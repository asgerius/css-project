[{"tags": ["http", "go", "tcp"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1521679550, "post_id": 49418283, "comment_id": 85839172, "body": "*http.Request.Write, http.ReadRequest, and http.ReadResponse may be a start. You probably end up re-implementing much of the http package though, like draining and closing request bodies, connection pools, keep-alive and such. It&#39;s certainly not easy with just the standard library."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521725161, "post_id": 49418283, "comment_id": 85861221, "body": "Out of curiosity, what on earth would you use this for?"}], "owner": {"reputation": 21, "user_id": 1886273, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66227e32d598fb630e62f554297681d8?s=128&d=identicon&r=PG", "display_name": "user1886273", "link": "https://stackoverflow.com/users/1886273/user1886273"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 427, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1521675754, "creation_date": 1521675754, "question_id": 49418283, "link": "https://stackoverflow.com/questions/49418283/golang-http-client-server-based-on-net-conn", "title": "golang http client/server based on net.conn", "body": "<p>I am wondering if there is easy way to reverse the http client/server tcp connection direction with golang.</p>\n\n<p>I would like http client behavior on tcp listen port, and http server on tcp dial out . </p>\n\n<p>Is there a way init/create http client or server based on already established net.conn and using them?</p>\n\n<p>thanks.</p>\n"}, {"tags": ["go", "indexing", "struct"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1521674257, "post_id": 49418006, "comment_id": 85837829, "body": "You would use reflection for it. But the whole idea looks dirty and unreasonable: you should always know what fields are available and how to access them."}, {"owner": {"reputation": 174, "user_id": 7884214, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-J_Pi1eA_Bqc/AAAAAAAAAAI/AAAAAAAARXY/NyN5RzuLLEw/photo.jpg?sz=128", "display_name": "initialed85", "link": "https://stackoverflow.com/users/7884214/initialed85"}, "edited": false, "score": 0, "creation_date": 1521676614, "post_id": 49418006, "comment_id": 85838502, "body": "I think I understand your use-case (supporting a requirement to update just one part of an existing post).   You could do something a little yuck- marshal the existing post into JSON and then into a <code>map[string]string</code>; if you did the same with the updated data, you could iterate through the updated data (which would have only one key), update that key in the map that represents the existing post and marshal that back into JSON and then unmarshal it into the post struct haha"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1521678940, "post_id": 49418006, "comment_id": 85839037, "body": "Don&#39;t try to program PHP or JavaScript in Go; that will just cause pain. Either use a map, or access struct fields by their (static) name."}, {"owner": {"reputation": 105, "user_id": 9368823, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sam White", "link": "https://stackoverflow.com/users/9368823/sam-white"}, "edited": false, "score": 1, "creation_date": 1521701269, "post_id": 49418006, "comment_id": 85845176, "body": "This code is of course going no where near production, I&#39;m just trying to solidify my learning. If it&#39;s not directly possible and you&#39;d need to iterate over a map then this answers my question. Thanks all!"}], "answers": [{"tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": true, "score": 6, "last_activity_date": 1521721478, "creation_date": 1521721478, "answer_id": 49428647, "question_id": 49418006, "link": "https://stackoverflow.com/questions/49418006/access-golang-struct-field-with-variable/49428647#49428647", "title": "access golang struct field with variable", "body": "<p>One of the main points when using <code>struct</code>s is that the way how to access the fields is known at compile time.Then the produced code uses fixed indexes added to a base address of the struct.</p>\n\n<p>For any kind of dynamism here  you just need to use <code>map[string]string</code> or similar.</p>\n"}], "owner": {"reputation": 105, "user_id": 9368823, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sam White", "link": "https://stackoverflow.com/users/9368823/sam-white"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4307, "favorite_count": 0, "accepted_answer_id": 49428647, "answer_count": 1, "score": 4, "last_activity_date": 1521721478, "creation_date": 1521674036, "question_id": 49418006, "link": "https://stackoverflow.com/questions/49418006/access-golang-struct-field-with-variable", "title": "access golang struct field with variable", "body": "<p>For reference: <a href=\"https://github.com/samisagit/go-learn/blob/0ec39f920ee0914ca73a8fd9a6abc74459e38c06/realWorldUse/main.go#L39\" rel=\"nofollow noreferrer\">example here</a></p>\n\n<p>I am trying to access a struct field using a variable key, to explain in PHP you can do the below.</p>\n\n<pre><code>$arr = [\"test\" =&gt; \"foo\"];\n$key = \"test\";\n$result = $arr[$key];\n</code></pre>\n\n<p>Or in Javascript you can do the below</p>\n\n<pre><code>const obj = {\"test\": \"foo\"}\nconst key = \"test\"\nconst result = obj[key]\n</code></pre>\n\n<p>Is this possible with go structs? I have searched for this functionality, but the answers always seem to point to the reflect package and running a for loop over the struct fields.</p>\n\n<p>My code (linked above) gets the compile error of <code>invalid operation: p[key] (type Post does not support indexing)</code> which makes sense, but I can't find a way around this.</p>\n"}, {"tags": ["go", "terminal", "stdin"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 2, "creation_date": 1521667368, "post_id": 49416526, "comment_id": 85835233, "body": "It can&#39;t be done easy with stdlib. You most likely need thirdparty library, some equivalent of GNU readline like <a href=\"https://github.com/chzyer/readline\" rel=\"nofollow noreferrer\">github.com/chzyer/readline</a> or <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">github.com/nsf/termbox-go</a> for example."}], "answers": [{"tags": [], "owner": {"reputation": 482, "user_id": 159650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9440222a0c3e33f369eef79712e12204?s=128&d=identicon&r=PG", "display_name": "dwright", "link": "https://stackoverflow.com/users/159650/dwright"}, "is_accepted": true, "score": 1, "last_activity_date": 1521667269, "creation_date": 1521667269, "answer_id": 49416721, "question_id": 49416526, "link": "https://stackoverflow.com/questions/49416526/read-space-without-enter-as-input-from-terminal/49416721#49416721", "title": "Read SPACE without ENTER as input from terminal", "body": "<p>There is a built in shell command <code>read -n1 -r -p \"Press SPACE to show next page, press q to quit\" key</code>. Possibly you could exec that. </p>\n\n<p>For a more full featured golang solution, see <code>github.com/nsf/termbox-go</code>. Good example: <a href=\"https://www.socketloop.com/tutorials/golang-get-ascii-code-from-a-key-press-cross-platform-example\" rel=\"nofollow noreferrer\">https://www.socketloop.com/tutorials/golang-get-ascii-code-from-a-key-press-cross-platform-example</a></p>\n"}, {"comments": [{"owner": {"reputation": 1348, "user_id": 672416, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a03515223968cf5903ceff3f04ecb4ef?s=128&d=identicon&r=PG", "display_name": "vancexu", "link": "https://stackoverflow.com/users/672416/vancexu"}, "edited": false, "score": 1, "creation_date": 1521672045, "post_id": 49417155, "comment_id": 85837126, "body": "I think you forget <code>tb.Close()</code>, so it behaves wired after program exit. But anyway, thanks for this example"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 4, "last_activity_date": 1521672517, "last_edit_date": 1521672517, "creation_date": 1521669308, "answer_id": 49417155, "question_id": 49416526, "link": "https://stackoverflow.com/questions/49416526/read-space-without-enter-as-input-from-terminal/49417155#49417155", "title": "Read SPACE without ENTER as input from terminal", "body": "<p>A simple solution with <code>github.com/nsf/termbox-go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    tb \"github.com/nsf/termbox-go\"\n)\n\nfunc main() {\n    err := tb.Init()\n    if err != nil {\n        panic(err)\n    }\n    defer tb.Close()\n    for {\n        fmt.Println(\"Press any key\")\n        event := tb.PollEvent()\n        switch {\n        case event.Ch == 'a':\n            fmt.Println(\"a\")\n        case event.Key == tb.KeyEsc:\n            fmt.Println(\"Bye!\")\n            return\n        case event.Key == tb.KeySpace:\n            fmt.Println(\"ANY KEY! You pressed SPACE!\")\n        case event.Key == tb.KeyEnter:\n            fmt.Println(\"ANY KEY! You pressed ENTER!\")\n        default:\n            fmt.Println(\"Any key.\")\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1348, "user_id": 672416, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a03515223968cf5903ceff3f04ecb4ef?s=128&d=identicon&r=PG", "display_name": "vancexu", "link": "https://stackoverflow.com/users/672416/vancexu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 647, "favorite_count": 0, "accepted_answer_id": 49416721, "answer_count": 2, "score": 2, "last_activity_date": 1521672553, "creation_date": 1521666421, "last_edit_date": 1521672553, "question_id": 49416526, "link": "https://stackoverflow.com/questions/49416526/read-space-without-enter-as-input-from-terminal", "title": "Read SPACE without ENTER as input from terminal", "body": "<p>I had a CLI program which will ask user to type ENTER to continue and OTHER keys to abort. </p>\n\n<pre><code>for {\n    show() // list one page\n\n    fmt.Printf(\"Press ENTER to show next page, press any other key then Enter to quit\")\n    var input string\n    fmt.Scanln(&amp;input)\n    if strings.Trim(input, \" \") == \"\" {\n        continue\n    } else {\n        break\n    }\n}\n</code></pre>\n\n<p>I want to improve user experience: instead of \"ENTER or press something then ENTER\", how can I make it <strong>\"Press SPACE to show next page, press q to quit\"</strong>, just like Linux command \"more\" and others.  </p>\n\n<p>To make it clear:  </p>\n\n<ul>\n<li>The existing control to continue is \"ENTER\", I want to use \"SPACE\" (just SPACE, not SPACE+ENTER); </li>\n<li>The existing control to quit is \"any key + ENTER\", I want to use \"q\" (just q, not q+ENTER)</li>\n</ul>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 18792, "user_id": 385548, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e8f290affc1d939cf9a4ad2c9e79592a?s=128&d=identicon&r=PG", "display_name": "Vojtech Vitek", "link": "https://stackoverflow.com/users/385548/vojtech-vitek"}, "is_accepted": true, "score": 6, "last_activity_date": 1521668136, "last_edit_date": 1521668136, "creation_date": 1521662950, "answer_id": 49415664, "question_id": 49415573, "link": "https://stackoverflow.com/questions/49415573/golang-json-how-do-i-unmarshal-array-of-strings-into-int64/49415664#49415664", "title": "Golang: JSON: How do I unmarshal array of strings into []int64", "body": "<p>For anyone interested, I found a solution using a custom type having <code>MarshalJSON()</code> and <code>UnmarshalJSON()</code> methods defined.</p>\n\n<pre><code>type Int64StringSlice []int64\n\nfunc (slice Int64StringSlice) MarshalJSON() ([]byte, error) {\n    values := make([]string, len(slice))\n    for i, value := range []int64(slice) {\n        values[i] = fmt.Sprintf(`\"%v\"`, value)\n    }\n\n    return []byte(fmt.Sprintf(\"[%v]\", strings.Join(values, \",\"))), nil\n}\n\nfunc (slice *Int64StringSlice) UnmarshalJSON(b []byte) error {\n    // Try array of strings first.\n    var values []string\n    err := json.Unmarshal(b, &amp;values)\n    if err != nil {\n        // Fall back to array of integers:\n        var values []int64\n        if err := json.Unmarshal(b, &amp;values); err != nil {\n            return err\n        }\n        *slice = values\n        return nil\n    }\n    *slice = make([]int64, len(values))\n    for i, value := range values {\n        value, err := strconv.ParseInt(value, 10, 64)\n        if err != nil {\n            return err\n        }\n        (*slice)[i] = value\n    }\n    return nil\n}\n</code></pre>\n\n<p>The above solution marshals <code>[]int64</code> into JSON string array. Unmarshaling works from both JSON string and integer arrays, ie.:</p>\n\n<pre><code>{\"bars\": [\"1729382256910270462\", \"309286902808622\", \"23\"]}\n\n{\"bars\": [1729382256910270462, 309286902808622, 23]}\n</code></pre>\n\n<p>See example at <a href=\"https://play.golang.org/p/BOqUBGR3DXm\" rel=\"noreferrer\">https://play.golang.org/p/BOqUBGR3DXm</a></p>\n"}, {"comments": [{"owner": {"reputation": 18792, "user_id": 385548, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e8f290affc1d939cf9a4ad2c9e79592a?s=128&d=identicon&r=PG", "display_name": "Vojtech Vitek", "link": "https://stackoverflow.com/users/385548/vojtech-vitek"}, "edited": false, "score": 0, "creation_date": 1522121301, "post_id": 49431320, "comment_id": 86011900, "body": "Nice, that works too! I didn&#39;t think of implementing a custom marshaler on an individual element and then make it a slice :)  I guess both implementations are equivalent. The slice approach should be a bit more performant - but only in order of microseconds - which is unlikely a bottle neck for any real app.  Thanks for sharing!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1521729158, "creation_date": 1521729158, "answer_id": 49431320, "question_id": 49415573, "link": "https://stackoverflow.com/questions/49415573/golang-json-how-do-i-unmarshal-array-of-strings-into-int64/49431320#49431320", "title": "Golang: JSON: How do I unmarshal array of strings into []int64", "body": "<p>As you quoted from <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal()</code></a>, the <code>,string</code> option only applies to specific types, namely:</p>\n\n<blockquote>\n  <p>The \"string\" option signals that a field is stored as JSON inside a JSON-encoded string. <strong>It applies only to fields of string, floating point, integer, or boolean types.</strong></p>\n</blockquote>\n\n<p>You want it to work with a slice, but that is not supported by the <code>json</code> package.</p>\n\n<p>If you still want this functionality, you have to write your custom marshaling / unmarshaling logic.</p>\n\n<p>What you presented works, but it is unnecessarily complex. This is because you created your custom logic on slices, but you only want this functionality on individual elements of the slices (arrays). You don't want to change how an array / slice (as a sequence of elements) is rendered or parsed.</p>\n\n<p>So a much simpler solution is to only create a custom \"number\" type producing this behavior, and elements of slices of this custom type will behave the same.</p>\n\n<p>Our custom number type and the marshaling / unmarshaling logic:</p>\n\n<pre><code>type Int64Str int64\n\nfunc (i Int64Str) MarshalJSON() ([]byte, error) {\n    return json.Marshal(strconv.FormatInt(int64(i), 10))\n}\n\nfunc (i *Int64Str) UnmarshalJSON(b []byte) error {\n    // Try string first\n    var s string\n    if err := json.Unmarshal(b, &amp;s); err == nil {\n        value, err := strconv.ParseInt(s, 10, 64)\n        if err != nil {\n            return err\n        }\n        *i = Int64Str(value)\n        return nil\n    }\n\n    // Fallback to number\n    return json.Unmarshal(b, (*int64)(i))\n}\n</code></pre>\n\n<p>And that's all!</p>\n\n<p>The type using it:</p>\n\n<pre><code>type Foo struct {\n    Bars []Int64Str `json:\"bars\"`\n}\n</code></pre>\n\n<p>Testing it the same way as you did yields the same result. Try it on the <a href=\"https://play.golang.org/p/DuzIqx6JHJ2\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 18792, "user_id": 385548, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e8f290affc1d939cf9a4ad2c9e79592a?s=128&d=identicon&r=PG", "display_name": "Vojtech Vitek", "link": "https://stackoverflow.com/users/385548/vojtech-vitek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10731, "favorite_count": 4, "accepted_answer_id": 49415664, "answer_count": 2, "score": 2, "last_activity_date": 1521729158, "creation_date": 1521662576, "question_id": 49415573, "link": "https://stackoverflow.com/questions/49415573/golang-json-how-do-i-unmarshal-array-of-strings-into-int64", "title": "Golang: JSON: How do I unmarshal array of strings into []int64", "body": "<p>Golang <code>encoding/json</code> package lets you use <code>,string</code> struct tag in order to marshal/unmarshal string values (like <code>\"309230\"</code>) into <code>int64</code> field. Example:</p>\n\n<pre><code>Int64String int64 `json:\",string\"`\n</code></pre>\n\n<p>However, this doesn't work for slices, ie. <code>[]int64</code>:</p>\n\n<pre><code>Int64Slice []int64 `json:\",string\"` // Doesn't work.\n</code></pre>\n\n<p><strong>Is there any way to marshal/unmarshal JSON string arrays into []int64 field?</strong></p>\n\n<hr>\n\n<p>Quote from <a href=\"https://golang.org/pkg/encoding/json\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json</a>:</p>\n\n<blockquote>\n  <p>The \"string\" option signals that a field is stored as JSON inside a JSON-encoded string. It applies only to fields of string, floating point, integer, or boolean types. This extra level of encoding is sometimes used when communicating with JavaScript programs:</p>\n</blockquote>\n"}, {"tags": ["java", "android", "go", "apk", "gomobile"], "answers": [{"comments": [{"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "edited": false, "score": 1, "creation_date": 1521717357, "post_id": 49418556, "comment_id": 85855448, "body": "Thank you so much, will try that. I guess then that I&#39;m out of luck using the built-in static file middleware that Echo (my web server that will run on the Android device) uses, but I can write my own static file serving middleware whith this info. ;)"}], "tags": [], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "is_accepted": true, "score": 3, "last_activity_date": 1521677760, "creation_date": 1521677760, "answer_id": 49418556, "question_id": 49412762, "link": "https://stackoverflow.com/questions/49412762/gomobile-how-to-embed-assets-in-apk/49418556#49418556", "title": "gomobile how to embed assets in apk", "body": "<p>You must put your assets within a directory called 'assets'.</p>\n\n<p>See this example:</p>\n\n<p><a href=\"https://github.com/udhos/fugo/tree/master/demo/invader/assets\" rel=\"nofollow noreferrer\">https://github.com/udhos/fugo/tree/master/demo/invader/assets</a></p>\n\n<p>Then you can use the package <a href=\"https://godoc.org/golang.org/x/mobile/asset\" rel=\"nofollow noreferrer\">golang.org/x/mobile/asset</a> to load the desired asset:</p>\n\n<pre><code>import \"golang.org/x/mobile/asset\"\n\nf, err := asset.Open(\"image.png\")\n</code></pre>\n\n<p>Sample code taken from <a href=\"https://github.com/udhos/fugo/blob/master/demo/invader/main.go\" rel=\"nofollow noreferrer\">https://github.com/udhos/fugo/blob/master/demo/invader/main.go</a>:</p>\n\n<pre><code>func loadFull(name string) ([]byte, error) {\n    f, errOpen := asset.Open(name)\n    if errOpen != nil {\n        return nil, errOpen\n    }\n    defer f.Close()\n    buf, errRead := ioutil.ReadAll(f)\n    if errRead != nil {\n        return nil, errRead\n    }\n    log.Printf(\"loaded: %s (%d bytes)\", name, len(buf))\n    return buf, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 409, "favorite_count": 2, "accepted_answer_id": 49418556, "answer_count": 1, "score": 2, "last_activity_date": 1521677760, "creation_date": 1521652721, "last_edit_date": 1521653160, "question_id": 49412762, "link": "https://stackoverflow.com/questions/49412762/gomobile-how-to-embed-assets-in-apk", "title": "gomobile how to embed assets in apk", "body": "<p>When developing with gomobile for Android. How can I include assets (html, js, images) inside the apk file? I have a web server running inside the apk which works inside the apk as well as with go run, but when packaged inside the apk on the phone the service cannot find it's assets/static files.</p>\n"}, {"tags": ["go", "multipartform-data", "temporary-files"], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521642527, "post_id": 49408461, "comment_id": 85819349, "body": "Is there a way to stop writing in temporary files in first place?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1521642863, "post_id": 49408461, "comment_id": 85819642, "body": "@JohnBalvinArias Set <code>maxMemory</code> so large that everything fits into memory."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521643244, "post_id": 49408461, "comment_id": 85819956, "body": "but that would be worse, It&#180;s the same scenario, but now it&#180;s memory"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1521644060, "post_id": 49408461, "comment_id": 85820624, "body": "@JohnBalvinArias: what exactly do you want to do? If you want to read the entire form, memory or temporary files are the only possible destinations."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1521644283, "post_id": 49408461, "comment_id": 85820812, "body": "I just want to read it from memory, &quot;normal users&quot; would not be even allowed to upload any file &gt; 5MB because of front end, but any hacker can do it and I may be in troubles if I don&#180;t make this in a good way"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1521644895, "post_id": 49408461, "comment_id": 85821274, "body": "If you want to read each part yourself, then use <a href=\"https://golang.org/pkg/net/http/#Request.MultipartReader\" rel=\"nofollow noreferrer\"><code>MultiPartReader</code></a>. If you want to limit the request body size altogether, then use <a href=\"https://golang.org/pkg/net/http/#MaxBytesReader\" rel=\"nofollow noreferrer\"><code>MaxBytesReader</code></a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1521642286, "last_edit_date": 1521642286, "creation_date": 1521640999, "answer_id": 49408461, "question_id": 49408239, "link": "https://stackoverflow.com/questions/49408239/are-temporary-files-temporal-if-so-how-long/49408461#49408461", "title": "are temporary files temporal? if so how long?", "body": "<p>Temporary files live for the duration of the request. Parsing of the form and the creation of the temp files are handled by the <a href=\"https://golang.org/pkg/mime/multipart/\" rel=\"noreferrer\"><code>mime/multipart</code></a> package.</p>\n\n<p>When the server finishes the request, it calls <a href=\"https://golang.org/pkg/mime/multipart/#Form.RemoveAll\" rel=\"noreferrer\"><code>Form.RemoveAll</code></a> to delete any temporary files associated with the form data.</p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "accepted_answer_id": 49408461, "answer_count": 1, "score": 6, "last_activity_date": 1521642286, "creation_date": 1521640458, "last_edit_date": 1521642272, "question_id": 49408239, "link": "https://stackoverflow.com/questions/49408239/are-temporary-files-temporal-if-so-how-long", "title": "are temporary files temporal? if so how long?", "body": "<p>I\u00b4m building a web app that allows users to upload files &lt; 5MB, and for this I\u00b4m using <em>Request.ParseMultipartForm(5000000)</em>, but I\u00b4m wondering what happens if a funny guy tries to upload a file bigger than 5MB, documentation is not clear enough <a href=\"https://golang.org/pkg/net/http/#Request.ParseMultipartForm\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Request.ParseMultipartForm</a> </p>\n\n<blockquote>\n  <p>The whole request body is parsed and up to a total of maxMemory bytes of its file parts are stored in memory, with the remainder stored on disk in temporary files</p>\n</blockquote>\n\n<p>So, how long \"temporary files\" really means? because it\u00b4s a little ambiguous, does that mean that remaining file will be erase after the handler function returns? or does mean that has a lifetime determined? I wouldn\u00b4t want my app to crash if some guys try to do this and I run out of disk space.</p>\n"}, {"tags": ["ruby-on-rails", "go", "websocket"], "comments": [{"owner": {"reputation": 301, "user_id": 5522798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca03387e0294e139c95113cfdf6a34c5?s=128&d=identicon&r=PG&f=1", "display_name": "tomjohn", "link": "https://stackoverflow.com/users/5522798/tomjohn"}, "edited": false, "score": 0, "creation_date": 1566412286, "post_id": 49407668, "comment_id": 101651868, "body": "It looks like you&#39;re trying to configure <code>anycable-go</code> from your Rails application <a href=\"https://docs.anycable.io/#/anycable-go/getting_started?id=configuration-parameters\" rel=\"nofollow noreferrer\">anycable-go config docs</a>. Your Rails app will only be coupled to the AnyCable RPC server. I might be able to write an answer if you can provide information on how you&#39;re starting <code>anycable-go</code> and with what arguments."}], "answers": [{"tags": [], "owner": {"reputation": 141, "user_id": 5301781, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/xeQLO.jpg?s=128&g=1", "display_name": "Darlyn", "link": "https://stackoverflow.com/users/5301781/darlyn"}, "is_accepted": false, "score": 0, "last_activity_date": 1521833998, "creation_date": 1521833998, "answer_id": 49457237, "question_id": 49407668, "link": "https://stackoverflow.com/questions/49407668/cant-connect-rails-and-go-via-websocket-using-anycable/49457237#49457237", "title": "Can&#39;t connect Rails and Go via websocket using AnyCable", "body": "<p>I have my next file: </p>\n\n<p><strong>config/anycable.yml</strong></p>\n\n<pre><code>development:\n  # gRPC server host\n  rpc_host: \"localhost:50051\"\n  # Redis URL (for broadcasting)\n  redis_url: \"redis://localhost:6379/2\"\n  # You can also turn on access logging\n  access_logs_disabled: false\n  debug: true\n</code></pre>\n\n<p>and I run my servers:</p>\n\n<p><strong>my file Procfile.dev</strong> is not neccessary</p>\n\n<pre><code>web: bundle exec rails s -b 0.0.0.0 -p 3000\nrpc: bundle exec ./bin/anycable\ngo: sleep 5 &amp;&amp; ./cable/anycable-go-0.5.4 -addr 'host.lvh.me:8080' -disconnect_rate=1\n</code></pre>\n"}], "owner": {"reputation": 477, "user_id": 492171, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ab6e70add4e782e0ed6b2f800a293cf9?s=128&d=identicon&r=PG", "display_name": "Cem Baykam", "link": "https://stackoverflow.com/users/492171/cem-baykam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 640, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1614926419, "creation_date": 1521638957, "last_edit_date": 1521639413, "question_id": 49407668, "link": "https://stackoverflow.com/questions/49407668/cant-connect-rails-and-go-via-websocket-using-anycable", "title": "Can&#39;t connect Rails and Go via websocket using AnyCable", "body": "<p>I am trying to configure Anycable in a Rails 5.2 application which needs to communicate with a GO server. </p>\n\n<p>This is my anycable configuration in the Rails: </p>\n\n<pre><code>default: &amp;default\nrpc_host: \"localhost:50051\"\nlog_grpc: false\nlog_file: nil\ndebug: false # Shortcut to enable GRPC logging and debug level\nlog_level: info\nredis_channel: \"__anycable__\" \nredis_sentinels: []\n\n\nproduction:\n  &lt;&lt;: *default\n  redis_url: \"redis://localhost:6379/1\"\n\ndevelopment:\n  &lt;&lt;: *default\n  redis_url: \"redis://localhost:6379/2\"\n</code></pre>\n\n<p>And the anycable server runs in localhost:3334 (Using default settings.) \nHowever when I try to connect to the same server  from the GO application I am starting to get connection timeout errors from the Rails side. (Tried vice versa and got timeout on the GO side)</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1001, "user_id": 4940012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbcb1a537f1a07c08d08cc72c7efb921?s=128&d=identicon&r=PG&f=1", "display_name": "bearzyj", "link": "https://stackoverflow.com/users/4940012/bearzyj"}, "edited": false, "score": 0, "creation_date": 1521638315, "post_id": 49407315, "comment_id": 85815854, "body": "Wow, you are a genius. With your reminding I tried it like this &quot;r := regexp.MustCompile(<code>(\\d+).*?(\\d+)</code>)&quot;, then it also works. Thanks a lot!"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1521638029, "creation_date": 1521638029, "answer_id": 49407315, "question_id": 49407165, "link": "https://stackoverflow.com/questions/49407165/golang-regexp-findstringsubmatch-doesnt-return-the-correct-last-group/49407315#49407315", "title": "golang regexp FindStringSubmatch() doesn&#39;t return the correct last group", "body": "<p>Regular expressions are greedy, so <code>.*</code> will match <code>01</code> leaving just <code>2</code> to match the final <code>\\d+</code>.</p>\n\n<p>You probably want to change your expression to something like the following: <code>(\\d+)[^\\d]*(\\d+)$</code> to match a sequence of digits (captured), anything but a sequence of digits, a sequence of digits (captured), and the end of line.</p>\n\n<p>The same code for the rest will print what you expected:</p>\n\n<pre><code>len(m)=3\n012 abc 012\n012\n012\n</code></pre>\n"}], "owner": {"reputation": 1001, "user_id": 4940012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dbcb1a537f1a07c08d08cc72c7efb921?s=128&d=identicon&r=PG&f=1", "display_name": "bearzyj", "link": "https://stackoverflow.com/users/4940012/bearzyj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "accepted_answer_id": 49407315, "answer_count": 1, "score": -1, "last_activity_date": 1521638029, "creation_date": 1521637650, "last_edit_date": 1521637988, "question_id": 49407165, "link": "https://stackoverflow.com/questions/49407165/golang-regexp-findstringsubmatch-doesnt-return-the-correct-last-group", "title": "golang regexp FindStringSubmatch() doesn&#39;t return the correct last group", "body": "<p>I am using go1.10 darwin/amd64, here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    raw := \"012 abc 012\"\n    r := regexp.MustCompile(`(\\d+).*(\\d+)`)\n    m := r.FindStringSubmatch(raw)\n    fmt.Printf(\"len(m)=%v\\n%v\\n%v\\n%v\\n\", len(m), m[0], m[1], m[2])\n}\n</code></pre>\n\n<p>Output is:</p>\n\n<blockquote>\n  <p>len(m)=3 </p>\n  \n  <p>012 abc 012</p>\n  \n  <p>012</p>\n  \n  <p>2</p>\n</blockquote>\n\n<p>You can also run it here: <a href=\"https://play.golang.org/p/i2zlhClB72e\" rel=\"nofollow noreferrer\">https://play.golang.org/p/i2zlhClB72e</a></p>\n\n<p>I expect that the output of m[2] is \"012\" but not \"2\". </p>\n\n<p>Can anyone let me know where the issue is? Thanks very much.</p>\n"}, {"tags": ["sql", "go", "sqlx"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1521638459, "post_id": 49407058, "comment_id": 85815988, "body": "Where is <code>db</code> defined? Is it a local variable inside <code>main()</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1521641373, "post_id": 49407549, "comment_id": 85818421, "body": "Yes. This got the db error away, but instead I got &quot;err declared and not used&quot;."}, {"owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "reply_to_user": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1521642879, "post_id": 49407549, "comment_id": 85819658, "body": "Well if you don&#39;t use a variable in go, you can use an underscore as a placeholder: rows, _ := db.Query(...). But I suggest handling all errors, so make sure you don&#39;t have any unused variable in your code."}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1521643489, "post_id": 49407549, "comment_id": 85820135, "body": "Underscore solved one problem, but gives another error: &quot;undefined: err&quot;"}, {"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1521750621, "post_id": 49407549, "comment_id": 85877818, "body": "Can you specify where to start? I find nothing about SQL or error handling."}, {"owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "reply_to_user": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1521795358, "post_id": 49407549, "comment_id": 85892962, "body": "I think you&#39;re missing a general understanding on how variable declaration works in Go. Your problems are not SQL specific. You can start for example at &quot;Variables with initializers&quot;: <a href=\"https://tour.golang.org/basics/9\" rel=\"nofollow noreferrer\">tour.golang.org/basics/9</a>"}], "tags": [], "owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "is_accepted": true, "score": 3, "last_activity_date": 1521642919, "last_edit_date": 1521642919, "creation_date": 1521638685, "answer_id": 49407549, "question_id": 49407058, "link": "https://stackoverflow.com/questions/49407058/moving-query-to-handler-gets-undefined-db-golang/49407549#49407549", "title": "Moving query to handler gets &quot;undefined: db&quot; (golang)", "body": "<p>Define your db variable outside of main, e.g.:</p>\n\n<pre><code>var db *sql.DB\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    rows, err := db.Query(...)\n    // use it\n}\n\nfunc main() {\n    db, _ = sql.Open(...)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "edited": false, "score": 0, "creation_date": 1521641535, "post_id": 49408087, "comment_id": 85818548, "body": "&quot;next time I suggest to post the full code&quot;. I tried, but SO prohibit long code if I do not write much text."}], "tags": [], "owner": {"reputation": 417, "user_id": 3049386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/754afefdb87c446066459a9857d9a0cf?s=128&d=identicon&r=PG&f=1", "display_name": "Bestbug", "link": "https://stackoverflow.com/users/3049386/bestbug"}, "is_accepted": false, "score": 0, "last_activity_date": 1521640139, "creation_date": 1521640139, "answer_id": 49408087, "question_id": 49407058, "link": "https://stackoverflow.com/questions/49407058/moving-query-to-handler-gets-undefined-db-golang/49408087#49408087", "title": "Moving query to handler gets &quot;undefined: db&quot; (golang)", "body": "<p>For what I can see with the code you posted (next time I suggest to post the full code) you are declaring the db variable on the main function but you are referring it in a function who have no visibility of that variable. In order to fix the problem you have various way. the easiest way is to declare a global variable like <code>var db typename</code> and on the main function don't use the <code>:=</code> assign but only <code>=</code>. In this mode you can set the global variable (in the other case you are create a local variable named db in the main function). Note in a concurrency environment this could be a problem, consider to study your driver library to see if have some guarantee about concurrency or best practice.</p>\n"}], "owner": {"reputation": 1378, "user_id": 3496776, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/0b93e9de0f94f4c49617f50d5fd7e63f?s=128&d=identicon&r=PG&f=1", "display_name": "sibert", "link": "https://stackoverflow.com/users/3496776/sibert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1265, "favorite_count": 1, "accepted_answer_id": 49407549, "answer_count": 2, "score": 2, "last_activity_date": 1521644337, "creation_date": 1521637363, "last_edit_date": 1521644337, "question_id": 49407058, "link": "https://stackoverflow.com/questions/49407058/moving-query-to-handler-gets-undefined-db-golang", "title": "Moving query to handler gets &quot;undefined: db&quot; (golang)", "body": "<p>I am trying to use Golang as a REST API. I have managed to get handlers to work and queries as well. But not got a query inside a handler to work.</p>\n\n<p>When the query resides within the main() it works: </p>\n\n<pre><code>func handleRequests() {\n    http.HandleFunc(\"/getuser\", Getuser)\n}\n\n---&gt; this handler gets respons on localhost:8080/getuser\n\nfunc Getuser(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Getuser\")\n}\n\nfunc main() {\n    handleRequests()\n\n    //Connect to db\n\n    rows, err := db.Queryx(`SELECT \"USER_ID\",\"USER_NAME\" FROM user`)\n    for rows.Next() {\n        results := make(map[string]interface{})\n        err = rows.MapScan(results)\n    fmt.Printf(\"%#v\\n\", results)\n    }\n\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>But when I move the query to the handler it gives an error that the db is not defined.</p>\n\n<pre><code>func handleRequests() {\n    http.HandleFunc(\"/getuser\", Getuser)\n}\n\n---&gt; this gives the error that the db is not defined\n\nfunc Getuser(w http.ResponseWriter, r *http.Request) {\n    rows, err := db.Queryx(`SELECT \"USER_ID\",\"USER_NAME\" FROM user`)\n    for rows.Next() {\n        results := make(map[string]interface{})\n        err = rows.MapScan(results)\n    fmt.Printf(\"%#v\\n\", results)\n    }\n}\n\nfunc main() {\n    handleRequests()\n\n    //Connect to db\n\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n }\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>Full code inside the handler (added db var as suggested), but gives various errors on \"err\".</p>\n\n<pre><code> var db *sqlx.DB &lt;---solved the db problem\n\n func Getsign(w http.ResponseWriter, r *http.Request) {\n    rows, err := db.Queryx(`SELECT \"USER_ID\",\"USER_NAME\" FROM user`)\n    for rows.Next() {\n        results := make(map[string]interface{})\n        err = rows.MapScan(results)\n        fmt.Printf(\"%#v\\n\", results)\n    }\n\n    defer rows.Close()\n\n    if err := rows.Err(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>Any tip what I am doing wrong?</p>\n"}, {"tags": ["go", "command-line", "command-line-interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1521637746, "post_id": 49406738, "comment_id": 85815405, "body": "1. Commands are commands (like foo) and flags a flags (like --foo). 2. No. Yes commands have flags. 3. ??? 4. ??? (question of taste)."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9528667"}, "edited": false, "score": 0, "creation_date": 1521640202, "post_id": 49407737, "comment_id": 85817426, "body": "so you mean that the \u201cmachine&quot; should be --flag"}, {"owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "edited": false, "score": 0, "creation_date": 1521640326, "post_id": 49407737, "comment_id": 85817535, "body": "In my example, yes. But I don&#39;t now your actual goal :)"}], "tags": [], "owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "is_accepted": true, "score": 1, "last_activity_date": 1521639114, "creation_date": 1521639114, "answer_id": 49407737, "question_id": 49406738, "link": "https://stackoverflow.com/questions/49406738/command-line-flags-and-commands/49407737#49407737", "title": "Command line flags and commands", "body": "<p>A command tells the application what to do, for example \"tool sayhello\". Flags are used to pass information required by the application to achieve its task, for example \"tool sayhello --message='Hello World'\". Flags are often shortened by using their first letter and one hyphen.</p>\n\n<p>How you design the commands and flags of your application is up to you. If you want to create a deployment tool for example, you could create a command \"deploy\" and a flag for the machine to deploy to: \"tool deploy --machine=hostip\".</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9528667"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 49407737, "answer_count": 1, "score": -3, "last_activity_date": 1521639114, "creation_date": 1521636502, "question_id": 49406738, "link": "https://stackoverflow.com/questions/49406738/command-line-flags-and-commands", "title": "Command line flags and commands", "body": "<p>I need to start working on command line tool, and I\u2019ve few questions</p>\n\n<p>we have decided to use cobra for go\n<a href=\"https://github.com/spf13/cobra\" rel=\"nofollow noreferrer\">https://github.com/spf13/cobra</a> </p>\n\n<p>From the help : </p>\n\n<pre><code>$ cobra help\n\nCobra is a CLI library for Go that empowers applications.\nThis application is a tool to generate the needed files\nto quickly create a Cobra application.\n\nUsage:\n  cobra [command]\n\nAvailable Commands:\n  add         Add a command to a Cobra Application\n  help        Help about any command\n  init        Initialize a Cobra Application\n\nFlags:\n  -a, --author string    author name for copyright attribution (default \"YOUR NAME\")\n      --config string    config file (default is $HOME/.cobra.yaml)\n  -h, --help             help for cobra\n  -l, --license string   name of license for the project\n      --viper            use Viper for configuration (default true)\n\nUse \"cobra [command] --help\" for more information about a command.\n</code></pre>\n\n<p>My questions are:</p>\n\n<blockquote>\n  <ol>\n  <li>what is the relations/diff between commands and flags (Available Commands) semantic \u2026.</li>\n  <li>is there is relations between command and flags</li>\n  <li>Are single command should support flags </li>\n  <li>in case in Need to provide command like deploy to x should it be \u2018deploy -x\u2019</li>\n  </ol>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1521633921, "post_id": 49405877, "comment_id": 85812657, "body": "In this (pretty strange) setup: not at all. If you know before how many things you are going to process: Just read that many elements from the channel. You write 5, you read 5, no need to do some fancy close dance."}, {"owner": {"reputation": 666, "user_id": 9060838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/889fa7aa60691aed08d3a5b1e396770f?s=128&d=identicon&r=PG&f=1", "display_name": "chanioxaris", "link": "https://stackoverflow.com/users/9060838/chanioxaris"}, "edited": false, "score": 0, "creation_date": 1521634944, "post_id": 49405877, "comment_id": 85813389, "body": "Maybe you can range over nums array and inside receive the data from channel. After that you can safely close it."}, {"owner": {"reputation": 1965, "user_id": 508214, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xKgdj.png?s=128&g=1", "display_name": "titogeo", "link": "https://stackoverflow.com/users/508214/titogeo"}, "edited": false, "score": 1, "creation_date": 1521635248, "post_id": 49405877, "comment_id": 85813613, "body": "@volkerI am not sure if it writes five. What if the HTTP GET timed out etc..."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1521637586, "post_id": 49405877, "comment_id": 85815280, "body": "Then send that information. In any case you have to redesign."}, {"owner": {"reputation": 1965, "user_id": 508214, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xKgdj.png?s=128&g=1", "display_name": "titogeo", "link": "https://stackoverflow.com/users/508214/titogeo"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1521659278, "post_id": 49405877, "comment_id": 85831037, "body": "@Volker I know I have to redesign, What would that be, and that&#39;s why I am here."}, {"owner": {"reputation": 111, "user_id": 9397311, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Nico Mitchell", "link": "https://stackoverflow.com/users/9397311/nico-mitchell"}, "edited": false, "score": 1, "creation_date": 1521750341, "post_id": 49405877, "comment_id": 85877648, "body": "This will work fine as is if you add a waitgroup and use a go func() call after the for loop to close the channel once the waitgroup is done."}], "owner": {"reputation": 1965, "user_id": 508214, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/xKgdj.png?s=128&g=1", "display_name": "titogeo", "link": "https://stackoverflow.com/users/508214/titogeo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "closed_date": 1521634869, "answer_count": 0, "score": 0, "last_activity_date": 1521633753, "creation_date": 1521633753, "question_id": 49405877, "link": "https://stackoverflow.com/questions/49405877/how-to-effectively-close-the-channel-in-golang", "closed_reason": "Duplicate", "title": "How to effectively close the channel in golang?", "body": "<p>I am new to GoLang. How to close the channel in below code. I am following the tutorial <a href=\"https://gobyexample.com/closing-channels\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<ul>\n<li>If I close on //Location 1 I do not get any data.</li>\n<li>If I close on //Location 2 I get a <code>panic: send on closed channel</code> occasionally.</li>\n<li>if I do not close, the range loop on the channel does not break</li>\n</ul>\n\n<p>-</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"strconv\"\n)\n\nfunc main() {\n    nums := []int{2, 3, 4, 1, 5}\n    channel := make(chan string, len(nums))\n    for i, num := range nums {\n        go getUser(strconv.Itoa(num), len(nums), i, channel)\n    }\n    // Location 1\n    // close(channel)\n    for data := range channel {\n        fmt.Println(data)\n    }\n\n}\n\nfunc getUser(userID string, length int, current int, channel chan string) {\n    resp, err := http.Get(\"https://jsonplaceholder.typicode.com/users/\" + userID)\n    if err != nil {\n        // handle error\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    data := string(body)\n    channel &lt;- data\n    // Location 2\n    // if current == length-1 {\n    //  close(channel)\n    // }\n}\n</code></pre>\n"}, {"tags": ["go", "type-declaration"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 8, "creation_date": 1521623554, "post_id": 49402138, "comment_id": 85805505, "body": "you should start with <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">Effective Go</a>. to get an idea in working with go."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1521623587, "post_id": 49402138, "comment_id": 85805518, "body": "It defines a new named Type &quot;PublicKey&quot; wich is a byte slice. This is not a struct (no <code>struct</code> keyword here) nor inheritance nor type alias (which is something completely different). It is more the total oposit of inheritance: After <code>type X Y</code> type X has the memory layout of Y but <b>none</b> of Y&#39;s methods. And take the Tour of Go first."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 18, "last_activity_date": 1521627184, "last_edit_date": 1521627184, "creation_date": 1521623736, "answer_id": 49402234, "question_id": 49402138, "link": "https://stackoverflow.com/questions/49402138/what-is-the-meaning-of-this-type-declaration/49402234#49402234", "title": "What is the meaning of this type declaration?", "body": "<p>It's a <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"noreferrer\">type declaration</a>, more specifically a <em>type definition</em>. It creates a new type, having <code>[]byte</code> as its underlying type:</p>\n\n<blockquote>\n  <p>A type definition creates a new, distinct type with the same <a href=\"https://golang.org/ref/spec#Types\" rel=\"noreferrer\">underlying type</a> and operations as the given type, and binds an identifier to it.</p>\n</blockquote>\n\n<p>New types are created because they can simplify using them multiple times, their identifier (their name) may be expressive in other contexts, and\u2013most importantly\u2013so that you can define (attach) methods to it (you can't attach methods to built-in types, nor to anonymous types or types defined in other packages).</p>\n\n<p>This last part (attaching methods) is important, because even though instead of attaching methods you could just as easily create and use functions that accept the \"original\" type as parameter, only types with methods can implement interfaces that list (\"prescribe\") those methods, and as mentioned earlier, you can't attach methods to certain types unless you create a new type derived from them.</p>\n\n<p>As an example, the type <code>[]int</code> will never implement the <a href=\"https://golang.org/pkg/sort/#Interface\" rel=\"noreferrer\"><code>sort.Interface</code></a> required to be sortable (by the <code>sort</code> package), so a new type <a href=\"https://golang.org/pkg/sort/#IntSlice\" rel=\"noreferrer\"><code>sort.IntSlice</code></a> is created (which is <code>type IntSlice []int</code>) to which the required methods are attached, so you can pass a value of type <code>sort.IntSlice</code> to the <a href=\"https://golang.org/pkg/sort/#Sort\" rel=\"noreferrer\"><code>sort.Sort()</code></a> function but not a value of type <code>[]int</code>. Since <code>sort.IntSlice</code> has <code>[]int</code> as its underlying type, if you have a value of <code>[]int</code>, you can simply <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">convert</a> it to <code>sort.IntSlice</code> if you want to sort it, like in this example (try it on the <a href=\"https://play.golang.org/p/L2AXaWdCzWX\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>is := []int{1,3,2}\nsort.Sort(sort.IntSlice(is))\nfmt.Println(is) // Prints: [1 2 3]\n</code></pre>\n\n<p>When you create a new type, there is no \"inheritance\" involved. The new type will have 0 methods. If you want \"inheritance-like\" functionality, you should check out embedding (in relation with <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"noreferrer\">struct types</a>), in which case the embedder type will also \"have\" the methods of the embedded type.</p>\n"}], "owner": {"reputation": 153, "user_id": 1831738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ffaad782263b04db1a2afd9c8242718?s=128&d=identicon&r=PG", "display_name": "Hisko", "link": "https://stackoverflow.com/users/1831738/hisko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3823, "favorite_count": 2, "accepted_answer_id": 49402234, "answer_count": 1, "score": 3, "last_activity_date": 1521627184, "creation_date": 1521623395, "question_id": 49402138, "link": "https://stackoverflow.com/questions/49402138/what-is-the-meaning-of-this-type-declaration", "title": "What is the meaning of this type declaration?", "body": "<p>I am actually learning golang (from .NET) and there is one thing I don't understand about this language.\nSometimes I find this kind of declaration:</p>\n\n<p><a href=\"https://github.com/golang/crypto/blob/master/ed25519/ed25519.go\" rel=\"nofollow noreferrer\">https://github.com/golang/crypto/blob/master/ed25519/ed25519.go</a></p>\n\n<pre><code>// PublicKey is the type of Ed25519 public keys.\ntype PublicKey []byte\n</code></pre>\n\n<p>What does it mean exactly? \nIs it a creating a struct which inherit from []byte?</p>\n\n<p>Is it just an alias?</p>\n\n<p>I thought golang forbid inheritance.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 2428, "user_id": 4681654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/295df10e195a8e024884fbc91594fd7f?s=128&d=identicon&r=PG&f=1", "display_name": "simon", "link": "https://stackoverflow.com/users/4681654/simon"}, "edited": false, "score": 1, "creation_date": 1521616755, "post_id": 49400284, "comment_id": 85801797, "body": "What&#39;s the issue?"}, {"owner": {"reputation": 135, "user_id": 6910150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6612ec915da27dedfcac5178421091c5?s=128&d=identicon&r=PG&f=1", "display_name": "\u041e\u0442\u0433\u043e\u043d\u0431\u0430\u044f\u0440 \u041b\u0430\u043c\u0436\u0430\u0432", "link": "https://stackoverflow.com/users/6910150/%d0%9e%d1%82%d0%b3%d0%be%d0%bd%d0%b1%d0%b0%d1%8f%d1%80-%d0%9b%d0%b0%d0%bc%d0%b6%d0%b0%d0%b2"}, "reply_to_user": {"reputation": 2428, "user_id": 4681654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/295df10e195a8e024884fbc91594fd7f?s=128&d=identicon&r=PG&f=1", "display_name": "simon", "link": "https://stackoverflow.com/users/4681654/simon"}, "edited": false, "score": 0, "creation_date": 1521617384, "post_id": 49400284, "comment_id": 85802123, "body": "I need how many rows in table. Not check any user and password exists in database"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1521621573, "post_id": 49400284, "comment_id": 85804307, "body": "People don&#39;t downvote questions because they don&#39;t know the answer. They downvote the question because it &quot;does not show any research effort; it is unclear, or not useful&quot;. Blaming people who give you appropriate feedback is ridiculous."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1521621769, "post_id": 49400284, "comment_id": 85804431, "body": "In this case, a reasonable guess as to why you earned a downvote would probably be: As suggested in the first comment, you haven&#39;t explained the problem you&#39;re having. You showed one line of code, which appears to do what you want, without explaining how it falls short of your expectation."}], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 6910150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6612ec915da27dedfcac5178421091c5?s=128&d=identicon&r=PG&f=1", "display_name": "\u041e\u0442\u0433\u043e\u043d\u0431\u0430\u044f\u0440 \u041b\u0430\u043c\u0436\u0430\u0432", "link": "https://stackoverflow.com/users/6910150/%d0%9e%d1%82%d0%b3%d0%be%d0%bd%d0%b1%d0%b0%d1%8f%d1%80-%d0%9b%d0%b0%d0%bc%d0%b6%d0%b0%d0%b2"}, "edited": false, "score": 0, "creation_date": 1521620813, "post_id": 49400697, "comment_id": 85803914, "body": "ok when i print count number on html template then it is looks 0015. Why two zero included before 15?"}, {"owner": {"reputation": 666, "user_id": 9060838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/889fa7aa60691aed08d3a5b1e396770f?s=128&d=identicon&r=PG&f=1", "display_name": "chanioxaris", "link": "https://stackoverflow.com/users/9060838/chanioxaris"}, "reply_to_user": {"reputation": 135, "user_id": 6910150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6612ec915da27dedfcac5178421091c5?s=128&d=identicon&r=PG&f=1", "display_name": "\u041e\u0442\u0433\u043e\u043d\u0431\u0430\u044f\u0440 \u041b\u0430\u043c\u0436\u0430\u0432", "link": "https://stackoverflow.com/users/6910150/%d0%9e%d1%82%d0%b3%d0%be%d0%bd%d0%b1%d0%b0%d1%8f%d1%80-%d0%9b%d0%b0%d0%bc%d0%b6%d0%b0%d0%b2"}, "edited": false, "score": 0, "creation_date": 1521624187, "post_id": 49400697, "comment_id": 85805933, "body": "Without any code i can&#39;t really help you why this is happening."}], "tags": [], "owner": {"reputation": 666, "user_id": 9060838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/889fa7aa60691aed08d3a5b1e396770f?s=128&d=identicon&r=PG&f=1", "display_name": "chanioxaris", "link": "https://stackoverflow.com/users/9060838/chanioxaris"}, "is_accepted": true, "score": 13, "last_activity_date": 1521620931, "last_edit_date": 1521620931, "creation_date": 1521618151, "answer_id": 49400697, "question_id": 49400284, "link": "https://stackoverflow.com/questions/49400284/count-number-of-rows-in-golang/49400697#49400697", "title": "Count number of rows in golang", "body": "<p>The query will return a row into the variable count. So the next you have to do is to read this row and assign the result into a new variable, using the function <code>Scan()</code>. This is how it works.</p>\n\n<pre><code>rows, err := db.Query(\"SELECT COUNT(*) FROM main_table\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer rows.Close()\n\nvar count int\n\nfor rows.Next() {   \n    if err := rows.Scan(&amp;count); err != nil {\n        log.Fatal(err)\n    }\n}\n\nfmt.Printf(\"Number of rows are %s\\n\", count)\n</code></pre>\n\n<p>The best option thought would be to use <code>QueryRow()</code> as you expect to read just one row. The code then will be.</p>\n\n<pre><code>var count int\n\nerr := db.QueryRow(\"SELECT COUNT(*) FROM main_table\").Scan(&amp;count)\nswitch {    \ncase err != nil:\n    log.Fatal(err)\ndefault:\n    fmt.Printf(\"Number of rows are %s\\n\", count)\n}\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 6910150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6612ec915da27dedfcac5178421091c5?s=128&d=identicon&r=PG&f=1", "display_name": "\u041e\u0442\u0433\u043e\u043d\u0431\u0430\u044f\u0440 \u041b\u0430\u043c\u0436\u0430\u0432", "link": "https://stackoverflow.com/users/6910150/%d0%9e%d1%82%d0%b3%d0%be%d0%bd%d0%b1%d0%b0%d1%8f%d1%80-%d0%9b%d0%b0%d0%bc%d0%b6%d0%b0%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11780, "favorite_count": 3, "accepted_answer_id": 49400697, "answer_count": 1, "score": 8, "last_activity_date": 1521620931, "creation_date": 1521616374, "last_edit_date": 1521619132, "question_id": 49400284, "link": "https://stackoverflow.com/questions/49400284/count-number-of-rows-in-golang", "title": "Count number of rows in golang", "body": "<p>I want to display the number of rows from database using Go. How do I display number of rows?</p>\n\n<pre><code>count, err := db.Query(\"SELECT COUNT(*) FROM main_table\")\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1521624902, "post_id": 49399675, "comment_id": 85806375, "body": "Why do you want to fork a Go process? Are goroutines not good enough for your task?"}, {"owner": {"reputation": 39, "user_id": 8235796, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tQGMG_zhEHg/AAAAAAAAAAI/AAAAAAAAAAs/LOGX2cKkdbg/photo.jpg?sz=128", "display_name": "Raj Shrivastawa", "link": "https://stackoverflow.com/users/8235796/raj-shrivastawa"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1521694042, "post_id": 49399675, "comment_id": 85842524, "body": "Thanks Grzegorz \u017bur,   if main goroutine killed then all goroutines will also exit, but i want to keep one goroutine always running. Can you please suggest any solution for that or any alternative in go."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1521700605, "post_id": 49399675, "comment_id": 85844865, "body": "There are multiple ways to solve your problem and it is quite a common problem. You can state your question more specifically. You asked for an implementation of the solution to the same problem in Python, you got answers that will not be well-suited to Go."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1521700685, "post_id": 49399675, "comment_id": 85844909, "body": "Keeping Go program running: <a href=\"https://stackoverflow.com/q/9543835/450989\">stackoverflow.com/q/9543835/450989</a>"}], "owner": {"reputation": 39, "user_id": 8235796, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tQGMG_zhEHg/AAAAAAAAAAI/AAAAAAAAAAs/LOGX2cKkdbg/photo.jpg?sz=128", "display_name": "Raj Shrivastawa", "link": "https://stackoverflow.com/users/8235796/raj-shrivastawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1234, "favorite_count": 0, "closed_date": 1521614141, "answer_count": 0, "score": 0, "last_activity_date": 1521613890, "creation_date": 1521613890, "question_id": 49399675, "link": "https://stackoverflow.com/questions/49399675/how-to-fork-a-process-in-golang", "closed_reason": "Duplicate", "title": "How to fork a process in golang?", "body": "<p>I want to fork a process in Go.\nAs we can fork in Python using <code>os.fork</code>, Is there any module or library in Go to fork process?</p>\n\n<p>I am able to fork in Python but just want to do it using Go.</p>\n"}, {"tags": ["docker", "go", "docker-compose", "dockerfile", "beego"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521615875, "post_id": 49399552, "comment_id": 85801351, "body": "I don&#39;t follow. What&#39;s stopping you from simply editing app.conf?"}, {"owner": {"reputation": 2667, "user_id": 1508147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nueRO.jpg?s=128&g=1", "display_name": "Sathishkumar Rakkiasamy", "link": "https://stackoverflow.com/users/1508147/sathishkumar-rakkiasamy"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521616603, "post_id": 49399552, "comment_id": 85801708, "body": "@Peter I don&#39;t have any problem in editing app.conf file. In PHP frameworks(Laravel) it is possible to overwrite the port in ENV file using docker-compose environment variables. So only I asked for similar setup is possible or not in beego?"}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 2, "creation_date": 1521619974, "post_id": 49399552, "comment_id": 85803495, "body": "To read port from env varialbles you probably should use <code>beego.AppConfig.Set(key, val string)</code> method and check if proper env variable is set and get it from <code>os.Getenv</code>. But why you wanna run it on different port inside docker? If u just wanna get access to it on different port outside (because of allready used port) you should change in you docker-compose file ports section to <code>&quot;8081:8080&quot;</code> then you can access your app on <code>8081</code> port"}], "answers": [{"tags": [], "owner": {"reputation": 1124, "user_id": 819626, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7207e444aef4a13ebb8feb876cd017b9?s=128&d=identicon&r=PG", "display_name": "eodgooch", "link": "https://stackoverflow.com/users/819626/eodgooch"}, "is_accepted": true, "score": 1, "last_activity_date": 1544229053, "creation_date": 1544229053, "answer_id": 53678420, "question_id": 49399552, "link": "https://stackoverflow.com/questions/49399552/beego-make-use-of-port-number-from-docker-compose-implementaion-instead-using/53678420#53678420", "title": "Beego - Make use of port number from docker-compose implementaion instead using port number from app.conf", "body": "<p>You shouldn't need to update the <code>app.conf</code> to <code>8080</code> use the <code>ports</code> to have the docker container listen on <code>8081</code> and respond to <code>8080</code>.</p>\n\n<p>Change <code>- \"8080:8080\"</code> to <code>- \"8080:8081\"</code></p>\n\n<p>First port is what the docker container will respond to and the second port is the port of the application within the container.</p>\n"}], "owner": {"reputation": 2667, "user_id": 1508147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nueRO.jpg?s=128&g=1", "display_name": "Sathishkumar Rakkiasamy", "link": "https://stackoverflow.com/users/1508147/sathishkumar-rakkiasamy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 535, "favorite_count": 0, "accepted_answer_id": 53678420, "answer_count": 1, "score": 1, "last_activity_date": 1544229053, "creation_date": 1521613364, "last_edit_date": 1522329014, "question_id": 49399552, "link": "https://stackoverflow.com/questions/49399552/beego-make-use-of-port-number-from-docker-compose-implementaion-instead-using", "title": "Beego - Make use of port number from docker-compose implementaion instead using port number from app.conf", "body": "<p>I am trying to run the beego application using docker with the help of docker-compose. I am able access the demo application in <a href=\"http://localhost:8081\" rel=\"nofollow noreferrer\">http://localhost:8081</a> URL after running <code>docker-compose up</code>.</p>\n\n<p><strong>docker-compose.yml</strong></p>\n\n<pre><code>version: \"2\"\n\nservices:\n  app:\n    build: .\n    volumes:\n      - .:/go/src/hello\n    ports:\n      - \"8080:8080\"\n    working_dir: /go/src/hello\n    command: bee run\n</code></pre>\n\n<p><strong>Dockerfile</strong></p>\n\n<pre><code>FROM golang:1.10\n\n## Install beego and the bee dev tool\nRUN go get github.com/astaxie/beego &amp;&amp; go get github.com/beego/bee\n</code></pre>\n\n<p><strong>app.conf</strong> from beego framework</p>\n\n<pre><code>appname = hello\nhttpport = 8081\nrunmode = dev\n</code></pre>\n\n<p>How can I overwrite the <code>httpport</code>(8081) in <code>app.conf</code> using <code>ports</code>(8080) number used in <code>app</code> from <code>docker-compose.yml</code>. After running <code>docker-compose up</code> application runs in port 8081 not in 8080. How can I solve this?</p>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1521613577, "post_id": 49399482, "comment_id": 85800268, "body": "You&#39;re using two different spellings of &quot;count&quot;. The struct and MongoDB use &quot;conut&quot; but your tag says <code>bson:&quot;message_count,inline&quot;</code>. This will probably continue to cause problems until someone gets around to rebuilding your MongoDB collection to use the right spelling."}, {"owner": {"reputation": 313, "user_id": 9239185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3586d9a7d60fc4007416053c1e3e73f7?s=128&d=identicon&r=PG&f=1", "display_name": "MengCheng Wei", "link": "https://stackoverflow.com/users/9239185/mengcheng-wei"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1521614090, "post_id": 49399482, "comment_id": 85800516, "body": "OMG.... it&#39;s ridiculous typo here, thank you and I will try again"}], "owner": {"reputation": 313, "user_id": 9239185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3586d9a7d60fc4007416053c1e3e73f7?s=128&d=identicon&r=PG&f=1", "display_name": "MengCheng Wei", "link": "https://stackoverflow.com/users/9239185/mengcheng-wei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 275, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1521613058, "creation_date": 1521613058, "question_id": 49399482, "link": "https://stackoverflow.com/questions/49399482/nested-struct-conversion-from-mgo-mongodb-library-to-golang-struct", "title": "Nested struct conversion from mgo (mongodb library) to golang struct?", "body": "<p>I have a struct like this:</p>\n\n<pre><code>type ArticleDocument struct {\n    ArticleID    string `json:\"article_id\" bson:\"article_id\"`\n    ArticleTitle string `json:\"article_title\" bson:\"article_title\"`\n    Author       string `json:\"author\" bson:\"author\"`\n    Board        string `json:\"board\" bson:\"board\"`\n    Content      string `json:\"content\" bson:\"content\"`\n    Date         string `json:\"date\" bson:\"date\"`\n    IP           string `json:\"ip\" bson:\"ip\"`\n    MessageConut struct {\n        All     int `json:\"all\" bson:\"all\"`\n        Boo     int `json:\"boo\" bson:\"boo\"`\n        Count   int `json:\"count\" bson:\"count\"`\n        Neutral int `json:\"neutral\" bson:\"neutral\"`\n        Push    int `json:\"push\" bson:\"push\"`\n    } `json:\"message_count,inline\" bson:\"message_count,inline\"`\n    Messages []interface{} `json:\"messages\" bson:\"messages\"`\n    URL      string        `json:\"url\" bson:\"url\"`\n}\n</code></pre>\n\n<p>In MongoDB, my document looks like:</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"5ab1da8133691b034b2be31d\"),\n    \"article_id\" : \"M.1521548086.A.DCA\",\n    \"article_title\" : \"some title\",\n    \"author\" : \"somebody\",\n    \"board\" : \"some board\",\n    \"content\" : \"some content\",\n    \"date\" : \"Tue Mar 20 20:14:42 2018\",\n    \"ip\" : \"1.1.1.1\",\n    \"message_conut\" : {\n        \"all\" : 15,\n        \"boo\" : 0,\n        \"count\" : 14,\n        \"neutral\" : 1,\n        \"push\" : 14\n    },\n    \"messages\" : [],\n    \"url\" : \"https://xxx.xxx.xxx\"\n}\n</code></pre>\n\n<p>In my Golang code, i am trying to use mgo to query this document and print it out, however, all document fields are converted to golang struct correctly except the nested document \"MessageConut\", all the values in \"All\", \"Boo\", \"Count\", ...etc are zero:</p>\n\n<pre><code>message_count\":{\"all\":0,\"boo\":0,\"count\":0,\"neutral\":0,\"push\":0}\"\n</code></pre>\n\n<p>Could you please guide how do I solve this issue?</p>\n"}, {"tags": ["xml", "go", "soap", "marshalling"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "is_accepted": true, "score": 4, "last_activity_date": 1521619053, "creation_date": 1521619053, "answer_id": 49400901, "question_id": 49398585, "link": "https://stackoverflow.com/questions/49398585/golang-marshal-nested-xml-tags/49400901#49400901", "title": "Golang marshal nested xml tags", "body": "<p>Define <code>ParameterValueStruct</code> to be a slice:</p>\n\n<pre><code>type SPVParameterList struct {\n    XMLName              xml.Name                  `xml:\"ParameterList\"`\n    ArrayType            string                    `xml:\"soap:arrayType,attr\"` // must use cwmp:ParameterValueStruct[?] Number of params to SPV\n    ParameterValueStruct []SPVParameterValueStruct `xml:\"ParameterValueStruct\"`\n}\n</code></pre>\n\n<p>Then build up the <code>SPVParameterValueStruct</code>s and <code>append</code> them to <code>ParameterValueStruct</code>:</p>\n\n<pre><code>pvs1 := &amp;SPVParameterValueStruct{\n    Name: \"Someparameter1\",\n    Value: SPVValue{\n        Type:  \"xsd:string\",\n        Value: \"SomeParamValue1\",\n    },\n}\n\npvs2 := &amp;SPVParameterValueStruct{\n    Name: \"Someparameter2\",\n    Value: SPVValue{\n        Type:  \"xsd:string\",\n        Value: \"SomeParamValue2\",\n    },\n}\n\nsoap.Body.SPV.ParameterList.ParameterValueStruct =\n    append(soap.Body.SPV.ParameterList.ParameterValueStruct, *pvs1, *pvs2)\n</code></pre>\n\n<p>see <a href=\"https://play.golang.org/p/As6ymGNViZx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/As6ymGNViZx</a></p>\n"}], "owner": {"reputation": 35, "user_id": 1183995, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d637d56602bcbcea23d5af807d3e0468?s=128&d=identicon&r=PG", "display_name": "BeNoZo", "link": "https://stackoverflow.com/users/1183995/benozo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 595, "favorite_count": 0, "accepted_answer_id": 49400901, "answer_count": 1, "score": 2, "last_activity_date": 1521619053, "creation_date": 1521608922, "question_id": 49398585, "link": "https://stackoverflow.com/questions/49398585/golang-marshal-nested-xml-tags", "title": "Golang marshal nested xml tags", "body": "<p>I'm trying to marshal a Soap xml response but cannot get nested tags (<code>&lt;ParameterValueStruct&gt;</code>) going, if i call the struct twice the last one overwrites the first one.</p>\n\n<p>Any help is mostly appreciated.</p>\n\n<p>Here is the sample code <a href=\"https://play.golang.org/p/fwb4FI0hDG9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fwb4FI0hDG9</a> </p>\n\n<p>Here is a sample xml im trying to mimic:</p>\n\n<pre><code>&lt;soapenv:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/encoding/\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:cwmp=\"urn:dslforum-org:cwmp-1-0\" xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"&gt;\n&lt;soapenv:Header&gt;\n    &lt;cwmp:ID soapenv:mustUnderstand=\"1\"&gt;null0&lt;/cwmp:ID&gt;\n&lt;/soapenv:Header&gt;\n&lt;soapenv:Body&gt;\n    &lt;cwmp:SetParameterValues&gt;\n        &lt;ParameterList soap:arrayType=\"cwmp:ParameterValueStruct[4]\"&gt;\n            &lt;ParameterValueStruct&gt;\n                &lt;Name&gt;InternetGatewayDevice.ManagementServer.PeriodicInformEnable&lt;/Name&gt;\n                &lt;Value xsi:type=\"xsd:boolean\"&gt;1&lt;/Value&gt;\n            &lt;/ParameterValueStruct&gt;\n            &lt;ParameterValueStruct&gt;\n                &lt;Name&gt;InternetGatewayDevice.ManagementServer.ConnectionRequestUsername&lt;/Name&gt;\n                &lt;Value xsi:type=\"xsd:string\"&gt;00147F-SpeedTouch780-CP0611JTLNW&lt;/Value&gt;\n            &lt;/ParameterValueStruct&gt;\n            &lt;ParameterValueStruct&gt;\n                &lt;Name&gt;InternetGatewayDevice.ManagementServer.ConnectionRequestPassword&lt;/Name&gt;\n                &lt;Value xsi:type=\"xsd:string\"&gt;98ff55fb377bf724c625f60dec448646&lt;/Value&gt;\n            &lt;/ParameterValueStruct&gt;\n            &lt;ParameterValueStruct&gt;\n                &lt;Name&gt;InternetGatewayDevice.ManagementServer.PeriodicInformInterval&lt;/Name&gt;\n                &lt;Value xsi:type=\"xsd:unsignedInt\"&gt;60&lt;/Value&gt;\n            &lt;/ParameterValueStruct&gt;\n        &lt;/ParameterList&gt;\n        &lt;ParameterKey&gt;null&lt;/ParameterKey&gt;\n    &lt;/cwmp:SetParameterValues&gt;\n&lt;/soapenv:Body&gt;\n</code></pre>\n\n<p></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "edited": false, "score": 0, "creation_date": 1521613783, "post_id": 49397980, "comment_id": 85800362, "body": "Have the <code>db</code> variable as global, so it can be accessed outside main.  Might want to look into this : <a href=\"https://stackoverflow.com/questions/26211954/how-do-i-pass-arguments-to-my-handler\" title=\"how do i pass arguments to my handler\">stackoverflow.com/questions/26211954/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2571, "user_id": 1264675, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/7cdce6fa69152f105c232420c8e62925?s=128&d=identicon&r=PG", "display_name": "Undreren", "link": "https://stackoverflow.com/users/1264675/undreren"}, "is_accepted": false, "score": 7, "last_activity_date": 1521615296, "creation_date": 1521615296, "answer_id": 49400008, "question_id": 49397980, "link": "https://stackoverflow.com/questions/49397980/how-to-pass-a-parameter-to-my-auth-middleware-to-get-db-access/49400008#49400008", "title": "How to pass a parameter to my auth middleware to get db access", "body": "<p>You have two straight-forward options that doesn't involve global variables.</p>\n\n<h1>Using a closure</h1>\n\n<p>You could re-write <code>AuthMw</code> into:</p>\n\n<pre><code>func AuthMw(db *DbType) (func (next http.Handler) http.Handler) {\n    return func (next http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            // Your code goes here, now with a pointer to db\n        })\n    }\n}\n</code></pre>\n\n<p>That way, you make a \"factory function\" that returns a new <code>http.Handler</code> decorator, where your <code>db</code> variable is accessible throught the closure.</p>\n\n<p>All you need to do after this is to replace <code>r.Use(AuthMw)</code> with <code>r.Use(AuthMw(db))</code>.</p>\n\n<p>This is maybe a little heavy on nested methods, so I'll instead suggest...</p>\n\n<h1>Using a struct</h1>\n\n<p>Turn <code>AuthMw</code> into a struct with you decorator attached as a method:</p>\n\n<pre><code>type AuthMw struct {\n  db *DbType\n}\n\nfunc NewAuthMw(db *DbType) AuthMw {\n  return AuthMw{db}\n}\n\nfunc (a *AuthMw) Decorator(next http.Handler) http.Handler {\n    // Your code, now with a pointer to db, goes here\n}\n</code></pre>\n\n<p>Then you just need replace <code>r.Use(AuthMw)</code> with <code>r.Use(authMwVariable.Decorator)</code>.</p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1521615296, "creation_date": 1521605001, "last_edit_date": 1521613539, "question_id": 49397980, "link": "https://stackoverflow.com/questions/49397980/how-to-pass-a-parameter-to-my-auth-middleware-to-get-db-access", "title": "How to pass a parameter to my auth middleware to get db access", "body": "<p>In my AuthMw middleware, I want to make database calls.</p>\n\n<p><strong>My database variable is initialized in main, how can I pass this to my middleware AuthMw?</strong></p>\n\n<pre><code>func main() {\n    db, err := gorm.Open(\"postgres\", ... )\n    r := mux.NewRouter()\n    r.Handle(\"/ws\", serveWebsocket(hub))\n    r.Use(AuthMw)\n\n    //\n    //\n    ...\n\n} // main\n\n\nfunc AuthMw(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        token := r.URL.Query().Get(\"token\")\n        fmt.Printf(\"AuthMiddleware token is: %v\\n\", token)\n\n        ctx := ....\n\n        next.ServeHTTP(w, r.WithContext(ctx))\n    })\n}\n</code></pre>\n"}, {"tags": ["go", "utf-8", "rune"], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": false, "score": 3, "last_activity_date": 1521617149, "last_edit_date": 1521617149, "creation_date": 1521610649, "answer_id": 49398920, "question_id": 49397913, "link": "https://stackoverflow.com/questions/49397913/difference-between-length-of-rune-slice-and-runecountinstring/49398920#49398920", "title": "Difference between length of rune slice and RuneCountInString?", "body": "<p>The difference is that the first one:</p>\n\n<pre><code>runes  := []rune(s)\nlength := len(runes)\n</code></pre>\n\n<p>has to step through <code>s</code> to build a slice of <code>rune</code>s and then ask that slice how long it is whereas <a href=\"https://github.com/golang/go/blob/release-branch.go1.10/src/unicode/utf8/utf8.go#L408\" rel=\"nofollow noreferrer\"><code>utf8.RuneCountInString</code></a> simply steps through <code>s</code> byte by byte incrementing a counter whenever it sees a sequence of contiguous bytes that make up a UTF-8 character.</p>\n\n<p>The <code>[]rune(s)</code> version has to do more work than <code>utf8.RuneCountInString</code> does.</p>\n\n<hr>\n\n<p>A cursory bit of wandering around the source suggests that <code>[]rune(someString)</code> is implemented by <a href=\"https://github.com/golang/go/blob/release-branch.go1.10/src/runtime/string.go#L158\" rel=\"nofollow noreferrer\"><code>stringtoslicerune</code></a> which actually does two iterations over the string: one two find out how many <code>rune</code>s are there and another to copy those <code>rune</code>s into a slice. I'm not certain about this as I'm not that familiar with the implementation details of Go.</p>\n"}], "owner": {"reputation": 111, "user_id": 2702117, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37ea6c2812deff668185600a7999bbb5?s=128&d=identicon&r=PG&f=1", "display_name": "Wang Ke", "link": "https://stackoverflow.com/users/2702117/wang-ke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 812, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521617149, "creation_date": 1521604520, "question_id": 49397913, "link": "https://stackoverflow.com/questions/49397913/difference-between-length-of-rune-slice-and-runecountinstring", "title": "Difference between length of rune slice and RuneCountInString?", "body": "<p>We can get the number of runes in a string by getting the length of the rune slice converted from the string.</p>\n\n<pre><code>s := \"\u4e16\u754c\"\nrunes := []rune(s)\nfmt.Println(len(runes))\n</code></pre>\n\n<p>Or use the <code>RuneCountInString</code> function in <code>unicode/utf8</code> package.</p>\n\n<pre><code>fmt.Println(utf8.RuneCountInString(s))\n</code></pre>\n\n<p>What's the difference between the two?</p>\n"}, {"tags": ["go", "concurrency", "mutex", "race-condition"], "answers": [{"comments": [{"owner": {"reputation": 272, "user_id": 479736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71f5d13ef3d9ec2208d41df3415b9f34?s=128&d=identicon&r=PG", "display_name": "Andrei Simionescu", "link": "https://stackoverflow.com/users/479736/andrei-simionescu"}, "edited": false, "score": 0, "creation_date": 1525773711, "post_id": 49397460, "comment_id": 87479065, "body": "Can second the <code>go vet</code> recommendation, <code>gometalinter</code> is pretty useful as well. Another popular way to fix it is to pass <code>i</code> as an argument to the <code>go func</code>."}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 6, "last_activity_date": 1521602241, "last_edit_date": 1521602241, "creation_date": 1521601619, "answer_id": 49397460, "question_id": 49397395, "link": "https://stackoverflow.com/questions/49397395/go-rwmutex-still-raises-race-condition/49397460#49397460", "title": "Go RWMutex still raises race condition?", "body": "<p>You are capturing the same variable <code>i</code> in multiple goroutines.</p>\n\n<p>One way to fix this is to modify your main for loop like so:</p>\n\n<pre><code>for i := 0; i &lt; 100; i++ {\n    i := i  # look here\n    go func() {\n        fmt.Printf(\"%v\\n\", t.Read())\n    }()\n\n    go func() {\n        t.Append(int64(i))\n    }()\n}\n</code></pre>\n\n<p>This will ensure that you capture a different variable in the closure of the second goroutine each iteration of the for loop. In your example, the <code>i</code> passed to <code>t.Append</code> was the same <code>i</code> that was incremented by the for loop concurrently.</p>\n\n<p>I also recommend running <code>go vet</code> to catch such errors in the future. For more information, there is an entry on this problem in the Go FAQ that goes into more detail: <a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"noreferrer\">https://golang.org/doc/faq#closures_and_goroutines</a></p>\n"}], "owner": {"reputation": 4630, "user_id": 1411004, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/7121065ef6fa8322cd2ac0bb959bdbdf?s=128&d=identicon&r=PG", "display_name": "stevenspiel", "link": "https://stackoverflow.com/users/1411004/stevenspiel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 1, "accepted_answer_id": 49397460, "answer_count": 1, "score": 3, "last_activity_date": 1521679677, "creation_date": 1521601112, "last_edit_date": 1521679677, "question_id": 49397395, "link": "https://stackoverflow.com/questions/49397395/go-rwmutex-still-raises-race-condition", "title": "Go RWMutex still raises race condition?", "body": "<p>I have a seemingly innocent package that just makes a slice and protects it with a RWMutex. However, when I run it, it still complains about a race condition. What am I doing wrong? (<a href=\"https://play.golang.org/p/peZtmrp0A6T\" rel=\"nofollow noreferrer\">playground</a>)</p>\n\n<pre><code>type Ids struct {\n    e []int64\n    sync.RWMutex\n}\n\nfunc (i *Ids) Read() []int64 {\n    i.RLock()\n    defer i.RUnlock()\n\n    return i.e\n}\n\n\nfunc (i *Ids) Append(int int64) {\n    i.Lock()\n    defer i.Unlock()\n\n    i.e = append(i.e, int)\n}\n\nfunc main() {\n    t := &amp;Ids{e: make([]int64, 1)}\n\n    for i := 0; i &lt; 100; i++ {\n        go func() {\n            fmt.Printf(\"%v\\n\", t.Read())\n        }()\n\n        go func() {\n            t.Append(int64(i))\n        }()\n    }\n\n    time.Sleep(time.Second * 10)\n}\n</code></pre>\n\n<p>when run with <code>-race</code>, it returns (among other things):</p>\n\n<pre><code>==================\nWARNING: DATA RACE\nRead at 0x00c4200a0010 by goroutine 7:\n  main.main.func2()\n      .../main.go:38 +0x38\n\nPrevious write at 0x00c4200a0010 by main goroutine:\n  main.main()\n      .../main.go:32 +0x197\n\nGoroutine 7 (running) created at:\n  main.main()\n      .../main.go:37 +0x173\n==================\n</code></pre>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 3335, "user_id": 3824876, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rFDWl.png?s=128&g=1", "display_name": "vishnu narayanan", "link": "https://stackoverflow.com/users/3824876/vishnu-narayanan"}, "edited": false, "score": 0, "creation_date": 1521600761, "post_id": 49396951, "comment_id": 85796463, "body": "Have a look at this answer <a href=\"https://stackoverflow.com/a/11357116/3824876\">stackoverflow.com/a/11357116/3824876</a>"}, {"owner": {"reputation": 3704, "user_id": 859355, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YHgGT.jpg?s=128&g=1", "display_name": "Vincenzo Maggio", "link": "https://stackoverflow.com/users/859355/vincenzo-maggio"}, "edited": false, "score": 0, "creation_date": 1521632718, "post_id": 49396951, "comment_id": 85811820, "body": "What do you intend with &quot;fetch is not working&quot;?"}], "owner": {"reputation": 135, "user_id": 6910150, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6612ec915da27dedfcac5178421091c5?s=128&d=identicon&r=PG&f=1", "display_name": "\u041e\u0442\u0433\u043e\u043d\u0431\u0430\u044f\u0440 \u041b\u0430\u043c\u0436\u0430\u0432", "link": "https://stackoverflow.com/users/6910150/%d0%9e%d1%82%d0%b3%d0%be%d0%bd%d0%b1%d0%b0%d1%8f%d1%80-%d0%9b%d0%b0%d0%bc%d0%b6%d0%b0%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 664, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1521619210, "creation_date": 1521597538, "last_edit_date": 1521619210, "question_id": 49396951, "link": "https://stackoverflow.com/questions/49396951/fetch-database-using-golang", "title": "fetch database using golang", "body": "<p>I have few functions to connect to a database and fetch results. My question is why fetch not working?</p>\n\n<p>My database structure looks like </p>\n\n<p><img src=\"https://i.stack.imgur.com/n0CoU.png\" alt=\"database structure\"></p>\n\n<p>My main.go code is</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"log\"\n    \"net/http\"\n    \"text/template\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype maintable struct {\n    Id          int\n    Location    string\n    Picname     string\n    Malefemale  string\n    Name        string\n    Country     string\n    Connections int\n}\n\nfunc dbConn() (db *sql.DB) {\n    db, err := sql.Open(\"mysql\", \"root:@/test_db\")\n    if err != nil {\n        panic(err.Error())\n    }\n    return db\n}\n\nvar tmpl = template.Must(template.ParseGlob(\"form/*\"))\n\nfunc Index(w http.ResponseWriter, r *http.Request) {\n    db := dbConn()\n    selDB, err := db.Query(\"SELECT * FROM main_table ORDER BY user_id DESC\")\n    if err != nil {\n        panic(err.Error())\n    }\n    defer selDB.Close()\n    maint := maintable{}\n    res := []maintable{}\n    for selDB.Next() {\n        var id, connections int\n        var name, country, location, picname, malefemale string\n        err = selDB.Scan(&amp;id, &amp;name, &amp;country, &amp;location, &amp;picname, &amp;malefemale, &amp;connections)\n        if err != nil {\n            panic(err.Error())\n        }\n        maint.Id = id\n        maint.Name = name\n        maint.Country = country\n        maint.Location = location\n        maint.Picname = picname\n        maint.Malefemale = malefemale\n        maint.Connections = connections\n        res = append(res, maint)\n    }\n    tmpl.ExecuteTemplate(w, \"Index\", res)\n    defer db.Close()\n}\n\nfunc Show(w http.ResponseWriter, r *http.Request) {\n    db := dbConn()\n    nID := r.URL.Query().Get(\"user_id\")\n    selDB, err := db.Query(\"SELECT * FROM main_table WHERE user_id=?\", nID)\n    if err != nil {\n        panic(err.Error())\n    }\n    maint := maintable{}\n    for selDB.Next() {\n        var id, connections int\n        var name, country, location, picname, malefemale string\n        err = selDB.Scan(&amp;id, &amp;name, &amp;country, &amp;location, &amp;picname, &amp;malefemale, &amp;connections)\n        if err != nil {\n            panic(err.Error())\n        }\n        maint.Id = id\n        maint.Name = name\n        maint.Country = country\n        maint.Location = location\n        maint.Picname = picname\n        maint.Malefemale = malefemale\n        maint.Connections = connections\n    }\n    tmpl.ExecuteTemplate(w, \"Show\", maint)\n    defer db.Close()\n}\n\n    log.Println(\"Server started on: http://localhost:3000\")\n    http.HandleFunc(\"/\", Index)\n    http.HandleFunc(\"/show\", Show)\n    http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n\n<p>And my show.tmpl code is looks like</p>\n\n<pre><code>{{ define \"Show\" }}\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en-US\"&gt;\n    &lt;head&gt;\n        &lt;title&gt;Golang Mysql Curd Example&lt;/title&gt;\n        &lt;meta charset=\"UTF-8\" /&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;h1&gt;Golang Mysql Curd Example&lt;/h1&gt;   \n&lt;a href=\"/\"&gt;HOME&lt;/a&gt; | \n&lt;a href=\"/new\"&gt;NEW&lt;/a&gt;\n    &lt;h2&gt; Register {{ .Id }} &lt;/h2&gt;\n      &lt;p&gt;Name: {{ .Name }}&lt;/p&gt;\n      &lt;p&gt;Picture name:  {{ .Picname }}&lt;/p&gt;\n      &lt;p&gt;Picture location:  {{ .Location }}&lt;/p&gt;\n      &lt;p&gt;Gender:  {{ .Malefemale }}&lt;/p&gt;\n&lt;p&gt;Country:  {{ .Country }}&lt;/p&gt;\n&lt;p&gt;User connections:  {{ .Connections }}&lt;/p&gt;\n      &lt;br /&gt; &lt;a href=\"/edit?user_id={{ .Id }}\"&gt;Edit&lt;/a&gt;&lt;/p&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n{{ end }}\n</code></pre>\n\n<p>Do I need create array and append all results to array? Is there other way to display multi rows?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1521602272, "post_id": 49396875, "comment_id": 85796794, "body": "The obvious problem I see is you are <code>make</code>ing slices with a <code>capacity</code> of <code>0</code>. Try a more realistic number."}, {"owner": {"reputation": 127, "user_id": 1846597, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/adabda37e1d5d4780ac6fa60eac37ea2?s=128&d=identicon&r=PG", "display_name": "JamesL", "link": "https://stackoverflow.com/users/1846597/jamesl"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 2, "creation_date": 1521602765, "post_id": 49396875, "comment_id": 85796925, "body": "@MichaelHampton I wanted to see what the append performance is in the worst case. I&#39;m aware that if I set the cap to 10e6 it&#39;ll allocate the entire thing at once and any further appends are essentially just Sets under the hood. Adding the Set and Make results should give you the best case Append performance.  My actual implementation involves a lot of &quot;allocate new slice of len=constant, copy old slice data to it&quot; which I feel is reasonably equivalent to what append does in the worst case, but I asked my question in terms of append to make it more general."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1521614557, "post_id": 49396875, "comment_id": 85800732, "body": "Show real code and real problems. The benchmark code looks very unnatural. And of corse you will have to pay a hefty penalty for using the empty interface but maybe your actual problem could be formulated on a slightly larger interface?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1521616807, "post_id": 49396875, "comment_id": 85801825, "body": "If you allocate new slices all the time -- either explicitly with make or implicitly with append -- I&#39;m not surprised that performance suffers. See if you can re-use slices instead. You can &quot;reset&quot; them pretty much for free by re-slicing (<code>[:0]</code>). You can use sync.Pool for instance, or implement your own simple ring buffer, or use several pools for different slice capacities. It&#39;s hard to tell what makes sense without seeing the code."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1521617568, "post_id": 49396875, "comment_id": 85802223, "body": "Please note it does matter what value is wrapped in <code>interface{}</code>, as that will be a copy, which in case of big structs will cost you... In such cases you should store (wrap) only pointers... This question without the code in question is off-topic."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521640403, "post_id": 49396875, "comment_id": 85817606, "body": "Also note that your append benchmarks, and to an extent your make benchmarks, have so few iterations that they&#39;re not actually telling you anything. In particular, any benchmark with an iteration count of 1 can just be thrown away. Try running your benchmarks with a longer runtime so you can get some valid data out."}], "answers": [{"comments": [{"owner": {"reputation": 127, "user_id": 1846597, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/adabda37e1d5d4780ac6fa60eac37ea2?s=128&d=identicon&r=PG", "display_name": "JamesL", "link": "https://stackoverflow.com/users/1846597/jamesl"}, "edited": false, "score": 1, "creation_date": 1521969510, "post_id": 49470020, "comment_id": 85950854, "body": "Thank you for this answer. You have shown me that the only way around this slowdown is to re-engineer my solution to avoid slices of interfaces, and also the sensitivity of this code to heap/stack differences.  The differences in the allocs/op between BenchmarkAppendInterface10M and BenchmarkAppendInterfacePtr10M is interesting to me."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 4, "last_activity_date": 1522051870, "last_edit_date": 1522051870, "creation_date": 1521926074, "answer_id": 49470020, "question_id": 49396875, "link": "https://stackoverflow.com/questions/49396875/using-interfaces-in-slices-seems-to-incur-a-40x-slowdown-is-there-a-way-of-by/49470020#49470020", "title": "Using interfaces{} in slices seems to incur a 40x slowdown. Is there a way of bypassing this when implementing `interface{}` based datastructures?", "body": "<p>Let's profile the test with memory benchmarks.</p>\n\n<pre><code>go test -bench . -cpuprofile cpu.prof -benchmem\ngoos: linux\ngoarch: amd64\nBenchmarkMake10M-8                           100          10254248 ns/op        80003282 B/op          1 allocs/op\nBenchmarkMakePtr10M-8                        100          18696295 ns/op        80003134 B/op          1 allocs/op\nBenchmarkMakeInterface10M-8                   50          34501361 ns/op        160006147 B/op         1 allocs/op\nBenchmarkMakeInterfacePtr10M-8                50          35129085 ns/op        160006652 B/op         1 allocs/op\nBenchmarkAppend10M-8                          20          69971722 ns/op        423503264 B/op        50 allocs/op\nBenchmarkAppendPtr10M-8                        1        2135090501 ns/op        423531096 B/op        62 allocs/op\nBenchmarkAppendInterface10M-8                  1        1833396620 ns/op        907567984 B/op  10000060 allocs/op\nBenchmarkAppendInterfacePtr10M-8               1        2270970241 ns/op        827546240 B/op        53 allocs/op\nBenchmarkSet-8                          30000000                54.0 ns/op             0 B/op          0 allocs/op\nBenchmarkSetPtr-8                       20000000                91.6 ns/op             8 B/op          1 allocs/op\nBenchmarkSetInterface-8                 30000000                58.0 ns/op             0 B/op          0 allocs/op\nBenchmarkSetInterfacePtr-8              20000000                88.0 ns/op             8 B/op          1 allocs/op\nPASS\nok      _/home/grzesiek/test    22.427s\n</code></pre>\n\n<p>We can see that the slowest benchmarks are the ones that makes allocations.</p>\n\n<pre><code>PPROF_BINARY_PATH=. go tool pprof -disasm BenchmarkAppend cpu.prof\nTotal: 29.75s\nROUTINE ======================== _/home/grzesiek/test.BenchmarkAppend10M\n     210m   1.51s (flat, cum)  5.08% of Total\n     .      1.30s     4e827a: CALL runtime.growslice(SB)                 ;_/home/grzesiek/test.BenchmarkAppend10M test_test.go:35\nROUTINE ======================== _/home/grzesiek/test.BenchmarkAppendInterface10M\n     20m    930ms (flat, cum)  3.13% of Total\n     .      630ms     4e8519: CALL runtime.growslice(SB)                 ;_/home/grzesiek/test.BenchmarkAppendInterface10M test_test.go:53\nROUTINE ======================== _/home/grzesiek/test.BenchmarkAppendInterfacePtr10M\n     0      800ms (flat, cum)  2.69% of Total\n     .      770ms     4e8625: CALL runtime.growslice(SB)                 ;_/home/grzesiek/test.BenchmarkAppendInterfacePtr10M test_test.go:62\nROUTINE ======================== _/home/grzesiek/test.BenchmarkAppendPtr10M\n     0      950ms (flat, cum)  3.19% of Total\n     .      870ms     4e8374: CALL runtime.growslice(SB)                 ;_/home/grzesiek/test.BenchmarkAppendPtr10M test_test.go:44\n</code></pre>\n\n<p>By analyzing the number of bytes allocated, we can see that use of interface doubles the allocations size.</p>\n\n<p>Why is <code>BenchmarkAppendPtr10M</code> so much faster than other <code>BenchmarkAppend*</code>?\nTo figure this out, we need to see the escape analysis.</p>\n\n<pre><code>go test -gcflags '-m -l' original_test.go\n\n./original_test.go:31:28: BenchmarkAppend10M b does not escape                      \n./original_test.go:33:14: BenchmarkAppend10M make([]int, 0, 0) does not escape      \n./original_test.go:40:31: BenchmarkAppendPtr10M b does not escape                   \n./original_test.go:42:14: BenchmarkAppendPtr10M make([]*int, 0, 0) does not escape  \n./original_test.go:43:7: moved to heap: jj                                          \n./original_test.go:44:22: &amp;jj escapes to heap                                       \n./original_test.go:49:37: BenchmarkAppendInterface10M b does not escape             \n./original_test.go:51:14: BenchmarkAppendInterface10M make([]interface {}, 0, 0) does not escape                                                                         \n./original_test.go:53:16: jj escapes to heap                                        \n./original_test.go:58:40: BenchmarkAppendInterfacePtr10M b does not escape          \n./original_test.go:60:14: BenchmarkAppendInterfacePtr10M make([]interface {}, 0, 0) does not escape                                                                      \n./original_test.go:61:7: moved to heap: jj                                          \n./original_test.go:62:16: &amp;jj escapes to heap                                       \n./original_test.go:62:22: &amp;jj escapes to heap                                       \n</code></pre>\n\n<p>We can see that it is the only benchmark in which <code>jj</code> does not escape to the heap. We can deduce that accessing heap variable causes slowdown.</p>\n\n<p>Why does <code>BenchmarkAppendInterface10M</code> make so many allocations?\nIn the assembler, we can see that it is the only one that calls <code>runtime.convT2E64</code> function.</p>\n\n<pre><code>PPROF_BINARY_PATH=. go tool pprof -disasm BenchmarkAppend cpu.prof\n\nROUTINE ======================== _/home/grzesiek/test.BenchmarkAppendInterface10M\n      30ms      1.10s (flat, cum)  3.35% of Total\n         .      260ms     4e8490: CALL runtime.convT2E64(SB)                 \n</code></pre>\n\n<p>The source code from <code>runtime/iface.go</code> looks like this:</p>\n\n<pre><code>func convT2E64(t *_type, elem unsafe.Pointer) (e eface) {\n    if raceenabled {\n        raceReadObjectPC(t, elem, getcallerpc(), funcPC(convT2E64))\n    }\n    if msanenabled {\n        msanread(elem, t.size)\n    }\n    var x unsafe.Pointer\n    if *(*uint64)(elem) == 0 {\n        x = unsafe.Pointer(&amp;zeroVal[0])\n    } else {\n        x = mallocgc(8, t, false)\n        *(*uint64)(x) = *(*uint64)(elem)\n    }\n    e._type = t\n    e.data = x\n    return\n}\n</code></pre>\n\n<p>As we see it makes the allocation by calling <code>mallocgc</code> function.</p>\n\n<p>I know it does not directly help fix your code but I hope it gives you the tools and techniques to analyze optimize it.</p>\n"}], "owner": {"reputation": 127, "user_id": 1846597, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/adabda37e1d5d4780ac6fa60eac37ea2?s=128&d=identicon&r=PG", "display_name": "JamesL", "link": "https://stackoverflow.com/users/1846597/jamesl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 49470020, "answer_count": 1, "score": 1, "last_activity_date": 1522051870, "creation_date": 1521596795, "last_edit_date": 1521623088, "question_id": 49396875, "link": "https://stackoverflow.com/questions/49396875/using-interfaces-in-slices-seems-to-incur-a-40x-slowdown-is-there-a-way-of-by", "title": "Using interfaces{} in slices seems to incur a 40x slowdown. Is there a way of bypassing this when implementing `interface{}` based datastructures?", "body": "<p>I am currently trying to implement a tree based datastructure in Go and I am seeing disappointing results in my benchmarking. Because I am trying to be generic as to what values I accept, I am limited to using <code>interface{}</code>.</p>\n\n<p>The code in question is an immutable vector trie. Essentially, any time a value in the vector is modified I need to make a copy of several nodes in the trie. Each of these nodes is implemented as a slice of const (known at compile time) length. For example, writing a value into a large trie will require the copying of 5 seperate 32 long slices. They must be copies to preserve the immutability of the previous contents.</p>\n\n<p>I believe the disappointing benchmark results are because I am storing my data  as <code>interface{}</code> in slices, which get created, copied and appended to often. To measure this I set up the following benchmark</p>\n\n<pre><code>package main\n\nimport (\n    \"math/rand\"\n    \"testing\"\n)\n\nfunc BenchmarkMake10M(b *testing.B) {\n    for ii := 0; ii &lt; b.N; ii++ {\n        _ = make([]int, 10e6, 10e6)\n    }\n}\n\nfunc BenchmarkMakePtr10M(b *testing.B) {\n    for ii := 0; ii &lt; b.N; ii++ {\n        _ = make([]*int, 10e6, 10e6)\n    }\n}\n\nfunc BenchmarkMakeInterface10M(b *testing.B) {\n    for ii := 0; ii &lt; b.N; ii++ {\n        _ = make([]interface{}, 10e6, 10e6)\n    }\n}\n\nfunc BenchmarkMakeInterfacePtr10M(b *testing.B) {\n    for ii := 0; ii &lt; b.N; ii++ {\n        _ = make([]interface{}, 10e6, 10e6)\n    }\n}\nfunc BenchmarkAppend10M(b *testing.B) {\n    for ii := 0; ii &lt; b.N; ii++ {\n        slc := make([]int, 0, 0)\n        for jj := 0; jj &lt; 10e6; jj++ {\n            slc = append(slc, jj)\n        }\n    }\n}\n\nfunc BenchmarkAppendPtr10M(b *testing.B) {\n    for ii := 0; ii &lt; b.N; ii++ {\n        slc := make([]*int, 0, 0)\n        for jj := 0; jj &lt; 10e6; jj++ {\n            slc = append(slc, &amp;jj)\n        }\n    }\n}\n\nfunc BenchmarkAppendInterface10M(b *testing.B) {\n    for ii := 0; ii &lt; b.N; ii++ {\n        slc := make([]interface{}, 0, 0)\n        for jj := 0; jj &lt; 10e6; jj++ {\n            slc = append(slc, jj)\n        }\n    }\n}\n\nfunc BenchmarkAppendInterfacePtr10M(b *testing.B) {\n    for ii := 0; ii &lt; b.N; ii++ {\n        slc := make([]interface{}, 0, 0)\n        for jj := 0; jj &lt; 10e6; jj++ {\n            slc = append(slc, &amp;jj)\n        }\n    }\n}\n\nfunc BenchmarkSet(b *testing.B) {\n    slc := make([]int, 10e6, 10e6)\n    b.ResetTimer()\n    for ii := 0; ii &lt; b.N; ii++ {\n        slc[rand.Intn(10e6-1)] = 1\n    }\n}\n\nfunc BenchmarkSetPtr(b *testing.B) {\n    slc := make([]*int, 10e6, 10e6)\n    b.ResetTimer()\n    for ii := 0; ii &lt; b.N; ii++ {\n        theInt := 1\n        slc[rand.Intn(10e6-1)] = &amp;theInt\n    }\n}\n\nfunc BenchmarkSetInterface(b *testing.B) {\n    slc := make([]interface{}, 10e6, 10e6)\n    b.ResetTimer()\n    for ii := 0; ii &lt; b.N; ii++ {\n        slc[rand.Intn(10e6-1)] = 1\n    }\n}\n\nfunc BenchmarkSetInterfacePtr(b *testing.B) {\n    slc := make([]interface{}, 10e6, 10e6)\n    b.ResetTimer()\n    for ii := 0; ii &lt; b.N; ii++ {\n        theInt := 1\n        slc[rand.Intn(10e6-1)] = &amp;theInt\n    }\n}\n</code></pre>\n\n<p>which gives the following result</p>\n\n<pre><code>BenchmarkMake10M-4                       300       4962381 ns/op\nBenchmarkMakePtr10M-4                    100      10255522 ns/op\nBenchmarkMakeInterface10M-4              100      19788588 ns/op\nBenchmarkMakeInterfacePtr10M-4           100      19850682 ns/op\nBenchmarkAppend10M-4                      20      67090711 ns/op\nBenchmarkAppendPtr10M-4                    1    2784300818 ns/op\nBenchmarkAppendInterface10M-4              1    3457503833 ns/op\nBenchmarkAppendInterfacePtr10M-4           1    3532502711 ns/op\nBenchmarkSet-4                      30000000            43.5 ns/op\nBenchmarkSetPtr-4                   20000000            91.2 ns/op\nBenchmarkSetInterface-4             30000000            43.5 ns/op\nBenchmarkSetInterfacePtr-4          20000000            70.9 ns/op\n</code></pre>\n\n<p>Where the difference on Set and Make seems to be about 2-4x but the difference on Append is about 40x.</p>\n\n<p>From what I understand the performance hit is because behind the scenes interfaces are implemented as pointers, and that pointers must be allocated on the heap. That still doesn't explain why Append is significantly worse than the difference between Set or Make.</p>\n\n<p>Is there a way in the current language of Go without using a code generation tool (e.g., a generics tool that lets the consumer of the library generate a version of the library to store <code>FooType</code>) to work around this 40x performance hit? Alternatively, have I made some error in my benchmarking?</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521628846, "post_id": 49396665, "comment_id": 85809183, "body": "A stream means you can send multiple message. Bidirectional means you can send multiple messages in both directions. There is no way for a server to call a client."}], "answers": [{"tags": [], "owner": {"reputation": 6305, "user_id": 164128, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/447ebbbd4711994c41259b7c5d184ec8?s=128&d=identicon&r=PG", "display_name": "Joa Ebert", "link": "https://stackoverflow.com/users/164128/joa-ebert"}, "is_accepted": false, "score": 1, "last_activity_date": 1521641716, "creation_date": 1521641716, "answer_id": 49408712, "question_id": 49396665, "link": "https://stackoverflow.com/questions/49396665/bidirectional-grpc-stream-implementation-in-go/49408712#49408712", "title": "Bidirectional gRPC stream implementation in go", "body": "<p>From the <a href=\"https://grpc.io/docs/guides/concepts.html#bidirectional-streaming-rpc\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>In a bidirectional streaming RPC, again the call is initiated by the\n  client calling the method and the server receiving the client\n  metadata, method name, and deadline. Again the server can choose to\n  send back its initial metadata or wait for the client to start sending\n  requests.</p>\n  \n  <p>What happens next depends on the application, as the client and server\n  can read and write in any order - the streams operate completely\n  independently. [...]</p>\n</blockquote>\n\n<p>This means: the client would establish the connection to the server and you'd then have a connection on wich both parties can read/write.</p>\n"}], "owner": {"reputation": 571, "user_id": 4672066, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/76f2602db81aefda840f27845b9160e3?s=128&d=identicon&r=PG&f=1", "display_name": "SimpleCoder", "link": "https://stackoverflow.com/users/4672066/simplecoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 771, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1521641716, "creation_date": 1521595112, "question_id": 49396665, "link": "https://stackoverflow.com/questions/49396665/bidirectional-grpc-stream-implementation-in-go", "title": "Bidirectional gRPC stream implementation in go", "body": "<p>I'm looking at a proto file which has a bidirectional stream between the client and the server. Does this mean that the client and server can send and receive messages arbitrarily? I'm more confused about the server side. How can the server send data over this bidirectional stream arbitrarily? What would be the trigger?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-api-gateway", "aws-xray"], "comments": [{"owner": {"reputation": 2659, "user_id": 958616, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9e6338a12bed941f746f7449baf3b10?s=128&d=identicon&r=PG", "display_name": "raevilman", "link": "https://stackoverflow.com/users/958616/raevilman"}, "edited": false, "score": 0, "creation_date": 1521811068, "post_id": 49396352, "comment_id": 85903296, "body": "To view the whole flow of multiple lambdas, I moved away from XRay and  used OpenTracing -&gt; Zipkin"}], "answers": [{"tags": [], "owner": {"reputation": 3368, "user_id": 501217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46c3bc2f3610e7f9cfec50a264a472be?s=128&d=identicon&r=PG", "display_name": "Kim Burgaard", "link": "https://stackoverflow.com/users/501217/kim-burgaard"}, "is_accepted": false, "score": 5, "last_activity_date": 1522134218, "last_edit_date": 1522134218, "creation_date": 1522133850, "answer_id": 49506230, "question_id": 49396352, "link": "https://stackoverflow.com/questions/49396352/aws-x-ray-golang-lambda-to-lambda-tracing-and-displayed-in-the-service-map/49506230#49506230", "title": "AWS X-Ray GoLang Lambda to lambda tracing and displayed in the service map", "body": "<p>You don't need to add a subsegment for the \"child\" call unless you want to add annotation/metadata.</p>\n\n<p>The API gateway adds a trace ID called <code>X-Amzn-Trace-Id</code> to the header of incoming requests, which X-ray picks up. If you forward that trace ID in your call from lambda 1 to lambda 2, then X-ray will visually represent the calls with an arrow from lambda 1 to lambda 2 in the overview and include the trace details of lambda 2 when viewing the trace details of lambda 1.</p>\n\n<p>As long as you forward the top trace ID through the call chain, X-ray will correctly visualize the call chain from service to service with nodes and arrows.</p>\n\n<p>From <a href=\"https://aws.amazon.com/xray/faqs/\" rel=\"noreferrer\">https://aws.amazon.com/xray/faqs/</a>:</p>\n\n<blockquote>\n  <p>Q: What is a trace?</p>\n  \n  <p>An X-Ray trace is a set of data points that share the same trace ID.\n  For example, when a client makes a request to your application, it is\n  assigned a unique trace ID. As the request makes its way through\n  services in your application, the services relay information regarding\n  the request back to X-Ray using this unique trace ID. The piece of\n  information relayed by each service in your application to X-Ray is a\n  segment, and a trace is a collection of segments.</p>\n</blockquote>\n\n<p><a href=\"https://docs.aws.amazon.com/xray/latest/devguide/xray-concepts.html#xray-concepts-tracingheader\" rel=\"noreferrer\">https://docs.aws.amazon.com/xray/latest/devguide/xray-concepts.html#xray-concepts-tracingheader</a></p>\n\n<p><a href=\"https://docs.aws.amazon.com/xray/latest/devguide/xray-services-apigateway.html\" rel=\"noreferrer\">https://docs.aws.amazon.com/xray/latest/devguide/xray-services-apigateway.html</a></p>\n"}, {"tags": [], "owner": {"reputation": 391, "user_id": 4375384, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_RqBl08cXag/AAAAAAAAAAI/AAAAAAAAAH4/YeJ8_X9cdiw/photo.jpg?sz=128", "display_name": "Noah Zoschke", "link": "https://stackoverflow.com/users/4375384/noah-zoschke"}, "is_accepted": true, "score": 1, "last_activity_date": 1522418286, "last_edit_date": 1522418286, "creation_date": 1522417725, "answer_id": 49575700, "question_id": 49396352, "link": "https://stackoverflow.com/questions/49396352/aws-x-ray-golang-lambda-to-lambda-tracing-and-displayed-in-the-service-map/49575700#49575700", "title": "AWS X-Ray GoLang Lambda to lambda tracing and displayed in the service map", "body": "<p>This <a href=\"https://github.com/nzoschke/gofaas\" rel=\"nofollow noreferrer\">Go and Lambda boilerplate app</a> demonstrates Lambda to Lambda traces on the X-Ray service map:</p>\n\n<p><a href=\"https://github.com/nzoschke/gofaas/blob/master/worker.go\" rel=\"nofollow noreferrer\">https://github.com/nzoschke/gofaas/blob/master/worker.go</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/UQBKW.png\" rel=\"nofollow noreferrer\">Resulting X-Ray Service Map</a></p>\n\n<p><code>WorkCreateFunction</code> (function 1) is an API Gateway handler function. It calls <code>WorkerFunction</code> (function 2) via a <code>Lambda.InvokeWithContext</code> call.</p>\n\n<p>The trick is to instrument the Lambda API client with xray before making Lambda API calls:</p>\n\n<pre><code>// Lambda is an xray instrumented Lambda client\nfunc Lambda() *lambda.Lambda {\n    c := lambda.New(sess)\n    xray.AWS(c.Client)\n    return c\n}\n\nout, err := Lambda().InvokeWithContext(ctx, &amp;lambda.InvokeInput{\n    FunctionName:   aws.String(os.Getenv(\"WORKER_FUNCTION_NAME\")),\n    InvocationType: aws.String(\"Event\"), // async\n})\nif err != nil {\n    return responseEmpty, errors.WithStack(err)\n}\n</code></pre>\n\n<p>The <code>aws-xray-sdk-go</code> copies the <code>X-Amzn-Trace-Id</code> header from function 1 into the Lambda API request for function 2:</p>\n\n<p><a href=\"https://github.com/aws/aws-xray-sdk-go/blob/master/xray/aws.go#L56\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-xray-sdk-go/blob/master/xray/aws.go#L56</a></p>\n\n<p>If this is not working, try updating to the latest <code>aws-xray-sdk-go</code>.</p>\n"}], "owner": {"reputation": 443, "user_id": 567214, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/056423a69304d7f99fe82ce8c3e21d2c?s=128&d=identicon&r=PG", "display_name": "rick", "link": "https://stackoverflow.com/users/567214/rick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1537, "favorite_count": 2, "accepted_answer_id": 49575700, "answer_count": 2, "score": 9, "last_activity_date": 1522418286, "creation_date": 1521592724, "last_edit_date": 1521818208, "question_id": 49396352, "link": "https://stackoverflow.com/questions/49396352/aws-x-ray-golang-lambda-to-lambda-tracing-and-displayed-in-the-service-map", "title": "AWS X-Ray GoLang Lambda to lambda tracing and displayed in the service map", "body": "<p>I have the API Gateway that calls Lamdba function 1 and that invokes lambda function 2 in Go.   I want to see these 2 functions joined in the service map.</p>\n\n<p>The only way i have been able to do this so far is to create a custom segment eg called \"parent\" and the create a subsegment from this context eg called \"child\".   Then using client.InvokeWithContext to invoke the function 2 passing the \"child\" segment context.</p>\n\n<pre><code>sess := session.Must(session.NewSession())\nclient := lambda.New(sess, &amp;aws.Config{Region: aws.String(region)})\n\nxray.Configure(xray.Config{LogLevel: \"trace\"})\nxray.AWS(client.Client)\n\nctx, seg := xray.BeginSegment(context.Background(), \"Parent\")\nctx, subseg := xray.BeginSubsegment(ctx, \"Child\")\nresult, _ := client.InvokeWithContext(ctx, \n    lambda.InvokeInput{FunctionName: aws.String(functionName), Payload: nil})\nsubseg.Close(nil)   \nseg.Close(nil)\n</code></pre>\n\n<p>Problem is that this creates trace parent -> child in sevice map but also has function 1 too.</p>\n\n<p>What is the best way to join these 2 functions on the service map please ?\nNote.  I have more than 2 that i want to see linked up on the service map to show me my whole flow through lambdas.</p>\n\n<p>Please help.</p>\n\n<p>Thanks\nRick</p>\n"}, {"tags": ["go", "package", "revel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521583686, "post_id": 49394841, "comment_id": 85791473, "body": "That repo no longer exists, so <code>gopkg.in</code> can&#39;t redirect you there."}], "answers": [{"tags": [], "owner": {"reputation": 669, "user_id": 202648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a3c77049e188b4334bf7d589d438b9f?s=128&d=identicon&r=PG", "display_name": "ptman", "link": "https://stackoverflow.com/users/202648/ptman"}, "is_accepted": false, "score": 0, "last_activity_date": 1523361504, "creation_date": 1523361504, "answer_id": 49753062, "question_id": 49394841, "link": "https://stackoverflow.com/questions/49394841/cant-install-revel-on-macos-package-gopkg-in-fsnotify-v1-unrecognized-import/49753062#49753062", "title": "Can&#39;t install Revel on MacOS &quot;package gopkg.in/fsnotify.v1: unrecognized import path&quot;", "body": "<p>The problem was fixed in <a href=\"https://github.com/revel/revel/releases/tag/v0.19.1\" rel=\"nofollow noreferrer\">revel 0.19.1</a></p>\n"}], "owner": {"reputation": 11, "user_id": 9525290, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-xbL5DDIAQl0/AAAAAAAAAAI/AAAAAAAAAVQ/oMCCM7snoWM/photo.jpg?sz=128", "display_name": "Michael Lindner", "link": "https://stackoverflow.com/users/9525290/michael-lindner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 382, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523361504, "creation_date": 1521583288, "question_id": 49394841, "link": "https://stackoverflow.com/questions/49394841/cant-install-revel-on-macos-package-gopkg-in-fsnotify-v1-unrecognized-import", "title": "Can&#39;t install Revel on MacOS &quot;package gopkg.in/fsnotify.v1: unrecognized import path&quot;", "body": "<p>Following \"<a href=\"https://revel.github.io/tutorial/gettingstarted.html\" rel=\"nofollow noreferrer\">Getting Started</a>\" directions:</p>\n\n<pre><code>$ go get -v github.com/revel/revel\nFetching https://gopkg.in/fsnotify.v1?go-get=1\nParsing meta tags from https://gopkg.in/fsnotify.v1?go-get=1 (status code 404)\npackage gopkg.in/fsnotify.v1: unrecognized import path \"gopkg.in/fsnotify.v1\" (parse https://gopkg.in/fsnotify.v1?go-get=1: no go-import meta tags ())\n</code></pre>\n\n<p>MacOS High Sierra version: 10.13.3 (17D102)\ngit version 2.14.3 (Apple Git-98)\ngo version go1.10 darwin/amd64</p>\n\n<p>Previous similar problems (like <a href=\"https://stackoverflow.com/questions/33202323/golang-revel-freezes-when-download-gopkg-in-fsnotify-v1\">this</a> and <a href=\"https://stackoverflow.com/questions/29843116/cant-install-revel-unrecognized-import-path\">this</a>) did not provide a solution that works.</p>\n"}, {"tags": ["go", "associations", "go-gorm"], "comments": [{"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1521583099, "post_id": 49394539, "comment_id": 85791234, "body": "I&#39;m guessing but maybe in your <code>UserProfileService</code> <code>Create</code> method probably you  should provide model.UserProfile as a pointer?"}], "answers": [{"tags": [], "owner": {"reputation": 89, "user_id": 7061754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56df6e548abaddd7c9e739a1d4848a8d?s=128&d=identicon&r=PG&f=1", "display_name": "Neverbolt", "link": "https://stackoverflow.com/users/7061754/neverbolt"}, "is_accepted": false, "score": 0, "last_activity_date": 1526233199, "creation_date": 1526233199, "answer_id": 50318871, "question_id": 49394539, "link": "https://stackoverflow.com/questions/49394539/create-one-to-one-association-in-transaction/50318871#50318871", "title": "Create one-to-one association in transaction", "body": "<p>The model that you are inserting in UserProfileService.go is not a pointer, which is why you are getting the <code>unaddressable</code> error.</p>\n\n<pre><code>func (UserProfileService) Create(tx *gorm.DB, user *models.User) error {\n    if err := tx.Create(*models.UserProfile{User: user}).Error; err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>That referencing in the <code>tx.Create</code> call will most likely fix your error. If not please post the full error.</p>\n"}], "owner": {"reputation": 1, "user_id": 5019146, "user_type": "registered", "profile_image": "https://graph.facebook.com/1003682012998850/picture?type=large", "display_name": "Giuliano Falcaro", "link": "https://stackoverflow.com/users/5019146/giuliano-falcaro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1526233199, "creation_date": 1521581978, "last_edit_date": 1521620148, "question_id": 49394539, "link": "https://stackoverflow.com/questions/49394539/create-one-to-one-association-in-transaction", "title": "Create one-to-one association in transaction", "body": "<p>UserService.go</p>\n\n<pre><code>func (service UserService) Create(model *models.User) (*models.User, error) {\n    db, err := database.GetConnection()\n    if err != nil {\n        return nil, err\n    }\n    tx := db.Begin()\n    if tx.Error != nil {\n        fmt.Errorf(\"%v\", err)\n        return nil, err\n    }\n    if err := tx.Create(model).Error; err != nil {\n        fmt.Errorf(\"%v\", err)\n        tx.Rollback()\n        return nil, err\n    }\n    if err := tx.Save(model).Error; err != nil {\n        fmt.Errorf(\"%v\", err)\n        tx.Rollback()\n        return nil, err\n    }\n    if err := service.UserProfileService.Create(tx, model); err != nil {\n        fmt.Errorf(\"%v\", err)\n        tx.Rollback()\n        return nil, err\n    }\n    if err := tx.Commit().Error; err != nil {\n        fmt.Errorf(\"%v\", err)\n        return nil, err\n    }\n    return model, nil\n}\n</code></pre>\n\n<p>UserProfileService.go</p>\n\n<pre><code>func (UserProfileService) Create(tx *gorm.DB, user *models.User) error {\n    if err := tx.Create(models.UserProfile{User: user}).Error; err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>User.go</p>\n\n<pre><code>type User struct {\n    Id               *uuid.UUID     `json:\"id\" gorm:\"not null;primary_key;type:uuid;default:uuid_generate_v4();\"`\n    Name             *string        `json:\"name\" gorm:\"not null;type:varchar(255);\"`\n    CreatedAt        time.Time      `json:\"createdAt\" gorm:\"type:timestamp;default:now()\"`\n    UpdatedAt        time.Time      `json:\"updatedAt\" gorm:\"type:timestamp;default:now()\"`\n    DeletedAt        *time.Time     `json:\"deleteAt,omitempty\" gorm:\"type:timestamp;\"`\n}\n\nfunc (User) TableName() string {\n    return \"users\"\n}\n</code></pre>\n\n<p>UserProfile.go</p>\n\n<pre><code>type UserProfile struct {\n    User        *User      `json:\"id\" gorm:\"not null;primary_key;foreignkey:Id;type:uuid;default:uuid_generate_v4();\"`\n    Id          *uuid.UUID `json:\"id\" gorm:\"not null;type:uuid\"`\n    Description string     `json:\"description\" gorm:\"not null;type:varchar(255)\"`\n    UpdatedAt   time.Time  `json:\"updatedAt\" gorm:\"type:timestamp;default:now()\"`\n}\n\nfunc (UserProfile) TableName() string {\n    return \"users_profile\"\n}\n</code></pre>\n\n<p>So, every User must have just one UserProfile, that is why UserProfile's primary key is also a foreign key (User (id)). But when I try to make a request, I got this error: <code>(using unaddressable value)</code></p>\n\n<p>Any ideas on how to get this working?</p>\n"}, {"tags": ["go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 4, "last_activity_date": 1521589481, "last_edit_date": 1521589481, "creation_date": 1521582194, "answer_id": 49394596, "question_id": 49394466, "link": "https://stackoverflow.com/questions/49394466/does-type-assertion-change-the-value-in-go/49394596#49394596", "title": "Does type assertion change the value in go?", "body": "<p>Type assertion is used to get a value wrapped around using interface.</p>\n\n<pre><code>m := structs.Map(p)\n\nMap(v interface{}){}\n</code></pre>\n\n<p>Map function is actually taking interface as its argument in the case stated. It is wrapping the type which is <code>[]string</code> and its underlying value which is slice. The type can be checked using <a href=\"https://golang.org/pkg/reflect/#TypeOf\" rel=\"nofollow noreferrer\">Relection</a> <code>reflect.TypeOf()</code>.</p>\n\n<pre><code>func TypeOf(i interface{}) Type\n</code></pre>\n\n<p>According to Russ Cox blog on <a href=\"https://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">Interfaces</a></p>\n\n<blockquote>\n  <p>Interface values are represented as a two-word pair giving a pointer\n  to information about the type stored in the interface and a pointer to\n  the associated data.</p>\n</blockquote>\n\n<p>As specified in <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">Golang</a> spec</p>\n\n<blockquote>\n  <p>For an expression x of interface type and a type T, the primary\n  expression</p>\n\n<pre><code>x.(T)\n</code></pre>\n  \n  <p>asserts that x is not nil and that the value stored in x is of type T.\n  The notation x.(T) is called a type assertion.</p>\n</blockquote>\n\n<p>For the error part:-</p>\n\n<pre><code>Cannot use 'arguments' (type interface{}) as type []string\n</code></pre>\n\n<p>We first needs to get the underlying value of type <code>[]string</code> from interface using type assertion.</p>\n"}], "owner": {"reputation": 637, "user_id": 4926846, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c7c6f19ebf2cfa79a70d71d3966fe36?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/4926846/brian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 594, "favorite_count": 0, "accepted_answer_id": 49394596, "answer_count": 1, "score": 0, "last_activity_date": 1531308125, "creation_date": 1521581564, "last_edit_date": 1531308125, "question_id": 49394466, "link": "https://stackoverflow.com/questions/49394466/does-type-assertion-change-the-value-in-go", "title": "Does type assertion change the value in go?", "body": "<p>Go newbie here.</p>\n\n<p>I have a map where the key arguments should be <code>[]string</code>.</p>\n\n<p>However, if I try to use the value directly <code>arguments := m[\"arguments\"]</code> it doesn't seem to be the right type. When used later to append to another slice with <code>arguments...</code> I get <code>Cannot use 'arguments' (type interface{}) as type []string</code>.</p>\n\n<p>I fixed this by chaning the assignment to a type check <code>arguments, _ := m[\"arguments\"].([]string)</code>. That works, but I'm not sure why. Is <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> doing conversion as well?</p>\n\n<p>The full example is below:</p>\n\n<pre><code>import (\n    \"github.com/fatih/structs\"\n    \"strings\"\n)\n\nvar playbookKeyDict = map[string]string{\n    \"Playbook\": \"\",\n    \"Limit\" : \"--limit\",\n    \"ExtraVars\" : \"--extra-vars\",\n}\n\ntype Playbook struct {\n    Playbook string `json:\"playbook\" xml:\"playbook\" form:\"playbook\" query:\"playbook\"`\n    Limit string `json:\"limit\" xml:\"limit\" form:\"limit\" query:\"limit\"`\n    ExtraVars string `json:\"extra-vars\" xml:\"extra-vars\" form:\"extra-vars\" query:\"extra-vars\"`\n    Arguments []string `json:\"arguments\" xml:\"arguments\" form:\"arguments\" query:\"arguments\"`\n    Args []string\n}\n\nfunc (p *Playbook) formatArgs() {\n    // is it worth iterating through directly with reflection instead of using structs import?\n    // https://stackoverflow.com/questions/21246642/iterate-over-string-fields-in-struct\n    m := structs.Map(p)\n\n    // direct assignment has the wrong type?\n    // arguments := m[\"arguments\"]\n    arguments, _ := m[\"arguments\"].([]string)\n    delete(m, \"arguments\")\n\n    for k, v := range m {\n        // Ignore non-strings and empty strings\n        if val, ok := v.(string); ok &amp;&amp; val != \"\" {\n            key := playbookKeyDict[k]\n            if key == \"\" {\n                p.Args = append(p.Args, val)\n            } else {\n                p.Args = append(p.Args, playbookKeyDict[k], val)\n            }\n        }\n    }\n    p.Args = append(p.Args, arguments...)\n}\n</code></pre>\n"}, {"tags": ["go", "heroku", "iris-go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1521581512, "post_id": 49393938, "comment_id": 85790600, "body": "Which browser are you using? I seem to recall that Safari ignores the Set-Cookie header for iframe responses, for instance. Use your browser&#39;s developer tool to verify that the cookie sticks."}, {"owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521639925, "post_id": 49393938, "comment_id": 85817186, "body": "I am using Chrome."}, {"owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521678792, "post_id": 49393938, "comment_id": 85839006, "body": "Every response that comes from my backend contains a new set-cookie header with new session id. Only on herokuapp.com and not localhost."}, {"owner": {"reputation": 156, "user_id": 6142156, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YD-JjNDaB_g/AAAAAAAAAAI/AAAAAAAAFNs/2xJjyecA0xs/photo.jpg?sz=128", "display_name": "manudicri", "link": "https://stackoverflow.com/users/6142156/manudicri"}, "edited": false, "score": 0, "creation_date": 1608719011, "post_id": 49393938, "comment_id": 115664270, "body": "How can I fix??"}], "owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 331, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1521579707, "creation_date": 1521579279, "last_edit_date": 1521579707, "question_id": 49393938, "link": "https://stackoverflow.com/questions/49393938/session-id-is-different-for-each-request", "title": "Session id is different for each request", "body": "<p>On Heroku, I am using the <code>sessions</code> within the Iris framework for Go. Each time I make a request to the server from the browser page, the session ID is different.</p>\n\n<p>My code:</p>\n\n<p>When the application starts (global scope)</p>\n\n<pre><code>var appSession = sessions.New(sessions.Config{Cookie: \"cookiesessionid\"})\n</code></pre>\n\n<p>Incoming request</p>\n\n<pre><code>func post Request(ctx iris.Context) {\n\n    sess := appSession.Start(ctx)\n    sess := appSession.Start(ctx)\n    fmt.Printf(\"%#v\", sess)\n}\n</code></pre>\n\n<p>Every time I run the request the session identifier revealed by the print statement, is different. Why would this be?</p>\n\n<p>For what it's worth - the page is running out of an iframe.</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521577082, "post_id": 49393106, "comment_id": 85788387, "body": "What about it specifically do you need help understanding?"}], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 2, "last_activity_date": 1521577073, "creation_date": 1521577073, "answer_id": 49393407, "question_id": 49393106, "link": "https://stackoverflow.com/questions/49393106/trying-to-understand-the-use-of-channel-in-grpc-client-in-golang/49393407#49393407", "title": "Trying to understand the use of channel in gRPC client in golang", "body": "<p>Channel <code>waitc</code> used to make <code>main</code> thread wait for goroutine to finish receiving from server and gracefully shutdown connection.</p>\n\n<pre><code>&lt;-waitc // is a blocking operation. It can evaluate when channel been closed\n</code></pre>\n"}], "owner": {"reputation": 571, "user_id": 4672066, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/76f2602db81aefda840f27845b9160e3?s=128&d=identicon&r=PG&f=1", "display_name": "SimpleCoder", "link": "https://stackoverflow.com/users/4672066/simplecoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1508, "favorite_count": 0, "accepted_answer_id": 49393407, "answer_count": 1, "score": 2, "last_activity_date": 1521577073, "creation_date": 1521575959, "question_id": 49393106, "link": "https://stackoverflow.com/questions/49393106/trying-to-understand-the-use-of-channel-in-grpc-client-in-golang", "title": "Trying to understand the use of channel in gRPC client in golang", "body": "<p>Could someone please help me understand the usage of the channel in the client side of gRPC code here (for bidirectional streaming RPC):\n<a href=\"https://grpc.io/docs/tutorials/basic/go.html\" rel=\"nofollow noreferrer\">https://grpc.io/docs/tutorials/basic/go.html</a></p>\n\n<p>This is the code:</p>\n\n<pre><code>stream, err := client.RouteChat(context.Background())\nwaitc := make(chan struct{})\ngo func() {\n    for {\n        in, err := stream.Recv()\n        if err == io.EOF {\n            // read done.\n            close(waitc)\n            return\n        }\n        if err != nil {\n            log.Fatalf(\"Failed to receive a note : %v\", err)\n        }\n        log.Printf(\"Got message %s at point(%d, %d)\", in.Message, in.Location.Latitude, in.Location.Longitude)\n    }\n}()\nfor _, note := range notes {\n    if err := stream.Send(note); err != nil {\n        log.Fatalf(\"Failed to send a note: %v\", err)\n    }\n}\nstream.CloseSend()\n&lt;-waitc\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["dictionary", "go", "struct"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521577073, "post_id": 49393087, "comment_id": 85788382, "body": "Please add the code for main file where you are using the package returnperson for person struct"}], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 3, "last_activity_date": 1521576827, "last_edit_date": 1521576827, "creation_date": 1521576354, "answer_id": 49393213, "question_id": 49393087, "link": "https://stackoverflow.com/questions/49393087/package-to-return-a-map-of-structs/49393213#49393213", "title": "package to return a map of structs", "body": "<p>Here a few hints on extracting something to a package:</p>\n\n<ol>\n<li><p>Only functions, variables and types with capital letters on package level are accessible from the \"outside\" (other packages or main)</p></li>\n<li><p>A public function should only return types that are public as well</p></li>\n</ol>\n\n<p>In your case you say <code>personstruct</code> is defined inside the function <code>Person</code>. That is not possible if you want it to be a return value of the function. You need to define it on package level. Also it should be exported since an exported function uses it.</p>\n\n<p>Here a sample:</p>\n\n<pre><code>package returnperson\n\n// PersonStruct defines ...\ntype PersonStruct struct {\n    // fields\n}\n\n// Person does ...\nfunc Person() map[string]PersonStruct {\n    var people = map[string]PersonStruct{}\n    //do stuff\n    return people\n}\n</code></pre>\n\n<p>-- edit --</p>\n\n<p>I would further suggest to call the package itself <code>person</code> and make it about managing a person, meaning the main item in this package would be a struct called <code>Person</code>. <code>returnperson</code> is more of a function name.</p>\n\n<p>The package could also be about a list of persons (slice/map). Then maybe you want to call it <code>personlist</code> and the main topic of the package would be managing a list of persons with the main struct maybe called <code>PersonList</code>.</p>\n\n<p>Just some suggestions to think about...</p>\n"}], "owner": {"reputation": 121, "user_id": 1691233, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bltX6.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/1691233/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 49393213, "answer_count": 1, "score": 0, "last_activity_date": 1521577111, "creation_date": 1521575870, "last_edit_date": 1521577111, "question_id": 49393087, "link": "https://stackoverflow.com/questions/49393087/package-to-return-a-map-of-structs", "title": "package to return a map of structs", "body": "<p>I have created the logic to populate a map of structs and it is working as expected.\nNow, I would like to move that functionality to a package. Like so</p>\n\n<pre><code>package returnperson\nfunc Person() map[string]personstruct {\n   //do stuff\n   return people\n}\n</code></pre>\n\n<p>I defined the personstruct in the body of the function Person, however, line 2 is throwing the following error: </p>\n\n<blockquote>\n  <p>undefined:personstruct(2,1)</p>\n</blockquote>\n\n<p>I've researched and I don't seem to find a way to correct the issue.\nThanks in advance for your help.</p>\n"}, {"tags": ["go", "gnupg", "gpg-signature"], "comments": [{"owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 0, "creation_date": 1521570948, "post_id": 49391073, "comment_id": 85785137, "body": "If this documentation is right, --verify does not generate output: &quot;Assume that sigfile is a signature and verify it without generating any output.&quot; <a href=\"https://gnupg.org/documentation/manpage.html\" rel=\"nofollow noreferrer\">gnupg.org/documentation/manpage.html</a> Does that match the man/info for gpg on your system?"}, {"owner": {"reputation": 173, "user_id": 2061705, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/20b28e3cdb00338f5622207751240a69?s=128&d=identicon&r=PG", "display_name": "Nik", "link": "https://stackoverflow.com/users/2061705/nik"}, "reply_to_user": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "edited": false, "score": 1, "creation_date": 1521572233, "post_id": 49391073, "comment_id": 85785867, "body": "I think i figured it out, it needs CombinedOutput instead to make it work."}], "owner": {"reputation": 173, "user_id": 2061705, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/20b28e3cdb00338f5622207751240a69?s=128&d=identicon&r=PG", "display_name": "Nik", "link": "https://stackoverflow.com/users/2061705/nik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1521569352, "creation_date": 1521568335, "question_id": 49391073, "link": "https://stackoverflow.com/questions/49391073/go-basic-exec-command-having-issue-printing-output-of-command", "title": "Go basic exec command having issue printing output of command", "body": "<p>I am new to Go and trying to run a simple program with GPG verify a file with my signature file.</p>\n\n<p>Here is my snippet:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>out, err := exec.Command(\"gpg\", \"--verify\", \"xyz.json.sig\", \"xyz.json\").Output()\r\n\tif err != nil {\r\n\t\tfmt.Printf(\"%s\", err)\r\n\t\tos.Exit(1)\r\n\t}\r\n\tfmt.Printf(\"The output is: %s\\n\", out)</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>When i execute this my output <code>out</code> is coming out empty. If i run this verify command manually from command line i get valid signature, both xyz.json.sig and xyz.json are local files next to my go file. What am i missing any idea?</p>\n"}, {"tags": ["regex", "go", "simultaneous"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "edited": false, "score": 0, "creation_date": 1521552276, "post_id": 49385380, "comment_id": 85771704, "body": "I don&#39;t understand how the output you show is supposed to be created? What are the two values on each line in the output? Do they correspond to a value from the first and from the second file? How is done?"}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1521555070, "post_id": 49385380, "comment_id": 85774042, "body": "&quot;messing with splitting line into slices/substrings and working over them&quot; would likely be much faster ... :)"}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 1, "creation_date": 1521555458, "post_id": 49385380, "comment_id": 85774349, "body": "Can you show 2 exact inputs (5 lines) for each files and exact output expected. Make sure couple of values are in scientific notation."}, {"owner": {"reputation": 33, "user_id": 9501942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iKEp9.png?s=128&g=1", "display_name": "Umnitsyn Vladimir", "link": "https://stackoverflow.com/users/9501942/umnitsyn-vladimir"}, "edited": false, "score": 0, "creation_date": 1521555669, "post_id": 49385380, "comment_id": 85774497, "body": "First three values of first lines of files are <code>-0,1296169 -0,1286087 -0,1276232 ...</code>and <code>-0,1181779 -0,1200798 -0,1219472 ...</code> should be reworked as shown in last listing, so first row consists of values from first file, second - from second (or first row - from first values of these files, second row - second values ...). So file1 line1 <code>val1 val2 val3 ...</code> and file2 line1 <code>val1 val2 val3 ...</code> comes to out.txt: line1 like <code>val1;val1</code>, line 2 <code>val2;val2</code> and so on."}], "answers": [{"comments": [{"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1521727069, "post_id": 49388753, "comment_id": 85862709, "body": "Version from @peterSO is more comprehensive and much neater."}], "tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": false, "score": 0, "last_activity_date": 1521563460, "last_edit_date": 1521563460, "creation_date": 1521561289, "answer_id": 49388753, "question_id": 49385380, "link": "https://stackoverflow.com/questions/49385380/read-two-files-simultsneously-value-by-value-using-regexp/49388753#49388753", "title": "Read two files simultsneously value by value using regexp", "body": "<p>Something like this. Note the limitation that assumes same number of values per line. Be careful it would blowup with the error if this assumption is wrong :)</p>\n\n\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    file_dB, err := os.Open(\"dB.txt\")\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        return\n    }\n    defer file_dB.Close()\n\n    file_dL, err := os.Open(\"dL.txt\")\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        return\n    }\n    defer file_dL.Close()\n\n    file_out, err := os.Create(\"out.txt\") // also rewrite existing !\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        return\n    }\n    defer file_out.Close()\n\n    dB := bufio.NewReader(file_dB)\n    dL := bufio.NewReader(file_dL)\n\n    lc := 0\n\n    for {\n        lc++\n\n        line1, _, err := dB.ReadLine()\n        vals1 := strings.Split(string(line1), \" \")\n        if err != nil {\n            fmt.Println(lc, err)\n            return\n        }\n\n        line2, _, err := dL.ReadLine()\n        vals2 := strings.Split(string(line2), \" \")\n        if err != nil {\n            fmt.Println(lc, err)\n            return\n        }\n\n        // Limitation: assumes line1 and line2 have same number of values per line\n\n        for i := range vals1 {\n            dot1 := strings.Replace(vals1[i], \",\", \".\", 1)\n            v1, err := strconv.ParseFloat(dot1, 64)\n            if err != nil {\n                fmt.Println(lc, err)\n                continue\n            }\n\n            dot2 := strings.Replace(vals2[i], \",\", \".\", 1)\n            v2, err := strconv.ParseFloat(dot2, 64)\n            if err != nil {\n                fmt.Println(lc, err)\n                continue\n            }\n\n            _, err = fmt.Fprintf(file_out, \"%v; %v\\n\", v1, v2)\n            if err != nil {\n                fmt.Println(lc, err)\n                return\n            }\n        }\n\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1521561624, "creation_date": 1521561624, "answer_id": 49388876, "question_id": 49385380, "link": "https://stackoverflow.com/questions/49385380/read-two-files-simultsneously-value-by-value-using-regexp/49388876#49388876", "title": "Read two files simultsneously value by value using regexp", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n)\n\nvar comma, period = []byte{','}, []byte{'.'}\n\nfunc readNext(r io.Reader) func() (float64, error) {\n    s := bufio.NewScanner(r)\n    var fields []string\n    return func() (float64, error) {\n        if len(fields) == 0 {\n            err := io.EOF\n            for s.Scan() {\n                line := bytes.Replace(s.Bytes(), comma, period, -1)\n                fields = strings.Fields(string(line))\n                if len(fields) &gt; 0 {\n                    err = nil\n                    break\n                }\n            }\n            if err := s.Err(); err != nil {\n                return 0, err\n            }\n            if err == io.EOF {\n                return 0, err\n            }\n        }\n        n, err := strconv.ParseFloat(fields[0], 64)\n        fields = fields[1:]\n        if err != nil {\n            return 0, err\n        }\n        return n, nil\n    }\n}\n\nfunc main() {\n    in1Name := `in1.data`\n    in2Name := `in2.data`\n    outName := `out.data`\n    in1, err := os.Open(in1Name)\n    if err != nil {\n        fmt.Fprint(os.Stderr, err)\n        return\n    }\n    defer in1.Close()\n    in2, err := os.Open(in2Name)\n    if err != nil {\n        fmt.Fprint(os.Stderr, err)\n        return\n    }\n    defer in2.Close()\n    out, err := os.Create(outName)\n    if err != nil {\n        fmt.Fprint(os.Stderr, err)\n        return\n    }\n    defer out.Close()\n    outw := bufio.NewWriter(out)\n    defer outw.Flush()\n\n    next1 := readNext(in1)\n    next2 := readNext(in2)\n    for {\n        n1, err1 := next1()\n        n2, err2 := next2()\n        if err1 == io.EOF &amp;&amp; err2 == io.EOF {\n            break\n        }\n        if err1 != nil || err2 != nil {\n            fmt.Fprint(os.Stderr, err1, err2)\n            return\n        }\n        _, err := fmt.Fprintf(outw, \"%g;%g\\n\", n1, n2)\n        if err != nil {\n            fmt.Fprint(os.Stderr, err)\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/I_sT_EPFI_W\" rel=\"nofollow noreferrer\">https://play.golang.org/p/I_sT_EPFI_W</a></p>\n\n<p>Output:</p>\n\n<pre><code>$ go run  data.go\n$ cat in1.data\n-0,1296169 -0,1286087 -0,1276232 \n-0,1288124 -0,1278683 -0,1269373 \n-0,1280221 -0,1271375 -0,12626  \n$ cat in2.data\n-0,1296169 -0,1286087 -0,1276232 \n-0,1288124 -0,1278683 -0,1269373 \n-0,1280221 -0,1271375 -0,12626  \n$ cat out.data\n-0.1296169;-0.1296169\n-0.1286087;-0.1286087\n-0.1276232;-0.1276232\n-0.1288124;-0.1288124\n-0.1278683;-0.1278683\n-0.1269373;-0.1269373\n-0.1280221;-0.1280221\n-0.1271375;-0.1271375\n-0.12626;-0.12626\n$ \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 33, "user_id": 9501942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iKEp9.png?s=128&g=1", "display_name": "Umnitsyn Vladimir", "link": "https://stackoverflow.com/users/9501942/umnitsyn-vladimir"}, "is_accepted": false, "score": 1, "last_activity_date": 1525360379, "creation_date": 1525360379, "answer_id": 50158445, "question_id": 49385380, "link": "https://stackoverflow.com/questions/49385380/read-two-files-simultsneously-value-by-value-using-regexp/50158445#50158445", "title": "Read two files simultsneously value by value using regexp", "body": "<p>Thanks for help, with points of view of another peoples i've found my own solution.</p>\n\n<p><strong>What this tool does?</strong> Generally it combines two text files to one.</p>\n\n<p><strong>Where i've used it?</strong> Creating \"Generic ASCII\" text file for \"Country specific coordinate system tool\". Input text files are ASCII export of GRID files from GIS applications (values in arc degrees expected). Later this file may be used to fix local coordinate shifts when working with precise GPS/GNSS receivers.</p>\n\n<p>Here what i've \"developed\":</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"regexp\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    file_dB, err := os.Open(\"d:/dB.txt\")\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        os.Exit(1)\n    }\n    defer file_dB.Close()\n    file_dL, err := os.Open(\"d:/dL.txt\")\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        os.Exit(1)\n    }\n    defer file_dL.Close()\n    file_out, err := os.Create(\"d:/out.txt\") // also rewrite existing !\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        os.Exit(1)\n    }\n    defer file_out.Close()\n\n    dB := bufio.NewReader(file_dB)\n    dL := bufio.NewReader(file_dL)\n\n    err = nil\n    xcorn_float := 0.0\n    ycorn_float := 0.0\n    cellsize_float := 0.0\n    ncols := regexp.MustCompile(\"[0-9]+\")\n    nrows := regexp.MustCompile(\"[0-9]+\")\n    xcorn := regexp.MustCompile(\"[0-9]*,[0-9]*\")\n    ycorn := regexp.MustCompile(\"[0-9]*,[0-9]*\")\n    cellsize := regexp.MustCompile(\"[0-9]*,[0-9]*\")\n    nodataval := regexp.MustCompile(\"-?d+\")\n    tmp := 0.0\n\n    // n cols --------------------\n    ncols_dB, err := dB.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    ncols_dL, err := dL.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    if ncols.FindString(ncols_dB) != ncols.FindString(ncols_dL) {\n        panic(err)\n    }\n    ncols_dB = ncols.FindString(ncols_dB)\n    // n rows --------------------\n    nrows_dB, err := dB.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    nrows_dL, err := dL.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    if nrows.FindString(nrows_dB) != nrows.FindString(nrows_dL) {\n        panic(err)\n    }\n    nrows_dB = nrows.FindString(nrows_dB)\n    // X --------------------\n    xcorn_dB, err := dB.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    xcorn_dL, err := dL.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    if xcorn.FindString(xcorn_dB) != xcorn.FindString(xcorn_dL) {\n        panic(err)\n    }\n    xcorn_float, err = strconv.ParseFloat(strings.Replace(cellsize.FindString(xcorn_dB), \",\", \".\", 1), 8)\n    xcorn_float *= 3600.0\n    // Y --------------------\n    ycorn_dB, err := dB.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    ycorn_dL, err := dL.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    if ycorn.FindString(ycorn_dB) != ycorn.FindString(ycorn_dL) {\n        panic(err)\n    }\n    ycorn_float, err = strconv.ParseFloat(strings.Replace(cellsize.FindString(ycorn_dB), \",\", \".\", 1), 8)\n    ycorn_float *= 3600.0\n    // cell size --------------------\n    cellsize_dB, err := dB.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    cellsize_dL, err := dL.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    if cellsize.FindString(cellsize_dB) != cellsize.FindString(cellsize_dL) {\n        panic(err)\n    }\n    cellsize_float, err = strconv.ParseFloat(strings.Replace(cellsize.FindString(cellsize_dB), \",\", \".\", 1), 8)\n    cellsize_float *= 3600.0\n    // nodata value --------------------\n    nodataval_dB, err := dB.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    nodataval_dL, err := dL.ReadString('\\n')\n    if err != nil {\n        panic(err)\n    }\n    if nodataval.FindString(nodataval_dB) != nodataval.FindString(nodataval_dL) {\n        panic(err)\n    }\n    nodataval_dB = nodataval.FindString(nodataval_dB)\n    fmt.Print(nodataval_dB)\n    //making header\n    if _, err := file_out.WriteString(\"name\\n3;0;2\\n1;2;\" + nrows_dB + \";\" + ncols_dB + \"\\n\" + strconv.FormatFloat(xcorn_float, 'f', -1, 32) + \";\" + strconv.FormatFloat(ycorn_float, 'f', -1, 32) + \";\" + strconv.FormatFloat(cellsize_float, 'f', -1, 32) + \";\" + strconv.FormatFloat(cellsize_float, 'f', -1, 32) + \"\\n1\\n\"); err != nil {\n        panic(err)\n    }\n    // valuses --------------------\n    for {\n        line1, err := dB.ReadString(' ')\n        if err != nil {\n            break\n        }\n        if tmp, err = strconv.ParseFloat(strings.TrimSpace(strings.Replace(line1, \",\", \".\", 1)), 64); err == nil {\n            line1 = strconv.FormatFloat(tmp, 'f', 8, 64)\n        }\n        line2, err := dL.ReadString(' ')\n        if err != nil {\n            break\n        }\n        if tmp, err = strconv.ParseFloat(strings.TrimSpace(strings.Replace(line2, \",\", \".\", 1)), 64); err == nil {\n            line2 = strconv.FormatFloat(tmp, 'f', 8, 64)\n        }\n        if err != nil {\n            panic(err)\n        }\n        str := string(line1) + \";\" + string(line2) + \"\\n\"\n        if _, err := file_out.WriteString(str); err != nil {\n            panic(err)\n        }\n    }\n}\n</code></pre>\n\n<p>If you have any recomendations - feel free to leave a comment!</p>\n"}], "owner": {"reputation": 33, "user_id": 9501942, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iKEp9.png?s=128&g=1", "display_name": "Umnitsyn Vladimir", "link": "https://stackoverflow.com/users/9501942/umnitsyn-vladimir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 1, "answer_count": 3, "score": 0, "last_activity_date": 1525360379, "creation_date": 1521552050, "last_edit_date": 1521556132, "question_id": 49385380, "link": "https://stackoverflow.com/questions/49385380/read-two-files-simultsneously-value-by-value-using-regexp", "title": "Read two files simultsneously value by value using regexp", "body": "<p>Doing small helping tool for combining two text files into one.\nThese files stores a big 2D arrays of float values. Here is some of them:</p>\n\n<pre><code>File 1\n-0,1296169 -0,1286087 -0,1276232 ...\n-0,1288124 -0,1278683 -0,1269373 ...\n-0,1280221 -0,1271375 -0,12626  ...\n...\n\nFile 2\n-0,1181779 -0,1200798 -0,1219472 ...\n-0,1198357 -0,1216468 -0,1234369 ...\n-0,1214746 -0,1232006 -0,1249159 ...\n... \nboth may have hunderds of rows and columns ...\n</code></pre>\n\n<p>Values also can be in scientific form (etc. 1.234e-003).\nMy goal is to read two files simultaneously value by value and write output, while fixing delimeter from comma to point and conver from scientific form to standard in the process.</p>\n\n<p>This version of program combines only prepeared files (delimeter changed to point, values represented in standard form and values moved \"one value per line\"), but making these preparation is unreal if file have more than million of values.</p>\n\n<p>Here is what i have for now:</p>\n\n<pre><code>import (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"regexp\"\n)\n\nfunc main() {\n    file_dB, err := os.Open(\"d:/dB.txt\")\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        os.Exit(1)\n    }\n    file_dL, err := os.Open(\"d:/dL.txt\")\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        os.Exit(1)\n    }\n    file_out, err := os.Create(\"d:/out.txt\") // also rewrite existing !\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\\n\", err)\n        os.Exit(1)\n    }\n\n    dB := bufio.NewReader(file_dB)\n    dL := bufio.NewReader(file_dL)\n\n    err = nil\n    i := 1\n\n    for {\n        line1, _, err := dB.ReadLine()\n        if len(line1) &gt; 0 &amp;&amp; line1[len(line1)-1] == '\\n' {\n            line1 = line1[:len(line1)-1]\n        }\n        line2, _, err := dL.ReadLine()\n        if len(line2) &gt; 0 &amp;&amp; line2[len(line2)-1] == '\\n' {\n            line2 = line2[:len(line2)-1]\n        }\n        if len(line1) == 0 || len(line2) == 0 || err == io.EOF {\n            fmt.Println(\"Total lines done: \", i)\n            break\n        } else if err != nil {\n            fmt.Printf(\"Error while reading files: %v\\n\", err)\n            os.Exit(1)\n        }\n        i++\n        str := string(line1) + \";\" + string(line2) + \"\\n\"\n        if _, err := file_out.WriteString(str); err != nil {\n            panic(err)\n        }\n    }\n}\n</code></pre>\n\n<p>How can i use regexp to make this program read unprepeared files (first listing) value by value and form it like:</p>\n\n<pre><code>-0.129617;-0.118178\n-0.128609;-0.120080\n-0.127623;-0.121947\n...\n</code></pre>\n\n<p>Input files always formed in same way:\n-decimal separator is comma\n-one space after value (even if it last in a row)\n-newline in the end of line</p>\n\n<p>Previously used expression like <code>([-?])([0-9]{1})([,]{1})([0-9]{1,12})( {1})</code> and Notepad++ replace function to split line-of-values into one-value-per-line (combined to new vaules used expression like <code>$1$2.$4\\r\\n\\</code>), but its mess if 'scientific form' value happens.</p>\n\n<p>So is there any way to read files value by value without messing with splitting line into slices/substrings and working over them?</p>\n"}, {"tags": ["http", "go", "ip"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1521552436, "post_id": 49384786, "comment_id": 85771833, "body": "At best you can get the IP address of <i>a</i> server that processed the response, at some point along the way. That could be a proxy, a load balancer, a WAF, a reverse proxy... what are you actually trying to <i>accomplish</i> here? Why do you need the IP?"}, {"owner": {"reputation": 53, "user_id": 3344020, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XYG7k.png?s=128&g=1", "display_name": "InfamousLoop", "link": "https://stackoverflow.com/users/3344020/infamousloop"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521555631, "post_id": 49384786, "comment_id": 85774471, "body": "@Adrian This last server in the response chain is fine. Creating an archive using the WARC standard has a metadata field for IP address. While there are warc writers for Golang, none of them (currently) support processing a response into WARC format."}], "answers": [{"comments": [{"owner": {"reputation": 21338, "user_id": 145279, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/r9KgA.jpg?s=128&g=1", "display_name": "Will", "link": "https://stackoverflow.com/users/145279/will"}, "edited": false, "score": 0, "creation_date": 1537791136, "post_id": 49385411, "comment_id": 91899144, "body": "What would be a good way to persist this in the response object?"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 6, "last_activity_date": 1521556842, "last_edit_date": 1521556842, "creation_date": 1521552118, "answer_id": 49385411, "question_id": 49384786, "link": "https://stackoverflow.com/questions/49384786/how-to-capture-ip-address-of-server-providing-http-response/49385411#49385411", "title": "How to capture IP address of server providing HTTP response", "body": "<p>As far as I can tell, the only way to accomplish this with the standard library is with a custom <a href=\"https://golang.org/pkg/net/http/#Transport\" rel=\"nofollow noreferrer\">http.Transport</a> that records the remote IP address, for example in the <code>DialContext</code> function.</p>\n\n<pre><code>client := &amp;http.Client{\n    Transport: &amp;http.Transport{\n        DialContext: func(ctx context.Context, network, addr string) (net.Conn, error) {\n            conn, err := net.Dial(network, addr)\n            fmt.Printf(\"Remote IP: %s\\n\", conn.RemoteAddr())\n            return conn, err\n        },\n    },\n}\nresp, _ := client.Get(\"http://www.google.com\")\n</code></pre>\n\n<p>Tying the connection IP to the response is left as an exercise for the reader.</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 11168629, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TVvDAylQs1M/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfeUMTCse5K8eNYpWfdfosrUiYCmQ/mo/photo.jpg?sz=128", "display_name": "Shindou-L", "link": "https://stackoverflow.com/users/11168629/shindou-l"}, "is_accepted": false, "score": 1, "last_activity_date": 1552361665, "creation_date": 1552361665, "answer_id": 55113744, "question_id": 49384786, "link": "https://stackoverflow.com/questions/49384786/how-to-capture-ip-address-of-server-providing-http-response/55113744#55113744", "title": "How to capture IP address of server providing HTTP response", "body": "<p>you also can build a request with trace:</p>\n\n<pre><code>request = request.WithContext(httptrace.WithClientTrace(request.Context(), &amp;httptrace.ClientTrace{\n        GotConn: func(connInfo httptrace.GotConnInfo) {\n            fmt.Printf(\"target ip:%+v\\n\", connInfo.Conn.RemoteAddr().String())\n        },\n    }))\nresponse, _:= client.Do(request)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11774504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cf51ee3489d0af80d546811a1a75d5c?s=128&d=identicon&r=PG&f=1", "display_name": "eis", "link": "https://stackoverflow.com/users/11774504/eis"}, "is_accepted": false, "score": 0, "last_activity_date": 1563787212, "creation_date": 1563787212, "answer_id": 57142841, "question_id": 49384786, "link": "https://stackoverflow.com/questions/49384786/how-to-capture-ip-address-of-server-providing-http-response/57142841#57142841", "title": "How to capture IP address of server providing HTTP response", "body": "<p>httptrace form <a href=\"https://golang.org/pkg/net/http/httptrace/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httptrace/</a></p>\n\n<pre><code>req, err := http.NewRequest(method, url, strings.NewReader(body))\n    trace := &amp;httptrace.ClientTrace{\n        GotConn: func(connInfo httptrace.GotConnInfo) {\n            fmt.Printf(\"Got Conn: %+v\\n\", connInfo)\n        },\n        DNSDone: func(dnsInfo httptrace.DNSDoneInfo) {\n            fmt.Printf(\"DNS Info: %+v\\n\", dnsInfo)\n        },\n    }\nreq = req.WithContext(httptrace.WithClientTrace(req.Context(), trace))\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 3344020, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XYG7k.png?s=128&g=1", "display_name": "InfamousLoop", "link": "https://stackoverflow.com/users/3344020/infamousloop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1975, "favorite_count": 2, "accepted_answer_id": 49385411, "answer_count": 3, "score": 4, "last_activity_date": 1589906859, "creation_date": 1521550484, "last_edit_date": 1589906859, "question_id": 49384786, "link": "https://stackoverflow.com/questions/49384786/how-to-capture-ip-address-of-server-providing-http-response", "title": "How to capture IP address of server providing HTTP response", "body": "<p>Using Go's <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">default HTTP client</a>, I am unable to directly determine the IP address of the server that processed the request. For instance, when requesting <code>example.com</code>, what is the IP address that <code>example.com</code> resolved to at the time of the request?</p>\n\n<pre><code>import \"net/http\"\n\nresp, err := http.Get(\"http://example.com/\")\n</code></pre>\n\n<p>The <code>resp</code> object contains the <code>resp.RemoteAddr</code> property, but as detailed below it is not utilized during client operations. </p>\n\n<pre><code> // RemoteAddr allows HTTP servers and other software to record\n // the network address that sent the request, usually for\n // logging. This field is not filled in by ReadRequest and\n // has no defined format. The HTTP server in this package\n // sets RemoteAddr to an \"IP:port\" address before invoking a\n // handler.\n // This field is ignored by the HTTP client.\n RemoteAddr string\n</code></pre>\n\n<p>Is there a straightforward way to accomplish this? My initial thought would be to: </p>\n\n<ol>\n<li>Initiate a DNS lookup to remote domain</li>\n<li>Create new <code>http</code> transport using returned A/AAAA records</li>\n<li>Make the request</li>\n<li>Set the <code>RemoteAddr</code> property on the response object</li>\n</ol>\n\n<p>Is there a better way?</p>\n\n<hr>\n\n<p>UPDATED - to use @flimzy's suggestion. This method stores the remote IP:PORT into the <code>request.RemoteAddr</code> property. I've also added support for multiple redirects so that each subsequent request has its <code>RemoteAddr</code> populated. </p>\n\n<pre><code>request, _ := http.NewRequest(\"GET\", \"http://www.google.com\", nil)\nclient := &amp;http.Client{\n    Transport:&amp;http.Transport{\n        DialContext: func(ctx context.Context, network, addr string) (net.Conn, error) {\n            conn, err := net.Dial(network, addr)\n            request.RemoteAddr = conn.RemoteAddr().String()\n            return conn, err\n        },\n    },\n    CheckRedirect: func(req *http.Request, via []*http.Request) error {\n        request = req\n        return nil\n    },\n}\nresp, _ := client.Do(request)\n</code></pre>\n"}, {"tags": ["go", "ethernet", "tcp-ip", "plc"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1521551898, "post_id": 49384476, "comment_id": 85771349, "body": "Most probably Go is out of question here, and the H/W device is at fault. Verification of such cases is straightforward: you need to exclude the possibility Go is at fault by attempting the same connection by different means. I&#39;d try <code>telnet 192.168.137.10 502</code>. Here&#39;s <a href=\"https://www.google.com/search?q=windows+10+telnet\" rel=\"nofollow noreferrer\">how to do it</a>. If you will find out <code>telnet</code> works, and your Go program still does not, <i>that</i> would be an interesting situation, so then please come back with a refined question."}], "answers": [{"tags": [], "owner": {"reputation": 69, "user_id": 7266193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JbFmUJ4S6To/AAAAAAAAAAI/AAAAAAAAAFQ/agbpHHq_FSE/photo.jpg?sz=128", "display_name": "Stephan", "link": "https://stackoverflow.com/users/7266193/stephan"}, "is_accepted": false, "score": 1, "last_activity_date": 1521551498, "last_edit_date": 1521551498, "creation_date": 1521551162, "answer_id": 49385025, "question_id": 49384476, "link": "https://stackoverflow.com/questions/49384476/connectex-error-connecting-to-a-physical-device/49385025#49385025", "title": "Connectex: Error connecting to a physical device", "body": "<p>I suspect that there is a problem with the server and not your client code. The fact that you aren't just getting a \"connection refused\" error tells me that the remote port is probably open. Chances are that the server is not performing an accept() on the incoming connection within a reasonable time.</p>\n\n<p>Things that might cause this</p>\n\n<ul>\n<li>Maximum number of connection configured on the server has been exceeded or the service is too busy.</li>\n<li>Server has crashed</li>\n<li>Funny firewall or another routing issue between you and the server. Some deep packet inspection firewalls sometimes cause these types of issues.</li>\n</ul>\n\n<p>I suggest you try and do troubleshooting on the server side.</p>\n"}], "owner": {"reputation": 834, "user_id": 4596814, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q7evG.jpg?s=128&g=1", "display_name": "Bhavana", "link": "https://stackoverflow.com/users/4596814/bhavana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 980, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1521551498, "creation_date": 1521549560, "last_edit_date": 1521550359, "question_id": 49384476, "link": "https://stackoverflow.com/questions/49384476/connectex-error-connecting-to-a-physical-device", "title": "Connectex: Error connecting to a physical device", "body": "<p>I am trying to communicate with a device (connected using ethernet) using TCP/IP connection. When a connection request is sent, I am getting an error:  </p>\n\n<pre><code>dial tcp 192.168.137.10:502: connectex: A connection attempt failed because\nthe connected party did not properly respond after a period of time,\nor established connection failed because connected host has failed to respond\n</code></pre>\n\n<p>But if I am connecting to the simulator (which will act as device), it is getting connected and sending me response.</p>\n\n<p>I am using <code>GO</code> for coding. This is my code to connect to device</p>\n\n<pre><code>conn, err := net.Dial(\"tcp\", \"192.168.137.10:502\")\nif err != nil {\n  return nil, err\n} else {\n  return conn, nil\n}\n</code></pre>\n\n<p>Hardware Info:</p>\n\n<ul>\n<li>Windows 10, 64 bit machine</li>\n<li>PLC device connected over TCP/IP</li>\n</ul>\n"}, {"tags": ["url", "go"], "comments": [{"owner": {"reputation": 429, "user_id": 5461428, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gxTkNRr0Lck/AAAAAAAAAAI/AAAAAAAAAcY/uZ1rNKFav_s/photo.jpg?sz=128", "display_name": "Rahul Kamboj", "link": "https://stackoverflow.com/users/5461428/rahul-kamboj"}, "edited": false, "score": 0, "creation_date": 1521539017, "post_id": 49380683, "comment_id": 85762253, "body": "please paste the snippet where you are using it ?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1521539110, "post_id": 49380683, "comment_id": 85762337, "body": "This seems to be a problem with a Printf statement. Run go vet."}, {"owner": {"reputation": 524, "user_id": 6071433, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-isPKF1YmAT4/AAAAAAAAAAI/AAAAAAAAADQ/Ibdd48zl1fE/photo.jpg?sz=128", "display_name": "Reiah Paul Sam", "link": "https://stackoverflow.com/users/6071433/reiah-paul-sam"}, "reply_to_user": {"reputation": 429, "user_id": 5461428, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gxTkNRr0Lck/AAAAAAAAAAI/AAAAAAAAAcY/uZ1rNKFav_s/photo.jpg?sz=128", "display_name": "Rahul Kamboj", "link": "https://stackoverflow.com/users/5461428/rahul-kamboj"}, "edited": false, "score": 0, "creation_date": 1521539234, "post_id": 49380683, "comment_id": 85762419, "body": "@RahulKamboj , please check the updated question"}, {"owner": {"reputation": 524, "user_id": 6071433, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-isPKF1YmAT4/AAAAAAAAAAI/AAAAAAAAADQ/Ibdd48zl1fE/photo.jpg?sz=128", "display_name": "Reiah Paul Sam", "link": "https://stackoverflow.com/users/6071433/reiah-paul-sam"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521539258, "post_id": 49380683, "comment_id": 85762430, "body": "@Peter , I too have a doubt wit Fprintf"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1521539937, "post_id": 49380683, "comment_id": 85762912, "body": "Just do not use Fprint<b>f</b>. What do you expect Fprint<b>f</b> to do? Or use Fprintf(rs, &quot;%s&quot;, whatever&quot;) if you cannot tolerate the newline from Fprintln."}, {"owner": {"reputation": 524, "user_id": 6071433, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-isPKF1YmAT4/AAAAAAAAAAI/AAAAAAAAADQ/Ibdd48zl1fE/photo.jpg?sz=128", "display_name": "Reiah Paul Sam", "link": "https://stackoverflow.com/users/6071433/reiah-paul-sam"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1521540905, "post_id": 49380683, "comment_id": 85763612, "body": "@Volker, Thank you for your suggestion , Fprintf(rs, &quot;%s&quot;, whatever&quot;) Works fine"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 2, "creation_date": 1521541030, "post_id": 49380683, "comment_id": 85763690, "body": "<code>Fprintf(rs, &quot;%s&quot;, whatever&quot;)</code> is slower than <code>Fprint(rs, whatever)</code>. It has to parse the format first, do some string calculations and then it can finally write it to the writer."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1521575558, "post_id": 49380683, "comment_id": 85787577, "body": "Go has protected your application from being exploited by malicious input. This is why MISSING appears there. Always use a format string with <code>fmt.Fprintf()</code>, or if you don&#39;t really need to format anything, use <code>fmt.Fprint()</code> instead."}], "answers": [{"comments": [{"owner": {"reputation": 524, "user_id": 6071433, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-isPKF1YmAT4/AAAAAAAAAAI/AAAAAAAAADQ/Ibdd48zl1fE/photo.jpg?sz=128", "display_name": "Reiah Paul Sam", "link": "https://stackoverflow.com/users/6071433/reiah-paul-sam"}, "edited": false, "score": 1, "creation_date": 1521540854, "post_id": 49381371, "comment_id": 85763580, "body": "@tehspinx, Thank you for the answer and i replaced the the Fprintf function to accept one more argument %s"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 5, "last_activity_date": 1521540590, "creation_date": 1521540590, "answer_id": 49381371, "question_id": 49380683, "link": "https://stackoverflow.com/questions/49380683/printing-urls-with-fmt-printf-behaves-weirdly/49381371#49381371", "title": "Printing URLs with fmt.Printf behaves weirdly", "body": "<p>As also mentioned in the comments: your problem is that Fprintf uses second parameter as a format interpreting every % as an indicator it should insert a variable there. In your string there is a % sign but you are not providing any arguments to insert. So it writings <code>MISSING</code>.</p>\n\n<p>Since you do not want to format anything (it seems) just use this instead:</p>\n\n<pre><code>cnt, err := fmt.Fprint(rs, jsonStr)\n</code></pre>\n"}], "owner": {"reputation": 524, "user_id": 6071433, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-isPKF1YmAT4/AAAAAAAAAAI/AAAAAAAAADQ/Ibdd48zl1fE/photo.jpg?sz=128", "display_name": "Reiah Paul Sam", "link": "https://stackoverflow.com/users/6071433/reiah-paul-sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1521544235, "creation_date": 1521538613, "last_edit_date": 1521544235, "question_id": 49380683, "link": "https://stackoverflow.com/questions/49380683/printing-urls-with-fmt-printf-behaves-weirdly", "title": "Printing URLs with fmt.Printf behaves weirdly", "body": "<p>If i save the url in the database as </p>\n\n<p><a href=\"https://xxx.amazonaws.com/sub%2Fsub1/1495771021869-3sx5ims88vu-12f63aaa7d278435e1800486b31f9cc7/xxx.jpg\" rel=\"nofollow noreferrer\">https://xxx.amazonaws.com/sub%2Fsub1/1495771021869-3sx5ims88vu-12f63aaa7d278435e1800486b31f9cc7/xxx.jpg</a></p>\n\n<p>the http.ResponseWriter returns in the following format</p>\n\n<p><a href=\"https://xxx.amazonaws.com/sub!F(MISSING)sub1/1495771021869-3sx5ims88vu-12f63aaa7d278435e1800486b31f9cc7/xxx.jpg\" rel=\"nofollow noreferrer\">https://xxx.amazonaws.com/sub!F(MISSING)sub1/1495771021869-3sx5ims88vu-12f63aaa7d278435e1800486b31f9cc7/xxx.jpg</a></p>\n\n<p>in the above url you can see %2F is replaced with !F(MISSING)</p>\n\n<p>can some one help to resolve this</p>\n\n<p>the following is the code snippet\n``  rs.WriteHeader(retObj.HttpStatus)</p>\n\n<pre><code>jsonStr, res := ConvObjectToJSON(retObj)\nif res != nil {\n    Logger(ctx, cnst.LogError, \"In writeReturnError error in ConvObjectToJSON: %v Original object:%v\",\n        res.GetMessageWDetails(), retObj)\n    rs.WriteHeader(http.StatusInternalServerError)\n    return\n}\n\nvar consoleLog *log.Logger = log.New(os.Stdout, cnst.LogPrefix, log.Ldate|log.Ltime)\nconsoleLog.Print(jsonStr)\n\ncnt, err := fmt.Fprintf(rs, jsonStr)\nif nil == err &amp;&amp; 0 &lt; cnt {\n    rs.Header().Set(\"Content-Type\", \"application/json\")\n} else {\n    Logger(ctx, cnst.LogError, \"In writeReturnError error in fmt.Fprintf: %v Original JSON:%v\",\n        err.Error(), jsonStr)\n    rs.WriteHeader(http.StatusInternalServerError)\n}\n</code></pre>\n\n<p>``</p>\n\n<p>I have a doubt with fmt.Fprintf</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1521535464, "last_edit_date": 1521535464, "creation_date": 1521535124, "answer_id": 49379580, "question_id": 49379424, "link": "https://stackoverflow.com/questions/49379424/select-prints-output-from-only-one-channel/49379580#49379580", "title": "Select prints output from only one channel", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">Select statements</a></p>\n  \n  <p>A \"select\" statement chooses which of a set of possible send or\n  receive operations will proceed.</p>\n</blockquote>\n\n<p>Select chooses one of a set. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc square(dat int, ch chan&lt;- int) {\n\n    ch &lt;- dat * dat\n\n}\n\nfunc main() {\n\n    resp1 := make(chan int)\n    resp2 := make(chan int)\n\n    go square(20, resp1)\n    go square(10, resp2)\n\n    // Choose one\n    select {\n    case msg1 := &lt;-resp1:\n        fmt.Println(msg1)\n    case msg2 := &lt;-resp2:\n        fmt.Println(msg2)\n    }\n    // Choose the other\n    select {\n    case msg1 := &lt;-resp1:\n        fmt.Println(msg1)\n    case msg2 := &lt;-resp2:\n        fmt.Println(msg2)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/TiThqcXDa6o\" rel=\"nofollow noreferrer\">https://play.golang.org/p/TiThqcXDa6o</a></p>\n\n<p>Output:</p>\n\n<pre><code>100\n400\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1521536827, "post_id": 49379681, "comment_id": 85760734, "body": "@peterSO  Maybe?  It&#39;s quite possible that you&#39;re correctly guessing the asker&#39;s intentions.  The question certainly doesn&#39;t mention anything about that, however.  The question as posed seems to be &quot;Why does <code>select</code> only choose one case?&quot; and the answer is &quot;That&#39;s what <code>select</code> is for.&quot;"}], "tags": [], "owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "is_accepted": false, "score": 2, "last_activity_date": 1521538130, "last_edit_date": 1592644375, "creation_date": 1521535572, "answer_id": 49379681, "question_id": 49379424, "link": "https://stackoverflow.com/questions/49379424/select-prints-output-from-only-one-channel/49379681#49379681", "title": "Select prints output from only one channel", "body": "<p>You want <code>select</code> to select both?  That's kind of the opposite of what it's for.  From the <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">Go Spec</a>:</p>\n<blockquote>\n<p>A &quot;select&quot; statement chooses which of a set of possible send or receive operations will proceed.</p>\n<p>If one or more of the communications can proceed, a single one that can proceed is chosen via a uniform pseudo-random selection.</p>\n</blockquote>\n<p>If you want to read from both channels, rather than having <code>select</code> figure out which one is ready to be read from (or select one pseudo-randomly if both can be read from), don't use <code>select</code>.  Just read from both:</p>\n<pre><code>msg1 := &lt;-resp1:\nfmt.Println(msg1)\nmsg2 := &lt;-resp2:\nfmt.Println(msg2)\n</code></pre>\n<p><strong>Update</strong></p>\n<p>If, as @peterSO suggests, your goal is to read from both channels, starting with whichever is ready first, I'd think something like this would be a reasonable approach:</p>\n<pre><code>func main() {\n    resp1 := make(chan int)\n    resp2 := make(chan int)\n\n    readsWanted := 0\n\n    readsWanted += 1\n    go square(20, resp1)\n    readsWanted += 1\n    go square(10, resp2)\n\n    for i := 0; i &lt; readsWanted; i++ {\n        select {\n        case msg1 := &lt;-resp1:\n            fmt.Println(msg1)\n        case msg2 := &lt;-resp2:\n            fmt.Println(msg2)\n        }\n    }\n}\n</code></pre>\n<p>You could of course hard-code the loop to only run twice, but I have an aversion to such things, although in this simple example it doesn't much matter.</p>\n"}, {"tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": false, "score": 0, "last_activity_date": 1566286451, "last_edit_date": 1566286451, "creation_date": 1521549791, "answer_id": 49384553, "question_id": 49379424, "link": "https://stackoverflow.com/questions/49379424/select-prints-output-from-only-one-channel/49384553#49384553", "title": "Select prints output from only one channel", "body": "<p>As per your code in the select whenever any case matches will execute and main function will terminate .That is why it is only printing the single channel value. \nYou can fix this by doing something like this : </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc square(dat int, ch chan&lt;- int) {\n    ch &lt;- dat * dat\n}\n\nfunc main() {\n    resp1 := make(chan int)\n    resp2 := make(chan int)\n\n    go square(20, resp1)\n    go square(10, resp2)\n    time.Sleep(1 * time.Second)\n    for {\n        select {\n        case msg1 := &lt;-resp1:\n            fmt.Println(msg1)\n        case msg2 := &lt;-resp2:\n            fmt.Println(msg2)\n        default:\n            close(resp1)\n            close(resp2)\n            fmt.Println(\"no value recieved\")\n            os.Exit(0)\n        }\n    }\n}\n</code></pre>\n\n<p>Output </p>\n\n<pre><code>100\n400\nno value recieved\n</code></pre>\n\n<p>See in playground: <a href=\"https://play.golang.org/p/T9mkfrO4wNF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/T9mkfrO4wNF</a></p>\n"}, {"tags": [], "owner": {"reputation": 836, "user_id": 197637, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a865c4dbd18c5da18c5ca1ee8acfd830?s=128&d=identicon&r=PG", "display_name": "gurbieta", "link": "https://stackoverflow.com/users/197637/gurbieta"}, "is_accepted": false, "score": 0, "last_activity_date": 1523481148, "creation_date": 1523481148, "answer_id": 49784550, "question_id": 49379424, "link": "https://stackoverflow.com/questions/49379424/select-prints-output-from-only-one-channel/49784550#49784550", "title": "Select prints output from only one channel", "body": "<p>Selects works more like a switch in another languages (ex: Java), you need to execute that part N times as you need.</p>\n"}], "owner": {"reputation": 4228, "user_id": 1949081, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/139dd61fd2d256bbdacc282c30c48713?s=128&d=identicon&r=PG&f=1", "display_name": "slysid", "link": "https://stackoverflow.com/users/1949081/slysid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 1, "accepted_answer_id": 49379580, "answer_count": 4, "score": -1, "last_activity_date": 1566286451, "creation_date": 1521534488, "last_edit_date": 1521535152, "question_id": 49379424, "link": "https://stackoverflow.com/questions/49379424/select-prints-output-from-only-one-channel", "title": "Select prints output from only one channel", "body": "<p>I am learning Go and I am on channels now. I have written a simple program using channels. I have created two channels and the channels are passed to a function which is called concurrently. </p>\n\n<p>My expectation is to print output form both the channels but in reality only one channel output is getting printed:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc square(dat int, ch chan&lt;- int) {\n\n    ch &lt;- dat * dat\n\n}\n\nfunc main() {\n\n    resp1 := make(chan int)\n    resp2 := make(chan int)\n\n    go square(20, resp1)\n    go square(10, resp2)\n\n    select {\n    case msg1 := &lt;-resp1:\n        fmt.Println(msg1)\n    case msg2 := &lt;-resp2:\n        fmt.Println(msg2)\n    }\n}\n</code></pre>\n\n<p>Either the message from <code>resp1</code> is printed or that from <code>resp2</code> during each execution. Channels should block until something is pushed into it, right?</p>\n"}, {"tags": ["android", "go"], "comments": [{"owner": {"reputation": 346, "user_id": 9490568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ljyk.jpg?s=128&g=1", "display_name": "bharath", "link": "https://stackoverflow.com/users/9490568/bharath"}, "edited": false, "score": 0, "creation_date": 1521523482, "post_id": 49376752, "comment_id": 85754445, "body": "Is your <code>bind</code> package within your <code>GOPATH</code>? And you should install the <code>bind</code> package to generate an executable file using <code>go install</code> and the location of this executable file will be basically at <code>$GOPATH&#47;bin&#47;</code>. Use that executable and can you try again?"}, {"owner": {"reputation": 553, "user_id": 2234704, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/a50b471f678cde58090dc3b9c7da020f?s=128&d=identicon&r=PG", "display_name": "Vierda Mila Nartila", "link": "https://stackoverflow.com/users/2234704/vierda-mila-nartila"}, "reply_to_user": {"reputation": 346, "user_id": 9490568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ljyk.jpg?s=128&g=1", "display_name": "bharath", "link": "https://stackoverflow.com/users/9490568/bharath"}, "edited": false, "score": 0, "creation_date": 1521524368, "post_id": 49376752, "comment_id": 85754723, "body": "Hi Bharath, thanks for your reply but sorry I don&#39;t understand what bind package that are you talking about? is it this package : /Users/vierdamila1/Desktop/go-workspace/src/golang.org/x/mob&zwnj;&#8203;ile/bind"}, {"owner": {"reputation": 553, "user_id": 2234704, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/a50b471f678cde58090dc3b9c7da020f?s=128&d=identicon&r=PG", "display_name": "Vierda Mila Nartila", "link": "https://stackoverflow.com/users/2234704/vierda-mila-nartila"}, "reply_to_user": {"reputation": 346, "user_id": 9490568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ljyk.jpg?s=128&g=1", "display_name": "bharath", "link": "https://stackoverflow.com/users/9490568/bharath"}, "edited": false, "score": 0, "creation_date": 1521524939, "post_id": 49376752, "comment_id": 85754919, "body": "or this package : /Users/vierdamila1/Desktop/go-workspace/src/golang.org/x/mob&zwnj;&#8203;ile/example/bind"}, {"owner": {"reputation": 346, "user_id": 9490568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ljyk.jpg?s=128&g=1", "display_name": "bharath", "link": "https://stackoverflow.com/users/9490568/bharath"}, "edited": false, "score": 0, "creation_date": 1521526321, "post_id": 49376752, "comment_id": 85755428, "body": "Refer to <a href=\"https://godoc.org/golang.org/x/mobile/cmd/gobind\" rel=\"nofollow noreferrer\">this link</a> for actual pakage and <a href=\"https://godoc.org/golang.org/x/mobile/cmd/gomobile\" rel=\"nofollow noreferrer\">this link</a> for installation of <code>go mobile</code>. You&#39;ve to perform all those instructions from within your <code>$GOPATH</code>."}], "answers": [{"tags": [], "owner": {"reputation": 553, "user_id": 2234704, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/a50b471f678cde58090dc3b9c7da020f?s=128&d=identicon&r=PG", "display_name": "Vierda Mila Nartila", "link": "https://stackoverflow.com/users/2234704/vierda-mila-nartila"}, "is_accepted": false, "score": 2, "last_activity_date": 1521597628, "last_edit_date": 1521597628, "creation_date": 1521561199, "answer_id": 49388724, "question_id": 49376752, "link": "https://stackoverflow.com/questions/49376752/cannot-find-gobind-executable-file/49388724#49388724", "title": "Cannot find gobind executable file", "body": "<p>I think I found the solution, I put here for someone who might need the answer.\nActually the error is showing up because I haven't install gobind. So before you do gomobile bind, don't forget to install gobind by run below command :</p>\n\n<blockquote>\n  <p>go install golang.org/x/mobile/cmd/gobind</p>\n</blockquote>\n\n<p>after that call the bind command :</p>\n\n<blockquote>\n  <p>gomobile bind -target=android golang.org/x/mobile/example/bind/hello</p>\n</blockquote>\n\n<p>The bind command will generate hello.aar file and you can put it inside your Android project libs folder.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12050961, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mA_RICGRBJJ4v6zylGhfprH2VBAtR_jBcYIOSR8LQ=k-s128", "display_name": "feeecatz", "link": "https://stackoverflow.com/users/12050961/feeecatz"}, "is_accepted": false, "score": 0, "last_activity_date": 1568180213, "last_edit_date": 1592644375, "creation_date": 1568175998, "answer_id": 57882149, "question_id": 49376752, "link": "https://stackoverflow.com/questions/49376752/cannot-find-gobind-executable-file/57882149#57882149", "title": "Cannot find gobind executable file", "body": "<ol>\n<li><p>gobind package install</p>\n<p><code>$ go get golang.org/x/mobile/cmd/gobind</code></p>\n</li>\n<li><p>init</p>\n<p><code>$ gomobile init</code></p>\n</li>\n<li><p>build</p>\n<p><code>$ gomobile &lt;build or bind&gt; ...</code></p>\n</li>\n</ol>\n"}], "owner": {"reputation": 553, "user_id": 2234704, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/a50b471f678cde58090dc3b9c7da020f?s=128&d=identicon&r=PG", "display_name": "Vierda Mila Nartila", "link": "https://stackoverflow.com/users/2234704/vierda-mila-nartila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 964, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1568180213, "creation_date": 1521522788, "last_edit_date": 1521537657, "question_id": 49376752, "link": "https://stackoverflow.com/questions/49376752/cannot-find-gobind-executable-file", "title": "Cannot find gobind executable file", "body": "<p>I'm trying to produce aar file by run command gomobile bind as per below :</p>\n\n<blockquote>\n  <p>gomobile bind -target=android golang.org/x/mobile/example/bind/hello</p>\n</blockquote>\n\n<p>But always, getting error like below :</p>\n\n<blockquote>\n  <p>gomobile: gobind -lang=go,java -outdir=/var/folders/s_/yzvdrlg522z237w58tjn2rm00000gp/T/gomobile-work-931510225 golang.org/x/mobile/example/bind/hello failed: exec: \"gobind\": executable file not found in $PATH</p>\n</blockquote>\n\n<p>I already tried to specified path inside class <code>GobindExtension</code> in <code>GobindPlugin.groovy</code> as per below:</p>\n\n<pre><code>class GobindExtension {\n    // Package to bind. Separate multiple packages with spaces. (required)\n    def String pkg = \"golang.org/x/mobile/example/bind/hello\"\n\n    // GOPATH: necessary for gomobile tool. (required)\n    def String GOPATH = System.getenv(\"GOPATH\")\n\n    // GO: path to go tool. (can omit if 'go' is in the paths visible by Android Studio)\n    def String GO = \"/usr/local/opt/go/libexec/bin\"\n\n    // GOMOBILE: path to gomobile binary. (can omit if 'gomobile' is under GOPATH)\n    def String GOMOBILE = \"/Users/vierdamila1/Desktop/go-workspace/bin/gomobile\"\n}\n</code></pre>\n\n<p>And this is my GOPATH :</p>\n\n<blockquote>\n  <p>export GOPATH=\"/Users/vierdamila1/Desktop/go-workspace\"</p>\n</blockquote>\n\n<p>But still not working. Did I missed something here? Really appreciate for any kind help. </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 8, "last_activity_date": 1521523302, "last_edit_date": 1521523302, "creation_date": 1521519952, "answer_id": 49376345, "question_id": 49376191, "link": "https://stackoverflow.com/questions/49376191/better-to-compare-slices-or-bytes/49376345#49376345", "title": "Better to compare slices or bytes?", "body": "<p>In Go, <code>string</code>s are UTF-8 encoded. UTF-8 is a variable-length encoding.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    word := \"\u4e16\u754c\u4e16\"\n    fmt.Println(word[:1] == word[len(word)-1:])\n    fmt.Println(word[0] == word[len(word)-1])\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>false\nfalse\n</code></pre>\n\n<hr>\n\n<p>If you really want to compare a byte, not a character, then be as precise as possible for the compiler. Obviously, compare a byte, not a slice. </p>\n\n<pre><code>BenchmarkSlice-4    200000000            7.55 ns/op\nBenchmarkByte-4     2000000000           1.08 ns/op\n\npackage main\n\nimport \"testing\"\n\nvar word = \"word\"\n\nfunc BenchmarkSlice(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        if word[:1] == word[len(word)-1:] {\n        }\n    }\n}\n\nfunc BenchmarkByte(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        if word[0] == word[len(word)-1] {\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1521527517, "post_id": 49376817, "comment_id": 85755912, "body": "@peterSO Thanks. The decode functions return the unicode replacement char for invalid utf-8. Answer updated."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1521559176, "last_edit_date": 1521559176, "creation_date": 1521523233, "answer_id": 49376817, "question_id": 49376191, "link": "https://stackoverflow.com/questions/49376191/better-to-compare-slices-or-bytes/49376817#49376817", "title": "Better to compare slices or bytes?", "body": "<p>If by letter you mean <a href=\"https://golang.org/ref/spec#Rune_literals\" rel=\"nofollow noreferrer\">rune</a>, then use:</p>\n\n<pre><code>func eqRune(s string) bool {\n    if s == \"\" {\n        return false // or true if that makes more sense for the app\n    }\n    f, _ := utf8.DecodeRuneInString(s)  // 2nd return value is rune size. ignore it.\n    l, _ := utf8.DecodeLastRuneInString(s) // 2nd return value is rune size. ignore it.\n    if f != l {\n        return false\n    }\n    if f == unicode.ReplacementChar {\n        // First and last are invalid UTF-8. Fallback to \n        // comparing bytes.\n        return s[0] == s[len(s)-1]\n    }\n    return true\n}\n</code></pre>\n\n<p>If you mean byte, then use:</p>\n\n<pre><code>func eqByte(s string) bool {\n    if s == \"\" {\n        return false // or true if that makes more sense for the app\n    }\n    return s[0] == s[len(s)-1]\n}\n</code></pre>\n\n<p>Comparing individual bytes is faster than comparing string slices as shown by the benchmark in another answer.</p>\n\n<p><a href=\"https://play.golang.org/p/phizJQhd92g\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}, {"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 0, "last_activity_date": 1521528225, "creation_date": 1521528225, "answer_id": 49377799, "question_id": 49376191, "link": "https://stackoverflow.com/questions/49376191/better-to-compare-slices-or-bytes/49377799#49377799", "title": "Better to compare slices or bytes?", "body": "<p>A string is a sequence of bytes.  Your method works if you know the string contains only ASCII characters.  Otherwise, you should use a method that handles multibyte characters instead of string indexing.  You can convert it to a rune slice to process code points or characters, like this:</p>\n\n<pre><code>    r := []rune(s)\n    return r[0] == r[len(r) - 1]\n</code></pre>\n\n<p>You can read more about strings, byte slices, runes, and code points in <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">the official Go Blog post on the subject</a>.</p>\n\n<p>To answer your question, there's no significant performance difference between the two index expressions you posted.</p>\n\n<p>Here's a runnable example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc EndsMatch(s string) bool {\n    r := []rune(s)\n    return r[0] == r[len(r) - 1]\n}\n\nfunc main() {\n    tests := []struct{\n        s   string\n        e   bool\n    }{\n        {\"foo\", false},\n        {\"eve\", true},\n        {\"\u4e16\u754c\u4e16\", true},\n    }\n    for _, t := range tests {\n        r := EndsMatch(t.s)\n        if r != t.e {\n            fmt.Printf(\"EndsMatch(%s) failed: expected %t, got %t\\n\", t.s, t.e, r)\n        }\n    }\n}\n</code></pre>\n\n<p>Prints nothing.</p>\n"}], "owner": {"reputation": 768, "user_id": 2702755, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/5e75badabc8b868ba69ece0babec4c8a?s=128&d=identicon&r=PG&f=1", "display_name": "drew kroft", "link": "https://stackoverflow.com/users/2702755/drew-kroft"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1086, "favorite_count": 2, "accepted_answer_id": 49376817, "answer_count": 3, "score": 0, "last_activity_date": 1521559176, "creation_date": 1521518866, "last_edit_date": 1521532511, "question_id": 49376191, "link": "https://stackoverflow.com/questions/49376191/better-to-compare-slices-or-bytes", "title": "Better to compare slices or bytes?", "body": "<p>I'm just curious on which of these methods is better (or if there's an even better one that I'm missing).  I'm trying to determine if the first letter and last letter of a word are the same, and there are two obvious solutions to me.</p>\n\n<pre><code>if word[:1] == word[len(word)-1:]\n</code></pre>\n\n<p>or</p>\n\n<pre><code>if word[0] == word[len(word)-1]\n</code></pre>\n\n<p>As I understand it, the first is just pulling slices of the string and doing a string comparison, while the second is pulling the character from either end and comparing as bytes.</p>\n\n<p>I'm curious if there's a performance difference between the two, and if there's any \"preferable\" way to do this?</p>\n"}, {"tags": ["go", "jwt"], "comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1521531576, "post_id": 49375894, "comment_id": 85757945, "body": "You haven&#39;t posted the full code here, but I&#39;m guessing you can try to check the claims earlier     <code>if claims, ok := token.Claims.(jwt.MapClaims); ok &amp;&amp; token.Valid {     fmt.Println(claims[&quot;foo&quot;]) } else {     fmt.Println(err) }</code>"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "is_accepted": false, "score": 1, "last_activity_date": 1521533533, "creation_date": 1521533533, "answer_id": 49379188, "question_id": 49375894, "link": "https://stackoverflow.com/questions/49375894/parsing-json-web-token-claims-in-go/49379188#49379188", "title": "Parsing JSON Web Token Claims in Go", "body": "<p>Define a type that describes the claims and that includes the <code>jwt.StandardClaims</code>:</p>\n\n<pre><code>type myClaims struct {\n    Foo    string   `json:\"foo\"`\n    jwt.StandardClaims\n}\n</code></pre>\n\n<p>If you have a JWT with this <code>data</code></p>\n\n<pre><code>{\n  \"foo\": \"bar\"\n}\n</code></pre>\n\n<p>you can access the claims like this:</p>\n\n<pre><code>parsedToken, err := jwt.Parse(signed, keyfunc)\nif err != nil {\n    fmt.Println(\"token is invalid: \", err)\n} else {\n    claims := parsedToken.Claims.(jwt.MapClaims)\n    fmt.Println(claims[\"foo\"])\n}\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 6121611, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/fbfec86ebeacb4976719f8f29d9eb537?s=128&d=identicon&r=PG&f=1", "display_name": "FyZyX", "link": "https://stackoverflow.com/users/6121611/fyzyx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3895, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1521533533, "creation_date": 1521516375, "question_id": 49375894, "link": "https://stackoverflow.com/questions/49375894/parsing-json-web-token-claims-in-go", "title": "Parsing JSON Web Token Claims in Go", "body": "<p>I am trying to do some authentication with JSON Web Tokens and I've managed to generate the token with the correct claims, but I'm having trouble parsing the claims my subsequent requests.</p>\n\n<p>My token looks something like this</p>\n\n<pre><code>{\n    \"Raw\": \"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"Method\": {\n        \"Name\": \"RS256\",\n        \"Hash\": 5\n    },\n    \"Header\": {\n        \"alg\": \"RS256\",\n        \"typ\": \"JWT\"\n    },\n    \"Claims\": {\n        \"foo\": \"bar\"\n    },\n    \"Signature\": \"\",\n    \"Valid\": false\n}\n</code></pre>\n\n<p>and my goal is to parse the <code>foo</code> value from the claims. I'm using <a href=\"https://github.com/dgrijalva/jwt-go\" rel=\"nofollow noreferrer\">this</a> package for working with web tokens.</p>\n\n<p>I'm able to successfully extract the token from the <code>Authorization</code> header, but when I try this</p>\n\n<pre><code>token, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {\n    return apiKeyPair.PublicKey, nil\n})\n\nif claims, ok := token.Claims.(jwt.MapClaims); ok &amp;&amp; token.Valid {\n    return claims, nil\n} else {\n    return nil, err\n}\n</code></pre>\n\n<p>I'm not getting an error here, but when I try to access <code>foo</code> from the claims like this</p>\n\n<pre><code>claims, err := GetWebTokenClaims(r)\nif err != nil {\n    return\n}\n\nfoo := claims[\"foo\"]\n</code></pre>\n\n<p>I get <code>nil</code>. I've tried a number of little tweaks to this structure\u2013like using <a href=\"https://github.com/dgrijalva/jwt-go/blob/master/example_test.go#L56\" rel=\"nofollow noreferrer\">custom claims</a> with the <code>ParseWithClaims()</code> method\u2013but for the life of me I can't get this simple thing working.</p>\n\n<p>Not sure where to go from here or what other info might be relevant, any help is appreciated!</p>\n"}, {"tags": ["go", "bleve"], "answers": [{"comments": [{"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "edited": false, "score": 0, "creation_date": 1521543734, "post_id": 49379257, "comment_id": 85765652, "body": "I actually did that but doesn&#39;t seem to work. I&#39;ve updated the question with the test case."}], "tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": false, "score": 0, "last_activity_date": 1521533810, "creation_date": 1521533810, "answer_id": 49379257, "question_id": 49375711, "link": "https://stackoverflow.com/questions/49375711/how-to-escape-query-params/49379257#49379257", "title": "How to escape query params?", "body": "<p>You just put a backslash before the special characters. You find a list of all special characters in the docs (at the bottom under escaping): <a href=\"http://www.blevesearch.com/docs/Query-String-Query/\" rel=\"nofollow noreferrer\">http://www.blevesearch.com/docs/Query-String-Query/</a></p>\n"}], "owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1089, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521543763, "creation_date": 1521514907, "last_edit_date": 1521543763, "question_id": 49375711, "link": "https://stackoverflow.com/questions/49375711/how-to-escape-query-params", "title": "How to escape query params?", "body": "<p>I'm using <a href=\"https://github.com/blevesearch/bleve\" rel=\"nofollow noreferrer\">bleve</a> (with a http server in front) to index and <a href=\"https://godoc.org/github.com/blevesearch/bleve/search/query#NewQueryStringQuery\" rel=\"nofollow noreferrer\">query</a> documents. </p>\n\n<p>I need to execute a query as below which should query documents matching <code>channelID</code> value. How can escape query fields(in this case the value of <code>channelID</code>) in the query syntax? </p>\n\n<pre><code> query.NewQueryStringQuery(\"channelID:http://example.com?some-params-with$-+badChars\"). \n</code></pre>\n\n<p>I can't just urlencode it because if I do it won't match the field from the documented indexed(which has the value unencoded).</p>\n\n<p><strong>Update(testcase)</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/blevesearch/bleve\"\n    //\"github.com/blevesearch/bleve/search\"\n    \"github.com/blevesearch/bleve/search/query\"\n\n    \"bytes\"\n    \"flag\"\n    log \"github.com/golang/glog\"\n)\n\ntype Data struct {\n    ID      string\n    Message string\n    URI     string\n}\n\nfunc main() {\n    flag.Parse()\n    defer log.Flush()\n\n    mapping := bleve.NewIndexMapping()\n    index, err := bleve.New(\"example.bleve\", mapping)\n    if err != nil {\n        panic(err)\n    }\n    d := Data{\n        ID:      \"someID\",\n        Message: \"Hello\",\n        URI:     `https://www.google.co.uk/search?q=google+search&amp;oq={}///\\}ie=UTF-8`,\n    }\n    if err := index.Index(d.ID, d); err != nil {\n        panic(err)\n    }\n\n    //index, _ := bleve.Open(\"example.bleve\")\n    query := query.NewQueryStringQuery(\"URI:\" + Escape(d.URI))\n    searchRequest := bleve.NewSearchRequest(query)\n    result, _ := index.Search(searchRequest)\n    log.Errorf(\"total hits %v\", result.Total)\n}\n\nfunc Escape(s string) string {\n    ra := []string{\"+\", \"-\", \"=\",\n        \"&amp;\", \"|\", \"&gt;\",\n        \"&lt;\", \"!\", \"(\", \")\", \"{\",\n        \"}\", \"[\", \"]\", \"^\",\n        `~`, `*`, `?`, `:`, `\\\\`, `/`, `\\`, ` `}\n    exists := func(v string) bool {\n        for _, s := range ra {\n            if v == s {\n                return true\n            }\n        }\n        return false\n    }\n    buf := bytes.NewBuffer(nil)\n    var prevBack bool\n    for _, v := range s {\n        if prevBack || !exists(string(v)) {\n            buf.WriteString(string(v))\n            prevBack = false\n        } else {\n            buf.WriteString(`\\`)\n            buf.WriteString(string(v))\n            if string(v) == `\\` {\n                prevBack = true\n            }\n        }\n    }\n    return buf.String()\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "aws-sdk"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1521501088, "post_id": 49373734, "comment_id": 85748964, "body": "Try a pointer to s3.CopyObjectInput, <code>copyObjectInput := &amp;s3.CopyObjectInput{}</code>"}, {"owner": {"reputation": 51, "user_id": 9519537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6a3ee58365d07b6dd41b345529511c0?s=128&d=identicon&r=PG&f=1", "display_name": "SearcherMain", "link": "https://stackoverflow.com/users/9519537/searchermain"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521547181, "post_id": 49373734, "comment_id": 85767995, "body": "That was a good suggestion, I don&#39;t know it even compiled as a object rather than reference. However, it still wasn&#39;t enough to modify the metadata."}], "answers": [{"comments": [{"owner": {"reputation": 7639, "user_id": 673282, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/19b35416cb9ff0ed4f6573afaabd00a5?s=128&d=identicon&r=PG", "display_name": "chim", "link": "https://stackoverflow.com/users/673282/chim"}, "edited": false, "score": 0, "creation_date": 1581682143, "post_id": 49388119, "comment_id": 106527469, "body": "This is what stackoverflow is about, thanks for taking the time to document this @SearcherMain"}], "tags": [], "owner": {"reputation": 51, "user_id": 9519537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6a3ee58365d07b6dd41b345529511c0?s=128&d=identicon&r=PG&f=1", "display_name": "SearcherMain", "link": "https://stackoverflow.com/users/9519537/searchermain"}, "is_accepted": false, "score": 2, "last_activity_date": 1521559415, "creation_date": 1521559415, "answer_id": 49388119, "question_id": 49373734, "link": "https://stackoverflow.com/questions/49373734/setting-content-disposition-and-content-type-in-aws-sdk-golang-has-no-effect/49388119#49388119", "title": "Setting Content Disposition and Content Type in AWS SDK (golang) has no effect", "body": "<p>It looks like the issue was that I needed to tell AWS I wanted to <code>REPLACE</code> the metadata. Adding the following line finally allowed me to change the metadata:</p>\n\n<pre><code>copyObjectInput.SetMetadataDirective(\"REPLACE\")\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 9519537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6a3ee58365d07b6dd41b345529511c0?s=128&d=identicon&r=PG&f=1", "display_name": "SearcherMain", "link": "https://stackoverflow.com/users/9519537/searchermain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1527851686, "creation_date": 1521500209, "last_edit_date": 1527851686, "question_id": 49373734, "link": "https://stackoverflow.com/questions/49373734/setting-content-disposition-and-content-type-in-aws-sdk-golang-has-no-effect", "title": "Setting Content Disposition and Content Type in AWS SDK (golang) has no effect", "body": "<p>The title says most of it. \nI have the following code:</p>\n\n<pre><code>        copySource := bucket + \"/\" + sourcePath + \"/\" + filenameIn\n        destPath := lambdaParams.DestinationPath + \"/\" + filenameIn\n        copyObjectInput := s3.CopyObjectInput{\n                CopySource: aws.String(copySource),\n                Bucket:     aws.String(bucket),\n                Key:        aws.String(destPath),\n        }\n\n            if filepath.Ext(filenameIn) == \".pdf\" {\ncopyObjectInput.SetContentType(\"application/pdf\").SetContentDisposition(\"inline; filename=\\\"\" + filenameIn + \"\\\"\")\n            }\n\n            _, err := svc.CopyObject(&amp;copyObjectInput)\n            if err != nil {\n                    logErrorAndInformGFS(err, \"S3 copy error.\", c, log, filenameIn)\n                    return err\n            }\n</code></pre>\n\n<p>I am setting both the <code>Content-Type</code> and the <code>Content-Disposition</code> with the hope of having the copied object have the new values from <code>Content-Type</code> and <code>Content-Disposition</code>. However, I can see in AWS that the copied file has the same metadata as the original file. What am I leaving out?</p>\n"}, {"tags": ["node.js", "go", "websocket"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1521499911, "post_id": 49373582, "comment_id": 85748580, "body": "Let&#39;s see some code."}, {"owner": {"reputation": 167, "user_id": 1525945, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/415ca8750ea54f4d7216d19d6950c05f?s=128&d=identicon&r=PG", "display_name": "Max Gillett", "link": "https://stackoverflow.com/users/1525945/max-gillett"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521500409, "post_id": 49373582, "comment_id": 85748744, "body": "@Peter See the linked gists."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1521500522, "post_id": 49373582, "comment_id": 85748783, "body": "@MaxGillett: Always include the code for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> in your post (see <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>)."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521500728, "post_id": 49373582, "comment_id": 85748864, "body": "Paste that code here. Site rules dictate that code must be included in the question, not just linked to."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1521508006, "post_id": 49373582, "comment_id": 85750825, "body": "Because you report that the client receives pongs, it seems that the pings must be well-formed."}, {"owner": {"reputation": 167, "user_id": 1525945, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/415ca8750ea54f4d7216d19d6950c05f?s=128&d=identicon&r=PG", "display_name": "Max Gillett", "link": "https://stackoverflow.com/users/1525945/max-gillett"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522190446, "post_id": 49373582, "comment_id": 86052922, "body": "@CeriseLim&#243;n Yes, but malformed from the perspective of this particular third-party server. The above Golang script holds a connection for any other websocket server I can throw at it, including servers I spin up on my own. I would like to compare the unencrypted content of the ping frames sent by each script, but I don&#39;t know how to go about doing this."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522194410, "post_id": 49373582, "comment_id": 86053962, "body": "To log the unencrypted data, add <code>fmt.Println(&quot;frame: %x %x\\n&quot;, buf0, buf1)</code> <a href=\"https://github.com/gorilla/websocket/blob/eb925808374e5ca90c83401a40d711dc08c0c0f6/conn.go#L376\" rel=\"nofollow noreferrer\">to the Go code</a> and <code>console.log(output);</code> <a href=\"https://github.com/theturtle32/WebSocket-Node/blob/d941f975e8ef6b55eafc0ef45996f4198013832c/lib/WebSocketFrame.js#L270\" rel=\"nofollow noreferrer\">to the JS code</a>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1522195620, "post_id": 49373582, "comment_id": 86054216, "body": "Based on a quick inspection of the code, it looks like both packages send the same data for a ping: 0x89, 0x80 and a four byte mask."}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1525259517, "post_id": 49373582, "comment_id": 87284382, "body": "addr is different between the two- wss://ws.radarrelay.com/0x/v0/ws for node and wss://api.radarrelay.com/0x/v0/ws for the go version. Those resolve to different IPs, do they have different ingress infrastructure?"}, {"owner": {"reputation": 167, "user_id": 1525945, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/415ca8750ea54f4d7216d19d6950c05f?s=128&d=identicon&r=PG", "display_name": "Max Gillett", "link": "https://stackoverflow.com/users/1525945/max-gillett"}, "reply_to_user": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1525275086, "post_id": 49373582, "comment_id": 87294966, "body": "@JonahBenton Well, that&#39;s embarrassing -- this is the problem. Good catch. If you create an answer below I can accept it."}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1525275692, "post_id": 49373582, "comment_id": 87295339, "body": "@max-gillett Cool! Happy to help. Always good to have a second pair of eyes look something over. Happens to me all the time that someone catches a little nit. To a first approximation, SO is just that service at scale. :) Cheers."}], "answers": [{"comments": [{"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 1, "creation_date": 1525276280, "post_id": 50138505, "comment_id": 87295718, "body": "If this turns out to be the real problem, then nice catch :-)"}], "tags": [], "owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "is_accepted": true, "score": 4, "last_activity_date": 1525275567, "creation_date": 1525275567, "answer_id": 50138505, "question_id": 49373582, "link": "https://stackoverflow.com/questions/49373582/websocket-connection-drops-using-golangs-gorilla-websocket-package/50138505#50138505", "title": "Websocket connection drops using Golang&#39;s gorilla/websocket package", "body": "<p>The addr is different between the two. The node code is talking to</p>\n\n<pre><code>wss://ws.radarrelay.com/0x/v0/ws\n</code></pre>\n\n<p>And the go code is talking to:</p>\n\n<pre><code>wss://api.radarrelay.com/0x/v0/ws\n</code></pre>\n\n<p>Looks like those resolve to different IPs, so perhaps they have different ingress infrastructure, and there is a timeout on the api subdomain that doesn't exist on the ws subdomain. </p>\n"}], "owner": {"reputation": 167, "user_id": 1525945, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/415ca8750ea54f4d7216d19d6950c05f?s=128&d=identicon&r=PG", "display_name": "Max Gillett", "link": "https://stackoverflow.com/users/1525945/max-gillett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2150, "favorite_count": 1, "accepted_answer_id": 50138505, "answer_count": 1, "score": 4, "last_activity_date": 1525275567, "creation_date": 1521499336, "last_edit_date": 1521501864, "question_id": 49373582, "link": "https://stackoverflow.com/questions/49373582/websocket-connection-drops-using-golangs-gorilla-websocket-package", "title": "Websocket connection drops using Golang&#39;s gorilla/websocket package", "body": "<p>I'm attempting to port a NodeJS script that establishes and maintains a Websocket connection to a third-party server to Go using the <a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">gorilla/websocket</a> package. In the <a href=\"https://gist.github.com/anonymous/7c169e995d13a943d3f494c88cac7a17\" rel=\"nofollow noreferrer\">Node script</a>, a pong is received following a ping, and the connection is kept alive indefinitely. In the <a href=\"https://gist.github.com/anonymous/69b8dca0172803fccb45dfeb5d310133\" rel=\"nofollow noreferrer\">Go script</a>, ping/pong works but the connection is dropped by the server after about 30 seconds. </p>\n\n<p>I suspect that the pings that are sent using the Go websocket package are malformed, but I can't pinpoint the cause of this. Comparing the captured, encrypted network traffic while running these programs shows no difference in the response length of the TCP requests and responses, so this may not be the issue. Any help would be greatly appreciated!</p>\n\n<p><strong>websocket.js</strong></p>\n\n<pre><code>#!/usr/bin/env node\n\n// npm install websocket@1.0.25 --save\nconst WebSocketClient = require('websocket').client;\nconst client = new WebSocketClient();\n\nlet lastPing = new Date().getTime();\n\nclient.on('connectFailed', function(error) {\n    console.log('Connect Error: ' + error.toString());\n});\n\nclient.on('connect', function(connection) {\n    console.log('Connected to Server...');\n    connection.on('error', function(error) {\n        console.log(\"Connection Error: \" + error.toString());\n    });\n    connection.on('close', function() {\n        console.log('Connection Closed');\n    });\n    connection.on('message', function(message) {\n      if (message.type === 'utf8') {\n        console.log(message.utf8Data);\n      }\n    });\n    connection.on('pong', function(){\n      console.log('[pingpong] response took', (new Date().getTime() - lastPing) + 'ms');\n    })\n\n    function send(message) {\n      if (connection.connected) {\n          connection.sendUTF(message);\n      }\n    }\n\n    // Send a ping every 10s\n    // to keep the connection live\n    setInterval(function(){\n      lastPing = new Date().getTime();\n      connection.ping();\n    }, 10000);\n});\n\nclient.connect('wss://ws.radarrelay.com/0x/v0/ws');\n</code></pre>\n\n<p><strong>websocket.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"log\"\n    \"os\"\n    \"os/signal\"\n    \"time\"\n\n    \"github.com/gorilla/websocket\"\n)\n\nvar addr = \"wss://api.radarrelay.com/0x/v0/ws\"\n\nfunc main() {\n    flag.Parse()\n    log.SetFlags(0)\n\n    timeoutDuration := 2 * time.Minute\n\n    interrupt := make(chan os.Signal, 1)\n    signal.Notify(interrupt, os.Interrupt)\n\n    c, _, err := websocket.DefaultDialer.Dial(addr, nil)\n    if err != nil {\n        log.Fatal(\"dial:\", err)\n    } else {\n        log.Println(\"Connected to server\")\n    }\n\n    c.SetPongHandler(func(str string) error {\n        log.Println(\"pong received\", str)\n        return nil\n    })\n\n    defer c.Close()\n\n    done := make(chan struct{})\n\n    go func() {\n        defer c.Close()\n        defer close(done)\n        for {\n            c.SetReadDeadline(time.Now().Add(timeoutDuration))\n            _, message, err := c.ReadMessage()\n            if err != nil {\n                log.Println(\"read:\", err)\n                return\n            }\n            if len(message) &gt;= 2 {\n                message = message[2:]\n            }\n            log.Printf(\"recv: %s\", message)\n        }\n    }()\n\n    ticker := time.NewTicker(10 * time.Second)\n    defer ticker.Stop()\n\n    for {\n        select {\n        case _ = &lt;-ticker.C:\n            err := c.WriteMessage(websocket.PingMessage, []byte{})\n            if err != nil {\n                log.Println(\"write:\", err)\n                return\n            } else {\n                log.Println(\"ping sent\")\n            }\n        case &lt;-interrupt:\n            log.Println(\"interrupt\")\n            // To cleanly close a connection, a client should send a close\n            // frame and wait for the server to close the connection.\n            err := c.WriteMessage(\n                websocket.CloseMessage,\n                websocket.FormatCloseMessage(websocket.CloseNormalClosure, \"\"))\n            if err != nil {\n                log.Println(\"write close:\", err)\n                return\n            }\n            select {\n            case &lt;-done:\n            case &lt;-time.After(time.Second):\n            }\n            c.Close()\n            return\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["windows", "go", "visual-studio-code"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521485812, "post_id": 49370149, "comment_id": 85741853, "body": "Please show the source with the import that causes this, and it&#39;s location in GOPATH."}, {"owner": {"reputation": 135, "user_id": 8408032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99a303565505ae571c0407774cf036ca?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Souza", "link": "https://stackoverflow.com/users/8408032/gabriel-souza"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521486512, "post_id": 49370149, "comment_id": 85742220, "body": "I edited the question with the requested information"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521486786, "post_id": 49370149, "comment_id": 85742363, "body": "Hmm, still not seeing the issue. Do you have any symlinks involved in the paths here?"}, {"owner": {"reputation": 135, "user_id": 8408032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99a303565505ae571c0407774cf036ca?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Souza", "link": "https://stackoverflow.com/users/8408032/gabriel-souza"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521487038, "post_id": 49370149, "comment_id": 85742472, "body": "&quot;github.com/gorilla/mux&quot; &quot;github.com/rs/cors&quot; &quot;github.com/gorilla/handlers&quot; These are public"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521487279, "post_id": 49370149, "comment_id": 85742584, "body": "Are you importing two packages named handlers? Try renaming one of them."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521487315, "post_id": 49370149, "comment_id": 85742603, "body": "Nvm, one is plural."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521487562, "post_id": 49370149, "comment_id": 85742710, "body": "@GabrielSouza: I don&#39;t understand your response about the symlinks. The <code>go</code> tool doesn&#39;t follow symlinks -- are those packages actually located in the expected paths?"}, {"owner": {"reputation": 135, "user_id": 8408032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99a303565505ae571c0407774cf036ca?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Souza", "link": "https://stackoverflow.com/users/8408032/gabriel-souza"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521490841, "post_id": 49370149, "comment_id": 85744406, "body": "@Peter Sorry, I&#39;m not good with English. I noticed that the folder structure was wrong the name bitbucket.com and bitbucket.org&#39;s thank you very much for the help, can you answer this for me to give you the points... Gracias"}], "owner": {"reputation": 135, "user_id": 8408032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99a303565505ae571c0407774cf036ca?s=128&d=identicon&r=PG&f=1", "display_name": "Gabriel Souza", "link": "https://stackoverflow.com/users/8408032/gabriel-souza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 959, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1521532534, "creation_date": 1521484589, "last_edit_date": 1521532534, "question_id": 49370149, "link": "https://stackoverflow.com/questions/49370149/error-by-giving-the-go-command-install-unexpected-directory-layout", "title": "error by giving the go command install-unexpected directory layout", "body": "<p>Hey I'm new to go (golang) I'm trying to start an application but without success, he returns the following error when you give the command go install:\nunexpected directory layout:</p>\n\n<pre><code>import path: github.com/gorilla/handlers\nroot: D:\\BitBucketERN\\GO\\src\ndir: D:\\BitBucketERN\\GO\\src\\bitbucket.com\\ernetworkdev\\ern-admin-cadastro-api\\vendor\\github.com\\gorilla\\handlers\nexpand root: D:\\BitBucketERN\\GO\\src\nexpand dir: D:\\BitBucketERN\\GO\\src\\bitbucket.com\\ernetworkdev\\ern-admin-cadastro-api\\vendor\\github.com\\gorilla\\handlers\nseparator: \\\n</code></pre>\n\n<p>my version:</p>\n\n<pre><code>go1.10 windows/amd64\n\nGOPATH \"D:\\BitBucketERN\\GO\"\nGOROOT \"D:\\GO\\\"\n</code></pre>\n\n<p>my import in app.go: </p>\n\n<pre><code>import (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    \"bitbucket.org/ernetworkdev/ern-admin-cadastro-api/handler\"\n    \"github.com/gorilla/mux\"\n    \"github.com/rs/cors\"\n    // Add the handlers package dependency\n    \"github.com/gorilla/handlers\"\n)\n</code></pre>\n\n<p>Full path:</p>\n\n<pre><code>D:\\BitBucketERN\\GO\\src\\bitbucket.com\\ernetworkdev\\ern-admin-cadastro-api\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521484615, "post_id": 49370111, "comment_id": 85741195, "body": "<code>math&#47;bits</code> was added in go1.9, though you should be using go1.10"}, {"owner": {"reputation": 378, "user_id": 3585078, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/602470386/picture?type=large", "display_name": "Pubudu", "link": "https://stackoverflow.com/users/3585078/pubudu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521485014, "post_id": 49370111, "comment_id": 85741442, "body": "This was previously working with my code in go 1.8.7 Is there a way I can get this working with 1.8.7 since swapping go version is not an option atm?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1521485122, "post_id": 49370111, "comment_id": 85741502, "body": "The current version of <code>golang.org&#47;x&#47;crypto</code> expects the current version of Go. Either update Go, or vendor an older commit of <code>golang.org&#47;x&#47;crypto</code>"}, {"owner": {"reputation": 378, "user_id": 3585078, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/602470386/picture?type=large", "display_name": "Pubudu", "link": "https://stackoverflow.com/users/3585078/pubudu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521513275, "post_id": 49370111, "comment_id": 85752065, "body": "How can I use an old commit of the library if I know the commit version if it\u2019s a golang package not git? @JimB"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521556458, "post_id": 49370111, "comment_id": 85775170, "body": "What do you mean &quot;it\u2019s a golang package not git&quot;? The <code>golang.org&#47;x&#47;</code>  packages are all pulled using git. You should be using some sort of tooling to manage your dependencies, and you would use the tool of your choice (govendor, dep, glide, etc.) to &quot;vendor&quot; the desired package version."}], "answers": [{"comments": [{"owner": {"reputation": 378, "user_id": 3585078, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/602470386/picture?type=large", "display_name": "Pubudu", "link": "https://stackoverflow.com/users/3585078/pubudu"}, "edited": false, "score": 0, "creation_date": 1521485068, "post_id": 49370157, "comment_id": 85741478, "body": "I need to use it with go 1.8.7. Is there a possibility of doing that? This was working with the same go version earlier."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 378, "user_id": 3585078, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/602470386/picture?type=large", "display_name": "Pubudu", "link": "https://stackoverflow.com/users/3585078/pubudu"}, "edited": false, "score": 0, "creation_date": 1521486374, "post_id": 49370157, "comment_id": 85742151, "body": "Yes. See my revised answer."}, {"owner": {"reputation": 378, "user_id": 3585078, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/602470386/picture?type=large", "display_name": "Pubudu", "link": "https://stackoverflow.com/users/3585078/pubudu"}, "edited": false, "score": 0, "creation_date": 1521496825, "post_id": 49370157, "comment_id": 85747328, "body": "Thanks. But I&#39;m actually on Mac. My terminal gets closed when I execute &quot;exec $GOBIN/go &quot;$@&quot; command. Is there a straight forward way to get a specific version of &quot;golang.org/x/crypto/bcrypt&quot;?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 378, "user_id": 3585078, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/602470386/picture?type=large", "display_name": "Pubudu", "link": "https://stackoverflow.com/users/3585078/pubudu"}, "edited": false, "score": 0, "creation_date": 1521556534, "post_id": 49370157, "comment_id": 85775223, "body": "@Pubudu: that&#39;s what happens if you use <code>exec</code> from the any unix command line. The example was a shell script, if you want to run the commands individually, don&#39;t use <code>exec</code>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 10, "last_activity_date": 1521487725, "last_edit_date": 1521487725, "creation_date": 1521484614, "answer_id": 49370157, "question_id": 49370111, "link": "https://stackoverflow.com/questions/49370111/cannot-find-package-math-bits/49370157#49370157", "title": "Cannot find package math/bits", "body": "<blockquote>\n  <p><a href=\"https://golang.org/doc/go1.9\" rel=\"noreferrer\">Go 1.9 Release Notes</a></p>\n  \n  <p><a href=\"https://golang.org/doc/go1.9#math-bits\" rel=\"noreferrer\">New bit manipulation package</a></p>\n  \n  <p>Go 1.9 includes a new package, math/bits, with optimized\n  implementations for manipulating bits. On most architectures,\n  functions in this package are additionally recognized by the compiler\n  and treated as intrinsics for additional performance.</p>\n</blockquote>\n\n<p>You need Go version 1.9 or later.</p>\n\n<hr>\n\n<p>I have several versions of Go installed from source in my <code>$HOME</code> directory: <code>~/go1.4</code>, <code>~/go1.8</code>, <code>~/go1.9</code>, <code>~/go1.10</code>, and <code>~/go</code> (devel). Copy the <code>src/math/bits</code> folder from go1.9 or later to go1.8. From <code>go1.8/src</code> run <code>go1.8 install -v math/bits</code>.</p>\n\n<p><code>go1.8</code>:</p>\n\n<pre><code>#!/bin/sh\n\n# $HOME/bin/go1.8\n\nexport GOARCH=amd64\nexport GOOS=linux\nexport GOROOT=$HOME/go1.8 \nexport GOBIN=$GOROOT/bin\n\nexec $GOBIN/go \"$@\"\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ cd ~/go1.8/src\n$ go1.8 install -v math/bits \nmath/bits\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/bits\"\n)\n\nfunc main() {\n    fmt.Println(bits.UintSize)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go1.8 run bits.go\n64\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 983, "user_id": 7059119, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209343272591927/picture?type=large", "display_name": "Aristofanio Garcia", "link": "https://stackoverflow.com/users/7059119/aristofanio-garcia"}, "is_accepted": false, "score": 0, "last_activity_date": 1536356612, "last_edit_date": 1536356612, "creation_date": 1536353938, "answer_id": 52229568, "question_id": 49370111, "link": "https://stackoverflow.com/questions/49370111/cannot-find-package-math-bits/52229568#52229568", "title": "Cannot find package math/bits", "body": "<p>You need to copy package \"math/bits\" for you gopath.\nAn way is:</p>\n\n<ol>\n<li>download golang 1.10+</li>\n<li>make directory <code>&lt;goprojectpath&gt;/src/math</code></li>\n<li>copy <code>(cp -r ...)</code> from <code>&lt;goroot_1.10+&gt;/src/math/bits</code> to <code>&lt;goprojectpath&gt;/src/math</code></li>\n<li>try again: <code>govendor add +external</code></li>\n</ol>\n\n<p>Or install new golang version to 1.10+.</p>\n"}], "owner": {"reputation": 378, "user_id": 3585078, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/602470386/picture?type=large", "display_name": "Pubudu", "link": "https://stackoverflow.com/users/3585078/pubudu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11315, "favorite_count": 2, "answer_count": 2, "score": 4, "last_activity_date": 1536356612, "creation_date": 1521484464, "last_edit_date": 1521485087, "question_id": 49370111, "link": "https://stackoverflow.com/questions/49370111/cannot-find-package-math-bits", "title": "Cannot find package math/bits", "body": "<p>I'm getting the following error when I execute my tests. This was working previously. Not sure what I need to do in order to fix this error.</p>\n\n<pre><code>golang.org/x/crypto/ripemd160/ripemd160block.go:12:2: cannot find package \"math/bits\" in any of:\n    /usr/local/Cellar/go@1.8/1.8.7/libexec/src/math/bits (from $GOROOT)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1521475345, "post_id": 49367338, "comment_id": 85735401, "body": "<code>log.Fatal</code> doesn&#39;t make a very good error log level, since it immediately called <code>os.Exit(1)</code>"}, {"owner": {"reputation": 23, "user_id": 2821260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ad824b4d610ecf6f6b3c11206dca9bb?s=128&d=identicon&r=PG&f=1", "display_name": "user2821260", "link": "https://stackoverflow.com/users/2821260/user2821260"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521476751, "post_id": 49367338, "comment_id": 85736405, "body": "yes, it would still write to the log though before it exits, which is still fine, I can check the log and see which function it stopped at.   It would be a terminating error."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1521477363, "post_id": 49367338, "comment_id": 85736826, "body": "No, you cannot. If you want this level of granularity, you should either wrap the stdlib logger or use a 3rd-party logger."}], "owner": {"reputation": 23, "user_id": 2821260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ad824b4d610ecf6f6b3c11206dca9bb?s=128&d=identicon&r=PG&f=1", "display_name": "user2821260", "link": "https://stackoverflow.com/users/2821260/user2821260"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1521475578, "creation_date": 1521475277, "last_edit_date": 1521475578, "question_id": 49367338, "link": "https://stackoverflow.com/questions/49367338/regarding-log-println-log-fatalf-and-ioutil-discard", "title": "regarding log.Println log.Fatalf and ioutil.Discard", "body": "<p>The below is an example of a function which basically enables or disables writes to a file. </p>\n\n<pre><code>func getdebugmode(d bool, env string) {\n    log.SetOutput(ioutil.Discard) //discard all writes by default\n    if d == true {\n        f, _ := os.OpenFile(\"/app/monitoring/appdyn/logs/appdyn_server_monitoring_events_\" + env + \".log\", os.O_APPEND|os.O_CREATE|os.O_RDWR, 0666)\n        log.SetOutput(f)\n        log.SetFlags(log.LstdFlags | log.Lshortfile)\n    }\n}\n</code></pre>\n\n<p>Is it possible instead of discarding all writes to allow log.Fatalf writes to go into the log but not writes using log.Println unless I specify the bool to be true.</p>\n\n<p>I am trying to use log.Println as \"INFORMATIONAL\" alerts and log.Fatalf as \"Error\" alerts.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1521473339, "post_id": 49366606, "comment_id": 85733900, "body": "This is a very common way to handle middleware chains. Some third-party libraries provide &quot;helpers&quot; for this but it ends up with the same result."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1521473354, "post_id": 49366606, "comment_id": 85733912, "body": "It&#39;s common to use the approach outlined in the question."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1521474041, "post_id": 49366606, "comment_id": 85734439, "body": "You should check this <a href=\"http://www.alexedwards.net/blog/making-and-using-middleware\" rel=\"nofollow noreferrer\">Link</a> showing the same with better code readability. Also for much better code readability you can use <a href=\"https://github.com/urfave/negroni\" rel=\"nofollow noreferrer\">Negroni</a> package for handling middlewares"}], "answers": [{"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 1, "last_activity_date": 1521478213, "creation_date": 1521478213, "answer_id": 49368282, "question_id": 49366606, "link": "https://stackoverflow.com/questions/49366606/is-it-ok-to-use-the-chain-of-http-handlerfunc/49368282#49368282", "title": "Is it OK to use the chain of http.HandlerFunc?", "body": "<p>Sure, I have some old Go code that does exactly that.</p>\n\n<p>I have somewhat newer Go code which uses github.com/justinas/alice to manage middleware before passing it on to gorilla/mux.</p>\n\n<p>My current Go code just uses gorilla/mux's now built in middleware handling, <code>Router.Use()</code>, which looks a lot cleaner than either of the previous solutions, and doesn't require any <em>more</em> third party libraries.</p>\n"}], "owner": {"reputation": 465, "user_id": 1936173, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/8uQ1j.png?s=128&g=1", "display_name": "Illia Danko", "link": "https://stackoverflow.com/users/1936173/illia-danko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 49368282, "answer_count": 1, "score": -1, "last_activity_date": 1521478213, "creation_date": 1521473233, "last_edit_date": 1521475527, "question_id": 49366606, "link": "https://stackoverflow.com/questions/49366606/is-it-ok-to-use-the-chain-of-http-handlerfunc", "title": "Is it OK to use the chain of http.HandlerFunc?", "body": "<p>Using Go http package for a while, I found a convenient way to split responsibilities of the target (endpoint) of HTTP request, over several chain call of http.HandlerFunc:</p>\n\n<pre><code>func HeaderValidator(h func(http.ResponseWriter, *HttpRequest)) http.HandlerFunc {\n    return func(w http.ResponseWriter, req *HttpRequest) {\n        ...\n        h(w, req)\n    }\n}\n</code></pre>\n\n<p>So now, the handler looks like:</p>\n\n<pre><code>router.HandleFunc(\"/\", handler.Log(handler.HeaderValidator(handler.RequestTimer(handler.TargetHandler))))\n</code></pre>\n\n<p>I guess this is not so good from an efficiency point of view (at least, it requires a stack allocation for a functions call) as well as code readability hurts a bit.</p>\n\n<p>Is there a more graceful and efficient way to do that?</p>\n"}, {"tags": ["go", "types", "type-assertion"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1521472679, "post_id": 49366380, "comment_id": 85733375, "body": "What have you tried? What problems did you encounter?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521472772, "post_id": 49366380, "comment_id": 85733454, "body": "You need a <a href=\"https://tour.golang.org/methods/16\" rel=\"nofollow noreferrer\">type switch, covered in the Go tour</a> and <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">in the spec</a>."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521472930, "post_id": 49366380, "comment_id": 85733585, "body": "An alternative that&#39;ll work for at least primitive (ie. non-struct) types is to append <code>fmt.Sprintf(&quot;%v&quot;, j)</code>.  This will convert them all to string via their default print format.  If you want type-specific conversion styles, use a typeswitch as @Adrian suggested."}, {"owner": {"reputation": 67, "user_id": 5664838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uvjhL.gif?s=128&g=1", "display_name": "\u0418\u0433\u043e\u0440\u044c", "link": "https://stackoverflow.com/users/5664838/%d0%98%d0%b3%d0%be%d1%80%d1%8c"}, "edited": false, "score": 0, "creation_date": 1521473488, "post_id": 49366380, "comment_id": 85734021, "body": "Actually, I need to create POST request with properties from that map. So i need to get string type to create a request with that parameters. I think, fmt.Sprintf(&quot;%v&quot;, j) will works for me."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521473668, "post_id": 49366380, "comment_id": 85734163, "body": "Better approach will be that to use type switch to check the value using type assertion and then convert everything to string."}, {"owner": {"reputation": 23850, "user_id": 196679, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/fXUzE.jpg?s=128&g=1", "display_name": "Bazzz", "link": "https://stackoverflow.com/users/196679/bazzz"}, "edited": false, "score": 0, "creation_date": 1521540107, "post_id": 49366380, "comment_id": 85763010, "body": "I would highly suggest to change your map to <code>map[string]fmt.Stringer</code> if that is the purpose you have in mind. You can then just <code>range</code> the map and call <code>String()</code> on each element. I do realise that the demo values you have added do not all implement the Stringer interface but maybe that is easier to solve?"}], "answers": [{"tags": [], "owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "is_accepted": true, "score": 3, "last_activity_date": 1521480743, "last_edit_date": 1521480743, "creation_date": 1521473510, "answer_id": 49366737, "question_id": 49366380, "link": "https://stackoverflow.com/questions/49366380/how-to-convert-different-values-from-mapstringinterface-to-type-string/49366737#49366737", "title": "How to convert different values from map[string]interface{} to type string", "body": "<p>@Adrian and @Kaedys comments point to the correct answer. Developing it a bit more you could do something as:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    map1 := map[string]interface{}{\"str1\": \"string one\", \"int1\": 123, \"float1\": 0.123}\n\n    var slc []string\n    for _, j := range map1 {\n        switch v := j.(type) {\n        case string:\n            slc = append(slc, v)\n        case fmt.Stringer:\n            slc = append(slc, v.String())\n        default:\n            slc = append(slc, fmt.Sprintf(\"%v\", v))\n        }\n    }\n\n    fmt.Println(slc)\n}\n</code></pre>\n\n<p>This answer will work for strings, any type that implements the <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow noreferrer\"><code>fmt.Stringer</code> interface</a>, and will default to <code>fmt.Sprintf(\"%v\", ...)</code>.</p>\n"}], "owner": {"reputation": 67, "user_id": 5664838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uvjhL.gif?s=128&g=1", "display_name": "\u0418\u0433\u043e\u0440\u044c", "link": "https://stackoverflow.com/users/5664838/%d0%98%d0%b3%d0%be%d1%80%d1%8c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3249, "favorite_count": 0, "accepted_answer_id": 49366737, "answer_count": 1, "score": -1, "last_activity_date": 1598388791, "creation_date": 1521472621, "last_edit_date": 1598388791, "question_id": 49366380, "link": "https://stackoverflow.com/questions/49366380/how-to-convert-different-values-from-mapstringinterface-to-type-string", "title": "How to convert different values from map[string]interface{} to type string", "body": "<p>I have a map with different types in interface{} and I need to convert them all to string type. Type assertion is not enough.</p>\n\n<pre><code>package main\n\nfunc main() {\n    map1 := map[string]interface{}{\"str1\": \"string one\", \"int1\": 123, \"float1\": 0.123}\n\n    var slc []string\n    for _, j := range map1 {\n        slc = append(slc, j.(string)) // panic: interface conversion: interface {} is int, not string\n    }\n}\n</code></pre>\n"}, {"tags": ["sql-server", "go"], "comments": [{"owner": {"reputation": 4677, "user_id": 519348, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TIdre.jpg?s=128&g=1", "display_name": "TZHX", "link": "https://stackoverflow.com/users/519348/tzhx"}, "edited": false, "score": 0, "creation_date": 1521469123, "post_id": 49365146, "comment_id": 85730670, "body": "there&#39;s two different time outs in sql server, and it looks like the one you&#39;re setting is the &quot;connection timeout&quot; (how long it&#39;ll wait to make a connection). does the api you use refer anywhere to a &quot;command&quot; or &quot;query&quot; timeout? (I can see a read and write timeout, but they say they deafult to 0 which I&#39;d assume is unlimited)"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521470836, "post_id": 49365146, "comment_id": 85731975, "body": "The timeout depends on the connection time taking to connect to sql-server. It does not seems like query execution time out. Did you check it by removing the timeout."}, {"owner": {"reputation": 929, "user_id": 6146337, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207160730031528/picture?type=large", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/6146337/sebastian"}, "reply_to_user": {"reputation": 4677, "user_id": 519348, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/TIdre.jpg?s=128&g=1", "display_name": "TZHX", "link": "https://stackoverflow.com/users/519348/tzhx"}, "edited": false, "score": 0, "creation_date": 1521471123, "post_id": 49365146, "comment_id": 85732203, "body": "@TZHX good call. So the default for readTimeout and writeTimout is 0 which should be unlimited. I just tried <code>sqlserver:&#47;&#47;user:password@server?readTimeout=1m30s</code> and am still getting timed-out at 30 seconds"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1521471304, "post_id": 49365146, "comment_id": 85732343, "body": "Not sure why you are referencing docs for a different project.  According to the docs here: <a href=\"https://github.com/denisenkom/go-mssqldb\" rel=\"nofollow noreferrer\">github.com/denisenkom/go-mssqldb</a> it looks like you might want to add <code>connection+timeout=90</code> to you connection string."}, {"owner": {"reputation": 929, "user_id": 6146337, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207160730031528/picture?type=large", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/6146337/sebastian"}, "edited": false, "score": 0, "creation_date": 1521471579, "post_id": 49365146, "comment_id": 85732560, "body": "ah shame. I got confused in my documentation googling. Thank you for setting me straight. <code>connection+timeout=#</code> worked. I initially tried <code>connection+timeout=0</code> which timed out immediately contrary to the documentation."}], "answers": [{"comments": [{"owner": {"reputation": 1509, "user_id": 2093371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hNNb8.jpg?s=128&g=1", "display_name": "hestellezg", "link": "https://stackoverflow.com/users/2093371/hestellezg"}, "edited": false, "score": 0, "creation_date": 1568915816, "post_id": 49366036, "comment_id": 102436804, "body": "I changed the parameter for <code>?dial+timeout=90</code>"}], "tags": [], "owner": {"reputation": 929, "user_id": 6146337, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207160730031528/picture?type=large", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/6146337/sebastian"}, "is_accepted": false, "score": 0, "last_activity_date": 1521471694, "creation_date": 1521471694, "answer_id": 49366036, "question_id": 49365146, "link": "https://stackoverflow.com/questions/49365146/go-mssql-set-connection-timeout/49366036#49366036", "title": "go-mssql set connection timeout", "body": "<p>I was referencing the wrong documentation initially. To format the url see the following:</p>\n\n<pre><code>\"sqlserver://user:password@server?connection+timeout=90\"\n</code></pre>\n"}], "owner": {"reputation": 929, "user_id": 6146337, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207160730031528/picture?type=large", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/6146337/sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 734, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1521471694, "creation_date": 1521469038, "last_edit_date": 1521471617, "question_id": 49365146, "link": "https://stackoverflow.com/questions/49365146/go-mssql-set-connection-timeout", "title": "go-mssql set connection timeout", "body": "<p>I'm having issues setting the timeout in go-mssqldb</p>\n\n<p>This is my current connection string:</p>\n\n<pre><code>sqlserver://user:password@server?timeout=1m30s\n</code></pre>\n\n<p>I can connect just fine, run queries etc. but I keep timing out at the default value of 30 seconds.\nI'm referencing the documentation <a href=\"https://github.com/denisenkom/go-mssqldb\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>What am I missing?</p>\n\n<pre><code>import (\n    \"database/sql\"\n    _ \"github.com/denisenkom/go-mssqldb\"\n)\n\nfunc main(){\n    db, err := sql.Open(\"mssql\", \"sqlserver://user:password@server?timeout=1m30s\")\n    if err != nil{\n        panic(err)\n    }\n\n    _, err = db.Exec(\"run query that takes longer than 30 seconds\")\n    if err != nil{\n         panic(err)\n    }\n    // panic at 30 seconds...\n    // panic: read tcp {my ip}-&gt;{server ip}: i/o timeout\n\n}\n</code></pre>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1521463256, "post_id": 49363051, "comment_id": 85726502, "body": "Possible duplicate: <a href=\"https://stackoverflow.com/questions/23494950/specifically-check-for-timeout-error\" title=\"specifically check for timeout error\">stackoverflow.com/questions/23494950/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521463361, "post_id": 49363051, "comment_id": 85726595, "body": "If you&#39;ve read a complete message, then there was no timeout error. If you encountered a timeout error, it&#39;s up to the logic of your program how you want to handle that."}, {"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521463915, "post_id": 49363051, "comment_id": 85726979, "body": "@JimB I know how to check a timeout error, but I don\u2019t know if a timeout error occur and after that server send a message to me by the connection, will I get the message by reading from the connection"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521464309, "post_id": 49363051, "comment_id": 85727277, "body": "The error is returned from a Read operation -- if you didn&#39;t receive the data and got an error, then you didn&#39;t receive the data. If you received the data, then you received the data. What is the point of the timeout if you want to see if the server sent the message after the timeout? Why not check if the server sent the message after you checked after the timeout, and so on? Set the timeout appropriately first, and if you didn&#39;t get message, timeout."}], "answers": [{"comments": [{"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1521467687, "post_id": 49363514, "comment_id": 85729719, "body": "thank you\uff0ci think I understand. If I use keep alive connection, I should check response valid in programming logic rather than rely on underlay of tcp connection, right?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1521468179, "post_id": 49363514, "comment_id": 85730085, "body": "You always (always!) have to check data received over the network in any case."}, {"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1521470569, "post_id": 49363514, "comment_id": 85731755, "body": "In my mind, I have two choice to handle this problem, 1. close the connection and create new one, resend request message to server by new connection 2.add sequence number to request and response message, check response sequence number is pair to request. I only have little programming practice, so which one is better?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 2, "creation_date": 1521470968, "post_id": 49363514, "comment_id": 85732065, "body": "@wangjun, we cannot tell you how to handle your errors. That depends entirely on the application. You have to figure it out yourself."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1521464097, "creation_date": 1521464097, "answer_id": 49363514, "question_id": 49363051, "link": "https://stackoverflow.com/questions/49363051/can-tcp-clients-receive-data-after-a-read-timeout/49363514#49363514", "title": "Can TCP clients receive data after a read timeout?", "body": "<blockquote>\n  <p>If a timeout error occur after reading from a connection and server send message to me after this point, will the message be put into my connection receive buffer?</p>\n</blockquote>\n\n<p>If you don't close the connection, yes.</p>\n\n<blockquote>\n  <p>Will I get the message in next reading?</p>\n</blockquote>\n\n<p>Yes, if you reset the deadline. Although this does beg the question why you set a timeout in the first place.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net\"\n    \"time\"\n)\n\nfunc main() {\n    l, err := net.Listen(\"tcp\", \"127.0.0.1:3001\")\n    check(err)\n\n    go slowServer(l)\n\n    conn, err := net.Dial(\"tcp\", \"127.0.0.1:3001\")\n    check(err)\n    conn.SetDeadline(time.Now().Add(time.Second))\n\n    b := make([]byte, 512)\n\n    n, err := conn.Read(b)\n    fmt.Printf(\"%q, %v\\n\", b[:n], err) // \"\", i/o timeout\n\n    // Reset deadline\n    conn.SetDeadline(time.Now().Add(2 * time.Second))\n\n    n, err = conn.Read(b)\n    fmt.Printf(\"%q, %v\\n\", b[:n], err) // \"hello world\", &lt;nil&gt;\n}\n\nfunc slowServer(l net.Listener) {\n    conn, err := l.Accept()\n    check(err)\n\n    time.Sleep(2 * time.Second)\n    io.WriteString(conn, \"hello world\")\n    conn.Close()\n}\n\nfunc check(err error) {\n    if err != nil {\n            log.Fatal(err)\n    }\n}\n\n// \"\", read tcp 127.0.0.1:50488-&gt;127.0.0.1:3001: i/o timeout\n// \"hello world\", &lt;nil&gt;\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/Id60hHK7tKF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Id60hHK7tKF</a></p>\n"}], "owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 559, "favorite_count": 0, "accepted_answer_id": 49363514, "answer_count": 1, "score": 0, "last_activity_date": 1521464245, "creation_date": 1521462643, "last_edit_date": 1521464245, "question_id": 49363051, "link": "https://stackoverflow.com/questions/49363051/can-tcp-clients-receive-data-after-a-read-timeout", "title": "Can TCP clients receive data after a read timeout?", "body": "<p>I create a tcp connection pool in golang and set every connection to keep alive, when I get a connection from pool, I will set a 10 seconds timeout by SetDeadline function. Now I want to know, if a timeout error occur after reading from a connection and server send message to me after this point, will the message be put into my connection receive buffer? Will I get the message in next reading? If so, how should I handle the timeout error? Close the connection and create a new one?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1558614224, "last_edit_date": 1558614224, "creation_date": 1521461768, "answer_id": 49362754, "question_id": 49362653, "link": "https://stackoverflow.com/questions/49362653/how-to-unmarshal-json-with-unknown-fieldnames-to-struct/49362754#49362754", "title": "How to unmarshal JSON with unknown fieldnames to struct", "body": "<p>Simply use a map if you don't know the key, and the value type of the map may be the struct describing the structure:</p>\n\n<pre><code>type mData struct {\n    KnownField1 [][5]int `json:\"known_field_1\"`\n    KnownField2 [][5]int `json:\"known_field_2\"`\n    KnownField3 [][5]int `json:\"known_field_3\"`\n}\n</code></pre>\n\n<p>Note that you must export the fields for this to work!</p>\n\n<p>And the unmarshaling code:</p>\n\n<pre><code>var data map[string]mData\nif err := json.Unmarshal(body, &amp;data); err != nil {\n    panic(err)\n}\n\nfmt.Println(data)\nfor k, v := range data {\n    fmt.Println(k, v)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/0NW1HrjerJQ\" rel=\"nofollow noreferrer\">Go Playground)</a>:</p>\n\n<pre><code>map[unknown_field:{[[1 2 3 4 5] [10 20 30 40 50] [100 200 300 400 500]] [[11 21 31 41 51]] [[12 22 32 42 52] [14 44 34 44 54]]}]\nunknown_field {[[1 2 3 4 5] [10 20 30 40 50] [100 200 300 400 500]] [[11 21 31 41 51]] [[12 22 32 42 52] [14 44 34 44 54]]}\n</code></pre>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/29347092/how-to-parse-deserlize-a-dynamic-json-in-golang/29347148#29347148\">How to parse/deserlize a dynamic JSON in Golang</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/33436730/unmarshal-json-with-unknown-fields/33437853#33437853\">Unmarshal JSON with unknown fields</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/46585279/unmarshal-json-string-to-a-struct-that-have-one-element-of-the-struct-itself/46585770#46585770\">Unmarshal json string to a struct that have one element of the struct itself</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/56274884/json-nested-dynamic-structures-go-decoding/56274984#56274984\">JSON Nested dynamic structures Go decoding</a></p>\n"}], "owner": {"reputation": 67, "user_id": 5664838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uvjhL.gif?s=128&g=1", "display_name": "\u0418\u0433\u043e\u0440\u044c", "link": "https://stackoverflow.com/users/5664838/%d0%98%d0%b3%d0%be%d1%80%d1%8c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4353, "favorite_count": 0, "closed_date": 1558421939, "accepted_answer_id": 49362754, "answer_count": 1, "score": 3, "last_activity_date": 1569302984, "creation_date": 1521461441, "last_edit_date": 1569302984, "question_id": 49362653, "link": "https://stackoverflow.com/questions/49362653/how-to-unmarshal-json-with-unknown-fieldnames-to-struct", "closed_reason": "Duplicate", "title": "How to unmarshal JSON with unknown fieldnames to struct", "body": "<p>Is it possible to unmarshal JSON with unknown field? That field name is always different, but the structure is the same. JSON is a result of POST request.</p>\n\n<p>My code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/json\"\n\nvar body = []byte(`{\n    \"unknown_field\": {\n            \"known_field_1\": [[1,2,3,4,5],[10,20,30,40,50],[100,200,300,400,500]],\n            \"known_field_2\": [[11,21,31,41,51]],\n            \"known_field_3\": [[12,22,32,42,52],[14,44,34,44,54]]\n        }\n}`)\n\ntype MyStruct struct {\n    MainData map[string]mData `json:\"-\"`\n}\n\ntype mData struct {\n    knownField1 [][5]int `json:\"known_field_1\"`\n    knownField2 [][5]int `json:\"known_field_2\"`\n    knownField3 [][5]int `json:\"known_field_3\"`\n}\n\nfunc NewMyStruct() MyStruct {\n    ms := MyStruct{}\n    ms.MainData = make(map[string]mData)\n    return ms\n}\n\nfunc main() {\n    myStruct := NewMyStruct()\n    if err := json.Unmarshal(body, &amp;myStruct); err != nil {\n        panic(err)\n    }\n\n    fmt.Println(myStruct) // gives {map[]}\n}\n</code></pre>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1521458762, "post_id": 49361806, "comment_id": 85723597, "body": "I don&#39;t understand your question. Are you using C code in Go (i.e. <code>cgo</code>)? Or are you just trying to get the same functionality in Go that you have observed in C and Python?"}, {"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 0, "creation_date": 1521461899, "post_id": 49361806, "comment_id": 85725572, "body": "Go is a statically typed language, use CGO to call c code in Go : <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>"}, {"owner": {"reputation": 15, "user_id": 9516208, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HeyLight", "link": "https://stackoverflow.com/users/9516208/heylight"}, "edited": false, "score": 0, "creation_date": 1521711694, "post_id": 49361806, "comment_id": 85851294, "body": "I mean python&#39;s cffi library could load C struct into memory and organize it like a &quot;tree&quot; of classes which make it possible to resolve a variable name string like &quot;entity.var1&quot; by looking into that tree and find the desired leaf and output its value. Is there anything similar in GO?"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 9516208, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HeyLight", "link": "https://stackoverflow.com/users/9516208/heylight"}, "edited": false, "score": 0, "creation_date": 1521711337, "post_id": 49363142, "comment_id": 85851028, "body": "Thanks. But could GO dynamically resolve C struct? The program does not know desired variable name before it runs.  fmt.Printf(&quot;My Struct&#39;s var field %d\\n&quot;, something read from input stream)"}, {"owner": {"reputation": 15, "user_id": 9516208, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HeyLight", "link": "https://stackoverflow.com/users/9516208/heylight"}, "edited": false, "score": 0, "creation_date": 1521711456, "post_id": 49363142, "comment_id": 85851113, "body": "Just like python&#39;s cffi, which can generate a &quot;tree&quot; of struct in memory and make it possible to resolve variable dynamically."}, {"owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "reply_to_user": {"reputation": 15, "user_id": 9516208, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HeyLight", "link": "https://stackoverflow.com/users/9516208/heylight"}, "edited": false, "score": 0, "creation_date": 1521723575, "post_id": 49363142, "comment_id": 85859936, "body": "CGO can be used to link against libraries (dll,so,a,etc), just make sure the header file is in the CGO pre-amble and the library is in the compilers search paths. Now this is a compile time solution, though dynamic in that you change a shared library, but you do not need to change the go code. As far as the ultra dynamic solution that Python offers, Go actually can do this with other Go code using <code>plugins</code>, but cannot do it with C code. Basically as long as you are not taking the shared library as an argument, you should be able to do everything you need with CGO."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "is_accepted": true, "score": 1, "last_activity_date": 1521462952, "creation_date": 1521462952, "answer_id": 49363142, "question_id": 49361806, "link": "https://stackoverflow.com/questions/49361806/is-there-some-way-to-resolve-c-struct-dynamically-in-go/49363142#49363142", "title": "Is there some way to resolve C struct dynamically in Go?", "body": "<p>This is handled by CGO which is a special package in Go that allows for easy C integration. You can read more about it <a href=\"https://github.com/golang/go/wiki/cgo\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://godoc.org/cmd/cgo\" rel=\"nofollow noreferrer\">here</a>. Given your examples, a simple CGO example would be:</p>\n\n<pre><code>/*\nstruct SomeStruct\n{\n    int var1;\n    bool var2;\n    double var3;\n    int var4[10];\n    int var5[10][10];\n}\n*/\nimport \"C\"\nimport \"fmt\"\n\nfunc main(){\n    thing := C.struct_SomeStruct{}\n    thing.var1 = C.int(5)\n    fmt.Printf(\"My Struct's var field %d\\n\",int(thing.var1))\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 9516208, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "HeyLight", "link": "https://stackoverflow.com/users/9516208/heylight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 49363142, "answer_count": 1, "score": 0, "last_activity_date": 1521479320, "creation_date": 1521458681, "last_edit_date": 1521479320, "question_id": 49361806, "link": "https://stackoverflow.com/questions/49361806/is-there-some-way-to-resolve-c-struct-dynamically-in-go", "title": "Is there some way to resolve C struct dynamically in Go?", "body": "<p>I defined a struct in C like:</p>\n\n<pre><code>struct SomeStruct\n{\n    int var1;\n    bool var2;\n    double var3;\n    int var4[10];\n    int var5[10][10];\n}\nstruct SomeStruct entity;\n</code></pre>\n\n<p>And somewhere there was a input box that some user input in GO: </p>\n\n<pre><code>func(\"entity.var3\")\n</code></pre>\n\n<p>It will return value of entity.var3 in C struct.</p>\n\n<p>Actually I could already implement it in python by cffi and:</p>\n\n<pre><code>def get_one_variable(buffer, setup):\n    value = buffer\n    for level in setup:\n        if isinstance(level, str):\n            value = getattr(value, level)\n        else:\n            [base, extends] = level\n            value = getattr(value, base)\n            for extend in extends:\n                value = value[extend]\n    return value\n</code></pre>\n\n<p>Where buffer is python cffi data pointer defined with \"FFI.cdef\" and setup resolved by:</p>\n\n<pre><code>def parse_variable(self, line):\n    line = line.replace('\\n', '').replace(' ', '')\n    split = line.split('.')\n    variable = []\n    for child in split:\n        match = self.BASE_EXT_REGEX.match(child)\n        if match is None:\n            variable.append(child)\n        else:\n            base_name = match.group('base_name')\n            ext_name = match.group('ext_name')\n            variable.append([base_name, [int(index) for index in\n                                         ext_name.replace('[', ']').replace(']]', ']').strip(']').split(']')]])\n    return variable\n</code></pre>\n\n<p>So I can dynamically resolve \"entity.var1\", \"entity.var2\", \"entity.var3\", \"entity.var4[0]\", \"entity.var5[0][1]\".</p>\n\n<p>Is there something or someway similar in GO?</p>\n"}, {"tags": ["go", "apache-kafka"], "answers": [{"comments": [{"owner": {"reputation": 4354, "user_id": 1806005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ee889ac6797f1f23ebb955164162bd39?s=128&d=identicon&r=PG", "display_name": "freakman", "link": "https://stackoverflow.com/users/1806005/freakman"}, "edited": false, "score": 0, "creation_date": 1521456466, "post_id": 49361036, "comment_id": 85722182, "body": "but I imagine that it should fetch exactly same message since it was not commited, but it moves on as you said. How to force to poll same message? I believe its more kafka-related knowledge not go/library itself."}, {"owner": {"reputation": 2583, "user_id": 3202696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/QmN8u.png?s=128&g=1", "display_name": "TobiSH", "link": "https://stackoverflow.com/users/3202696/tobish"}, "reply_to_user": {"reputation": 4354, "user_id": 1806005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ee889ac6797f1f23ebb955164162bd39?s=128&d=identicon&r=PG", "display_name": "freakman", "link": "https://stackoverflow.com/users/1806005/freakman"}, "edited": false, "score": 0, "creation_date": 1521458023, "post_id": 49361036, "comment_id": 85723165, "body": "Fully agree: This is not a go issue but a question of how kafka actually works. I updated my answer maybe that explains it a little better"}, {"owner": {"reputation": 4354, "user_id": 1806005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ee889ac6797f1f23ebb955164162bd39?s=128&d=identicon&r=PG", "display_name": "freakman", "link": "https://stackoverflow.com/users/1806005/freakman"}, "edited": false, "score": 0, "creation_date": 1521458681, "post_id": 49361036, "comment_id": 85723552, "body": "what I dont get is commit offset part. You wrote &quot;You submit the position (a.k.a offset) at this topic/partition&quot; and thats the problem - I don&#39;t submit it. I don&#39;t commit offset :) It moves on anyway on next valid message."}, {"owner": {"reputation": 2583, "user_id": 3202696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/QmN8u.png?s=128&g=1", "display_name": "TobiSH", "link": "https://stackoverflow.com/users/3202696/tobish"}, "reply_to_user": {"reputation": 4354, "user_id": 1806005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ee889ac6797f1f23ebb955164162bd39?s=128&d=identicon&r=PG", "display_name": "freakman", "link": "https://stackoverflow.com/users/1806005/freakman"}, "edited": false, "score": 0, "creation_date": 1521462250, "post_id": 49361036, "comment_id": 85725811, "body": "Again not a go-developer. But I would interpret this part of your code: <code>if err := msgFunc(m); err != nil {             log.Errorf(&quot;# messaging # cannot commit a message: %v&quot;, err)             continue         } </code> as following. When you hit an error just move on with the next message. If this one is valid commit the offset. So let&#39;s say we have 3 message on a topic (to keep it simple with one partition). Message 2 is invalid. You consumer m1 commit the offset, consume m2 don&#39;t commit the offset and than consume m3 and commit the offset again. So your commited offset is 3"}, {"owner": {"reputation": 4354, "user_id": 1806005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ee889ac6797f1f23ebb955164162bd39?s=128&d=identicon&r=PG", "display_name": "freakman", "link": "https://stackoverflow.com/users/1806005/freakman"}, "edited": false, "score": 0, "creation_date": 1521463028, "post_id": 49361036, "comment_id": 85726351, "body": "exactly, at last we are on the same page :) so commit offset m3 is ignoring that m2 was not commited. To fix that I believe I have to do some manual checks that I am only on position offset+1 before commiting."}, {"owner": {"reputation": 2583, "user_id": 3202696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/QmN8u.png?s=128&g=1", "display_name": "TobiSH", "link": "https://stackoverflow.com/users/3202696/tobish"}, "reply_to_user": {"reputation": 4354, "user_id": 1806005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ee889ac6797f1f23ebb955164162bd39?s=128&d=identicon&r=PG", "display_name": "freakman", "link": "https://stackoverflow.com/users/1806005/freakman"}, "edited": false, "score": 0, "creation_date": 1521464136, "post_id": 49361036, "comment_id": 85727153, "body": "You are consuming in a linear style. A simple mind model would be an array of messages and you can just remember until which element of this array you have processed the array. Does that help you?"}, {"owner": {"reputation": 2583, "user_id": 3202696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/QmN8u.png?s=128&g=1", "display_name": "TobiSH", "link": "https://stackoverflow.com/users/3202696/tobish"}, "reply_to_user": {"reputation": 4354, "user_id": 1806005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ee889ac6797f1f23ebb955164162bd39?s=128&d=identicon&r=PG", "display_name": "freakman", "link": "https://stackoverflow.com/users/1806005/freakman"}, "edited": false, "score": 0, "creation_date": 1521466060, "post_id": 49361036, "comment_id": 85728571, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/167093/discussion-between-tobish-and-freakman\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 2583, "user_id": 3202696, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/QmN8u.png?s=128&g=1", "display_name": "TobiSH", "link": "https://stackoverflow.com/users/3202696/tobish"}, "is_accepted": false, "score": 1, "last_activity_date": 1521462677, "last_edit_date": 1521462677, "creation_date": 1521456349, "answer_id": 49361036, "question_id": 49360325, "link": "https://stackoverflow.com/questions/49360325/kafka-consumer-group-loses-not-commited-messages/49361036#49361036", "title": "Kafka consumer group loses not commited messages", "body": "<p>In kafka you just submit offsets not single messages. If I understand your code right (not a go-developer). You just continue after you hit an invalid message. If after in invalid message a valid one appears you will submit the offset again - I guess that was not your intention. </p>\n\n<p>Just to make clear what does submitting or committing an offset means: Your consumer group will store the offset to a dedicated internal kafka topic (or on older kafka versions on zookeeper). An offset can identify a single position within a topic (or to be more precise on a partition of a given topic). This means you can only consume a topic in a linear fashion.  </p>\n\n<p>Here you can see what happens on kafka-consumer side:</p>\n\n<p><a href=\"https://i.stack.imgur.com/32esG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/32esG.png\" alt=\"New Kafka Consumer\"></a></p>\n\n<p>You are consuming from a (most likely multiple) stack(s) of messages. You submit the position (a.k.a offset) at this topic/partition. So you can <strong>not</strong> say I want to reconsume a specific message again. What you can do is to stop consuming once you hit an invalid message. In this case your problem will be: How do I get rid of this message. Deleting a single message from a kafka topic is tricky. A common pattern is to write this messages to some kind of dead-letter topic and deal with it with a different consumer.</p>\n\n<p>Hope that made things a little bit clearer to you.  </p>\n"}, {"tags": [], "owner": {"reputation": 911, "user_id": 1521224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04c24c4befec035ce91fe823759b043f?s=128&d=identicon&r=PG", "display_name": "Andrzej Purtak", "link": "https://stackoverflow.com/users/1521224/andrzej-purtak"}, "is_accepted": false, "score": 0, "last_activity_date": 1539768831, "creation_date": 1539768831, "answer_id": 52851635, "question_id": 49360325, "link": "https://stackoverflow.com/questions/49360325/kafka-consumer-group-loses-not-commited-messages/52851635#52851635", "title": "Kafka consumer group loses not commited messages", "body": "<p>It looks like your Kafka consumer is set up to commit offsets automatically (that's the default setting).<br>\nIf so, that's probably why your app skips over the erroneous message - despite the fact you skip <code>CommitMessages</code> invocation, commit is performed on a background thread<br>\nPlease check out <code>enable.auto.commit</code> property specification in the docs: <a href=\"https://kafka.apache.org/documentation/#newconsumerconfigs\" rel=\"nofollow noreferrer\">https://kafka.apache.org/documentation/#newconsumerconfigs</a></p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 10477050, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kVqR7.png?s=128&g=1", "display_name": "Henry Yang", "link": "https://stackoverflow.com/users/10477050/henry-yang"}, "is_accepted": false, "score": 1, "last_activity_date": 1540537330, "last_edit_date": 1540537330, "creation_date": 1540536063, "answer_id": 53002877, "question_id": 49360325, "link": "https://stackoverflow.com/questions/49360325/kafka-consumer-group-loses-not-commited-messages/53002877#53002877", "title": "Kafka consumer group loses not commited messages", "body": "<p>Here make sense to understand the concept of consumer offset. For running consumer app, it stores the offset of consumed messages in memory regardless of commit/uncommit offset, if restarting the consumer app, it will retrieve the offset of 'CURRENT-OFFSET' to continue with the consumption.</p>\n"}], "owner": {"reputation": 4354, "user_id": 1806005, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ee889ac6797f1f23ebb955164162bd39?s=128&d=identicon&r=PG", "display_name": "freakman", "link": "https://stackoverflow.com/users/1806005/freakman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2878, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1540537330, "creation_date": 1521454223, "last_edit_date": 1521456317, "question_id": 49360325, "link": "https://stackoverflow.com/questions/49360325/kafka-consumer-group-loses-not-commited-messages", "title": "Kafka consumer group loses not commited messages", "body": "<p>I am using consumer group with just one consumer, just one broker ( docker wurstmeister image ). It's decided in a code to commit offset or not - if code returns error then message is not commited. I need to ensure that system does not lose any message - even if that means retrying same msg forever ( for now ;) ). For testing this I have created simple handler which does not commit offset in case of 'error' string send as message to kafka. All other strings are commited. </p>\n\n<pre><code>kafka-console-producer --broker-list localhost:9092 --topic test\n&gt;this will be commited\n</code></pre>\n\n<p>Now running </p>\n\n<pre><code>kafka-run-class kafka.admin.ConsumerGroupCommand --bootstrap-server localhost:9092 --group michalgrupa --describe\n</code></pre>\n\n<p>returns</p>\n\n<pre><code>TOPIC                          PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG        CONSUMER-ID                                       HOST                           CLIENT-ID\ntest                           0          13              13              0\n</code></pre>\n\n<p>so thats ok, there is no lag. Now we pass 'error' string to fake that something bad happened and message is not commited:</p>\n\n<pre><code>TOPIC                          PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG        CONSUMER-ID                                       HOST                           CLIENT-ID\ntest                           0          13              14              1\n</code></pre>\n\n<p>Current offset stays at right position + there  is 1 lagged message. Now if we pass correct message again offset will move on to 15:</p>\n\n<p><code>TOPIC                          PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG\ntest                           0          15              15</code> </p>\n\n<p>and message number 14 will not be picked up ever again. Is it default behaviour? Do I need to trace last offset and load message by it+1 manually? I have set commit interval to 0 to hopefully not use any auto.commit mechanism.</p>\n\n<p>fetch/commit code:</p>\n\n<pre><code>go func() {\n    for {\n        ctx := context.Background()\n\n        m, err := mr.brokerReader.FetchMessage(ctx)\n        if err != nil {\n            break\n        }\n\n        if err := msgFunc(m); err != nil {\n            log.Errorf(\"# messaging # cannot commit a message: %v\", err)\n            continue\n        }\n\n        // commit message if no error\n        if err := mr.brokerReader.CommitMessages(ctx, m); err != nil {\n            // should we do something else to just logging not committed message?\n            log.Errorf(\"cannot commit message [%s] %v/%v: %s = %s; with error: %v\", m.Topic, m.Partition, m.Offset, string(m.Key), string(m.Value), err)\n        }\n    }\n}()\n</code></pre>\n\n<p>reader configuration:</p>\n\n<pre><code>kafkaReader := kafka.NewReader(kafka.ReaderConfig{\nBrokers:         brokers,\nGroupID:         groupID,\nTopic:           topic,\nCommitInterval:  0,\nMinBytes:        10e3,\nMaxBytes:        10e6,\n})\n</code></pre>\n\n<p>library used: <a href=\"https://github.com/segmentio/kafka-go\" rel=\"nofollow noreferrer\">https://github.com/segmentio/kafka-go</a></p>\n"}, {"tags": ["elasticsearch", "go", "elasticsearch-5"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521487662, "post_id": 49359510, "comment_id": 85742751, "body": "Adding Redis just for this seems totally unnecessary. That&#39;s a lot of development and operational overhead for what is very simple to implement with no new dependencies."}], "tags": [], "owner": {"reputation": 751, "user_id": 2675482, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/2tcA8.jpg?s=128&g=1", "display_name": "Averias", "link": "https://stackoverflow.com/users/2675482/averias"}, "is_accepted": false, "score": -1, "last_activity_date": 1521451817, "last_edit_date": 1592644375, "creation_date": 1521451458, "answer_id": 49359510, "question_id": 49358749, "link": "https://stackoverflow.com/questions/49358749/how-to-store-only-limited-number-of-doc-in-elasticsearch/49359510#49359510", "title": "How to store only limited number of doc in elasticsearch.", "body": "<p>I'm assuming you will have fixed names for documents, like 1, 2,...,10 or whatever. So one approach could be to use Redis to implement a circular list <a href=\"https://redis.io/commands/rpoplpush#pattern-circular-list\" rel=\"nofollow noreferrer\">https://redis.io/commands/rpoplpush#pattern-circular-list</a> (you can also implement your own algorithm to implement that circular list by code)</p>\n<p>So basically you should follow the next steps:</p>\n<ul>\n<li><p>You load those 10 values ordered in the circular list, let's say 1,2, 3, ... 10</p>\n</li>\n<li><p>When you want to store a document in Redis, you extract an element from the list, for our list that element will be <code>1</code></p>\n</li>\n<li><p>make a query count on your ElasticSearch index to get the number of the document in the index</p>\n</li>\n<li><p>if you get a count &lt; 10 you call insert document query with your data and with the number extracted from the list as the document name. If count = 10 you call update document query on ElasticSearch</p>\n<p>The circular will progress in this way:</p>\n</li>\n<li><p>The initial state of the list is <code>[1, 2, ...10]</code>. You extract <code>1</code> and after extracting it, it goes to the end of the list: <code>[2,3,..., 10,1]</code></p>\n</li>\n<li><p>Second extraction from the list, current state of the list: <code>[2, 3, ...10, 1]</code>. You extract <code>2</code> and after extracting it, it goes to the end of the list: <code>[3,4,..., 1,2]</code></p>\n</li>\n<li><p>and so on</p>\n</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 149, "user_id": 6175535, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec628e5c6433d604b9a47324ac08abdc?s=128&d=identicon&r=PG&f=1", "display_name": "Rajnish", "link": "https://stackoverflow.com/users/6175535/rajnish"}, "is_accepted": false, "score": 1, "last_activity_date": 1521459449, "creation_date": 1521459449, "answer_id": 49362049, "question_id": 49358749, "link": "https://stackoverflow.com/questions/49358749/how-to-store-only-limited-number-of-doc-in-elasticsearch/49362049#49362049", "title": "How to store only limited number of doc in elasticsearch.", "body": "<p>If you want to store only 10 doc then\n    you should apply algo = (document no%10)+1.\n    the return value is your elasticsearch _id field\n    the algo retyrn only 1 to 10. and always index it.</p>\n"}], "owner": {"reputation": 367, "user_id": 4422411, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0c814c955bffcac9b4c22371a0a84df8?s=128&d=identicon&r=PG&f=1", "display_name": "kish", "link": "https://stackoverflow.com/users/4422411/kish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1521459449, "creation_date": 1521448879, "question_id": 49358749, "link": "https://stackoverflow.com/questions/49358749/how-to-store-only-limited-number-of-doc-in-elasticsearch", "title": "How to store only limited number of doc in elasticsearch.", "body": "<p>I need to store only say 10 number docs under a particular index. And the 11th item should replace the old item i.e 1st item. So that i will be having only 10 doc at any time.\nI am using elacticsearch in golang</p>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 7445, "user_id": 1564365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2ff53772b33c8b0c305481ecb7e67141?s=128&d=identicon&r=PG", "display_name": "Kyslik", "link": "https://stackoverflow.com/users/1564365/kyslik"}, "edited": false, "score": 2, "creation_date": 1521447333, "post_id": 49358216, "comment_id": 85716600, "body": "I am not go-expert, what does the doc say?"}], "answers": [{"comments": [{"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1521448439, "post_id": 49358394, "comment_id": 85717152, "body": "I get it, thank you.The timer won&#39;t stop until I set a new value to it, right?"}, {"owner": {"reputation": 7445, "user_id": 1564365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2ff53772b33c8b0c305481ecb7e67141?s=128&d=identicon&r=PG", "display_name": "Kyslik", "link": "https://stackoverflow.com/users/1564365/kyslik"}, "reply_to_user": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1521448569, "post_id": 49358394, "comment_id": 85717215, "body": "Yes, <b>Each activity on the connection must therefore set a new deadline.</b> Good luck."}, {"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "edited": false, "score": 0, "creation_date": 1521450269, "post_id": 49358394, "comment_id": 85718226, "body": "sorry\uff0ci forget it\uff0ci have accepted it now. Thank you for your answer"}], "tags": [], "owner": {"reputation": 7445, "user_id": 1564365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2ff53772b33c8b0c305481ecb7e67141?s=128&d=identicon&r=PG", "display_name": "Kyslik", "link": "https://stackoverflow.com/users/1564365/kyslik"}, "is_accepted": true, "score": 3, "last_activity_date": 1521448595, "last_edit_date": 1592644375, "creation_date": 1521447453, "answer_id": 49358394, "question_id": 49358216, "link": "https://stackoverflow.com/questions/49358216/setdeadline-for-golang-tcp-connection/49358394#49358394", "title": "SetDeadline for golang tcp connection", "body": "<blockquote>\n<p>The Conn interface also has deadline settings; either for the connection as a whole (<code>SetDeadLine()</code>) or specific to read or write calls (<code>SetReadDeadLine()</code> and <code>SetWriteDeadLine()</code>).</p>\n<p>Note that the deadlines are fixed points in (wallclock) time. Unlike timeouts, they don\u2019t reset after a new activity. <strong>Each activity on the connection must therefore set a new deadline.</strong></p>\n</blockquote>\n<p>Emphasis mine.</p>\n<p>From <a href=\"https://appliedgo.net/networking/\" rel=\"nofollow noreferrer\">https://appliedgo.net/networking/</a> (second google search result).</p>\n"}], "owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2449, "favorite_count": 0, "accepted_answer_id": 49358394, "answer_count": 1, "score": 2, "last_activity_date": 1521448595, "creation_date": 1521446624, "question_id": 49358216, "link": "https://stackoverflow.com/questions/49358216/setdeadline-for-golang-tcp-connection", "title": "SetDeadline for golang tcp connection", "body": "<p>If I set a deadline to a tcp connection, and I read and write it successfully, and I keep it alive for subsequence communction, does the deadline affect the next reading/writing? Should I set deadline to 0 for a connection after reading from/writing to it?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 2959668, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WjPPW.jpg?s=128&g=1", "display_name": "Lincoln", "link": "https://stackoverflow.com/users/2959668/lincoln"}, "edited": false, "score": 3, "creation_date": 1529660460, "post_id": 49355523, "comment_id": 88964960, "body": "actually i think the last one might be dangerous when there is a race condition on <code>map2</code> object"}, {"owner": {"reputation": 2618, "user_id": 382564, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/o2wAN.jpg?s=128&g=1", "display_name": "Angad", "link": "https://stackoverflow.com/users/382564/angad"}, "edited": false, "score": 1, "creation_date": 1540910199, "post_id": 49355523, "comment_id": 93031793, "body": "The last one would most certainly ignore any semaphore internal to the <code>sync.Map</code> structure - request somebody to concur on this please"}, {"owner": {"reputation": 1226, "user_id": 1716905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf004baf04689322a8766ebc1efd5e07?s=128&d=identicon&r=PG&f=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/1716905/luke"}, "edited": false, "score": 0, "creation_date": 1568284773, "post_id": 49355523, "comment_id": 102229771, "body": "Manipulation of data inside a <code>sync.Map</code> should only occur via the provided functions. The last one does not do so and is therefore dangerous."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 10, "last_activity_date": 1521465887, "last_edit_date": 1521465887, "creation_date": 1521431376, "answer_id": 49355523, "question_id": 49355345, "link": "https://stackoverflow.com/questions/49355345/how-to-clean-a-sync-map/49355523#49355523", "title": "How to clean a sync.map?", "body": "<p>For example,</p>\n\n<pre><code>//erase map\nmap2.Range(func(key interface{}, value interface{}) bool {\n    map2.Delete(key)\n    return true\n})\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/PTASV3sEIxJ\" rel=\"noreferrer\">https://play.golang.org/p/PTASV3sEIxJ</a></p>\n\n<p><strong>Or</strong></p>\n\n<pre><code>//erase map\ndelete2 := func(key interface{}, value interface{}) bool {\n    map2.Delete(key)\n    return true\n}\nmap2.Range(delete2)\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/jd8dl71ee94\" rel=\"noreferrer\">https://play.golang.org/p/jd8dl71ee94</a></p>\n\n<p><strong>Or</strong></p>\n\n<pre><code>func eraseSyncMap(m *sync.Map) {\n    m.Range(func(key interface{}, value interface{}) bool {\n        m.Delete(key)\n        return true\n    })\n}\n\nfunc main() {\n    // . . .\n\n    //erase map\n    eraseSyncMap(&amp;map2)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/lCBkUv6GJIO\" rel=\"noreferrer\">https://play.golang.org/p/lCBkUv6GJIO</a></p>\n\n<p><strong>Or</strong></p>\n\n<pre><code>//erase map: A zero sync.Map is empty and ready for use.\nmap2 = sync.Map{}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/s-KYelDxqFB\" rel=\"noreferrer\">https://play.golang.org/p/s-KYelDxqFB</a></p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10614, "favorite_count": 6, "accepted_answer_id": 49355523, "answer_count": 1, "score": 8, "last_activity_date": 1521465887, "creation_date": 1521429671, "last_edit_date": 1521437687, "question_id": 49355345, "link": "https://stackoverflow.com/questions/49355345/how-to-clean-a-sync-map", "title": "How to clean a sync.map?", "body": "<p>I can't have access to map inside Range loop method. I just want an equivalente method of normal map apply in sync.map \n<a href=\"https://play.golang.org/p/515_MFqSvCm\" rel=\"noreferrer\">https://play.golang.org/p/515_MFqSvCm</a></p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n)\n\ntype list struct {\n    code string\n    fruit\n}\n\ntype fruit struct {\n    name     string\n    quantity int\n}\n\nfunc main() {\n    lists := []list{list{\"asd\", fruit{\"Apple\", 5}}, list{\"ajsnd\", fruit{\"Apple\", 10}}, list{\"ajsdbh\", fruit{\"Peach\", 15}}}\n    map1 := make(map[string]fruit)\n    var map2 sync.Map\n    for _, e := range lists {\n        map1[e.code] = e.fruit\n        map2.Store(e.code, e.fruit)\n    }\n\n    //erase map\n    for k, _ := range map1 {\n        delete(map1, k)\n    }\n\n    //can\u00b4t pass map as argument,so I can\u00b4t delete it\u00b4s values\n    map2.Range(aux)\n}\n\nfunc aux(key interface{}, value interface{}) bool {\n    map2.Delete(key) //doesn\u00b4t work\n    return true\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-pubsub"], "answers": [{"tags": [], "owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "is_accepted": true, "score": 0, "last_activity_date": 1521670399, "last_edit_date": 1521670399, "creation_date": 1521430360, "answer_id": 49355423, "question_id": 49355142, "link": "https://stackoverflow.com/questions/49355142/using-pubsub-with-golang-ocgrpc-newclientstatshandler/49355423#49355423", "title": "Using pubsub with golang: ocgrpc.NewClientStatsHandler", "body": "<p>It seems to have been an issue on the repo:</p>\n\n<blockquote>\n  <p>@naguibihab This is NOT a windows issue. This commit fixes the problem\n  be072a5. Short explanation: breaking changes where pushed on a minor\n  release of a google pubsub dependency:\n  census-instrumentation/opencensus-go@ac82455, method\n  NewClientStatsHandler was deleted. (They don't claim anywhere they\n  comply with semver).</p>\n</blockquote>\n\n<p>Here's the fix mentioned in that comment: <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go/commit/be072a5d1d73144ae0ce1071e9bd43d1ad221581\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/google-cloud-go/commit/be072a5d1d73144ae0ce1071e9bd43d1ad221581</a></p>\n"}, {"comments": [{"owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "edited": false, "score": 0, "creation_date": 1521670418, "post_id": 49416342, "comment_id": 85836594, "body": "Check my answer and see if that fixes your issue as well"}, {"owner": {"reputation": 105, "user_id": 4607009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93f7b4ccfbf544d4eb029657f2fad476?s=128&d=identicon&r=PG&f=1", "display_name": "torie", "link": "https://stackoverflow.com/users/4607009/torie"}, "reply_to_user": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "edited": false, "score": 0, "creation_date": 1521673534, "post_id": 49416342, "comment_id": 85837613, "body": "Looks like that fix is only on master currently, and I&#39;m not seeing a patch release (unless I&#39;m missing it?). I try to keep my dependencies pinned to releases rather than master, so the fix is still bumping down to 0.18.0 for me. Good to know there&#39;s already a fix for the next release though!"}, {"owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "edited": false, "score": 0, "creation_date": 1521677316, "post_id": 49416342, "comment_id": 85838694, "body": "Maybe fork and cherry pick that commit until it comes in a patch release"}], "tags": [], "owner": {"reputation": 105, "user_id": 4607009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93f7b4ccfbf544d4eb029657f2fad476?s=128&d=identicon&r=PG&f=1", "display_name": "torie", "link": "https://stackoverflow.com/users/4607009/torie"}, "is_accepted": false, "score": 1, "last_activity_date": 1521665703, "creation_date": 1521665703, "answer_id": 49416342, "question_id": 49355142, "link": "https://stackoverflow.com/questions/49355142/using-pubsub-with-golang-ocgrpc-newclientstatshandler/49416342#49416342", "title": "Using pubsub with golang: ocgrpc.NewClientStatsHandler", "body": "<p>I was having the same issue on mac, using \"cloud.google.com/go/pubsub\" version 0.19.0. The fix for me was bumping the version down to 0.18.0.</p>\n"}], "owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 49355423, "answer_count": 2, "score": 1, "last_activity_date": 1521670399, "creation_date": 1521427936, "question_id": 49355142, "link": "https://stackoverflow.com/questions/49355142/using-pubsub-with-golang-ocgrpc-newclientstatshandler", "title": "Using pubsub with golang: ocgrpc.NewClientStatsHandler", "body": "<p>I am following this tutorial to publish a topic to Pub/Sub from a golang project and here's the code I have for that project at the moment:</p>\n\n<pre><code>package main\n\nimport \"cloud.google.com/go/pubsub\"\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"hello, world\\n\")\n}\n</code></pre>\n\n<p>All it does is simply imports the pubsub but when I run <code>go get</code> I get this error: <code>undefined: ocgrpc.NewClientStatsHandler</code></p>\n\n<pre><code>C:\\Users\\iha001\\Dev\\golang-projects\\src\\github.com\\naguibihab\\golang-playarea\\src\\gcloud&gt;go get\n# cloud.google.com/go/pubsub\n..\\..\\..\\..\\..\\cloud.google.com\\go\\pubsub\\go18.go:34:51: undefined: ocgrpc.NewClientStatsHandler\n</code></pre>\n\n<p>Is there anything else I need to install to get this running?</p>\n"}, {"tags": ["go", "data-structures", "struct"], "comments": [{"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "edited": false, "score": 0, "creation_date": 1521420799, "post_id": 49354290, "comment_id": 85709064, "body": "Can you give a more complete example?  Is this all of the code?"}, {"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "edited": false, "score": 0, "creation_date": 1521420893, "post_id": 49354290, "comment_id": 85709081, "body": "Appending a D to A is not correct to say.  You are really choosing a B to append a D to.  There may be many Bs since A.B is a slice of structs"}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 5220635, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/394ff627390019800c2611edf3d0b340?s=128&d=identicon&r=PG&f=1", "display_name": "Charlie Getzen", "link": "https://stackoverflow.com/users/5220635/charlie-getzen"}, "edited": false, "score": 0, "creation_date": 1521422492, "post_id": 49354355, "comment_id": 85709395, "body": "How would you create <code>anotherD</code>, given you have <code>E string</code> and <code>G string</code>?"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "reply_to_user": {"reputation": 65, "user_id": 5220635, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/394ff627390019800c2611edf3d0b340?s=128&d=identicon&r=PG&f=1", "display_name": "Charlie Getzen", "link": "https://stackoverflow.com/users/5220635/charlie-getzen"}, "edited": false, "score": 1, "creation_date": 1521443462, "post_id": 49354355, "comment_id": 85714906, "body": "@CharlieGetzen You will have to create new anonymous struct definitions in the <code>append()</code>, e.g. <code>a.B = append(a.B, struct{ C string }{&quot;value&quot;})</code>. It&#39;s cumbersome and a good reason to avoid anonymous structs in cases like this, especially if it&#39;s more complex than just one or two simple fields."}, {"owner": {"reputation": 65, "user_id": 5220635, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/394ff627390019800c2611edf3d0b340?s=128&d=identicon&r=PG&f=1", "display_name": "Charlie Getzen", "link": "https://stackoverflow.com/users/5220635/charlie-getzen"}, "edited": false, "score": 0, "creation_date": 1521495852, "post_id": 49354355, "comment_id": 85746874, "body": "Thank you! Exactly what I was looking for. I&#39;m assuming it would be recommended to split out that struct and reference it by name instead of nesting?"}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 3, "last_activity_date": 1521420620, "creation_date": 1521420620, "answer_id": 49354355, "question_id": 49354290, "link": "https://stackoverflow.com/questions/49354290/how-to-append-a-substruct-to-a-list-in-go/49354355#49354355", "title": "How to append a &quot;sub&quot;struct to a list in go", "body": "<p>Since <code>B</code> is a slice of structs, it has no <code>D</code> attribute directly.  There could be a variable number of <code>B</code>'s:</p>\n\n<pre><code>type A struct {\n  B []struct {\n    C string\n    D []struct {\n      E string\n      F []struct {\n        G string\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>Since <code>B</code> is a slice the entry below assumes you'd like to append a new <code>D</code> to the first <code>B</code>:</p>\n\n<pre><code>A.B[0].D = append(A.B[0].D, anotherD)\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 5220635, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/394ff627390019800c2611edf3d0b340?s=128&d=identicon&r=PG&f=1", "display_name": "Charlie Getzen", "link": "https://stackoverflow.com/users/5220635/charlie-getzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 240, "favorite_count": 0, "accepted_answer_id": 49354355, "answer_count": 1, "score": 0, "last_activity_date": 1521422759, "creation_date": 1521420061, "last_edit_date": 1521422759, "question_id": 49354290, "link": "https://stackoverflow.com/questions/49354290/how-to-append-a-substruct-to-a-list-in-go", "title": "How to append a &quot;sub&quot;struct to a list in go", "body": "<pre><code>type A struct {\n  B []struct {\n    C string\n    D []struct {\n      E string\n      F []struct {\n        G string\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>Lets say I have an instance of struct A, and I want to \nappend a struct D into it. I would try to do something like</p>\n\n<pre><code>var a A;\n...\na.B.D = append(a.B.D, ???)\n</code></pre>\n\n<p>??? = A.B.D</p>\n\n<p>--> type A has no method B</p>\n\n<p>??? = D</p>\n\n<p>--> undefined: D</p>\n\n<p>--- Edit for more complete example ---</p>\n\n<pre><code>type A struct {\n  B []struct {\n    C string\n    D hugeNestedElement\n  }\n}\n\nvar a A\n// Goal is to create many B's\na = append(a, what_goes_here)\n// or ...\na = append(a.B, what_goes_here)\n</code></pre>\n"}, {"tags": ["go", "godoc"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1267177"}, "edited": false, "score": 0, "creation_date": 1521429295, "post_id": 49352238, "comment_id": 85710822, "body": "hmm, are you hosting the docs yourself? or do you expect this to stay in go doc reference?"}, {"owner": {"reputation": 85, "user_id": 6434929, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-khtDb2bMEHo/AAAAAAAAAAI/AAAAAAAABI4/NtwwH8HAODs/photo.jpg?sz=128", "display_name": "Ali Dabour", "link": "https://stackoverflow.com/users/6434929/ali-dabour"}, "edited": false, "score": 0, "creation_date": 1521430250, "post_id": 49352238, "comment_id": 85711014, "body": "I think it will be a separate repository holding the documents (HTML Files) for this project, so any one of the team could easily read it"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1267177"}, "edited": false, "score": 0, "creation_date": 1521433146, "post_id": 49352238, "comment_id": 85711617, "body": "<a href=\"https://stackoverflow.com/a/38338422/1267177\">stackoverflow.com/a/38338422/1267177</a> might help, maybe have a look, or I&#39;d do some bash scripting and generate in CI server."}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 1, "last_activity_date": 1533819610, "creation_date": 1533819610, "answer_id": 51767750, "question_id": 49352238, "link": "https://stackoverflow.com/questions/49352238/how-can-i-generate-html-documents-for-all-packages-inside-a-folder-using-godoc/51767750#51767750", "title": "How can I generate HTML documents for all packages inside a folder using godoc", "body": "<p>You have two questions here:</p>\n\n<blockquote>\n  <p>Is it possible to generate HTML pages for all packages linked together through godoc -html?</p>\n</blockquote>\n\n<p>No. Because it is not implemented into godoc (<a href=\"https://godoc.org/golang.org/x/tools/cmd/godoc\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/tools/cmd/godoc</a>).</p>\n\n<p>The other question:</p>\n\n<blockquote>\n  <p>How can I generate HTML documents for all packages inside a folder\n  using godoc</p>\n</blockquote>\n\n<p>I think the simplest way is to start godoc with the http flag: <code>godoc -http=:6060</code></p>\n\n<p>Then you navigate to the folder you want to get the docs. For that url you can use a webcrawler for getting the html documentation. There are already some crawler in Go (<a href=\"https://godoc.org/?q=crawler\" rel=\"nofollow noreferrer\">https://godoc.org/?q=crawler</a>), if you don't want to write a crawler by your own.</p>\n"}, {"tags": [], "owner": {"reputation": 77, "user_id": 3715832, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06a916c22108f0a8668e91440dc9515f?s=128&d=identicon&r=PG&f=1", "display_name": "T.L", "link": "https://stackoverflow.com/users/3715832/t-l"}, "is_accepted": false, "score": 0, "last_activity_date": 1610943679, "last_edit_date": 1610943679, "creation_date": 1600189161, "answer_id": 63906628, "question_id": 49352238, "link": "https://stackoverflow.com/questions/49352238/how-can-i-generate-html-documents-for-all-packages-inside-a-folder-using-godoc/63906628#63906628", "title": "How can I generate HTML documents for all packages inside a folder using godoc", "body": "<p>I developed <a href=\"https://github.com/go101/golds\" rel=\"nofollow noreferrer\">Golds</a>, which is an alternate Go docs generation tool (and a local docs server / code reader). Hope you this tool would satisfy your need.</p>\n<p>Under your project directory, you can run any of the following commands to generate HTML docs for your Go project:</p>\n<ul>\n<li>golds -gen -nouses -plainsrc -wdpkgs-listing=promoted ./...</li>\n<li>golds -gen -nouses -wdpkgs-listing=promoted ./...</li>\n<li>golds -gen -wdpkgs-listing=promoted ./...</li>\n</ul>\n<p>The first command generates the most compact docs and the last one generates the full docs, which size is 6 times of the compact docs.</p>\n"}], "owner": {"reputation": 85, "user_id": 6434929, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-khtDb2bMEHo/AAAAAAAAAAI/AAAAAAAABI4/NtwwH8HAODs/photo.jpg?sz=128", "display_name": "Ali Dabour", "link": "https://stackoverflow.com/users/6434929/ali-dabour"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1415, "favorite_count": 0, "accepted_answer_id": 51767750, "answer_count": 2, "score": 3, "last_activity_date": 1610943679, "creation_date": 1521402957, "last_edit_date": 1521412145, "question_id": 49352238, "link": "https://stackoverflow.com/questions/49352238/how-can-i-generate-html-documents-for-all-packages-inside-a-folder-using-godoc", "title": "How can I generate HTML documents for all packages inside a folder using godoc", "body": "<p><code>godoc -html</code> generates documents for only one package.  However, I want to ship the project with all documents for all packages, just like when I run <code>godoc -http</code>.  With that, I could find all packages and navigate through them from the browser.</p>\n\n<p>Is it possible to generate HTML pages for all packages <strong>linked together</strong> through <code>godoc -html</code>?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1521399163, "post_id": 49351605, "comment_id": 85703121, "body": "A regular expression which will return false could even be <code>.*</code>, which doesn&#39;t make any sense. Sample input would be, basically a big HTML file. Though, it escapes string at times with \\n? Is that an issue?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1521399938, "post_id": 49351605, "comment_id": 85703403, "body": "Compiling expressions is expensive and slow. Don&#39;t compile the same expression for every line; re-use it."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1521399669, "last_edit_date": 1521399669, "creation_date": 1521399369, "answer_id": 49351696, "question_id": 49351605, "link": "https://stackoverflow.com/questions/49351605/golang-regular-expression-always-returns-false/49351696#49351696", "title": "Golang Regular expression always returns false?", "body": "<p>The call <code>userRegexp, _ := reader.ReadString('\\n')</code> returns a string with a trailing newline.  Trim the newline:</p>\n\n<pre><code> userRegexp, err := reader.ReadString('\\n')\n if err != nil {\n    // handle error\n }\n userRegexp = userRegexp[:len(userRegexp)-1]\n</code></pre>\n\n<p>Here's the code with some other improvements (compile regexp once, use scanner Bytes):</p>\n\n<pre><code>// User input from command line\nreader := bufio.NewReader(os.Stdin)\nfmt.Print(\"Enter regexp: \")\nuserRegexp, err := reader.ReadString('\\n')\nif err != nil {\n    log.Fatal(err)\n}\nuserRegexp = userRegexp[:len(userRegexp)-1]\nre, err := regexp.Compile(userRegexp)\nif err != nil {\n    log.Fatal(err)\n}\n\n// List all .html files in static dir\nfiles, err := filepath.Glob(\"static/*.html\")\nif err != nil {\n    log.Fatal(err)\n}\n\n// Empty array of int64's to be returned with matching results\nvar lineIdArr []int64\n\nfor _, file := range files {\n    htmlFile, _ := os.Open(file)\n    fscanner := bufio.NewScanner(htmlFile)\n    // Loop over each line\n    for fscanner.Scan() {\n        line := fscanner.Bytes()\n        if !re.Match(line) {\n            continue\n        }\n        lineIdStr := line[:bytes.IndexByte(line, ':')]\n        lineIdInt, err := strconv.ParseInt(string(lineIdStr), 10, 64)\n        if err != nil {\n            log.Fatal(err)\n        }\n        lineIdArr = append(lineIdArr, lineIdInt)\n    }\n}\nfmt.Println(\"Return array: \", lineIdArr)\nfmt.Println(\"Using regular expression: \", userRegexp)\n</code></pre>\n"}], "owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 0, "accepted_answer_id": 49351696, "answer_count": 1, "score": 0, "last_activity_date": 1521399669, "creation_date": 1521398700, "question_id": 49351605, "link": "https://stackoverflow.com/questions/49351605/golang-regular-expression-always-returns-false", "title": "Golang Regular expression always returns false?", "body": "<p>I am taking a user input(a regular expression), and checking to see if a given line of a file would match it. I then return some ID if there's a match(the ID of the line), and that's about it. However, it appears as my <code>match</code> always returns false? But, interestingly, if I throw a wildcard <code>.*</code>, the program will take significantly longer to execute than a specific regular expression. So, there must be something going on -- why does it always return false?</p>\n\n<p>Sample code:</p>\n\n<pre><code>func main() {\n\n    // User input from command line\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Enter regexp: \")\n    userRegexp, _ := reader.ReadString('\\n')\n\n    // List all .html files in static dir\n    files, err := filepath.Glob(\"static/*.html\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Empty array of int64's to be returned with matching results\n    var lineIdArr []int64\n\n    for _, file := range files {\n        htmlFile, _ := os.Open(file)\n        fscanner := bufio.NewScanner(htmlFile)\n\n        // Loop over each line\n        for fscanner.Scan() {\n\n            line := fscanner.Text()\n\n            match := matchLineByValue(userRegexp, line) // This is always false?\n\n            // ID is always the first item. Seperate by \":\" and cast it to int64.\n            lineIdStr := line[:strings.IndexByte(line, ':')]\n            lineIdInt, err := strconv.ParseInt(lineIdStr, 10, 64)\n\n            if err != nil {\n                panic(err)\n            }\n\n            // If matched, append ID to lineIdArr\n            if match {\n                lineIdArr = append(lineIdArr, lineIdInt)\n            }\n        }\n    }\n    fmt.Println(\"Return array: \", lineIdArr)\n    fmt.Println(\"Using regular expression: \", userRegexp)\n}\n\nfunc matchLineByValue(re string, s string) bool {\n    return regexp.MustCompile(re).MatchString(s)\n}\n</code></pre>\n\n<p>is <code>regexp.MustCompile(re).MatchString(s)</code> not the right way to construct a regular expression from user input and match it to a whole line? </p>\n\n<p>The string it matches is fairly long(it's basically a whole html file), would that present an issue?</p>\n"}, {"tags": ["javascript", "go", "xmlhttprequest", "http-headers"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1521393062, "post_id": 49350650, "comment_id": 85701032, "body": "Take a look at this <a href=\"https://stackoverflow.com/questions/49338485/how-to-post-a-json-request-and-recieve-json-response-to-go-server-go-language\">post</a>. Post man is smart enough to add missing headers for you. But in code you have to add it by yourself"}, {"owner": {"reputation": 11, "user_id": 9512719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Priya S", "link": "https://stackoverflow.com/users/9512719/priya-s"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521393711, "post_id": 49350650, "comment_id": 85701259, "body": "I have copied same the code from Post man but when I run in console I&#39;m getting error"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521394394, "post_id": 49350650, "comment_id": 85701514, "body": "what error ? post it here the error you are getting"}, {"owner": {"reputation": 11, "user_id": 9512719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Priya S", "link": "https://stackoverflow.com/users/9512719/priya-s"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521394658, "post_id": 49350650, "comment_id": 85701618, "body": "OPTIONS <a href=\"http://localhost:8000/calculate\" rel=\"nofollow noreferrer\">localhost:8000/calculate</a> 405 (Method Not Allowed) (anonymous) @ VM44:21 calci.html:1 Failed to load <a href=\"http://localhost:8000/calculate\" rel=\"nofollow noreferrer\">localhost:8000/calculate</a>: Response for preflight has invalid HTTP status code 405."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1521402284, "post_id": 49350650, "comment_id": 85704305, "body": "This is a VERY good question. Please upvote. Since postman normally does not do a preflight request things are perfectly fine in postman but fail when used from javascript for example."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9512719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Priya S", "link": "https://stackoverflow.com/users/9512719/priya-s"}, "edited": false, "score": 0, "creation_date": 1521395310, "post_id": 49350949, "comment_id": 85701873, "body": "calci.js:73 OPTIONS <a href=\"http://localhost:8000/calculate\" rel=\"nofollow noreferrer\">localhost:8000/calculate</a> 405 (Method Not Allowed) UserAction @ calci.js:73 (anonymous) @ calci.js:80 calci.html:1 Failed to load <a href=\"http://localhost:8000/calculate\" rel=\"nofollow noreferrer\">localhost:8000/calculate</a>: Response to preflight request doesn&#39;t pass access control check: The value of the &#39;Access-Control-Allow-Origin&#39; header in the response must not be the wildcard &#39;*&#39; when the request&#39;s credentials mode is &#39;include&#39;. Origin &#39;null&#39; is therefore not allowed access. The credentials mode of requests initiated by the XMLHttpRequest is controlled by the withCredentials attribute.   I&#39;m getting this error"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 11, "user_id": 9512719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Priya S", "link": "https://stackoverflow.com/users/9512719/priya-s"}, "edited": false, "score": 0, "creation_date": 1521398680, "post_id": 49350949, "comment_id": 85702965, "body": "have you tried my code for both javascript and go. You should remove wildcard from <code>Access-Control-Allow-Origin</code> header"}, {"owner": {"reputation": 11, "user_id": 9512719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Priya S", "link": "https://stackoverflow.com/users/9512719/priya-s"}, "edited": false, "score": 0, "creation_date": 1521399756, "post_id": 49350949, "comment_id": 85703343, "body": "I have tried your code but i didnt get ans. how to remove wildcards??"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 11, "user_id": 9512719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Priya S", "link": "https://stackoverflow.com/users/9512719/priya-s"}, "edited": false, "score": 0, "creation_date": 1521399974, "post_id": 49350949, "comment_id": 85703422, "body": "I have already removed wildcard and added the host <code>localhost</code> along with port number in the <code>access-control-allow-origin</code> header"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 11, "user_id": 9512719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Priya S", "link": "https://stackoverflow.com/users/9512719/priya-s"}, "edited": false, "score": 0, "creation_date": 1521402551, "post_id": 49350949, "comment_id": 85704384, "body": "Try using curl if it works. Use this <code>curl -H &quot;Content-Type: application&#47;json&quot; -X POST -d &#39;{&quot;Operand1&quot;: &quot;2.6&quot;, &quot;Operand2&quot;: &quot;2.4&quot;, &quot;Operator&quot;: &quot;+&quot;}&#39; http:&#47;&#47;localhost:8000&#47;calculate</code>. Everything is working in my machine."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1521397741, "last_edit_date": 1521397741, "creation_date": 1521394623, "answer_id": 49350949, "question_id": 49350650, "link": "https://stackoverflow.com/questions/49350650/response-to-preflight-request-doesnt-pass-access-control-check-the-value-of-th/49350949#49350949", "title": "Response to preflight request doesn&#39;t pass access control check: The value of the &#39;Access-", "body": "<p>Whenever you are setting xhr request with credentials to true. It is a security loop hole to allow cross origin request for all domains using wild card <code>*</code>. So add <code>http://localhost:8000/</code> to the <code>Access-Control-Allow-Origin</code>.</p>\n\n<pre><code>var xhr = new XMLHttpRequest();\n\nxhr.addEventListener(\"readystatechange\", function () {\n  if (this.readyState === 4) {\n    console.log(this.responseText);\n  }\n});\n\nxhr.open(\"POST\", \"http://localhost:8000/calculate\");\nxhr.setRequestHeader(\"Content-Type\", \"application/json\");\nxhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\nxhr.setRequestHeader(\"Access-Control-Allow-Origin\", \"http://localhost:8000\");\nxhr.setRequestHeader(\"Access-Control-Allow-Methods\", \"POST\");\nxhr.withCredentials = true;\nxhr.send(data);\n</code></pre>\n\n<p>Also in header in go lang code allow for <code>http://localhost:8000</code>:</p>\n\n<pre><code>func do_Calculation(w http.ResponseWriter, r *http.Request) {\n    var cal Calculate\n    var ans Answer\n    fmt.Println(\"Request Reached\")\n    w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n    w.Header().Set(\"Access-Control-Allow-Methods\", \"POST, GET, OPTIONS, PUT, DELETE\")\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"http://localhost:8000\")\n    w.WriteHeader(http.StatusOK)\n    json.NewDecoder(r.Body).Decode(&amp;cal)\n    // my stuff\n    // res := do_Operations(convertToFloat(cal.Operand1),convertToFloat(cal.Operand2),cal.Operator)\n    // ans = Answer{Res: floattostrwithprec(res, 4)}\n    json.NewEncoder(w).Encode(ans)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1521578425, "post_id": 49352142, "comment_id": 85789138, "body": "any news on this Priya? Anything I can help?"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 1, "last_activity_date": 1521455404, "last_edit_date": 1521455404, "creation_date": 1521402152, "answer_id": 49352142, "question_id": 49350650, "link": "https://stackoverflow.com/questions/49350650/response-to-preflight-request-doesnt-pass-access-control-check-the-value-of-th/49352142#49352142", "title": "Response to preflight request doesn&#39;t pass access control check: The value of the &#39;Access-", "body": "<p>A preflight request is a request to the server BEFORE the actual GET/POST/PUT/etc. It is of type OPTIONS to check if cross origin is allowed or not. Your server obviously does not implement a OPTIONS call as it says in your javascript error: <code>OPTIONS localhost:8000/calculate 405 (Method Not Allowed)</code></p>\n\n<p>Since this is an extra request with method OPTIONS it will never arrive in <code>do_Calculation</code> handler. So you cannot fix the problem there.</p>\n\n<p>What you have to do is register a global handler <code>/</code> of type OPTIONS and return the correct header information in there.</p>\n\n<p>If you are using gin or gorilla or another router they might have an easy way of setting up such a handler. If you do not use a special router or want to do it manually, check <a href=\"https://husobee.github.io/golang/cors/2015/09/26/cors.html\" rel=\"nofollow noreferrer\">here</a> for what headers are expected by an OPTIONS call.</p>\n\n<p>In Javascript I don't think you have to set any special headers but I wouldn't bet on it. Last time I implemented this I only implemented the go server side.</p>\n\n<p>I used it with gin and simply had to use the following code:</p>\n\n<pre><code>CORSHandler = cors.New(cors.Config{\n    AllowAllOrigins:  true,\n    AllowMethods:     []string{\"GET\", \"POST\", \"PUT\", \"DELETE\", \"HEAD\"},\n    AllowHeaders:     []string{\"Origin\", \"Content-Length\", \"Content-Type\"},\n    AllowCredentials: false,\n    MaxAge:           12 * time.Hour,\n})\nrouter.Use(CORSHandler)\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9512719, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Priya S", "link": "https://stackoverflow.com/users/9512719/priya-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6198, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1521455404, "creation_date": 1521392917, "last_edit_date": 1521395947, "question_id": 49350650, "link": "https://stackoverflow.com/questions/49350650/response-to-preflight-request-doesnt-pass-access-control-check-the-value-of-th", "title": "Response to preflight request doesn&#39;t pass access control check: The value of the &#39;Access-", "body": "<p>I have created an API using Go. It's working fine in postman but not when consumed using javascript. When I post request using javascript I'm getting an error saying that Access-Control-Allow-Origin is set to null.</p>\n\n<p>go API code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n)\n\ntype Calculate struct {\n    Operand1  string   `json:\"Operand1,omitempty\"`\n    Operand2 string   `json:\"Operand2,omitempty\"`\n    Operator  string   `json:\"Operator,omitempty\"`\n}\n\ntype Answer struct {\n    Res string  `json:\"Res,omitempty\"`\n}\n\n\nfunc do_Calculation(w http.ResponseWriter, r *http.Request) {\n    var cal Calculate\n    var ans Answer\n    fmt.Println(\"Request Reached\")\n    w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.WriteHeader(http.StatusOK)\n    json.NewDecoder(r.Body).Decode(&amp;cal)\n    // my stuff\n    // res := do_Operations(convertToFloat(cal.Operand1),convertToFloat(cal.Operand2),cal.Operator)\n    // ans = Answer{Res: floattostrwithprec(res, 4)}\n    json.NewEncoder(w).Encode(ans)\n}\n\n\n\n// main function to boot up everything\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/calculate\", do_Calculation).Methods(\"POST\")\n    fmt.Println(\"Server online at port :8000\")\n    log.Fatal(http.ListenAndServe(\":8000\", router))\n}\n</code></pre>\n\n<p>javascript code:</p>\n\n<pre><code>var data = JSON.stringify({\n  \"Operand1\": \"2.6\",\n  \"Operand2\": \"2.4\",\n  \"Operator\": \"+\"\n});\n\nvar xhr = new XMLHttpRequest();\n\nxhr.addEventListener(\"readystatechange\", function () {\n  if (this.readyState === 4) {\n    console.log(this.responseText);\n  }\n});\n\nxhr.open(\"POST\", \"http://localhost:8000/calculate\");\nxhr.setRequestHeader(\"Content-Type\", \"application/json\");\nxhr.setRequestHeader(\"Cache-Control\", \"no-cache\");\nxhr.setRequestHeader(\"Access-Control-Allow-Origin\", \"*\");\nxhr.setRequestHeader(\"Access-Control-Allow-Methods\", \"POST\");\nxhr.withCredentials = true;\nxhr.send(data);\n</code></pre>\n\n<p>error:</p>\n\n<blockquote>\n  <p>Failed to load <a href=\"http://127.0.0.1:8000/calculate\" rel=\"nofollow noreferrer\">http://127.0.0.1:8000/calculate</a>: Response to preflight\n  request doesn't pass access control check: The value of the\n  'Access-Control-Allow-Origin' header in the response must not be the\n  wildcard '*' when the request's credentials mode is 'include'. Origin\n  'null' is therefore not allowed access. The credentials mode of\n  requests initiated by the XMLHttpRequest is controlled by the\n  withCredentials attribute.</p>\n</blockquote>\n"}, {"tags": ["multithreading", "go", "mutex", "race-condition"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521388569, "post_id": 49349527, "comment_id": 85699525, "body": "The documentation states \u201cWithin a single goroutine, reads and writes must behave as if they executed in the order specified by the program\u201d, so once <code>doneCh</code> is closed, <code>err</code> must have been written."}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 0, "creation_date": 1521471484, "post_id": 49349527, "comment_id": 85732486, "body": "Why creating a <code>struct</code> with a channel to signal the end and some value to read instead of using the channel to send the value? Channels are thread-safe by construction, structs aren&#39;t, make use of them."}, {"owner": {"reputation": 55, "user_id": 9132270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a88cd190408bb73943eca7b3e338f220?s=128&d=identicon&r=PG&f=1", "display_name": "George Robinson", "link": "https://stackoverflow.com/users/9132270/george-robinson"}, "reply_to_user": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 0, "creation_date": 1521577274, "post_id": 49349527, "comment_id": 85788500, "body": "@Adirio because I&#39;m using it more like a context. There are other functions for Result (it&#39;s also not called Result) that are removed from the example above as the extra code isn&#39;t relevant to the question at hand."}, {"owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "edited": false, "score": 0, "creation_date": 1521621291, "post_id": 49349527, "comment_id": 85804134, "body": "Could you then edit yoru answer to include a bit more detail (still keeping it simple if you wish) that would retain you from using the answer I gave you? You are probably able to send a more complex type than <code>error</code> through the channel to get the result you want."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 9132270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a88cd190408bb73943eca7b3e338f220?s=128&d=identicon&r=PG&f=1", "display_name": "George Robinson", "link": "https://stackoverflow.com/users/9132270/george-robinson"}, "edited": false, "score": 0, "creation_date": 1521389178, "post_id": 49349925, "comment_id": 85699702, "body": "Great! Thanks for the link too, looks like an exact mirror of the code above! :-)"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1521388591, "creation_date": 1521388591, "answer_id": 49349925, "question_id": 49349527, "link": "https://stackoverflow.com/questions/49349527/is-this-go-code-thread-safe-or-do-i-need-a-mutex/49349925#49349925", "title": "Is this Go code thread safe or do I need a mutex?", "body": "<p>The compiler may not reorder the assignment and close statement, so you do not need a mutex if callers are well-behaved and do as instructed by your docs.</p>\n\n<p>This is explained in <a href=\"https://golang.org/ref/mem#tmp_7\" rel=\"nofollow noreferrer\">The Go Memory Model, Channel Communication</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 3735, "user_id": 97672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0d5a68d9b32452f7e76f7efe602e8fd?s=128&d=identicon&r=PG", "display_name": "darkliquid", "link": "https://stackoverflow.com/users/97672/darkliquid"}, "is_accepted": false, "score": 4, "last_activity_date": 1521389152, "creation_date": 1521389152, "answer_id": 49350009, "question_id": 49349527, "link": "https://stackoverflow.com/questions/49349527/is-this-go-code-thread-safe-or-do-i-need-a-mutex/49350009#49350009", "title": "Is this Go code thread safe or do I need a mutex?", "body": "<p>It is thread-safe only if your comments are obeyed and <code>Err()</code> is never called until a read from <code>Done()</code> returns.</p>\n\n<p>You could simply make <code>Err()</code> blocking though by re-implementing it as:</p>\n\n<pre><code>func (r *Result) Err() error {\n    &lt;-r.doneCh\n    return r.err\n}\n</code></pre>\n\n<p>Which would guarantee that <code>Err()</code> only returns after done is complete. Given that err will be nil until the work errors, you have no way of telling if <code>Err()</code> is returning successfully because work was finished or because it hasn't completed or errored yet unless you block on <code>Done()</code> first, in which case why not just make <code>Err()</code> blocking?</p>\n"}, {"tags": [], "owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "is_accepted": false, "score": 0, "last_activity_date": 1521471419, "creation_date": 1521471419, "answer_id": 49365932, "question_id": 49349527, "link": "https://stackoverflow.com/questions/49349527/is-this-go-code-thread-safe-or-do-i-need-a-mutex/49365932#49365932", "title": "Is this Go code thread safe or do I need a mutex?", "body": "<p>Have you tried using <code>chan error</code> and testing if the channel is opened or closed on reception?</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\nfunc delegate(work func(ch chan error)) {\n    ch := make(chan error)\n\n    go work(ch)\n\n    for {\n        err, opened := &lt;- ch\n        if !opened {\n            break\n        }\n        // Handle errors\n        fmt.Println(err)\n    }\n}\n\nfunc main() {\n    // Example: error\n    delegate(func(ch chan error) {\n        defer close(ch)\n        // Do some work\n        fmt.Println(\"Something went wrong.\")\n        ch &lt;- errors.New(\"Eyyyyy\")\n    })\n\n    // Example: success\n    delegate(func(ch chan error) {\n        defer close(ch)\n        // Do some work\n        fmt.Println(\"Everything went fine.\")\n    })\n\n    // Example: error\n    delegate(func(ch chan error) {\n        defer close(ch)\n        // Do some work\n        fmt.Println(\"Something went wrong more than once.\")\n        ch &lt;- errors.New(\"Eyyyyy 1\")\n        ch &lt;- errors.New(\"Eyyyyy 2\")\n        ch &lt;- errors.New(\"Eyyyyy 3\")\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 9132270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a88cd190408bb73943eca7b3e338f220?s=128&d=identicon&r=PG&f=1", "display_name": "George Robinson", "link": "https://stackoverflow.com/users/9132270/george-robinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 853, "favorite_count": 1, "accepted_answer_id": 49349925, "answer_count": 3, "score": 1, "last_activity_date": 1521471419, "creation_date": 1521386167, "question_id": 49349527, "link": "https://stackoverflow.com/questions/49349527/is-this-go-code-thread-safe-or-do-i-need-a-mutex", "title": "Is this Go code thread safe or do I need a mutex?", "body": "<p>Suppose I have the following function, <code>doWork</code>, that starts some work in a goroutine and returns a <code>Result</code> to check for completion and error:  </p>\n\n<pre><code>func doWork() *Result {\n    r := Result{doneCh: make(chan struct{})}\n    go func() {\n        var err error\n        defer func() {\n            r.err = err\n            close(r.doneCh)\n        }()\n        // do some work\n    }()\n    return &amp;r\n}\n</code></pre>\n\n<p>where <code>Result</code> is the following struct:</p>\n\n<pre><code>type Result struct {\n    doneCh      chan struct{}\n    err         error\n}\n// doneCh returns a closed chan when the work is done.\nfunc (r *Result) Done() &lt;-chan struct{} {\n    return r.doneCh\n}\n// Err returns a non-nil err if the work failed.\n// Don't call Err until Done returns a closed chan.\nfunc (r *Result) Err() error {\n    return r.err\n}\n</code></pre>\n\n<p>is this code thread safe if I set <code>err</code> before closing <code>doneCh</code>:</p>\n\n<pre><code>defer func() {\n    r.err = err\n    close(r.doneCh)\n}()\n</code></pre>\n\n<p>or is the compiler free to order the <code>r.err = err</code> and <code>close(r.doneCh)</code> instructions as it likes, in which case I'd need a mutex to prevent concurrent read/writes on error.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521385864, "post_id": 49349361, "comment_id": 85698606, "body": "For updating a package you can use <code>-u</code> with <code>go get</code> command to install a package"}, {"owner": {"reputation": 99, "user_id": 852329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11bcadf15046a199c661894f9c35680b?s=128&d=identicon&r=PG", "display_name": "lafolle", "link": "https://stackoverflow.com/users/852329/lafolle"}, "edited": false, "score": 0, "creation_date": 1521392948, "post_id": 49349361, "comment_id": 85700975, "body": "Probably your Go version on local is &lt; 1.10."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1521401888, "post_id": 49349361, "comment_id": 85704168, "body": "Consider installing the Go documentation package, if your distribution provides it. This way you always have a local copy of the docs matching your version of Go, and it is also available offline."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 4, "last_activity_date": 1521385960, "creation_date": 1521385960, "answer_id": 49349488, "question_id": 49349361, "link": "https://stackoverflow.com/questions/49349361/how-to-get-the-version-of-a-standard-golang-package-and-update-it/49349488#49349488", "title": "How to get the version of a standard golang package and update it?", "body": "<p>golang.org always documents the latest released version of Go. See <a href=\"https://golang.org/doc/devel/release.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/devel/release.html</a> for the release notes. <a href=\"https://golang.org/doc/go1.10#math\" rel=\"nofollow noreferrer\">math.Round was introduced in 1.10</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 49, "user_id": 8605429, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e0efdbe758e69dc351b92d1c255a853?s=128&d=identicon&r=PG", "display_name": "Matjam", "link": "https://stackoverflow.com/users/8605429/matjam"}, "is_accepted": false, "score": -2, "last_activity_date": 1521395375, "creation_date": 1521395375, "answer_id": 49351086, "question_id": 49349361, "link": "https://stackoverflow.com/questions/49349361/how-to-get-the-version-of-a-standard-golang-package-and-update-it/49351086#49351086", "title": "How to get the version of a standard golang package and update it?", "body": "<p>You should update the go package for your platform to the latest available.</p>\n"}], "owner": {"reputation": 25, "user_id": 5776513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1da61362690427089e2dfd10e7658818?s=128&d=identicon&r=PG&f=1", "display_name": "exp2logy", "link": "https://stackoverflow.com/users/5776513/exp2logy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 49349488, "answer_count": 2, "score": -2, "last_activity_date": 1521395375, "creation_date": 1521385216, "question_id": 49349361, "link": "https://stackoverflow.com/questions/49349361/how-to-get-the-version-of-a-standard-golang-package-and-update-it", "title": "How to get the version of a standard golang package and update it?", "body": "<p>I looked into go list but couldn't find a flag that does this. <a href=\"https://golang.org/pkg/math/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/math/</a> has a Round function but it's not found in my local install.</p>\n"}, {"tags": ["api", "post", "go", "multipart"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521381514, "post_id": 49348566, "comment_id": 85697031, "body": "Are you setting your Content-Type to <code>form-url-encoded</code> or <code>application&#47;x-www-form-urlencoded</code>?"}, {"owner": {"reputation": 1674, "user_id": 6640806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/10207119967343824/picture?type=large", "display_name": "Boris Le M&#233;ec", "link": "https://stackoverflow.com/users/6640806/boris-le-m%c3%a9ec"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521382111, "post_id": 49348566, "comment_id": 85697246, "body": "I&#39;m sorry, if iI pass values via <code>form-url-encoded</code> I set no header. If I set <code>application&#47;x-www-form-urlencoded</code> I get back to <code>EOF</code> error"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521382707, "post_id": 49348566, "comment_id": 85697438, "body": "Try <code>curl -d &quot;firstname=Boris&amp;lastname=Le+Meec&quot; -X POST http:&#47;&#47;127.0.0.1:3000&#47;api&#47;v1&#47;users</code>, if it goes through successfully it&#39;s possible that the app you&#39;re using to send the api requests is constructing those requests in some manner that buffalo (or the libs it uses, or Go) can&#39;t handle."}, {"owner": {"reputation": 1674, "user_id": 6640806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/10207119967343824/picture?type=large", "display_name": "Boris Le M&#233;ec", "link": "https://stackoverflow.com/users/6640806/boris-le-m%c3%a9ec"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521382809, "post_id": 49348566, "comment_id": 85697471, "body": "Nop. I still have an error (the same <code>EOF</code>)..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521383369, "post_id": 49348566, "comment_id": 85697684, "body": "Do you have any middleware, or some code that runs before <code>UserResource.Create</code>? Something That reads the <code>req.Body</code> without resetting it?"}, {"owner": {"reputation": 1674, "user_id": 6640806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/10207119967343824/picture?type=large", "display_name": "Boris Le M&#233;ec", "link": "https://stackoverflow.com/users/6640806/boris-le-m%c3%a9ec"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521383583, "post_id": 49348566, "comment_id": 85697756, "body": "Nope, the only code that calls <code>UserRessource.Create</code> is <code>g.POST(&quot;&#47;users&quot;, ur.Create)</code> (<code>g</code> is a <code>Group</code> with <code>&#47;api&#47;v1</code>)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521383909, "post_id": 49348566, "comment_id": 85697881, "body": "If you&#39;ve no calls to <code>a&#47;g.Use</code> that could read the body, and you&#39;re certain a body is being sent in the request, and you&#39;re still getting <code>EOF</code> then i&#39;m out of ideas, sorry."}, {"owner": {"reputation": 1674, "user_id": 6640806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/10207119967343824/picture?type=large", "display_name": "Boris Le M&#233;ec", "link": "https://stackoverflow.com/users/6640806/boris-le-m%c3%a9ec"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521384078, "post_id": 49348566, "comment_id": 85697947, "body": "<code>c.Request().FormValue(&quot;firstname&quot;)</code> actually returns <code>Boris</code> so I think I won&#39;t user any binder, just gonna do it by hand"}], "owner": {"reputation": 1674, "user_id": 6640806, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/10207119967343824/picture?type=large", "display_name": "Boris Le M&#233;ec", "link": "https://stackoverflow.com/users/6640806/boris-le-m%c3%a9ec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 468, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1521382056, "creation_date": 1521380708, "last_edit_date": 1521382056, "question_id": 49348566, "link": "https://stackoverflow.com/questions/49348566/golang-api-with-buffalo-retrieve-post-datas", "title": "Golang api (with buffalo) retrieve Post datas", "body": "<p>I am developing an API in Golang (with Buffalo library).</p>\n\n<p>I have my route set to point to :</p>\n\n<pre><code>func (ur UserResource) Create(c buffalo.Context) error {\n    // new User\n    u := &amp;models.User{}\n    if err := c.Bind(u); err != nil {\n        return c.Render(500, r.String(err.Error()))\n    }\n    id, _ := uuid.NewV4()\n    u.ID = id\n    db[u.ID] = *u\n    return c.Render(201, r.JSON(u))\n}\n</code></pre>\n\n<p>The problem is that when I test my api I have the following error :</p>\n\n<p>(and my header <code>Content-Type</code> is set to <code>multipart/form-data</code>)\n <a href=\"https://i.stack.imgur.com/xappm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xappm.png\" alt=\"Problem\"></a></p>\n\n<p>If I change the way values are passed to <code>form-url-encoded</code> and set no header, I have this error :\n<code>invalid character 'i' in literal false (expecting 'a')</code></p>\n"}, {"tags": ["go", "tcpserver"], "comments": [{"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1521380722, "post_id": 49348463, "comment_id": 85696773, "body": "This is unrelated, but your code has race conditions."}, {"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1521380763, "post_id": 49348463, "comment_id": 85696786, "body": "Try flushing the buffer."}], "answers": [{"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 2, "creation_date": 1521383404, "post_id": 49348493, "comment_id": 85697705, "body": "just a side note: you should check errors from <code>WriteString</code> and also <code>Flush</code>."}, {"owner": {"reputation": 1324, "user_id": 490790, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/FobZX.jpg?s=128&g=1", "display_name": "SeedyROM", "link": "https://stackoverflow.com/users/490790/seedyrom"}, "edited": false, "score": 0, "creation_date": 1578775757, "post_id": 49348493, "comment_id": 105551334, "body": "Ugh I spent like 5 hours trying to figure this out, mostly because I started using <code>bufio</code> from seeing an example. Of COURSE it&#39;s buffered... :P"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 4, "last_activity_date": 1521444333, "last_edit_date": 1521444333, "creation_date": 1521380261, "answer_id": 49348493, "question_id": 49348463, "link": "https://stackoverflow.com/questions/49348463/golang-bufio-writer-not-writing-to-tcp-connection/49348493#49348493", "title": "Golang Bufio writer not writing to TCP connection", "body": "<p>The buffered writer has buffered the data. To push it further call <a href=\"https://golang.org/pkg/bufio/#Writer.Flush\" rel=\"nofollow noreferrer\"><code>writer.Flush</code></a>.</p>\n\n<pre><code>func startMatch(client1 Client, client2 Client){\n    _, err := client1.writer.WriteString(\"found\\n\")\n    // handle error here\n    err = client1.writer.Flush()\n    // handle error here\n    _, err = client2.writer.WriteString(\"found\\n\")\n    // handle error here\n    err = client2.writer.Flush()\n    // handle error here\n\n    fmt.Println(\"Starting match with: \" + client1.name + \" and \" + client2.name)\n    fmt.Println(\"Current lobby size is: \", len(lobby))\n}\n</code></pre>\n\n<p>It becomes important to handle errors also in flush operations as the underlying writer errors can bubble up at this point.</p>\n"}], "owner": {"reputation": 15, "user_id": 9511886, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f563533b00e0114fddc0f76a4e317f56?s=128&d=identicon&r=PG&f=1", "display_name": "Jmo", "link": "https://stackoverflow.com/users/9511886/jmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3150, "favorite_count": 0, "accepted_answer_id": 49348493, "answer_count": 1, "score": 1, "last_activity_date": 1521444333, "creation_date": 1521380025, "last_edit_date": 1521380313, "question_id": 49348463, "link": "https://stackoverflow.com/questions/49348463/golang-bufio-writer-not-writing-to-tcp-connection", "title": "Golang Bufio writer not writing to TCP connection", "body": "<p>I'm working on a small server written in Golang. I'm looking at the following example:</p>\n\n<p><a href=\"https://gist.github.com/kenshinx/5796276\" rel=\"nofollow noreferrer\">https://gist.github.com/kenshinx/5796276</a></p>\n\n<p>When trying to implement the Reader and Writer from the Bufio package, it's only possible to read from the connection. It looks like it's not writing anything (well, I'm not receiving anything client-side), and it's also not giving an error. Using the actual connection to write, instead of the bufio.Writer, works fine however.</p>\n\n<p>Here's the code.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"bufio\"\n    \"strings\"\n)\n\nconst (\n    CONN_HOST = \"localhost\"\n    CONN_TYPE = \"tcp\"\n    CONN_PORT = \"3333\"\n)\n\ntype Client struct{\n    name string\n    reader *bufio.Reader\n    writer *bufio.Writer\n    connection net.Conn\n}\n\ntype Clients [] Client\n\nvar lobby Clients\n\nfunc main() {\n    c, err := net.Listen(CONN_TYPE, CONN_HOST+\":\"+CONN_PORT)\n\n    if err != nil {\n        fmt.Println(\"Error listening:\", err.Error())\n        os.Exit(1)\n    }\n\n    defer c.Close()\n    fmt.Println(\"Server listening on port \" + CONN_PORT)\n\n    go matchmaking()\n\n    for {\n        conn, err := c.Accept()\n        if err != nil {\n            fmt.Println(\"Error accepting: \", err.Error())\n            os.Exit(1)\n        }\n\n        if conn != nil {\n            go handleRequest(conn)\n        }\n    }\n}\n\nfunc handleRequest(conn net.Conn) {\n    client := &amp;Client{\n        reader: bufio.NewReader(conn),\n        writer: bufio.NewWriter(conn),\n        connection:conn,\n    }\n\n    client.name, _ = client.reader.ReadString('\\n') // Works fine\n    client.name = strings.TrimSpace(client.name)\n\n    lobby = append(lobby, *client)\n    fmt.Println(\"Client connected: \" + client.name)\n}\n\nfunc matchmaking(){\n    fmt.Println(\"Matchmaker started!\")\n    for {\n        for i := range lobby {\n            if len(lobby) &gt;= 2 {\n                go startMatch(lobby[i], lobby[i+1] )\n                lobby = append(lobby[:i], lobby[i+1:]...) // Remove from lobby\n                lobby = append(lobby[:i], lobby[i+1:]...)\n            }\n        }\n    }\n}\n\nfunc startMatch(client1 Client, client2 Client){\n    client1.writer.WriteString(\"found\\n\") // Doens't work?\n    client2.writer.WriteString(\"found\\n\") // Doens't work?\n\n    //client1.writer.Write([]byte(\"found\\n\")) =&gt; Doensn't work either\n    //client1.connection.Write([]byte(\"found\\n\")) =&gt; this works fine..?\n\n    fmt.Println(\"Starting match with: \" + client1.name + \" and \" + client2.name)\n    fmt.Println(\"Current lobby size is: \", len(lobby))\n}\n</code></pre>\n\n<p>So as the title says suggests, why is the bufio.Writer not writing to connected clients?</p>\n"}, {"tags": ["go", "gorilla", "mux"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521377231, "post_id": 49347974, "comment_id": 85695700, "body": "why not use negroni to handle middlewares"}, {"owner": {"reputation": 5551, "user_id": 1201488, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/cce2b982a2acdfb40f3c376489403f1e?s=128&d=identicon&r=PG", "display_name": "Ivan Velichko", "link": "https://stackoverflow.com/users/1201488/ivan-velichko"}, "edited": false, "score": 2, "creation_date": 1521377243, "post_id": 49347974, "comment_id": 85695701, "body": "This code works for me. What is the version of Gorilla do you use?"}, {"owner": {"reputation": 313, "user_id": 6650701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b26fbd263ecf4554fd90857ecd55d207?s=128&d=identicon&r=PG&f=1", "display_name": "stef", "link": "https://stackoverflow.com/users/6650701/stef"}, "edited": false, "score": 0, "creation_date": 1521377615, "post_id": 49347974, "comment_id": 85695790, "body": "Ha! You are right. Probably a very old one. I updatet my Gorilla package with <code>go get -u</code> and now it\u2019s working. Many thanks!!"}], "answers": [{"tags": [], "owner": {"reputation": 313, "user_id": 6650701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b26fbd263ecf4554fd90857ecd55d207?s=128&d=identicon&r=PG&f=1", "display_name": "stef", "link": "https://stackoverflow.com/users/6650701/stef"}, "is_accepted": true, "score": 4, "last_activity_date": 1521377681, "creation_date": 1521377681, "answer_id": 49348106, "question_id": 49347974, "link": "https://stackoverflow.com/questions/49347974/gorilla-mux-use-function-not-working/49348106#49348106", "title": "Gorilla Mux Use() Function Not Working", "body": "<p>Thanks to Ivan Velichko, I solved my problem. My package was outdated. I updated it with <code>go get -u github.com/gorilla/mux</code> and now it\u2019s working. Many thanks to y\u2019all!</p>\n"}], "owner": {"reputation": 313, "user_id": 6650701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b26fbd263ecf4554fd90857ecd55d207?s=128&d=identicon&r=PG&f=1", "display_name": "stef", "link": "https://stackoverflow.com/users/6650701/stef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1330, "favorite_count": 0, "accepted_answer_id": 49348106, "answer_count": 1, "score": 4, "last_activity_date": 1547558361, "creation_date": 1521376760, "question_id": 49347974, "link": "https://stackoverflow.com/questions/49347974/gorilla-mux-use-function-not-working", "title": "Gorilla Mux Use() Function Not Working", "body": "<p>I want to use the Use() function of the Gorilla Mux package, but I cannot get it to work. It says: <code>r.Use undefined (type *mux.Router has no field or method Use)</code>. I used almot the identitcal example from the documentation. My code looks like this.</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n    \"fmt\"\n)\n\nfunc simpleMw(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        fmt.Println(r.RequestURI)\n        next.ServeHTTP(w, r)\n    })\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"hello\")\n}\n\nfunc main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", handler)\n    r.Use(simpleMw)\n    http.Handle(\"/\", r)\n    http.ListenAndServe(\":8000\", nil)\n}\n</code></pre>\n\n<p>You can find the example of the documentation here: <a href=\"http://www.gorillatoolkit.org/pkg/mux#overview\" rel=\"nofollow noreferrer\">http://www.gorillatoolkit.org/pkg/mux#overview</a>, search for \"middleware\".</p>\n\n<p>I know I could use <a href=\"https://stackoverflow.com/questions/26204485/gorilla-mux-custom-middleware\">this</a> method, but I would like to use the Gorilla package.</p>\n\n<p>Many thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1521376236, "post_id": 49347098, "comment_id": 85695434, "body": "Just a guess, but I think this has less to do with how fmt is implemented than with the fact that situation 1. does nothing and therefore, I assume, is optimized away by the compiler, together with the select statement since it as well does nothing, resulting in a <code>for {}</code> (an infinite loop) which I think is indicated by the single cpu 100% usage. Try it, remove the body of the loop and I think you should see approximately the same cpu stats."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1521376389, "post_id": 49347098, "comment_id": 85695470, "body": ".. In situation 2., the contents of the loop aren&#39;t optimized away since you have actual code that does something, that results in some output. Now, how a single <code>select</code> statement, with only a <code>default</code> case results in all cpus being used relatively equally I do not know. Don&#39;t know whether it is something you can attribute to <code>select</code>&#39;s implementation or to Go&#39;s implementation in general."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1521400402, "post_id": 49347098, "comment_id": 85703577, "body": "Reasoning about unsensible code is basically useless."}, {"owner": {"reputation": 63, "user_id": 7802045, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b405dbec103e4b4c1fa5567c8bb682ef?s=128&d=identicon&r=PG&f=1", "display_name": "xjk", "link": "https://stackoverflow.com/users/7802045/xjk"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521425949, "post_id": 49347098, "comment_id": 85710152, "body": "@mkopriva  yes . I want to know in which situation the  cpus being used relatively equally . Try to find out it ."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 7802045, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b405dbec103e4b4c1fa5567c8bb682ef?s=128&d=identicon&r=PG&f=1", "display_name": "xjk", "link": "https://stackoverflow.com/users/7802045/xjk"}, "edited": false, "score": 0, "creation_date": 1521425845, "post_id": 49354768, "comment_id": 85710129, "body": "try to add a common function call in the default section but cpu still take 100% . seems not that problem ."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521465371, "post_id": 49354768, "comment_id": 85728091, "body": "A small function call may be inlined."}], "tags": [], "owner": {"reputation": 465, "user_id": 328631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76392d1afbab3812c85e56870802a34d?s=128&d=identicon&r=PG", "display_name": "uvgroovy", "link": "https://stackoverflow.com/users/328631/uvgroovy"}, "is_accepted": false, "score": 2, "last_activity_date": 1521424621, "creation_date": 1521424621, "answer_id": 49354768, "question_id": 49347098, "link": "https://stackoverflow.com/questions/49347098/after-added-a-simple-fmt-println-in-for-select-structure-the-cpu-usage-is-q/49354768#49354768", "title": "After added a simple fmt.Println in &quot;for {select }&quot; structure the CPU usage is quite different , why?", "body": "<p>My guess: In the first statement go's scheduler can't work. Go's scheduler is semi cooperative, and only works at certain points. Like function calls for example.</p>\n\n<p>In an infinite loop with no function calls the scheduler has no chance to kick in..</p>\n"}], "owner": {"reputation": 63, "user_id": 7802045, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b405dbec103e4b4c1fa5567c8bb682ef?s=128&d=identicon&r=PG&f=1", "display_name": "xjk", "link": "https://stackoverflow.com/users/7802045/xjk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1521424621, "creation_date": 1521370836, "last_edit_date": 1521422252, "question_id": 49347098, "link": "https://stackoverflow.com/questions/49347098/after-added-a-simple-fmt-println-in-for-select-structure-the-cpu-usage-is-q", "title": "After added a simple fmt.Println in &quot;for {select }&quot; structure the CPU usage is quite different , why?", "body": "<p>Encounter a confused situation :<br>\nlet's say we have a <code>for { select }</code> function which is written in Go.<br>\nHere the code below:</p>\n\n<pre><code>package main\n//import \"fmt\"\nfunc main(){\n\n  for {\n    select {\n\n      default:\n      _=1                     1. first situation \n      // fmt.Sprint(\"aa\")     2. second situation \n          }\n  }\n}\n</code></pre>\n\n<p>while in the first situation the cup usage shows below:\n<a href=\"https://i.stack.imgur.com/dw7jn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/dw7jn.png\" alt=\"enter image description here\"></a>\nin the second situation the cpu usage shows below:\n<a href=\"https://i.stack.imgur.com/CB9CO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CB9CO.png\" alt=\"enter image description here\"></a></p>\n\n<p>I guess something happened in fmt.Println .<br>\nMay be related to the mechanism of Go's fmt realization?<br>\nNot quite sure how it happens by using all the CPUs?<br>\nThanks in advance !</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1538080226, "post_id": 49345934, "comment_id": 92029191, "body": "Hey @Ray, didn&#39;t have enough credits to upvote your answer back then. Just found it today, paid my debts. Thank again for the help."}], "tags": [], "owner": {"reputation": 78771, "user_id": 831878, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/1d1a4823c46ad92f357b4bb7e74a64b0?s=128&d=identicon&r=PG", "display_name": "Ray Toal", "link": "https://stackoverflow.com/users/831878/ray-toal"}, "is_accepted": true, "score": 2, "last_activity_date": 1521362444, "last_edit_date": 1592644375, "creation_date": 1521361909, "answer_id": 49345934, "question_id": 49345881, "link": "https://stackoverflow.com/questions/49345881/what-is-difference-between-var-decksize-20-and-decksize-20-in-golang-i/49345934#49345934", "title": "What is difference between &quot;var deckSize = 20&quot; and &quot;deckSize := 20&quot; in GoLang, if written outside the main function body?", "body": "<p>The designers of Go chose not to allow this shorthand outside of functions. The Go folks hint at their reasons <a href=\"https://tour.golang.org/basics/10\" rel=\"nofollow noreferrer\">here</a></p>\n<blockquote>\n<p>Inside a function, the := short assignment statement can be used in place of a var declaration with implicit type.</p>\n<p>Outside a function, every statement begins with a keyword (var, func, and so on) and so the := construct is not available.</p>\n</blockquote>\n<p>The designers preferred every single statement at the top level to start with a keyword. Perhaps for aesthetics. Perhaps for ease of parsing. Perhaps because the top level things are the things you can export if you capitalize.</p>\n<p>This construct is called both a <em>short assignment statement</em> (in the Go Tour) but <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">officially, in the grammar</a> it is indeed called a short variable declaration! Given that it officially <em>is</em> a declaration, the error message, as you are alluding to, is IMHO wrong! They could do better. They should say &quot;short declaration found outside function.&quot;</p>\n<p><em>UPDATE</em></p>\n<p>This question looks like a dupe: <a href=\"https://stackoverflow.com/questions/18854033/why-isnt-short-variable-declaration-allowed-at-package-level-in-go\">Why isn&#39;t short variable declaration allowed at package level in Go?</a></p>\n<p>However, if the question is not &quot;why is it not allowed?&quot; but rather &quot;why does the error message say it is a non-declaration?&quot; then it's a good, distinct question.</p>\n"}], "owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "closed_date": 1521362220, "accepted_answer_id": 49345934, "answer_count": 1, "score": 1, "last_activity_date": 1521363833, "creation_date": 1521361422, "last_edit_date": 1521363833, "question_id": 49345881, "link": "https://stackoverflow.com/questions/49345881/what-is-difference-between-var-decksize-20-and-decksize-20-in-golang-i", "closed_reason": "Duplicate", "title": "What is difference between &quot;var deckSize = 20&quot; and &quot;deckSize := 20&quot; in GoLang, if written outside the main function body?", "body": "<p>I am new to Go, and learning the basics of the language. This is where I am stuck.</p>\n\n<p>I understand from the basic course that <code>var x int = 10</code> and <code>x := 10</code> are supposed to be equivalent, the latter being a shorthand notation. \nIt all made sense till these two were inside the main() function.</p>\n\n<p>That means:</p>\n\n<pre><code>package main\nimport \"fmt\"   \n\nfunc main() {\n    var x int = 20\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>,</p>\n\n<pre><code>func main() {\n    var x := 20\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>func main() {\n    x := 20\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>All these run fine.\nBut when I move this variable outside the main function, the behavior is different and I couldn't find an explanation in the tutorials I could find.</p>\n\n<p>That means,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar x int = 20\n\nfunc main() {\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>var x = 20\n\nfunc main() {\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>run as expected, but,</p>\n\n<pre><code>x := 20\n\nfunc main() {\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>Gives an error :</p>\n\n<blockquote>\n  <p>syntax error: non-declaration statement outside function body</p>\n</blockquote>\n\n<p>Why did this statement become a \"non-declaration\" one, and how is it different from same syntax being used inside the main() function?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1521379926, "post_id": 49345010, "comment_id": 85696534, "body": "This 3rd party lib might be of great help to you: <a href=\"https://github.com/icza/dyno\" rel=\"nofollow noreferrer\">github.com/icza/dyno</a> (disclosure: I&#39;m the author)."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 783744, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGjYy.png?s=128&g=1", "display_name": "tjoe", "link": "https://stackoverflow.com/users/783744/tjoe"}, "edited": false, "score": 0, "creation_date": 1521365310, "post_id": 49345111, "comment_id": 85692398, "body": "Thank you, very good ! Is there a way to insert <b>s1</b> directly in <b>ship1</b> ? I tried <code>ship1 := map[string]interface{}{ s1, &quot;crew&quot;: crew,&quot;passengers&quot;: passengers}</code> but I got and error <code>missing key in map literal</code>."}, {"owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "reply_to_user": {"reputation": 43, "user_id": 783744, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGjYy.png?s=128&g=1", "display_name": "tjoe", "link": "https://stackoverflow.com/users/783744/tjoe"}, "edited": false, "score": 0, "creation_date": 1521392429, "post_id": 49345111, "comment_id": 85700795, "body": "@tjoe <code>ship1 := map[string]interface{}{ &quot;ship&quot;: s1, &quot;crew&quot;: crew,&quot;passengers&quot;: passengers}</code>"}], "tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": true, "score": 1, "last_activity_date": 1521354535, "creation_date": 1521354535, "answer_id": 49345111, "question_id": 49345010, "link": "https://stackoverflow.com/questions/49345010/insert-arrays-into-json-object-in-golang/49345111#49345111", "title": "Insert arrays into json object in golang", "body": "<p>The solution is not to unescape the string, but to marshal the complete structure you want to serialize to JSON, for example:</p>\n\n<pre><code>ship1 := map[string]interface{}{\n    \"ship\": \"RMS Titanic\",\n    \"crew\": crew,\n    \"passengers\": passengers,\n}\n\nship1Json, err := json.Marshal(ship1)\nif err != nil {\n    panic(err)\n}\n\nfmt.Println(\"ship1:\", string(ship1Json))\n</code></pre>\n\n<p>Another example with two ships in a slice:</p>\n\n<pre><code>ship2 := map[string]interface{}{\n    \"ship\": \"ship2\",\n    \"crew\": crew,\n    \"passengers\": passengers,\n}\n\nships := []map[string]interface{}{ship1, ship2}\n\nshipsJson, err := json.Marshal(ships)\nif err != nil {\n    panic(err)\n}\n\nfmt.Println(\"ships:\", string(shipsJson))\n</code></pre>\n\n<p>The result is easier to see if we print the JSON indented:</p>\n\n<pre><code>indented, err := json.MarshalIndent(ships, \"\", \"  \")\nif err != nil {\n    panic(err)\n}\n\nfmt.Println(string(indented))\n</code></pre>\n\n<p>Giving:</p>\n\n<pre><code>[\n  {\n    \"crew\": [\n      {\n        \"name\": \"Captain Smith\"\n      },\n      {\n        \"name\": \"First Officer Murdoch\"\n      }\n    ],\n    \"passengers\": [\n      {\n        \"name\": \"Jack Dawson\"\n      },\n      {\n        \"name\": \"Rose Dewitt Bukater\"\n      }\n    ],\n    \"ship\": \"RMS Titanic\"\n  },\n  {\n    \"crew\": [\n      {\n        \"name\": \"Captain Smith\"\n      },\n      {\n        \"name\": \"First Officer Murdoch\"\n      }\n    ],\n    \"passengers\": [\n      {\n        \"name\": \"Jack Dawson\"\n      },\n      {\n        \"name\": \"Rose Dewitt Bukater\"\n      }\n    ],\n    \"ship\": \"ship2\"\n  }\n]\n</code></pre>\n\n<p>See also on the <a href=\"https://play.golang.org/p/BnmJXT9gREO\" rel=\"nofollow noreferrer\">playground.</a></p>\n"}], "owner": {"reputation": 43, "user_id": 783744, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGjYy.png?s=128&g=1", "display_name": "tjoe", "link": "https://stackoverflow.com/users/783744/tjoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 49345111, "answer_count": 1, "score": 1, "last_activity_date": 1521354535, "creation_date": 1521353587, "question_id": 49345010, "link": "https://stackoverflow.com/questions/49345010/insert-arrays-into-json-object-in-golang", "title": "Insert arrays into json object in golang", "body": "<p>I am processing data from a text file with go and would like to ouput a json record like this:</p>\n\n<pre><code>[{\n        \"ship\": \"RMS Titanic\",\n        \"crew\": [{\n            \"name\": \"Captain Smith\"\n        }, {\n            \"name\": \"First Officer Murdoch\"\n        }],\n        \"passengers\": [{\n            \"name\": \"Jack Dawson\"\n        }, {\n            \"name\": \"Rose Dewitt Bukater\"\n        }]\n    },\n    {\n        \"ship\": \"ship2\",\n        \"crew\": [{\n            \"name\": \"crew 1\"\n        }, {\n            \"name\": \"crew 2\"\n        }],\n        \"passengers\": [{\n            \"name\": \"passenger 1\"\n        }, {\n            \"name\": \"passenger 2\"\n        }]\n    }\n]\n</code></pre>\n\n<p>Here is a snippet from my code:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"encoding/json\"\n)\n\nfunc main() {\n        var crew []map[string]string\n        var passengers []map[string]string\n\n        s1 := map[string]string{ \"name\": \"RMS Titanic\"}\n        j1, _ := json.Marshal(s1)\n        fmt.Printf(\"j1: %s\\n\", string(j1))\n\n        s2 := map[string]string{ \"name\": \"Captain Smith\" }\n        crew = append(crew, s2)\n        s2 = map[string]string{ \"name\": \"First Officer Murdoch\" }\n        crew = append(crew, s2)\n        j2, _ := json.Marshal(crew)\n        fmt.Printf(\"j2: %s\\n\", string(j2))\n\n        s3 := map[string]string{ \"name\": \"Jack Dawson\"}\n        passengers = append(passengers, s3)\n        s3 = map[string]string{ \"name\": \"Rose Dewitt Bukater\" }\n        passengers = append(passengers, s3)\n\n        j3, _ := json.Marshal(passengers)\n        fmt.Printf(\"j3: %s\\n\", string(j3))\n\n        s4 :=  map[string]string{\"crew\": string(j2), \"passengers\": string(j3)}\n        j4, _ := json.Marshal(s4)\n        fmt.Printf(\"j4: %s\\n\", string(j4))\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>j1: {\"name\":\"RMS Titanic\"}\nj2: [{\"name\":\"Captain Smith\"},{\"name\":\"First Officer Murdoch\"}]\nj3: [{\"name\":\"Jack Dawson\"},{\"name\":\"Rose Dewitt Bukater\"}]\nj4: {\"crew\":\"[{\\\"name\\\":\\\"Captain Smith\\\"},{\\\"name\\\":\\\"First Officer Murdoch\\\"}]\",\"passengers\":\"[{\\\"name\\\":\\\"Jack Dawson\\\"},{\\\"name\\\":\\\"Rose Dewitt Bukater\\\"}]\"}\n</code></pre>\n\n<p>I am processing the ship data in <strong>j1</strong>, the crew data in <strong>j2</strong> and the passengers data in <strong>j3</strong>. </p>\n\n<p>I have managed to merge <strong>j2</strong> and <strong>j3</strong> together into <strong>j4</strong>, but the quotation mark s are escapaded, how un-escape the quotation marks ?</p>\n\n<p>How to insert <strong>j1</strong> data in there so the output match the json output I wish for ?</p>\n"}, {"tags": ["go", "error-handling"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1565613564, "post_id": 49344478, "comment_id": 101396029, "body": "In addition to the answer with a link to the spec; the <a href=\"https://golang.org/pkg/builtin/#recover\" rel=\"nofollow noreferrer\"><code>recover</code> documentation</a> also says &quot;Executing a call to recover inside a deferred function (but not any function called by it) \u2026&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 996, "user_id": 4909445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ded7e867ff7001048e511974d4c19137?s=128&d=identicon&r=PG&f=1", "display_name": "Shettyh", "link": "https://stackoverflow.com/users/4909445/shettyh"}, "is_accepted": true, "score": 5, "last_activity_date": 1521349087, "creation_date": 1521349087, "answer_id": 49344592, "question_id": 49344478, "link": "https://stackoverflow.com/questions/49344478/why-recover-does-not-work-in-a-nested-deferred-function/49344592#49344592", "title": "Why recover() does not work in a nested deferred function?", "body": "<p>It is because <code>recover</code> will be <code>nil</code> if not directly called by deferred function</p>\n\n<p>Here is excerpt from golang spec</p>\n\n<blockquote>\n  <p>The return value of recover is nil if any of the following conditions holds:</p>\n  \n  <ol>\n  <li>panic's argument was nil;</li>\n  <li>the goroutine is not panicking;</li>\n  <li><strong>recover was not called directly by a deferred function.</strong></li>\n  </ol>\n</blockquote>\n\n<p>For more info check the full spec <a href=\"https://golang.org/ref/spec#Handling_panics\" rel=\"noreferrer\">here</a></p>\n"}], "owner": {"reputation": 4283, "user_id": 5462608, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eb8700e5129804fc324f2cc4dc4ccff?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Lee", "link": "https://stackoverflow.com/users/5462608/nick-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 831, "favorite_count": 1, "accepted_answer_id": 49344592, "answer_count": 1, "score": 2, "last_activity_date": 1565600385, "creation_date": 1521347412, "question_id": 49344478, "link": "https://stackoverflow.com/questions/49344478/why-recover-does-not-work-in-a-nested-deferred-function", "title": "Why recover() does not work in a nested deferred function?", "body": "<p>I am testing <code>panic/recover</code> in Golang. This simple program works as expected:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc printRecover() {\n    r := recover()\n    fmt.Println(\"Recovered:\", r)\n}\n\nfunc main() {\n    defer printRecover()\n\n    panic(\"OMG!\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Recovered: OMG!\n</code></pre>\n\n<p>However, if I wrap the function <code>printRecover()</code> in a bigger deferred function:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc printRecover() {\n    r := recover()\n    fmt.Println(\"Recovered:\", r)\n}\n\nfunc main() {\n    defer func() {\n        printRecover()\n    }()\n\n    panic(\"OMG!\")\n}\n</code></pre>\n\n<p>It does not recover and let the panic go through:</p>\n\n<pre><code>Recovered: &lt;nil&gt;\npanic: OMG!\n\ngoroutine 1 [running]:\nmain.main()\n    /tmp/sandbox898315096/main.go:15 +0x60\n</code></pre>\n\n<p>Can someone explain the difference?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 1808965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bab245d0adb6985b5f336ad01c3d58ff?s=128&d=identicon&r=PG", "display_name": "user1808965", "link": "https://stackoverflow.com/users/1808965/user1808965"}, "edited": false, "score": 0, "creation_date": 1521360250, "post_id": 49344318, "comment_id": 85691245, "body": "Thanks.  I only gave the other answer the tick as it showed an example."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 2, "last_activity_date": 1521345128, "creation_date": 1521345128, "answer_id": 49344318, "question_id": 49344303, "link": "https://stackoverflow.com/questions/49344303/mutex-does-not-seem-to-be-locking-properly/49344318#49344318", "title": "Mutex does not seem to be locking properly", "body": "<p>You're not waiting for any of the goroutines you started to <em>finish</em> before checking the result. Use a <code>WaitGroup</code> to wait for all of them to complete.</p>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 1808965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bab245d0adb6985b5f336ad01c3d58ff?s=128&d=identicon&r=PG", "display_name": "user1808965", "link": "https://stackoverflow.com/users/1808965/user1808965"}, "edited": false, "score": 0, "creation_date": 1521360168, "post_id": 49344711, "comment_id": 85691224, "body": "Thanks.  I didn&#39;t know about the -race option... I&#39;ll look into that."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1521350523, "creation_date": 1521350523, "answer_id": 49344711, "question_id": 49344303, "link": "https://stackoverflow.com/questions/49344303/mutex-does-not-seem-to-be-locking-properly/49344711#49344711", "title": "Mutex does not seem to be locking properly", "body": "<p>You have a data race. Therefore, the results are undefined.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar total int\nvar locker sync.RWMutex\n\nfunc add() {\n    for x := 1; x &lt;= 100; x++ {\n        locker.Lock()\n        total += 1\n        locker.Unlock()\n    }\n}\n\nfunc main() {\n    for x := 1; x &lt;= 10; x++ {\n        go add()\n    }\n    fmt.Printf(\"Total is %v\\n\", total)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run -race racer.go\n==================\nWARNING: DATA RACE\nRead at 0x0000005ba408 by main goroutine:\n  runtime.convT2E64()\n      /home/peter/go/src/runtime/iface.go:335 +0x0\n  main.main()\n      /home/peter/src/racer.go:23 +0x84\n\nPrevious write at 0x0000005ba408 by goroutine 14:\n  main.add()\n      /home/peter/src/racer.go:14 +0x76\n\nGoroutine 14 (running) created at:\n  main.main()\n      /home/peter/src/racer.go:21 +0x52\n==================\nTotal is 960\nFound 1 data race(s)\nexit status 66\n$ \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 1808965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bab245d0adb6985b5f336ad01c3d58ff?s=128&d=identicon&r=PG", "display_name": "user1808965", "link": "https://stackoverflow.com/users/1808965/user1808965"}, "edited": false, "score": 0, "creation_date": 1521359389, "post_id": 49345452, "comment_id": 85691059, "body": "Awesome.  Thank you!"}], "tags": [], "owner": {"reputation": 365, "user_id": 4810520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dead6c17da8d5c805485ad1148b4b46e?s=128&d=identicon&r=PG&f=1", "display_name": "oxana", "link": "https://stackoverflow.com/users/4810520/oxana"}, "is_accepted": true, "score": 3, "last_activity_date": 1521357686, "creation_date": 1521357686, "answer_id": 49345452, "question_id": 49344303, "link": "https://stackoverflow.com/questions/49344303/mutex-does-not-seem-to-be-locking-properly/49345452#49345452", "title": "Mutex does not seem to be locking properly", "body": "<p>Main function returns before gorutines finished their works, you should add <code>sync.WaitGroup</code>, this code works as you expected: <a href=\"https://play.golang.com/p/_OfrZae0soB\" rel=\"nofollow noreferrer\">https://play.golang.com/p/_OfrZae0soB</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar total int\nvar locker sync.RWMutex\n\nfunc add(wg *sync.WaitGroup) {\n    defer wg.Done()\n    for x := 1; x &lt;= 100; x++ {\n        locker.Lock()\n        total += 1\n        locker.Unlock()\n    }\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    for x := 1; x &lt;= 10; x++ {\n        wg.Add(1)\n        go add(&amp;wg)\n    }\n    wg.Wait()\n    fmt.Printf(\"Total is %v\\n\", total)\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 1808965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bab245d0adb6985b5f336ad01c3d58ff?s=128&d=identicon&r=PG", "display_name": "user1808965", "link": "https://stackoverflow.com/users/1808965/user1808965"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 1, "accepted_answer_id": 49345452, "answer_count": 3, "score": 0, "last_activity_date": 1521357686, "creation_date": 1521344881, "question_id": 49344303, "link": "https://stackoverflow.com/questions/49344303/mutex-does-not-seem-to-be-locking-properly", "title": "Mutex does not seem to be locking properly", "body": "<p>I am just learning about mutexess.  I thought the following program would return a total of 1000, but I am getting varied results, so I assume I am doing something wrong...</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar total int\nvar locker sync.RWMutex\n\nfunc add() {\n    for x := 1; x &lt;= 100; x++ {\n        locker.Lock()\n        total += 1\n        locker.Unlock()\n    }\n}\n\nfunc main() {\n    for x := 1; x &lt;= 10; x++ {\n        go add()\n    }\n    fmt.Printf(\"Total is %v\\n\", total)\n}\n</code></pre>\n"}, {"tags": ["function", "go", "range", "keyword"], "comments": [{"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "edited": false, "score": 3, "creation_date": 1521344637, "post_id": 49344250, "comment_id": 85688744, "body": "There&#39;s no difference in how they&#39;d be compiled, but gofmt will remove the unnecessary parentheses -- you shouldn&#39;t use them."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1521349891, "post_id": 49344250, "comment_id": 85689439, "body": "Why do you ask? There is no difference."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1521367633, "creation_date": 1521367633, "answer_id": 49346658, "question_id": 49344250, "link": "https://stackoverflow.com/questions/49344250/what-is-different-range-function-with-range-keyword-in-go-language/49346658#49346658", "title": "what is different range function with range keyword in go language?", "body": "<p>There is no <code>range</code> function in Go. There is only the <a href=\"https://golang.org/ref/spec#Keywords\" rel=\"nofollow noreferrer\"><code>range</code> keyword</a>.</p>\n\n<p>What's confusing you is the optional parenthesis in your second example. These parenthesis are, as mentioned, <strong>optional</strong>, so the <a href=\"https://golang.org/cmd/gofmt/\" rel=\"nofollow noreferrer\">gofmt</a> tool will remove them.</p>\n\n<p>But there is no difference between <code>range x</code> and <code>range(x)</code>.</p>\n"}], "owner": {"reputation": 15, "user_id": 7171756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/352606d72f605d48404075f6cc6b849f?s=128&d=identicon&r=PG&f=1", "display_name": "geekoff", "link": "https://stackoverflow.com/users/7171756/geekoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1521367633, "creation_date": 1521344163, "question_id": 49344250, "link": "https://stackoverflow.com/questions/49344250/what-is-different-range-function-with-range-keyword-in-go-language", "title": "what is different range function with range keyword in go language?", "body": "<p>what is different range function with range keyword in go language ?</p>\n\n<pre><code>func main(){\n     s := []int{10, 20, 30, 40, 50, 60, 70, 80, 90}\n\n     for i,j:= range s{\n         fmt.Printf(\"%d =&gt; \",i)\n         fmt.Println(j) \n     }\n }\n</code></pre>\n\n<p>different with</p>\n\n<pre><code>  func main(){\n        s := []int{10, 20, 30, 40, 50, 60, 70, 80, 90}\n\n        for i,j:= range(s){\n            fmt.Printf(\"%d =&gt; \",i)\n            fmt.Println(j)  \n         }\n   }\n</code></pre>\n"}, {"tags": ["go", "apache-kafka", "kafka-producer-api"], "comments": [{"owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1521365641, "post_id": 49344067, "comment_id": 85692479, "body": "One hint might be to check if producer is not closing before message is sent. Try removing producer.Close() altogether."}, {"owner": {"reputation": 1137, "user_id": 2660766, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/qiIdj.png?s=128&g=1", "display_name": "maksadbek", "link": "https://stackoverflow.com/users/2660766/maksadbek"}, "edited": false, "score": 0, "creation_date": 1521368434, "post_id": 49344067, "comment_id": 85693199, "body": "How are you running Kafka and ZooKeeper ? The problem can be you misconfigured address of Kafka brokers in Zookeeper."}, {"owner": {"reputation": 1, "user_id": 9510436, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Scorch Lee", "link": "https://stackoverflow.com/users/9510436/scorch-lee"}, "edited": false, "score": 0, "creation_date": 1521470978, "post_id": 49344067, "comment_id": 85732066, "body": "Eh, I already check the address of Kafka and zookeeper,  I only built one broker which id is 0."}], "owner": {"reputation": 1, "user_id": 9510436, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Scorch Lee", "link": "https://stackoverflow.com/users/9510436/scorch-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 953, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1521367691, "creation_date": 1521341681, "last_edit_date": 1521367691, "question_id": 49344067, "link": "https://stackoverflow.com/questions/49344067/kafka-producer-panic", "title": "kafka producer panic", "body": "<p>I'm working on building kafka producer based on golang right now. I cannot sent any message from my producer. The panic shown as follow:</p>\n\n<pre><code>producer close, err: kafka: client has run out of available brokers to talk to(Is your cluster reachable?)\n</code></pre>\n\n<p>I test the kafka-console-consumer and kafka-console-producer, they are all work well on terminal. So, is there anything I missed?\nHere's the code:</p>\n\n<pre><code>package main\nimport (\n    \"github.com/Shopify/sarama\"\n    \"log\"\n    \"os\"\n    \"strings\"\n)\n\nvar (\n    logger = log.New(os.Stderr, \"[srama]\", log.LstdFlags)\n)\n\nfunc main() {\n    sarama.Logger = logger\n\n    config := sarama.NewConfig()\n    config.Producer.Return.Successes = true\n    config.Producer.RequiredAcks = sarama.WaitForAll\n    config.Producer.Partitioner = sarama.NewRandomPartitioner\n\n    msg := &amp;sarama.ProducerMessage{}\n    msg.Topic = \"hello\"\n    msg.Partition = int32(-1)\n    msg.Key = sarama.StringEncoder(\"key\")\n    msg.Value = sarama.ByteEncoder(\"hello, world!\")\n\n    producer, err := sarama.NewSyncProducer(strings.Split(\"localhost:9092\", \",\"), config)//default port\n    if err != nil {\n        logger.Println(\"Failed to produce message: %s\", err)\n        os.Exit(500)\n    }\n    defer producer.Close()\n\n    partition, offset, err := producer.SendMessage(msg)\n    if err != nil {\n        logger.Println(\"Failed to produce message: \", err)\n    }\n    logger.Printf(\"partition=%d, offset=%d\\n\", partition, offset)\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 0, "creation_date": 1521325682, "post_id": 49342232, "comment_id": 85685168, "body": "First time I hear about the &quot;actor pattern&quot;, I know the &quot;actor model&quot;, but it has seldom to do with that, can you link to the original article?"}], "answers": [{"comments": [{"owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "edited": false, "score": 0, "creation_date": 1521325058, "post_id": 49342349, "comment_id": 85685011, "body": "Could you expand a little bit more? In the above example isn&#39;t the synchronization to a single function caller only needed because of the go routine in the first place? If left alone as a &quot;synchronous&quot; handler wouldn&#39;t it do the same effect?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "edited": false, "score": 3, "creation_date": 1521330421, "post_id": 49342349, "comment_id": 85686373, "body": "@Rodrigo The actions are executed in the single goroutine running <code>API.loop()</code>.  If the actions are called directly in the handler, then the actions run concurrently in the per-connection goroutines started by the net/http server."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 4, "last_activity_date": 1521324291, "creation_date": 1521324291, "answer_id": 49342349, "question_id": 49342232, "link": "https://stackoverflow.com/questions/49342232/benefits-of-actor-pattern-in-http-handler/49342349#49342349", "title": "Benefits of actor pattern in HTTP handler", "body": "<p>The benefits are not to a single call but to the sum of all calls.</p>\n\n<p>For example you can use this to limit actual execution to a single goroutine and thereby avoid all the problems concurrent execution would bring with it.</p>\n\n<p>For example I use this pattern to synchronise all usage of a connection to a hardware device that talks serial.</p>\n"}], "owner": {"reputation": 2479, "user_id": 3666882, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/4d6c91065605fbddcd17db1556134b37?s=128&d=identicon&r=PG&f=1", "display_name": "Rodrigo", "link": "https://stackoverflow.com/users/3666882/rodrigo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "accepted_answer_id": 49342349, "answer_count": 1, "score": 1, "last_activity_date": 1521367754, "creation_date": 1521323291, "last_edit_date": 1521367754, "question_id": 49342232, "link": "https://stackoverflow.com/questions/49342232/benefits-of-actor-pattern-in-http-handler", "title": "Benefits of actor pattern in HTTP handler", "body": "<p>I've been reading a few go blogs and and more recently I stubbled upon Peter Bourgon's talk titled \"Ways to do things\". He shows a few examples of the actor pattern for concurrency in GO. Here is a handler example using such pattern:</p>\n\n<pre><code>func (a *API) handleNext(w http.ResponseWriter, r *http.Request) {\n    var (\n        notFound   = make(chan struct{})\n        otherError = make(chan error)\n        nextID     = make(chan string)\n    )\n    a.action &lt;- func() {\n        s, err := a.log.Oldest()\n        if err == ErrNoSegmentsAvailable {\n            close(notFound)\n            return\n        }\n        if err != nil {\n            otherError &lt;- err\n            return\n        }\n        id := uuid.New()\n        a.pending[id] = pendingSegment{s, time.Now().Add(a.timeout), false}\n        nextID &lt;- id\n    }\n    select {\n    case &lt;-notFound:\n        http.NotFound(w, r)\n    case err := &lt;-otherError:\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    case id := &lt;-nextID:\n        fmt.Fprint(w, id)\n    }\n}\n</code></pre>\n\n<p>And there's a loop behind the scenes listening for the <code>action</code> channel:</p>\n\n<pre><code>func (a *API) loop() {\n    for {\n        select {\n        case f := &lt;-a.action:\n            f()\n        }\n    }\n}\n</code></pre>\n\n<p>My question is what is the benefit to all of this? The handler isn't any faster because it is still blocking until some action in the action func returns something to it. Which is essentially the same thing as just returning the function from outside the go routine. What am I missing here?</p>\n"}, {"tags": ["sorting", "go", "type-conversion"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1521321296, "post_id": 49341895, "comment_id": 85684069, "body": "Does it have to be an implementation of sort.Interface?  sort.Slice with type assertions should work."}], "answers": [{"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 0, "last_activity_date": 1521404785, "last_edit_date": 1521404785, "creation_date": 1521403830, "answer_id": 49352376, "question_id": 49341895, "link": "https://stackoverflow.com/questions/49341895/go-type-conversion-sort-2-slices-of-different-interfaces-using-shared-interfac/49352376#49352376", "title": "go type conversion - sort 2 slices of different interfaces using shared interface", "body": "<p>Yes, it is possible to sort different types using one <code>sort.Interface</code>.\nBut not the way you were trying to do it. Current Go specification doesn't allow converting one slice type to another. You have to convert each item.</p>\n\n<p>Here's a helper function that does it using reflection:</p>\n\n<pre><code>// ByTimestamp converts a slice of Timestamper into a slice\n// that can be sorted by timestamp.\nfunc ByTimestamp(slice interface{}) sort.Interface {\n    value := reflect.ValueOf(slice)\n    length := value.Len()\n    b := make(byTimestamp, 0, length)\n    for i := 0; i &lt; length; i++ {\n        b = append(b, value.Index(i).Interface().(Timestamper))\n    }\n    return b\n}\n</code></pre>\n\n<p>See the full example <a href=\"https://play.golang.org/p/JbM0gbQRwYh\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>And, if you only have a couple of types, then it might make sense to do type-specific conversions instead.</p>\n"}], "owner": {"reputation": 446, "user_id": 854488, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/478410ad8e690c9d0385183969be2646?s=128&d=identicon&r=PG", "display_name": "MAcabot", "link": "https://stackoverflow.com/users/854488/macabot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521404785, "creation_date": 1521320645, "question_id": 49341895, "link": "https://stackoverflow.com/questions/49341895/go-type-conversion-sort-2-slices-of-different-interfaces-using-shared-interfac", "title": "go type conversion - sort 2 slices of different interfaces using shared interface", "body": "<p>The example below contains 2 interfaces <code>Foo</code> and <code>Bar</code> that both implement the same interface <code>Timestamper</code>. It also contains the type <code>ByTimestamp</code> that implements <a href=\"https://golang.org/pkg/sort/#Interface\" rel=\"nofollow noreferrer\">sort.Interface</a>. </p>\n\n<p>As shown in the function <code>main</code>, I would like to use the type <code>ByTimestamp</code> to sort both a slice of <code>Foo</code>s and a slice of <code>Bar</code>s. However, the code will not compile because it <code>cannot convert foos (type []Foo) to type ByTimestamp</code> and it <code>cannot convert bars (type []Bar) to type ByTimestamp</code>.</p>\n\n<p>Is it possible to sort 2 slices of different interfaces that both implement the same interface with a single type that implements <code>sort.Interface</code>?</p>\n\n<pre><code>package main\n\nimport (\n    \"sort\"\n)\n\ntype Timestamper interface {\n    Timestamp() int64\n}\n\ntype ByTimestamp []Timestamper\n\nfunc (b ByTimestamp) Len() int {\n    return len(b)\n}\n\nfunc (b ByTimestamp) Swap(i, j int) {\n    b[i], b[j] = b[j], b[i]\n}\n\nfunc (b ByTimestamp) Less(i, j int) bool {\n    return b[i].Timestamp() &lt; b[j].Timestamp()\n}\n\ntype Foo interface {\n    Timestamper\n    DoFoo() error\n}\n\ntype Bar interface {\n    Timestamper\n    DoBar() error\n}\n\nfunc getFoos() (foos []Foo) {\n    // TODO get foos\n    return\n}\n\nfunc getBars() (bars []Bar) {\n    // TODO get bars\n    return\n}\n\nfunc main() {\n    foos := getFoos()\n    bars := getBars()\n\n    sort.Sort(ByTimestamp(foos))\n    sort.Sort(ByTimestamp(bars))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/IV9wd78Xoje\" rel=\"nofollow noreferrer\">The Go playground</a></p>\n"}, {"tags": ["arrays", "json", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521320291, "post_id": 49340734, "comment_id": 85683775, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/48777882/check-if-strings-are-json-format\">Check if strings are JSON format</a>"}, {"owner": {"reputation": 1992, "user_id": 1520767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a7e4a40a81debc040ec0f73b70c3c66?s=128&d=identicon&r=PG&f=1", "display_name": "fabfas", "link": "https://stackoverflow.com/users/1520767/fabfas"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521324562, "post_id": 49340734, "comment_id": 85684893, "body": "@Peter The suggested answer cannot unmarshal array into Go value of type struct {}. Hence does no meet the requirement."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521385676, "post_id": 49340734, "comment_id": 85698541, "body": "I was referring to the json.Decoder.Token() and json.RawMessage options."}, {"owner": {"reputation": 1992, "user_id": 1520767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a7e4a40a81debc040ec0f73b70c3c66?s=128&d=identicon&r=PG&f=1", "display_name": "fabfas", "link": "https://stackoverflow.com/users/1520767/fabfas"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521556962, "post_id": 49340734, "comment_id": 85775586, "body": "@Peter Thanks for pointing it out. I tried your answer using <code>json.Decoder.Token()</code> and <code>json.RawMessage</code>, it is not validating JSON as an object. the &quot;sfdsf&quot; is a valid JSON string but not JSON object. Here is play link <a href=\"https://play.golang.org/p/_EMloRrLg8D\" rel=\"nofollow noreferrer\">play.golang.org/p/_EMloRrLg8D</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1992, "user_id": 1520767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a7e4a40a81debc040ec0f73b70c3c66?s=128&d=identicon&r=PG&f=1", "display_name": "fabfas", "link": "https://stackoverflow.com/users/1520767/fabfas"}, "edited": false, "score": 0, "creation_date": 1521316001, "post_id": 49340795, "comment_id": 85682489, "body": "In your added case, the <code>&quot;sfdsf&quot;</code> is a valid <code>JSON</code> string value but not the JSON object. A JSON text is serialized object or array. Therefore it would not be legal to use this to validate a JSON with an internet media type <code>application&#47;json</code>."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 1992, "user_id": 1520767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a7e4a40a81debc040ec0f73b70c3c66?s=128&d=identicon&r=PG&f=1", "display_name": "fabfas", "link": "https://stackoverflow.com/users/1520767/fabfas"}, "edited": false, "score": 0, "creation_date": 1521316503, "post_id": 49340795, "comment_id": 85682637, "body": "I could argue with you here but I will just edit my answer."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521320432, "post_id": 49340795, "comment_id": 85683814, "body": "See <a href=\"https://stackoverflow.com/questions/48777882/check-if-strings-are-json-format/48781823\">answers to this question</a> for more efficient alternatives to decoding to interface{}."}, {"owner": {"reputation": 1992, "user_id": 1520767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a7e4a40a81debc040ec0f73b70c3c66?s=128&d=identicon&r=PG&f=1", "display_name": "fabfas", "link": "https://stackoverflow.com/users/1520767/fabfas"}, "edited": false, "score": 0, "creation_date": 1521324223, "post_id": 49340795, "comment_id": 85684810, "body": "@TehSphinX That works! I added more cases and simplify the <code>if</code> conditions <a href=\"https://play.golang.org/p/ajrHWEVr-7x\" rel=\"nofollow noreferrer\">play.golang.org/p/ajrHWEVr-7x</a>"}, {"owner": {"reputation": 1992, "user_id": 1520767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a7e4a40a81debc040ec0f73b70c3c66?s=128&d=identicon&r=PG&f=1", "display_name": "fabfas", "link": "https://stackoverflow.com/users/1520767/fabfas"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521324490, "post_id": 49340795, "comment_id": 85684873, "body": "@Peter The suggested answer cannot unmarshal array into Go value of type struct {}"}, {"owner": {"reputation": 1992, "user_id": 1520767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a7e4a40a81debc040ec0f73b70c3c66?s=128&d=identicon&r=PG&f=1", "display_name": "fabfas", "link": "https://stackoverflow.com/users/1520767/fabfas"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521556970, "post_id": 49340795, "comment_id": 85775593, "body": "@Peter Thanks for pointing it out. I tried your answer using <code>json.Decoder.Token()</code> and <code>json.RawMessage</code>, it is not validating JSON as an object. the &quot;sfdsf&quot; is a valid JSON string but not JSON object. Here is play link <a href=\"https://play.golang.org/p/_EMloRrLg8D\" rel=\"nofollow noreferrer\">play.golang.org/p/_EMloRrLg8D</a>"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 4, "last_activity_date": 1521317003, "last_edit_date": 1521317003, "creation_date": 1521313467, "answer_id": 49340795, "question_id": 49340734, "link": "https://stackoverflow.com/questions/49340734/how-to-validate-json-when-using-unmarshal-into-generic-interface/49340795#49340795", "title": "How to validate JSON when using unmarshal into generic interface?", "body": "<p>Don't use <code>map[string]interface{}</code> but simply <code>interface{}</code>. The second example is of type <code>[]interface{}</code> and there are more types of valid json.</p>\n\n<p>Here your working code. I added a few more cases of valid json.</p>\n\n<p><a href=\"https://play.golang.org/p/rXH2DPq3_lw\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<p>Here the code if you want to allow only maps and slices:</p>\n\n<p><a href=\"https://play.golang.org/p/NP6EI7h4Jm1\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 1992, "user_id": 1520767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a7e4a40a81debc040ec0f73b70c3c66?s=128&d=identicon&r=PG&f=1", "display_name": "fabfas", "link": "https://stackoverflow.com/users/1520767/fabfas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 0, "accepted_answer_id": 49340795, "answer_count": 1, "score": -1, "last_activity_date": 1521324094, "creation_date": 1521313034, "last_edit_date": 1521324094, "question_id": 49340734, "link": "https://stackoverflow.com/questions/49340734/how-to-validate-json-when-using-unmarshal-into-generic-interface", "title": "How to validate JSON when using unmarshal into generic interface?", "body": "<p>I want to validate byte array data if it contains valid JSON using unmarsall method into interface. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc isJSON(s string) bool {\n    var js map[string]interface{}\n\n    return json.Unmarshal([]byte(s), &amp;js) == nil\n}\n\nfunc main() {\n    var tests = []string{\n        `{\"a\":\"b\"}`,\n        `[{\"a\":\"b\"},{\"a\":\"b\"}]`,\n    }\n\n    for _, t := range tests {\n        fmt.Printf(\"isJSON(%s) = %v\\n\\n\", t, isJSON(t))\n    }\n\n}\n</code></pre>\n\n<p>Both input test parameters are valid JSON strings, but it validate based on the interface 'map[string]interface{}'</p>\n\n<pre><code>{\n    \"a\": \"b\"\n}\n\n[{\n    \"a\": \"b\"\n}, {\n    \"a\": \"b\"\n}]\n</code></pre>\n\n<p>I want to validate the JSON text. JSON text is a serialized object or array. Hence looking for a solution which support all valid cases for JSON text as I added test cases in <a href=\"https://play.golang.org/p/ajrHWEVr-7x\" rel=\"nofollow noreferrer\">playground</a>.</p>\n\n<p>How can I make this interface i.e var <code>map[string]interface{}</code> generic so it support both test cases of valid JSON string?</p>\n\n<p><a href=\"https://play.golang.org/p/ajrHWEVr-7x\" rel=\"nofollow noreferrer\">Solved: Playground Link</a></p>\n"}, {"tags": ["go", "set-returning-functions"], "comments": [{"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 3, "creation_date": 1521312554, "post_id": 49340537, "comment_id": 85681368, "body": "try doing goimports to your package. It should fix the unused imports issue."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1546850878, "post_id": 49340537, "comment_id": 94974763, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/45071362/why-am-i-getting-a-missing-return-at-end-of-function-in-this-code\">Why am I getting a missing return at end of function in this code?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 8707057, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3WYFgf8Iyy8/AAAAAAAAAAI/AAAAAAAADh8/z3Iqc-xrBwg/photo.jpg?sz=128", "display_name": "harsha hirushan", "link": "https://stackoverflow.com/users/8707057/harsha-hirushan"}, "edited": false, "score": 0, "creation_date": 1521313427, "post_id": 49340658, "comment_id": 85681676, "body": "but not working if else  for the ^(&gt;));@&amp;^$^d5(5&gt;/()!ed(e5&gt;/&amp;e&amp;!^    can you tel me what is the meaning of return (14 - 2), (3 + 3 - 6)"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 51, "user_id": 8707057, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3WYFgf8Iyy8/AAAAAAAAAAI/AAAAAAAADh8/z3Iqc-xrBwg/photo.jpg?sz=128", "display_name": "harsha hirushan", "link": "https://stackoverflow.com/users/8707057/harsha-hirushan"}, "edited": false, "score": 0, "creation_date": 1521313846, "post_id": 49340658, "comment_id": 85681818, "body": "The meaning of <code>return (14 - 2), (3 + 3 - 6)</code> is that it returns two numbers 12 and 0 (the functions has 2 outputs of type int). I can&#39;t help you with the logic of your program as you have not said what it is supposed to do."}, {"owner": {"reputation": 51, "user_id": 8707057, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3WYFgf8Iyy8/AAAAAAAAAAI/AAAAAAAADh8/z3Iqc-xrBwg/photo.jpg?sz=128", "display_name": "harsha hirushan", "link": "https://stackoverflow.com/users/8707057/harsha-hirushan"}, "edited": false, "score": 0, "creation_date": 1521314241, "post_id": 49340658, "comment_id": 85681968, "body": "I want to return a value to this ^(&gt;));@&amp;^$^d5(5&gt;/()!ed(e5&gt;/&amp;e&amp;!^ using my logic it must be 32 hexa desimals as a example for &quot;)&quot; need to return 4,2"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 4, "last_activity_date": 1521312620, "creation_date": 1521312620, "answer_id": 49340658, "question_id": 49340537, "link": "https://stackoverflow.com/questions/49340537/in-go-language-missing-return-at-end-of-function/49340658#49340658", "title": "In Go language missing return at end of function", "body": "<p>If you define a function with a return value you also need to return something:</p>\n\n<pre><code>func getLetter(value int) string {\n    return \"\"\n} \n</code></pre>\n\n<p>This will fix your first error.</p>\n\n<p>For the second error just remove the <code>import ( \"fmt\" )</code> part. Go does not allow you to import a package and then not use it.</p>\n\n<p>EDIT: as is being suggested: run <code>go imports</code> on the file will automatically add/remove imports. There are editors out there that do this automatically on every save for you. I prefer Goland but also VSCode has a great Go-Plugin. There are other great editors that support Go of course.</p>\n\n<p>Same with variables: <code>inputString</code> and <code>letter</code> are declared but not used. If you are still in programming phase but want to run it already you can either print the variables:</p>\n\n<pre><code>fmt.Println(inputString, letter)\n</code></pre>\n\n<p>or assign them to the empty receiver:</p>\n\n<pre><code>_ = inputString\n</code></pre>\n\n<p>Then the compiler considers them used.</p>\n\n<p>Here your code in a runnable fashion: <a href=\"https://play.golang.org/p/2tHYDpkXBtY\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 51, "user_id": 8707057, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3WYFgf8Iyy8/AAAAAAAAAAI/AAAAAAAADh8/z3Iqc-xrBwg/photo.jpg?sz=128", "display_name": "harsha hirushan", "link": "https://stackoverflow.com/users/8707057/harsha-hirushan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4348, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1521314149, "creation_date": 1521311949, "last_edit_date": 1521314149, "question_id": 49340537, "link": "https://stackoverflow.com/questions/49340537/in-go-language-missing-return-at-end-of-function", "title": "In Go language missing return at end of function", "body": "<pre><code>package main\nimport (\n       \"fmt\"\n)\n\n\nfunc iLoveGoLang(sign string) (int , int) {\n  if sign == \"!\" {\n    return (14 - 2),( 3 + 3 - 6);\n} else if sign == \"@\" {\n    return (41 - (20 * 2)),(5 - 4)\n}  else if sign == \"$\" {\n    return 1,3\n} else if sign == \"^\" {\n    return 2,2\n}  else if sign == \"5\" {\n    return 3, 2\n} else if sign == \"(\" {\n    return (4 * 2) - 1, 1 \n} else if sign == \")\" {\n    return (2*2), 2\n} else if sign == \"d\" {\n    return 2, 5\n} else if sign == \"&gt;\" {\n    return (3 * 3) + 2, 1\n} else if sign == \"~\" {\n    return (2 * 2), (3 * 1)\n} else if sign == \"#\" {\n    return 2,1\n} else if sign == \"+\" {\n    return 13,1\n} else if sign == \"&amp;\" {\n    return (2+3),1\n} else if sign == \"/\" {\n    return (3 + 4), 2\n} else if sign == \";\" {\n    return (33 / 11), 3\n} else if sign == \"e\" {\n    return (2 + 3), (8 - 5)\n}\n\n\n    return -1,1\n}\n\n func getLetter(value int) string {\n\n\n\n } \n\n\n  func main() {\n  var inputString = \"^(&gt;));@&amp;^$^d5(5&gt;/()!ed(e5&gt;/&amp;e&amp;!^\"\n\n  var gdg, srilanka = iLoveGoLang(\"@\")\n  var letter = getLetter(gdg * srilanka)\n\n//you need to do that for all letters.\n\n }\n</code></pre>\n\n<p>I am unable to get an output. Though I added a return type to the <code>getLetter</code> function it does not work. It also keeps saying imported and not used: \"fmt\".</p>\n"}, {"tags": ["javascript", "json", "go", "request", "httpwebresponse"], "comments": [{"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 1, "creation_date": 1521310548, "post_id": 49340064, "comment_id": 85680746, "body": "while I answered your question, this is a  really low effort one considered the one you just asked before : <a href=\"https://stackoverflow.com/questions/49338485/how-to-post-a-json-request-and-recieve-json-response-to-go-server-go-language\" title=\"how to post a json request and recieve json response to go server go language\">stackoverflow.com/questions/49338485/&hellip;</a> Avoid doing that. Take the time to get familiar with go by reading the documentation."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521320901, "post_id": 49340064, "comment_id": 85683942, "body": "Note that you cannot encode or decode unexported fields, such as &quot;result&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "is_accepted": false, "score": 0, "last_activity_date": 1521310131, "creation_date": 1521310131, "answer_id": 49340249, "question_id": 49340064, "link": "https://stackoverflow.com/questions/49340064/how-to-manipulate-the-data-that-we-have-sent-and-receive-in-golang/49340249#49340249", "title": "How to manipulate the data that we have sent and receive in golang", "body": "<p>The same way you can encode a payload in json in a http response, you can decode the body of a request.</p>\n\n<pre><code>err:= json.NewDecoder(request.Body).Decode(&amp;answer);\n</code></pre>\n\n<p>Read Go documentation for future reference, and avoid any third party tutorial that doesn't clearly reference to the documentation.</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/</a></p>\n"}], "owner": {"reputation": 7, "user_id": 9508652, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "akash sc", "link": "https://stackoverflow.com/users/9508652/akash-sc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1521310131, "creation_date": 1521309173, "question_id": 49340064, "link": "https://stackoverflow.com/questions/49340064/how-to-manipulate-the-data-that-we-have-sent-and-receive-in-golang", "title": "How to manipulate the data that we have sent and receive in golang", "body": "<p>how can I decode the json object that has been sent in javascript to server\nand save them to variable op1,op2,opr.</p>\n\n<p>and in java script i wanna decode the response sent by the server and save it variable result.</p>\n\n<p>java script code:</p>\n\n<pre><code>var calculate = { \n                operand1 : null,\n                operand2 : null,\n                operator : null\n};\n\nfunction UserAction() {\n    var xhttp = new XMLHttpRequest();\n    xhttp.open(\"POST\", \"http://localhost:8000/\", true);\n    xhttp.setRequestHeader(\"Content-type\", \"application/json\");\n    xhttp.send(calculate);\n    var response = (xhttp.responseText);\n    console.log(response);\n}\nUserAction();\n</code></pre>\n\n<p>go server code:</p>\n\n<pre><code>package main\nimport (\"fmt\"\n        \"net/http\"\n        \"encoding/json\"\n)\n\n\ntype answer struct {\n    result float64\n}\n\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    ans := answer{result: 30}\n    fmt.Println(r)\n    w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.WriteHeader(http.StatusOK)\n    if err := json.NewEncoder(w).Encode(ans); err != nil {\n        panic(err)\n    }    \n}\n\nfunc main() {\n    http.HandleFunc(\"/\",index)\n    http.ListenAndServe(\":8000\", nil)\n\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "concurrency", "locking"], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 1, "last_activity_date": 1521315156, "last_edit_date": 1521315156, "creation_date": 1521314772, "answer_id": 49341035, "question_id": 49339856, "link": "https://stackoverflow.com/questions/49339856/which-data-type-to-use-in-go-for-concurrent-read-write-operation/49341035#49341035", "title": "Which data type to use in Go for concurrent read/write operation", "body": "<p>Yes, you could use a map for that and you would have to protect it by a mutex.</p>\n\n<p>I would however suggest that each job contains a result channel where you can input the result of the job. Here a rough sketch of what that would look like:</p>\n\n<p><a href=\"https://play.golang.org/p/FavfF5FRhCx\" rel=\"nofollow noreferrer\">playground</a>: note that playground only has one core so the numbers will appear in sequence.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype job struct {\n    a     int\n    b     int\n    chRes chan int\n}\n\nfunc main() {\n\n    var chIn = make(chan job, 20)\n\n    for i := 0; i &lt; 10; i++ {\n        go worker(chIn)\n    }\n\n    for i := 0; i &lt; 100; i++ {\n        go func(i int) {\n            chRes := make(chan int)\n            chIn &lt;- job{\n                a:     i,\n                b:     i,\n                chRes: chRes,\n            }\n\n            fmt.Println(&lt;-chRes)\n        }(i)\n    }\n\n    // I'm lazy, so here just a sleep so we can see something\n    time.Sleep(1 * time.Second)\n}\n\nfunc worker(ch chan job) {\n    for job := range ch {\n        job.chRes &lt;- job.a + job.b\n    }\n}\n</code></pre>\n\n<p>-- edit --</p>\n\n<p>If you device to go with a store instead (which kind of goes against the go mantra <code>share memory by communicating</code> instead of <code>communicate by sharing memory</code>): there is also a <code>sync.Map</code> that is already concurrency safe. No mutex needed.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "is_accepted": false, "score": 2, "last_activity_date": 1521387815, "last_edit_date": 1521387815, "creation_date": 1521316144, "answer_id": 49341250, "question_id": 49339856, "link": "https://stackoverflow.com/questions/49339856/which-data-type-to-use-in-go-for-concurrent-read-write-operation/49341250#49341250", "title": "Which data type to use in Go for concurrent read/write operation", "body": "<p>I'd use a second channel the workers send results to. One goroutine will receive results from this channel and store them. Shared memory and protected code sections are not needed if you use this approach.</p>\n\n<p><strong>Edit: Example</strong></p>\n\n<p>The following program uses four workers and one result collector. Tasks are passed to the workers from the main gorouting. The worker send results and errors to the collector who builds a summary.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    tasks := make(chan int)\n    results := make(chan string)\n\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 4; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            for task := range tasks {\n                rem := int(task) % 2\n                switch rem {\n                case 0:\n                    results &lt;- fmt.Sprintf(\"done with task %d\", task)\n                case 1:\n                    results &lt;- fmt.Sprintf(\"error: only even tasks accepted: %d\", task)\n                }\n            }\n        }()\n    }\n\n    summary := \"\"\n    go func() {\n        for result := range results {\n            summary += result + \"\\n\"\n        }\n    }()\n\n    for i := 0; i &lt; 10; i++ {\n        tasks &lt;- i\n    }\n\n    close(tasks)\n    wg.Wait()\n    close(results)\n\n    fmt.Println(summary)\n}\n</code></pre>\n\n<p>see <a href=\"https://play.golang.org/p/puZONnJHme-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/puZONnJHme-</a></p>\n"}], "owner": {"reputation": 2491, "user_id": 1117320, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/LA0T3.jpg?s=128&g=1", "display_name": "ambikanair", "link": "https://stackoverflow.com/users/1117320/ambikanair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 327, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1521387815, "creation_date": 1521307992, "question_id": 49339856, "link": "https://stackoverflow.com/questions/49339856/which-data-type-to-use-in-go-for-concurrent-read-write-operation", "title": "Which data type to use in Go for concurrent read/write operation", "body": "<p>I have a scenario where I create a worker pool which has 4 workers. These  workers picks up job from a channel and stores the result to the memory. \nSo the worker execute the job and may update the result in parallel. I would like to know which data type is best to save the result as it would be accessed by multiple workers at a time. I would need to use the lock mechanism to achieve this. </p>\n\n<p>The result will be key-value format. So can maps be considered in this scenario.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521301645, "post_id": 49338604, "comment_id": 85677695, "body": "It is not possible to do that in Go. Also If you have a package  with method which contains receiver. It&#39;s a good practice to use remaining methods with receivers too"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1521302008, "creation_date": 1521302008, "answer_id": 49338818, "question_id": 49338604, "link": "https://stackoverflow.com/questions/49338604/is-an-optional-receiver-possible/49338818#49338818", "title": "Is an optional receiver possible?", "body": "<p>It's not possible to make the receiver argument optional, but you can declare a method and a function with the same name:</p>\n\n<pre><code>func (r ReceiverType) doSth(arg ArgType) (ReturnType) {\n    return r.doSthWithReceiver()\n}\n\nfunc doSth(arg ArgType) (ReturnType) {\n    return doSthWithoutReceiver()\n}\n</code></pre>\n\n<p>and call them as stated in the question:</p>\n\n<pre><code>var sth ReceiverType\nresWithoutRecv := doSth()\nresWithRecv := sth.doSth()\n</code></pre>\n\n<p>You can also check for a nil receiver:</p>\n\n<pre><code>func (r *ReceiverType) doSth(arg ArgType) (ReturnType) {\n    if r == nil {\n        return doSthWithoutReceiver()\n    }\n    return r.doSthWithReceiver()\n}\n</code></pre>\n\n<p>and call it like this:</p>\n\n<pre><code>var sth *ReceiverType\nresWithoutRecv := sth.doSth()  // sth == nil\n</code></pre>\n"}], "owner": {"reputation": 561, "user_id": 3564720, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/KiSNg.jpg?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/3564720/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "accepted_answer_id": 49338818, "answer_count": 1, "score": 0, "last_activity_date": 1521366703, "creation_date": 1521300787, "last_edit_date": 1521366703, "question_id": 49338604, "link": "https://stackoverflow.com/questions/49338604/is-an-optional-receiver-possible", "title": "Is an optional receiver possible?", "body": "<p>Is it possible to define an optional receiver for a function?</p>\n\n<pre><code>func (r ReceiverType) doSth(arg ArgType) (ReturnType) {\n    if r == nil {\n        return doSthWithoutReceiver()\n    }\n\n    return r.doSthWithReceiver()\n}\n</code></pre>\n\n<p>Such that I can call the function as follows:</p>\n\n<pre><code>var sth ReceiverType\nresWithoutRecv := doSth()\nresWithRecv := sth.doSth()\n</code></pre>\n\n<p>Without the need of basically writing the same function twice, once with and once without the receiver? Since I didn't find anything I assume this is bad practice either way?</p>\n"}, {"tags": ["javascript", "json", "http", "go", "xmlhttprequest"], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 9508652, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "akash sc", "link": "https://stackoverflow.com/users/9508652/akash-sc"}, "edited": false, "score": 0, "creation_date": 1521301621, "post_id": 49338547, "comment_id": 85677688, "body": "after changes  Failed to load <a href=\"http://localhost:8000/\" rel=\"nofollow noreferrer\">localhost:8000</a>: Request header field Content-type is not allowed by Access-Control-Allow-Headers in preflight response"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 7, "user_id": 9508652, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "akash sc", "link": "https://stackoverflow.com/users/9508652/akash-sc"}, "edited": false, "score": 0, "creation_date": 1521302818, "post_id": 49338547, "comment_id": 85678067, "body": "we need to set header to allow options <code>Access-Control-Allow-Headers</code>"}, {"owner": {"reputation": 7, "user_id": 9508652, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "akash sc", "link": "https://stackoverflow.com/users/9508652/akash-sc"}, "edited": false, "score": 0, "creation_date": 1521308338, "post_id": 49338547, "comment_id": 85679981, "body": "can u tell me how to manipulate the data that we have sent and receive i just want to convert them to variables"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 7, "user_id": 9508652, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "akash sc", "link": "https://stackoverflow.com/users/9508652/akash-sc"}, "edited": false, "score": 0, "creation_date": 1521367444, "post_id": 49338547, "comment_id": 85692961, "body": "@akashsc thats another question If my code works. Please accept it and post another question with your code and we will definitely help you."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1521301846, "last_edit_date": 1521301846, "creation_date": 1521300420, "answer_id": 49338547, "question_id": 49338485, "link": "https://stackoverflow.com/questions/49338485/how-to-post-a-json-request-and-recieve-json-response-to-go-server-go-language/49338547#49338547", "title": "How to post a json request and recieve json response to &quot;go server&quot; (go language) using java script", "body": "<p>Set <code>Access-Control-Allow-Origin</code> headers in your Golang code to allow request form cross origin</p>\n\n<pre><code>func index(w http.ResponseWriter, r *http.Request) {\n    ans := answer{result: 30}\n    fmt.Println(r)\n    w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.WriteHeader(http.StatusOK)\n    if err := json.NewEncoder(w).Encode(ans); err != nil {\n        panic(err)\n    }    \n}\n</code></pre>\n\n<p>Also you can use CORS handler using this <a href=\"https://github.com/rs/cors\" rel=\"nofollow noreferrer\">API</a> for every request passing through router inside your main.</p>\n\n<pre><code>func main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\",index)\n    handler := cors.Default().Handler(mux)\n    fmt.Println(\"Server online at port localhost:8000\")\n    http.ListenAndServe(\":8000\", handler)\n}\n</code></pre>\n"}], "owner": {"reputation": 7, "user_id": 9508652, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "akash sc", "link": "https://stackoverflow.com/users/9508652/akash-sc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 498, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1521309715, "creation_date": 1521300056, "last_edit_date": 1521309715, "question_id": 49338485, "link": "https://stackoverflow.com/questions/49338485/how-to-post-a-json-request-and-recieve-json-response-to-go-server-go-language", "title": "How to post a json request and recieve json response to &quot;go server&quot; (go language) using java script", "body": "<p>How to post a json request and receive json response from \"go server\" (go language) using java script </p>\n\n<p>I tried this</p>\n\n<p>java script code:</p>\n\n<pre><code>var calculate = { \n                operand1 : null,\n                operand2 : null,\n                operator : null\n};\n\nfunction UserAction() {\n    var xhttp = new XMLHttpRequest();\n    xhttp.open(\"POST\", \"http://localhost:8000/\", true);\n    xhttp.setRequestHeader(\"Content-type\", \"application/json\");\n    xhttp.send(calculate);\n    var response = (xhttp.responseText);\n    console.log(response);\n}\nUserAction();\n</code></pre>\n\n<p>go code:</p>\n\n<pre><code>package main\nimport (\"fmt\"\n        \"net/http\"\n        \"encoding/json\"\n)\n\n\ntype answer struct {\n    result float64\n}\n\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    ans := answer{result: 30}\n    fmt.Println(r)\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    w.WriteHeader(http.StatusOK)\n    if err := json.NewEncoder(w).Encode(ans); err != nil {\n        panic(err)\n    }    \n}\n\nfunc main() {\n    http.HandleFunc(\"/\",index)\n    fmt.Println(\"Server online at port localhost:8000\")\n    http.ListenAndServe(\":8000\", nil)\n\n}\n</code></pre>\n\n<p>And I am getting a error message </p>\n\n<blockquote>\n  <p>Failed to load <a href=\"http://localhost:8000/\" rel=\"nofollow noreferrer\">http://localhost:8000/</a>: Response to preflight request\n  doesn't pass access control check: No 'Access-Control-Allow-Origin'\n  header is present on the requested resource. Origin 'null' is\n  therefore not allowed access.</p>\n</blockquote>\n"}, {"tags": ["json", "go", "yaml", "configuration-files"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1521289634, "post_id": 49335985, "comment_id": 85673349, "body": "Why not just open the file and unmarshal the contents as <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">json</a>? You will just need to pass the handle to the file (since it implements the <code>io.Reader</code> interface) to <code>json.NewDecoder()</code> and then pass a pointer to a struct that matches the structure of your file to <code>Decode()</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1999, "user_id": 1491720, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Kmszq.jpg?s=128&g=1", "display_name": "Tony Stark", "link": "https://stackoverflow.com/users/1491720/tony-stark"}, "edited": false, "score": 1, "creation_date": 1521295817, "post_id": 49336072, "comment_id": 85675895, "body": "I started to look into boltdb and abandoned the idea because I needed more than simple key/value structure. Now I looked again and it&#39;s totally possible to store just about any structure into boltdb. Additionally there seem to ba a great toolkit for it @ <a href=\"https://github.com/asdine/storm\" rel=\"nofollow noreferrer\">github.com/asdine/storm</a>."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 1, "last_activity_date": 1521290385, "last_edit_date": 1521290385, "creation_date": 1521290061, "answer_id": 49336072, "question_id": 49335985, "link": "https://stackoverflow.com/questions/49335985/how-to-i-manage-state-inside-a-file-in-go/49336072#49336072", "title": "How to I manage state inside a file in Go?", "body": "<p>For settings that need to be human readable and will primarily be edited by a human a <code>yaml</code> or <code>json</code> file seems fine.</p>\n\n<p>If the state is both written and read by the program itself and a full fledged database seems overkill then I would use a file based database. Probably a simple key/value store like <code>boltdb</code> or <code>sqlite</code> if the data needs more structure.</p>\n\n<p>I personally use <a href=\"https://github.com/boltdb/bolt\" rel=\"nofollow noreferrer\">boltdb</a> in such a case, because it is very lightweight, superfast and I like its simplicity.</p>\n\n<p>-- edit --</p>\n\n<p>With <code>json</code> as a file structure the problem is that you need to write and read the entire file every single time. A edit would be a read of the entire file, unmarshalling the json, changing something in the unmarshalled object, marshalling it back to json and writing the entire file again.</p>\n\n<p>Thats why I would only use this for settings that the program reads once on startup and that's it.</p>\n"}], "owner": {"reputation": 1999, "user_id": 1491720, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/Kmszq.jpg?s=128&g=1", "display_name": "Tony Stark", "link": "https://stackoverflow.com/users/1491720/tony-stark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 49336072, "answer_count": 1, "score": 0, "last_activity_date": 1521290385, "creation_date": 1521289546, "question_id": 49335985, "link": "https://stackoverflow.com/questions/49335985/how-to-i-manage-state-inside-a-file-in-go", "title": "How to I manage state inside a file in Go?", "body": "<p>Hard to admit it but I struggle to manage state in my cli go app. What I basically want is to manage a list of objects with their properties in a file on disk. I want to be able to add objects with their properties, update objects and/or their properties and remove them if needed.</p>\n\n<p>I thought it would be easy to just have a yml or json file and edit it with some kind of library but it seems harder than it should for a go beginner like me.</p>\n\n<p>An example would be the following json structure.</p>\n\n<pre><code>{\n  \"servers\":\n    [\n      { \"hostname\": \"gandalf\", \"ip\": \"192.168.1.10\", \"color\": \"red\" },\n      { \"hostname\": \"bilbo\", \"ip\": \"192.168.1.11\", \"color\": \"blue\" },\n      { \"hostname\": \"frodo\", \"ip\": \"192.168.1.12\", \"color\": \"yellow\" }\n    ]\n}\n</code></pre>\n\n<p>Now I want to be able to add, remove and edit servers. It doesn't have to be json, yaml is fine as well.</p>\n\n<p>Do you girls and guys have any suggestions (libs and an example) on how to do it? I already tried <a href=\"https://github.com/spf13/viper\" rel=\"nofollow noreferrer\">Viper</a> but adding new objects or even editing the existing ones seems to be impossible.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1521276898, "post_id": 49334170, "comment_id": 85669900, "body": "Why is <code>json:&quot;-&quot;</code> not what you want? It has nothing to do with <code>val interface{}</code> or whatever."}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521292524, "post_id": 49334170, "comment_id": 85674180, "body": "@mkopriva the reason I do not want json tag is that the function I want to write is a <b>utility</b> function used for debugging. I do NOT want to add any requirement for the data to be dumped."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521293457, "post_id": 49334170, "comment_id": 85674438, "body": "In that case I would say that you&#39;re out of luck, the values that the json encoder accepts have to satisfy a number of requirements, which are documented, for it not to blow up. I can see 3 options: 1. use something other than json, 2. write your own json encoder, 3. before passing the value to the encoder use the <code>reflect</code> package to build a <code>map[string]interface{}</code> out of the original value, leaving out fields that aren&#39;t encodable, and then pass the map to the encoder."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1521298012, "post_id": 49334170, "comment_id": 85676565, "body": "If your goal is data inspection and debugging, then the <a href=\"https://github.com/davecgh/go-spew\" rel=\"nofollow noreferrer\">spew</a> package may be of help."}], "answers": [{"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1521278093, "post_id": 49334226, "comment_id": 85670198, "body": "Since you obviously did&#39;t like my answer I improved on it showing you all the options you have."}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "edited": false, "score": 0, "creation_date": 1521292751, "post_id": 49334226, "comment_id": 85674234, "body": "write my own marshaller <b>will</b> solve the problem, at a <i>high</i> cost I&#39;d avoid.    I am just hoping a sort of call back func/interface in the standard library to handle unknown types.  Since my purpose is solely data inspection/debugging. I will stick with fmt.Printf(&quot;%+v&quot;, ...) unless a viable json one is available :-)"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "edited": false, "score": 0, "creation_date": 1521311523, "post_id": 49334226, "comment_id": 85681029, "body": "The <code>viable json</code> is already available. You just don&#39;t want to use it the way it is build. And I don&#39;t get why."}, {"owner": {"reputation": 238, "user_id": 578444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/483e658f18b8a12fdb681d1b1fc9e905?s=128&d=identicon&r=PG", "display_name": "gelraen", "link": "https://stackoverflow.com/users/578444/gelraen"}, "edited": false, "score": 0, "creation_date": 1557853760, "post_id": 49334226, "comment_id": 98901788, "body": "I think I have a very similar issue to the original question and I can answer why <code>encoding&#47;json</code> package doesn&#39;t work here. I&#39;m developing a thing on Google App Engine, so my logging is in JSON format, which is then nicely parsed and displayed in the UI. And the problem I have is that sometimes I want to log the whole <code>http.Request</code>, but I can&#39;t just serialize it as is because it contains at least one <code>func</code> field. I can dump whole request as a string, but then log viewer will not parse it and won&#39;t allow filtering on sub-fields."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1561630689, "post_id": 49334226, "comment_id": 100131903, "body": "I&#39;d create a function called <code>getRequestData</code> and extract all the relevant data from the <code>http.Request</code> to a struct of your own design and log that. e.g. the body must be read from the request first anyway."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 6, "last_activity_date": 1521278032, "last_edit_date": 1521278032, "creation_date": 1521277007, "answer_id": 49334226, "question_id": 49334170, "link": "https://stackoverflow.com/questions/49334170/ignore-unsupported-type-error-on-json-marshal/49334226#49334226", "title": "Ignore unsupported type error on JSON Marshal", "body": "<h2>JSON tags (the correct way)</h2>\n\n<p>Is this what you are looking for: <a href=\"https://play.golang.org/p/ELjv0U7hHFA\" rel=\"noreferrer\">playground</a></p>\n\n<p>You can use field tags to give json instructions on how to handle your struct. See also <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"noreferrer\">encoding/json</a> for more info on the options you have.</p>\n\n<p>-- edit --</p>\n\n<p>It does not matter that val is of type <code>interface{}</code>. <code>json.Marshal()</code> will reflect on it anyway and find out what type it is. It is the programmers job to set the correct <code>json</code> tags on all structs he/she wants to <code>dump</code>.</p>\n\n<h2>Custom Marshal function (another here not necessary way)</h2>\n\n<p>You can also write a custom MarshalJSON function to do marshalling of every type however you like: <a href=\"https://play.golang.org/p/PCFm_nFIrUM\" rel=\"noreferrer\">custom marshalling playground</a></p>\n\n<h2>Your own json Marshaller (have it your way)</h2>\n\n<p>If you don't like the way golang handles json marshalling you could always write your own marshalling function doing all the reflection youself.</p>\n"}, {"comments": [{"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "edited": false, "score": 0, "creation_date": 1521421554, "post_id": 49339475, "comment_id": 85709210, "body": "can you show an example how can json.RawMessage be used in ENCODING? thanks."}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "edited": false, "score": 0, "creation_date": 1521767739, "post_id": 49339475, "comment_id": 85883790, "body": "this is good to know such usage of json.RawMessage. However, it is not what I want. I want to handle ANY data structure without knowing its structure, NOT to design a universal data structure that can be dumped, or to design a &quot;wrapper&quot; structure to convert a data structure to be dumped. If I would design such a data strucuture, using json:&quot;-&quot; is simplest solution."}], "tags": [], "owner": {"reputation": 1477, "user_id": 889972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/df02868b2a3ef9c280f0ac9b51326fdf?s=128&d=identicon&r=PG", "display_name": "Mifeng", "link": "https://stackoverflow.com/users/889972/mifeng"}, "is_accepted": false, "score": 0, "last_activity_date": 1521305687, "creation_date": 1521305687, "answer_id": 49339475, "question_id": 49334170, "link": "https://stackoverflow.com/questions/49334170/ignore-unsupported-type-error-on-json-marshal/49339475#49339475", "title": "Ignore unsupported type error on JSON Marshal", "body": "<p>You can use <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\">json.RawMessage</a>. It can be used to delay JSON decoding or precompute a JSON encoding.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 15241260, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jNYlK.jpg?s=128&g=1", "display_name": "Leo Hung", "link": "https://stackoverflow.com/users/15241260/leo-hung"}, "is_accepted": false, "score": 0, "last_activity_date": 1613724632, "creation_date": 1613724632, "answer_id": 66274391, "question_id": 49334170, "link": "https://stackoverflow.com/questions/49334170/ignore-unsupported-type-error-on-json-marshal/66274391#66274391", "title": "Ignore unsupported type error on JSON Marshal", "body": "<p>If you just want to log the entire struct, you can do this.</p>\n<pre><code>func dump(w io.Writer, val interface{}) error {\n    je := json.NewEncoder(w)\n    return je.Encode(val)\n}\n\ntype example struct {\n    Name string\n    Func func()\n}\n\nfunc main() {\n    a := example{\n        Name: &quot;Gopher&quot;,\n        Func: func() {},\n    }\n    type _example struct {\n        example\n        Func interface{}\n    }\n    err := dump(os.Stdout, _example{example: a})\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n<p>This is an example of logging the entire http.Request.</p>\n<pre><code>type _Request struct {\n    *http.Request\n    GetBody interface{}\n    Cancel  interface{}\n}\nj, err := json.MarshalIndent(_Request{Request: r}, &quot;&quot;, &quot;    &quot;)\n</code></pre>\n"}], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7469, "favorite_count": 3, "answer_count": 3, "score": 2, "last_activity_date": 1613725538, "creation_date": 1521276528, "last_edit_date": 1613725538, "question_id": 49334170, "link": "https://stackoverflow.com/questions/49334170/ignore-unsupported-type-error-on-json-marshal", "title": "Ignore unsupported type error on JSON Marshal", "body": "<p>Here is my code:</p>\n<pre><code>func dump(w io.Writer, val interface{}) error {\n    je := json.NewEncoder(w)\n    return je.Encode(val)   \n}\n\ntype example struct {\n    Name string\n    Func func() \n}\n\nfunc main() {\n    a := example{\n        Name: &quot;Gopher&quot;,\n        Func: func() {},\n    }\n    err := dump(os.Stdout, a)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n<p>The program will panic with <code>json: unsupported type: func()</code></p>\n<p>My question is, how can I encode ANYTHING into json, ignoring those the encode cannot handle. For example, the above data structure, I want the output to be: <code>{&quot;Name&quot;: &quot;Gopher&quot;}</code></p>\n<p>IMPORTANT: for the dump funtion, its value is an <code>interface{}</code>, i.e. don't know what kind of data it will receive, so tricks like <code>json:&quot;-&quot;</code> is <strong>not</strong> what I want.</p>\n<p>If in case that the data passed to dump() is not marshal-able, e.g. <code>dump(func(){})</code>, it is perfectly acceptable to just return empty string.</p>\n<p><strong>EDIT after two years:</strong></p>\n<p>The answer provided by @TehSphinX has this piece of code which I want to avoid:</p>\n<pre><code>func (s example) MarshalJSON() ([]byte, error) {\n    return json.Marshal(struct {\n        Name string\n    }{\n        Name: s.Name,\n    })\n}\n</code></pre>\n<p>the reason is: in <code>func dump(w io.Writer, val interface{}) error</code>, the <strong><code>val</code></strong> is ANY code, i.e. code NOT written by me, could be any open source code, or even data types I don't have access to its source code.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1521259865, "creation_date": 1521259865, "answer_id": 49332426, "question_id": 49332257, "link": "https://stackoverflow.com/questions/49332257/what-does-p-mean-in-gos-sync-pool-source-code/49332426#49332426", "title": "What does P mean in Go&#39;s sync.Pool source code?", "body": "<p>P stands for processor. A processor is a resource used to execute Go code. There are exactly GOMAXPROC Ps in a process. <a href=\"https://golang.org/s/go11sched\" rel=\"noreferrer\">The Go Scheduler Design Doc</a> describes Ps in detail. The relevant code is in the <a href=\"https://golang.org/src/runtime/\" rel=\"noreferrer\">runtime package</a>.</p>\n"}], "owner": {"reputation": 726, "user_id": 2148710, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/SUfsw.jpg?s=128&g=1", "display_name": "jack-nie", "link": "https://stackoverflow.com/users/2148710/jack-nie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 1, "accepted_answer_id": 49332426, "answer_count": 1, "score": 10, "last_activity_date": 1521260171, "creation_date": 1521257965, "last_edit_date": 1521260171, "question_id": 49332257, "link": "https://stackoverflow.com/questions/49332257/what-does-p-mean-in-gos-sync-pool-source-code", "title": "What does P mean in Go&#39;s sync.Pool source code?", "body": "<p>Recently, I've been digging into Go's source code. When I looked into the details of sync.Pool, I found a comment I couldn't understand.</p>\n\n<p><a href=\"https://golang.org/src/sync/pool.go?s=1633:1992#L58\" rel=\"noreferrer\">https://golang.org/src/sync/pool.go?s=1633:1992#L58</a></p>\n\n<pre><code>// Local per-P Pool appendix.\ntype poolLocalInternal struct {\n    private interface{}   // Can be used only by the respective P.\n    shared  []interface{} // Can be used by any P.\n    Mutex                 // Protects shared.\n}\n</code></pre>\n\n<blockquote>\n  <p>Local per-P Pool appendix.</p>\n</blockquote>\n\n<p>What does per-P mean?</p>\n\n<blockquote>\n  <p>Can be used only by the respective P</p>\n</blockquote>\n\n<p>What does P mean?</p>\n"}, {"tags": ["go", "mux", "gorilla"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521236318, "post_id": 49329798, "comment_id": 85661804, "body": "<code>var h http.Handler = r</code>, if ... then <code>h = handlers.CombinedLoggingHandler(os.Stdout, h)</code>, if ... then <code>h = handlers.CompressHandler(h)</code>. No need to do <code>l := r</code> and <code>h := l</code>, doing <code>h = middleware(h)</code> should be fine."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521236595, "post_id": 49329798, "comment_id": 85661911, "body": "you are assigning a *router to <code>CombinedLoggingHandler</code> and <code>CompressHandler</code>. They both require handler type which is not the case here"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521236867, "post_id": 49329798, "comment_id": 85662023, "body": "@Himanshu you mean <i>return</i> right? Because so far as they take an <code>http.Handler</code> as an argument the code is ok, since <code>*mux.Router</code> implements that interface. The problem is that they also <i>return</i> an <code>http.Handler</code> but the type of the value on the left hand side of the assignment is <code>*mux.Router</code> and not <code>http.Handler</code>... The problem is in what type those two functions <i>return</i>, not in what they require as an argument."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1521236986, "post_id": 49329798, "comment_id": 85662066, "body": "Based on the first comment his should fix it <a href=\"https://play.golang.org/p/zD5Ran7t3Kj\" rel=\"nofollow noreferrer\">play.golang.org/p/zD5Ran7t3Kj</a>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521237849, "post_id": 49329798, "comment_id": 85662343, "body": "@mkopriva <code>http.Handler</code> is a function using <code>servemux</code> as receiver. You have declared a variable of that type. Hanlder is a type ? I have never seen declaring a variable of function type. Please elaborate. I am in learning phase"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521241737, "post_id": 49329798, "comment_id": 85663391, "body": "@Himanshu <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\">http.Handler</a> is not a function."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521241944, "post_id": 49329798, "comment_id": 85663456, "body": "But If we are implementing an interface type we should implement its function too. I hadn&#39;t see it. So how things works. Please can you explain."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521243866, "post_id": 49329798, "comment_id": 85663921, "body": "@Himanshu <code>r</code> is of type <code>*mux.Router</code>, this type already implements the <code>http.Handler</code> interface. And so <code>var h http.Handler = r</code> declares a variable <code>h</code> of type <code>http.Handler</code> and assigns it the value of <code>r</code> which is correct and will compile because <code>r</code> (*mux.Router) has the <code>ServeHTTP</code> method, which is required to implement the interface."}], "answers": [{"comments": [{"owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "edited": false, "score": 0, "creation_date": 1521282612, "post_id": 49330474, "comment_id": 85671403, "body": "I accepting this as an answer, because it gives even simpler solution to my problem, but I think mkopriva&#39;s solution is more universal (for fasthttp). I also noticed that <code>flag.Bool</code> accepting every console argument as true, even <code>false</code>, because of missing type casting. So I use <code>flag.String</code> and <code>if logging == &quot;true&quot; {}</code>."}, {"owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "edited": false, "score": 0, "creation_date": 1521285286, "post_id": 49330474, "comment_id": 85672154, "body": "My bad, boolean flags&#39;s format should be <code>-foo=bar</code>, sorry. <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow noreferrer\">golang.org/pkg/flag</a>"}], "tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 2, "last_activity_date": 1521240380, "creation_date": 1521240380, "answer_id": 49330474, "question_id": 49329798, "link": "https://stackoverflow.com/questions/49329798/changing-a-value-of-a-variable-which-is-inside-an-if-statement-that-referencing/49330474#49330474", "title": "Changing a value of a variable which is inside an if statement that referencing a flag", "body": "<p>It looks like you're trying to add middleware to your gorilla/mux router.</p>\n\n<p>You can add middleware with <a href=\"http://www.gorillatoolkit.org/pkg/mux#Router.Use\" rel=\"nofollow noreferrer\"><code>Router.Use()</code></a>.</p>\n\n<p><code>Router.Use()</code> takes a <a href=\"http://www.gorillatoolkit.org/pkg/mux#MiddlewareFunc\" rel=\"nofollow noreferrer\"><code>mux.MiddlewareFunc</code></a>, which is simply a function with the signature <code>func (http.Handler) http.Handler</code>. Most middleware you will run across matches this signature or can be easily wrapped to do so, as in the example below.</p>\n\n<p>Ripped off from some of my own internal code:</p>\n\n<pre><code>func myLoggingHandler(next http.Handler) http.Handler {\n    return handlers.CombinedLoggingHandler(os.Stdout, next)\n}\n\nfunc main() {\n    r := mux.NewRouter()\n\n    if logging {\n        r.Use(myLoggingHandler)\n    }\n    if compress {\n        r.Use(handlers.CompressHandler)\n    }\n\n    http.Handle(\"/\", r)\n\n    log.Fatal(http.ListenAndServe(\"[::]:8009\", nil))\n\n}\n</code></pre>\n"}], "owner": {"reputation": 1951, "user_id": 1442219, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/6398031dc321aa3c975436e11d752f6b?s=128&d=identicon&r=PG", "display_name": "Lanti", "link": "https://stackoverflow.com/users/1442219/lanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 49330474, "answer_count": 1, "score": 1, "last_activity_date": 1521240380, "creation_date": 1521235838, "question_id": 49329798, "link": "https://stackoverflow.com/questions/49329798/changing-a-value-of-a-variable-which-is-inside-an-if-statement-that-referencing", "title": "Changing a value of a variable which is inside an if statement that referencing a flag", "body": "<p>I have the following Go program, which is a static file server. I'm getting the following error in the console:</p>\n\n<pre><code>..\\static\\main.go:45:5: cannot use handlers.CombinedLoggingHandler(os.Stdout, r) (type http.Handler) as type *mux.Router in assignment: need type assertion\n..\\static\\main.go:52:5: cannot use handlers.CompressHandler(l) (type http.Handler) as type *mux.Router in assignment: need type assertion\n</code></pre>\n\n<p>How can I use flags with the Gorilla Mux router and <code>CombinedLoggingHandler</code> or <code>CompressHandler</code>?</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n\n    \"github.com/gorilla/handlers\"\n    \"github.com/gorilla/mux\"\n\n    controllers \"&lt;this_is_a_local_repo&gt;\"\n    common \"&lt;this_is_a_local_repo&gt;\"\n)\n\nvar (\n    host     = flag.String(\"host\", \"127.0.0.1\", \"TCP host to listen to\")\n    port     = flag.String(\"port\", \"8081\", \"TCP port to listen to\")\n    logging  = flag.Bool(\"logging\", false, \"Whether to enable HTTP response logging\")\n    compress = flag.Bool(\"compress\", true, \"Whether to enable transparent response compression\")\n    dir      = flag.String(\"dir\", common.Abs(\"public\"), \"Directory to serve static files from\")\n)\n\nfunc main() {\n    flag.Parse()\n\n    r := mux.NewRouter().StrictSlash(true)\n    r.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", http.FileServer(http.Dir(*dir))))\n    r.PathPrefix(\"/\").HandlerFunc(controllers.IndexHandler(*dir + \"/index.html\")) // catch-all route for 404\n\n    l := r\n    if *logging {\n        l = handlers.CombinedLoggingHandler(os.Stdout, r)\n    }\n\n    h := l\n    if *compress {\n        h = handlers.CompressHandler(l) // gzip all responses\n    }\n\n    srv := &amp;http.Server{\n        Handler: h,\n        Addr:    fmt.Sprintf(\"%s:%s\", *host, *port),\n        ReadTimeout:  5 * time.Second,\n        WriteTimeout: 10 * time.Second,\n        IdleTimeout:  15 * time.Second,\n    }\n    log.Fatal(srv.ListenAndServe())\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "visual-studio-code", "delve"], "comments": [{"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 1, "creation_date": 1522782580, "post_id": 49329710, "comment_id": 86282639, "body": "You should toggle the developer tools and see if console shows in any exceptions, sometimes that running progress bar means there was an exception in JS code of VSCode"}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1523346794, "post_id": 49329710, "comment_id": 86510872, "body": "I believe Tyler&#39;s answer should do it. Please check and update"}], "answers": [{"comments": [{"owner": {"reputation": 11316, "user_id": 86731, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/876564dd7625975a8e9029fde0b48af0?s=128&d=identicon&r=PG", "display_name": "BryanWheelock", "link": "https://stackoverflow.com/users/86731/bryanwheelock"}, "edited": false, "score": 0, "creation_date": 1521245002, "post_id": 49329786, "comment_id": 85664147, "body": "The problem isn&#39;t getting the Helloworld code. I have downloaded the helloworld code. It works. I can&#39;t figure out how to get the debugger to start."}], "tags": [], "owner": {"reputation": 1029, "user_id": 1332738, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/9c03bce3bfdc90e4a7c21914bc306d30?s=128&d=identicon&r=PG", "display_name": "Victor Oliveira", "link": "https://stackoverflow.com/users/1332738/victor-oliveira"}, "is_accepted": false, "score": 1, "last_activity_date": 1542437073, "last_edit_date": 1542437073, "creation_date": 1521235762, "answer_id": 49329786, "question_id": 49329710, "link": "https://stackoverflow.com/questions/49329710/how-do-i-setup-vscode-debug-session-for-golang-and-appengine/49329786#49329786", "title": "How do I setup VScode debug session for Golang and AppEngine?", "body": "<p>Yes, it is outdated. The page you are getting from, does not exist. Instead, you can run </p>\n\n<pre><code>go get github.com/GoogleCloudPlatform/golang-samples/tree/master/appengine/helloworld/...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11316, "user_id": 86731, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/876564dd7625975a8e9029fde0b48af0?s=128&d=identicon&r=PG", "display_name": "BryanWheelock", "link": "https://stackoverflow.com/users/86731/bryanwheelock"}, "edited": false, "score": 0, "creation_date": 1523391236, "post_id": 49738162, "comment_id": 86539712, "body": "Shouldn&#39;t the port in the launch.json be the same as the assigned port in the the Delve headless server?"}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "reply_to_user": {"reputation": 11316, "user_id": 86731, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/876564dd7625975a8e9029fde0b48af0?s=128&d=identicon&r=PG", "display_name": "BryanWheelock", "link": "https://stackoverflow.com/users/86731/bryanwheelock"}, "edited": false, "score": 0, "creation_date": 1523391972, "post_id": 49738162, "comment_id": 86540075, "body": "Yes. You&#39;re right. I edited the post to correct the port."}, {"owner": {"reputation": 11316, "user_id": 86731, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/876564dd7625975a8e9029fde0b48af0?s=128&d=identicon&r=PG", "display_name": "BryanWheelock", "link": "https://stackoverflow.com/users/86731/bryanwheelock"}, "edited": false, "score": 0, "creation_date": 1523458582, "post_id": 49738162, "comment_id": 86571926, "body": "The documents say headless Delve server assigned port should match port config in launch.js but that creates a bind error. When I change port in config, Debug REPL shows API server listening but debugger sill doesn&#39;t show Variables."}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "reply_to_user": {"reputation": 11316, "user_id": 86731, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/876564dd7625975a8e9029fde0b48af0?s=128&d=identicon&r=PG", "display_name": "BryanWheelock", "link": "https://stackoverflow.com/users/86731/bryanwheelock"}, "edited": false, "score": 0, "creation_date": 1523468439, "post_id": 49738162, "comment_id": 86578029, "body": "The port specified in <code>dlv --headless -l &quot;localhost:2345&quot; attach</code> should definitely match the <code>&quot;port&quot;: 2345,</code> line in the configuration. I&#39;d suggest checking <code>lsof -n -i :2345</code> and <code>lsof -n -i :8080</code> (or whatever ports you&#39;re trying to use) to make sure everything is clear before starting everything up."}, {"owner": {"reputation": 11316, "user_id": 86731, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/876564dd7625975a8e9029fde0b48af0?s=128&d=identicon&r=PG", "display_name": "BryanWheelock", "link": "https://stackoverflow.com/users/86731/bryanwheelock"}, "edited": false, "score": 0, "creation_date": 1523567446, "post_id": 49738162, "comment_id": 86626609, "body": "I checked that port 2345 was unused before attaching Delve and I still got a bind error. See the EDIT above."}], "tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": true, "score": 13, "last_activity_date": 1523391899, "last_edit_date": 1523391899, "creation_date": 1523293755, "answer_id": 49738162, "question_id": 49329710, "link": "https://stackoverflow.com/questions/49329710/how-do-i-setup-vscode-debug-session-for-golang-and-appengine/49738162#49738162", "title": "How do I setup VScode debug session for Golang and AppEngine?", "body": "<p>VS Code never attaches to Delve because it is waiting to connect to the remote Delve server at <code>127.0.0.1:2345</code>. If you <code>dlv attach</code> in headless mode, listening at the correct address, you should hopefully be able to connect.</p>\n\n<p>The steps below describe how to debug a Go App Engine application running with <code>dev_appserver.py</code> and no other tools/helpers. However, when you make changes to your Go code, <code>dev_appserver.py</code> recompiles and restarts the application, changing the PID Delve needs to debug. <a href=\"http://github.com/dbenque/delveAppengine\" rel=\"noreferrer\">http://github.com/dbenque/delveAppengine</a> can help keep Delve attached to the right process. See <a href=\"https://medium.com/@dbenque/debugging-golang-appengine-module-with-visual-studio-code-85b3aa59e0f\" rel=\"noreferrer\">here</a> for a tutorial.</p>\n\n<ol>\n<li>Install the <a href=\"https://code.visualstudio.com/docs/languages/go\" rel=\"noreferrer\">VS Code Go extension</a>.</li>\n<li><code>go get -u -d github.com/directmeasure/VScodeDebugGoAppEngine.git</code></li>\n<li><p><code>cd $GOPATH/src/src/github.com/GoogleCloudPlatform/golang-samples/appengine/helloworld</code></p>\n\n<p>Note: if your GOPATH has more than one entry, <code>cd</code> to the directory <code>go get</code> downloaded to.</p></li>\n<li><p>Start the App Engine development server:</p>\n\n<p><code>dev_appserver.py --go_debugging=true app.yaml</code></p></li>\n<li>Visit <a href=\"http://localhost:8080\" rel=\"noreferrer\">http://localhost:8080</a> to ensure the server is running.</li>\n<li><p>Find the PID of the Go process:</p>\n\n<p><code>ps aux | grep _go_app</code></p></li>\n<li><p>Start the Delve server (select any port available on your system):</p>\n\n<p><code>dlv --headless -l \"localhost:2345\" attach $GO_APP_PID</code></p></li>\n<li>Open the VS Code debug tab (\u21e7\u2318D on macOS, Ctrl+Shift+D on Windows &amp; Linux).</li>\n<li>Create a new launch configuration by clicking the gear and selecting any entry (see official docs <a href=\"https://code.visualstudio.com/docs/editor/debugging#_launch-configurations\" rel=\"noreferrer\">here</a>).</li>\n<li><p>Create a \"Go: Connect to server\" entry:<img src=\"https://i.stack.imgur.com/mxCrd.png\" alt=\"create config dropdown\"></p>\n\n<p>Note: this is only a template - you can edit it later.</p></li>\n<li><p>Customize the config to point to the port you specified when starting Delve. Here is my full configuration:</p>\n\n<pre>\n{\n    \"name\": \"Launch\",\n    \"type\": \"go\",\n    \"request\": \"launch\",\n    \"mode\": \"debug\",\n    \"remotePath\": \"\",\n    \"port\": 2345,\n    \"host\": \"127.0.0.1\",\n    \"program\": \"${fileDirname}\",\n    \"env\": {},\n    \"args\": [],\n    \"showLog\": true\n}\n</pre></li>\n<li>Add breakpoints as desired and visit <a href=\"http://localhost:8080\" rel=\"noreferrer\">http://localhost:8080</a> again. Execution should stop when a breakpoint is reached, variables should be listed in the variables section in VS Code, and the call stack should be in the call stack section.</li>\n</ol>\n\n<p>For general help with debugging Go code in VS Code (not run with App Engine), see <a href=\"https://github.com/Microsoft/vscode-go/wiki/Debugging-Go-code-using-VS-Code\" rel=\"noreferrer\">https://github.com/Microsoft/vscode-go/wiki/Debugging-Go-code-using-VS-Code</a>.</p>\n"}], "owner": {"reputation": 11316, "user_id": 86731, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/876564dd7625975a8e9029fde0b48af0?s=128&d=identicon&r=PG", "display_name": "BryanWheelock", "link": "https://stackoverflow.com/users/86731/bryanwheelock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3648, "favorite_count": 2, "accepted_answer_id": 49738162, "answer_count": 2, "score": 22, "last_activity_date": 1542437073, "creation_date": 1521235328, "last_edit_date": 1537873177, "question_id": 49329710, "link": "https://stackoverflow.com/questions/49329710/how-do-i-setup-vscode-debug-session-for-golang-and-appengine", "title": "How do I setup VScode debug session for Golang and AppEngine?", "body": "<h1>VScodeDebugGoAppEngine</h1>\n\n<p>Hello World tutorial that shows how to setup VS Code to debug Golang App Engine code with Visual Studio (aka VScode )</p>\n\n<p>This is using using the Helloworld code from AppEngine documentation:</p>\n\n<pre><code>go get -u -d github.com/directmeasure/VScodeDebugGoAppEngine.git\n</code></pre>\n\n<p>on a Mac running osX 10.13.3.   </p>\n\n<p>I've tested the code and the server works locally. I'm trying to figure out how to enter into the code with the debugger so I can learn how to use the debugger on other projects.</p>\n\n<p>These were the best instructions I could find for using VScode with GAE but they seem to be outdated based on updates to Golang(e.g.  switch to Gcloud, -go_debugging flag and change of directory structure):<br>\n<a href=\"https://medium.com/@dbenque/debugging-golang-appengine-module-with-visual-studio-code-85b3aa59e0f\" rel=\"nofollow noreferrer\">https://medium.com/@dbenque/debugging-golang-appengine-module-with-visual-studio-code-85b3aa59e0f</a> </p>\n\n<p>Here are the steps I took:</p>\n\n<h1>set up Environment</h1>\n\n<ul>\n<li><p>added to .bash_profile  </p>\n\n<pre><code>export BASEFOLDER=\"/Users/Bryan/google-cloud-sdk/\" . \nexport GOROOT=\"/usr/local/go\" # this shoudln't have to be set with current Version, doing it to follow the tutorial . \n</code></pre></li>\n</ul>\n\n<p>How I have attempted to get debugger to run:  </p>\n\n<h1>start local server .</h1>\n\n<pre><code>dev_appserver.py --go_debugging=true app.yaml\n</code></pre>\n\n<h1>attach local binary to Delve</h1>\n\n<pre><code> ps aux | grep _go_app \n\ndlv attach &lt;#using the PID from the server binary&gt;\n</code></pre>\n\n<p>Delve successfully attaches to the binary.</p>\n\n<p>When I start the <strong>Debug session</strong>, the blue progress bar never stops scanning horizontally.</p>\n\n<p>The VARIABLE sidebar is never populated with the variables in hello.go</p>\n\n<p>The Breakpoint is set at hello.go: line 21</p>\n\n<p>The Debug REPL terminal displays: </p>\n\n<pre><code>Verbose logs are written to:  \n/var/folders/mw/0y88j8_54bjc93d_lg3120qw0000gp/T/vscode-go-debug.txt  \n16:02:31, 2018-4-5  \nInitializeRequest  \nInitializeResponse  \nUsing GOPATH: /Users/Bryan/go  \nfmt.Print(u)  \nPlease start a debug session to evaluate  \n</code></pre>\n\n<p>Here is the launch.json config:</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",  \n    \"configurations\": [   \n    {\n        \"name\": \"Launch\",\n        \"type\": \"go\",\n        \"request\": \"launch\",\n        \"mode\": \"debug\",\n        \"remotePath\": \"\",\n        //\"port\": 1234,  \n        \"port\": 2345   // docs say port should match assigned port headless server, https://github.com/Microsoft/vscode-go/wiki/Debugging-Go-code-using-VS-Code#remote-debugging\n                         // this creates bind error\n        \"host\": \"127.0.0.1\",\n        \"program\": \"${workspaceFolder}/hello.go\",\n        \"env\": {},\n        \"args\": [],\n        \"showLog\": true,\n        \"trace\": true,\n    }\n    ]\n}\n</code></pre>\n\n<p>Here are the versions I have installed:  </p>\n\n<pre><code>go version go1.10 darwin/amd64  \n$ gcloud version . \nGoogle Cloud SDK 197.0.0\napp-engine-go \napp-engine-python 1.9.68\nbq 2.0.31\ncore 2018.04.06\ngsutil 4.30\n\nVS code extension:\nGo 0.6.78\n</code></pre>\n\n<p>EDIT###########################  </p>\n\n<pre><code>$ lsof -n -i :8080\nBryan@Bryans-MacBook-Pro Thu Apr 12 17:02:04 ~ \n$ lsof -n -i :2345\n\nBryan@Bryans-MacBook-Pro Thu Apr 12 17:03:34 ~ \n$ ps aux | grep _go_app\nBryan             7433   0.0  0.0  2434840    800 s000  S+    5:03PM   0:00.00 grep _go_app\nBryan             7426   0.0  0.0 556603172   3896 s002  S+    5:02PM   0:00.01 /var/folders/mw/0y88j8_54bjc93d_lg3120qw0000gp/T/tmp8GWk1gappengine-go-bin/_go_app\n\nBryan@Bryans-MacBook-Pro Thu Apr 12 17:03:52 ~ \n$ dlv attach --headless -l \"localhost:2345\" 7426 /var/folders/mw/0y88j8_54bjc93d_lg3120qw0000gp/T/tmp8GWk1gappengine-go-bin/_go_app\nAPI server listening at: 127.0.0.1:2345\n</code></pre>\n\n<p>When I start the Debugger, REPL shows:  </p>\n\n<pre><code>Verbose logs are written to:\n/var/folders/mw/0y88j8_54bjc93d_lg3120qw0000gp/T/vscode-go-debug.txt\ncouldn't start listener: listen tcp 127.0.0.1:2345: bind: address already in use\nProcess exiting with code: 1\n</code></pre>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1521228159, "post_id": 49327907, "comment_id": 85658007, "body": "None of your fields are exported (they start with lowercase letters), so none of them will be serialized and stored in Mongo."}, {"owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521228610, "post_id": 49327907, "comment_id": 85658235, "body": "The fields are stored. As I mentioned, CreateOrUpdate method insert data into mongodb but it not update existing ones"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521228735, "post_id": 49327907, "comment_id": 85658307, "body": "If they&#39;re there, they got there from somewhere else, or the code you posted isn&#39;t what you&#39;re using. <i>You cannot serialize from, or deserialize into, unexported fields</i>."}, {"owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521228957, "post_id": 49327907, "comment_id": 85658422, "body": "@Adrian State fields you mean?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521228994, "post_id": 49327907, "comment_id": 85658442, "body": "Correct. That&#39;s the type you&#39;re trying to serialize and deserialize, and it will not work as written."}, {"owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521229172, "post_id": 49327907, "comment_id": 85658528, "body": "I changed and now prints { 0001-01-01 00:00:00 +0000 UTC  0}"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521229219, "post_id": 49327907, "comment_id": 85658558, "body": "OK. Without being able to see the updated code, I have no way to know if the changes are correct or what your issue now might be."}, {"owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521229408, "post_id": 49327907, "comment_id": 85658647, "body": "Code has been updated"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1521229682, "post_id": 49327907, "comment_id": 85658800, "body": "<code>GetById</code> never references the ID you pass in to it, so who knows what record you&#39;re getting back. Your <code>Upsert</code> call should also probably just pass in the State object instead of manually converting it into a <code>bson.M</code>."}, {"owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521230685, "post_id": 49327907, "comment_id": 85659310, "body": "Thanks @Adrian. I corrected the CreateOrUpdate method and everything went well :)"}], "answers": [{"tags": [], "owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "is_accepted": false, "score": 0, "last_activity_date": 1521460085, "creation_date": 1521460085, "answer_id": 49362241, "question_id": 49327907, "link": "https://stackoverflow.com/questions/49327907/getbyid-and-createorupdate-not-working/49362241#49362241", "title": "GetById and CreateOrUpdate not working", "body": "<p>The code below work as intended</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype State struct {\n    CustomerId  string\n    CreatedOn   time.Time\n    CreatedBy   string\n    Description string\n}\n\ntype DataStore struct {\n    session *mgo.Session\n    err     error\n}\n\nfunc (ds *DataStore) getCol(collectionName string) *mgo.Collection {\n\n    ds.session, ds.err = mgo.Dial(\"localhost:27017\")\n\n    if ds.err != nil {\n        panic(ds.err)\n    }\n\n    return ds.session.DB(\"c3po_db\").C(collectionName)\n}\n\nfunc (ds *DataStore) GetAll() []State {\n\n    var states []State\n    ds.err = ds.getCol(\"state\").Find(bson.M{}).All(&amp;states)\n    if ds.err != nil {\n        panic(ds.err)\n    }\n\n    ds.session.Close()\n    return states\n}\n\nfunc (ds *DataStore) GetById(customerId string) State {\n\n    var state State\n    ds.err = ds.getCol(\"state\").Find(bson.M{\"customerId\": customerId}).One(&amp;state)\n    if ds.err != nil {\n        panic(ds.err)\n    }\n\n    ds.session.Close()\n    return state\n\n}\n\nfunc (ds *DataStore) CreateOrUpdate(state State) bool {\n\n    _, ds.err = ds.getCol(\"state\").Upsert(\n        bson.M{\"customerId\": state.CustomerId},\n        bson.M{\"$set\": state})\n    if ds.err != nil {\n        panic(ds.err)\n    } else {\n        ds.session.Close()\n        return true\n    }\n\n    ds.session.Close()\n    return false\n}\n\nfunc main() {\n\n    ds := DataStore{}\n\n    state := State{CustomerId: \"3\", CreatedOn: time.Now(), CreatedBy: \"Ivo\", Description: \"6\"}\n\n    ds.CreateOrUpdate(state)\n\n    fmt.Println(ds.GetById(\"3\"))\n\n    fmt.Println(ds.GetAll())\n\n}\n</code></pre>\n"}], "owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1521460085, "creation_date": 1521227186, "last_edit_date": 1521230165, "question_id": 49327907, "link": "https://stackoverflow.com/questions/49327907/getbyid-and-createorupdate-not-working", "title": "GetById and CreateOrUpdate not working", "body": "<p>I'm trying to create a simple CRUD with mgo (mongodb).</p>\n\n<p>Here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype State struct {\n    CustomerId  string\n    CreatedOn   time.Time\n    CreatedBy   string\n    Description string\n}\n\ntype DataStore struct {\n    session *mgo.Session\n    err     error\n}\n\nfunc (ds *DataStore) getCol(collectionName string) *mgo.Collection {\n\n    ds.session, ds.err = mgo.Dial(\"localhost:27017\")\n\n    if ds.err != nil {\n        panic(ds.err)\n    }\n\n    return ds.session.DB(\"c3po_db\").C(collectionName)\n}\n\nfunc (ds *DataStore) GetAll() []State {\n\n    var states []State\n    ds.err = ds.getCol(\"state\").Find(bson.M{}).All(&amp;states)\n    if ds.err != nil {\n        panic(ds.err)\n    }\n\n    ds.session.Close()\n    return states\n}\n\nfunc (ds *DataStore) GetById(customerId string) State {\n\n    var state State\n    ds.err = ds.getCol(\"state\").Find(bson.M{\"customerId\": customerId}).One(&amp;state)\n    if ds.err != nil {\n        panic(ds.err)\n    }\n\n    ds.session.Close()\n    return state\n\n}\n\nfunc (ds *DataStore) CreateOrUpdate(state State) bool {\n\n    _, ds.err = ds.getCol(\"state\").Upsert(\n        bson.M{\"customerId\": state.CustomerId},\n        bson.M{\"$set\": bson.M{\"description\": state.Description, \"createdOn\": state.CreatedOn, \"createdBy\": state.CreatedBy}})\n    if ds.err != nil {\n        panic(ds.err)\n    } else {\n        ds.session.Close()\n        return true\n    }\n\n    ds.session.Close()\n    return false\n}\n\nfunc main() {\n\n    ds := DataStore{}\n\n    state := State{CustomerId: \"3\", CreatedOn: time.Now(), CreatedBy: \"Ivo\", Description: \"6\"}\n\n    ds.CreateOrUpdate(state)\n\n    fmt.Println(ds.GetById(\"3\"))\n\n}\n</code></pre>\n\n<p>As result I get</p>\n\n<pre><code>{ 0001-01-01 00:00:00 +0000 UTC  0}                                   \n</code></pre>\n\n<p>It prints an empty result for GetById. The CreateOrUpdate method works partially. It only inserts a new record, it does not update an existing one.\nIs it the correct way of doing it?\nWhat can be done to make GetById and CreateOrUpdate method work?</p>\n"}, {"tags": ["macos", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1521226182, "post_id": 49327658, "comment_id": 85657172, "body": "check your environment variables"}, {"owner": {"reputation": 99, "user_id": 852329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11bcadf15046a199c661894f9c35680b?s=128&d=identicon&r=PG", "display_name": "lafolle", "link": "https://stackoverflow.com/users/852329/lafolle"}, "edited": false, "score": 0, "creation_date": 1521394229, "post_id": 49327658, "comment_id": 85701449, "body": "I don&#39;t think gcc is needed to compile Go programs anymore unless you specify it explicitly.  I get somewhat similar error if I do <code>go build -compiler gccgo</code> -&gt; <code>cmd&#47;go: gccgo: exec: &quot;gccgo&quot;: executable file not found in $PATH</code> (I&#39;m on linux).  Is it possible to compile your code  like this? <code>go build -compiler gc</code> ?"}, {"owner": {"reputation": 1, "user_id": 5776698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aefdc89e84a1514eb9aa1b357712dbfc?s=128&d=identicon&r=PG", "display_name": "Fernando S.", "link": "https://stackoverflow.com/users/5776698/fernando-s"}, "reply_to_user": {"reputation": 99, "user_id": 852329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11bcadf15046a199c661894f9c35680b?s=128&d=identicon&r=PG", "display_name": "lafolle", "link": "https://stackoverflow.com/users/852329/lafolle"}, "edited": false, "score": 0, "creation_date": 1521484178, "post_id": 49327658, "comment_id": 85740962, "body": "@lafolle I thought I had added this comment but JimB&#39;s response was correct. I had CC set to gcc-6. Unsetting that variable allowed the code to compile. Just for the record, <code>go build -compiler gc</code> fails with the same error (i.e., <code>gcc-6 not found</code>) in that environment."}], "owner": {"reputation": 1, "user_id": 5776698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aefdc89e84a1514eb9aa1b357712dbfc?s=128&d=identicon&r=PG", "display_name": "Fernando S.", "link": "https://stackoverflow.com/users/5776698/fernando-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1521226085, "creation_date": 1521226085, "question_id": 49327658, "link": "https://stackoverflow.com/questions/49327658/go1-10-build-failing-with-gcc-6-reference", "title": "go1.10 build failing with gcc-6 reference", "body": "<p>I have go1.10 installed via Homebrew (had the same issue installing the official golang.org package for macOS).</p>\n\n<p>I'm failing to buid a fairly simple go program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/health\", healthHandler)\n\n    fmt.Println(\"Listening for connections\")\n    http.ListenAndServe(\"127.0.0.1:5000\", nil)\n}\n\nfunc healthHandler(writer http.ResponseWriter, request *http.Request) {\n    fmt.Fprint(writer, \"Healthy!\")\n}\n</code></pre>\n\n<p><code>go build</code> fails with:</p>\n\n<pre><code># crypto/x509\nfork/exec /usr/local/bin/gcc-6: no such file or directory\n</code></pre>\n\n<p>I don't have <code>gcc-6</code> in my system (I have <code>gcc-7</code> from both Xcode and Homebrew).\nOddly, I can build the same code on a different mac (with same overall setup: <code>go1.10</code>, no <code>gcc-6</code>).</p>\n\n<p>I've tried reinstalling the whole go/gcc combo through Homebrew but nothing seems to work. At this point I just feel lost.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["database", "unit-testing", "go", "mocking"], "answers": [{"comments": [{"owner": {"reputation": 5834, "user_id": 393109, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1b8c2e6df5cbbbe81e02be9537697305?s=128&d=identicon&r=PG", "display_name": "mohi666", "link": "https://stackoverflow.com/users/393109/mohi666"}, "edited": false, "score": 0, "creation_date": 1521227275, "post_id": 49327646, "comment_id": 85657602, "body": "Thanks for the quick response. I changed the type to Rower, but I got this error: *sql.DB does not implement appinfo.DBer (wrong type for Query method)                 have Query(string, ...interface {}) (*sql.Rows, error)                 want Query(string, ...interface {}) (appinfo.Rower, error) That&#39;s why I ended up changing the return type to *sql.Rows. However, when I run my tests rows.Close() panics with this: panic: runtime error: invalid memory address or nil pointer dereference  I need to figure out how to create a fake *sql.Rows that doesn&#39;t panic when Close() is called,"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5834, "user_id": 393109, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1b8c2e6df5cbbbe81e02be9537697305?s=128&d=identicon&r=PG", "display_name": "mohi666", "link": "https://stackoverflow.com/users/393109/mohi666"}, "edited": false, "score": 0, "creation_date": 1521228049, "post_id": 49327646, "comment_id": 85657950, "body": "You&#39;ll actually have to mock it rather than just returning a nil pointer to the real type."}, {"owner": {"reputation": 5834, "user_id": 393109, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1b8c2e6df5cbbbe81e02be9537697305?s=128&d=identicon&r=PG", "display_name": "mohi666", "link": "https://stackoverflow.com/users/393109/mohi666"}, "edited": false, "score": 0, "creation_date": 1521231809, "post_id": 49327646, "comment_id": 85659828, "body": "sql.Rows is a rather big struct. <a href=\"https://golang.org/src/database/sql/sql.go?s=71562:72284#L2539\" rel=\"nofollow noreferrer\">golang.org/src/database/sql/sql.go?s=71562:72284#L2539</a> I wish it were an interface. I&#39;m scratching my head to figure out a way to mock it now."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521231911, "post_id": 49327646, "comment_id": 85659870, "body": "You don&#39;t need to wish it were an interface. Just create the interface you need and use it in place of <code>sql.Rows</code> in your types. That&#39;s the beauty of Go&#39;s duck-typed interfaces - the implementation doesn&#39;t have to know about the interface."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 5834, "user_id": 393109, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1b8c2e6df5cbbbe81e02be9537697305?s=128&d=identicon&r=PG", "display_name": "mohi666", "link": "https://stackoverflow.com/users/393109/mohi666"}, "edited": false, "score": 1, "creation_date": 1521232206, "post_id": 49327646, "comment_id": 85660007, "body": "@mohi666 it&#39;s actually simple, take a look at this: <a href=\"https://play.golang.org/p/57fhkok0kEN\" rel=\"nofollow noreferrer\">play.golang.org/p/57fhkok0kEN</a> (fixed link). Using this your mock implementation of Dber can return a mock implementation of Rower, and anytime you need the real thing use the adapter."}, {"owner": {"reputation": 5834, "user_id": 393109, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1b8c2e6df5cbbbe81e02be9537697305?s=128&d=identicon&r=PG", "display_name": "mohi666", "link": "https://stackoverflow.com/users/393109/mohi666"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521235460, "post_id": 49327646, "comment_id": 85661448, "body": "@mkopriva Thank you. That would work too. I really appreciate your help and suggestions."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1521226375, "last_edit_date": 1521226375, "creation_date": 1521226016, "answer_id": 49327646, "question_id": 49327497, "link": "https://stackoverflow.com/questions/49327497/faking-db-methods-in-golang/49327646#49327646", "title": "Faking DB methods in Golang", "body": "<p>The problem is that <code>DBer.Query</code> returns a generic <code>interface{}</code>, which the compiler cannot assume has any methods at all:</p>\n\n<pre><code>Query(query string, args ...interface{}) (interface{}, error)\n</code></pre>\n\n<p>Meaning, unless you use a type assertion, you cannot call any methods on the returned value. Perhaps it should instead return <code>(Rower, error)</code>?</p>\n\n<p>The compiler, in effect, sees this:</p>\n\n<pre><code>rows, err := a.DB.Query(query)\n</code></pre>\n\n<p><code>rows</code> is a <code>interface{}</code>. It could be anything. It could be an <code>int</code>. It cannot assume it has any methods at all. So when you pass it to <code>parseRows</code>:</p>\n\n<pre><code>parseRows(rows, appInfos)\n</code></pre>\n\n<p>Defined as:</p>\n\n<pre><code>func parseRows(rows Rower, infos []AppInfo) ([]AppInfo, error)\n</code></pre>\n\n<p>Well, it takes a <code>Rower</code>, but you're passing an <code>interface{}</code>, which is not guaranteed to implement <code>Rower</code>. Hence the compiler error you're getting:</p>\n\n<pre><code>interface {} does not implement Rower (missing Close method)\n</code></pre>\n\n<p>It has nothing to do with the underlying value, but rather the type of the variable. The variable is of type <code>interface{}</code>, which has no methods, and therefor does not implement <code>Rower</code>.</p>\n"}], "owner": {"reputation": 5834, "user_id": 393109, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1b8c2e6df5cbbbe81e02be9537697305?s=128&d=identicon&r=PG", "display_name": "mohi666", "link": "https://stackoverflow.com/users/393109/mohi666"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 862, "favorite_count": 0, "accepted_answer_id": 49327646, "answer_count": 1, "score": 1, "last_activity_date": 1521226375, "creation_date": 1521225308, "question_id": 49327497, "link": "https://stackoverflow.com/questions/49327497/faking-db-methods-in-golang", "title": "Faking DB methods in Golang", "body": "<p>I'm trying to create a unit test for the following function that is making database calls internally using Postgres driver:</p>\n\n<pre><code>type DBer interface {\n    Exec(query string, args ...interface{}) (sql.Result, error)\n    Query(query string, args ...interface{}) (interface{}, error)\n    QueryRow(query string, args ...interface{}) *sql.Row\n    Prepare(query string) (*sql.Stmt, error)\n}\n\ntype AppInfoCtrl struct {\n    DB DBer\n}\n\ntype Rower interface {\n    Next() bool\n    Close() error\n    Scan(...interface{}) error\n}\n\nfunc parseRows(rows Rower, infos []AppInfo) ([]AppInfo, error) {\n    defer rows.Close()\n    for rows.Next() {\n        var i AppInfo\n        if err := rows.Scan(&amp;i.Id, &amp;i.Platform); err != nil {\n            return nil, err\n        }\n        infos = append(infos, i)\n    }\n    return infos, nil\n}\n\nfunc (a *AppInfoCtrl) List() ([]AppInfo, error) {\n    query := \"select id, platform from appinfo where deleted = false\"\n    rows, err := a.DB.Query(query)\n    if err != nil {\n        return nil, err\n    }\n\n    appInfos := []AppInfo{}\n    parseRows(rows, appInfos)\n\n    return appInfos, nil\n}\n</code></pre>\n\n<p>And my test looks like this:</p>\n\n<pre><code>func (f *FakeDB) Query(query string, args ...interface{}) (*sql.Rows, error) {\n    fmt.Println(query)\n    var rows *sql.Rows\n    return rows, nil\n}\n</code></pre>\n\n<p>However, after running this I get the following compilation error:</p>\n\n<pre><code>appinfo/controller.go:68:11: cannot use rows (type interface {}) as type Rower in argument to parseRows:\n        interface {} does not implement Rower (missing Close method)\n</code></pre>\n\n<p>When I look at the source code, sql.Rows does implement Close():</p>\n\n<p><a href=\"https://golang.org/pkg/database/sql/#Rows.Close\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#Rows.Close</a></p>\n\n<p>Any idea what I need to do here? Am I even taking the right approach to test List() here? I'm not particularly picky about testing parseRows() as it only contains calls to db.Rows, but I need to at least test List here.</p>\n"}, {"tags": ["javascript", "go", "websocket", "go-html-template"], "comments": [{"owner": {"reputation": 574451, "user_id": 816620, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Xu7hp.jpg?s=128&g=1", "display_name": "jfriend00", "link": "https://stackoverflow.com/users/816620/jfriend00"}, "edited": false, "score": 0, "creation_date": 1521222664, "post_id": 49326732, "comment_id": 85655212, "body": "When you receive data over the websocket in the client, you use normal DOM manipulation methods to insert or change content in the existing page (such as changing <code>.innerHTML</code> on some page element).  You can&#39;t use server-side rendering from your client-side webSocket data unless the server is sending you fully formed HTML that you just need to insert into a frame or div.  You could use client-side template rendering and then insert the rendered template into the page if you have the template and rendering library locally in the client."}, {"owner": {"reputation": 13, "user_id": 9502852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ffa84864009dd58da00af0bf3fdaf83?s=128&d=identicon&r=PG&f=1", "display_name": "Haknazar", "link": "https://stackoverflow.com/users/9502852/haknazar"}, "reply_to_user": {"reputation": 574451, "user_id": 816620, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Xu7hp.jpg?s=128&g=1", "display_name": "jfriend00", "link": "https://stackoverflow.com/users/816620/jfriend00"}, "edited": false, "score": 0, "creation_date": 1521290769, "post_id": 49326732, "comment_id": 85673692, "body": "@jfriend00 I was guided by the answer <a href=\"https://stackoverflow.com/questions/42309020/golang-template-range-for-loop-using-json-from-websocket\" title=\"golang template range for loop using json from websocket\">stackoverflow.com/questions/42309020/&hellip;</a>  but failed."}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 9502852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ffa84864009dd58da00af0bf3fdaf83?s=128&d=identicon&r=PG&f=1", "display_name": "Haknazar", "link": "https://stackoverflow.com/users/9502852/haknazar"}, "is_accepted": true, "score": 0, "last_activity_date": 1521551869, "creation_date": 1521551869, "answer_id": 49385317, "question_id": 49326732, "link": "https://stackoverflow.com/questions/49326732/how-to-change-templates-using-websockets/49385317#49385317", "title": "How to change templates using websockets?", "body": "<p>It was necessary to specify id.; <code>&lt;div id= \"scene\"&gt;\n     {{template \"main\"}}\n   &lt;/div&gt;</code></p>\n\n<p>instead <code>&lt;div class = \"scene\"&gt;\n     {{template \"main\"}}\n   &lt;/div&gt;</code></p>\n\n<p>Because What I'm looking for by Id and not by class.\n<code>document.getElementById('scene').innerHTML = message</code></p>\n"}], "owner": {"reputation": 13, "user_id": 9502852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ffa84864009dd58da00af0bf3fdaf83?s=128&d=identicon&r=PG&f=1", "display_name": "Haknazar", "link": "https://stackoverflow.com/users/9502852/haknazar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 338, "favorite_count": 0, "accepted_answer_id": 49385317, "answer_count": 1, "score": 0, "last_activity_date": 1521551869, "creation_date": 1521222462, "question_id": 49326732, "link": "https://stackoverflow.com/questions/49326732/how-to-change-templates-using-websockets", "title": "How to change templates using websockets?", "body": "<p>I want to split the page into fragments and use the web sockets to change them without reloading the page.</p>\n\n<pre><code> {{define \"index\"}}\n {{template \"head\"}}\n  &lt;div class = \"scene\"&gt;\n     {{template \"main\"}}\n   &lt;/div&gt;\n\n{{template \"foot\"}}\n{{end}}\n</code></pre>\n\n<p>I read the json from the client and find out which page to open.</p>\n\n<pre><code>func webSocketHandler(conn *websocket.Conn) {\n\n data := conn.ReadJSON(&amp;msg)\n\n if data != nil {\n    log.Fatal(data)\n    return\n }\n\n  LoadVista(msg.Temp,conn)\n}\nvar (\nindexTemplate = template.Must(template.ParseFiles(indexVista,mainVista,headVista,footVista \n))\nloginTemplate = template.Must(template.ParseFiles(loginVista))\n)\n\nfunc LoadVista(nameTemplate string, conn *websocket.Conn) {\n switch nameTemplate {\n case \"page2\":\n    templateWsRender(nameTemplate,conn)\n }\n\n}\nfunc templateWsRender(name string,conn *websocket.Conn){\n//defer conn.Close()\n var buf  bytes.Buffer\n data := page2Template.ExecuteTemplate(&amp;buf,name,nil)\n if data!=nil{\n    log.Fatal(data)\n }\n err := conn.WriteMessage(1,buf.Bytes())\n if err!=nil{\n    log.Fatal(err)\n }\n\n}\n</code></pre>\n\n<p>Client code</p>\n\n<pre><code>var socket = new WebSocket('ws://localhost:7030/ws' )\n\nsocket.onmessage = function (event) {\n  var message = event.data\n  loadVista(message)\n}\n\nelem.addEventListener( \"click\" , sendQuery);\nfunction sendQuery() {\n  var page = {\n    query_type :\"openLink\",\n    temp: \"page\"\n }\nvar event = JSON.stringify(page);\n\nsocket.send(event);\n}\n\nfunction loadVista(message) {\n//alert(message)\ndocument.getElementById('scene').innerHTML = message.data;\n}\n</code></pre>\n\n<p>But the \"main\" template does not change to the \"page 2\" template. Give advice on how to properly organize the change of templates using Go + js (webscokets). Thanks!</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521222758, "post_id": 49326675, "comment_id": 85655266, "body": "@Adrian he is using an interface."}], "answers": [{"comments": [{"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1521228285, "post_id": 49328083, "comment_id": 85658064, "body": "Thanks Josiah for the answer and for taking the time for reading. Not sure if i&#39;m getting your idea, perpahs you can write the underlying code your are talking about and in that way i get no excuses for no understanding!"}, {"owner": {"reputation": 141, "user_id": 6044659, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XcR8I.png?s=128&g=1", "display_name": "Josiah Niedrauer", "link": "https://stackoverflow.com/users/6044659/josiah-niedrauer"}, "reply_to_user": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 1, "creation_date": 1521229467, "post_id": 49328083, "comment_id": 85658684, "body": "Here&#39;s a quick and dirty example: <a href=\"https://play.golang.org/p/YuFhkDvTlwf\" rel=\"nofollow noreferrer\">play.golang.org/p/YuFhkDvTlwf</a>"}], "tags": [], "owner": {"reputation": 141, "user_id": 6044659, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XcR8I.png?s=128&g=1", "display_name": "Josiah Niedrauer", "link": "https://stackoverflow.com/users/6044659/josiah-niedrauer"}, "is_accepted": false, "score": 1, "last_activity_date": 1521228036, "creation_date": 1521228036, "answer_id": 49328083, "question_id": 49326675, "link": "https://stackoverflow.com/questions/49326675/is-there-a-recommended-way-to-define-common-behaviour-for-collection-of-slices/49328083#49328083", "title": "Is there a recommended way to define common behaviour for collection of slices?", "body": "<p>I think maybe this is overcomplicated. Define FindEnclosingHalfOpenInterval as a standalone function, and then for functions which need to work with HalfOpenInterval structs, make then accept an interface that has a EnclosingHalfOpenInterval method which usually just calls FindEnclosingHalfOpenInterval. That way you can do any kind of edge case data encapsulation without changing the signature.</p>\n\n<p>And that's really all there is to it. FindEnclosingHalfOpenInterval is already shared because it's not explicitly part of any struct.</p>\n"}, {"comments": [{"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1521296583, "post_id": 49330293, "comment_id": 85676129, "body": "Thanks  you very much TehS\u1e55hinX!!, this is a indeed way to get rid of this, and very well explanined.  Let&#39;s wait a little more for anothers answer in this matter, and eventually, i will mark this answer as correct. I would guess that defining common behaviour for collection of things is a complicated subject in every programming languaje.."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1521298760, "post_id": 49330293, "comment_id": 85676804, "body": "Nit: Go doesn&#39;t have casts, only type conversions."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521311815, "post_id": 49330293, "comment_id": 85681128, "body": "@Peter: thanks for the hint. I corrected it in my answer."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1521464948, "post_id": 49330293, "comment_id": 85727767, "body": "i&#39;m sure to have answered to someone Peter in another post, but it seems to be vanished.. so, i mark this as correct answer as proves (to me) to add valuable knowledge on how to strive this problem about common behaviour on slices."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 2, "last_activity_date": 1521311782, "last_edit_date": 1521311782, "creation_date": 1521238984, "answer_id": 49330293, "question_id": 49326675, "link": "https://stackoverflow.com/questions/49326675/is-there-a-recommended-way-to-define-common-behaviour-for-collection-of-slices/49330293#49330293", "title": "Is there a recommended way to define common behaviour for collection of slices?", "body": "<p>The key Problem here is you need to convert a slice from one type to another type.</p>\n\n<h2>Converting Slices</h2>\n\n<p>The correct way to do this is to create a new slice and loop over it converting every single item. You can do this fast(er) if you create the array beforehand:</p>\n\n<pre><code>func ToIntervalsFromClockIntervals(clockIntervals []ClockInterval) HalfOpenIntervals {\n    intervals := make(HalfOpenIntervals, 0, len(clockIntervals))\n    for _, clockInterval := range clockIntervals {\n        intervals = append(intervals, clockInterval)\n    }\n    return intervals\n}\n</code></pre>\n\n<h2>Composition</h2>\n\n<p>Apart from that composition is another way you could solve the problem that you want to write the <code>GetEnclosingInterval</code> function only once. I'm not saying it is better: it has other advantages and disadvantages. What fits better depends on how else you use the slices apart from what you posted here.</p>\n\n<p>Here my refactored suggestion (and fixed): <a href=\"https://play.golang.org/p/Ko43hJUMpyT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ko43hJUMpyT</a> (TehS\u1e55hinX you forgot to make the <strong>mutable method</strong> <code>baseIntervals.add</code> with <code>pointer recievers</code> instead of<code>value recievers</code>(or whatever is the name for <code>non-pointer recievers</code>))</p>\n\n<p>The <code>HalfOpenIntervals</code> does not exist any more. Instead you have two different types for <code>CLockIntervals</code> and <code>PeriodIntervals</code> and both have the sorting and <code>GetEnclosingInterval</code> function implemented via a common base struct.</p>\n\n<p>For convenience I added a <code>Add</code> function and a <code>New...</code> function for each of them. This is where the disadvantages come in: Since <code>CLockIntervals</code> (and <code>PeriodIntervals</code>) is not a slice any more but a struct you will need convenience functions to work with the inner slice from the outside.</p>\n\n<p>-- edit --</p>\n\n<h2>Over generalising</h2>\n\n<p>Coming from a oo-oriented background myself I know the drive to avoid duplicated code at all costs.</p>\n\n<p>Writing go code for more than 2 years now on a full time basis I learned that this is not always the best approach in go. Duplicating code in go for different types is a common thing I do these days. Not sure if all would agree with this statement, though.</p>\n"}], "owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 1, "accepted_answer_id": 49330293, "answer_count": 2, "score": 5, "last_activity_date": 1524074106, "creation_date": 1521222259, "last_edit_date": 1524074106, "question_id": 49326675, "link": "https://stackoverflow.com/questions/49326675/is-there-a-recommended-way-to-define-common-behaviour-for-collection-of-slices", "title": "Is there a recommended way to define common behaviour for collection of slices?", "body": "<p>I am trying to get suggestion from the community in order to make the best practices. \nPlease bear with me, with the following example:</p>\n\n<p>Suppose that you work with <strong>half open intervals</strong>, that is, <em>something that you know when it starts.</em></p>\n\n<p>For example </p>\n\n<ul>\n<li>There can be <code>HalfOpenInterval</code> restricted to a day. Example: you say \"from 1:00 pm afterwards\" (until the end of the day). Let's call it <strong>ClockInterval</strong></li>\n<li>There can be <code>HalfOpenInterval</code> restricted to the existence of universe. Example: you say \"from 9 of july of 1810 we declare the indepedency\" (until the end of the cosmos.. hypothetically). Let's call it <strong>Period</strong></li>\n</ul>\n\n<p>For both entities types: you work with a collection of them, so you usually have <code>slices</code> of <strong>clocks</strong> and <strong>periods</strong> in your code.</p>\n\n<p>So now comes the problem: <em>you must find the enclosing interval for a given time</em> (<code>func FindEnclosingHalfOpenInterval</code>) for <em>both</em> clocks and periods, so you start writing the code...</p>\n\n<p>And well, i get into this matter... how i should organize the code in order to write only once the common func. (<code>func FindEnclosingHalfOpenInterval</code>).</p>\n\n<p>So i get into this code: <a href=\"https://play.golang.org/p/Cy7fFaFzYJR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Cy7fFaFzYJR</a></p>\n\n<p>But i keep wondering if there is a better way to define common behaviour for collection of slices.</p>\n\n<p>Please reader you shall realize that i need to do an \"element by element\" <strong>conversion</strong> for each type of slice (and i have a type of slice for each type of concrete HalfOpenInterval i define). So i wonder if there is there any way that allows me to introduce new types of <code>HalfOpenInterval</code> without having to do some adjustement and \"automatically\" gets the abilitiy to use the <code>func FindEnclosingHalfOpenInterval</code>?. Perhaps my rich-oo-java-based mind is not the correct way to face the problems in the simplistic-straight-ahead-go-world. I'm all hears, to any suggestion.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1521217965, "post_id": 49325515, "comment_id": 85652532, "body": "I think you want <a href=\"https://godoc.org/golang.org/x/crypto/ssh#ParseAuthorizedKey\" rel=\"nofollow noreferrer\">ParseAuthorizedKey</a> instead"}, {"owner": {"reputation": 9230, "user_id": 63308, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/666badca71c452ae51c999971419b506?s=128&d=identicon&r=PG", "display_name": "codefinger", "link": "https://stackoverflow.com/users/63308/codefinger"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521218153, "post_id": 49325515, "comment_id": 85652655, "body": "@Peter yes! you&#39;re right. please create an answer and I&#39;ll accept it. thanks."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 11, "last_activity_date": 1589269644, "last_edit_date": 1589269644, "creation_date": 1521220708, "answer_id": 49326300, "question_id": 49325515, "link": "https://stackoverflow.com/questions/49325515/how-do-i-parse-an-rsa-public-key-in-go/49326300#49326300", "title": "How do I parse an RSA public key in Go?", "body": "<p>This looks like the authorized_keys format, which you can parse with <a href=\"https://godoc.org/golang.org/x/crypto/ssh#ParseAuthorizedKey\" rel=\"nofollow noreferrer\">ssh.ParseAuthorizedKey</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"golang.org/x/crypto/ssh\"\n    \"testing\"\n)\n\nfunc TestPublicKeyParsing(t *testing.T) {\n    key := \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDhZgLqiZYDKCWhyi2gUXIRwIPyMSyXZ6yrwsm3PYfIvFB60kVlNgqDpPVhWoH6eRfaQ1y/xbg4nClZmHEDTvLbTQ1ZoQzzjZ7zvM6aQ4nADmKcCYswEuU94axouVjsHNyMLfOkPXuGec0fChwQ2JDh/B9LCiSDxyhCOgHvETXGXsyBMKjn498iPjJ6snzk35dy5wPZRz41g3dLaygF+wYAT791u/JchHQL7OP7RoNgby+RM16SYZs1tgQVkfU//o+AyTarWYLVDpFU6HPPenE4xEXhbgqd7x3wSNPBsMvY8Zjcu3kdHtboJidyMtKeD8ghV/T24kME58TW15T8Eg8R\"\n\n    parsedKey, _, _, _, err := ssh.ParseAuthorizedKey([]byte(key))\n    if err != nil {\n        t.Errorf(\"ERROR! %s\", err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 9230, "user_id": 63308, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/666badca71c452ae51c999971419b506?s=128&d=identicon&r=PG", "display_name": "codefinger", "link": "https://stackoverflow.com/users/63308/codefinger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3520, "favorite_count": 2, "accepted_answer_id": 49326300, "answer_count": 1, "score": 5, "last_activity_date": 1589269644, "creation_date": 1521217787, "last_edit_date": 1521224097, "question_id": 49325515, "link": "https://stackoverflow.com/questions/49325515/how-do-i-parse-an-rsa-public-key-in-go", "title": "How do I parse an RSA public key in Go?", "body": "<p>Why do I get the error <code>ssh: short read</code> from the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/crypto/ssh\"\n    \"testing\"\n)\n\nfunc TestPublicKeyParsing(t *testing.T) {\n    key := \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDhZgLqiZYDKCWhyi2gUXIRwIPyMSyXZ6yrwsm3PYfIvFB60kVlNgqDpPVhWoH6eRfaQ1y/xbg4nClZmHEDTvLbTQ1ZoQzzjZ7zvM6aQ4nADmKcCYswEuU94axouVjsHNyMLfOkPXuGec0fChwQ2JDh/B9LCiSDxyhCOgHvETXGXsyBMKjn498iPjJ6snzk35dy5wPZRz41g3dLaygF+wYAT791u/JchHQL7OP7RoNgby+RM16SYZs1tgQVkfU//o+AyTarWYLVDpFU6HPPenE4xEXhbgqd7x3wSNPBsMvY8Zjcu3kdHtboJidyMtKeD8ghV/T24kME58TW15T8Eg8R\"\n\n    _, err := ssh.ParsePublicKey([]byte(key))\n    if err != nil {\n        t.Errorf(\"ERROR! %s\", err)\n    }\n}\n</code></pre>\n\n<p>Is the key string in the wrong format?</p>\n\n<p>What is the correct format for the public key?</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 58, "user_id": 9503921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc45dbbb04a400539bb7d3c6ae10ab7b?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/9503921/chris"}, "edited": false, "score": 0, "creation_date": 1521216966, "post_id": 49324466, "comment_id": 85651926, "body": "Cool, that works! Thanks a lot! I still find it a little counter intuitive, because b already points to a valid struc... but I guess interface{} is just special"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 58, "user_id": 9503921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc45dbbb04a400539bb7d3c6ae10ab7b?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/9503921/chris"}, "edited": false, "score": 0, "creation_date": 1521217426, "post_id": 49324466, "comment_id": 85652232, "body": "@Chris: b is a valid struct, but <code>a.Field</code> isn&#39;t a struct, it&#39;s a pointer."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1521214444, "creation_date": 1521214444, "answer_id": 49324466, "question_id": 49324312, "link": "https://stackoverflow.com/questions/49324312/set-value-of-interface-to-struct-field-of-type-pointer-to-struc-via-reflection/49324466#49324466", "title": "Set value of interface to struct field of type pointer to struc via reflection", "body": "<p>You first need to allocate a pointer to the type of <code>b</code>, in order to have somewhere to copy the value. Once you have a pointer value, you can set that to <code>Field</code> in <code>a</code>:</p>\n\n<pre><code>field := reflect.New(reflect.TypeOf(b))\nfield.Elem().Set(reflect.ValueOf(b))\nreflect.ValueOf(&amp;a).Elem().FieldByName(\"Field\").Set(field)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6-GNSEq0tw3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6-GNSEq0tw3</a></p>\n"}], "owner": {"reputation": 58, "user_id": 9503921, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc45dbbb04a400539bb7d3c6ae10ab7b?s=128&d=identicon&r=PG&f=1", "display_name": "Chris", "link": "https://stackoverflow.com/users/9503921/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2215, "favorite_count": 2, "accepted_answer_id": 49324466, "answer_count": 1, "score": 4, "last_activity_date": 1521214880, "creation_date": 1521213970, "last_edit_date": 1521214880, "question_id": 49324312, "link": "https://stackoverflow.com/questions/49324312/set-value-of-interface-to-struct-field-of-type-pointer-to-struc-via-reflection", "title": "Set value of interface to struct field of type pointer to struc via reflection", "body": "<p>I'm trying to set struct.field = &amp;otherStruct. However, I have to use reflection, and otherStruct is of type interface{}. </p>\n\n<p>The error I'm getting is:</p>\n\n<pre><code>reflect.Set: value of type main.StructB is not assignable to type *main.StructB\n</code></pre>\n\n<p>struct is known. The (real) type of otherStruct is not known, but it is guaranteed, that the assignment is safe (the struct type is identical).</p>\n\n<p>Code:</p>\n\n<pre><code>type StrucA struct {\n    Field *StrucB\n}\n\ntype StrucB struct {}\n\nfunc main() {\n    a := StrucA{}\n    var b interface{} = StrucB{}\n    //above is set\n\n    // Target: Set a.Field = &amp;b\n    reflect.ValueOf(&amp;a).Elem().FieldByName(\"Field\").Set(reflect.ValueOf(b)) // reflect.Set: value of type main.StrucB is not assignable to type *main.StrucB\n}\n</code></pre>\n\n<p>Playground:\n<a href=\"https://play.golang.org/p/LR_RgfBzsxa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LR_RgfBzsxa</a></p>\n\n<p>I have tested a lot of different stuff, but I'm unable to solve it. </p>\n"}, {"tags": ["c", "go", "compilation", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1521213879, "post_id": 49323978, "comment_id": 85649938, "body": "Please make a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. If <code>Foo</code> is just a struct, then the <code>void will_allocate_foo(Foo *foo){</code> declaration isn&#39;t valid. This for example runs fine: <a href=\"https://play.golang.org/p/WSARkds3-ZE\" rel=\"nofollow noreferrer\">play.golang.org/p/WSARkds3-ZE</a>"}, {"owner": {"reputation": 3087, "user_id": 856142, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bfb729f6ac07e17c2326a7335a3f3be?s=128&d=identicon&r=PG", "display_name": "yageek", "link": "https://stackoverflow.com/users/856142/yageek"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521214544, "post_id": 49323978, "comment_id": 85650343, "body": "I&#39;m not sure to understand why is the C declaration invalid ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521214651, "post_id": 49323978, "comment_id": 85650410, "body": "If <code>Foo</code> is a named struct, then you must prepend the type with <code>struct</code>, as in my example."}, {"owner": {"reputation": 3087, "user_id": 856142, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bfb729f6ac07e17c2326a7335a3f3be?s=128&d=identicon&r=PG", "display_name": "yageek", "link": "https://stackoverflow.com/users/856142/yageek"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1521215098, "post_id": 49323978, "comment_id": 85650682, "body": "I updated the provided code. In the original C source, I used a typedef and not a named struct."}], "answers": [{"comments": [{"owner": {"reputation": 3087, "user_id": 856142, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bfb729f6ac07e17c2326a7335a3f3be?s=128&d=identicon&r=PG", "display_name": "yageek", "link": "https://stackoverflow.com/users/856142/yageek"}, "edited": false, "score": 0, "creation_date": 1521215488, "post_id": 49324527, "comment_id": 85650939, "body": "Thanks for the explanation. The cgo documentaion was not clear enough for me."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1987437, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/508e14a7e9414311eff04b2fd8d20ed6?s=128&d=identicon&r=PG", "display_name": "Liam Kelly", "link": "https://stackoverflow.com/users/1987437/liam-kelly"}, "is_accepted": true, "score": 4, "last_activity_date": 1521215196, "last_edit_date": 1521215196, "creation_date": 1521214589, "answer_id": 49324527, "question_id": 49323978, "link": "https://stackoverflow.com/questions/49323978/struct-prefix-vs-no-prefix/49324527#49324527", "title": "struct_ prefix vs no prefix", "body": "<p>You are declaring your C struct as a typedef and not as a named struct.</p>\n\n<p>In your c code you have something like this:</p>\n\n<pre><code>typedef struct{\n    int a;\n    char *b;\n    ...\n    char z[20];\n }Foo;\n</code></pre>\n\n<p>In C you would refer to this as <code>Foo x</code> when declaring an instance of <code>Foo</code> so in Cgo you would refer to it as <code>C.Foo</code>.</p>\n\n<p>The reason you are getting the weird error is because the compiler does not have a name for the struct you declared just a typedef, so it calls it <code>_0</code>.</p>\n\n<p>In your example your Go code is expecting</p>\n\n<pre><code>struct Foo{\n    int a;\n    char *b;\n    ...\n    char z[20];\n };\n</code></pre>\n\n<p>In C you would refer to this as <code>struct Foo x</code> when declaring an instance of <code>Foo</code> so in Cgo you would refer to it as <code>C.struct_Foo</code>.</p>\n\n<p>Extra Helpful Info</p>\n\n<ul>\n<li>If you need to get the size of a typedef struct Cgo use <code>C.sizeof_Foo</code></li>\n<li>To see how Cgo declares the Go version of your C struct run <code>go tool cgo &lt;go file&gt;</code> and look at the <code>_obj/_cgo_gotypes.go</code> file</li>\n</ul>\n"}], "owner": {"reputation": 3087, "user_id": 856142, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5bfb729f6ac07e17c2326a7335a3f3be?s=128&d=identicon&r=PG", "display_name": "yageek", "link": "https://stackoverflow.com/users/856142/yageek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 233, "favorite_count": 2, "accepted_answer_id": 49324527, "answer_count": 1, "score": 2, "last_activity_date": 1521215196, "creation_date": 1521212949, "last_edit_date": 1521214968, "question_id": 49323978, "link": "https://stackoverflow.com/questions/49323978/struct-prefix-vs-no-prefix", "title": "struct_ prefix vs no prefix", "body": "<p>I'm currently writing some basic cgo code. According to the <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">cgo documention about Go to C references</a>:</p>\n\n<blockquote>\n  <p>To access a struct, union, or enum type directly, prefix it with\n  struct_, union_, or enum_, as in C.struct_stat.</p>\n</blockquote>\n\n<p>My understanding of this sentence is that if I have a struct named <code>Foo</code> in C, I have to use the type <code>C.struct_Foo</code> in Go.</p>\n\n<p>I have written some Go code like:</p>\n\n<pre><code>package main\n\n// #cgo LDFLAGS: -lnavilink -lserialport\n// #cgo CFLAGS: -I/usr/local/include\n// #include&lt;navilink/navilink.h&gt;\nimport \"C\"\nimport \"errors\"\n\nfunc (d *Device) navilinkErrorToGoError() error {\n    errorC := C.navilink_get_error_description(d.navilinkC)\n    return errors.New(C.GoString(errorC))\n    return nil\n}\n\n// Device repr\u00e9sente une interface\n// vers le port s\u00e9rie connect\u00e9 au GPS\ntype Device struct {\n    navilinkC *C.struct_NavilinkDevice\n}\n\n// Open permettra au d\u00e9veloppeur d'ouvrir la communication\nfunc (d *Device) Open(path string) error {\n    res := C.navilink_open_device_from_name(C.CString(path), d.navilinkC)\n    if res &lt; 0 {\n        return d.navilinkErrorToGoError()\n    }\n    return nil\n}\n\n// Close permettra au d\u00e9veloppeur de fermer la communication\nfunc (d *Device) Close() {\n    C.navilink_close_device(d.navilinkC)\n}\n</code></pre>\n\n<p>I encounter a compilation error likes:</p>\n\n<blockquote>\n  <p>cannot convert d.navilinkC (type *_Ctype_struct_NavilinkDevice) to\n  type _Ctype_struct___1</p>\n</blockquote>\n\n<p>The definition of the C struct is the following:</p>\n\n<pre><code>typedef struct {\n  struct sp_port* serial_port;\n  struct sp_event_set* event_set;\n  uint8_t buffer[NAVILINK_MAX_PACKET_SIZE];\n  NavilinkInformation informations;\n  int firmware_version;\n  NavilinkPacket response_packet;\n  int last_error_code;\n} NavilinkDevice;\n</code></pre>\n\n<p>If I use <code>C.DeviceNavilink</code> instead of <code>C.DeviceNavilink</code> as the field's type, the compilation succeeds.</p>\n\n<p>Every C functions expect a pointer to a <code>NavilinkDevice</code> C struct as last parameter. Code for the C library can be found <a href=\"https://github.com/yageek/navilink\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Why does the upper documentation sentence mean since you can refer the C type without using any prefix? What is the difference between both?</p>\n"}, {"tags": ["database", "go", "prepared-statement"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "is_accepted": true, "score": 10, "last_activity_date": 1521206756, "last_edit_date": 1592644375, "creation_date": 1521206756, "answer_id": 49321912, "question_id": 49321568, "link": "https://stackoverflow.com/questions/49321568/executing-sql-query-in-golang/49321912#49321912", "title": "Executing SQL query in Golang", "body": "<p><strong>Never</strong> build SQL from strings that come from outside your system.</p>\n<p><a href=\"https://i.stack.imgur.com/lMuyI.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/lMuyI.png\" alt=\"enter image description here\" /></a></p>\n<p><em>Always</em> use the <code>?</code> syntax.</p>\n<p>If you must set SQL parts like table names, prepare multiple, complete SQL statements that contain <code>?</code> for the values. Select the SQL to execute, maybe based on user input, but <strong>never</strong> build SQL <em>from</em> user input.</p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1521207933, "last_edit_date": 1521207933, "creation_date": 1521207603, "answer_id": 49322177, "question_id": 49321568, "link": "https://stackoverflow.com/questions/49321568/executing-sql-query-in-golang/49322177#49322177", "title": "Executing SQL query in Golang", "body": "<p>It is cleaner to use prepared statements so that whenever a requirement changes you can easily modify the statements. Also to prevent SQL injections.</p>\n\n<blockquote>\n  <p>Prepared statements is much better than concatenating strings, for all\n  the usual reasons (avoiding SQL injection attacks, for example).</p>\n  \n  <p>In MySQL, the parameter placeholder is ?, and in PostgreSQL it is $N,\n  where N is a number. SQLite accepts either of these.</p>\n</blockquote>\n\n<p>One more thing is Prepared statements can be used for repetitive approach, can be executed multiple times and can be destroyed.</p>\n\n<pre><code>stmt, err := db.Prepare(\"select id, name from users where id = ?\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer stmt.Close() // closing the statement\nrows, err := stmt.Query(1)\n</code></pre>\n\n<p>And you are using interfaces </p>\n\n<pre><code>func (db *DB) CreateUserTable() (sql.Result, error) {\n    statement := \"CREATE TABLE %s (%s, %s, %s, %s, %s)\"\n    v := []interface{}{\"User\", \"ID int PRIMARY KEY NOT NULL\", \"Name varchar(100) UNIQUE\", \"Email varchar(100) UNIQUE\", \"Address varchar(100) \",  \"Username varchar(100) UNIQUE\"}\n    return db.Exec(fmt.Sprintf(statement, v...))\n}\n</code></pre>\n\n<p>which can take any type of parameter under the hood which can be vulnerable</p>\n\n<p>For more detailed information Go for this <a href=\"http://go-database-sql.org/retrieving.html\" rel=\"nofollow noreferrer\">Link</a></p>\n"}], "owner": {"reputation": 1496, "user_id": 4374970, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/mVn41.jpg?s=128&g=1", "display_name": "mfathirirhas", "link": "https://stackoverflow.com/users/4374970/mfathirirhas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5881, "favorite_count": 1, "accepted_answer_id": 49321912, "answer_count": 2, "score": 3, "last_activity_date": 1521207933, "creation_date": 1521205655, "question_id": 49321568, "link": "https://stackoverflow.com/questions/49321568/executing-sql-query-in-golang", "title": "Executing SQL query in Golang", "body": "<p>I've seen two ways of people executing queries using Golang builtin <code>database/sql</code> queries. One of them is using <code>fmt.Sprintf</code>:</p>\n\n<pre><code>func (db *DB) CreateUserTable() (sql.Result, error) {\n    statement := \"CREATE TABLE %s (%s, %s, %s, %s, %s)\"\n    v := []interface{}{\"User\", \"ID int PRIMARY KEY NOT NULL\", \"Name varchar(100) UNIQUE\", \"Email varchar(100) UNIQUE\", \"Address varchar(100) \",  \"Username varchar(100) UNIQUE\"}\n    return db.Exec(fmt.Sprintf(statement, v...))\n}\n</code></pre>\n\n<p>and the other one is using prepared statement:</p>\n\n<pre><code>func (db *DB) CreateUserTable() (sql.Result, error) {    \n    statement, err := db.Prepare(\"INSERT INTO User(tbl1,tbl2,tbl3) VALUES(?,?,?)\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    return statement.Exec(\"value1\", \"value2\", \"value3\")\n}\n</code></pre>\n\n<p>The first gives benefit by enabling you to dynamically set the table name, column name, and the values. But the second one only for values. What's the difference? Which one should I use?</p>\n"}, {"tags": ["go", "panic"], "comments": [{"owner": {"reputation": 1, "user_id": 9503034, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-b8HFlya-24c/AAAAAAAAAAI/AAAAAAAAAAg/xnCzs9WLGnI/photo.jpg?sz=128", "display_name": "lee breeze", "link": "https://stackoverflow.com/users/9503034/lee-breeze"}, "edited": false, "score": 0, "creation_date": 1521203975, "post_id": 49320981, "comment_id": 85642905, "body": "go version is v1.9.2."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521205204, "post_id": 49320981, "comment_id": 85643782, "body": "Process hangs meaning it never exits?"}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1521207233, "post_id": 49320981, "comment_id": 85645177, "body": "Have you ever tried initialising the context if it&#39;s <code>nil</code>? Also this:  <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">Do not pass a nil Context, even if a function permits it. Pass context.TODO if you are unsure about which Context to use.</a>"}, {"owner": {"reputation": 1, "user_id": 9503034, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-b8HFlya-24c/AAAAAAAAAAI/AAAAAAAAAAg/xnCzs9WLGnI/photo.jpg?sz=128", "display_name": "lee breeze", "link": "https://stackoverflow.com/users/9503034/lee-breeze"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1521207269, "post_id": 49320981, "comment_id": 85645205, "body": "@Adrian yes ,it never exists."}, {"owner": {"reputation": 1, "user_id": 9503034, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-b8HFlya-24c/AAAAAAAAAAI/AAAAAAAAAAg/xnCzs9WLGnI/photo.jpg?sz=128", "display_name": "lee breeze", "link": "https://stackoverflow.com/users/9503034/lee-breeze"}, "reply_to_user": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1521207393, "post_id": 49320981, "comment_id": 85645283, "body": "@Havelock i know the right way to use context, but i do not know why the context is nil, but context.WithTimeout() function does not panic."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1521208737, "post_id": 49320981, "comment_id": 85646213, "body": "@leebreeze: if the program is blocked, get a stack trace and see where. Is the panic being recovered somewhere?"}], "owner": {"reputation": 1, "user_id": 9503034, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-b8HFlya-24c/AAAAAAAAAAI/AAAAAAAAAAg/xnCzs9WLGnI/photo.jpg?sz=128", "display_name": "lee breeze", "link": "https://stackoverflow.com/users/9503034/lee-breeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 786, "favorite_count": 2, "answer_count": 0, "score": 0, "last_activity_date": 1529529374, "creation_date": 1521203857, "last_edit_date": 1529529374, "question_id": 49320981, "link": "https://stackoverflow.com/questions/49320981/use-a-nil-context-but-do-not-panic-and-hang-there-how-could-this-possible", "title": "Use a nil context, but do not panic and hang there. How could this possible?", "body": "<pre><code>type Etcd struct {\n    Next       plugin.Handler\n    Fall       fall.F\n    Zones      []string\n    PathPrefix string\n    Upstream   upstream.Upstream // Proxy for looking up names during the resolution process\n    Client     etcdc.KeysAPI\n    Ctx        context.Context\n    Stubmap    *map[string]proxy.Proxy // list of proxies for stub resolving.\n\n    endpoints []string // Stored here as well, to aid in testing.\n}\n\n\nfunc (e *Etcd) get(path string, recursive bool) (*etcdc.Response, error) {\n    if e.Ctx == nil {\n            // run here\n            log.Printf(\"e.Ctx is nil\")\n    }\n    // hang here but not panic.\n    ctx, cancel := context.WithTimeout(e.Ctx, etcdTimeout)\n    defer cancel()\n    r, err := e.Client.Get(ctx, path, &amp;etcdc.GetOptions{Sort: false, Recursive: recursive})\n    if err != nil {\n            return nil, err\n    }\n    return r, nil\n}\n</code></pre>\n\n<p>source code link:\n<a href=\"https://github.com/coredns/coredns/blob/v1.0.6/plugin/etcd/etcd.go#L87\" rel=\"nofollow noreferrer\">https://github.com/coredns/coredns/blob/v1.0.6/plugin/etcd/etcd.go#L87</a></p>\n\n<p>I used this etcd package in my own project, and init it, but not initialize filed Ctx, and I found that the process hang at this code:</p>\n\n<blockquote>\n  <p>ctx, cancel := context.WithTimeout(e.Ctx, etcdTimeout)</p>\n</blockquote>\n\n<p>how could this happen with e.Ctx is nil and context.WithTimeout() do not panic ?</p>\n\n<p>Anyone's suggestion is helpful.</p>\n"}, {"tags": ["mongodb", "go", "slice", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 5664838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uvjhL.gif?s=128&g=1", "display_name": "\u0418\u0433\u043e\u0440\u044c", "link": "https://stackoverflow.com/users/5664838/%d0%98%d0%b3%d0%be%d1%80%d1%8c"}, "edited": false, "score": 0, "creation_date": 1521196076, "post_id": 49318078, "comment_id": 85637960, "body": "I mean, is there a way to get slice from Find (or another search function) directly, without struct and range loop?"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user9455968"}, "is_accepted": false, "score": 0, "last_activity_date": 1521195059, "creation_date": 1521195059, "answer_id": 49318078, "question_id": 49317887, "link": "https://stackoverflow.com/questions/49317887/is-there-a-way-to-get-slice-as-result-of-find/49318078#49318078", "title": "Is there a way to get slice as result of Find()?", "body": "<p>I don't see what could be more effective than a simple <code>range</code> loop with <code>append</code>s. Without all the Mongo stuff your code basically is this and that's exactly how I would do this.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype User struct {\n    Username string\n}\n\nfunc main() {\n\n    var users []User\n    users = append(users, User{\"John\"}, User{\"Jane\"}, User{\"Jim\"}, User{\"Jean\"})\n    fmt.Println(users)\n\n    // Interesting part starts here.\n    var myUsers []string\n    for _, user := range users {\n        myUsers = append(myUsers, user.Username)\n    }\n    // Interesting part ends here.\n\n    fmt.Println(myUsers)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/qCwENmemn-R\" rel=\"nofollow noreferrer\">https://play.golang.com/p/qCwENmemn-R</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1521200376, "last_edit_date": 1521200376, "creation_date": 1521199654, "answer_id": 49319677, "question_id": 49317887, "link": "https://stackoverflow.com/questions/49317887/is-there-a-way-to-get-slice-as-result-of-find/49319677#49319677", "title": "Is there a way to get slice as result of Find()?", "body": "<p>The result of a MongoDB <code>find()</code> is always a list of documents. So if you want a list of values, you have to convert it manually just as you did.</p>\n\n<h2>Using a custom type (derived from <code>string</code>)</h2>\n\n<p>Also note that if you would create your own type (derived from <code>string</code>), you could override its unmarshaling logic, and \"extract\" just the <code>username</code> from the document.</p>\n\n<p>This is how it could look like:</p>\n\n<pre><code>type Username string\n\nfunc (u *Username) SetBSON(raw bson.Raw) (err error) {\n    doc := bson.M{}\n    if err = raw.Unmarshal(&amp;doc); err != nil {\n        return\n    }\n    *u = Username(doc[\"username\"].(string))\n    return\n}\n</code></pre>\n\n<p>And then querying the usernames into a slice:</p>\n\n<pre><code>c := mongodb.DB(\"mybase\").C(\"mycollection\") // Obtain collection\n\nvar uns []Username\nerr = c.Find(nil).Select(bson.M{\"username\": 1, \"_id\": 0}).All(&amp;uns)\nif err != nil {\n    fmt.Println(err)\n}\nfmt.Println(uns)\n</code></pre>\n\n<p>Note that <code>[]Username</code> is not the same as <code>[]string</code>, so this may or may not be sufficient to you. Should you need a user name as a value of <code>string</code> instead of <code>Username</code> when processing the result, you can simply convert a <code>Username</code> to <code>string</code>.</p>\n\n<h2>Using <code>Query.Iter()</code></h2>\n\n<p>Another way to avoid the slice copying would be to call <a href=\"https://godoc.org/gopkg.in/mgo.v2#Query.Iter\" rel=\"nofollow noreferrer\"><code>Query.Iter()</code></a>, iterate over the results and extract and store the <code>username</code> manually, similarly how the above custom unmarshaling logic does.</p>\n\n<p>This is how it could look like:</p>\n\n<pre><code>var uns []string\nit := c.Find(nil).Select(bson.M{\"username\": 1, \"_id\": 0}).Iter()\ndefer it.Close()\nfor doc := (bson.M{}); it.Next(&amp;doc); {\n    uns = append(uns, doc[\"username\"].(string))\n}\nif err := it.Err(); err != nil {\n    fmt.Println(err)\n}\nfmt.Println(uns)\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 5664838, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/uvjhL.gif?s=128&g=1", "display_name": "\u0418\u0433\u043e\u0440\u044c", "link": "https://stackoverflow.com/users/5664838/%d0%98%d0%b3%d0%be%d1%80%d1%8c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 49319677, "answer_count": 2, "score": -1, "last_activity_date": 1521305888, "creation_date": 1521194527, "last_edit_date": 1521305888, "question_id": 49317887, "link": "https://stackoverflow.com/questions/49317887/is-there-a-way-to-get-slice-as-result-of-find", "title": "Is there a way to get slice as result of Find()?", "body": "<p>Now I'm doing:</p>\n\n<pre><code>sess := mongodb.DB(\"mybase\").C(\"mycollection\")\nvar users []struct {\n    Username string `bson:\"username\"`\n}\n\nerr = sess.Find(nil).Select(bson.M{\"username\": 1, \"_id\": 0}).All(&amp;users)\nif err != nil {\n    fmt.Println(err)\n}\n\nvar myUsers []string\nfor _, user := range users{\n    myUsers = append(myUsers, user.Username)\n}\n</code></pre>\n\n<p>Is there a more effective way to get slice with usernames from Find (or another search function) directly, without struct and range loop?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1521193404, "post_id": 49317387, "comment_id": 85636063, "body": "The error is because <code>model</code> is a parameter to function <code>mapStructResult</code> not a type."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1521194308, "post_id": 49317387, "comment_id": 85636675, "body": "You cannot pass types to functions, you must pass values. Only a couple built in functions like <code>new</code>, or <code>make</code> for example, can accept types as parameters. That is, <code>model interface{}</code> can be a <b>value</b> of any type, <code>Dogs</code> is a <b>type name</b>, not a value."}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 1, "last_activity_date": 1521193961, "creation_date": 1521193961, "answer_id": 49317657, "question_id": 49317387, "link": "https://stackoverflow.com/questions/49317387/passing-dynamic-array-struct-to-a-function-golang/49317657#49317657", "title": "Passing dynamic array struct to a function Golang", "body": "<p>Pass the ready slice to the <code>mapStructResult function</code>.</p>\n\n<pre><code>type Cats struct {\n    Meow string\n}\n\nfunc getCatsPagination() {\n    cats := []Cats{}\n    mapStructResult(\"Animality\", \"Cat_Col\", &amp;cats)\n}\n\ntype Dogs struct {\n    Bark string\n}\n\nfunc getDogsPagination() {\n    dogs := []Dogs{}\n    mapStructResult(\"Animality\", \"Dog_Col\", &amp;dogs)\n}\n\nfunc mapStructResult(db string, collection string, model interface{}) {\n    err := con.Find(param).Limit(int(limit)).Skip(int(offset)).All(result) // map any database result to 'any' struct provided\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1521194121, "creation_date": 1521194121, "answer_id": 49317719, "question_id": 49317387, "link": "https://stackoverflow.com/questions/49317387/passing-dynamic-array-struct-to-a-function-golang/49317719#49317719", "title": "Passing dynamic array struct to a function Golang", "body": "<p>First of all there is no term in go called dynamic struct. Struct fields are declared before using them and cannot be changed. We can use bson type to handle the data. Bson type is like <code>map[string]interface{}</code> used to save the data dynamically.</p>\n\n<pre><code>func mapStructResult(db string, collection string, model interface{}) {\n\n   var result []bson.M // bson.M works like map[string]interface{}\n\n   err := con.Find(param).Limit(int(limit)).Skip(int(offset)).All(&amp;result) // map any database result to 'any' struct provided\n\n   if err != nil {\n      log.Fatal(err)\n   }\n}\n</code></pre>\n\n<p>For more information on bson type. Look this godoc for <a href=\"https://godoc.org/labix.org/v2/mgo/bson#M\" rel=\"nofollow noreferrer\">BSON</a></p>\n"}], "owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1179, "favorite_count": 0, "accepted_answer_id": 49317657, "answer_count": 2, "score": 1, "last_activity_date": 1521194193, "creation_date": 1521193151, "last_edit_date": 1521194193, "question_id": 49317387, "link": "https://stackoverflow.com/questions/49317387/passing-dynamic-array-struct-to-a-function-golang", "title": "Passing dynamic array struct to a function Golang", "body": "<p>I want to create function that accept 'dynamic array struct' and use it to map a data from database *mgodb</p>\n\n<pre><code>type Cats struct {\n  Meow string \n}\nfunc getCatsPagination() {\n   mapStructResult(\"Animality\",\"Cat_Col\", Cats)\n}\n\ntype Dogs struct {\n  Bark string \n}\nfunc getDogsPagination() {\n   mapStructResult(\"Animality\",\"Dog_Col\", Dogs)\n}\n\nfunc mapStructResult(db string, collection string, model interface{}) {\n\n   result := []model{} //gets an error here\n\n   err := con.Find(param).Limit(int(limit)).Skip(int(offset)).All(&amp;result) // map any database result to 'any' struct provided\n\n   if err != nil {\n      log.Fatal(err)\n   }\n}\n</code></pre>\n\n<p>and gets an error as \"model is not a type\", why is it?\nany answer will be highly appreciated !</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 1, "creation_date": 1521186369, "post_id": 49314105, "comment_id": 85632296, "body": "What have you tried out so far? What were your problems? Please share the code your are having problems with."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1521187801, "post_id": 49314105, "comment_id": 85632942, "body": "Use the <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\">encoding/xml</a> package for decoding and encoding XML."}, {"owner": {"reputation": 81, "user_id": 5121849, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5fea34791de41d24c5ca4069c9259351?s=128&d=identicon&r=PG&f=1", "display_name": "Fan", "link": "https://stackoverflow.com/users/5121849/fan"}, "edited": false, "score": 0, "creation_date": 1521188067, "post_id": 49314105, "comment_id": 85633085, "body": "Sorry for that,my english is very poor.I will show my code."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 5121849, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5fea34791de41d24c5ca4069c9259351?s=128&d=identicon&r=PG&f=1", "display_name": "Fan", "link": "https://stackoverflow.com/users/5121849/fan"}, "edited": false, "score": 0, "creation_date": 1521425499, "post_id": 49327471, "comment_id": 85710049, "body": "Thanks for you answer,but the question is I can&#39;t define <code>WSGetInfosLink</code> struct because the goal of this project is convert webservice to http by config.So if there is a new webservice we will add a new config rather than new code.I find a solution:<a href=\"https://play.golang.org/p/xoP_QHI395c\" rel=\"nofollow noreferrer\">play.golang.org/p/xoP_QHI395c</a>"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1521227249, "last_edit_date": 1521227249, "creation_date": 1521225196, "answer_id": 49327471, "question_id": 49314105, "link": "https://stackoverflow.com/questions/49314105/generate-xml-document-from-an-xml-template/49327471#49327471", "title": "Generate XML document from an XML template", "body": "<p>The usual approach to parse some XML, modify its values, and then generate new XML with the modifications is to define a type that <strong>matches</strong> the XML's structure, then, using <code>xml.Unmarshal</code> you decode the XML into a value of that type, modify that value, and then use <code>xml.Marshal</code> to encode that modified value back into XML.</p>\n\n<pre><code>var data = []byte(`&lt;person&gt;\n  &lt;name&gt;John Doe&lt;/name&gt;\n&lt;/person&gt;`)\n\n\ntype Person struct {\n  XMLName xml.Name `xml:\"person\"`\n  Name    string   `xml:\"name\"`\n}\n\nfunc main() {\n  person := new(Person)\n\n  // unmashal xml data into person\n  if err := xml.Unmarshal(data, person); err != nil {\n    panic(err)\n  }\n\n  // modify person\n  person.Name = \"Jane Doe\"\n\n  // marshal modified person back into xml\n  b, err := xml.Marshal(person)\n  if err != nil {\n    panic(err)\n  }\n\n  fmt.Pritnln(string(b))\n}\n</code></pre>\n\n<hr>\n\n<p>Now with SOAP's XML and its prefixes this becomes a bit more complicated.</p>\n\n<p>As far as I know the <code>encoding/xml</code> package does not provide direct support for XML prefixes and the discussion on issue <a href=\"https://github.com/golang/go/issues/9519\" rel=\"nofollow noreferrer\">#9519</a> seems to corroborate that. I recommend you read through that and possibly reconsider the tool you're gonna use to solve the problem.</p>\n\n<p>That said, in the already mentioned discussion there is a suggestion to use two separate types, one for unmarshaling and one for marshaling the XML data, that way you <em>may</em> be able to achieve your goal, if you like that idea the examples there are fairly simple and you should be able to use them to guide you to the full implementation.</p>\n\n<p>Besides the two-type solution one other approach comes to mind but, while it works for this small piece of SOAP data, I do not have any real experience with SOAP to be able to say whether this is gonna be enough to work with an actual SOAP API.</p>\n\n<p>The idea here is to utilize the <code>xml.Marshaler</code> and <code>xml.MarshalerAttr</code> interfaces. Every XML element that has a prefix, e.g. <code>&lt;soapenv:Envelope&gt;...</code> needs a matching type that implements the Marshaler interface and every attribute that has a prefix, e.g. <code>soapenv:encodingStyle=\"...</code> needs to be declared as a struct field with a type that implements the MarshalerAttr interface.</p>\n\n<p>Example element with prefix:</p>\n\n<pre><code>type Envelope struct {\n    XMLName xml.Name  `xml:\"Envelope\"`\n    // ...\n}\n\n// MarhsalXML implements the xml.Marshaler interface.\nfunc (env *Envelope) MarshalXML(e *xml.Encoder, start xml.StartElement) error {\n    start.Name.Local = \"soapenv:\" + start.Name.Local\n    return e.EncodeElement(*env, start)\n}\n</code></pre>\n\n<p>Example attribute with prefix:</p>\n\n<pre><code>type WSGetInfosLink struct {\n    XMLName       xml.Name    `xml:\"wsGetInfosLink\"`\n    EncodingStyle SoapenvAttr `xml:\"encodingStyle,attr\"`\n    // ...\n}\n\ntype SoapenvAttr string\n\n// MarshalXMLAttr implements the xml.MarshalerAttr interface.\nfunc (a SoapenvAttr) MarshalXMLAttr(n xml.Name) (xml.Attr, error) {\n    return xml.Attr{\n        Name:  xml.Name{Local: \"soapenv:\" + n.Local},\n        Value: string(a),\n    }, nil\n}\n</code></pre>\n\n<p>You can find a more complete example here: <a href=\"https://play.golang.org/p/4wba60hBv7I\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4wba60hBv7I</a></p>\n"}], "owner": {"reputation": 81, "user_id": 5121849, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5fea34791de41d24c5ca4069c9259351?s=128&d=identicon&r=PG&f=1", "display_name": "Fan", "link": "https://stackoverflow.com/users/5121849/fan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 560, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1521227249, "creation_date": 1521179896, "last_edit_date": 1521198454, "question_id": 49314105, "link": "https://stackoverflow.com/questions/49314105/generate-xml-document-from-an-xml-template", "title": "Generate XML document from an XML template", "body": "<p>I have a xml template like this:</p>\n\n<pre><code>&lt;soapenv:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:ser=\"http://service.receive.appservice.jcms.hanweb.com\"&gt;\n   &lt;soapenv:Header/&gt;\n   &lt;soapenv:Body&gt;\n      &lt;ser:wsGetInfosLink soapenv:encodingStyle=\"http://schemas.xmlsoap.org/soap/encoding/\"&gt;\n         &lt;nCataId xsi:type=\"xsd:int\"&gt;3&lt;/nCataId&gt;\n         &lt;bRef xsi:type=\"xsd:int\"&gt;3&lt;/bRef&gt;\n         &lt;nStart xsi:type=\"xsd:int\"&gt;3&lt;/nStart&gt;\n         &lt;nEnd xsi:type=\"xsd:int\"&gt;3&lt;/nEnd&gt;\n         &lt;bAsc xsi:type=\"xsd:int\"&gt;3&lt;/bAsc&gt;\n         &lt;strStartCTime xsi:type=\"xsd:string\"&gt;gero et&lt;/strStartCTime&gt;\n         &lt;strEndCTime xsi:type=\"xsd:string\"&gt;sonoras imperio&lt;/strEndCTime&gt;\n         &lt;strLoginId xsi:type=\"xsd:string\"&gt;quae divum incedo&lt;/strLoginId&gt;\n         &lt;strPwd xsi:type=\"xsd:string\"&gt;verrantque per auras&lt;/strPwd&gt;\n         &lt;strKey xsi:type=\"xsd:string\"&gt;per auras&lt;/strKey&gt;\n      &lt;/ser:wsGetInfosLink&gt;\n   &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n</code></pre>\n\n<p>I need generate same format xml document , change <code>wsGetInfosLink</code> children element value to some value receive from client.Because xml template have many formats.I must parse xml and generate in dynamic way,How can i achieve it in golang?</p>\n\n<p>Now I can parse xml template in dynamic way use <code>xml.Encoder.Token</code>,but I don't konw how to motify value and generate new xml document.</p>\n\n<pre><code>func TestOperation_DoRequest(t *testing.T) {\n\nxmlStr := \"\"\n\nvar xmlTemplate bytes.Buffer\nxmlTemplate.Write([]byte(xmlStr))\ndecoder := xml.NewDecoder(&amp;xmlTemplate)\nroot, err := decoder.Token()\nif err != nil {\n    t.Fatal(err)\n}\nfor t := root; err == nil; t, err = decoder.Token() {\n    switch  t.(type) {\n    case xml.StartElement:\n        token := t.(xml.StartElement)\n        fmt.Println(\"len len len\", len(token.Attr))\n        if len(token.Attr) &gt; 0 {\n            for _, attr := range token.Attr {\n                attrName := attr.Name.Local\n                attrSpace := attr.Name.Space\n                attrValue := attr.Value\n                fmt.Printf(\"attrSpace:%s attrName:%s attrValue:%s\\n\", attrSpace, attrName, attrValue)\n            }\n        }\n\n        name := token.Name.Local\n        space := token.Name.Space\n        fmt.Printf(\"Token space:%s name:%s\\n\", space, name)\n        break\n    case xml.EndElement:\n        token := t.(xml.EndElement)\n        //element := t.(xml.EndElement)\n        name := token.Name.Local\n        fmt.Printf(\"end element name:%s\\n\", name)\n        break\n    case xml.CharData:\n        token := t.(xml.CharData)\n        content := string([]byte(token))\n\n        fmt.Printf(\"---value %s\\n\", content)\n        break\n    default:\n        break\n    }\n}\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 13530, "user_id": 593382, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f7326fd554e09edf21ca727d6854e22e?s=128&d=identicon&r=PG", "display_name": "Grady Player", "link": "https://stackoverflow.com/users/593382/grady-player"}, "edited": false, "score": 3, "creation_date": 1521172720, "post_id": 49312954, "comment_id": 85627562, "body": "I am no go expert, but dereferencing would make it a struct not a pointer to one so type of b would be a countHolder struct, and assignment thereof would copy the contents..."}, {"owner": {"reputation": 13530, "user_id": 593382, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/f7326fd554e09edf21ca727d6854e22e?s=128&d=identicon&r=PG", "display_name": "Grady Player", "link": "https://stackoverflow.com/users/593382/grady-player"}, "edited": false, "score": 6, "creation_date": 1521172808, "post_id": 49312954, "comment_id": 85627589, "body": "Your line 2 explanation is wrong..."}], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 5, "last_activity_date": 1521177957, "creation_date": 1521177957, "answer_id": 49313710, "question_id": 49312954, "link": "https://stackoverflow.com/questions/49312954/does-dereferencing-struct-pointer-copy-the-struct/49313710#49313710", "title": "Does dereferencing struct pointer copy the struct?", "body": "<p>From the <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"noreferrer\">fine specification</a>:</p>\n\n<blockquote>\n  <p>For an operand x of type T, the address operation &amp;x generates a pointer of type *T to x. [...]</p>\n  \n  <p>For an operand x of pointer type *T, the pointer indirection *x denotes the variable of type T pointed to by x. [...]</p>\n</blockquote>\n\n<p>That means that the unary <code>&amp;</code> operator gives you the address of something so <code>a</code> in:</p>\n\n<pre><code>a := &amp;countHolder{1}\n</code></pre>\n\n<p>is a pointer. The unary <code>*</code> operator in:</p>\n\n<pre><code>b := *a\n</code></pre>\n\n<p>dereferences the pointer <code>a</code> and leaves you with a <code>countHolder</code> struct on the right side so <code>b</code> is a copy of the struct that <code>a</code> points to. Since <code>b</code> is a copy of the struct, modifying <code>a.count</code>:</p>\n\n<pre><code>a.count = 2\n</code></pre>\n\n<p>(which could also be written as <code>(*a).count = 2</code>) won't have any affect on <code>b</code>.</p>\n\n<p>You could also have a look at (<a href=\"https://play.golang.org/p/Zubs8qYBA_K\" rel=\"noreferrer\">https://play.golang.org/p/Zubs8qYBA_K</a>):</p>\n\n<pre><code>func main() {\n    a := &amp;countHolder{1}\n    b := *a\n    fmt.Printf(\"%T\\n%T\\n\", a, b)\n}\n</code></pre>\n\n<p>to have a quick look at what types <code>a</code> and <code>b</code> are (<code>*counterHolder</code> and <code>counterHolder</code>, respectively, in this case).</p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 2, "accepted_answer_id": 49313710, "answer_count": 1, "score": -2, "last_activity_date": 1521177957, "creation_date": 1521172523, "question_id": 49312954, "link": "https://stackoverflow.com/questions/49312954/does-dereferencing-struct-pointer-copy-the-struct", "title": "Does dereferencing struct pointer copy the struct?", "body": "<p>I have <a href=\"https://play.golang.org/p/ickKt8mPp3H\" rel=\"nofollow noreferrer\">this code</a>:</p>\n\n<pre><code>type countHolder struct {\n    count int\n}\n\nfunc main() {\n    a := &amp;countHolder{1}\n    b := *a\n    a.count = 2\n    println(b.count)\n}\n</code></pre>\n\n<p>I expected the output to be 2, but the output was 1.</p>\n\n<p>My understanding was that:</p>\n\n<ol>\n<li><code>a := &amp;countHolder{1}</code> // a is pointer to struct with data starting at address x</li>\n<li><code>b := *a</code> // b now equals address x</li>\n<li><code>a.count = 2</code> // the struct stored at address x has its count value changed to 2</li>\n</ol>\n\n<p>Where am I wrong? is <code>b := *a</code> creating a copy of the struct?</p>\n"}, {"tags": ["session", "go", "echo"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1521171636, "post_id": 49312516, "comment_id": 85627368, "body": "Please avoid posting images."}, {"owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "edited": false, "score": 0, "creation_date": 1521263292, "post_id": 49312516, "comment_id": 85667264, "body": "Please provide more detail to your question"}, {"owner": {"reputation": 132, "user_id": 8195583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad523bf0385fd860cd92128124b30851?s=128&d=identicon&r=PG&f=1", "display_name": "Andr&#233;s", "link": "https://stackoverflow.com/users/8195583/andr%c3%a9s"}, "edited": false, "score": 0, "creation_date": 1540853293, "post_id": 49312516, "comment_id": 93009424, "body": "Hi, could you solve it?"}], "answers": [{"tags": [], "owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "is_accepted": false, "score": 0, "last_activity_date": 1521263359, "creation_date": 1521263359, "answer_id": 49332710, "question_id": 49312516, "link": "https://stackoverflow.com/questions/49312516/how-can-i-get-same-session-in-labstack-echo-session-middleware/49332710#49332710", "title": "How can I get same session in labstack echo session middleware?", "body": "<p>Per the <a href=\"https://echo.labstack.com/middleware/session\" rel=\"nofollow noreferrer\">documentation</a> </p>\n\n<blockquote>\n  <p>Session middleware facilitates HTTP session management backed by\n  <a href=\"https://github.com/gorilla/sessions\" rel=\"nofollow noreferrer\">gorilla/sessions</a>. The default implementation provides cookie and\n  filesystem based session store; however, you can take advantage of\n  community maintained implementation for various backends.</p>\n</blockquote>\n\n<p>It stores a cookie for the session. Your question is very basic. Not sure if this is what you are needing. </p>\n"}], "owner": {"reputation": 41, "user_id": 5001391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0c5e6bed27baec2ee101896c7cf0ae?s=128&d=identicon&r=PG&f=1", "display_name": "smark", "link": "https://stackoverflow.com/users/5001391/smark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1046, "favorite_count": 2, "answer_count": 1, "score": -1, "last_activity_date": 1527699316, "creation_date": 1521169396, "last_edit_date": 1527699316, "question_id": 49312516, "link": "https://stackoverflow.com/questions/49312516/how-can-i-get-same-session-in-labstack-echo-session-middleware", "title": "How can I get same session in labstack echo session middleware?", "body": "<p>Is there the missing config or something else?\nThe main config:</p>\n\n<p><img src=\"https://i.stack.imgur.com/mmnzr.png\" alt=\"enter image description here\"></p>\n\n<p>The Request handlers:</p>\n\n<p><img src=\"https://i.stack.imgur.com/ujzSM.png\" alt=\"request handlers\"></p>\n"}]