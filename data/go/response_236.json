[{"tags": ["go", "cgo", "ldflags"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563433054, "post_id": 57085385, "comment_id": 100699643, "body": "There&#39;s no magic way to do this. You need to use a script, or a Makefile, as you said. Getting it to work in your specific configuration means coming up with a solution that fits your exact requirements, but your requirements are complex enough that I don&#39;t think we can just hand you a solution. You&#39;ll have to experiment and apply your debugging skills until you find a solution that works."}], "answers": [{"tags": [], "owner": {"reputation": 3, "user_id": 4180315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c60539f6fa15599c98b74f6321358a8?s=128&d=identicon&r=PG&f=1", "display_name": "alok aggarwal", "link": "https://stackoverflow.com/users/4180315/alok-aggarwal"}, "is_accepted": false, "score": 0, "last_activity_date": 1563573918, "creation_date": 1563573918, "answer_id": 57120055, "question_id": 57085385, "link": "https://stackoverflow.com/questions/57085385/set-an-environment-variable-before-go-build/57120055#57120055", "title": "Set an environment variable before &quot;go build&quot;", "body": "<p>So the method I chose is:</p>\n\n<p>create a new file e.g. Makefilevars in foo directory which has this export:\nexport CGO_LDFLAGS_ALLOW -Wl,-Bdynamic,--wrap=memcpy\nThis file is included in all the makefiles which need to build bar.</p>\n"}], "owner": {"reputation": 3, "user_id": 4180315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c60539f6fa15599c98b74f6321358a8?s=128&d=identicon&r=PG&f=1", "display_name": "alok aggarwal", "link": "https://stackoverflow.com/users/4180315/alok-aggarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 803, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1563573918, "creation_date": 1563407711, "question_id": 57085385, "link": "https://stackoverflow.com/questions/57085385/set-an-environment-variable-before-go-build", "title": "Set an environment variable before &quot;go build&quot;", "body": "<p>Starting go1.10 only a safelist of compiler/linker options is allowed. \nAny options outside these need to be included in an environment variable e.g.\nubuntu#echo $CGO_LDFLAGS_ALLOW\n-Wl,-Bdynamic,--wrap=memcpy\nMore info:\n<a href=\"https://github.com/golang/go/wiki/InvalidFlag\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/InvalidFlag</a></p>\n\n<p>Inside directory foo I have some go code which imports a package from another directory bar.\nThis bar directory has some cgo code where #cgo flags are declared.</p>\n\n<p>From foo when I do \"go build\", it goes to bar and does a \"go build\" which fails as CGO_LDFLAGS_ALLOW is not set in environment.</p>\n\n<p>I want to not have all my team set this env variable explicitly in their environment. \nIs there a way the environment variable can be set just before \"go build\" in directory bar?</p>\n\n<p>I tried setting the environment variable in Makefile of foo, but the problem is there are many makefiles in sub directories which may try to build bar. I don't want to set the variable in all makefiles.</p>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1563418598, "post_id": 57084314, "comment_id": 100695680, "body": "To clarify: Do you need to use jhump/protoreflection for a reason or could you just use <a href=\"https://godoc.org/github.com/golang/protobuf/proto#Unmarshal\" rel=\"nofollow noreferrer\">proto#Unmarshal</a>?"}, {"owner": {"reputation": 905, "user_id": 1879605, "user_type": "registered", "accept_rate": 2, "profile_image": "https://i.stack.imgur.com/T8uIg.jpg?s=128&g=1", "display_name": "Arsene", "link": "https://stackoverflow.com/users/1879605/arsene"}, "reply_to_user": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1563433945, "post_id": 57084314, "comment_id": 100700088, "body": "@mattes. Please how can I use the proto#Unmarshal with the DescriptorProto then."}], "answers": [{"comments": [{"owner": {"reputation": 905, "user_id": 1879605, "user_type": "registered", "accept_rate": 2, "profile_image": "https://i.stack.imgur.com/T8uIg.jpg?s=128&g=1", "display_name": "Arsene", "link": "https://stackoverflow.com/users/1879605/arsene"}, "edited": false, "score": 0, "creation_date": 1563459634, "post_id": 57096502, "comment_id": 100714730, "body": "Thank you so much for the details explanation."}, {"owner": {"reputation": 905, "user_id": 1879605, "user_type": "registered", "accept_rate": 2, "profile_image": "https://i.stack.imgur.com/T8uIg.jpg?s=128&g=1", "display_name": "Arsene", "link": "https://stackoverflow.com/users/1879605/arsene"}, "edited": false, "score": 0, "creation_date": 1563550369, "post_id": 57096502, "comment_id": 100749845, "body": "It did work but the challenge I am having is when the descriptor File set is in json format"}, {"owner": {"reputation": 301, "user_id": 5286435, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2c377241bb619c9254d07897baaa86a8?s=128&d=identicon&r=PG&f=1", "display_name": "Dnj Abc", "link": "https://stackoverflow.com/users/5286435/dnj-abc"}, "edited": false, "score": 0, "creation_date": 1588306197, "post_id": 57096502, "comment_id": 108853201, "body": "@josh is there a wiki or document with examples I can read to get on how to use the descriptor files? Appreciate it if you could point me to it. Thanks."}], "tags": [], "owner": {"reputation": 66, "user_id": 11803403, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nQJdr6l5L4Y/AAAAAAAAAAI/AAAAAAAAAA4/7j1XBKRkhwY/photo.jpg?sz=128", "display_name": "Josh Humphries", "link": "https://stackoverflow.com/users/11803403/josh-humphries"}, "is_accepted": true, "score": 5, "last_activity_date": 1563458925, "creation_date": 1563458925, "answer_id": 57096502, "question_id": 57084314, "link": "https://stackoverflow.com/questions/57084314/how-to-use-github-com-jhump-protoreflect-to-parse-a-byte-array-of-proto-message/57096502#57096502", "title": "How to use github.com/jhump/protoreflect to parse a byte array of proto message knowing the message descriptor", "body": "<p>The typical way would be to <em>compile</em> the protocol to Go code using <code>protoc</code>:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>protoc main.proto --go_out=.\n</code></pre>\n\n<p>This will generate <code>main.pb.go</code>, which will have a type called <code>Address</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var addr Address\nerr := proto.Unmarshal(bytes, &amp;addr)\n</code></pre>\n\n<p>If this for some reason is not do-able (e.g. you <em>must</em> do it dynamically, with a descriptor), there are options. (But it's a lot more complicated.)</p>\n\n<ol>\n<li>Use a <code>protoc</code>-generated descriptor. You can have <code>protoc</code> export to a descriptor file (via the <code>-o</code> flag). If this is for RPC, have the server use <a href=\"https://github.com/grpc/grpc/blob/master/doc/server-reflection.md#known-implementations\" rel=\"noreferrer\">server reflection</a>; you can then use the <a href=\"https://godoc.org/github.com/jhump/protoreflect/grpcreflect#Client\" rel=\"noreferrer\">github.com/jhump/protoreflect/grpcreflect</a> package to download the server's descriptor (presumably generated by <code>protoc</code>).</li>\n<li>If you <em>must</em> create the descriptor programmatically, instead of using <code>protoc</code>, I recommend using the <a href=\"https://godoc.org/github.com/jhump/protoreflect/desc/builder\" rel=\"noreferrer\">github.com/jhump/protoreflect/desc/builder</a> package to construct it (instead of trying to create raw protos by hand). For example, your raw protos are not sufficient since they have no parent <code>FileDescriptorProto</code>, which is the root of any descriptor hierarchy. That builder package can take care of details like that for you (e.g. it will synthesize a parent file descriptor if necessary).</li>\n</ol>\n\n<p>In any event, the descriptor you want is a <code>desc.Descriptor</code> (from the <a href=\"https://godoc.org/github.com/jhump/protoreflect/desc\" rel=\"noreferrer\">github.com/jhump/protoreflect/desc</a> package). The tips above (using other protoreflect sub-packages) will return <code>desc.Descriptor</code> instances. If you only have the raw descriptor protos (like in your example code), you'd want to first turn your <code>*descriptor.FileDescriptorProto</code> into a <code>*desc.FileDescriptor</code> using the <a href=\"https://godoc.org/github.com/jhump/protoreflect/desc#CreateFileDescriptor\" rel=\"noreferrer\">desc#CreateFileDescriptor</a> function.</p>\n\n<p>If you are using <code>protoc</code> and its <code>-o</code> option to create a descriptor set file (don't forget <code>--include_imports</code> flag, too), you can load it and turn it into a <code>*desc.FileDescriptor</code> using the <a href=\"https://godoc.org/github.com/jhump/protoreflect/desc#CreateFileDescriptorFromSet\" rel=\"noreferrer\">desc#CreateFileDescriptorFromSet</a> function. Here's an example:</p>\n\n<pre><code>bytes, err := ioutil.ReadFile(\"protoset-from-protoc\")\nif err != nil {\n  panic(err)\n}\nvar fileSet descriptor.FileDescriptorSet\nif err := proto.Unmarshal(bytes, &amp;fileSet); err != nil {\n  panic(err)\n}\nfd, err := desc.CreateFileDescriptorFromSet(&amp;fileSet)\nif err != nil {\n  panic(err)\n}\n// Now you have a *desc.FileDescriptor in `fd`\n</code></pre>\n\n<p>Once you have that right kind of descriptor, you can create a <a href=\"https://godoc.org/github.com/jhump/protoreflect/dynamic#NewMessage\" rel=\"noreferrer\">*dynamic.Message</a>. You can then unmarshal into that using either the <code>proto#Unmarshal</code> function or using the dynamic message's <code>Unmarshal</code> method.</p>\n"}], "owner": {"reputation": 905, "user_id": 1879605, "user_type": "registered", "accept_rate": 2, "profile_image": "https://i.stack.imgur.com/T8uIg.jpg?s=128&g=1", "display_name": "Arsene", "link": "https://stackoverflow.com/users/1879605/arsene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1060, "favorite_count": 0, "accepted_answer_id": 57096502, "answer_count": 1, "score": 1, "last_activity_date": 1563458925, "creation_date": 1563399157, "last_edit_date": 1563418455, "question_id": 57084314, "link": "https://stackoverflow.com/questions/57084314/how-to-use-github-com-jhump-protoreflect-to-parse-a-byte-array-of-proto-message", "title": "How to use github.com/jhump/protoreflect to parse a byte array of proto message knowing the message descriptor", "body": "<p>I have a file containing a slice of bytes of the following protomessage.</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage main;\n\nmessage Address {\n    string street = 1;\n    string country = 2;\n    string state = 3;\n}\n</code></pre>\n\n<p>I have the message type described as follow:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GetProtoDescriptor() (*descriptor.DescriptorProto, error) {\n\n    return &amp;descriptor.DescriptorProto{\n        Name: proto.String(\"Address\"),\n        Field: []*descriptor.FieldDescriptorProto{\n            &amp;descriptor.FieldDescriptorProto{\n                Name:     proto.String(\"street\"),\n                JsonName: proto.String(\"street\"),\n                Number:   proto.Int(1),\n                Label:    descriptor.FieldDescriptorProto_LABEL_OPTIONAL.Enum(),\n                Type:     descriptor.FieldDescriptorProto_TYPE_STRING.Enum(),\n            },\n\n            &amp;descriptor.FieldDescriptorProto{\n                Name:     proto.String(\"state\"),\n                JsonName: proto.String(\"state\"),\n                Number:   proto.Int(2),\n                Label:    descriptor.FieldDescriptorProto_LABEL_OPTIONAL.Enum(),\n                Type:     descriptor.FieldDescriptorProto_TYPE_STRING.Enum(),\n            },\n\n            &amp;descriptor.FieldDescriptorProto{\n                Name:     proto.String(\"country\"),\n                JsonName: proto.String(\"country\"),\n                Number:   proto.Int(2),\n                Label:    descriptor.FieldDescriptorProto_LABEL_OPTIONAL.Enum(),\n                Type:     descriptor.FieldDescriptorProto_TYPE_STRING.Enum(),\n            },\n        },\n    }, nil\n\n}\n\n</code></pre>\n\n<p>I would like to know how best I can use <a href=\"https://github.com/jhump/protoreflect\" rel=\"nofollow noreferrer\">jhump/protoreflect</a> to parse the content of the file using the message descriptor above. </p>\n\n<p>Thank you for your help.</p>\n"}, {"tags": ["sorting", "go", "time"], "answers": [{"comments": [{"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1563396608, "post_id": 57083653, "comment_id": 100690853, "body": "Does this need go 1.8?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1563407507, "post_id": 57083653, "comment_id": 100693690, "body": "Yes: <a href=\"https://golang.org/doc/go1.8#sort_slice\" rel=\"nofollow noreferrer\">golang.org/doc/go1.8#sort_slice</a>"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1563408397, "post_id": 57083653, "comment_id": 100693866, "body": "@camccar, I see you edited your question to note it is Go 1.2, so I included the &quot;With Go below 1.8&quot; section in my answer."}, {"owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1563413027, "post_id": 57083653, "comment_id": 100694663, "body": "Ugh, do I really have to define a type? I have an array of a struct i&#39;m using already"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1563416578, "post_id": 57083653, "comment_id": 100695313, "body": "Only if you want to reuse the Go&#39;s libraries sort functions, the other option is to implement a sorting function over your array yourself."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 4, "last_activity_date": 1563408357, "last_edit_date": 1563408357, "creation_date": 1563395280, "answer_id": 57083653, "question_id": 57083593, "link": "https://stackoverflow.com/questions/57083593/sort-slice-of-structs-by-time-date-field-in-go-1-2-without-creating-a-secondary/57083653#57083653", "title": "Sort slice of structs by Time date field in go 1.2 without creating a secondary structure", "body": "<p><strong>With Go 1.8 and above</strong></p>\n\n<pre><code>sort.Slice(dateSlice, func(i, j int) bool { \n    return dateSlice[i].sortByThis.Before(dateSlice[j].sortByThis) \n})\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/sort/#Slice\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sort/#Slice</a></p>\n\n<p><strong>With Go below 1.8</strong></p>\n\n<p>In that case, you don't need a <code>map</code>, but you do need to define a type for your array:</p>\n\n<pre><code>type SortedDateExampleArray []SortDateExample\n</code></pre>\n\n<p>Then you need that array type to implement the methods in <code>sort.Interface</code>.</p>\n\n<pre><code>func (a SortedDateExampleArray) Len() int {\n    return len(a)\n}\n\nfunc (a SortedDateExampleArray) Less(i, j int) bool {\n    return a[i].sortByThis.Before(a[j].sortByThis)\n}\n\nfunc (a SortedDateExampleArray) Swap(i, j int) {\n    a[i], a[j] = a[j], a[i]\n}\n</code></pre>\n\n<p>And then you can use <code>sort.Sort</code> to sort your custom array.</p>\n\n<p><a href=\"https://golang.org/pkg/sort/#Sort\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sort/#Sort</a></p>\n"}], "owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1469, "favorite_count": 1, "closed_date": 1563396052, "answer_count": 1, "score": 0, "last_activity_date": 1563434053, "creation_date": 1563394942, "last_edit_date": 1563434053, "question_id": 57083593, "link": "https://stackoverflow.com/questions/57083593/sort-slice-of-structs-by-time-date-field-in-go-1-2-without-creating-a-secondary", "closed_reason": "Duplicate", "title": "Sort slice of structs by Time date field in go 1.2 without creating a secondary structure", "body": "<p>This answer here <a href=\"https://stackoverflow.com/questions/23121026/sorting-by-time-time-in-golang\">Sorting by time.Time in Golang</a></p>\n\n<p>tries to sort with a secondary array with a map </p>\n\n<pre><code>type timeSlice []reviews_data\n</code></pre>\n\n<p>Can golang slices of objects with dates be sorted by without creating this secondary data structure? </p>\n\n<p>Given a struct like</p>\n\n<pre><code>type SortDateExample struct {\n    sortByThis time.Time\n    id string\n}    \n</code></pre>\n\n<p>And a slice initialized something like </p>\n\n<pre><code>var datearray = var alerts = make([]SortDateExample, 0)\ndateSlice = append(dateSlice,newSortDateExmple)\ndateSlice = append(dateSlice,newSortDateExmple2)\ndateSlice = append(dateSlice,newSortDateExmple3)\n</code></pre>\n\n<p>How can I sort array by the time field sortByThis?</p>\n"}, {"tags": ["go", "kubernetes", "operator-sdk"], "answers": [{"comments": [{"owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "edited": false, "score": 0, "creation_date": 1609509007, "post_id": 57083222, "comment_id": 115855893, "body": "Thanks for sharing this, @helmbert. The updated link for Default Client is <a href=\"https://sdk.operatorframework.io/docs/building-operators/golang/references/client/#default-client\" rel=\"nofollow noreferrer\">sdk.operatorframework.io/docs/building-operators/golang/&hellip;</a>"}], "tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": true, "score": 3, "last_activity_date": 1563393176, "creation_date": 1563393176, "answer_id": 57083222, "question_id": 57083221, "link": "https://stackoverflow.com/questions/57083221/list-custom-resources-from-caching-client-with-custom-fieldselector/57083222#57083222", "title": "List custom resources from caching client with custom fieldSelector", "body": "<p>The default API client that is provided by the controller is a <em>split client</em> -- it serves <code>Get</code> and <code>List</code> requests from a locally-held cache and forwards other methods like <code>Create</code> and <code>Update</code> directly to the Kubernetes API server. This is also explained in <a href=\"https://github.com/operator-framework/operator-sdk/blob/master/doc/user/client.md#default-client\" rel=\"nofollow noreferrer\">the respective documentation</a>:</p>\n\n<blockquote>\n  <p>The SDK will generate code to create a Manager, which holds a Cache and a Client to be used in CRUD operations and communicate with the API server. By default a Controller's Reconciler will be populated with the Manager's Client which is a split-client. [...] A split client reads (Get and List) from the Cache and writes (Create, Update, Delete) to the API server. Reading from the Cache significantly reduces request load on the API server; as long as the Cache is updated by the API server, read operations are eventually consistent.</p>\n</blockquote>\n\n<p>To query values from the cache using a custom field selector, the cache needs to have a <em>search index</em> for this field. This indexer can be defined right after the cache has been set up.</p>\n\n<p>To register a custom indexer, add the following code into the bootstrapping logic of the operator (in the auto-generated code, this is done directly in <code>main</code>). This needs to be done <strong>after</strong> the controller manager has been instantiated (<code>manager.New</code>) and <strong>also after</strong> the custom API types have been added to the <code>runtime.Scheme</code>:</p>\n\n<pre><code>package main\n\nimport (\n    k8sruntime \"k8s.io/apimachinery/pkg/runtime\"\n    \"example.com/example-operator/pkg/apis/example/v1alpha1\"\n    // ...\n)\n\nfunction main() {\n    // ...\n\n    cache := mgr.GetCache()\n\n    indexFunc := func(obj k8sruntime.Object) []string {\n        return []string{obj.(*v1alpha1.Example).Spec.SomeField}\n    }\n\n    if err := cache.IndexField(&amp;v1alpha1.Example{}, \"spec.someField\", indexFunc); err != nil {\n        panic(err)\n    }\n\n    // ...\n}\n</code></pre>\n\n<p>When a respective indexer function is defined, field selectors on <code>spec.someField</code> will work from the local cache as expected.</p>\n"}], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 833, "favorite_count": 1, "accepted_answer_id": 57083222, "answer_count": 1, "score": 3, "last_activity_date": 1563393176, "creation_date": 1563393176, "question_id": 57083221, "link": "https://stackoverflow.com/questions/57083221/list-custom-resources-from-caching-client-with-custom-fieldselector", "title": "List custom resources from caching client with custom fieldSelector", "body": "<p>I'm using the <a href=\"https://github.com/operator-framework/operator-sdk\" rel=\"nofollow noreferrer\">Operator SDK</a> to build a custom Kubernetes operator. I have created a custom resource definition and a controller using the respective Operator SDK commands:</p>\n\n<pre><code>operator-sdk add api --api-version example.com/v1alpha1 --kind=Example\noperator-sdk add controller --api-version example.com/v1alpha1 --kind=Example\n</code></pre>\n\n<p>Within the main reconciliation loop (for the example above, the auto-generated <code>ReconcileExample.Reconcile</code> method) I have some custom business logic that requires me to query the Kubernetes API for other objects of the same kind that have a certain field value. It's occurred to me that I might be able to use the default API client (that is provided by the controller) with a custom field selector:</p>\n\n<pre><code>func (r *ReconcileExample) Reconcile(request reconcile.Request) (reconcile.Result, error) {\n    ctx := context.TODO()\n    listOptions := client.ListOptions{\n        FieldSelector: fields.SelectorFromSet(fields.Set{\"spec.someField\": \"someValue\"}),\n        Namespace:     request.Namespace,\n    }\n    otherExamples := v1alpha1.ExampleList{}\n\n    if err := r.client.List(ctx, &amp;listOptions, &amp;otherExamples); err != nil {\n        return reconcile.Result{}, err\n    }\n\n    // do stuff...\n\n    return reconcile.Result{}, nil\n}\n</code></pre>\n\n<p>When I run the operator and create a new <code>Example</code> resource, the operator fails with the following error message:</p>\n\n<pre><code>{\"level\":\"info\",\"ts\":1563388786.825384,\"logger\":\"controller_example\",\"msg\":\"Reconciling Example\",\"Request.Namespace\":\"default\",\"Request.Name\":\"example-test\"}\n{\"level\":\"error\",\"ts\":1563388786.8255732,\"logger\":\"kubebuilder.controller\",\"msg\":\"Reconciler error\",\"controller\":\"example-controller\",\"request\":\"default/example-test\",\"error\":\"Index with name field:spec.someField does not exist\",\"stacktrace\":\"...\"}\n</code></pre>\n\n<p>The most important part being</p>\n\n<blockquote>\n  <p>Index with name field:spec.someField does not exist</p>\n</blockquote>\n\n<p>I've already searched <a href=\"https://github.com/operator-framework/operator-sdk/blob/master/doc/user/client.md\" rel=\"nofollow noreferrer\">the Operator SDK's documentation</a> on the default API client and learned a bit about the inner workings of the client, but no detailed explanation on this error or how to fix it.</p>\n\n<p><strong>What does this error message mean, and how can I create this missing index to efficiently list objects by this field value?</strong></p>\n"}, {"tags": ["multithreading", "go", "process"], "comments": [{"owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "edited": false, "score": 0, "creation_date": 1563394178, "post_id": 57082848, "comment_id": 100689857, "body": "Check out <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime</a> and look for GOMAXPROCS in particular."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1563391508, "creation_date": 1563391508, "answer_id": 57082885, "question_id": 57082848, "link": "https://stackoverflow.com/questions/57082848/does-a-web-application-built-on-gos-http-package-work-as-a-single-process-using/57082885#57082885", "title": "Does a web application built on Go&#39;s http package work as a single process using multiple threads to deal with incoming requests?", "body": "<p>Go applications typically use the net/http package to implement a web server.  The <a href=\"https://godoc.org/net/http#Serve\" rel=\"nofollow noreferrer\">documentation for that package</a> says:</p>\n\n<blockquote>\n  <p>Serve accepts incoming HTTP connections on the listener l, creating a new service goroutine for each. The service goroutines read requests and then call handler to reply to them.</p>\n</blockquote>\n\n<p>Goroutines are scheduled on one or more OS threads.</p>\n\n<p>The package does not use fork.</p>\n"}], "owner": {"reputation": 1, "user_id": 10534808, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-rRFv_rAqNG4/AAAAAAAAAAI/AAAAAAAAABs/-5h3UqXZmyY/photo.jpg?sz=128", "display_name": "\u5c71\u7530\u525b\u53f8", "link": "https://stackoverflow.com/users/10534808/%e5%b1%b1%e7%94%b0%e5%89%9b%e5%8f%b8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1563391508, "creation_date": 1563391367, "question_id": 57082848, "link": "https://stackoverflow.com/questions/57082848/does-a-web-application-built-on-gos-http-package-work-as-a-single-process-using", "title": "Does a web application built on Go&#39;s http package work as a single process using multiple threads to deal with incoming requests?", "body": "<p>I read that a Go application receives connections directly from clients using a built-in web server, not running behind a web server such as Apache. Also, I read network servers, such as Apache, deal with incoming requests using multiple processes created by fork(). \nIs this also true for a Go application, or does it operate on a single process and handle incoming requests by multiple threads?</p>\n"}, {"tags": ["go", "google-cloud-platform", "timestamp", "google-cloud-datastore", "datetime-format"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1563385615, "post_id": 57081238, "comment_id": 100686041, "body": "I ran into this headache recently. It&#39;s best to normalize your times into UTC. If your DB is reporting times in local-time, best to coerce them into UTC at the query stage e.g. <a href=\"https://stackoverflow.com/questions/56397882/timezone-reconciliation-with-sql\" title=\"timezone reconciliation with sql\">stackoverflow.com/questions/56397882/&hellip;</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563388371, "post_id": 57081238, "comment_id": 100687280, "body": "Those are <a href=\"https://tools.ietf.org/html/rfc3339\" rel=\"nofollow noreferrer\">RFC3339</a> formatted times."}, {"owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "edited": false, "score": 0, "creation_date": 1563388784, "post_id": 57081238, "comment_id": 100687451, "body": "Both of them? or just with the offset?"}], "owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563385240, "creation_date": 1563384143, "last_edit_date": 1563385240, "question_id": 57081238, "link": "https://stackoverflow.com/questions/57081238/how-to-interpret-these-timestamps", "title": "How to interpret these timestamps", "body": "<p>I have different values in Google datastore column <em>TS</em>. The column <strong>type</strong> is <code>string</code>. Here are bunch of values</p>\n\n<pre><code>1994-11-04T13:15:30Z    \n1994-11-06T13:15:30Z    \n1994-11-05T08:15:30-05:00   \n1994-11-07T08:15:30-05:00\n</code></pre>\n\n<p>Now these values are in 2 different formats. The one with <code>Z</code> represent the timestamp in UTC timezone. However, the one with the offset is representing local timezone (am I correct here?)</p>\n\n<p>Now the problem is that the query that we are making in our project does ordering based on this column i.e.,</p>\n\n<pre><code>query := datastore.NewQuery(myEntityType).\n    Namespace(myNameSpace.String()).\n    Order(\"-TS\")\nrows := make([]domain.datastore.rows, 0)\n_, err := r.client.GetAll(ctx, query, rows)\n</code></pre>\n\n<p>There <code>client</code> is <code>cloud.google.com/go/datastore</code> object. </p>\n\n<p>I am unable to test this in my local but in prod, the end user are seeing these things out of order. However, if I go to datastore UI, and sort values by clicking on <code>TS</code> column, they order just fine. Which is confusing me that if the error was on sorting, shouldn't the error be there on UI as well? </p>\n\n<p>So I am not sure how to fix this bug. Should I convert Google Datastore column to Timestamp (can we do so?). Or should I fix the code to persist consistently? </p>\n"}, {"tags": ["mongodb", "go", "filter"], "answers": [{"tags": [], "owner": {"reputation": 379, "user_id": 7067918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4456e1b265f37c27776d4ba20e634a7?s=128&d=identicon&r=PG&f=1", "display_name": "Katamari", "link": "https://stackoverflow.com/users/7067918/katamari"}, "is_accepted": true, "score": 1, "last_activity_date": 1563391103, "creation_date": 1563391103, "answer_id": 57082798, "question_id": 57080738, "link": "https://stackoverflow.com/questions/57080738/how-to-combine-bson-m-filters/57082798#57082798", "title": "How to combine bson.M filters", "body": "<p>I have a lot of trouble getting bson.A to work with $and statements, try using bson.D instead.</p>\n\n<pre><code>bson.D{{\"$and\", []bson.D{\n   bson.D{{\"_id\",id}},\n   bson.D{{\"isArchived\", bson.D{{\"$ne\", false}}}},\n}}}\n</code></pre>\n"}], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1594, "favorite_count": 0, "accepted_answer_id": 57082798, "answer_count": 1, "score": 1, "last_activity_date": 1563391103, "creation_date": 1563381977, "last_edit_date": 1563382214, "question_id": 57080738, "link": "https://stackoverflow.com/questions/57080738/how-to-combine-bson-m-filters", "title": "How to combine bson.M filters", "body": "<p>I am trying to combine some filters with no success. I am using the mongodb driver for go</p>\n\n<pre><code>// FindOneByID returns an error on fail, otherwise, it sets the {out} by the result.\nfunc FindOneByID(collectionName string, id *primitive.ObjectID, out interface{}, considerArchivedItems bool) error {\n    ctx, _ := context.WithTimeout(context.Background(), 2*time.Second)\n    var filter bson.M\n\n    if considerArchivedItems {\n        filter = bson.M{\"_id\": id}\n    } else {\n        filter = bson.M{\"$and\": bson.A{ bson.M{\"_id\": id}, bson.M{isArchived: bson.M{\"$ne\": false}}}}\n    }\n\n    return database.Collection(collectionName).FindOne(ctx, filter).Decode(out)\n}\n</code></pre>\n\n<p>Now, I insert an object as archived and trying to get the document. The document is inserted as archived, so I want to consider archived items.</p>\n\n<p>However, when I pass in the <code>else</code>, document can be either archived or not (<code>false</code> or <code>true</code>), I still get it anyway. So it means that my $and doesn\u2019t work..</p>\n\n<pre><code>const (\n    databaseNameUnitTests           = \"database_name_unit_tests\"\n    databaseCollectionNameUnitTests = \"database_name_unit_tests\"\n)\n\ntype Test struct {\n    ID          *primitive.ObjectID `protobuf:\"bytes,1,opt,name=id,proto3\" json:\"_id,omitempty\" bson:\"_id,omitempty\"`\n    IsArchived  bool                `protobuf:\"varint,2,opt,name=IsArchived,proto3\" json:\"is_archived,omitempty\" bson:\"is_archived,omitempty\"`\n    Description string              `protobuf:\"varint,3,opt,name=Description,proto3\" json:\"description,omitempty\" bson:\"description,omitempty\"`\n}\n\n// func\n    var item Test\n    err := mongodb.FindOneByID(databaseCollectionNameUnitTests, insertedID, &amp;item, false)\n</code></pre>\n\n<p>The following query from Robo 3T : <code>db.getCollection('database_name_unit_tests').find({$and:[{\"_id\":ObjectId(\"5d2e8afeb0e106fbe0d5af21\")},{\"is_archived\": {$ne:false}}]})</code>\nthis works tho, where am I wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563379299, "post_id": 57080026, "comment_id": 100683047, "body": "What is your question?"}, {"owner": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563393458, "post_id": 57080026, "comment_id": 100689534, "body": "@Adrian the question, in case it wasn&#39;t obvious, was; why is my goroutine only using the last element in the slice and how do I fix it?"}], "answers": [{"comments": [{"owner": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "edited": false, "score": 0, "creation_date": 1563393184, "post_id": 57080138, "comment_id": 100689410, "body": "Thanks for the complete explanation and example @eugenioy"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 1, "last_activity_date": 1563380962, "last_edit_date": 1563380962, "creation_date": 1563379562, "answer_id": 57080138, "question_id": 57080026, "link": "https://stackoverflow.com/questions/57080026/running-for-range-with-a-goroutine-inside-a-for-range/57080138#57080138", "title": "Running for range with a goroutine inside a for range", "body": "<p><strong>Problem</strong></p>\n\n<p>You have a problem here:</p>\n\n<pre><code>ms.Entry = &amp;entry\n</code></pre>\n\n<p>When you use a loop, like this:</p>\n\n<pre><code>for i, entry := range *ms.Entries {\n</code></pre>\n\n<p>The variable \"entry\" is only declared once.</p>\n\n<p>So <code>&amp;entry</code> will have a constant value (same value in every iteration).</p>\n\n<p>But even if you solve that issue, another problem is that you are using the same <code>ms</code> object on every iteration.</p>\n\n<p>So when you then launch different goroutines, the <code>ms.Entry = ...</code> statement you execute on the second iteration is modifying the shared <code>ms</code> object.</p>\n\n<p>You are also \"sharing\" the <code>fn</code> variable between iterations as described in the other answer, so you should also capture that variable.</p>\n\n<p><strong>Fix</strong></p>\n\n<p>I suggest you remove the <code>Entry</code> field from your struct (you don't need it since you already have the complete array), and you use the array position to refer to the current entry.</p>\n\n<p>You should add an <code>i int</code> parameter to your \"action\" and \"process\" functions.</p>\n\n<p>You also need to \"capture\" the <code>fn</code> variable.</p>\n\n<pre><code>for i, entry := range *ms.Entries {\n    ...\n    for j, fn := range fns {\n        ...\n        fn := fn // capture the fn variable\n        go ms.process(&amp;wg, fn, fnChan, i) // sending index here\n    }\n}\n</code></pre>\n\n<p>See here for a modified playground:</p>\n\n<p><a href=\"https://play.golang.org/p/uuw7r4kGBPb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uuw7r4kGBPb</a></p>\n"}, {"comments": [{"owner": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "edited": false, "score": 0, "creation_date": 1563393251, "post_id": 57080206, "comment_id": 100689440, "body": "Thanks for that link, it helped me understand the situation better. Your example wasn&#39;t the solution but def a part of it @LeGEC"}], "tags": [], "owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "is_accepted": false, "score": 1, "last_activity_date": 1563379805, "creation_date": 1563379805, "answer_id": 57080206, "question_id": 57080026, "link": "https://stackoverflow.com/questions/57080026/running-for-range-with-a-goroutine-inside-a-for-range/57080206#57080206", "title": "Running for range with a goroutine inside a for range", "body": "<p>You have been caught by this trap : <a href=\"https://github.com/golang/go/wiki/CommonMistakes#using-goroutines-on-loop-iterator-variables\" rel=\"nofollow noreferrer\">Using goroutines on loop iterator variables</a></p>\n\n<hr>\n\n<p>One way to fix this :</p>\n\n<pre><code>    for j, fn := range fns {\n        fmt.Printf(\"fn loop %d\\n\", j)\n        wg.Add(1)\n\n        // copy the iterator variable to a local variable :\n        // variables declared within the body of a loop are not shared between iterations\n        f := fn\n        go ms.process(&amp;wg, f, fnChan)\n    }\n</code></pre>\n"}], "owner": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 57080138, "answer_count": 2, "score": 1, "last_activity_date": 1563380962, "creation_date": 1563379170, "question_id": 57080026, "link": "https://stackoverflow.com/questions/57080026/running-for-range-with-a-goroutine-inside-a-for-range", "title": "Running for range with a goroutine inside a for range", "body": "<p>I have a goroutine inside a loop and I want to execute a goroutine for each item in ms.Entries concurrently but it's only running for the last item in the loop.</p>\n\n<p>I've abstracted my example out of a larger program...\n<a href=\"https://play.golang.org/p/whUMQ3pjq81\" rel=\"nofollow noreferrer\">https://play.golang.org/p/whUMQ3pjq81</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype MyStruct struct {\n    Entry   *Entry\n    Entries *[]Entry\n}\n\ntype Entry struct {\n    ID   int\n    Name string\n}\n\ntype Fn struct {\n    Res string\n    Err error\n}\n\nfunc main() {\n    e1 := Entry{ID: 1, Name: \"First\"}\n    e2 := Entry{ID: 2, Name: \"Second\"}\n\n    ms := &amp;MyStruct{\n        Entries: &amp;[]Entry{e1, e2},\n    }\n\n    fmt.Printf(\"MS: %+v\\n\", ms)\n\n    var wg sync.WaitGroup\n    fnChan := make(chan *Fn)\n    go func() {\n        wg.Wait()\n        close(fnChan)\n    }()\n\n    var fns []func() (string, error)\n    fns = append(fns, ms.actionA)\n    fns = append(fns, ms.actionB)\n\n    for i, entry := range *ms.Entries {\n        fmt.Printf(\"%d: %+v\\n\", i, entry)\n        ms.Entry = &amp;entry\n        for j, fn := range fns {\n            fmt.Printf(\"fn loop %d\\n\", j)\n            wg.Add(1)\n            go ms.process(&amp;wg, fn, fnChan)\n        }\n    }\n\n    for d := range fnChan {\n        fmt.Printf(\"fnchan: %+v\\n\", d)\n    }\n}\n\nfunc (m *MyStruct) actionA() (string, error) {\n    fmt.Println(\"actionA\")\n    fmt.Printf(\"Entry: %s\\n\", m.Entry.Name)\n    return \"actionA done\", nil\n}\n\nfunc (m *MyStruct) actionB() (string, error) {\n    fmt.Println(\"actionB\")\n    fmt.Printf(\"Entry: %s\\n\", m.Entry.Name)\n    return \"actionB done\", nil\n}\n\nfunc (m *MyStruct) process(wg *sync.WaitGroup, fn func() (string, error), fnChan chan&lt;- *Fn) {\n    fmt.Println(\"processing\")\n    var err error\n    defer wg.Done()\n\n    res, err := fn()\n    if err != nil {\n        fnChan &lt;- &amp;Fn{Err: err}\n        return\n    }\n\n    fnChan &lt;- &amp;Fn{Res: res}\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 6, "creation_date": 1563377646, "post_id": 57079516, "comment_id": 100682054, "body": "The local variable named global shadows the package level variable. You can&#39;t access the package level variable if you do this."}, {"owner": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563379258, "post_id": 57079516, "comment_id": 100683019, "body": "@Peter Thank you.  I know about shadowing and that is the reason i have asked this question. Like i have given example of C++. I am just curious to know whether that sort of thing is possible in Go or not"}, {"owner": {"reputation": 379, "user_id": 7067918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4456e1b265f37c27776d4ba20e634a7?s=128&d=identicon&r=PG&f=1", "display_name": "Katamari", "link": "https://stackoverflow.com/users/7067918/katamari"}, "edited": false, "score": 0, "creation_date": 1563391551, "post_id": 57079516, "comment_id": 100688682, "body": "At first, reading this made me think that <code>global</code> was a new keyword, simply because im not used to seeing long variable declarations!"}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "edited": false, "score": 0, "creation_date": 1563380597, "post_id": 57080336, "comment_id": 100683772, "body": "Thank you for the answer. I am not a big fan of shadowing. I am new to Go and I just came across this issue of scope and was wondering if Go provides support for shadowing in the same file or not"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "edited": false, "score": 0, "creation_date": 1563380664, "post_id": 57080336, "comment_id": 100683814, "body": "Yes, it supports shadowing."}, {"owner": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "edited": false, "score": 0, "creation_date": 1563380713, "post_id": 57080336, "comment_id": 100683836, "body": "But in this case it does not. It does support it for different packages but not in the same file/package"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "edited": false, "score": 0, "creation_date": 1563380733, "post_id": 57080336, "comment_id": 100683843, "body": "Why do you think it doesn&#39;t in this case? Your example demonstrates shadowing."}, {"owner": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "edited": false, "score": 0, "creation_date": 1563380794, "post_id": 57080336, "comment_id": 100683867, "body": "i mean i can declare a var but i am not able to retrieve or use the value of the global variable"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "edited": false, "score": 1, "creation_date": 1563381101, "post_id": 57080336, "comment_id": 100684014, "body": "Yeah, that&#39;s what shadowing means :)"}, {"owner": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "edited": false, "score": 0, "creation_date": 1563381193, "post_id": 57080336, "comment_id": 100684058, "body": "Ok so can we say that Go supports Shadowing in the same file but it is of no use if someone wants to access the value of global variable without any &quot;workaround&quot;?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "edited": false, "score": 2, "creation_date": 1563381362, "post_id": 57080336, "comment_id": 100684133, "body": "Go supports shadowing. Period. Shadowing is <i>only possible</i> in the same package, so saying &quot;in the same file/package&quot; doesn&#39;t add any information. It doesn&#39;t support &quot;unshadowing&quot;--accessing the shadowed variable."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1563386982, "post_id": 57080336, "comment_id": 100686631, "body": "<code>originalGlobal</code> is a copy - so only useful for read purposes. Any changes will not be written back to the global version - nor can they be without taking the address of the global first. But this is all starting to get a little messy..."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1563380327, "creation_date": 1563380327, "answer_id": 57080336, "question_id": 57079516, "link": "https://stackoverflow.com/questions/57079516/accessing-global-variables-within-same-file-package/57080336#57080336", "title": "Accessing global variables within same file/package", "body": "<blockquote>\n  <p>How can I print the global variable value 40?</p>\n</blockquote>\n\n<p>By not shadowing it. Or if you absolutely must shadow it (but why would you?), re-assign it to another variable first.</p>\n\n<pre><code>func main() {\n    originalGlobal := global\n    var global int = 30\n    fmt.Println(originalGlobal)\n}\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 8056142, "user_type": "registered", "profile_image": "https://graph.facebook.com/10158614275980304/picture?type=large", "display_name": "Faisal Khan", "link": "https://stackoverflow.com/users/8056142/faisal-khan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1563380376, "creation_date": 1563377513, "last_edit_date": 1563380376, "question_id": 57079516, "link": "https://stackoverflow.com/questions/57079516/accessing-global-variables-within-same-file-package", "title": "Accessing global variables within same file/package", "body": "<p>Consider the following code </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n)\n\nvar global int = 40\n\nfunc main() {\n\n\n    var global int = 30\n    fmt.Println(::global) // In C++ this would print 40\n\n}\n</code></pre>\n\n<p>How can I print the global variable value 40? There are posts on SO about accessing global variables from different packages but I could not find anything about accessing globals within the same file/package</p>\n"}, {"tags": ["macos", "go", "terminal"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1563376594, "post_id": 57079120, "comment_id": 100681459, "body": "<code>tell application &quot;Terminal&quot; to do script &quot;echo hello&quot;</code> is a single argument (the second) to osascript. <a href=\"https://play.golang.org/p/Rp_r8Jj7yve\" rel=\"nofollow noreferrer\">play.golang.org/p/Rp_r8Jj7yve</a>"}, {"owner": {"reputation": 965, "user_id": 3554534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feq2v.jpg?s=128&g=1", "display_name": "pegasuspect", "link": "https://stackoverflow.com/users/3554534/pegasuspect"}, "edited": false, "score": 0, "creation_date": 1563376621, "post_id": 57079120, "comment_id": 100681478, "body": "I don&#39;t know about go but have you tried fixing the part of your code <code>`&quot;echo`, `hello&quot;&#39;`</code>"}, {"owner": {"reputation": 91, "user_id": 9367249, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Raw4ka1TOyQ/AAAAAAAAAAI/AAAAAAAAATM/_mE6S8xylZ0/photo.jpg?sz=128", "display_name": "TheJet 1", "link": "https://stackoverflow.com/users/9367249/thejet-1"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563376918, "post_id": 57079120, "comment_id": 100681629, "body": "Thanks @Peter you are right it is one argument."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563453025, "post_id": 57080324, "comment_id": 100710384, "body": "<code>`osascript` == &quot;osascript&quot;</code>, there is no difference at all in the actual string. You should normally only use backticks when necessary, and prefer double-quotes when possible."}, {"owner": {"reputation": 965, "user_id": 3554534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feq2v.jpg?s=128&g=1", "display_name": "pegasuspect", "link": "https://stackoverflow.com/users/3554534/pegasuspect"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563453952, "post_id": 57080324, "comment_id": 100710943, "body": "difference is in the last part. It is tricky to give a script as an argument. So double quotes works in ticks."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563454007, "post_id": 57080324, "comment_id": 100710976, "body": "yes, that&#39;s when you <i>would</i> use <code>``</code> to avoid escaping many quotes."}], "tags": [], "owner": {"reputation": 965, "user_id": 3554534, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feq2v.jpg?s=128&g=1", "display_name": "pegasuspect", "link": "https://stackoverflow.com/users/3554534/pegasuspect"}, "is_accepted": true, "score": 1, "last_activity_date": 1563460122, "last_edit_date": 1563460122, "creation_date": 1563380295, "answer_id": 57080324, "question_id": 57079120, "link": "https://stackoverflow.com/questions/57079120/using-exec-command-in-golang-how-do-i-open-a-new-terminal-and-execute-a-command/57080324#57080324", "title": "Using exec.Command in golang, how do I open a new terminal and execute a command?", "body": "<p>After playing some time found this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cmd := exec.Command(\"osascript\", \"-s\", \"h\", \"-e\",`tell application \"Terminal\" to do script \"echo test\"`)\n</code></pre>\n\n<p>Apparently you should give the automator script in 1 argument and also use ticks (`) as the string literals for go.</p>\n\n<p><code>\"-s\", \"h\"</code> is for automator program to tell you human readable errors.</p>\n\n<p>My complete test code is as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n )\n// this is a comment\n\nfunc main() {\n    // osascript -e 'tell application \"Terminal\" to do script \"echo hello\"'\n    cmd := exec.Command(`osascript`, \"-s\", \"h\", \"-e\",`tell application \"Terminal\" to do script \"echo test\"`)\n    // cmd := exec.Command(\"sh\", \"-c\", \"echo stdout; echo 1&gt;&amp;2 stderr\")\n    stderr, err := cmd.StderrPipe()\n    log.SetOutput(os.Stderr)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    slurp, _ := ioutil.ReadAll(stderr)\n    fmt.Printf(\"%s\\n\", slurp)\n\n    if err := cmd.Wait(); err != nil {\n        log.Fatal(err)\n    }\n}\n\n</code></pre>\n\n<p>PS: osascript is the command line interface for Automator app in macOS.</p>\n"}], "owner": {"reputation": 91, "user_id": 9367249, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Raw4ka1TOyQ/AAAAAAAAAAI/AAAAAAAAATM/_mE6S8xylZ0/photo.jpg?sz=128", "display_name": "TheJet 1", "link": "https://stackoverflow.com/users/9367249/thejet-1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1785, "favorite_count": 0, "accepted_answer_id": 57080324, "answer_count": 1, "score": 0, "last_activity_date": 1563460122, "creation_date": 1563376370, "question_id": 57079120, "link": "https://stackoverflow.com/questions/57079120/using-exec-command-in-golang-how-do-i-open-a-new-terminal-and-execute-a-command", "title": "Using exec.Command in golang, how do I open a new terminal and execute a command?", "body": "<p>I am able to get the following command to open a new terminal and execute the command when I directly input it inside a terminal, but I can not get it to work when I use the exec.Commmand function in go.</p>\n\n<pre><code>osascript -e 'tell application \"Terminal\" to do script \"echo hello\"'\n</code></pre>\n\n<p>I think the issue lies within the double and single quotes, but I am not exactly sure what is causing the error.</p>\n\n<pre><code>c := exec.Command(\"osascript\", \"-e\", \"'tell\", \"application\", `\"Terminal\"`, \"to\", \"do\", \"script\", `\"echo`, `hello\"'`)\nif err := c.Run(); err != nil {\n     fmt.Println(\"Error: \", err)\n}\n</code></pre>\n\n<p>As of now the code is returning Error:  exit status 1, but I would like the code to open a terminal window and execute the command.</p>\n"}, {"tags": ["string", "go", "struct", "go-structtag"], "answers": [{"comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1563375800, "post_id": 57078898, "comment_id": 100681003, "body": "Specifically, the conventions described on <a href=\"https://godoc.org/reflect#StructTag\" rel=\"nofollow noreferrer\"><code>reflect.StructTag</code></a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1563376025, "post_id": 57078898, "comment_id": 100681125, "body": "@TimCooper Thanks, included."}, {"owner": {"reputation": 13, "user_id": 8499986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cff91ab0554d343fc3215902f4b3606b?s=128&d=identicon&r=PG&f=1", "display_name": "Ocodenyth", "link": "https://stackoverflow.com/users/8499986/ocodenyth"}, "edited": false, "score": 0, "creation_date": 1563435816, "post_id": 57078898, "comment_id": 100700972, "body": "You&#39;re right, I forgot these were conventions! Thanks for the clear answer !"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1563436481, "last_edit_date": 1563436481, "creation_date": 1563375623, "answer_id": 57078898, "question_id": 57078637, "link": "https://stackoverflow.com/questions/57078637/can-you-set-multiple-different-tags-with-the-same-value/57078898#57078898", "title": "Can you set multiple (different) tags with the same value?", "body": "<p><a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Struct tags</a> are arbitrary <a href=\"https://golang.org/ref/spec#string_lit\" rel=\"nofollow noreferrer\">string literals</a>. Data stored in struct tags may look like whatever you want them to be, but if you don't follow the <em>conventions</em>, you'll have to write your own parser / processing logic. If you follow the conventions, you may use <a href=\"https://golang.org/pkg/reflect/#StructTag.Get\" rel=\"nofollow noreferrer\"><code>StructTag.Get()</code></a> and <a href=\"https://golang.org/pkg/reflect/#StructTag.Lookup\" rel=\"nofollow noreferrer\"><code>StructTag.Lookup()</code></a> to easily get tag values.</p>\n\n<p>The conventions do not support \"merging\" multiple tags, so just write them all out.</p>\n\n<p>The <em>conventions</em>, quoted from <a href=\"https://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow noreferrer\"><code>reflect.StructTag</code></a>:</p>\n\n<blockquote>\n  <p>By convention, tag strings are a concatenation of optionally space-separated key:\"value\" pairs. Each key is a non-empty string consisting of non-control characters other than space (U+0020 ' '), quote (U+0022 '\"'), and colon (U+003A ':'). Each value is quoted using U+0022 '\"' characters and Go string literal syntax.</p>\n</blockquote>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">What are the use(s) for tags in Go?</a></p>\n"}], "owner": {"reputation": 13, "user_id": 8499986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cff91ab0554d343fc3215902f4b3606b?s=128&d=identicon&r=PG&f=1", "display_name": "Ocodenyth", "link": "https://stackoverflow.com/users/8499986/ocodenyth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 57078898, "answer_count": 1, "score": 0, "last_activity_date": 1563436481, "creation_date": 1563374852, "last_edit_date": 1563376330, "question_id": 57078637, "link": "https://stackoverflow.com/questions/57078637/can-you-set-multiple-different-tags-with-the-same-value", "title": "Can you set multiple (different) tags with the same value?", "body": "<p>For some of my projects, I have had to use the <a href=\"https://github.com/spf13/viper/\" rel=\"nofollow noreferrer\">viper</a> package to use configuration. \nThe package requires you to add the <code>mapstructure:\"fieldname\"</code> to identify and set your configuration object's fields correctly, but I have also had to add other tags for other purposes, leading to something looking like the following : </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MyStruct struct {\n    MyField string `mapstructure:\"myField\" json:\"myField\" yaml:\"myField\"`\n}\n</code></pre>\n\n<p>As you can see, it is quite redundant for me to write <code>tag:\"myField\"</code> for each of my tag, so I was wondering if there was any way to \"bundle\" them up and reduce the verbosity, with something like this <code>mapstructure,json,yaml:\"myField\"</code></p>\n\n<p>Or is it simply not possible and you must specify every tag separately ?</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563374352, "post_id": 57078357, "comment_id": 100680149, "body": "<a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\"><code>html&#47;template</code></a> package. E.g. <a href=\"https://golang.org/pkg/html/template/#Template.Execute\" rel=\"nofollow noreferrer\"><code>Template.Execute()</code></a> method."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563376264, "post_id": 57078357, "comment_id": 100681259, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/18175630/go-template-executetemplate-include-html\">Go template.ExecuteTemplate include html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 0, "last_activity_date": 1563381082, "creation_date": 1563381082, "answer_id": 57080536, "question_id": 57078357, "link": "https://stackoverflow.com/questions/57078357/is-there-any-solution-to-render-html-like-this-in-gin/57080536#57080536", "title": "Is there any solution to render html like this in gin?", "body": "<p>I believe you can just do:</p>\n\n<pre><code>var aEle template.HTML = `&lt;a&gt;I 'm tagA&lt;/a&gt;`\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11798146, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-T9UbtCHCzN8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfoJFXUyjF8RzwrKR0bf7CSRjLX_g/photo.jpg?sz=128", "display_name": "solomneye", "link": "https://stackoverflow.com/users/11798146/solomneye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1597308816, "creation_date": 1563373984, "last_edit_date": 1597308816, "question_id": 57078357, "link": "https://stackoverflow.com/questions/57078357/is-there-any-solution-to-render-html-like-this-in-gin", "title": "Is there any solution to render html like this in gin?", "body": "<p>I want to render templete like this, but I can't find relative code from website.</p>\n<p>page.tmpl</p>\n<pre class=\"lang-golang prettyprint-override\"><code>&lt;html&gt;\n  &lt;body&gt;\n  {{.a}}\n  &lt;/body&gt;\n&lt;html&gt;\n</code></pre>\n<p>router code piece</p>\n<pre class=\"lang-golang prettyprint-override\"><code>aEle = `&lt;a&gt;I 'm tagA&lt;/a&gt;`\nr.GET(&quot;/page&quot;, func(c *gin.Context) {\n  c.HTML(200, &quot;page.tmpl&quot;,  gin.H{&quot;a&quot;:aEle,}})\n})\n</code></pre>\n<p>result like this</p>\n<pre class=\"lang-html prettyprint-override\"><code>page\n&lt;html&gt;\n  &lt;body&gt;\n    &lt;a&gt;I'\u2018m tagA&lt;/a&gt;\n  &lt;/body&gt;\n&lt;html&gt;\n</code></pre>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1563373098, "post_id": 57077877, "comment_id": 100679301, "body": "There is no need for a waitgroup here, simply use the channel close event for this. Once all items are sent on the channel, the &quot;producer&quot; should close the channel. Workers may use <code>for range</code> on the channel, which terminates when all items are received from the channel (that were sent on it before it was closed)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563373186, "post_id": 57077877, "comment_id": 100679356, "body": "I&#39;m not sure I understand what you&#39;re trying to do with the <code>WaitGroup</code> here. Take a look at the documentation example: <a href=\"https://golang.org/pkg/sync/#example_WaitGroup\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/#example_WaitGroup</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1563373330, "post_id": 57077877, "comment_id": 100679444, "body": "Your wait group isn&#39;t doing anything, except creating a race condition which you&#39;re running into."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563373390, "post_id": 57077877, "comment_id": 100679491, "body": "To be clear on my first comment: you don&#39;t need a waitgroup to get all elements from the channel, but you might need a waitgroup if you need to wait all your workers to finish."}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1563373524, "post_id": 57077877, "comment_id": 100679579, "body": "Like @icza said if you want to close your application after everything is executed (is not a part of some bigger application and work in background), you can remove <code>go</code> which is before <code>makeMePrint</code> and after that you can safely remove all of waitGroup usage because <code>range</code> in <code>makeMePrint</code> will end after you close the channel"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563378907, "post_id": 57077877, "comment_id": 100682791, "body": "The above comments are right regarding an improved design not using WaitGroup, but regarding your original error, it is because the call to <code>wg.Wait</code> is being executed before any call to <code>wg.Add</code> gets executed."}], "answers": [{"tags": [], "owner": {"reputation": 169, "user_id": 1213542, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OMRch.jpg?s=128&g=1", "display_name": "Mudasir Mirza", "link": "https://stackoverflow.com/users/1213542/mudasir-mirza"}, "is_accepted": true, "score": 0, "last_activity_date": 1563436407, "creation_date": 1563436407, "answer_id": 57089629, "question_id": 57077877, "link": "https://stackoverflow.com/questions/57077877/goroutine-reading-from-channel-with-dynamic-loop-getting-waitgroup-is-reused-bef/57089629#57089629", "title": "goroutine reading from channel with dynamic loop getting waitgroup is reused before previous was has returned", "body": "<p>I finally got it to work.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/dchest/uniuri\"\n    \"math/rand\"\n    \"sync\"\n    \"time\"\n)\n\nvar count = 0\n\nfunc printMe(msg string) {\n    time.Sleep(1 * time.Second)\n    fmt.Println(count, msg)\n}\n\nfunc makeMePrint(wg *sync.WaitGroup, ch chan string) {\n    wg.Add(1)\n    defer wg.Done()\n\n    for s := range ch {\n        count++\n        printMe(s)\n\n    }\n\n}\n\nfunc writePrint(wg *sync.WaitGroup, ch chan&lt;- string) {\n    wg.Add(1)\n    defer wg.Done()\n\n    fmt.Println(\"Starting to insert data in channel\")\n    for i := 1; i &lt;= rand.Intn(30); i++ {\n        s := uniuri.New()\n        ch &lt;- s\n    }\n    fmt.Println(\"We are done inserting all data in the channel\")\n    close(ch)\n}\n\nfunc main() {\n    wg := &amp;sync.WaitGroup{}\n    var ch = make(chan string)\n\n    go writePrint(wg, ch)\n    go makeMePrint(wg, ch)\n    time.Sleep(1 * time.Second)\n    wg.Wait()\n}\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 1213542, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/OMRch.jpg?s=128&g=1", "display_name": "Mudasir Mirza", "link": "https://stackoverflow.com/users/1213542/mudasir-mirza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 588, "favorite_count": 0, "accepted_answer_id": 57089629, "answer_count": 1, "score": -2, "last_activity_date": 1563436407, "creation_date": 1563372543, "question_id": 57077877, "link": "https://stackoverflow.com/questions/57077877/goroutine-reading-from-channel-with-dynamic-loop-getting-waitgroup-is-reused-bef", "title": "goroutine reading from channel with dynamic loop getting waitgroup is reused before previous was has returned", "body": "<p>I am working on a small utility which needs to iterate over a dynamic range of items (can be 100 or can be 100000) and put the items in a channel. From that channel another function reads the items and does some processing on each item individually.\nI am trying to use <code>sync.WaitGroup</code> to make sure that my utility does not exit before all the items in the channels are processed. As I am fairly new to channels and waitgroups, I am stuck with an error <code>panic: sync: WaitGroup is reused before previous Wait has returned</code></p>\n\n<p><a href=\"https://play.golang.org/p/nMw3END_9qw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nMw3END_9qw</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/dchest/uniuri\"\n    \"math/rand\"\n    \"sync\"\n    \"time\"\n)\n\nvar wg sync.WaitGroup\nvar count = 0\n\nfunc printMe(msg string) {\n    time.Sleep(1 * time.Second)\n    fmt.Println(count, msg)\n}\n\nfunc makeMePrint(ch chan string) {\n    for s := range ch {\n        count++\n        wg.Add(1)\n        printMe(s)\n        wg.Done()\n    }\n\n}\n\nfunc writePrint(ch chan&lt;- string) {\n    fmt.Println(\"Starting to insert data in channel\")\n    for i := 1; i &lt;= rand.Intn(30); i++ {\n        s := uniuri.New()\n        ch &lt;- s\n    }\n    fmt.Println(\"We are done inserting all data in the channel\")\n    close(ch)\n}\n\nfunc main() {\n\n    var ch = make(chan string)\n\n    go writePrint(ch)\n    go makeMePrint(ch)\n    time.Sleep(1 * time.Second)\n    wg.Wait()\n}\n</code></pre>\n\n<p>This is the main idea of what I am working on (not the exact code but exactly the same architecture with same number of functions).</p>\n\n<p>How can I make sure that the utility only exits only when all the items in the channel are processes.</p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["git", "go", "module", "continuous-integration"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563371472, "post_id": 57077422, "comment_id": 100678172, "body": "There are many ways to address this issue, which makes it too broad to adequately answer here. Also, none of them relate specifically to Go, meaning if you find a solution on Google for any language, you can adapt it to Go. You should do some research. Read blog posts and forum discussions about the different approaches, and choose one you&#39;re comfortable with."}, {"owner": {"reputation": 87, "user_id": 5318547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a1dbH.jpg?s=128&g=1", "display_name": "Anonym", "link": "https://stackoverflow.com/users/5318547/anonym"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563371697, "post_id": 57077422, "comment_id": 100678334, "body": "Usually I will do it with git-submodules, but it is not a go way because of gopath and go organisation, so, I disagree with you."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563372224, "post_id": 57077422, "comment_id": 100678688, "body": "You can have your submodules mounted under, or linked to <code>vendor</code>, so your disagreement is actually wrong."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563372250, "post_id": 57077422, "comment_id": 100678706, "body": "Although I strongly discourage submodules for such a thing anyway."}, {"owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "edited": false, "score": 0, "creation_date": 1564427185, "post_id": 57077422, "comment_id": 101019205, "body": "The above comments seem to be confusing Go modules with Git submodules. The question seems clearly about the former, not the latter."}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": true, "score": 1, "last_activity_date": 1564428105, "creation_date": 1564428105, "answer_id": 57260215, "question_id": 57077422, "link": "https://stackoverflow.com/questions/57077422/how-to-organize-two-git-repos-for-ci/57260215#57260215", "title": "How to organize two git repos for CI", "body": "<p>Your <code>go.mod</code> file can specify an explicit commit of a dependency \u2014 even if that commit is on a branch! \u2014 as long as the commit has actually been published to that repository.</p>\n\n<p>So if you publish a feature on the <code>feature-42</code> branch of <code>core</code> and want to use that in <code>project</code>, you can run <code>go get core@feature-42</code> within the <code>project</code> module and you should get a version that includes that feature.</p>\n\n<p>(The <code>go</code> command knows how to resolve a branch name to a specific commit in general, so you shouldn't need to name the commit hash explicitly. However, the <code>go.mod</code> file will record a <a href=\"https://tip.golang.org/cmd/go/#hdr-Pseudo_versions\" rel=\"nofollow noreferrer\">pseudo-version</a> with the resolved hash.)</p>\n\n<hr>\n\n<p>As another alternative, you could add a <code>go mod edit -replace</code> command to your CI system, to have it explicitly replace the selected version of the <code>core</code> module with the branch in question.</p>\n\n<hr>\n\n<p>All that said, it sounds like it would probably be simpler for you to switch to a monorepo, perhaps with a single <code>go.mod</code> file at the repo root so that everything is versioned in lock-step. In my experience, the best way to avoid a Go project turning into a monolith is through the use of <a href=\"https://golang.org/doc/go1.4#internalpackages\" rel=\"nofollow noreferrer\"><code>internal</code> packages</a>, not separate repositories.</p>\n"}], "owner": {"reputation": 87, "user_id": 5318547, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a1dbH.jpg?s=128&g=1", "display_name": "Anonym", "link": "https://stackoverflow.com/users/5318547/anonym"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 57260215, "answer_count": 1, "score": 0, "last_activity_date": 1564428105, "creation_date": 1563371173, "last_edit_date": 1563371433, "question_id": 57077422, "link": "https://stackoverflow.com/questions/57077422/how-to-organize-two-git-repos-for-ci", "title": "How to organize two git repos for CI", "body": "<p>I have a git repo \"core\" and \"project\" repo, that is using \"core\" as dependency. If I want to change some API of \"core\" module, and its usages in \"project\", I create two separate pull requests in gitlab. But our continuous integration system can't test \"project\" until \"core\" will be merged, if \"core\" contains API changes.\nWhat I want, is the possibility of \"project\" test will go on the same branch in \"core\". For example if I created branches \"feature-42\" in \"project\" and \"core\", the \"project\" tests will start on the \"feature-42\" branch of \"core\".</p>\n\n<p>Now we have an opportunity to move at go modules, but it is hard to always specify the direct commit hash in go.mod file(many possibilities to made a mistake).\nIt looks like we should use monorepo, but I scared of the possibility our project will become monolith (considering that we have not very qualified developers).</p>\n\n<p>How can we organize our continuous integration?</p>\n\n<p>P.S. also we don't wanna use tags with version, because people works in parallel, and it is hard to maintain always non-decreasing versions.</p>\n"}, {"tags": ["go", "rethinkdb"], "answers": [{"comments": [{"owner": {"reputation": 504, "user_id": 465136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dc8963815cdc4f8e9a87e804766f0d3?s=128&d=identicon&r=PG&f=1", "display_name": "inf581", "link": "https://stackoverflow.com/users/465136/inf581"}, "reply_to_user": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "edited": false, "score": 0, "creation_date": 1563371731, "post_id": 57077344, "comment_id": 100678357, "body": "@camccar yes of course. Rethinkdb query language is very flexible"}], "tags": [], "owner": {"reputation": 504, "user_id": 465136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dc8963815cdc4f8e9a87e804766f0d3?s=128&d=identicon&r=PG&f=1", "display_name": "inf581", "link": "https://stackoverflow.com/users/465136/inf581"}, "is_accepted": true, "score": 1, "last_activity_date": 1563370939, "creation_date": 1563370939, "answer_id": 57077344, "question_id": 57077119, "link": "https://stackoverflow.com/questions/57077119/rethink-db-query-for-sub-array-only/57077344#57077344", "title": "Rethink DB Query for sub array only", "body": "<p>You need to use <a href=\"https://www.rethinkdb.com/api/javascript/concat_map/\" rel=\"nofollow noreferrer\">concatMap</a> command</p>\n\n<pre><code>r.db(\"irrelevant\").table(\"alerts\").concatMap(r.row.getField('history'))\n</code></pre>\n"}], "owner": {"reputation": 622, "user_id": 1710501, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e308decda9992832f6c0634f134fb7b1?s=128&d=identicon&r=PG", "display_name": "camccar", "link": "https://stackoverflow.com/users/1710501/camccar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 57077344, "answer_count": 1, "score": 0, "last_activity_date": 1563370939, "creation_date": 1563370339, "last_edit_date": 1563370895, "question_id": 57077119, "link": "https://stackoverflow.com/questions/57077119/rethink-db-query-for-sub-array-only", "title": "Rethink DB Query for sub array only", "body": "<p>Lets say I have an object in a table called alerts like</p>\n\n<pre><code>{ id:\"1\"\n   history:[ {\n            date:\"some date\"\n            hid:\"1234\"\n          },\n         { \n          date:\"some date\"\n          hid:\"1234\"\n         }\n       ]\n  }\n { id:\"2\"\n   history:[ {\n            date:\"some other date\"\n            hid:\"1235\"\n          },\n         { \n          date:\"some date\"\n          hid:\"1234\"\n         }\n       ]\n  }\n</code></pre>\n\n<p>I want an array of just the history objects from all alerts. If I use pluck such as</p>\n\n<pre><code>r.db(\"irrelevant\").table(\"alerts\").pluck(\"history\")\n</code></pre>\n\n<p>I end up with the whole structure with brackets just no id. like</p>\n\n<pre><code>{\n  history:[{hid:123,date:\"some date\"}{hid:123,date:\"some date\"}]\n},\n{\n  history:[{hid:123,date:\"some date\"}{hid:123,date:\"some date\"}]\n }\n</code></pre>\n\n<p>When what I want is </p>\n\n<pre><code>[{hid:123,date:\"some date\"},{hid:123,date:\"some date\"},{hid:123,date:\"some date\"},{hid:123,date:\"some date\"}]\n</code></pre>\n\n<p>I'm specifically doing this in go but if I can find a RethinkDB javascript query I could probably translate it into go</p>\n"}, {"tags": ["go", "command", "line"], "answers": [{"tags": [], "owner": {"reputation": 90, "user_id": 8295357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/835de56d25fd6634d9578d717c605ecb?s=128&d=identicon&r=PG&f=1", "display_name": "Abenstex", "link": "https://stackoverflow.com/users/8295357/abenstex"}, "is_accepted": false, "score": -1, "last_activity_date": 1563371407, "last_edit_date": 1563371407, "creation_date": 1563370894, "answer_id": 57077318, "question_id": 57077105, "link": "https://stackoverflow.com/questions/57077105/command-line-argument-is-ignored-in-go-tool/57077318#57077318", "title": "Command line argument is ignored in Go tool", "body": "<p>I found that I called <code>flag.Parse()</code> after I started using the parameter.</p>\n"}], "owner": {"reputation": 90, "user_id": 8295357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/835de56d25fd6634d9578d717c605ecb?s=128&d=identicon&r=PG&f=1", "display_name": "Abenstex", "link": "https://stackoverflow.com/users/8295357/abenstex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1563371407, "creation_date": 1563370299, "last_edit_date": 1563370779, "question_id": 57077105, "link": "https://stackoverflow.com/questions/57077105/command-line-argument-is-ignored-in-go-tool", "title": "Command line argument is ignored in Go tool", "body": "<p>I'm currently writing my first small tool in Go and I ran into the problem that no matter what I do, one command line argument is getting ignored.</p>\n\n<pre><code>mainFile := flag.String(\"input\", \"./generator.ini\", \"the input file\")\noutputFile := flag.String(\"foo\", \"Default directory foo bar blablabla\", \"the output directory\")\nfmt.Println(\"Param: \", *outputFile)\noutputDir := filepath.Clean(*outputFile)\n\nflag.Parse()\n\nfmt.Println(\"Outputdir \", outputDir)\nfmt.Println(\"Mainfile \", *mainFile)\n</code></pre>\n\n<p>So the thing is that outputFile is always the default value no matter how I call the programm.</p>\n\n<pre><code>.\\generator.exe -input=D:\\entwicklung\\GoLang\\src\\github.com\\Abenstex\\CodeGenerator\\generator\\main.cfg -out=D:\\entwicklung\\test\n</code></pre>\n\n<p>It absolutely does not matter if -out comes before -input or not. The value of output is always the default whereas the input value is always correctly set. I'm really at a loss here.</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-functions"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563382127, "post_id": 57077072, "comment_id": 100684504, "body": "ImageMagick generally uses <code>fd:N</code> to read pipes. Did you try <a href=\"https://golang.org/pkg/os/#Pipe\" rel=\"nofollow noreferrer\"><code>os.Pipe</code></a>?"}, {"owner": {"reputation": 11, "user_id": 3644822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b568797ed4312a4fe31612d1a9c0712?s=128&d=identicon&r=PG&f=1", "display_name": "DuncanA", "link": "https://stackoverflow.com/users/3644822/duncana"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563805578, "post_id": 57077072, "comment_id": 100811673, "body": "Hi @jimB, I&#39;ve taken a look at the os.Pipe mechanism, but I don&#39;t think it really suits my needs. Even if I can use the Pipe to wrap the Reader object from the Storage API, I still don&#39;t seem to have a way to provide that as input to the exec.Command structure"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563821350, "post_id": 57077072, "comment_id": 100819233, "body": "I&#39;m not sure how it doesn&#39;t suit your needs, <code>os.Pipe</code> returns 2 <code>*os.File</code>, and you can append the read side to <code>cmd.ExtraFiles</code> just like you do below. There&#39;s nothing wrong with caching the files locally, but a streaming solution is sometimes more efficient."}, {"owner": {"reputation": 11, "user_id": 3644822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b568797ed4312a4fe31612d1a9c0712?s=128&d=identicon&r=PG&f=1", "display_name": "DuncanA", "link": "https://stackoverflow.com/users/3644822/duncana"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563871648, "post_id": 57077072, "comment_id": 100834463, "body": "Hi @jimB - Thanks for the reply. I&#39;m not really sure what I missed the first time around, but I completely agree that a streaming solution would be better &amp; I should be able to use the os.Pipe mechanism to achieve this. I&#39;ve re-done my overlay function to make use of the Pipes now &amp; it&#39;s kinda functional, but the convert command now takes about 2 1/2 minutes to execute. I&#39;m going to keep looking and I&#39;ll post an update if I figure it out."}, {"owner": {"reputation": 11, "user_id": 3644822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b568797ed4312a4fe31612d1a9c0712?s=128&d=identicon&r=PG&f=1", "display_name": "DuncanA", "link": "https://stackoverflow.com/users/3644822/duncana"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563892820, "post_id": 57077072, "comment_id": 100846955, "body": "I can&#39;t fathom it - using Pipes, the script does work, but it&#39;ll take anywhere from 1 to 5 minutes to complete, whereas using the temporary files it takes a second or two."}], "answers": [{"comments": [{"owner": {"reputation": 1040, "user_id": 11135159, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fcb3b536ae330b4e19e8359824aef583?s=128&d=identicon&r=PG&f=1", "display_name": "Pawel Czuczwara", "link": "https://stackoverflow.com/users/11135159/pawel-czuczwara"}, "edited": false, "score": 0, "creation_date": 1563523321, "post_id": 57078474, "comment_id": 100735858, "body": "Hi user3644822, good work finding the solution! Can you accept your own answer? It will make it more visible and help someone with the same issue as you find the solution. Thanks!"}], "tags": [], "owner": {"reputation": 11, "user_id": 3644822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b568797ed4312a4fe31612d1a9c0712?s=128&d=identicon&r=PG&f=1", "display_name": "DuncanA", "link": "https://stackoverflow.com/users/3644822/duncana"}, "is_accepted": true, "score": 1, "last_activity_date": 1563374315, "creation_date": 1563374315, "answer_id": 57078474, "question_id": 57077072, "link": "https://stackoverflow.com/questions/57077072/passing-multiple-files-to-an-exec-command-invocation-from-storage-buckets/57078474#57078474", "title": "Passing multiple files to an exec.Command invocation from storage buckets", "body": "<p>To anybody who happens across this question in the future - I found a workaround. I'm not thrilled with it, but it is functional.</p>\n\n<p>Essentially, I was able to slurp the contents of the storage Readers &amp; then create my own os.File objects within the Cloud Functions context. Then, passing that os.File to the exec.Cmd invocation. It's definitely not ideal, but here's the code:</p>\n\n<pre><code>func Overlay(ctx context.Context, inputBucket, outputBucket, background string, foreground string, output string) (string, error) {\n        // Retrieve the Background Image from the storage API\n        backgroundBlob := storageClient.Bucket(inputBucket).Object(background)\n        backgroundImg, err := backgroundBlob.NewReader(ctx)\n        if err != nil {\n                return \"\", fmt.Errorf(\"backgroundImg: %v\", err)\n        }        \n        // Read the contents of the file into a variable\n        backgroundSlurp, err := ioutil.ReadAll(backgroundImg)\n        if err != nil {\n                return \"\", fmt.Errorf(\"readFile: unable to read data from bucket %q, file %q: %v\", inputBucket, background, err)\n        }\n        // Write the contents of Background Image to an os.File instance\n        err = ioutil.WriteFile(fmt.Sprintf(\"/tmp/%s\",background), backgroundSlurp, 0644)\n        if err != nil {\n                return \"\", fmt.Errorf(\"backgroundImg: %v\", err)\n        }\n        // Open the os.File instance to pass it on to os.exec later\n        backgroundFile, err := os.Open(fmt.Sprintf(\"/tmp/%s\",background))\n        if err != nil {\n                return \"\", fmt.Errorf(\"backgroundFile: %v\", err)\n        }\n\n        foregroundBlob := storageClient.Bucket(inputBucket).Object(foreground)\n        foregroundImg, err := foregroundBlob.NewReader(ctx)\n        if err != nil {\n                return \"\", fmt.Errorf(\"foregroundImg: %v\", err)\n        }\n        // Read the contents of the file into a variable\n        foreroundSlurp, err := ioutil.ReadAll(foregroundImg)\n        if err != nil {\n                return \"\", fmt.Errorf(\"readFile: unable to read data from bucket %q, file %q: %v\", inputBucket, foreground, err)\n        }\n        // Write the contents of Foreground Image to an os.File instance\n        err = ioutil.WriteFile(fmt.Sprintf(\"/tmp/%s\",foreground), foreroundSlurp, 0644)\n        if err != nil {\n                return \"\", fmt.Errorf(\"foregroundImg: %v\", err)\n        }\n        // Open the os.File instance to pass it on to os.exec later\n        foregroundFile, err := os.Open(fmt.Sprintf(\"/tmp/%s\",foreground))\n        if err != nil {\n                return \"\", fmt.Errorf(\"foregroundFile: %v\", err)\n        }\n\n        outputBlob := storageClient.Bucket(outputBucket).Object(output)\n        outputImg := outputBlob.NewWriter(ctx)\n        defer outputImg.Close()\n\n        // Set up some additional file handles since we're delaqing with more inputs than STDIN Can cope with\n        cmd := exec.Command(\"convert\", \"fd:3\", \"fd:4\", \"-composite\", \"-\")\n        cmd.Stdout = outputImg\n        cmd.ExtraFiles = append(cmd.ExtraFiles,backgroundFile)\n        cmd.ExtraFiles = append(cmd.ExtraFiles,foregroundFile)\n\n        if err := cmd.Run(); err != nil {\n                return \"\", fmt.Errorf(\"cmd.Run: %v\", err)\n        }\n\n        log.Printf(\"Blurred image has been uploaded to %s\", outputBlob.ObjectName())\n\n        return outputBlob.ObjectName(), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 3644822, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b568797ed4312a4fe31612d1a9c0712?s=128&d=identicon&r=PG&f=1", "display_name": "DuncanA", "link": "https://stackoverflow.com/users/3644822/duncana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 57078474, "answer_count": 1, "score": 0, "last_activity_date": 1563374315, "creation_date": 1563370188, "question_id": 57077072, "link": "https://stackoverflow.com/questions/57077072/passing-multiple-files-to-an-exec-command-invocation-from-storage-buckets", "title": "Passing multiple files to an exec.Command invocation from storage buckets", "body": "<p>I'm attempting to build a cloud function written in Go, that will use the available ImageMagick library in Google's Cloud Functions infrastructure to composite &amp; manipulate several images into a resulting output image.</p>\n\n<p>The root of the problem, is that the ImageMagick function that I want to use is available, but it takes multiple distinct inputs in order to work. My inputs are objects in a Storage Bucket.</p>\n\n<p>The os/exec Cmd struct allows you to do this, by using an \"ExtraFiles\" array, and I know how to provide these extra files to my ImageMagick command.</p>\n\n<p>However, the \"ExtraFiles\" array only wants to store instances of os.File, whereas the GCP Storage Client gives you a \"Reader\" instance when you open a file.</p>\n\n<pre><code>        backgroundBlob := storageClient.Bucket(inputBucket).Object(background)\n        backgroundImg, err := backgroundBlob.NewReader(ctx)\n        if err != nil {\n                return \"\", fmt.Errorf(\"backgroundImg: %v\", err)\n        }\n\n        foregroundBlob := storageClient.Bucket(inputBucket).Object(foreground)\n        foregroundImg, err := foregroundBlob.NewReader(ctx)\n        if err != nil {\n                return \"\", fmt.Errorf(\"foregroundImg: %v\", err)\n        }\n\n        outputBlob := storageClient.Bucket(outputBucket).Object(output)\n        outputImg := outputBlob.NewWriter(ctx)\n        defer outputImg.Close()\n\n        // Set up some additional file handles since we're dealing with more inputs than STDIN Can cope with\n        cmd := exec.Command(\"convert\", \"fd:3\", \"fd:4\", \"-composite\", \"fd:5\")\n        cmd.ExtraFiles = append(cmd.ExtraFiles,backgroundImg)\n        cmd.ExtraFiles = append(cmd.ExtraFiles,foregroundImg)\n        cmd.ExtraFiles = append(cmd.ExtraFiles,outputImg)\n\n        if err := cmd.Run(); err != nil {\n                return \"\", fmt.Errorf(\"cmd.Run: %v\", err)\n        }\n\n        log.Printf(\"Blurred image has been uploaded to %s\", outputBlob.ObjectName())\n\n        return outputBlob.ObjectName(), nil\n}```\n\nSo, from where I am at the moment, I need to do one of the following two things:\n1. Figure out how to get Google's storage API to treat/use objects in their storage buckets as \"os.File\"s\nOR\n2. Figure out how to execute my \"convert\" command using multiple Readers as input, rather than leveraging the ExtraFiles array.\n\nIf anybody out there has any ideas on how to achieve either of the above, or has alternate ways of solving this problem, I would be very grateful to hear them!\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mapreduce", "mgo"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1563449607, "post_id": 57076178, "comment_id": 100708440, "body": "<code>c.Find(query).MapReduce...</code>"}, {"owner": {"reputation": 665, "user_id": 533237, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2c53d96de85a46700cefb0f6da8a2275?s=128&d=identicon&r=PG&f=1", "display_name": "yodhevauhe", "link": "https://stackoverflow.com/users/533237/yodhevauhe"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1563519711, "post_id": 57076178, "comment_id": 100734126, "body": "@MarkusWMahlberg , Tested, working, Please post as answer,Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 665, "user_id": 533237, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2c53d96de85a46700cefb0f6da8a2275?s=128&d=identicon&r=PG&f=1", "display_name": "yodhevauhe", "link": "https://stackoverflow.com/users/533237/yodhevauhe"}, "is_accepted": false, "score": 1, "last_activity_date": 1563376668, "creation_date": 1563376668, "answer_id": 57079216, "question_id": 57076178, "link": "https://stackoverflow.com/questions/57076178/golang-globalsign-mgo-query-in-mapreduce/57079216#57079216", "title": "Golang GlobalSign mgo Query in MapReduce", "body": "<p>Managed to get this done with MongoDb official godriver</p>\n\n<pre><code>\"go.mongodb.org/mongo-driver/bson\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"go.mongodb.org/mongo-driver/mongo/options\"\n\npar := bson.D{\n    {\"mapreduce\", \"audit\"},\n    {\"map\", \" function() { emit( this.name , 1 ); }\"},\n    {\"reduce\", \"function(key, arr) { return Array.sum(arr); }\"},\n    {\"out\", \"mr3\"},\n    {\"query\", bson.D{{\"status\", \"SUCCESS\"}}},\n}\n\nsr := db.RunCommand(nil, par)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 1, "last_activity_date": 1563522315, "creation_date": 1563522315, "answer_id": 57107824, "question_id": 57076178, "link": "https://stackoverflow.com/questions/57076178/golang-globalsign-mgo-query-in-mapreduce/57107824#57107824", "title": "Golang GlobalSign mgo Query in MapReduce", "body": "<p><code>MapReduce</code> is a function of the Query struct returned by Find. So in order to apply your MapReduce to a query result, simply add a query document to the find function:</p>\n\n<pre><code>c.Find(query).MapReduce(job,result)\n</code></pre>\n"}], "owner": {"reputation": 665, "user_id": 533237, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2c53d96de85a46700cefb0f6da8a2275?s=128&d=identicon&r=PG&f=1", "display_name": "yodhevauhe", "link": "https://stackoverflow.com/users/533237/yodhevauhe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 556, "favorite_count": 0, "accepted_answer_id": 57107824, "answer_count": 2, "score": -1, "last_activity_date": 1563522315, "creation_date": 1563367498, "question_id": 57076178, "link": "https://stackoverflow.com/questions/57076178/golang-globalsign-mgo-query-in-mapreduce", "title": "Golang GlobalSign mgo Query in MapReduce", "body": "<pre><code>import \"github.com/globalsign/mgo\"\n\njob := &amp;mgo.MapReduce{\n    Map:    \"function() { emit(this.name, 1) }\",\n    Reduce: \"function(key, values) { return Array.sum(values) }\",\n    Out:    \"res\",\n\n}\n\n_, err = c.Find(nil).MapReduce(job, nil)\n</code></pre>\n\n<p>How to add 'query' to the above golang mgo mapreduce ?</p>\n\n<p>Ref:</p>\n\n<p><a href=\"https://docs.mongodb.com/manual/core/map-reduce/\" rel=\"nofollow noreferrer\">https://docs.mongodb.com/manual/core/map-reduce/</a>\n<a href=\"https://godoc.org/github.com/globalsign/mgo#MapReduce\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/globalsign/mgo#MapReduce</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1563367050, "post_id": 57075850, "comment_id": 100675181, "body": "Which part confuses you? <code>for {}</code> is a loop. <code>select</code> is a select statement."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1563370590, "post_id": 57075850, "comment_id": 100677573, "body": "Note that &quot;please explain this code&quot; questions are generally considered by nature to be too broad to be permissible here. &quot;Why does X happen before Y?&quot; with a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> can be on-topic, but the goal is to make the question as explicit and narrow as possible, describing exactly what you expect, why you expect it, and what you see instead. See <a href=\"https://meta.stackoverflow.com/questions/253894/how-to-handle-explain-how-this-code-dump-works-questions\">How to handle \u201cExplain how this ${code dump} works\u201d questions</a> on <a href=\"https://meta.stackoverflow.com\">Meta Stack Overflow</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11797530, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rLa31S4_HzA/AAAAAAAAAAI/AAAAAAAAACc/sYFlz8AdTCQ/photo.jpg?sz=128", "display_name": "Bobby", "link": "https://stackoverflow.com/users/11797530/bobby"}, "edited": false, "score": 0, "creation_date": 1563368504, "post_id": 57076160, "comment_id": 100676144, "body": "very thanks\uff0cbut i have some problem the channel will cloesd at 5 second,in 5 second the case doesnt run ? if i dont close this channel ,cant do &lt;- done?will run default but the default is empty ,why workcount will add +1 ,dont know the order ,can show number about program run order"}, {"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1563368940, "post_id": 57076160, "comment_id": 100676447, "body": "Reading from closed channels always returns immediately, with a default value. (0, false, &quot;&quot;, etc.)  <code>default</code> is picked immediately if no other case can run."}, {"owner": {"reputation": 1, "user_id": 11797530, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rLa31S4_HzA/AAAAAAAAAAI/AAAAAAAAACc/sYFlz8AdTCQ/photo.jpg?sz=128", "display_name": "Bobby", "link": "https://stackoverflow.com/users/11797530/bobby"}, "edited": false, "score": 0, "creation_date": 1563369622, "post_id": 57076160, "comment_id": 100676957, "body": "default is empty so the program will run workcount++? then continue for loop ,when 5second , the case &lt;-done will run ,so break the loop? then run fmt.Printf?  i run this program ,i found the program will show <code>1 2 3 4 5 ...</code> after 5 seconds. why program will print information after 5 seconds?"}, {"owner": {"reputation": 1, "user_id": 11797530, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rLa31S4_HzA/AAAAAAAAAAI/AAAAAAAAACc/sYFlz8AdTCQ/photo.jpg?sz=128", "display_name": "Bobby", "link": "https://stackoverflow.com/users/11797530/bobby"}, "edited": false, "score": 0, "creation_date": 1563370427, "post_id": 57076160, "comment_id": 100677469, "body": "Thank you very much,  can you add the number of the program running, so that I can clearly understand the order in which it runs."}, {"owner": {"reputation": 614, "user_id": 5802172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9msUA.jpg?s=128&g=1", "display_name": "Sebastian Waldbauer", "link": "https://stackoverflow.com/users/5802172/sebastian-waldbauer"}, "edited": false, "score": 0, "creation_date": 1563370560, "post_id": 57076160, "comment_id": 100677555, "body": "What do you mean by order? The program runs from top to bottom"}, {"owner": {"reputation": 1, "user_id": 11797530, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rLa31S4_HzA/AAAAAAAAAAI/AAAAAAAAACc/sYFlz8AdTCQ/photo.jpg?sz=128", "display_name": "Bobby", "link": "https://stackoverflow.com/users/11797530/bobby"}, "edited": false, "score": 0, "creation_date": 1563370832, "post_id": 57076160, "comment_id": 100677715, "body": "i want know the <code>case &lt;-done</code> will run after 5seconds right\uff1fwhy\uff1f the channel not a buffered channel only have one  value ,if i didnt send any value to it ,it has a zerovalue, the zerovalue of interface is nil so &lt;-done will read nil  right\uff1fwhy i need close\uff1f"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1563370835, "post_id": 57076160, "comment_id": 100677717, "body": "@SebastianWaldbauer, ...as a note for the future, see <a href=\"https://meta.stackoverflow.com/questions/253894/how-to-handle-explain-how-this-code-dump-works-questions\">How to handle \u201cExplain how this ${code dump} works\u201d questions</a> on <a href=\"https://meta.stackoverflow.com\">Meta Stack Overflow</a>, and the &quot;Answer Well-Asked Questions&quot; section of <a href=\"https://stackoverflow.com/help/how-to-answer\">How to Answer</a>; it can avoid a lot of trouble to get someone to narrow and clarify their question <i>before</i> trying to answer it, so you don&#39;t find out you answered the wrong question after already putting effort in."}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "reply_to_user": {"reputation": 1, "user_id": 11797530, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rLa31S4_HzA/AAAAAAAAAAI/AAAAAAAAACc/sYFlz8AdTCQ/photo.jpg?sz=128", "display_name": "Bobby", "link": "https://stackoverflow.com/users/11797530/bobby"}, "edited": false, "score": 0, "creation_date": 1563370908, "post_id": 57076160, "comment_id": 100677771, "body": "@Bobby, ...it would have very helpful to have had the content you just put in your last comment included in the question itself, as that explains what it specifically is about the execution path that&#39;s surprising to you, vs making someone guess what you do and don&#39;t already know."}, {"owner": {"reputation": 1, "user_id": 11797530, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rLa31S4_HzA/AAAAAAAAAAI/AAAAAAAAACc/sYFlz8AdTCQ/photo.jpg?sz=128", "display_name": "Bobby", "link": "https://stackoverflow.com/users/11797530/bobby"}, "edited": false, "score": 0, "creation_date": 1563370998, "post_id": 57076160, "comment_id": 100677841, "body": "yes the order mean the program runs from top to bottom,sorry for my english."}, {"owner": {"reputation": 1, "user_id": 11797530, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rLa31S4_HzA/AAAAAAAAAAI/AAAAAAAAACc/sYFlz8AdTCQ/photo.jpg?sz=128", "display_name": "Bobby", "link": "https://stackoverflow.com/users/11797530/bobby"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1563371042, "post_id": 57076160, "comment_id": 100677877, "body": "@CharlesDuffy thanks , i am new come to stackoverflow....."}, {"owner": {"reputation": 1, "user_id": 11797530, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rLa31S4_HzA/AAAAAAAAAAI/AAAAAAAAACc/sYFlz8AdTCQ/photo.jpg?sz=128", "display_name": "Bobby", "link": "https://stackoverflow.com/users/11797530/bobby"}, "edited": false, "score": 0, "creation_date": 1563372707, "post_id": 57076160, "comment_id": 100679011, "body": "@SebastianWaldbauer  hi bro why &lt;-done will run after close ?"}], "tags": [], "owner": {"reputation": 614, "user_id": 5802172, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9msUA.jpg?s=128&g=1", "display_name": "Sebastian Waldbauer", "link": "https://stackoverflow.com/users/5802172/sebastian-waldbauer"}, "is_accepted": true, "score": 0, "last_activity_date": 1563370427, "last_edit_date": 1563370427, "creation_date": 1563367453, "answer_id": 57076160, "question_id": 57075850, "link": "https://stackoverflow.com/questions/57075850/who-can-explain-the-execution-that-the-done-will-run-after-close/57076160#57076160", "title": "Who can explain the execution that the &lt;-done will run after close", "body": "<pre><code>    // Our communication channel is created\n    done := make(chan interface{})\n\n    // run this function as goroutine\n    go func() {\n        // wait/sleep 5 seconds\n        time.Sleep(5 * time.Second)\n\n        // close our communication channel\n        close(done)\n    }()\n\n    // initialize workcount with 0\n    workcount := 0\n\nloop:\n    // loop\n    for {\n        // read channel data\n        select {\n        // if channel is closed break this loop, break = stop!\n        case &lt;-done:\n            break loop\n\n        // default do nothing\n        default:\n        }\n\n        // if our channel doesn't send anything, just add +1 to workcount\n        workcount++\n\n        // print workcount\n        fmt.Println(workcount)\n\n        // wait 1 second before we run this loop again\n        time.Sleep(1 * time.Second)\n    }\n\n    // so workcount is 5, cuz our goroutine will send term signal after 5 seconds\n    fmt.Printf(\"Achieved %v cycles of work before signalled to stop \\n\", workcount)\n</code></pre>\n\n<p>A much cleaner way to solve this issue would be</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    // sends after 5 seconds to this channel https://golang.org/pkg/time/#After\n    timeout := time.After(5 * time.Second)\n\n    // sends each second to this channel https://golang.org/pkg/time/#Tick\n    tick := time.Tick(1 * time.Second)\n\n    // our workcount var\n    workcount := 0\n\n    // for infinite\n    for {\n        // waits for data on each channel\n        select {\n        // fired if time.After wrote in timeout\n        case &lt;-timeout:\n            fmt.Printf(\"Achieved %v cycles of work before signalled to stop \\n\", workcount)\n            return\n        // fired if time.Tick wrote in tick\n        case &lt;-tick:\n            workcount++\n            fmt.Println(workcount)\n        }\n    }\n}\n\n</code></pre>\n\n<p>You run your code in main function so we need to return. We gonna fix this code using return</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    // Our communication channel is created\n    done := make(chan interface{})\n\n    // run this function as goroutine\n    go func() {\n        // wait/sleep 5 seconds\n        time.Sleep(5 * time.Second)\n\n        // close our communication channel\n        close(done)\n    }()\n\n    // initialize workcount with 0\n    workcount := 0\n\n    // loop\n    for {\n        // read channel data\n        select {\n        // if channel is closed break this loop, break = stop!\n        case &lt;-done:\n            fmt.Printf(\"Achieved %v cycles of work before signalled to stop \\n\", workcount)\n            return\n\n        // default do nothing\n        default:\n        }\n\n        // if our channel doesn't send anything, just add +1 to workcount\n        workcount++\n\n        // print workcount\n        fmt.Println(workcount)\n\n        // wait 1 second before we run this loop again\n        time.Sleep(1 * time.Second)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11797530, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rLa31S4_HzA/AAAAAAAAAAI/AAAAAAAAACc/sYFlz8AdTCQ/photo.jpg?sz=128", "display_name": "Bobby", "link": "https://stackoverflow.com/users/11797530/bobby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "closed_date": 1563372536, "accepted_answer_id": 57076160, "answer_count": 1, "score": -4, "last_activity_date": 1563372628, "creation_date": 1563366450, "last_edit_date": 1563372628, "question_id": 57075850, "link": "https://stackoverflow.com/questions/57075850/who-can-explain-the-execution-that-the-done-will-run-after-close", "closed_reason": "Needs details or clarity", "title": "Who can explain the execution that the &lt;-done will run after close", "body": "<p>I can't understand this program <code>for select</code>, so I need help to explain the order of this program,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    done := make(chan interface{})\n    go func() {\n        time.Sleep(5 * time.Second)\n        close(done)\n    }()\n    workcount := 0\nloop:\n    for {\n        select {\n        case &lt;-done:\n            break loop\n        default:\n        }\n        workcount++\n        fmt.Println(workcount)\n        time.Sleep(1 * time.Second)\n    }\n    fmt.Printf(\"Achieved %v cycles of work before signalled to stop \\n\", workcount)\n</code></pre>\n"}, {"tags": ["go", "project", "buffalo"], "comments": [{"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "edited": false, "score": 0, "creation_date": 1563369345, "post_id": 57074693, "comment_id": 100676759, "body": "have you tried <code>setx GO111MODULE &quot;on&quot;</code>? this will set the environment variable to the shell you run, then running the <code>go get -u ...</code> should turn on Go Modules"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563371149, "post_id": 57074693, "comment_id": 100677952, "body": "Alternatively, if the project requires modules, just don&#39;t use GOPATH."}, {"owner": {"reputation": 45, "user_id": 1447294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cfd23f0b2a9085a3a1af5564c60af4e?s=128&d=identicon&r=PG", "display_name": "unclejimbob", "link": "https://stackoverflow.com/users/1447294/unclejimbob"}, "edited": false, "score": 0, "creation_date": 1563447587, "post_id": 57074693, "comment_id": 100707411, "body": "Anzel: setx GO111MODULE &quot;on&quot; Thanks for that, now I get a problem with simply installing buffalo using  &quot;go get -u -v github.com/gobuffalo/buffalo/buffalo&quot; the last message I receive is &quot;go get: error loading module requirements&quot;, tried setting it off same issue. JimB: thanks but I don&#39;t really know what &quot;don&#39;t use GOPATH&quot; entails. Many thanks for trying but what I think I will do is grab a docker image instead"}], "answers": [{"tags": [], "owner": {"reputation": 45, "user_id": 1447294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cfd23f0b2a9085a3a1af5564c60af4e?s=128&d=identicon&r=PG", "display_name": "unclejimbob", "link": "https://stackoverflow.com/users/1447294/unclejimbob"}, "is_accepted": false, "score": 0, "last_activity_date": 1563594249, "creation_date": 1563594249, "answer_id": 57121623, "question_id": 57074693, "link": "https://stackoverflow.com/questions/57074693/generating-a-new-project-in-buffalo-fails-with-go111module-issue/57121623#57121623", "title": "Generating a new project in buffalo fails with GO111MODULE issue", "body": "<p>Started again from scratch, manually uninstalled everything.</p>\n\n<p>Following this:\n<a href=\"https://www.stuartellis.name/articles/windows-golang-setup/\" rel=\"nofollow noreferrer\">https://www.stuartellis.name/articles/windows-golang-setup/</a></p>\n\n<p>I just used scoop to create a default install of all the apps; I knew I wouldn't like the result because it put them all on my C:\\users\\ which is only for my OS</p>\n\n<p>Then I ran <code>buffalo new coke</code> which failed with an error message along the lines of 'you need to be inside GOPATH'</p>\n\n<p>Then I ran <code>buffalo info</code> which gave me all sorts of useful stuff, one of which told me that my PATH needed to match where I was running it from (which I thought was quite clever of it), then light dawned, my path was e:\\dev\\go and I was running it from E:\\dev\\go\\src. Yes, a capitalization issue. Changed my path to 'E:\\dev\\go', reran <code>buffalo info</code> and only got warnings about things I wasn't interested in, ran <code>buffalo new coke</code> and it worked.</p>\n\n<p>Now I'm uninstalling scoop and all my scooped apps, changing my custom path using SCOOP and SCOOP_GLOBAL and then re-installing scoop and all the apps again via scoop.</p>\n\n<p>So, capitalization.</p>\n"}, {"tags": [], "owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "is_accepted": false, "score": 0, "last_activity_date": 1563654829, "creation_date": 1563654829, "answer_id": 57128372, "question_id": 57074693, "link": "https://stackoverflow.com/questions/57074693/generating-a-new-project-in-buffalo-fails-with-go111module-issue/57128372#57128372", "title": "Generating a new project in buffalo fails with GO111MODULE issue", "body": "<pre><code>GO111MODULE=on go get -u -v github.com/gobuffalo/buffalo/buffalo\n</code></pre>\n\n<p><a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules</a> here's all you need to know how work with modules</p>\n"}], "owner": {"reputation": 45, "user_id": 1447294, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6cfd23f0b2a9085a3a1af5564c60af4e?s=128&d=identicon&r=PG", "display_name": "unclejimbob", "link": "https://stackoverflow.com/users/1447294/unclejimbob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 887, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1563654829, "creation_date": 1563362509, "last_edit_date": 1563446616, "question_id": 57074693, "link": "https://stackoverflow.com/questions/57074693/generating-a-new-project-in-buffalo-fails-with-go111module-issue", "title": "Generating a new project in buffalo fails with GO111MODULE issue", "body": "<p>I am trying out buffalo for the first time.</p>\n\n<p>I manually installed the pre-requisites rather than using scoop because I didn't know where scoop would put things:\n<a href=\"https://www.stuartellis.name/articles/windows-golang-setup/#installing-buffalo\" rel=\"nofollow noreferrer\">https://www.stuartellis.name/articles/windows-golang-setup/#installing-buffalo</a></p>\n\n<p>Installed buffalo using this from Powershell and it seemed to work OK:</p>\n\n<pre><code>go get -u -v github.com/gobuffalo/buffalo/buffalo\n</code></pre>\n\n<p>However when I went to generate a new project using this example:\n<a href=\"https://gobuffalo.io/en/docs/getting-started/new-project/\" rel=\"nofollow noreferrer\">https://gobuffalo.io/en/docs/getting-started/new-project/</a></p>\n\n<pre><code>buffalo new coke\n</code></pre>\n\n<p>I receive the following.</p>\n\n<pre><code>DEBU[2019-07-17T20:55:51+10:00] Exec: go mod init coke\ngo: modules disabled inside GOPATH/src by GO111MODULE=auto; see 'go help modules'\n</code></pre>\n\n<p>If anyone has any idea of what the problem is or how I can avoid it please let me know.</p>\n\n<p>I don't know how to set GO111MODULE within Windows and I've googled this issue for the past 2 hours without success including searches on <a href=\"https://gobuffalo.io\" rel=\"nofollow noreferrer\">https://gobuffalo.io</a></p>\n\n<p>I've tried reinstalling buffalo but this didn't help.</p>\n\n<p>My GOPATH is E:\\dev\\go</p>\n\n<p>Here is what I issued in order to create a new buffalo project (and I issued it from the correct folder within GOPATH E:\\dev\\go\\src\\github.com\\):</p>\n\n<pre><code>buffalo new coke\n</code></pre>\n\n<p>Here is the result from issuing 'go env'.</p>\n\n<pre><code>set GOARCH=amd64\nset GOBIN=\nset GOCACHE=C:\\Users\\canto\\AppData\\Local\\go-build\nset GOEXE=.exe\nset GOFLAGS=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=e:\\dev\\go\nset GOPROXY=\nset GORACE=\nset GOROOT=e:\\Go\nset GOTMPDIR=\nset GOTOOLDIR=e:\\Go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset CXX=g++\nset CGO_ENABLED=1\nset GOMOD=\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\nset GOGCCFLAGS=-m64 -mthreads -fmessage-length=0 -fdebug-prefix-map=C:\\Users\\canto\\AppData\\Local\\Temp\\go-build677176826=/tmp/go-build -gno-record-gcc-switches\n</code></pre>\n\n<p>I have successfully created a sample 'coke' buffalo project at work however it fails on my home workstation.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1563357884, "post_id": 57072906, "comment_id": 100670322, "body": "This isn&#39;t a code-writing service. What have you tried? Include your code. What problem are you experiencing?"}, {"owner": {"reputation": 324, "user_id": 5281255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/omXRE.png?s=128&g=1", "display_name": "Norman", "link": "https://stackoverflow.com/users/5281255/norman"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563412567, "post_id": 57072906, "comment_id": 100694601, "body": "@Flimzy I updated the question to include the portion of my code. If you run this in Golang it will still prompt for password and not automatically return the password when prompt due to it being an input in a terminal. Anyway to resolve this?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563432310, "post_id": 57072906, "comment_id": 100699348, "body": "You can either use <code>cmd.StdinPipe</code>, or use a proper <a href=\"https://godoc.org/golang.org/x/crypto/ssh\" rel=\"nofollow noreferrer\">ssh package</a>."}, {"owner": {"reputation": 324, "user_id": 5281255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/omXRE.png?s=128&g=1", "display_name": "Norman", "link": "https://stackoverflow.com/users/5281255/norman"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563438006, "post_id": 57072906, "comment_id": 100702165, "body": "Thanks for the help. But I am currently having an issue expecting a prompt from knife bootstrap command. Do you happen to use it before?"}], "answers": [{"comments": [{"owner": {"reputation": 324, "user_id": 5281255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/omXRE.png?s=128&g=1", "display_name": "Norman", "link": "https://stackoverflow.com/users/5281255/norman"}, "edited": false, "score": 0, "creation_date": 1563412647, "post_id": 57074987, "comment_id": 100694611, "body": "In my case, I am testing out with the ssh command. Anyway to echo the password for input terminal (which the prompt is at)?"}, {"owner": {"reputation": 324, "user_id": 5281255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/omXRE.png?s=128&g=1", "display_name": "Norman", "link": "https://stackoverflow.com/users/5281255/norman"}, "edited": false, "score": 0, "creation_date": 1563420084, "post_id": 57074987, "comment_id": 100695964, "body": "thanks for the suggestion but I found a package that helps to handle Expect inside Golang. You can take a look at <a href=\"https://github.com/google/goexpect\" rel=\"nofollow noreferrer\">github.com/google/goexpect</a> if you are interested."}], "tags": [], "owner": {"reputation": 24, "user_id": 8397295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aaade7d09ad405f445b61238b2c15e78?s=128&d=identicon&r=PG", "display_name": "dchaofei", "link": "https://stackoverflow.com/users/8397295/dchaofei"}, "is_accepted": false, "score": -1, "last_activity_date": 1563363632, "creation_date": 1563363632, "answer_id": 57074987, "question_id": 57072906, "link": "https://stackoverflow.com/questions/57072906/automatically-input-defined-password-when-shell-prompts/57074987#57074987", "title": "Automatically input defined password when shell prompts?", "body": "<p>I think you need use <code>sudo -S</code>.</p>\n\n<blockquote>\n  <p>echo password | sudo -S vim a.txt</p>\n</blockquote>\n"}], "owner": {"reputation": 324, "user_id": 5281255, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/omXRE.png?s=128&g=1", "display_name": "Norman", "link": "https://stackoverflow.com/users/5281255/norman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1563437803, "creation_date": 1563356467, "last_edit_date": 1563437803, "question_id": 57072906, "link": "https://stackoverflow.com/questions/57072906/automatically-input-defined-password-when-shell-prompts", "title": "Automatically input defined password when shell prompts?", "body": "<p>I am writing a Golang application which will run some bash scripts. In one of the commands the script will run as sudo and it would require me to enter a password manually.</p>\n\n<p>May I know how to achieve sending of password automatically?</p>\n\n<pre><code>cmd := exec.Command(\"/bin/sh\", \"-c\", \"knife bootstrap xxx.xxx.xxx.xxx -x user_name --sudo -i ~/.ssh/id_rsa.pub --node-name node_name -P password -c ~/chef-repo/.chef/config.rb\")\n\nstdin, err := cmd.StdinPipe()\nif err != nil {\n    log.Panic(err)\n}\n\ngo func() {\n    defer stdin.Close()\n    io.WriteString(stdin, \"password\")\n}()\n</code></pre>\n\n<p>I am currently stuck at the step when knife bootstrap will prompt the following for a password over at the chef client side.</p>\n\n<pre><code>user_name@xxx.xxx.xxx.xxx's password:\n</code></pre>\n\n<p>I couldn't use expect to capture this string and provide the password, it seems to be different from the usual strings that will output in the terminal.</p>\n"}, {"tags": ["function", "go", "input", "struct", "types"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1563354046, "post_id": 57072069, "comment_id": 100668059, "body": "There are no &quot;child&quot; or &quot;parent&quot; structs in Go. What you have are distinct types, with no parent/child relationships."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563354113, "post_id": 57072069, "comment_id": 100668088, "body": "The proper approach to your problem is to use an interface (not an empty one). Perhaps <code>interface Poly { Value() []*ring.Poly }</code>. Then have your function accept that interface."}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 9770401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a560becfea6f4dc084d14f424344cfee?s=128&d=identicon&r=PG&f=1", "display_name": "Pro7ech", "link": "https://stackoverflow.com/users/9770401/pro7ech"}, "edited": false, "score": 0, "creation_date": 1563355049, "post_id": 57072272, "comment_id": 100668643, "body": "Thank you. But where do the Ciphertext and Plaintext type fit in? I would still like to be able to differentiate between them."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 9, "user_id": 9770401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a560becfea6f4dc084d14f424344cfee?s=128&d=identicon&r=PG&f=1", "display_name": "Pro7ech", "link": "https://stackoverflow.com/users/9770401/pro7ech"}, "edited": false, "score": 0, "creation_date": 1563355638, "post_id": 57072272, "comment_id": 100669039, "body": "You can still use them. Just make sure they satisfy the interface."}, {"owner": {"reputation": 9, "user_id": 9770401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a560becfea6f4dc084d14f424344cfee?s=128&d=identicon&r=PG&f=1", "display_name": "Pro7ech", "link": "https://stackoverflow.com/users/9770401/pro7ech"}, "edited": false, "score": 0, "creation_date": 1563356232, "post_id": 57072272, "comment_id": 100669382, "body": "Yes right, my bad, it works well, thank you very much."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1563354332, "creation_date": 1563354332, "answer_id": 57072272, "question_id": 57072069, "link": "https://stackoverflow.com/questions/57072069/struct-embeding-function-inputs-polymorphism/57072272#57072272", "title": "struct embeding, function inputs, polymorphism", "body": "<p>Use a non-empty interface:</p>\n\n<pre><code>type Poly interface {\n    Value() []*ring.Poly\n}\n</code></pre>\n\n<p>Then define your struct as:</p>\n\n<pre><code>type BigPoly struct{\n    value []*ring.Poly\n}\n\nfunc (p *BigPoly) Value() []*ring.Poly {\n    return p.value\n}\n</code></pre>\n\n<p>And your consumer as:</p>\n\n<pre><code>func Add(a, b Poly) Poly {\n    aValue := a.Value()\n    bValue := b.Value()\n    // ... do something with aValue and bValue\n}\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 9770401, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a560becfea6f4dc084d14f424344cfee?s=128&d=identicon&r=PG&f=1", "display_name": "Pro7ech", "link": "https://stackoverflow.com/users/9770401/pro7ech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1563354332, "creation_date": 1563353656, "last_edit_date": 1563354016, "question_id": 57072069, "link": "https://stackoverflow.com/questions/57072069/struct-embeding-function-inputs-polymorphism", "title": "struct embeding, function inputs, polymorphism", "body": "<p>I have a parent struct :</p>\n\n<pre><code>type BigPoly struct{\n    Value []*ring.Poly\n}\n</code></pre>\n\n<p>And two child structs :</p>\n\n<pre><code>type Plaintext BigPoly\ntype Ciphertext BigPoly\n</code></pre>\n\n<p>I would like to have functions accepting both Plaintext and Ciphertext. My solution is to use a function of the form :</p>\n\n<pre><code>func Add(a *Ciphertext, b interface{}) (*Ciphertext)\n</code></pre>\n\n<p>and use a switch-case to decide what to do, but I find it troublesome and it can lead to very complicated cases if the number of inputs grows.</p>\n\n<p>However since Plaintext and Ciphertext have exactly the same structure and internal variables and only differ in their name, is it possible to create a function accepting both Plaintext and Ciphertext in a cleaner way ? I.e. it doesn't care if it is a type Plaintext or Ciphertext, as long as it is a type BigPoly.</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563354013, "post_id": 57070856, "comment_id": 100668043, "body": "<code>LoadClientStateMiddleware</code> is not only declared outside of your package, it is also a method not a type, you cannot define new methods on any of those. What you need to do is to write your own wrapper that takes a value whose type matches that of the method&#39;s signature, i.e. <code>func(http.Handler) http.Handler</code> and then have your wrapper return a value of type that&#39;s accepted by <code>Use</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1563354377, "post_id": 57070856, "comment_id": 100668242, "body": "... here&#39;s one such example: <a href=\"https://godoc.org/github.com/gwatts/gin-adapter#Wrap\" rel=\"nofollow noreferrer\">godoc.org/github.com/gwatts/gin-adapter#Wrap</a>"}], "owner": {"reputation": 175, "user_id": 5477548, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-u_GWgGl3A68/AAAAAAAAAAI/AAAAAAAAAF4/GqN9bcsoapY/photo.jpg?sz=128", "display_name": "yoad w", "link": "https://stackoverflow.com/users/5477548/yoad-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 281, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563356891, "creation_date": 1563349286, "last_edit_date": 1563356891, "question_id": 57070856, "link": "https://stackoverflow.com/questions/57070856/function-not-implementing-interface", "title": "function not implementing interface?", "body": "<p>I am trying to define middleware for Gin's router. The middleware is authboss's.\nI'm pretty sure my issue is me not understanding fully how golang's interface implementation works.\nI know that if struct S implements all of the methods of interface I, then we say S implements I (and also has its type).</p>\n\n<p>However in this specific issue, it seems go requires my <strong>function</strong> to implement an interface, rather than struct as usual. I am using <em>authboss</em> package for authentication.</p>\n\n<ul>\n<li><code>\"github.com/volatiletech/authboss\"</code></li>\n<li><code>router.Use(middleware ...HandlerFunc)</code> (router is of a type which has an embedded field <code>*gin.Engine</code>) </li>\n<li><code>gin.WrapH (h http.Handler) HandlerFunc</code></li>\n<li><code>func (a *Authboss) LoadClientStateMiddleware(h http.Handler) http.Handler</code></li>\n<li><code>ab:= authboss.New()</code></li>\n</ul>\n\n<p>all together:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>router.Use(gin.WrapH(ab.LoadClientStateMiddleware))\n</code></pre>\n\n<p>The error I am getting is: </p>\n\n<blockquote>\n  <p>cannot use ab.LoadClientStateMiddleware (type func(http.Handler) http.Handler) as type http.Handler in argument to gin.WrapH:\n      func(http.Handler) http.Handler does not implement http.Handler (missing ServeHTTP method)</p>\n</blockquote>\n\n<p>The way I read the error is, <em>'please make a function with <code>ab.middleware</code> as receiver and implement ServeHttp'</em>, but can a function be a receiver?</p>\n\n<pre><code>func (ab *authboss.LoadClientStateMiddleware) ServeHttp (){ \n}\n</code></pre>\n\n<p><strong>EDIT:</strong><br>\nAs Suggested bellow by @mkopriva, there is a package called <a href=\"https://godoc.org/github.com/gwatts/gin-adapter#Wrap\" rel=\"nofollow noreferrer\">a \"gin-adapter\"</a> that does exactly the wrapping I needed.<br></p>\n"}, {"tags": ["go", "datatables"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1563349183, "post_id": 57070797, "comment_id": 100665521, "body": "<i>&quot;I have tried following, but not sure&quot;</i> What was the result? What did you expect to happen?"}, {"owner": {"reputation": 3, "user_id": 8366220, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_p1NtyMFXk0/AAAAAAAAAAI/AAAAAAAAAAs/6INulcKgpLA/photo.jpg?sz=128", "display_name": "SAM Temp", "link": "https://stackoverflow.com/users/8366220/sam-temp"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563349379, "post_id": 57070797, "comment_id": 100665628, "body": "I am expecting the values that can be found from $_REQUEST (in php). So I need the golang gin edition of $_REQUEST to read the values. @icza"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 1, "last_activity_date": 1563368316, "last_edit_date": 1563368316, "creation_date": 1563353203, "answer_id": 57071945, "question_id": 57070797, "link": "https://stackoverflow.com/questions/57070797/what-is-equivalent-of-php-request-in-golang/57071945#57071945", "title": "What is equivalent of php $_REQUEST in golang?", "body": "<ol>\n<li><p>Stop thinking about <code>$_REQUEST</code>. Simply forget it exists. There is luckily no such thing in Go (for various reasons), and will never be.</p></li>\n<li><p>Read the docs; figure out that <code>c.Request</code> <a href=\"https://github.com/gin-gonic/gin/blob/f98b339b773105aad77f321d0baaa30475bf875d/context.go#L45\" rel=\"nofollow noreferrer\">is actually a\n<code>http.Request</code></a>.</p></li>\n<li><p>Read <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\">its docs</a>,\nfigure out its <code>Form</code> field is an <code>url.Values</code>.</p></li>\n<li><p>Read <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\">its docs</a>, figure out it's a map of keys which are names of query parameters to slices of the arguments of these parameters.</p></li>\n<li><p>Armed with that knowledge, in your request processing code, dump the whole contents of the <code>c.Request.Form</code> somewhere (that depends on how you run your server \u2014 if you fire it off right in a terminal for testing, then a simple <code>log.Print(c.Request.Form)</code> will suffice).</p>\n\n<p>Study what's there.</p></li>\n<li><p>Work from there.</p></li>\n</ol>\n"}], "owner": {"reputation": 3, "user_id": 8366220, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_p1NtyMFXk0/AAAAAAAAAAI/AAAAAAAAAAs/6INulcKgpLA/photo.jpg?sz=128", "display_name": "SAM Temp", "link": "https://stackoverflow.com/users/8366220/sam-temp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 57071945, "answer_count": 1, "score": -4, "last_activity_date": 1563368316, "creation_date": 1563349053, "question_id": 57070797, "link": "https://stackoverflow.com/questions/57070797/what-is-equivalent-of-php-request-in-golang", "title": "What is equivalent of php $_REQUEST in golang?", "body": "<p>I am trying to implement datatables server-side-processing in golang with gin framework. I have my resource in php. I want to convert it into golang gin. Need a little help.</p>\n\n<pre class=\"lang-php prettyprint-override\"><code>// php codes\n$params = $_REQUEST;\n$draw = $params[\"draw\"];\n$orderColumn = $params['order'][0]['column'];\n$sortColumnDir = $params['order'][0]['dir'];\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// golang gin codes\n// no idea what to do to get $_REQUEST as in php\n// $params = $_REQUEST; // here what will be go code in gin ?\n// I have tried following, but not sure\ndraw := c.Request.Form.Get(\"draw\")\norderColumn := c.Request.Form.Get(\"order[0][column]\")\nsortColumnDir := c.Request.Form.Get(\"order[0][dir]\")\n</code></pre>\n"}, {"tags": ["xml", "go", "xml-parsing"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1563354299, "post_id": 57070542, "comment_id": 100668196, "body": "Try adding the <code>xml:&quot;Donnees_Courbe&quot;</code> tag directly to the <code>DonneeCDC []flowDataCDC</code> field."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1563354372, "post_id": 57070542, "comment_id": 100668238, "body": "How should I do that ? DonneeCDC already has a XMLName"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1563354812, "post_id": 57070542, "comment_id": 100668504, "body": "I mean, it is already in XMLName, I don&#39;t see how can I add it. Please forgive my ignorance, I have not been coding in go since a long time"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1563356484, "post_id": 57070542, "comment_id": 100669518, "body": "I could make it work. Please put it as answer ! I added xml:&quot;Donnees_Courbe&quot; at the end of the line in flowBody"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1563357773, "post_id": 57070542, "comment_id": 100670254, "body": "That&#39;s precisely what is meant by &quot;to add a tag&quot; \u2014 see the closing paragraph <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">of this section of the <code>ref&#47;spec</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 0, "last_activity_date": 1563368257, "last_edit_date": 1563368257, "creation_date": 1563357944, "answer_id": 57073399, "question_id": 57070542, "link": "https://stackoverflow.com/questions/57070542/parsing-a-xml-file-with-go-has-a-strange-behaviour/57073399#57073399", "title": "Parsing a XML file with Go has a strange behaviour", "body": "<p>Adding the struct tag to the field containing the slice should work:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type flowBody struct {\n    XMLName   xml.Name      `xml:\"Corps\"`\n    PRM       string        `xml:\"Identifiant\"`\n    DonneeCDC []flowDataCDC `xml:\"Donnees_Courbe\"` // tag added\n}\n\ntype flowDataCDC struct {\n    XMLName       xml.Name           `xml:\"Donnees_Courbe\"` // this may be removed.\n    HorodateDebut time.Time          `xml:\"Horodatage_Debut\"`\n    HorodateFin   time.Time          `xml:\"Horodatage_Fin\"`\n    Granularite   uint32             `xml:\"Granularite\"`\n    Unite         string             `xml:\"Unite_Mesure\"`\n    GrdMetier     string             `xml:\"Grandeur_Metier\"`\n    GrdPhysique   string             `xml:\"Grandeur_Physique\"`\n    Donnes        []flowMeasurePoint `xml:\"Donnees_Point_Mesure\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 57073399, "answer_count": 1, "score": 0, "last_activity_date": 1563368257, "creation_date": 1563348044, "question_id": 57070542, "link": "https://stackoverflow.com/questions/57070542/parsing-a-xml-file-with-go-has-a-strange-behaviour", "title": "Parsing a XML file with Go has a strange behaviour", "body": "<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;Courbe&gt;\n  &lt;Entete&gt;\n    &lt;Identifiant_Flux&gt;RD&lt;/Identifiant_Flux&gt;\n    &lt;Libelle_Flux&gt;@@@&lt;/Libelle_Flux&gt;\n    &lt;Identifiant_Emetteur&gt;xxx&lt;/Identifiant_Emetteur&gt;\n    &lt;Identifiant_Destinataire&gt;1000000&lt;/Identifiant_Destinataire&gt;\n    &lt;Date_Creation&gt;2010-08-02T05:10:05+02:00&lt;/Date_Creation&gt;\n    &lt;Frequence_Publication&gt;Q&lt;/Frequence_Publication&gt;\n    &lt;Reference_Demande&gt;123456&lt;/Reference_Demande&gt;\n    &lt;Nature_De_Courbe_Demandee&gt;Brute&lt;/Nature_De_Courbe_Demandee&gt;\n  &lt;/Entete&gt;\n&lt;Corps&gt;\n  &lt;Identifiant&gt;30000000000&lt;/Identifiant&gt;\n  &lt;Donnees_Courbe&gt;\n    &lt;Horodatage_Debut&gt;2010-08-02T00:00:00+02:00&lt;/Horodatage_Debut&gt;\n    &lt;Horodatage_Fin&gt;2010-08-02T23:59:59+02:00&lt;/Horodatage_Fin&gt;\n    &lt;Granularite&gt;10&lt;/Granularite&gt;\n    &lt;Unite_Mesure&gt;kW&lt;/Unite_Mesure&gt;\n    &lt;Grandeur_Metier&gt;CONS&lt;/Grandeur_Metier&gt;\n    &lt;Grandeur_Physique&gt;EA&lt;/Grandeur_Physique&gt;\n    &lt;Donnees_Point_Mesure Horodatage =\"2010-08-02T00:00:00+02:00\" Valeur_Point =\"10\" Statut_Point =\"R\"&gt;&lt;/Donnees_Point_Mesure&gt;\n    &lt;Donnees_Point_Mesure Horodatage =\"2010-08-02T00:10:00+02:00\" Valeur_Point =\"10\" Statut_Point =\"R\"&gt;&lt;/Donnees_Point_Mesure&gt;\n    &lt;Donnees_Point_Mesure Horodatage =\"2010-08-02T00:20:00+02:00\" Valeur_Point =\"10\" Statut_Point =\"R\"&gt;&lt;/Donnees_Point_Mesure&gt;\n  &lt;/Donnees_Courbe&gt;\n  &lt;Donnees_Courbe&gt;\n    &lt;Horodatage_Debut&gt;2010-08-02T00:00:00+02:00&lt;/Horodatage_Debut&gt;\n    &lt;Horodatage_Fin&gt;2010-08-02T23:59:59+02:00&lt;/Horodatage_Fin&gt;\n    &lt;Granularite&gt;10&lt;/Granularite&gt;\n    &lt;Unite_Mesure&gt;kVAr&lt;/Unite_Mesure&gt;\n    &lt;Grandeur_Metier&gt;CONS&lt;/Grandeur_Metier&gt;\n    &lt;Grandeur_Physique&gt;ERI&lt;/Grandeur_Physique&gt;\n    &lt;Donnees_Point_Mesure Horodatage =\"2010-08-02T00:00:00+02:00\" Valeur_Point =\"6\" Statut_Point =\"R\"&gt;&lt;/Donnees_Point_Mesure&gt;\n    &lt;Donnees_Point_Mesure Horodatage =\"2010-08-02T00:10:00+02:00\" Valeur_Point =\"5\" Statut_Point =\"R\"&gt;&lt;/Donnees_Point_Mesure&gt;\n  &lt;/Donnees_Courbe&gt;\n&lt;/Corps&gt;\n&lt;/Courbe&gt;\n</code></pre>\n\n<p>Here are the structures I use to parse it.    </p>\n\n<pre><code>type Flow struct {\n    XMLName    xml.Name `xml:\"Courbe\"`\n    PathToFile string\n    Entete     flowHeader\n    Corp       flowBody\n}\n\n\ntype flowHeader struct {\n    XMLName         xml.Name  `xml:\"Entete\"`\n    IDFlux          string    `xml:\"Identifiant_Flux\"`\n    LabelFlux       string    `xml:\"Libelle_Flux\"`\n    IDEmetteur      string    `xml:\"Identifiant_Emetteur\"`\n    IDDestinataire  uint32    `xml:\"Identifiant_Destinataire\"`\n    DateCreation    time.Time `xml:\"Date_Creation\"`\n    FreqPublication string    `xml:\"Frequence_Publication\"`\n    RefDemande      uint32    `xml:\"Reference_Demande\"`\n    NatureCourbe    string    `xml:\"Nature_De_Courbe_Demandee\"`\n}\n\ntype flowBody struct {\n    XMLName   xml.Name `xml:\"Corps\"`\n    PRM       string   `xml:\"Identifiant\"`\n    DonneeCDC flowDataCDC\n}\n\ntype flowDataCDC struct {\n    XMLName       xml.Name                    `xml:\"Donnees_Courbe\"`\n    HorodateDebut time.Time                   `xml:\"Horodatage_Debut\"`\n    HorodateFin   time.Time                   `xml:\"Horodatage_Fin\"`\n    Granularite   uint32                      `xml:\"Granularite\"`\n    Unite         string                      `xml:\"Unite_Mesure\"`\n    GrdMetier     string                      `xml:\"Grandeur_Metier\"`\n    GrdPhysique   string                      `xml:\"Grandeur_Physique\"`\n    Donnes        []flowMeasurePoint `xml:\"Donnees_Point_Mesure\"`\n}\n</code></pre>\n\n<p>Initially, I had only 1 <code>Donnees_Courbe</code>, so it was OK. Now, I have 2 ( Only the first one is important to me, I want to ignore the second one )</p>\n\n<p>Thing is, in the <code>flowBody</code> struct, I change the last field to an array:</p>\n\n<pre><code>type flowBody struct {\n    XMLName   xml.Name `xml:\"Corps\"`\n    PRM       string   `xml:\"Identifiant\"`\n    DonneeCDC []flowDataCDC\n}\n</code></pre>\n\n<p>but it doesnt work, my data is nil.</p>\n\n<p>If I let it without an <code>DonneeCDC</code> array, it will parse my file, but it says that all my data has <code>Unite_Mesure=kVAr</code>, which is obviously not what I want.</p>\n\n<p>How should I parse it well ?</p>\n"}, {"tags": ["go", "reflection", "reflect"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1563345835, "post_id": 57069869, "comment_id": 100663712, "body": "<a href=\"https://play.golang.org/p/6iioGliwgZM\" rel=\"nofollow noreferrer\">play.golang.org/p/6iioGliwgZM</a> <code>A</code> is unaddressable because you&#39;re passing a non pointer in as interface. Your <code>va.CanAddr()</code> returns true because it&#39;s looking at the element of the addressable slice, not the value contained inside that element."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563345839, "post_id": 57069869, "comment_id": 100663716, "body": "use a type assertion, as normal."}, {"owner": {"reputation": 3123, "user_id": 7803527, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bskeA.jpg?s=128&g=1", "display_name": "Dean Xu", "link": "https://stackoverflow.com/users/7803527/dean-xu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563346741, "post_id": 57069869, "comment_id": 100664159, "body": "@Flimzy Unfortunatly, I don&#39;t know the struct type."}, {"owner": {"reputation": 3123, "user_id": 7803527, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bskeA.jpg?s=128&g=1", "display_name": "Dean Xu", "link": "https://stackoverflow.com/users/7803527/dean-xu"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563347080, "post_id": 57069869, "comment_id": 100664330, "body": "@mkopriva Do you mean if the element is a value, I can&#39;t update it? But if the slice is <code>[]A</code>, I can do it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563347110, "post_id": 57069869, "comment_id": 100664353, "body": "Ah, that&#39;s not clear from your question."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1563349876, "post_id": 57069869, "comment_id": 100665876, "body": "@DeanXu from the <a href=\"https://golang.org/pkg/reflect/#Value.CanAddr\" rel=\"nofollow noreferrer\">docs</a>: <i>&quot;A value is addressable if it is an element of a slice, an element of an addressable array, a field of an addressable struct, or the result of dereferencing a pointer.&quot;</i> So what is addressable in your example code is the interface element of a slice, not the value stored in the interface. By design non-pointer values stored in interface variables are not addressable even if the interface variable itself is addressable."}], "owner": {"reputation": 3123, "user_id": 7803527, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/bskeA.jpg?s=128&g=1", "display_name": "Dean Xu", "link": "https://stackoverflow.com/users/7803527/dean-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563345465, "creation_date": 1563345465, "question_id": 57069869, "link": "https://stackoverflow.com/questions/57069869/how-to-set-field-of-interface", "title": "How to set field of interface?", "body": "<p>I have a slice <code>[]interface{}</code> and there is struct value in it.</p>\n\n<p>When I try to reflect the slice's element to update the struct's field. I got following error </p>\n\n<blockquote>\n  <p>panic: reflect: reflect.Value.SetInt using unaddressable value</p>\n</blockquote>\n\n<p>Minimize code here:</p>\n\n<p><a href=\"https://play.golang.org/p/VOycEtG2Nq5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VOycEtG2Nq5</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype A struct {\n    B int\n}\n\nfunc main() {\n    array := []interface{}{A{1}}\n    v := reflect.ValueOf(&amp;array)\n    va := v.Elem().Index(0)\n    fmt.Println(va.Kind() == reflect.Interface) // true\n    fmt.Println(va.CanAddr()) // true\n    f := va.Elem().Field(0)\n    f.SetInt(2)\n    fmt.Println(array)\n}\n</code></pre>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1563340993, "post_id": 57068922, "comment_id": 100661947, "body": "The use of $name is correct.  The problem is that <code>.</code> is a string.  A string cannot be indexed  by <code>Tr</code>."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1563342639, "post_id": 57068922, "comment_id": 100662507, "body": "what is your userlist pipe? can you describe your userlist? is it []string only?"}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563343963, "post_id": 57068922, "comment_id": 100662977, "body": "@CeriseLim&#243;n the op specified the <code>Tr</code> as a func. So he can do this, i suppose."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1563345008, "post_id": 57068922, "comment_id": 100663370, "body": "The dot value is an element of userlist.  Did you intend to refer the Tr field of the root value passed to the template?   If so, use $.Tr.   Show the Go code."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563345500, "post_id": 57068922, "comment_id": 100663564, "body": "@CeriseLim&#243;n if that&#39;s the fact, then the 1st try of the question wouldn&#39;t a success."}, {"owner": {"reputation": 1, "user_id": 11795473, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YzOI0bUoEtA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rflm5c6rgR1Lmyz9gQpTDDx34ly7g/photo.jpg?sz=128", "display_name": "Joy chen", "link": "https://stackoverflow.com/users/11795473/joy-chen"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563346639, "post_id": 57068922, "comment_id": 100664103, "body": "thank @Cerise Lim&#243;n Enthusiastic answer\uff0clike you say , it need $.Tr , now it work !!!"}, {"owner": {"reputation": 1, "user_id": 11795473, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YzOI0bUoEtA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rflm5c6rgR1Lmyz9gQpTDDx34ly7g/photo.jpg?sz=128", "display_name": "Joy chen", "link": "https://stackoverflow.com/users/11795473/joy-chen"}, "reply_to_user": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1563346680, "post_id": 57068922, "comment_id": 100664124, "body": "thank @Shudipta Sharma Enthusiastic answer too, it is my fault , Actually,1st it not work too..."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1563355214, "post_id": 57068922, "comment_id": 100668753, "body": "then it&#39;s ok since it is working"}], "owner": {"reputation": 1, "user_id": 11795473, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-YzOI0bUoEtA/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rflm5c6rgR1Lmyz9gQpTDDx34ly7g/photo.jpg?sz=128", "display_name": "Joy chen", "link": "https://stackoverflow.com/users/11795473/joy-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563340564, "creation_date": 1563340564, "question_id": 57068922, "link": "https://stackoverflow.com/questions/57068922/how-can-i-use-variable-in-go-template-call", "title": "How can I use $variable in go template call", "body": "<p>i use the go template </p>\n\n<p>it work:</p>\n\n<pre><code>{{range $k, $name := .userList}}\n    &lt;tr&gt;\n        &lt;a href=\"/?id={{$k}}\"&gt;{{call .Tr \"hey\"}}&lt;/a&gt;\n    &lt;/tr&gt;\n{{end}}\n</code></pre>\n\n<p>it not work: \nget the err : at &lt;.Tr>: can't evaluate field Tr in type string</p>\n\n<pre><code>{{range $k, $name := .userList}}\n    &lt;tr&gt;\n        &lt;a href=\"/?id={{$k}}\"&gt;{{call .Tr $name}}&lt;/a&gt;\n    &lt;/tr&gt;\n{{end}}\n</code></pre>\n\n<p>i want use $name for the Tr func , how can i do ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1563342274, "post_id": 57068884, "comment_id": 100662395, "body": "You did not export your function (make it accessible outside your package), hence it is not covered by Godoc."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1563340697, "creation_date": 1563340697, "answer_id": 57068938, "question_id": 57068884, "link": "https://stackoverflow.com/questions/57068884/how-to-generate-documentation-with-godoc-correctly/57068938#57068938", "title": "How to generate documentation with godoc correctly?", "body": "<p>Use the -u flag to show <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">unexported</a> symbols: <code>go doc -u ./test</code></p>\n"}], "owner": {"reputation": 151, "user_id": 11795428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oOW8v.png?s=128&g=1", "display_name": "unicorns4re4live", "link": "https://stackoverflow.com/users/11795428/unicorns4re4live"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1563340697, "creation_date": 1563340256, "question_id": 57068884, "link": "https://stackoverflow.com/questions/57068884/how-to-generate-documentation-with-godoc-correctly", "title": "How to generate documentation with godoc correctly?", "body": "<p>Here is my code and terminal window. What should I do to make it work well and return function description?</p>\n\n<pre><code>// Copyright DOCUMENTATION FOR ME. All rights reserved.\n// Use of this source code is governed by a BSD-style\n// license that can be found in the LICENSE file.\npackage testDoc\n\n// sayHello return \"Hello world string\"\nfunc sayHello() string{\n    return \"Hello world!\"\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/JGFk3.png\" rel=\"nofollow noreferrer\">terminal return</a></p>\n"}, {"tags": ["go", "winapi"], "answers": [{"tags": [], "owner": {"reputation": 126, "user_id": 10887989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/231b9b3e837309154c6b7e96c7a7f263?s=128&d=identicon&r=PG&f=1", "display_name": "TimeLoad", "link": "https://stackoverflow.com/users/10887989/timeload"}, "is_accepted": true, "score": 0, "last_activity_date": 1563343080, "creation_date": 1563343080, "answer_id": 57069360, "question_id": 57068772, "link": "https://stackoverflow.com/questions/57068772/unexpected-fault-address-when-calling-enumprocessmodules/57069360#57069360", "title": "&#39;unexpected fault address&#39; When Calling EnumProcessModules", "body": "<p>I figured out the issue. I was interacting with the <code>EnumProcessModules</code> incorrectly. Here's a working function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func getBaseAddress(handle uintptr) int64 {\n    // GetProcessImageFileNameA\n    var imageFileName [200]byte\n    var fileSize uint32 = 200\n    var fileName string\n\n    ret, _, _ := procGetProcessImageFileNameA.Call(handle, uintptr(unsafe.Pointer(&amp;imageFileName)), uintptr(fileSize))\n\n    for _, char := range imageFileName {\n        if char == 0 {\n            break\n        }\n\n        fileName += string(char)\n    }\n\n    fileName = fileName[24:]\n\n    // EnumProcessModules\n    moduleHandles := make([]uintptr, 1024)\n    var needed int32\n    const handleSize = unsafe.Sizeof(moduleHandles[0])\n\n    ret, _, _ = procEnumProcessModules.Call(uintptr(handle), uintptr(unsafe.Pointer(&amp;moduleHandles[0])), handleSize*uintptr(len(moduleHandles)), uintptr(unsafe.Pointer(&amp;needed)))\n\n    // GetModuleFileNameExA\n    var finalModuleHandle uintptr\n\n    for _, moduleHandle := range moduleHandles {\n        if moduleHandle &gt; 0 {\n            var moduleFileName [200]byte\n            var moduleSize uint32 = 200\n            var moduleName string\n\n            ret, _, _ = procGetModuleFileNameExA.Call(handle, uintptr(moduleHandle), uintptr(unsafe.Pointer(&amp;moduleFileName)), uintptr(moduleSize))\n\n            if ret != 0 {\n                for _, char := range moduleFileName {\n                    if char == 0 {\n                        break\n                    }\n\n                    moduleName += string(char)\n                }\n\n                moduleName = moduleName[3:]\n\n                if moduleName == fileName {\n                    finalModuleHandle = uintptr(moduleHandle)\n                    break\n                }\n            }\n        }\n    }\n\n    return int64(finalModuleHandle)\n}\n</code></pre>\n\n<p>I hope this can help someone, I spent a lot of time working on this function.</p>\n"}, {"comments": [{"owner": {"reputation": 126, "user_id": 10887989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/231b9b3e837309154c6b7e96c7a7f263?s=128&d=identicon&r=PG&f=1", "display_name": "TimeLoad", "link": "https://stackoverflow.com/users/10887989/timeload"}, "edited": false, "score": 0, "creation_date": 1563406516, "post_id": 57069734, "comment_id": 100693499, "body": "Thanks for the response. I figured out what I was doing wrong eventually, I was calling EnumProcessModules wrong and passing the pointer to the array incorrectly."}], "tags": [], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "is_accepted": false, "score": 1, "last_activity_date": 1563344902, "creation_date": 1563344902, "answer_id": 57069734, "question_id": 57068772, "link": "https://stackoverflow.com/questions/57068772/unexpected-fault-address-when-calling-enumprocessmodules/57069734#57069734", "title": "&#39;unexpected fault address&#39; When Calling EnumProcessModules", "body": "<p>The 2nd parameter to <code>EnumProcessModules</code> cannot be a null pointer (0) even if you are just trying to determine the number of entries needed.</p>\n"}], "owner": {"reputation": 126, "user_id": 10887989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/231b9b3e837309154c6b7e96c7a7f263?s=128&d=identicon&r=PG&f=1", "display_name": "TimeLoad", "link": "https://stackoverflow.com/users/10887989/timeload"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 57069360, "answer_count": 2, "score": 0, "last_activity_date": 1563344902, "creation_date": 1563339565, "question_id": 57068772, "link": "https://stackoverflow.com/questions/57068772/unexpected-fault-address-when-calling-enumprocessmodules", "title": "&#39;unexpected fault address&#39; When Calling EnumProcessModules", "body": "<p>I am writing a function that enumerates the base address of a process. This is done through a few Windows API calls, however, I believe it's my call to <code>EnumProcessModules</code> that is creating the error.</p>\n\n<p>It should also be noted that this error does not occur for every process.</p>\n\n<p>I have already tried changing around some of the uint32 to uint64 and vice versa, and different ways of creating the <code>moduleHandles</code> array, but I can't get anything working.</p>\n\n<p>This is just one function in an application I'm creating to retrieve and scan another process's memory.</p>\n\n<p>This is the source code of my function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func getBaseAddress(handle uintptr) int64 {\n    // GetProcessImageFileNameA\n    var imageFileName [200]byte\n    var fileSize uint32 = 200\n    var fileName string\n\n    ret, _, _ := procGetProcessImageFileNameA.Call(handle, uintptr(unsafe.Pointer(&amp;imageFileName)), uintptr(fileSize))\n\n    for _, char := range imageFileName {\n        if char == 0 {\n            break\n        }\n\n        fileName += string(char)\n    }\n\n    fileName = fileName[24:]\n\n    // EnumProcessModules\n    var n uint32\n    var needed uint64\n\n    ret, _, _ = procEnumProcessModules.Call(handle, 0, uintptr(n), uintptr(unsafe.Pointer(&amp;needed)))\n\n    moduleHandles := make([]syscall.Handle, int(needed))\n\n    if ret == 1 &amp;&amp; needed &gt; 0 {\n        ret, _, _ = procEnumProcessModules.Call(handle, uintptr(unsafe.Pointer(&amp;moduleHandles)), uintptr(needed), uintptr(unsafe.Pointer(&amp;needed)))\n    }\n\n    // GetModuleFileNameExA\n    var finalModuleHandle uintptr\n\n    for _, moduleHandle := range moduleHandles {\n        if moduleHandle &gt; 0 {\n            var moduleFileName [200]byte\n            var moduleSize uint32 = 200\n            var moduleName string\n\n            ret, _, _ = procGetModuleFileNameExA.Call(handle, uintptr(moduleHandle), uintptr(unsafe.Pointer(&amp;moduleFileName)), uintptr(moduleSize))\n\n            if ret != 0 {\n                for _, char := range moduleFileName {\n                    if char == 0 {\n                        break\n                    }\n\n                    moduleName += string(char)\n                }\n\n                moduleName = moduleName[3:]\n\n                if moduleName == fileName {\n                    finalModuleHandle = uintptr(moduleHandle)\n                    break\n                }\n            }\n        }\n    }\n\n    return int64(finalModuleHandle)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 16, "user_id": 11795549, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/b3367b3237a735a9bd3a85ac1888a41e?s=128&d=identicon&r=PG", "display_name": "nooryvom", "link": "https://stackoverflow.com/users/11795549/nooryvom"}, "is_accepted": true, "score": 0, "last_activity_date": 1563340072, "creation_date": 1563340072, "answer_id": 57068852, "question_id": 57068707, "link": "https://stackoverflow.com/questions/57068707/how-to-add-a-map-interface-in-a-another-map-interface/57068852#57068852", "title": "How to add a map interface in a another map interface?", "body": "<p><a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">Assert</a> the <code>interface{}</code> value to a <code>map[string]interface{}</code> and index that.</p>\n\n<pre><code>message[\"key2\"].(map[string]interface{})[\"k4\"] = k\n</code></pre>\n"}], "owner": {"reputation": 265, "user_id": 3252512, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwYZS.jpg?s=128&g=1", "display_name": "sutirtha", "link": "https://stackoverflow.com/users/3252512/sutirtha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 57068852, "answer_count": 1, "score": -1, "last_activity_date": 1563340072, "creation_date": 1563339083, "question_id": 57068707, "link": "https://stackoverflow.com/questions/57068707/how-to-add-a-map-interface-in-a-another-map-interface", "title": "How to add a map interface in a another map interface?", "body": "<p>Here I have message a map interface. There are 2 keys in it key1, key2. Key2 has 2 keys k2, k3. I want to add another key in it. So I did this.</p>\n\n<pre><code>message := map[string]interface{}{\n    \"key1\": map[string]string{\n        \"k1\" : \"\",\n    },\n    \"key2\": map[string]interface{}{\n        \"k2\": \"\",\n        \"k3\" : map[string]interface{}{\n            \"kk1\"       : \"\", \n        },\n    },\n}\nk := map[string]interface{}{\n        \"kk2\"   : \"\",\n}\nmessage[\"key2\"][\"k4\"] = k\n\nb, err := json.Marshal(message)\nif err != nil {\n    fmt.Println(err)\n}\nfmt.Println(string(b))\n</code></pre>\n\n<p>But I am getting error as: </p>\n\n<pre><code>message[\"key2\"][\"k4\"] (type interface {} does not support indexing)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1563339618, "creation_date": 1563339618, "answer_id": 57068778, "question_id": 57068664, "link": "https://stackoverflow.com/questions/57068664/go-run-uses-stale-versions-of-sub-packages/57068778#57068778", "title": "go run uses stale versions of sub-packages", "body": "<p><a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"nofollow noreferrer\"><code>go run</code></a> compiles and runs the named main Go package.</p>\n\n<p>Only <a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"nofollow noreferrer\"><code>go build</code></a> or <a href=\"https://golang.org/cmd/go/#hdr-Compile_and_install_packages_and_dependencies\" rel=\"nofollow noreferrer\"><code>go install</code></a> would compile the packages named by the import paths, along with their dependencies,</p>\n"}], "owner": {"reputation": 69, "user_id": 3641332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d0f88a4d2f02ca1624b3ab68c2912a8?s=128&d=identicon&r=PG", "display_name": "flying_kiwi", "link": "https://stackoverflow.com/users/3641332/flying-kiwi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1563339618, "creation_date": 1563338762, "last_edit_date": 1563339449, "question_id": 57068664, "link": "https://stackoverflow.com/questions/57068664/go-run-uses-stale-versions-of-sub-packages", "title": "go run uses stale versions of sub-packages", "body": "<p>I'm trying out the <a href=\"https://medium.com/opentracing/take-opentracing-for-a-hotrod-ride-f6e3141f7941\" rel=\"nofollow noreferrer\">Jaeger/OpenTracing tutorial</a> and finding that none of my changes to the HotROD application code have any effect.</p>\n\n<p>The project structure is something like (abridged):</p>\n\n<pre><code>\u251c\u2500\u2500 main.go\n\u251c\u2500\u2500 pkg\n\u2514\u2500\u2500 services\n    \u251c\u2500\u2500 config\n    \u2502   \u2514\u2500\u2500 config.go\n    \u251c\u2500\u2500 customer\n    \u251c\u2500\u2500 driver\n    \u251c\u2500\u2500 frontend\n    \u2514\u2500\u2500 route\n</code></pre>\n\n<p>I start the application by running <code>go run main.go all</code>.\nIt behaves as expected, the traces on Jaeger all match the screenshots on Medium.</p>\n\n<p>I edit <code>services/config/config.go</code> to change the RouteWorkerPoolSize and MySQLGetDelay variables as directed.\nThen stop the server and start it again with <code>go run main.go all</code></p>\n\n<p>I'd expect these changes to be reflected in the newly running server, but they aren't. The behaviour is the exact same as before. It's like go is running the old code.</p>\n\n<p>Am I misunderstanding something about <code>go run</code>?</p>\n\n<p>Environment variables:</p>\n\n<pre><code>GOPATH=\"/home/ronnie/go\"\nGOROOT=\"/usr/local/go\"\n</code></pre>\n\n<p>working directory:</p>\n\n<pre><code>/home/ronnie/go/src/github.com/jaegertracing/jaeger/examples/hotrod\n</code></pre>\n\n<p>Go version 1.12.6 running on Kubuntu 18.04</p>\n"}, {"tags": ["go", "swagger"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9271450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03285d9bcbb5f2046e1801481aaa34f9?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Nayak", "link": "https://stackoverflow.com/users/9271450/aman-nayak"}, "is_accepted": false, "score": 0, "last_activity_date": 1578569256, "last_edit_date": 1578569256, "creation_date": 1578556788, "answer_id": 59659481, "question_id": 57068433, "link": "https://stackoverflow.com/questions/57068433/parsefile-error-when-generating-swagger-docs/59659481#59659481", "title": "ParseFile error when generating Swagger docs", "body": "<p>I recently faced the same issue; it resolved after installing previous version of swag. </p>\n\n<p>The command to install that specific version is:</p>\n\n<p><code>go get -u github.com/swaggo/swag/cmd/swag@v1.4.1</code></p>\n"}], "owner": {"reputation": 385, "user_id": 8249447, "user_type": "registered", "profile_image": "https://graph.facebook.com/2019240481630479/picture?type=large", "display_name": "Tr\u1ea7n Xu&#226;n Huy", "link": "https://stackoverflow.com/users/8249447/tr%e1%ba%a7n-xu%c3%a2n-huy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 284, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1578569256, "creation_date": 1563336862, "question_id": 57068433, "link": "https://stackoverflow.com/questions/57068433/parsefile-error-when-generating-swagger-docs", "title": "ParseFile error when generating Swagger docs", "body": "<p>I'm using Swagger to generate docs with Golang.</p>\n\n<p>I have generated successfully for a few times. However, the last time I ran <code>swag init</code> (at root folder), it ran into this problem: </p>\n\n<pre><code>swag init\n2019/07/17 11:10:43 Generate swagger docs....\n2019/07/17 11:10:43 Generate general API Info, search dir:./\n2019/07/17 11:10:48 ParseFile error:pkg/mod/golang.org/x/tools@v0.0.0-20190712213246-8b927904ee0d/cmd/fiximports/testdata/src/old.com/bad/bad.go:2:43: expected 'package', found 'EOF'\n</code></pre>\n\n<p>What is this error and how to fix it?</p>\n"}, {"tags": ["node.js", "docker", "go", "travis-ci"], "comments": [{"owner": {"reputation": 2953, "user_id": 5133088, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d0efad94ced5dcd194c0a482cafd4f7b?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Heier", "link": "https://stackoverflow.com/users/5133088/jeroen-heier"}, "edited": false, "score": 0, "creation_date": 1563335620, "post_id": 57068108, "comment_id": 100660753, "body": "Welcome to Stack Overflow!  Did you try your setup without Ruby?"}, {"owner": {"reputation": 1, "user_id": 11795178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a99ddddcb0123194f4844bd53b36a338?s=128&d=identicon&r=PG&f=1", "display_name": "oscar", "link": "https://stackoverflow.com/users/11795178/oscar"}, "reply_to_user": {"reputation": 2953, "user_id": 5133088, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d0efad94ced5dcd194c0a482cafd4f7b?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Heier", "link": "https://stackoverflow.com/users/5133088/jeroen-heier"}, "edited": false, "score": 0, "creation_date": 1563420368, "post_id": 57068108, "comment_id": 100696031, "body": "@JeroenHeier Thank you! After a good amount of tweaking, I think I got it to work the client side of the app. It seems to be reporting the results correctly. I still have to look into exactly how the docker run exit codes work with travis. I updated my post with my changes"}], "owner": {"reputation": 1, "user_id": 11795178, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a99ddddcb0123194f4844bd53b36a338?s=128&d=identicon&r=PG&f=1", "display_name": "oscar", "link": "https://stackoverflow.com/users/11795178/oscar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563420520, "creation_date": 1563333825, "last_edit_date": 1563420520, "question_id": 57068108, "link": "https://stackoverflow.com/questions/57068108/how-to-utilize-docker-to-run-tests-for-multiple-languages-on-travis-ci", "title": "How to utilize Docker to run tests for multiple languages on Travis CI", "body": "<p>I am attempting to create a CI/CD pipeline with Travis CI that tests the front-end, tests the back-end, and deploys. The front-end is using Node, the back-end is using Go.</p>\n\n<p>My repository is structured as follows:</p>\n\n<pre><code>- client\n    - DockerFile\n    - ...(front-end code)\n- server\n    - DockerFile\n    - ...(back-end code)\n- .travis.yml\n</code></pre>\n\n<p>Would I be able to utilize the DockerFiles in some fashion to execute tests for both sides of the application and have Travis report their results properly?</p>\n\n<p>I'm not well versed with either tools so I was hoping to get some input before I dig myself into a hole. I plan on using a combination of Travis stages and docker build/docker run commands. Something like this:</p>\n\n<pre><code>jobs:\n  include:\n    - stage: test client side\n      before_script:\n        - cd client\n        - docker build ...\n      script:\n        docker run image /bin/sh -c \"run node tests\"\n      after_script:\n        - cd ..\n\n    - stage: test server side\n      before_script:\n        - cd server\n      script:\n        docker run image /bin/sh -c \"run go tests\"\n      after_script:\n        - cd ..\n\n    - stage: deploy\n      script: skip\n      deploy:\n        - provider: s3\n            skip_cleanup: true\n            on:\n            branch: master\n</code></pre>\n\n<p><a href=\"https://docs.travis-ci.com/user/build-stages/share-docker-image/\" rel=\"nofollow noreferrer\">This doc page</a> makes it looks promising, but the inclusion of <code>language: ruby</code> and <code>script: - bundle exec rake test</code> throws me off. I am not sure why Ruby is required if the tests are ran through docker (at least that's what it looks like).</p>\n\n<h1>Update 1</h1>\n\n<p>I believe I got it to work correctly with the client side of the application.</p>\n\n<p>Here is what I got:</p>\n\n<pre><code>services:\n  - docker\n\njobs:\n  include:\n    - stage: test\n      before_script:\n        - docker pull node:12\n      script:\n        - docker run --rm -e CI=true -v $(pwd)/client:/src node:12 /bin/sh -c \"cd src; npm install; npm test\"\n</code></pre>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1563333985, "post_id": 57067724, "comment_id": 100660475, "body": "Do you want to get a float to truncate past the 2nd decimal?"}, {"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1563334754, "post_id": 57067724, "comment_id": 100660587, "body": "@colminator Yes. Since I want to use that float type value to compare other int data. But have another problem that don&#39;t know how to convert float type to string (with limited length) in golang&#39;s template syntax."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1563336034, "post_id": 57067724, "comment_id": 100660825, "body": "Use the printf function in templates: <code>{{printf &quot;%.2f&quot; v}}</code>"}, {"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563338355, "post_id": 57067724, "comment_id": 100661275, "body": "@CeriseLim&#243;n Thank you! Great!"}], "answers": [{"comments": [{"owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "edited": false, "score": 1, "creation_date": 1563335254, "post_id": 57068190, "comment_id": 100660686, "body": "This is a very suitable answer! Thank you!"}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 1, "last_activity_date": 1563335256, "last_edit_date": 1563335256, "creation_date": 1563334686, "answer_id": 57068190, "question_id": 57067724, "link": "https://stackoverflow.com/questions/57067724/how-to-get-two-length-below-the-decimal-point-with-golang/57068190#57068190", "title": "How to get two length below the decimal point with golang?", "body": "<p>Multiply by 100; truncate via <code>int</code> conversion; convert back to float32 and divide by 100:</p>\n\n<pre><code>func precision2(f float64) float64 {\n    return float64(int(f*100)) / 100\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jbsdeQKgJji\" rel=\"nofollow noreferrer\">https://play.golang.org/p/jbsdeQKgJji</a></p>\n\n<p>This <a href=\"https://yourbasic.org/golang/round-float-2-decimal-places/\" rel=\"nofollow noreferrer\">link</a> has examples using the <code>math</code> package - but I generally try to avoid including packages for trivial operations.</p>\n"}], "owner": {"reputation": 419, "user_id": 11296502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8969a369d6753a2caf66c8cb370dad2?s=128&d=identicon&r=PG&f=1", "display_name": "02040402", "link": "https://stackoverflow.com/users/11296502/02040402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 0, "accepted_answer_id": 57068190, "answer_count": 1, "score": -2, "last_activity_date": 1563335256, "creation_date": 1563330283, "question_id": 57067724, "link": "https://stackoverflow.com/questions/57067724/how-to-get-two-length-below-the-decimal-point-with-golang", "title": "How to get two length below the decimal point with golang?", "body": "<p>From the source below, I want to get float type result <code>33.33</code>.\nIf use <code>fmt.Sprintf(\"%.2f\", v)</code> can work well. But want to get the result in the <code>floatTest</code> function. How to do?</p>\n\n<pre><code>func main() {\n        v := floatTest(30, 90)\n        fmt.Println(v)\n        // 33.33333333333333\n        vv := fmt.Sprintf(\"%.2f\", v)\n        fmt.Println(vv)\n        // 33.33\n}\n\nfunc floatTest(count float64, total float64) float64 {\n        return (count / total * 100)\n}\n</code></pre>\n"}, {"tags": ["for-loop", "go", "evaluation"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 5, "creation_date": 1563320559, "post_id": 57066568, "comment_id": 100658215, "body": "For the Go rules documentation, read <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a>. In particular: <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">For statements</a>."}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1563330152, "post_id": 57066601, "comment_id": 100659857, "body": "Does <code>_, i</code> count as 1 or 2 iteration variables?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1563332537, "post_id": 57066601, "comment_id": 100660240, "body": "The previous paragraph in that doc seems to imply that <code>_, i</code> would count as 2 iteration variables, which makes sense since it&#39;d only avoid the evaluation when values are not important, just the length to return the indexes: <i>&quot;As with an assignment, if present the operands on the left [...]; they denote the iteration variables. If the range expression is a channel, at most one iteration variable is permitted, otherwise there may be up to two. If the last iteration variable is the blank identifier, the range clause is equivalent to the same clause without that identifier.&quot;</i>"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 4, "last_activity_date": 1563319107, "creation_date": 1563319107, "answer_id": 57066601, "question_id": 57066568, "link": "https://stackoverflow.com/questions/57066568/is-a-golang-range-in-a-for-loop-guaranteed-to-be-evaluated-only-once/57066601#57066601", "title": "Is a golang range in a for loop guaranteed to be evaluated only once?", "body": "<p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec</a></p>\n\n<blockquote>\n  <p>The range expression x is evaluated once before beginning the loop, with one exception: if at most one iteration variable is present and len(x) is constant, the range expression is not evaluated.</p>\n</blockquote>\n"}], "owner": {"reputation": 14998, "user_id": 212378, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/185aae2d842026d2eefa7528b00b394b?s=128&d=identicon&r=PG", "display_name": "Alexis Wilke", "link": "https://stackoverflow.com/users/212378/alexis-wilke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "accepted_answer_id": 57066601, "answer_count": 1, "score": -3, "last_activity_date": 1563319107, "creation_date": 1563318813, "question_id": 57066568, "link": "https://stackoverflow.com/questions/57066568/is-a-golang-range-in-a-for-loop-guaranteed-to-be-evaluated-only-once", "title": "Is a golang range in a for loop guaranteed to be evaluated only once?", "body": "<p>In a software I'm working on, I see many loops that look like this:</p>\n\n<pre><code>for _, i := range strings.Split(s, \",\") { ... }\n</code></pre>\n\n<p>I wanted to make sure that the range was only evaluated once since splitting a string is always costly.</p>\n\n<p>Is there a rule in the documentation of golang about this?</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1563320809, "post_id": 57066554, "comment_id": 100658275, "body": "If they don&#39;t have a tagged version, you can&#39;t. You can only specify a version that actually exists."}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 0, "last_activity_date": 1564514035, "creation_date": 1564514035, "answer_id": 57278616, "question_id": 57066554, "link": "https://stackoverflow.com/questions/57066554/how-to-make-modules-from-golang-org-appear-with-semver-tags-in-my-go-mod/57278616#57278616", "title": "How to make modules from golang.org appear with semver tags in my go.mod?", "body": "<p>The versioning for a Go module is determined by the author of that module, not the consumer.</p>\n\n<p>(You can use a <code>replace</code> directive to remap versions arbitrarily, but then nobody could use <em>your</em> module without doing that same remapping \u2014 it wouldn't simplify anything for anybody.)</p>\n"}], "owner": {"reputation": 19, "user_id": 7197491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc8adc02369e0cc30094d9a021cb6780?s=128&d=identicon&r=PG", "display_name": "Jay Lee", "link": "https://stackoverflow.com/users/7197491/jay-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1564736174, "creation_date": 1563318682, "last_edit_date": 1564736174, "question_id": 57066554, "link": "https://stackoverflow.com/questions/57066554/how-to-make-modules-from-golang-org-appear-with-semver-tags-in-my-go-mod", "title": "How to make modules from golang.org appear with semver tags in my go.mod?", "body": "<p>In my <code>go.mod</code> file. \nI wanna change versioning about modules from golang.org. </p>\n\n<p>they have commit date and hash after version.</p>\n\n<p>I'm using go mod, So I have <code>go.mod</code> file in my workspace.\nMy <code>go.mod</code> is as follow.</p>\n\n<pre><code>module myproject\n\ngo 1.12.6\n\nrequire (\n    github.com/lib/pq v1.1.1\n    golang.org/x/crypto v0.0.0-20190701094942-4def268fd1a4\n    golang.org/x/image v0.0.0-20190523035834-f03afa92d3ff\n)\n</code></pre>\n\n<p>like this. </p>\n\n<p>golang.org/x/crypto v0.0.0-20190701094942-4def268fd1a4 -> golang.org/x/crypto v0.0.0</p>\n\n<p>How to change it? </p>\n\n<p>I think they don't have major versioning officialy.\nas a result, I wanna simplify my <code>go.mod</code> file</p>\n"}, {"tags": ["go", "postman", "keycloak"], "comments": [{"owner": {"reputation": 6338, "user_id": 737936, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/dRhD8.jpg?s=128&g=1", "display_name": "ravthiru", "link": "https://stackoverflow.com/users/737936/ravthiru"}, "edited": false, "score": 0, "creation_date": 1563336362, "post_id": 57066518, "comment_id": 100660895, "body": "what is Access Type set for your client?  may be you need understand more about the Access types here <a href=\"https://www.keycloak.org/docs/6.0/server_admin/#_clients\" rel=\"nofollow noreferrer\">keycloak.org/docs/6.0/server_admin/#_clients</a>."}, {"owner": {"reputation": 13, "user_id": 11794552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef4df0bee34dc919939524543c40029f?s=128&d=identicon&r=PG&f=1", "display_name": "Liza", "link": "https://stackoverflow.com/users/11794552/liza"}, "reply_to_user": {"reputation": 6338, "user_id": 737936, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/dRhD8.jpg?s=128&g=1", "display_name": "ravthiru", "link": "https://stackoverflow.com/users/737936/ravthiru"}, "edited": false, "score": 0, "creation_date": 1563364247, "post_id": 57066518, "comment_id": 100673559, "body": "Access Type in my case is Confidential."}, {"owner": {"reputation": 15334, "user_id": 3348604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QybjW.jpg?s=128&g=1", "display_name": "Jan Garaj", "link": "https://stackoverflow.com/users/3348604/jan-garaj"}, "edited": false, "score": 0, "creation_date": 1563383977, "post_id": 57066518, "comment_id": 100685328, "body": "I recommend to use <a href=\"https://github.com/keycloak/keycloak-gatekeeper\" rel=\"nofollow noreferrer\">github.com/keycloak/keycloak-gatekeeper</a>, which has quite complex features and then you can keep your app simple (without any oidc logic)"}], "owner": {"reputation": 13, "user_id": 11794552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef4df0bee34dc919939524543c40029f?s=128&d=identicon&r=PG&f=1", "display_name": "Liza", "link": "https://stackoverflow.com/users/11794552/liza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 408, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563328285, "creation_date": 1563318328, "last_edit_date": 1563328285, "question_id": 57066518, "link": "https://stackoverflow.com/questions/57066518/how-to-configure-keycloak-to-protect-all-services-hosted-on-a-url", "title": "How to configure keycloak to protect all services hosted on a URL", "body": "<p>I have multiple services running on localhost:8080.\nFor e.g:</p>\n\n<p>a) <code>GET  localhost:8080/idtest/{id}</code></p>\n\n<p>b) <code>POST localhost:8080/idtest</code></p>\n\n<p>and to test them I use POSTMAN. </p>\n\n<p>I want to protect these services by keycloak authentication when they are triggered. Hence, I got the keycloak server installed, created realm,client and rolemapping.</p>\n\n<p>Is there a possibility to add authentication in general to all API's with the same root path just at one place?</p>\n\n<p>Using Golang for implementation.</p>\n\n<p>In keycloak client page:</p>\n\n<p><strong>Base URL:</strong> <code>localhost:8080</code></p>\n\n<p><strong>Redirect URL:</strong> <code>localhost:8080/test</code></p>\n\n<p>I have followed <a href=\"https://tutorialedge.net/golang/go-oauth2-tutorial/\" rel=\"nofollow noreferrer\">this procedure</a>  in my localhost client. </p>\n\n<p>As per it, when I am running <code>localhost:8080</code> on my browser, I get redirected to <code>http://localhost:8080/test</code> and I get below json:</p>\n\n<pre><code>  {\n    \"OAuth2Token\": {\n\n    \"access_token\": \"eyJhbGciOiJSUzI1Ni\",\n    \"token_type\": \"bearer\",\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIs\",\n    \"expiry\": \"2019-07-16T17:41:43.4884786-04:00\"\n\n    },\n    \"IDTokenClaims\": null\n  }\n</code></pre>\n\n<p>Now when I am using POSTMAN with my header type authorization - bearer \"accesstoken retrived from above JSON\" for </p>\n\n<p>1) <code>http://localhost:8080</code> I again get HTML for keyclaok login,\nbut when I am using browser to hit <code>http://localhost:8080</code> it is redirecting me to <code>localhost:8080/test</code> page. </p>\n\n<p>How can I test it from POSTMAN? What am I doing wrong?</p>\n\n<p>2) <code>http://localhost:8080/idtest/12345</code> this service runs seamless irrespective of access token. I want to know how can I add this under the umbrella of same authentication ? I read about single sign on for multiple clients but these services belong to same client. </p>\n\n<p>I tried adding them as resources under authorization tab of client. Do I need to make any changes in the code as well ? How can I do it ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 88487, "user_id": 6508, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6baa1023a5f700292f7e9791311e7f7a?s=128&d=identicon&r=PG", "display_name": "Jorge Ferreira", "link": "https://stackoverflow.com/users/6508/jorge-ferreira"}, "is_accepted": false, "score": 2, "last_activity_date": 1563318022, "creation_date": 1563318022, "answer_id": 57066475, "question_id": 57066301, "link": "https://stackoverflow.com/questions/57066301/combining-time-date-in-golang/57066475#57066475", "title": "Combining time &amp; date in golang?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n    d, err := time.Parse(\"2006-01-02\", \"2019-06-17\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(d)\n\n    t, err := time.Parse(\"15:04:05.000\", \"12:16:54.016\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(t)\n\n    f := d.Add(time.Hour*time.Duration(t.Hour()) + time.Minute*time.Duration(t.Minute()) + time.Second*time.Duration(t.Second()) + time.Nanosecond*time.Duration(t.Nanosecond()))\n    fmt.Println(f)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563346169, "post_id": 57067518, "comment_id": 100663870, "body": "This isn&#39;t inherently simpler, and it doesn&#39;t solve the TZ math problem--it just moves it."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563375305, "post_id": 57067518, "comment_id": 100680676, "body": "@Flimzy agreed. In the OP It&#39;s unclear where the the TZ info is: in the date (time.Time) or should it be relayed via the time-of-day input (if we&#39;re not dealing with UTC?). <i>So for all the kids watching at home: always store your times in UTC!</i>"}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 1, "last_activity_date": 1563412891, "last_edit_date": 1563412891, "creation_date": 1563328572, "answer_id": 57067518, "question_id": 57066301, "link": "https://stackoverflow.com/questions/57066301/combining-time-date-in-golang/57067518#57067518", "title": "Combining time &amp; date in golang?", "body": "<p>If you already have the <code>Date</code> in string format, combine the entire date-time into a single string and call <code>time.Parse</code> once:</p>\n\n<pre><code>func datePlusTime(date, timeOfDay string) (time.Time, error) {\n    return time.Parse(\"2006-01-02 15:04:05.000\", date+\" \"+timeOfDay)\n}\n\nfunc main() {\n    t, err := datePlusTime(\"2019-06-17\", \"12:16:54.016\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(t)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>2019-06-17 12:16:54.016 +0000 UTC</p>\n</blockquote>\n\n<p><a href=\"https://play.golang.org/p/kbor6NBMFLl\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kbor6NBMFLl</a></p>\n\n<hr>\n\n<p>If the date is not in a string format - but you have it in a <code>time.Time</code>, simply coerce to the desired string format, like so:</p>\n\n<pre><code>mydate.Format(\"2006-01-02\") // e.g. mydate:= time.Now() \n</code></pre>\n"}], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 879, "favorite_count": 0, "accepted_answer_id": 57067518, "answer_count": 2, "score": 1, "last_activity_date": 1563412891, "creation_date": 1563316499, "last_edit_date": 1563338488, "question_id": 57066301, "link": "https://stackoverflow.com/questions/57066301/combining-time-date-in-golang", "title": "Combining time &amp; date in golang?", "body": "<p>Suppose I have</p>\n\n<pre><code>t := time.Parse(\"15:04:05.000\", \"12:16:54.016\")\n</code></pre>\n\n<p>This returns a time.Time which prints out as:</p>\n\n<pre><code>0000-01-01 12:16:54.016 +0000 UTC\n</code></pre>\n\n<p>But I know what the actual date is and have it stored as a variable called <code>timestamp</code> which is a time.Time struct already. How do I combine them?</p>\n\n<p>e.g. suppose the date is 2019-06-17.  I need the output to be:</p>\n\n<p>2019-06-17 12:16:54.016 +0000 UTC</p>\n\n<pre><code>// this doesn't compile\nts.AddDate(timestamp.Year(), timestamp.Month(), timestamp.Day())\n\n\ncannot use timestamp.Month() (type time.Month) as type int in argument to ts.AddDate \n</code></pre>\n\n<p>This should be trivial right?  well it is in C which is what I'm most used to.  But I haven't found the answer easily for golang.  The docs don't tell me the actual underlying field names, just functions.  :-/  </p>\n"}, {"tags": ["go", "struct", "protocol-buffers", "proto"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1563306942, "post_id": 57064482, "comment_id": 100654241, "body": "<code>kvData.(pb.Data)</code>"}, {"owner": {"reputation": 5917, "user_id": 4440675, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/q44sl.jpg?s=128&g=1", "display_name": "Amit Tripathi", "link": "https://stackoverflow.com/users/4440675/amit-tripathi"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1563307131, "post_id": 57064482, "comment_id": 100654314, "body": "Getting this <code>invalid type assertion: kvData.(pb.Data) (non-interface type KVData on left)</code>"}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1563307223, "post_id": 57064482, "comment_id": 100654359, "body": "sorry got it mixed up, <code>pb.Data(kvData)</code>"}, {"owner": {"reputation": 5917, "user_id": 4440675, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/q44sl.jpg?s=128&g=1", "display_name": "Amit Tripathi", "link": "https://stackoverflow.com/users/4440675/amit-tripathi"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1563307433, "post_id": 57064482, "comment_id": 100654437, "body": "Now, this is failing with <code>cannot convert kvData (type KVData) to type pb.Data</code>"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1563309864, "post_id": 57064482, "comment_id": 100655420, "body": "FYI... the protobuf field numbers for message <code>Record</code> should probably be <code>1</code> and <code>2</code> - not <code>3</code> and <code>4</code>. Message <code>Record</code> is independent of message <code>Data</code> - so their field numbers are independent.  One would only need to start at a later number if you were sunsetting a field value for backward compatibility."}, {"owner": {"reputation": 5917, "user_id": 4440675, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/q44sl.jpg?s=128&g=1", "display_name": "Amit Tripathi", "link": "https://stackoverflow.com/users/4440675/amit-tripathi"}, "edited": false, "score": 0, "creation_date": 1563310031, "post_id": 57064482, "comment_id": 100655484, "body": "My bad, I removed some of the fields for the sake of brevity. Will fix it."}], "answers": [{"comments": [{"owner": {"reputation": 5917, "user_id": 4440675, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/q44sl.jpg?s=128&g=1", "display_name": "Amit Tripathi", "link": "https://stackoverflow.com/users/4440675/amit-tripathi"}, "edited": false, "score": 1, "creation_date": 1563313072, "post_id": 57065141, "comment_id": 100656571, "body": "I think Pawel&#39;s answer is correct about proto. Proto adds a few extra fields. But your answer does touch some part of my question and it&#39;s helpful. Thanks!"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 5917, "user_id": 4440675, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/q44sl.jpg?s=128&g=1", "display_name": "Amit Tripathi", "link": "https://stackoverflow.com/users/4440675/amit-tripathi"}, "edited": false, "score": 0, "creation_date": 1563314542, "post_id": 57065141, "comment_id": 100656994, "body": "Ah! The question did not include the protoc version you were using.  Yes using <code>syntax = &quot;proto3&quot;;</code> it would be cumbersome to include the extra generated <code>XXX</code> fields just for trivial type conversion."}], "tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1563310745, "last_edit_date": 1563310745, "creation_date": 1563309689, "answer_id": 57065141, "question_id": 57064482, "link": "https://stackoverflow.com/questions/57064482/how-to-cast-convert-a-struct-to-protobuf/57065141#57065141", "title": "How to cast/convert a Struct to Protobuf?", "body": "<p>The closest you can get is something like:</p>\n\n<pre><code>pbData := pb.Data(kvData) // convert kvData struct to pb.Data struct\n\nrecord := &amp;pb.Record{\n        Size: 20,\n        Data: &amp;pbData,\n}\n</code></pre>\n\n<p><strong>Note:</strong> you <em>cannot</em> combine these two steps like so:</p>\n\n<pre><code>record := &amp;pb.Record{\n    Size: 20,\n    Data: &amp;(pb.Data(kvData)), // BROKEN: can't get address of a return-value\n}\n</code></pre>\n\n<p>You can experiment more here: <a href=\"https://play.golang.org/p/2AhWi0Khe4l\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2AhWi0Khe4l</a></p>\n\n<p><strong>EDIT:</strong> pre <a href=\"https://golang.org/doc/go1.8\" rel=\"nofollow noreferrer\">go 1.8</a> struct types could not be converted if they were not exactly identical (same tags etc.) Updated playground link to demo mismatched tags will convert with <code>go 1.8</code> or later.</p>\n"}, {"tags": [], "owner": {"reputation": 5038, "user_id": 436754, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/40s9Q.jpg?s=128&g=1", "display_name": "Pawe\u0142 Szczur", "link": "https://stackoverflow.com/users/436754/pawe%c5%82-szczur"}, "is_accepted": true, "score": 1, "last_activity_date": 1563311362, "creation_date": 1563311362, "answer_id": 57065481, "question_id": 57064482, "link": "https://stackoverflow.com/questions/57064482/how-to-cast-convert-a-struct-to-protobuf/57065481#57065481", "title": "How to cast/convert a Struct to Protobuf?", "body": "<p>You cannot, at least not in Go 1.12.7.</p>\n\n<p>Go's Protobuf compiler adds 3 extra fields to each struct generated from a message:</p>\n\n<pre><code>XXX_NoUnkeyedLiteral         struct{} `json:\"-\"`\nXXX_unrecognized             []byte   `json:\"-\"`\nXXX_sizecache                int32    `json:\"-\"`\n</code></pre>\n\n<p>Therefore your <code>struct</code> and generated one have different fields and are not identical as per, therefore not <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assignable</a>.</p>\n\n<p>If two structs differ only in the tags, it is possible to <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">convert it</a>:</p>\n\n<pre><code>type Person struct {\n    Name    string\n    Address *struct {\n        Street string\n        City   string\n    }\n}\n\nvar data *struct {\n    Name    string `json:\"name\"`\n    Address *struct {\n        Street string `json:\"street\"`\n        City   string `json:\"city\"`\n    } `json:\"address\"`\n}\n\nvar person = (*Person)(data)  // ignoring tags, the underlying types are identical\n</code></pre>\n\n<p>You have to create a new <code>struct</code> instance manually.</p>\n"}, {"tags": [], "owner": {"reputation": 659, "user_id": 5032930, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/852933064761674/picture?type=large", "display_name": "Kartavya", "link": "https://stackoverflow.com/users/5032930/kartavya"}, "is_accepted": false, "score": 0, "last_activity_date": 1581021278, "creation_date": 1581021278, "answer_id": 60103087, "question_id": 57064482, "link": "https://stackoverflow.com/questions/57064482/how-to-cast-convert-a-struct-to-protobuf/60103087#60103087", "title": "How to cast/convert a Struct to Protobuf?", "body": "<p>You can use gogofaster which is a third-party library to generate go code from your .proto files. </p>\n\n<p>gogofaster is a faster generation tool and it does not include the extra fields (XXX_*) in structs making the conversion simpler (as the structs will now be identical). </p>\n\n<p>You can learn more about it here : <a href=\"https://github.com/gogo/protobuf\" rel=\"nofollow noreferrer\">https://github.com/gogo/protobuf</a></p>\n\n<p>Prototool by Uber also support gogofaster.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 5917, "user_id": 4440675, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/q44sl.jpg?s=128&g=1", "display_name": "Amit Tripathi", "link": "https://stackoverflow.com/users/4440675/amit-tripathi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5470, "favorite_count": 0, "accepted_answer_id": 57065481, "answer_count": 3, "score": 0, "last_activity_date": 1581021278, "creation_date": 1563306563, "last_edit_date": 1563313154, "question_id": 57064482, "link": "https://stackoverflow.com/questions/57064482/how-to-cast-convert-a-struct-to-protobuf", "title": "How to cast/convert a Struct to Protobuf?", "body": "<p>I am working on a personal project &amp; using Go for the first time. I am using structs for operating on the data and for storing the data in a file, I am using proto as the encoder.</p>\n\n<p>In the project, my proto definition looks something like this</p>\n\n<pre><code>message Data {\n    string key = 1;\n    string value = 2;\n}\n\nmessage Record {\n    int64 size = 1;\n    Data data = 2;\n}\n</code></pre>\n\n<p>and my struct looks like this</p>\n\n<pre><code>type KVData struct {\n    Key       string\n    Value     string\n}\n</code></pre>\n\n<p>Currently, this is how I am creating proto data</p>\n\n<pre><code>kvData := KVData{Key: \"name\", Value: \"A\"}\n\nrecord := &amp;pb.Record{\n        Size: 20,\n        Data: &amp;pb.Data{Key: \"name\", Value: \"A\"},\n}\n</code></pre>\n\n<p>What I am looking for is a way to do this:</p>\n\n<pre><code>record := &amp;pb.Record{\n        Size: 20,\n        Data: &amp;((pb.Data)kvData), // Won't work\n}\n\n// or like Python\n\nrecord := &amp;pb.Record{\n        Size: 20,\n        Data: &amp;(pb.Data{**kvData}), // Won't work\n}\n\n</code></pre>\n\n<p>I tried googling but couldn't find any solution explaining how to do this.</p>\n\n<p>Note, I am not just trying to solve this specific case, I also want to know what's the recommended Go way to operate between structs and proto(use only proto?)?</p>\n"}, {"tags": ["go", "middleware", "go-echo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563306060, "post_id": 57064089, "comment_id": 100653859, "body": "If you&#39;re referring to specific source code, please quote the relevant code in the body of your question rather than linking to it externally."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563306740, "post_id": 57064089, "comment_id": 100654165, "body": "<a href=\"https://godoc.org/github.com/labstack/echo#HandlerFunc\" rel=\"nofollow noreferrer\"><code>HandlerFunc</code></a> is not a function but a <i>type</i>, that&#39;s why there is no function definition for it, there is, however, a type definition in the <a href=\"https://github.com/labstack/echo/blob/master/echo.go#L111\" rel=\"nofollow noreferrer\">source code</a> if you&#39;re interested."}], "answers": [{"comments": [{"owner": {"reputation": 1970, "user_id": 7994318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7fe47e5dd4ae66f819654383d86dd8c1?s=128&d=identicon&r=PG&f=1", "display_name": "hhprogram", "link": "https://stackoverflow.com/users/7994318/hhprogram"}, "edited": false, "score": 0, "creation_date": 1563320317, "post_id": 57064433, "comment_id": 100658176, "body": "Thanks.  I&#39;m still unsure of what happens when a request arrives at <code>&#47;stats</code>. Request comes in, how is the middleware <code>HandlerFunc</code> <code>Process</code> first called? And then let&#39;s assume there&#39;s a second middleware function to be executed after <code>Process</code>. I was wondering how that chain of function calls works. But maybe once I setup my VSCode Go debugger correctly I can just step through it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1970, "user_id": 7994318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7fe47e5dd4ae66f819654383d86dd8c1?s=128&d=identicon&r=PG&f=1", "display_name": "hhprogram", "link": "https://stackoverflow.com/users/7994318/hhprogram"}, "edited": false, "score": 1, "creation_date": 1563320969, "post_id": 57064433, "comment_id": 100658311, "body": "The router (gin in your case) calls the handler registered for a route. You&#39;ve wrapped the handler in middleware, so the middleware is what the router is actually calling. Then the middleware calls its parameter, and so on."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1563306287, "creation_date": 1563306287, "answer_id": 57064433, "question_id": 57064089, "link": "https://stackoverflow.com/questions/57064089/golang-echo-package-middleware-implementation/57064433#57064433", "title": "Golang echo package middleware implementation", "body": "<p><code>next(c)</code> doesn't loop through anything. <code>next</code> is a variable received as a function parameter, which contains a function. <code>next(c)</code> calls that function. In practice, it is the next part of the chain - which might be the next middleware, or might be the final request handler. When the <code>func</code> that <code>Process</code> returns is called, that itself might have been called as <code>next</code> by the middleware before it.</p>\n\n<p>There's no magic involved, and nothing hidden within the library It's just a chain of function calls.</p>\n"}], "owner": {"reputation": 1970, "user_id": 7994318, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7fe47e5dd4ae66f819654383d86dd8c1?s=128&d=identicon&r=PG&f=1", "display_name": "hhprogram", "link": "https://stackoverflow.com/users/7994318/hhprogram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 706, "favorite_count": 0, "accepted_answer_id": 57064433, "answer_count": 1, "score": 0, "last_activity_date": 1563306287, "creation_date": 1563304727, "question_id": 57064089, "link": "https://stackoverflow.com/questions/57064089/golang-echo-package-middleware-implementation", "title": "Golang echo package middleware implementation", "body": "<p>I'm learning Go and was going through this example : <a href=\"https://echo.labstack.com/cookbook/middleware\" rel=\"nofollow noreferrer\">echo middleware example</a>. I wanted to do a deep dive to understand what was going on when we call <code>next(c)</code> in the function middleware function <code>Process()</code>. </p>\n\n<p>Looking at the <code>main()</code> I understand we append the <code>Process()</code> function to the echo <code>Context</code> object's list of middleware functions via the <code>Use()</code> call. However, looking at the <a href=\"https://github.com/labstack/echo/blob/master/echo.go\" rel=\"nofollow noreferrer\">echo source code</a> I'm unsure how the <code>next(c)</code> call in the <code>Process()</code> function in the middleware example looks through all of the context's middleware functions. Couple things that I cannot seem to find even after searching the source code:</p>\n\n<p>(1) Where is the function definition for <code>echo.HandlerFunc</code> being defined? I see <a href=\"https://github.com/labstack/echo/blob/master/echo.go#L761\" rel=\"nofollow noreferrer\">WrapHandler</a> but that's exported and not used in <code>echo.go</code> so I'm confused what happens when <code>next(c)</code> gets called what line of code in <code>echo.go</code> source code we jump to. </p>\n\n<p>(2) It looks like the loop happens when calling <code>applyMiddleware</code> as that seems to loop through all the middleware functions saved in the Context's list of middleware functions but I don't see how that method is called unless you call the exported <code>WrapMiddleware</code> function or <code>ServeHTTP</code> etc.</p>\n"}, {"tags": ["go", "gmail"], "answers": [{"comments": [{"owner": {"reputation": 148, "user_id": 5085641, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SJPL6XX9KuA/AAAAAAAAAAI/AAAAAAAAADI/9WBZFhVYrxw/photo.jpg?sz=128", "display_name": "Basten Gao", "link": "https://stackoverflow.com/users/5085641/basten-gao"}, "edited": false, "score": 0, "creation_date": 1574599268, "post_id": 57076378, "comment_id": 104281709, "body": "This lib <a href=\"https://github.com/jordan-wright/email\" rel=\"nofollow noreferrer\">jordan-wright/email</a> supplies a convenient method <a href=\"https://godoc.org/github.com/jordan-wright/email#Email.SendWithTLS\" rel=\"nofollow noreferrer\">Email#SendWithTLS</a> to replace of gist above."}], "tags": [], "owner": {"reputation": 121, "user_id": 6660177, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb1003ed085d1a8463f60af3a2f24577?s=128&d=identicon&r=PG&f=1", "display_name": "user666N", "link": "https://stackoverflow.com/users/6660177/user666n"}, "is_accepted": true, "score": 3, "last_activity_date": 1563368174, "creation_date": 1563368174, "answer_id": 57076378, "question_id": 57063411, "link": "https://stackoverflow.com/questions/57063411/go-smtp-unable-to-send-email-through-gmail-getting-eof/57076378#57076378", "title": "go-smtp, unable to send email through gmail, getting EOF", "body": "<p>Check out the \"Configuration options\" section here <a href=\"https://support.google.com/a/answer/176600?hl=en\" rel=\"nofollow noreferrer\">https://support.google.com/a/answer/176600?hl=en</a>. It mentions that Gmail uses SSL for the SMTP server on port 465 and TLS for port 587. To resolve your issue, you could use port 587 because the <code>smtp.SendMail()</code> function internally makes a call to <code>net.Dial()</code> that uses plain TCP to send the mail traffic with a call to STARTTLS later in the process.</p>\n\n<p>If you want to use port 465, here is a nice example that works for sending emails using SSL.</p>\n\n<p><a href=\"https://gist.github.com/chrisgillis/10888032\" rel=\"nofollow noreferrer\">https://gist.github.com/chrisgillis/10888032</a></p>\n\n<p>The main difference between the two methods as also mentioned in the above link is that in SSL, the TLS connection is established from the beginning whereas if you used port 587, the connection starts over plain TCP without encryption.</p>\n"}], "owner": {"reputation": 1024, "user_id": 506114, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/9f7e70182b11d67be153af13227d286e?s=128&d=identicon&r=PG", "display_name": "Walter", "link": "https://stackoverflow.com/users/506114/walter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2058, "favorite_count": 1, "accepted_answer_id": 57076378, "answer_count": 1, "score": 1, "last_activity_date": 1563368174, "creation_date": 1563301702, "question_id": 57063411, "link": "https://stackoverflow.com/questions/57063411/go-smtp-unable-to-send-email-through-gmail-getting-eof", "title": "go-smtp, unable to send email through gmail, getting EOF", "body": "<p>I am using go-smtp to attempt to send an email to myself:\n<a href=\"https://github.com/emersion/go-smtp\" rel=\"nofollow noreferrer\">https://github.com/emersion/go-smtp</a></p>\n\n<pre><code>    auth := sasl.NewPlainClient(\"\", USERNAME, PASSWORD)\n    to := []string{USERNAME}\n\n    msg := strings.NewReader(\"To: \" + USERNAME + \"\\r\\n\" +\n        \"Subject: testing golang go-smtp!\\r\\n\" +\n        \"\\r\\n\" +\n        \"This is the email body.\\r\\n\")\n\n    err := smtp.SendMail(SERVER_HOST + \":\" + SERVER_PORT, auth, USERNAME, to, msg)\n    if err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n\n<p>The output is:\nEOF\nexit status 1</p>\n\n<p>I am connecting to smtp.gmail.com:465 and can send email through thunderbird okay.</p>\n\n<p>Thanks for your help.</p>\n\n<p>Walter</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "serverless"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563301389, "post_id": 57063109, "comment_id": 100651892, "body": "&quot;Efficient&quot; in what regard? What resource(s) are you looking to optimize for?"}, {"owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563302636, "post_id": 57063109, "comment_id": 100652394, "body": "@Adrian I guess I&#39;m indirectly asking that, specifically: are establishing new db connections more network-expensive than maintaining a connection? CPU needed to execute the short-lived lambda function rather than keep the long-running Go program (could experiment and answer this one myself)?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563303083, "post_id": 57063109, "comment_id": 100652581, "body": "The CPU needed for a process running on a VM and the CPU needed for a Lambda function are so effectively different as to be incomparable; one is consuming the CPU of a VM, the other is consuming CPU time billed by the second. The network traffic to handshake a connection vs keep a connection alive are both negligible at infrastructure scale; keepalive vs reconnect is an application-level optimization but you&#39;re not talking about the same application doing one or the other so that comparison also seems irrelevant."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563303140, "post_id": 57063109, "comment_id": 100652614, "body": "If you&#39;re comparing running something as a Lambda or as a process on a VM, the only salient difference is cost, but your question says explicitly that cost isn&#39;t the concern, so it&#39;s hard to tell what exactly you&#39;re trying to optimize for here."}, {"owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563306442, "post_id": 57063109, "comment_id": 100654036, "body": "If cost is the most important difference, then that&#39;s the answer and I&#39;ll take it. Thanks!"}], "owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563335384, "creation_date": 1563300392, "last_edit_date": 1563335384, "question_id": 57063109, "link": "https://stackoverflow.com/questions/57063109/golang-creating-resource-efficient-emailer", "title": "Golang creating resource-efficient emailer", "body": "<p>I've made a simple scheduler in Go that is meant to be long-running and using channels, when the ticker's channel is ready, I poll my database for emails to be sent out, which sends the email to the send channel and when it is ready, the email is sent out. For now the tick interval is every 10 minutes. This scheduler connects to the pg database once on startup.</p>\n\n<p>Example:</p>\n\n<pre><code>for {\n    select {\n     case &lt;-s.ticker.C:\n      // query db, sends each email to s.send channel. Could just send them\n      // without the channel though.\n      go poll()\n     case email := s.send:\n      send(email) // sends the email via some email service\n    }\n}\n</code></pre>\n\n<p>My question is if would it be more safe/efficient to use this Go program which connects to the database once, or setup a Lambda function as a cronjob every 10 minutes? I've never used Lambda, but I believe there would be a new database connection every time it is run, which also involves fetching credentials.</p>\n\n<p>Cost-wise assume that it doesn't matter, I'm only curious as to which would be more safe/efficient. Any information is appreciated!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1563301642, "post_id": 57063010, "comment_id": 100652002, "body": "The implementations of <code>UserManager</code> should reflect where/how the implementation retrieves/modifies its data. For example: <code>DBUserManager</code>, <code>InMemoryUserManager</code>, <code>CachingUserManager</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2595, "user_id": 1661745, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4ecd96e73e6cbe7010ce8dc5922cf89b?s=128&d=identicon&r=PG&f=1", "display_name": "onepiece", "link": "https://stackoverflow.com/users/1661745/onepiece"}, "edited": false, "score": 0, "creation_date": 1596484383, "post_id": 57063452, "comment_id": 111820589, "body": "&quot;If you&#39;ll only ever have one implementation, the interface is probably useless.&quot; - this represents my scenario. Then my main problem: how would create mocks for tests with only structs?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2595, "user_id": 1661745, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4ecd96e73e6cbe7010ce8dc5922cf89b?s=128&d=identicon&r=PG&f=1", "display_name": "onepiece", "link": "https://stackoverflow.com/users/1661745/onepiece"}, "edited": false, "score": 0, "creation_date": 1596545487, "post_id": 57063452, "comment_id": 111840051, "body": "@onepiece if you&#39;re using mocks, then that doesn&#39;t describe your situation; you have <i>two</i> implementations: the production implementation, and the mock. Therefore, you need an interface."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1563301860, "creation_date": 1563301860, "answer_id": 57063452, "question_id": 57063010, "link": "https://stackoverflow.com/questions/57063010/golang-multi-method-interface-and-struct-naming/57063452#57063452", "title": "Golang multi-method interface and struct naming", "body": "<p>Coming from Java/C# to Go requires a paradigm shift.</p>\n\n<p>Because they are implemented implicitly, interfaces are defined where they're <em>consumed</em>, not where they're <em>implemented</em>.</p>\n\n<p>Because they're implemented implicitly, smaller interfaces are preferred over larger interfaces, hence the focus on single-method \"Verber\" interfaces. If you have a function that needs to read bytes, it can take a <code>io.Reader</code>, and the function can be supplied any type that has that method (regardless what other methods it has). You probably don't have a function that calls all 5 of the methods listed in your interface (if so, that function is probably doing too much).</p>\n\n<p>If you feel like naming a struct and an interface the same thing and therefore need some kind of prefix/suffix, you're probably thinking about it the wrong way and might need to reconsider your design.</p>\n\n<p>DBAL is one area where there is sometimes a real case for a larger interface (though it should probably still be composed of smaller interfaces). But in this case, \"Impl\" doesn't tell you anything - Java and C# love to have pointless interfaces, Go does not. If you'll only ever have one implementation, the interface is probably useless.</p>\n\n<p>If you will have multiple implementations, the differences between them should guide your naming. For example, you might have a <code>PostgresUserManager</code>, a <code>MongoUserManager</code>, and a <code>MockUserManager</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 5551, "user_id": 1201488, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/cce2b982a2acdfb40f3c376489403f1e?s=128&d=identicon&r=PG", "display_name": "Ivan Velichko", "link": "https://stackoverflow.com/users/1201488/ivan-velichko"}, "is_accepted": false, "score": 1, "last_activity_date": 1563302390, "creation_date": 1563302390, "answer_id": 57063586, "question_id": 57063010, "link": "https://stackoverflow.com/questions/57063010/golang-multi-method-interface-and-struct-naming/57063586#57063586", "title": "Golang multi-method interface and struct naming", "body": "<p>Do you really need <code>UserManagerImpl</code> struct be public? It's kinda common to have a public interface and the corresponding private implementation. Check <a href=\"https://github.com/containers/storage/blob/master/store.go#L155\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://github.com/containers/storage/blob/master/store.go#L520\" rel=\"nofollow noreferrer\">this</a>.</p>\n\n<pre><code>type Store interface {\n    RunRoot() string\n    GraphRoot() string\n    ...\n}\n\ntype store struct {\n    ...\n}\n\nfunc New() Store {\n    return &amp;store{}\n}\n\nfunc (s *store) RunRoot() string {\n    return s.runRoot\n}\n\nfunc (s *store) GraphRoot() string {\n    return s.graphRoot\n}\n</code></pre>\n\n<p>I mean, if you came up with a decent name for the interface, you still can use it for the implementation. But in general, it's good to call things reflecting what they really are regardless of the best practices of the given language. Projects are unique, it's barely possible to make a list of best practices suitable for all the use cases of the language.</p>\n"}], "owner": {"reputation": 11850, "user_id": 258737, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c17f8bf398b71f61dd2aca03d35c0919?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/258737/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1253, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1563302390, "creation_date": 1563299869, "question_id": 57063010, "link": "https://stackoverflow.com/questions/57063010/golang-multi-method-interface-and-struct-naming", "title": "Golang multi-method interface and struct naming", "body": "<p>Golang docs provide a clear guidance on <a href=\"https://golang.org/doc/effective_go.html#interface-names\" rel=\"noreferrer\">how to name single-method interface</a> (by appending \"-er\"). But what is the best practice to name a multi-method interface that has only a single struct implementing it? </p>\n\n<p>In C# the interface would have \"I\" prefix, in Java, the class will have \"Impl\" suffix. Are there similar guidelines for Golang?</p>\n\n<p>The point of having an interface here is to be able to mock it for unit-testing of components that depend on it.</p>\n\n<p>Here is a specific example of UserManager interface. It is going to be consumed by a web api controller that will translate HTTP requests into method calls on this interface.  This web api controller will use most of the methods of UserManager. </p>\n\n<pre><code>type UserManager interface { // Should it be UserManagerInterface ?\n    GetUser(id int) User\n    CreateUser(user User)\n    DeleteUser(id int)\n    ResetPassword(id int, newPassword string)\n    VerifyEmail(id int)\n}\n\ntype UserManagerImpl struct { // -Impl, or -Struct, or something else? \n\n}\n</code></pre>\n"}, {"tags": ["go", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 6, "last_activity_date": 1563298766, "creation_date": 1563298766, "answer_id": 57062767, "question_id": 57060602, "link": "https://stackoverflow.com/questions/57060602/what-is-the-difference-between-metadata-fromoutgoingcontext-and-metadata-frominc/57062767#57062767", "title": "What is the difference between metadata.FromOutgoingContext and metadata.FromIncomingContext?", "body": "<p>If you are writing that middle-ware in the server, then you are <strong>receiving</strong> that metadata in the <strong>incoming</strong> request.</p>\n\n<p>You should then use <code>metadata.FromIncomingContext</code> to get the metadata at that point.</p>\n\n<p>The metadata in the \"outgoing context\" is the one generated by the client when <strong>sending</strong> an <strong>outgoing</strong> request to the server.</p>\n\n<p>See here for examples of both:</p>\n\n<p><a href=\"https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md\" rel=\"noreferrer\">https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-metadata.md</a></p>\n"}], "owner": {"reputation": 424, "user_id": 1459578, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/f0618fbfe872614be8f5fa14ee152d65?s=128&d=identicon&r=PG", "display_name": "Javad M. Amiri", "link": "https://stackoverflow.com/users/1459578/javad-m-amiri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1005, "favorite_count": 1, "accepted_answer_id": 57062767, "answer_count": 1, "score": 9, "last_activity_date": 1563348241, "creation_date": 1563290444, "last_edit_date": 1563348241, "question_id": 57060602, "link": "https://stackoverflow.com/questions/57060602/what-is-the-difference-between-metadata-fromoutgoingcontext-and-metadata-frominc", "title": "What is the difference between metadata.FromOutgoingContext and metadata.FromIncomingContext?", "body": "<p>If you are in a middle-ware that both receives the <code>context</code> and maybe append some data to <code>context</code> to send it to the next interceptor, then which of the two methods i.e. <code>metadata.FromOutgoingContext</code> and <code>metadata.FromIncomingContext</code> shall be called?</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "edited": false, "score": 0, "creation_date": 1563288289, "post_id": 57059204, "comment_id": 100645395, "body": "Did you answer yourself already, are you sure you have data with the first match running alone?"}, {"owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "reply_to_user": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "edited": false, "score": 0, "creation_date": 1563288500, "post_id": 57059204, "comment_id": 100645509, "body": "Yes I do have data when performing this search : <code>db.events.find({&quot;start_date&quot;: { &quot;$gt&quot;: ISODate(&quot;2019-05-16T00:00:00.0Z&quot;)}}).limit(1);</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563288941, "post_id": 57059204, "comment_id": 100645796, "body": "Are you sure you&#39;re querying from the <code>events</code> collection? Also <code>time.Now()</code> uses local time, and the query you claim has results uses UTC (there might be few hours difference)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563289105, "post_id": 57059204, "comment_id": 100645897, "body": "@icza given that the times include time zone information, I doubt that&#39;s relevant to the issue."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563289223, "post_id": 57059204, "comment_id": 100645979, "body": "@Adrian His query does not have time zone info, it contains UTC timestamp. It may make a difference if he only has matching documents that are between <code>2019-05-16T00:00:00.0</code> UTC and <code>time.Now() - 2 months</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563289587, "post_id": 57059204, "comment_id": 100646204, "body": "The query in Go passes a <code>time.Time</code>, which includes location information. The query quoted in the comment executed in mongo specifies UTC."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563289850, "post_id": 57059204, "comment_id": 100646353, "body": "@Adrian Yes, and the time in the query has 0:00 time part, only date. If his local time is 16:00 and zone is let&#39;s say UTC+2, that translates to 14:00 UTC. So there is a 14-hour window between the 2 timestamps."}, {"owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563301624, "post_id": 57059204, "comment_id": 100651992, "body": "@icza : I am UTC+2 yes. But I do not get it, I am only filtering with a <b>FROM</b> value, I do not specify a <b>TO</b>. From May to know, if I remove the <code>$match</code>, I do have results... incredible !"}, {"owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "edited": false, "score": 0, "creation_date": 1563302293, "post_id": 57059204, "comment_id": 100652266, "body": "Stupid question, does it need to be inside the same <code>bson.M</code> than the <code>$group</code> one ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563309283, "post_id": 57059204, "comment_id": 100655186, "body": "Try to use <code>time.Date(2019, 5, 16, 0, 0, 0, 0, time.UTC)</code> instead of <code>time.Now()</code>. Does it change anything?"}], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 0, "last_activity_date": 1563946085, "creation_date": 1563946085, "answer_id": 57175829, "question_id": 57059204, "link": "https://stackoverflow.com/questions/57059204/mongodb-and-golang-match-before-group/57175829#57175829", "title": "MongoDb and Golang - Match before Group", "body": "<blockquote>\n  <p>I checked in database and I do have events that have a start_date matching my criteria, with that request</p>\n</blockquote>\n\n<p><a href=\"https://docs.mongodb.com/manual/reference/bson-types/#document-bson-type-date\" rel=\"nofollow noreferrer\">MongoDB stores time in UTC</a> by default, and will convert any local time representations into this form. </p>\n\n<p>This means, if you are in <code>UTC+2</code> timezone, your query filter is by default would be in local time but the documents in the database is in UTC. You need to convert your <code>time</code> to UTC. For example, you have the following documents in a collection: </p>\n\n<pre><code>{ \"start_date\": ISODate(\"2019-05-27T00:00:00Z\"), \"location_id\": 1 },\n{ \"start_date\": ISODate(\"2019-05-28T00:00:00Z\"), \"location_id\": 2 },\n{ \"start_date\": ISODate(\"2019-05-24T00:00:00Z\"), \"location_id\": 1 },\n</code></pre>\n\n<p>You can perform <code>$match</code> for dates two months ago as below: </p>\n\n<pre><code>pipeline := mongo.Pipeline{\n    {{\"$match\", bson.D{\n        {\"start_date\", bson.D{\n            {\"$gt\", time.Now().AddDate(0, -2, 0).UTC()},\n            }, \n        },\n    }}}, \n}\ncursor, err := collection.Aggregate(context.Background(), pipeline)\ndefer cursor.Close(context.Background())\nfor cursor.Next(context.Background()) {\n    var doc bson.M\n    err := cursor.Decode(&amp;doc)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(doc)\n}\n</code></pre>\n\n<p>Note the conversion to <code>UTC</code> after the calculation. If today is already the 24th July 2019, then the query will not matched the third document. Instead you need to query with <strong>2 months and 1 day ago</strong>. </p>\n\n<p>Another tip is you can debug the date sent to the server by printing the <code>pipeline</code>, i.e: </p>\n\n<pre><code>fmt.Println(pipeline)\n// [[{$match [{start_date [{$gt 2019-05-24 05:19:47.382049 +0000 UTC}]}]}]]\n</code></pre>\n\n<p>If you have a static date value, you can also construct the date (still in UTC) as below example: </p>\n\n<pre><code>filterDate := time.Date(2019, 5, 24, 0, 0, 0, 0, time.UTC)\npipeline := mongo.Pipeline{\n    {{\"$match\", bson.D{\n        {\"start_date\", bson.D{\n            {\"$gt\", filterDate},\n            }, \n        },\n    }}},\n}\nfmt.Println(pipeline)\n</code></pre>\n\n<p>All of the snippets above are written for <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">MongoDB Go driver</a> v1.0.x. </p>\n"}], "owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1563946085, "creation_date": 1563286053, "last_edit_date": 1563301102, "question_id": 57059204, "link": "https://stackoverflow.com/questions/57059204/mongodb-and-golang-match-before-group", "title": "MongoDb and Golang - Match before Group", "body": "<p>I am trying to <strong>$match</strong> my list of <strong>Event</strong> before to <strong>$group</strong> them but it does not work. If I remove the first <code>$match</code>, I get results.</p>\n\n<p>The <strong>Event</strong> has a <strong>start_date</strong> property.</p>\n\n<p>I need to get the IDs of the duplicated events that start from 2 months to now. A duplicated event is an event that is a the same location at same hour.</p>\n\n<pre><code>    // Create the pipeline\n    pipeline := []bson.M{\n        bson.M{\n            \"$match\": bson.M{\n                \"start_date\": bson.M{\"$gt\": time.Now().AddDate(0, -2, 0)},\n            },\n        },\n        bson.M{\n            \"$group\": bson.M{\n                \"_id\": bson.M{\n                    \"_location_id\": \"$_location_id\",\n                    \"start_date\":   \"$start_date\",\n                },\n                \"docs\":  bson.M{\"$push\": \"$_id\"},\n                \"count\": bson.M{\"$sum\": 1},\n            },\n        },\n        bson.M{\n            \"$match\": bson.M{\n                \"count\": bson.M{\"$gt\": 1.0},\n            },\n        },\n    }\n</code></pre>\n\n<p>Am I missing something ?</p>\n\n<p>I checked in database and I do have events that have a <code>start_date</code> matching my criteria, with that request <code>db.events.find({}).sort({ \"start_date\": -1}).limit(1);</code> and that one <code>db.events.find({\"start_date\": { \"$gt\": ISODate(\"2019-05-16T00:00:00.0Z\")}}).limit(1)</code></p>\n\n<p>Version : MongoDB shell version v3.4.6</p>\n"}, {"tags": ["go", "apache-kafka", "kafka-consumer-api", "sarama"], "answers": [{"comments": [{"owner": {"reputation": 765, "user_id": 1773471, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ef9230d2cad16eeaef167c2b782ebe36?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/1773471/steve"}, "edited": false, "score": 1, "creation_date": 1565399635, "post_id": 57059101, "comment_id": 101354407, "body": "I have found the answer. For question#2, you don&#39;t consume from earlies/latest offset unless your consume offset is expired!!!"}], "tags": [], "owner": {"reputation": 23213, "user_id": 7131757, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/wvEUE.jpg?s=128&g=1", "display_name": "Giorgos Myrianthous", "link": "https://stackoverflow.com/users/7131757/giorgos-myrianthous"}, "is_accepted": false, "score": 2, "last_activity_date": 1563285745, "creation_date": 1563285745, "answer_id": 57059101, "question_id": 57058504, "link": "https://stackoverflow.com/questions/57058504/how-to-consume-from-latest-offset-using-sarama-go-kafka-consumer/57059101#57059101", "title": "How to consume from latest offset using Sarama Go Kafka Consumer", "body": "<ol>\n<li><p>No. When the retention policy is applied, older messages are deleted from the topics. Therefore, the oldest offset might not be the first-ever offset (i.e. <code>0</code>). </p></li>\n<li><p>It depends on your configuration. Essentially, you have 3 options: </p>\n\n<ul>\n<li>Start consuming from the <code>earliest</code> offset</li>\n<li>Start consuming from the <code>latest</code> offset</li>\n<li>Start consuming from a specific offset </li>\n</ul></li>\n<li><p>You have to use <code>sarama.OffsetOldest</code>. From the <a href=\"https://godoc.org/github.com/Shopify/sarama\" rel=\"nofollow noreferrer\">documentation</a>, </p></li>\n</ol>\n\n<blockquote>\n<pre><code> const (\n        // OffsetNewest stands for the log head offset, i.e. the offset that will be\n        // assigned to the next message that will be produced to the partition. You\n        // can send this to a client's GetOffset method to get this offset, or when\n        // calling ConsumePartition to start consuming new messages.\n        OffsetNewest int64 = -1\n        // OffsetOldest stands for the oldest offset available on the broker for a\n        // partition. You can send this to a client's GetOffset method to get this\n        // offset, or when calling ConsumePartition to start consuming from the\n        // oldest offset that is still available on the broker.\n        OffsetOldest int64 = -2\n    )\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 765, "user_id": 1773471, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ef9230d2cad16eeaef167c2b782ebe36?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/1773471/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2345, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1563287890, "creation_date": 1563284028, "last_edit_date": 1563287890, "question_id": 57058504, "link": "https://stackoverflow.com/questions/57058504/how-to-consume-from-latest-offset-using-sarama-go-kafka-consumer", "title": "How to consume from latest offset using Sarama Go Kafka Consumer", "body": "<p>I have three questions\uff1a</p>\n\n<ol>\n<li>what is the meaning of \"oldest offset\"? Oldest offset doesn't mean offset 0?</li>\n</ol>\n\n<blockquote>\n  <p>// OffsetOldest stands for the oldest offset available on the broker for a<br>\n      // partition.<br>\n      OffsetOldest int64 = -2</p>\n</blockquote>\n\n<ol start=\"2\">\n<li><p>Supposing   </p>\n\n<p>A. Three brokers running on same machine<br>\nB. The consumer group has only one consumer thread<br>\nC. The consumer configs OffsetOldest flag.<br>\nD. There have been 100 msgs produced and currently the consumer thread have consumed 90 msgs.    </p>\n\n<p>So if the consumer thread restarted, then which offset will this consumer start to consume from? it is 91 or 0?   </p></li>\n<li><p>In our code below, it seems to reconsume messages everytime the consumer is started. but actually it doest happen all times. Why reconsuming just happens a few times just after restart(not all)?</p>\n\n<pre><code> func (this *consumerGroupHandler) ConsumeClaim(session \n sarama.ConsumerGroupSession, claim sarama.ConsumerGroupClaim) error {\n          for message := range claim.Messages() {\n          this.handler(message)\n         session.MarkMessage(message, \"\")\n    }\n\n    return nil\n}\n\nctx := context.Background()\nconf := sarama.NewConfig()\n\nconf.Version = sarama.V2_0_0_0\nconf.Consumer.Offsets.Initial = sarama.OffsetOldest\nconf.Consumer.Return.Errors = true\n\nconsumer, err := sarama.NewConsumerGroup(strings.Split(app.Config().KafkaBrokers, \",\"), groupId, conf)\nif err != nil {\n    logger.Error(\"NewConsumerGroupFromClient(%s) error: %v\", groupId, err)\n    return\n}\n</code></pre></li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1563283410, "post_id": 57057773, "comment_id": 100642203, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24534072/how-to-compare-struct-slice-map-are-equal\">How to compare struct, slice, map are equal?</a>"}, {"owner": {"reputation": 137, "user_id": 5562332, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f7396b0c9b7352debad016528f45fb36?s=128&d=identicon&r=PG&f=1", "display_name": "IFeel3", "link": "https://stackoverflow.com/users/5562332/ifeel3"}, "reply_to_user": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 1, "creation_date": 1563283939, "post_id": 57057773, "comment_id": 100642520, "body": "I don&#39;t see it as duplicate, that thread is much more general"}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 5562332, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f7396b0c9b7352debad016528f45fb36?s=128&d=identicon&r=PG&f=1", "display_name": "IFeel3", "link": "https://stackoverflow.com/users/5562332/ifeel3"}, "edited": false, "score": 0, "creation_date": 1563284041, "post_id": 57058265, "comment_id": 100642589, "body": "thanks, this is excactly the explanation I needed. I was missing knowledge about json marshalling details."}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 6, "last_activity_date": 1563283267, "creation_date": 1563283267, "answer_id": 57058265, "question_id": 57057773, "link": "https://stackoverflow.com/questions/57057773/go-structs-comparison-reflect-deepequal-fails-on-maps/57058265#57058265", "title": "Go structs comparison - reflect.DeepEqual fails on maps?", "body": "<p>The thing here is how the golang encoding an <code>int</code>, you're initializing it as <code>int</code>, but in the json you provide it is <code>float64</code>.</p>\n\n<p>Here is working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n    \"reflect\"\n)\n\ntype MyStruct struct {\n    Cache map[string]interface{} `json:\"cache\"`\n}\n\nvar js = `{\"cache\":{\"productsCount\":28}}`\n\nfunc main() {\n    var s1, s2 MyStruct\n    s1 = MyStruct{\n        Cache: map[string]interface{}{\n            \"productsCount\": float64(28),\n        },\n    }\n    s2 = MyStruct{}\n    err := json.Unmarshal([]byte(js), &amp;s2)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    fmt.Printf(\"%#v\\n\", s1)\n    fmt.Printf(\"%#v\\n\", s2)\n    fmt.Println(reflect.DeepEqual(s1, s2))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>main.MyStruct{Cache:map[string]interface {}{\"productsCount\":28}}\nmain.MyStruct{Cache:map[string]interface {}{\"productsCount\":28}}\ntrue\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 5562332, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f7396b0c9b7352debad016528f45fb36?s=128&d=identicon&r=PG&f=1", "display_name": "IFeel3", "link": "https://stackoverflow.com/users/5562332/ifeel3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1032, "favorite_count": 0, "accepted_answer_id": 57058265, "answer_count": 1, "score": 1, "last_activity_date": 1563283267, "creation_date": 1563281699, "question_id": 57057773, "link": "https://stackoverflow.com/questions/57057773/go-structs-comparison-reflect-deepequal-fails-on-maps", "title": "Go structs comparison - reflect.DeepEqual fails on maps?", "body": "<p>I'm writing unit test and my goal is to unmarshall data from json to one struct and compare it to the other, mock struct. I'm using reflect.DeepEqual() method but it's returning false on these. </p>\n\n<p>My guess is that it is somehow related to type casting going on in the background, where map[string]interface{} is converted to map[string]int, but that's as far as I got. </p>\n\n<pre><code>type MyStruct struct {\n    Cache map[string]interface{} `json:\"cache\"`\n}\n\nvar js = `{\"cache\":{\"productsCount\":28}}`\n\nfunc main() {\n    var s1, s2 MyStruct\n    s1 = MyStruct{\n        Cache: map[string]interface{} {\n            \"productsCount\": 28,\n        },\n    }\n    s2 = MyStruct{}\n    err := json.Unmarshal([]byte(js), &amp;s2)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n\n    fmt.Printf(\"%#v\\n\", s1)\n    fmt.Printf(\"%#v\\n\", s2)\n    fmt.Println(reflect.DeepEqual(s1, s2))\n}\n</code></pre>\n\n<p>The output looks like this: </p>\n\n<pre><code>main.MyStruct{Cache:map[string]interface {}{\"productsCount\":28}}\nmain.MyStruct{Cache:map[string]interface {}{\"productsCount\":28}}\nfalse\n</code></pre>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 3, "creation_date": 1563281782, "post_id": 57057744, "comment_id": 100641163, "body": "Go is a memory managed language. When the reference to <code>chan</code> is dropped (i.e. at the end of <code>f</code>), the memory it takes can be freed by the garbage collector. There&#39;s no memory leak here."}, {"owner": {"reputation": 45, "user_id": 11217066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c6ab1743b102b328da488934a824616?s=128&d=identicon&r=PG&f=1", "display_name": "jdoe", "link": "https://stackoverflow.com/users/11217066/jdoe"}, "reply_to_user": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1563281844, "post_id": 57057744, "comment_id": 100641203, "body": "Thanks for the quick answer :)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1563281922, "post_id": 57057744, "comment_id": 100641252, "body": "Nope. When the channel goes out if scope it becomes garbage and thus doesn&#39;t reference the value anymore. No different from map or slice contents, or struct fields."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 2, "creation_date": 1563283486, "post_id": 57057744, "comment_id": 100642243, "body": "Note: there&#39;s a common misconception that once a channel is closed, it will be GC&#39;ed. This is not the case. In the case of a buffered channel - any unread items - can still be read later (after the close event). As such, as others have mentioned, only when the last reference to the channel goes out of scope, will the channel&#39;s memory be reclaimed."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1563283660, "post_id": 57057744, "comment_id": 100642354, "body": "Possible duplicate of [Is it OK to leave a channel open? ](<a href=\"https://stackoverflow.com/questions/8593645/is-it-ok-to-leave-a-channel-open\" title=\"is it ok to leave a channel open\">stackoverflow.com/questions/8593645/&hellip;</a>)"}], "owner": {"reputation": 45, "user_id": 11217066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c6ab1743b102b328da488934a824616?s=128&d=identicon&r=PG&f=1", "display_name": "jdoe", "link": "https://stackoverflow.com/users/11217066/jdoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563283412, "creation_date": 1563281609, "last_edit_date": 1563283412, "question_id": 57057744, "link": "https://stackoverflow.com/questions/57057744/what-happens-to-a-value-never-consumed-from-a-buffered-channel", "title": "What happens to a value never consumed from a Buffered channel", "body": "<p>I have the following code</p>\n\n<pre><code>func f() {\n  ...\n  chan := make(chan error, 1)\n  go func() {\n    ...\n    chan &lt;- err\n  }()\n\n  err := other_method()\n  if err != nil {\n    log(err)\n    return\n  }\n\n  err &lt;- chan\n  if err != nil {\n    log(err)\n  }\n}\n</code></pre>\n\n<p>What will happen to the value written in the buffered channel if it is never ever read, because the func exited before reading from it? Is this a resource leak I need to care about?</p>\n"}, {"tags": ["json", "go", "go-gin"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1563279767, "post_id": 57056639, "comment_id": 100639951, "body": "If you want recipients to be a json array then you should use a go slice. And it is usually recommended that you use proper struct types instead of maps when dealing with json."}, {"owner": {"reputation": 119, "user_id": 10689245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1ffe56b89216fa21e1e85a1d9ab0c47?s=128&d=identicon&r=PG&f=1", "display_name": "Amit Upa", "link": "https://stackoverflow.com/users/10689245/amit-upa"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563280991, "post_id": 57056639, "comment_id": 100640682, "body": "I tried to use struct as well but the same issue, how to enclose recipients data in <i>[ ]</i>. can you please give some example of struct."}], "answers": [{"comments": [{"owner": {"reputation": 119, "user_id": 10689245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1ffe56b89216fa21e1e85a1d9ab0c47?s=128&d=identicon&r=PG&f=1", "display_name": "Amit Upa", "link": "https://stackoverflow.com/users/10689245/amit-upa"}, "edited": false, "score": 0, "creation_date": 1563288178, "post_id": 57058575, "comment_id": 100645332, "body": "Thanks I was missing this step"}], "tags": [], "owner": {"reputation": 36, "user_id": 11790167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d80ae645f9e25df821764eb992208483?s=128&d=identicon&r=PG&f=1", "display_name": "JonasKraft", "link": "https://stackoverflow.com/users/11790167/jonaskraft"}, "is_accepted": true, "score": 2, "last_activity_date": 1563284283, "creation_date": 1563284283, "answer_id": 57058575, "question_id": 57056639, "link": "https://stackoverflow.com/questions/57056639/how-to-create-multilevel-map-in-golang/57058575#57058575", "title": "How to create multilevel map in golang", "body": "<p>To enclose the recipients in a JSON array, create a Go slice and append what you have stored in <code>data</code>. Then assign the slice to <code>parameter[\"recipients\"]</code> instead of <code>data</code>.</p>\n\n<p>You could change your code to something like this:</p>\n\n<pre><code>recipients := make([]map[string]interface{}, 0)\nrecipients = append(recipients, data)\nparameter[\"recipients\"] = recipients\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 10689245, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1ffe56b89216fa21e1e85a1d9ab0c47?s=128&d=identicon&r=PG&f=1", "display_name": "Amit Upa", "link": "https://stackoverflow.com/users/10689245/amit-upa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "accepted_answer_id": 57058575, "answer_count": 1, "score": -3, "last_activity_date": 1566078899, "creation_date": 1563278000, "last_edit_date": 1566078899, "question_id": 57056639, "link": "https://stackoverflow.com/questions/57056639/how-to-create-multilevel-map-in-golang", "title": "How to create multilevel map in golang", "body": "<p>I have to send request parameter in json format to an API. This json request parameter is in nested format, so I am trying to create a map of request parameters and  then convert it in json format and pass it to api.</p>\n\n<p>This is expected json format</p>\n\n<pre><code>{\n  \"campaign_id\": \"test_notify\",\n  \"content\": {\n    \"template_id\": \"xxxxxxxx\"\n  },\n  \"recipients\": [\n    {\n      \"address\": {\"email\":\"xxxx@xxxxx.com\"},\n      \"substitution_data\": {\n        \"address1\": \"xxxx@xxxxx.com\",\n        \"address1\": \"xxxx@xxxxx.com\"\n      }\n    }\n  ]\n  }\n</code></pre>\n\n<p>I am able to convert till content but facing issue to enclose recipients in []</p>\n\n<pre><code>parameter := make(map[string]interface{})\nparameter[\"campaign_id\"] = \"test_notify\"\nparameter[\"content\"] = map[string]string{\"template_id\": \"xxxxxxxx\"}\n\ndata := make(map[string]interface{})\n\ndata[\"address\"] = \"xxxx@xxxxx.com\"\ndata[\"substitution_data\"] = map[string]string{\n  \"address1\":\"xxxx@xxxxx.com\",\n  \"address2\": \"xxxx@xxxxx.com\"\n}\n\nparameter[\"recipients\"] = data\nfmt.Println(data)\nfmt.Println(parameter)\n\nmapC, _ := json.Marshal(parameter)\nfmt.Println(string(mapC))\n</code></pre>\n\n<p>I am getting output</p>\n\n<pre><code>{\"campaign_id\":\"test_notify\",\"content\":{\"template_id\":\"xxxxxxxx\"},\"recipients\":{\"address\":\"xxxx@xxxxx.com\",\"substitution_data\":{\"address1\":\"xxxx@xxxxx.com\",\"address2\":\"xxxx@xxxxx.com\"}}}\n</code></pre>\n\n<p>I just need to enclose recipients data in [] and my expected requesting parameter will match.</p>\n"}, {"tags": ["go", "google-api", "google-cloud-storage", "google-kubernetes-engine", "service-accounts"], "answers": [{"comments": [{"owner": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "edited": false, "score": 0, "creation_date": 1563327859, "post_id": 57060141, "comment_id": 100659472, "body": "Sorry I didn&#39;t make my question clear. I meant to ask, why am I receiving an error when I am trying to get bucket attributes when I am using default permission? Technically getting bucket attributes is just a read function, which I am supposed to be able to do with default permission right?"}, {"owner": {"reputation": 3621, "user_id": 9231144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63da0be227b72dd9dfdda45972952fde?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick W", "link": "https://stackoverflow.com/users/9231144/patrick-w"}, "reply_to_user": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "edited": false, "score": 0, "creation_date": 1563369515, "post_id": 57060141, "comment_id": 100676883, "body": "Something is going wrong with the default node service account getting mounted. The token is either expired or not being mounted into the request properly. It is best practice to mount your credentials directly into the application for the call (see the last link in my answer)"}, {"owner": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "edited": false, "score": 0, "creation_date": 1563389599, "post_id": 57060141, "comment_id": 100687835, "body": "Thanks for replying Patrick. I&#39;ve tried the recommended method to authenticate as well, but no luck unfortunately, was getting the same error :/ I believe my service account is mounted correctly, but I&#39;m not sure if token is expired or not. Is there any way I can check that? Like maybe I can log something from my image to see the service account&#39;s token status?"}, {"owner": {"reputation": 3621, "user_id": 9231144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63da0be227b72dd9dfdda45972952fde?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick W", "link": "https://stackoverflow.com/users/9231144/patrick-w"}, "reply_to_user": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "edited": false, "score": 0, "creation_date": 1563391020, "post_id": 57060141, "comment_id": 100688446, "body": "I would recommend to just generate a new token from the service accounts page and use that."}, {"owner": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "edited": false, "score": 0, "creation_date": 1563437406, "post_id": 57060141, "comment_id": 100701859, "body": "I have tested out running it on localhost, and it actually works without any problem. I was able to get the name of the service account I was using. However it still doesn&#39;t work on Google Kubernetes Engine. It makes sens that it works on my local machine as I was singed in through gcloud. Now I assume this means that somehow the authentication is off inside the cluster right? But how can that be? and how can I actually reset the authentication?"}, {"owner": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "edited": false, "score": 0, "creation_date": 1563439804, "post_id": 57060141, "comment_id": 100703117, "body": "Also, I did actually try to generate a new token from service account page and generate a key and followed the steps. However I was getting the same error. I feel like it has something to do with authenticating."}, {"owner": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "edited": false, "score": 0, "creation_date": 1563465339, "post_id": 57060141, "comment_id": 100718212, "body": "Thank you Patrick for trying to help! I figured it out. It was my careless mistake!"}, {"owner": {"reputation": 3621, "user_id": 9231144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63da0be227b72dd9dfdda45972952fde?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick W", "link": "https://stackoverflow.com/users/9231144/patrick-w"}, "reply_to_user": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "edited": false, "score": 0, "creation_date": 1563466157, "post_id": 57060141, "comment_id": 100718639, "body": "Could you let us know what it was in case others have the same issue?"}, {"owner": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "edited": false, "score": 0, "creation_date": 1563507520, "post_id": 57060141, "comment_id": 100730776, "body": "Of course Patrick, I answered my own question. But basically it was because I misplaced adding ca certificate to my image. Because I was using multi stage build in my dockerfile, the misplacing the adding of certificate caused my image to have to certificate and therefore unable to make https API calls to Google!"}], "tags": [], "owner": {"reputation": 3621, "user_id": 9231144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/63da0be227b72dd9dfdda45972952fde?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick W", "link": "https://stackoverflow.com/users/9231144/patrick-w"}, "is_accepted": false, "score": 0, "last_activity_date": 1563288938, "creation_date": 1563288938, "answer_id": 57060141, "question_id": 57056164, "link": "https://stackoverflow.com/questions/57056164/unable-to-access-google-cloud-storage-from-google-kubernetes-engine-using-defaul/57060141#57060141", "title": "Unable to access Google Cloud Storage from Google Kubernetes Engine using default service account and google cloud libraries", "body": "<p>If you are using the default cluster service account, you need to make sure the cluster has <a href=\"https://cloud.google.com/compute/docs/access/create-enable-service-accounts-for-instances#applications\" rel=\"nofollow noreferrer\">sufficient scopes to write to storage</a>. By <a href=\"https://cloud.google.com/sdk/gcloud/reference/container/clusters/create#--scopes\" rel=\"nofollow noreferrer\">default</a>, GKE clusters only have the read scope which blocks write attempts to GCS buckets.</p>\n\n<blockquote>\n  <p>gke-default:<br>\n  <a href=\"https://www.googleapis.com/auth/devstorage.read_only\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/devstorage.read_only</a><br>\n  <a href=\"https://www.googleapis.com/auth/logging.write\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/logging.write</a><br>\n  <a href=\"https://www.googleapis.com/auth/monitoring\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/monitoring</a><br>\n  <a href=\"https://www.googleapis.com/auth/service.management.readonly\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/service.management.readonly</a><br>\n  <a href=\"https://www.googleapis.com/auth/servicecontrol\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/servicecontrol</a><br>\n  <a href=\"https://www.googleapis.com/auth/trace.append\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/trace.append</a></p>\n</blockquote>\n\n<p>Without the write scope enabled, regardless of the credentials, you won't be able to write to buckets.</p>\n\n<blockquote>\n  <p>Note: You can use the access token only for scopes that you specified when you created the instance. For example, if the instance has been granted only the <a href=\"https://www.googleapis.com/auth/storage-full\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/storage-full</a> scope for Google Cloud Storage, then it can't use the access token to make a request to BigQuery.</p>\n</blockquote>\n\n<p>If you want to bypass scopes, create a custom service account for the application, download the JWT token and mount these credentials directly into your code. This is the <a href=\"https://cloud.google.com/kubernetes-engine/docs/tutorials/authenticating-to-cloud-platform\" rel=\"nofollow noreferrer\">recommended method to authenticate your application</a> against Google APIs</p>\n"}, {"tags": [], "owner": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "is_accepted": true, "score": 1, "last_activity_date": 1563465309, "creation_date": 1563465309, "answer_id": 57098464, "question_id": 57056164, "link": "https://stackoverflow.com/questions/57056164/unable-to-access-google-cloud-storage-from-google-kubernetes-engine-using-defaul/57098464#57098464", "title": "Unable to access Google Cloud Storage from Google Kubernetes Engine using default service account and google cloud libraries", "body": "<p>So I finally figured it out, just leaving this here if anyone ever runs into this problem too. It was my mistake of being very careless, but after reading this question :</p>\n\n<p><a href=\"https://stackoverflow.com/questions/52341878/cannot-exchange-accesstoken-from-google-api-inside-docker-container/52343054\">Cannot exchange AccessToken from Google API inside Docker container</a></p>\n\n<p>I was able to narrow it down to a certificate problem. It was actually because I did not install the ca-certificate properly. Because I was using multi stage build in my docker file, I misplaced this line of code :</p>\n\n<pre><code>RUN apk --no-cache add ca-certificates &amp;&amp; update-ca-certificates\n</code></pre>\n\n<p>After placing it correctly it worked! </p>\n"}], "owner": {"reputation": 155, "user_id": 1237381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652849bdd1ce1c5dc2d376613f3082b2?s=128&d=identicon&r=PG", "display_name": "andy", "link": "https://stackoverflow.com/users/1237381/andy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 0, "accepted_answer_id": 57098464, "answer_count": 2, "score": 0, "last_activity_date": 1563465309, "creation_date": 1563276289, "last_edit_date": 1563327916, "question_id": 57056164, "link": "https://stackoverflow.com/questions/57056164/unable-to-access-google-cloud-storage-from-google-kubernetes-engine-using-defaul", "title": "Unable to access Google Cloud Storage from Google Kubernetes Engine using default service account and google cloud libraries", "body": "<p>I wrote an application that has a function to upload image through Google Kubernetes Engine using go lang. Everything else works fine, but I kept running into problems when I try to write image to Google Cloud Storage.</p>\n\n<p>Here is my code in golang that actually uses the google storage api:</p>\n\n<pre><code>func putImage(imageURL string, image multipart.File) bool {\n    fmt.Println(\"Putting into image location : \" + imageURL)\n\n    contextBackground := context.Background()\n    storageClient, err := storage.NewClient(contextBackground)\n    if err != nil {\n        fmt.Println(\"No client.\")\n        return false\n    }\n\n    bucket := storageClient.Bucket(\"mytestbucketname\")\n    bucketWriter := bucket.Object(imageURL).NewWriter(contextBackground)\n    bucketWriter.ContentType = \"image/jpg\"\n    bucketWriter.CacheControl = \"public, max-age=0\"\n\n    size, err := io.Copy(bucketWriter, image)\n    if err != nil {\n        fmt.Println(\"failed to put image\")\n        return false\n    }\n\n    fmt.Println(size)\n    fmt.Println(\"Successfully put image\")\n    bucketWriter.Close()\n    return true\n}\n</code></pre>\n\n<p>The above function always returns true and size is always greater than 0. However, when I check the bucket, it does not actually have anything inside. So I researched around and realized that the default service account only has a read permission to Cloud Storage. Which is very weird because it should be returning false or size should be 0 or even outputting an error of permission denied. </p>\n\n<p>The official cloud.google.com/go/storage API says Bucket() function returns a BucketHandle that does not actually perform any network operations, which makes sense as to why I was not getting permission denied error (?). And so I decided to check if I am actually getting anything from the Client or Bucket, just to see if the read permission is working. I added the following code :</p>\n\n<pre><code>attr, err := bucket.Attrs(contextBackground)\nif err != nil {\n    fmt.Println(err.Error())\n}\nfmt.Println(\"bucket name : \" + attr.Name)\n</code></pre>\n\n<p>And at this point I started to get fatal errors that shuts down my application. The error I got when trying to retrieve bucket's attributes is this :</p>\n\n<pre><code>Get https://www.googleapis.com/storage/v1/b/mytestbucketname?alt=json&amp;prettyPrint=false&amp;projection=full: oauth2: cannot fetch token: Post https://oauth2.googleapis.com/token: x509: certificate signed by unknown authority\n</code></pre>\n\n<p>So I thought I need to add ca certificate to my image. But it just does not sound logical to me because if I was running my image in Google Kubernetes Engine and it was accessing my Google Cloud Storage, given that it already has a default service account with read permission, why would I need a certificate? I made a new cluster with version 1.12.8-gke.10 and made sure to disable issue client certificate and made sure I had read permission to Storage and still got the same error. And I added this line to my docker file and still got the same error:</p>\n\n<pre><code>RUN apk --no-cache add ca-certificates &amp;&amp; update-ca-certificates\n</code></pre>\n\n<p>I've been at it for two days and now I'm running out of ideas. My question is what am I doing wrong that keeps giving me \"x.509 certificate signed by unknown authority\" error when trying to access the Storage bucket attributes from Kubernetes Engine when I am using default permission? Technically getting bucket attributes is just a read function, which I am supposed to be able to do with default permission right? If anyone has any ideas or has ever ran into the same problem, please give me some help! Thanks!</p>\n"}, {"tags": ["amazon-web-services", "go"], "comments": [{"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 1, "creation_date": 1563273928, "post_id": 57055064, "comment_id": 100636765, "body": "&quot;<i>But when deployed to AWS the &quot;project&quot; folder doesn&#39;t exist of course</i>&quot; Could you clarify what you mean by that? Also, how do you &quot;<i>deploy</i>&quot; your project on AWS?"}, {"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1563274210, "post_id": 57055064, "comment_id": 100636906, "body": "have you considered using go modules? It may solve the problem for you. Is the project open-source? If no, you&#39;ll need to give the AWS ec2 access to the repo&#39;s dependencies. More about go modules -&gt; <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">blog.golang.org/using-go-modules</a>"}, {"owner": {"reputation": 357, "user_id": 9305335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a20ea3826649e5b45bc663b7e5111f?s=128&d=identicon&r=PG&f=1", "display_name": "Herco", "link": "https://stackoverflow.com/users/9305335/herco"}, "reply_to_user": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1563276649, "post_id": 57055064, "comment_id": 100638273, "body": "@GiulioMicheloni - I deploy to Elastic Beanstalk using the EB CLI (eb deploy). About the missing folder: locally I need to provide the full path from my GOPATH upwards, but these folders don&#39;t exist anywhere else but on my computer."}, {"owner": {"reputation": 357, "user_id": 9305335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a20ea3826649e5b45bc663b7e5111f?s=128&d=identicon&r=PG&f=1", "display_name": "Herco", "link": "https://stackoverflow.com/users/9305335/herco"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1563276742, "post_id": 57055064, "comment_id": 100638324, "body": "@kabanek I will read up on modules, thank you."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 1, "creation_date": 1563279879, "post_id": 57055064, "comment_id": 100640022, "body": "@Herco, are you deploying only the <code>application.go</code>? You need to deploy the entire folder of your project, i.e. also the dependency packages. According to AWS EB doc: &quot;<i>If git is installed, EB CLI uses the git archive command to create a .zip file from the contents of the most recent git commit command.</i>&quot;.  So, try to create a git repo in your project folder and then deploy again. If all your dependencies are in the project folder (maybe under a <code>vendor</code> folder), then you should be able to build it also inside the AWS VM."}, {"owner": {"reputation": 357, "user_id": 9305335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a20ea3826649e5b45bc663b7e5111f?s=128&d=identicon&r=PG&f=1", "display_name": "Herco", "link": "https://stackoverflow.com/users/9305335/herco"}, "reply_to_user": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1563283804, "post_id": 57055064, "comment_id": 100642441, "body": "@GiulioMicheloni Yes, I have a repo, I am committing and pushing with Git first, then <code>eb deploy</code> deploys/copies the entire branch. But once I create a package in a subfolder of the project, the import commands differ on local v.s. deployed since locally I need to specify the path including the project folder itself (which does not exist in Beanstalk)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563283953, "post_id": 57055064, "comment_id": 100642532, "body": "The normal deployment mechanism for Go is to build the project, which produces a self-contained binary, and to deploy that binary - <i>not</i> the source code. A production machine running a Go application does not need the Go source files and does not need the Go toolchain installed."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563284866, "post_id": 57055064, "comment_id": 100643114, "body": "It looks like you&#39;re using relative import paths. Don&#39;t do that! <a href=\"https://stackoverflow.com/questions/38517593/relative-imports-in-go\" title=\"relative imports in go\">stackoverflow.com/questions/38517593/relative-imports-in-go</a>"}, {"owner": {"reputation": 357, "user_id": 9305335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a20ea3826649e5b45bc663b7e5111f?s=128&d=identicon&r=PG&f=1", "display_name": "Herco", "link": "https://stackoverflow.com/users/9305335/herco"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563288137, "post_id": 57055064, "comment_id": 100645308, "body": "@Adrian Thanks, I&#39;ve got it working. It feels a bit weird though, coming from other languages/stacks. If you write it as an answer I&#39;ll verify."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1563288972, "creation_date": 1563288972, "answer_id": 57060150, "question_id": 57055064, "link": "https://stackoverflow.com/questions/57055064/golang-deployment-on-aws/57060150#57060150", "title": "Golang deployment on AWS", "body": "<p>The normal deployment mechanism for Go is to build the project, which produces a self-contained binary, and to deploy that binary - not the source code. A production machine running a Go application does not need the Go source files and does not need the Go toolchain installed. Go is not an interpreted language, it's not even a bytecode language with a VM (like Java with JVM or C# with CLR); it produces native binaries for the target OS and architecture. That's one of the reasons for its strong performance and efficient memory profile.</p>\n"}], "owner": {"reputation": 357, "user_id": 9305335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a20ea3826649e5b45bc663b7e5111f?s=128&d=identicon&r=PG&f=1", "display_name": "Herco", "link": "https://stackoverflow.com/users/9305335/herco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 57060150, "answer_count": 1, "score": -2, "last_activity_date": 1563288972, "creation_date": 1563272401, "question_id": 57055064, "link": "https://stackoverflow.com/questions/57055064/golang-deployment-on-aws", "title": "Golang deployment on AWS", "body": "<p>I have some Go code I want to test locally, then deploy to AWS. Everything is fine as long as I stay in a single directory/package.</p>\n\n<p>However, I want my folder structure to be similar to this:</p>\n\n<p><code>$GOPATH/src/project/application.go</code></p>\n\n<p><code>$GOPATH/src/project/lib1/libcode.go</code></p>\n\n<p>Locally, to use the code in \"lib1\" I need to use <code>import \"project/lib1\"</code></p>\n\n<p>But when deployed to AWS the \"project\" folder doesn't exist of course, so instead I have to use <code>import \"./lib1\"</code></p>\n\n<p>I can probably solve this problem by either having all code in a single folder/package, or by changing my $GOROOT every time I change working on a project, but both these workarounds feel dirty and awkward.</p>\n\n<p>What's the correct way to tackle this? Thanks.</p>\n"}, {"tags": ["go", "timezone"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563269113, "post_id": 57053837, "comment_id": 100634289, "body": "A cleaner approach would be to use DI. Put all of your TZ-handling code in one place, and depend on a configured value (rather than a global state). This will also avoid bugs when using other libraries that depend on the actual local time zone (i.e. logging libraries)."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563271859, "post_id": 57053837, "comment_id": 100635698, "body": "You can see in the code that Local is just a pointer to another value that you cannot change. Making the two inconsistent is just asking for trouble. Don&#39;t do it."}, {"owner": {"reputation": 5272, "user_id": 26494, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/3ea96d840e7ca7b09b61f5ded4050624?s=128&d=identicon&r=PG", "display_name": "pihentagy", "link": "https://stackoverflow.com/users/26494/pihentagy"}, "edited": false, "score": 1, "creation_date": 1563279309, "post_id": 57053837, "comment_id": 100639669, "body": "Then why it is not a <code>const</code>?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563279858, "post_id": 57053837, "comment_id": 100640009, "body": "@pihentagy Because a) its value is not a compile-time value, b) there are no pointer constants in Go."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1563290351, "last_edit_date": 1563290351, "creation_date": 1563288460, "answer_id": 57059986, "question_id": 57053837, "link": "https://stackoverflow.com/questions/57053837/globally-setting-timezone-in-go-by-setting-local/57059986#57059986", "title": "Globally setting timezone in go by setting Local", "body": "<p>Setting <code>time.Local</code> does have an effect on the <code>time</code> local time zone.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    now := time.Now().Round(0)\n    fmt.Println(now, time.Local)\n\n    loc, err := time.LoadLocation(\"America/Atka\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    time.Local = loc\n\n    now = time.Now().Round(0)\n    fmt.Println(now, time.Local)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2019-07-16 10:45:41.263418395 -0400 EDT Local\n2019-07-16 05:45:41.263530699 -0900 HDT America/Atka\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/XBxO2toH-SJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XBxO2toH-SJ</a></p>\n"}], "owner": {"reputation": 5272, "user_id": 26494, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/3ea96d840e7ca7b09b61f5ded4050624?s=128&d=identicon&r=PG", "display_name": "pihentagy", "link": "https://stackoverflow.com/users/26494/pihentagy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 1, "accepted_answer_id": 57059986, "answer_count": 1, "score": 3, "last_activity_date": 1610037856, "creation_date": 1563268276, "last_edit_date": 1610037856, "question_id": 57053837, "link": "https://stackoverflow.com/questions/57053837/globally-setting-timezone-in-go-by-setting-local", "title": "Globally setting timezone in go by setting Local", "body": "<p>Related to <a href=\"https://stackoverflow.com/questions/54363451/setting-timezone-globally-in-golang\">Setting timezone globally in golang</a></p>\n<p>In <code>zoneinfo.go</code> you can find the following</p>\n<pre><code>// Local represents the system's local time zone.\nvar Local *Location = &amp;localLoc\n</code></pre>\n<p>which suggest that you have a global modifiable Local, and you can set it. By setting it, should it have effect to timezones?</p>\n"}, {"tags": ["go", "enums", "constants", "iota"], "answers": [{"comments": [{"owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "edited": false, "score": 0, "creation_date": 1563269255, "post_id": 57053431, "comment_id": 100634372, "body": "Great, what I needed."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1563270854, "last_edit_date": 1563270854, "creation_date": 1563266766, "answer_id": 57053431, "question_id": 57053373, "link": "https://stackoverflow.com/questions/57053373/how-to-skip-a-lot-of-values-when-define-const-variable-with-iota/57053431#57053431", "title": "How to skip a lot of values when define const variable with iota?", "body": "<h2>Single group, manual offset</h2>\n\n<p>You may shift the <a href=\"https://golang.org/ref/spec#Iota\" rel=\"nofollow noreferrer\"><code>iota</code></a> with a constant, and leave subsequent initialization expressions empty:</p>\n\n<pre><code>const (\n    APPLE = iota\n    ORANGE\n    PEAR\n    BANANA = iota + 96 // 96 is manually calculated to get 99\n    GRAPE\n)\nfmt.Println(APPLE, ORANGE, PEAR, BANANA, GRAPE)\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/5T49-crUMXZ\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0 1 2 99 100\n</code></pre>\n\n<p>Although if you insert elements before <code>BANANA</code>, values of <code>BANANA</code> and subsequent constants will change.</p>\n\n<h2>Breaking the constant group</h2>\n\n<p>If you want to avoid that, break the constant group, and start a new (the value of <code>iota</code> is reset to <code>0</code> whenever the reserved word <code>const</code> appears in the source):</p>\n\n<pre><code>const (\n    APPLE = iota\n    ORANGE\n    PEAR\n)\nconst (\n    BANANA = iota + 99 // iota is reset to 0\n    GRAPE\n)\nfmt.Println(APPLE, ORANGE, PEAR, BANANA, GRAPE)\n</code></pre>\n\n<p>Output is the same. Try this one on the <a href=\"https://play.golang.org/p/-wyw6LoavHV\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h2>Single group, automatic offset</h2>\n\n<p>If you don't want to break the constant group, there is still a solution.</p>\n\n<p>Introduce a constant in the place where you want to \"break\" the numbering, and subtract its value from <code>iota</code> in the the subsequent line. This will result in <code>1</code>, and so shift this with the amount minus 1 you want to continue from. This way even if you insert elements before <code>BANANA</code> (but not between <code>_BREAK</code> and <code>BANANA</code>), ordinals of <code>BANANA</code> and subsequent constants won't change.</p>\n\n<pre><code>const (\n    APPLE = iota\n    ORANGE\n    PEAR\n\n    _BREAK\n\n    BANANA = iota - _BREAK + 98 // Continues from 98 + 1 = 99\n    GRAPE\n)\nfmt.Println(APPLE, ORANGE, PEAR, BANANA, GRAPE)\n</code></pre>\n\n<p>Output again is the same. Try it on the <a href=\"https://play.golang.org/p/dsvHEVBkJk5\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Depending on your taste, <code>_BREAK</code> may be initialized with <code>iota + 1</code>, so the offset to apply on the next constant will be the value it gets:</p>\n\n<pre><code>const (\n    APPLE = iota\n    ORANGE\n    PEAR\n\n    _BREAK = iota + 1\n\n    BANANA = iota - _BREAK + 99 // Continues from 99\n    GRAPE\n)\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/8cMDD7CCCP5\" rel=\"nofollow noreferrer\">Go Playground</a>. Use whichever looks easier to you.</p>\n"}], "owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 0, "accepted_answer_id": 57053431, "answer_count": 1, "score": 1, "last_activity_date": 1563270854, "creation_date": 1563266575, "last_edit_date": 1563267108, "question_id": 57053373, "link": "https://stackoverflow.com/questions/57053373/how-to-skip-a-lot-of-values-when-define-const-variable-with-iota", "title": "How to skip a lot of values when define const variable with iota?", "body": "<p>Say I have next c program:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(int args, char* argv[])\n{\n    enum RC {\n        APPLE=0,\n        ORANGE,\n        PEAR,\n        BANANA=99,\n        GRAPE\n    };\n\n    printf(\"%d, %d, %d, %d, %d\\n\", APPLE, ORANGE, PEAR, BANANA, GRAPE);\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<blockquote>\n  <p>0, 1, 2, 99, 100</p>\n</blockquote>\n\n<p><strong>If in go, how can I use a <code>more golang way</code> to handle that?</strong></p>\n\n<p>In fact, if I just want to skip some value. e.g. print <code>0, 1, 2, 5, 6</code>, then I can use next to skip some value, but here I need to skip 96 values...</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    const (\n        APPLE = iota\n        ORANGE\n        PEAR\n        _\n        _\n        BANANA\n        GRAPE\n    )\n    fmt.Println(APPLE, ORANGE, PEAR, BANANA, GRAPE)\n}\n</code></pre>\n\n<p>And, also I can use next, but I still have many const variable after <code>GRAPE</code>...</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    const (\n        APPLE = iota\n        ORANGE\n        PEAR\n        BANANA = 99\n        GRAPE  = 100\n    )\n    fmt.Println(APPLE, ORANGE, PEAR, BANANA, GRAPE)\n}\n</code></pre>\n\n<p>So, is there any <code>more golang way</code> for me to handle such kind of situation?</p>\n"}, {"tags": ["algorithm", "dictionary", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1563265714, "post_id": 57052877, "comment_id": 100632412, "body": "To make the map safe for concurrent use."}, {"owner": {"reputation": 127, "user_id": 10346002, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LO9i_UwB4uQ/AAAAAAAAAAI/AAAAAAAAABY/C-PKbEbH5iA/photo.jpg?sz=128", "display_name": "Martin Inf1n1ty", "link": "https://stackoverflow.com/users/10346002/martin-inf1n1ty"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563267061, "post_id": 57052877, "comment_id": 100633185, "body": "@icza, please define &quot;map safe&quot;?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1563267205, "post_id": 57052877, "comment_id": 100633272, "body": "You can&#39;t write and/or read the same variable from multiple goroutines concurrently without explicit synchronization. <code>sync.RWMutex</code> can be used to synchronize access to a variable."}], "owner": {"reputation": 127, "user_id": 10346002, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LO9i_UwB4uQ/AAAAAAAAAAI/AAAAAAAAABY/C-PKbEbH5iA/photo.jpg?sz=128", "display_name": "Martin Inf1n1ty", "link": "https://stackoverflow.com/users/10346002/martin-inf1n1ty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 38, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563265355, "creation_date": 1563264915, "last_edit_date": 1563265355, "question_id": 57052877, "link": "https://stackoverflow.com/questions/57052877/implementation-dictonary-structure-with-valuedictionary-lock-sync-rwmutex", "title": "Implementation dictonary structure with ValueDictionary lock sync.RwMutex", "body": "<p>I checked how I may implemented dictionary in go-lang,</p>\n\n<p>Why we have \n<a href=\"https://flaviocopes.com/golang-data-structure-dictionary/\" rel=\"nofollow noreferrer\">https://flaviocopes.com/golang-data-structure-dictionary/</a>? </p>\n\n<pre><code>type ValueDictionary struct {\n    items map[Key]Value\n    lock  sync.RWMutex\n}\n</code></pre>\n\n<p>From official documentation we have </p>\n\n<blockquote>\n  <p>Package <strong>sync</strong> provides basic synchronization primitives such as mutual exclusion locks. </p>\n</blockquote>\n\n<p>Why we used lock ?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1563263185, "post_id": 57052228, "comment_id": 100631109, "body": "Pre-declare both variables before the <code>if</code> and inside the <code>if</code> / <code>else</code> blocks use <code>=</code> instead of <code>:=</code> to assign values to them."}, {"owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563263663, "post_id": 57052228, "comment_id": 100631370, "body": "@mkopriva works, write it as an answer and I will mark it"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1563263910, "creation_date": 1563263910, "answer_id": 57052614, "question_id": 57052228, "link": "https://stackoverflow.com/questions/57052228/failed-to-get-variables-data-inside-if-else-condition-undefined-err-go/57052614#57052614", "title": "Failed to get variables data inside if..else condition: &quot;undefined err go&quot;", "body": "<p>Pre-declare both variables before the <code>if</code> and inside the <code>if</code> / <code>else</code> blocks use <code>=</code> instead of <code>:=</code> to assign values to them.</p>\n\n<p>Read more here:</p>\n\n<p><a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">Declarations and scope</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow noreferrer\">Variable declarations</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">Short variable declarations</a></p>\n"}], "owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 57052614, "answer_count": 1, "score": -4, "last_activity_date": 1563263910, "creation_date": 1563262575, "question_id": 57052228, "link": "https://stackoverflow.com/questions/57052228/failed-to-get-variables-data-inside-if-else-condition-undefined-err-go", "title": "Failed to get variables data inside if..else condition: &quot;undefined err go&quot;", "body": "<p>I am trying to use HTTP Get with the use of <code>if..else</code> condition but I am getting an error:  </p>\n\n<blockquote>\n  <p>undefined: err go</p>\n</blockquote>\n\n<p>This is my code:  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc main() {\n    num := 0\n    if num == 0{\n        resp, err := http.Get(\"https://httpbin.org/get\")\n    }else{\n        resp, err := http.Get(\"https://google.com\")\n    }\n\n    if err != nil {\n        fmt.Println(\"error\")\n    }\n\n    fmt.Println(resp.StatusCode)\n}\n</code></pre>\n\n<p>I tried to defined the variables before the call:  </p>\n\n<pre><code>var err error\nvar resp *http.Response\n</code></pre>\n\n<p>But then I received a different error:  </p>\n\n<blockquote>\n  <p>err declared and not used  </p>\n</blockquote>\n\n<p>Any idea how I can solve it and why it happens ?<br>\nBecause any way the <code>resp</code> and <code>err</code> should be received by the <code>Get</code> request.  </p>\n"}, {"tags": ["go", "kubernetes", "kubebuilder"], "answers": [{"comments": [{"owner": {"reputation": 1242, "user_id": 3873424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9NddA.jpg?s=128&g=1", "display_name": "Ottovsky", "link": "https://stackoverflow.com/users/3873424/ottovsky"}, "edited": false, "score": 0, "creation_date": 1563289561, "post_id": 57058870, "comment_id": 100646184, "body": "Yes, documentation is definitely buggy. the unstructured method GetNamespace() is explicitly using &quot;metadata&quot; field to reach its value: <a href=\"https://github.com/kubernetes/apimachinery/blob/master/pkg/apis/meta/v1/unstructured/unstructured.go#L233\" rel=\"nofollow noreferrer\">github.com/kubernetes/apimachinery/blob/master/pkg/apis/meta&zwnj;&#8203;/v1/&hellip;</a>  :)"}, {"owner": {"reputation": 802, "user_id": 6904128, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7yIQ.jpg?s=128&g=1", "display_name": "Spazzy757", "link": "https://stackoverflow.com/users/6904128/spazzy757"}, "reply_to_user": {"reputation": 1242, "user_id": 3873424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9NddA.jpg?s=128&g=1", "display_name": "Ottovsky", "link": "https://stackoverflow.com/users/3873424/ottovsky"}, "edited": false, "score": 0, "creation_date": 1563303929, "post_id": 57058870, "comment_id": 100652965, "body": "Thanks for the help! I had been struggling with this for about a week"}], "tags": [], "owner": {"reputation": 802, "user_id": 6904128, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7yIQ.jpg?s=128&g=1", "display_name": "Spazzy757", "link": "https://stackoverflow.com/users/6904128/spazzy757"}, "is_accepted": true, "score": 4, "last_activity_date": 1563285058, "creation_date": 1563285058, "answer_id": 57058870, "question_id": 57051860, "link": "https://stackoverflow.com/questions/57051860/rbac-rules-with-kubebuilder/57058870#57058870", "title": "Rbac rules with Kubebuilder", "body": "<p>So seperatley from what the docs stated at <a href=\"https://godoc.org/sigs.k8s.io/controller-runtime/pkg/client\" rel=\"nofollow noreferrer\">https://godoc.org/sigs.k8s.io/controller-runtime/pkg/client</a> when you define the type unstructured.Unstructured you need to set the namespace and name in the metadata field as such:</p>\n\n<pre><code>u.Object = map[string]interface{}{\n        \"metadata\": map[string]interface{}{\n            \"name\":      \"name\",\n            \"namespace\": \"namespace\"},\n        \"spec\": map[string]interface{}{\n            \"replicas\": 2,\n            \"selector\": map[string]interface{}{\n                \"matchLabels\": map[string]interface{}{\n                    \"foo\": \"bar\",\n                },\n            },\n            \"template\": map[string]interface{}{\n                \"labels\": map[string]interface{}{\n                    \"foo\": \"bar\",\n                },\n                \"spec\": map[string]interface{}{\n                    \"containers\": []map[string]interface{}{\n                        {\n                            \"name\":  \"nginx\",\n                            \"image\": \"nginx\",\n                        },\n                    },\n                },\n            },\n        },\n    }\n</code></pre>\n\n<p>otherwise unstructured client reads it as cluster scoped resource deployments, which does not exist</p>\n"}], "owner": {"reputation": 802, "user_id": 6904128, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7yIQ.jpg?s=128&g=1", "display_name": "Spazzy757", "link": "https://stackoverflow.com/users/6904128/spazzy757"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 1, "accepted_answer_id": 57058870, "answer_count": 1, "score": 1, "last_activity_date": 1563285058, "creation_date": 1563261141, "question_id": 57051860, "link": "https://stackoverflow.com/questions/57051860/rbac-rules-with-kubebuilder", "title": "Rbac rules with Kubebuilder", "body": "<p>My probelm is that i am trying to use the <code>unstructured.Unstructured</code> type to create a deployment as such:</p>\n\n<pre><code>// +kubebuilder:rbac:groups=stable.resource.operator.io,resources=resource,verbs=get;list;watch;create;update;patch;delete\n// +kubebuilder:rbac:groups=stable.resource.operator.io,resources=resource/status,verbs=get;update;patch\n// +kubebuilder:rbac:groups=apps,resources=deployments,verbs=get;list;watch;create;update;patch;delete\n// +kubebuilder:rbac:groups=apps,resources=deployments/status,verbs=get;list;watch;create;update;patch;delete\nfunc (r *ResourceReconciler) Reconcile(req ctrl.Request) (ctrl.Result, error) {\n\n    ctx := context.Background()\n    log := r.Log.WithValues(\"resource\", req.NamespacedName)\n    instance := &amp;stablev1.Resource{}\n    // your logic here\n\n    if err := r.Get(ctx, req.NamespacedName, instance); err != nil {\n        log.Error(err, \"unable to fetch Resource\")\n        // we'll ignore not-found errors, since they can't be fixed by an immediate\n        // requeue (we'll need to wait for a new notification), and we can get them\n        // on deleted requests.\n        return ctrl.Result{}, ignoreNotFound(err)\n    }\n    // your logic here\n    u := &amp;unstructured.Unstructured{}\n    u.Object = map[string]interface{}{\n        \"name\":      \"name\",\n        \"namespace\": \"namespace\",\n        \"spec\": map[string]interface{}{\n            \"replicas\": 2,\n            \"selector\": map[string]interface{}{\n                \"matchLabels\": map[string]interface{}{\n                    \"foo\": \"bar\",\n                },\n            },\n            \"template\": map[string]interface{}{\n                \"labels\": map[string]interface{}{\n                    \"foo\": \"bar\",\n                },\n                \"spec\": map[string]interface{}{\n                    \"containers\": []map[string]interface{}{\n                        {\n                            \"name\":  \"nginx\",\n                            \"image\": \"nginx\",\n                        },\n                    },\n                },\n            },\n        },\n    }\n    u.SetGroupVersionKind(schema.GroupVersionKind{\n        Group:   \"apps\",\n        Kind:    \"Deployment\",\n        Version: \"v1\",\n    })\n    err = r.Create(context.Background(), u)\n    log.Error(err, \"unable to get object\")\n    log.V(1).Info(\"reconciling\")\n    return ctrl.Result{}, nil\n\n}\n</code></pre>\n\n<p>My understanding is that I have specified the rbac rules, my operator should be able to create said Deployment, but I am still getting the error:</p>\n\n<pre><code>the server does not allow this method on the requested resource\n</code></pre>\n\n<p>All the examples I have seen are based of using the actual deployment type, I cant find anywhere where there is an example of doing this with type unstructured, am i missing something?\nJust to save time, I have tried:</p>\n\n<ul>\n<li>Applying the clusterroles manually</li>\n<li>Given the operator cluster-admin</li>\n<li>used both make run and make deploy (obviously after running make manifests etc..)</li>\n<li>The roles generator is working</li>\n<li>I have started a new project to make sure me playing around with env is not the cause</li>\n</ul>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 125670, "user_id": 6464308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/12PVX.jpg?s=128&g=1", "display_name": "Laurenz Albe", "link": "https://stackoverflow.com/users/6464308/laurenz-albe"}, "edited": false, "score": 0, "creation_date": 1563259630, "post_id": 57051379, "comment_id": 100629428, "body": "If the database goes into recovery, that means that the server has crashed. This is a bug and shouldn&#39;t happen. Look at the database log and <a href=\"https://wiki.postgresql.org/wiki/Generating_a_stack_trace_of_a_PostgreSQL_backend\" rel=\"nofollow noreferrer\">get a stack trace</a>. Are you using any extensions? PostgreSQL cannot be configured to use multi-threading; what do you mean? Problems with PostgreSQL v12 should be reported to the pgsql-hackers mailing list, since it is in beta. Make sure you include the information I asked for here."}, {"owner": {"reputation": 78, "user_id": 8950009, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-z-FJw8PQ8AU/AAAAAAAAAAI/AAAAAAAAADY/YwbcPWTdLPI/photo.jpg?sz=128", "display_name": "Gaziz Zhaiyk", "link": "https://stackoverflow.com/users/8950009/gaziz-zhaiyk"}, "edited": false, "score": 0, "creation_date": 1563261682, "post_id": 57051379, "comment_id": 100630362, "body": "Thanks for quick answers. Excuse me for misleading you. There is Postgres 11.01."}], "owner": {"reputation": 78, "user_id": 8950009, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-z-FJw8PQ8AU/AAAAAAAAAAI/AAAAAAAAADY/YwbcPWTdLPI/photo.jpg?sz=128", "display_name": "Gaziz Zhaiyk", "link": "https://stackoverflow.com/users/8950009/gaziz-zhaiyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 241, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563301635, "creation_date": 1563259162, "last_edit_date": 1563301635, "question_id": 57051379, "link": "https://stackoverflow.com/questions/57051379/problems-with-updating-or-deleting-rows-in-postgresql", "title": "Problems with updating or deleting rows in postgresql", "body": "<p>I created the golang web api with postgresql <code>v11.01</code>. All works fine but some times I faced some problem with DB. When I try to delete or update some row in DB, DB going to Recovery mode and row that I tried to Update or delete is not affected. This problem is occurred randomly in random tables. </p>\n\n<p>First time I thought that there some problems with my code, and I rewrote it with transactions but it is not helped me.\nWhen I try to update row with DBForge, this app also hangs.</p>\n\n<p>Also I thought that it was a problem with concurrency in golang, I also rewrote my code without concurrency. Did not help.</p>\n\n<p>DB also configured to use multi-threading.</p>\n\n<p>It is my endpoint controller for deletion:</p>\n\n<pre><code>var DeleteAntenna = func(res http.ResponseWriter, req *http.Request) {\nantenna_id := req.URL.Query().Get(\"antenna_id\")\ntx, err := database.DB.Begin()\nif err != nil {\n    fmt.Println(err.Error())\n    http.Error(res, err.Error(), 400)\n    tx.Rollback()\n    return\n}\n\n_, err = tx.Exec(\"UPDATE new_rollout_managment.cell SET antenna_id = NULL WHERE antenna_id = $1;\", antenna_id)\nif err != nil {\n    fmt.Println(err.Error())\n    http.Error(res, err.Error(), 400)\n    return\n}\n\n_, err = tx.Exec(`DELETE FROM \"new_rollout_managment\".antenna WHERE id = $1;`, antenna_id)\nif err != nil {\n    fmt.Println(err.Error())\n    http.Error(res, err.Error(), 400)\n    tx.Rollback()\n    return\n}\ndefer tx.Commit()\nresp := u.Message(true, \"Deleted\")\nresp[\"Deleted_antenna\"] = antenna_id\n\nu.Respond(res, resp)\n</code></pre>\n\n<p>}</p>\n\n<p>Please share any ideas</p>\n"}, {"tags": ["amazon-web-services", "go", "caching", "aws-codebuild"], "comments": [{"owner": {"reputation": 3225, "user_id": 2023963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mQ5mE.jpg?s=128&g=1", "display_name": "Joel Duckworth", "link": "https://stackoverflow.com/users/2023963/joel-duckworth"}, "edited": false, "score": 0, "creation_date": 1588405550, "post_id": 57050660, "comment_id": 108886133, "body": "Did you figure this out? I&#39;m trying to do the same..."}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "reply_to_user": {"reputation": 3225, "user_id": 2023963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mQ5mE.jpg?s=128&g=1", "display_name": "Joel Duckworth", "link": "https://stackoverflow.com/users/2023963/joel-duckworth"}, "edited": false, "score": 0, "creation_date": 1588411712, "post_id": 57050660, "comment_id": 108888061, "body": "@JoelDuckworth sorry I never figured it out in the end."}], "answers": [{"tags": [], "owner": {"reputation": 3225, "user_id": 2023963, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mQ5mE.jpg?s=128&g=1", "display_name": "Joel Duckworth", "link": "https://stackoverflow.com/users/2023963/joel-duckworth"}, "is_accepted": true, "score": 1, "last_activity_date": 1588502862, "creation_date": 1588502862, "answer_id": 61573181, "question_id": 57050660, "link": "https://stackoverflow.com/questions/57050660/caching-go-modules-in-codebuild-without-custom-docker-image/61573181#61573181", "title": "caching go modules in codebuild without custom docker image", "body": "<p>To get it working with the default CodeBuild Ubuntu build image (I'm using v4)</p>\n\n<ol>\n<li><p>Make sure that local caching is enabled on the CodeBuild project. Go to to edit then artifacts then make sure Custom Cache is ticked\n<a href=\"https://i.stack.imgur.com/cZzeK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/cZzeK.png\" alt=\"Codebuild local cache settings\"></a></p></li>\n<li><p>Set the path to cache as <code>/go/pkg/**.*</code></p></li>\n</ol>\n\n<pre><code>cache:\n  paths:\n    - '/go/pkg/**/*'\n</code></pre>\n\n<ol start=\"3\">\n<li>Make sure your build script includes a step before building for <code>go mod download</code>. <strong>Before I did this caching didn't seem to work so this seemed a key step.</strong></li>\n</ol>\n\n<p>Here is my full buildspec.yml for reference</p>\n\n<pre><code>version: 0.2\n\nphases:\n  install:\n    runtime-versions:\n      golang: latest\n    commands:\n      - \"git config --global credential.helper '!aws codecommit credential-helper $@'\"\n      - \"git config --global credential.UseHttpPath true\"\n  build:\n    commands:\n      - 'go mod edit -dropreplace git-codecommit.ap-southeast-2.amazonaws.com/v1/repos/xyz'\n      - 'go mod download'\n      # Use latest from develop for the build (test env only)\n      - 'go get git-codecommit.ap-southeast-2.amazonaws.com/v1/repos/xyz@develop'\n      - 'rm -rf \"dist\"'\n      - 'cp -r \"eb-template\" \"dist\"'\n      - 'env GOOS=linux GOARCH=amd64 go build -o \"dist/bin/server\"'\n      - 'go mod edit -replace git-codecommit.ap-southeast-2.amazonaws.com/v1/repos/xyz=../xyz'\n      - 'echo -n ${CODEBUILD_RESOLVED_SOURCE_VERSION} &gt; dist/commithash'\n\nartifacts:\n  base-directory: dist\n  files:\n    - '**/*'\n\ncache:\n  paths:\n    - '/go/pkg/**/*'\n</code></pre>\n"}], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 0, "accepted_answer_id": 61573181, "answer_count": 1, "score": 5, "last_activity_date": 1588502862, "creation_date": 1563255526, "question_id": 57050660, "link": "https://stackoverflow.com/questions/57050660/caching-go-modules-in-codebuild-without-custom-docker-image", "title": "caching go modules in codebuild without custom docker image", "body": "<h1>TL;DR</h1>\n\n<p>How can I cache my modules in codebuild using AWS provided image (Go 1.12)?</p>\n\n<h1>Background</h1>\n\n<p>I'm trying to cache go modules in codebuild using the go image (1.12) from AWS.</p>\n\n<h2>Trying to cache /go/pkg/mod</h2>\n\n<p>After digging deeper, I found that there is no <code>/go/pkg</code> folder in that image. Hence, when I tried to cache <code>/go/pkg</code> it would throw an error.</p>\n\n<blockquote>\n  <p>Error mounting /go/pkg/mod: symlink /codebuild/local-cache/custom//go/pkg/mod /go/pkg/mod: no such file or directory</p>\n</blockquote>\n\n<p>Even after I run <code>go mod download</code> (which will create the <code>/go/pkg/mod</code>, it won't cache the folder because codebuild cannot mounted it earlier).</p>\n\n<p>This is my <code>codebuild.yml</code></p>\n\n<pre><code>version: 0.2\n\nphases:\n  install:\n    runtime-versions:\n      golang: 1.12\n      nodejs: 10\n    commands:\n      - npm install\n  build:\n    commands:\n      - go build -ldflags=\"-s -w\" -o api/bin/main api/main.go\ncache:\n  paths:\n    - /go/src/**/*\n    - /go/pkg/mod/**/*\n</code></pre>\n\n<h2>Trying to cache ./vendor</h2>\n\n<p>I also tried caching ./vendor folder which doesn't throw any errors in codebuild. However, I don't think it's caching anything because the build time doesn't decrease. It also says it ignores the symlink.</p>\n\n<blockquote>\n  <p>warning: ignoring symlink /codebuild/output/src074479210/src/github.com/kkesley/myrepo/vendor \n  go: finding github.com/aws/aws-lambda-go v1.11.1 \n  go: finding github.com/stretchr/testify v1.2.1 \n  go: finding github.com/pmezard/go-difflib v1.0.0 \n  go: finding github.com/davecgh/go-spew v1.1.0 \n  go: finding gopkg.in/urfave/cli.v1 v1.20.0 \n  go: downloading github.com/aws/aws-lambda-go v1.11.1 \n  go: extracting github.com/aws/aws-lambda-go v1.11.1 </p>\n</blockquote>\n\n<p>This is my <code>codebuild.yml</code> for this version:</p>\n\n<pre><code>version: 0.2\n\nphases:\n  install:\n    runtime-versions:\n      golang: 1.12\n      nodejs: 10\n    commands:\n      - npm install\n      - go mod vendor\n  build:\n    commands:\n      - go build -mod vendor -ldflags=\"-s -w\" -o api/bin/main api/main.go\ncache:\n  paths:\n    - /go/src/**/*\n    - vendor/**/*\n</code></pre>\n\n<h1>Question</h1>\n\n<p>How do you cache go modules in code build without using custom docker image? Is it possible?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1563253742, "post_id": 57050355, "comment_id": 100627459, "body": "Show <code>curl -v http:&#47;&#47;www.mtsoukalo.eu&#47;</code>"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1563254745, "post_id": 57050355, "comment_id": 100627722, "body": "The document says that &quot;Do sends an HTTP request and returns an HTTP response, following policy (such as redirects, cookies, auth) as configured on the client.&quot; so maybe the http response is redirecting to https."}, {"owner": {"reputation": 11, "user_id": 4896444, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-E3mo7itge3o/AAAAAAAAAAI/AAAAAAAAABU/TvSMDJFEtI4/photo.jpg?sz=128", "display_name": "Olumide Ogundele", "link": "https://stackoverflow.com/users/4896444/olumide-ogundele"}, "edited": false, "score": 0, "creation_date": 1563296777, "post_id": 57050355, "comment_id": 100649872, "body": "Yeah, thank you. I also thought so that the server is making a redirect from http to https."}], "owner": {"reputation": 11, "user_id": 4896444, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-E3mo7itge3o/AAAAAAAAAAI/AAAAAAAAABU/TvSMDJFEtI4/photo.jpg?sz=128", "display_name": "Olumide Ogundele", "link": "https://stackoverflow.com/users/4896444/olumide-ogundele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563253617, "creation_date": 1563253617, "question_id": 57050355, "link": "https://stackoverflow.com/questions/57050355/does-golang-cache-request-to-both-http-https-version-of-a-url", "title": "Does Golang cache request to both `http/https` version of a URL?", "body": "<p>I am currently working with the <code>net/http</code> package to make a request by passing the URL from the command line but what I discovered was that :\nA cache is made for the request to both <code>http/https</code> version of a URL I am testing with</p>\n\n<p>I have tried reading about the package <code>net/http</code> Do method\n<a href=\"https://golang.org/pkg/net/http/#Client.Do\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Client.Do</a></p>\n\n<pre><code>httpResponse, err := c.Do(request)\n    if err != nil {\n        fmt.Println(\"An error occurred from the response \", err.Error(), URL)\n        os.Exit(100)\n    }\n</code></pre>\n\n<p>Scenario 1:\n<code>go run web/webClient/webClient.go https://www.mtsoukalos.eu/</code></p>\n\n<p>Result:</p>\n\n<pre><code>An error occurred from the response  Get https://www.mtsoukalos.eu/: x509: certificate signed by unknown authority https://www.mtsoukalos.eu/\nexit status 100\n</code></pre>\n\n<p>Scenario 2:\n<code>go run web/webClient/webClient.go http://www.mtsoukalo.eu/</code></p>\n\n<pre><code>An error occurred from the response  Get https://www.mtsoukalos.eu/: x509: certificate signed by unknown authority http://www.mtsoukalos.eu/\nexit status 100\n</code></pre>\n\n<p>The expected result of the URL in Scenario 2 should be <code>http://www.mtsoukalos.eu/</code> but I still get <code>https://www.mtsoukalos.eu/</code>. </p>\n\n<p>Can you help me understand why it is happening this way?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1563251582, "post_id": 57050030, "comment_id": 100627004, "body": "I knew of this command before and didn&#39;t think about it, thanks !"}], "tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": true, "score": 4, "last_activity_date": 1563251114, "creation_date": 1563251114, "answer_id": 57050030, "question_id": 57049922, "link": "https://stackoverflow.com/questions/57049922/unformat-string-number-with-thousand-comma-golang/57050030#57050030", "title": "unformat string number with thousand comma golang", "body": "<p>The reason it is failed because <code>\"1,090\"</code> has <code>,</code> comma in it. You have to remove the <code>,</code> from the string before you use <code>strconv.ParseFloat(v, 32)</code>. One way to remove comma is by using <a href=\"https://golang.org/pkg/strings/#Replace\" rel=\"nofollow noreferrer\">strings.Replace()</a>:</p>\n\n<pre><code>v := \"1,090\"\n\nv = strings.Replace(v, \",\", \"\", -1)\n\ns, err := strconv.ParseFloat(v, 32)\nif  err != nil {\n        fmt.Printf(\"err: %s\\n\", err)\n        return\n}\nfmt.Printf(\"%T, %v\\n\", s, s)\n</code></pre>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "accepted_answer_id": 57050030, "answer_count": 1, "score": 0, "last_activity_date": 1563251114, "creation_date": 1563250263, "question_id": 57049922, "link": "https://stackoverflow.com/questions/57049922/unformat-string-number-with-thousand-comma-golang", "title": "unformat string number with thousand comma golang", "body": "<p>I have this string \"1,090\"</p>\n\n<p>I want to convert it to float</p>\n\n<pre><code>v := \"1,090\"\ns, err := strconv.ParseFloat(v, 32)\nif  err != nil {\n    fmt.Printf(\"err: %s\\n\", err)\n    return\n}\nfmt.Printf(\"%T, %v\\n\", s, s)\n</code></pre>\n\n<p>But it returns an error: </p>\n\n<pre><code>//err: strconv.ParseFloat: parsing \"1,090\": invalid syntax\n</code></pre>\n\n<p>So anybody know to convert it to float?</p>\n"}, {"tags": ["http", "go", "networking"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1563250534, "post_id": 57049871, "comment_id": 100626773, "body": "Does the application close the http response bodies? Show some code."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1563252951, "post_id": 57049871, "comment_id": 100627268, "body": "As @CeriseLim&#243;n said, you should be closing the bodies of the <i>responses</i> not the requests. Closing the body of a request in your server handlers is <a href=\"https://golang.org/pkg/net/http/#Request.Body\" rel=\"nofollow noreferrer\">unnecessary</a>."}, {"owner": {"reputation": 317, "user_id": 933350, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a06c60d631247a67d9df2d5cd3c36e07?s=128&d=identicon&r=PG", "display_name": "William", "link": "https://stackoverflow.com/users/933350/william"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563260091, "post_id": 57049871, "comment_id": 100629629, "body": "@CeriseLim&#243;n I&#39;ve added an example of how I&#39;m doing the client side -- any problems that you see? TIA!"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1563260164, "post_id": 57049871, "comment_id": 100629660, "body": "Also make sure that you&#39;re reusing the client. Each client (or, more precisely, http.Transport) maintains a connection pool, so don&#39;t create a new client for every request."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1563283376, "post_id": 57049871, "comment_id": 100642178, "body": "An http.Transport holds a pool of connections. Ensure that the application reuses a single http.Tranport.  What is the value of MaxIdleConnections?"}, {"owner": {"reputation": 317, "user_id": 933350, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a06c60d631247a67d9df2d5cd3c36e07?s=128&d=identicon&r=PG", "display_name": "William", "link": "https://stackoverflow.com/users/933350/william"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563297997, "post_id": 57049871, "comment_id": 100650366, "body": "@CeriseLim&#243;n I set MaxIdleConnections = 2 for testing purposes (to try to fix this problem). I declare that <code>webHttpClient</code> thing once as a singleton and use it a bunch of times. So I shouldn&#39;t be doing anything to make a new <code>http.Transport</code> -- any other ideas?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563370995, "post_id": 57049871, "comment_id": 100677837, "body": "Rather than have people continue guessing, it would be more helpful to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that demonstrates the problem."}], "owner": {"reputation": 317, "user_id": 933350, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a06c60d631247a67d9df2d5cd3c36e07?s=128&d=identicon&r=PG", "display_name": "William", "link": "https://stackoverflow.com/users/933350/william"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 221, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563260058, "creation_date": 1563249879, "last_edit_date": 1563260058, "question_id": 57049871, "link": "https://stackoverflow.com/questions/57049871/using-go-standard-libs-why-do-i-leak-tcp-connections-constantly-in-this-two-tie", "title": "Using Go standard libs, why do I leak TCP connections constantly in this two-tier architecture?", "body": "<p>In this situation, I'm using all standard Go libraries -- <code>net/http</code>, most importantly.</p>\n\n<p>The application consists of two layers. The first layer is the basic web application. The web application serves out the UI, and proxies a bunch of API calls back to the second layer based on username -- so, it's effectively a load balancer with consistent hashing -- each user is allocated to one of these second-layer nodes, and any requests pertaining to that user must be sent to that particular node.</p>\n\n<p><strong>Quick details</strong></p>\n\n<p>These API endpoints in the first layer effectively read in a JSON body, check the username, use that to figure out which of the layer 2 nodes to send the JSON body to, and then it sends it there. This is done using a global <code>http.Client</code> that has timeouts set on it, as appropriate.</p>\n\n<p>The server side does a <code>defer request.Body.Close()</code> in each of the handlers after ensuring no <code>error</code> comes back from <code>decoder.Decode(&amp;obj)</code> calls that unmarshal the JSON. If there is any codepath where that could happen, it isn't one that's likely to get followed very often.</p>\n\n<p><strong>Symptoms</strong></p>\n\n<p>On the node in the second layer (the application server) I get log lines like this because it's leaking sockets presumably and sucking up all the FDs:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>2019/07/15 16:16:59 http: Accept error: accept tcp [::]:8100: accept4: too many open files; retrying in 1s\n2019/07/15 16:17:00 http: Accept error: accept tcp [::]:8100: accept4: too many open files; retrying in 1s\n</code></pre>\n\n<p>And, when I do <code>lsof</code> 14k lines are output, of which 11,200 are TCP sockets. When I look into the contents of <code>lsof</code>, I see that nearly all these TCP sockets are in connection state <code>CLOSE_WAIT</code>, and are between my application server (second layer node) and the web server (the first layer node).</p>\n\n<p>Interestingly, nothing seems to go wrong with the web application server (layer 1) during this timeframe. </p>\n\n<p><strong>Why does this happen?</strong></p>\n\n<p>I've seen lots of explanations, but most either point out that you need to specify custom defaults on a custom <code>http.Client</code> and not use the default, or they tell you to make sure to close the request bodies after reading from them in the layer 2 handlers.</p>\n\n<p>Given all this information, does anyone have any idea what I can do to at least put this to bed once and for all? Everything I search on the internet is user error, and while I certainly hope that's the case here, I worry that I've nailed down every last quirk of the Go standard library I can find.</p>\n\n<p>Been having trouble nailing down exactly how long it takes for this to happen -- the last time it happened, it was up for 3 days before I started to see this error, and at that point obviously nothing recovers until I kill and restart the process.</p>\n\n<p>Any help would be hugely appreciated!</p>\n\n<p><strong>EDIT: example of client-side code</strong></p>\n\n<p>Here is an example of what I'm doing in the web application (layer 1) to call the layer 2 node:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nvar webHttpClient = &amp;http.Client{\n    Transport: &amp;http.Transport{\n        MaxIdleConnsPerHost: MaxIdleConnections,\n    },\n    Timeout: time.Second * 20,\n}\n// ...\n                    uri := fmt.Sprintf(\"http://%s/%s\", tsUri, \"pms/all-venue-balances\")\n                    req, e := http.NewRequest(\"POST\", uri, bytes.NewBuffer(b))\n                    resp, err := webHttpClient.Do(req)\n                    if err != nil {\n                        log.Printf(\"Submit rebal error 3: %v\\n\", err)\n                        w.WriteHeader(500)\n                        return\n                    }\n                    defer resp.Body.Close()\n\n                    body, _ := ioutil.ReadAll(resp.Body)\n                    w.WriteHeader(200)\n                    w.Write(body)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 881, "user_id": 9534591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wxvb4.png?s=128&g=1", "display_name": "ik1ne", "link": "https://stackoverflow.com/users/9534591/ik1ne"}, "edited": false, "score": 0, "creation_date": 1563244043, "post_id": 57049271, "comment_id": 100625610, "body": "Thanks, is there any program/package for this purpose? For example, python has pip&amp;virtualenv which is used for $PYTHONPATH, package separation."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 881, "user_id": 9534591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wxvb4.png?s=128&g=1", "display_name": "ik1ne", "link": "https://stackoverflow.com/users/9534591/ik1ne"}, "edited": false, "score": 0, "creation_date": 1563244237, "post_id": 57049271, "comment_id": 100625640, "body": "If you don&#39;t need different version of Go itself, just changing the GOPATH variable would be the easiest. But if you are looking for something similar to virtualenv there are many tools out there, like <a href=\"https://github.com/DamnWidget/VenGO\" rel=\"nofollow noreferrer\">github.com/DamnWidget/VenGO</a>"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 0, "last_activity_date": 1563243779, "creation_date": 1563243779, "answer_id": 57049271, "question_id": 57049048, "link": "https://stackoverflow.com/questions/57049048/what-is-the-best-local-structure-for-go-open-source-repository-development/57049271#57049271", "title": "What is the best local structure for Go open source repository development?", "body": "<p>Yes, the folder structure you ended up with is the right one.</p>\n\n<p>Code should be under <code>$GOPATH/src</code> as you describe.</p>\n\n<p>But note that <code>$GOPATH</code> is not a fixed folder in your system, you can have multiple projects under different folders and change the value of <code>$GOPATH</code> accordingly depending what you are working on (or have multiple console terminals open, each with its own <code>$GOPATH</code> value).</p>\n"}], "owner": {"reputation": 881, "user_id": 9534591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wxvb4.png?s=128&g=1", "display_name": "ik1ne", "link": "https://stackoverflow.com/users/9534591/ik1ne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 57049271, "answer_count": 1, "score": -1, "last_activity_date": 1577815965, "creation_date": 1563241407, "last_edit_date": 1577815965, "question_id": 57049048, "link": "https://stackoverflow.com/questions/57049048/what-is-the-best-local-structure-for-go-open-source-repository-development", "title": "What is the best local structure for Go open source repository development?", "body": "<p>I'm trying to debug Go implementation of ethereum(<a href=\"https://github.com/ethereum/go-ethereum\" rel=\"nofollow noreferrer\">link</a>), because my core interest is in developing new consensus algorithm (i.e. modify the open source Go code from github).</p>\n\n<p>However, I'm having problem with the location/path of the source code. When I put the folder(i.e. <code>go-ethereum</code>) outside of the <code>$GOPATH</code> and then try to compile&amp;debug <code>geth</code>(<code>go-ethereum/cmd/geth/main.go</code>) it shows the following error: <code>Use of internal package is not allowed.</code></p>\n\n<p>From that error message, I figured out that the import <code>github.com/ethereum/go-ethereum</code> was not importing my source, and instead it was getting code from internet(like other libraries). Which of course is definitely what I shouldn't do when I'm trying to modify the <code>github.com/ethereum/go-ethereum</code> package code.</p>\n\n<p>So, my workaround was to clone the source code into <code>$GOPATH/src/github.com/ethereum/go-ethereum</code> and followed <a href=\"https://ethereum.stackexchange.com/a/27649/54814\">this answer</a>, and Goland IDE started compiling&amp;debugging without error (wasn't able to <code>go build ./cmd/geth/main.go</code> though due to error <code>undefined: configFileFlag...</code>)</p>\n\n<p>Thereby now I've got a working debugger that can debug with my source code modification, but this doesn't look like ideal source code structure.</p>\n\n<p>The question is:</p>\n\n<p>Is putting source code inside <code>$GOPATH</code>(because of internals) a proper approach? If so, what if I was using <code>go-ethereum</code> package from another project?(Fortunately I'm not, but I'm curious) Do I have to stash&amp;revert changes I made to the code?</p>\n"}, {"tags": ["go", "encryption", "oauth", "jwt", "sts-securitytokenservice"], "comments": [{"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 1, "creation_date": 1563240660, "post_id": 57048911, "comment_id": 100624981, "body": "How can people tamper JWT data? It is signed. You&#39;d need to know the secret key (and yeah, if that&#39;s not secret then of course everything breaks down)."}, {"owner": {"reputation": 11104, "user_id": 7329832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96a4e398a7a3d75e8cffbc635860e01a?s=128&d=identicon&r=PG&f=1", "display_name": "jps", "link": "https://stackoverflow.com/users/7329832/jps"}, "edited": false, "score": 0, "creation_date": 1563260364, "post_id": 57048911, "comment_id": 100629747, "body": "If you can view the contents of the token on jwt.io, then it is not <b>encrypted</b> but just <b>encoded</b> (base64url encoding), hence there is nothing to <b>decrypt</b> but just to <b>decode</b>. If you need encrypted data, you can also use JWE, the encrpted variant of JWT."}], "answers": [{"comments": [{"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1563359216, "post_id": 57049387, "comment_id": 100671004, "body": "Without secret signed string user anyhow would not be able to pass tamper data and get verified."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 3, "last_activity_date": 1563244999, "creation_date": 1563244999, "answer_id": 57049387, "question_id": 57048911, "link": "https://stackoverflow.com/questions/57048911/can-token-generated-using-paseto-token-be-decrypted-and-viewed-like-jwt-tok/57049387#57049387", "title": "Can &quot;token&quot; generated using &quot;Paseto Token&quot; be decrypted and viewed like &quot;JWT Token&quot;?", "body": "<blockquote>\n  <p>1 - Can \"token\" generated be altered like \"JWT\" and pass modified or tampered data?</p>\n</blockquote>\n\n<p>Note that token cannot be \"altered\" either using PASETO or JWT without knowing the signing key (which should of course be secret).</p>\n\n<p>The fact you mention about being able to <strong>view</strong> the JWT token data in JWT.io page is because data is not encrypted (so you can see it without the key).</p>\n\n<p>But token is signed, so if you modify any value and don't have the key, you won't be able to sign it back and the token receiver will note the token is not valid when trying to verify it.</p>\n\n<blockquote>\n  <p>2 - Can \"token\" generated using \"paseto\" be decrypted and viewed like \"JWT\"?</p>\n</blockquote>\n\n<p>It depends on how you generate the PASETO token.</p>\n\n<p>See here:</p>\n\n<p><a href=\"https://tools.ietf.org/id/draft-paragon-paseto-rfc-00.html#rfc.section.2\" rel=\"nofollow noreferrer\">https://tools.ietf.org/id/draft-paragon-paseto-rfc-00.html#rfc.section.2</a></p>\n\n<p>Format for the token is <code>version.purpose.payload</code>.</p>\n\n<p>And from the docs:</p>\n\n<blockquote>\n  <p>The payload is a string that contains the token's data. In a local token, this data is encrypted with a symmetric cipher. In a public token, this data is unencrypted. </p>\n</blockquote>\n\n<p>So if you generate the token as in the code snippet you posted (local token, with a symmetric key), then payload will be encrypted (you won't be able to see it unless you know the symmetric key and use that one to decrypt it).</p>\n\n<p>If you use a public/private key pair, then payload will not be encrypted, so you'll be able to <strong>see it</strong> without the key (but you'll not be able to change it and sign it again without knowing the private key).</p>\n"}], "owner": {"reputation": 33, "user_id": 11713492, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qlkdjTs_b9s/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdx21-FX4m6O0tIECR--d8D7V5RVA/photo.jpg?sz=128", "display_name": "Raven Go", "link": "https://stackoverflow.com/users/11713492/raven-go"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 0, "accepted_answer_id": 57049387, "answer_count": 1, "score": 3, "last_activity_date": 1563244999, "creation_date": 1563239837, "question_id": 57048911, "link": "https://stackoverflow.com/questions/57048911/can-token-generated-using-paseto-token-be-decrypted-and-viewed-like-jwt-tok", "title": "Can &quot;token&quot; generated using &quot;Paseto Token&quot; be decrypted and viewed like &quot;JWT Token&quot;?", "body": "<p>I am using \"Platform agnostic Security Token\" for oAuth in Golang - <a href=\"https://github.com/o1egl/paseto\" rel=\"nofollow noreferrer\">https://github.com/o1egl/paseto</a></p>\n\n<p>I am not able to understand, why this is better than JWT even after reading README</p>\n\n<p>My Major Question is:</p>\n\n<ol>\n<li>Can \"token\" generated be altered like \"JWT\" and pass modified or tampered data?</li>\n<li>Can \"token\" generated using \"paseto\" be decrypted and viewed like \"JWT\"?</li>\n</ol>\n\n<p>Paseto library above uses \"SET\" and \"GET\" method inside their JSONToken method. Is that how we can verify authenticity of the user?</p>\n\n<p>Sample Code:</p>\n\n<pre><code>symmetricKey := []byte(\"YELLOW SUBMARINE, BLACK WIZARDRY\") // Must be 32 bytes\nnow := time.Now()\nexp := now.Add(24 * time.Hour)\nnbt := now\n\njsonToken := paseto.JSONToken{\n        Audience:   \"test\",\n        Issuer:     \"test_service\",\n        Jti:        \"123\",\n        Subject:    \"test_subject\",\n        IssuedAt:   now,\n        Expiration: exp,\n        NotBefore:  nbt,\n        }\n// Add custom claim to the token    \njsonToken.Set(\"data\", \"this is a signed message\")\nfooter := \"some footer\"\n\nv2 := paseto.NewV2()\n\n// Encrypt data\ntoken, err := v2.Encrypt(symmetricKey, jsonToken, footer)\n// token = \"v2.local.E42A2iMY9SaZVzt-WkCi45_aebky4vbSUJsfG45OcanamwXwieieMjSjUkgsyZzlbYt82miN1xD-X0zEIhLK_RhWUPLZc9nC0shmkkkHS5Exj2zTpdNWhrC5KJRyUrI0cupc5qrctuREFLAvdCgwZBjh1QSgBX74V631fzl1IErGBgnt2LV1aij5W3hw9cXv4gtm_jSwsfee9HZcCE0sgUgAvklJCDO__8v_fTY7i_Regp5ZPa7h0X0m3yf0n4OXY9PRplunUpD9uEsXJ_MTF5gSFR3qE29eCHbJtRt0FFl81x-GCsQ9H9701TzEjGehCC6Bhw.c29tZSBmb290ZXI\"\n\n// Decrypt data\nvar newJsonToken paseto.JSONToken\nvar newFooter string\nerr := v2.Decrypt(token, symmetricKey, &amp;newJsonToken, &amp;newFooter)\n</code></pre>\n\n<p>Now, if you see there is code: <code>jsonToken.Set(\"data\", \"this is a signed message\")</code> and we can get that value in Decrypt data at the end where <code>newJsonToken</code> variable is created.</p>\n\n<p>We can get the value of \"data\" key using: <code>newJsonToken.Get(\"data\")</code>.</p>\n\n<p>But is above data \"verifiable\" and can't be tampered or modified on user's end?</p>\n\n<p>Like in JWT debugger at JWT.io, People can tamper data and know the algorithm and pass \"modified\" data.</p>\n\n<p>Can user do the same with my generated token as well? Can they decode and pass tampered data? or they can't decode data or view actual data at all?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 0, "creation_date": 1563239002, "post_id": 57048789, "comment_id": 100624682, "body": "it could be there is an error occurred during <code>Demo1_CallFindAll()</code> call. try to print the products on block <code>if err !=nil{</code>"}], "answers": [{"tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": false, "score": 2, "last_activity_date": 1563249576, "creation_date": 1563249576, "answer_id": 57049819, "question_id": 57048789, "link": "https://stackoverflow.com/questions/57048789/cannot-receive-correct-object-when-returning-it-from-the-function/57049819#57049819", "title": "Cannot receive correct object when returning it from the function", "body": "<p>The bug is in this line: <code>products,err := productModel.FindAll()</code>. You used named return parameters in the <code>Demo1_CallFindAll()</code> functions. Named returned parameters are initialized to their zero value(ref: <a href=\"https://golang.org/doc/effective_go.html#named-results\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#named-results</a>).</p>\n\n<p>But in the line <code>products,err := productModel.FindAll()</code>, you created a new variable (by <code>:=</code>) <code>products</code> and set results in it, not in the return parameter <code>products</code>. That's why you can not see anything in the <code>foo()</code> functions. To solve it, change <code>:=</code> to <code>=</code>, <code>products,err = productModel.FindAll()</code>.</p>\n"}], "owner": {"reputation": 71, "user_id": 10542899, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94129e8edd87d8f539d20f73ad0bfaa7?s=128&d=identicon&r=PG&f=1", "display_name": "Imediasun", "link": "https://stackoverflow.com/users/10542899/imediasun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563249576, "creation_date": 1563238566, "last_edit_date": 1563246237, "question_id": 57048789, "link": "https://stackoverflow.com/questions/57048789/cannot-receive-correct-object-when-returning-it-from-the-function", "title": "Cannot receive correct object when returning it from the function", "body": "<p>In the function <code>Demo1_CallFindAll()</code> I am trying to return an object from a database.</p>\n\n<p>In <code>foo()</code> I cannot see it after using Print. However, I call the <code>Demo1_CallFindAll</code> function and can see an array of objects in it. </p>\n\n<p>Please explain why and correct my code.</p>\n\n<pre><code>func foo(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n    var tags = Demo1_CallFindAll()\n    fmt.Println(tags) // Here I see nothing\n    js, err := json.Marshal(tags)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Write(js)\n\n    json.NewEncoder(w).Encode(\"OKOK\")\n}\n\nfunc Demo1_CallFindAll()(products []entities.Product)  {\n    db,err:=config.GetMySQLDB()\n    if err !=nil{\n        fmt.Println(err)\n    }else{\n        productModel := models.ProductModel{\n            Db:db,\n        }\n        products,err := productModel.FindAll()\n        if err !=nil{\n            fmt.Println(err)\n        }else{\nfmt.Println(products)//[{1 Nokia1 10 2 true} {2 Nokia2 11 22 false}]\n\n            fmt.Println(\"Product List\")\n        }\n    }\n    return\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1563234465, "post_id": 57048181, "comment_id": 100623903, "body": "If you have the luxury, I would change to structured logs for easier parsing."}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1563234748, "post_id": 57048181, "comment_id": 100623947, "body": "@georgeok - would love to, but this is an old established product.  We get logs from various installations around the world that have been running for many years and don&#39;t have the luxury of changing the format.  However the format doesn&#39;t change."}, {"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1563313642, "post_id": 57048181, "comment_id": 100656759, "body": "I would sure love it if the close votes could be accompanied by comments.  That gives me and others the ability to improve questions and make them more useful for others.  Please take some thought before voting to close !"}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 0, "last_activity_date": 1563234871, "creation_date": 1563234871, "answer_id": 57048443, "question_id": 57048181, "link": "https://stackoverflow.com/questions/57048181/efficient-log-parsing-in-golang/57048443#57048443", "title": "Efficient log parsing in golang", "body": "<p>If all your log lines are similar to that sample you posted, they seem quite structured so regular expressions might be a bit overkill and hard to generalize.</p>\n\n<p>Another option would be for you to transform each of those lines to a slice of strings (<code>[]string</code>) by using <a href=\"https://golang.org/pkg/strings/#Fields\" rel=\"nofollow noreferrer\">strings.Fields</a>, or even <a href=\"https://golang.org/pkg/strings/#FieldsFunc\" rel=\"nofollow noreferrer\">strings.FieldFunc</a> so that you can strip both white space and commas.</p>\n\n<p>Then you can design an interface like:</p>\n\n<pre><code>type LogLineProcessor interface {\n    CanParse(line []string)\n    GetResultFrom(line []string) LogLineResult\n}\n</code></pre>\n\n<p>Where <code>LogLineResult</code> is an struct containing the extracted information.</p>\n\n<p>You can then define multiple structs with methods that implement <code>LogLineProcessor</code> (each implementation would look at specific positions on that <code>[]string</code> to realize if it is a line it can process or not, like looking for the words \"hose\", \"FF\" and \"price\" in the positions it expects to find them).</p>\n\n<p>The <code>GetResultFrom</code> implementations would also extract each data point from specific positions in the <code>[]string</code> (it can rely on that information being there if it already determined it was one of the lines it can process).</p>\n\n<p>You can create a <code>var processors []LogLineProcessor</code>, put all your processors in there and then just iterate that array:</p>\n\n<pre><code>line := strings.Fields(text)\nfor _, processor := range processors {\n     if processor.CanParse(line) {\n        result := processor.GetResultFrom(line)\n        // do whatever needed with the result\n     }\n}\n</code></pre>\n"}], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 774, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1563234871, "creation_date": 1563232410, "question_id": 57048181, "link": "https://stackoverflow.com/questions/57048181/efficient-log-parsing-in-golang", "title": "Efficient log parsing in golang", "body": "<p>What would be an efficient (performance and readability) of parsing lines in a log file and extracting points of interest?</p>\n\n<p>For example:</p>\n\n<pre><code>*** Time: 2/1/2019 13:51:00\n17.965 Pump 10 hose FF price level 1 limit    0.0000 authorise pending (Type 00)\n17.965 Pump 10 State change LOCKED_PSTATE to CALLING_PSTATE [31]\n38.791 Pump 10 delivery complete, Hose 1, price 72.9500, level 1, value  100.0000, volume    1.3700, v-total 8650924.3700, m-total 21885705.8800, T13:51:38\n</code></pre>\n\n<p>Things I need to extract are 10 (for pump 10), Price Level.  Limit\nThe _PSTATE  changes the values from the delivery completel line etc.</p>\n\n<p>Currently I'm using a regular expression to capture each one and using capture groups.  But it feels inefficient and there is quite a bit of duplication.</p>\n\n<p>For example, I have a bunch of these:</p>\n\n<pre><code>reStateChange := regexp.MustCompile(`^(?P&lt;offset&gt;.*) Pump (?P&lt;pump&gt;\\d{2}) State change (?P&lt;oldstate&gt;\\w+_PSTATE) to (?P&lt;newstate&gt;\\w+)_PSTATE`)\n</code></pre>\n\n<p>Then inside a while loop</p>\n\n<pre><code>if match := reStateChange.FindStringSubmatch(text); len(match) &gt; 0 {\n    matched = true\n    for i, name := range match {\n        result[reStateChange.SubexpNames()[i]] = name\n    }\n} else if match := otherReMatch.FindStringSubmatch(text); len(match) &gt; 0 {\n    matched = true\n    for i, name := range match {\n        result[reStateChange.SubexpNames()[i]] = name\n    }\n} else if strings.Contains(text, \"*** Time:\") {\n\n}\n</code></pre>\n\n<p>It feels that there could be a much better way to do this.  I would trade some performance for readability.  The log files are only really 10MB max. Often smaller.</p>\n\n<p>I'm after some suggestions on how to make this better in golang.</p>\n"}, {"tags": ["go", "types", "polymorphism"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563231415, "post_id": 57047941, "comment_id": 100623319, "body": "Show the function you woukd write for one of the types."}, {"owner": {"reputation": 1446, "user_id": 1930817, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/66Aja.jpg?s=128&g=1", "display_name": "guzmonne", "link": "https://stackoverflow.com/users/1930817/guzmonne"}, "edited": false, "score": 0, "creation_date": 1563231539, "post_id": 57047941, "comment_id": 100623340, "body": "Please check <a href=\"https://stackoverflow.com/questions/44380095/polymorphic-json-unmarshalling-of-embedded-structs\">this stackoverflow</a> question for your answer. Look at the one given by @putu for a way to solve your issue. And please, use the search function before asking a question."}, {"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1563231750, "post_id": 57047941, "comment_id": 100623380, "body": "Just unmashal into a <code>map[string]interface{}</code> - will take any JSON type (Numbers are unmarshaled into <code>float64</code>) and you can get an item by it&#39;s name. Just remember to safely type assert the items."}, {"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1563231911, "post_id": 57047941, "comment_id": 100623419, "body": "A safe type assertion: <code>if value, ok := map[&quot;itemName&quot;].(int); !ok { &#47;* Item is an incorrect type - return an error *&#47; }</code>"}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 0, "creation_date": 1563241095, "post_id": 57047941, "comment_id": 100625081, "body": "is this your own api or a 3rd party api? If it&#39;s your own api, can you not just make it always use the same structure for code/description?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1563259822, "post_id": 57047941, "comment_id": 100629507, "body": "Obviously, I fail to get the point. We <i>are</i> talking of 50 distinct types, are we not?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1563260541, "post_id": 57047941, "comment_id": 100629839, "body": "Are you looking for something like this: <a href=\"https://play.golang.org/p/sQpo3CBdKYe\" rel=\"nofollow noreferrer\">play.golang.org/p/sQpo3CBdKYe</a> ?"}, {"owner": {"reputation": 19, "user_id": 6580997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/272c1a1f3c6908b6f67a47002477493a?s=128&d=identicon&r=PG&f=1", "display_name": "StevenD", "link": "https://stackoverflow.com/users/6580997/stevend"}, "edited": false, "score": 0, "creation_date": 1563396388, "post_id": 57047941, "comment_id": 100690785, "body": "I found out the answer about this question. Thanks all for the help."}], "answers": [{"tags": [], "owner": {"reputation": 88, "user_id": 8870043, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ubc0WJvyDGM/AAAAAAAAAAI/AAAAAAAAA4Y/0Amapj0C_2A/photo.jpg?sz=128", "display_name": "ahmedaabouzied", "link": "https://stackoverflow.com/users/8870043/ahmedaabouzied"}, "is_accepted": false, "score": 0, "last_activity_date": 1563232214, "creation_date": 1563232214, "answer_id": 57048167, "question_id": 57047941, "link": "https://stackoverflow.com/questions/57047941/how-can-i-make-my-unmarshall-function-in-golang-handle-multiple-types/57048167#57048167", "title": "How can I make my unmarshall function in golang handle multiple types?", "body": "<p><em>As far as I know</em> , You should always decode into structs to benefit from go static types , the methods attached to that struct and perhaps be able to validate your responses with a package like <a href=\"https://github.com/thedevsaddam/govalidator\" rel=\"nofollow noreferrer\">validator</a> , but you could always parse the JSON body into a map like this : </p>\n\n<pre><code>// JsonParse parses the json body of http request\nfunc JsonParse(r *http.Request) (map[string]interface{}, error) {\n    // Read the r.body into a byte array\n    body, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        return nil, err\n    }\n    // Make a map of String keys and Interface Values\n    b := make(map[string]interface{})\n    // Unmarshal the body array into the map\n    err = json.Unmarshal(body, &amp;b)\n    if err != nil {\n        return nil, err\n    }\n    return b, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 6580997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/272c1a1f3c6908b6f67a47002477493a?s=128&d=identicon&r=PG&f=1", "display_name": "StevenD", "link": "https://stackoverflow.com/users/6580997/stevend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 186, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1563232799, "creation_date": 1563230019, "last_edit_date": 1563232799, "question_id": 57047941, "link": "https://stackoverflow.com/questions/57047941/how-can-i-make-my-unmarshall-function-in-golang-handle-multiple-types", "title": "How can I make my unmarshall function in golang handle multiple types?", "body": "<p>I'm using the json.unmarshalling function in golang to decode some JSON responses we got from the API. How do I make it handle multiple types? </p>\n\n<p>The response we receive are always status code and a message, but the json field have different names. Sometimes these two fields are called code and message and sometimes they are called statuscode and description, depending on what we query. </p>\n\n<p>say that we queries Apple and this is simply solved by creating an Apple type struct like this: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Apple struct {\n    Code        int    `json:\"code\"`\n    Description string `json:\"message\"`\n}\n</code></pre>\n\n<p>But when we query Peach, the json we got back is no longer code and message anymore, the field names became statuscode and description. So we will need the following: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Peach struct {\n    Code        int    `json:\"statuscode\"`\n    Description string `json:\"description\"`\n}\n</code></pre>\n\n<p>Potentially, we need to set up 50 more types and write duplicate for 50 times?? There MUST be a better way to do this. Unfortunately I'm new to Golang and don't know how polymorphism works in this language. Please help.</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-sql"], "comments": [{"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1563229277, "post_id": 57047372, "comment_id": 100622906, "body": "Please show the actual code that you are using and not one line. You are using the correct package and instance name format. Check that the service account for your instance has permissions to access Cloud SQL (Cloud SQL Client, Editor or Admin). Remove what you did with the IP in authorized networks as that is not used by Cloud SQL Proxy. Proxy uses service account roles to authorize access to Cloud SQL. You will of course need the correct login and password for the database."}, {"owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "edited": false, "score": 0, "creation_date": 1563238536, "post_id": 57047372, "comment_id": 100624597, "body": "Are you setting the environment variable needed to use a service account credentials? <a href=\"https://cloud.google.com/docs/authentication/getting-started\" rel=\"nofollow noreferrer\">cloud.google.com/docs/authentication/getting-started</a> Or do you need to add the <code>cloudSql.client</code> role to the VM&#39;s service account?  Also, when using the proxy, you shouldn&#39;t need to add the VM to the authorized networks"}, {"owner": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "reply_to_user": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1563241377, "post_id": 57047372, "comment_id": 100625129, "body": "@JohnHanley  <code>package main  import ( \t&quot;fmt&quot; \t&quot;os&quot;  \t&quot;github.com&#47;GoogleCloudPlatform&#47;cloudsql-proxy&#47;proxy&#47;dialer&zwnj;&#8203;s&#47;mysql&quot; )  func main() { \tcfg := mysql.Cfg(&quot;MyAccount:us-west2:myDatabase&quot;, &quot;root&quot;, os.Getenv(&quot;dbPass&quot;)) \tdb, err := mysql.DialCfg(cfg) \tif err != nil { \t\tpanic(err) \t} \tfmt.Print(db) }</code>  I&#39;m unsure what you&#39;re asking with the permissions, also don&#39;t I need to set the Authorized networks for shell access to my DB?  @JacobLambert I don&#39;t believe this package uses the credentials json, I might need to add the cloudsql.client. I&#39;m able to ssh in to make my dbs."}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1563241909, "post_id": 57047372, "comment_id": 100625212, "body": "Compute Engine has a service account. Your code uses that service account. You need roles as I mentioned in order to use Cloud SQL Proxy. Note Edit your question with your code and not in comments which are hard to read."}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 1, "creation_date": 1563244412, "post_id": 57047372, "comment_id": 100625677, "body": "After your edit. The Compute Engine Service Account does not have roles enabled for Cloud SQL. Go to the Google Cloud Console. Select your VM instance. Shutdown the instance. Edit the service account and enable Cloud SQL."}, {"owner": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "edited": false, "score": 0, "creation_date": 1563248379, "post_id": 57047372, "comment_id": 100626377, "body": "Thank you guys very much that solved my issue!"}], "owner": {"reputation": 87, "user_id": 11651299, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SCXxj7Gddto/AAAAAAAAAAI/AAAAAAAAAAc/jtEBHeDLBBE/photo.jpg?sz=128", "display_name": "wes kay", "link": "https://stackoverflow.com/users/11651299/wes-kay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 228, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563242027, "creation_date": 1563225781, "last_edit_date": 1563242027, "question_id": 57047372, "link": "https://stackoverflow.com/questions/57047372/permissions-error-when-trying-to-connect-gcp-sql-database-with-golang-cloud-sql", "title": "Permissions error when trying to connect GCP SQL Database with Golang cloud sql proxy package", "body": "<p>I'm trying to connect my go app on my VM (Debain 9) server to my mysql database using the package: <code>github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/dialers/mysql</code></p>\n\n<p>Looking at connection function:</p>\n\n<pre><code> // Cfg returns the effective *mysql.Config to represent connectivity to the\n// provided instance via the given user and password. The config can be\n// modified and passed to DialCfg to connect. If you don't modify the returned\n// config before dialing, consider using Dial or DialPassword.\nfunc Cfg(instance, user, password string) *mysql.Config {\n</code></pre>\n\n<p>I assume I put in the instance 'Instance connection name that is found on the GCP instance connection database page: \n`\n    package main</p>\n\n<pre><code>import (\n\"fmt\"\n\"os\"\n\n\"github.com/GoogleCloudPlatform/cloudsql-proxy/proxy/dialers/mysql\"\n)\n\nfunc main() {\n    cfg := mysql.Cfg(\"MyAccount:us-west2:myDatabase\", \"root\", os.Getenv(\"GCPDBPass\"))\n    db, err := mysql.DialCfg(cfg)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Print(db)\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/v8bep.png\" rel=\"nofollow noreferrer\">Where I find my instance connection name</a></p>\n\n<p>I get an error:\n<code>panic: ensure that the account has access to \"MyAccount\" (and make sure there's no typo in that name)</code> </p>\n\n<p>I've hooked up the VM instance IP to the Authorized networks in the Database so I don't know if I'm using the correct instance or user with this package.</p>\n"}, {"tags": ["go", "servemux"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563220139, "post_id": 57045852, "comment_id": 100620072, "body": "A GET request should not have a <code>Content-Type</code> header because it has no body to have a content type. Also note that, per the linked docs, &quot;If a subtree has been registered and a request is received naming the subtree root without its trailing slash, ServeMux <b>redirects that request</b> to the subtree root (adding the trailing slash)&quot; (emphasis mine). So the request your handler actually receives is the same (the URL with the trailing slash)."}, {"owner": {"reputation": 775, "user_id": 816182, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a912c0fab7489da071314182f67901ea?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/816182/andrew"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563221239, "post_id": 57045852, "comment_id": 100620458, "body": "I neglected to specify that the request in question is a POST, because as you correctly stated, GETs don&#39;t pass Content-Type. And yes, the same handler gets executed in both cases. But in the case of <code>&#47;test</code> the Content-Type header is NOT set."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563231070, "post_id": 57045852, "comment_id": 100623262, "body": "You never see the POST request for /test. You see the GET request for /test/ that the client sends when following the redirect. There&#39;s nothing wrong with your server, you just seem to be misunderstanding the client&#39;s behavior. Add -Lv to the curl command and remove the -w flag and it should become clear."}, {"owner": {"reputation": 775, "user_id": 816182, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a912c0fab7489da071314182f67901ea?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/816182/andrew"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563285191, "post_id": 57045852, "comment_id": 100643323, "body": "@Peter I realize that there&#39;s nothing wrong with the server, but should I expect, based on the go language documentation, to receive a 301?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1563287983, "post_id": 57045852, "comment_id": 100645191, "body": "Yes, you should. Adrian quoted the relevant docs."}, {"owner": {"reputation": 775, "user_id": 816182, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a912c0fab7489da071314182f67901ea?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/816182/andrew"}, "edited": false, "score": 0, "creation_date": 1563296882, "post_id": 57045852, "comment_id": 100649909, "body": "Sorry, I read <code>redirects</code> as <code>routes</code> somehow. Makes sense now. Sorry for wasting your time."}], "owner": {"reputation": 775, "user_id": 816182, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a912c0fab7489da071314182f67901ea?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/816182/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563224388, "creation_date": 1563217828, "last_edit_date": 1563224388, "question_id": 57045852, "link": "https://stackoverflow.com/questions/57045852/header-content-type-not-set-when-servemux-pattern-has-no-trailing-slash", "title": "Header Content-Type not set when ServeMux pattern has no trailing slash", "body": "<p>I have the simplest HTTP server:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n)\n\nfunc handle(w http.ResponseWriter, r *http.Request) {\n    // Calling http://localhost:10000/test/ will not panic\n    // Calling http://localhost:10000/test WILL panic\n    if r.Header.Get(\"Content-Type\") == \"\" {\n        panic(\"No Content-Type header found\")\n    }\n}\n\nfunc main() {\n    http.HandleFunc(\"/test/\", handle)\n    err := http.ListenAndServe(\":10000\", nil)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>The server will match both <code>/test</code> and <code>/test/</code> like <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#ServeMux</a> indicates.</p>\n\n<p>However, the URL without the trailing slash will not have the <code>Content-Type</code> set causing the panic in the code above. Am I missing something? Why does leaving off the trailing slash cause <code>Content-Type</code> header specifically to disappear? Other headers, like <code>Accept,</code> <code>Cache-Control</code>, etc., still show up.</p>\n\n<p>Also, I am executing these requests via Postman.</p>\n\n<p>It appears the default http mux handles the redirect using a 301 which Postman cannot handle. Executing the following CURL command:</p>\n\n<pre><code>curl -X POST 'http://localhost:10000/test' -H 'Accept: application/pdf' -H 'Content-Type:text/markdown' -w \"%{http_code}\"\n</code></pre>\n\n<p>prints <code>301</code></p>\n"}, {"tags": ["go", "command-line", "gmail-api"], "comments": [{"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1563230711, "post_id": 57044535, "comment_id": 100623200, "body": "In your current script, when the file of <code>token.json</code> is not existing, the URL for retrieving the authorization code is displayed to the terminal. When the code is retrieved using the browser and it is inputted to the terminal, the refresh token and access token are saved to the file of <code>token.json</code>. For this situation, when you want to display the URL every time, how about removing <code>saveToken(tokFile, tok)</code> in the function of <code>getClient()</code>? By this, the refresh token and access token are not saved, and the URL is displayed every time. If I misunderstood your question, I apologize."}, {"owner": {"reputation": 1, "user_id": 11787854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58cd8adec0e69f2a424e52815dde2ec5?s=128&d=identicon&r=PG&f=1", "display_name": "b4372826", "link": "https://stackoverflow.com/users/11787854/b4372826"}, "reply_to_user": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1563232452, "post_id": 57044535, "comment_id": 100623522, "body": "I got what you were saying, and I realized that the issue was exactly what you talked about. I also moved the token.json file out of the directory and was able to trigger the authorization page showing up. Thank you very much!"}, {"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1563232662, "post_id": 57044535, "comment_id": 100623545, "body": "Thank you for replying. I&#39;m glad your issue was resolved. When your issue was resolved, can you post the resolved script by including the explanation as an answer and accept it? By this, it will be useful for other users who have the same issue."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11794512, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tz6ex3HsCBk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdWsdp0zf6xOzqIIDJ9KhQAbbHH0w/photo.jpg?sz=128", "display_name": "b7383746", "link": "https://stackoverflow.com/users/11794512/b7383746"}, "is_accepted": false, "score": 1, "last_activity_date": 1563314897, "creation_date": 1563314897, "answer_id": 57066070, "question_id": 57044535, "link": "https://stackoverflow.com/questions/57044535/using-gmail-apis-quickstart-to-authorize-multiple-times/57066070#57066070", "title": "Using Gmail API&#39;s quickstart to authorize multiple times", "body": "<p>Got locked out of my account, so here's what I did.</p>\n\n<p>First, on the main method, I added:</p>\n\n<pre><code>if exists(\"token.json\") {\n    os.Remove(\"token.json\")\n}\n</code></pre>\n\n<p>Then, I made that method: </p>\n\n<pre><code>func exists(filename string) bool {\n    info, err := os.Stat(filename)\n    if os.IsNotExist(err) {\n        return false\n    }\n    return !info.IsDir()\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11787854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58cd8adec0e69f2a424e52815dde2ec5?s=128&d=identicon&r=PG&f=1", "display_name": "b4372826", "link": "https://stackoverflow.com/users/11787854/b4372826"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563314897, "creation_date": 1563211488, "question_id": 57044535, "link": "https://stackoverflow.com/questions/57044535/using-gmail-apis-quickstart-to-authorize-multiple-times", "title": "Using Gmail API&#39;s quickstart to authorize multiple times", "body": "<p>I was using Gmail's Quickstart application to extract the labels from an email account, but I hoped that there was a way to change to code so that a login page would always show up. There's a one-time authorization, but I wanted to know if there was a way to prompt authorization every time I start the app. The code that I've been using can be found right here: <a href=\"https://developers.google.com/gmail/api/quickstart/go\" rel=\"nofollow noreferrer\">https://developers.google.com/gmail/api/quickstart/go</a></p>\n\n<p>I will also attach the code below. Any help would be appreciated.</p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/json\"\n        \"fmt\"\n        \"io/ioutil\"\n        \"log\"\n        \"net/http\"\n        \"os\"\n\n        \"golang.org/x/net/context\"\n        \"golang.org/x/oauth2\"\n        \"golang.org/x/oauth2/google\"\n        \"google.golang.org/api/gmail/v1\"\n)\n\n// Retrieve a token, saves the token, then returns the generated client.\nfunc getClient(config *oauth2.Config) *http.Client {\n        // The file token.json stores the user's access and refresh tokens, and is\n        // created automatically when the authorization flow completes for the first\n        // time.\n        tokFile := \"token.json\"\n        tok, err := tokenFromFile(tokFile)\n        if err != nil {\n                tok = getTokenFromWeb(config)\n                saveToken(tokFile, tok)\n        }\n        return config.Client(context.Background(), tok)\n}\n\n// Request a token from the web, then returns the retrieved token.\nfunc getTokenFromWeb(config *oauth2.Config) *oauth2.Token {\n        authURL := config.AuthCodeURL(\"state-token\", oauth2.AccessTypeOffline)\n        fmt.Printf(\"Go to the following link in your browser then type the \"+\n                \"authorization code: \\n%v\\n\", authURL)\n\n        var authCode string\n        if _, err := fmt.Scan(&amp;authCode); err != nil {\n                log.Fatalf(\"Unable to read authorization code: %v\", err)\n        }\n\n        tok, err := config.Exchange(context.TODO(), authCode)\n        if err != nil {\n                log.Fatalf(\"Unable to retrieve token from web: %v\", err)\n        }\n        return tok\n}\n\n// Retrieves a token from a local file.\nfunc tokenFromFile(file string) (*oauth2.Token, error) {\n        f, err := os.Open(file)\n        if err != nil {\n                return nil, err\n        }\n        defer f.Close()\n        tok := &amp;oauth2.Token{}\n        err = json.NewDecoder(f).Decode(tok)\n        return tok, err\n}\n\n// Saves a token to a file path.\nfunc saveToken(path string, token *oauth2.Token) {\n        fmt.Printf(\"Saving credential file to: %s\\n\", path)\n        f, err := os.OpenFile(path, os.O_RDWR|os.O_CREATE|os.O_TRUNC, 0600)\n        if err != nil {\n                log.Fatalf(\"Unable to cache oauth token: %v\", err)\n        }\n        defer f.Close()\n        json.NewEncoder(f).Encode(token)\n}\n\nfunc main() {\n        b, err := ioutil.ReadFile(\"credentials.json\")\n        if err != nil {\n                log.Fatalf(\"Unable to read client secret file: %v\", err)\n        }\n\n        // If modifying these scopes, delete your previously saved token.json.\n        config, err := google.ConfigFromJSON(b, gmail.GmailReadonlyScope)\n        if err != nil {\n                log.Fatalf(\"Unable to parse client secret file to config: %v\", err)\n        }\n        client := getClient(config)\n\n        srv, err := gmail.New(client)\n        if err != nil {\n                log.Fatalf(\"Unable to retrieve Gmail client: %v\", err)\n        }\n\n        user := \"me\"\n        r, err := srv.Users.Labels.List(user).Do()\n        if err != nil {\n                log.Fatalf(\"Unable to retrieve labels: %v\", err)\n        }\n        if len(r.Labels) == 0 {\n                fmt.Println(\"No labels found.\")\n                return\n        }\n        fmt.Println(\"Labels:\")\n        for _, l := range r.Labels {\n                fmt.Printf(\"- %s\\n\", l.Name)\n        }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1563204131, "post_id": 57042071, "comment_id": 100613247, "body": "Concurrency. If two CPU cores are busy for one second on the wall clock, they have been used for two seconds. It&#39;s the same mechanism that allows YouTube to add several hundred hours of Video every minute."}, {"owner": {"reputation": 535, "user_id": 1436289, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/HRq26.png?s=128&g=1", "display_name": "xiaodong", "link": "https://stackoverflow.com/users/1436289/xiaodong"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563207499, "post_id": 57042071, "comment_id": 100615027, "body": "@Peter Thanks a lot, while maybe I shouldn&#39;t put two questions into one post.  I want to ask what the <code>26.26s</code> stands for? since the wall time is <code>30.18s</code>, what the program was doing during the other <code>30.18 - 26.26 = 3.92s</code>?  Is it not on CPU because of blocking on something.  While I think even no goroutine is on CPU, there should be something running on CPU (like idle thread?)"}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 0, "creation_date": 1563300110, "post_id": 57042071, "comment_id": 100651320, "body": "regarding the missing seconds particularly, in my experience pprof generally shows you the beginning of the &#39;long tail&#39; because you are not generally interested in the many many things that take very little time."}], "owner": {"reputation": 535, "user_id": 1436289, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/HRq26.png?s=128&g=1", "display_name": "xiaodong", "link": "https://stackoverflow.com/users/1436289/xiaodong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 228, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1563201507, "creation_date": 1563201507, "question_id": 57042071, "link": "https://stackoverflow.com/questions/57042071/what-s-the-meaning-of-duration-30-18s-total-samples-26-26s-87-00-in-go", "title": "What\u2019s the meaning of `Duration: 30.18s, Total samples = 26.26s (87.00%)` in go pprof?", "body": "<p>As my understanding, pprof stops and samples go program at every 10ms. So a 30s program should got 3000 samples, but what\u2019s the meaning of the 26.26s? How can the samples count be shown as time duration?</p>\n\n<p>What\u2019s more, I even ever got such output shows that the sample time is bigger than wall time, how could it be such result?</p>\n\n<p><code>Duration: 5.13s, Total samples = 5.57s (108.58%)</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 561, "user_id": 522915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c96d965519bcb39f42401ff75d807ae?s=128&d=identicon&r=PG", "display_name": "cyang", "link": "https://stackoverflow.com/users/522915/cyang"}, "edited": false, "score": 0, "creation_date": 1563199821, "post_id": 57041339, "comment_id": 100610794, "body": "This example teaches you how to send GET and POST in go. <a href=\"https://dlintw.github.io/gobyexample/public/http-client.html\" rel=\"nofollow noreferrer\">dlintw.github.io/gobyexample/public/http-client.html</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563199983, "post_id": 57041339, "comment_id": 100610867, "body": "You&#39;re not setting any cookies in your request, so it isn&#39;t sending any. If it needs cookies set, set them: <a href=\"https://golang.org/pkg/net/http/#Request.AddCookie\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Request.AddCookie</a>"}, {"owner": {"reputation": 1, "user_id": 11148783, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lKX147qZ32g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMn9syT9XE5t6XZfRxX-VEoVNflUQ/mo/photo.jpg?sz=128", "display_name": "Tagir Veliev", "link": "https://stackoverflow.com/users/11148783/tagir-veliev"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563200828, "post_id": 57041339, "comment_id": 100611364, "body": "@Adrian JSESSIONID is always different, this value is formed on the server side during each session. Cookies are not listed in VBA code, but everything works fine"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563200902, "post_id": 57041339, "comment_id": 100611407, "body": "They&#39;re probably coming from somewhere else in the VB code (perhaps saved from a previous request to the same site). Cookies don&#39;t appear from nowhere."}, {"owner": {"reputation": 1, "user_id": 11148783, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lKX147qZ32g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMn9syT9XE5t6XZfRxX-VEoVNflUQ/mo/photo.jpg?sz=128", "display_name": "Tagir Veliev", "link": "https://stackoverflow.com/users/11148783/tagir-veliev"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563201638, "post_id": 57041339, "comment_id": 100611860, "body": "@Adrian VB code is written by me, cookies are not registered anywhere in it. Can&#39;t the server create them for the session to track authorization"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563204009, "post_id": 57041339, "comment_id": 100613185, "body": "Yes, cookies originate on the server side. The client gets a <code>Set-Cookie</code> header, saves the values, and returns them in the <code>Cookie</code> header on subsequent requests. Which means, logically, the first request the client makes to the server will contain no cookies."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563206722, "post_id": 57041339, "comment_id": 100614694, "body": "That VBA code might implicitely use IE&#39;s cookies or something like that. Go doesn&#39;t, of course. Create an HTTP client with a <a href=\"https://golang.org/pkg/net/http/#Client.Jar\" rel=\"nofollow noreferrer\">cookie jar</a> and establish a session before making the login request."}, {"owner": {"reputation": 1, "user_id": 11148783, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lKX147qZ32g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMn9syT9XE5t6XZfRxX-VEoVNflUQ/mo/photo.jpg?sz=128", "display_name": "Tagir Veliev", "link": "https://stackoverflow.com/users/11148783/tagir-veliev"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563349900, "post_id": 57041339, "comment_id": 100665886, "body": "@Peter thanks for the help, add cookie jar and work well"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11148783, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lKX147qZ32g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMn9syT9XE5t6XZfRxX-VEoVNflUQ/mo/photo.jpg?sz=128", "display_name": "Tagir Veliev", "link": "https://stackoverflow.com/users/11148783/tagir-veliev"}, "is_accepted": true, "score": 0, "last_activity_date": 1563350373, "creation_date": 1563350373, "answer_id": 57071138, "question_id": 57041339, "link": "https://stackoverflow.com/questions/57041339/i-can-not-send-a-post-request-with-golang/57071138#57071138", "title": "I can not send a post request with Golang?", "body": "<p>Thanks @Peter</p>\n\n<pre><code>urlLogin := \"http://kasant.gvc.oao.rzd:8888/kasant/login?\"\nformData := url.Values{\n    \"dor_user\": {\"51\"},\n    \"login\":    {\"nvivc\"},\n    \"pass\":     {\"51256\"},\n}\ncookieJar, _ := cookiejar.New(nil)\nclient := &amp;http.Client{\n    Jar: cookieJar,\n}\nrespp, _ := client.Post(urlLogin, \"application/x-www-form-urlencoded\", bytes.NewBufferString(formData.Encode()))\ndefer respp.Body.Close()\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11148783, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lKX147qZ32g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMn9syT9XE5t6XZfRxX-VEoVNflUQ/mo/photo.jpg?sz=128", "display_name": "Tagir Veliev", "link": "https://stackoverflow.com/users/11148783/tagir-veliev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 57071138, "answer_count": 1, "score": -5, "last_activity_date": 1563350373, "creation_date": 1563199057, "question_id": 57041339, "link": "https://stackoverflow.com/questions/57041339/i-can-not-send-a-post-request-with-golang", "title": "I can not send a post request with Golang?", "body": "<p>VBA code works well</p>\n\n<pre><code>Set oFields = CreateObject(\"Scripting.Dictionary\")\nWith oFields\n    .Add \"dor_user\", \"51\"\n    .Add \"login\", \"nvivc\"\n    .Add \"pass\", \"51256\"\nEnd With\nFor Each sName In oFields\n    oFields(sName) = sName &amp; \"=\" &amp; EncodeUriComponent(oFields(sName))\nNext\nsPayLoad = Join(oFields.Items(), \"&amp;\")\nWith CreateObject(\"MSXML2.XMLHTTP\")\n    .Open \"POST\", \"http://kasant.gvc.oao.rzd:8888/kasant/login?\", False\n    .setRequestHeader \"Content-Type\", \"application/x-www-form-urlencoded\"\n    .setRequestHeader \"Content-Length\", LenB(sPayLoad)\n    .Send (sPayLoad)\n    Do While .readyState &lt;&gt; 4\n        DoEvents\n    Loop\nEnd With\n</code></pre>\n\n<p>Login successful\nFIDDLER</p>\n\n<blockquote>\n  <p>POST <a href=\"http://kasant.gvc.oao.rzd:8888/kasant/login\" rel=\"nofollow noreferrer\">http://kasant.gvc.oao.rzd:8888/kasant/login</a>? HTTP/1.1</p>\n  \n  <p>Accept: <em>/</em></p>\n  \n  <p>Content-Type: application/x-www-form-urlencoded</p>\n  \n  <p>Accept-Language: ru,en-US;q=0.7,en;q=0.3</p>\n  \n  <p>UA-CPU: AMD64</p>\n  \n  <p>Accept-Encoding: gzip, deflate</p>\n  \n  <p>User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64;\n  x64; Trident/7.0; .NET4.0C; .NET4.0E)</p>\n  \n  <p>Host: kasant.gvc.oao.rzd:8888</p>\n  \n  <p>Content-Length: 34</p>\n  \n  <p>Connection: Keep-Alive</p>\n  \n  <p>Pragma: no-cache</p>\n  \n  <p>Cookie: dor_user=\"\"; kasant_pass=\"\"; kasant_user=\"\"; \n  kasant_pass_save=false;\n  JSESSIONID=0000VSeSKuzaru0vpwzeeSQF29Y:1ak0n0hlm</p>\n  \n  <p>dor_user=51&amp;login=nvivc&amp;pass=51256</p>\n</blockquote>\n\n<p><strong>JSESSIONID</strong>=0000VSeSKuzaru0vpwzeeSQF29Y:1ak0n0hlm</p>\n\n<p>Code Golang</p>\n\n<pre><code>urlLogin := \"http://kasant.gvc.oao.rzd:8888/kasant/login?\"\nformData := url.Values{\n    \"dor_user\": {\"51\"},\n    \"login\":    {\"nvivc\"},\n    \"pass\":     {\"51256\"},\n}\nclient := &amp;http.Client{}\nreq, _ := http.NewRequest(\"POST\", urlLogin, bytes.NewBufferString(formData.Encode()))\nreq.Header.Set(\"User-Agent\", \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)\")\nreq.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\nresp, _ := client.Do(req)\ndefer resp.Body.Close()\n</code></pre>\n\n<p>FIDDLER</p>\n\n<blockquote>\n  <p>POST <a href=\"http://kasant.gvc.oao.rzd:8888/kasant/login\" rel=\"nofollow noreferrer\">http://kasant.gvc.oao.rzd:8888/kasant/login</a>? HTTP/1.1 Host:</p>\n  \n  <p>kasant.gvc.oao.rzd:8888 User-Agent: Mozilla/4.0 (compatible; MSIE 7.0;</p>\n  \n  <p>Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E)</p>\n  \n  <p>Content-Length: 34 Content-Type: application/x-www-form-urlencoded</p>\n  \n  <p>Accept-Encoding: gzip</p>\n  \n  <p>dor_user=51&amp;login=nvivc&amp;pass=51256</p>\n</blockquote>\n\n<p>Missing cookies and <strong>JSESSIONID</strong>. Login failed!!! \nTell me what is the error???</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563197240, "post_id": 57040318, "comment_id": 100609275, "body": "This code is full of basic syntax errors and wouldn&#39;t even compile to be able to hang. Can you edit your question to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a>?"}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 6180958, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T4JwD.png?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/6180958/arthur"}, "edited": false, "score": 0, "creation_date": 1563197708, "post_id": 57040783, "comment_id": 100609529, "body": "Thank you very much, loop is really help! Problem solved."}], "tags": [], "owner": {"reputation": 256, "user_id": 11368381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28c4851d78c9ce48c8140fcf1b9aaf10?s=128&d=identicon&r=PG&f=1", "display_name": "jubukka", "link": "https://stackoverflow.com/users/11368381/jubukka"}, "is_accepted": true, "score": 0, "last_activity_date": 1563197197, "creation_date": 1563197197, "answer_id": 57040783, "question_id": 57040318, "link": "https://stackoverflow.com/questions/57040318/goroutines-communication-trough-channel-works-only-once/57040783#57040783", "title": "Goroutines communication trough channel works only once", "body": "<p>Seems like 'msgChanel' is read only once with 'msg := &lt;-msgChanel'. Channel is blocked and cannot be written into by the HTTP request handler. Maybe you should read channel values with a for loop.</p>\n"}], "owner": {"reputation": 79, "user_id": 6180958, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T4JwD.png?s=128&g=1", "display_name": "Arthur", "link": "https://stackoverflow.com/users/6180958/arthur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 57040783, "answer_count": 1, "score": 0, "last_activity_date": 1563197197, "creation_date": 1563195668, "last_edit_date": 1563195803, "question_id": 57040318, "link": "https://stackoverflow.com/questions/57040318/goroutines-communication-trough-channel-works-only-once", "title": "Goroutines communication trough channel works only once", "body": "<p>My first attempt to write code in Golang (1.12) with go-routine and channel communication. I have Telegram bot and piece of code which can communicate with bot when some update happened and answer needed. At the same time I try to put some web service which will get a message trough http GET and send it to Bot. And in fact it works, but only once. After it Bot part still working, but http Get request cannot be performed, it hang on till time out.</p>\n\n<p>I try to use channel with buffer, but in this it stops working completely.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n//App is a structure with Bot objects\ntype App struct {\n    Router *mux.Router\n    Bot\n}\n\n//Initialize is method to initialize App session\nfunc (a *App) Initialize() {\n\n    var err error\n\n    a.Bot.BotAPI, err = telegram.NewBotAPI(TelegramBotAPIkey)\n    checkErr(err)\n\n    a.Router = mux.NewRouter()\n    a.initializeRoutes()\n    msgChanel = make(chan string)\n}\n\n\nfunc (a *App) initializeRoutes() {\n    a.Router.HandleFunc(\"/\", a.homePage).Methods(\"GET\")\n    a.Router.Path(\"/message/send\").Queries(\"msg\", \"{msg}\").HandlerFunc(a.getMessage).Methods(\"GET\")\n}\n\n\n}\n\n// Handling of requests to send/message\nfunc (a *App) getMessage(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, \"-----Send message to Bot-------\")\n    vars := mux.Vars(r)\n    if vars[\"msg\"] != \"\" {\n        fmt.Fprintln(w, vars[\"msg\"])\n        msgChanel &lt;- vars[\"msg\"]\n    }\n\n// Run is all about running application\nfunc (a *App) Run() {\n\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n\n    go func() {\n        defer wg.Done()\n        msg := &lt;-msgChanel\n        a.Bot.generateAnswer(msgid, msg)\n    }()\n\n    go func() {\n\n        var msg string\n\n        defer wg.Done()\n        a.Bot.BotAPI.Debug = true\n\n        u := telegram.NewUpdate(0)\n        u.Timeout = 60\n\n        updates, err := a.Bot.BotAPI.GetUpdatesChan(u)\n        checkErr(err)\n\n        for update := range updates {\n            if update.Message == nil {\n                continue\n            }\n            msg = \"\"\n            msgid = update.Message.Chat.ID\n            a.Bot.generateAnswer(msgid, msg)\n        }\n    }()\n\n    log.Fatal(http.ListenAndServe(\":8080\", a.Router))\n\n    wg.Wait()\n\n}\n\n</code></pre>\n\n<p>My problem that there is no error message. I run application and then it is working in terms on Bot communication, but communication with web service happened only once. My first thought was that it is because of of channel blocking, but I send string to channel, then I read it, so it there are should not be any blocking. So my expectation is that each time when I send http GET with message text it will be immediately send to Bot, and system was ready to get next request.</p>\n"}, {"tags": ["go", "gif"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1563209717, "last_edit_date": 1563209717, "creation_date": 1563209318, "answer_id": 57044064, "question_id": 57040295, "link": "https://stackoverflow.com/questions/57040295/gif-generation-exercise-from-the-go-programming-language-creating-corrupt-file/57044064#57044064", "title": "Gif Generation Exercise from The Go Programming Language Creating Corrupt File", "body": "<p>I'm unable to reproduce your issue.</p>\n\n<pre><code>cmd.exe\nMicrosoft Windows [Version 10.0.18362.239]\n\n&gt;go version\ngo version devel +89d300b821 Sun Jul 14 20:15:47 2019 +0000 windows/amd64\n\n&gt;go run lissajous.go &gt; lissajous.gif\n\nFirefox 68.0 (64-bit)\nMenu -&gt; Open File -&gt; lissajous.gif\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/dQphX.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/dQphX.gif\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<p><code>lissajous.go</code> (from the question):</p>\n\n<pre><code>// Lissajous generates GIF animations of random Lissajous figures.\npackage main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"image/gif\"\n    \"io\"\n    \"math\"\n    \"math/rand\"\n    \"os\"\n)\n\nvar palette = []color.Color{color.White, color.Black}\n\nconst (\n    whiteIndex = 0 // first color in palette\n    blackIndex = 1 // next color in palette\n)\n\nfunc main() {\n    lissajous(os.Stdout)\n}\nfunc lissajous(out io.Writer) {\n    const (\n        cycles  = 5     // number of complete x oscillator revolutions\n        res     = 0.001 // angular resolution\n        size    = 100   // image canvas covers [-size..+size]\n        nframes = 64    // number of animation frames\n        delay   = 8     // delay between frames in 10ms units\n    )\n    freq := rand.Float64() * 3.0 // relative frequency of y oscillator\n    anim := gif.GIF{LoopCount: nframes}\n    phase := 0.0 // phase difference\n    for i := 0; i &lt; nframes; i++ {\n        rect := image.Rect(0, 0, 2*size+1, 2*size+1)\n        img := image.NewPaletted(rect, palette)\n        for t := 0.0; t &lt; cycles*2*math.Pi; t += res {\n            x := math.Sin(t)\n            y := math.Sin(t*freq + phase)\n            img.SetColorIndex(size+int(x*size+0.5), size+int(y*size+0.5),\n                blackIndex)\n        }\n        phase += 0.1\n        anim.Delay = append(anim.Delay, delay)\n        anim.Image = append(anim.Image, img)\n    }\n    gif.EncodeAll(out, &amp;anim) // NOTE: ignoring encoding errors\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10162437, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XGRAk.jpg?s=128&g=1", "display_name": "Fernando Arrigorriaga", "link": "https://stackoverflow.com/users/10162437/fernando-arrigorriaga"}, "is_accepted": false, "score": 0, "last_activity_date": 1567483963, "last_edit_date": 1567483963, "creation_date": 1567457009, "answer_id": 57762521, "question_id": 57040295, "link": "https://stackoverflow.com/questions/57040295/gif-generation-exercise-from-the-go-programming-language-creating-corrupt-file/57762521#57762521", "title": "Gif Generation Exercise from The Go Programming Language Creating Corrupt File", "body": "<p>The problem arises only if you use Powershell. I faced the same problem and solved it by executing the <code>go run</code> command using cmd.</p>\n"}], "owner": {"reputation": 1249, "user_id": 3199109, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2ea70f0c2a432ffbb9e5875039645b39?s=128&d=identicon&r=PG&f=1", "display_name": "loganhuskins", "link": "https://stackoverflow.com/users/3199109/loganhuskins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1567483963, "creation_date": 1563195590, "last_edit_date": 1563196311, "question_id": 57040295, "link": "https://stackoverflow.com/questions/57040295/gif-generation-exercise-from-the-go-programming-language-creating-corrupt-file", "title": "Gif Generation Exercise from The Go Programming Language Creating Corrupt File", "body": "<p>I am working on the exercises in the book The Go Programming Language. In the first chapter, there is an exercise that generates a gif. I have run the program without errors, but have been unable to open the gif. It appears corrupt.</p>\n\n<p>I am on Windows 10 and have tried to open the file in browsers, IfranView 64bit version 4.53, and the default Photos app.</p>\n\n<p>Code:</p>\n\n<pre><code>// Lissajous generates GIF animations of random Lissajous figures.\npackage main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"image/gif\"\n    \"io\"\n    \"math\"\n    \"math/rand\"\n    \"os\"\n)\n\nvar palette = []color.Color{color.White, color.Black}\nconst (\n    whiteIndex = 0 // first color in palette\n    blackIndex = 1 // next color in palette\n)\nfunc main() {\n    lissajous(os.Stdout)\n}\nfunc lissajous(out io.Writer) {\n    const (\n        cycles = 5 // number of complete x oscillator revolutions\n        res = 0.001 // angular resolution\n        size = 100 // image canvas covers [-size..+size]\n        nframes = 64 // number of animation frames\n        delay = 8 // delay between frames in 10ms units\n    )\n    freq := rand.Float64() * 3.0 // relative frequency of y oscillator\n    anim := gif.GIF{LoopCount: nframes}\n    phase := 0.0 // phase difference\n    for i := 0; i &lt; nframes; i++ {\n        rect := image.Rect(0, 0, 2*size+1, 2*size+1)\n        img := image.NewPaletted(rect, palette)\n        for t := 0.0; t &lt; cycles*2*math.Pi; t += res {\n            x := math.Sin(t)\n            y := math.Sin(t*freq + phase)\n            img.SetColorIndex(size+int(x*size+0.5), size+int(y*size+0.5),\n                blackIndex)\n        }\n        phase += 0.1\n        anim.Delay = append(anim.Delay, delay)\n        anim.Image = append(anim.Image, img)\n    }\n    gif.EncodeAll(out, &amp;anim) // NOTE: ignoring encoding errors\n}\n</code></pre>\n\n<p>I run the application in Powershell by evoking <code>go run {programname}.go &gt; out.gif</code> and by compiling and running <code>./{programname}.exe &gt; out.gif</code>.</p>\n\n<p>How can I figure out what's wrong with the gif and how can I generate it correctly?</p>\n"}, {"tags": ["go", "interface", "method-chaining"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1563194904, "post_id": 57040008, "comment_id": 100607913, "body": "It&#39;s a pretty serious code smell if your implementation of <code>IntCells</code> needs to know that <code>FloatCells</code> exists."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563195004, "post_id": 57040008, "comment_id": 100607968, "body": "But to your question: Why not just make it return <code>NumCells</code> then?"}, {"owner": {"reputation": 590, "user_id": 6212718, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/38f617dbb24ae7c83790fb981650f6d4?s=128&d=identicon&r=PG&f=1", "display_name": "FredMaster", "link": "https://stackoverflow.com/users/6212718/fredmaster"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563195039, "post_id": 57040008, "comment_id": 100607992, "body": "Hi @Flimzy thanks for your swift response. Will edit regarding inheritance. Regarding &quot;code smell&quot;. I am a self-taught coder just learning <code>go</code>. So any suggestions will help!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563195101, "post_id": 57040008, "comment_id": 100608023, "body": "One of the reasons to use interfaces is so that your implementations <i>don&#39;t have to know about each other</i>. Any interaction between implementations should happen <i>through the interface</i>. So if your <code>IntCells</code> needs information about another type, get it through the defined interface, not by doing type assertions and building logic about other types into <code>IntCells</code>."}, {"owner": {"reputation": 590, "user_id": 6212718, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/38f617dbb24ae7c83790fb981650f6d4?s=128&d=identicon&r=PG&f=1", "display_name": "FredMaster", "link": "https://stackoverflow.com/users/6212718/fredmaster"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563195282, "post_id": 57040008, "comment_id": 100608128, "body": "So you mean I should use type switch in something like <code>Add(nC NumCells)</code> instead?"}], "answers": [{"comments": [{"owner": {"reputation": 590, "user_id": 6212718, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/38f617dbb24ae7c83790fb981650f6d4?s=128&d=identicon&r=PG&f=1", "display_name": "FredMaster", "link": "https://stackoverflow.com/users/6212718/fredmaster"}, "edited": false, "score": 0, "creation_date": 1563196054, "post_id": 57040330, "comment_id": 100608556, "body": "Thanks. This works! Although I am now struggling to understand Flimzy&#39;s comment."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 590, "user_id": 6212718, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/38f617dbb24ae7c83790fb981650f6d4?s=128&d=identicon&r=PG&f=1", "display_name": "FredMaster", "link": "https://stackoverflow.com/users/6212718/fredmaster"}, "edited": false, "score": 0, "creation_date": 1563196349, "post_id": 57040330, "comment_id": 100608704, "body": "@FredMaster, I updated my answer to include some more explanations regarding trying to avoid the type switches to make it more complete."}, {"owner": {"reputation": 590, "user_id": 6212718, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/38f617dbb24ae7c83790fb981650f6d4?s=128&d=identicon&r=PG&f=1", "display_name": "FredMaster", "link": "https://stackoverflow.com/users/6212718/fredmaster"}, "edited": false, "score": 0, "creation_date": 1563197161, "post_id": 57040330, "comment_id": 100609218, "body": "Great. Thanks! This gives me something to chew on :-)"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1563196306, "last_edit_date": 1563196306, "creation_date": 1563195726, "answer_id": 57040330, "question_id": 57040008, "link": "https://stackoverflow.com/questions/57040008/golang-interface-method-chaining/57040330#57040330", "title": "Golang interface method chaining", "body": "<p>It works if you define your <code>NumCells</code> interface this way:</p>\n\n<pre><code>type NumCells interface{\n    Cells\n    Add(NumCells) NumCells // returns either IntCells or FloatCells\n}\n</code></pre>\n\n<p>You then need both <code>IntCells</code> and <code>FloatCells</code> to implement <code>Add</code> and return one of those types.</p>\n\n<p>Here's a working playground, using method chaining and printing the result:</p>\n\n<p><a href=\"https://play.golang.org/p/W7DzcB4A3NH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/W7DzcB4A3NH</a></p>\n\n<p>As stated in the comments, when using interfaces one usually wants to make each type agnostic of the rest of the implementations and just use the interface without type switches.</p>\n\n<p>One way to avoid those type switches in the implementations of <code>Add</code> might be to add another method in the <code>NumCells</code> to return a particular position as a <code>float64</code>.</p>\n\n<pre><code>type NumCells interface{\n    Cells\n    Add(NumCells) NumCells // returns either IntCells or FloatCells\n    GetCell(index int) float64\n}\n</code></pre>\n\n<p>So that then you can get the value without needing to assert the particular type.</p>\n\n<p>Since <code>IntCells</code> cannot accommodate <code>float64</code> values, it'd still need to create a <code>FloatCells</code> to return it, if we want to avoid <code>IntCells</code> doing that we'd need to abstract the creation of the objects somehow, using a factory pattern or similar.</p>\n"}], "owner": {"reputation": 590, "user_id": 6212718, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/38f617dbb24ae7c83790fb981650f6d4?s=128&d=identicon&r=PG&f=1", "display_name": "FredMaster", "link": "https://stackoverflow.com/users/6212718/fredmaster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "accepted_answer_id": 57040330, "answer_count": 1, "score": -1, "last_activity_date": 1563196306, "creation_date": 1563194532, "last_edit_date": 1563195129, "question_id": 57040008, "link": "https://stackoverflow.com/questions/57040008/golang-interface-method-chaining", "title": "Golang interface method chaining", "body": "<p>I have an interface <code>Cells</code> with several methods</p>\n\n<pre><code>type Cells interface{\n    Len() int\n    //....\n}\n</code></pre>\n\n<p>Concrete implementations of this are <code>StrCells</code>, <code>IntCells</code>, <code>FloatCells</code> and <code>BoolCells</code>, all of which have the above methods implemented. </p>\n\n<p>E.g.:</p>\n\n<pre><code>type StrCells []string\nfunc (sC StrCells) Len() int {return len(sC)}\n//...\n\ntype IntCells []int\nfunc (iC IntCells) Len() int {return len(iC)}\n//...\n\n//....\n</code></pre>\n\n<p>For two of the concrete types - <code>IntCells</code> and <code>FloatCells</code> - I want to implement specific functions only applicable to those types. </p>\n\n<p>I create a new interface <code>NumCells</code> which embedds <code>Cells</code></p>\n\n<pre><code>type NumCells interface{\n    Cells\n    Add(NumCells) interface{} // should return either IntCells or FloatCells \n}\n</code></pre>\n\n<p>Here is my implementation of <code>Add()</code> for IntCells:</p>\n\n<pre><code>func (iC IntCells) Add(nC NumCells) interface{} {\n    if iC.Len() != nC.Len() {\n        // do stuff\n    }\n    switch nC.(type) {\n    case IntCells:\n        res := make(IntCells, iC.Len())\n        for i, v := range iC {\n            res[i] = v + nC.(IntCells)[i]\n        }\n        return res\n    case FloatCells:\n        res := make(FloatCells, iC.Len())\n        for i, v := range iC {\n            res[i] = float64(v) + nC.(FloatCells)[i]\n        }\n        return res\n    default:\n        // to come\n        return nil\n    }\n\n}\n</code></pre>\n\n<p><strong>Here is my question / problem</strong>  </p>\n\n<p>The function works, however, I actually want the function to return <code>NumCells</code> (i.e. either IntCells or FloatCells) so I could do method chaining like this</p>\n\n<pre><code>a := columns.IntCells(1, 2, 4, 2)\nb := columns.IntCells{2, 3, 5, 3}\nc := columns.FloatCells{3.1, 2, 2.4, 3.2}\nd := a.Add(b).Add(c)\n</code></pre>\n\n<p>This is not possible if <code>Add()</code> returns an <code>interface{}</code>. However, I am not able to make the function work otherwise.</p>\n"}, {"tags": ["go", "serialization", "protocol-buffers", "protobuf-go"], "answers": [{"tags": [], "owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "is_accepted": true, "score": 2, "last_activity_date": 1563228316, "creation_date": 1563228316, "answer_id": 57047726, "question_id": 57039033, "link": "https://stackoverflow.com/questions/57039033/go-protobuf-declarations-and-optional-fields-in-go-struct-string-pointers/57047726#57047726", "title": "Go Protobuf declarations and optional Fields in Go Struct (string pointers)", "body": "<p>Proto3 returns the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">Zero Value</a> even if a field isn't set. Currently there is no way to distinguish if a field has been set or not. </p>\n\n<p>See Github issue <a href=\"https://github.com/golang/protobuf/issues/15\" rel=\"nofollow noreferrer\">#15</a>.</p>\n\n<p><strong>Possible solutions:</strong></p>\n\n<ul>\n<li>Use <a href=\"https://developers.google.com/protocol-buffers/docs/reference/go-generated?hl=en#singular-scalar-proto2\" rel=\"nofollow noreferrer\">proto2</a> instead of <a href=\"https://developers.google.com/protocol-buffers/docs/reference/go-generated?hl=en#singular-scalar-proto3\" rel=\"nofollow noreferrer\">proto3</a>.</li>\n<li>Use gogoproto's <a href=\"https://godoc.org/github.com/gogo/protobuf/gogoproto#hdr-More_Canonical_Go_Structures\" rel=\"nofollow noreferrer\">nullable</a> extension.</li>\n<li>Use the <code>google.protobuf.FieldMask</code> extension, see Common Design Patterns\nfrom the Google API Design Guide: <a href=\"https://cloud.google.com/apis/design/design_patterns#partial_response\" rel=\"nofollow noreferrer\">Partial Responses</a> and <a href=\"https://cloud.google.com/apis/design/design_patterns#output_fields\" rel=\"nofollow noreferrer\">Output Fields</a>.</li>\n</ul>\n\n<hr>\n\n<p>Probably not a solution:</p>\n\n<blockquote>\n  <p>Write the tedious mapping code with target.Path = *source.Path with the appropriate null pointer.</p>\n</blockquote>\n\n<p>... as this won't work for int types where the zero value is 0.</p>\n"}, {"tags": [], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "is_accepted": false, "score": 0, "last_activity_date": 1589528783, "creation_date": 1589528783, "answer_id": 61814251, "question_id": 57039033, "link": "https://stackoverflow.com/questions/57039033/go-protobuf-declarations-and-optional-fields-in-go-struct-string-pointers/61814251#61814251", "title": "Go Protobuf declarations and optional Fields in Go Struct (string pointers)", "body": "<p>In my case, I solved this problem with several packages:</p>\n\n<ol>\n<li><a href=\"https://github.com/gogo/protobuf\" rel=\"nofollow noreferrer\">https://github.com/gogo/protobuf</a></li>\n<li><a href=\"https://github.com/golang/protobuf\" rel=\"nofollow noreferrer\">https://github.com/golang/protobuf</a></li>\n</ol>\n\n<p>My proto file looks like this:</p>\n\n<pre><code>syntax = \"proto3\";\n\nimport \"google/protobuf/wrappers.proto\";\nimport \"github.com/gogo/protobuf/gogoproto/gogo.proto\";\n\nmessage Message {\n  google.protobuf.StringValue path = 1 [(gogoproto.wktpointer) = true];\n}\n</code></pre>\n\n<p>The command for generating the go code, which I used look like this:</p>\n\n<pre><code>protoc -I. -I%GOPATH%/src --gogofaster_out=plugins=grpc:. proto/*.proto\n</code></pre>\n\n<p>The generated go file looks like this:</p>\n\n<pre><code>type Message struct {\n    Path *string `protobuf:\"bytes,1,opt,name=path,json=path,proto3,wktptr\" json:\"path,omitempty\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 55, "user_id": 9321069, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-11Kzi-0PHBU/AAAAAAAAAAI/AAAAAAAAAAc/e94hIqeDmH8/photo.jpg?sz=128", "display_name": "Jonyhy96", "link": "https://stackoverflow.com/users/9321069/jonyhy96"}, "is_accepted": false, "score": 0, "last_activity_date": 1616658158, "creation_date": 1616658158, "answer_id": 66795083, "question_id": 57039033, "link": "https://stackoverflow.com/questions/57039033/go-protobuf-declarations-and-optional-fields-in-go-struct-string-pointers/66795083#66795083", "title": "Go Protobuf declarations and optional Fields in Go Struct (string pointers)", "body": "<p><a href=\"https://stackoverflow.com/a/62566052\">https://stackoverflow.com/a/62566052</a>\nproto3 support optional with flag <code>--experimental_allow_proto3_optional</code></p>\n"}], "owner": {"reputation": 22034, "user_id": 21699, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1c27bc77c7d5d9506958e3f9164341b7?s=128&d=identicon&r=PG", "display_name": "Tigraine", "link": "https://stackoverflow.com/users/21699/tigraine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3140, "favorite_count": 0, "accepted_answer_id": 57047726, "answer_count": 3, "score": 3, "last_activity_date": 1616658158, "creation_date": 1563191015, "question_id": 57039033, "link": "https://stackoverflow.com/questions/57039033/go-protobuf-declarations-and-optional-fields-in-go-struct-string-pointers", "title": "Go Protobuf declarations and optional Fields in Go Struct (string pointers)", "body": "<p>I am running into a bit of a problem with Protoc and my existing struct that contains nullable string fields.</p>\n\n<p>The struct I am trying to serialize for transmission contains a bunch of fields that are nullable in json (so we can distinguish between <code>null</code>, <code>\"\"</code> and a set value).</p>\n\n<pre><code>type Message struct {\n  Path *string `json:\"path\"`\n}\n</code></pre>\n\n<p>So if a user sends a empty json string <code>{}</code> the Path will be <code>nil</code> and not <code>\"\"</code>, whereas <code>{\"path\":\"\"}</code> is also valid and a different case from <code>{\"path\": null}</code>.</p>\n\n<p>The <code>proto3</code> declaration I came up with obviously looks like this (and is optional as <code>required</code> and <code>optional</code> got dropped from proto3:</p>\n\n<pre><code>syntax = \"proto3\";\nmessage Message {\n  string Path = 1;\n}\n</code></pre>\n\n<p>After running Protoc I end up with a struct that looks like this and all values are <code>string</code> and no way to declare them as <code>*string</code>:</p>\n\n<pre><code>type Message struct {\n  Path string `protobuf:\"bytes,1,opt,name=Path,proto3\" json:\"Path,omitempty\"`\n}\n</code></pre>\n\n<p>Obviously I can't assign to this array from my existing struct. But even if I were to write the tedious mapping code with <code>target.Path = *source.Path</code> with the appropriate null pointer checks etc I'd loose the triple meaning of my source struct (<code>nil</code>, <code>\"\"</code>, <code>\"value\"</code>). </p>\n\n<p>Any suggestions on how to proceed here or if there is an extension to the Go Protobuf to do this? Or how would one go about describing this proto declaration?</p>\n"}, {"tags": ["regex", "go"], "answers": [{"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 1, "last_activity_date": 1563188851, "last_edit_date": 1563188851, "creation_date": 1563188626, "answer_id": 57038405, "question_id": 57038357, "link": "https://stackoverflow.com/questions/57038357/what-would-be-a-regex-to-match-all-occurrences-after-space-separated/57038405#57038405", "title": "What would be a regex to match all occurrences after =, space separated?", "body": "<p>You may use</p>\n\n<pre><code>=([^\\]\\s]+)\n</code></pre>\n\n<p>See <a href=\"https://regex101.com/r/WU5RTQ/1\" rel=\"nofollow noreferrer\">regex demo</a></p>\n\n<p><strong>Details</strong></p>\n\n<ul>\n<li><code>=</code> - an equals sign </li>\n<li><code>([^\\]\\s]+)</code> - Capturing group 1: any 1 or more chars other than <code>]</code> and whitespace.</li>\n</ul>\n\n<p><strong><a href=\"https://play.golang.org/p/4tJcEUadGgC\" rel=\"nofollow noreferrer\">GO demo</a></strong>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\n\nfunc main() {\n    s := \"/components/component[name=fan/10 index=55]/cpu\"\n    rx := regexp.MustCompile(`=([^\\]\\s]+)`)\n    matches := rx.FindAllStringSubmatch(s, -1)\n    for _, v := range matches {\n        fmt.Println(v[1])   \n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>fan/10\n55\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": false, "score": 1, "last_activity_date": 1563188844, "creation_date": 1563188844, "answer_id": 57038461, "question_id": 57038357, "link": "https://stackoverflow.com/questions/57038357/what-would-be-a-regex-to-match-all-occurrences-after-space-separated/57038461#57038461", "title": "What would be a regex to match all occurrences after =, space separated?", "body": "<p>You may try to use something like this:</p>\n\n<pre><code>s := \"/components/component[name=fan/10 index=55]/cpu\"\nre := regexp.MustCompile(`=([^\\s\\]]*)`)\nmatches := re.FindAllStringSubmatch(s, -1)\nfmt.Println(matches)\n</code></pre>\n\n<p>Result will be:</p>\n\n<pre><code>[[=fan/10 fan/10] [=55 55]]\n</code></pre>\n"}], "owner": {"reputation": 350, "user_id": 6091736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87bddf5a361754d628ee1365cacfbcc7?s=128&d=identicon&r=PG&f=1", "display_name": "Vivek Subramanian", "link": "https://stackoverflow.com/users/6091736/vivek-subramanian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 57038405, "answer_count": 2, "score": 1, "last_activity_date": 1563188851, "creation_date": 1563188459, "last_edit_date": 1563188534, "question_id": 57038357, "link": "https://stackoverflow.com/questions/57038357/what-would-be-a-regex-to-match-all-occurrences-after-space-separated", "title": "What would be a regex to match all occurrences after =, space separated?", "body": "<p>I have <code>/components/component[name=fan/10 index=55]/cpu</code></p>\n\n<p>I want a <code>regex</code> that givens me <code>fan/10</code> and <code>55</code>. </p>\n\n<p>I tried stuff like <code>=(.*)\\s</code>, but doesn't work. But I'm guessing it has to be done using capturing groups (the () ) somehow?</p>\n"}, {"tags": ["go", "operating-system"], "comments": [{"owner": {"reputation": 7319, "user_id": 2667360, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kKqx3.png?s=128&g=1", "display_name": "Benjamin T", "link": "https://stackoverflow.com/users/2667360/benjamin-t"}, "edited": false, "score": 1, "creation_date": 1563189683, "post_id": 57038303, "comment_id": 100605109, "body": "Not sure if there exist anything in golang, but from what I have seen in C++ some program/libraries prefer to read the information from the &quot;source&quot; than use the command line. Meaning that they will read and parse <code>&#47;etc&#47;lsb-release</code> rather than run <code>lsb-release -a</code>. On Windows you have a C function <code>RtlGetVersion</code>."}, {"owner": {"reputation": 1041, "user_id": 2660313, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7f4cadd6658af696e1d975eda49c49?s=128&d=identicon&r=PG", "display_name": "owlwalks", "link": "https://stackoverflow.com/users/2660313/owlwalks"}, "edited": false, "score": 0, "creation_date": 1563189885, "post_id": 57038303, "comment_id": 100605204, "body": "os/exec and parsing the output as u said"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1563189907, "post_id": 57038303, "comment_id": 100605220, "body": "On contemporary Linux-based OSes the sure way to get this information is to try reading <code>&#47;usr&#47;lib&#47;os-release</code>, and if that fails, try <code>&#47;etc&#47;os-release</code> (different distros have one of them to be a symlink to another, in various directions). The <code>lsb_release</code> binary may ligitimately not be installed on a particular system. On Windows, you may call the <a href=\"https://docs.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-_osversioninfoexa\" rel=\"nofollow noreferrer\"><code>GetVersionEx</code> Win32 API function</a> directly."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1563190123, "post_id": 57038303, "comment_id": 100605323, "body": "&quot;The runtime package can return the operating system.&quot; Specifically, <code>$GOOS</code> is the Go compilation environment name of the target operating system."}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1563190513, "post_id": 57038303, "comment_id": 100605530, "body": "@peterSO, I agree with you, GOOS returns the target operating system, but not the version"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563191916, "post_id": 57038303, "comment_id": 100606291, "body": "Related/possible duplicate: <a href=\"https://stackoverflow.com/q/53197586/13860\">stackoverflow.com/q/53197586/13860</a>"}], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 533, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563190615, "creation_date": 1563188261, "last_edit_date": 1592644375, "question_id": 57038303, "link": "https://stackoverflow.com/questions/57038303/detect-operating-system-version", "title": "Detect operating system version", "body": "<p>The runtime package can return the operating system. This is great because someone can just call <code>runtime.GOOS</code> which will return on of:</p>\n<pre><code>const GOOS = `windows`\nconst GoosAix = 0\nconst GoosAndroid = 0\nconst GoosDarwin = 0\nconst GoosDragonfly = 0\nconst GoosFreebsd = 0\nconst GoosHurd = 0\nconst GoosJs = 0\nconst GoosLinux = 0\nconst GoosNacl = 0\nconst GoosNetbsd = 0\nconst GoosOpenbsd = 0\nconst GoosPlan9 = 0\nconst GoosSolaris = 0\nconst GoosWindows = 1\nconst GoosZos = 0\n</code></pre>\n<p>There are some use case where this is not enough and users want to detect the specific version and just the OS family. How to detect the version of the operating system?</p>\n<p>From the command line someone can type:</p>\n<p><code>sw_vers</code> on macOS</p>\n<blockquote>\n<p>ProductName:   Mac OS X</p>\n<p>ProductVersion:    10.14.5</p>\n<p>BuildVersion:  18F132</p>\n</blockquote>\n<p><code>lsb_release -a</code> on Ubuntu</p>\n<blockquote>\n<p>Distributor ID:    Ubuntu</p>\n<p>Description:   Ubuntu 14.04.5 LTS</p>\n<p>Release:   14.04</p>\n<p>Codename:  trusty</p>\n</blockquote>\n<p><code>ver</code> on Windows</p>\n<blockquote>\n<p>Microsoft Windows [Version 10.0.17134.829]</p>\n</blockquote>\n<p>I guess this can be done by using <code>os/exec</code> and parsing the output of the commands above, but is there a better way?</p>\n"}, {"tags": ["oracle", "go"], "comments": [{"owner": {"reputation": 75434, "user_id": 9097906, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RmIqt.jpg?s=128&g=1", "display_name": "Littlefoot", "link": "https://stackoverflow.com/users/9097906/littlefoot"}, "edited": false, "score": 2, "creation_date": 1563187115, "post_id": 57037549, "comment_id": 100603878, "body": "As far as Oracle is concerned, nothing wrong with your code. I tested it on 12.2.0.1.0 (which is your database version), works correctly when ran in SQL*Plus. Maybe it has to do something with the 3rd party driver (as you said)."}, {"owner": {"reputation": 868, "user_id": 4113109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c8272ee0ba8d6fb56ed64c4c116f80d?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Satyavada", "link": "https://stackoverflow.com/users/4113109/aditya-satyavada"}, "reply_to_user": {"reputation": 75434, "user_id": 9097906, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RmIqt.jpg?s=128&g=1", "display_name": "Littlefoot", "link": "https://stackoverflow.com/users/9097906/littlefoot"}, "edited": false, "score": 0, "creation_date": 1563187459, "post_id": 57037549, "comment_id": 100604062, "body": "@Littlefoot ditto for me. Runs for me using sqlplus as well. Just needed some confirmation that this is indeed correct. I&#39;m fairly new to oracle. I&#39;ve opened an issue regarding the same: <a href=\"https://github.com/mattn/go-oci8/issues/346\" rel=\"nofollow noreferrer\">github.com/mattn/go-oci8/issues/346</a>."}], "answers": [{"comments": [{"owner": {"reputation": 868, "user_id": 4113109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c8272ee0ba8d6fb56ed64c4c116f80d?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Satyavada", "link": "https://stackoverflow.com/users/4113109/aditya-satyavada"}, "edited": false, "score": 0, "creation_date": 1563250185, "post_id": 57039069, "comment_id": 100626715, "body": "You&#39;re right @Alex. This was the same thing suggested by the owner of the repo I was using. I&#39;m marking this as the correct answer. Thank you for your detailed response !"}], "tags": [], "owner": {"reputation": 160176, "user_id": 266304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bdb6217d08dcea7d67ff75f5f255081?s=128&d=identicon&r=PG", "display_name": "Alex Poole", "link": "https://stackoverflow.com/users/266304/alex-poole"}, "is_accepted": true, "score": 2, "last_activity_date": 1563191168, "creation_date": 1563191168, "answer_id": 57039069, "question_id": 57037549, "link": "https://stackoverflow.com/questions/57037549/ora-01735-when-altering-table-with-inline-constraint/57039069#57039069", "title": "ORA-01735 when altering table with inline constraint", "body": "<p>Remove the semicolon at the end of the <code>ALTER</code> statement:</p>\n\n<pre><code>_sql := `ALTER TABLE \"TAB\" ADD \"XVAR\" CLOB CHECK (\"XVAR\" IS JSON)`\n</code></pre>\n\n<p>The semicolon is client statement separator and is not part of the actual statement (for SQL; PL/SQL is a different matter).</p>\n\n<p>Demo of the problem and fix, via dynamic SQL rather than your stack, but same problem and solution:</p>\n\n<pre><code>BEGIN\n  EXECUTE IMMEDIATE 'ALTER TABLE \"TAB\" ADD \"XVAR\" CLOB CHECK (\"XVAR\" IS JSON);';\nEND;\n/\n\nORA-01735: invalid ALTER TABLE option\nORA-06512: at line 2\n\nBEGIN\n  EXECUTE IMMEDIATE 'ALTER TABLE \"TAB\" ADD \"XVAR\" CLOB CHECK (\"XVAR\" IS JSON)';\nEND;\n/\n\nTable altered.\n</code></pre>\n\n<p><a href=\"https://dbfiddle.uk/?rdbms=oracle_18&amp;fiddle=7fa13def81ce0c2d133023e58d89a776\" rel=\"nofollow noreferrer\">db&lt;>fiddle</a></p>\n"}], "owner": {"reputation": 868, "user_id": 4113109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c8272ee0ba8d6fb56ed64c4c116f80d?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Satyavada", "link": "https://stackoverflow.com/users/4113109/aditya-satyavada"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 57039069, "answer_count": 1, "score": 0, "last_activity_date": 1563191168, "creation_date": 1563185322, "question_id": 57037549, "link": "https://stackoverflow.com/questions/57037549/ora-01735-when-altering-table-with-inline-constraint", "title": "ORA-01735 when altering table with inline constraint", "body": "<p>Oracle Version: <strong>Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</strong></p>\n\n<p>Query:\n   <code>ALTER TABLE \"TAB\" ADD \"XVAR\" CLOB CHECK (\"XVAR\" IS JSON);</code></p>\n\n<p>I can't quite understand what is wrong with this statement. Can someone point out what is wrong with this ?</p>\n\n<p>As far as I understand, the constraint does not need to be named by default. Even naming the constraint has not helped here.</p>\n\n<p>I'm trying to run the query on the DB via the <a href=\"https://github.com/mattn/go-oci8\" rel=\"nofollow noreferrer\">go-oci8 driver</a>.</p>\n\n<p>The code to do the same is:</p>\n\n<pre><code>package main\n\nimport (\n\"database/sql\"\n\"fmt\"\n_ \"github.com/mattn/go-oci8\"\n)\n\nfunc main() {\ndb, err := sql.Open(\"oci8\", \"&lt;connectionString&gt;\")\nif err != nil {\n    fmt.Println(err)\n    return\n}\ndefer func(db *sql.DB) {\n    if err := db.Close(); err != nil{\n        fmt.Println(err)\n    }\n}(db)\n\n_sql := `ALTER TABLE \"TAB\" ADD \"XVAR\" CLOB CHECK (\"XVAR\" IS JSON);`\n\nresult, err := db.Exec(_sql)\nif err != nil {\n    fmt.Println(\"Issue with altering table...\")\n    fmt.Println(err)\n    return\n}\n\nfmt.Println(result.RowsAffected())\n</code></pre>\n\n<p>}</p>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>Issue with altering table...\nORA-01735: invalid ALTER TABLE option\n</code></pre>\n\n<p>Is there anything wrong with my query ? Or does it look like an issue with the 3rd party driver I'm using to do the same ?</p>\n"}, {"tags": ["go", "google-cloud-firestore", "google-cloud-functions"], "answers": [{"tags": [], "owner": {"reputation": 233128, "user_id": 807126, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xpNqK.jpg?s=128&g=1", "display_name": "Doug Stevenson", "link": "https://stackoverflow.com/users/807126/doug-stevenson"}, "is_accepted": false, "score": -1, "last_activity_date": 1563195851, "creation_date": 1563195851, "answer_id": 57040365, "question_id": 57037488, "link": "https://stackoverflow.com/questions/57037488/firestore-cloud-function-get-documentsnapshot-from-the-event/57040365#57040365", "title": "Firestore cloud function: Get DocumentSnapshot from the event", "body": "<p>It's typical with code that deals with Cloud Firestore for it to manually copy the values from a DocumentSnapshot into a data structure of your own definition.</p>\n\n<p>The exception to this is with Java code, where the Firestore SDK can use reflection to automatically map field values to and from POJO properties.  But not everyone chooses this, as they might need to modify the values going in and out.  But I don't think the Firestore SDKs for other languages have this sort of support.</p>\n"}], "owner": {"reputation": 2993, "user_id": 3009130, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/01nM1.jpg?s=128&g=1", "display_name": "Vlad-HC", "link": "https://stackoverflow.com/users/3009130/vlad-hc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 270, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563195851, "creation_date": 1563185099, "question_id": 57037488, "link": "https://stackoverflow.com/questions/57037488/firestore-cloud-function-get-documentsnapshot-from-the-event", "title": "Firestore cloud function: Get DocumentSnapshot from the event", "body": "<p>I'm listening for change events of collection documents, just making a dump what I'm receiving: </p>\n\n<pre><code>func ForwardUserChanged(ctx context.Context, e cloudfn.FirestoreEvent) error {\n    raw, err := json.Marshal(e.Value.Fields)\n    if err != nil {\n        return err\n    }\n    fmt.Println(string(raw))\n\n    return nil\n}\n</code></pre>\n\n<p>where <code>FirestoreEvent</code> is a custom struct:</p>\n\n<pre><code>// FirestoreEvent is the payload of a Firestore event.\ntype FirestoreEvent struct {\n    OldValue   FirestoreValue `json:\"oldValue\"`\n    Value      FirestoreValue `json:\"value\"`\n    UpdateMask struct {\n        FieldPaths []string `json:\"fieldPaths\"`\n    } `json:\"updateMask\"`\n}\n\ntype FirestoreValue struct {\n    CreateTime time.Time `json:\"createTime\"`\n    Fields     map[string]interface{} `json:\"fields\"`\n    Name       string                 `json:\"name\"`\n    UpdateTime time.Time              `json:\"updateTime\"`\n}\n</code></pre>\n\n<p>What I want is a simple way of decoding the <code>Fields</code> into my struct, which was saved into the in the same collection before. \nThe thing is that the <code>Fields</code> looks in a pretty complex way and it's not just an easy mapping map[string]interface{} to the struct fields. For example, the <code>Fields</code> looks like this:</p>\n\n<pre><code>{\"answers\":\n  {\"mapValue\":\n    {\"fields\":\n      {\"fish-1\":\n        {\"mapValue\":\n          {\"fields\":{\"option\":{\"stringValue\":\"yes\"},\n</code></pre>\n\n<p>but the original struct is</p>\n\n<pre><code>type Report struct {\n  Answers map[string]Answer\n}\n\ntype Answer struct {\n  Option string\n}\n\n</code></pre>\n\n<p>Is there an easy way to de-serialize the map into the struct? Or it should be done \"by hand\"?</p>\n\n<p>There should be a way to get a <code>DocumentSnapshot</code> from this data. The data from the Firestore look like the protobuf message and it even can be seen in the <code>Document</code> struct from the <code>google.golang.org/genproto/googleapis/firestore/v1</code>.</p>\n"}, {"tags": ["string", "go", "methods", "go-interface"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10747868, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--IocEEqVzFU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iBLN70RLKy_vzg0raGFExZqOjQAQ/mo/photo.jpg?sz=128", "display_name": "Cyanic", "link": "https://stackoverflow.com/users/10747868/cyanic"}, "edited": false, "score": 0, "creation_date": 1563176852, "post_id": 57035305, "comment_id": 100599021, "body": "Thanks, that works! So does that means the run() function just return an error type which wraps a value of *MyError instead of the &amp;MyError written in the run function code block."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1, "user_id": 10747868, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--IocEEqVzFU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iBLN70RLKy_vzg0raGFExZqOjQAQ/mo/photo.jpg?sz=128", "display_name": "Cyanic", "link": "https://stackoverflow.com/users/10747868/cyanic"}, "edited": false, "score": 0, "creation_date": 1563177355, "post_id": 57035305, "comment_id": 100599265, "body": "@Cyanic <code>&amp;MyError</code> is not a type, it&#39;s the address operator applied on a composite literal, which results in a value of type <code>*MyError</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1563177285, "last_edit_date": 1563177285, "creation_date": 1563176709, "answer_id": 57035305, "question_id": 57035266, "link": "https://stackoverflow.com/questions/57035266/what-is-the-difference-between-the-two-err-value/57035305#57035305", "title": "What is the difference between the two err value?", "body": "<p>The function <code>run()</code> returns a value of type <a href=\"https://golang.org/pkg/builtin/#error\" rel=\"nofollow noreferrer\"><code>error</code></a>, which is an interface type. Yes, it wraps a value of concrete type <code>*MyError</code>, but to get access to <code>MyError</code>'s fields, you need to use a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>:</p>\n\n<pre><code>fmt.Println(err2.(*MyError).What)\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/OV4TH_cgsD6\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Note that a value of <code>error</code> type may contain values of other concrete types, actually any that implements the <code>error</code> interface. If it would contain a value of another type, the above type assertion would result in a runtime panic.</p>\n\n<p>If you're unsure <code>err2</code> actually holds a value of type <code>*MyError</code> and you want to avoid the runtime panic, you may use the special form of type assertion to get this information and only act if it is so:</p>\n\n<pre><code>if myerror, ok := err2.(*MyError); ok {\n    fmt.Println(myerror.What) // Here myerror has static type *MyError\n} else {\n    fmt.Println(\"Some other error:\", err2)\n}\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/K7rs3giZQUr\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11645900, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-X1Kv8kh5Obs/AAAAAAAAAAI/AAAAAAAAABo/4hwzSKHgtWU/photo.jpg?sz=128", "display_name": "Jian-Hua He", "link": "https://stackoverflow.com/users/11645900/jian-hua-he"}, "is_accepted": false, "score": 0, "last_activity_date": 1563177927, "creation_date": 1563177927, "answer_id": 57035609, "question_id": 57035266, "link": "https://stackoverflow.com/questions/57035266/what-is-the-difference-between-the-two-err-value/57035609#57035609", "title": "What is the difference between the two err value?", "body": "<p>I think the interface of error type is let you use <code>Error()</code> method without any detail in the concrete structure. You can check on the <a href=\"https://play.golang.org/p/cOBcYBiGHKq\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}], "owner": {"reputation": 1, "user_id": 10747868, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/--IocEEqVzFU/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-iBLN70RLKy_vzg0raGFExZqOjQAQ/mo/photo.jpg?sz=128", "display_name": "Cyanic", "link": "https://stackoverflow.com/users/10747868/cyanic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1563177927, "creation_date": 1563176500, "last_edit_date": 1563176742, "question_id": 57035266, "link": "https://stackoverflow.com/questions/57035266/what-is-the-difference-between-the-two-err-value", "title": "What is the difference between the two err value?", "body": "<p>I'm trying to understand golang interface, my problem is that why err2.What undefined.</p>\n\n<p>Here is a simple code. The output indicates that both err and err2 have same type as *main.MyError, but err2 have no field \"What\", so there must be some difference between err and err2, but I cannot figure out the difference here. I just began learning golang not long before, any help will be greatly appreciated.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"time\"\n        \"reflect\"\n)\n\ntype MyError struct {\n        When time.Time\n        What string\n}\n\nfunc (e *MyError) Error() string {\n        return fmt.Sprintf(\"at %v, %s\",\n                e.When, e.What)\n}\n\nfunc run() error {\n        return &amp;MyError{\n                time.Now(),\n                \"it didn't work\",\n        }\n}\n\nfunc main() {\n        err := &amp;MyError{time.Now(), \"Hello\"}\n        fmt.Println(reflect.TypeOf(err))\n        fmt.Println(err.What)   \n\n        err2 := run()\n        fmt.Println(reflect.TypeOf(err2))\n        fmt.Println(err2.What)\n}\n</code></pre>\n\n<h1>expected output:</h1>\n\n<p><code>main.MyError</code><br /> \n<code>Hello</code><br /> \n<code>main.MyError</code><br /> \n<code>it didn't work</code><br /> </p>\n\n<h1>actual output:</h1>\n\n<p><code>\\# command-line-arguments\n./test.go:34:18: err2.What undefined (type error has no field or method What)</code></p>\n"}, {"tags": ["go", "kubernetes-helm"], "owner": {"reputation": 354, "user_id": 8663603, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Je1LfD1HIp4/AAAAAAAAAAI/AAAAAAAADWg/eCpm_dS5JKo/photo.jpg?sz=128", "display_name": "Saurabh ", "link": "https://stackoverflow.com/users/8663603/saurabh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 350, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563169919, "creation_date": 1563169919, "question_id": 57033863, "link": "https://stackoverflow.com/questions/57033863/connecting-to-kubernetes-cluster-using-helm-go-client", "title": "Connecting to kubernetes cluster using helm go client", "body": "<p>I am using helm go client to install the release. The link is \n<a href=\"https://github.com/helm/helm/tree/55193089e67207363e6f448054113b5a36649d74/pkg/helm\" rel=\"nofollow noreferrer\">https://github.com/helm/helm/tree/55193089e67207363e6f448054113b5a36649d74/pkg/helm</a> </p>\n\n<p>What I didn't get , how can I give my kubeconfig file to this go client so that my client can communicate with the kubernetes cluster. I went through documentation but doesn't has the details on the same. </p>\n\n<p>Is there any other way to connect to cluster from helm go client.</p>\n"}, {"tags": ["go", "error-handling", "bcrypt"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1563172781, "post_id": 57032884, "comment_id": 100597173, "body": "They set cost to default when below <i>minimum</i> cost (not below default) so they can raise the minimum as computing power increases without breaking anyone&#39;s code."}, {"owner": {"reputation": 327, "user_id": 6878109, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0203bee52f4e9266945f07732403a43a?s=128&d=identicon&r=PG&f=1", "display_name": "billyzaelani", "link": "https://stackoverflow.com/users/6878109/billyzaelani"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563178084, "post_id": 57032884, "comment_id": 100599563, "body": "my bad of course, it&#39;s set to default below the minimum cost. my point in the last question is why they set error when above maximum cost? why not just set to default as well just like below minimum cost."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1563182766, "post_id": 57032884, "comment_id": 100601751, "body": "Because it&#39;s always a programmer error to specify a value above the maximum."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 11784508, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/bed6e39df0e89b00b09e6ad603daea40?s=128&d=identicon&r=PG", "display_name": "nhoory", "link": "https://stackoverflow.com/users/11784508/nhoory"}, "is_accepted": false, "score": 1, "last_activity_date": 1563163491, "creation_date": 1563163491, "answer_id": 57033142, "question_id": 57032884, "link": "https://stackoverflow.com/questions/57032884/golang-org-x-crypto-bcrypt-which-error-case-when-generating-hash/57033142#57033142", "title": "golang.org/x/crypto/bcrypt which error case when generating hash", "body": "<p>In addition to returning an error for bad parameters, the function returns an error if it cannot read from the secure random number generator.</p>\n"}], "owner": {"reputation": 327, "user_id": 6878109, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/0203bee52f4e9266945f07732403a43a?s=128&d=identicon&r=PG&f=1", "display_name": "billyzaelani", "link": "https://stackoverflow.com/users/6878109/billyzaelani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563178145, "creation_date": 1563160762, "last_edit_date": 1563178145, "question_id": 57032884, "link": "https://stackoverflow.com/questions/57032884/golang-org-x-crypto-bcrypt-which-error-case-when-generating-hash", "title": "golang.org/x/crypto/bcrypt which error case when generating hash", "body": "<p>This is the function to generate hashed password using <a href=\"https://godoc.org/golang.org/x/crypto/bcrypt\" rel=\"nofollow noreferrer\">bcrypt</a></p>\n\n<p><code>func GenerateFromPassword(password []byte, cost int) ([]byte, error)</code></p>\n\n<blockquote>\n  <p>GenerateFromPassword returns the bcrypt hash of the password at the given cost. If the cost given is less than MinCost, the cost will be set to DefaultCost, instead. Use CompareHashAndPassword, as defined in this package, to compare the returned hashed password with its cleartext version.</p>\n</blockquote>\n\n<p>In which case this function returns an error other than the cost out of range (4, 31)? and the weird thing is they set cost to default when below minimum cost but return an error when the cost is above maximum cost, any reason behind this?</p>\n"}, {"tags": ["json", "go", "jwt", "jwt-go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1563166954, "post_id": 57032662, "comment_id": 100595441, "body": "<code>chkRoles</code> is a slice, it makes very little sense to compare it with a string."}], "answers": [{"tags": [], "owner": {"reputation": 11104, "user_id": 7329832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96a4e398a7a3d75e8cffbc635860e01a?s=128&d=identicon&r=PG&f=1", "display_name": "jps", "link": "https://stackoverflow.com/users/7329832/jps"}, "is_accepted": true, "score": 1, "last_activity_date": 1563799857, "last_edit_date": 1563799857, "creation_date": 1563178548, "answer_id": 57035752, "question_id": 57032662, "link": "https://stackoverflow.com/questions/57032662/how-to-check-roles-claim-array-of-values-of-a-jwt-for-a-certain-value/57035752#57035752", "title": "How to check roles claim (array of values) of a JWT for a certain value?", "body": "<p>The <code>roles</code>claim in the JWT payload is an array, so it could also contain multiple values, e.g. <code>\"roles\":[\"test-app\", \"production-app\"]</code></p>\n\n<p><code>chkRoles</code> is therefore a <code>slice</code> containing these values.\nYou could access them by index, e.g. <code>chkRoles[0]</code>, but if you don't know in which position you would find the value you're looking for, you can iterate over the slice like this:</p>\n\n<pre><code>chkRoles := claims[\"roles\"].([]interface{})\nfor _, role:=range chkRoles {\n  if role == \"test-app\" {\n    fmt.Println(\"Check Roles passed\")\n    break\n  }\n}\n</code></pre>\n\n<p>With this code you'll find out, if the <code>roles</code>claim contains the value \"test-app\". </p>\n\n<p>Here's a complete program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/dgrijalva/jwt-go\"   \n)\n\nfunc main() {\n    tokenString := \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiSm9obiBEb2UiLCJyb2xlcyI6WyJ0ZXN0LWFwcCIsInByb2R1Y3Rpb24tYXBwIl0sImlhdCI6MTUxNjIzOTAyMn0.4VHXYkAXgFkgbQ524ijVClPVJb0GuXRtAVNp3yuGwvA\"\n\n    token, _, err := new(jwt.Parser).ParseUnverified(tokenString, jwt.MapClaims{})\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    if claims, ok := token.Claims.(jwt.MapClaims); ok {\n\n        chkRoles := claims[\"roles\"].([]interface{})\n\n        for _, role := range chkRoles {\n            if role == \"test-app\" {\n                fmt.Println(\"Check Roles passed\")\n                break\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>A full working example can be seen and tested <a href=\"https://play.golang.org/p/XfRFnUw6rtk\" rel=\"nofollow noreferrer\">on the Go Playground</a></p>\n"}], "owner": {"reputation": 23, "user_id": 11784260, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PwUHvDlay8w/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf_bjr87mJd5ZzwQHJ6NcwZu9yJ_w/photo.jpg?sz=128", "display_name": "Neung K", "link": "https://stackoverflow.com/users/11784260/neung-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 962, "favorite_count": 0, "accepted_answer_id": 57035752, "answer_count": 1, "score": 2, "last_activity_date": 1588507471, "creation_date": 1563157943, "last_edit_date": 1588507471, "question_id": 57032662, "link": "https://stackoverflow.com/questions/57032662/how-to-check-roles-claim-array-of-values-of-a-jwt-for-a-certain-value", "title": "How to check roles claim (array of values) of a JWT for a certain value?", "body": "<p>I am using Golang and the Gin framework to get claims from a JWT sent from a client. But I can't compare the extracted roles with a string.</p>\n\n<p>When I try to get the value, it returns <code>[test-app]</code>\nbut actually I want the value as <code>\"test-app\"</code></p>\n\n<pre><code>token, _, err := new(jwt.Parser).ParseUnverified(tokenString, jwt.MapClaims{})\nif err != nil {\n    fmt.Println(err2)\n    return\n}\n\nif claims, ok := token.Claims.(jwt.MapClaims); ok {\n   chkRoles := claims[\"roles\"]\n\n   if chkRoles == \"test-app\" {\n        fmt.Println(\"Check Roles passed\")\n   }\n} \n</code></pre>\n\n<p>and My Payload</p>\n\n<pre><code>    {\n        \"roles\": [\n            \"test-app\"\n        ],\n        \"exp\": 1811749673,\n        \"client_id\": \"testapp\"\n    }\n</code></pre>\n\n<p>How can I get the value from json claims and use it to compare/validate with a string?</p>\n"}, {"tags": ["go", "goland"], "answers": [{"comments": [{"owner": {"reputation": 29326, "user_id": 11125, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/50d8719c41cb766282b463f4b2e06afd?s=128&d=identicon&r=PG&f=1", "display_name": "gak", "link": "https://stackoverflow.com/users/11125/gak"}, "edited": false, "score": 1, "creation_date": 1563184968, "post_id": 57034069, "comment_id": 100602826, "body": "That only works for symbols you want to look up, not the package of the current file. Also the the directory name does not necessarily need to match the package name."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 29326, "user_id": 11125, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/50d8719c41cb766282b463f4b2e06afd?s=128&d=identicon&r=PG&f=1", "display_name": "gak", "link": "https://stackoverflow.com/users/11125/gak"}, "edited": false, "score": 0, "creation_date": 1563199571, "post_id": 57034069, "comment_id": 100610651, "body": "The symbols <i>are</i> defined in the current file, which is in the current package, so this does work. A better question would be: Why do you need this feature? What&#39;s the use-case for it?"}, {"owner": {"reputation": 29326, "user_id": 11125, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/50d8719c41cb766282b463f4b2e06afd?s=128&d=identicon&r=PG&f=1", "display_name": "gak", "link": "https://stackoverflow.com/users/11125/gak"}, "edited": false, "score": 0, "creation_date": 1563233456, "post_id": 57034069, "comment_id": 100623689, "body": "Are you saying I have to find a symbol that is in the local package, then use quick documentation?"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 29326, "user_id": 11125, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/50d8719c41cb766282b463f4b2e06afd?s=128&d=identicon&r=PG&f=1", "display_name": "gak", "link": "https://stackoverflow.com/users/11125/gak"}, "edited": false, "score": 0, "creation_date": 1563250135, "post_id": 57034069, "comment_id": 100626704, "body": "As I said, if you can explain why you need this, then perhaps I can suggest a different way to do it."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 1, "last_activity_date": 1563171210, "creation_date": 1563171210, "answer_id": 57034069, "question_id": 57032402, "link": "https://stackoverflow.com/questions/57032402/how-do-you-see-the-name-of-the-current-package-in-goland/57034069#57034069", "title": "How do you see the name of the current package in GoLand?", "body": "<p>You can invoke the <code>Quick Documentation</code> feature, via Ctrl + Q on Windows/Linux or F1 on macOS, on any identifier defined in the package and the first line of the output will be the name of the package it's defined in.</p>\n\n<p>This is an example of how this would look like:</p>\n\n<p><a href=\"https://i.stack.imgur.com/GdfPU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GdfPU.png\" alt=\"Quick Documentation\"></a></p>\n\n<p>Another option would be to invoke the <code>Navigation Bar</code>, via Alt + Home on Windows/Linux or Cmd (\u2318) + Up on macOS, and that would show you the path to the directory in which the package is contained, see below:</p>\n\n<p><a href=\"https://i.stack.imgur.com/4iG7Q.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4iG7Q.png\" alt=\"Jump to Navigation Bar\"></a></p>\n"}], "owner": {"reputation": 29326, "user_id": 11125, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/50d8719c41cb766282b463f4b2e06afd?s=128&d=identicon&r=PG&f=1", "display_name": "gak", "link": "https://stackoverflow.com/users/11125/gak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1563171210, "creation_date": 1563154651, "question_id": 57032402, "link": "https://stackoverflow.com/questions/57032402/how-do-you-see-the-name-of-the-current-package-in-goland", "title": "How do you see the name of the current package in GoLand?", "body": "<p>Without having to scroll to the top of the page, is there a way to see the name of the current package in GoLand?</p>\n\n<p>The fastest I can do is (using Vi keys) typing <code>magg</code> (create mark <code>a</code>, go to top) then <code>`a</code> to get back. It's not bad, but ideally I want it to be visible at all times.</p>\n\n<p>There's a top bar that shows some terse contextual information. Maybe there's a way to configure it? I haven't worked out how.</p>\n\n<p>The Structure pane only lists symbols, etc.</p>\n"}, {"tags": ["go", "types", "floating-point", "strconv"], "comments": [{"owner": {"reputation": 324, "user_id": 10071963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea288aa8f18154fa315bc394eb9227d4?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/10071963/andrew"}, "edited": false, "score": 0, "creation_date": 1563203304, "post_id": 57031651, "comment_id": 100612805, "body": "downvoter care to explain?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1563156286, "last_edit_date": 1563156286, "creation_date": 1563144191, "answer_id": 57031690, "question_id": 57031651, "link": "https://stackoverflow.com/questions/57031651/float64-type-printing-as-int-in-golang/57031690#57031690", "title": "Float64 type printing as int in Golang", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Integer_literals\" rel=\"nofollow noreferrer\">Integer literals</a></p>\n  \n  <p>An integer literal is a sequence of digits representing an integer\n  constant.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Floating-point_literals\" rel=\"nofollow noreferrer\">Floating-point literals</a></p>\n  \n  <p>A floating-point literal is a decimal representation of a\n  floating-point constant. It has an integer part, a decimal point, a\n  fractional part, and an exponent part. The integer and fractional part\n  comprise decimal digits; the exponent part is an e or E followed by an\n  optionally signed decimal exponent. One of the integer part or the\n  fractional part may be elided; one of the decimal point or the\n  exponent may be elided.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Arithmetic_operators\" rel=\"nofollow noreferrer\">Arithmetic operators</a></p>\n  \n  <p>For two integer values x and y, the integer quotient q = x / y and\n  remainder r = x % y satisfy the following relationships:</p>\n\n<pre><code>x = q*y + r  and  |r| &lt; |y|\n</code></pre>\n  \n  <p>with x / y truncated towards zero.</p>\n</blockquote>\n\n<hr>\n\n<p>You wrote, using integer literals and arithmetic (x / y truncates towards zero):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    var num float64\n    num = 5 / 3 // float64(int(5)/int(3))\n    fmt.Printf(\"%v\\n\", num)\n    numString := strconv.FormatFloat(num, 'f', -1, 64)\n    fmt.Println(numString)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/PBqSbpHvuSL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PBqSbpHvuSL</a></p>\n\n<p>Output:</p>\n\n<pre><code>1\n1\n</code></pre>\n\n<hr>\n\n<p>You should write, using floating-point literals and arithmetic:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    var num float64\n    num = 5.0 / 3.0 // float64(float64(5.0) / float64 (3.0))\n    fmt.Printf(\"%v\\n\", num)\n    numString := strconv.FormatFloat(num, 'f', -1, 64)\n    fmt.Println(numString)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Hp1nac358HK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Hp1nac358HK</a></p>\n\n<p>Output:</p>\n\n<pre><code>1.6666666666666667\n1.6666666666666667\n</code></pre>\n"}], "owner": {"reputation": 324, "user_id": 10071963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea288aa8f18154fa315bc394eb9227d4?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/10071963/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1976, "favorite_count": 1, "accepted_answer_id": 57031690, "answer_count": 1, "score": 2, "last_activity_date": 1563156286, "creation_date": 1563143838, "question_id": 57031651, "link": "https://stackoverflow.com/questions/57031651/float64-type-printing-as-int-in-golang", "title": "Float64 type printing as int in Golang", "body": "<p>Surprisingly I couldn't find anyone else having this same issue; I tried simply initializing a float64 in Go and printing it, then attempting a string conversion and printing that. Neither output was accurate.</p>\n\n<p>I've attempted this with many fractions, including those which don't resolve to repeating decimals, as well as simply writing out the float and printing (e.g. <code>num := 1.5</code> then <code>fmt.Println(num)</code> gives output <code>1</code>).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    var num float64\n    num = 5/3\n    fmt.Printf(\"%v\\n\", num)\n    numString := strconv.FormatFloat(num, 'f', -1, 64)\n    fmt.Println(numString)\n}\n\n</code></pre>\n\n<p><strong>Expected:</strong></p>\n\n<pre><code>// Output:\n1.66\n1.66\n</code></pre>\n\n<p><strong>Actual:</strong></p>\n\n<pre><code>// Output:\n1\n1\n</code></pre>\n"}, {"tags": ["shell", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1563140116, "post_id": 57030918, "comment_id": 100591510, "body": "The command you\u2019re running is <code>bash</code>, and that is exiting with <code>0</code>. Why not run <code>helm</code> directly?"}, {"owner": {"reputation": 899, "user_id": 2914587, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8264caf9ad892f1a8a3128aeebbdb0ac?s=128&d=identicon&r=PG&f=1", "display_name": "supercalifragilistichespirali", "link": "https://stackoverflow.com/users/2914587/supercalifragilistichespirali"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563141509, "post_id": 57030918, "comment_id": 100591757, "body": "JimB, the reason was so that I didn&#39;t have to split all the arguments in the command, and also I have some commands with pipes that I wouldn&#39;t know how to execute in Go. If I use the quotes in bash to run that <code>bash -c</code> command, the exit status is carried over. How can I achieve that from Go?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1563195664, "post_id": 57030918, "comment_id": 100608335, "body": "Looking at this more closely, you&#39;re not checking the error from the command, so how do you know it&#39;s not returning a non-zero exit status? Is the question actually about setting environment variables? It&#39;s much easier to just directly set them in the execution environment rather than dealing with shell parsing (and again, it&#39;s much easier to control what&#39;s happening if you don&#39;t shell out to <code>bash -c</code> at all)"}, {"owner": {"reputation": 899, "user_id": 2914587, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8264caf9ad892f1a8a3128aeebbdb0ac?s=128&d=identicon&r=PG&f=1", "display_name": "supercalifragilistichespirali", "link": "https://stackoverflow.com/users/2914587/supercalifragilistichespirali"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563261443, "post_id": 57030918, "comment_id": 100630251, "body": "Thanks for the comments. I&#39;ve updated the original question. That was indeed a non-problem. The code return err != nil if the command terminates with exit status != 0. I had two commands running one after the other and got confused on which one was supposed to return err != nil. Sorry"}], "answers": [{"comments": [{"owner": {"reputation": 899, "user_id": 2914587, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8264caf9ad892f1a8a3128aeebbdb0ac?s=128&d=identicon&r=PG&f=1", "display_name": "supercalifragilistichespirali", "link": "https://stackoverflow.com/users/2914587/supercalifragilistichespirali"}, "edited": false, "score": 0, "creation_date": 1563261513, "post_id": 57031782, "comment_id": 100630286, "body": "Updated the question to not being an actual problem, but accepting this answer since you provided code to check exit code. Thanks"}], "tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 2, "last_activity_date": 1563145862, "last_edit_date": 1563145862, "creation_date": 1563145454, "answer_id": 57031782, "question_id": 57030918, "link": "https://stackoverflow.com/questions/57030918/golang-exec-command-returning-nil-error-when-exit-code-is-not-zero/57031782#57031782", "title": "Golang exec.Command returning nil error when exit code is not zero", "body": "<p>Seems like you should be able to get it with <code>exec.ExitError</code>, see <a href=\"https://golang.org/pkg/os/exec/#ExitError\" rel=\"nofollow noreferrer\">exec package</a>. Note that you may need Go 1.12. Here's a runnable example (but it won't give you realistic output at the go playground):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(`/bin/bash`, `-c`, `FOO=bar ls /foo`)\n    cmd.Stdin = os.Stdin\n    cmd.Stderr = os.Stderr\n    stdOut, err := cmd.StdoutPipe()\n    if err != nil {\n        fmt.Println(\"Error 1\")\n    }\n    if err := cmd.Start(); err != nil {\n        fmt.Println(\"Error 2\")\n    }\n    bytes, err := ioutil.ReadAll(stdOut)\n    if err != nil {\n        fmt.Println(\"Error 3\")\n    }\n    if err := cmd.Wait(); err != nil {\n        fmt.Println(\"Error 4\")\n        if exitError, ok := err.(*exec.ExitError); ok {\n            fmt.Printf(\"Exit code is %d\\n\", exitError.ExitCode())\n        }\n    }\n    fmt.Println(string(bytes))\n}\n</code></pre>\n\n<p>On my system that prints:</p>\n\n<pre><code>$ go run main.go\nls: cannot access '/foo': No such file or directory\nError 4\nExit code is 2\n</code></pre>\n\n<p>If that doesn't work for you, maybe it's worth following @JimB's suggestion and invoking helm directly? The Go standard library should support pipes as well:</p>\n\n<blockquote>\n  <p>It wraps os.StartProcess to make it easier to remap stdin and stdout, connect I/O with pipes, and do other adjustments.</p>\n</blockquote>\n\n<p>(<a href=\"https://golang.org/pkg/os/exec\" rel=\"nofollow noreferrer\">exec package</a>)</p>\n"}], "owner": {"reputation": 899, "user_id": 2914587, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8264caf9ad892f1a8a3128aeebbdb0ac?s=128&d=identicon&r=PG&f=1", "display_name": "supercalifragilistichespirali", "link": "https://stackoverflow.com/users/2914587/supercalifragilistichespirali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1619, "favorite_count": 0, "accepted_answer_id": 57031782, "answer_count": 1, "score": 0, "last_activity_date": 1563261340, "creation_date": 1563136099, "last_edit_date": 1563261340, "question_id": 57030918, "link": "https://stackoverflow.com/questions/57030918/golang-exec-command-returning-nil-error-when-exit-code-is-not-zero", "title": "Golang exec.Command returning nil error when exit code is not zero", "body": "<p>I'm trying to run a command in Golang, but it looks like it loses the exit code because the err is nil:</p>\n\n<pre><code>func runCommand() []byte, error {\n  cmd := exec.Command(\"/bin/bash\", \"-c\", \"KUBECONFIG=/tmp/.kube/config helm version\")\n\n  cmd.Stdin = os.Stdin\n  cmd.Stderr = os.Stderr\n\n  stdOut, err := cmd.StdoutPipe()\n  if err != nil {\n      return nil, err\n  }\n\n  if err := cmd.Start(); err != nil {\n      return nil, err\n  }\n\n  bytes, err := ioutil.ReadAll(stdOut)\n  if err != nil {\n      return nil, err\n  }\n  if err := cmd.Wait(); err != nil {\n      return nil, err\n  }\n\n  fmt.Println(string(bytes))\n\n  return bytes, nil\n}\n</code></pre>\n\n<p>This return nil, even though the command returns with exit code != 0.</p>\n\n<p>If I type:</p>\n\n<pre><code>$&gt; /bin/bash -c KUBECONFIG=/tmp/.kube/config helm version\n$&lt;\n$&gt; echo $?\n$&lt; 0\n</code></pre>\n\n<p>If I type:</p>\n\n<pre><code>$&gt; /bin/bash -c 'KUBECONFIG=/tmp/.kube/config helm version'\n$&lt; ...connection refused\n$&gt; echo $?\n$&lt; 1\n</code></pre>\n\n<p>So I tried to wrap the command in single quote:</p>\n\n<pre><code>cmd := exec.Command(\"/bin/bash\", \"-c\", \"'KUBECONFIG=/tmp/.kube/config helm version'\")\n</code></pre>\n\n<p>but then I get:</p>\n\n<pre><code>/bin/bash: KUBECONFIG=/tmp/.kube/config helm version: No such file or directory\n</code></pre>\n\n<p>(needless to say that /tmp/.kube/config is there, but I don't think the no such file or directory refers to that anyway). </p>\n\n<p>What am I doing wrong?</p>\n\n<p>Thanks</p>\n\n<p><strong>UPDATE</strong>: turns out I got it wrong. In fact I had two commands attempted and for some reason I was sure the one failing was the one I mentioned above, when instead the second command was exiting with a status code different from 0. The code works as expected and the err is not nil in case of exit code != 0. Sorry about that.</p>\n"}, {"tags": ["javascript", "go", "quill", "buffalo"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 11783580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45ce1dbfc70a33b6c1b862368befc650?s=128&d=identicon&r=PG&f=1", "display_name": "ace_dev", "link": "https://stackoverflow.com/users/11783580/ace-dev"}, "is_accepted": false, "score": 0, "last_activity_date": 1564119792, "creation_date": 1564119792, "answer_id": 57213791, "question_id": 57030904, "link": "https://stackoverflow.com/questions/57030904/how-to-render-the-quill-js-content-using-go-buffalo-framework/57213791#57213791", "title": "How to render the quill js content using go buffalo framework", "body": "<p>Finally i end with the following,</p>\n\n<pre><code>Helpers: render.Helpers{\n            \"quil_for\": func(content string) template.HTML {\n                content = strings.ReplaceAll(content, \"&lt;script&gt;\", \"&amp;lt;script&amp;gt;\")\n                content = strings.ReplaceAll(content, \"&lt;a&gt;\", \"&amp;lt;a&amp;gt;\")\n                content = strings.ReplaceAll(content, \"&lt;/a&gt;\", \"&amp;lt;/a&amp;gt;\")\n                content = strings.ReplaceAll(content, \"&lt;/script&gt;\", \"&amp;lt;/script&amp;gt;\")\n                return template.HTML(content)\n            },\n        },\n</code></pre>\n\n<p>instead of this</p>\n\n<pre><code>c.Set(\"getContent\", func(content string) template.HTML {\n    return template.HTML(html.EscapeString(content))\n})\n</code></pre>\n\n<p>This escapes only the script and the anchor tag and the res of html as it is.</p>\n"}], "owner": {"reputation": 21, "user_id": 11783580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45ce1dbfc70a33b6c1b862368befc650?s=128&d=identicon&r=PG&f=1", "display_name": "ace_dev", "link": "https://stackoverflow.com/users/11783580/ace-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1564119792, "creation_date": 1563135955, "last_edit_date": 1563138037, "question_id": 57030904, "link": "https://stackoverflow.com/questions/57030904/how-to-render-the-quill-js-content-using-go-buffalo-framework", "title": "How to render the quill js content using go buffalo framework", "body": "<p>The options that i am aware of are,</p>\n\n<ol>\n<li><p>Get the content of the quilljs from <code>getContents</code> api which gives the JSON structure. I can post this to server and store it in server.</p></li>\n<li><p>Get the innerHTML of the <code>div</code> which is passed to Quill editor and store it.</p></li>\n</ol>\n\n<p><strong>Approach 1:</strong> </p>\n\n<p>While displaying it back I need to write the content in my buffalo template in a variable like </p>\n\n<p><code>&lt;script&gt; var contentJSON = \"&lt;%= content %&gt;\"&lt;/script&gt;</code></p>\n\n<p>Then once the page loaded I need to set the contents like <code>quillInstance.setContents(contentJSON)</code></p>\n\n<p><strong>Approach 2:</strong> </p>\n\n<p>Incase the request is compromised then the html may contain scripts unescaped. So if I try like this</p>\n\n<pre><code>c.Set(\"getContent\", func(content string) template.HTML {\n    return template.HTML(html.EscapeString(content))\n})\n</code></pre>\n\n<p>This escapes all the html entities. So all the div, styles introduced by quill js also gone with this. So the whole content looks just like a plain string. </p>\n\n<p>Whats the right approach in storing the content? I am looking for a way to get this rendered in the server.</p>\n"}, {"tags": ["go", "web-scraping"], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1563128595, "post_id": 57029948, "comment_id": 100588968, "body": "see also nightmarejs zombiejs <a href=\"https://godoc.org/github.com/fedesog/webdriver\" rel=\"nofollow noreferrer\">godoc.org/github.com/fedesog/webdriver</a> <a href=\"https://github.com/chromedp/chromedp\" rel=\"nofollow noreferrer\">github.com/chromedp/chromedp</a>"}], "tags": [], "owner": {"reputation": 3851, "user_id": 6266540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0455a60b54cc79b3f8935832f4ca76c?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian", "link": "https://stackoverflow.com/users/6266540/fabian"}, "is_accepted": true, "score": 1, "last_activity_date": 1563127880, "creation_date": 1563127880, "answer_id": 57029948, "question_id": 57029385, "link": "https://stackoverflow.com/questions/57029385/webscraping-after-ajax-loaded-site-content/57029948#57029948", "title": "Webscraping after ajax loaded site content", "body": "<p>It can't since colly would have to do that client-side, but colly <a href=\"https://github.com/gocolly/colly/issues/261\" rel=\"nofollow noreferrer\">does not execute JavaScript</a> - so no Ajax with it.</p>\n\n<p>To simulate a browser you can use selenium or phantomjs as the link above suggests.</p>\n"}], "owner": {"reputation": 2884, "user_id": 1430476, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/cf9e49064895c6b498e936d2a2b80bf3?s=128&d=identicon&r=PG", "display_name": "Tino", "link": "https://stackoverflow.com/users/1430476/tino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 371, "favorite_count": 0, "accepted_answer_id": 57029948, "answer_count": 1, "score": -2, "last_activity_date": 1563127880, "creation_date": 1563123206, "question_id": 57029385, "link": "https://stackoverflow.com/questions/57029385/webscraping-after-ajax-loaded-site-content", "title": "Webscraping after ajax loaded site content", "body": "<p>I'm trying to get colly to scrape the following page: <a href=\"https://www56.muenchen.de/termin/index.php?loc=BB\" rel=\"nofollow noreferrer\">https://www56.muenchen.de/termin/index.php?loc=BB</a>. </p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/gocolly/colly\"\n)\n\nfunc main() {\n    c := colly.NewCollector(\n        colly.IgnoreRobotsTxt(),\n        colly.Async(false),\n    )\n\n    c.OnHTML(\"html\", func(e *colly.HTMLElement) {\n        fmt.Println(e.Text)\n    })\n\n    c.OnError(func(_ *colly.Response, err error) {\n        log.Println(\"Something went wrong:\", err)\n    })\n\n    c.Visit(\"https://www56.muenchen.de/termin/index.php?loc=BB\")\n\n    c.OnScraped(func(r *colly.Response) {\n        fmt.Println(\"Finished\")\n    })\n}\n</code></pre>\n\n<p>The problem is that after the website is visited it loads some content. I'm unsure how to tell colly to \"wait\" until that has happened and then look at the result. </p>\n\n<p>Looking forward to some ideas. </p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1563114152, "post_id": 57028209, "comment_id": 100585597, "body": "You can actually mix them, but it&#39;s generally good practice not to."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1563114242, "post_id": 57028209, "comment_id": 100585617, "body": "Related: <a href=\"https://stackoverflow.com/a/27775558/13860\">stackoverflow.com/a/27775558/13860</a>"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 2, "creation_date": 1563119211, "post_id": 57028209, "comment_id": 100586719, "body": "From: <a href=\"https://tour.golang.org/methods/8\" rel=\"nofollow noreferrer\">tour.golang.org/methods/8</a>  &quot;In general, all methods on a given type should have either value or pointer receivers, but not a mixture of both. (We&#39;ll see why over the next few pages.)&quot;"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1563125250, "post_id": 57028209, "comment_id": 100588193, "body": "The <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> value type does not include the pointer receiver methods.  The method set for the pointer type does include the value receiver methods.  Register the pointer: <code>registration.RegisterAPI(c)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 2, "last_activity_date": 1563126555, "creation_date": 1563126555, "answer_id": 57029786, "question_id": 57028209, "link": "https://stackoverflow.com/questions/57028209/structs-implementing-interface-methods-either-as-pointer-reciever-or-value-recei/57029786#57029786", "title": "structs implementing interface methods either as pointer reciever or value receiver", "body": "<p>You can mix value and pointer receivers in the methods for a type, and the types will be converted if you call a method with a value receiver on a pointer object or if you call a method with a pointer receiver on a non-pointer object (assuming it's addressable). However, if you need a certain type to implement an interface, that type must have all of the methods of the interface defined. In your example, you can have the type <code>Contract</code> implement the interface if all the methods are defined with value receivers, or you can have the type <code>*Contract</code> implement the interface if all the methods are defined with pointer receivers. The important point here is that <code>Contract</code> and <code>*Contract</code> are distinct types, so whichever type you want to implement the interface has to have all of the interface methods defined on it.</p>\n"}], "owner": {"reputation": 77, "user_id": 3602300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec33e1e8e1ed2078449a2cf569682253?s=128&d=identicon&r=PG&f=1", "display_name": "user3602300", "link": "https://stackoverflow.com/users/3602300/user3602300"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563126555, "creation_date": 1563114015, "last_edit_date": 1563114142, "question_id": 57028209, "link": "https://stackoverflow.com/questions/57028209/structs-implementing-interface-methods-either-as-pointer-reciever-or-value-recei", "title": "structs implementing interface methods either as pointer reciever or value receiver", "body": "<p>I have few methods in my interface. I have struct that implements those methods. I noticed that it is not possible to implements set of methods as a pointer receiver and few as value receiver. </p>\n\n<p>below is an interface</p>\n\n<pre><code>type ContractCRUD interface {\n    addContract() bool\n    deleteContract() bool\n    updateContract() bool\n    addAPI(apipath string) bool\n    getContractByNameAndGroup(user string, group APIGroup) error\n    getObject() Contract\n}\n</code></pre>\n\n<p>struct that will implement the ContractCRUD Interface</p>\n\n<pre><code>type Contract struct {\n    id             int64\n    User           string\n    Group          APIGroup\n    AllowedRequest int64\n    Window         int16\n}\n\n</code></pre>\n\n<p>just listing out the functions definition..</p>\n\n<pre><code>func (c Contract) getObject() Contract {...}\nfunc (c Contract) addContract() bool {...}\n.\n.\n.\nfunc (c *Contract) getContractByNameAndGroup(user string, group APIGroup) error {..}\n\n</code></pre>\n\n<p>with such an implementation, even the getObject and addContact, expect the pointer reciever.</p>\n\n<pre><code>func RegisterAPI(c ContractCRUD) bool {\n    contract := c.getObject()\n    fmt.Printf(\"Register the user %s under the group %s with the limit %d per %d minute(s)\\n\", contract.User, contract.Group, contract.AllowedRequest, contract.Window)\n    return c.addContract()\n}\n</code></pre>\n\n<p>somewhere in main</p>\n\n<pre><code>...\nregistration.RegisterAPI(*c)\n</code></pre>\n\n<p>i get the following error</p>\n\n<pre><code>cannot use *c (type registration.Contract) as type registration.ContractCRUD in argument to registration.RegisterAPI:\n    registration.Contract does not implement registration.ContractCRUD (registration.getContractByNameAndGroup method has pointer receiver)\n\n</code></pre>\n\n<p>So I understand I cannot have the mix of the implementation, but I don't seem to understand why. I am  fairly new to Go. I apologies if this is something very obvious. I tried reading around, but I only found everyone talking about the when to use pointer and value implementation.</p>\n"}, {"tags": ["go", "design-patterns", "observer-pattern"], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 5295365, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35fb9a27ee245430e112beac711df66e?s=128&d=identicon&r=PG&f=1", "display_name": "thoward", "link": "https://stackoverflow.com/users/5295365/thoward"}, "edited": false, "score": 0, "creation_date": 1563136301, "post_id": 57027215, "comment_id": 100590717, "body": "For your last point, currently <code>SubjectInterface</code> is defined in <code>observer.go</code> in my <code>observers</code> package, so there is a couple ways I could make <code>Update</code> in <code>ObserverInterface</code> accept the interface.1. define <code>SubjectInterface</code> in my <code>subjects</code> package as well as in my <code>observers</code> package, 2. use <code>observers.SubjectInterface</code> or 3. define it in the <code>subjects</code> package instead and use <code>subjects.SubjectInterface</code> as needed in my <code>observers</code> package. 1. doesn&#39;t seem right because the same thing is defined in two places and 1. and 3. seem to be going against the recommended way of doing things in Go."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 179, "user_id": 5295365, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35fb9a27ee245430e112beac711df66e?s=128&d=identicon&r=PG&f=1", "display_name": "thoward", "link": "https://stackoverflow.com/users/5295365/thoward"}, "edited": false, "score": 2, "creation_date": 1563136664, "post_id": 57027215, "comment_id": 100590811, "body": "@thoward: You should define your interfaces in a package independent from your observers and subjects."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1563105768, "creation_date": 1563105768, "answer_id": 57027215, "question_id": 57027133, "link": "https://stackoverflow.com/questions/57027133/the-go-way-to-implement-the-observer-design-pattern/57027215#57027215", "title": "The Go way to implement the Observer design pattern", "body": "<p>First, don't use pointers to interfaces.</p>\n\n<pre><code>func (o *ObserverOne) Update(subject *SubjectInterface, updateType string) {}\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>func (o *ObserverOne) Update(subject SubjectInterface, updateType string) {}\n</code></pre>\n\n<p>Second, you've defined your interface to require a concrete type:</p>\n\n<pre><code>type ObserverInterface interface {\n    Update(subject *Subject, updateType string)\n}\n</code></pre>\n\n<p>Instead, make it accept an interface:</p>\n\n<pre><code>type ObserverInterface interface {\n    Update(subject SubjectInterface, updateType string)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 2, "creation_date": 1563109267, "post_id": 57027438, "comment_id": 100584514, "body": "Where possible, using <code>interface{}</code> should be avoided."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563111443, "post_id": 57027438, "comment_id": 100585026, "body": "&quot;Flimzy solution still ties things together with explicit interfaces&quot; I don&#39;t understand why you think this is a problem."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1563112263, "post_id": 57027438, "comment_id": 100585187, "body": "I strongly disagree to <code>Where possible, using interface{} should be avoided.</code> You must misunderstand something."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563112382, "post_id": 57027438, "comment_id": 100585216, "body": "@Flimzy, with your design i can build <code>[]ObserverInterface</code> only if i consume <code>SubjectInterface</code>. Which does seem very restrictive for an observer pattern."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1563112985, "post_id": 57027438, "comment_id": 100585346, "body": "I think you&#39;re the one confused. <a href=\"https://www.youtube.com/watch?v=PAAkCSZUG1c&amp;t=7m36s\" rel=\"nofollow noreferrer\">interface{} says nothing</a>. Use it only when absolutely necessary."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563113024, "post_id": 57027438, "comment_id": 100585357, "body": "Consuming <code>SubjectInterface</code> is the right approach here. I don&#39;t see how that&#39;s restrictive. You have to know what interface to use in the first place. Certainly accepting <code>interface{}</code> instead is absolutely the wrong approach."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1563113466, "post_id": 57027438, "comment_id": 100585463, "body": "It does not really says nothing, it impersonate types. it says something as long as you know what to look for. I have not said your design was <b>broken</b>,i only think its not universal enough, in regard to the pattern.<code>You have to know what interface to use in the first place.</code> you have to know what you consume to use it, but, that you want to build a church of type definition is a totally different matter. Using interface{} here simplifies a tons a things, for today and for future, while allowing strictly static source code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563115036, "post_id": 57027438, "comment_id": 100585785, "body": "&quot;it says something as long as you know what to look for&quot; -- ??? So in other words, it doesn&#39;t say anything. You have to already know how to use it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563115100, "post_id": 57027438, "comment_id": 100585801, "body": "I also didn&#39;t say yours was broken. :) Just completely non-idiomatic, and difficult to use."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1563115158, "post_id": 57027438, "comment_id": 100585812, "body": "&quot;Using interface{} here simplifies a tons a things&quot; -- No, here using <code>interface{}</code> complicates things a ton, for today, and for future. You know <i>nothing</i> about what to pass into that function by reading the function signature. You must look at the implementation. Completely non-ideal.  And you get zero compile-time type safety, which is the main reason to use a statically typed language in the first place."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1563118101, "post_id": 57027438, "comment_id": 100586477, "body": "but OP said <code>so that I can avoid having dependencies between my subject package and my observer package</code>. Were you suggesting to put the subject observer into the observer package ? I can t get how you consider it more difficult to use. its less in any properties you might try to evaluate. less constrained, less verbose, less hierarchic. <code>You know nothing about what to pass into that function by reading the function signature.</code> I don&#39;t consider this as a requirement. I can t remember a function signature that completely reflected its side effects solely via its parameters definition."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563118767, "post_id": 57027438, "comment_id": 100586613, "body": "The interfaces can be defined anywhere. Normally, you&#39;d create one package where the interfaces are designed, and different packages where each of the subjects and observers are defined. Subjects and observers would all depend on the same package which defines the interface, but they would have no knowledge of each other."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563118829, "post_id": 57027438, "comment_id": 100586626, "body": "&quot;I don&#39;t consider this as a requirement&quot; -- You may not consider it as a requirement, but it&#39;s precisely what&#39;s meant by &quot;interface{} says nothing&quot;, and it&#39;s what any professional developer will strive for."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1563118899, "post_id": 57027438, "comment_id": 100586641, "body": "&quot;I can t remember a function signature that completely reflected its side effects solely via its parameters definition.&quot; First, functions should strive not to have side effects. Second, you&#39;re not trying very hard then. Here are some examples: <code>Open(path string) (*os.File, error)</code>.  <code>Read(p []byte) (count int, err error)</code>, <code>Copy(dst Writer, src Reader) (written int64, err error)</code>."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": -2, "last_activity_date": 1563107363, "creation_date": 1563107363, "answer_id": 57027438, "question_id": 57027133, "link": "https://stackoverflow.com/questions/57027133/the-go-way-to-implement-the-observer-design-pattern/57027438#57027438", "title": "The Go way to implement the Observer design pattern", "body": "<p>Flimzy solution still ties things together with explicit interfaces into the Observers vertical abstraction (ie: ObserverInterface).</p>\n\n<p>a more generic version may look like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    obs := Observer{SubjectObserver{}}\n\n    s := Subject{Observer: obs}\n    s.Update()\n\n}\n\ntype Subject struct {\n    Observer\n    UUID string\n}\n\nfunc (s *Subject) Update() {\n    s.Observer.Notify(s)\n}\n\ntype SubjectObserver struct{}\n\nfunc (s SubjectObserver) Notify(v interface{}) {\n    x, ok := v.(*Subject)\n    if ok {\n        fmt.Printf(\"do whatever with %#v\\n\", x)\n    }\n}\n\ntype Observer []ObserverOf\n\nfunc (o Observer) Notify(s interface{}) {\n    for _, ob := range o {\n        ob.Notify(s)\n    }\n}\n\ntype ObserverOf interface {\n    Notify(interface{})\n}\n</code></pre>\n\n<p>That the PO embeds the observer is a detail.</p>\n"}], "owner": {"reputation": 179, "user_id": 5295365, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/35fb9a27ee245430e112beac711df66e?s=128&d=identicon&r=PG&f=1", "display_name": "thoward", "link": "https://stackoverflow.com/users/5295365/thoward"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 0, "accepted_answer_id": 57027215, "answer_count": 2, "score": 1, "last_activity_date": 1563107363, "creation_date": 1563104857, "question_id": 57027133, "link": "https://stackoverflow.com/questions/57027133/the-go-way-to-implement-the-observer-design-pattern", "title": "The Go way to implement the Observer design pattern", "body": "<p>My experience is with OOP languages but I've started trying out Go. I'm having trouble working out the best way to implement the <a href=\"https://en.wikipedia.org/wiki/Observer_pattern\" rel=\"nofollow noreferrer\">Observer design pattern</a> in Go.</p>\n\n<p>I've organised my project as follows where everything in the <code>observers</code> folder is part of <code>package observers</code> and everything in the <code>subjects</code> folder is part of <code>package subjects</code>. The attaching of observers to subjects is done in <code>main.go</code>.</p>\n\n<pre><code>my-project/\n  main.go\n  observers/\n    observer.go\n    observer_one.go\n    observer_two.go\n  subjects/\n    subject.go\n    subject_one.go\n</code></pre>\n\n<p>I've seen <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#interfaces\" rel=\"nofollow noreferrer\">this section in the Go wiki</a> about interfaces:</p>\n\n<blockquote>\n  <p>Go interfaces generally belong in the package that uses values of the interface type, not the package that implements those values. The implementing package should return concrete (usually pointer or struct) types: that way, new methods can be added to implementations without requiring extensive refactoring.</p>\n</blockquote>\n\n<p>Keeping the comment from the Go Wiki in mind. I've implemented like this (left out function implementations):</p>\n\n<p>subject.go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type ObserverInterface interface {\n    Update(subject *Subject, updateType string)\n}\n\ntype Subject struct {\n    observers map[string][]ObserverInterface\n}\n\nfunc (s *Subject) Attach(observer ObserverInterface, updateType string) {}\n\nfunc (s *Subject) Detach(observer ObserverInterface, updateType string) {}\n\nfunc (s *Subject) notify(updateType string) {}\n</code></pre>\n\n<p>observer.go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type SubjectInterface interface {\n   Attach(observer Observer, updateType string)\n   Detach(observer Observer, updateType string)\n   notify(updateType string)\n}\n\ntype Observer struct {\n    uuid uuid.UUID\n}\n</code></pre>\n\n<p>observer_one.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type ObserverOne struct {\n    Observer\n}\n\nfunc (o *ObserverOne) Update(subject *SubjectInterface, updateType string) {}\n</code></pre>\n\n<p>main.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>subjectOne := &amp;SubjectOne{}\nobserverOne := &amp;ObserverOne{Observer{uuid: uuid.New()}}\nsubjectOne.Attach(observerOne, \"update_type\")\n</code></pre>\n\n<p>I expect to be able to use <code>SubjectInterface</code> for the argument to the <code>Update()</code> method in <code>ObserverOne</code> so that I can avoid having dependencies between my <code>subject</code> package and my <code>observer</code> package but I get the following compile-time error.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>observers/observer_one.go:29:35: cannot use &amp;observer (type *ObserverOne) as type subjects.ObserverInterface in argument to SubjectOne.Subject.Attach:\n    *ObserverOne does not implement subjects.ObserverInterface (wrong type for Update method)\n        have Update(*SubjectInterface, string)\n        want Update(*subjects.Subject, string)\n</code></pre>\n\n<p>If I replace the definition of <code>Update()</code> in observer_one.go with the following it compiles fine but i thought the idea was to decouple the packages using interfaces:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (o *ObserverOne) Update(subject *subjects.Subject, updateType string) {}\n</code></pre>\n"}, {"tags": ["macos", "go", "terminal"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563100657, "post_id": 57026265, "comment_id": 100582691, "body": "So your original question had two problems (tilde expansion, and calling a built-in). Calling bash directly solves both."}], "answers": [{"comments": [{"owner": {"reputation": 811, "user_id": 492298, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5aa13fb801400c8eaee3fc3ad1fc77b1?s=128&d=identicon&r=PG", "display_name": "nevada_scout", "link": "https://stackoverflow.com/users/492298/nevada-scout"}, "edited": false, "score": 0, "creation_date": 1563099752, "post_id": 57026310, "comment_id": 100582493, "body": "Thanks! This was almost right, the part after the &quot;-c&quot; needed to be one argument instead of multiple ones: <code>exec.Command(&quot;bash&quot;, &quot;-c&quot;, &quot;open -a Terminal &#47;Users&#47;ns&#47;go&#47;&quot;).Run()</code>"}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": true, "score": 1, "last_activity_date": 1563098122, "creation_date": 1563098122, "answer_id": 57026310, "question_id": 57026265, "link": "https://stackoverflow.com/questions/57026265/exit-status-1-when-trying-to-launch-terminal-from-go-app/57026310#57026310", "title": "&quot;exit status 1&quot; when trying to launch Terminal from Go app", "body": "<p>From the <a href=\"https://godoc.org/github.com/golang/go/src/os/exec\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>Unlike the \"system\" library call from C and other languages, the os/exec package intentionally does not invoke the system shell and does not expand any glob patterns or handle other expansions, pipelines, or redirections typically done by shells. The package behaves more like C's \"exec\" family of functions. To expand glob patterns, either call the shell directly, taking care to escape any dangerous input, or use the path/filepath package's Glob function. To expand environment variables, use package os's ExpandEnv.</p>\n</blockquote>\n\n<p>So you need to run <code>bash -c</code> command and pass above command as argument. Something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>exec.Command(\"bash\", \"-c\", \"open\", \"-a\", \"Terminal\", \"~/go/\").Run()\n</code></pre>\n\n<p>For windows you should use <code>cmd /C</code>. Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>exec.Command(\"cmd\", \"/C\", ...)\n</code></pre>\n"}], "owner": {"reputation": 811, "user_id": 492298, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5aa13fb801400c8eaee3fc3ad1fc77b1?s=128&d=identicon&r=PG", "display_name": "nevada_scout", "link": "https://stackoverflow.com/users/492298/nevada-scout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "closed_date": 1563098329, "accepted_answer_id": 57026310, "answer_count": 1, "score": -4, "last_activity_date": 1563100667, "creation_date": 1563097778, "last_edit_date": 1563099403, "question_id": 57026265, "link": "https://stackoverflow.com/questions/57026265/exit-status-1-when-trying-to-launch-terminal-from-go-app", "closed_reason": "Duplicate", "title": "&quot;exit status 1&quot; when trying to launch Terminal from Go app", "body": "<p>I have quite a simple Go app called <code>myApp</code> that is supposed to launch a new Terminal window on macOS:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n)\n\nfunc main() {\n    err := exec.Command(\"open\", \"-a\", \"Terminal\", \"/Users/ns/go/\").Run()\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>However, when I run the app I get the following output:</p>\n\n<pre><code>ns:~/go/src/github.com/nevadascout/myApp $ go install &amp;&amp; myApp\nexit status 1\n</code></pre>\n\n<p>If I run the command (<code>open -a Terminal /Users/ns/go/</code>) in the terminal manually, it works.<br>\nWhat am I missing?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1563095099, "creation_date": 1563095099, "answer_id": 57025957, "question_id": 57025911, "link": "https://stackoverflow.com/questions/57025911/how-is-handlerfunc-returned-by-function-that-should-return-handler/57025957#57025957", "title": "How is HandlerFunc returned by function that should return Handler?", "body": "<p><a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\"><code>http.Handler</code></a> is an interface. <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow noreferrer\"><code>http.HandlerFunc</code></a> is a concrete type that implements that interface. This is all documented in the <a href=\"https://golang.org/pkg/net/http\" rel=\"nofollow noreferrer\"><code>http</code> package documentation</a>. If interfaces are new to you, start with <a href=\"https://tour.golang.org/methods/9\" rel=\"nofollow noreferrer\">A Tour of Go</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 2, "last_activity_date": 1563095182, "creation_date": 1563095182, "answer_id": 57025971, "question_id": 57025911, "link": "https://stackoverflow.com/questions/57025911/how-is-handlerfunc-returned-by-function-that-should-return-handler/57025971#57025971", "title": "How is HandlerFunc returned by function that should return Handler?", "body": "<blockquote>\n  <p>The HandlerFunc type is an adapter to allow the use of  ordinary\n  functions as HTTP handlers. If f is a function  with the appropriate\n  signature, HandlerFunc(f) is a  Handler that calls f.</p>\n</blockquote>\n\n<p>The <code>http.Handler</code> is an interface:</p>\n\n<pre><code>type Handler interface {\n    ServeHTTP(ResponseWriter, *Request)\n}\n</code></pre>\n\n<p>The <code>http.HandlerFunc</code> is a type:</p>\n\n<pre><code>type HandlerFunc func(ResponseWriter, *Request)\n\n// ServeHTTP calls f(w, r).\nfunc (f HandlerFunc) ServeHTTP(w ResponseWriter, r *Request) {\n    f(w, r)\n}\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 7463874, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh5.googleusercontent.com/-Mp8PHDzK3RQ/AAAAAAAAAAI/AAAAAAAAABs/ygAhoZ80AAE/photo.jpg?sz=128", "display_name": "Aayush Taneja", "link": "https://stackoverflow.com/users/7463874/aayush-taneja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 57025971, "answer_count": 2, "score": -1, "last_activity_date": 1563095182, "creation_date": 1563094630, "question_id": 57025911, "link": "https://stackoverflow.com/questions/57025911/how-is-handlerfunc-returned-by-function-that-should-return-handler", "title": "How is HandlerFunc returned by function that should return Handler?", "body": "<p>While chaining handlers, the function has a return type of Handler, but it actually returns a HandlerFunc. This does not throw any error.</p>\n\n<p>How is HandlerFunc accepted in place of a Handler, the prior being a function type and the latter being a interface type?</p>\n\n<pre><code>func log(h http.Handler) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    ...\n  })\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform", "gcloud", "google-app-engine-go"], "comments": [{"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 0, "creation_date": 1563086240, "post_id": 57024587, "comment_id": 100580143, "body": "Are you running this command in an Elevated Command Prompt on Windows? There is a catch-22 here. You don&#39;t need elevation to deploy, but you do need elevation to install components. Start an elevated prompt, install the required components and then deploy with a normal command prompt."}], "answers": [{"tags": [], "owner": {"reputation": 2417, "user_id": 4037220, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JYTuqJ0lf0w/AAAAAAAAAAI/AAAAAAAAAEw/irO6eSzV15Q/photo.jpg?sz=128", "display_name": "Andrei Cusnir", "link": "https://stackoverflow.com/users/4037220/andrei-cusnir"}, "is_accepted": false, "score": 3, "last_activity_date": 1568712139, "creation_date": 1568712139, "answer_id": 57971199, "question_id": 57024587, "link": "https://stackoverflow.com/questions/57024587/why-the-gcloud-components-update-command-always-show-restarting-command/57971199#57971199", "title": "Why the gcloud components update command always show restarting command", "body": "<p>I was trying to deploy a quickstart for .NET Google App Engine application and I run into the same issue. My issue was that I needed to execute <code>$ gcloud components install beta</code> to be able to deploy my GAE .NET app. And I was getting the same behavior as yours. PowerShell would print </p>\n\n<pre><code>Restarting command:\n  $ gcloud components install beta\n</code></pre>\n\n<p>but nothing actually happened. No window popup nor installation progress in the same window where I run the command. Also non of the other commands for installing or updating components were working. I could only list them with <code>$ gcloud components list</code>, but not install nor update any of them.</p>\n\n<p><strong>SOLUTION</strong></p>\n\n<p>I have noticed that if you run PowerShell with administrative privileges, it will open a window in <code>C:\\Windows\\system32</code> directory. If you execute the command there, then another window will pop up and will proceed with installation or update of gcloud components. However if you <code>cd</code> into different directory the behavior will be as mentioned in this issue.</p>\n\n<p>So to resolve this:</p>\n\n<ol>\n<li>Run PowerShell as Administrative </li>\n<li>If the directory is different than what I described above execute <code>$ C:\\Windows\\system32</code> otherwise go to <strong>Step 3</strong></li>\n<li>Execute any command you want for gcloud components. e.g. <code>$ gcloud components update</code> or <code>gcloud components install beta</code> etc.</li>\n<li>A window should popup and proceed with the installation or update of the components.</li>\n</ol>\n"}], "owner": {"reputation": 11, "user_id": 11781403, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tGrrc0cNy0o/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc37Jp3B630xdE2y82n8UpSeNCCAw/photo.jpg?sz=128", "display_name": "\u8b1dRichard", "link": "https://stackoverflow.com/users/11781403/%e8%ac%9drichard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1568712139, "creation_date": 1563078313, "last_edit_date": 1563094521, "question_id": 57024587, "link": "https://stackoverflow.com/questions/57024587/why-the-gcloud-components-update-command-always-show-restarting-command", "title": "Why the gcloud components update command always show restarting command", "body": "<p>When I want to deploy my Go app to App Engine, I found that I have to install the app-engine-go. And it even said the installation is on a new window, no window popped out.</p>\n\n<p><a href=\"https://github.com/ChihchengHsieh/ProblemsScreenShot/blob/master/image-2.png\" rel=\"nofollow noreferrer\">https://github.com/ChihchengHsieh/ProblemsScreenShot/blob/master/image-2.png</a></p>\n\n<pre><code>C:\\go-work\\src\\orderFunc&gt;gcloud app deploy\nThe component [app-engine-go] is required for staging this\napplication.\n\nRestarting command:\n  $ gcloud components install app-engine-go\n\nInstalling component in a new window.\n\nPlease re-run this command when installation is complete.\n    $ gcloud app deploy\n</code></pre>\n\n<p>When I run the command <code>gcloud components install app-engine-go</code> and <code>gcloud components update</code>, it shows:</p>\n\n<p><a href=\"https://github.com/ChihchengHsieh/ProblemsScreenShot/blob/master/image.png\" rel=\"nofollow noreferrer\">https://github.com/ChihchengHsieh/ProblemsScreenShot/blob/master/image.png</a></p>\n\n<pre><code>C:\\go-work\\src\\orderFunc&gt;gcloud components install app-engine-go\n\nRestarting command:\n  $ gcloud components install app-engine-go\n\n\nC:\\go-work\\src\\orderFunc&gt;gcloud components update\n\nRestarting command:\n  $ gcloud components update\n\n\nC:\\go-work\\src\\orderFunc&gt;gcloud components install app-engine-go\n\nRestarting command:\n  $ gcloud components install app-engine-go\n</code></pre>\n\n<p>I already tried reinstalling the google cloud SDK, but it's the same.</p>\n\n<p>I expect it can show some installation process.</p>\n"}, {"tags": ["go", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 6405, "user_id": 3166160, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9054f030b0058573a8338340e6347da8?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Lambert", "link": "https://stackoverflow.com/users/3166160/jacob-lambert"}, "is_accepted": true, "score": 3, "last_activity_date": 1608940682, "last_edit_date": 1608940682, "creation_date": 1563080309, "answer_id": 57024728, "question_id": 57024470, "link": "https://stackoverflow.com/questions/57024470/folder-structure-and-package-naming-convention-for-a-rest-api-develop-in-gin-fra/57024728#57024728", "title": "Folder structure and package naming convention for a REST API develop in Gin Framework", "body": "<p>I would change your folder structure a little bit. Instead of having a separate package for each controller, I would instead have those be a part of the <code>controllers</code> package (While I am talking about the controllers, the same line of thinking holds true for the models).</p>\n<pre><code>.\n+- bin/\n+- controllers/\n   +- user.go\n+- models/\n   +- user.go\n+- main.go\n</code></pre>\n<p>Doing this, I would also change the code structure a bit to instantiate a controller instance like so:</p>\n<pre><code>import &quot;models&quot;\nimport &quot;controllers&quot;\nimport &quot;github.com/gin-gonic/gin&quot;\n\nuserController := controllers.UserController{\n    Users: models.UserModel{}, //DO your stuff here\n}\n\nrouter := gin.Default()\nrouter.GET(&quot;/user&quot;, userController.GetUser)\n</code></pre>\n<p>You could go as you were wanting, creating a new package for each controller, but it will easily grow into a large number of packages. By keeping all of the controllers in a single package, it makes it easier to work with.</p>\n<p>Note: As your app grows, there may be a need to create sub packages. One case I can think of is placing all admin only controllers in a <code>controllers/admin</code> package.</p>\n"}], "owner": {"reputation": 411, "user_id": 3390955, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/420ad11bdbde7003faf57dd6bc064cd6?s=128&d=identicon&r=PG&f=1", "display_name": "Trevor. W", "link": "https://stackoverflow.com/users/3390955/trevor-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2367, "favorite_count": 1, "accepted_answer_id": 57024728, "answer_count": 1, "score": 2, "last_activity_date": 1608940682, "creation_date": 1563076689, "last_edit_date": 1608939080, "question_id": 57024470, "link": "https://stackoverflow.com/questions/57024470/folder-structure-and-package-naming-convention-for-a-rest-api-develop-in-gin-fra", "title": "Folder structure and package naming convention for a REST API develop in Gin Framework", "body": "<p>I was a NodeJS / PHP developer and I'm a beginner using Go. After doing a little research, I come up with a MVC style folder structure like this for my REST API project.</p>\n<pre><code>.\n+- bin/\n+- controllers/\n   +- userController/\n      +- userController.go\n+- models/\n   +- userModel/\n      +- userModel.go\n+- main.go\n</code></pre>\n<p>Thus, I can have my code look like this:</p>\n<pre><code>import &quot;github.com/gin-gonic/gin&quot;\nimport &quot;controllers/userController&quot;\n\nrouter := gin.Default()\nrouter.GET(&quot;/user&quot;, userController.handleSomeLogicHere)\n</code></pre>\n<p>However, I then realised that it is not recommended to use camel case and snake case for packages according to the GoLang official website.</p>\n<p>I am wondering if it is not a good practice to use MVC in Go (because I know some one suggest module/dependency based folder structure)?</p>\n<p>Or should I change all controllers and models into one word like usercontroller or userctrl (but it seems like a bit wired to me)?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1563125597, "post_id": 57024131, "comment_id": 100588272, "body": "amazing ! Thanks so much :) I just would like to make sure, the slice has to be a slice of pointers on <code>T</code> otherwise it can&#39;t be filled up right?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1563126364, "post_id": 57024131, "comment_id": 100588449, "body": "The code assumes slice of pointers.  See updated answer for working with non-pointers."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1575093025, "last_edit_date": 1575093025, "creation_date": 1563071083, "answer_id": 57024131, "question_id": 57023943, "link": "https://stackoverflow.com/questions/57023943/update-array-elements-if-the-array-in-passed-as-val-and-then-converted-to-inter/57024131#57024131", "title": "Update array elements if the array in passed as &amp;val and then converted to interface{}", "body": "<p>Here's how to do it:</p>\n\n<pre><code>// GetAll decodes the cursor c to slicep where slicep is a \n// pointer to a slice of pointers to values.\nfunc GetAll(ctx context.Context, c *Cursor, slicep interface{}) error {\n    // Get the slice. Call Elem() because arg is pointer to the slice.\n    slicev := reflect.ValueOf(slicep).Elem()\n\n    // Get value type. First call to Elem() gets slice \n    // element type. Second call to Elem() dereferences \n    // the pointer type.\n    valuet := slicev.Type().Elem().Elem()\n\n    // Iterate through the cursor...\n    for c.Next(ctx) {\n        // Create new value.\n        valuep := reflect.New(valuet)\n\n        // Decode to that value.\n        if err := c.Decode(valuep.Interface()); err != nil {\n            return err\n        }\n\n        // Append value pointer to slice.\n        slicev.Set(reflect.Append(slicev, valuep))\n    }\n    return c.Err()\n}\n</code></pre>\n\n<p>Call it like this:</p>\n\n<pre><code>var data []*T\nerr := GetAll(ctx, c, &amp;data)\nif err != nil {\n   // handle error\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ZmpGvFC4QY-\" rel=\"nofollow noreferrer\">Run it on the Go Playground</a>.</p>\n\n<p>Here's a generalization of the code to work with non-pointer slice elements:</p>\n\n<pre><code>func GetAll(ctx context.Context, c *Cursor, slicep interface{}) error {\n    slicev := reflect.ValueOf(slicep).Elem()\n    valuet := slicev.Type().Elem()\n    isPtr := valuet.Kind() == reflect.Ptr\n    if isPtr {\n        valuet = valuet.Elem()\n    }\n    for c.Next(ctx) {\n        valuep := reflect.New(valuet)\n        if err := c.Decode(valuep.Interface()); err != nil {\n            return err\n        }\n        if !isPtr {\n            valuep = valuep.Elem()\n        }\n        slicev.Set(reflect.Append(slicev, valuep))\n    }\n    return c.Err()\n}\n</code></pre>\n"}], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 57024131, "answer_count": 1, "score": 0, "last_activity_date": 1575093025, "creation_date": 1563067886, "last_edit_date": 1563094613, "question_id": 57023943, "link": "https://stackoverflow.com/questions/57023943/update-array-elements-if-the-array-in-passed-as-val-and-then-converted-to-inter", "title": "Update array elements if the array in passed as &amp;val and then converted to interface{}", "body": "<p>I am trying to code some generic methods (CRUD approach) to share it between my services. The following example is a <code>GetAll()</code> method that returns all the documents present in my collection:</p>\n\n<pre><code>func GetAll(out interface{}) error {\n    // mongodb operations\n\n    // iterate through all documents\n    for cursor.Next(ctx) {\n        var item interface{}\n        // decode the document\n        if err := cursor.Decode(&amp;item); err != nil {\n            return err\n        }\n        (*out) = append((*out), item)\n        // arrays.AppendToArray(out, item) // Read below :)\n    }\n\n    return nil // if no error\n\n}\n</code></pre>\n\n<p>I also tried with some reflection, but then:</p>\n\n<pre><code>package arrays\n\nimport \"reflect\"\n\nfunc AppendToArray(slicePtrInterface interface{}, item interface{}) {\n    // enter `reflect`-land\n    slicePtrValue := reflect.ValueOf(slicePtrInterface)\n    // get the type\n    slicePtrType := slicePtrValue.Type()\n    // navigate from `*[]T` to `T`\n    _ = slicePtrType.Elem().Elem() // crashes if input type not `*[]T`\n    // we'll need this to Append() to\n    sliceValue := reflect.Indirect(slicePtrValue)\n    // append requested number of zeroes\n    sliceValue.Set(reflect.Append(sliceValue, reflect.ValueOf(item)))\n}\n</code></pre>\n\n<blockquote>\n  <p>panic: reflect.Set: value of type primitive.D is not assignable to type *mongodb.Test [recovered]\n      panic: reflect.Set: value of type primitive.D is not assignable to type *mongodb.Test</p>\n</blockquote>\n\n<p>What I would like is to get the same approach as <code>cursor.Decode(&amp;item)</code> (you can see above)</p>\n"}, {"tags": ["go", "rabbitmq", "channel"], "answers": [{"comments": [{"owner": {"reputation": 373, "user_id": 4192247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d1b2e6ff177a373d1ec15d8f433c997e?s=128&d=identicon&r=PG&f=1", "display_name": "Renato Medeiros", "link": "https://stackoverflow.com/users/4192247/renato-medeiros"}, "edited": false, "score": 0, "creation_date": 1563188227, "post_id": 57032482, "comment_id": 100604434, "body": "Thanks, I think I missed the go routine creation."}], "tags": [], "owner": {"reputation": 88, "user_id": 968024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dddc33e0c442a45d4f144ade5342add?s=128&d=identicon&r=PG", "display_name": "YSTai", "link": "https://stackoverflow.com/users/968024/ystai"}, "is_accepted": false, "score": 2, "last_activity_date": 1563155610, "creation_date": 1563155610, "answer_id": 57032482, "question_id": 57023638, "link": "https://stackoverflow.com/questions/57023638/how-to-return-a-channel/57032482#57032482", "title": "How to return a channel", "body": "<p>maybe something like this:</p>\n\n<pre><code>msgs, err := ch.Consume(...)\n\n/* handle error */\n\nstringCh := make(chan string)\ndone := make(chan struct{})\ngo func() {\n    defer con.Close()\n    defer ch.Close()\n    defer close(stringCh)\n    for {\n        select {\n        case currMsg := &lt;-msgs:\n            stringCh &lt;- string(currMsg.Body)\n        case &lt;-done:\n            return\n        }\n    }\n}()\nreturn stringCh, done\n</code></pre>\n\n<p>This is only a sketchy example. Basic idea is spawn another goroutine listen to the message chan returned by Consume. Other details like how to graceful shutdown, dequeue interface,... depend on your needs.</p>\n"}, {"comments": [{"owner": {"reputation": 88, "user_id": 968024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dddc33e0c442a45d4f144ade5342add?s=128&d=identicon&r=PG", "display_name": "YSTai", "link": "https://stackoverflow.com/users/968024/ystai"}, "edited": false, "score": 0, "creation_date": 1563224558, "post_id": 57038358, "comment_id": 100621646, "body": "i am not sure I fully understand, but using <code>for true</code> to create go routine will quickly OOM."}], "tags": [], "owner": {"reputation": 373, "user_id": 4192247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d1b2e6ff177a373d1ec15d8f433c997e?s=128&d=identicon&r=PG&f=1", "display_name": "Renato Medeiros", "link": "https://stackoverflow.com/users/4192247/renato-medeiros"}, "is_accepted": false, "score": 0, "last_activity_date": 1563188465, "creation_date": 1563188465, "answer_id": 57038358, "question_id": 57023638, "link": "https://stackoverflow.com/questions/57023638/how-to-return-a-channel/57038358#57038358", "title": "How to return a channel", "body": "<p>After reading @YSTai response, I realised I miss the go routine creation. This is how my code end up.</p>\n\n<p><code>worker.go</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"../domain\"\n    \"../externalservices\"\n    \"log\"\n    \"strings\"\n    \"sync\"\n)\n\n/*\nStartWorker initializes a program that will wait for messages enqueued and process them\n*/\nfunc StartWorker() {\n    var wg sync.WaitGroup\n\n    wg.Add(1)\n\n    go func() {\n        defer wg.Done()\n\n        catalogReceived := make(chan domain.Catalog)\n        defer close(catalogReceived)\n        for true {\n\n            go func() {\n                externalservices.DequeueMessageCatalog(catalogReceived)\n\n                catalog := &lt;-catalogReceived\n                website := domain.Website{\n                    Name: strings.ToUpper(catalog.Name),\n                    Zip:  catalog.Zip}\n                externalservices.InsertWebSite(&amp;website)\n            }()\n        }\n\n    }()\n\n    log.Printf(\" [*] Waiting for messages\")\n    wg.Wait()\n}\n\nfunc main() {\n    StartWorker()\n}\n</code></pre>\n\n<p><code>queue.go</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package externalservices\n\nimport (\n    \"../domain\"\n    \"encoding/json\"\n    \"github.com/streadway/amqp\"\n    \"os\"\n)\n\nconst (\n    catalogQueue = \"catalog-queue\"\n)\n\nfunc EnqueueMessageCatalog(catalog *domain.Catalog) error {\n    marshal, err := json.Marshal(*catalog)\n    if err != nil {\n        return err\n    }\n    jsonVal := string(marshal)\n    err = enqueue(catalogQueue, jsonVal)\n    return err\n}\n\n// DequeueMessageCatalog is nice\nfunc DequeueMessageCatalog(messageChannel chan domain.Catalog) {\n\n    message := make(chan []byte)\n    defer close(message)\n\n    for true {\n        go func() {\n            dequeue(catalogQueue, message)\n        }()\n\n        currCatalog := domain.Catalog{}\n        json.Unmarshal([]byte(&lt;-message), &amp;currCatalog)\n        messageChannel &lt;- currCatalog\n    }\n}\n\nfunc openConnection() (*amqp.Connection, *amqp.Channel, error) {\n    connString := os.Getenv(\"RabbitMQConStr\")\n    conn, err := amqp.Dial(connString)\n    if err != nil {\n        return nil, nil, err\n    }\n\n    ch, err := conn.Channel()\n    if err != nil {\n        conn.Close()\n        return nil, nil, err\n    }\n    return conn, ch, nil\n}\n\nfunc ensureQueueExists(queueName string, ch *amqp.Channel) (amqp.Queue, error) {\n    q, err := ch.QueueDeclare(\n        queueName, // name\n        false,     // durable\n        false,     // delete when unused\n        false,     // exclusive\n        false,     // no-wait\n        nil,       // arguments\n    )\n\n    return q, err\n}\n\nfunc enqueue(queueName string, message string) error {\n    con, ch, err := openConnection()\n    if err != nil {\n        return err\n    }\n\n    defer con.Close()\n    defer ch.Close()\n\n    q, err := ensureQueueExists(queueName, ch)\n    if err != nil {\n        return err\n    }\n\n    err = ch.Publish(\n        \"\",     // exchange\n        q.Name, // routing key\n        false,  // mandatory\n        false,  // immediate\n        amqp.Publishing{\n            ContentType: \"application/json\",\n            Body:        []byte(message),\n        })\n    return err\n}\n\nfunc dequeue(queueName string, message chan []byte) error {\n    con, ch, err := openConnection()\n    if err != nil {\n        return err\n    }\n\n    defer con.Close()\n    defer ch.Close()\n\n    q, err := ensureQueueExists(queueName, ch)\n    if err != nil {\n        return err\n    }\n\n    msgs, err := ch.Consume(\n        q.Name, // queue\n        \"\",     // consumer\n        true,   // auto-ack\n        false,  // exclusive\n        false,  // no-local\n        true,  // no-wait\n        nil,    // args\n    )\n\n    if err != nil {\n        return err\n    }\n\n    for currMsg := range msgs {\n        message &lt;- currMsg.Body\n    }\n\n    return nil\n}\n\n\n</code></pre>\n"}], "owner": {"reputation": 373, "user_id": 4192247, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/d1b2e6ff177a373d1ec15d8f433c997e?s=128&d=identicon&r=PG&f=1", "display_name": "Renato Medeiros", "link": "https://stackoverflow.com/users/4192247/renato-medeiros"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1563188465, "creation_date": 1563062609, "last_edit_date": 1563094688, "question_id": 57023638, "link": "https://stackoverflow.com/questions/57023638/how-to-return-a-channel", "title": "How to return a channel", "body": "<p>I'm creating a worker to consume messages from a RabitMQ queue. To achieve that, I created the following file named <code>queue.go</code> </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    package ExternalServices\n\n    import (\n        \"../domain\"\n        \"encoding/json\"\n        \"github.com/streadway/amqp\"\n        \"os\"\n    )\n\n    const (\n        catalogQueue = \"catalog-queue\"\n    )\n\n    func EnqueueMessageCatalog(catalog *domain.Catalog) error {\n        marshal, err := json.Marshal(*catalog)\n        if err != nil {\n            return err\n        }\n        jsonVal := string(marshal)\n        err = enqueue(catalogQueue, jsonVal)\n        return err\n    }\n\n    func DequeueMessageCatalog() ([]domain.Catalog, error) {\n        msgs, err := dequeue(catalogQueue)\n        if err != nil {\n            return nil, err\n        }\n\n        allCatalogs := make([]domain.Catalog, len(msgs))\n        for _, currMsg := range msgs {\n            var currCatalog domain.Catalog\n            err = json.Unmarshal([]byte(currMsg), &amp;currCatalog)\n            if err != nil {\n                return nil, err\n            }\n        }\n\n        return allCatalogs, nil\n    }\n\n    func openConnection() (*amqp.Connection, *amqp.Channel, error) {\n        conn, err := amqp.Dial(os.Getenv(\"RabbitMQConStr\"))\n        if err != nil {\n            return nil, nil, err\n        }\n\n        ch, err := conn.Channel()\n        if err != nil {\n            conn.Close()\n            return nil, nil, err\n        }\n        return conn, ch, nil\n    }\n\n    func ensureQueueExists(queueName string, ch *amqp.Channel) (amqp.Queue, error) {\n        q, err := ch.QueueDeclare(\n            queueName, // name\n            false,     // durable\n            false,     // delete when unused\n            false,     // exclusive\n            false,     // no-wait\n            nil,       // arguments\n        )\n\n        return q, err\n    }\n\n    func enqueue(queueName string, message string) error {\n        con, ch, err := openConnection()\n        if err != nil {\n            return err\n        }\n\n        defer con.Close()\n        defer ch.Close()\n\n        q, err := ensureQueueExists(queueName, ch)\n        if err != nil {\n            return err\n        }\n\n        err = ch.Publish(\n            \"\",     // exchange\n            q.Name, // routing key\n            false,  // mandatory\n            false,  // immediate\n            amqp.Publishing{\n                ContentType: \"application/json\",\n                Body:        []byte(message),\n            })\n        return err\n    }\n\n    func dequeue(queueName string) ([]string, error) {\n        con, ch, err := openConnection()\n        if err != nil {\n            return nil, err\n        }\n\n        defer con.Close()\n        defer ch.Close()\n\n        q, err := ensureQueueExists(queueName, ch)\n        if err != nil {\n            return nil, err\n        }\n\n        msgs, err := ch.Consume(\n            q.Name, // queue\n            \"\",     // consumer\n            true,   // auto-ack\n            false,  // exclusive\n            false,  // no-local\n            false,  // no-wait\n            nil,    // args\n        )\n\n        if err != nil {\n            return nil, err\n        }\n\n        jsons := make([]string, len(msgs))\n        i := 0\n        for currMsg:= range msgs {\n            jsons[i] = string(currMsg.Body)\n            i += 1\n        }\n\n        return jsons, nil\n    }\n</code></pre>\n\n<p>However, I got a bit confused at the <code>dequeue</code> function. I want my worker to be notified every time a messages arrives at my queue, so I guess the proper way to do so is to create a string chan to my worker, since I don't want to expose the message channel returned by <code>Consume</code> to it.</p>\n\n<p>This is my worker so far.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package worker\n\nimport (\n    \"../external-services\"\n    \"log\"\n)\n\nfunc StartWorker() {\n    go func() {\n        messages, err := ExternalServices.DequeueMessageCatalog();\n        if err != nil {\n            // todo log\n        }\n\n        for d := range messages {\n            log.Printf(\"Received a message: %s\", d)\n        }\n\n    }()\n}\n\n</code></pre>\n\n<ol>\n<li>How can I modify my <code>dequeue</code> function so it returns a string chan? </li>\n<li>After modifying this method to return the string chan, do the lines <code>defer con.Close()</code> and <code>defer ch.Close()</code> need to be deleted from this method?</li>\n</ol>\n\n<p>It's my first project in GoLang so anything you think can increase the quality of the code will be much appreciated :-D</p>\n"}, {"tags": ["go", "kubernetes", "webhooks", "patch"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563049593, "post_id": 57022579, "comment_id": 100575391, "body": "&quot;I can not get to mount the new volume&quot; -- can you be more specific? What happens when you try?"}, {"owner": {"reputation": 19, "user_id": 10698545, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7da22349d72da9fbd9a24a8dc054f1c0?s=128&d=identicon&r=PG&f=1", "display_name": "S Macklin", "link": "https://stackoverflow.com/users/10698545/s-macklin"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563049806, "post_id": 57022579, "comment_id": 100575442, "body": "Hi @Flimzy sorry.  The pod comes up fine and the init container runs. Just the new volume does not get mounted to the original containers."}], "owner": {"reputation": 19, "user_id": 10698545, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7da22349d72da9fbd9a24a8dc054f1c0?s=128&d=identicon&r=PG&f=1", "display_name": "S Macklin", "link": "https://stackoverflow.com/users/10698545/s-macklin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 476, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563049406, "creation_date": 1563049406, "question_id": 57022579, "link": "https://stackoverflow.com/questions/57022579/kubernetes-mutating-webhook-patch-issue", "title": "Kubernetes mutating webhook patch issue", "body": "<p>I am trying to get my head around Kubernetes Admission Controllers and trying to mutate a pod to include an init container and a volume in which all containers will mount.</p>\n\n<p>The volume gets created and the init container mounts this volume but the original containers I can not get to mount the new volume.  I am using Golang to write the webhook and using Json patch to mutate the pod.  If anyone could point me in the right direction that would be great!</p>\n\n<pre><code>\n\nfunc serve(w http.ResponseWriter, r *http.Request) {\n    body, err := ioutil.ReadAll(r.Body)\n\n    if err != nil {\n        glog.Error(err.Error())\n        http.Error(w, err.Error(), http.StatusBadRequest)\n        return\n    }\n\n    if len(body) == 0 {\n        glog.Error(\"the request body is empty\")\n        http.Error(w, \"the request body is empty\", http.StatusBadRequest)\n        return\n    }\n\n    if r.Header.Get(\"Content-Type\") != \"application/json\" {\n        glog.Errorf(\"the content-type is %s, but expect application/json\", r.Header.Get(\"Content-Type\"))\n        http.Error(w, \"invalid content-type, expect `application/json`\", http.StatusUnsupportedMediaType)\n        return\n    }\n\n    request := v1beta1.AdmissionReview{}\n\n    if _, _, err := universalDeserializer.Decode(body, nil, &amp;request); err != nil {\n        glog.Errorf(\"could not deserialize request: %s\", err)\n        w.WriteHeader(http.StatusBadRequest)\n        return\n    }\n\n    if request.Request == nil {\n        glog.Error(\"could not find admission review in the request body\")\n        w.WriteHeader(http.StatusBadRequest)\n        return\n    }\n\n    response := v1beta1.AdmissionReview{Response: &amp;v1beta1.AdmissionResponse{UID: request.Request.UID}}\n    response.Response.Allowed = true\n\n    var pod corev1.Pod\n    if err := json.Unmarshal(request.Request.Object.Raw, &amp;pod); err != nil {\n        glog.Errorf(\"Could not unmarshal raw object to a pod object: %v\", err)\n        w.WriteHeader(http.StatusBadRequest)\n        return\n    }\n\n    required, err := mutationRequired(&amp;pod.ObjectMeta)\n\n    if err != nil {\n        glog.Error(err)\n    }\n\n    if required {\n        pbytes, _ := createPatch(&amp;pod)\n        response.Response.Patch = pbytes\n    }\n\n    reviewBytes, err := json.Marshal(response)\n\n    if err != nil {\n        glog.Error(err)\n        http.Error(w, fmt.Sprintf(\"problem marshaling json: %v\", err), http.StatusInternalServerError)\n    }\n\n    if _, err := w.Write(reviewBytes); err != nil {\n        glog.Errorf(\"error writting response back to kubernetes: %v\", err)\n        http.Error(w, fmt.Sprintf(\"could not write response: %v\", err), http.StatusInternalServerError)\n    }\n}\n\nfunc mutationRequired(m *metav1.ObjectMeta) (bool, error) {\n    for _, n := range config.AllowedNamespaces {\n        if m.Namespace != n {\n            glog.Infof(\"request from pod %s is from namespace %s which is allowed\", m.Name, m.Namespace)\n            a := m.GetAnnotations()\n\n            if len(a) &lt; 1 {\n                glog.Infof(\"pod %s has no annotations so mutation is not required\", m.Name)\n                return false, nil\n            }\n\n            if _, ok := a[enableKey]; ok {\n                glog.Infof(\"annotation: %s found with value %s\", enableKey, a[enableKey])\n                b, err := strconv.ParseBool(a[enableKey])\n\n                if err != nil {\n                    glog.Errorf(\"was unable to parse the annotation value: %s\", err)\n                    return false, err\n                }\n                return b, nil\n            }\n            glog.Infof(\"pod %s has does not have the enable annotation so mutation not required\", m.Name)\n        }\n    }\n    glog.Infof(\"request from %s is coming from namespace %s which is not allowed\", m.Name, m.Namespace)\n    return false, nil\n}\n\nfunc addCredentialVolume() (patch patchOperation) {\n    volume := corev1.Volume{\n        Name: \"vault-creds\",\n        VolumeSource: corev1.VolumeSource{\n            EmptyDir: &amp;corev1.EmptyDirVolumeSource{\n                Medium: \"Memory\",\n            },\n        },\n    }\n\n    value := []corev1.Volume{volume}\n\n    return patchOperation{\n        Op:    \"add\",\n        Path:  \"/spec/volumes\",\n        Value: value,\n    }\n}\n// this is the part not working \nfunc updateVolumeMounts(p *corev1.Pod) (patch patchOperation) {\n    vmount := corev1.VolumeMount{\n        Name:      \"vault-creds\",\n        MountPath: \"/creds\",\n        ReadOnly:  true,\n    }\n    for _, c := range p.Spec.Containers {\n        c.VolumeMounts = append(c.VolumeMounts, vmount)\n    }\n    return patchOperation{\n        Op:    \"replace\",\n        Path:  \"/spec/containers\",\n        Value: p.Spec.Containers,\n    }\n}\n\nfunc addInitContainer(p *corev1.Pod) (patch patchOperation) {\n\n    req := corev1.ResourceList{\n        \"cpu\":    resource.MustParse(\"10m\"),\n        \"memory\": resource.MustParse(\"20Mi\"),\n    }\n\n    lim := corev1.ResourceList{\n        \"cpu\":    resource.MustParse(\"30m\"),\n        \"memory\": resource.MustParse(\"50Mi\"),\n    }\n\n    vault := corev1.Container{\n        Name:            \"vault-init\",\n        Image:           config.Image,\n        ImagePullPolicy: \"Always\",\n\n        Resources: corev1.ResourceRequirements{\n            Requests: req,\n            Limits:   lim,\n        },\n        VolumeMounts: []corev1.VolumeMount{\n            corev1.VolumeMount{\n                Name:      \"vault-creds\",\n                MountPath: \"/creds\",\n            },\n        },\n        Command: []string{\"echo\", \"'Hello' &gt; /creds/cred.txt\"},\n    }\n    p.Spec.InitContainers = append(p.Spec.InitContainers, vault)\n\n    return patchOperation{\n        Op:    \"add\",\n        Path:  \"/spec/initContainers\",\n        Value: p.Spec.InitContainers,\n    }\n}\n\nfunc createPatch(p *corev1.Pod) ([]byte, error) {\n    var patch []patchOperation\n    patch = append(patch, addInitContainer(p))\n    patch = append(patch, addCredentialVolume())\n    patch = append(patch, updateVolumeMounts(p))\n    return json.Marshal(patch)\n}\n</code></pre>\n"}, {"tags": ["go", "testing"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563039270, "post_id": 57021432, "comment_id": 100573128, "body": "Can you update your question to include a complete, executable example, so we can see the failure directly?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563039322, "post_id": 57021432, "comment_id": 100573140, "body": "And can you show the actual output of your failing tests?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1563040231, "post_id": 57021432, "comment_id": 100573385, "body": "Not 100% sure but your code seems to rely, to some extent, on the range-over-the-map to be always in the same order, which is not the case in Go. <a href=\"https://blog.golang.org/go-maps-in-action#TOC_7\" rel=\"nofollow noreferrer\">blog.golang.org/go-maps-in-action#TOC_7</a>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1563041127, "post_id": 57021432, "comment_id": 100573628, "body": "... using a slice instead of a map makes your solution consistent (and correct) <a href=\"https://play.golang.com/p/2fIemxq08i4\" rel=\"nofollow noreferrer\">play.golang.com/p/2fIemxq08i4</a> (I&#39;ve dropped the if statements under <code>index == 0</code> since you seem to have added them based on some wrong assumptions, they were not the issue however)"}, {"owner": {"reputation": 55, "user_id": 10150127, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ductEA1_QpE/AAAAAAAAAAI/AAAAAAAAAEs/v96tObej9s0/photo.jpg?sz=128", "display_name": "Screaming Taco", "link": "https://stackoverflow.com/users/10150127/screaming-taco"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563053377, "post_id": 57021432, "comment_id": 100576091, "body": "Thank you so much @mkopriva! That makes a lot of sense."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1563220383, "post_id": 57022966, "comment_id": 100620159, "body": "As an aside, a <code>map</code> in any language should never be assumed to maintain order. There are often variations that <i>do</i> maintain order, but they are special constructs of the base type itself with that specifically added in."}], "tags": [], "owner": {"reputation": 55, "user_id": 10150127, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ductEA1_QpE/AAAAAAAAAAI/AAAAAAAAAEs/v96tObej9s0/photo.jpg?sz=128", "display_name": "Screaming Taco", "link": "https://stackoverflow.com/users/10150127/screaming-taco"}, "is_accepted": true, "score": 1, "last_activity_date": 1563053350, "creation_date": 1563053350, "answer_id": 57022966, "question_id": 57021432, "link": "https://stackoverflow.com/questions/57021432/my-go-code-returns-a-different-result-even-when-i-dont-change-anything/57022966#57022966", "title": "My go code returns a different result even when I don&#39;t change anything", "body": "<p>Thank you @mkopriva for answering my question! If anyone else comes along later, what I hadn't realized was that iteration order is not guaranteed for go maps, so a separate data structure was needed. mkopriva proved a working version <a href=\"https://play.golang.com/p/2fIemxq08i4\" rel=\"nofollow noreferrer\">here</a>. </p>\n"}], "owner": {"reputation": 55, "user_id": 10150127, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ductEA1_QpE/AAAAAAAAAAI/AAAAAAAAAEs/v96tObej9s0/photo.jpg?sz=128", "display_name": "Screaming Taco", "link": "https://stackoverflow.com/users/10150127/screaming-taco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 57022966, "answer_count": 1, "score": -1, "last_activity_date": 1563053350, "creation_date": 1563039184, "last_edit_date": 1563039299, "question_id": 57021432, "link": "https://stackoverflow.com/questions/57021432/my-go-code-returns-a-different-result-even-when-i-dont-change-anything", "title": "My go code returns a different result even when I don&#39;t change anything", "body": "<p>I'm working through a kata about decoding Roman numerals into base 10 numbers and I'm running into a very strange problem. The problem I'm running into is that the output is not consistent and I have no idea why. I have the following code set up trying to beat the challenge (I know it's not perfect; that's not the problem):</p>\n\n<pre><code>package kata\n\nimport \"strings\"\n\nvar numeralsMap = map[string]int{\n    \"M\": 1000,\n    \"D\": 500,\n    \"C\": 100,\n    \"L\": 50,\n    \"X\": 10,\n    \"V\": 5,\n    \"I\": 1,\n  }\n\nfunc Decode(roman string) int {\n    sum := 0\n    romanCpy := roman\nfor k := range numeralsMap { //works through romanCpy looking for matching numeralMap members\n    for strings.Index(romanCpy, k) != -1 {\n        index := strings.Index(romanCpy, k)\n        if index == 0 { //if it is the first one in the string, simply add it to sum and remove it from romanCpy\n            sum += numeralsMap[k]\n            if len(romanCpy) &gt; 1 { //this is necessary to prevent an infinite loop at the last numeral\n                romanCpy = romanCpy[1:] \n            } else if len(romanCpy) &lt;= 1 {\n                romanCpy = \"\" //removes last one at the end\n            }\n        } else if index &gt; 0 { //if it is present but not the first one, subtract all the ones before it from sum\n            substr := romanCpy[:index]\n            for i := 0; i &lt; len(substr); i++ {\n                sum -= numeralsMap[string(substr[i])]\n            }\n            if len(romanCpy) &gt; 1 {\n                romanCpy = romanCpy[index:] \n            }\n        }\n    }\n}\nreturn sum\n}\n</code></pre>\n\n<p>And then I have some tests like this:</p>\n\n<pre><code>t.Run(\"MDCLXVI\", func(t *testing.T) {\n    got := Decode(\"MDCLXVI\")\n    want := 1666\n    if got != want {\n        t.Errorf(\"got %d; want %d\", got, want)\n    }\n})\n\nt.Run(\"IV\", func(t *testing.T) {\n    got := Decode(\"IV\")\n    want := 4\n    if got != want {\n        t.Errorf(\"got %d; want %d\", got, want)\n    }\n})\n</code></pre>\n\n<p>Then when I run the tests, sometimes they pass, and then sometimes the same test will fail the next time. This is true both on my machine and when I try to run the tests on codewars. I'm not asking for help to solve the kata, I'm just not sure why the output keeps changing. Any help would be greatly appreciated. Thanks in advance!</p>\n\n<p>EDIT: The different outputs do tend to follow a pattern. It seems to loop around every five times.</p>\n"}, {"tags": ["go", "middleware", "go-gin"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1563038757, "post_id": 57021266, "comment_id": 100573031, "body": "You need to call <code>Use</code> <b>before</b> you register your handlers to which the middleware should be applied, which I believe you&#39;re doing in <code>InitRouter</code>. So, you&#39;ve got the order mixed up."}, {"owner": {"reputation": 383, "user_id": 4755187, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-t9NsmKJbyoI/AAAAAAAAAAI/AAAAAAAAAIo/KCFXvhfIiIo/photo.jpg?sz=128", "display_name": "Allen Gooch", "link": "https://stackoverflow.com/users/4755187/allen-gooch"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563040439, "post_id": 57021266, "comment_id": 100573438, "body": "That was indeed it.  Many thanks @mkopriva"}], "owner": {"reputation": 383, "user_id": 4755187, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-t9NsmKJbyoI/AAAAAAAAAAI/AAAAAAAAAIo/KCFXvhfIiIo/photo.jpg?sz=128", "display_name": "Allen Gooch", "link": "https://stackoverflow.com/users/4755187/allen-gooch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 224, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1597431047, "creation_date": 1563037811, "last_edit_date": 1597431047, "question_id": 57021266, "link": "https://stackoverflow.com/questions/57021266/problem-where-gin-middleware-does-not-seem-to-be-invoked-despite-being-used-by-g", "title": "Problem where gin middleware does not seem to be invoked despite being used by gin router", "body": "<p>I have a simple DbSession middleware setting a *db.SQL value to a context key of 'db'.  I add an instance of that middleware to my router, yet when handling requests, the 'db' key does not exist in the context's keys.</p>\n\n<p>I've added logging to the middleware and can verify that it is never being invoked, despite being added to the router with Use().  I also checked the context Keys and didn't see my 'db' key there.</p>\n\n<p>This is my middleware.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// DbSession returns a gin middleware adding the database connection to the request context.\nfunc DbSession(db *sql.DB) gin.HandlerFunc {\n    return func(c *gin.Context) {\n        fmt.Println(\"inside DbSession middleware\")\n        c.Set(\"db\", db)\n        c.Next()\n    }\n}\n</code></pre>\n\n<p>And this is how it gets added in my main() function.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var db *sql.DB\n\nfunc main() {\n    initEnv()\n\n    initDb()\n    defer db.Close()\n\n    r := InitRouter()\n    r.Use(DbSession(db))\n\n    _ = r.Run()\n}\n</code></pre>\n\n<p>In my handler, I try to retrieve it.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GetProfile(c *gin.Context) {\n    // ...\n\n    // Get our db session from the request context.\n    db := c.MustGet(\"db\").(*sql.DB)\n\n    // ...\n}\n</code></pre>\n\n<p>When the endpoint is accessed, I expect the context to have the 'db' key and its associated *sql.DB value.  Instead I get the following panic.</p>\n\n<pre><code>[GIN-debug] Listening and serving HTTP on :8080\n2019/07/13 11:45:05 http: panic serving [::1]:55014: Key \"db\" does not exist\n</code></pre>\n\n<p>This seems like such a trivial example, and I expected it to \"Just Work (tm)\".  I figure it must be something really trivial that I've overlooked.  Any and all insight is greatly appreciated.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1563116243, "post_id": 57021089, "comment_id": 100586039, "body": "This code is prone to <a href=\"https://en.m.wikipedia.org/wiki/SQL_injection\" rel=\"nofollow noreferrer\">SQL injection</a>. You should take extreme precautions."}], "answers": [{"tags": [], "owner": {"reputation": 827, "user_id": 1697563, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3481471c4bbf2279945c7ab2d08d6aa2?s=128&d=identicon&r=PG&f=1", "display_name": "Collierre", "link": "https://stackoverflow.com/users/1697563/collierre"}, "is_accepted": true, "score": 3, "last_activity_date": 1563038614, "creation_date": 1563038614, "answer_id": 57021367, "question_id": 57021089, "link": "https://stackoverflow.com/questions/57021089/the-right-syntax-to-use-near-name/57021367#57021367", "title": "The right syntax to use near &#39;Name= ?&#39;", "body": "<p>It looks to me like the SQL string produced by your code will be</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT Id, Data, Role, Name FROM funcionaries WHERE 1=1 Name= ?\n</code></pre>\n\n<p>Whereas what you want is:</p>\n\n<pre class=\"lang-sql prettyprint-override\"><code>SELECT Id, Data, Role, Name FROM funcionaries WHERE 1=1 AND Name= ?\n</code></pre>\n\n<p>To do this you could modify your code like so:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>q := `SELECT Id, Data, Role, Name\n          FROM funcionaries\n          WHERE True`\nif len(where) != 0 {\n    q = q + \" AND \" + strings.Join(where, \" AND \")\n}\nrows, err := db.Query(q, values...)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11638667"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 57021367, "answer_count": 1, "score": 2, "last_activity_date": 1563039004, "creation_date": 1563036471, "last_edit_date": 1563039004, "question_id": 57021089, "link": "https://stackoverflow.com/questions/57021089/the-right-syntax-to-use-near-name", "title": "The right syntax to use near &#39;Name= ?&#39;", "body": "<p>i'm trying to filter my registers with a \"Name\" parameter.</p>\n\n<p>I make this handler function:</p>\n\n<pre><code>func GetFuncionaries(w http.ResponseWriter, r *http.Request) {\n    var f model.Funcionary\n    var t util.App\n    var d db.DB\n    err := d.Connection()\n    db := d.DB\n    defer db.Close()\n\n    Id, _ := strconv.Atoi(r.FormValue(\"Id\"))\n    Name:= r.FormValue(\"Name\")\n\n    f.Id = int64(Id)\n    f.Name = Name\n\n    funcionaries, err := f.GetFuncionaries(db)\n    if err != nil {\n            log.Printf(\"[handler/GetFuncionaries-  Error: %s\", err.Error())\n            t.ResponseWithError(w, http.StatusInternalServerError, err.Error(), \"\")\n        }\n        return\n    }\n    t.ResponseWithJSON(w, http.StatusOK, funcionaries, 0, 0)\n}\n</code></pre>\n\n<p>And the function model:</p>\n\n<pre><code>func (f *Funcionary) GetFuncionaries(db *sql.DB) ([]Funcionary, error) {\n    var values []interface{}\n    var where []string\n\n    if f.Name != \"\" {\n        where = append(where, \"Name= ?\")\n        values = append(values, f.Name)\n    }\n\n\n    rows, err := db.Query(`SELECT Id, Data, Role, Name\n                    FROM funcionaries\n                    WHERE 1=1 `+strings.Join(where, \" AND \"), values...)\n    if err != nil {\n        return nil, err\n    }\n\n    funcionaries:= []Funcionary{}\n    defer rows.Close()\n    for rows.Next() {\n        var funcionary Funcionary\n        if err = rows.Scan(&amp;funcionario.Id, &amp;funcionario.Name, &amp;Others...); err != nil {\n            return nil, err\n        }\n        funcionaries = append(funcionaries, funcionary)\n    }\n    return funcionaries, nil\n}\n</code></pre>\n\n<p>But when i make a call in postman like:</p>\n\n<p><a href=\"http://localhost:8000/api/funcionaries?Name=a\" rel=\"nofollow noreferrer\">http://localhost:8000/api/funcionaries?Name=a</a></p>\n\n<p>I receive the error:</p>\n\n<blockquote>\n  <p>You have an error in your SQL syntax; check the manual that\n  corresponds to your MySQL server version for the right syntax to use\n  near 'Name= ?' at line 3\",</p>\n</blockquote>\n\n<p>I'm forgetting something?</p>\n"}]