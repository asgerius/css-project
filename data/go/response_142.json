[{"tags": ["linux", "docker", "go", "permissions", "docker-compose"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506543126, "post_id": 46456411, "comment_id": 79868508, "body": "You can&#39;t execute a directory <code>.&#47;</code>. What is it you want that to do?"}, {"owner": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506543302, "post_id": 46456411, "comment_id": 79868607, "body": "build the go directory"}, {"owner": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506543455, "post_id": 46456411, "comment_id": 79868681, "body": "was trying to follow this tutorial <a href=\"https://medium.com/statuscode/golang-docker-for-development-and-production-ce3ad4e69673\" rel=\"nofollow noreferrer\">medium.com/statuscode/&hellip;</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506543551, "post_id": 46456411, "comment_id": 79868732, "body": "Why would you assume <code>.&#47;;</code> builds go? Nothing like that in the linked article, they build go on line 10 <a href=\"https://gist.github.com/McMenemy/485659e9e691c4a37976473a6d275f46#file-dockerfile-L10\" rel=\"nofollow noreferrer\">gist.github.com/McMenemy/&hellip;</a>."}, {"owner": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "edited": false, "score": 0, "creation_date": 1506543754, "post_id": 46456411, "comment_id": 79868835, "body": "oh i meant serve the go binary"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506543943, "post_id": 46456411, "comment_id": 79868918, "body": "instead of <code>.&#47;</code> use the name of the binary that resulted from the <code>RUN go build</code>, just like they use <code>app</code> in the article."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1506545858, "last_edit_date": 1506545858, "creation_date": 1506544372, "answer_id": 46456758, "question_id": 46456411, "link": "https://stackoverflow.com/questions/46456411/getting-permission-denied-for-bin-sh-to-start-go-server-in-production-docker/46456758#46456758", "title": "Getting permission denied for /bin/sh to start Go server in production | docker-compose", "body": "<p>You need to build your go program and then tell Docker, with <code>CMD</code>, to use the resulting binary as the default executable.</p>\n\n<p>Try something like this:</p>\n\n<pre><code>From golang:1.8.3-alpine3.6\n\nRUN apk update &amp;&amp; \\\n    apk add \\\n        bash \\\n        build-base \\\n        curl \\\n        make \\\n        git \\\n        &amp;&amp; rm -rf /var/cache/apk/*\n\nARG app_env\nENV APP_ENV $app_env\n\nCOPY . /go/src/myproject/api\nWORKDIR /go/src/myproject/api\n\nRUN go get ./\nRUN go build\n\nCMD if [ ${APP_ENV} = prod ]; \\\n    then \\\n    api; \\\n    else \\\n    go get github.com/pilu/fresh &amp;&amp; \\\n    fresh; \\\n    fi\n\n\nEXPOSE 8080\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 410, "user_id": 3507595, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/fb72c78c89a75492d8ecd1c8cc46cb13?s=128&d=identicon&r=PG&f=1", "display_name": "Yoker", "link": "https://stackoverflow.com/users/3507595/yoker"}, "is_accepted": false, "score": 1, "last_activity_date": 1564129228, "creation_date": 1564129228, "answer_id": 57215921, "question_id": 46456411, "link": "https://stackoverflow.com/questions/46456411/getting-permission-denied-for-bin-sh-to-start-go-server-in-production-docker/57215921#57215921", "title": "Getting permission denied for /bin/sh to start Go server in production | docker-compose", "body": "<p>If you haven't named the package containing the main function as \"main\", I found with multi-stage builds it was building but it wasn't a binary.</p>\n\n<p>There was no obvious error message.</p>\n\n<p>Make sure your go code builds and runs on your host, before containerising it.</p>\n"}], "owner": {"reputation": 1383, "user_id": 3226932, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e05eac9c05a7aefcaa1ca3a27191fbb6?s=128&d=identicon&r=PG&f=1", "display_name": "user3226932", "link": "https://stackoverflow.com/users/3226932/user3226932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1483, "favorite_count": 0, "accepted_answer_id": 46456758, "answer_count": 2, "score": 1, "last_activity_date": 1564129228, "creation_date": 1506542927, "last_edit_date": 1506543932, "question_id": 46456411, "link": "https://stackoverflow.com/questions/46456411/getting-permission-denied-for-bin-sh-to-start-go-server-in-production-docker", "title": "Getting permission denied for /bin/sh to start Go server in production | docker-compose", "body": "<p>I'm running <code>sudo docker-compose</code> on my production server to start up my Go container. I have sudo access in my production server but am not the root user.</p>\n\n<p>error:</p>\n\n<pre><code>go_1     | /bin/sh: ./: Permission denied\n</code></pre>\n\n<p>docker-compose.yml</p>\n\n<pre><code>go:\n    build:\n      context: ./api\n      args:\n        app_env: ${APP_ENV}\n    volumes:\n      - ./api:/go/src/myproject/api\n    expose:\n      - \"8080\"\n</code></pre>\n\n<p>Go Dockerfile </p>\n\n<pre><code>From golang:1.8.3-alpine3.6\n\nRUN apk update &amp;&amp; \\\n    apk add \\\n        bash \\\n        build-base \\\n        curl \\\n        make \\\n        git \\\n        &amp;&amp; rm -rf /var/cache/apk/*\n\nARG app_env\nENV APP_ENV $app_env\n\nCOPY . /go/src/myproject/api\nWORKDIR /go/src/myproject/api\n\n\nCMD if [ ${APP_ENV} = prod ]; \\\n    then \\\n    ./; \\\n    else \\\n    go get github.com/pilu/fresh &amp;&amp; \\\n    fresh; \\\n    fi\n\n\nEXPOSE 8080\n</code></pre>\n\n<p>Any ideas on how to resolve this?</p>\n"}, {"tags": ["mongodb", "algorithm", "go", "polygon", "geo"], "comments": [{"owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "edited": false, "score": 0, "creation_date": 1506541125, "post_id": 46455730, "comment_id": 79867461, "body": "There are quite a few geo-spatial libraries for golang, but without knowing how you are storing data, or what work you have done so far, this question is too general."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1506546235, "post_id": 46455730, "comment_id": 79870027, "body": "have you tried to make a plain MongoDB query before using Go ?"}, {"owner": {"reputation": 13, "user_id": 2983428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/exIW9.jpg?s=128&g=1", "display_name": "Juan Torello", "link": "https://stackoverflow.com/users/2983428/juan-torello"}, "edited": false, "score": 0, "creation_date": 1506603170, "post_id": 46455730, "comment_id": 79894209, "body": "Yes, that&#39;s exactly what I&#39;m showing, the mongo query returns 2 parents because the boundaries of the neighbor country are overlapping with the state ones"}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 0, "last_activity_date": 1506633432, "creation_date": 1506633432, "answer_id": 46478464, "question_id": 46455730, "link": "https://stackoverflow.com/questions/46455730/polygon-overlapping-percentage/46478464#46478464", "title": "Polygon overlapping percentage", "body": "<p>If you can assume that one polygon is always a region of another (completely contained by it), you could instead of using the entire polygon for the region just calculate the centre point of it, and use either a point or a very small square at that point to test against parents. If you have a bounding box the centre point should be easy to find. </p>\n\n<p>That way you avoid the problems you're seeing with edges which overlap two parents, and it should work for any region as long as you know the region is within its parent and not just overlapping it. </p>\n\n<p>So you may not even need two queries, just reduce state.Geometry to a small square around its centre-point and query with that instead. </p>\n"}], "owner": {"reputation": 13, "user_id": 2983428, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/exIW9.jpg?s=128&g=1", "display_name": "Juan Torello", "link": "https://stackoverflow.com/users/2983428/juan-torello"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 0, "accepted_answer_id": 46478464, "answer_count": 1, "score": 1, "last_activity_date": 1524546361, "creation_date": 1506540170, "last_edit_date": 1524546361, "question_id": 46455730, "link": "https://stackoverflow.com/questions/46455730/polygon-overlapping-percentage", "title": "Polygon overlapping percentage", "body": "<p>I'm working on a geo spatial web app with MongoDB. I have a lot of polygons on a collection with different categories (<code>COUNTRY</code>, <code>STATE</code>, etc.), and I want to know which is the <code>COUNTRY</code> of a certain <code>STATE</code> but in some cases the border of a neighbour <code>COUNTRY</code> is touching the border of the <code>STATE</code> so when I query the intersection I get 2 countries.</p>\n\n<p>I want to calculate the overlapping percentage between the state and both countries to know which one is the parent. I've been looking but I didn't found any library with this kind of operation and I'm not very good doing this kind of algorithms.</p>\n\n<hr>\n\n<p>EDIT: Adding more context</p>\n\n<p>This is the model I'm working with</p>\n\n<pre><code>type GeoEntity struct {\n    ID       bson.ObjectId `json:\"id\" bson:\"_id\"`\n    Type     string        `json:\"type\" bson:\"type\"` // COUNTRY, STATE, etc.\n    Geometry Geometry      `json:\"geometry\" bson:\"geometry\"`\n}\n\n// GeoJSON entity\ntype Geometry struct {\n    Type        string          `json:\"type\" bson:\"type\"`\n    Coordinates [][][][]float64 `json:\"coordinates\" bson:\"coordinates\"`\n}\n</code></pre>\n\n<p>And this is the chunk of code I have right now:</p>\n\n<pre><code>func findParent(state *GeoEntity) GeoEntity{\n    session, err := mgo.Dial(\"localhost\")\n    check(err)\n    defer session.Close()\n\n    entities := session.DB(\"geo\").C(\"entity\")\n\n    query := bson.M{\n        \"geometry\": bson.M{\n            \"$geoIntersects\": bson.M{\n                \"$geometry\": state.Geometry,\n            },\n        },\n        \"type\": \"COUNTRY\",\n    }\n\n    var countries []GeoEntity\n    err = entities.Find(query).All(&amp;countries)\n    check(err)\n\n    var parent GeoEntity\n\n    if len(countries) &gt; 1 {\n        //TODO: parent = findTheTrueParent(countries, state) \n    } else {\n        parent = countries[0]\n    }\n\n    return parent \n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/K8laj.png\" rel=\"nofollow noreferrer\">And here is an image example of the problem I'm having.</a> When I make the query I get both countries, the red and green one, but the true parent is the green one. </p>\n"}, {"tags": ["json", "go", "serialization"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1506536693, "post_id": 46454475, "comment_id": 79865041, "body": "#2, <code>when serializing or deserializing an entire Post object containing an array of PostSections, my custom code was not being used and I would get errors</code>. What errors? And did you implement <code>MarshalJSON</code> and <code>UnmarshalJSON</code> for the Post object itself?"}, {"owner": {"reputation": 73, "user_id": 8673362, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dd6ZoMijM6k/AAAAAAAAAAI/AAAAAAAAAaE/MS4qVUq3H7c/photo.jpg?sz=128", "display_name": "happens", "link": "https://stackoverflow.com/users/8673362/happens"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1506539573, "post_id": 46454475, "comment_id": 79866610, "body": "Sorry but it seems like i remembered that wrong. I just tried it again and the errors only appeared when trying to deserialize from mgo because it can&#39;t find a <code>SetBSON</code> method for the PostSection interface. As for your second question, I talk about that in #3."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 6, "last_activity_date": 1506541046, "creation_date": 1506541046, "answer_id": 46455935, "question_id": 46454475, "link": "https://stackoverflow.com/questions/46454475/custom-json-serialization-and-deserialization-for-interfaces-in-go/46455935#46455935", "title": "Custom JSON serialization and deserialization for interfaces in Go", "body": "<p>To avoid writing <code>UnmarshalJSON</code> for the whole <code>Post</code> you can wrap your <code>PostSection</code> in a concrete type and have it implement the Unmarshaler interface.</p>\n\n<pre><code>type Post struct {\n    ID         int\n    Author     string\n    Title      string\n    Intro      string\n    Slug       string\n    TitleImage string\n    Images     []string\n\n    Sections []*PostSection\n}\n\ntype SectionContent interface {\n    Type()    string\n    Content() interface{}\n}\n\ntype PostSection struct {\n    Content SectionContent\n}\n\nfunc (s *PostSection) UnmarshalJSON(data []byte) error {\n    // ...\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 8673362, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dd6ZoMijM6k/AAAAAAAAAAI/AAAAAAAAAaE/MS4qVUq3H7c/photo.jpg?sz=128", "display_name": "happens", "link": "https://stackoverflow.com/users/8673362/happens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2814, "favorite_count": 0, "accepted_answer_id": 46455935, "answer_count": 1, "score": 2, "last_activity_date": 1506541046, "creation_date": 1506535555, "last_edit_date": 1506539971, "question_id": 46454475, "link": "https://stackoverflow.com/questions/46454475/custom-json-serialization-and-deserialization-for-interfaces-in-go", "title": "Custom JSON serialization and deserialization for interfaces in Go", "body": "<p>I'm currently developing a JSON API for a blog in golang, and I've run into a roadblock trying to handle the serialization and deserialization of blog posts. I want my posts to contain an array of Post Sections that could be a number of things (such as normal paragraphs, images, quotes, etc.). I'm using Mongo for storage (with the amazing <a href=\"https://godoc.org/labix.org/v2/mgo\" rel=\"nofollow noreferrer\">mgo library</a>) and I want to save the posts like this:</p>\n\n<pre><code>{\n  \"title\": \"Blog post\",\n  \"sections\": [\n    {\n      \"type\": \"text\",\n      \"content\": { \"en\": \"English content\", \"de\": \"Deutscher Inhalt\" }\n    },\n    {\n      \"type\": \"image\",\n      \"content\": \"https://dummyimage.com/100x100\"\n    },\n    ...more sections\n  ],\n  ...other fields\n}\n</code></pre>\n\n<p>I've tried several solutions to implement this in go and none have really seemed like the \"right way\" to do it:</p>\n\n<ol>\n<li>Not caring about the content</li>\n</ol>\n\n<p>This seemed like the obvious solution, just using a simple struct:</p>\n\n<pre><code>type PostSection struct{\n  Type    string\n  Content interface{}\n}\n</code></pre>\n\n<p>This way, I can pass through whatever the frontend POSTS and save it. However, manipulating the data or validating it becomes impossible, so it's not a good solution.</p>\n\n<ol start=\"2\">\n<li>Using custom interface serialization</li>\n</ol>\n\n<p>I found <a href=\"http://gregtrowbridge.com/golang-json-serialization-with-interfaces/\" rel=\"nofollow noreferrer\">this article</a> about serializing interfaces in golang. This seemed great at first, because I could have an interface like this:</p>\n\n<pre><code>type PostSection interface{\n  Type()    string\n  Content() interface{}\n}\n</code></pre>\n\n<p>and then implement every type like this:</p>\n\n<pre><code>type PostImage string\n\nfunc (p *PostImage) Type() string {\n  return \"image\"\n}\n\nfunc (p *PostImage) Content() interface{} {\n  return p\n}\n</code></pre>\n\n<p>Optimally, that would've been it, and after implementing <code>MarshalJSON</code> and <code>UnmarshalJSON</code> for all my types, it was working fine when using json.Marshal directly on a PostSection object.</p>\n\n<p>However, when serializing or deserializing an entire Post object containing an array of <code>PostSection</code>s, my custom code was just being ignored and the PostSections would just be treated as the underlying objects (<code>string</code> or <code>map[string]string</code> in the examples) when serializing, or result in empty objects when deserializing.</p>\n\n<ol start=\"3\">\n<li>Writing custom serialization for the entire Post struct</li>\n</ol>\n\n<p>So, the solution I'm currently using but would like to change is custom serialization for the entire Post object. This leads to super ugly code, as I only really need custom code for a single field and so I'm passing through the rest, making the deserialization look similar to this:</p>\n\n<pre><code>p.ID = decoded.ID\np.Author = decoded.Author\np.Title = decoded.Title\np.Intro = decoded.Intro\np.Slug = decoded.Slug\np.TitleImage = decoded.TitleImage\np.Images = decoded.Images\n...more fields...\n</code></pre>\n\n<p>and then, decoding the sections like this:</p>\n\n<pre><code>sections := make([]PostSection, len(decoded.Sections))\nfor i, s := range decoded.Sections {\n    if s[\"type\"] == \"text\" {\n        content := s[\"content\"].(map[string]interface{})\n        langs := make(PostText, len(content))\n        for lang, langContent := range content {\n            langString := langContent.(string)\n            langs[lang] = langString\n        }\n        sections[i] = &amp;langs\n    } else if s[\"type\"] == \"image\" {\n        content := s[\"content\"].(string)\n        contentString := PostImage(content)\n        sections[i] = &amp;contentString\n    }\n}\n\np.Sections = sections\n</code></pre>\n\n<p>This is a whole lot of code I'll have to use every time I wanna include PostSections in another form somewhere else (for example in a Newsletter) and it doesn't feel like idiomatic go code by a long shot. Also, there is no error handling for malformed sections - They just cause a panic like this.</p>\n\n<p>Is there a clean solution to this problem?</p>\n"}, {"tags": ["algorithm", "loops", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1506530283, "post_id": 46453003, "comment_id": 79861758, "body": "It&#39;s not clear what you&#39;re actually trying to do. Can you show a more complete example? This just isn&#39;t valid Go, which is why the compiler and formatter both complain."}, {"owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506541930, "post_id": 46453003, "comment_id": 79867879, "body": "@JimB I&#39;m trying to slice a byte array into multiple byte arrays in order to do some arithmetic operation on each one of them separately"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506542271, "post_id": 46453003, "comment_id": 79868068, "body": "but the short variable declaration <code>variable_[i] := ...</code> doesn&#39;t make sense. What do you expect to happen here?"}, {"owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506543342, "post_id": 46453003, "comment_id": 79868621, "body": "@JimB The first variable will be named variable_0, the second would be variable_10, third would be variable_20. With the variables getting the values of number according to the slice"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506543902, "post_id": 46453003, "comment_id": 79868901, "body": "you can&#39;t create new variable names at runtime. Just put the results in some sort of data structure, like a map with <code>&quot;variable_0&quot;</code> as the key."}], "answers": [{"comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "edited": false, "score": 2, "creation_date": 1506550487, "post_id": 46453696, "comment_id": 79871590, "body": "Have you checked the link? Source slice is split into 2 slices <code>variable[0]</code> and <code>variable[10]</code> each of 10 elements."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 4, "last_activity_date": 1506578454, "last_edit_date": 1506578454, "creation_date": 1506532561, "answer_id": 46453696, "question_id": 46453003, "link": "https://stackoverflow.com/questions/46453003/slicing-an-array-while-assigning-new-variables/46453696#46453696", "title": "slicing an array while assigning new variables", "body": "<p>Go is not an interpreted language, so you cannot create a variable name and asssign some variable to it in runtime. But you may use <code>map</code> and assign new variable as its keys with appropriate values:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    variable := make(map[int][]int)\n\n    number := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20}\n\n    for i := 0; i &lt; len(number); i += 10 {\n        variable[i] = number[i : i+10]\n\n    }\n    fmt.Println(variable)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6VYM0vuBmU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6VYM0vuBmU</a></p>\n\n<p>Output (formatted by me for better redability):</p>\n\n<pre><code>map[\n   0: [1 2 3 4 5 6 7 8 9 10] \n   10:[11 12 13 14 15 16 17 18 19 20]\n]\n</code></pre>\n\n<p><code>variable[0]</code> and <code>variable[10]</code> are slices of 10 integers.</p>\n"}, {"tags": [], "owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "is_accepted": false, "score": 0, "last_activity_date": 1506568210, "creation_date": 1506568210, "answer_id": 46460358, "question_id": 46453003, "link": "https://stackoverflow.com/questions/46453003/slicing-an-array-while-assigning-new-variables/46460358#46460358", "title": "slicing an array while assigning new variables", "body": "<p>I think this accomplishes your goal.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n)\n\nfunc main() {\n    //get some random byte data\n    number := make([]byte, 27)\n    rand.Read(number)\n    fmt.Println(\"all the bytes: \", number)\n\n    //make an output variable\n    var tensOfBytes [][]byte\n\n    //loop through number\n    for i := 10; i &lt; len(number); i += 10 {\n        //get a chunk of values and store it in tensOfBytes\n        tensOfBytes = append(tensOfBytes, number[i - 10 : i])\n    }\n\n    fmt.Println(\"bytes in 10s:\")\n    for _, chunk := range tensOfBytes {\n        fmt.Println(\"\\t\", chunk)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BKQB7JwSHw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BKQB7JwSHw</a></p>\n\n<p>In general, you need to be careful of the indexes in that loop...</p>\n\n<ul>\n<li>if you are sure the number of bytes is a multiple of 10, you're good to go.</li>\n<li><code>i</code> increases by 10 each iteration of the loop, be careful using it as an index for another variable..</li>\n<li>probably other edge cases..</li>\n</ul>\n"}], "owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 46453696, "answer_count": 2, "score": -3, "last_activity_date": 1506578454, "creation_date": 1506530084, "last_edit_date": 1506542021, "question_id": 46453003, "link": "https://stackoverflow.com/questions/46453003/slicing-an-array-while-assigning-new-variables", "title": "slicing an array while assigning new variables", "body": "<p>I would like to create new variables based on a 10 bytes slice each time until <code>len(number)</code> is achieved. However, Go keeps giving me the following error:</p>\n\n<blockquote>\n  <p>non-name variable_[i] on left side of :=</p>\n</blockquote>\n\n<p>This is what I've tried so far</p>\n\n<pre><code>for i := 0; i &lt; len(number); i += 10 {\n        variable_[i] := number[i : i+10]\n    }\n</code></pre>\n\n<p>I also tried the append and it didn't work either.</p>\n\n<p>Any idea how to do this?</p>\n\n<p>number is a variable so it's not a constant (it can change in size)\nSo I wouldn't know in advance how many new variables I want the loop to create.</p>\n"}, {"tags": ["debugging", "go", "profiling"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1506528736, "post_id": 46452531, "comment_id": 79860902, "body": "Off the top of my head... add logging to the goroutines, using contexts <a href=\"https://blog.gopheracademy.com/advent-2016/context-logging/\" rel=\"nofollow noreferrer\">blog.gopheracademy.com/advent-2016/context-logging</a>, build your own logger interface <a href=\"https://stackoverflow.com/questions/18361750/correct-approach-to-global-logging-in-golang\" title=\"correct approach to global logging in golang\">stackoverflow.com/questions/18361750/&hellip;</a>, use a third party logging interface <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">github.com/sirupsen/logrus</a>.  Race conditions can be handled directly with go tooling <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">golang.org/doc/articles/race_detector.html</a>. Same with  poorly performing routines <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1506530315, "post_id": 46452531, "comment_id": 79861781, "body": "Look at <code>pprof</code>. Very handy. Also build your code with the <code>-race</code> option to detect race conditions. You have to arrange for all goroutines to run though, it won&#39;t find races unless the code actually executes."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 2, "creation_date": 1506530526, "post_id": 46452531, "comment_id": 79861876, "body": "Read this: <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a> especially go all the way to the end where the embedded profiler is explained. It can be built into a server app and accessed over HTTP."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 2, "creation_date": 1506530728, "post_id": 46452531, "comment_id": 79861963, "body": "And this: <a href=\"https://software.intel.com/en-us/blogs/2014/05/10/debugging-performance-issues-in-go-programs\" rel=\"nofollow noreferrer\">software.intel.com/en-us/blogs/2014/05/10/&hellip;</a> especially scroll down to the section labelled &quot;Blocking Profiler&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1506534779, "post_id": 46452531, "comment_id": 79864025, "body": "You might also be interested in the <a href=\"https://golang.org/cmd/trace/\" rel=\"nofollow noreferrer\">go execution tracer</a>"}], "owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 727, "favorite_count": 2, "answer_count": 0, "score": 2, "last_activity_date": 1506528431, "creation_date": 1506528431, "question_id": 46452531, "link": "https://stackoverflow.com/questions/46452531/profiling-logging-go-routines-in-golang", "title": "Profiling/Logging Go Routines in GoLang", "body": "<p>Using go's standard tooling, is there any way to -- log? profile? report on? -- the go routines a program invokes?</p>\n\n<p>The specific use cases I'm thinking of are</p>\n\n<ol>\n<li><p>Debugging concurrency issues/race conditions (i.e. which go routines ran when for a specific run of a program)</p></li>\n<li><p>Identifying poorly performing go routines (how often is a particular go routine invoked, how long is go spending in an individual go routine)</p></li>\n</ol>\n\n<p>Is there standard tooling for doing this sort of debugging?  If not, are there de-facto standard third party libraries for this sort of thing?  Or does go's culture encourage developers to build this sort of profiling into their own applications and systems?</p>\n"}, {"tags": ["windows", "go", "virtualization"], "comments": [{"owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "edited": false, "score": 0, "creation_date": 1506562878, "post_id": 46451787, "comment_id": 79874524, "body": "related: <a href=\"https://stackoverflow.com/questions/46459328/read-the-value-of-a-cpu-control-register-from-admin-privilege-app-windows\" title=\"read the value of a cpu control register from admin privilege app windows\">stackoverflow.com/questions/46459328/&hellip;</a> re: reading CR4 (which contains the VMX bit).  Reading a control register requires kernel mode, so it&#39;s problematic."}], "answers": [{"tags": [], "owner": {"reputation": 1750, "user_id": 530714, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/489c3fdabc5df1116d627e0f10474b01?s=128&d=identicon&r=PG", "display_name": "Grigory Rechistov", "link": "https://stackoverflow.com/users/530714/grigory-rechistov"}, "is_accepted": false, "score": 1, "last_activity_date": 1516697797, "creation_date": 1516697797, "answer_id": 48397637, "question_id": 46451787, "link": "https://stackoverflow.com/questions/46451787/programmatically-detect-if-hardware-virtualization-is-enabled-on-windows-7/48397637#48397637", "title": "Programmatically detect if hardware virtualization is enabled on Windows 7", "body": "<p>I am afraid you won't be able to achieve what you want unless you are ready to provide a kernel driver, because checking if BIOS has enabled virtualization requires kernel privileges.</p>\n\n<p><a href=\"https://software.intel.com/en-us/articles/intel-sdm\" rel=\"nofollow noreferrer\">Intel Software Developer Manual</a> describes a model-specific register (MSR) with number 3Ah called IA32_FEATURE_CONTROL. Its bits 1 and 2 control whether VMX instructions are allowed in SMX and non-SMX modes. Also there is bit zero which, when written with 1, locks the whole register's value, thus making impossible to enable/disabled features until the next processor reset. This means that, if BIOS code has disabled VMX and locked it, an OS that boots later will be unable to change that fact, only to see it.</p>\n\n<p>To read this or any other MSR one should use machine instruction RDMSR, and this instruction is only available when CPL is zero, that is, within an OS context. It will throw an exception if attempted to be used from application code.</p>\n\n<p>Unless you find a program interface method that wraps RDMSR around and provides it to applications, you are out of luck. Typically that implies loading and running a dedicated kernel driver. I am aware about one for Linux, but cannot say if there is anything for Windows.</p>\n\n<p>As an extra note, if your code is already running inside a virtual machine, like it is for some Windows installations which enable a Hyper-V environment for regular desktop, then you won't even be able to see an actual host MSR value. It will be up to the VMM to provide you with an emulated value, as well as it will show you whatever CPUID value it wants you to see, not the one from the host.</p>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 903, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1516697797, "creation_date": 1506526134, "question_id": 46451787, "link": "https://stackoverflow.com/questions/46451787/programmatically-detect-if-hardware-virtualization-is-enabled-on-windows-7", "title": "Programmatically detect if hardware virtualization is enabled on Windows 7", "body": "<p><strong>Background</strong></p>\n\n<p>I've been bouncing around this for a while and still haven't come up with an adequate solution, hoping someone out there can point me in the right direction.</p>\n\n<p>Essentially I need to identify whether I can run 64bit VM on a target machine (working in GO but happy to consider binding c code or some assembly (though I feel a bit out of depth there)</p>\n\n<p>In order to run a 64 bit VM the system need Hardware Virtualisation support available and enabled in the bios (im only concerned with intel/amd at this time)</p>\n\n<p><strong>Journey so far</strong></p>\n\n<p>From windows 8 onwards, Windows ships with Hyper-V, and there is a nice function you can call IsProcessorFeaturePresent from the kernel32.dll with an arg of 'PF_VIRT_FIRMWARE_ENABLED' which will tell you if hardware virtualisation is enabled in firmware:</p>\n\n<p><a href=\"https://msdn.microsoft.com/ja-jp/library/windows/desktop/ms724482(v=vs.85).aspx\" rel=\"nofollow noreferrer\">IsProcessorFeaturePresent</a></p>\n\n<p>now I dont really like the way this behaves (it says not available if hyper-v is installed) but i can cope with it by checking if hyper-v is enabled through other means so this pretty much does the job from win8 upwards.</p>\n\n<p>Problem is this function always return false on win 7 for some reason - even on a system on which I know hardware virtualization is enabled.</p>\n\n<p>Coming from another angle I have used this lib to determine what instruction sets are available: <a href=\"https://github.com/intel-go/cpuid\" rel=\"nofollow noreferrer\">intel processor feature lib</a> - this allows me to know what type of virtualization instructions are available on the processor (if any)</p>\n\n<p>But I'm still missing the final piece of knowing if its enabled in the bios on win 7. I figure in principle it should be easy from here - I should be able to call something which utilizes the virtualization extensions and see if it responds as expected. But unfortunately I have no idea how to do this.</p>\n\n<p>Does anyone have any suggestions as to how I might do this?</p>\n\n<p>Note: Im happy to consider 3rd party libs but this would be used in commercial software so licensing would have to allow for that (e.g nothing from Microsoft)</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506526162, "post_id": 46451669, "comment_id": 79859175, "body": "Nothing here will be serialized, because none of the fields are exported. Please make a complete example of what you&#39;re seeing. If you export all the fields, this works as intended."}, {"owner": {"reputation": 47, "user_id": 7931615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c3fecf74e0c0893b26ecafec16ee513?s=128&d=identicon&r=PG&f=1", "display_name": "j0ykls1cCMbTWfD1", "link": "https://stackoverflow.com/users/7931615/j0ykls1ccmbtwfd1"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506526499, "post_id": 46451669, "comment_id": 79859409, "body": "Sorry, the fields are exported. Basically the values of X and Y within bar when set to 0/false respectively are omitted when I marshal Foo. However A and B in Foo are not omitted when they are set to 0/false respectively"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506527251, "post_id": 46451669, "comment_id": 79859922, "body": "@j0ykls1cCMbTWfD1: please show a complete example of what happens, and what you expect to happen. This works as expected: <a href=\"https://play.golang.org/p/850qkyLYKU\" rel=\"nofollow noreferrer\">play.golang.org/p/850qkyLYKU</a>"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1506546562, "post_id": 46451669, "comment_id": 79870141, "body": "create Bar as a pointer to Bar"}], "answers": [{"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 1, "last_activity_date": 1506527672, "last_edit_date": 1506527672, "creation_date": 1506527318, "answer_id": 46452168, "question_id": 46451669, "link": "https://stackoverflow.com/questions/46451669/marshalling-0-false-in-a-nested-struct-to-json-whilst-using-omitempty/46452168#46452168", "title": "Marshalling 0/False in a nested struct to json whilst using omitempty", "body": "<p>Thats because they aren't empty.. You are setting them to 0/false. 0/false doesn't mean that they aren't there, you've given then a space in memory by assigning them a value.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Foo struct {\n    Bar Bar   `json:\"bar,omitempty\"`\n    A   *int  `json:\"a,omitempty\"` //Does not get omitted when a = 0\n    B   *bool `json:\"b,omitempty\"` //Does not get omitted when b = false\n}\n\ntype Bar struct {\n    X *int  `json:\"x,omitempty\"` //Gets omitted when x = 0\n    Y *bool `json:\"y,omitempty\"` //Gets omitted when y = false\n}\n\nfunc main() {\n    var obj Foo\n    a := 0 // a will not be not empty, it's set to 0\n    obj.A = &amp;a\n\n    b, _ := json.MarshalIndent(obj, \"\", \" \")\n    fmt.Println(string(b))\n\n    var obj2 Foo\n    // a and everything else will be empty, nothing is set\n\n    b, _ = json.MarshalIndent(obj2, \"\", \" \")\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>From the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">documentation</a></p>\n\n<p><code>The \"omitempty\" option specifies that the field should be omitted from the encoding if the field has an empty value, defined as false, 0, a nil pointer, a nil interface value, and any empty array, slice, map, or string.</code></p>\n\n<p>The wording could be better, but empty in this case means that nothing has been assigned to that field. It doesn't mean if the field is literally set to 0 or false it will be empty.  False and 0 are values as well and if you assign them then the field becomes 0 or false.</p>\n"}], "owner": {"reputation": 47, "user_id": 7931615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c3fecf74e0c0893b26ecafec16ee513?s=128&d=identicon&r=PG&f=1", "display_name": "j0ykls1cCMbTWfD1", "link": "https://stackoverflow.com/users/7931615/j0ykls1ccmbtwfd1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 667, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506527672, "creation_date": 1506525788, "last_edit_date": 1506526342, "question_id": 46451669, "link": "https://stackoverflow.com/questions/46451669/marshalling-0-false-in-a-nested-struct-to-json-whilst-using-omitempty", "title": "Marshalling 0/False in a nested struct to json whilst using omitempty", "body": "<p>When marshalling a struct to JSON I am able to assign a variable to it's corresponding \"empty value\" and still pass it even when using omitempty, however I am unable to achieve the same result in a nested struct as it get's omitted despite being a pointer. Is this possible?  </p>\n\n<pre><code>type Foo struct {\n    Bar Bar `json:\"bar,omitempty\"`\n    A *int  `json:\"a,omitempty\"`  //Does not get omitted when a = 0\n    B *bool `json:\"b,omitempty\"`  //Does not get omitted when b = false\n}\n\ntype Bar struct {\n    X *int  `json:\"x,omitempty\"`  //Gets omitted when x = 0\n    Y *bool `json:\"y,omitempty\"` //Gets omitted when y = false\n}\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "private-methods"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1506524135, "post_id": 46451058, "comment_id": 79857802, "body": "Please show a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. If the test file is in the same package, then it has access to all the package level identifiers."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 2, "creation_date": 1506524179, "post_id": 46451058, "comment_id": 79857826, "body": "If they are in the same package all functions and global variables should be accessible to each other. How are you running your tests?  <code>go test .&#47;...</code> ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1506524703, "post_id": 46451058, "comment_id": 79858194, "body": "Unexported identifiers are only accessible from the same package, so use the same package declaration inside <code>example_test.go</code> (white-box testing). It also must be in the same folder as <code>example.go</code>. For more details see <a href=\"https://stackoverflow.com/questions/42930944/how-can-i-allow-one-package-access-to-another-packages-unexported-data-only-whe/42931290#42931290\">How can I allow one package access to another package&#39;s unexported data only when testing?</a>"}, {"owner": {"reputation": 443, "user_id": 5158845, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2eff4c21679d34a45c335d91940215c9?s=128&d=identicon&r=PG&f=1", "display_name": "gogofan", "link": "https://stackoverflow.com/users/5158845/gogofan"}, "edited": false, "score": 0, "creation_date": 1506524767, "post_id": 46451058, "comment_id": 79858240, "body": "If both files are in directory <code>foo&#47;bar&#47;</code>, how should I run the go test function?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1506525117, "post_id": 46451058, "comment_id": 79858476, "body": "How are you running now? Simply change directory to <code>foo&#47;bar&#47;</code>, then run <code>go test</code>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1506527442, "post_id": 46451058, "comment_id": 79860044, "body": "&quot;When I run the test, the unexported functions are undefined&quot; No they are not. You are making an other mistake."}, {"owner": {"reputation": 443, "user_id": 5158845, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2eff4c21679d34a45c335d91940215c9?s=128&d=identicon&r=PG&f=1", "display_name": "gogofan", "link": "https://stackoverflow.com/users/5158845/gogofan"}, "edited": false, "score": 0, "creation_date": 1506606020, "post_id": 46451058, "comment_id": 79896349, "body": "I managed to test the unexported functions when changing to the directory. The mistake before was I was doing <code>go test foo&#47;bar&#47;example_test.go</code>"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1506719156, "post_id": 46451058, "comment_id": 79948641, "body": "Ah yes, that&#39;s a confusing mistake; when you specify a file Go will compile just that file, instead of the package. In Go, you almost always to to specify packages (i.e. <code>foo&#47;bar</code>) and almost never files (this applies to most <code>go</code> commands)."}], "answers": [{"comments": [{"owner": {"reputation": 390, "user_id": 2637167, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/298d6f4aa1c8775a09bb6c1c9fb5f2a2?s=128&d=identicon&r=PG", "display_name": "Eaton Emmerich", "link": "https://stackoverflow.com/users/2637167/eaton-emmerich"}, "edited": false, "score": 0, "creation_date": 1578133476, "post_id": 46460188, "comment_id": 105345247, "body": "example_test is a different package. but still valid"}, {"owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "reply_to_user": {"reputation": 390, "user_id": 2637167, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/298d6f4aa1c8775a09bb6c1c9fb5f2a2?s=128&d=identicon&r=PG", "display_name": "Eaton Emmerich", "link": "https://stackoverflow.com/users/2637167/eaton-emmerich"}, "edited": false, "score": 0, "creation_date": 1578424908, "post_id": 46460188, "comment_id": 105431748, "body": "That is incorrect, both files declare they are in the <code>example</code> package. If they were in separate packages (lets say <code>A</code> and <code>B</code>), the test in package B would need to reference the function in package A, which would not be possible, because the function in package A is not exported - as in the original post."}, {"owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "reply_to_user": {"reputation": 390, "user_id": 2637167, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/298d6f4aa1c8775a09bb6c1c9fb5f2a2?s=128&d=identicon&r=PG", "display_name": "Eaton Emmerich", "link": "https://stackoverflow.com/users/2637167/eaton-emmerich"}, "edited": false, "score": 0, "creation_date": 1578425057, "post_id": 46460188, "comment_id": 105431809, "body": "<a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow noreferrer\">&quot;When importing a package, you can refer only to its exported names. Any &quot;unexported&quot; names are not accessible from outside the package.&quot;</a>"}, {"owner": {"reputation": 390, "user_id": 2637167, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/298d6f4aa1c8775a09bb6c1c9fb5f2a2?s=128&d=identicon&r=PG", "display_name": "Eaton Emmerich", "link": "https://stackoverflow.com/users/2637167/eaton-emmerich"}, "edited": false, "score": 0, "creation_date": 1579275706, "post_id": 46460188, "comment_id": 105723434, "body": "Just indicating a common mistake that was not mentioned in answer. saying that example_test and example is not the same package in all ways, means that we can declare a second package in one directory, which is not the case.  Something like: &quot;The _test package is not the same package, and unit tests don&#39;t have to be in them&quot; would be useful information."}], "tags": [], "owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "is_accepted": false, "score": 6, "last_activity_date": 1506567047, "creation_date": 1506567047, "answer_id": 46460188, "question_id": 46451058, "link": "https://stackoverflow.com/questions/46451058/testing-unexported-functions-in-go/46460188#46460188", "title": "Testing Unexported Functions in Go", "body": "<p>If your files are truly in the same package, this should not be an issue. I am able to run the below test with no problem.</p>\n\n<p>directory structure:</p>\n\n<pre><code>~/Source/src/scratch/JeffreyYong-Example$ tree .\n.\n\u251c\u2500\u2500 example.go\n\u2514\u2500\u2500 example_test.go\n</code></pre>\n\n<p>example.go:</p>\n\n<pre><code>package example\n\nimport \"fmt\"\n\nfunc unexportedFunc() {\n    fmt.Println(\"this totally is a real function\")\n}\n</code></pre>\n\n<p>example_test.go</p>\n\n<pre><code>package example\n\nimport \"testing\"\n\nfunc TestUnimportedFunc(t *testing.T) {\n    //some test conditions\n    unexportedFunc()\n}\n</code></pre>\n\n<p>test command:</p>\n\n<blockquote>\n  <p>~/Source/src/scratch/JeffreyYong-Example$ go test -v .</p>\n</blockquote>\n\n<p>output:</p>\n\n<pre><code>=== RUN   TestUnimportedFunc\nthis totally is a real function\n--- PASS: TestUnimportedFunc (0.00s)\nPASS\nok      scratch/JeffreyYong-Example     0.001s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 926, "user_id": 1089354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/652beb0f429024c55dca2d11088360e8?s=128&d=identicon&r=PG", "display_name": "George Thomas", "link": "https://stackoverflow.com/users/1089354/george-thomas"}, "is_accepted": false, "score": 7, "last_activity_date": 1555974514, "last_edit_date": 1555974514, "creation_date": 1537223405, "answer_id": 52376484, "question_id": 46451058, "link": "https://stackoverflow.com/questions/46451058/testing-unexported-functions-in-go/52376484#52376484", "title": "Testing Unexported Functions in Go", "body": "<p>This will also work for private member functions of a private type. </p>\n\n<p>For example. </p>\n\n<p>abc.go is as follows</p>\n\n<pre><code>package main\n\ntype abc struct {\n        A string\n}\n\nfunc (a *abc) privateFunc() {\n\n}\n</code></pre>\n\n<p>abc_test.go is as follows</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc TestAbc(t *testing.T) {\n        a := new(abc)\n        a.privateFunc()\n}\n</code></pre>\n\n<p>Running go test on this should give you a full pass without any errors.</p>\n\n<pre><code>linux-/bin/bash@~/trials/go$ go test -v\n=== RUN   TestAbc\n--- PASS: TestAbc (0.00s)\nPASS\nok      _/home/george/trials/go        0.005s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 390, "user_id": 2637167, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/298d6f4aa1c8775a09bb6c1c9fb5f2a2?s=128&d=identicon&r=PG", "display_name": "Eaton Emmerich", "link": "https://stackoverflow.com/users/2637167/eaton-emmerich"}, "is_accepted": false, "score": 1, "last_activity_date": 1548928681, "creation_date": 1548928681, "answer_id": 54457890, "question_id": 46451058, "link": "https://stackoverflow.com/questions/46451058/testing-unexported-functions-in-go/54457890#54457890", "title": "Testing Unexported Functions in Go", "body": "<p>Running <code>go test /path/to/testfile_test.go</code>\nWill not automatically compile any defenitions made in /path/to/testfile.go</p>\n\n<p>You can run the test with <code>go test /path/to/</code> instead.</p>\n"}], "owner": {"reputation": 443, "user_id": 5158845, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2eff4c21679d34a45c335d91940215c9?s=128&d=identicon&r=PG&f=1", "display_name": "gogofan", "link": "https://stackoverflow.com/users/5158845/gogofan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8410, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1555974514, "creation_date": 1506524030, "question_id": 46451058, "link": "https://stackoverflow.com/questions/46451058/testing-unexported-functions-in-go", "title": "Testing Unexported Functions in Go", "body": "<p>I have a file called <code>example.go</code> and another test file called <code>example_test.go</code> and they are both in the same package. I would like to test some unexported functions in <code>example.go</code></p>\n\n<p>When I run the test, the unexported functions are undefined in <code>example_test.go</code>. I am wondering what is the best convention of testing unexported functions in a test file that are in the same package?</p>\n"}, {"tags": ["winapi", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1506524505, "post_id": 46448993, "comment_id": 79858061, "body": "If you fetch the files &quot;over the Internet&quot; (which includes unpacking them form a ZIP archive downloaded by a browser) you first need to remove it. I mean <a href=\"https://www.howtogeek.com/wp-content/uploads/2011/08/image10.png\" rel=\"nofollow noreferrer\">this</a>. Is it the problem?"}, {"owner": {"reputation": 3, "user_id": 8683166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/890e343fc466e83c689ba37a2e40d278?s=128&d=identicon&r=PG&f=1", "display_name": "\u9673\u5b78\u5100", "link": "https://stackoverflow.com/users/8683166/%e9%99%b3%e5%ad%b8%e5%84%80"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1506526913, "post_id": 46448993, "comment_id": 79859699, "body": "Thx\uff01I solve it. I found that the &quot;my.dll&quot; has some dependency dlls. After I installed lack of dlls, it works well."}], "answers": [{"tags": [], "owner": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "is_accepted": true, "score": 1, "last_activity_date": 1506528748, "creation_date": 1506528748, "answer_id": 46452615, "question_id": 46448993, "link": "https://stackoverflow.com/questions/46448993/syscall-loaddll-fails-on-all-computers-except-one-what-do-i-do/46452615#46452615", "title": "syscall.LoadDLL() fails on all computers except one; what do I do?", "body": "<p>Your .DLL probably depends on some other .DLL not installed on these other systems. <a href=\"http://www.dependencywalker.com/\" rel=\"nofollow noreferrer\">Dependency Walker</a> is a useful tool to debug these types of issues...</p>\n"}], "owner": {"reputation": 3, "user_id": 8683166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/890e343fc466e83c689ba37a2e40d278?s=128&d=identicon&r=PG&f=1", "display_name": "\u9673\u5b78\u5100", "link": "https://stackoverflow.com/users/8683166/%e9%99%b3%e5%ad%b8%e5%84%80"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 46452615, "answer_count": 1, "score": -1, "last_activity_date": 1506528748, "creation_date": 1506518463, "last_edit_date": 1506524597, "question_id": 46448993, "link": "https://stackoverflow.com/questions/46448993/syscall-loaddll-fails-on-all-computers-except-one-what-do-i-do", "title": "syscall.LoadDLL() fails on all computers except one; what do I do?", "body": "<p>When I call <code>syscall.LoadDLL(\"my.dll\")</code> in my notebook, it works well.</p>\n\n<p>But when I copy the execution file (.exe) and <code>my.dll</code> to other computers, it will fail and show the following error: </p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Failed to load my.dll: The specified module could not be found. \n</code></pre>\n\n<p>The my.dll could be found in the same directory. </p>\n\n<p>I don't know what happened. </p>\n"}, {"tags": ["go", "rabbitmq"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506519553, "post_id": 46448741, "comment_id": 79854416, "body": "If increasing the number of goroutines doesn&#39;t make your program faster, you are limited by some resource. Usually either CPU, disk I/O, or network I/O. Concurrency is not parallelism. Adding goroutines doesn&#39;t magically make all programs faster. Your main function looks reasonable to me."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1506546134, "post_id": 46448741, "comment_id": 79869980, "body": "if you want to get something close to parallelism you shouldn&#39;t have more workers than CPU cores, try to set <code>maxWorkers</code> to <a href=\"https://golang.org/pkg/runtime/#NumCPU\" rel=\"nofollow noreferrer\">NumCPU()</a>"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 3104123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5de8185b8b659c9a29901d50aa49d9c?s=128&d=identicon&r=PG&f=1", "display_name": "user3104123", "link": "https://stackoverflow.com/users/3104123/user3104123"}, "edited": false, "score": 0, "creation_date": 1506520563, "post_id": 46449563, "comment_id": 79855233, "body": "I&#39;m testing on a 6 core desktop, but have also tested on an 8 core AWS instance.If I run the program on two machines, the performance increases as expected (this is what I&#39;m doing at the moment). Increasing the number of workers on an instance does nothing wherever I run it, which is why I thought there was an issue somewhere. Additionally, running the program more than once on the same instance does increase performance. Throughput is approx 300 msg/s so well within RMQ&#39;s ability to handle (it&#39;s sitting on a big instance all to itself)."}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 0, "last_activity_date": 1506520424, "last_edit_date": 1506520424, "creation_date": 1506520025, "answer_id": 46449563, "question_id": 46448741, "link": "https://stackoverflow.com/questions/46448741/rabbitmq-multiple-workers-pattern/46449563#46449563", "title": "RabbitMQ multiple workers pattern", "body": "<p>There are a couple of things that jump out:</p>\n\n<p><strong>Done within main function</strong></p>\n\n<pre><code>wg.Add(maxWorkers)\nfor i := 1; i &lt;= maxWorkers; i++ {\n    log.Println(i)\n    defer wg.Done()\n    go processor(in, out)\n}\n</code></pre>\n\n<p>The <code>defer</code> here is executed when <code>main</code> returns so it's not actually indicating when processing is complete.  I don't think this'll have an effect on the performance profile of your program though.</p>\n\n<p>To address this you could pass in <code>wg *sync.WaitGroup</code> to your <code>processor</code> so your processor can indicate when it's done.</p>\n\n<p><strong>CPU Bound Processing</strong></p>\n\n<p>Parsing messages and performing Regex is a cpu intensive workload.  How many cores is your machine?  How is throughput affected if you run your program on two separate machines, does throughput 2x?  What if you double your amount of cores? What about running your program with 1 worker vs 2 processor workers? does that double throughput? Are you maxing out your rabbitmq local instance? is it the bottleneck?? </p>\n\n<p>Setting up benchmarking and load testing harnesses should allow you to setup experiments to see where your bottle necks are :)</p>\n\n<p>For queue based services it's pretty easy to setup a test harness to fill rabbitmq with a set backlog and benchmark how fast you can process those messages, or to setup a load generator to send x messages/second to rabbitmq and observe if you can keep up.</p>\n\n<p>Does rabbitmq have good visibility into message processing throughput? If not I frequently add a counter to go code and then log the overall averaged throughput on an interval to get a rough idea of performance:</p>\n\n<pre><code>start := time.Now()\nupdateInterval := time.Tick(1 * time.Second)\nnumIn := 0\nfor {\n    select {\n    case &lt;-updateInterval:\n        log.Infof(\"IN - Count: %d\", numIn)\n        log.Infof(\"IN - Througput: %.0f events/second\",\n            float64(numIn)/(time.Now().Sub(start)).Seconds())\n    case e := &lt;-msgs:\n        numIn++\n        in &lt;- d.Body\n        d.Ack(false)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 3104123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5de8185b8b659c9a29901d50aa49d9c?s=128&d=identicon&r=PG&f=1", "display_name": "user3104123", "link": "https://stackoverflow.com/users/3104123/user3104123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1405, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1506520424, "creation_date": 1506517673, "question_id": 46448741, "link": "https://stackoverflow.com/questions/46448741/rabbitmq-multiple-workers-pattern", "title": "RabbitMQ multiple workers pattern", "body": "<p>I'm trying to find a good method to consume asynchronously from an input queue, process the content using several workers and then publish to an output queue. So far I've tried a number of examples, most recently using the code from <a href=\"http://nesv.github.io/golang/2014/02/25/worker-queues-in-go.html\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://gist.github.com/harlow/dbcd639cf8d396a2ab73#file-worker_refactored-go\" rel=\"nofollow noreferrer\">here</a> as inspiration. </p>\n\n<p>My current code doesn't appear to be doing what it should be however, increasing the number of workers doesn't increase performance (msg/s consumed or published) and the number of goroutines remains fairly static whilst running.</p>\n\n<p>main:</p>\n\n<pre><code>func main() {\n    maxWorkers := 10\n\n    // channel for jobs\n    in := make(chan []byte)\n    out := make(chan []byte)\n\n    // start workers\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(maxWorkers)\n    for i := 1; i &lt;= maxWorkers; i++ {\n        log.Println(i)\n        defer wg.Done()\n        go processor(in, out)\n    }\n\n    // add jobs\n    go collector(in)\n    go sender(out)\n\n    // wait for workers to complete\n    wg.Wait()\n}\n</code></pre>\n\n<p>The collector is basically the example from the RabbitMQ site with a goroutine that collects messages from the queue and places them on the 'in' channel:</p>\n\n<pre><code>forever := make(chan bool)\ngo func() {\n    for d := range msgs {\n        in &lt;- d.Body\n        d.Ack(false)\n    }\n}()\nlog.Printf(\"[*] Waiting for messages. To exit press CTRL+C\")\n&lt;-forever\n</code></pre>\n\n<p>The processor receives an 'in' and 'out' channel, unmarshals JSON, performs a series of regexes and then places the output into the 'out' channel:</p>\n\n<pre><code>func processor(in chan []byte, out chan []byte) {\n\n    var (\n    // list of regexes declared here\n    )\n\n    for {\n        body := &lt;-in\n\n        jsonIn := &amp;Data{}\n        err := json.Unmarshal(body, jsonIn)\n        if err != nil {\n            log.Fatalln(\"Failed to decode:\", err)\n        }\n\n        content := jsonIn.Content\n\n        //process regexes using:\n        //jsonIn.a = r1.FindAllString(content, -1)\n\n        jsonOut, _ := json.Marshal(jsonIn)\n\n        out &lt;- jsonOut\n    }\n}\n</code></pre>\n\n<p>And finally the sender is simply the code from the RabbitMQ site, setting up a connection, reading from the 'out' channel and then publishing to a RMQ queue:</p>\n\n<pre><code>for {\n    jsonOut := &lt;-out\n\n    err = ch.Publish(\n        \"\",     // exchange\n        q.Name, // routing key\n        false,  // mandatory\n        false,\n        amqp.Publishing{\n            DeliveryMode: amqp.Persistent,\n            ContentType:  \"text/json\",\n            Body:         []byte(jsonOut),\n        })\n    failOnError(err, \"Failed to publish a message\")\n\n}\n</code></pre>\n\n<p>This is a pattern that I'll be using quite a lot, so I'm spending a lot of time trying to find something that works correctly (and well) - any advice or help would be appreciated (and in case it isn't obvious, I'm new to Go).</p>\n"}, {"tags": ["json", "go", "marshalling", "unmarshalling"], "answers": [{"tags": [], "owner": {"reputation": 195, "user_id": 2893513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f874f2807a1c11a1fbc9bed368712205?s=128&d=identicon&r=PG&f=1", "display_name": "Oleg", "link": "https://stackoverflow.com/users/2893513/oleg"}, "is_accepted": false, "score": 0, "last_activity_date": 1506516271, "creation_date": 1506516271, "answer_id": 46448232, "question_id": 46448102, "link": "https://stackoverflow.com/questions/46448102/go-json-unmarshaller-is-not-called/46448232#46448232", "title": "Go json Unmarshaller is not called", "body": "<p><code>Data</code> methods has value receiver, but the variable data has pointer type (<code>*Data</code>).</p>\n\n<p>Pointer type variables cannot use functions with value receiver. Either change variable type or receiver type.</p>\n\n<p>Also see <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#receiver-type\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/CodeReviewComments#receiver-type</a> about receivers.</p>\n"}, {"comments": [{"owner": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "edited": false, "score": 0, "creation_date": 1506516590, "post_id": 46448260, "comment_id": 79852201, "body": "Sorry, the points number 3 and 4 is my fault. I have made the changes inside my editor but didn&#39;t copy it to here."}, {"owner": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "edited": false, "score": 0, "creation_date": 1506516710, "post_id": 46448260, "comment_id": 79852294, "body": "With the pointer it works, thank you. But I found a little bit strange that you have to implement a method on a pointer to make this work. It&#39;s not so obvious to me, maybe it&#39;s just because I&#39;m new to Golang"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1506516328, "creation_date": 1506516328, "answer_id": 46448260, "question_id": 46448102, "link": "https://stackoverflow.com/questions/46448102/go-json-unmarshaller-is-not-called/46448260#46448260", "title": "Go json Unmarshaller is not called", "body": "<p>You have a few distinct problems here.</p>\n\n<ul>\n<li><p>The method receiver must be a pointer if you want to modify the receiver, otherwise you're only modifying the copy local to the method.</p></li>\n<li><p>You always need to unmarshal into a pointer.</p></li>\n<li><p>You're declaring a <code>\"field\"</code> json tag for the <code>Foo</code> field, but passing in <code>\"foo\"</code></p></li>\n<li><p>You're calling <code>json.Unmarshal</code> inside your <code>UnmarshalJSON</code> method, which is going to recurse indefinitely.</p></li>\n</ul>\n\n<p>A working example would look like</p>\n\n<pre><code>func (d *Data) UnmarshalJSON(b []byte) error {\n    type data Data\n    tmp := &amp;data{bar: \"bar\"}\n    err := json.Unmarshal(b, tmp)\n    if err != nil {\n        return err\n    }\n    *d = Data(*tmp)\n    return nil\n}\n\nfunc main() {\n    jsonData := \"{\\\"field\\\":\\\"test\\\"}\"\n    data := Data{}\n    json.Unmarshal([]byte(jsonData), &amp;data)\n    fmt.Printf(\"%#v\\n\", data)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/FnF2li63dt\" rel=\"noreferrer\">https://play.golang.org/p/FnF2li63dt</a></p>\n"}], "owner": {"reputation": 7297, "user_id": 5604676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/CQ3zk.jpg?s=128&g=1", "display_name": "Sergii Bishyr", "link": "https://stackoverflow.com/users/5604676/sergii-bishyr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 878, "favorite_count": 0, "accepted_answer_id": 46448260, "answer_count": 2, "score": 1, "last_activity_date": 1506516497, "creation_date": 1506515883, "last_edit_date": 1506516497, "question_id": 46448102, "link": "https://stackoverflow.com/questions/46448102/go-json-unmarshaller-is-not-called", "title": "Go json Unmarshaller is not called", "body": "<p>I'm fairly new to Golang. And I was looking for a way to do some custom stuff for marshaling and unmarshalling <code>json</code>. I have found the solution to implement <code>Marshaller</code> and <code>Unmarshaller</code> interfaces.</p>\n\n<p>Here is my <code>struct</code> with implemented interfaces (I have also implemented Stringer):</p>\n\n<pre><code>type Data struct {\n    Foo string `json:\"foo\"`\n    bar string\n}\n\nfunc (d Data) MarshalJSON() ([]byte, error) {\n    return []byte(\"{\\\"foo\\\":\\\"test\\\",\\\"bar\\\":\\\"data\\\"}\"), nil\n}\n\nfunc (d Data) String() string {\n    return fmt.Sprintf(\"Foo: %s, bar: %s\", d.Foo, d.bar)\n}\n\nfunc (d Data) UnmarshalJSON(b []byte) error {\n    d.bar = \"testtest\"\n    d.Foo = \"data\"\n    return nil\n}\n</code></pre>\n\n<p>For <code>Marshaller</code> everything works as expected:</p>\n\n<pre><code>data := &amp;Data{}\nmarshal, _ := json.Marshal(data)\nfmt.Println(string(marshal))\n</code></pre>\n\n<p>The output as expected:</p>\n\n<blockquote>\n  <p>{\"foo\":\"test\",\"bar\":\"data\"}</p>\n</blockquote>\n\n<p>But Unmarshaller doesn't work as I was expecting:</p>\n\n<pre><code>jsonData := \"{\\\"foo\\\":\\\"test\\\"}\"\ndata := Data{}\njson.Unmarshal([]byte(jsonData), data)\nfmt.Println(data)\n</code></pre>\n\n<p>This code prints:</p>\n\n<blockquote>\n  <p>Foo: , bar:</p>\n</blockquote>\n\n<p>Is there something that I'm missing here?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1506514818, "post_id": 46447659, "comment_id": 79851031, "body": "ah that was where to look! and now I also realized that the &quot;Hello&quot; comment is on <code>ast.GenDecl</code> and not <code>ast.TypeSpec</code>"}], "tags": [], "owner": {"reputation": 529, "user_id": 1061579, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e80a2c0170d152133bfd5f691b5e2ccf?s=128&d=identicon&r=PG", "display_name": "R3v4n", "link": "https://stackoverflow.com/users/1061579/r3v4n"}, "is_accepted": true, "score": 8, "last_activity_date": 1506514631, "creation_date": 1506514631, "answer_id": 46447659, "question_id": 46447497, "link": "https://stackoverflow.com/questions/46447497/golang-comments-and-docs-fields-when-doing-ast-inspect-why-are-they-blank/46447659#46447659", "title": "golang comments and docs fields when doing ast.Inspect \u2014&#160;why are they blank?", "body": "<p>In order to get comments, you have to pass the parser.ParseComments flag in argument to parser.ParseFile():</p>\n\n<pre><code>parser.ParseFile(fset, \"\", src, parse.ParseComments)\n</code></pre>\n\n<p>All possible mode flags are documented here:</p>\n\n<p><a href=\"https://golang.org/pkg/go/parser/#Mode\" rel=\"noreferrer\">https://golang.org/pkg/go/parser/#Mode</a></p>\n"}], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 0, "accepted_answer_id": 46447659, "answer_count": 1, "score": 2, "last_activity_date": 1506514631, "creation_date": 1506514080, "question_id": 46447497, "link": "https://stackoverflow.com/questions/46447497/golang-comments-and-docs-fields-when-doing-ast-inspect-why-are-they-blank", "title": "golang comments and docs fields when doing ast.Inspect \u2014&#160;why are they blank?", "body": "<p>I'm trying to get at the <code>Doc</code>s and <code>Comment</code>s of <code>struct</code>s and <code>struct field</code>s, but I can't seem to be able to do so, they just turn up empty:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"go/ast\"\n    \"go/parser\"\n    \"go/token\"\n)\n\nfunc main() {\n    src := `package test\n\n    // Hello\n    type A struct {\n        // Where\n        B int // Are you\n    }\n    `\n\n    fset := token.NewFileSet()\n    f, err := parser.ParseFile(fset, \"\", src, 0)\n    if err != nil {\n        panic(err)\n    }\n\n    ast.Inspect(f, func(n ast.Node) bool {\n        switch t := n.(type) {\n        case *ast.TypeSpec:\n            fmt.Println(t.Doc.Text())\n        case *ast.StructType:\n            for _, field := range t.Fields.List {\n                fmt.Println(field.Doc.Text())\n                fmt.Println(field.Comment.Text())\n            }\n        }\n        return true\n    })\n}\n</code></pre>\n\n<p>yields three blank lines: <a href=\"https://play.golang.org/p/4Eh9gS-PUg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4Eh9gS-PUg</a></p>\n\n<p>Saw the similar question <a href=\"https://stackoverflow.com/questions/19580688/go-parser-not-detecting-doc-comments-on-struct-type\">Go parser not detecting Doc comments on struct type</a> but when trying to run the accepted example it turns up all empty \u2014 so I'm wondering if something has changed since that version.</p>\n"}, {"tags": ["go", "reflection", "interface"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506511281, "post_id": 46446429, "comment_id": 79848794, "body": "&quot;Index() method is returning a panic because it needs a struct&quot; is wrong. Index works on slices and arrays. Can you explain more in depth what the problem is? E.g. your <code>t</code> interface looks like JSON and not like a Go interface type?"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506512140, "post_id": 46446429, "comment_id": 79849356, "body": "Actually I was parsing the interface to json. Now I have edited the interface. Index() is panicking because its getting a map. Map is not defined to work with Index. Right ? I just want to get &quot;count&quot; field value from interface."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506512385, "post_id": 46446429, "comment_id": 79849496, "body": "<a href=\"https://golang.org/pkg/reflect/#Value.MapIndex\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#Value.MapIndex</a>"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506513430, "post_id": 46446429, "comment_id": 79850141, "body": "thanks @Volker,  its returning me the count when I am printing it. But its giving me <code>{ flag: 148 }</code> when I am parsing it to JSON. Can you Explain me the reason for it. Is it connected to reflection?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506514223, "post_id": 46446429, "comment_id": 79850661, "body": "I have to admit I do not understand what your &quot;parsing to JSON&quot; actually is. You did not show code and it seems rather strange to me. If you need further help you will have to come up with a proper problem description (parse to JSON is not helpful)."}], "answers": [{"comments": [{"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1506570658, "post_id": 46447381, "comment_id": 79876288, "body": "thanks for replying to my question. I have checked your solution and its working fine to get the count value. But I have edited my post to get this count value in json. Please check and provide the solution if you have any."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1506579110, "post_id": 46447381, "comment_id": 79878942, "body": "Well @R3v4n, neither type assertion nor <code>ratingsCount.Int()</code> is working. When I do type assertion it returns an empty map. Also <code>ratingsCount.Int()</code> is giving panic saying <code>reflect: call of reflect.Value.Int on interface Value</code>."}, {"owner": {"reputation": 529, "user_id": 1061579, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e80a2c0170d152133bfd5f691b5e2ccf?s=128&d=identicon&r=PG", "display_name": "R3v4n", "link": "https://stackoverflow.com/users/1061579/r3v4n"}, "reply_to_user": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1506582378, "post_id": 46447381, "comment_id": 79880584, "body": "@Amandeepkaur: I edited my reply with a link to a working example on the Go playground. Forget about the reflection, it really makes things more complicated for no gain. Let&#39;s focus on my solution that uses type assertion. If the map is empty, it is probably the value of <code>ratingsCountInterface</code> that is not what you expect. Can you paste the entire source code?"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1506584345, "post_id": 46447381, "comment_id": 79881759, "body": "I have tried your both code snippets. but in both case its returning empty map. And I think there is no logic difference between the two. The interface I am passing to get type assertion is a bson.M type interface (for mongodb). Now what should I do ?"}, {"owner": {"reputation": 529, "user_id": 1061579, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e80a2c0170d152133bfd5f691b5e2ccf?s=128&d=identicon&r=PG", "display_name": "R3v4n", "link": "https://stackoverflow.com/users/1061579/r3v4n"}, "reply_to_user": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1506584586, "post_id": 46447381, "comment_id": 79881929, "body": "If you are passing a bson.M it is not an interface, it is a <code>map[string]interface{}</code>: <a href=\"https://godoc.org/labix.org/v2/mgo/bson#M\" rel=\"nofollow noreferrer\">godoc.org/labix.org/v2/mgo/bson#M</a> therefore, there is no need for type assertion. You should be able to directly access the value. Can you paste all the relevant parts of you source code?"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1506588915, "post_id": 46447381, "comment_id": 79884758, "body": "If it is a map and I directly access the index of a map, it gives the following error: <code>invalid operation: RatingInterface[&quot;count&quot;] (type interface {} does not support indexing)</code>. So I can not directly access the bson map."}, {"owner": {"reputation": 529, "user_id": 1061579, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e80a2c0170d152133bfd5f691b5e2ccf?s=128&d=identicon&r=PG", "display_name": "R3v4n", "link": "https://stackoverflow.com/users/1061579/r3v4n"}, "reply_to_user": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1506590131, "post_id": 46447381, "comment_id": 79885598, "body": "At some point in your code, the bson.M is converted into an interface{}. If you can avoid this, that would be the best option. Using interface{} break the type checking at compilation time.  If you can&#39;t, instead of using type assertion on type <code>map[string]interface{}</code> you have to do type assertion with the type <code>bson.M</code>, like this: ratingsCount, ok := v.(bson.M)"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1506593275, "post_id": 46447381, "comment_id": 79887774, "body": "I got it. You are right, its type assertion should be to bson.M type. Your answer to use type assertion instead of reflect solved my issue. I used type assertion bson.M to get direct value from map. Thanks @R3v4n, please update your answer so that I can mark this question resolved."}], "tags": [], "owner": {"reputation": 529, "user_id": 1061579, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e80a2c0170d152133bfd5f691b5e2ccf?s=128&d=identicon&r=PG", "display_name": "R3v4n", "link": "https://stackoverflow.com/users/1061579/r3v4n"}, "is_accepted": true, "score": 15, "last_activity_date": 1506582062, "last_edit_date": 1506582062, "creation_date": 1506513722, "answer_id": 46447381, "question_id": 46446429, "link": "https://stackoverflow.com/questions/46446429/get-interface-field-values-from-an-interface-without-declaring-structure-in-gola/46447381#46447381", "title": "Get Interface Field Values From an Interface Without Declaring Structure in Golang", "body": "<p>You can use type assertion instead of reflection. It is generally better to avoid reflection whenever you can.</p>\n\n<pre><code>m, ok := t.(map[string]interface{})\nif !ok {\n    return fmt.Errorf(\"want type map[string]interface{};  got %T\", t)\n}\nfor k, v := range m {\n    fmt.Println(k, \"=&gt;\", v)\n}\n</code></pre>\n\n<p>If you really want to use reflection, you can do something like this:</p>\n\n<pre><code>s := reflect.ValueOf(t)\nfor _, k := range s.MapKeys() {\n    fmt.Println(s.MapIndex(k))\n}\n</code></pre>\n\n<p><strong>Update to reply to your latest update</strong></p>\n\n<p>It does not return what you expect because it returns a <code>reflect.Value</code>. If you want an integer value, you have to use <code>ratingsCount.Int()</code>.</p>\n\n<p>But as I said before, don't use reflection. Use the first solution with type assertion and just get the count with <code>m[\"count\"]</code>.</p>\n\n<p>I posted working example there using type assertion: <a href=\"https://play.golang.org/p/9gzwtJIfd7\" rel=\"noreferrer\">https://play.golang.org/p/9gzwtJIfd7</a></p>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20417, "favorite_count": 1, "accepted_answer_id": 46447381, "answer_count": 1, "score": 7, "last_activity_date": 1506582062, "creation_date": 1506510682, "last_edit_date": 1506569389, "question_id": 46446429, "link": "https://stackoverflow.com/questions/46446429/get-interface-field-values-from-an-interface-without-declaring-structure-in-gola", "title": "Get Interface Field Values From an Interface Without Declaring Structure in Golang", "body": "<p>I am trying to get field values from an interface in Golang. The interface is initially an empty interface which is getting its values from a database result. The DB query is working fine.</p>\n\n<p>The only thing I need is that I need to get the field value of the interface.\nHere is my code:</p>\n\n<pre><code>s := reflect.ValueOf(t)\n    for i := 0; i &lt; s.Len(); i++ {\n        fmt.Println(s.Index(i))\n    }\n</code></pre>\n\n<p>where t is an interface having following values:</p>\n\n<pre><code>map[id:null count:1]\n</code></pre>\n\n<p>I want value of <code>\"count\"</code> like simply 1.</p>\n\n<p>My problem is that the Index() method is returning a panic because it needs a struct and I dont have any struct here. So what should I do to get interface value? Is there any solution to iterate over an interface to get field values with or without Golang's reflection package?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>After getting the value for count I need to parse it to json.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>type ResponseControllerList struct{\n    Code            int             `json:\"code\"`\n    ApiStatus       int             `json:\"api_status\"`\n    Message         string          `json:\"message\"`\n    Data            interface{}     `json:\"data,omitempty\"`\n    TotalRecord     interface{}     `json:\"total_record,omitempty\"`\n}\nresponse := ResponseControllerList{}\nratingsCount := reflect.ValueOf(ratingsCountInterface).MapIndex(reflect.ValueOf(\"count\"))\nfmt.Println(ratingsCount)\n\nresponse = ResponseControllerList{\n                200,\n                1,\n                \"success\",\n                nil,\n                ratingsCount,\n            }\nGetResponseList(c, response)\n\nfunc GetResponseList(c *gin.Context, response ResponseControllerList) {\n    c.JSON(200, gin.H{\n        \"response\": response,\n    })\n}\n</code></pre>\n\n<p>The above code is being used to get the <code>ratingCount</code> in JSON format to use this response as API response. In this code, I am using the GIN framework to make HTTP request to API.</p>\n\n<p>Now the problem is that when I am printing the variable <code>ratingsCount</code>, its displaying the exact value of count in terminal what I need. But when I am passing it to JSON, the same variable gives me the response like:</p>\n\n<pre><code>{\n    \"response\": {\n        \"code\": 200,\n        \"api_status\": 1,\n        \"message\": \"Success\",\n        \"total_record\": {\n            \"flag\": 148\n        }\n    }\n}\n</code></pre>\n\n<p>What is the way to get the count's actual value in JSON ?</p>\n"}, {"tags": ["string", "go", "int", "type-conversion"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1506497648, "last_edit_date": 1506497648, "creation_date": 1506496153, "answer_id": 46441560, "question_id": 46441478, "link": "https://stackoverflow.com/questions/46441478/adding-a-integer-value-to-string-on-a-single-statement/46441560#46441560", "title": "Adding a integer value to string on a single statement", "body": "<p>There is no ready function in the standard library for what you want to do. And the reason for that is because adding a number to a number available as a <code>string</code> and having the result as another <code>string</code> is (terribly) <em>inefficient</em>.</p>\n\n<p>The model (memory representation) of the <code>string</code> type does not support adding numbers to it efficiently (not to mention that <code>string</code> values are immutable, a new one has to be created); the memory model of <code>int</code> does support adding efficiently for example (and CPUs also have direct operations for that). No one wants to add <code>int</code>s to numbers stored as <code>string</code> values. If you want to add numbers, have your numbers ready just as that: numbers. When you want to print or transmit, only then convert it to <code>string</code> (if you must).</p>\n\n<p>But everything becomes a single statement if you have a ready util function for it:</p>\n\n<pre><code>func add(s string, n int) (string, error) {\n    i, err := strconv.Atoi(s)\n    if err != nil {\n        return \"\", err\n    }\n    return strconv.Itoa(i + n), nil\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>s, err := add(\"10\", 5)\nfmt.Println(s, err)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/LnuZFWuY3Z\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>15 &lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 7756476, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/48d729a68f49808a92d7aaf49ba1747e?s=128&d=identicon&r=PG&f=1", "display_name": "camoflage ", "link": "https://stackoverflow.com/users/7756476/camoflage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 46441560, "answer_count": 1, "score": 0, "last_activity_date": 1506526798, "creation_date": 1506495859, "last_edit_date": 1506496603, "question_id": 46441478, "link": "https://stackoverflow.com/questions/46441478/adding-a-integer-value-to-string-on-a-single-statement", "title": "Adding a integer value to string on a single statement", "body": "<p>I was wondering how can I add an integer value to a string value like \"10\". I know I can accomplish this by converting the <code>string</code> into an <code>int</code> first and then after adding the integer I can convert it back into <code>string</code>. But can I accomplish this in a single statement in golang. For example I can do this with multiple lines like this:</p>\n\n<pre><code>i, err := strconv.Atoi(\"10\")\n// handle error\ni = i + 5\ns := strconv.Itoa(i)\n</code></pre>\n\n<p>But is there any way that I can accomplish this in a single statement?</p>\n"}, {"tags": ["go", "aerospike"], "comments": [{"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "edited": false, "score": 0, "creation_date": 1506497670, "post_id": 46441336, "comment_id": 79840029, "body": "Ok. Found <a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go#ListInsertOp\" rel=\"nofollow noreferrer\">godoc.org/github.com/aerospike/aerospike-client-go#ListInser&zwnj;&#8203;tOp</a> and use 0 as the index...but not sure how would this work for a list of messages"}], "answers": [{"comments": [{"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "edited": false, "score": 0, "creation_date": 1506498304, "post_id": 46442050, "comment_id": 79840369, "body": "Yup. That is what I just found out and added that as a comment to my question."}], "tags": [], "owner": {"reputation": 3825, "user_id": 1917187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/115760c69c4f709ccf66ec14e08882b2?s=128&d=identicon&r=PG", "display_name": "pgupta", "link": "https://stackoverflow.com/users/1917187/pgupta"}, "is_accepted": true, "score": 4, "last_activity_date": 1506497889, "creation_date": 1506497889, "answer_id": 46442050, "question_id": 46441336, "link": "https://stackoverflow.com/questions/46441336/how-to-prepend-to-a-list-in-aerospike-using-golang/46442050#46442050", "title": "How to Prepend to a list in aerospike using golang?", "body": "<p>Not familiar with Go client but just looking at the API, would specifying the index as 0 prepend it?</p>\n\n<pre><code>func ListInsertOp\nfunc ListInsertOp(binName string, index int, values ...interface{}) *Operation\nListInsertOp creates a list insert operation. Server inserts value to specified index of list bin. Server returns list size on bin name. It will panic is no values have been passed.\n</code></pre>\n"}], "owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 0, "accepted_answer_id": 46442050, "answer_count": 1, "score": 2, "last_activity_date": 1506497889, "creation_date": 1506495343, "question_id": 46441336, "link": "https://stackoverflow.com/questions/46441336/how-to-prepend-to-a-list-in-aerospike-using-golang", "title": "How to Prepend to a list in aerospike using golang?", "body": "<p>In aerospike, the <a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go#ListAppendOp\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/aerospike/aerospike-client-go#ListAppendOp</a> operation can be used along with client.Operate method to append to a list. Is there a way to Prepend to the list ?</p>\n\n<p>The <a href=\"http://www.aerospike.com/docs/guide/cdt-list.html#development-guidelines-and-tips\" rel=\"nofollow noreferrer\">http://www.aerospike.com/docs/guide/cdt-list.html#development-guidelines-and-tips</a> does mention that insertions can happen at either end of the list. But could not find the right API to do the same. Any help ?</p>\n"}, {"tags": ["docker", "go", "docker-machine"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1506495179, "post_id": 46441235, "comment_id": 79838713, "body": "What does the <code>Dockerfile</code> look like? Are those two lines all there&#39;s in it?"}, {"owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1506496689, "post_id": 46441235, "comment_id": 79839468, "body": "Yes, sir! That&#39;s all and it worked perfectly in my local environment"}, {"owner": {"reputation": 2128, "user_id": 284126, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/3cc7713a71d583a122566dab14a5fc77?s=128&d=identicon&r=PG", "display_name": "tanyehzheng", "link": "https://stackoverflow.com/users/284126/tanyehzheng"}, "edited": false, "score": 0, "creation_date": 1506499787, "post_id": 46441235, "comment_id": 79841269, "body": "how does your <code>docker run</code> command look like? Did you map the port correctly?"}, {"owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "edited": false, "score": 0, "creation_date": 1506500275, "post_id": 46441235, "comment_id": 79841538, "body": "it was like: docker run -d -p 8080:80 cookie-app"}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1506502444, "post_id": 46441235, "comment_id": 79842864, "body": "Add output of <code>docker ps</code>"}], "answers": [{"tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": true, "score": 1, "last_activity_date": 1506504158, "creation_date": 1506504158, "answer_id": 46444116, "question_id": 46441235, "link": "https://stackoverflow.com/questions/46441235/cant-run-go-lang-app-from-docker-image-on-docker-machine-virtual-box/46444116#46444116", "title": "Can&#39;t run Go (lang) app from docker image on docker-machine (Virtual Box)", "body": "<p>This command maps port 8080 from your docker host to port 80 of your container:</p>\n\n<blockquote>\n  <p>docker run -d -p 8080:80 cookie-app</p>\n</blockquote>\n\n<p>This instruction tells your go application to listen on port 8080, inside the container: </p>\n\n<blockquote>\n  <p>http.ListenAndServe(\":8080\", nil)</p>\n</blockquote>\n\n<p>You have a port mismatch in those above lines, your application is not listening on the port you are forwarding to.</p>\n\n<p>To connect to port 8080 of your container, you can run the following:</p>\n\n<pre><code>docker run -d -p 8080:8080 cookie-app\n</code></pre>\n"}], "owner": {"reputation": 1442, "user_id": 3289673, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100001287204028/picture?type=large", "display_name": "SanchelliosProg", "link": "https://stackoverflow.com/users/3289673/sanchelliosprog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 46444116, "answer_count": 1, "score": 0, "last_activity_date": 1506504158, "creation_date": 1506495011, "last_edit_date": 1592644375, "question_id": 46441235, "link": "https://stackoverflow.com/questions/46441235/cant-run-go-lang-app-from-docker-image-on-docker-machine-virtual-box", "title": "Can&#39;t run Go (lang) app from docker image on docker-machine (Virtual Box)", "body": "<p>I have a very simple application. Here is the code:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;math/rand&quot;\n    &quot;time&quot;\n    &quot;net/http&quot;\n    &quot;encoding/base64&quot;\n    &quot;encoding/json&quot;\n)\n\ntype Message struct {\n    Text string `json:&quot;text&quot;`\n}\n\n\nvar cookieQuotes = []string{\n    // Skipped all the stuff\n}\n\nconst COOKIE_NAME = &quot;your_cookie&quot;\n\nfunc main() {\n    http.HandleFunc(&quot;/set_cookie&quot;, setCookie)\n    http.HandleFunc(&quot;/get_cookie&quot;, getCookie)\n    http.Handle(&quot;/favicon.ico&quot;, http.NotFoundHandler())\n    http.ListenAndServe(&quot;:8080&quot;, nil)\n}\n\nfunc setCookie(w http.ResponseWriter, r *http.Request) {\n    quote := getRandomCookieQuote()\n    encQuote := base64.StdEncoding.EncodeToString([]byte(quote))\n    http.SetCookie(w, &amp;http.Cookie{\n        Name: COOKIE_NAME,\n        Value: encQuote,\n    })\n}\n\nfunc getCookie(w http.ResponseWriter, r *http.Request) {\n    cookie, err := r.Cookie(COOKIE_NAME)\n    if err != nil {\n        fmt.Fprintln(w, &quot;Cannot get the cookie&quot;)\n    }\n\n    message, _ := base64.StdEncoding.DecodeString(cookie.Value)\n    msg := Message{Text:string(message)}\n    fmt.Println(msg.Text)\n    respBody, err := json.Marshal(msg)\n    fmt.Println(string(respBody))\n    if err != nil {\n        fmt.Println(&quot;Cannot marshall JSON&quot;)\n    }\n    w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;)\n    fmt.Fprintln(w, string(respBody))\n}\n\nfunc getRandomCookieQuote() string {\n    source := rand.NewSource(time.Now().UnixNano())\n    random := rand.New(source)\n    i := random.Intn(len(cookieQuotes))\n    return cookieQuotes[i]\n}\n</code></pre>\n<p>It was tested locally, and, also I've tried to run a docker container with it on my machine (Ubuntu) and it was working perfectly. But I want to run it on Virtual Machine (I use Oracle Virtual Box).</p>\n<p>So, I have installed docker-machine:</p>\n<blockquote>\n<p>docker-machine version 0.12.2, build 9371605</p>\n</blockquote>\n<p>After that, I've switched to it, like it was recommended in <a href=\"https://docs.docker.com/machine/get-started/#run-containers-and-experiment-with-machine-commands\" rel=\"nofollow noreferrer\">official documentation</a> like this:</p>\n<blockquote>\n<p>eval &quot;$(docker-machine env default)&quot;</p>\n</blockquote>\n<p>So I can do now from a perspective of that machine.</p>\n<p>Also I've tried to run <strong>ngnix</strong> from the documentation example:</p>\n<blockquote>\n<p>docker run -d -p 8000:80 nginx</p>\n<p>curl $(docker-machine ip default):8000</p>\n</blockquote>\n<p>And I get the result, I can get to <em>ngnix welcome page</em> by accessing my docker machine ip-address which could be accessed by command:</p>\n<blockquote>\n<p>docker-machine ip default</p>\n</blockquote>\n<p>But when I try to run my own docker image, I could not do this. When I try to access it, I get:</p>\n<blockquote>\n<p>curl $(docker-machine ip default):8080</p>\n<p>curl: (7) Failed to connect to 192.168.99.100 port 8080: Connection refused</p>\n</blockquote>\n<p>Also I've tried to skip a port, to add protocol (http, and even https for the sake of luck) - nothing works.</p>\n<p>Maybe, something wrong with my Dockerfile?</p>\n<pre><code># Go experiments with cookies\nFROM golang:1.8-onbuild\nMAINTAINER vasyania2@gmail.com\n</code></pre>\n<p>Could you help me please?</p>\n"}, {"tags": ["go", "vim"], "comments": [{"owner": {"reputation": 156267, "user_id": 546861, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SIhsx.png?s=128&g=1", "display_name": "romainl", "link": "https://stackoverflow.com/users/546861/romainl"}, "edited": false, "score": 0, "creation_date": 1506497363, "post_id": 46440638, "comment_id": 79839854, "body": "How about asking on the plugin&#39;s issue tracker if you don&#39;t find the answer in its documentation?"}, {"owner": {"reputation": 62, "user_id": 3890756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af453c8cffe711525ebf18df025e3e0f?s=128&d=identicon&r=PG&f=1", "display_name": "kaeshi waza", "link": "https://stackoverflow.com/users/3890756/kaeshi-waza"}, "reply_to_user": {"reputation": 156267, "user_id": 546861, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SIhsx.png?s=128&g=1", "display_name": "romainl", "link": "https://stackoverflow.com/users/546861/romainl"}, "edited": false, "score": 0, "creation_date": 1506502263, "post_id": 46440638, "comment_id": 79842745, "body": "I don&#39;t know if it&#39;s related to vim or the plugin go-vim"}, {"owner": {"reputation": 7097, "user_id": 1389898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00f2a3f2624a47edc48464d4929a7508?s=128&d=identicon&r=PG", "display_name": "dlmeetei", "link": "https://stackoverflow.com/users/1389898/dlmeetei"}, "edited": false, "score": 0, "creation_date": 1506503371, "post_id": 46440638, "comment_id": 79843460, "body": "It should be <code>go-vim</code> plugin issue tracker"}, {"owner": {"reputation": 156267, "user_id": 546861, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SIhsx.png?s=128&g=1", "display_name": "romainl", "link": "https://stackoverflow.com/users/546861/romainl"}, "edited": false, "score": 0, "creation_date": 1506503489, "post_id": 46440638, "comment_id": 79843530, "body": "Your entry point is a plugin so your first step should be the plugin&#39;s doc. If it fails, try the plugin&#39;s issue tracker. If the maintainer thinks it&#39;s a Vim bug, try the vim_use mailing list."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1506685437, "post_id": 46440638, "comment_id": 79930596, "body": "Currrently vim-go doesn&#39;t deal with log outputs of <code>:GoTest</code> (and <code>:GoBuild</code> etc.) very well. There are actually some issues open for this on the bug tracker already."}], "answers": [{"comments": [{"owner": {"reputation": 62, "user_id": 3890756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af453c8cffe711525ebf18df025e3e0f?s=128&d=identicon&r=PG&f=1", "display_name": "kaeshi waza", "link": "https://stackoverflow.com/users/3890756/kaeshi-waza"}, "edited": false, "score": 0, "creation_date": 1506584378, "post_id": 46448079, "comment_id": 79881777, "body": "thanks, i will now go to the issue tracker of <code>vim-go</code> like suggested."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 0, "last_activity_date": 1506515835, "creation_date": 1506515835, "answer_id": 46448079, "question_id": 46440638, "link": "https://stackoverflow.com/questions/46440638/vim-go-how-to-see-the-log-of-gotestfunc-v/46448079#46448079", "title": "vim-go: how to see the log of :GoTestFunc -v?", "body": "<p>vim-go always clears the output window if the test succeeds<a href=\"https://github.com/cuzelac/vim-go/blob/449dc59a/autoload/go/cmd.vim#L252\" rel=\"nofollow noreferrer\">1</a>. You can hack your local vim script to change the behaviour, or submit a feature request in the issue tracker.</p>\n"}], "owner": {"reputation": 62, "user_id": 3890756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af453c8cffe711525ebf18df025e3e0f?s=128&d=identicon&r=PG&f=1", "display_name": "kaeshi waza", "link": "https://stackoverflow.com/users/3890756/kaeshi-waza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 0, "accepted_answer_id": 46448079, "answer_count": 1, "score": 0, "last_activity_date": 1506515835, "creation_date": 1506492724, "last_edit_date": 1506495269, "question_id": 46440638, "link": "https://stackoverflow.com/questions/46440638/vim-go-how-to-see-the-log-of-gotestfunc-v", "title": "vim-go: how to see the log of :GoTestFunc -v?", "body": "<p>When I use <code>:GoTestFunc -v</code> I see the log only if the test fail, I would like to see the result even if the test success.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["git", "go"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1506496259, "post_id": 46440000, "comment_id": 79839259, "body": "Have you tried to pass <code>nil</code> to Stdin? <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"nofollow noreferrer\">golang.org/pkg/os/exec/#Cmd</a> Also pls check examples below with CommandContext and StdinPipe."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1506497021, "post_id": 46440000, "comment_id": 79839660, "body": "@EugeneLisitsky yeah passing nil doesn&#39;t do anything. golang.org/pkg/os/exec/#Cmd.StdinPipe seems like closing the stdinPipe should keep the command from blocking I still get prompted for a password."}, {"owner": {"reputation": 19564, "user_id": 5292302, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3b61b00d5bcb378f99eadff312544514?s=128&d=identicon&r=PG", "display_name": "Petter Friberg", "link": "https://stackoverflow.com/users/5292302/petter-friberg"}, "edited": false, "score": 0, "creation_date": 1506541988, "post_id": 46440000, "comment_id": 79867918, "body": "Please post your solution as an answer not as an edit to the question see <a href=\"https://stackoverflow.com/tour\">tour</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "edited": false, "score": 0, "creation_date": 1506527435, "post_id": 46447698, "comment_id": 79860041, "body": "This works well, the only problem is that <code>Read()</code> still gets called even if there&#39;s no prompt to input so it will technically abort the git clone op even if there&#39;s no prompt for password"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1506528093, "post_id": 46447698, "comment_id": 79860479, "body": "I almost wrote this answer, but I double checked the docs first. This will indeed not work. I was not able to come up with a solution that works, but I didn&#39;t try very hard either... (Why is this marked accepted if it doesn&#39;t work?)"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1506528299, "post_id": 46447698, "comment_id": 79860604, "body": "I checked - yes <code>git</code> tries to read stdin even it does not need. So  we need a way to distinguish such situations."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1506533634, "post_id": 46447698, "comment_id": 79863479, "body": "@MiloChristiansen I thought it did work so I gave it the accepted answer"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "edited": false, "score": 0, "creation_date": 1506534974, "post_id": 46447698, "comment_id": 79864145, "body": "@EugeneLisitsky The particular comment you posted is only valid for https cloning. However, there was also a useful comment about ssh in the post. In order to disable stdin you can set <code>os.Setenv(&quot;GIT_SSH_COMMAND&quot;, &quot;ssh -oBatchMode=yes&quot;)</code> before running the clone. Do you want to update your answer and I&#39;ll give you the accepted answer?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1506550774, "post_id": 46447698, "comment_id": 79871686, "body": "@sreya I&#39;ve update solution. However for me both https and git works the same. Could you pls check? Could you provide your test repo url?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "edited": false, "score": 0, "creation_date": 1506641098, "post_id": 46447698, "comment_id": 79914290, "body": "@EugeneLisitsky unfortunately the repo I&#39;m testing against is private. The documentation seems to confirm that <code>GIT_TERMINAL_PROMPT</code> is only valid for https, i&#39;ve updated my answer to reflect this."}, {"owner": {"reputation": 2259, "user_id": 8554496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uJhVd.png?s=128&g=1", "display_name": "Clive Makamara", "link": "https://stackoverflow.com/users/8554496/clive-makamara"}, "edited": false, "score": 0, "creation_date": 1506667849, "post_id": 46447698, "comment_id": 79920857, "body": "If you use a native go-lang solution then ssh is possible with the added bonus of not relying on the git binary"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1506580094, "last_edit_date": 1506580094, "creation_date": 1506514743, "answer_id": 46447698, "question_id": 46440000, "link": "https://stackoverflow.com/questions/46440000/how-do-i-disable-credential-prompting-for-git-clone-in-go/46447698#46447698", "title": "How do I disable credential prompting for git clone in Go?", "body": "<p><strong>UPDATE</strong>: special git solution.</p>\n\n<p>Since v 2.3 git supports environment setting <code>GIT_TERMINAL_PROMPT=0</code> which says not to ask for credentials but fail.</p>\n\n<pre><code>func main() {\n    cmd := exec.Command(\"git\", \"clone\", \"https://github.com/some/non-existing-repo\")\n    os.Setenv(\"GIT_SSH_COMMAND\", \"ssh -oBatchMode=yes\")  // \n    cmd.Env = append(os.Environ(), \"GIT_TERMINAL_PROMPT=1\", \"GIT_SSH_COMMAND='ssh -oBatchMode=yes'\")\n\n    cmd.Stdout = os.Stdout\n    err := cmd.Run()\n    if err != nil {\n        log.Println(\"Error: \", err)\n    }\n} \n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "is_accepted": false, "score": 1, "last_activity_date": 1506641044, "last_edit_date": 1506641044, "creation_date": 1506640347, "answer_id": 46479574, "question_id": 46440000, "link": "https://stackoverflow.com/questions/46440000/how-do-i-disable-credential-prompting-for-git-clone-in-go/46479574#46479574", "title": "How do I disable credential prompting for git clone in Go?", "body": "<h1>SSH Solution:</h1>\n\n<p>The accepted answer will only work with http clones. If you want a way to do this with ssh the following will work:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>//disables stdin prompts for username/password. If passwordless-ssh isn't configured we want to fail\nos.Setenv(\"GIT_SSH_COMMAND\", \"ssh -oBatchMode=yes\") \ncmd := exec.Command(name, args...)\nreturn cmd.CombinedOutput()\n</code></pre>\n\n<p><code>man git</code> entry for <code>GIT_SSH_COMMAND</code></p>\n\n<blockquote>\n  <p>If either of these environment variables is set then git fetch and git push will use the\n             specified command instead of ssh when they need to connect to a remote system. The command will\n             be given exactly two or four arguments: the username@host (or just host) from the URL and the\n             shell command to execute on that remote system, optionally preceded by -p (literally) and the\n             port from the URL when it specifies something other than the default SSH port.</p>\n  \n  <p>$GIT_SSH_COMMAND takes precedence over $GIT_SSH, and is interpreted by the shell, which allows\n             additional arguments to be included.  $GIT_SSH on the other hand must be just the path to a\n             program (which can be a wrapper shell script, if additional arguments are needed).</p>\n  \n  <p>Usually it is easier to configure any desired options through your personal .ssh/config file.\n            Please consult your ssh documentation for further details.</p>\n</blockquote>\n\n<p><code>man git</code> entry for <code>GIT_TERMINAL_PROMPT</code></p>\n\n<blockquote>\n  <p>If this environment variable is set to 0, git will not prompt on the terminal (e.g., when\n             asking for HTTP authentication).</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 2259, "user_id": 8554496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uJhVd.png?s=128&g=1", "display_name": "Clive Makamara", "link": "https://stackoverflow.com/users/8554496/clive-makamara"}, "is_accepted": false, "score": 2, "last_activity_date": 1506667310, "last_edit_date": 1506667310, "creation_date": 1506666861, "answer_id": 46483014, "question_id": 46440000, "link": "https://stackoverflow.com/questions/46440000/how-do-i-disable-credential-prompting-for-git-clone-in-go/46483014#46483014", "title": "How do I disable credential prompting for git clone in Go?", "body": "<p>How about a natively golang solution for using git instead. This will mean that your program won't require git and you won't have issues with stdin and the git binary. Checkout this example from <a href=\"https://godoc.org/gopkg.in/src-d/go-git.v4\" rel=\"nofollow noreferrer\">https://godoc.org/gopkg.in/src-d/go-git.v4</a>. A plus is that the documentation is really good, this is from the <a href=\"https://github.com/src-d/go-git/tree/master/_examples\" rel=\"nofollow noreferrer\">examples</a> page of the project. It also supports the ssh protocol. Here is a <a href=\"https://github.com/src-d/go-git/blob/master/COMPATIBILITY.md\" rel=\"nofollow noreferrer\">full comparison</a> of git vs this project. </p>\n\n<pre><code>import (\n    \"fmt\"\n    \"os\"\n\n    \"gopkg.in/src-d/go-git.v4\"\n    . \"gopkg.in/src-d/go-git.v4/_examples\"\n)\n\n// Basic example of how to clone a repository using clone options.\nfunc main() {\n    url := \"https://github.com/some/non-existing-repo\"\n    directory := \"/foo/bar\"\n\n    // Clone the given repository to the given directory\n    Info(\"git clone %s %s --recursive\", url, directory)\n\n    r, err := git.PlainClone(directory, false, &amp;git.CloneOptions{\n        URL:               url,\n        RecurseSubmodules: git.DefaultSubmoduleRecursionDepth,\n    })\n\n    CheckIfError(err)  \n\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1370, "favorite_count": 0, "accepted_answer_id": 46447698, "answer_count": 3, "score": 2, "last_activity_date": 1506667310, "creation_date": 1506489525, "last_edit_date": 1506640332, "question_id": 46440000, "link": "https://stackoverflow.com/questions/46440000/how-do-i-disable-credential-prompting-for-git-clone-in-go", "title": "How do I disable credential prompting for git clone in Go?", "body": "<p>I'm trying to run the equivalent of <code>git clone</code> in Go but I want to exit out of the command if prompted for input from stdin (ex: authentication if an ssh key hasn't been set up in the remote repository). Is there a way to do this? Right now it will simply block on input.</p>\n"}, {"tags": ["go", "web", "web-testing"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 3709604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VV1w2.jpg?s=128&g=1", "display_name": "Amr Zenga", "link": "https://stackoverflow.com/users/3709604/amr-zenga"}, "edited": false, "score": 0, "creation_date": 1506641115, "post_id": 46471972, "comment_id": 79914294, "body": "here is an example of what i need to do : i used to do this with python and selenium :  <code>user = browser.find_element_by_css_selector(user_input)</code>  it gives me a pointer to the element or a nil value which i can check to see if the element was present or not how can i do this same example with chromedp"}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "reply_to_user": {"reputation": 51, "user_id": 3709604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VV1w2.jpg?s=128&g=1", "display_name": "Amr Zenga", "link": "https://stackoverflow.com/users/3709604/amr-zenga"}, "edited": false, "score": 0, "creation_date": 1506707600, "post_id": 46471972, "comment_id": 79943306, "body": "@AmrZenga : I believe <a href=\"https://godoc.org/github.com/knq/chromedp#ByID\" rel=\"nofollow noreferrer\">GoDoc</a> of the <code>chromedp</code> package. There are different functions available. I believe, <code>BySearch()</code> will help you in your case. Also, the way with JavaScript, I have mentioned in my answer will also work. :)"}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "reply_to_user": {"reputation": 51, "user_id": 3709604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VV1w2.jpg?s=128&g=1", "display_name": "Amr Zenga", "link": "https://stackoverflow.com/users/3709604/amr-zenga"}, "edited": false, "score": 0, "creation_date": 1506707820, "post_id": 46471972, "comment_id": 79943424, "body": "@AmrZenga: <code>Kenneth Shaw</code> has closed the issue <a href=\"https://github.com/knq/chromedp/issues/120#event-1270843274\" rel=\"nofollow noreferrer\">#120</a> which you have created on GitHub so my answer is correct and works well. So, I would suggest using it if you couldn&#39;t figure out a way with other functions of <code>chromedp</code>"}, {"owner": {"reputation": 51, "user_id": 3709604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VV1w2.jpg?s=128&g=1", "display_name": "Amr Zenga", "link": "https://stackoverflow.com/users/3709604/amr-zenga"}, "edited": false, "score": 0, "creation_date": 1506721817, "post_id": 46471972, "comment_id": 79949512, "body": "thx for your time , but all i need a working example of what i mentioned above ,the javascript way didn&#39;t work , if you knew what i need plz respond with an example, i only want to know if an item is present at the page or not"}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "reply_to_user": {"reputation": 51, "user_id": 3709604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VV1w2.jpg?s=128&g=1", "display_name": "Amr Zenga", "link": "https://stackoverflow.com/users/3709604/amr-zenga"}, "edited": false, "score": 0, "creation_date": 1506874357, "post_id": 46471972, "comment_id": 79982706, "body": "@AmrZenga I believe I have already answered your query by giving the example. You can use it by modifying it. Can you show what you have tried with JavaScript which you are saying, it didn&#39;t work? So that we can also understand your exact problem. This time show us your actual problem to get better and exact solution."}, {"owner": {"reputation": 51, "user_id": 3709604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VV1w2.jpg?s=128&g=1", "display_name": "Amr Zenga", "link": "https://stackoverflow.com/users/3709604/amr-zenga"}, "edited": false, "score": 0, "creation_date": 1506906863, "post_id": 46471972, "comment_id": 79990894, "body": "i tried you solution and it did exactly what the waitvisible do, it waits too much to check,i need an example like the one i mentions with python and selenium , a working example"}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "reply_to_user": {"reputation": 51, "user_id": 3709604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VV1w2.jpg?s=128&g=1", "display_name": "Amr Zenga", "link": "https://stackoverflow.com/users/3709604/amr-zenga"}, "edited": false, "score": 0, "creation_date": 1507198284, "post_id": 46471972, "comment_id": 80118911, "body": "@AmrZenga: Still you didn&#39;t answer my question. You are not showing us your trials and giving us your actual problem. And want us to help you to solve it exactly. You can accept this answer if it worked. Now, modifying it as you wanted is depend on you, so we can&#39;t guarantee that."}, {"owner": {"reputation": 1369, "user_id": 2730233, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GDPoY.jpg?s=128&g=1", "display_name": "Lucio Mollinedo", "link": "https://stackoverflow.com/users/2730233/lucio-mollinedo"}, "edited": false, "score": 0, "creation_date": 1580388182, "post_id": 46471972, "comment_id": 106085975, "body": "If the problem to you is that it waits too much to perform the check, skip WaitVisible and do the checking directly. But you should still use WaitVisible in another element to be sure that the page has finished loading. This answer is acceptable."}], "tags": [], "owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "is_accepted": false, "score": 3, "last_activity_date": 1506609776, "creation_date": 1506609776, "answer_id": 46471972, "question_id": 46438339, "link": "https://stackoverflow.com/questions/46438339/how-can-i-check-for-an-element-is-present-in-the-page-using-golang-knq-chromedp/46471972#46471972", "title": "How can I check for an element is present in the page using golang knq/chromedp", "body": "<p>Here is my answer.\nThe web page is <code>www.google.co.in</code>. The element used is <code>lst-ib</code>, Text box present on the page.</p>\n\n<ol>\n<li><p>Navigate the page.</p></li>\n<li><p>Wait until the element is visible.</p></li>\n<li><p>Read the value of the element. This is first time page is being loaded so obviously value will be <code>\"\"</code>.</p></li>\n<li><p>Assume, you have modified the value of the element by typing in the text box. Now, if we try to read the value of the same element <code>lst-ib</code> then we should get the updated value.</p></li>\n</ol>\n\n<p>My code is below,</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n\n    cdp \"github.com/knq/chromedp\"\n)\n\nfunc main() {\n    var err error\n\n    // create context\n    ctxt, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    // create chrome instance\n    c, err := cdp.New(ctxt)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // run task list\n    var res, value, newValue string\n    err = c.Run(ctxt, text(&amp;res, &amp;value, &amp;newValue))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // shutdown chrome\n    err = c.Shutdown(ctxt)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // wait for chrome to finish\n    err = c.Wait()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if len(value) &gt; 1 {\n        log.Println(\"Search Input is present.\")\n    } else {\n        log.Println(\"Search Input is NOT present.\")\n    }\n\n    log.Println(\"New updated value: \", newValue);   \n\n}\n\nfunc text(res, value, newValue *string) cdp.Tasks {\n    return cdp.Tasks{\n        cdp.Navigate(`https://www.google.co.in`),\n        cdp.WaitVisible(`lst-ib`, cdp.ByID),\n        cdp.EvaluateAsDevTools(\"document.getElementById('lst-ib').value\", value),\n        cdp.EvaluateAsDevTools(\"document.getElementById('lst-ib').value='Hello';document.getElementById('lst-ib').value\", newValue),\n    }\n}\n</code></pre>\n\n<p>To run code use <code>go run &lt;FileName&gt;.go</code></p>\n\n<p>I am getting following output which was expected:</p>\n\n<pre><code>$ go run main.go \n2017/09/28 20:05:20 Search Input is NOT present.\n2017/09/28 20:05:20 New updated value:  Hello\n</code></pre>\n\n<p><code>NOTE:</code></p>\n\n<p>First I checked with <code>Google Chrome Developer Tools</code> to get exact <code>Javascript</code>s for my need. It helps a lot.\nI have added the screenshot of the Javascript I tried on Chrome Developer Tools.</p>\n\n<p><a href=\"https://i.stack.imgur.com/1GuJO.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1GuJO.png\" alt=\"Screen shot of the Chrome Developer Tool\"></a></p>\n\n<p>I hope it helps you. :)</p>\n"}], "owner": {"reputation": 51, "user_id": 3709604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VV1w2.jpg?s=128&g=1", "display_name": "Amr Zenga", "link": "https://stackoverflow.com/users/3709604/amr-zenga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4119, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1565850036, "creation_date": 1506477620, "last_edit_date": 1506495700, "question_id": 46438339, "link": "https://stackoverflow.com/questions/46438339/how-can-i-check-for-an-element-is-present-in-the-page-using-golang-knq-chromedp", "title": "How can I check for an element is present in the page using golang knq/chromedp", "body": "<p><strong>I am creating an app to using [chromedp][1]</strong></p>\n\n<p>How can I check for an element is present in the page?</p>\n\n<p>I tried to use <code>cdp.WaitVisible()</code> but it didn't give me what I wanted.</p>\n\n<p>I need this so I can make dictions if the application will do one thing or the other.</p>\n\n<p>For this example, suppose I need to know if the search input is present or not</p>\n\n<p>How can I do that?</p>\n\n<p><strong>[1]: <a href=\"https://github.com/knq/chromedp\" rel=\"nofollow noreferrer\">https://github.com/knq/chromedp</a></strong></p>\n\n<pre><code>  package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"time\"\n\n    cdp \"github.com/knq/chromedp\"\n    cdptypes \"github.com/knq/chromedp/cdp\"\n)\n\nfunc main() {\n    var err error\n\n    // create context\n    ctxt, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    // create chrome instance\n    c, err := cdp.New(ctxt, cdp.WithLog(log.Printf))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // run task list\n    var site, res string\n    err = c.Run(ctxt, googleSearch(\"site:brank.as\", \"Easy Money Management\", &amp;site, &amp;res))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // shutdown chrome\n    err = c.Shutdown(ctxt)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // wait for chrome to finish\n    err = c.Wait()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Printf(\"saved screenshot of #testimonials from search result listing `%s` (%s)\", res, site)\n}\n\nfunc googleSearch(q, text string, site, res *string) cdp.Tasks {\n    var buf []byte\n    sel := fmt.Sprintf(`//a[text()[contains(., '%s')]]`, text)\n    return cdp.Tasks{\n        cdp.Navigate(`https://www.google.com`),\n        cdp.Sleep(2 * time.Second),\n        cdp.WaitVisible(`#hplogo`, cdp.ByID),\n        cdp.SendKeys(`#lst-ib`, q+\"\\n\", cdp.ByID),\n        cdp.WaitVisible(`#res`, cdp.ByID),\n        cdp.Text(sel, res),\n        cdp.Click(sel),\n        cdp.Sleep(2 * time.Second),\n        cdp.WaitVisible(`#footer`, cdp.ByQuery),\n        cdp.WaitNotVisible(`div.v-middle &gt; div.la-ball-clip-rotate`, cdp.ByQuery),\n        cdp.Location(site),\n        cdp.Screenshot(`#testimonials`, &amp;buf, cdp.ByID),\n        cdp.ActionFunc(func(context.Context, cdptypes.Handler) error {\n            return ioutil.WriteFile(\"testimonials.png\", buf, 0644)\n        }),\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506481568, "post_id": 46438276, "comment_id": 79834177, "body": "I don&#39;t know what your <code>syncmap.Map</code> type is, but chances are it shouldn&#39;t be copied. Start by running <code>go vet</code> on your code."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506516995, "post_id": 46438276, "comment_id": 79852500, "body": "It&#39;s hard to tell what&#39;s wrong without seeing the implementation of syncmap.Map. Try to make a runnable example on <a href=\"https://play.golang.org\" rel=\"nofollow noreferrer\">play.golang.org</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506517681, "post_id": 46438276, "comment_id": 79853035, "body": "Chances are this is the old <code>sync.Map</code> implementation from the <code>x&#47;sync</code> repo, in which case you most definitely can&#39;t copy it, but <code>vet</code> should point that out immediately."}], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 2, "last_activity_date": 1506507799, "creation_date": 1506507799, "answer_id": 46445449, "question_id": 46438276, "link": "https://stackoverflow.com/questions/46438276/how-to-add-entry-to-syncmap-map-when-it-has-type-interface/46445449#46445449", "title": "How to add entry to syncmap.Map when it has type interface", "body": "<p>You are correct about the inner map being a copy. To make persistent changes to the maps, use pointers.</p>\n\n<pre><code>func Test(name string, m *sync.Map) { // make parameter a pointer\n    log.Print(name, \" \")\n    m.Range(func(key, value interface{}) bool {\n        mm, ok := value.(*sync.Map) // outer map must also store inner maps as pointers\n        mm.Store(\"xxxxxxx\", 1)\n        return true\n    })\n    log.Println()\n}\n</code></pre>\n\n<p>Update the part of your code that declares the main outer map to store pointers to <code>sync.Map</code> type. Example:</p>\n\n<pre><code>var m sync.Map // outer map\nm.Store(\"A\", &amp;sync.Map{})\nm.Store(\"B\", &amp;sync.Map{})\nm.Store(\"C\", &amp;sync.Map{})\n\na, _ := m.Load(\"A\")\nam, _ := a.(*sync.Map)\nam.Store(\"xxxx\", 1)\n</code></pre>\n\n<p>Note that I've used <code>sync</code> package instead of <code>syncmap</code> since <code>syncmap.Map</code> is now a part of standard library.</p>\n\n<p>Working example: <a href=\"https://play.golang.org/p/ib-dfXjPDy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ib-dfXjPDy</a></p>\n"}], "owner": {"reputation": 773, "user_id": 2593312, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/c4c902ffb259359ad607fc4497297c04?s=128&d=identicon&r=PG", "display_name": "Rick Giuly", "link": "https://stackoverflow.com/users/2593312/rick-giuly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5949, "favorite_count": 1, "accepted_answer_id": 46445449, "answer_count": 1, "score": 1, "last_activity_date": 1506507799, "creation_date": 1506477140, "question_id": 46438276, "link": "https://stackoverflow.com/questions/46438276/how-to-add-entry-to-syncmap-map-when-it-has-type-interface", "title": "How to add entry to syncmap.Map when it has type interface", "body": "<p>In the example, I'm trying to store 1 at the key \"xxxxxxx\" in the syncmap called value. The type of value is interface{}. So, I have a type assertion to make it a syncmap.Map, which is mm. Then, I add the new entry to mm. Unfortunately the new entry, doesn't get added to value, only to mm. Looks like mm is a copy or something. I'm not sure how to make this work.</p>\n\n<p>To be specific, I figure I need to do the type assertion to add the entry. But, I think the type assertion is making a copy. Can you advise on how to do this so that the entry (\"xxxxxxx\", 1) is actually added into the syncmap called value?</p>\n\n<pre><code>func Test(name string, m syncmap.Map) {\n        log.Print(name, \" \")\n        m.Range(func(key, value interface{}) bool {\n                log.Println(\"&gt;&gt;\", value)\n                mm := value.(syncmap.Map)\n                mm.Store(\"xxxxxxx\", 1)\n                PrintMap(\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; \" + key.(string), value.(syncmap.Map))\n                return true\n        })\n        log.Println()\n}\n</code></pre>\n"}, {"tags": ["opencv", "go"], "comments": [{"owner": {"reputation": 18741, "user_id": 138200, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e98211a037ee1431e5c6929947691fba?s=128&d=identicon&r=PG", "display_name": "Mitch", "link": "https://stackoverflow.com/users/138200/mitch"}, "edited": false, "score": 1, "creation_date": 1506470694, "post_id": 46437169, "comment_id": 79831842, "body": "Consider just saving the mat with <a href=\"http://docs.opencv.org/3.0-beta/modules/imgcodecs/doc/reading_and_writing_images.html#imwrite\" rel=\"nofollow noreferrer\"><code>imwrite</code></a>.  Any performance difference is likely due to copies or due to a different default quality setting on the PNG encoder."}, {"owner": {"reputation": 14358, "user_id": 3962537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AI0Bc.png?s=128&g=1", "display_name": "Dan Ma\u0161ek", "link": "https://stackoverflow.com/users/3962537/dan-ma%c5%a1ek"}, "reply_to_user": {"reputation": 18741, "user_id": 138200, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/e98211a037ee1431e5c6929947691fba?s=128&d=identicon&r=PG", "display_name": "Mitch", "link": "https://stackoverflow.com/users/138200/mitch"}, "edited": false, "score": 0, "creation_date": 1506471165, "post_id": 46437169, "comment_id": 79831932, "body": "How exactly is <code>image&#47;png</code> implemented? | I&#39;d go with what @Mitch suggests, since OpenCV used LibPNG under the hood. 300ms per image seems a bit excessive when you&#39;re able to get 30fps."}, {"owner": {"reputation": 161, "user_id": 131267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4461d1efcbffe644dfa5bef07072e156?s=128&d=identicon&r=PG", "display_name": "dlowe", "link": "https://stackoverflow.com/users/131267/dlowe"}, "edited": false, "score": 0, "creation_date": 1506471826, "post_id": 46437169, "comment_id": 79832063, "body": "See what happens if you declare buffer (with <code>var buffer bytes.Buffer</code> <i>not</i>  <code>new(bytes.Buffer)</code>) just within your <code>for</code> loop."}, {"owner": {"reputation": 2460, "user_id": 3788456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kDXz3.jpg?s=128&g=1", "display_name": "AJ X.", "link": "https://stackoverflow.com/users/3788456/aj-x"}, "reply_to_user": {"reputation": 14358, "user_id": 3962537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AI0Bc.png?s=128&g=1", "display_name": "Dan Ma\u0161ek", "link": "https://stackoverflow.com/users/3962537/dan-ma%c5%a1ek"}, "edited": false, "score": 0, "creation_date": 1506472683, "post_id": 46437169, "comment_id": 79832244, "body": "@DanMa\u0161ek, Mitch -- thanks for your suggestions. image/png is a go library and I haven&#39;t dug into it&#39;s implementation yet.  I might end up doing that.  I&#39;m taking a look at using the Mat directly now.  The fact that the acquisition alone takes 50ms (~20fps at best) is raising concerns for me to."}, {"owner": {"reputation": 2460, "user_id": 3788456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kDXz3.jpg?s=128&g=1", "display_name": "AJ X.", "link": "https://stackoverflow.com/users/3788456/aj-x"}, "reply_to_user": {"reputation": 161, "user_id": 131267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4461d1efcbffe644dfa5bef07072e156?s=128&d=identicon&r=PG", "display_name": "dlowe", "link": "https://stackoverflow.com/users/131267/dlowe"}, "edited": false, "score": 0, "creation_date": 1506472730, "post_id": 46437169, "comment_id": 79832257, "body": "@dlowe I gave that a shot but the results were negligible.  Thanks for the suggestion!"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1506472789, "post_id": 46437169, "comment_id": 79832271, "body": "Go&#39;s standard image handling packages are implemented in a generic and safe, but slow, way IIRC. You may be better served to look for something faster, but less flexible."}, {"owner": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 0, "creation_date": 1506475691, "post_id": 46437169, "comment_id": 79832950, "body": "Why would you are declaring a buffer on every iteration of that loop? Move it to outside of the loop and preallocate a buffer large enough, this should solve your problem."}, {"owner": {"reputation": 2460, "user_id": 3788456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kDXz3.jpg?s=128&g=1", "display_name": "AJ X.", "link": "https://stackoverflow.com/users/3788456/aj-x"}, "reply_to_user": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 0, "creation_date": 1506477471, "post_id": 46437169, "comment_id": 79833284, "body": "@navossoc Thanks for the idea, unfortunately, as noted the problem is with (1) The image acquisition @ 50ms and (2) The PNG encoding time @ ~300ms.  This is a good suggestion for possible late-stage optimization, but in this case the time to allocate the buffer is negligible."}, {"owner": {"reputation": 546, "user_id": 1174534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca8267f69e15cd421deb3ca8a0524ec4?s=128&d=identicon&r=PG", "display_name": "navossoc", "link": "https://stackoverflow.com/users/1174534/navossoc"}, "edited": false, "score": 0, "creation_date": 1506477733, "post_id": 46437169, "comment_id": 79833347, "body": "I was trying to setup opencv into my windows here to make some tests, but no lucky... sourceforge is down for all day long and I don&#39;t have mingw installed."}, {"owner": {"reputation": 574, "user_id": 1804107, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dd0bb364299bb5c6fc7c626bf1af30e6?s=128&d=identicon&r=PG", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/1804107/aleksandar"}, "edited": false, "score": 0, "creation_date": 1551196906, "post_id": 46437169, "comment_id": 96548171, "body": "Gocv have function called imencode and it will encode to png ucing c++ under the hood."}, {"owner": {"reputation": 2460, "user_id": 3788456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kDXz3.jpg?s=128&g=1", "display_name": "AJ X.", "link": "https://stackoverflow.com/users/3788456/aj-x"}, "reply_to_user": {"reputation": 574, "user_id": 1804107, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/dd0bb364299bb5c6fc7c626bf1af30e6?s=128&d=identicon&r=PG", "display_name": "Aleksandar", "link": "https://stackoverflow.com/users/1804107/aleksandar"}, "edited": false, "score": 0, "creation_date": 1551385890, "post_id": 46437169, "comment_id": 96632065, "body": "Thanks @Aleksandar.  It&#39;s been a while since I&#39;ve looked at this, but I believe my final implementation ended up using libjpeg-turbo.  I as able to get decent quality and compression at ~30-35fps."}], "answers": [{"comments": [{"owner": {"reputation": 72581, "user_id": 44852, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/JbQbc.jpg?s=128&g=1", "display_name": "Tarik", "link": "https://stackoverflow.com/users/44852/tarik"}, "edited": false, "score": 3, "creation_date": 1506530744, "post_id": 46440262, "comment_id": 79861976, "body": "This should have added as a comment not a separate post."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": -1, "last_activity_date": 1506490923, "creation_date": 1506490923, "answer_id": 46440262, "question_id": 46437169, "link": "https://stackoverflow.com/questions/46437169/png-encoding-with-go-is-slow/46440262#46440262", "title": "PNG encoding with Go is slow", "body": "<blockquote>\n  <p>Why is this running so slowly?</p>\n</blockquote>\n\n<p>Measure! Go has nice profiling tools built in e.g. into <code>go test</code>.</p>\n\n<p>Most probably it is the PNG encoder which is pure, \"unoptimized\" Go. If this is not fast enough for you you might want to consider contributing a faster PNG encoder.</p>\n"}, {"comments": [{"owner": {"reputation": 2460, "user_id": 3788456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kDXz3.jpg?s=128&g=1", "display_name": "AJ X.", "link": "https://stackoverflow.com/users/3788456/aj-x"}, "edited": false, "score": 0, "creation_date": 1506521369, "post_id": 46449286, "comment_id": 79855826, "body": "This answer not only answers the question but also has a wealth of information to get me moving in the right direction. Thanks for all the effort you put into this!"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 5, "last_activity_date": 1506519186, "creation_date": 1506519186, "answer_id": 46449286, "question_id": 46437169, "link": "https://stackoverflow.com/questions/46437169/png-encoding-with-go-is-slow/46449286#46449286", "title": "PNG encoding with Go is slow", "body": "<p>Disabling compression improves encoding performance by an order of magnitude on my machine. That may be a start if you don't want to look for png packages outside the standard library. </p>\n\n<p>I also tried <a href=\"https://golang.org/pkg/image/png/#EncoderBufferPool\" rel=\"noreferrer\">the BufferPool</a> (new in Go 1.9), but it didn't make a difference compared to an encoder with a nil BufferPool. Perhaps I did it wrong. The docs are unfortunately very, erm, concise.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"image\"\n    \"image/png\"\n    \"os\"\n    \"testing\"\n)\n\nfunc BenchmarkPNG_Encode(b *testing.B) {\n    img, buf := loadImage(b)\n\n    b.ResetTimer()\n\n    for i := 0; i &lt; b.N; i++ {\n            buf.Reset()\n            png.Encode(buf, img)\n    }\n}\n\nfunc BenchmarkPNG_Encoder(b *testing.B) {\n    img, buf := loadImage(b)\n    enc := &amp;png.Encoder{}\n\n    b.ResetTimer()\n\n    for i := 0; i &lt; b.N; i++ {\n            buf.Reset()\n            enc.Encode(buf, img)\n    }\n}\n\nfunc BenchmarkPNG_Encoder_NoCompression(b *testing.B) {\n    img, buf := loadImage(b)\n    enc := &amp;png.Encoder{\n            CompressionLevel: png.NoCompression,\n    }\n\n    b.ResetTimer()\n\n    for i := 0; i &lt; b.N; i++ {\n            buf.Reset()\n            enc.Encode(buf, img)\n    }\n}\n\nfunc loadImage(b *testing.B) (image.Image, *bytes.Buffer) {\n    // foo.png PNG 1920x1053 1920x1053+0+0 8-bit sRGB 251KB 0.000u 0:00.000\n    f, err := os.Open(\"foo.png\")\n    if err != nil {\n            b.Fatal(err)\n    }\n\n    img, err := png.Decode(f)\n    if err != nil {\n            b.Fatal(err)\n    }\n    f.Close()\n\n    buf := &amp;bytes.Buffer{}\n    // grow the buffer once\n    (&amp;png.Encoder{CompressionLevel: png.NoCompression}).Encode(buf, img)\n\n    return img, buf\n}\n</code></pre>\n\n<p>Again, this was on my machine with a roughly 1920x1080 pixel image -- a random screenshot; not sure how much this will differ from, say, a photo. YMMV.</p>\n\n<pre><code>$ go test -v -bench . -benchmem \ngoos: linux\ngoarch: amd64\nBenchmarkPNG_Encode-8                         10         119289121 ns/op          884964 B/op         38 allocs/op\nBenchmarkPNG_Encoder-8                        10         118001658 ns/op          884932 B/op         37 allocs/op\nBenchmarkPNG_Encoder_NoCompression-8         100          13050664 ns/op          807156 B/op        212 allocs/op\n</code></pre>\n\n<p>It's interesting that no compression causes many more allocations than with compression though.</p>\n"}], "owner": {"reputation": 2460, "user_id": 3788456, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kDXz3.jpg?s=128&g=1", "display_name": "AJ X.", "link": "https://stackoverflow.com/users/3788456/aj-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2365, "favorite_count": 4, "accepted_answer_id": 46449286, "answer_count": 2, "score": 3, "last_activity_date": 1506519186, "creation_date": 1506467960, "last_edit_date": 1506470092, "question_id": 46437169, "link": "https://stackoverflow.com/questions/46437169/png-encoding-with-go-is-slow", "title": "PNG encoding with Go is slow", "body": "<p>I'm acquiring frames from my built in webcam with go-opencv. The time it takes to acquire an image from the camera  is ~50ms. The time to encode the PNG is ~300ms.  Encoding a JPEG is 3x faster, but still horribly slow.</p>\n\n<p>Why is this running so slowly?</p>\n\n<p><em>Note</em>:\nI've written similar code against NodeJS, executed on the same machine, and have absolutely no problem hitting 30fps w/ additional image processing.  For me, this removes hardware issues from the equation.</p>\n\n<p>My code looks like this:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"image/png\"\n\n    \"github.com/lazywei/go-opencv/opencv\"\n)\n\ncamera := opencv.NewCameraCapture(0)\nif camera == nil {\n    panic(\"Unable to open camera.\")\n}\ndefer camera.Release()\n\nfor {\n    if camera.GrabFrame() {\n        img := camera.RetrieveFrame(1)\n        if img != nil {\n            frame := img.ToImage()\n            buffer := new(bytes.Buffer)\n            png.Encode(buffer, frame)\n        } else {\n            fmt.Println(\"Unable to capture frame\")\n        }\n    }\n\n}\n</code></pre>\n"}, {"tags": ["javascript", "json", "go", "websocket"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1506459758, "post_id": 46435740, "comment_id": 79828711, "body": "Somewhere you are <code>base64</code> encoding the data. The string you posted after base64 decode is <code>{&quot;ChunksWritten&quot;:0,&quot;ChunksRead&quot;:0,&quot;BytesWritten&quot;:54481,&quot;Byte&zwnj;&#8203;sRead&quot;:78782,&quot;DataBy&zwnj;&#8203;tesWritten&quot;:0,&quot;DataB&zwnj;&#8203;ytesRead&quot;:0,&quot;ActiveP&zwnj;&#8203;eers&quot;:0,&quot;TotalPeers&quot;&zwnj;&#8203;:43,&quot;TorrentHashStri&zwnj;&#8203;ng&quot;:&quot;9f9165d9a281a9b&zwnj;&#8203;8e782cd5176bbcc8256f&zwnj;&#8203;d1871&quot;}</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506460054, "post_id": 46435740, "comment_id": 79828834, "body": "I don&#39;t know what kind of <code>conn</code> has a <code>WriteJSON</code> method, but it looks like you&#39;re taking a slice which is already JSON, and encoding it again as JSON, which is probably not what you want to do."}, {"owner": {"reputation": 309, "user_id": 1396929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/221315012a0495acf6feed3f7b5de204?s=128&d=identicon&r=PG", "display_name": "deranjer", "link": "https://stackoverflow.com/users/1396929/deranjer"}, "edited": false, "score": 0, "creation_date": 1506460128, "post_id": 46435740, "comment_id": 79828869, "body": "Sorry forgot to add the library I am using: <a href=\"http://www.gorillatoolkit.org/pkg/websocket\" rel=\"nofollow noreferrer\">gorillatoolkit.org/pkg/websocket</a>  This is creating the connection: <code>conn, err := upgrader.Upgrade(w, r, nil)</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506460251, "post_id": 46435740, "comment_id": 79828919, "body": "Then only use <code>WriteJSON</code> <i>or</i> <code>json.Marshal</code>; you don&#39;t need to encode it twice."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1506460429, "post_id": 46435740, "comment_id": 79828996, "body": "Interesting that it <code>base64</code> encodes it if sent to both..."}, {"owner": {"reputation": 309, "user_id": 1396929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/221315012a0495acf6feed3f7b5de204?s=128&d=identicon&r=PG", "display_name": "deranjer", "link": "https://stackoverflow.com/users/1396929/deranjer"}, "edited": false, "score": 0, "creation_date": 1506460431, "post_id": 46435740, "comment_id": 79828998, "body": "Thanks, in retrospect I should have realized that the reason they had a &quot;writejson&quot; function was to encode as well as write to the websocket, otherwise why have that function at all.  Thanks!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1506460629, "post_id": 46435740, "comment_id": 79829072, "body": "@RayfenWindspear: base64 is the default json encoding format for a <code>[]byte</code>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506460815, "post_id": 46435740, "comment_id": 79829161, "body": "@JimB Cool! Learn something new every day!"}], "answers": [{"tags": [], "owner": {"reputation": 309, "user_id": 1396929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/221315012a0495acf6feed3f7b5de204?s=128&d=identicon&r=PG", "display_name": "deranjer", "link": "https://stackoverflow.com/users/1396929/deranjer"}, "is_accepted": true, "score": 2, "last_activity_date": 1506460939, "creation_date": 1506460939, "answer_id": 46436045, "question_id": 46435740, "link": "https://stackoverflow.com/questions/46435740/golang-backend-to-javascript-json-parse/46436045#46436045", "title": "Golang backend to javascript JSON Parse", "body": "<p>The gorilla websocket <a href=\"http://www.gorillatoolkit.org/pkg/websocket,%20package\" rel=\"nofollow noreferrer\">package</a> automatically encodes to JSON so using the standard library to encode as well was just encoding it twice, causing it to show up as base64. </p>\n\n<p>Thanks guys!</p>\n"}], "owner": {"reputation": 309, "user_id": 1396929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/221315012a0495acf6feed3f7b5de204?s=128&d=identicon&r=PG", "display_name": "deranjer", "link": "https://stackoverflow.com/users/1396929/deranjer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 693, "favorite_count": 0, "accepted_answer_id": 46436045, "answer_count": 1, "score": 1, "last_activity_date": 1506460939, "creation_date": 1506459566, "last_edit_date": 1506460237, "question_id": 46435740, "link": "https://stackoverflow.com/questions/46435740/golang-backend-to-javascript-json-parse", "title": "Golang backend to javascript JSON Parse", "body": "<p>I am using the gorilla websocket library for golang: <a href=\"http://www.gorillatoolkit.org/pkg/websocket\" rel=\"nofollow noreferrer\" title=\"Gorilla Websocket\">http://www.gorillatoolkit.org/pkg/websocket</a></p>\n\n<p>This is the code I am using to create the websocket connection: </p>\n\n<pre><code>conn, err := upgrader.Upgrade(w, r, nil)\n</code></pre>\n\n<p>Having an issue with sending JSON from golang to javascript. I can get it working but have to do what seem to be unnecessary steps.  Here is the basics of the golang backend that does not work:</p>\n\n<pre><code>    type clientDB struct{\n         ChunksWritten int64\n         ChunksRead int64\n         BytesWritten   int64\n         BytesRead    int64\n         DataBytesWritten int64\n         DataBytesRead    int64\n         ActivePeers   int\n         TotalPeers    int\n         TorrentHashString string\n}\n\nfullClientDB := new(clientDB) //creating a new clientDB struct\n\nb, err := json.Marshal(fullClientDB)\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n\n\nconn.WriteJSON(b)\n</code></pre>\n\n<p>When I use JSON.parse in javascript I get the following response: </p>\n\n<pre><code>var clientUpdate = JSON.parse(evt.data);\n</code></pre>\n\n<blockquote>\n  <p>eyJDaHVua3NXcml0dGVuIjowLCJDaHVua3NSZWFkIjowLCJCeXRlc1dyaXR0ZW4iOjU0NDgxLCJCeXRlc1JlYWQiOjc4NzgyLCJEYXRhQnl0ZXNXcml0dGVuIjowLCJEYXRhQnl0ZXNSZWFkIjowLCJBY3RpdmVQZWVycyI6MCwiVG90YWxQZWVycyI6NDMsIlRvcnJlbnRIYXNoU3RyaW5nIjoiOWY5MTY1ZDlhMjgxYTliOGU3ODJjZDUxNzZiYmNjODI1NmZkMTg3MSJ9</p>\n</blockquote>\n\n<p>I can get it working making the following changes:</p>\n\n<pre><code>conn.WriteJSON(string(b))\n</code></pre>\n\n<p>Then in javascript I actually parse the data TWICE.</p>\n\n<pre><code>var clientUpdate = JSON.parse(evt.data);\nvar clientUpdateJSON = JSON.parse(clientUpdate);\n</code></pre>\n\n<p>After that I can access the data correctly as a JSON object.  Is there something I'm missing about sending JSON objects from golang to javascript over websockets?</p>\n"}, {"tags": ["dictionary", "go", "types", "interface"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 3, "creation_date": 1506452598, "post_id": 46433860, "comment_id": 79825208, "body": "No, it\u2019s not enough, the signature is not the same. Why do you want to do that? (This may help others to suggest alternatives)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1506452742, "post_id": 46433860, "comment_id": 79825285, "body": "&quot; I wonder why I can&#39;t since function ensures I have to provide a MyDoer which implements Doer.&quot; this doesn&#39;t make the type the same. Different types are different types. Go has no supertypes with subtypes being also of supertype. That&#39;s how the type system works."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1506452806, "post_id": 46433860, "comment_id": 79825324, "body": "Go is not really object oriented, though you can mimic it in many ways. This is not one of them."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1506452949, "post_id": 46433860, "comment_id": 79825386, "body": "as the <a href=\"https://golang.org/ref/spec#Properties_of_types_and_values\" rel=\"nofollow noreferrer\">docs</a> state: <code>Two types are either identical or different. </code>"}, {"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 0, "creation_date": 1506453552, "post_id": 46433860, "comment_id": 79825703, "body": "Sure - they are different types, but I can pass a <code>MyDoer</code> to a function that accepts a <code>Doer</code> - that&#39;s the whole point of interfaces.  Why does putting it in a map make the result somehow different?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1506453814, "post_id": 46433860, "comment_id": 79825847, "body": "Because you aren&#39;t passing a <code>Doer</code> you are passing a <code>func(Doer) string</code> the compiler doesn&#39;t care that <code>MyDoer</code> implements <code>Doer</code>, the function type must match exactly."}, {"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 0, "creation_date": 1506454344, "post_id": 46433860, "comment_id": 79826106, "body": "it clearly doesn&#39;t, but should it? could it? Is there a simple reason I&#39;ve missed that it can&#39;t? Most likely this isn&#39;t something that comes up often, and I&#39;ve clearly created an artificial example, but it did come up in my project."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1506454513, "post_id": 46433860, "comment_id": 79826201, "body": "You&#39;ve updated your question to basically say you understand but don&#39;t like the answer. <i>That&#39;s just how Go works.</i> You defined a specific value type in the <code>map</code>, and you must use that type, period. Any discussion beyond that is out of scope for SO, possibly better suited to one of the Go mailing lists."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1506455725, "post_id": 46433860, "comment_id": 79826805, "body": "they are taking proposals now for go2: <a href=\"https://github.com/golang/proposal\" rel=\"nofollow noreferrer\">github.com/golang/proposal</a>"}, {"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 0, "creation_date": 1506457420, "post_id": 46433860, "comment_id": 79827578, "body": "I&#39;m not nearly smart enough to make a language design proposal."}], "answers": [{"comments": [{"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 0, "creation_date": 1506454968, "post_id": 46434487, "comment_id": 79826430, "body": "The problem is that this map bridges the gap between library and user code, so the user might want <code>AlsoDo</code> but the library can&#39;t know that."}, {"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 0, "creation_date": 1506455523, "post_id": 46434487, "comment_id": 79826704, "body": "This second example suggests some possibility, but in my case it just moves the problem around - I need to make a library that doesn&#39;t know developer defined concrete types, and define a map-type that uses them, without requiring the user to write type assertions."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 1, "creation_date": 1506455606, "post_id": 46434487, "comment_id": 79826744, "body": "Maybe you should try explaining the real problem, explaining all the constraints by editing your answer above. This is a little abstract and you&#39;re focussed on the limits of the type system, rather than what you actually need to do. Are you sure for example that you need a map of funcs that act on types, not a map of types?"}, {"owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 0, "creation_date": 1506458733, "post_id": 46434487, "comment_id": 79828205, "body": "sorry if my update sounded snarky, i realize you are genuinely trying to help, and thanks for that.  the list of constraints does not easily fit the SO Q&amp;A format"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "edited": false, "score": 0, "creation_date": 1506459365, "post_id": 46434487, "comment_id": 79828532, "body": "Can you elaborate on why the map[int]Doer is not workable?"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1506459845, "last_edit_date": 1506459845, "creation_date": 1506454634, "answer_id": 46434487, "question_id": 46433860, "link": "https://stackoverflow.com/questions/46433860/golang-using-a-defined-interface-in-a-map-value/46434487#46434487", "title": "golang: Using a defined interface in a Map Value", "body": "<p>You haven't outlined a concrete problem (the why). This makes it hard to suggest alternatives, because it looks like you're trying to recreate another language in go. </p>\n\n<p>In order of preference, you can use the type system as intended: </p>\n\n<pre><code>type DoMap map[int]func(Doer) string\n\ntype Doer interface {\n    Do() int\n    AlsoDo() int\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/uPzoOZiLQG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uPzoOZiLQG</a></p>\n\n<p>Or you can bypass the type system of course:</p>\n\n<pre><code>type DoMap map[int]interface{}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lfKPkwhOGa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lfKPkwhOGa</a></p>\n\n<p>But I wouldn't recommend that - better to work with the tools the language gives you, rather than trying to bend them out of shape. </p>\n\n<p>The intent of the interface is to advertise a contract about the functions - they require this of their argument, and no more. But then you also want to call AlsoDo on the argument, so if you want to do that, put it in the contract. Then all will work as you intend. The contract for the function should be published next to the function as in your example, it should be under your control. </p>\n\n<p>[EDIT]\nFinally, if you don't control the types passed in, perhaps you should rethink the idea of your map. It could be a map[int]Doer where Doer is an interface (which you should control). This lets you advertise what you require in your library, and users put whatever type they want in there (with whatever other dependencies they want). </p>\n\n<pre><code>// Library \ntype DoMap map[int]Doer\n\ntype Doer interface {\n    Do() int\n}\n\n// Client \ntype MyDoer struct {\n    myint int\n}\n\nfunc (d *MyDoer) Do() int {\n    fmt.Println(d.AlsoDo())\n    return d.myint + 1\n}\n\nfunc (d *MyDoer) AlsoDo() int {\n    return d.myint + 2\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/cs01C8bSKo\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cs01C8bSKo</a></p>\n\n<p>[EDIT2] Final edit, if building an fsm management chain, you might find this little project inspirational. It should definitely be doable without much trouble, just not exactly as in your first attempt of a map of function which can take any type: </p>\n\n<p><a href=\"https://github.com/ryanfaerman/fsm\" rel=\"nofollow noreferrer\">https://github.com/ryanfaerman/fsm</a></p>\n"}], "owner": {"reputation": 2174, "user_id": 2712644, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qbg3j.jpg?s=128&g=1", "display_name": "domoarigato", "link": "https://stackoverflow.com/users/2712644/domoarigato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1506459845, "creation_date": 1506452143, "last_edit_date": 1506458165, "question_id": 46433860, "link": "https://stackoverflow.com/questions/46433860/golang-using-a-defined-interface-in-a-map-value", "title": "golang: Using a defined interface in a Map Value", "body": "<p>in the linked playground example, I define a type:</p>\n\n<pre><code>type DoMap map[int]func(Doer) string\n</code></pre>\n\n<p>Where <code>Doer</code> in an interface type that I define.</p>\n\n<p>I implement the interface on a concrete type <code>MyDoer</code>.  I'd like to be able to construct a <code>DoMap</code> where entries into that map contain functions like both of the following:</p>\n\n<pre><code>func(Doer) string // this works\nfunc(*MyDoer) string // this doesn't\nfunc(MyDoer) string // more-or-less the same idea, also doesn't\n</code></pre>\n\n<p>I can't, and although it's obvious they are different types, I wonder why I can't since function ensures I have to provide a <code>MyDoer</code> which implements <code>Doer</code>.</p>\n\n<p>Isn't that enough to ensure I will fulfill my contract with the function?</p>\n\n<p>Is there another way of achieving this?</p>\n\n<p><a href=\"https://play.golang.org/p/sJ2Rg3neL7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/sJ2Rg3neL7</a></p>\n\n<h3>Update</h3>\n\n<p>Some comments are of the form \"they are different\" \"that's the spec\" but I can pass a <code>MyDoer</code> to a function that accepts a <code>Doer</code> - if the interface is implemented: why does putting it into a map change the result?</p>\n\n<h3>Update 2</h3>\n\n<p>There's a request to explain the \"real problem\" and a question of why I can't just use a map of types.  I'll try best I can:</p>\n\n<p><code>DoMap</code> cannot be a map of types.  I am writing a library that allows developers to succinctly define state machines, which succeed or fail to transition, based on the output of a developer written function (business logic) that accepts a developer defined type (business message). the library exists to ensure that the series of transitions can be serialized and recorded elsewhere and subsequently verified by third party users of the library.  I didn't say all that originally, because it misses the point - there isn't a simple answer.</p>\n\n<p>Now I feel like I am annoying everyone with my impertinent questions, and since I don't exactly have Rob Pike on speed dial, I'll probably delete this, unless some one is willing to trust that I need to do what I need to do, and suggest something.</p>\n"}, {"tags": ["go", "middleware"], "answers": [{"tags": [], "owner": {"reputation": 195, "user_id": 2893513, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f874f2807a1c11a1fbc9bed368712205?s=128&d=identicon&r=PG&f=1", "display_name": "Oleg", "link": "https://stackoverflow.com/users/2893513/oleg"}, "is_accepted": true, "score": 2, "last_activity_date": 1506515474, "creation_date": 1506515474, "answer_id": 46447927, "question_id": 46433817, "link": "https://stackoverflow.com/questions/46433817/chaining-cas-middleware-and-httprouter-routing/46447927#46447927", "title": "Chaining CAS middleware and httprouter() routing", "body": "<p>Your middleware may use request context to pass the data to the handler with different signature:</p>\n\n<pre><code>import (\n    \"net/http\"\n    \"net/url\"\n\n    \"github.com/go-cas/cas\"\n    \"github.com/julienschmidt/httprouter\"\n    \"golang.org/x/net/context\"\n)\n\nfunc defaultHandler(w http.ResponseWriter, r *http.Request) {\n    if !cas.IsAuthenticated(r) {\n        cas.RedirectToLogin(w, r)\n    }\n\n    ps := r.Context().Value(\"params\").(httprouter.Params)\n\n    // business logic\n}\n\n\nfunc main() {\n\n    u, _ := url.Parse(\"https://cas_example_server.com\")\n\n    client := cas.NewClient(&amp;cas.Options{\n        URL: u,\n    })\n\n    router := httprouter.New()\n\n    //This line fails with the message:\n\n    //\"Cannot use defaultHandler (type func(http.ResponseWriter, *http.Request, httprouter.Params))\n    //as type func(http.ResponseWriter, *http.Request) in argument to client.HandleFunc\"\n\n    router.Handler(\"GET\", \"/\", func(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n        newContext := context.WithValue(r.Context(), \"params\", ps)\n        r.WithContext(newContext)\n        client.HandleFunc(defaultHandler)(w, r)\n    })\n\n    err := http.ListenAndServe(\":8080\", router)\n    if err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n\n<p><strong>UPDATE:</strong>\nThere are a number of useful libraries to hold your http handlers stack like this <a href=\"https://github.com/urfave/negroni\" rel=\"nofollow noreferrer\">https://github.com/urfave/negroni</a></p>\n"}], "owner": {"reputation": 673, "user_id": 363042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d158e0063c0d368abbca8e7f99a153af?s=128&d=identicon&r=PG", "display_name": "Brent", "link": "https://stackoverflow.com/users/363042/brent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 46447927, "answer_count": 1, "score": 1, "last_activity_date": 1506515474, "creation_date": 1506451985, "question_id": 46433817, "link": "https://stackoverflow.com/questions/46433817/chaining-cas-middleware-and-httprouter-routing", "title": "Chaining CAS middleware and httprouter() routing", "body": "<p>I'm deep in the weeds on what's probably a simple problem. I need wrap a func with a call to a third-party CAS authenication service. I'm using go-cas to do that, and it worked until I started adding routing requirements. I chose Julien Schmidt's httprouter, and somehow I need to get that to work with go-cas too. </p>\n\n<p>If I'm not mistaken, I need to use some kind of custom-designed middleware to go from handler to handler. I think the chain needs to go something like this:</p>\n\n<p>http.Handler -> func(http.ResponseWriter, *http.Request, httprouter.Params)</p>\n\n<p>...the first being what CAS wants, and the second being what httprouter wants. But I'm so lost now that I can't make heads or tails of what to do.</p>\n\n<p>Thanks for any advice!</p>\n\n<hr>\n\n<p>In the code below, the call to ...</p>\n\n<pre><code>router.Handler(\"GET\", \"/\", client.HandleFunc(defaultHandler))\n</code></pre>\n\n<p>... produces this error:</p>\n\n<p>\"cannot use defaultHandler (type func(http.ResponseWriter, *http.Request, httprouter.Params)) as type func(http.ResponseWriter, *http.Request) in argument to client.HandleFunc\"</p>\n\n<p>Here's the non-working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n    \"time\"\n\n    \"github.com/go-cas/cas\"\n    \"github.com/julienschmidt/httprouter\"\n)\n\nfunc defaultHandler(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n    if !cas.IsAuthenticated(r) {\n        cas.RedirectToLogin(w, r)\n    }\n\n    pageID := ps.ByName(\"pageID\")\n\n    type pageModel struct {\n        Title    string\n        PageID   string\n    }\n\n    model := pageModel{\n        Title:    \"Seminars\",\n        PageID:    pageID,\n    }\n    render.ToBrowser(w, \"views/index.html\", &amp;model)\n}\n\n\nfunc main() {\n\n    u, _ := url.Parse(\"https://cas_example_server.com\")\n\n    client := cas.NewClient(&amp;cas.Options{\n        URL: u,\n    })\n\n    router := httprouter.New()\n\n    //This line fails with the message:\n\n    //\"Cannot use defaultHandler (type func(http.ResponseWriter, *http.Request, httprouter.Params)) \n    //as type func(http.ResponseWriter, *http.Request) in argument to client.HandleFunc\"\n\n    router.Handler(\"GET\", \"/\", client.HandleFunc(defaultHandler))\n\n    err := http.ListenAndServe(\":8080\", router)\n    if err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["elasticsearch", "go", "elasticsearch-plugin", "elasticsearch-query"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506953498, "post_id": 46433733, "comment_id": 80008499, "body": "Share your mapping. I suspect that &quot;nestedfield&quot; is not actually a nested document."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1506971775, "post_id": 46433733, "comment_id": 80019048, "body": "I&#39;ve adjusted answer below but you should try giving more detail of the full code used to search."}, {"owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "edited": false, "score": 0, "creation_date": 1507152192, "post_id": 46433733, "comment_id": 80102367, "body": "Shared mapping and what eventually worked"}], "answers": [{"comments": [{"owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "edited": false, "score": 0, "creation_date": 1506718922, "post_id": 46435467, "comment_id": 79948530, "body": "I tried this and the error went away but it doesn&#39;t return any results. I edited the question to add more details"}, {"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 1, "creation_date": 1506744068, "post_id": 46435467, "comment_id": 79953576, "body": "<code>&quot;ind1&quot;</code>  should be <code>&quot;nestedfield.ind1&quot;</code>"}, {"owner": {"reputation": 1977, "user_id": 2612230, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mwS0O.jpg?s=128&g=1", "display_name": "Pandawan", "link": "https://stackoverflow.com/users/2612230/pandawan"}, "edited": false, "score": 0, "creation_date": 1506947850, "post_id": 46435467, "comment_id": 80005101, "body": "I believe Val meant <code>aquery := elastic.NewTermQuery(&quot;nestedfield.ind1&quot;, val1)</code>"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1506971749, "post_id": 46435467, "comment_id": 80019038, "body": "Thanks Val, Pandawan, I think you&#39;re right. Sorry for rejected edit."}, {"owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "edited": false, "score": 0, "creation_date": 1507152312, "post_id": 46435467, "comment_id": 80102412, "body": "I was able to use <code>elastic.NewMatchQuery(&quot;nestedfield.ind1&quot;, &quot;val1&quot;)</code> to get the result. I wonder why the NewNestedQuery and NewTermQuery combo didn&#39;t work :/"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 3, "last_activity_date": 1506971719, "last_edit_date": 1506971719, "creation_date": 1506458534, "answer_id": 46435467, "question_id": 46433733, "link": "https://stackoverflow.com/questions/46433733/elasticsearch-go-nested-query/46435467#46435467", "title": "Elasticsearch Go nested query", "body": "<p>Looks like that should be:</p>\n\n<pre><code>q := elastic.NewTermQuery(\"nestedfield.ind1\", value)\nnq := elastic.NewNestedQuery(\"nestedfield\", q)\n</code></pre>\n\n<ul>\n<li>NestedQuery is a type, not a function. </li>\n<li>NewTermQuery needs to take a\nvalue from the json, not a const string</li>\n<li>You'll need to parse your source json to get the value from ind1</li>\n</ul>\n\n<p>Edited to fix NewTermQuery too as per comments below. If that still doesn't work provide the full code you're using to parse source and get the error as you don't give enough detail here to guess at the problem. </p>\n"}], "owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1902, "favorite_count": 1, "answer_count": 1, "score": 10, "last_activity_date": 1507152168, "creation_date": 1506451688, "last_edit_date": 1507152168, "question_id": 46433733, "link": "https://stackoverflow.com/questions/46433733/elasticsearch-go-nested-query", "title": "Elasticsearch Go nested query", "body": "<p>I'm using olivere's elastic Go library to run Elastic queries - <a href=\"https://godoc.org/github.com/olivere/elastic#NestedQuery\" rel=\"noreferrer\">https://godoc.org/github.com/olivere/elastic#NestedQuery</a></p>\n\n<p>The data I'm trying to query on looks like this:</p>\n\n<pre><code>                \"_source\": {\n                    \"field1\": \"randVal1\",\n                    \"field2\": \"randVal2\",\n                    \"nestedfield\": {\n                        \"ind1\": \"val1\"\n                    }\n                }\n</code></pre>\n\n<p>I'm trying to run a query on the <code>nestedfield</code> using the <code>NestedQuery</code> call from the Elastic Go library like so:</p>\n\n<pre><code>aquery := elastic.NewTermQuery(\"ind1\", \"val1\")\nquery := elastic.NestedQuery(\"nestedfield\", aquery)\n</code></pre>\n\n<p>But I get an error stating:</p>\n\n<blockquote>\n  <p>too many arguments to conversion to NestedQuery</p>\n</blockquote>\n\n<p>I'm trying to retrieve all documents where the <code>ind1</code> of <code>nestedfield</code> is <code>val1</code>. Would appreciate any help in constructing this query.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>I changed it to NewNestedQuery and now it doesn't give that error. However, it is not returning any results, even though that document exists in the index and I am able to query on the non-nested fields.</p>\n\n<p>I tried this:</p>\n\n<pre><code>aquery := elastic.NewTermQuery(\"ind1\", \"val1\")\nquery := elastic.NewNestedQuery(\"nestedfield\", aquery)\n</code></pre>\n\n<p>And this:</p>\n\n<pre><code>query := elastic.NewNestedQuery(\"nestedfield\", elastic.NewMatchQuery(\"nestedfield.ind1\", \"val1\"))\n</code></pre>\n\n<p>But they both give 0 results. Any idea what I'm doing wrong?</p>\n\n<p><strong>EDIT #2</strong></p>\n\n<p>The mapping is:</p>\n\n<pre><code>\"field1\": { \"type\": \"string\" },\n\"field2\": { \"type\": \"string\" },\n\"nestedfield\": {\n                    \"type\": \"nested\"\n                }\n</code></pre>\n\n<p>What eventually worked was this:</p>\n\n<pre><code>query := elastic.NewMatchQuery(\"nestedfield.ind1\", \"val1\")\n</code></pre>\n\n<p>I was able to add additional fields to 'nestedfield' and do queries like:</p>\n\n<pre><code>query := elastic.NewBoolQuery().Filter(elastic.NewMatchQuery(\"nestedfield.ind1\", \"val1\"), elastic.NewMatchQuery(\"nestedfield.ind2\", \"val2\"))\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1506441656, "post_id": 46431017, "comment_id": 79819388, "body": "Clarify what you mean by &quot;does not work&quot;."}, {"owner": {"user_type": "does_not_exist", "display_name": "user99874"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506441713, "post_id": 46431017, "comment_id": 79819429, "body": "fatal error: all goroutines are asleep - deadlock!  goroutine 1 [chan receive]: main.main() \t/tmp/sandbox241190633/main.go:27 +0x2e0"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1506442044, "post_id": 46431017, "comment_id": 79819622, "body": "When you get it working, you can learn how to run benchmarks to see if it&#39;s worth using goroutines. As an opinion, this isn&#39;t really enough number crunching to make much difference. Usually you use goroutines when you are running some code that blocks, such as <code>io</code> from disk or network. The goroutine (possibly the main one) will block waiting for data, wasting time you could be doing something else with the idle CPU. <a href=\"https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go\" rel=\"nofollow noreferrer\">dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go</a>"}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1506442136, "post_id": 46431017, "comment_id": 79819682, "body": "<a href=\"https://play.golang.org/p/zGEQGC9EIy\" rel=\"nofollow noreferrer\">play.golang.org/p/zGEQGC9EIy</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user99874"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1506445684, "post_id": 46431017, "comment_id": 79821624, "body": "@RayfenWindspear Yes I agree that usually it would be IO work that would be concurrency candidates. I&#39;ll check out that Cheney post, thank you."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1506442157, "creation_date": 1506442157, "answer_id": 46431237, "question_id": 46431017, "link": "https://stackoverflow.com/questions/46431017/conceptually-is-the-a-correct-approach-to-using-goroutines-and-whats-wrong-wi/46431237#46431237", "title": "Conceptually, is the a correct approach to using goroutines (and what&#39;s wrong with my code)", "body": "<p>range loops over channels terminate when the channel is closed. Since you never close the channel in your programm, the main goroutine will eventually block forever, trying to receive from c.</p>\n\n<blockquote>\n  <p>Does it make sense to spin up multiple goroutines in a loop for something like calculating a math result?</p>\n</blockquote>\n\n<p>Depends. If you haven't seen it yet, I can recommend Rob Pike's talk <a href=\"https://blog.golang.org/concurrency-is-not-parallelism\" rel=\"nofollow noreferrer\">Concurrency is not parallelism</a>. This may give you some intuition about where it is beneficial, and where it isn't.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user99874"}, "edited": false, "score": 0, "creation_date": 1506445313, "post_id": 46431242, "comment_id": 79821445, "body": "Thanks very much for the code edit and the suggestion to benchmark."}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 4, "last_activity_date": 1506444418, "last_edit_date": 1506444418, "creation_date": 1506442180, "answer_id": 46431242, "question_id": 46431017, "link": "https://stackoverflow.com/questions/46431017/conceptually-is-the-a-correct-approach-to-using-goroutines-and-whats-wrong-wi/46431242#46431242", "title": "Conceptually, is the a correct approach to using goroutines (and what&#39;s wrong with my code)", "body": "<p>a) Yes it can make sense to spin up multiple go routines to do CPU bound tasks, if you have multiple CPU's.  Also it's super important to profile your code to see if there is actually any benefit.  You could use go's built in <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\">benchmark</a> framework to help do this.</p>\n\n<p>Because you're limited by CPU it could be a good start to do synchronously, then to bound your goroutines to the number of CPU cores instead of the # of items in your input list, but really it should be metrics driven to see.  Go provides amazing toolchain using benchmarks and <a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">pprof</a> to empirically determine what is the most efficient approach :)</p>\n\n<p>b) <a href=\"https://play.golang.org/p/zGEQGC9EIy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zGEQGC9EIy</a> Your channel never closes and your main thread never end.  The example waits until all go routines finish their work, then closes the channel.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user99874"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "accepted_answer_id": 46431242, "answer_count": 2, "score": 0, "last_activity_date": 1506444418, "creation_date": 1506441470, "question_id": 46431017, "link": "https://stackoverflow.com/questions/46431017/conceptually-is-the-a-correct-approach-to-using-goroutines-and-whats-wrong-wi", "title": "Conceptually, is the a correct approach to using goroutines (and what&#39;s wrong with my code)", "body": "<p>I have two question:</p>\n\n<p>a) Does it make sense to spin up multiple goroutines in a loop for something like calculating a math result?</p>\n\n<p>b) Why doesn't my code work (this is my first attempt at goroutines)? I'm guessing it has something to do with closing the channel.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"sync\"\n)\n\nfunc main() {\n    input := [][]int{\n        []int{10, 9},\n        []int{5, 2},\n        []int{4, 9},\n    }\n\n    var wg sync.WaitGroup\n    c := make(chan int)\n    for _, val := range input {\n        wg.Add(1)\n        go func(coordinates []int, c chan int) {\n            defer wg.Done()\n            c &lt;- calculateDistance(coordinates[0], coordinates[1])\n        }(val, c)\n    }\n    distances := []int{}\n\n    for val := range c {\n        distances = append(distances, val)\n    }\n    wg.Wait()\n    fmt.Println(distances)\n}\n\nfunc calculateDistance(x int, y int) int {\n    v := math.Exp2(float64(x)) + math.Exp2(float64(y))\n    distance := math.Sqrt(v)\n    return int(distance)\n}\n</code></pre>\n\n<p>Playground link: <a href=\"https://play.golang.org/p/0iJ9hFnb8R\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0iJ9hFnb8R</a></p>\n"}, {"tags": ["go", "jwt", "jwt-go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1506441634, "post_id": 46430847, "comment_id": 79819368, "body": "I&#39;ve used <code>github.com&#47;dgrijalva&#47;jwt-go</code> in a project and it supports <code>RS512</code>. It looks like many of these libraries verify the hash in their methods, but don&#39;t ever enforce <code>exp</code>. Guess you have to do that yourself. Means I need to fix my own project... <code>jwt-go</code> does say it is <code>exp</code> check compatible though."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1506442857, "post_id": 46430847, "comment_id": 79820089, "body": "<code>jwt-go</code> does verify time based claims. Is there any particular reason you chose <code>jose2go</code>? <a href=\"https://github.com/dgrijalva/jwt-go/blob/24c63f56522a87ec5339cc3567883f1039378fdb/map_claims.go#L70\" rel=\"nofollow noreferrer\">github.com/dgrijalva/jwt-go/blob/&hellip;</a>"}], "owner": {"reputation": 31, "user_id": 7225225, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd567f79f2fc523b19b2eba9e648b569?s=128&d=identicon&r=PG&f=1", "display_name": "Belarophon01", "link": "https://stackoverflow.com/users/7225225/belarophon01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 382, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1588150249, "creation_date": 1506440917, "last_edit_date": 1588150249, "question_id": 46430847, "link": "https://stackoverflow.com/questions/46430847/golang-jwt-rs512-verify", "title": "(Golang) jwt RS512 verify", "body": "<p>We currently implement a scenario where generate a token in node.js javascript with jwt . We use RS512 with certificates for token generation. The token has an expiration limit. Sign and verify work perfect if we use the node.js implementation only.  </p>\n\n<p>In addition we run a golang server where we want to use the same token for access control. Means the golang implementation has just to do the token verification. We tried a number of golang libs, recommended on jwt.io. None of them was able to handle a valid token in the expected manner so far. Or they do not support exp or they do not support RS512. The furthest we got was hitting a  \"crypto/rsa: verification error\" when using </p>\n\n<p>github.com/dvsekhvalnov/jose2go </p>\n\n<pre><code>payload, headers, err := jose.Decode(token,sharedKey)\n</code></pre>\n\n<p>Any are ideas welcome.</p>\n"}, {"tags": ["docker", "logging", "go", "io", "stream"], "answers": [{"comments": [{"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "edited": false, "score": 1, "creation_date": 1506436052, "post_id": 46428872, "comment_id": 79815416, "body": "Ohh I was aimlessly stripping off the metadata and thought I could just read until \\n... I&#39;ll give it a try, thanks!"}, {"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "edited": false, "score": 0, "creation_date": 1506436940, "post_id": 46428872, "comment_id": 79816017, "body": "Unfortunately it&#39;s just hanging at <code>i.Read(hdr)</code> - are there any settings I must put in the container.Config when I create it?"}, {"owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "edited": false, "score": 1, "creation_date": 1506437274, "post_id": 46428872, "comment_id": 79816286, "body": "Side note: If I <code>docker attach</code> and <code>CTRL+C</code> in another terminal, it suddenly outputs everything... it seems to have just locked up while waiting for output but as soon as the inner app ends, it flushes!"}, {"owner": {"reputation": 363, "user_id": 392753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a587f4914e137b7c8c9e655abba964?s=128&d=identicon&r=PG", "display_name": "Francesco Pasa", "link": "https://stackoverflow.com/users/392753/francesco-pasa"}, "edited": false, "score": 0, "creation_date": 1612805927, "post_id": 46428872, "comment_id": 116876087, "body": "Well, the docs do not say anything about the metadata... Here, I found an explaination: <a href=\"https://ahmet.im/blog/docker-logs-api-binary-format-explained/\" rel=\"nofollow noreferrer\">ahmet.im/blog/docker-logs-api-binary-format-explained</a>"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 363, "user_id": 392753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a587f4914e137b7c8c9e655abba964?s=128&d=identicon&r=PG", "display_name": "Francesco Pasa", "link": "https://stackoverflow.com/users/392753/francesco-pasa"}, "edited": false, "score": 0, "creation_date": 1612998596, "post_id": 46428872, "comment_id": 116944545, "body": "@FrancescoPasa thanks, looks like the go docs have gotten less explicit over the last 3 years."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 7, "last_activity_date": 1506435325, "creation_date": 1506435325, "answer_id": 46428872, "question_id": 46428721, "link": "https://stackoverflow.com/questions/46428721/how-to-stream-docker-container-logs-via-the-go-sdk/46428872#46428872", "title": "How to stream Docker container logs via the Go SDK", "body": "<p>Have you read <a href=\"https://godoc.org/github.com/moby/moby/client#Client.ContainerLogs\" rel=\"noreferrer\">the docs?</a> The stream has metadata embedded, so you can't quite just pipe it to the console.</p>\n\n<p>I have the following code in a monitoring application:</p>\n\n<pre><code>    i, err := cli.ContainerLogs(context.Background(), cid, types.ContainerLogsOptions{\n        ShowStderr: true,\n        ShowStdout: true,\n        Timestamps: false,\n        Follow:     true,\n        Tail:       \"40\",\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n    hdr := make([]byte, 8)\n    for {\n        _, err := i.Read(hdr)\n        if err != nil {\n            log.Fatal(err)\n        }\n        var w io.Writer\n        switch hdr[0] {\n        case 1:\n            w = os.Stdout\n        default:\n            w = os.Stderr\n        }\n        count := binary.BigEndian.Uint32(hdr[4:])\n        dat := make([]byte, count)\n        _, err = i.Read(dat)\n        fmt.Fprint(w, string(dat))\n    }\n</code></pre>\n\n<p>It streams as long as I keep it running. There is also <a href=\"https://godoc.org/github.com/moby/moby/pkg/stdcopy\" rel=\"noreferrer\">this helper package</a> to do most of that for you, but in my case I need to handle the messages individually like this for other reasons.</p>\n"}, {"comments": [{"owner": {"reputation": 76, "user_id": 9485283, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BbSoi.jpg?s=128&g=1", "display_name": "itsjwala", "link": "https://stackoverflow.com/users/9485283/itsjwala"}, "edited": false, "score": 0, "creation_date": 1594482564, "post_id": 46430260, "comment_id": 111144444, "body": "what worked for me was having the <code>Follow</code> option in container logs function"}], "tags": [], "owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "is_accepted": false, "score": 2, "last_activity_date": 1506439067, "creation_date": 1506439067, "answer_id": 46430260, "question_id": 46428721, "link": "https://stackoverflow.com/questions/46428721/how-to-stream-docker-container-logs-via-the-go-sdk/46430260#46430260", "title": "How to stream Docker container logs via the Go SDK", "body": "<p>Okay, I managed to resolve this and I'm not sure why captncraig's answer didn't work which I'm still curious about but hey, here's my solution:</p>\n\n<p>I had to set some other options in my <code>ContainerCreate</code> call:</p>\n\n<pre><code>        Tty:          true,\n        AttachStdout: true,\n        AttachStderr: true,\n</code></pre>\n\n<p>Then the <code>scanner.Scan()</code> method worked perfectly!</p>\n\n<p>Here is the updated code: <a href=\"https://github.com/Southclaws/sampctl/blob/1ad7971d817031bd5a5b3acfad3bf2ea69232c98/run_container.go#L56-L70\" rel=\"nofollow noreferrer\">https://github.com/Southclaws/sampctl/blob/1ad7971d817031bd5a5b3acfad3bf2ea69232c98/run_container.go#L56-L70</a></p>\n"}], "owner": {"reputation": 890, "user_id": 2112745, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d3f340e0052daa3370eca099e80d2181?s=128&d=identicon&r=PG", "display_name": "Southclaws", "link": "https://stackoverflow.com/users/2112745/southclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2585, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1506439100, "creation_date": 1506434948, "last_edit_date": 1506439100, "question_id": 46428721, "link": "https://stackoverflow.com/questions/46428721/how-to-stream-docker-container-logs-via-the-go-sdk", "title": "How to stream Docker container logs via the Go SDK", "body": "<p>I'm writing a tool for some game server software in Go called <a href=\"https://github.com/Southclaws/sampctl\" rel=\"nofollow noreferrer\">sampctl</a> and the primary function is to spin up a Docker container for a server instance and then capture the logs coming out of the container, clean them up a bit and send them to a location of the users choice such as Elasticsearch or an administration panel for later analysis.</p>\n\n<p>I've got everything else working, the only thing I can't seem to get to work is <em>streaming</em> logs. I can <em>get</em> logs if the application in the container crashes but I want to stream the logs in realtime.</p>\n\n<p>I've tried using a scanner with the <code>ContainerLogs</code> returned <code>ReadCloser</code> but that just hung at the terminal.</p>\n\n<p><a href=\"https://github.com/Southclaws/sampctl/blob/9c76b4dd1b3dbb9e18927da10028d5beeb94f728/run_container.go#L64-L67\" rel=\"nofollow noreferrer\">https://github.com/Southclaws/sampctl/blob/9c76b4dd1b3dbb9e18927da10028d5beeb94f728/run_container.go#L64-L67</a></p>\n\n<p>Does <code>ContainerLogs</code> even support streaming? Or will I need to figure out another solution...</p>\n\n<p>Apologies if this is more of a Go question than a Docker question, I wasn't too sure whether or not to post here or on GoLangBridge...</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1506432234, "post_id": 46427723, "comment_id": 79812498, "body": "Or you can use 2 structs, one with &quot;public&quot; info and another, &quot;full&quot; version which embeds the public and adds the &quot;private&quot; info such as password. And when viewing, only send / serialize the embedded, public struct. For an example see related question: <a href=\"https://stackoverflow.com/questions/31981592/assign-struct-with-another-struct/31981736#31981736\">Assign struct with another struct</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1506432461, "post_id": 46427723, "comment_id": 79812675, "body": "Oh, that&#39;s probably the closest you can get to &quot;elegant&quot;, especially now that you can convert identical structs with different tags. I would still label it under &quot;custom marshaler&quot;, but it&#39;s simpler than a <code>JSONMarshaler</code> implementation."}, {"owner": {"reputation": 4124, "user_id": 2828480, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/30ce285bfd170cf3834d9591fab207e0?s=128&d=identicon&r=PG&f=1", "display_name": "Konrad", "link": "https://stackoverflow.com/users/2828480/konrad"}, "edited": false, "score": 0, "creation_date": 1543753086, "post_id": 46427723, "comment_id": 94023728, "body": "In C# and Java you&#39;d use DTO pattern"}], "answers": [{"tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": false, "score": 5, "last_activity_date": 1506451348, "last_edit_date": 1506451348, "creation_date": 1506432481, "answer_id": 46427881, "question_id": 46427723, "link": "https://stackoverflow.com/questions/46427723/golang-elegant-way-to-omit-a-json-property-from-being-serialized/46427881#46427881", "title": "golang - elegant way to omit a json property from being serialized", "body": "<p>A simple solution would be to sanitize the user struct before marshaling it:</p>\n\n<pre><code>type User struct {\n    UID          string `json:\"uid\"  binding:\"required\"`\n    Password     string `json:\"password,omitempty\" binding:\"required\"`\n    EmailAddress string `json:\"email\" binding:\"required\"`\n}\n\nfunc sanitizeUser(u User) User {\n    return User{u.UID, \"\", u.EmailAddress}\n}\n</code></pre>\n\n<p>Demo: <a href=\"https://play.golang.org/p/RjKVoFc9o8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RjKVoFc9o8</a></p>\n"}, {"comments": [{"owner": {"reputation": 497, "user_id": 1334174, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5b912fe96966d18e2c703c84671d32ea?s=128&d=identicon&r=PG", "display_name": "ystark", "link": "https://stackoverflow.com/users/1334174/ystark"}, "edited": false, "score": 0, "creation_date": 1506623491, "post_id": 46428950, "comment_id": 79907181, "body": "I guess, you&#39;re right. There&#39;s no going around it. I tried different ways, but in terms of elegance, there&#39;s only this."}, {"owner": {"reputation": 863, "user_id": 821624, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/536173c832510de35c444aa7aae169e3?s=128&d=identicon&r=PG", "display_name": "snowdream", "link": "https://stackoverflow.com/users/821624/snowdream"}, "edited": false, "score": 0, "creation_date": 1601831038, "post_id": 46428950, "comment_id": 113521501, "body": "If i use xml or yaml\uff0cI want custom marshaling, What can i do\uff1f"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 9, "last_activity_date": 1506435534, "creation_date": 1506435534, "answer_id": 46428950, "question_id": 46427723, "link": "https://stackoverflow.com/questions/46427723/golang-elegant-way-to-omit-a-json-property-from-being-serialized/46428950#46428950", "title": "golang - elegant way to omit a json property from being serialized", "body": "<p>I'd say implementing json.Marshaler is the elegant solution if you want custom marshaling. It's quite simple in this case:</p>\n\n<pre><code>func (u User) MarshalJSON() ([]byte, error) {\n    type user User // prevent recursion\n    x := user(u)\n    x.Password = \"\"\n    return json.Marshal(x)\n}\n</code></pre>\n\n<p>Add \"omitempty\" in your User type if you don't want the password field at all when marshaling.</p>\n"}, {"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506436866, "post_id": 46428991, "comment_id": 79815952, "body": "This is a good point. To parse the password in a json document you can simply unmarshal twice. Once into your user struct (which doesn&#39;t have the password field), and then again into another struct that has only the password field. If that makes sense."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1506435627, "creation_date": 1506435627, "answer_id": 46428991, "question_id": 46427723, "link": "https://stackoverflow.com/questions/46427723/golang-elegant-way-to-omit-a-json-property-from-being-serialized/46428991#46428991", "title": "golang - elegant way to omit a json property from being serialized", "body": "<blockquote>\n  <p>Now I want to be able to use this struct to register a user and update, delete but also to view.</p>\n</blockquote>\n\n<p>Another solution is not to store the password at all in the struct. You don't need it to view, or delete, or update (normally). </p>\n\n<p>You need it to create the user record, at which point you'll store a hash in your data store. </p>\n\n<p>You need it to verify their identity (on login), at which point you verify against the hash in your data store, then usually issue a token they can use to keep accessing the service. </p>\n\n<p>So there are only a few points you need it, and at those points you can simply keep it in memory separately and verify identity, it doesn't need to be exposed or stored in the struct for most operations. This is IMO more elegant than having it in the struct where it can very easily be exposed by mistake in export or logging. </p>\n"}, {"tags": [], "owner": {"reputation": 529, "user_id": 1061579, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e80a2c0170d152133bfd5f691b5e2ccf?s=128&d=identicon&r=PG", "display_name": "R3v4n", "link": "https://stackoverflow.com/users/1061579/r3v4n"}, "is_accepted": false, "score": 6, "last_activity_date": 1506448696, "last_edit_date": 1506448696, "creation_date": 1506440198, "answer_id": 46430622, "question_id": 46427723, "link": "https://stackoverflow.com/questions/46427723/golang-elegant-way-to-omit-a-json-property-from-being-serialized/46430622#46430622", "title": "golang - elegant way to omit a json property from being serialized", "body": "<p>I would go with another struct and composition.</p>\n\n<p>Password should never be stored in plain-text, they should be securely hashed (bcrypt, pbkdf2, etc.). That hash is the one that has to be stored and should never be serialized. By using composition, you can do something like this:</p>\n\n<pre><code>type User struct {\n    UID string `json:\"uid\"  binding:\"required\"`\n    HashedPassword string `json:\"-\"`\n    EmailAddress string `json:\"email\" binding:\"required\"`\n}\n\ntype UserFormData struct {\n   User\n   Password string `json:\"password\" binding:\"required\"`\n}\n</code></pre>\n\n<p>This also gives you more flexibility. For instance, if you ask the user to confirm the password, you can simply change the UserFormData struct like this:</p>\n\n<pre><code>type UserFormData struct {\n   User\n   Password string `json:\"password\" binding:\"required\"`\n   ConfirmPassword string `json:\"confirm_password\" binding:\"required\"`\n}\n</code></pre>\n\n<p>Which also has the advantage to keep that serialization details outside your User object.</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 4323824, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uNRig.jpg?s=128&g=1", "display_name": "Binod Kafle", "link": "https://stackoverflow.com/users/4323824/binod-kafle"}, "is_accepted": false, "score": 0, "last_activity_date": 1589825157, "last_edit_date": 1589825157, "creation_date": 1589818429, "answer_id": 61874078, "question_id": 46427723, "link": "https://stackoverflow.com/questions/46427723/golang-elegant-way-to-omit-a-json-property-from-being-serialized/61874078#61874078", "title": "golang - elegant way to omit a json property from being serialized", "body": "<p>You can query the database with a select statement to get only fields you like.</p>\n\n<pre><code>db.Model(&amp;User{}).Select([]string{\"uid\",\"email\"}).Find(&amp;users)\n</code></pre>\n\n<p>Also add <code>omitempty</code> in your User type since empty response is sent for fields not included in select.</p>\n"}], "owner": {"reputation": 497, "user_id": 1334174, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5b912fe96966d18e2c703c84671d32ea?s=128&d=identicon&r=PG", "display_name": "ystark", "link": "https://stackoverflow.com/users/1334174/ystark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5908, "favorite_count": 1, "accepted_answer_id": 46428950, "answer_count": 5, "score": 4, "last_activity_date": 1589825157, "creation_date": 1506432010, "last_edit_date": 1506442236, "question_id": 46427723, "link": "https://stackoverflow.com/questions/46427723/golang-elegant-way-to-omit-a-json-property-from-being-serialized", "title": "golang - elegant way to omit a json property from being serialized", "body": "<p>I've got a user struct, which has sensitive fields like password:</p>\n\n<pre><code>type User struct {\n    UID string `json:\"uid\"  binding:\"required\"`\n    Password string `json:\"password\" binding:\"required\"`\n    EmailAddress string `json:\"email\" binding:\"required\"`\n}\n</code></pre>\n\n<p>Now I want to be able to use this struct to register a user and update, delete but also to view. What I don't want is for the password to be serialized for viewing. I can, of course, make a custom marshaller but is that the only way? I tried using the <code>json:\"-\"</code> option but that causes it to be ignored while unmarshalling as well, which I don't want. Is there a better way?</p>\n\n<p><strong>EDIT:</strong>\nTo put some of you guys at ease, I'm NOT going to be storing the password in plaintext, of course. It's the bcrypt hash of the password, but still. I don't want it to be returned when I search for users. </p>\n"}, {"tags": ["go", "tensorflow"], "comments": [{"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506432700, "post_id": 46427606, "comment_id": 79812877, "body": "Please edit your question adding <b>code</b>"}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506676521, "post_id": 46427606, "comment_id": 79925631, "body": "Why you have to reload the model every 15 minuts? Can&#39;t you just let it loaded in memory and use it when it&#39;s needed?"}, {"owner": {"reputation": 1, "user_id": 1469232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/992fea10230b615b0b373cd727f0baf8?s=128&d=identicon&r=PG", "display_name": "zingler", "link": "https://stackoverflow.com/users/1469232/zingler"}, "reply_to_user": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506695716, "post_id": 46427606, "comment_id": 79936646, "body": "The model is being continuously trained. And we need to be able to use the latest model as and when its available. Thats why this hack. This is our first attempt at trying tensorflow in the production environment so we might be making rookie mistakes. Since the time I asked the question, we have also explored tensorflow-serve which seems best suited for the task at hand."}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1507026816, "post_id": 46427606, "comment_id": 80039032, "body": "I guess the way to go is to train the model and export it every time the training finish, using a different tag. Then from Go check if the currently loaded model has a different tag and in that case, load it in memory. I guess. What&#39;s your actual solution instead?"}, {"owner": {"reputation": 1, "user_id": 1469232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/992fea10230b615b0b373cd727f0baf8?s=128&d=identicon&r=PG", "display_name": "zingler", "link": "https://stackoverflow.com/users/1469232/zingler"}, "reply_to_user": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1507549291, "post_id": 46427606, "comment_id": 80240140, "body": "Apologies for the delayed response. As I mentioned in my earlier comment, we have moved to tensorflow-serve. It manages the lifecycle of the model, loading the new model once it is available on the local file system and unloading the old model once the new one is available. The only problem that we were facing was with the loading/unloading of the model. Hence this has been working perfectly fine with us and also using less memory/storage."}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1507551272, "post_id": 46427606, "comment_id": 80241338, "body": "Thank you for your answer"}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1506452902, "last_edit_date": 1506452902, "creation_date": 1506440249, "answer_id": 46430636, "question_id": 46427606, "link": "https://stackoverflow.com/questions/46427606/reload-tensorflow-model-in-golang-app-server/46430636#46430636", "title": "Reload tensorflow model in Golang app server", "body": "<p>Presumably destroyTFModel takes a long time. You could try this:</p>\n\n<pre><code>old := TensorModel\n\nModelLoadMutex.Lock()\nTensorModel = new\nModelLoadMutex.Unlock()\n\ngo destroyTFModel(old)\n</code></pre>\n\n<p>So destroy after assign and/or try destroying on another goroutine if it needs to clean up resources and somehow takes a long time blocking this response. I'd look into what you're doing in destroyTFModel and why it is slow though, does it make network requests to the db or involve the file system? Are you sure there isn't another lock external to your app you're not aware of (for example if it had to open a file and locked it for reads while destroying this model?).</p>\n\n<p>Instead of using if err == nil { around it, consider returning on error. </p>\n"}], "owner": {"reputation": 1, "user_id": 1469232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/992fea10230b615b0b373cd727f0baf8?s=128&d=identicon&r=PG", "display_name": "zingler", "link": "https://stackoverflow.com/users/1469232/zingler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 254, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506452902, "creation_date": 1506431691, "last_edit_date": 1506433719, "question_id": 46427606, "link": "https://stackoverflow.com/questions/46427606/reload-tensorflow-model-in-golang-app-server", "title": "Reload tensorflow model in Golang app server", "body": "<p>I have a Golang app server wherein I keep reloading a saved tensorflow model every 15 minutes. Every api call that uses the tensorflow model, takes a read mutex lock and whenever I reload the model, I take a write lock. Functionality wise, this works fine but during the model load, my API response time increases as the request threads keep waiting for the write lock to be released. Could you please suggest a better approach to keep the loaded model up to date? </p>\n\n<p><strong>Edit, Code updated</strong></p>\n\n<p>Model Load Code:</p>\n\n<pre><code>    tags := []string{\"serve\"}\n\n    // load from updated saved model\n    var m *tensorflow.SavedModel\n    var err error\n    m, err = tensorflow.LoadSavedModel(\"/path/to/model\", tags, nil)\n    if err != nil {\n        log.Errorf(\"Exception caught while reloading saved model %v\", err)\n        destroyTFModel(m)\n    }\n\n    if err == nil {\n        ModelLoadMutex.Lock()\n        defer ModelLoadMutex.Unlock()\n\n        // destroy existing model\n        destroyTFModel(TensorModel)\n        TensorModel = m\n    }\n</code></pre>\n\n<p>Model Use Code(Part of the API request):</p>\n\n<pre><code>    config.ModelLoadMutex.RLock()\n    defer config.ModelLoadMutex.RUnlock()\n\n    scoreTensorList, err = TensorModel.Session.Run(map[tensorflow.Output]*tensorflow.Tensor{\n        UserOp.Output(0): uT,\n        DataOp.Output(0): nT},\n        []tensorflow.Output{config.SumOp.Output(0)},\n        nil,\n    )\n</code></pre>\n"}, {"tags": ["go", "ssh-keys"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506430876, "post_id": 46426718, "comment_id": 79811507, "body": "There is no single fingerprint for a public key. Fingerprints are just hashes of the public key and you are free to choose any hash algorithm. The Go standard library already has public key implementations for popular key types in the respective crypto/* packages. I doubt you have to implement your own."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 6, "last_activity_date": 1506438538, "creation_date": 1506438538, "answer_id": 46430102, "question_id": 46426718, "link": "https://stackoverflow.com/questions/46426718/go-how-to-generate-an-ssh-publickey-fingerprint-from-publickey-the-publickey/46430102#46430102", "title": "Go - How to Generate an SSH PublicKey Fingerprint from PublicKey, the PublicKey&#39;s type maybe is one of [ rsa dsa ssh-rsa ssh-dss ecdsa ]", "body": "<p>You probably want to use ssh.ParseAuthorizedKey from the ssh package to load the key: </p>\n\n<p><a href=\"https://godoc.org/golang.org/x/crypto/ssh#ParseAuthorizedKey\" rel=\"noreferrer\">https://godoc.org/golang.org/x/crypto/ssh#ParseAuthorizedKey</a></p>\n\n<p>That will give you a public key which you can call ssh.FingerprintLegacyMD5 on in order to get the fingerprint (assuming here you want the md5). </p>\n\n<p><a href=\"https://godoc.org/golang.org/x/crypto/ssh#FingerprintLegacyMD5\" rel=\"noreferrer\">https://godoc.org/golang.org/x/crypto/ssh#FingerprintLegacyMD5</a>\n<a href=\"https://godoc.org/golang.org/x/crypto/ssh#FingerprintSHA256\" rel=\"noreferrer\">https://godoc.org/golang.org/x/crypto/ssh#FingerprintSHA256</a></p>\n\n<pre><code>func main() {\n    // Read a key from a file in authorized keys file line format\n    // This could be an rsa.pub file or a line from authorized_keys\n    pubKeyBytes := []byte(`ssh-rsa AAAABMYKEY...ABC me@myplace.local`)\n\n    // Parse the key, other info ignored\n    pk, _, _, _, err := ssh.ParseAuthorizedKey(pubKeyBytes)\n    if err != nil {\n        panic(err)\n    }\n\n    // Get the fingerprint\n    f := ssh.FingerprintLegacyMD5(pk)\n\n    // Print the fingerprint\n    fmt.Printf(\"%s\\n\", f)\n}\n</code></pre>\n\n<p>There are two fingerprint functions provided, not sure which one you need. </p>\n"}], "owner": {"reputation": 147, "user_id": 6211801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ODZ83.jpg?s=128&g=1", "display_name": "fishu", "link": "https://stackoverflow.com/users/6211801/fishu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1385, "favorite_count": 0, "accepted_answer_id": 46430102, "answer_count": 1, "score": 5, "last_activity_date": 1506438538, "creation_date": 1506429204, "question_id": 46426718, "link": "https://stackoverflow.com/questions/46426718/go-how-to-generate-an-ssh-publickey-fingerprint-from-publickey-the-publickey", "title": "Go - How to Generate an SSH PublicKey Fingerprint from PublicKey, the PublicKey&#39;s type maybe is one of [ rsa dsa ssh-rsa ssh-dss ecdsa ]", "body": "<p>I only have a PublicKey string, How do I get the PublicKey Fingerprint?\nI have got some idea form <a href=\"https://go-review.googlesource.com/c/crypto/+/32814\" rel=\"noreferrer\">https://go-review.googlesource.com/c/crypto/+/32814</a>, but I do not know how to<br>\nimplement ssh.PublicKey interface.</p>\n"}, {"tags": ["go", "aerospike"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1506423406, "creation_date": 1506423406, "answer_id": 46424557, "question_id": 46424345, "link": "https://stackoverflow.com/questions/46424345/golang-client-to-perform-operations-on-cdt-list-in-aerospike/46424557#46424557", "title": "Golang client to perform operations on cdt list in aerospike", "body": "<p>Don't expect examples to provide full documentation. Use <a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go\" rel=\"nofollow noreferrer\">the documentation</a> for that.</p>\n"}, {"tags": [], "owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "is_accepted": false, "score": 2, "last_activity_date": 1506481159, "creation_date": 1506481159, "answer_id": 46438806, "question_id": 46424345, "link": "https://stackoverflow.com/questions/46424345/golang-client-to-perform-operations-on-cdt-list-in-aerospike/46438806#46438806", "title": "Golang client to perform operations on cdt list in aerospike", "body": "<p>Thanks to Flimzy for pointing the documentation. Maybe for future users who come accross this question, the following might help.</p>\n\n<p>To perform a list operation, you need to use the following method and specify the operation:</p>\n\n<p><a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go#Client.Operate\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/aerospike/aerospike-client-go#Client.Operate</a></p>\n\n<p>The Operate method takes an operation and to get an operation the List*Op methods are used (such as <a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go#ListAppendOp\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/aerospike/aerospike-client-go#ListAppendOp</a>)</p>\n"}], "owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1506481159, "creation_date": 1506422738, "question_id": 46424345, "link": "https://stackoverflow.com/questions/46424345/golang-client-to-perform-operations-on-cdt-list-in-aerospike", "title": "Golang client to perform operations on cdt list in aerospike", "body": "<p>I wanted to use a list as a bin value in aerospike. So, <a href=\"http://www.aerospike.com/docs/guide/cdt-list.html\" rel=\"nofollow noreferrer\">http://www.aerospike.com/docs/guide/cdt-list.html</a> seems like a good option. But the client examples in golang <a href=\"https://github.com/aerospike/aerospike-client-go/blob/master/examples/list_map.go\" rel=\"nofollow noreferrer\">https://github.com/aerospike/aerospike-client-go/blob/master/examples/list_map.go</a> only shows a get and a put.</p>\n\n<pre><code>key, _ := as.NewKey(*shared.Namespace, *shared.Set, \"listkey1\")\nclient.Delete(shared.WritePolicy, key)\n\nlist := []string{\"string1\", \"string2\", \"string3\"}\n\nbin := as.NewBin(\"listbin1\", list)\nclient.PutBins(shared.WritePolicy, key, bin)\n\nrecord, err := client.Get(shared.Policy, key, bin.Name)\nshared.PanicOnError(err)\nreceivedList := record.Bins[bin.Name].([]interface{})\n\nvalidateSize(3, len(receivedList))\nvalidate(\"string1\", receivedList[0])\nvalidate(\"string2\", receivedList[1])\nvalidate(\"string3\", receivedList[2])\n</code></pre>\n\n<p>What about all other APIs mentioned ? Such as how do I append to the list or get count of objects in the list etc. ? Any reference to any documentation would be appreciated.</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["xml", "go", "rss"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1506422047, "last_edit_date": 1506422047, "creation_date": 1506421260, "answer_id": 46423792, "question_id": 46423540, "link": "https://stackoverflow.com/questions/46423540/xml-unmarshal-getting-tripped-up-by-parallel-tag/46423792#46423792", "title": "XML Unmarshal getting tripped up by parallel tag", "body": "<p>This is a long-standing <a href=\"https://github.com/golang/go/issues/11735\" rel=\"nofollow noreferrer\">documentation bug</a> in Go's <code>encoding/xml</code> package. Basically, when you don't specify a namespace, the field will match <em>any</em> namespace instead of <em>no</em> namespace. In fact, there is no way to make a field match <em>only</em> when there is no namespace. If your XML has a namespace, the solution is to explicitly set it:</p>\n\n<pre><code>&lt;item xmlns=\"foo\"&gt;\n  &lt;link&gt;https://www.nytimes.com/2017/09/25/briefing/nfl-angela-merkel-iraqi-kurdistan.html?partner=rss&amp;amp;emc=rss&lt;/link&gt;\n  &lt;atom:link rel=\"standout\" href=\"https://www.nytimes.com/2017/09/25/briefing/nfl-angela-merkel-iraqi-kurdistan.html?partner=rss&amp;amp;emc=rss\"/&gt;\n  &lt;pubDate&gt;Mon, 25 Sep 2017 13:36:07 GMT&lt;/pubDate&gt;\n&lt;/item&gt;\n\ntype item struct {\n    Link    string `xml:\"foo link\"`\n    PubDate string `xml:\"pubDate\"`\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/L9WOhixTKa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/L9WOhixTKa</a>.</p>\n\n<p>If your <code>link</code> element explicitly <em>doesn't</em> have a namespace, you'll probably have to roll out your own <code>UnmarshalXML</code> method.</p>\n"}], "owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 46423792, "answer_count": 1, "score": 2, "last_activity_date": 1506422047, "creation_date": 1506420484, "question_id": 46423540, "link": "https://stackoverflow.com/questions/46423540/xml-unmarshal-getting-tripped-up-by-parallel-tag", "title": "XML Unmarshal getting tripped up by parallel tag", "body": "<p>I'm working on an RSS reader application and running into an issue with The New York Times RSS feed. I've narrowed the issue down to the following XML (unnecessary fields omitted):</p>\n\n<pre><code>&lt;item&gt;\n  &lt;link&gt;https://www.nytimes.com/2017/09/25/briefing/nfl-angela-merkel-iraqi-kurdistan.html?partner=rss&amp;amp;emc=rss&lt;/link&gt;\n  &lt;atom:link rel=\"standout\" href=\"https://www.nytimes.com/2017/09/25/briefing/nfl-angela-merkel-iraqi-kurdistan.html?partner=rss&amp;amp;emc=rss\"/&gt;\n  &lt;pubDate&gt;Mon, 25 Sep 2017 13:36:07 GMT&lt;/pubDate&gt;\n&lt;/item&gt;\n</code></pre>\n\n<p>I'm trying to parse it into the following structure:</p>\n\n<pre><code>type item struct {\n    Link    string `xml:\"link\"`\n    PubDate string `xml:\"pubDate\"`\n}\n</code></pre>\n\n<p>When parsed, the Link field is blank. However, by deleting the atom:link field it works fine. I think the similarity in the tags names is confusing the parser. I have a go playground that demonstrates the issue, and that removing that line fixes it: <a href=\"https://play.golang.org/p/fUbLhSbo5K\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fUbLhSbo5K</a>\nHow can I work around this issue? It's not really feasible to special case it because there could be other feeds that do this too.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1506420261, "post_id": 46423385, "comment_id": 79804060, "body": "Related / possible duplicate of <a href=\"https://stackoverflow.com/questions/32818472/do-we-need-to-close-the-response-object-if-an-error-occurs-while-calling-http-ge/32819910#32819910\">Do we need to close the response object if an error occurs while calling http.Get(url)?</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1506420330, "post_id": 46423385, "comment_id": 79804114, "body": "1. Yes as stated by the doc. But if err!=nil you can ignore the body. 2. No. see the doc you cited."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506431399, "post_id": 46423385, "comment_id": 79811898, "body": "That is only part of the stack trace, what error are you actually getting? What version of Go are you using? The stack trace doesn&#39;t look like it&#39;s from a recent release."}, {"owner": {"reputation": 1887, "user_id": 671997, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6a608586ba99dba0717b9928e020bb04?s=128&d=identicon&r=PG", "display_name": "dev_mush", "link": "https://stackoverflow.com/users/671997/dev-mush"}, "edited": false, "score": 0, "creation_date": 1506435720, "post_id": 46423385, "comment_id": 79815171, "body": "it&#39;s 1.8, I might have found the issue and it has nothing to do with the http client, it might be a concurrent map write that must be synced, the panic is not handled and every goroutine gets printed after the <code>fatal error: concurrent map read and map write</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506435921, "post_id": 46423385, "comment_id": 79815323, "body": "@dev_mush: that&#39;s not a panic that can be handled, it&#39;s a fatal error because you have a data race (and you should update your Go version, there have been some security fixes in the 1.8 cycle since then, and go1.9 has been out for a while)"}, {"owner": {"reputation": 1887, "user_id": 671997, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6a608586ba99dba0717b9928e020bb04?s=128&d=identicon&r=PG", "display_name": "dev_mush", "link": "https://stackoverflow.com/users/671997/dev-mush"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506436121, "post_id": 46423385, "comment_id": 79815477, "body": "@JimB right! thanks a lot for this, I didn&#39;t know it couldn&#39;t be handled and will look into it right away, and will obviously proceed to synchronise the access to the map! (and update go version on the server)"}], "answers": [{"comments": [{"owner": {"reputation": 1887, "user_id": 671997, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6a608586ba99dba0717b9928e020bb04?s=128&d=identicon&r=PG", "display_name": "dev_mush", "link": "https://stackoverflow.com/users/671997/dev-mush"}, "edited": false, "score": 0, "creation_date": 1506434880, "post_id": 46424619, "comment_id": 79814557, "body": "so in this case anyway the body gets closed, which means that my problem can&#39;t be related to bodies not closed by the defer..."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1506435986, "last_edit_date": 1506435986, "creation_date": 1506423586, "answer_id": 46424619, "question_id": 46423385, "link": "https://stackoverflow.com/questions/46423385/when-using-go-http-client-do-method-can-the-httpresponse-and-the-error-be-not-n/46424619#46424619", "title": "When using go http client Do method, can the httpResponse and the error be not nil at the same time?", "body": "<p>Yes, they can both be non-nil in one situation, apparently. From <a href=\"https://golang.org/src/net/http/client.go?s=16518:16570#L588\" rel=\"nofollow noreferrer\">the source</a>, we see:</p>\n\n<pre><code>        if err != nil {\n            // Special case for Go 1 compatibility: return both the response\n            // and an error if the CheckRedirect function failed.\n            // See https://golang.org/issue/3795\n            // The resp.Body has already been closed.\n            ue := uerr(err)\n            ue.(*url.Error).URL = loc\n            return resp, ue\n        }\n</code></pre>\n\n<p>Every other return is returning either a response and nil err, or a nil response and non-nil error.<br>\nSo for the questions above:   </p>\n\n<ol>\n<li>Yes</li>\n<li>Can't happen, for the only case in which both a body and an error are non-nil, the body has already been closed</li>\n</ol>\n"}], "owner": {"reputation": 1887, "user_id": 671997, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6a608586ba99dba0717b9928e020bb04?s=128&d=identicon&r=PG", "display_name": "dev_mush", "link": "https://stackoverflow.com/users/671997/dev-mush"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1261, "favorite_count": 0, "accepted_answer_id": 46424619, "answer_count": 1, "score": 0, "last_activity_date": 1506435986, "creation_date": 1506420100, "last_edit_date": 1506435930, "question_id": 46423385, "link": "https://stackoverflow.com/questions/46423385/when-using-go-http-client-do-method-can-the-httpresponse-and-the-error-be-not-n", "title": "When using go http client Do method, can the httpResponse and the error be not nil at the same time?", "body": "<p>As visible in the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">official documentation</a> as well as <em>almost</em> everywhere else online, the common pattern for handling http client errors is the following:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"http://example.com\", nil)\nreq.Header.Add(\"If-None-Match\", `W/\"wyzzy\"`)\nresp, err := client.Do(req)\nif err != nil {\n    // handle error\n}\ndefer resp.Body.Close()\n</code></pre>\n\n<p>Reading the docs about the methods on the http client, I'm not able to understand if it is possible to receive both <code>resp</code> and <code>err</code> <strong>not</strong> nil, it seems like it's possible if we consider what is written in the Do method documentation:</p>\n\n<blockquote>\n  <p>The request Body, if non-nil, will be closed by the underlying\n  Transport, even on errors.</p>\n  \n  <p>On error, any Response can be ignored. A non-nil Response with a\n  non-nil error only occurs when CheckRedirect fails, and even then the\n  returned Response.Body is already closed.</p>\n</blockquote>\n\n<p>Therefore my questions are the following:   </p>\n\n<ol>\n<li>Is it possible to receive non-nil <code>resp</code> <strong>and</strong> <code>err</code> at the same time?</li>\n<li>If it is possible, and in my program I end up receiving a lot of errors, and I <code>return</code> or <code>panic</code> in the <code>//handle error</code> piece of the code shown above, thus never reaching the defer right after, is it possible that on the long run I end up having too many open bodies that the transport hasn't been able to close?</li>\n</ol>\n\n<p><strong>Context Addendum</strong> : </p>\n\n<p>The problem I encounter is that, after a while, the program crashes with the following big print of goroutines on the stdErr, and following the trace I end up to a piece of code that seems normal, unless something bad happens if an error is encountered and there's a responseBody upon which no defer close will be made, but since the official docs say not to worry about it, the problem must be elsewhere...</p>\n\n<pre><code>Stderr logs\n  Display timestamps\n net/http.(*persistConn).readLoop(0xc4244e0240)\n    /usr/local/go/src/net/http/transport.go:1474 +0x196\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 194055 [select, 2 minutes]:\nnet/http.(*persistConn).readLoop(0xc42421ec60)\n    /usr/local/go/src/net/http/transport.go:1599 +0x9ec\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 215944 [IO wait]:\nnet.runtime_pollWait(0x7f63736f0628, 0x72, 0x21b)\n    /usr/local/go/src/runtime/netpoll.go:164 +0x59\nnet.(*pollDesc).wait(0xc420963568, 0x72, 0xa85c40, 0xa81350)\n    /usr/local/go/src/net/fd_poll_runtime.go:75 +0x38\nnet.(*pollDesc).waitRead(0xc420963568, 0xc422289000, 0x1000)\n    /usr/local/go/src/net/fd_poll_runtime.go:80 +0x34\nnet.(*netFD).Read(0xc420963500, 0xc422289000, 0x1000, 0x1000, 0x0, 0xa85c40, 0xa81350)\n    /usr/local/go/src/net/fd_unix.go:250 +0x1b7\nnet.(*conn).Read(0xc42025bbb8, 0xc422289000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:181 +0x70\nnet/http.(*persistConn).Read(0xc4217af8c0, 0xc422289000, 0x1000, 0x1000, 0xc420b33400, 0x8b61a3, 0xc423dd6b80)\n    /usr/local/go/src/net/http/transport.go:1316 +0x14b\nbufio.(*Reader).fill(0xc421af0060)\n    /usr/local/go/src/bufio/bufio.go:97 +0x117\nbufio.(*Reader).Peek(0xc421af0060, 0x1, 0xc421af01e0, 0xc420536c80, 0xc420b17e00, 0x60, 0xc420536c60)\n    /usr/local/go/src/bufio/bufio.go:129 +0x67\nnet/http.(*persistConn).readLoop(0xc4217af8c0)\n    /usr/local/go/src/net/http/transport.go:1474 +0x196\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 199855 [select, 1 minutes]:\nnet/http.(*persistConn).writeLoop(0xc421db1320)\n    /usr/local/go/src/net/http/transport.go:1704 +0x43a\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1118 +0xa5a\n\ngoroutine 198707 [select, 1 minutes]:\nnet/http.(*persistConn).readLoop(0xc4236ea000)\n    /usr/local/go/src/net/http/transport.go:1599 +0x9ec\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 192577 [select, 2 minutes]:\nnet/http.(*persistConn).readLoop(0xc424a8fc20)\n    /usr/local/go/src/net/http/transport.go:1599 +0x9ec\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 213681 [select]:\nnet/http.(*persistConn).writeLoop(0xc42455e6c0)\n    /usr/local/go/src/net/http/transport.go:1704 +0x43a\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1118 +0xa5a\n\ngoroutine 190222 [select, 2 minutes]:\nnet/http.(*persistConn).writeLoop(0xc4238617a0)\n    /usr/local/go/src/net/http/transport.go:1704 +0x43a\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1118 +0xa5a\n\ngoroutine 208970 [select, 1 minutes]:\nnet/http.(*persistConn).writeLoop(0xc4234530e0)\n    /usr/local/go/src/net/http/transport.go:1704 +0x43a\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1118 +0xa5a\n\ngoroutine 219699 [select]:\nnet/http.(*persistConn).writeLoop(0xc42155cb40)\n    /usr/local/go/src/net/http/transport.go:1704 +0x43a\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1118 +0xa5a\n\ngoroutine 221664 [select]:\nnet/http.setRequestCancel.func3(0x0, 0xc4231af680, 0xc423657000, 0xc4214aeecc, 0xc422f926c0)\n    /usr/local/go/src/net/http/client.go:320 +0x17c\ncreated by net/http.setRequestCancel\n    /usr/local/go/src/net/http/client.go:330 +0x287\n\ngoroutine 220550 [select]:\nnet/http.(*persistConn).readLoop(0xc4218f0c60)\n    /usr/local/go/src/net/http/transport.go:1599 +0x9ec\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 216169 [IO wait]:\nnet.runtime_pollWait(0x7f6373700fb0, 0x72, 0x221)\n    /usr/local/go/src/runtime/netpoll.go:164 +0x59\nnet.(*pollDesc).wait(0xc4212fdb18, 0x72, 0xa85c40, 0xa81350)\n    /usr/local/go/src/net/fd_poll_runtime.go:75 +0x38\nnet.(*pollDesc).waitRead(0xc4212fdb18, 0xc42393c000, 0x1000)\n    /usr/local/go/src/net/fd_poll_runtime.go:80 +0x34\nnet.(*netFD).Read(0xc4212fdab0, 0xc42393c000, 0x1000, 0x1000, 0x0, 0xa85c40, 0xa81350)\n    /usr/local/go/src/net/fd_unix.go:250 +0x1b7\nnet.(*conn).Read(0xc42300aa38, 0xc42393c000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:181 +0x70\nnet/http.(*persistConn).Read(0xc422102c60, 0xc42393c000, 0x1000, 0x1000, 0xc423d30820, 0xc42002a800, 0xc424422b80)\n    /usr/local/go/src/net/http/transport.go:1316 +0x14b\nbufio.(*Reader).fill(0xc4220598c0)\n    /usr/local/go/src/bufio/bufio.go:97 +0x117\nbufio.(*Reader).Peek(0xc4220598c0, 0x1, 0xc422059a40, 0xc420535c80, 0xc422059700, 0x60, 0xc420535c60)\n    /usr/local/go/src/bufio/bufio.go:129 +0x67\nnet/http.(*persistConn).readLoop(0xc422102c60)\n    /usr/local/go/src/net/http/transport.go:1474 +0x196\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 213706 [select]:\nnet/http.(*persistConn).writeLoop(0xc42321d200)\n    /usr/local/go/src/net/http/transport.go:1704 +0x43a\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1118 +0xa5a\n\ngoroutine 214335 [select]:\nnet/http.(*persistConn).writeLoop(0xc4230d7560)\n    /usr/local/go/src/net/http/transport.go:1704 +0x43a\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1118 +0xa5a\n\ngoroutine 221651 [IO wait]:\nnet.runtime_pollWait(0x7f63736eff38, 0x72, 0x254)\n    /usr/local/go/src/runtime/netpoll.go:164 +0x59\nnet.(*pollDesc).wait(0xc422449b18, 0x72, 0xa85c40, 0xa81350)\n    /usr/local/go/src/net/fd_poll_runtime.go:75 +0x38\nnet.(*pollDesc).waitRead(0xc422449b18, 0xc423d93000, 0x1000)\n    /usr/local/go/src/net/fd_poll_runtime.go:80 +0x34\nnet.(*netFD).Read(0xc422449ab0, 0xc423d93000, 0x1000, 0x1000, 0x0, 0xa85c40, 0xa81350)\n    /usr/local/go/src/net/fd_unix.go:250 +0x1b7\nnet.(*conn).Read(0xc421eb21b8, 0xc423d93000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:181 +0x70\nnet/http.(*persistConn).Read(0xc422e5b440, 0xc423d93000, 0x1000, 0x1000, 0x8cc888, 0x0, 0xc42347bb80)\n    /usr/local/go/src/net/http/transport.go:1316 +0x14b\nbufio.(*Reader).fill(0xc422f2c960)\n    /usr/local/go/src/bufio/bufio.go:97 +0x117\nbufio.(*Reader).Peek(0xc422f2c960, 0x1, 0xc422f2d6e0, 0xc420b8ec80, 0xc42180ff00, 0x60, 0xc420b8ec60)\n    /usr/local/go/src/bufio/bufio.go:129 +0x67\nnet/http.(*persistConn).readLoop(0xc422e5b440)\n    /usr/local/go/src/net/http/transport.go:1474 +0x196\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 221670 [IO wait]:\nnet.runtime_pollWait(0x7f63736ff7b0, 0x72, 0x259)\n    /usr/local/go/src/runtime/netpoll.go:164 +0x59\nnet.(*pollDesc).wait(0xc422449b88, 0x72, 0xa85c40, 0xa81350)\n    /usr/local/go/src/net/fd_poll_runtime.go:75 +0x38\nnet.(*pollDesc).waitRead(0xc422449b88, 0xc423f28000, 0x1000)\n    /usr/local/go/src/net/fd_poll_runtime.go:80 +0x34\nnet.(*netFD).Read(0xc422449b20, 0xc423f28000, 0x1000, 0x1000, 0x0, 0xa85c40, 0xa81350)\n    /usr/local/go/src/net/fd_unix.go:250 +0x1b7\nnet.(*conn).Read(0xc423eac3c8, 0xc423f28000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:181 +0x70\nnet/http.(*persistConn).Read(0xc4235930e0, 0xc423f28000, 0x1000, 0x1000, 0xa82dc0, 0xc42000e0b0, 0xc423be7b80)\n    /usr/local/go/src/net/http/transport.go:1316 +0x14b\nbufio.(*Reader).fill(0xc422bb70e0)\n    /usr/local/go/src/bufio/bufio.go:97 +0x117\nbufio.(*Reader).Peek(0xc422bb70e0, 0x1, 0xc422bb7320, 0xc424191480, 0xc4237a4820, 0x0, 0xc422ac9138)\n    /usr/local/go/src/bufio/bufio.go:129 +0x67\nnet/http.(*persistConn).readLoop(0xc4235930e0)\n    /usr/local/go/src/net/http/transport.go:1474 +0x196\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 213543 [select]:\nnet/http.(*persistConn).readLoop(0xc424795c20)\n    /usr/local/go/src/net/http/transport.go:1599 +0x9ec\ncreated by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:1117 +0xa35\n\ngoroutine 220529 [select]:\nnet/http.(*persistConn).roundTrip(0xc4215fd680, 0xc4212c5c80, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:1898 +0x974\nnet/http.(*Transport).RoundTrip(0xc420847b30, 0xc421248800, 0xc420847b30, 0xed15b2cf4, 0x16cd81f7)\n    /usr/local/go/src/net/http/transport.go:391 +0x74c\nnet/http.send(0xc421248700, 0xa84080, 0xc420847b30, 0xed15b2cf4, 0x16cd81f7, 0xab7060, 0x0, 0x8, 0xc4213a2a80, 0x40f258)\n    /usr/local/go/src/net/http/client.go:249 +0x162\nnet/http.(*Client).send(0xc42075ed20, 0xc421248700, 0xed15b2cf4, 0x16cd81f7, 0xab7060, 0xc4213a2a80, 0x0, 0x1, 0x4084fe)\n    /usr/local/go/src/net/http/client.go:173 +0x108\nnet/http.(*Client).Do(0xc42075ed20, 0xc421248700, 0xa, 0x8b359b, 0x5)\n    /usr/local/go/src/net/http/client.go:595 +0x254\ngithub.com/myCompanyName/gojsonrpc.(*Client).sendJsonRequest(0xc42078c6e0, 0xc4215fd320, 0xbb, 0x11a, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /home/ubuntu/go/src/github.com/myCompanyName/gojsonrpc/client.go:45 +0x2f2\ngithub.com/myCompanyName/gojsonrpc.(*Client).Run(0xc42078c6e0, 0x8be6b2, 0x1d, 0x838780, 0xc420789ce0, 0x7fb2e0, 0xc4212c5b40, 0x1, 0xe)\n    /home/ubuntu/go/src/github.com/myCompanyName/gojsonrpc/client.go:72 +0x219\ngithub.com/myCompanyName/app/connectors/vendor.(*Connector).ReadStatus(0xc42078aa30, 0xc4212c5a60, 0xd, 0xc4212c5a6e, 0x7, 0xc4212c59c0, 0x1d, 0x0, 0x0, 0x0, ...)\n    /home/ubuntu/go/src/github.com/myCompanyName/app/connectors/vendor/tickets.go:52 +0x386\ngithub.com/myCompanyName/app/obscuredPkgName/connabslayer.(*ConnAbsLayer).ReadMetrics(0xc42075ac40, 0xc4212c5a60, 0x15, 0xc4212c59c0, 0x1d, 0xc42121eb30, 0xf)\n    /home/ubuntu/go/src/github.com/myCompanyName/app/obscuredPkgName/connabslayer/connector_abstraction_layer.go:145 +0xdc\ngithub.com/myCompanyName/app/obscuredPkgName/updater/plugins.(*UpdaterPlugin).SyncPluggedData(0xc42078c820, 0xc4208b9ef0, 0x28, 0xf)\n    /home/ubuntu/go/src/github.com/myCompanyName/app/obscuredPkgName/updater/plugins/vendor_plugin.go:69 +0x1e1\ngithub.com/myCompanyName/app/obscuredPkgName/updater.(*Updater).syncData.func1(0xc420763a00, 0xc4208b9ef0, 0x28, 0xc4201824f0, 0xf)\n    /home/ubuntu/go/src/github.com/myCompanyName/app/obscuredPkgName/updater/updater.go:127 +0xf6\ncreated by github.com/myCompanyName/app/obscuredPkgName/updater.(*Updater).syncData\n    /home/ubuntu/go/src/github.com/myCompanyName/app/obscuredPkgName/updater/updater.go:131 +0x17b\n\n// AND SO ON\n</code></pre>\n\n<p><strong>Solution</strong>:</p>\n\n<p>The problem was elsewhere, as visible in the comments below, but the question might be useful for somebody else asking the same.</p>\n"}, {"tags": ["go", "transactions"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 2, "creation_date": 1506415622, "post_id": 46421602, "comment_id": 79800741, "body": "Looks like a mistake. As you say you wouldn&#39;t want to rollback unless an error occurred. Also the log.Fatalf you wouldn&#39;t want in a real app. I suggest use the improve this page button and contact the author."}, {"owner": {"reputation": 1464, "user_id": 936269, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/1fac3223b59eb3774aef86f7684f7f5f?s=128&d=identicon&r=PG", "display_name": "Lars Nielsen", "link": "https://stackoverflow.com/users/936269/lars-nielsen"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 1, "creation_date": 1506417590, "post_id": 46421602, "comment_id": 79802176, "body": "Thank you for your answer :)"}, {"owner": {"reputation": 6303, "user_id": 4680436, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/yAD2X.jpg?s=128&g=1", "display_name": "aristotll", "link": "https://stackoverflow.com/users/4680436/aristotll"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1567757150, "post_id": 46421602, "comment_id": 102066662, "body": "@KennyGrant Thumb up for improving this misleading example."}, {"owner": {"reputation": 404, "user_id": 5716089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tqyYO.png?s=128&g=1", "display_name": "Kelly Flet", "link": "https://stackoverflow.com/users/5716089/kelly-flet"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 1, "creation_date": 1587661776, "post_id": 46421602, "comment_id": 108606130, "body": "@KennyGrant Using <code>defer tx.Rollback()</code> after beginning a transaction can be nice to avoid putting rollback logic for every other error during the lifespan of the transaction. Note that if the transaction is already committed, calling rollback will perform a <code>NOP</code>. That being said, with verbosity comes more control, so if speed is a concern, handling every rollback rather than using <code>defer</code> may be preferable (or for verbose logging, etc)."}], "answers": [{"comments": [{"owner": {"reputation": 1464, "user_id": 936269, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/1fac3223b59eb3774aef86f7684f7f5f?s=128&d=identicon&r=PG", "display_name": "Lars Nielsen", "link": "https://stackoverflow.com/users/936269/lars-nielsen"}, "edited": false, "score": 0, "creation_date": 1506417628, "post_id": 46421989, "comment_id": 79802196, "body": "Yeah I knew about the log.Fatal part :) Thank you very much for your answer"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 5, "last_activity_date": 1506416311, "creation_date": 1506416311, "answer_id": 46421989, "question_id": 46421602, "link": "https://stackoverflow.com/questions/46421602/why-defer-a-rollback/46421989#46421989", "title": "Why defer a Rollback?", "body": "<p>The example is a little bit misleading. It uses <code>log.Fatal(err)</code> for error handling. You wouldn't normally do that, and instead <code>return err</code>. So the deferred rollback is there to ensure that the transaction is rolled back in case of an early return.</p>\n"}, {"tags": [], "owner": {"reputation": 534, "user_id": 3315593, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aZlbv.png?s=128&g=1", "display_name": "Tomor", "link": "https://stackoverflow.com/users/3315593/tomor"}, "is_accepted": false, "score": 16, "last_activity_date": 1592911169, "creation_date": 1592911169, "answer_id": 62533516, "question_id": 46421602, "link": "https://stackoverflow.com/questions/46421602/why-defer-a-rollback/62533516#62533516", "title": "Why defer a Rollback?", "body": "<p>The important thing is that if you <strong>defer</strong> <code>tx.Rollback()</code> you are sure that it will be called even if you do an early return and the &quot;trick&quot; is that calling <code>tx.Rollback()</code> on a committed transaction will not actually do the rollback, because once a transaction is committed, it's committed and there is no way to roll it back :)\nSo this is a neat trick on how to keep the code simple.</p>\n"}], "owner": {"reputation": 1464, "user_id": 936269, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/1fac3223b59eb3774aef86f7684f7f5f?s=128&d=identicon&r=PG", "display_name": "Lars Nielsen", "link": "https://stackoverflow.com/users/936269/lars-nielsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3356, "favorite_count": 1, "accepted_answer_id": 46421989, "answer_count": 2, "score": 10, "last_activity_date": 1592911169, "creation_date": 1506415153, "question_id": 46421602, "link": "https://stackoverflow.com/questions/46421602/why-defer-a-rollback", "title": "Why defer a Rollback?", "body": "<p>I have started using Go for a web-service and have some database interaction (surprise!!!) and I have found this example: </p>\n\n<pre><code>tx, err := db.Begin()\nif err != nil {\n    log.Fatal(err)\n}\ndefer tx.Rollback()\nstmt, err := tx.Prepare(\"INSERT INTO foo VALUES (?)\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer stmt.Close() // danger!\nfor i := 0; i &lt; 10; i++ {\n    _, err = stmt.Exec(i)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\nerr = tx.Commit()\nif err != nil {\n    log.Fatal(err)\n}\n// stmt.Close() runs here!\n</code></pre>\n\n<p>From <a href=\"http://go-database-sql.org/prepared.html\" rel=\"noreferrer\">http://go-database-sql.org/prepared.html</a></p>\n\n<p>The example is well formulated an easy to understand. However, it leaves me with an unanswered question. Why <code>defer</code> the transaction Rollback call? </p>\n\n<p>Why not just do the following: </p>\n\n<pre><code>err := tx.Commit()\n\nif err != nil {\n    log.Error(err)\n    tx.Rollback()\n}\n</code></pre>\n\n<p>Would <code>defer tx.Rollback()</code> not always attempt a rollback? Even if <code>tx.Commit()</code> was a success, or have I misunderstood something about <code>defer</code>?</p>\n"}, {"tags": ["mongodb", "join", "go"], "comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506415594, "post_id": 46421549, "comment_id": 79800724, "body": "Are you asking how to add another <code>$match</code> stage to the pipeline?"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506415744, "post_id": 46421549, "comment_id": 79800826, "body": "You can say that. But do I need to match the another conditions within the same join query ? Isn&#39;t there any way to separately manage that conditions (apart from join) ?"}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506416048, "post_id": 46421549, "comment_id": 79801071, "body": "So do you &quot;<i>need to send another conditions with join query</i>&quot; and &quot;<i>perform these two things together</i>&quot; or not?"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506416382, "post_id": 46421549, "comment_id": 79801274, "body": "yes I want these two things together. But I am asking Do I need to add another match stage as u said ? Or Is there another way to perform the queries together ?"}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506417430, "post_id": 46421549, "comment_id": 79802054, "body": "Ah, I see, so you still need 2 numbers in the result returned by a single query, don&#39;t you? If so, it is quite an unusual requirement. Why do you need it?"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506419443, "post_id": 46421549, "comment_id": 79803477, "body": "No, I want a single count by performing all queries. I want a common rating count in which I can apply a join to match rating&#39;s &quot;booking_id&quot; with booking&#39;s &quot;_id&quot; on the basis of &quot;location_id&quot; and a condition to get ratings for a particular time period."}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506420796, "post_id": 46421549, "comment_id": 79804414, "body": "So it is an extra <code>$match</code>, I don&#39;t really get your comment about &quot;<i>separately managed conditions</i>&quot;. If you need to count documents that match several filters, either add an extra <code>$match</code> stage or combine it with the existing one."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506421543, "post_id": 46421549, "comment_id": 79804970, "body": "Okay let me know your answer with all filters within one join operation"}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506421812, "post_id": 46421549, "comment_id": 79805163, "body": "Mind trying it yourself first? It should be fairly straightforward, but if there any problems with that, I&#39;d be happy to help."}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1506422635, "post_id": 46421549, "comment_id": 79805677, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/155321/discussion-between-amandeep-kaur-and-alex-blex\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "is_accepted": false, "score": 0, "last_activity_date": 1506570709, "creation_date": 1506570709, "answer_id": 46460686, "question_id": 46421549, "link": "https://stackoverflow.com/questions/46421549/perform-join-on-two-collections-on-id-basis-in-mongodb/46460686#46460686", "title": "Perform Join on Two Collections on ID basis in MongoDB", "body": "<p>I found the answer to my question. Here is the complex JOIN operatin on two different collection to get the single count of Ratings:</p>\n\n<pre><code>getCollection := mongoSession.DB(\"example_db\").C(\"ratings\")\n    pipe := getCollection.Pipe([]bson.M{ \n                                        bson.M{\"$lookup\": bson.M{\n                                                            \"localField\"    : \"booking_id\",\n                                                            \"from\"          : \"bookings\",\n                                                            \"foreignField\"  : \"_id\",\n                                                            \"as\"            : \"data\" }},\n                                        bson.M{\"$unwind\": \"$data\"},\n                                        bson.M{\"$match\": bson.M{\"location_id\": 1, \"industry_id\": 2, \"proivder_id\": 10, \"rating\": 4.5, \"rating_date\": bson.M{ \"$gte\": startDate, \"$lte\": endDate}}},\n                                        bson.M{\"$group\": bson.M{\n                                                            \"_id\": \"null\", \n                                                            \"count\": bson.M{\"$sum\": 1} } } } )\n    err = pipe.One(&amp;result) \n</code></pre>\n\n<p>In this way I get the count of ratings by joining two collections together along with different queries.</p>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 335, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506570709, "creation_date": 1506414969, "question_id": 46421549, "link": "https://stackoverflow.com/questions/46421549/perform-join-on-two-collections-on-id-basis-in-mongodb", "title": "Perform Join on Two Collections on ID basis in MongoDB", "body": "<p>I have two collections: ratings and bookings.</p>\n\n<p>In bookings collection I have a field \"_id\" which is normal document id. I am also saving a field \"location_id\" in bookings collection. In ratings collection I am referencing id of the booking as \"booking_id\" field. </p>\n\n<p><strong>Query1:</strong></p>\n\n<p>I want to get count of ratings on the basis of \"location_id\" which means first I need to get bookings on the basis of location_id, then I need to find the ratings for that bookings (that has location with \"location_id\"). </p>\n\n<p>For this I have performed MongoDB join by aggregating two collections like this:</p>\n\n<pre><code>    getCollection := mongoSession.DB(config.Database).C(config.RatingsCollection)\n    pipe := getCollection.Pipe([]bson.M{ \n                                        bson.M{\"$match\": bson.M{\"location_id\": 2}},\n                                        bson.M{\"$lookup\": bson.M{\n                                                            \"localField\"    : \"booking_id\",\n                                                            \"from\"          : config.BookingsCollection,\n                                                            \"foreignField\"  : \"_id\"}},\n                                        bson.M{\"$count\": \"ratings_count\"}, })\n    err = pipe.All(&amp;result)\n</code></pre>\n\n<p><strong>Query2:</strong></p>\n\n<p>Also I need to know how can we add more conditions (which are to be applied within the same collection) to our query ??</p>\n\n<p>I need to perform this join operation query as well as some other conditions like in ratings collection I have another field like \"rating_date\" which contains the timestamp value.</p>\n\n<pre><code>condition :=  bson.M{}\ncondition[\"review_date\"] = bson.M{\"$gte\": startDate, \"$lte\": endDate} \nallratingsCount, err := models.GetRatingsCount(condition)\n\nfunc GetRatingsCount(query interface{}) (int, error){\n    count, err := GetRecordsCount(config.RatingsCollection, query)\n    if err != nil{\n        return 0, err\n    }\n    return count, err\n}\n</code></pre>\n\n<p>Like In code, I need to send another conditions with join query. Can I perform these two things together ?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["string", "go", "slice"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1506421961, "post_id": 46421352, "comment_id": 79805273, "body": "Such a function would rarely be of any use. If they put that in the Standard Library, I&#39;d be forced to switch to PHP."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1506423145, "post_id": 46421352, "comment_id": 79806006, "body": "&quot;I don&#39;t know all the % variables that exist.&quot; The are all documented in the fmt package. No need to know them if you can look them up."}, {"owner": {"reputation": 2505, "user_id": 749521, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/302a64f5f51a7f8dc83c0881f4520eb5?s=128&d=identicon&r=PG", "display_name": "Steven Roose", "link": "https://stackoverflow.com/users/749521/steven-roose"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1506432872, "post_id": 46421352, "comment_id": 79813003, "body": "@Flimzy , well, there is not need for the <code>strings.Join</code> one if you can have a generalized variant that behaves exactly the same when used with strings only."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1506434809, "post_id": 46421352, "comment_id": 79814505, "body": "@StevenRoose: How <code>Join</code> works on a string is plainly defined and obvious. How it works on an <code>interface{}</code> is anything but."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1506414934, "creation_date": 1506414934, "answer_id": 46421535, "question_id": 46421352, "link": "https://stackoverflow.com/questions/46421352/how-to-join-a-slice-interface-into-a-string/46421535#46421535", "title": "How to join a slice []interface{} into a string?", "body": "<blockquote>\n  <p>Is there an stdlib equivalent of this method?</p>\n</blockquote>\n\n<p>No there is not.</p>\n"}, {"comments": [{"owner": {"reputation": 5426, "user_id": 4887423, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yW2L2.jpg?s=128&g=1", "display_name": "Willie Cheng", "link": "https://stackoverflow.com/users/4887423/willie-cheng"}, "edited": false, "score": 1, "creation_date": 1561770278, "post_id": 56805601, "comment_id": 100182750, "body": "Code only answers are considered low-quality posts. Please add some explanation for your code"}], "tags": [], "owner": {"reputation": 21, "user_id": 11713136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c0e3ef9a01cf38cd0463927a399d48e9?s=128&d=identicon&r=PG&f=1", "display_name": "Divyaraj", "link": "https://stackoverflow.com/users/11713136/divyaraj"}, "is_accepted": false, "score": 0, "last_activity_date": 1563364795, "last_edit_date": 1563364795, "creation_date": 1561719019, "answer_id": 56805601, "question_id": 46421352, "link": "https://stackoverflow.com/questions/46421352/how-to-join-a-slice-interface-into-a-string/56805601#56805601", "title": "How to join a slice []interface{} into a string?", "body": "<pre><code>func StrConvert(a ...interface{}) string {\n    str := \"\"\n\n    for index := 0; index &lt; len(a); index++ {\n        str1 := fmt.Sprintf(\"%v\", a[index])\n        str += \" \" + str1\n    }\n    return str\n}\n</code></pre>\n\n<p>you can pass []interface to above function and it will return a string as a response.</p>\n"}], "owner": {"reputation": 2505, "user_id": 749521, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/302a64f5f51a7f8dc83c0881f4520eb5?s=128&d=identicon&r=PG", "display_name": "Steven Roose", "link": "https://stackoverflow.com/users/749521/steven-roose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1126, "favorite_count": 0, "accepted_answer_id": 46421535, "answer_count": 2, "score": -4, "last_activity_date": 1563364795, "creation_date": 1506414270, "last_edit_date": 1506421905, "question_id": 46421352, "link": "https://stackoverflow.com/questions/46421352/how-to-join-a-slice-interface-into-a-string", "title": "How to join a slice []interface{} into a string?", "body": "<p>Is there a stdlib equivalent of this method?</p>\n\n<pre><code>func Join(sep string, values ...interface{}) string {\n    strs := make([]string, len(values))\n    for i, v := range values {\n        strs[i] = fmt.Sprintf(\"%s\", v)\n    }\n    return strings.Join(strs, sep)\n}\n</code></pre>\n\n<p>The <a href=\"https://godoc.org/strings\" rel=\"nofollow noreferrer\"><code>strings</code></a> package has a <code>Join</code> method, but it only joins a string slice.  I feel like the fmt package could have something like this, I don't know all the % variables that exist.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 2, "last_activity_date": 1506411802, "creation_date": 1506411802, "answer_id": 46420520, "question_id": 46420331, "link": "https://stackoverflow.com/questions/46420331/not-able-to-store-in-datastore-gcloud/46420520#46420520", "title": "Not able to store in datastore gcloud", "body": "<p>Update your handlers to use a context derived from app's handler request instead of <code>context.Background()</code></p>\n\n<pre><code>func saveData(w http.ResponseWriter, r *http.Request){\n    // ..\n    fmt.Println(input)\n\n    ctx := appengine.NewContext(r)\n    projectID := \"api-project-426361742627\"\n    // ...\n}\n</code></pre>\n\n<p>Remember that context can be used as an opaque value container as well and app engine environment makes heavy use of this feature.</p>\n\n<p>Package <a href=\"https://cloud.google.com/appengine/docs/standard/go/reference#NewContext\" rel=\"nofollow noreferrer\">appengine docs</a>.</p>\n"}], "owner": {"reputation": 330, "user_id": 3704776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xW0H6.jpg?s=128&g=1", "display_name": "Aditya Varma", "link": "https://stackoverflow.com/users/3704776/aditya-varma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 46420520, "answer_count": 1, "score": 0, "last_activity_date": 1506411802, "creation_date": 1506411250, "question_id": 46420331, "link": "https://stackoverflow.com/questions/46420331/not-able-to-store-in-datastore-gcloud", "title": "Not able to store in datastore gcloud", "body": "<p>I am learning golang and google app engine datastore. </p>\n\n<p>I am planning on making a simple rest api call to save and retrieve data from the datastore.</p>\n\n<p>I followed few hello world tutorials and the official get started guide. In the end what I came up with is this.</p>\n\n<p>`</p>\n\n<pre><code>package hello\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"net/http\"\n        \"encoding/json\"\n        \"cloud.google.com/go/datastore\"\n        \"golang.org/x/net/context\"\n        \"github.com/gorilla/mux\"\n        \"time\"\n)\ntype Task struct {\n        Description    string    `datastore:\"description\"`\n        Created time.Time `datastore:\"created\"`\n        id      int64\n}\nfunc saveData(w http.ResponseWriter, r *http.Request){\n        fmt.Println(\"Endpoint Hit: saveData\")\n        input := r.URL.Query().Get(\"input\")\n        fmt.Println(input)\n\n        ctx := context.Background()\n        projectID := \"api-project-426361742627\"\n        client, err := datastore.NewClient(ctx, projectID)\n        if err != nil {\n                log.Fatalf(\"Failed to create client: %v\", err)\n        }\n        kind := \"Task\"\n        task := Task{\n                Description: input,\n                Created: time.Now(),\n        }\n        taskKey := datastore.IncompleteKey(kind, nil)\n\n        if _, err := client.Put(ctx, taskKey, &amp;task); err != nil {\n                log.Fatalf(\"Failed to save task: %v\", err)\n        }\n\n        fmt.Printf(\"Saved %v: %v\\n\", taskKey, task.Description)\n        json.NewEncoder(w).Encode(task)\n}\nfunc returnAll(w http.ResponseWriter, r *http.Request){\n        fmt.Println(\"Endpoint Hit: returnAll\")\n\n        ctx := context.Background()\n        projectID := \"api-project-426361742627\"\n        client, err := datastore.NewClient(ctx, projectID)\n        if err != nil {\n                log.Fatalf(\"Failed to create client: %v\", err)\n        }\n\n        query := datastore.NewQuery(\"Task\").Order(\"description\")\n\n        var tasks []*Task\n\n        keys, err := client.GetAll(ctx, query, &amp;tasks)\n        for i, key := range keys {\n                tasks[i].id = key.ID\n        }\n        // for _, t := range tasks {\n        //         // fmt.Println( t.id, t.Description)\n        // }\n\n        json.NewEncoder(w).Encode(tasks)\n}\n\nfunc homePage(w http.ResponseWriter, r *http.Request){\n        fmt.Fprintf(w, \"Welcome to the HomePage!\")\n        fmt.Println(\"Endpoint Hit: homePage\")\n}\nfunc handleRequests() {\n        myRouter := mux.NewRouter()\n        myRouter.HandleFunc(\"/\", homePage)\n        myRouter.HandleFunc(\"/save\", saveData)\n        myRouter.HandleFunc(\"/retrieve\", returnAll)\n        http.Handle(\"/\", myRouter)\n}\nfunc init() {\n        handleRequests()\n}\n</code></pre>\n\n<p>`</p>\n\n<p>Now the problem I am facing is at this line </p>\n\n<p><code>\n        client, err := datastore.NewClient(ctx, projectID)\n</code></p>\n\n<p>I am getting the following error. </p>\n\n<pre><code>2017/09/26 07:15:16 http: panic serving 127.0.0.1:59488: not an App Engine context\ngoroutine 17 [running]:\nnet/http.(*conn).serve.func1(0xc82021e000)\n    /home/aditya/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/net/http/server.go:1389 +0xc1\npanic(0xa44740, 0xc82018a8c0)\n    /home/aditya/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/runtime/panic.go:443 +0x4e9\ngoogle.golang.org/appengine/internal.fullyQualifiedAppID(0x7f4142e12be0, 0xc82000b4e0, 0x0, 0x0)\n    /home/aditya/work/src/google.golang.org/appengine/internal/identity_classic.go:54 +0x8b\ngoogle.golang.org/appengine/internal.FullyQualifiedAppID(0x7f4142e12be0, 0xc82000b4e0, 0x0, 0x0)\n    /home/aditya/work/src/google.golang.org/appengine/internal/api_common.go:77 +0xe2\ngoogle.golang.org/appengine/internal.AppID(0x7f4142e12be0, 0xc82000b4e0, 0x0, 0x0)\n    /home/aditya/work/src/google.golang.org/appengine/internal/identity.go:13 +0x37\ngoogle.golang.org/appengine.AppID(0x7f4142e12be0, 0xc82000b4e0, 0x0, 0x0)\n    /home/aditya/work/src/google.golang.org/appengine/identity.go:20 +0x37\ngolang.org/x/oauth2/google.FindDefaultCredentials(0x7f4142e12be0, 0xc82000b4e0, 0xc820222170, 0x1, 0x1, 0xc820222150, 0x0, 0x0)\n    /home/aditya/work/src/golang.org/x/oauth2/google/default.go:92 +0x5a8\ngoogle.golang.org/api/internal.Creds(0x7f4142e12be0, 0xc82000b4e0, 0xc820248240, 0xc8202452c0, 0x0, 0x0)\n    /home/aditya/work/src/google.golang.org/api/internal/creds.go:37 +0x173\ngoogle.golang.org/api/transport/grpc.Dial(0x7f4142e12be0, 0xc82000b4e0, 0xc820245638, 0x3, 0x3, 0x0, 0x0, 0x0)\n    /home/aditya/work/src/google.golang.org/api/transport/grpc/dial.go:47 +0x272\ncloud.google.com/go/datastore.NewClient(0x7f4142e12be0, 0xc82000b4e0, 0xc0c320, 0x18, 0x0, 0x0, 0x0, 0x9, 0x0, 0x0)\n    /home/aditya/work/src/cloud.google.com/go/datastore/datastore.go:87 +0x87f\nmain76346.returnAll(0x7f4142dcb058, 0xc820234000, 0xc82022a000)\n    hello.go:51 +0x1b8\nnet/http.HandlerFunc.ServeHTTP(0xcd13d8, 0x7f4142dcb058, 0xc820234000, 0xc82022a000)\n    /home/aditya/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/net/http/server.go:1618 +0x3a\ngithub.com/gorilla/mux.(*Router).ServeHTTP(0xc820052660, 0x7f4142dcb058, 0xc820234000, 0xc82022a000)\n    /home/aditya/work/src/github.com/gorilla/mux/mux.go:133 +0x37c\nnet/http.(*ServeMux).ServeHTTP(0xc82000eab0, 0x7f4142dcb058, 0xc820234000, 0xc82022a000)\n    /home/aditya/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/net/http/server.go:1910 +0x17d\nappengine_internal.handleFilteredHTTP(0x7f4142dcb058, 0xc820234000, 0xc82022a000)\n    /home/aditya/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/appengine_internal/api_dev.go:102 +0x409\nnet/http.HandlerFunc.ServeHTTP(0xccfe48, 0x7f4142dcb058, 0xc820234000, 0xc82022a000)\n    /home/aditya/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/net/http/server.go:1618 +0x3a\nnet/http.serverHandler.ServeHTTP(0xc820078500, 0x7f4142dcb058, 0xc820234000, 0xc82022a000)\n    /home/aditya/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/net/http/server.go:2081 +0x19e\nnet/http.(*conn).serve(0xc82021e000)\n    /home/aditya/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/net/http/server.go:1472 +0xf2e\ncreated by net/http.(*Server).Serve\n    /home/aditya/google-cloud-sdk/platform/google_appengine/goroot-1.6/src/net/http/server.go:2137 +0x44e\nINFO     2017-09-26 07:15:16,800 module.py:821] default: \"GET /retrieve HTTP/1.1\" 500 3349\n</code></pre>\n\n<p>I am not sure how to go about fixing this issue. I tried using </p>\n\n<pre><code>gcloud auth application-default login \n</code></pre>\n\n<p>to give access to the datastore locally but it is not working. Whenever I try to save the data or return all entries while initializing the datastore new client I am facing this issue. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 620, "user_id": 6838838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/063168f6e5477ad7990330b95331d798?s=128&d=identicon&r=PG&f=1", "display_name": "Girdhar Sojitra", "link": "https://stackoverflow.com/users/6838838/girdhar-sojitra"}, "edited": false, "score": 0, "creation_date": 1506407547, "post_id": 46418977, "comment_id": 79795842, "body": "Put defer db.Close() in your main function."}], "answers": [{"tags": [], "owner": {"reputation": 609, "user_id": 4242336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IlAOL.jpg?s=128&g=1", "display_name": "PapEr", "link": "https://stackoverflow.com/users/4242336/paper"}, "is_accepted": false, "score": 7, "last_activity_date": 1506416502, "last_edit_date": 1506416502, "creation_date": 1506407261, "answer_id": 46419254, "question_id": 46418977, "link": "https://stackoverflow.com/questions/46418977/error-while-sending-data-to-the-database/46419254#46419254", "title": "Error while sending data to the database", "body": "<p><code>defer db.Close()</code> will be executed when <code>InitDataBase()</code> returns, so when you use <code>db</code> in <code>Registration</code>, it causes an error.</p>\n\n<p>You should call <code>db.Close()</code> just before your program exits, or after you are finished working with the database, whichever comes first.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7337776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c44fbc43d2d1b3817ee7cdf8b1471af4?s=128&d=identicon&r=PG&f=1", "display_name": "leadad", "link": "https://stackoverflow.com/users/7337776/leadad"}, "is_accepted": false, "score": 0, "last_activity_date": 1506502714, "creation_date": 1506502714, "answer_id": 46443612, "question_id": 46418977, "link": "https://stackoverflow.com/questions/46418977/error-while-sending-data-to-the-database/46443612#46443612", "title": "Error while sending data to the database", "body": "<p>Thank you all. I found the answer .You need to change  <code>db, err: = sql.Open (\"postgres\", psqlInfo)</code> to <code>db, err= sql.Open (\"postgres\", psqlInfo)</code>.\nThe answer found in this link <a href=\"https://stackoverflow.com/questions/37537156/why-my-db-connection-couldnt-be-accessed-from-handler\">enter link description here</a></p>\n"}], "owner": {"reputation": 11, "user_id": 7337776, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c44fbc43d2d1b3817ee7cdf8b1471af4?s=128&d=identicon&r=PG&f=1", "display_name": "leadad", "link": "https://stackoverflow.com/users/7337776/leadad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1506502714, "creation_date": 1506406185, "last_edit_date": 1506406900, "question_id": 46418977, "link": "https://stackoverflow.com/questions/46418977/error-while-sending-data-to-the-database", "title": "Error while sending data to the database", "body": "<p>I'm trying to transfer data to write them to the database.\nBut I have the error \"panic: runtime error: invalid memory address or nil pointer dereference\"\nIn this function, I wait for the data from the client</p>\n\n<pre><code>func handlePacket(conn net.Conn) {\n    rw := bufio.NewReadWriter(bufio.NewReader(conn), bufio.NewWriter(conn))\n    defer conn.Close()\n\n    packet := model.RegistrationMessage{}\n    client := JsonDecoderMessage(rw).Decode(&amp;packet)\n    if client != nil {\n        puts(\"Error from Decode.Please NO :(\")\n    }\n\n    if packet.MessageType == model.AUTH_MESSAGE {\n        puts(\"Auth\")\n    } else if packet.MessageType == model.REGS_MESSAGE {\n        puts(\"Regs\")\n        Registration(packet.Login, packet.Password)\n        puts(\"good\")\n    }\n}\n</code></pre>\n\n<p>And here I establish connection with a DB and I try to send the data in a DB</p>\n\n<pre><code>var db *sql.DB\n\nfunc InitDataBase() {\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n        \"password=%s dbname=%s sslmode=disable\",\n        host, port, user, password, dbname)\n    db, err := sql.Open(\"postgres\", psqlInfo)\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(\"Successfully connected!\")\n}\nfunc Registration(email, password string) {\n    sqlStatement := `INSERT INTO account0( email,password)\n        VALUES ($1, $2) RETURNING id`\n    id := 0\n    err := db.QueryRow(sqlStatement, email, password).Scan(&amp;id)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1506403180, "creation_date": 1506403180, "answer_id": 46418347, "question_id": 46418242, "link": "https://stackoverflow.com/questions/46418242/go-switch-fallthrough/46418347#46418347", "title": "Go switch fallthrough", "body": "<p>Yes. The fallthrough statement transfers control to the next case clause in an expression switch.  The expression on the next case is not considered when transferring control.</p>\n\n<p>The <a href=\"https://golang.org/ref/spec#Fallthrough_statements\" rel=\"nofollow noreferrer\">specification says this about the fallthrough statement</a>:</p>\n\n<blockquote>\n  <p>A \"fallthrough\" statement transfers control to the first statement of the next case clause in an expression \"switch\" statement. It may be used only as the final non-empty statement in such a clause.</p>\n</blockquote>\n\n<p>and this about <a href=\"https://golang.org/ref/spec#Expression_switches\" rel=\"nofollow noreferrer\">expression switches</a>:</p>\n\n<blockquote>\n  <p>In a case or default clause, the last non-empty statement may be a (possibly labeled) \"fallthrough\" statement to indicate that control should flow from the end of this clause to the first statement of the next clause. Otherwise control flows to the end of the \"switch\" statement. A \"fallthrough\" statement may appear as the last statement of all but the last clause of an expression switch.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": false, "score": 2, "last_activity_date": 1506403203, "creation_date": 1506403203, "answer_id": 46418354, "question_id": 46418242, "link": "https://stackoverflow.com/questions/46418242/go-switch-fallthrough/46418354#46418354", "title": "Go switch fallthrough", "body": "<p>That's right. The <code>fallthrough</code> statement causes it to go from the last statement on a case clause to the first statement of the next skipping the later case evaluation. From the <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <p>In a case or default clause, the last non-empty statement may be a\n  (possibly labeled) \"fallthrough\" statement to indicate that control\n  should flow from the end of this clause to the first statement of the\n  next clause. Otherwise control flows to the end of the \"switch\"\n  statement. A \"fallthrough\" statement may appear as the last statement\n  of all but the last clause of an expression switch.</p>\n</blockquote>\n"}], "owner": {"reputation": 819, "user_id": 5136936, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9c1e18e46f49b880d78f0efcec87ee44?s=128&d=identicon&r=PG&f=1", "display_name": "driftavalii", "link": "https://stackoverflow.com/users/5136936/driftavalii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1469, "favorite_count": 0, "accepted_answer_id": 46418347, "answer_count": 2, "score": 0, "last_activity_date": 1506403203, "creation_date": 1506402706, "question_id": 46418242, "link": "https://stackoverflow.com/questions/46418242/go-switch-fallthrough", "title": "Go switch fallthrough", "body": "<p>I am trying to understand the switch/fallthrough keyword. Using fallthrough statement in a switch block means the next block is entered even if the expression doesn't match but this is only valid when there has already been a match right? The code below seems to work that way but I just want to be sure.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    integer := 5\n    switch integer {\n    case 4:\n        fmt.Println(\"integer &lt;= 4\")\n        fallthrough\n    case 5:\n        fmt.Println(\"integer &lt;= 5\")\n        fallthrough\n    case 6:\n        fmt.Println(\"integer &lt;= 6\")\n        fallthrough\n    case 7:\n        fmt.Println(\"integer &lt;= 7\")\n        fallthrough\n    case 8:\n        fmt.Println(\"integer &lt;= 8\")\n        fallthrough\n    default:\n        fmt.Println(\"default case\")\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "utf-8", "special-characters"], "answers": [{"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1506387988, "post_id": 46416000, "comment_id": 79790425, "body": "The one difference from the question&#39;s code is the &quot;...&quot; when the limit kicks in. I was tempted to strip blacklisted chars from the <i>shortened</i> string, but then you either change the meaning (<code>santitize(&quot;&gt;&gt;&gt;abc&quot;, 3)</code> becomes <code>&quot;...&quot;</code> instead of <code>&quot;abc...&quot;</code>) or have to complicate the code."}, {"owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "edited": false, "score": 0, "creation_date": 1506388677, "post_id": 46416000, "comment_id": 79790560, "body": "Our current logic strips the string first which is why I kept the truncating afterwards"}, {"owner": {"reputation": 2382, "user_id": 6272277, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/522db908ba9addc9a647f5c8a8f8421a?s=128&d=identicon&r=PG&f=1", "display_name": "Lassi", "link": "https://stackoverflow.com/users/6272277/lassi"}, "edited": false, "score": 0, "creation_date": 1544274056, "post_id": 46416000, "comment_id": 94222419, "body": "This answer is great. The only problem is, it doesn&#39;t take Unicode grapheme clusters into account (a grapheme cluster is the combination of a base rune like <code>A</code> and any extra runes that supply things like diacritics on top of it). It might be useful to normalize the string to NFC before truncating it, so that as many characters as possible are converted into their single-rune variants."}, {"owner": {"reputation": 972, "user_id": 1260548, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b2ca990a7888cda2671c3eb1b3161068?s=128&d=identicon&r=PG", "display_name": "Markus Tenghamn", "link": "https://stackoverflow.com/users/1260548/markus-tenghamn"}, "edited": false, "score": 0, "creation_date": 1581425674, "post_id": 46416000, "comment_id": 106421984, "body": "The code above also uses <code>ReplaceAllString</code> but does not use the returned string and the <code>name</code> variable is never updated. So none of the characters in the regex are replaced. The same issue is present in the answer by @Topo"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1581432095, "post_id": 46416000, "comment_id": 106425912, "body": "Good catch, my bad for copy &amp; pasting from the question. Fixed."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 8, "last_activity_date": 1581432081, "last_edit_date": 1581432081, "creation_date": 1506385085, "answer_id": 46416000, "question_id": 46415894, "link": "https://stackoverflow.com/questions/46415894/golang-truncate-strings-with-special-characters-without-corrupting-data/46416000#46416000", "title": "Golang truncate strings with special characters without corrupting data", "body": "<p>Slicing strings treats them as their underlying byte array; the slice operator operates on indexes of bytes, not of runes (which can be multiple bytes each). However, <code>range</code> over a string iterates on runes - but the index returned is of bytes. This makes it fairly straightforward to do what you're looking for (<a href=\"https://play.golang.org/p/rfkfvbLWTM\" rel=\"nofollow noreferrer\">full playground example here</a>):</p>\n\n<pre><code>func SanitizeName(name string, limit int) string {\n    name = reNameBlacklist.ReplaceAllString(name, \"\")\n    result := name\n    chars := 0\n    for i := range name {\n        if chars &gt;= limit {\n            result = name[:i]\n            break\n        }\n        chars++\n    }\n    return result\n}\n</code></pre>\n\n<p>This is explained in further detail <a href=\"https://blog.golang.org/strings#TOC_6.\" rel=\"nofollow noreferrer\">on the Go blog</a></p>\n"}, {"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1506386972, "post_id": 46416046, "comment_id": 79790231, "body": "Adrian&#39;s approach avoids allocating the four bytes per Unicode code point, and does less work when the input string is long, so I&#39;d go with that."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 2, "creation_date": 1506410859, "post_id": 46416046, "comment_id": 79797682, "body": "This is by far the simplest way, but it does have some drawbacks. For short strings however, the drawbacks are a minor issue at worst."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1550744822, "post_id": 46416046, "comment_id": 96385979, "body": "This implementation breaks the string on codepoint boundaries (which is still better than breaking on byte boundaries) but this is not enough to break on character boundaries as a character may be represented by several codepoints."}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1550745526, "post_id": 46416046, "comment_id": 96386413, "body": "One optimization: the cost of conversion to runes can be avoided for short strings whose number of bytes (<code>len</code>) is lower than the limit."}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": false, "score": 3, "last_activity_date": 1506386015, "last_edit_date": 1506386015, "creation_date": 1506385470, "answer_id": 46416046, "question_id": 46415894, "link": "https://stackoverflow.com/questions/46415894/golang-truncate-strings-with-special-characters-without-corrupting-data/46416046#46416046", "title": "Golang truncate strings with special characters without corrupting data", "body": "<p>The reason your data is getting corrupted is because some characters use more than one byte and you are splitting them. To avoid this Go has type <code>rune</code> which represents a UTF-8 character. You can just cast the string to a <code>[]rune</code> like this:</p>\n\n<pre><code>func SanitizeName(name string, limit int) string{   \n    reNameBlacklist.ReplaceAllString(name, \"\")\n    result := []rune(name)\n    // Remove the special chars here\n    return string(result[:limit])\n}\n</code></pre>\n\n<p>This should only leave the first <em>limit</em> UTF-8 characters.</p>\n"}], "owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4218, "favorite_count": 1, "accepted_answer_id": 46416000, "answer_count": 2, "score": 7, "last_activity_date": 1581432081, "creation_date": 1506384287, "last_edit_date": 1506415067, "question_id": 46415894, "link": "https://stackoverflow.com/questions/46415894/golang-truncate-strings-with-special-characters-without-corrupting-data", "title": "Golang truncate strings with special characters without corrupting data", "body": "<p>I am trying to write a function to truncate strings with special characters in golang. One example is below</p>\n\n<p><code>\"H\u3400\u303e\u2593\u6717\ud42d\ud15f\u015f\u00fc\u00f6\u017e\u00e5\u0439\u043a\u043b\u00a4\"</code></p>\n\n<p>However I am doing it based on the number of characters allowed and cutting it in the middle. This results in data getting corrupted. </p>\n\n<p>The result comes out like</p>\n\n<p><code>H\u3400\u303e\u2593\u6717\ud42d\ud15f\u015f\u00fc\u00f6\u017e\u00e5\ufffd...</code></p>\n\n<p>The <code>\ufffd</code> should not be there. How do we detect these special characters and split it based on the length of these characters?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nvar reNameBlacklist = regexp.MustCompile(`(&amp;|&gt;|&lt;|\\/|:|\\n|\\r)*`)\nvar maxFileNameLength = 30\n\n// SanitizeName sanitizes user names in an email\nfunc SanitizeName(name string, limit int) string {\n\n    result := name\n    reNameBlacklist.ReplaceAllString(result, \"\")\n    if len(result) &gt; limit {\n        result = result[:limit] + \"...\"\n    }\n    return result\n}\n\n\n\nfunc main() {\n  str := \"H\u3400\u303e\u2593\u6717\ud42d\ud15f\u015f\u00fc\u00f6\u017e\u00e5\u0439\u043a\u043b\u00a4\"\n    fmt.Println(str)\n\n    strsan := SanitizeName(str, maxFileNameLength)\n    fmt.Println(strsan)\n\n}\n</code></pre>\n"}, {"tags": ["go", "websocket", "chat"], "comments": [{"owner": {"reputation": 2498, "user_id": 386356, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/Q4Biu.png?s=128&g=1", "display_name": "Aamir Mahmood", "link": "https://stackoverflow.com/users/386356/aamir-mahmood"}, "edited": false, "score": 0, "creation_date": 1517216610, "post_id": 46415206, "comment_id": 83988196, "body": "were you able to solve this? I am also working on something same and need some advise"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1567702952, "post_id": 46415206, "comment_id": 102051591, "body": "See this related question w/ answer: <a href=\"https://stackoverflow.com/questions/54290124/sending-a-websocket-message-to-a-specific-client-in-go-using-gorilla\" title=\"sending a websocket message to a specific client in go using gorilla\">stackoverflow.com/questions/54290124/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 7, "last_activity_date": 1506414892, "last_edit_date": 1506414892, "creation_date": 1506380473, "answer_id": 46415400, "question_id": 46415206, "link": "https://stackoverflow.com/questions/46415206/golang-one-to-one-chat/46415400#46415400", "title": "Golang one to one chat", "body": "<p>You would need to do few things:</p>\n\n<ol>\n<li>Get rid of <code>broadcast</code> channel</li>\n<li>Somehow pass &amp; get from request to which client your user want to connect. Some room number/name, secret code? For example an URL parameter <code>/ws?chat=abc</code>. You probably would need to maintain a <code>map[chatid][]*websocket.Conn</code></li>\n<li>Match 2 (<em>or more</em>) clients.</li>\n<li>Maintain a map, probably of type <code>map[*websocket.Conn]*websocket.Conn</code></li>\n<li>On receiving a message from a client lookup the map and send the message to the matching client. In similar way as in <code>handleMessages()</code> but just once.</li>\n</ol>\n\n<p><em>Please note StackOverflow is not a place to ask to write code for you.</em></p>\n"}], "owner": {"reputation": 51, "user_id": 3554158, "user_type": "registered", "profile_image": "https://graph.facebook.com/1264102405/picture?type=large", "display_name": "bajro91", "link": "https://stackoverflow.com/users/3554158/bajro91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2407, "favorite_count": 4, "answer_count": 1, "score": 5, "last_activity_date": 1506414892, "creation_date": 1506379131, "last_edit_date": 1506379269, "question_id": 46415206, "link": "https://stackoverflow.com/questions/46415206/golang-one-to-one-chat", "title": "Golang one to one chat", "body": "<p>I want make one to one chat on golang and I find this simple script with websocket it work really well and it is one room with how much users inside you want. But I want convert it to one to one like facebook this is script if someone can help because I dont know am I need use more connections or filter users. </p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/websocket\"\n)\n\nvar clients = make(map[*websocket.Conn]bool) // connected clients\nvar broadcast = make(chan Message)           // broadcast channel\n\n// Configure the upgrader\nvar upgrader = websocket.Upgrader{\n    CheckOrigin: func(r *http.Request) bool {\n        return true\n    },\n}\n\n// Define our message object\ntype Message struct {\n    Email    string `json:\"email\"`\n    Username string `json:\"username\"`\n    Message  string `json:\"message\"`\n    Created  string `json:\"created\"`\n}\n\nfunc main() {\n    // Create a simple file server\n    fs := http.FileServer(http.Dir(\"public\"))\n    http.Handle(\"/\", fs)\n\n    // Configure websocket route\n    http.HandleFunc(\"/ws\", handleConnections)\n\n    // Start listening for incoming chat messages\n    go handleMessages()\n\n    // Start the server on localhost port 8000 and log any errors\n    log.Println(\"http server started on :8090\")\n    err := http.ListenAndServe(\":8090\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n\nfunc handleConnections(w http.ResponseWriter, r *http.Request) {\n    // Upgrade initial GET request to a websocket\n    ws, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    // Make sure we close the connection when the function returns\n    defer ws.Close()\n\n    // Register our new client\n    clients[ws] = true\n\n    for {\n        var msg Message\n        // Read in a new message as JSON and map it to a Message object\n        err := ws.ReadJSON(&amp;msg)\n        if err != nil {\n            log.Printf(\"error: %v\", err)\n            delete(clients, ws)\n            break\n        }\n        // Send the newly received message to the broadcast channel\n        broadcast &lt;- msg\n    }\n}\n\nfunc handleMessages() {\n    for {\n        // Grab the next message from the broadcast channel\n        msg := &lt;-broadcast\n        // Send it out to every client that is currently connected\n        for client := range clients {\n            err := client.WriteJSON(msg)\n            if err != nil {\n                log.Printf(\"error: %v\", err)\n                client.Close()\n                delete(clients, client)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>am I need change this part</p>\n\n<pre><code>clients[ws] = true\n</code></pre>\n"}, {"tags": ["docker", "go", "containers", "grpc"], "comments": [{"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1506366126, "post_id": 46412256, "comment_id": 79782457, "body": "I think you need a <code>-p</code> on your mkdir command. <code>RUN mkdir -p &#47;go&#47;src&#47;github.com&#47;alhennessey92&#47;mygoapp</code>"}, {"owner": {"reputation": 2145, "user_id": 1136379, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/526b6a70268ca524b27266caff6f3ec2?s=128&d=identicon&r=PG", "display_name": "Al Hennessey", "link": "https://stackoverflow.com/users/1136379/al-hennessey"}, "reply_to_user": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1506366423, "post_id": 46412256, "comment_id": 79782638, "body": "Hi, just tried that but getting the error <code>can&#39;t load package: package &#47;go&#47;src&#47;github.com&#47;alhennessey92&#47;mygoapp: import &quot;&#47;go&#47;src&#47;github.com&#47;alhennessey92&#47;mygoapp&quot;: cannot import absolute path</code>"}, {"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 1, "creation_date": 1506366551, "post_id": 46412256, "comment_id": 79782715, "body": "Different error, different problem. I think that one points to your install line needing to use a relative path: <code>RUN go install github.com&#47;alhennessey92&#47;mygoapp</code>."}, {"owner": {"reputation": 2145, "user_id": 1136379, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/526b6a70268ca524b27266caff6f3ec2?s=128&d=identicon&r=PG", "display_name": "Al Hennessey", "link": "https://stackoverflow.com/users/1136379/al-hennessey"}, "reply_to_user": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1506366871, "post_id": 46412256, "comment_id": 79782876, "body": "Thanks for your help, i have implemented what you said, but now getting a different set of errors, i have edited the question with the updated code and errors"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506371430, "post_id": 46412256, "comment_id": 79785247, "body": "@AlHennessey: Now it appears you haven&#39;t installed any of your dependencies. You haven&#39;t run <code>go get</code>; are you expecting them to be vendored?"}], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 2, "last_activity_date": 1506395147, "creation_date": 1506395147, "answer_id": 46417208, "question_id": 46412256, "link": "https://stackoverflow.com/questions/46412256/error-building-go-with-grpc-docker-container/46417208#46417208", "title": "Error building Go with gRPC Docker container", "body": "<p>You either need to add <code>go get</code> to your docker file, or you need to <a href=\"https://blog.gopheracademy.com/advent-2015/vendor-folder/\" rel=\"nofollow noreferrer\">vendor</a> the third party libraries with a tool like <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a>.</p>\n\n<p>vendoring is better, but if you want to just download files in docker container, do:</p>\n\n<pre><code>FROM golang:latest\n\nRUN mkdir -p /go/src/github.com/alhennessey92/mygoapp\nADD . /go/src/github.com/alhennessey92/mygoapp\n\nWORKDIR /go/src/github.com/alhennessey92/mygoapp\nEXPOSE 8080\n\nRUN go get ./...\nRUN go install \nENTRYPOINT [\"/go/bin/mygoapp\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1501, "user_id": 4557946, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/Qtd3P.jpg?s=128&g=1", "display_name": "Tushar Saha", "link": "https://stackoverflow.com/users/4557946/tushar-saha"}, "is_accepted": false, "score": 0, "last_activity_date": 1552916411, "creation_date": 1552916411, "answer_id": 55222731, "question_id": 46412256, "link": "https://stackoverflow.com/questions/46412256/error-building-go-with-grpc-docker-container/55222731#55222731", "title": "Error building Go with gRPC Docker container", "body": "<p>i faced similar problem as yours</p>\n\n<p>turns out i was not creating folder correctly\ni was missing these lines from docker file</p>\n\n<pre><code> ADD . /go/src/github.com/grpc/app_folder_name\n WORKDIR /go/src/github.com/grpc/app_folder_name`\n</code></pre>\n\n<p>this is my dockerfile</p>\n\n<pre><code>FROM golang\n# Copy our file in the host contianer to our contianer\nADD . /go/src/github.com/grpc/app_folder_name\nWORKDIR /go/src/github.com/grpc/app_folder_name\nRUN go get -u github.com/golang/protobuf/protoc-gen-go\nRUN go get -u google.golang.org/grpc\nRUN go get -u go.mongodb.org/mongo-driver/mongo\nRUN go get -u github.com/go-redis/redis\nRUN go install -v ./...\n# Generate binary file from our /app\nRUN go build /go/src/github.com/grpc/app_folder_name/app_server/app.go\n# Expose the ports used in server\nEXPOSE 50051:50051\nEXPOSE 27018:27018\n# Run the app binarry file \nCMD [\"./app\"]\n</code></pre>\n\n<p>`</p>\n"}], "owner": {"reputation": 2145, "user_id": 1136379, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/526b6a70268ca524b27266caff6f3ec2?s=128&d=identicon&r=PG", "display_name": "Al Hennessey", "link": "https://stackoverflow.com/users/1136379/al-hennessey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 778, "favorite_count": 0, "accepted_answer_id": 46417208, "answer_count": 2, "score": -3, "last_activity_date": 1552916411, "creation_date": 1506365528, "last_edit_date": 1506367356, "question_id": 46412256, "link": "https://stackoverflow.com/questions/46412256/error-building-go-with-grpc-docker-container", "title": "Error building Go with gRPC Docker container", "body": "<p>I am trying to turn my golang grpc application into a docker container, however i keep getting an error when trying to build.</p>\n\n<p>The error is </p>\n\n<pre><code> messagepb/stickynote.pb.go:16:8: cannot find package \"github.com/golang/protobuf/proto\" in any of:\n        /usr/local/go/src/github.com/golang/protobuf/proto (from $GOROOT)\n        /go/src/github.com/golang/protobuf/proto (from $GOPATH)\nsticky.go:6:2: cannot find package \"github.com/llgcode/draw2d\" in any of:\n        /usr/local/go/src/github.com/llgcode/draw2d (from $GOROOT)\n        /go/src/github.com/llgcode/draw2d (from $GOPATH)\nsticky.go:7:2: cannot find package \"github.com/llgcode/draw2d/draw2dimg\" in any of:\n        /usr/local/go/src/github.com/llgcode/draw2d/draw2dimg (from $GOROOT)\n        /go/src/github.com/llgcode/draw2d/draw2dimg (from $GOPATH)\nmessagepb/stickynote.pb.go:21:2: cannot find package \"golang.org/x/net/context\" in any of:\n        /usr/local/go/src/golang.org/x/net/context (from $GOROOT)\n        /go/src/golang.org/x/net/context (from $GOPATH)\nmessagepb/stickynote.pb.go:22:2: cannot find package \"google.golang.org/grpc\" in any of:\n        /usr/local/go/src/google.golang.org/grpc (from $GOROOT)\n        /go/src/google.golang.org/grpc (from $GOPATH)\nmain.go:7:2: cannot find package \"google.golang.org/grpc/credentials\" in any of:\n        /usr/local/go/src/google.golang.org/grpc/credentials (from $GOROOT)\n        /go/src/google.golang.org/grpc/credentials (from $GOPATH)\n</code></pre>\n\n<p>The Dockerfile is </p>\n\n<pre><code>FROM golang:latest\n\nRUN mkdir -p /go/src/github.com/alhennessey92/mygoapp\nADD . /go/src/github.com/alhennessey92/mygoapp\n\nWORKDIR /go/src/github.com/alhennessey92/mygoapp\nEXPOSE 8080\n\nRUN go install github.com/alhennessey92/mygoapp\nENTRYPOINT [\"/go/bin/mygoapp\"]\n</code></pre>\n\n<p>The file structure is as follows</p>\n\n<pre><code>go\n-- src\n---- github.com\n------ alhennessey92\n-------- mygoapp\n---------- Dockerfile\n---------- main.go\n---------- sticky.go\n---------- messagepb\n------------ stickynote.pb.go\n------------ stickynote.proto\n</code></pre>\n\n<p>This is the code for main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"net\"\n    \"log\"\n    \"google.golang.org/grpc/credentials\"\n    \"golang.org/x/net/context\"\n    pb \"github.com/alhennessey92/mygoapp/messagepb\"\n    \"google.golang.org/grpc\"\n)\n\n\nconst (\n    useSSL = false\n)\n\ntype StickyNoteServer struct{}\n\nvar stickyNoteServer StickyNoteServer\n\n\n\nfunc (s *StickyNoteServer) Get(ctx context.Context, r *pb.StickyNoteRequest) (*pb.StickyNoteResponse, error) {\n    var sticky Sticky\n    sticky.Message = r.Message\n    sticky.Centered = false\n\n    resp := &amp;pb.StickyNoteResponse{}\n    stickyBytes, err := sticky.DrawPNG(512, 512)\n    resp.Image = *stickyBytes\n\n    return resp, err\n}\nfunc (s *StickyNoteServer) Update(stream pb.StickyNote_UpdateServer) error {\n    for {\n        in, err := stream.Recv()\n        if err == io.EOF {\n            return nil\n        }\n        if err != nil {\n            return err\n        }\n\n        var sticky Sticky\n        sticky.Message = in.Message\n        sticky.Centered = false\n\n        resp := &amp;pb.StickyNoteResponse{}\n        stickyBytes, err := sticky.DrawPNG(512, 512)\n        resp.Image = *stickyBytes\n\n        if err := stream.Send(resp); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\n //[START main]\nfunc main() {\n\n\n    var err error\n    var lis net.Listener\n    var grpcServer *grpc.Server\n    if !useSSL {\n        lis, err = net.Listen(\"tcp\", \":8080\")\n        if err != nil {\n            log.Fatalf(\"failed to listen: %v\", err)\n        }\n        grpcServer = grpc.NewServer()\n    } else {\n        certFile := \"ssl.crt\"\n        keyFile := \"ssl.key\"\n        creds, err := credentials.NewServerTLSFromFile(certFile, keyFile)\n        lis, err = net.Listen(\"tcp\", \":443\")\n        if err != nil {\n            log.Fatalf(\"failed to listen: %v\", err)\n        }\n        grpcServer = grpc.NewServer(grpc.Creds(creds))\n    }\n    pb.RegisterStickyNoteServer(grpcServer, &amp;stickyNoteServer)\n    grpcServer.Serve(lis)\n}\n</code></pre>\n\n<p>This is the code i am running in the terminal to build the docker container</p>\n\n<pre><code>docker build -t alhennessey92/mygoapptest .\n</code></pre>\n\n<p>The go code i am using is from the google cloud grpc demo stickynote - <a href=\"https://cloud.google.com/solutions/mobile/mobile-compute-engine-grpc\" rel=\"nofollow noreferrer\">https://cloud.google.com/solutions/mobile/mobile-compute-engine-grpc</a></p>\n\n<p>I think the error has something to do with using the command <code>go get</code>, however i am not sure</p>\n\n<p>Thanks for your help</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 5, "creation_date": 1506364749, "post_id": 46411849, "comment_id": 79781728, "body": "Try to check result of <code>strings.Join</code> and then check resulting query. If driver can&#39;t show it to you, turn on logging all queries on your test pgsql db instance."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1506378231, "post_id": 46411849, "comment_id": 79787993, "body": "Show us the result of <code>strings.Join(query, &quot; &quot;)</code> to see what you are actually sending to <code>db.Query()</code>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1506387202, "post_id": 46411849, "comment_id": 79790276, "body": "This is an SQL-injection nightmare. Give us a few examples of what you want your resulting query to look like. If you want an IN clause, then that is super easy."}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "edited": false, "score": 0, "creation_date": 1506391863, "post_id": 46411849, "comment_id": 79791254, "body": "All of the values are internally generated from other database fields, so there&#39;s no SQL injection issue involved. I&#39;ll edit the question to show an example of what I want the query to look like."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1506392999, "post_id": 46411849, "comment_id": 79791512, "body": "What is the content of <code>err</code>? How if you execute the query with <code>db.Query(query, &#39;something&#39;, 40, 50)</code>?"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 1, "creation_date": 1506399443, "post_id": 46411849, "comment_id": 79793015, "body": "What do you mean by &quot;I get nothing&quot;? What are the values of rows and err when you call <code>rows, err := db.Query(...</code>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1506422150, "post_id": 46411849, "comment_id": 79805389, "body": "&quot;I&#39;m not getting anything back&quot; -- I don&#39;t believe this for a moment. <code>Query</code> returns to values: <code>*sql.Rows</code> and <code>error</code>. Even if both of those are &#39;nil&#39;, you&#39;re getting <i>something</i>."}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "edited": false, "score": 0, "creation_date": 1506430581, "post_id": 46411849, "comment_id": 79811307, "body": "Here&#39;s the result of glog.Info(rows, err): &amp;{0xc4201002a0 0x50c730 0xc420a56500 0x4f5840 &lt;nil&gt; {{0 0} 0 0 0 0} false &lt;nil&gt; []} &lt;nil&gt;"}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "edited": false, "score": 0, "creation_date": 1506434703, "post_id": 46411849, "comment_id": 79814416, "body": "I clarified what I meant by &quot;I&#39;m not getting anything back&quot;."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506436488, "post_id": 46411849, "comment_id": 79815713, "body": "Make sure you are connecting to the database you think you are. Also, check rows.Err() after rows.Next() returns false."}, {"owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "edited": false, "score": 0, "creation_date": 1506443010, "post_id": 46411849, "comment_id": 79820178, "body": "Found it. The problem turned out to be in the Scan(), not the return from Query(). Thanks for chiming in. In the process of following your suggestions, the code is now measurably better structured."}], "owner": {"reputation": 2392, "user_id": 620679, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/cb547106a24ce46841e936a917ed610d?s=128&d=identicon&r=PG", "display_name": "Scott Deerwester", "link": "https://stackoverflow.com/users/620679/scott-deerwester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1506516759, "creation_date": 1506363963, "last_edit_date": 1506434678, "question_id": 46411849, "link": "https://stackoverflow.com/questions/46411849/variable-number-of-arguments-to-sql-query", "title": "Variable number of arguments to sql.Query", "body": "<p>I'm trying to pass a variable number of arguments to db.Query() in Go. I'm doing something like:</p>\n\n<pre><code>var values []interface{}\nquery := []string{\"SELECT * FROM table\"}\nsep := \"WHERE\"\n\nif ... {\n    values = append(values, something)\n    query = append(query, fmt.Sprintf(` %s field_a=$%d`, sep, len(values))\n    sep = \"AND\"\n}\n\nif ... {\n    values = append(values, something)\n    query = append(query, fmt.Sprintf(` %s field_b=$%d`, sep, len(values))\n    sep = \"AND\"\n}\n\n// Add an arbitrary number of conditional arguments...\n\nrows, err := db.Query(strings.Join(query, \" \"), values...)\n</code></pre>\n\n<p>The query looks fine, and the values are all there, but I'm not getting anything back from the query. Some of the values are integers, some strings. When I manually try the exact same query (copy/paste) in psql, I substituting the actual values for $1, $2, etc, I get correct results. What am I missing?</p>\n\n<p><strong>Edit</strong></p>\n\n<p>Here's an example of what the final query (the result of <code>strings.Join()</code>) should look like:</p>\n\n<pre><code>SELECT\n    table1.field1, table1.field2, table1.field3,\n    table2.field4, table2.field6, table2.field6\nFROM table1, table2\nWHERE\n    table1.field2=$1 AND\n    table2.field3 IN ($2, $3)\n</code></pre>\n\n<p>When I try:</p>\n\n<pre><code>SELECT\n    table1.field1, table1.field2, table1.field3,\n    table2.field4, table2.field6, table2.field6\nFROM table1, table2\nWHERE\n    table1.field2='something' AND\n    table2.field3 IN (40, 50)\n</code></pre>\n\n<p>from <code>psql</code>, it works fine. When I call:</p>\n\n<pre><code>var values []interface{}\nvalues = append(values, \"something\")\nvalues = append(values, 40)\nvalues = append(values, 50)\ndb.Query(`SELECT\n    table1.field1, table1.field2, table1.field3,\n    table2.field4, table2.field6, table2.field6\nFROM table1, table2\nWHERE\n    table1.field2=$1 AND\n    table2.field3 IN ($2, $3)`, values...)\n</code></pre>\n\n<p>from Go, I get a Rows object that returns <code>false</code> the first time <code>rows.Next()</code> is called, and a nil error.</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 0, "creation_date": 1591786170, "post_id": 46411173, "comment_id": 110186174, "body": "You wrote <i>I tried gin.SetMode(gin.ReleaseMode) but it does not work.</i> but your code shows <code>gin.SetMode(gin.releaseMode)</code> \u2014 probably if you change it to what you actually said (that is, actually using <code>ReleaseMode</code> with an upper-case R), it should work!"}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 4849647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e31cbb45ec1965cfac924504ae2066?s=128&d=identicon&r=PG&f=1", "display_name": "Soroosh", "link": "https://stackoverflow.com/users/4849647/soroosh"}, "edited": false, "score": 0, "creation_date": 1507989347, "post_id": 46411205, "comment_id": 80436623, "body": "Yes I do, I call it in main function. So where is the right place to call it?"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": -1, "last_activity_date": 1506361638, "creation_date": 1506361638, "answer_id": 46411205, "question_id": 46411173, "link": "https://stackoverflow.com/questions/46411173/how-to-set-gin-mode-to-release-mode/46411205#46411205", "title": "How to set gin mode to release mode?", "body": "<p>It would seem you do this by calling the <a href=\"https://godoc.org/github.com/gin-gonic/gin#SetMode\" rel=\"nofollow noreferrer\"><code>SetMode</code></a> method from within your app. Probably in your <code>main</code>, or possibly in an <code>init</code> function.</p>\n"}, {"comments": [{"owner": {"reputation": 81, "user_id": 4849647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e31cbb45ec1965cfac924504ae2066?s=128&d=identicon&r=PG&f=1", "display_name": "Soroosh", "link": "https://stackoverflow.com/users/4849647/soroosh"}, "edited": false, "score": 1, "creation_date": 1507989384, "post_id": 46668456, "comment_id": 80436639, "body": "I will try it with upper case R in &quot;ReleaseMode&quot;."}, {"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 0, "creation_date": 1591786078, "post_id": 46668456, "comment_id": 110186118, "body": "The upper case R is fundamental!"}], "tags": [], "owner": {"reputation": 53, "user_id": 7432828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c2633ebd40ff42e58d61a58079708ff?s=128&d=identicon&r=PG&f=1", "display_name": "Molly1337", "link": "https://stackoverflow.com/users/7432828/molly1337"}, "is_accepted": false, "score": 2, "last_activity_date": 1507643260, "creation_date": 1507643260, "answer_id": 46668456, "question_id": 46411173, "link": "https://stackoverflow.com/questions/46411173/how-to-set-gin-mode-to-release-mode/46668456#46668456", "title": "How to set gin mode to release mode?", "body": "<p>Just add <code>gin.SetMode(gin.ReleaseMode)</code> in your main function. </p>\n"}, {"comments": [{"owner": {"reputation": 4250, "user_id": 2804362, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/MVxXV.jpg?s=128&g=1", "display_name": "iam batman", "link": "https://stackoverflow.com/users/2804362/iam-batman"}, "edited": false, "score": 0, "creation_date": 1588753384, "post_id": 48926122, "comment_id": 109016320, "body": "Env config? you meant the <code>.env</code> file"}, {"owner": {"reputation": 2713, "user_id": 825980, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/qCLvr.jpg?s=128&g=1", "display_name": "Kunal Kapadia", "link": "https://stackoverflow.com/users/825980/kunal-kapadia"}, "reply_to_user": {"reputation": 4250, "user_id": 2804362, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/MVxXV.jpg?s=128&g=1", "display_name": "iam batman", "link": "https://stackoverflow.com/users/2804362/iam-batman"}, "edited": false, "score": 0, "creation_date": 1588845971, "post_id": 48926122, "comment_id": 109059114, "body": "Not sure if that&#39;ll work. You can simply set env name in our console before starting the application or can pass in as single statement like <code>GIN_MODE=release go run main.go</code>"}, {"owner": {"reputation": 190, "user_id": 3875913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb492e4272c9ab9e016ea3164c8aea47?s=128&d=identicon&r=PG&f=1", "display_name": "user3875913", "link": "https://stackoverflow.com/users/3875913/user3875913"}, "reply_to_user": {"reputation": 4250, "user_id": 2804362, "user_type": "registered", "accept_rate": 49, "profile_image": "https://i.stack.imgur.com/MVxXV.jpg?s=128&g=1", "display_name": "iam batman", "link": "https://stackoverflow.com/users/2804362/iam-batman"}, "edited": false, "score": 1, "creation_date": 1602844578, "post_id": 48926122, "comment_id": 113855010, "body": "@iambatman you would have to use a library to load an env file."}], "tags": [], "owner": {"reputation": 2713, "user_id": 825980, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/qCLvr.jpg?s=128&g=1", "display_name": "Kunal Kapadia", "link": "https://stackoverflow.com/users/825980/kunal-kapadia"}, "is_accepted": false, "score": 13, "last_activity_date": 1519298279, "creation_date": 1519298279, "answer_id": 48926122, "question_id": 46411173, "link": "https://stackoverflow.com/questions/46411173/how-to-set-gin-mode-to-release-mode/48926122#48926122", "title": "How to set gin mode to release mode?", "body": "<p>Just set <code>GIN_MODE=release</code> to your environment config.</p>\n"}, {"tags": [], "owner": {"reputation": 231, "user_id": 6777826, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jpGOd.jpg?s=128&g=1", "display_name": "NameError", "link": "https://stackoverflow.com/users/6777826/nameerror"}, "is_accepted": false, "score": 10, "last_activity_date": 1539676185, "creation_date": 1539676185, "answer_id": 52830435, "question_id": 46411173, "link": "https://stackoverflow.com/questions/46411173/how-to-set-gin-mode-to-release-mode/52830435#52830435", "title": "How to set gin mode to release mode?", "body": "<p>You have to call <code>SetMode</code> method before you initialize the gin router. E.x:</p>\n\n<pre><code>gin.SetMode(gin.ReleaseMode)\nrouter := gin.New()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 636, "user_id": 5563092, "user_type": "registered", "accept_rate": 31, "profile_image": "https://lh6.googleusercontent.com/-57aSH6n3Au8/AAAAAAAAAAI/AAAAAAAAMdE/dWgTfQjG4bg/photo.jpg?sz=128", "display_name": "The 0bserver", "link": "https://stackoverflow.com/users/5563092/the-0bserver"}, "is_accepted": false, "score": 2, "last_activity_date": 1613128982, "last_edit_date": 1613128982, "creation_date": 1580980283, "answer_id": 60091289, "question_id": 46411173, "link": "https://stackoverflow.com/questions/46411173/how-to-set-gin-mode-to-release-mode/60091289#60091289", "title": "How to set gin mode to release mode?", "body": "<pre><code>gin.SetMode(gin.ReleaseMode)\n</code></pre>\n<p>This works. Remember that you need to set this before creating the router in your init function/main. It does not seem to work otherwise\ni.e Your code would look something like this.</p>\n<pre><code>func init() {\n    gin.SetMode(gin.ReleaseMode)\n    r := NewRouter()\n    err := r.Run(&quot;8080&quot;)\n}\n</code></pre>\n<p>The init function is called for each source file after all the packages are imported and the variables are initialized.\n<a href=\"https://golang.org/doc/effective_go.html#init\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#init</a></p>\n"}], "owner": {"reputation": 81, "user_id": 4849647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e31cbb45ec1965cfac924504ae2066?s=128&d=identicon&r=PG&f=1", "display_name": "Soroosh", "link": "https://stackoverflow.com/users/4849647/soroosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14611, "favorite_count": 1, "answer_count": 5, "score": 7, "last_activity_date": 1613128982, "creation_date": 1506361527, "last_edit_date": 1597309688, "question_id": 46411173, "link": "https://stackoverflow.com/questions/46411173/how-to-set-gin-mode-to-release-mode", "title": "How to set gin mode to release mode?", "body": "<p>I need to set gin mode to release mode. How should I do it?</p>\n<p>Now when I run my API there is a hint like this:</p>\n<pre><code>[GIN-debug] [WARNING] Running in &quot;debug&quot; mode. Switch to &quot;release&quot; mode in production.\n - using env:   export GIN_MODE=release\n - using code:  gin.SetMode(gin.ReleaseMode)\n</code></pre>\n<p>I tried <code>gin.SetMode(gin.ReleaseMode)</code> but it does not work. I initialize my router here:</p>\n<pre><code>gin.SetMode(gin.releaseMode)    \nrouter := gin.Default()\n</code></pre>\n"}, {"tags": ["go", "apache-kafka", "sarama"], "answers": [{"tags": [], "owner": {"reputation": 325, "user_id": 2414380, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/Jnq1q.png?s=128&g=1", "display_name": "Prune", "link": "https://stackoverflow.com/users/2414380/prune"}, "is_accepted": false, "score": 1, "last_activity_date": 1506370221, "creation_date": 1506370221, "answer_id": 46413419, "question_id": 46409425, "link": "https://stackoverflow.com/questions/46409425/kafka-0-11-golang-sarama-version-support/46413419#46413419", "title": "Kafka 0.11 / Golang Sarama version support", "body": "<p>As far as I've gone, I'm not sure Sarama handle the search of the broker version by itself.</p>\n\n<p>From my point of view, one need to define the API version you want to use in the config parameters of the Producer/Broker/Client like :</p>\n\n<pre><code>config := sarama.NewConfig()\nconfig.Version=sarama.V0_10_2_0\n</code></pre>\n\n<p>Also, Sarama does not support 0.11.0 yet (Sept 2017), so use 0.10.2.0 to access the latest API.</p>\n\n<p>Finaly, to use the second solution, edit the file <code>Shopify/sarama/utils.go</code> and add your versions at the end :</p>\n\n<pre><code>V0_11_0_0  = newKafkaVersion(0, 11, 0, 0)\nV0_11_0  = newKafkaVersion(0, 11, 0, 0)\nminVersion = V0_11_0_0\n</code></pre>\n"}], "owner": {"reputation": 325, "user_id": 2414380, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/Jnq1q.png?s=128&g=1", "display_name": "Prune", "link": "https://stackoverflow.com/users/2414380/prune"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1029, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506370221, "creation_date": 1506355046, "last_edit_date": 1506359269, "question_id": 46409425, "link": "https://stackoverflow.com/questions/46409425/kafka-0-11-golang-sarama-version-support", "title": "Kafka 0.11 / Golang Sarama version support", "body": "<p>I spent some time finding that my Go application connecting to a Kafka 0.11 cluster was using the old 0.8.2 version of the library, which is missing the Timestamp value in the response. </p>\n\n<p>I then found that Kafka 0.11.x API/version wasn't supported (but they are working on it).</p>\n\n<p>I have two solutions for now.</p>\n\n<p>First is to set the required version explicitly in my apps.\nSecond is to \"tune\" the Sarama code to use version 0.10.x as minimum version, enabling me to use all the 0.10.x API/functionality.</p>\n\n<p>I was still wondering why the version is not taken from the Kafka broker I'm connecting to?</p>\n\n<p>I can't understand how it's supposed to work from the code... I clearly see the version that is set or defined in the sarama.Config.Version, but I can't find anything to update this value once connected to a broker?</p>\n\n<p>I know that Python is doing it this way:</p>\n\n<pre><code>from kafka import BrokerConnection\nbroker=BrokerConnection(\"localhost\",9092,0)\nbroker.connect()\nbroker.check_version()\n</code></pre>\n\n<p>(0, 11, 0)</p>\n\n<p>What am I missing?</p>\n"}, {"tags": ["asynchronous", "go", "scheduler", "barrier", "pthread-barriers"], "comments": [{"owner": {"reputation": 428, "user_id": 7421020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6faa42c836c9cf455d50c86e033c44b?s=128&d=identicon&r=PG&f=1", "display_name": "Federico", "link": "https://stackoverflow.com/users/7421020/federico"}, "edited": false, "score": 0, "creation_date": 1506355062, "post_id": 46409234, "comment_id": 79776486, "body": "i haven&#39;t understood what you need, honestly."}, {"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "reply_to_user": {"reputation": 428, "user_id": 7421020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f6faa42c836c9cf455d50c86e033c44b?s=128&d=identicon&r=PG&f=1", "display_name": "Federico", "link": "https://stackoverflow.com/users/7421020/federico"}, "edited": false, "score": 0, "creation_date": 1506355680, "post_id": 46409234, "comment_id": 79776912, "body": "@Federico what is not to understand? a thread waits for a SINGLE barrier as of POSIX and Windows API. I want it to wait for ANY barrier in a SET of barriers. How is this not clear???"}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1506357603, "post_id": 46409234, "comment_id": 79777917, "body": "What&#39;s the use case?  Using a single thread to wait for any one of several different events runs counter to the core idea of threads which is, to simplify the logic of a program by having a separate thread to wait for each different thing that a program needs to wait for."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 1, "creation_date": 1506357748, "post_id": 46409234, "comment_id": 79777992, "body": "One workaround would be, for each barrier, create a thread that awaits that barrier and then puts a token into a common, blocking queue.  Then, a thread that wants to wait for <i>any</i> barrier can do so by waiting to remove the token from the queue."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1506358047, "post_id": 46409234, "comment_id": 79778128, "body": "@Andreas What&#39;s the obstacle to coding what you need using mutexes and condition variables (or events)? Do you not know how to do it? Or is there some reason that obvious solution wouldn&#39;t work for you?"}, {"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1506358049, "post_id": 46409234, "comment_id": 79778130, "body": "@jameslarge added a theoretical use case."}, {"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1506358370, "post_id": 46409234, "comment_id": 79778303, "body": "@DavidSchwartz I&#180;m defining (or at least try defining) a minimalistic runtime environment for CSP using widely accessible and understood synchronization primitives. The barriers are SO close to what I need so I hoped someone had a trick taking that final step."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 1, "creation_date": 1506358486, "post_id": 46409234, "comment_id": 79778358, "body": "Use one lock. Inside the lock, put all the containers, state-variables, booleans arrays, counters, whatever you need to implement whatever it is you want to do.  All threads enter.  They either leave immediately and run on or leave and immediately block on an event/semaphore, ether a private one, or one they got from inside the lock, whatever is needed.  Threads in the lock can examine, iterate, increment, decrement, whatever they want &#39;cos they&#39;re inside the lock.  They can also signal any events/semas that threads are waiting on outside the lock.  Bulid whatever you want from that framework."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1506358598, "post_id": 46409234, "comment_id": 79778415, "body": "The tricks (as suggested by james large) are ugly. But they&#39;ll work. Otherwise, code what you need as Martin James suggests."}, {"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1506358621, "post_id": 46409234, "comment_id": 79778429, "body": "@jameslarge Nice one! I&#180;ll have to double-check but looks like you win."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 1, "creation_date": 1506358699, "post_id": 46409234, "comment_id": 79778466, "body": "Actually, choice three is to re-architect so that this requirement goes away. Whether or not that&#39;s possible depends on details of the specific problem. That may or may not be an option in your case."}, {"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1506359150, "post_id": 46409234, "comment_id": 79778674, "body": "@DavidSchwartz I&#180;m making a CSP model runtime. I can&#180;t make the requirement go away unless redefining CSP. But I agree on your comments as advice to others able to use an alternative architecture."}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "reply_to_user": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "edited": false, "score": 0, "creation_date": 1506359162, "post_id": 46409234, "comment_id": 79778677, "body": "^^ What @DavidSchwartz says.  Solving complex requirements by designing away the need for them is a good plan on any system, but especially so with multithreading.  So many devs get themselves tied up in horrible knots with bad designs, (eg. <a href=\"https://stackoverflow.com/q/46400868/758133\">stackoverflow.com/q/46400868/758133</a>)."}, {"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "reply_to_user": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1506359323, "post_id": 46409234, "comment_id": 79778746, "body": "@MartinJames Ironically what I&#180;m implementing is a simpler way of dealing with concurrency :-) So in a sense once I got this working I can make a model of the runtime and prove the design to be not only good, but perfect. All your multithreaded fears shall be moot and void!"}, {"owner": {"reputation": 23582, "user_id": 758133, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/W8X5E.jpg?s=128&g=1", "display_name": "Martin James", "link": "https://stackoverflow.com/users/758133/martin-james"}, "edited": false, "score": 0, "creation_date": 1506359774, "post_id": 46409234, "comment_id": 79778969, "body": "@Andreas &#39;design to be not only good, but perfect&#39;... well, good luck with that one;)    I don&#39;t with to put anyone off - it&#39;s just that it seems, when it comes to multithreading, I spend most time advising devs to not do something because it will end badly, rather than &#39;do this&#39; advice.  It&#39;s kinda weird what people pick up from the dodgy websites:("}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1506360081, "post_id": 46409234, "comment_id": 79779130, "body": "FWIW: A <code>Semaphore</code> is functionally equivalent to a blocking queue of tokens if the tokens are indistinguishable from one another.  The number of &quot;permits&quot; in the semaphore is equivalent to the number of tokens in the queue."}, {"owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "reply_to_user": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 0, "creation_date": 1506360511, "post_id": 46409234, "comment_id": 79779353, "body": "@jameslarge Good point. That reminds of a prerequisite: when unblocked the blocking primitive must be reset to its original n count. Semaphores don&#180;t have this property natively, barriers do. I like you first suggestion better but if I get the time I&#180;ll make answers from both suggestions."}], "owner": {"reputation": 2796, "user_id": 6121044, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d36000b5ea58961acf50354041457af9?s=128&d=identicon&r=PG&f=1", "display_name": "Andreas", "link": "https://stackoverflow.com/users/6121044/andreas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 267, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1506533451, "creation_date": 1506354451, "last_edit_date": 1506533451, "question_id": 46409234, "link": "https://stackoverflow.com/questions/46409234/how-can-i-make-a-thread-wait-on-any-barrier-in-a-set-of-barriers", "title": "How can I make a thread wait on any barrier in a set of barriers?", "body": "<p>In POSIX and Windows API have barriers that allow synchronizing n threads. When n threads waiting for the barrier they may proceed doing some work.</p>\n\n<p>What I want is for threads to wait for a set of barriers. When any of the barriers have n threads waiting it unlocks, returning which one of the barriers that was unlocked. Looking at POSIX and Windows API this is not a part of the native API. Is there another way around it?</p>\n\n<p>Target language is C/C++ but language agnostic solutions are also appreciated.</p>\n\n<p>Bakground: I\u00b4m looking into CSP, the basis of Occam and an inspiration source for Go. I believe a runtime can treat Events as barriers. However that would require some way of waiting for multiple barriers. I\u00b4d like to getting around this without major effort put in a supervisor.</p>\n\n<hr>\n\n<p>Edit: Making an example in CSP notation.</p>\n\n<pre><code>P = c -&gt; c -&gt; d -&gt; P;\nQ = d -&gt; e -&gt; Q;\nR = c -&gt; R | d -&gt; SKIP;\nRUNTIME = P || Q || R;\n</code></pre>\n\n<p>For those of you unfamiliar with the syntax, P is a process (thread) interacting with event c, then c again, then d, then works like P. Q works similar. R is defined as c then R\nor d then SKIP. RUNTIME is the concurrent process made from P, Q and R.</p>\n\n<p>Events are synchronized similar to barriers; all processes must be able to deal with it at the same time for it to happen. The trick is that a process may be able to participate in a set of event such as R which may participate in c or d, but unable to because of other processes (P and Q) not being able to participate.</p>\n\n<p>This is where the \"wait for ANY from a SET of barriers\" comes in. R may wait for c or d simultaneously, and depending on which one is unlocked will behave differently.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1506343512, "post_id": 46405557, "comment_id": 79768477, "body": "Why aren&#39;t you just processing the JSON in its unnested form? Without any additional information, that seems like an odd conversion to do."}, {"owner": {"reputation": 1592, "user_id": 1672261, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/185c55d00bfcbf953b0d5c88ed0d6c75?s=128&d=identicon&r=PG&f=1", "display_name": "Alen", "link": "https://stackoverflow.com/users/1672261/alen"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1506343759, "post_id": 46405557, "comment_id": 79768643, "body": "Because I need to store it into Redis, and if I store the json into Redis I can&#39;t search for specific keys. That&#39;s I why convert the keys into this key1:key2:key3:value etc. But then at some point I need it in json again."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1506343965, "post_id": 46405557, "comment_id": 79768796, "body": "That makes sense.  Have you attempted to write a reversal function for the gojsonexplode package?"}, {"owner": {"reputation": 1592, "user_id": 1672261, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/185c55d00bfcbf953b0d5c88ed0d6c75?s=128&d=identicon&r=PG&f=1", "display_name": "Alen", "link": "https://stackoverflow.com/users/1672261/alen"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1506344052, "post_id": 46405557, "comment_id": 79768860, "body": "I&#39;m not good enough with Go to reverse gojsonexplode package. I attempted it but I failed"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506347329, "post_id": 46405557, "comment_id": 79771230, "body": "If size of the data isn&#39;t a problem you could keep a copy of the nested json inside the flattened one. <a href=\"https://play.golang.org/p/kM4UyUA0Ry\" rel=\"nofollow noreferrer\">play.golang.org/p/kM4UyUA0Ry</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506347389, "post_id": 46405557, "comment_id": 79771275, "body": "Here&#39;s a more naive quick and dirty solution <a href=\"https://goplay.space/#_RIaXWDcVt\" rel=\"nofollow noreferrer\">goplay.space/#_RIaXWDcVt</a>"}, {"owner": {"reputation": 1592, "user_id": 1672261, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/185c55d00bfcbf953b0d5c88ed0d6c75?s=128&d=identicon&r=PG&f=1", "display_name": "Alen", "link": "https://stackoverflow.com/users/1672261/alen"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506347861, "post_id": 46405557, "comment_id": 79771592, "body": "@reticentroot I used Person only as an example (taken from gojsonexplode package). Data is not fixed, it can have various keys and various nesting levels."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506348001, "post_id": 46405557, "comment_id": 79771700, "body": "@Alen Sounds like a good time to write a reverse for gojsonexplode then :-) you may not know Go well enough now, but you&#39;ll know it a lot better if you write that function.  You can always write the function the best you can and when you get stuck ask the appropriate questions/errors on SOF. In that way you solve your original question and learn some more Go."}], "answers": [{"comments": [{"owner": {"reputation": 1592, "user_id": 1672261, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/185c55d00bfcbf953b0d5c88ed0d6c75?s=128&d=identicon&r=PG&f=1", "display_name": "Alen", "link": "https://stackoverflow.com/users/1672261/alen"}, "edited": false, "score": 0, "creation_date": 1506347156, "post_id": 46406625, "comment_id": 79771119, "body": "Sorry but this doesn&#39;t solve my problem, I&#39;m trying to convert key1:key2: some_value into nested json: {&quot;key1&quot;: {&quot;key2&quot;: &quot;some_value&quot;}}"}], "tags": [], "owner": {"reputation": 108, "user_id": 5356496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9eiku.jpg?s=128&g=1", "display_name": "goofle", "link": "https://stackoverflow.com/users/5356496/goofle"}, "is_accepted": false, "score": -1, "last_activity_date": 1506348113, "last_edit_date": 1506348113, "creation_date": 1506346683, "answer_id": 46406625, "question_id": 46405557, "link": "https://stackoverflow.com/questions/46405557/convert-flattened-json-into-nested-json/46406625#46406625", "title": "Convert flattened json into nested json", "body": "<p><a href=\"https://golang.org/pkg/encoding/json/#MarshalIndent\" rel=\"nofollow noreferrer\">json.MarshalIndent</a> is your friend.</p>\n\n<pre><code>j, err := json.MarshalIndent(x, \"\", \"\\t\")\nif err != nil {\n    log.Println(err)\n}\nlog.Println(string(j))\n</code></pre>\n\n<p>It will print your data (x) in indented manner.</p>\n"}, {"comments": [{"owner": {"reputation": 1592, "user_id": 1672261, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/185c55d00bfcbf953b0d5c88ed0d6c75?s=128&d=identicon&r=PG&f=1", "display_name": "Alen", "link": "https://stackoverflow.com/users/1672261/alen"}, "edited": false, "score": 0, "creation_date": 1506349232, "post_id": 46407455, "comment_id": 79772544, "body": "Man, you are absolutely awesome. Thank you 1000 times"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1506349660, "post_id": 46407455, "comment_id": 79772878, "body": "Note that the flattened version is ambiguous. You cannot distinguish <code>[&quot;x&quot;]</code> from <code>{&quot;0&quot;:&quot;x&quot;}</code>, or <code>{&quot;x&quot;:{&quot;y&quot;:&quot;z&quot;}}</code> from <code>{&quot;x.y&quot;:&quot;z&quot;}</code>. So be careful with your input."}], "tags": [], "owner": {"reputation": 2308, "user_id": 503798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aabe05e38d17eae27464034385ff5f55?s=128&d=identicon&r=PG", "display_name": "A J", "link": "https://stackoverflow.com/users/503798/a-j"}, "is_accepted": true, "score": 4, "last_activity_date": 1506349248, "last_edit_date": 1506349248, "creation_date": 1506349078, "answer_id": 46407455, "question_id": 46405557, "link": "https://stackoverflow.com/questions/46405557/convert-flattened-json-into-nested-json/46407455#46407455", "title": "Convert flattened json into nested json", "body": "<p>In order to \"unflatten\" the data you need to split each of the keys at the dot and create nested objects. <a href=\"https://play.golang.org/p/4juOff38ea\" rel=\"nofollow noreferrer\">Here is an example</a> with your data on the Go Playground.</p>\n\n<pre><code>func unflatten(flat map[string]interface{}) (map[string]interface{}, error) {\n    unflat := map[string]interface{}{}\n\n    for key, value := range flat {\n        keyParts := strings.Split(key, \".\")\n\n        // Walk the keys until we get to a leaf node.\n        m := unflat\n        for i, k := range keyParts[:len(keyParts)-1] {\n            v, exists := m[k]\n            if !exists {\n                newMap := map[string]interface{}{}\n                m[k] = newMap\n                m = newMap\n                continue\n            }   \n\n            innerMap, ok := v.(map[string]interface{})\n            if !ok {\n                return nil, fmt.Errorf(\"key=%v is not an object\", strings.Join(keyParts[0:i+1], \".\"))\n            }   \n            m = innerMap\n        }   \n\n        leafKey := keyParts[len(keyParts)-1]\n        if _, exists := m[leafKey]; exists {\n            return nil, fmt.Errorf(\"key=%v already exists\", key)\n        }   \n        m[keyParts[len(keyParts)-1]] = value\n    }   \n\n    return unflat, nil \n} \n</code></pre>\n"}], "owner": {"reputation": 1592, "user_id": 1672261, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/185c55d00bfcbf953b0d5c88ed0d6c75?s=128&d=identicon&r=PG&f=1", "display_name": "Alen", "link": "https://stackoverflow.com/users/1672261/alen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 1, "accepted_answer_id": 46407455, "answer_count": 2, "score": 2, "last_activity_date": 1506349248, "creation_date": 1506343382, "last_edit_date": 1506344182, "question_id": 46405557, "link": "https://stackoverflow.com/questions/46405557/convert-flattened-json-into-nested-json", "title": "Convert flattened json into nested json", "body": "<p>Currently I'm using the following code to convert nested json into flattened json:</p>\n\n<pre><code>import (\n    \"fmt\"\n\n    \"github.com/nytlabs/gojsonexplode\"\n)\nfunc main() {\n    input := `{\"person\":{\"name\":\"Joe\", \"address\":{\"street\":\"123 Main St.\"}}}`\n    out, err := gojsonexplode.Explodejsonstr(input, \".\")\n    if err != nil {\n        // handle error\n    }\n    fmt.Println(out)\n}\n</code></pre>\n\n<p>This is the output: <code>{\"person.address.street\":\"123 Main St.\",\"person.name\":\"Joe\"}</code></p>\n\n<p>After some processing, now I want to restore this data into normal nested json, but I'm unable to do so.</p>\n\n<p>My closest guess is usage of nested maps, but I don't know how to create nested map with N levels.</p>\n\n<p>EDIT: Reason why I need this: I'm storing data in Redis, and if I store json into Redis then I can't search for keys, that's why I convert keys into <code>key1:key2:key3: some_value</code></p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 33032, "user_id": 6603816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90ecdaa8afcbc3d826ef9beac53b2a1f?s=128&d=identicon&r=PG&f=1", "display_name": "yamenk", "link": "https://stackoverflow.com/users/6603816/yamenk"}, "edited": false, "score": 0, "creation_date": 1506340982, "post_id": 46404379, "comment_id": 79766752, "body": "can you provide the docker-compose file?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506341957, "post_id": 46404379, "comment_id": 79767407, "body": "<a href=\"https://docs.docker.com/compose/compose-file/#env_file\" rel=\"nofollow noreferrer\">Compose file reference</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1584, "user_id": 3775614, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tkkon.png?s=128&g=1", "display_name": "lee-pai-long", "link": "https://stackoverflow.com/users/3775614/lee-pai-long"}, "is_accepted": true, "score": 1, "last_activity_date": 1506347869, "last_edit_date": 1506347869, "creation_date": 1506341313, "answer_id": 46404887, "question_id": 46404379, "link": "https://stackoverflow.com/questions/46404379/how-use-docker-compose-env-file-variables-in-different-containers-with-golang/46404887#46404887", "title": "how use docker-compose env file variables in different containers with golang?", "body": "<p>The\u00a0<code>.env</code>\u00a0file placed in the same directory as the <code>docker-compose.yml</code> is used for\u00a0variable substitutions\u00a0in the compose files only.</p>\n\n<p>On the other hand, you can define a <code>env_file</code> key to pass env vars from a file to the container at runtime:</p>\n\n<pre><code>services: \n  some_service: \n    image: someimg\n      env_file:\n        - .env\n</code></pre>\n\n<p>It works like the\u00a0environment\u00a0statement in a <code>Dockerfile</code> or\u00a0<code>docker run -e</code>.</p>\n\n<p><em>As the list type implied you can use multiple files for example to override some generic config key for a specific service.</em></p>\n"}], "owner": {"reputation": 503, "user_id": 6398112, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/61924783fe49e9facb31a869a6845c74?s=128&d=identicon&r=PG&f=1", "display_name": "Andrey ", "link": "https://stackoverflow.com/users/6398112/andrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1223, "favorite_count": 0, "accepted_answer_id": 46404887, "answer_count": 1, "score": 1, "last_activity_date": 1506347869, "creation_date": 1506339700, "last_edit_date": 1506340637, "question_id": 46404379, "link": "https://stackoverflow.com/questions/46404379/how-use-docker-compose-env-file-variables-in-different-containers-with-golang", "title": "how use docker-compose env file variables in different containers with golang?", "body": "<pre><code>.\n\u251c\u2500\u2500 articaleServer\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 main.go\n\u2502   \u2514\u2500\u2500 sources.json\n\u251c\u2500\u2500 butler\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 main.py\n\u2502   \u2514\u2500\u2500 requirements.txt\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 frontEnd\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 main.go\n\u2502   \u251c\u2500\u2500 tags.json\n\u2502   \u2514\u2500\u2500 templates\n\u2502       \u251c\u2500\u2500 auth.html\n\u2502       \u251c\u2500\u2500 feed.html\n\u2502       \u251c\u2500\u2500 footer.html\n\u2502       \u251c\u2500\u2500 header.html\n\u2502       \u251c\u2500\u2500 main.html\n\u2502       \u2514\u2500\u2500 today.html\n\u2514\u2500\u2500 server\n    \u251c\u2500\u2500 Dockerfile\n    \u251c\u2500\u2500 keys\n    \u2502   \u251c\u2500\u2500 app.rsa\n    \u2502   \u2514\u2500\u2500 app.rsa.pub\n    \u2514\u2500\u2500 main.go\n</code></pre>\n\n<p>.env</p>\n\n<pre><code>MONGO_USERNSME=user\nMONGO_USERNSME=password\n</code></pre>\n\n<p>I have .env file in path with docker-compose.yml and I need to use variables form it in other containers(articaleServer, butler, server) in go files like</p>\n\n<pre><code>mongoDBDialInfo := &amp;mgo.DialInfo{\n        Addrs:    []string{\"mongodb://mongo:27017\"},\n        Username: os.Getenv(\"MONGO_USERNSME\"),\n        Password:  os.Getenv(\"MONGO_PASSWORD\"),\n    }\n</code></pre>\n\n<p>But go does't see it and pass nil</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506346409, "post_id": 46404307, "comment_id": 79770562, "body": "See here for a solution <a href=\"https://stackoverflow.com/questions/43132005/serving-static-files-go-seems-inefficient-or-maybe-its-just-me\" title=\"serving static files go seems inefficient or maybe its just me\">stackoverflow.com/questions/43132005/&hellip;</a>"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1506457682, "post_id": 46404307, "comment_id": 79827691, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/43132005/serving-static-files-go-seems-inefficient-or-maybe-its-just-me\">Serving static files Go seems inefficient..or maybe its just me :-)</a>"}], "owner": {"reputation": 509, "user_id": 7080782, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/e61e0b338481ed4ba381fd11e26efc34?s=128&d=identicon&r=PG&f=1", "display_name": "aaaaaaaaax10", "link": "https://stackoverflow.com/users/7080782/aaaaaaaaax10"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1506356594, "creation_date": 1506339496, "last_edit_date": 1506356594, "question_id": 46404307, "link": "https://stackoverflow.com/questions/46404307/how-to-define-one-static-folder-for-all-routes", "title": "How to define one static folder for all routes", "body": "<p>I use <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">github.com/gorilla/mux</a> router and I need include my static files for all routes or notFound routes.\nNow refreshing only page by <code>/</code> works but other urls doesn't.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"crudgo/backend/home\"\n    \"github.com/gorilla/mux\"\n  )\n\nfunc main() {\n     http.FileServer(http.Dir(\"./public/p/dist\"))\n     log.Println(\"Listening...\")\n\n     router := mux.NewRouter();\n\n     home.HomeRoute(router)\n\n     router.PathPrefix(\"/{_:.*}\").Handler(http.FileServer(http.Dir(\"./public/p/dist\")))\n\n     http.ListenAndServe(\"localhost:3000\", router)\n}\n</code></pre>\n"}, {"tags": ["http", "url", "go", "fileserver"], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 3369360, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1443307155/picture?type=large", "display_name": "Andrea Castello", "link": "https://stackoverflow.com/users/3369360/andrea-castello"}, "edited": false, "score": 0, "creation_date": 1506339486, "post_id": 46404016, "comment_id": 79765722, "body": "You&#39;re right. Is the caller forced to type the trailing slash in URL: localhost:8080/download/ ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 95, "user_id": 3369360, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1443307155/picture?type=large", "display_name": "Andrea Castello", "link": "https://stackoverflow.com/users/3369360/andrea-castello"}, "edited": false, "score": 0, "creation_date": 1506339646, "post_id": 46404016, "comment_id": 79765835, "body": "@AndreaCastello No, it is not needed, as the server will send a redirect and the browser will follow that automatically. See edited answer. Try it yourself."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 95, "user_id": 3369360, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1443307155/picture?type=large", "display_name": "Andrea Castello", "link": "https://stackoverflow.com/users/3369360/andrea-castello"}, "edited": false, "score": 0, "creation_date": 1506349774, "post_id": 46404016, "comment_id": 79772953, "body": "@AndreaCastello Please see revised answer, added explanation about the wrong URLs."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1506349761, "last_edit_date": 1506349761, "creation_date": 1506338517, "answer_id": 46404016, "question_id": 46403678, "link": "https://stackoverflow.com/questions/46403678/directory-listing-wrong-links-in-golang-http-fileserver/46404016#46404016", "title": "Directory listing wrong links in golang http.FileServer()", "body": "<p>The problem is the pattern you register you handler with: <code>\"/download\"</code>.</p>\n\n<p>There are 2 problems with it:</p>\n\n<ol>\n<li><p>The generated URLs are wrong because the handler returned by the <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\"><code>http.FileServer()</code></a> function generates <em>relative</em> URLs to files and subfolders; relative to the root folder passed to <code>http.FileServer()</code>, and if your page is available under the path <code>/download</code>, a relative URL like <code>href=\"a.xml\"</code> will be resolved to <code>/a.xml</code>, and not to <code>/download/a.xml</code>.</p></li>\n<li><p>Even if the URLs would be good, the files would not be served as the requests would not get routed to your handled (to the file server handler). You must add a trailing slash, as <code>\"/download\"</code> only matches this single path, and not all paths starting with it. Add a trailing slash: <code>\"/download/\"</code> and it will match the rooted subtree <code>/download/*</code>.</p></li>\n</ol>\n\n<p>So the solution is:</p>\n\n<pre><code>r.PathPrefix(\"/download/\").Handler(\n    http.StripPrefix(\"/download\", http.FileServer(http.Dir(dirPath))),\n).Methods(\"GET\")\n</code></pre>\n\n<p>This is documented at <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\"><code>http.ServeMux</code></a>:</p>\n\n<blockquote>\n  <p>Patterns name fixed, rooted paths, like \"/favicon.ico\", or rooted subtrees, like \"/images/\" (note the trailing slash). </p>\n</blockquote>\n\n<p>Note that even though we're now using the <code>\"/download/\"</code> registered path, users are not required to type the trailing slash in the browser, as leaving that out the server will send a redirect to the path that ends with a trailing slash. This will happen automatically. This is also documented at <code>http.ServeMux</code>:</p>\n\n<blockquote>\n  <p><strong>If a subtree has been registered and a request is received naming the subtree root without its trailing slash, ServeMux redirects that request to the subtree root (adding the trailing slash).</strong> This behavior can be overridden with a separate registration for the path without the trailing slash. For example, registering \"/images/\" causes ServeMux to redirect a request for \"/images\" to \"/images/\", unless \"/images\" has been registered separately.</p>\n</blockquote>\n\n<p>Read related question: <a href=\"https://stackoverflow.com/questions/36316429/go-web-server-is-automatically-redirecting-post-requests/36316752#36316752\">Go web server is automatically redirecting POST requests</a></p>\n\n<p>Here's a simple file server app using only the standard library:</p>\n\n<pre><code>http.Handle(\"/dl/\",\n    http.StripPrefix(\"/dl\", http.FileServer(http.Dir(\"/home/bob/Downloads\"))),\n)\npanic(http.ListenAndServe(\"localhost:8080\", nil))\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 3369360, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1443307155/picture?type=large", "display_name": "Andrea Castello", "link": "https://stackoverflow.com/users/3369360/andrea-castello"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1145, "favorite_count": 0, "accepted_answer_id": 46404016, "answer_count": 1, "score": 2, "last_activity_date": 1506356374, "creation_date": 1506337414, "last_edit_date": 1506356374, "question_id": 46403678, "link": "https://stackoverflow.com/questions/46403678/directory-listing-wrong-links-in-golang-http-fileserver", "title": "Directory listing wrong links in golang http.FileServer()", "body": "<p>I'm using <code>http.FileServer</code> in Go to serve some static file into a directory.</p>\n\n<p>This is how I map it using mux as a router:</p>\n\n<pre><code>r.PathPrefix(\"/download\").Handler(http.StripPrefix(\"/download\", http.FileServer(http.Dir(dirPath)))).Methods(\"GET\")\n</code></pre>\n\n<p>where <code>dirPath</code> is an absolute path of a directory in my file system.</p>\n\n<p>Now it seems to work fine when asking the directory listing with localhost:8080/download, because it returns a page like this</p>\n\n<pre><code>&lt;pre&gt;\n&lt;a href=\"a.xml\"&gt;a.xml&lt;/a&gt;\n&lt;a href=\"b.xml\"&gt;b.zip&lt;/a&gt;\n&lt;/pre&gt;\n</code></pre>\n\n<p>Unfortunately the links are broken because I expect them to be mapped, for example to <code>localhost:8080/download/a.xml</code> , while file server maps them to <code>localhost:8080/a.xml</code>.</p>\n\n<p>How can I make my directory listing keep the <code>/download</code> path prefix in links?</p>\n"}, {"tags": ["c#", "go", "grpc"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1506334059, "post_id": 46402163, "comment_id": 79762411, "body": "I&#39;d suggest gathering, say, 30 seconds of runtime trace from one gRPC server instance so that it has 15 s before the alleged spike and 15 s after. The trace can be obtained by doing something like <code>curl &#39;http:&#47;&#47;endpoint&#47;debug&#47;pprof&#47;trace?seconds=30&#39; &gt;runtime.trace</code> You can then analyze it for any anomalies like spikes in the GC. On how to use the trace, see <code>go tool trace --help</code>. Besides extracting pprof-ready stuff from it, the <code>-http</code> flag enables viewing the trace using the Chromium-s built-in visualizer. See <a href=\"https://making.pusher.com/go-tool-trace/\" rel=\"nofollow noreferrer\">making.pusher.com/go-tool-trace</a> for more info."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506345741, "post_id": 46402163, "comment_id": 79770056, "body": "If the anomaly only appears exactly on the hour, and restarting it doesn&#39;t shift the spikes, It would make more sense to look for some external system factor, like a cron job that is taking too many resources. Though I don&#39;t know anything about the C# implementation, most systems add jitter to the deadlines to prevent spikes like these. If you&#39;re setting a 20ms deadline on the client, it&#39;s probably not long enough to cover when you need to make new connections."}, {"owner": {"reputation": 1569, "user_id": 875007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0d1a441a66752038990292e47973fa3d?s=128&d=identicon&r=PG", "display_name": "pratikvasa", "link": "https://stackoverflow.com/users/875007/pratikvasa"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1506511899, "post_id": 46402163, "comment_id": 79849210, "body": "@kostix I ran the trace as you suggested. I could not find any different behavior on the gRPC server. I also logged the time each call is taking on the server, all seems fine. I think I will look into what JimB suggested and look out for issues on the client side"}, {"owner": {"reputation": 1569, "user_id": 875007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0d1a441a66752038990292e47973fa3d?s=128&d=identicon&r=PG", "display_name": "pratikvasa", "link": "https://stackoverflow.com/users/875007/pratikvasa"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507094136, "post_id": 46402163, "comment_id": 80068722, "body": "@JimB you were right. There was a scheduled windows service that was running. And it was configured in a wrong way which caused hundreds of instances of the light job to run every hour. Thanks for your help."}], "answers": [{"comments": [{"owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "edited": false, "score": 0, "creation_date": 1507074698, "post_id": 46555081, "comment_id": 80064196, "body": "On the client side, another thing you can look at is the grpc debug logs, which should show when connections encounter errors.  (And if you&#39;re using a very recent version -- in the last week or two -- it now logs <i>all</i> connection state changes, regardless of cause.)"}], "tags": [], "owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "is_accepted": true, "score": 2, "last_activity_date": 1507074672, "creation_date": 1507074672, "answer_id": 46555081, "question_id": 46402163, "link": "https://stackoverflow.com/questions/46402163/getting-spikes-in-grpc-calls-every-hour/46555081#46555081", "title": "Getting spikes in gRPC calls every hour", "body": "<p>No, grpc-go does not refresh connections.  The only time it initiates a disconnect is if you configure \"max idle\" (<a href=\"https://godoc.org/google.golang.org/grpc/keepalive#ServerParameters\" rel=\"nofollow noreferrer\">ref</a>) and the connection has been idle for longer than that time limit.  By default this is disabled, so it's unlikely to be the culprit in this case.</p>\n"}], "owner": {"reputation": 1569, "user_id": 875007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/0d1a441a66752038990292e47973fa3d?s=128&d=identicon&r=PG", "display_name": "pratikvasa", "link": "https://stackoverflow.com/users/875007/pratikvasa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 46555081, "answer_count": 1, "score": 3, "last_activity_date": 1507074672, "creation_date": 1506332754, "question_id": 46402163, "link": "https://stackoverflow.com/questions/46402163/getting-spikes-in-grpc-calls-every-hour", "title": "Getting spikes in gRPC calls every hour", "body": "<p>I have a website running with around 7 servers (C#). And there is a gRPC service (golang) running with 3 instances. Each web server connects to and makes calls to the gRPC service. There are around 8000 calls per minute to the service. </p>\n\n<p>The call to this service is not that critical, so lately we reduced the deadline of the call to 20 milliseconds. Here we noticed something strange. There was a spike in the \"deadline exceeded\" errors every hour throughout the day. And it happens exactly at 0th minute i.e. 2pm 3pm 4pm etc.</p>\n\n<p><a href=\"https://i.stack.imgur.com/wTdhL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wTdhL.png\" alt=\"spike in errors\"></a></p>\n\n<p>Why does this happen?</p>\n\n<p>I came across <a href=\"https://github.com/GoogleCloudPlatform/cloud-bigtable-client/issues/1463\" rel=\"nofollow noreferrer\">this link</a> saying gRPC resets the connection every hour, but nothing more than that.</p>\n\n<p>So my question is does gRPC internally refresh the connection every hour. If yes is there anyway to tweak this behavior. If no then can someone give some direction as to how I can debug why this is happening.</p>\n"}, {"tags": ["go", "casting", "simplejson"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1506328778, "post_id": 46400746, "comment_id": 79758892, "body": "I don&#39;t think <code>simplejson</code> converts a json string value to an <code>int64</code> with <code>MustInt64</code>. Can you provide the json you&#39;re trying to parse?"}, {"owner": {"reputation": 137, "user_id": 5110276, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/282a3cb8d98ac6f2e8c13aa208dda48c?s=128&d=identicon&r=PG&f=1", "display_name": "kispi", "link": "https://stackoverflow.com/users/5110276/kispi"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1506328905, "post_id": 46400746, "comment_id": 79758962, "body": "Yes I found the reason, you&#39;re definitely right."}], "answers": [{"tags": [], "owner": {"reputation": 137, "user_id": 5110276, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/282a3cb8d98ac6f2e8c13aa208dda48c?s=128&d=identicon&r=PG&f=1", "display_name": "kispi", "link": "https://stackoverflow.com/users/5110276/kispi"}, "is_accepted": false, "score": 0, "last_activity_date": 1506328887, "creation_date": 1506328887, "answer_id": 46400961, "question_id": 46400746, "link": "https://stackoverflow.com/questions/46400746/golang-simplejson-mustint64-doesnt-convert-from-string-to-int64/46400961#46400961", "title": "golang simplejson mustint64 doesn&#39;t convert from string to int64", "body": "<p>The original json was:</p>\n\n<pre><code>{\"created_time\":\"1505733738\"}\n</code></pre>\n\n<p>Not</p>\n\n<pre><code>{\"created_time\":1505733738}\n</code></pre>\n\n<p>It's originally a STRING, not a NUMBER.</p>\n\n<p>So, when use MustInt64() to that json, it should return 0 because type is not matched.</p>\n\n<p>Right way to treat this is using strconv.</p>\n\n<pre><code>i64, err := strconv.ParseInt(m.Get(\"created_time\").MustString(), 10, 64)\n</code></pre>\n\n<p>And you'll get what you wanted as i64.</p>\n"}], "owner": {"reputation": 137, "user_id": 5110276, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/282a3cb8d98ac6f2e8c13aa208dda48c?s=128&d=identicon&r=PG&f=1", "display_name": "kispi", "link": "https://stackoverflow.com/users/5110276/kispi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506328887, "creation_date": 1506328221, "question_id": 46400746, "link": "https://stackoverflow.com/questions/46400746/golang-simplejson-mustint64-doesnt-convert-from-string-to-int64", "title": "golang simplejson mustint64 doesn&#39;t convert from string to int64", "body": "<p>I am using simplejson, and it provides type asserters.</p>\n\n<pre><code>fmt.Printf(\"%s %s\", m.Get(\"created_time\").MustString(), m.Get(\"created_time\").MustInt64())\n</code></pre>\n\n<p>above code shows this result:</p>\n\n<pre><code>1506259900 %!s(int64=0)\n</code></pre>\n\n<p>So MustInt64() gives 0 instead of converted Int64 value.</p>\n\n<p>Is it because the 1506259900 is too big to be converted?</p>\n\n<p>Thank for your help!</p>\n"}, {"tags": ["validation", "go", "timezone"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506350211, "post_id": 46400479, "comment_id": 79773233, "body": "If you have control over the frontend, see if you can change it so that it sends standard location strings, e.g. &quot;Europe/Berlin&quot;. &quot;GMT+01:00 CET&quot; is wrong half the year for people living in Germany, for instance, thanks to DST."}], "answers": [{"tags": [], "owner": {"reputation": 593, "user_id": 8960344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4695a4739b1539ab219c4d10459c7?s=128&d=identicon&r=PG", "display_name": "Nima Ghotbi", "link": "https://stackoverflow.com/users/8960344/nima-ghotbi"}, "is_accepted": false, "score": 0, "last_activity_date": 1506327762, "creation_date": 1506327762, "answer_id": 46400611, "question_id": 46400479, "link": "https://stackoverflow.com/questions/46400479/i-want-to-validate-timezone-at-the-backend-which-is-coming-from-the-frontend-in/46400611#46400611", "title": "I want to validate timezone at the backend which is coming from the frontend in golang", "body": "<p>I don't know if there is a library for this, but you can optimize the code by using a map insist of the array, so u don't have to iterate over it.</p>\n\n<pre><code>_, ok := timeZones[timeZoneField]\nreturn ok\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4866, "user_id": 215713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaa4a82dca6b5d2d0b58e784231caf3a?s=128&d=identicon&r=PG", "display_name": "rfay", "link": "https://stackoverflow.com/users/215713/rfay"}, "edited": false, "score": 0, "creation_date": 1561493177, "post_id": 46400633, "comment_id": 100079970, "body": "time.LoadLocation() can fail with <code>The system cannot find the path specified</code> on Windows (golang v1.12.1-v1.12.6)."}], "tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": false, "score": 5, "last_activity_date": 1506327825, "creation_date": 1506327825, "answer_id": 46400633, "question_id": 46400479, "link": "https://stackoverflow.com/questions/46400479/i-want-to-validate-timezone-at-the-backend-which-is-coming-from-the-frontend-in/46400633#46400633", "title": "I want to validate timezone at the backend which is coming from the frontend in golang", "body": "<p>You might be able to use <a href=\"https://golang.org/pkg/time/#LoadLocation\" rel=\"noreferrer\"><code>time.LoadLocation</code></a>.</p>\n\n<pre><code>func LoadLocation(name string) (*Location, error)\n</code></pre>\n\n<p>You can pass in a string such as \"America/New_York\" and the error return should tell you if it's valid.</p>\n\n<p>Note the format will be different from what you currently have. Check out <a href=\"https://www.iana.org/time-zones\" rel=\"noreferrer\">https://www.iana.org/time-zones</a></p>\n"}], "owner": {"reputation": 23, "user_id": 8337925, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eTxOq1UZ_bo/AAAAAAAAAAI/AAAAAAAAAAg/O1f3HcCBMx0/photo.jpg?sz=128", "display_name": "Prince Raj", "link": "https://stackoverflow.com/users/8337925/prince-raj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1506327825, "creation_date": 1506327300, "question_id": 46400479, "link": "https://stackoverflow.com/questions/46400479/i-want-to-validate-timezone-at-the-backend-which-is-coming-from-the-frontend-in", "title": "I want to validate timezone at the backend which is coming from the frontend in golang", "body": "<p>The front-end is sending timezones along with other user details during sign up. I need to put a validator on timezone for api testing.\nThe data in the timezone is of the format:</p>\n\n<pre><code>(GMT-10:00) Hawaii\n(GMT-08:00) Pacific Time (US &amp;amp; Canada)\n</code></pre>\n\n<p>What I did is define all the timezones in an array and then search for the received timezone. If it exists then ok else return err. My function is:</p>\n\n<pre><code>func timeZoneValidator(field validator.FieldLevel) bool {\n    if field.Field().Kind() != reflect.String {\n        return false\n    }\n    timeZoneField := field.Field().String()\n\n    for i:= range timeZones {\n        if timeZones[i] == timeZoneField {\n            // Found!\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n\n<p>But I want to use a library or something that does this task for me. If you got any, please advise.</p>\n"}, {"tags": ["python", "go", "exit"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1506326068, "post_id": 46400038, "comment_id": 79757385, "body": "Are you executing the command from Go, and you want the exit code of that app? Or you run your command e.g. from a shell, and you want to see what code it exists with?"}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 3, "creation_date": 1506326342, "post_id": 46400038, "comment_id": 79757536, "body": "If you tried something, and it did not work, please post in detail what you did and how it failed. In this case you say you tried to execute your program and did not get the correct exit code. It will be much easier to help you if you then 1. Posted how you ran your code. 2. Posted how you tried to obtain the exit code after you ran your program."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1506419104, "post_id": 46400038, "comment_id": 79803263, "body": "You&#39;re using <code>go build</code>. This will just compile the binary and not run it. Use <code>go run</code>. Also, you usually don&#39;t want to use <code>shell=True</code> in Python&#39;s subprocess. It&#39;s completely unnecessary and may open you up to security problems."}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 7895812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67716b6d5c93d993c9d5adb401bb4c36?s=128&d=identicon&r=PG&f=1", "display_name": "Dhanshree", "link": "https://stackoverflow.com/users/7895812/dhanshree"}, "edited": false, "score": 0, "creation_date": 1506334675, "post_id": 46400151, "comment_id": 79762768, "body": "I have added the sample python code which will be used for running and recording the exit code."}, {"owner": {"reputation": 24723, "user_id": 3150943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06074c6f020f2509f0b51a2c0ad3a9a8?s=128&d=identicon&r=PG", "display_name": "nu11p01n73R", "link": "https://stackoverflow.com/users/3150943/nu11p01n73r"}, "reply_to_user": {"reputation": 9, "user_id": 7895812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67716b6d5c93d993c9d5adb401bb4c36?s=128&d=identicon&r=PG&f=1", "display_name": "Dhanshree", "link": "https://stackoverflow.com/users/7895812/dhanshree"}, "edited": false, "score": 0, "creation_date": 1506335990, "post_id": 46400151, "comment_id": 79763545, "body": "@Dhanshree I have added an edit to give an example of python. Hope it helps"}], "tags": [], "owner": {"reputation": 24723, "user_id": 3150943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06074c6f020f2509f0b51a2c0ad3a9a8?s=128&d=identicon&r=PG", "display_name": "nu11p01n73R", "link": "https://stackoverflow.com/users/3150943/nu11p01n73r"}, "is_accepted": false, "score": 2, "last_activity_date": 1506335946, "last_edit_date": 1506335946, "creation_date": 1506326138, "answer_id": 46400151, "question_id": 46400038, "link": "https://stackoverflow.com/questions/46400038/how-to-get-different-exit-code-like-2-or-3-from-main-in-go-language/46400151#46400151", "title": "how to get different Exit code like 2 or 3 from main in go language?", "body": "<p>I guess you are using <code>go run</code> to execute. In this case the exit status is not available as your executable is not running in bash, <code>run</code> is executing it in a subprocess. To see the difference use <code>build</code> and execute them, </p>\n\n<p><strong>Example</strong></p>\n\n<pre><code>$ go build test.go\n$ ./test\n$ echo $?\n3\n</code></pre>\n\n<hr>\n\n<p><strong>Edit</strong></p>\n\n<p>If you are using a python program, you need not run the <code>echo $?</code>. This will give you a wrong answer because this is executed in a different shell than the one that executed the <code>./test</code> command.</p>\n\n<p>You can always read the exit status of the command from the <code>Popen.returncode</code>. The script can be modified as</p>\n\n<pre><code>from subprocess import Popen, PIPE\n\ndef console(cmd):\n    p = Popen(cmd, shell=True, stdout=PIPE)\n    out, err = p.communicate()\n    return (p.returncode, out, err)\n\nif __name__ == '__main__':\n    result = console('./test')\n    print result\n</code></pre>\n\n<p>This would give</p>\n\n<pre><code>$ python test.py\n(3, '', None)\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 7895812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67716b6d5c93d993c9d5adb401bb4c36?s=128&d=identicon&r=PG&f=1", "display_name": "Dhanshree", "link": "https://stackoverflow.com/users/7895812/dhanshree"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1506335946, "creation_date": 1506325755, "last_edit_date": 1506334586, "question_id": 46400038, "link": "https://stackoverflow.com/questions/46400038/how-to-get-different-exit-code-like-2-or-3-from-main-in-go-language", "title": "how to get different Exit code like 2 or 3 from main in go language?", "body": "<p>How do I get the exit code 3 or any non zero except 1 from main? I am trying to execute one program but when I execute will get exit code 1 instead of 3. If I want to get exit code 3 what I need to do?\nex:</p>\n\n<pre><code>package main\nimport \"os\"\nfunc main() {\n\n    // Exit with status code.\n    os.Exit(3)\n}\n</code></pre>\n\n<p>I want to run go script through python script Please find the python script below : </p>\n\n<pre><code>from subprocess import Popen, PIPE\n\ndef console(cmd):\n    p = Popen(cmd, shell=True, stdout=PIPE)\n    out, err = p.communicate()\n    return (p.returncode, out, err)\n\nif __name__ == '__main__':\n    result = console('go build test.go')\n    result = console('./test')\n    result = console('echo $?')\n    print 'returncode: %s' % result[0]\n    print 'output: %s' % result[1]\n    print 'error: %s' % result[2]\n</code></pre>\n\n<p>I want to record the exit status code in Python program which can be used further for other logic.</p>\n"}, {"tags": ["iframe", "go"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1506329216, "post_id": 46399945, "comment_id": 79759170, "body": "It&#39;s not clear from your question what you&#39;re doing with an iframe, you&#39;ll need to give a lot more detail if you want help. Also why don&#39;t you just redirect to a new page after a post?"}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1506331957, "post_id": 46399945, "comment_id": 79761057, "body": "@KennyGrant the iframe loads a website whose purpose is to handle product orders (among other things), for these product orders, the user will go through several steps, during which each step will make a form post (e.g. <code>&lt;form action=&quot;&#47;somepath&quot; target=&quot;my-iframe&quot; method=&quot;post&quot;&gt;</code>), the input values in said form post will be handled by the backend, and then a new HTML page will be loaded using the above <code>render</code> method. I do believe this qualifies as redirecting to a new page, but I may be misunderstanding you :)"}], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1506369787, "post_id": 46409662, "comment_id": 79784398, "body": "That&#39;s brilliant! <code>unrolled&#47;render</code> uses the default <code>html&#47;template</code> package, so I guess the problem is not related to that, but I do use <code>github.com&#47;gorilla&#47;sessions</code> where I call <code>sessions.Save(r, w)</code>.. hopefully removing that line will be enough to fix these problems.. thanks a lot :)!"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1506355862, "creation_date": 1506355862, "answer_id": 46409662, "question_id": 46399945, "link": "https://stackoverflow.com/questions/46399945/iframe-shows-blank-page-while-waiting-for-new-page-to-load-whereas-without-ifram/46409662#46409662", "title": "iframe shows blank page while waiting for new page to load whereas without iframe it doesn&#39;t", "body": "<p>From my experiments, it looks like browsers turn the iframe white as soon as the first byte of the response body arrives. My guess is that your own code or the render package sends bytes before the actual processing is done. You can see the behaviour with this sample program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    http.DefaultServeMux.Handle(\"/\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            w.Header().Set(\"content-type\", \"text/html\")\n            fmt.Fprintln(w, `&lt;iframe src=\"/frame\"&gt;&lt;/iframe&gt;`)\n    }))\n\n    http.DefaultServeMux.Handle(\"/frame/\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            w.Header().Set(\"content-type\", \"text/html\")\n\n            // Remove either of the following two calls and the iframe doesn't turn white.\n            fmt.Fprint(w, \" \")\n            w.(http.Flusher).Flush()\n\n            time.Sleep(2 * time.Second) // Lots of work to do...\n\n            fmt.Fprint(w, `\n                &lt;form style=\"background:red\" method=\"post\"&gt;\n                    &lt;button&gt;submit&lt;/button&gt;\n                &lt;/form&gt;\n            `)\n    }))\n\n    log.Fatal(http.ListenAndServe(\":4000\", nil))\n}\n</code></pre>\n\n<p>Remove the flush or the first write, and the iframe stays rendered pretty much all the time. Why this behaviour is different from the top document is beyond me.</p>\n\n<p>I'm not familiar with github.com/unrolled/render. See if there are writes that can be deferred until the end, or if you can buffer the response (body) before sending it down the wire.</p>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 645, "favorite_count": 0, "accepted_answer_id": 46409662, "answer_count": 1, "score": 1, "last_activity_date": 1506355862, "creation_date": 1506325398, "last_edit_date": 1506338171, "question_id": 46399945, "link": "https://stackoverflow.com/questions/46399945/iframe-shows-blank-page-while-waiting-for-new-page-to-load-whereas-without-ifram", "title": "iframe shows blank page while waiting for new page to load whereas without iframe it doesn&#39;t", "body": "<p>Before this gets downvoted to oblivion, I just want to say that I feel I have tried everything short of changing application to use AJAX and returning responses with JSON instead of rendering new HTML page as I do now (using Go's <a href=\"https://github.com/unrolled/render\" rel=\"nofollow noreferrer\">https://github.com/unrolled/render</a> package) - it will be A LOT of work to redo everything, so I hope that there's a solution that doesn't involve AJAX + JSON response</p>\n\n<p>Right now, whenever I do a form POST, at the end I render a new HTML page as such:</p>\n\n<pre><code>render.HTML(w, http.StatusOK, \"path/to/htmlfile/index\", map[string]interface{}{\n        csrf.TemplateTag:    csrf.TemplateField(r),\n        \"passing some data\": dataFromGo})\n</code></pre>\n\n<p>This works perfectly both locally and in production, BUT the moment I put it inside an iframe, then whenever I click the form submit the page becomes blank (white) for 1-2 seconds before the new HTML page is rendered (whereas when accessed without iframe then the original HTML content will remain displayed while waiting for the new content to be rendered). I feel it's really strange that this behavior only happens inside the iframe.</p>\n\n<p>Is there any solution to this? I have tried setting <code>&lt;iframe name=\"my-iframe\" ..&gt;</code> and in my form set <code>target=\"my-iframe\"</code>, I have tried adding <code>sandbox</code> to the iframe. I have tried other things that in hindsight were completely irrelevant to solving my problem :)</p>\n\n<p>By the way, the iframe src is another domain, but this is unavoidable</p>\n"}, {"tags": ["if-statement", "encryption", "go", "error-handling", "aes"], "comments": [{"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 3, "creation_date": 1506326584, "post_id": 46399597, "comment_id": 79757672, "body": "Here&#39;s a simplified version of what&#39;s going on: <a href=\"https://play.golang.org/p/LmTQB9qfGz\" rel=\"nofollow noreferrer\">play.golang.org/p/LmTQB9qfGz</a> it has nothing to do with crypto, aes and error handling. In general, don&#39;t use named returns unless you actually plan to use them (which your code doesn&#39;t). Remove the named returns and you&#39;ll immediately see what the problem is."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 3, "last_activity_date": 1506327540, "last_edit_date": 1506327540, "creation_date": 1506326304, "answer_id": 46400197, "question_id": 46399597, "link": "https://stackoverflow.com/questions/46399597/inconsistent-go-error-return-using-if-construction-with-cypher-aes/46400197#46400197", "title": "Inconsistent Go error return using if-construction with cypher/aes", "body": "<p>This is to do with scoping rules, here is a simplified example: </p>\n\n<p><a href=\"https://play.golang.org/p/1dCaUB948p\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1dCaUB948p</a></p>\n\n<pre><code>func encrypt2(plaintext []byte, key []byte) (encrypted []byte, err error) {\n    if _, err := returnErr(); err == nil {\n        fmt.Println(\"inner loop\")\n    }\n    return nil, err\n}\n</code></pre>\n\n<p>If you remove the named arguments, it won't compile, which gives a hint of the problem - the err declared in your if statement does not affect the outer scope, it is only valid within the if statement. If you remove the := assignment, you'll see what you expect. </p>\n\n<p>In go a more verbose version which returns on error is usually preferred, rather than lots of nested if statements, so that you can return specific errors and the flow of logic is clear. It's easy if nesting to forget scope or which variables are assigned when, whereas if you adopt this <a href=\"https://medium.com/@matryer/line-of-sight-in-code-186dd7cdea88\" rel=\"nofollow noreferrer\">return on error</a> style the reader knows at any given point no errors have been encountered. You don't have to annotate errors where the original error is self-evident of course, you could just return nil,err.  </p>\n\n<pre><code>func encrypt3(plaintext []byte, key []byte) ([]byte, error) {\n\n    c, err := aes.NewCipher(key)\n    if err != nil {\n        return nil, fmt.Errorf(\"encrypt: invalid key :%s\", err)\n    }\n\n    gcm, err := cipher.NewGCM(c)\n    if err != nil {\n        return nil, fmt.Errorf(\"encrypt: error creating cipher :%s\", err)\n    }\n\n    nonce := make([]byte, gcm.NonceSize())\n    _, err = io.ReadFull(rand.Reader, nonce)\n    if err != nil {\n        return nil, fmt.Errorf(\"encrypt: error creating nonce :%s\", err)\n    }\n\n    return gcm.Seal(nonce, nonce, plaintext, nil), nil\n}\n</code></pre>\n\n<p>If you're doing aes encryption in Go, a good ref is this <a href=\"https://github.com/gtank/cryptopasta/blob/master/encrypt.go\" rel=\"nofollow noreferrer\">code</a> and <a href=\"https://golangnews.com/stories/1469-video-crypto-for-go-developers-gophercon-crypto\" rel=\"nofollow noreferrer\">video</a> by George Tankersley.</p>\n"}], "owner": {"reputation": 43, "user_id": 3423990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52bb173f00d8f839b12ffe5a90b54240?s=128&d=identicon&r=PG", "display_name": "mhindery", "link": "https://stackoverflow.com/users/3423990/mhindery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 46400197, "answer_count": 1, "score": 1, "last_activity_date": 1506334875, "creation_date": 1506324005, "last_edit_date": 1506334875, "question_id": 46399597, "link": "https://stackoverflow.com/questions/46399597/inconsistent-go-error-return-using-if-construction-with-cypher-aes", "title": "Inconsistent Go error return using if-construction with cypher/aes", "body": "<p>I'm seeing strange behaviour where I should get an error back from a function, but I get nil instead.</p>\n\n<p>The following code block contains 2 encrypt functions using cypher/aes. The only difference is the first 1/2 lines of each function. In <code>encrypt2</code>, I've combined the assignment of the first line of <code>encrypt1</code> into the conditional.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/aes\"\n    \"crypto/cipher\"\n    \"crypto/rand\"\n    \"fmt\"\n    \"io\"\n)\n\nfunc main() {\n    invalidKey := []byte(\"TCbKgXZsT\")\n    plaintext := []byte(\"dummycontenttoenctrypt\")\n    fmt.Println(encrypt1(plaintext, invalidKey))\n    fmt.Println(encrypt2(plaintext, invalidKey))\n}\n\nfunc encrypt1(plaintext []byte, key []byte) (encrypted []byte, err error) {\n    c, err := aes.NewCipher(key)\n    if err == nil {\n        if gcm, err := cipher.NewGCM(c); err == nil {\n            nonce := make([]byte, gcm.NonceSize())\n            if _, err = io.ReadFull(rand.Reader, nonce); err == nil {\n                return gcm.Seal(nonce, nonce, plaintext, nil), nil\n            }\n        }\n    }\n    return nil, err\n}\n\nfunc encrypt2(plaintext []byte, key []byte) (encrypted []byte, err error) {\n    if c, err := aes.NewCipher(key); err == nil {\n        if gcm, err := cipher.NewGCM(c); err == nil {\n            nonce := make([]byte, gcm.NonceSize())\n            if _, err = io.ReadFull(rand.Reader, nonce); err == nil {\n                return gcm.Seal(nonce, nonce, plaintext, nil), nil\n            }\n        }\n    }\n    return nil, err\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/kBpEwOU75_\" rel=\"nofollow noreferrer\">Go Playground Link</a></p>\n\n<p>I expected the same behaviour from these functions, as the logic is the same. However, calling <code>encrypt1</code> returns an error (correct), while <code>encrypt2</code> does not return the error (returns just nil).</p>\n\n<p>I have used named arguments, so <code>err</code> is declared at the start of the function and should be populated by the first error in both functions.</p>\n\n<p>Anything I'm doing wrong here?</p>\n"}, {"tags": ["redirect", "go", "stdin"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506352250, "post_id": 46399395, "comment_id": 79774697, "body": "Perhaps you can use fmt.Fscanf instead. You can give it any io.Reader you like."}, {"owner": {"reputation": 28103, "user_id": 248616, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c0813ef73a1a468d754775e4cb276abe?s=128&d=identicon&r=PG", "display_name": "Nam G VU", "link": "https://stackoverflow.com/users/248616/nam-g-vu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506388903, "post_id": 46399395, "comment_id": 79790612, "body": "@Peter Thanks but I seek for <code>fmt.Scanf</code> solution."}], "answers": [{"comments": [{"owner": {"reputation": 28103, "user_id": 248616, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c0813ef73a1a468d754775e4cb276abe?s=128&d=identicon&r=PG", "display_name": "Nam G VU", "link": "https://stackoverflow.com/users/248616/nam-g-vu"}, "edited": false, "score": 0, "creation_date": 1506324709, "post_id": 46399567, "comment_id": 79756628, "body": "I need to stick with <code>fmt.Scanf()</code> i.e. the challenges on hackerrank.com do not use <code>fmt.Fscanf</code> in their submission template"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 28103, "user_id": 248616, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c0813ef73a1a468d754775e4cb276abe?s=128&d=identicon&r=PG", "display_name": "Nam G VU", "link": "https://stackoverflow.com/users/248616/nam-g-vu"}, "edited": false, "score": 1, "creation_date": 1506324755, "post_id": 46399567, "comment_id": 79756646, "body": "@NamGVU Then the 1st and 3rd solutions are viable for you. If you can&#39;t control how your app is started, then maybe only the 1st."}, {"owner": {"reputation": 28103, "user_id": 248616, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c0813ef73a1a468d754775e4cb276abe?s=128&d=identicon&r=PG", "display_name": "Nam G VU", "link": "https://stackoverflow.com/users/248616/nam-g-vu"}, "edited": false, "score": 0, "creation_date": 1506324782, "post_id": 46399567, "comment_id": 79756659, "body": "And also, I need to stick with non-piping from command line too i.e. need a solution within Golang code"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 28103, "user_id": 248616, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c0813ef73a1a468d754775e4cb276abe?s=128&d=identicon&r=PG", "display_name": "Nam G VU", "link": "https://stackoverflow.com/users/248616/nam-g-vu"}, "edited": false, "score": 1, "creation_date": 1506324813, "post_id": 46399567, "comment_id": 79756677, "body": "@NamGVU Ok, still, you can use the 1st solution."}, {"owner": {"reputation": 28103, "user_id": 248616, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c0813ef73a1a468d754775e4cb276abe?s=128&d=identicon&r=PG", "display_name": "Nam G VU", "link": "https://stackoverflow.com/users/248616/nam-g-vu"}, "edited": false, "score": 0, "creation_date": 1506324889, "post_id": 46399567, "comment_id": 79756728, "body": "I&#39;ll focus on your 1st suggestion - may you give details of how to archive that; I&#39;m so nob that I can&#39;t tell myself the which code is correct/best-fit"}, {"owner": {"reputation": 28103, "user_id": 248616, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c0813ef73a1a468d754775e4cb276abe?s=128&d=identicon&r=PG", "display_name": "Nam G VU", "link": "https://stackoverflow.com/users/248616/nam-g-vu"}, "edited": false, "score": 0, "creation_date": 1506325790, "post_id": 46399567, "comment_id": 79757216, "body": "Brilliant answer ever. Accepted a thousand times ^^"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1506347796, "last_edit_date": 1506347796, "creation_date": 1506323914, "answer_id": 46399567, "question_id": 46399395, "link": "https://stackoverflow.com/questions/46399395/golang-to-redirect-fmt-scanf-to-read-from-file-instead-of-os-stdin/46399567#46399567", "title": "Golang to redirect fmt.Scanf to read from file instead of os.Stdin", "body": "<h2>Setting a file as <code>os.Stdin</code></h2>\n\n<p>If this is truly what you want: <code>os.Stdin</code> is a variable (of type <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>*os.File</code></a>) which you can modify to your liking, you can assign a new value to it. Opening a file and assigning it to <code>os.Stdin</code>, <a href=\"https://golang.org/pkg/fmt/#Scanf\" rel=\"nofollow noreferrer\"><code>fmt.Scanf()</code></a> will read directly from that file. For details, see <a href=\"https://stackoverflow.com/questions/46365221/fill-os-stdin-for-function-that-reads-from-it/46365584#46365584\">Fill os.Stdin for function that reads from it</a>.</p>\n\n<p>Here's a complete example which opens a file named <code>a.txt</code>, sets it as <code>os.Stdin</code>, then calls <code>fmt.Scanf()</code> to read a <code>string</code> value from <code>os.Stdin</code> (indirectly from the <code>a.txt</code> file). The code below also handles saving and restoring the original value of <code>os.Stdin</code>. It is not needed here, but it serves as an example, and it's also good habit to restore global things you modify temporarily.</p>\n\n<pre><code>f, err := os.Open(\"a.txt\")\nif err != nil {\n    panic(err)\n}\ndefer f.Close()\n\noldStdin := os.Stdin\ndefer func() { os.Stdin = oldStdin }()\n\nos.Stdin = f\n\nvar s string\nif _, err := fmt.Scanf(\"%s\", &amp;s); err != nil {\n    fmt.Printf(\"Error reading: %v\", err)\n}\nfmt.Println(\"Read:\", s)\n</code></pre>\n\n<p>Note that you can also redirect <code>os.Stdout</code> to a file like:</p>\n\n<pre><code>f2, err := os.Create(\"out.txt\")\nif err != nil {\n    panic(err)\n}\ndefer f2.Close()\n\noldStdout := os.Stdout\ndefer func() { os.Stdout = oldStdout }()\n\nos.Stdout = f2\n\nfmt.Printf(\"This will be written to the file: %s\", f2.Name())\n</code></pre>\n\n<h2>Using <code>fmt.Fscanf()</code></h2>\n\n<p>An easier, better alternative would be to use <a href=\"https://golang.org/pkg/fmt/#Fscanf\" rel=\"nofollow noreferrer\"><code>fmt.Fscanf()</code></a> which is analogue to <code>fmt.Scanf()</code>, but here you can also pass an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a> to read from, and <code>os.File</code> implements <code>io.Reader</code>, so you can directly pass a file to it.</p>\n\n<h2>Redirecting a file to the standard input of your app</h2>\n\n<p>Another option would be to redirect a file to your app as its standard input when you launch your app. For example:</p>\n\n<pre><code>go run myapp.go &lt; a.txt\n</code></pre>\n\n<p>This command will start your app, streaming the contents of the <code>a.txt</code> file to the standard input of your app. And so <code>fmt.Scanf()</code> will read the contents of the <code>a.txt</code> file.</p>\n"}], "owner": {"reputation": 28103, "user_id": 248616, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c0813ef73a1a468d754775e4cb276abe?s=128&d=identicon&r=PG", "display_name": "Nam G VU", "link": "https://stackoverflow.com/users/248616/nam-g-vu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2032, "favorite_count": 3, "accepted_answer_id": 46399567, "answer_count": 1, "score": 3, "last_activity_date": 1506388925, "creation_date": 1506323200, "last_edit_date": 1506388925, "question_id": 46399395, "link": "https://stackoverflow.com/questions/46399395/golang-to-redirect-fmt-scanf-to-read-from-file-instead-of-os-stdin", "title": "Golang to redirect fmt.Scanf to read from file instead of os.Stdin", "body": "<p>Normally when we call <code>fmt.Scanf()</code> in Golang, the program will read from standard input stream i.e. <code>os.stdin</code></p>\n\n<p>I want, by Golang code, to make <code>fmt.Scanf()</code> to reading from a file stream - similarly to a <a href=\"https://stackoverflow.com/a/39482389/248616\">technique in Python here</a>.</p>\n\n<p>Please note that we have the piping workaround at command line level; here I'm looking for in-Golang code solution.</p>\n\n<p>If you know how to get there, please share.</p>\n\n<p>p.s.</p>\n\n<p>I guess it requires us to</p>\n\n<ul>\n<li>read from file stream and store in a string variable <code>bytes</code></li>\n<li>assign <code>bytes</code> to <code>os.stdin</code> stream </li>\n</ul>\n\n<p>Though I'm a Golang newbie and my <a href=\"https://www.google.com.vn/search?newwindow=1&amp;biw=1855&amp;bih=965&amp;q=golang+redirect+fmt.Scanf+to+read+from+file+instead+of+os.stdin&amp;oq=golang+redirect+fmt.Scanf+to+read+from+file+instead+of+os.stdin&amp;gs_l=psy-ab.3...117763.129164.0.129422.35.33.0.0.0.0.370.3709.5j18j3j1.27.0....0...1.1.64.psy-ab..9.5.732...0i7i30k1j33i21k1j33i160k1.0.hd_2NcoGc08\" rel=\"nofollow noreferrer\">google search</a> is not very helpful so I asked here.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1506327275, "post_id": 46398059, "comment_id": 79758046, "body": "<a href=\"https://github.com/gocarina/gocsv\" rel=\"nofollow noreferrer\">github.com/gocarina/gocsv</a>"}, {"owner": {"reputation": 929, "user_id": 793930, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/eames.jpg?s=128&g=1", "display_name": "Gautam", "link": "https://stackoverflow.com/users/793930/gautam"}, "edited": false, "score": 0, "creation_date": 1609852678, "post_id": 46398059, "comment_id": 115946373, "body": "The final version you posted has a trailing comma in the CSV representation. This was a problem for me, so I replaced the single line within the <code>for</code> loop with: <code>if i == 0 { formatString = &quot;%v%v&quot; } else { formatString = &quot;%v,%v&quot; } csvString = fmt.Sprintf(formatString, csvString, v.Field(i).Interface())</code>"}], "answers": [{"tags": [], "owner": {"reputation": 16323, "user_id": 355499, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/78892b9338a302a4ba3cc1aa77edd99f?s=128&d=identicon&r=PG", "display_name": "Emil H", "link": "https://stackoverflow.com/users/355499/emil-h"}, "is_accepted": false, "score": 1, "last_activity_date": 1506317048, "creation_date": 1506317048, "answer_id": 46398093, "question_id": 46398059, "link": "https://stackoverflow.com/questions/46398059/iterate-through-a-go-struct-to-get-a-csv-string/46398093#46398093", "title": "Iterate through a go struct to get a csv string", "body": "<p>One way would be to use the <code>reflect</code> package. There is a <a href=\"https://golang.org/pkg/reflect/#Value.Field\" rel=\"nofollow noreferrer\"><code>Value.Field(int) Value</code></a> method that might be usefull to you. You would essentially first call <a href=\"https://golang.org/pkg/reflect/#ValueOf\" rel=\"nofollow noreferrer\"><code>ValueOf(interface{}) Value</code></a> with your DataFields, and then have a simple loop calling <code>Field(int) Value</code> on the <code>Value</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 51, "user_id": 4844293, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dab7bace5be505340abb66369348118?s=128&d=identicon&r=PG&f=1", "display_name": "Pradeep Varadharajan", "link": "https://stackoverflow.com/users/4844293/pradeep-varadharajan"}, "edited": false, "score": 0, "creation_date": 1506355011, "post_id": 46399281, "comment_id": 79776453, "body": "Great. This answer was perfect. I was converting the Value field to a String directly like so <code>v.Field(i).String()</code> but I was not getting the actual string representation I was looking for.  I am guessing the String() was getting invoked on the Value receiver if the underlying concrete type was not a String. Is this expected?"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 51, "user_id": 4844293, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dab7bace5be505340abb66369348118?s=128&d=identicon&r=PG&f=1", "display_name": "Pradeep Varadharajan", "link": "https://stackoverflow.com/users/4844293/pradeep-varadharajan"}, "edited": false, "score": 0, "creation_date": 1506377565, "post_id": 46399281, "comment_id": 79787793, "body": "@PradeepVaradharajan It is expected. Take a look at <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">package fmt</a> for ways to format the fields and you can use <code>fmt.Sprintf</code> to convert them to string, Maybe <code>%v</code> the default go syntax representation for the value works for you."}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 2, "last_activity_date": 1521404853, "last_edit_date": 1521404853, "creation_date": 1506322718, "answer_id": 46399281, "question_id": 46398059, "link": "https://stackoverflow.com/questions/46398059/iterate-through-a-go-struct-to-get-a-csv-string/46399281#46399281", "title": "Iterate through a go struct to get a csv string", "body": "<p>What you are looking for is called <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflection</a>. <a href=\"https://stackoverflow.com/questions/18926303/iterate-through-a-struct-in-go\">This</a> answer explains how to use it to loop though a struct and get the values.</p>\n\n<p>This is the example the author uses on the other answer:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    x := struct{Foo string; Bar int }{\"foo\", 2}\n    v := reflect.ValueOf(x)\n    values := make([]interface{}, v.NumField())\n\n    for i := 0; i &lt; v.NumField(); i++ {\n        values[i] = v.Field(i).Interface()\n    }\n\n    fmt.Println(values)\n}\n</code></pre>\n\n<p>You can see it working on the <a href=\"http://play.golang.org/p/gSnZ8mLll-\" rel=\"nofollow noreferrer\">go playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1506326740, "creation_date": 1506326740, "answer_id": 46400315, "question_id": 46398059, "link": "https://stackoverflow.com/questions/46398059/iterate-through-a-go-struct-to-get-a-csv-string/46400315#46400315", "title": "Iterate through a go struct to get a csv string", "body": "<p>Another approach is to use <a href=\"https://blog.golang.org/generate\" rel=\"nofollow noreferrer\">code generation</a> which would generate a serializer code for you.</p>\n\n<p>The trade-offs are:</p>\n\n<ul>\n<li><p>Codegen is more compilcated in that it, most of the time, relies\non running an external program (though this could be made simpler by\nemploying <code>go run</code> as it's supposed to be always available).</p>\n\n<p>Every time you make a change to your data type adding or removing\na field which has to be serialized, you need to run <code>go generate</code>\nto regenerate the serializer code.</p>\n\n<p>On the flip side the resulting code is fast and robust,\nand the changes to the data type are usually seldom enough.</p></li>\n<li><p>Reflection is simpler in that it does not require thinking about\nregenerating the code.</p>\n\n<p>On the flip side, the code which uses <code>reflect</code> is usually ugly and quite hard to understand.  And of course it incurs runtime performance penalty.</p></li>\n</ul>\n"}], "owner": {"reputation": 51, "user_id": 4844293, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dab7bace5be505340abb66369348118?s=128&d=identicon&r=PG&f=1", "display_name": "Pradeep Varadharajan", "link": "https://stackoverflow.com/users/4844293/pradeep-varadharajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1366, "favorite_count": 0, "closed_date": 1506333627, "accepted_answer_id": 46399281, "answer_count": 3, "score": 1, "last_activity_date": 1521404853, "creation_date": 1506316814, "last_edit_date": 1506355148, "question_id": 46398059, "link": "https://stackoverflow.com/questions/46398059/iterate-through-a-go-struct-to-get-a-csv-string", "closed_reason": "Duplicate", "title": "Iterate through a go struct to get a csv string", "body": "<p>I have a struct representing a dataset that I need to write to a CSV file as a time-series data. This is what I have so far.</p>\n\n<pre><code>type DataFields struct {\n    Field1 int,\n    Field2 string,\n    ...\n    Fieldn int\n}\n\nfunc (d DataFields) String() string {\n    return fmt.Sprintf(\"%v,%v,...,%v\", Field1, Field2,..., Fieldn)\n}\n</code></pre>\n\n<p>Is there a way I can iterate through the members of the struct and construct a string object using it?</p>\n\n<p>Performance is not really an issue here and I was wondering if there was a way I could generate the string without having to modify the <code>String()</code> function if the structure changed in the future.</p>\n\n<p>EDITED to add my change below:</p>\n\n<p>This is what I ended up with after looking at the answers below.</p>\n\n<pre><code>func (d DataFields) String() string {\n    v := reflect.ValueOf(d)\n    var csvString string\n    for i := 0; i &lt; v.NumField(); i++ {\n        csvString = fmt.Sprintf(\"%v%v,\", csvString, v.Field(i).Interface())\n    }\n\n    return csvString\n}\n</code></pre>\n"}, {"tags": ["go", "bigint", "sum-of-digits"], "comments": [{"owner": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "edited": false, "score": 0, "creation_date": 1506297517, "post_id": 46395819, "comment_id": 79749138, "body": "<code>sum</code> here is undefined.  Did you forget to leave out a global definition?  Also, <code>number</code> (the argument to <code>add()</code>) is a <code>*big.Int</code>, so man of the operators in the <code>add</code> function don&#39;t make sense (i.e., <code>&#47;</code>, <code>&lt;</code>, <code>+</code>, and so on, which are not defined for <code>*big.Int</code> and <code>int</code> types)."}], "answers": [{"tags": [], "owner": {"reputation": 3674, "user_id": 1168038, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/J3Y6B.jpg?s=128&g=1", "display_name": "Jason Nichols", "link": "https://stackoverflow.com/users/1168038/jason-nichols"}, "is_accepted": true, "score": 1, "last_activity_date": 1506297490, "creation_date": 1506297490, "answer_id": 46395958, "question_id": 46395819, "link": "https://stackoverflow.com/questions/46395819/get-sum-of-bigint-number-golang/46395958#46395958", "title": "get sum of bigInt number golang", "body": "<p>Fixed it</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc factoral(n uint64) (r *big.Int) {\n\n    one, bn := big.NewInt(1), new(big.Int).SetUint64(n)\n\n    r = big.NewInt(1)\n    if bn.Cmp(one) &lt;= 0 {\n        return\n    }\n    for i := big.NewInt(2); i.Cmp(bn) &lt;= 0; i.Add(i, one) {\n        r.Mul(r, i)\n    }\n    return\n}\n\nfunc add(number *big.Int) *big.Int {\n    ten := big.NewInt(10)\n    sum := big.NewInt(0)\n    mod := big.NewInt(0)\n    for ten.Cmp(number)&lt;0 {\n      sum.Add(sum, mod.Mod(number,ten))\n      number.Div(number,ten)\n    }\n    sum.Add(sum,number)\n  return sum\n}\nfunc main() {\n    fmt.Println(add(factoral(100)))\n\n}\n</code></pre>\n\n<p>Seems your issue was likely with the way the Big Int object whose method you invoke is going to be the one the value is assigned to, and not necessarily one of the arguments.</p>\n\n<p>See: <a href=\"https://golang.org/pkg/math/big/#Int.Div\" rel=\"nofollow noreferrer\">https://golang.org/pkg/math/big/#Int.Div</a></p>\n"}], "owner": {"reputation": 155, "user_id": 2963022, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/a41f2db180cb8eb4ce70b64b0ec4a4b4?s=128&d=identicon&r=PG&f=1", "display_name": "user2963022", "link": "https://stackoverflow.com/users/2963022/user2963022"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2121, "favorite_count": 0, "accepted_answer_id": 46395958, "answer_count": 1, "score": 2, "last_activity_date": 1506297490, "creation_date": 1506295972, "question_id": 46395819, "link": "https://stackoverflow.com/questions/46395819/get-sum-of-bigint-number-golang", "title": "get sum of bigInt number golang", "body": "<blockquote>\n  <p>Hi i am new to the golang programming language. I can get the bigint\n  value from the factoral function but it is not working with the add\n  function.</p>\n  \n  <p>i have had the add function accepting bigint but when i try to add a\n  .Mod and .Div methods it returns 0 fro some reason. the if else\n  statement in the add function is an old statement i was using when i\n  had int values coming from the factoral function.</p>\n  \n  <p>it worked perfectly when it was as int value. When i attempted to\n  alter the if else statement to accept bigint values i couldn't get it\n  to work at all.</p>\n  \n  <p>I have tried the .Mod and .Div methods and they are printing out the\n  correct values. But when i try to .Add them together it always returns\n  0. even if the values are \"22\", \"2\". I've put the if else statement back to the original int values for now.</p>\n</blockquote>\n\n<p>if anyone can help me out with this one i would be very greatful. </p>\n\n<pre><code> package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc factoral(n uint64) (r *big.Int) {\n\n    one, bn := big.NewInt(1), new(big.Int).SetUint64(n)\n\n    r = big.NewInt(1)\n    if bn.Cmp(one) &lt;= 0 {\n        return\n    }\n    for i := big.NewInt(2); i.Cmp(bn) &lt;= 0; i.Add(i, one) {\n        r.Mul(r, i)\n    }\n    return\n}\n\nfunc add(number *big.Int) *big.Int {\n    //this the statement that works with normal int values\n    if number/10 &lt; 10 {\n        return sum + number/10\n    } else {\n        return sum + add(number/10)\n    }\n\n}\nfunc main() {\n    fmt.Println(add(factoral(100)))\n\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "google-container-registry", "govendor", "google-container-builder"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506293535, "post_id": 46395187, "comment_id": 79748406, "body": "If you don&#39;t have the vendor folder checked in, what is the point of using govendor?"}, {"owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506325318, "post_id": 46395187, "comment_id": 79756959, "body": "@JimB: My vendor.json file is checked in to ensure that dependencies are consistent in any environment. The actual source code for the dependencies is not checked in. Similar to node.js where package.json is added to Git, but the node_modules/ directory is not. Here&#39;s why I did not add the dependencies to Git: <a href=\"https://getcomposer.org/doc/faqs/should-i-commit-the-dependencies-in-my-vendor-directory.md\" rel=\"nofollow noreferrer\">getcomposer.org/doc/faqs/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506343075, "post_id": 46395187, "comment_id": 79768144, "body": "If you have the <code>.&#47;vendor&#47;vendor.json</code> file, <code>govendor</code> can build the vendor directory for you. Are you having a problem executing govendor? (for the record, most people prefer to check in the vendor directory, as it makes builds more reliable, and protects you against a dependency breaking or becoming completely unavailable)"}, {"owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506345192, "post_id": 46395187, "comment_id": 79769664, "body": "I don&#39;t know how to run <code>govendor</code> on Google Container Builder service, since it&#39;s not listed as one of the container-builders over here: <a href=\"https://github.com/GoogleCloudPlatform/cloud-builders\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/cloud-builders</a>. My understanding was the opposite, actually: that most people don&#39;t check in go dependencies. Are there special precautions I should consider before doing so?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506346433, "post_id": 46395187, "comment_id": 79770584, "body": "Those are just some open source examples, you can <a href=\"https://cloud.google.com/container-builder/docs/concepts/custom-build-steps\" rel=\"nofollow noreferrer\">create your own build steps</a>. The point of using &#39;./vendor` <i>is</i> to check in the dependencies. Take almost any major project and look at the vendor tree, e.g.  <a href=\"https://github.com/kubernetes/kubernetes/tree/master/vendor\" rel=\"nofollow noreferrer\">Kubernetes</a>, <a href=\"https://github.com/hashicorp/terraform/tree/master/vendor\" rel=\"nofollow noreferrer\">Terraform</a>, <a href=\"https://github.com/mholt/caddy/tree/master/vendor\" rel=\"nofollow noreferrer\">Caddy</a>, etc. There are no precautions to take, other than what you normally would do before using external code."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506350950, "post_id": 46395187, "comment_id": 79773787, "body": "None of composer&#39;s arguments against commiting dependencies apply, really. 1) VCS size: guess what, you still have to download all the dependencies. In fact, build systems often cache the local checkout (e.g. git pull instead of git clone), but not the dependencies. 2) govendor does not import the history. 3) govendor does not create submodules. Being able to just clone your project and you&#39;re ready to go is a huge boon. It avoids problem like the one you are having right now (and more). I suggest you reconsider commiting vendor."}], "answers": [{"tags": [], "owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "is_accepted": true, "score": 0, "last_activity_date": 1506351092, "creation_date": 1506351092, "answer_id": 46408191, "question_id": 46395187, "link": "https://stackoverflow.com/questions/46395187/google-container-builder-how-to-install-govendor-dependencies-during-build-step/46408191#46408191", "title": "Google Container Builder: How to install govendor dependencies during build step?", "body": "<p>As per @JimB and @Peter's comments to my question, an easy solution is to add my <code>vendor</code> directory to Git so I don't have to download all my dependencies during the build steps.</p>\n"}], "owner": {"reputation": 712, "user_id": 6905609, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-pijalSU6uPM/AAAAAAAAAAI/AAAAAAAAAAo/CozZmL4o2KA/photo.jpg?sz=128", "display_name": "Ismail Khan", "link": "https://stackoverflow.com/users/6905609/ismail-khan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "accepted_answer_id": 46408191, "answer_count": 1, "score": 0, "last_activity_date": 1506351092, "creation_date": 1506289535, "question_id": 46395187, "link": "https://stackoverflow.com/questions/46395187/google-container-builder-how-to-install-govendor-dependencies-during-build-step", "title": "Google Container Builder: How to install govendor dependencies during build step?", "body": "<p>I am trying to use Google Cloud Container Builder to automate the building of my containers using GCP Build Triggers</p>\n\n<p>My code is in Go, and I have a <code>vendor</code> folder in my project root which contains all of my Go dependencies (I use <code>govendor</code>). However, this <code>vendor</code> folder is NOT checked in to source control.</p>\n\n<p>I have a <code>cloudbuild.yaml</code> file where I first build my Go source into a <code>main</code> executable, and then build a Docker image using this executable. Container Builder ensures these build steps have access to my master branch.</p>\n\n<p>The problem is that the Go compilation step fails, because the <code>vendor</code> folder is not checked in to source control, so none of my dependencies are available for any build step.</p>\n\n<p><strong>Is there a way to create a build step that uses <code>govendor</code> to install all dependencies in the <code>vendor</code> folder?</strong> If so, how? Or is the only option to check in my <code>vendor</code> directory into source control (which seems unnecessary to me)?</p>\n"}, {"tags": ["windows", "go", "windows-console"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1506277191, "post_id": 46392778, "comment_id": 79743797, "body": "How precisely are you running that command?"}, {"owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "edited": false, "score": 0, "creation_date": 1506279392, "post_id": 46392778, "comment_id": 79744497, "body": "I hate to suggest something so basic, but have you tried restarting Windows? I feel like it shouldn\u2019t be necessary, but... it is Windows, after all ;)"}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 1, "creation_date": 1506300639, "post_id": 46392778, "comment_id": 79749629, "body": "It seems like something is killing conhost.exe (the console host process), or it&#39;s crashing. Try using the legacy console instead. In the console properties on the options tab, select the option to use the legacy console. Close it and try running a Go command in a new command prompt."}, {"owner": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "reply_to_user": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1510623315, "post_id": 46392778, "comment_id": 81503754, "body": "@eryksun I tried legacy console also tried running as administrator and compatibility on go.exe. It&#39;s still not working properly."}], "answers": [{"comments": [{"owner": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506285891, "post_id": 46393831, "comment_id": 79746619, "body": "Thanks for the help, however, the console window is still closing before I can read anything, the build command works but gives me no information if there is a compiler error. This never happened on any system I&#39;ve previously used."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506293248, "post_id": 46393831, "comment_id": 79748349, "body": "Wait. The command prompt you <i>manually opened</i> closes when the command finishes? That is impossible, you can&#39;t even do that if you want to. (Well, you probably could if you <i>really</i> wanted to, but it would be a horrid hack)"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506294368, "post_id": 46393831, "comment_id": 79748588, "body": "@Patrick What is the output of <code>go build -x -v  os 1&gt; out.txt 2&gt;&amp;1</code>? Eg, what does `out.txt contain?"}, {"owner": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506294769, "post_id": 46393831, "comment_id": 79748652, "body": "Yes that is exactly what is happening, the command window I manually opened closes when the command finishes, the out.txt file contains: WORK=C:\\Users\\*MY USERNAME*\\AppData\\Local\\Temp\\go-build872561830"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506295104, "post_id": 46393831, "comment_id": 79748699, "body": "Sadly, that output is <i>exactly</i> what it is suposed to be, no error messages or anything.  This is a very strange issue... Did the command prompt close after running the given comand as well?"}, {"owner": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506295220, "post_id": 46393831, "comment_id": 79748723, "body": "yup it closed but still generates the file, I don&#39;t see any text pop up before it closes either."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506295424, "post_id": 46393831, "comment_id": 79748761, "body": "Displaying no text is normal in this case (since output is redirected to the file), closing the window is very much <i>not</i> normal however. Hmm... Let me think for a bit."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506296010, "post_id": 46393831, "comment_id": 79748853, "body": "Try <code>go build -x -v os 1&gt; out.txt 2&gt;&amp;1 &amp;&amp; echo &quot;This sure is weird...&quot; 1&gt;&gt; out.txt 2&gt;&amp;1</code> If that produces the expected ouput (same as last time, but with the extra echoed line after it) then you can paste that same command into a new text file, rename to <code>test.bat</code>, and replace the <code>&amp;&amp;</code> with a newline. Run <code>test</code> and report results. If that fails in the same way then... Well I don&#39;t know what to tell you."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506296064, "post_id": 46393831, "comment_id": 79748865, "body": "Just to be clear, I am trying to figure out <i>when</i> exactly the window decides to close. This will help tell if it is a weird Windows issue or a Go problem."}, {"owner": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506297428, "post_id": 46393831, "comment_id": 79749122, "body": "the output is: WORK=C:\\Users\\*MY USERNAME*\\AppData\\Local\\Temp\\go-build967449950 &quot;This sure is weird...&quot;  with a newline after this sure is weird"}, {"owner": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506297572, "post_id": 46393831, "comment_id": 79749150, "body": "Do you think the installation could be at fault, maybe I should install Golang from source if possible"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506297921, "post_id": 46393831, "comment_id": 79749206, "body": "OK, that is the expected output again, but it obviously isn&#39;t quiting the command prompt until the Go command is finished. This is so weird it is beyond words, I no longer have any idea what the problem could be... You can try uninstalling Go, making sure to clear out any changes to your environment, and install manually from the archive distrabution, restarting your computer after uninstalling, and after reinstalling, <i>maybe</i> that will help..."}, {"owner": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 0, "creation_date": 1506298968, "post_id": 46393831, "comment_id": 79749365, "body": "Oh boy... That&#39;s exactly what I did before resorting to asking a question on SO, do you think I should file a bug report or something?"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "edited": false, "score": 1, "creation_date": 1506299789, "post_id": 46393831, "comment_id": 79749490, "body": "Ask on the Go Nuts mailing list first, you are more likely to get a true expert that way."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 3, "last_activity_date": 1506280140, "creation_date": 1506280140, "answer_id": 46393831, "question_id": 46392778, "link": "https://stackoverflow.com/questions/46392778/golang-windows-console-exits-while-running-go-exe/46393831#46393831", "title": "Golang - windows console exits while running go.exe", "body": "<p>Press <code>win+r</code> and in the resulting dialog type <code>%COMSPEC%</code>. This will start a new copy of the SPECified COMmand interperter, by default <code>cmd.exe</code> on most modern Windows versions.</p>\n\n<p>Run your Go commands in this new window or others like it.</p>\n\n<p>Your problem seems to be that you are trying to run the commands directly. Windows automatically creates a command prompt to run these commands in, but it closes as soon as the command is finished, before you can read the output.</p>\n"}, {"tags": [], "owner": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "is_accepted": true, "score": 0, "last_activity_date": 1510679380, "creation_date": 1510679380, "answer_id": 47291534, "question_id": 46392778, "link": "https://stackoverflow.com/questions/46392778/golang-windows-console-exits-while-running-go-exe/47291534#47291534", "title": "Golang - windows console exits while running go.exe", "body": "<p>I figured it out, I have Cygwin installed and I put it in my path environment variable. Turns out the git installation from Cygwin was interfering with the regular up to date, git installation. This was causing go with args to only work if I had the Cygwin terminal running. On golang-nuts someone also mentioned that some git versions have some bug where come.exe is called causing go commands to fail on windows.</p>\n\n<p>To fix I just removed Cygwin from path and updated git to latest version.</p>\n"}], "owner": {"reputation": 305, "user_id": 3163763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78fed1cdbd8bfb1fe38e5d27848b5a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick", "link": "https://stackoverflow.com/users/3163763/patrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1785, "favorite_count": 0, "accepted_answer_id": 47291534, "answer_count": 2, "score": -1, "last_activity_date": 1510679380, "creation_date": 1506273484, "last_edit_date": 1510671928, "question_id": 46392778, "link": "https://stackoverflow.com/questions/46392778/golang-windows-console-exits-while-running-go-exe", "title": "Golang - windows console exits while running go.exe", "body": "<p>I installed Go in Windows 10 with the MSI installer. However, when I run go in cmd (or PowerShell) with an argument, such as env, build, install, list, ...\nThe console window closes (or crashes?) after the go command is run. This prevents me from seeing any errors or anything while compiling go code.</p>\n\n<p>Is there some sort of log in windows which contains console host data, such as crashing, errors, and warnings? This would be very helpful to find out if console or console host is crashing for some reason.</p>\n\n<p><strong>As an example:</strong></p>\n\n<pre><code>go env\n</code></pre>\n\n<p>won't output anything and the console window will immediately close.</p>\n\n<p>Edit: Just to clarify, I am not running this command in the run dialog, I am running it from an administrator command prompt (I tried using PowerShell, also no luck). If I run:</p>\n\n<pre><code>go help\n</code></pre>\n\n<p>It will work properly. However, as soon as I run go with any other argument, such as:</p>\n\n<pre><code>go install &lt;target&gt;\n</code></pre>\n\n<p>or</p>\n\n<pre><code>go build &lt;target&gt;\n</code></pre>\n\n<p>The process will work but the console will exit before giving me any information.</p>\n\n<p>Edit:</p>\n\n<p><strong>I've discovered a temporary fix... If I run go commands in a Cygwin terminal they work as usual. This is very strange.</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506277385, "post_id": 46392112, "comment_id": 79743857, "body": "Where are you very often seeing .go files committed in pkg directories? It&#39;s not common, it just happens to be the name of a directory in the kubernetes source."}, {"owner": {"reputation": 5824, "user_id": 306025, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8de1991653891b99ffb1c6b70df815fc?s=128&d=identicon&r=PG", "display_name": "abovesun", "link": "https://stackoverflow.com/users/306025/abovesun"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506278371, "post_id": 46392112, "comment_id": 79744198, "body": "yes, thats was part of my question, I was wondering if kuberenetes team has particular reason to name it like that"}], "answers": [{"comments": [{"owner": {"reputation": 5824, "user_id": 306025, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8de1991653891b99ffb1c6b70df815fc?s=128&d=identicon&r=PG", "display_name": "abovesun", "link": "https://stackoverflow.com/users/306025/abovesun"}, "edited": false, "score": 0, "creation_date": 1506275218, "post_id": 46392534, "comment_id": 79743166, "body": "thanks for reply, I just confused when they using &#39;reserved&#39; folder name to store sources but actually it possible to use any other folder name here. Any particular reason for that?"}, {"owner": {"reputation": 108, "user_id": 5356496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9eiku.jpg?s=128&g=1", "display_name": "goofle", "link": "https://stackoverflow.com/users/5356496/goofle"}, "reply_to_user": {"reputation": 5824, "user_id": 306025, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8de1991653891b99ffb1c6b70df815fc?s=128&d=identicon&r=PG", "display_name": "abovesun", "link": "https://stackoverflow.com/users/306025/abovesun"}, "edited": false, "score": 0, "creation_date": 1506318803, "post_id": 46392534, "comment_id": 79753790, "body": "No. No particular reason. You&#39;re right, they could use any other folder name, but &quot;they&quot; decided to name that folder pkg. Maybe because they thought it&#39;s more familiar to the eyes of other go developers, indicating that folder is where the *.go files can be found. But this isn&#39;t the common practice. Usually developers leave everything in the project root. e.g. Look up labstack/echo project."}], "tags": [], "owner": {"reputation": 108, "user_id": 5356496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9eiku.jpg?s=128&g=1", "display_name": "goofle", "link": "https://stackoverflow.com/users/5356496/goofle"}, "is_accepted": true, "score": 0, "last_activity_date": 1506334832, "last_edit_date": 1506334832, "creation_date": 1506272160, "answer_id": 46392534, "question_id": 46392112, "link": "https://stackoverflow.com/questions/46392112/understanding-need-to-place-go-files-under-pkg-folder/46392534#46392534", "title": "Understanding need to place .go files under pkg folder?", "body": "<p>Please clarify further.</p>\n\n<ul>\n<li><p>The <code>pkg</code> folder on that repo you linked is where they put the packages they wrote. Reason? well they need to put them somewhere, they chose <code>pkg</code>.</p></li>\n<li><p>You use <code>vendor</code> folder when you don't want future changes to 3rd party packages you've used possibly make your program unstable, in that case you \"vendor\" those 3rd party packages. So you don't put your own packages in <code>vendor</code> folder for obvious reasons. </p></li>\n<li><p>Which <code>src</code>? <code>$GOPATH/src</code>? you can do it! probably, I haven't test it. But you can only have one project in that case, and that's the project that you've placed there.</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1506281198, "last_edit_date": 1506281198, "creation_date": 1506280480, "answer_id": 46393881, "question_id": 46392112, "link": "https://stackoverflow.com/questions/46392112/understanding-need-to-place-go-files-under-pkg-folder/46393881#46393881", "title": "Understanding need to place .go files under pkg folder?", "body": "<p>There's <strong>no need</strong> to have your project's files under a <code>pkg</code> folder. And there's no need to have a <code>pkg</code> folder, inside your project, in the first place.</p>\n\n<p><code>pkg</code> <strong>is not</strong> a \"reserved\" folder name, at least not in the context of your project.</p>\n\n<p><code>vendor</code>, on the other hand, has special significance for the Go compiler and is inteded to hold code that was written as part of a separate project, e.g. 3rd party packages. Therefore it makes no sense, for the linked project, to move the code they have under <code>pkg</code> into <code>vendor</code>.</p>\n\n<p>If you want to understand why kubernetes or other projects decided to use <code>pkg</code> you would best be served by enquiring through those projects' communication channels (mailing lists, irc, social media, etc).</p>\n"}], "owner": {"reputation": 5824, "user_id": 306025, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8de1991653891b99ffb1c6b70df815fc?s=128&d=identicon&r=PG", "display_name": "abovesun", "link": "https://stackoverflow.com/users/306025/abovesun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "closed_date": 1506332686, "accepted_answer_id": 46392534, "answer_count": 2, "score": -2, "last_activity_date": 1506334832, "creation_date": 1506269472, "question_id": 46392112, "link": "https://stackoverflow.com/questions/46392112/understanding-need-to-place-go-files-under-pkg-folder", "closed_reason": "Needs details or clarity", "title": "Understanding need to place .go files under pkg folder?", "body": "<p>It's very often I see .go files committed to pkg folder, like here <a href=\"https://github.com/kubernetes/apiserver\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/apiserver</a> what particular reason doing that vs using vendor folder for 3rdparty dependencies or commit your own code into src dir?</p>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1506261630, "post_id": 46390796, "comment_id": 79738900, "body": "It&#39;s possible if <code>DoSomething()</code> returns an object with a <code>WithThisOptionalThing()</code> method on it--same as in any other language. I don&#39;t really understand what you&#39;re asking, though."}, {"owner": {"reputation": 12214, "user_id": 6785908, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4d260895797435b1e59b3c2154a469f7?s=128&d=identicon&r=PG&f=1", "display_name": "so-random-dude", "link": "https://stackoverflow.com/users/6785908/so-random-dude"}, "edited": false, "score": 0, "creation_date": 1506281751, "post_id": 46390796, "comment_id": 79745263, "body": "reminds me of builder pattern :)"}], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 8, "last_activity_date": 1506263013, "creation_date": 1506263013, "answer_id": 46391066, "question_id": 46390796, "link": "https://stackoverflow.com/questions/46390796/go-chained-function-calls/46391066#46391066", "title": "Go chained function calls?", "body": "<p>Basically, you make all your configuration functions keep returning the main \"object\" while you chain things together and have a final \"Go\" function or whatever you want to call it to make it perform the action.</p>\n\n<p>Here's an example on <a href=\"https://play.golang.org/p/_OvHGknvBa\" rel=\"noreferrer\">play</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    DoSomething().Go()\n    DoSomething().WithThisOptionalThing().Go()\n}\n\ntype Chainable struct {\n    thing bool\n}\n\nfunc DoSomething() *Chainable {\n    return &amp;Chainable{}\n}\nfunc (c *Chainable) WithThisOptionalThing() *Chainable {\n    c.thing = true\n    return c\n}\n\nfunc (c *Chainable) Go() error {\n    // Actually do something now that it's been configured\n    fmt.Println(\"Thing is\", c.thing)\n    return nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 108, "user_id": 5356496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9eiku.jpg?s=128&g=1", "display_name": "goofle", "link": "https://stackoverflow.com/users/5356496/goofle"}, "is_accepted": false, "score": 0, "last_activity_date": 1506273084, "creation_date": 1506273084, "answer_id": 46392707, "question_id": 46390796, "link": "https://stackoverflow.com/questions/46390796/go-chained-function-calls/46392707#46392707", "title": "Go chained function calls?", "body": "<p>You just need to know: When it comes to chaining things your methods should either always </p>\n\n<ul>\n<li>receive <code>pointers</code> and return <code>pointers</code></li>\n</ul>\n\n<p>or</p>\n\n<ul>\n<li>receive <code>values</code> and return <code>values</code></li>\n</ul>\n\n<p>or</p>\n\n<ul>\n<li>receive <code>values</code> and return <code>pointers</code></li>\n</ul>\n\n<p>at least they're the working combinations known to me. I couldn't find any documentation on this. If you know what's going on please let me know.</p>\n"}], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1506281720, "creation_date": 1506261221, "last_edit_date": 1506281720, "question_id": 46390796, "link": "https://stackoverflow.com/questions/46390796/go-chained-function-calls", "title": "Go chained function calls?", "body": "<p>Not sure what the correct name is, but I'm looking for more information about \"chained function calls\" in Go. For example:</p>\n\n<p><code>foo.DoSomething().WithThisOptionalThing()</code></p>\n\n<p>So I can use <code>foo.DoSomething()</code> but with the possibility to add <code>.WithThisOptionalThing()</code> which does something extra's. Is this possible? Please point me in the right direction / provide some examples.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506277572, "post_id": 46390409, "comment_id": 79743931, "body": "Are you sure you really even want a <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\"><code>sync.Map</code></a>? It has a very particular use case, and even documents that outside of its intended use case <code>&quot;it will likely have comparable or worse performance and worse type safety than an ordinary map paired with a read-write mutex&quot;</code>"}, {"owner": {"reputation": 91, "user_id": 8664527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce323cf1fe03d32dedc1ec05bb5f496?s=128&d=identicon&r=PG&f=1", "display_name": "zengxiaobai2", "link": "https://stackoverflow.com/users/8664527/zengxiaobai2"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506301306, "post_id": 46390409, "comment_id": 79749755, "body": "I have a webserver to serve much clients, each client may use a goroutine to request the server and lookup the map on the server. Then the server response the result to each request . Also the server have one goroutine to update the map every 10 minutes  by requesting to a remote server. I will test the performance for each map type, thanks for your reminding."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506351112, "post_id": 46390409, "comment_id": 79773898, "body": "sync.RWMutex seems absolutely reasonable for writes every 10 minutes."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 8, "last_activity_date": 1549047356, "last_edit_date": 1549047356, "creation_date": 1506260103, "answer_id": 46390611, "question_id": 46390409, "link": "https://stackoverflow.com/questions/46390409/how-to-decode-json-strings-to-sync-map-instead-of-normal-map-in-go1-9/46390611#46390611", "title": "How to decode json strings to sync.Map instead of normal map in Go1.9?", "body": "<p>You cannot directly unmarshal into a <code>sync.Map</code>, because <code>sync.Map</code> has no exported fields (so the Unmarshaler doesn't have any way to store data in it), and it doesn't implement the <code>json.Unmarshaler</code> interface.</p>\n\n<p>So you'll have to handle this yourself, probably by including a <code>sync.Map</code> in a type of your own, and implementing <code>json.Unmarshaler</code> on that type:</p>\n\n<pre><code>type Foo struct {\n    sync.Map\n}\n\nfunc (f *Foo) UnmarshalJSON(data []byte) error {\n    var tmpMap map[string]interface{}\n    if err := json.Unmarshal(data, &amp;tmpMap); err != nil {\n        return err\n    }\n    for key, value := range tmpMap {\n        f.Store(key, value)\n    }\n    return nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 6845641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/507f7bcfdb7aab6b69221a485482fff1?s=128&d=identicon&r=PG&f=1", "display_name": "Jakub Sacha", "link": "https://stackoverflow.com/users/6845641/jakub-sacha"}, "is_accepted": false, "score": 8, "last_activity_date": 1517511063, "creation_date": 1517511063, "answer_id": 48569829, "question_id": 46390409, "link": "https://stackoverflow.com/questions/46390409/how-to-decode-json-strings-to-sync-map-instead-of-normal-map-in-go1-9/48569829#48569829", "title": "How to decode json strings to sync.Map instead of normal map in Go1.9?", "body": "<p>In case you need a snippet to do it another way around</p>\n\n<pre><code>func (f Foo) MarshalJSON() ([]byte, error) {\n    tmpMap := make(map[YourTypeOfKey]YourTypeOfValue)\n    f.Range(func(k, v interface{}) bool {\n        tmpMap[k.(YourTypeOfKey)] = v.(YourTypeOfValue)\n        return true\n    })\n    return json.Marshal(tmpMap)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 720, "user_id": 3431636, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/x1Vlv.jpg?s=128&g=1", "display_name": "Seraf", "link": "https://stackoverflow.com/users/3431636/seraf"}, "is_accepted": false, "score": 3, "last_activity_date": 1613871091, "last_edit_date": 1613871091, "creation_date": 1608840746, "answer_id": 65442862, "question_id": 46390409, "link": "https://stackoverflow.com/questions/46390409/how-to-decode-json-strings-to-sync-map-instead-of-normal-map-in-go1-9/65442862#65442862", "title": "How to decode json strings to sync.Map instead of normal map in Go1.9?", "body": "<p>Just adding to @jakub great answer about <code>MarshalJSON</code>, you can also have a generic function that doesn't check the type (since json doesn't care either)</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func MarshalJSON(m *sync.Map) ([]byte, error) {\n    tmpMap := make(map[interface{}]interface{})\n    m.Range(func(k, v interface{}) bool {\n        tmpMap[k] = v\n        return true\n    })\n    return json.Marshal(tmpMap)\n}\n</code></pre>\n<p>This could take any kind of <code>sync.Map</code> and just Marshal it.</p>\n<p>To add to the <code>UnMarshal</code> function from @Flimzy's answer, you can play a bit with the types by omitting the string part to make it more generics (pun intended, cry in corner):</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func UnmarshalJSON(data []byte) (*sync.Map, error) {\n    var tmpMap map[interface{}]interface{}\n    m := &amp;sync.Map{}\n\n    if err := json.Unmarshal(data, &amp;tmpMap); err != nil {\n        return m, err\n    }\n\n    for key, value := range tmpMap {\n        m.Store(key, value)\n    }\n    return m, nil\n}\n</code></pre>\n<p>In general it is good to play with the same Types when doing this sort of manipulation, because we are lazy and we don't want to rewrite functions ;)</p>\n"}], "owner": {"reputation": 91, "user_id": 8664527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce323cf1fe03d32dedc1ec05bb5f496?s=128&d=identicon&r=PG&f=1", "display_name": "zengxiaobai2", "link": "https://stackoverflow.com/users/8664527/zengxiaobai2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1640, "favorite_count": 0, "answer_count": 3, "score": 5, "last_activity_date": 1613871091, "creation_date": 1506258762, "last_edit_date": 1506260471, "question_id": 46390409, "link": "https://stackoverflow.com/questions/46390409/how-to-decode-json-strings-to-sync-map-instead-of-normal-map-in-go1-9", "title": "How to decode json strings to sync.Map instead of normal map in Go1.9?", "body": "<p>I can decode json strings to a map with go language like this:</p>\n\n<pre><code>func main(){\n  date := []byte(`{\"127.1\":{\"host\":\"host1\",\"list\":[\"list123\",\"list456\"]},\"127.2\":{\"host\":\"host2\",\"list\":[\"list223\",\"list256\"]}}`)\n  var x interface{}\n  json.Unmarshal(date, &amp;x)\n  t := x.(map[string]interface{})\n  var aa []interface{}\n  aa = (t[\"127.2\"].(map[string]interface{})[\"list\"])\n  for _, v := range aa {\n     fmt.Println(v.(string))\n  }\n}\n</code></pre>\n\n<p>but I wonder how to decode it to a sync.Map in Go1.9. I have tried many ways but failed, can anyone help me?</p>\n\n<p>I tried like this:</p>\n\n<pre><code>    func main(){\n      date := []byte(`{\"127.1\":{\"host\":\"host1\",\"list\":[\"list123\",\"list456\"]},\"127.2\":{\"host\":\"host2\",\"list\":[\"list223\",\"list256\"]}}`)\n      var x interface{}\n      json.Unmarshal(date, &amp;x)\n      t := x.((sync.Map)[string]interface{})  //compile error\n}\n</code></pre>\n\n<p>Also I tried like this:</p>\n\n<pre><code>    func main(){\n      date := []byte(`{\"127.1\":{\"host\":\"host1\",\"list\":[\"list123\",\"list456\"]},\"127.2\":{\"host\":\"host2\",\"list\":[\"list223\",\"list256\"]}}`)\n      var x sync.Map\n      json.Unmarshal(date, &amp;x)\n      fmt.Println(x) // but the map has nothing\n}\n</code></pre>\n"}, {"tags": ["go", "linter"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 7, "last_activity_date": 1506253833, "last_edit_date": 1506253833, "creation_date": 1506253576, "answer_id": 46389699, "question_id": 46389607, "link": "https://stackoverflow.com/questions/46389607/goconst-warnings-from-linter/46389699#46389699", "title": "goconst warnings from linter", "body": "<p>It's just a warning that you're re-using the same string literal in multiple places.  This can be problematic because string literals are liable to be misspelled without noticing.  The solution is to use a constant instead.  This is made very easy in your case, because all of the (standard) HTTP verbs are already constants exported by the <code>http</code> package.  Just update your string literals to use the contant version instead:</p>\n\n<pre><code>func (a *App) PageLogin(res http.ResponseWriter, req *http.Request) {\n        switch r.Method {\n            case http.MethodGet:\n                // Serve the resource.\n            case http.MethodPost:\n                // Create a new record.\n            case http.MethodPut:\n                // Update an existing record.\n            case http.MethodDelete:\n                // Remove the record.\n            default:\n                // Give an error message.\n        }\n}\n</code></pre>\n\n<p>By using a constant, you safeguard against an accidental typo.  Example:</p>\n\n<pre><code>req, err := http.NewRequest(\"DLETE\", ...)\n</code></pre>\n\n<p>would not result in a compile-time error (and may not even result in a runtime error, depending on the rest of your program's logic), but</p>\n\n<pre><code>req, err := http.NewRequest(http.MethodDlete, ...)\n</code></pre>\n\n<p>will fail to compile.</p>\n"}], "owner": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 701, "favorite_count": 0, "accepted_answer_id": 46389699, "answer_count": 1, "score": 3, "last_activity_date": 1572698498, "creation_date": 1506252844, "last_edit_date": 1572698498, "question_id": 46389607, "link": "https://stackoverflow.com/questions/46389607/goconst-warnings-from-linter", "title": "goconst warnings from linter", "body": "<p>I'm using Atom to develop my Go app. The Linter in Atom is reporting an odd warning, and I don't see how it's a problem. Should I forever ignore the warning, or is there an alternate method I can implement?</p>\n\n<p><strong>Error:</strong> <code>Warning goconst 3 other occurrence(s) of \"GET\" found in: routes_pages.go:384:8 routes_pages.go:443:7 routes_pages.go:536:7 (goconst)    198:8</code></p>\n\n<p><strong>Details:</strong></p>\n\n<p>I have routes in a file \"app.go\":</p>\n\n<pre><code>a.Router.HandleFunc(\"/login\", a.PageLogin)\na.Router.HandleFunc(\"/register\", a.PageRegister)\na.Router.HandleFunc(\"/event/add\", a.PageEventCreate)\n</code></pre>\n\n<p>In a \"routes_pages.go\" file, I have func's defined like so:</p>\n\n<pre><code>func (a *App) PageEventCreate(w http.ResponseWriter, r *http.Request) {\n\n    switch r.Method {\n        case \"GET\":\n            // Serve the resource.\n        case \"POST\":\n            // Create a new record.\n        case \"PUT\":\n            // Update an existing record.\n        case \"DELETE\":\n            // Remove the record.\n        default:\n            // Give an error message.\n    }\n\n}\n\n\n\nfunc (a *App) PageLogin(res http.ResponseWriter, req *http.Request) {\n        switch r.Method {\n            case \"GET\":\n                // Serve the resource.\n            case \"POST\":\n                // Create a new record.\n            case \"PUT\":\n                // Update an existing record.\n            case \"DELETE\":\n                // Remove the record.\n            default:\n                // Give an error message.\n        }\n\n}\n</code></pre>\n\n<p>I have a multitude of func's setup this way. It makes it easy to work on any case (GET, POST, etc) in one place.</p>\n\n<p>The Linter in Atom has a problem with this. It's reporting a warning for each item, for example:</p>\n\n<pre><code>Warning goconst 3 other occurrence(s) of \"GET\" found in: routes_pages.go:384:8 routes_pages.go:443:7 routes_pages.go:536:7 (goconst)    198:8\n</code></pre>\n\n<p>This warning occurs many times; once for every instance of switch/case with GET, PUT, DELETE, etc; ultimately, for me it's a huge list (thus a huge error list).</p>\n\n<p>I see no apparent way to 'ignore' the warning in Atom, so I feel like just disabling the linter, which is not great for more serious warnings...</p>\n"}, {"tags": ["go", "types", "import", "importerror"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1506282821, "last_edit_date": 1506282821, "creation_date": 1506281593, "answer_id": 46394042, "question_id": 46388701, "link": "https://stackoverflow.com/questions/46388701/import-cycle-on-types/46394042#46394042", "title": "Import cycle on types", "body": "<p>You have a few problems here with structure, so you'll need to make some changes. A few general guidelines:</p>\n\n<ul>\n<li>Try to have packages know the minimum about the world (only a few should import lots of others)</li>\n<li>Declare data structures or interfaces in the pkg where they are used</li>\n<li>Prefer simple interfaces (with just a few methods), and simple data structures</li>\n<li>Try to have packages never import packages above them, only siblings or children (not always possible, but a good guideline)</li>\n</ul>\n\n<p>So looking at your problems:</p>\n\n<ol>\n<li><p>Your components currently know about routes, but don't need to - they should expose handlers, and you can let the app or main package wire up handlers and the router. Handlers should not know how they are used. </p></li>\n<li><p>Your router knows about templates and rendering, but doesn't need to, remove TemplateData from there, handlers should Render themselves by importing your template package and using it.</p></li>\n<li><p>Your TemplateData knows about users but doesn't have to - I would remove this and reduce the render context to  Data map[string]interface{}, as the user could be added there and having it separate doesn't add much but does mean your template package has to know about your specific user type, which is bad. </p></li>\n</ol>\n\n<p>These first three points are a question of removing dependencies that shouldn't exist - your packages are too interdependent.</p>\n\n<ol start=\"4\">\n<li>Finally, and crucially, your components can't know about other components or you'll eventually hit a Handler that needs to import user, page, tag all together and can't because the tags handler also needs to import user, or users will have tags and tags will have users etc. To tackle this you <em>need</em> to separate your handlers from components somehow. </li>\n</ol>\n\n<p>So listing possible layout solutions with an open mind (the best depends on the structure and complexity of your project): </p>\n\n<ul>\n<li>Put everything in one package (good for v. simple apps, not good for complex)</li>\n<li>Split by function (models, views, handlers etc) - I'm not so keen as means jumping around and splits up bits of components like users to separate models from handlers - this is a rails-like approach.</li>\n<li>Split by resource/component, but use sub-packages for handlers (my preferred option)</li>\n</ul>\n\n<p>You are already splitting by resource to some extent (what you call components), so let's work with that. Here is an example layout (each entry is a package):</p>\n\n<ul>\n<li>server.go - (main calls app setup, runs server)</li>\n<li>app (sets up db, logging etc, links handlers to router, imports all)</li>\n<li>user (component)\n\n<ul>\n<li>handlers (user handlers)</li>\n<li>assets  (user assets, js etc)</li>\n<li>templates (user templates)</li>\n</ul></li>\n<li>page \n\n<ul>\n<li>handlers</li>\n<li>assets </li>\n<li>templates \n...</li>\n</ul></li>\n</ul>\n\n<p>You say <em>I do not want create single purpose packages</em>, which you may feel this violates, but I suggest you try it out, I think it is closest to your suggested structure. </p>\n\n<p>This keeps everything about users in one place, lets the page handlers pull in users or other resources as required, without polluting pages with information about users say - it forces you to keep components completely separate except in handlers, which are allowed to pull in multiple components which is often necessary. You can find an example of this sort of structure <a href=\"https://github.com/kennygrant/gohackernews\" rel=\"nofollow noreferrer\">here</a>. This means only the app and handlers know about other packages, every other package can be completely self-contained (hence no change of cyclic dependencies).  </p>\n\n<p>The good news is once you've tackled these issues you'll find your packages are far more independent, this constraint (imposed to speed up compile times) is one of my favourite bits of Go as it also forces you to have quite a decoupled design. </p>\n"}], "owner": {"reputation": 57, "user_id": 3565093, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/Llcy1.jpg?s=128&g=1", "display_name": "ma3x", "link": "https://stackoverflow.com/users/3565093/ma3x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 423, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506282821, "creation_date": 1506246345, "last_edit_date": 1506252818, "question_id": 46388701, "link": "https://stackoverflow.com/questions/46388701/import-cycle-on-types", "title": "Import cycle on types", "body": "<p>I've read questions on stackoverflow and articles on other sites, but still cannot solve the problem.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package routing\n\nimport (\n    \"net/http\"\n\n    \"bitbucket.org/codictive/ise/components/user\"\n)\n\n// Route defines a component route structure.\ntype Route struct {\n    Path        string\n    Name        string\n    Method      string\n    Description string\n    Handler     func(w http.ResponseWriter, r *http.Request, data TemplateData)\n}\n\n// TemplateData defines data structure which passed to component handlers and rendered to client.\ntype TemplateData struct {\n    AppDomain   string\n    Data        map[string]interface{}\n    RequestPath string\n    Route       Route\n    User        *user.User\n}\n</code></pre>\n\n<p>The template package's <code>Render</code> function used in handlers to render html template to client's browser: </p>\n\n<pre><code>package template\n\nimport (\n    \"html/template\"\n    \"net/http\"\n    \"path\"\n\n    \"bitbucket.org/codictive/ise/components/log\"\n    \"bitbucket.org/codictive/ise/core/component/routing\"\n)\n\n// Render executes given template to user's client with given data.\nfunc Render(fp string, data routing.TemplateData, w http.ResponseWriter) {\n    files := []string{\n        \"storage/templates/master.html\",\n        path.Join(\"storage/templates\", fp),\n    }\n\n    tmpl, err := template.New(\"master.html\").Funcs(funcs).ParseFiles(files...)\n    if err != nil {\n        log.Error(\"[Render] Template creation failed. (%v)\", err)\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    if err := tmpl.Execute(w, data); err != nil {\n        log.Error(\"[Render] Template execution failed. (%v)\", err)\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n}\n</code></pre>\n\n<p>Every component has a dependency to routing package to define it's routes:</p>\n\n<pre><code>// Component defines application component structure.\ntype Component struct {\n    Name   string\n    Config interface{}\n    Routes []routing.Route\n\n    // Boot filters\n    Before func()\n    After  func()\n}\n</code></pre>\n\n<p>and component handlers also use <code>routing.TemplateData</code>:</p>\n\n<pre><code>// indexHandler displays application homepage.\nfunc indexHandler(w http.ResponseWriter, r *http.Request, data routing.TemplateData) {\n}\n</code></pre>\n\n<p>So the code highly depends on <code>routing.TemplateData</code> which is my problem; Because <code>TemplateData</code> is also dependent on <code>routing.Route</code> and <code>user.User</code>:</p>\n\n<ul>\n<li><p>I could not make another package just for <code>TemplateData</code>; It just moves import cycle there.</p></li>\n<li><p>Also I think I can't use interfaces because the cycle is on types not functions.</p></li>\n<li><p>I can't move all this in one package.</p></li>\n<li><p>I do not want create single purpose packages (eg. <code>user/models</code>, <code>user/handlers</code>, ...) just to bypass the cycle, as possible.</p></li>\n</ul>\n\n<p>What can I do to solve import cycle problem?</p>\n"}, {"tags": ["go", "microservices", "nats.io"], "comments": [{"owner": {"reputation": 333, "user_id": 771061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c0cc0607a67779f68c8002cd87c50d?s=128&d=identicon&r=PG", "display_name": "Diego Scaravaggi", "link": "https://stackoverflow.com/users/771061/diego-scaravaggi"}, "edited": false, "score": 0, "creation_date": 1506340452, "post_id": 46388219, "comment_id": 79766397, "body": "I notice that NATS Streaming Server has Queue as well and there is an option named <i>ManualAck</i> and re-delivery behavior (see <a href=\"https://github.com/nats-io/nats-streaming-server/issues/186\" rel=\"nofollow noreferrer\">github.com/nats-io/nats-streaming-server/issues/186</a> )"}], "answers": [{"comments": [{"owner": {"reputation": 26, "user_id": 8132493, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-n_R39OXEVXU/AAAAAAAAAAI/AAAAAAAAABA/pRgYCO8AN8k/photo.jpg?sz=128", "display_name": "Alberto Ricart", "link": "https://stackoverflow.com/users/8132493/alberto-ricart"}, "edited": false, "score": 1, "creation_date": 1506524711, "post_id": 46450735, "comment_id": 79858202, "body": "Also NATS Streaming is a completely different thing. A NATS streaming server captures all messages in a log. The NATS streaming server &#39;replays&#39; the log to a NATS streaming subscriber. Like NATS a subscriber can be a member of a queue group, and messages in the log will get distributed between the queue group members."}, {"owner": {"reputation": 333, "user_id": 771061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c0cc0607a67779f68c8002cd87c50d?s=128&d=identicon&r=PG", "display_name": "Diego Scaravaggi", "link": "https://stackoverflow.com/users/771061/diego-scaravaggi"}, "edited": false, "score": 0, "creation_date": 1506532574, "post_id": 46450735, "comment_id": 79862944, "body": "Thanks a lot for your suggestion! I agree with your final sentence: <i>...make the requests idempotent to prevent duplicate side effects...</i>  It is exactly the critical <i>piece</i> of code that I had to code within the current pub/sub architecture. I will clone my test env into a simple NATS pub sub and I will retest all recovery scenarios."}], "tags": [], "owner": {"reputation": 26, "user_id": 8132493, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-n_R39OXEVXU/AAAAAAAAAAI/AAAAAAAAABA/pRgYCO8AN8k/photo.jpg?sz=128", "display_name": "Alberto Ricart", "link": "https://stackoverflow.com/users/8132493/alberto-ricart"}, "is_accepted": true, "score": 1, "last_activity_date": 1506523159, "creation_date": 1506523159, "answer_id": 46450735, "question_id": 46388219, "link": "https://stackoverflow.com/questions/46388219/nats-io-queuesubscribe-behavior-on-timeout/46450735#46450735", "title": "Nats.io QueueSubscribe behavior on timeout", "body": "<p>For your first question: It seems to me that you are trying to publish a request message with a timeout (using the <code>nc.Request</code>). If so, the timeout is managed by the client. Effectively the client publishes the request message and creates a subscription on the reply subject. If the subscription doesn't get any messages within the timeout it will notify you of the timeout condition and unsubscribe from the reply subject.</p>\n\n<p>On your second question - are you using a queue group? A queue group in NATS is a subscription that specifies a queue group name. All subscriptions having the same queue group name are treated specially by the server. The server will select one of the queue group subscriptions to send the message to rotating between them as messages arrive. However the responsibility of the server is simply to deliver the message.</p>\n\n<p>To do what you describe, implement your functionality using request/reply using a timeout and a max number of messages equal to 1. If no responses are received after the timeout your client can then resend the request message after some delay or perform some other type of recovery logic. The reply message should be your 'protocol' to know that the message was handled properly. Note that this gets into the design of your messaging architecture. For example, it is possible for the timeout to trigger after the request recipient received the message and handled it but before the client or server was able to publish the response. In that case the request sender wouldn't be able to tell the difference and would eventually republish. This hints that such type of interactions need to make the requests idempotent to prevent duplicate side effects.</p>\n"}], "owner": {"reputation": 333, "user_id": 771061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15c0cc0607a67779f68c8002cd87c50d?s=128&d=identicon&r=PG", "display_name": "Diego Scaravaggi", "link": "https://stackoverflow.com/users/771061/diego-scaravaggi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1012, "favorite_count": 0, "accepted_answer_id": 46450735, "answer_count": 1, "score": 1, "last_activity_date": 1506523159, "creation_date": 1506242455, "last_edit_date": 1506243129, "question_id": 46388219, "link": "https://stackoverflow.com/questions/46388219/nats-io-queuesubscribe-behavior-on-timeout", "title": "Nats.io QueueSubscribe behavior on timeout", "body": "<p>I'm evaluating NATS for migrating an existing msg based software \nI did not find documentation about msg timeout exception and overload. \nFor Example:</p>\n\n<ul>\n<li>After Subscriber has been <em>chosen</em> , Is it aware of timeout settings posted by Publisher ? Is it possible to notify an additional time extension ?</li>\n<li>If the <em>elected</em> subscriber is aware that some DBMS connection is missing and cannot complete It could be possible to bounce the message</li>\n</ul>\n\n<p>NATS server will pickup another subscriber and will re-post the same message ?</p>\n\n<p>Ciao\nDiego   </p>\n"}, {"tags": ["mysql", "sql", "database", "go", "web"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1506228584, "post_id": 46386654, "comment_id": 79731236, "body": "Typically this issue would be solved with proper schema definitions.  I would imagine a query like &quot;SELECT * FROM games WHERE user_id = ? ORDER BY date_played DESC LIMIT {page_number - 1 * 25}, 25&quot;"}, {"owner": {"reputation": 32469, "user_id": 1529673, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/O6MQS.jpg?s=128&g=1", "display_name": "Strawberry", "link": "https://stackoverflow.com/users/1529673/strawberry"}, "edited": false, "score": 0, "creation_date": 1506235155, "post_id": 46386654, "comment_id": 79732310, "body": "See <a href=\"https://dev.mysql.com/doc/refman/5.7/en/information-functions.html\" rel=\"nofollow noreferrer\">dev.mysql.com/doc/refman/5.7/en/information-functions.html</a>"}], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "edited": false, "score": 0, "creation_date": 1506231199, "post_id": 46386681, "comment_id": 79731648, "body": "I see, this makes perfect sense! My only question is if I&#39;m creating a page selection at the footer of the page, similar to other sites, (where it has the 4 next page numbers, and then the last page number), how will I know what the last page number will be? I understand I can get some sort of number of  rows in the db and then divide it by how many I will be showing on each page, but where do I get that number? The table the games are stored in aren&#39;t just for that user, so I couldn&#39;t do something like get the last row in the table and see it&#39;s time_played id."}, {"owner": {"reputation": 9377, "user_id": 8431111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GteAE.jpg?s=128&g=1", "display_name": "J_H", "link": "https://stackoverflow.com/users/8431111/j-h"}, "reply_to_user": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "edited": false, "score": 1, "creation_date": 1506270005, "post_id": 46386681, "comment_id": 79741509, "body": "<code>select count(*) from tbl where player=&#39;bob&#39;;</code>"}, {"owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "edited": false, "score": 0, "creation_date": 1506285276, "post_id": 46386681, "comment_id": 79746441, "body": "Yes but that&#39;s what I&#39;m trying to avoid, else why wouldn&#39;t I just select all in the first place? I&#39;m worried about the speed if I select all, hence for this post."}, {"owner": {"reputation": 9377, "user_id": 8431111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GteAE.jpg?s=128&g=1", "display_name": "J_H", "link": "https://stackoverflow.com/users/8431111/j-h"}, "reply_to_user": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "edited": false, "score": 1, "creation_date": 1506286769, "post_id": 46386681, "comment_id": 79746846, "body": "First, if you&#39;re worried about speed, bench it both ways, and then decide if the time difference matters. (Though beware of caching effects.) Second, you <i>do</i> have an index on <code>player</code>, yes? Look at the <code>EXPLAIN</code> plan produced by the backend optimizer. Often a count(*) query can be answered with many fewer I/Os than one that transfers lots of row data. Also, consider limiting to time range of 24 or 6 months, and use compound index on (player, play_time). In the end, your site&#39;s usage statistics are certain to have a big effect on performance of one or another query."}, {"owner": {"reputation": 9377, "user_id": 8431111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GteAE.jpg?s=128&g=1", "display_name": "J_H", "link": "https://stackoverflow.com/users/8431111/j-h"}, "reply_to_user": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "edited": false, "score": 1, "creation_date": 1506287050, "post_id": 46386681, "comment_id": 79746932, "body": "If your benchmark results show that <code>count(*)</code> introduces unacceptably long response times, then just run a daily cron job to compute summary statistics and store them in another table. Then the &quot;online&quot; query can combine a count from the summary table with a date range limited <code>count(*)</code> query."}, {"owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "edited": false, "score": 0, "creation_date": 1506287992, "post_id": 46386681, "comment_id": 79747177, "body": "So let me understand this correctly. I should: on page load - query for ALL appropriate rows to get total page numbers, then on page switches limit the query to just 15 - 25? If so, how long would you reckon it&#39;d take to query a table with ~50,000 entries?"}, {"owner": {"reputation": 9377, "user_id": 8431111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GteAE.jpg?s=128&g=1", "display_name": "J_H", "link": "https://stackoverflow.com/users/8431111/j-h"}, "reply_to_user": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "edited": false, "score": 1, "creation_date": 1506290211, "post_id": 46386681, "comment_id": 79747716, "body": "You didn&#39;t show us <code>show create table tbl \\G</code> (nor even reveal the name of <code>tbl</code>) so we can&#39;t see your indexes. You haven&#39;t shown us the <code>EXPLAIN</code> plans of two competing queries yet. Suppose Bob played 50k games. The prediction I offered above is that elapsed time for <code>select count(*) from tbl where player=&#39;bob&#39;</code> will be much much shorter than elapsed time to transfer 50k rows with <code>select * from tbl where player=&#39;bob&#39;</code>. Post the benchmark results in an Answer and tell us the time difference. Create offline daily summaries if the online benchmarking reveals unacceptably high latencies."}], "tags": [], "owner": {"reputation": 9377, "user_id": 8431111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GteAE.jpg?s=128&g=1", "display_name": "J_H", "link": "https://stackoverflow.com/users/8431111/j-h"}, "is_accepted": false, "score": 1, "last_activity_date": 1506228593, "last_edit_date": 1592644375, "creation_date": 1506228593, "answer_id": 46386681, "question_id": 46386654, "link": "https://stackoverflow.com/questions/46386654/web-development-sql-creating-a-recent-pages/46386681#46386681", "title": "Web Development - SQL Creating a Recent Pages", "body": "<p>For pagination use <a href=\"https://dev.mysql.com/doc/refman/5.7/en/select.html\" rel=\"nofollow noreferrer\"><code>limit</code></a>:</p>\n<blockquote>\n<p>The LIMIT clause can be used to constrain the number of rows returned by the SELECT statement.</p>\n<p>... the first argument specifies the [zero origin] offset of the first row to return, and the second specifies the maximum number of rows to return. ...</p>\n<p>SELECT * FROM tbl LIMIT 5,10;  # Retrieve rows 6-15</p>\n</blockquote>\n<p>So for the first page it's enough to request all games played, order by time_played DESCending, limit 25. Just be sure to put an index on the time_played column.</p>\n"}], "owner": {"reputation": 151, "user_id": 6190999, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/fcbeb809f99538b1a195867a6658b126?s=128&d=identicon&r=PG&f=1", "display_name": "Nicster15", "link": "https://stackoverflow.com/users/6190999/nicster15"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506228593, "creation_date": 1506228134, "question_id": 46386654, "link": "https://stackoverflow.com/questions/46386654/web-development-sql-creating-a-recent-pages", "title": "Web Development - SQL Creating a Recent Pages", "body": "<p>I'm creating a web application where one of the features will include getting the recent games played. I want to make it so the 25 most recent games played will be on the first page, with a page selection at the bottom. (Games data will be grabbed from MYSQL)</p>\n\n<p>I understand this is a concept many sites already have, but after extensive googling I'm uncertain of a way to efficiently do this. The only thing I can currently think of is querying every game of theirs then splitting it into pages, but wouldn't that become extremely inefficient when it gets in the thousands?</p>\n\n<p>Any help, or link to outside sources that explain this topic would be greatly appreciated, thank you!</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1506351321, "post_id": 46386663, "comment_id": 79774031, "body": "This is equivalent to <code>context.WithTimeout(context.Background(), 2*time.Second)</code> (and no explicit timer), by the way."}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506356289, "post_id": 46386663, "comment_id": 79777235, "body": "Nice addition @Peter"}], "tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": true, "score": 5, "last_activity_date": 1506228266, "creation_date": 1506228266, "answer_id": 46386663, "question_id": 46386404, "link": "https://stackoverflow.com/questions/46386404/context-cancel-does-not-exit/46386663#46386663", "title": "context cancel does not exit", "body": "<p>The main issue is that your channel returned from <code>generator(ctx)</code> emits values almost as fast as you can read them.</p>\n\n<p>The channel created by <code>time.After(2 * time.Second)</code> is discarded almost immediately, and you create a new timeout channel every iteration through the generator.</p>\n\n<p>If you make one small change; create the timeout channel <em>outside</em> the loop, and then put it in the select clause you'll see it begin to work.</p>\n\n<pre><code>timeout := time.After(2 * time.Second)\nfor i := range generator(ctx) {\n    select {\n    case &lt;-timeout:\n        cancel()\n        return\n    default:\n        fmt.Println(i)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/zb3wn5FJuK\" rel=\"noreferrer\">https://play.golang.org/p/zb3wn5FJuK</a></p>\n"}], "owner": {"reputation": 73, "user_id": 7632254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b05c74f5f1b66681fd7cdd8401167c1?s=128&d=identicon&r=PG&f=1", "display_name": "technologyblogger", "link": "https://stackoverflow.com/users/7632254/technologyblogger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 46386663, "answer_count": 1, "score": 3, "last_activity_date": 1506268934, "creation_date": 1506224944, "last_edit_date": 1506268934, "question_id": 46386404, "link": "https://stackoverflow.com/questions/46386404/context-cancel-does-not-exit", "title": "context cancel does not exit", "body": "<p>Expected: To be done after approx. 2 seconds</p>\n\n<p>Actual: Runs indefinitely.</p>\n\n<p>Don't understand what could be causing it to run indefinitely. </p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ctx, cancel := context.WithCancel(context.Background())\n    defer cancel()\n\n    for i := range generator(ctx) {\n        select {\n        case &lt;-time.After(2 * time.Second):\n            cancel()\n            return\n        default:\n            fmt.Println(i)\n        }\n    }\n}\n\nfunc generator(ctx context.Context) &lt;-chan int {\n    ch := make(chan int)\n\n    go func() {\n        count := 0\n        for {\n            select {\n            case &lt;-ctx.Done():\n                return\n            case ch &lt;- count:\n                count++\n            }\n        }\n    }()\n\n    return ch\n}\n</code></pre>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1506225490, "post_id": 46386353, "comment_id": 79730796, "body": "The main goroutine sends to the channel (in the call to <code>crawl</code>) and later receives from the channel.  The program will deadlock if more than 5 links are sent."}, {"owner": {"reputation": 4968, "user_id": 244330, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/66b048081841e1854319684966683663?s=128&d=identicon&r=PG", "display_name": "newguy", "link": "https://stackoverflow.com/users/244330/newguy"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1506225625, "post_id": 46386353, "comment_id": 79730817, "body": "@CeriseLim&#243;n Thanks. I have tried changing it to 150 it is still deadlock. Any suggestions? I don&#39;t think a normal website has more than 150 links on its homepage."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1506226610, "post_id": 46386353, "comment_id": 79730959, "body": "Fix this issue by calling <code>go craw(url, 1, ch)</code> from main.  The next issue is that <code>main</code> blocks ranging on <code>ch</code>.  Something needs to close <code>ch</code> for main to continue to printing the links."}], "answers": [{"comments": [{"owner": {"reputation": 4968, "user_id": 244330, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/66b048081841e1854319684966683663?s=128&d=identicon&r=PG", "display_name": "newguy", "link": "https://stackoverflow.com/users/244330/newguy"}, "edited": false, "score": 0, "creation_date": 1506573950, "post_id": 46458118, "comment_id": 79877101, "body": "This looks very interesting. In fact the code I wrote was a modification version of another person&#39;s blog post but I keep its main structure. Why do you think doing it in your way is better? Can you give the rationale behind this flat model?"}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "reply_to_user": {"reputation": 4968, "user_id": 244330, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/66b048081841e1854319684966683663?s=128&d=identicon&r=PG", "display_name": "newguy", "link": "https://stackoverflow.com/users/244330/newguy"}, "edited": false, "score": 0, "creation_date": 1506587227, "post_id": 46458118, "comment_id": 79883589, "body": "When I look at your code(updated version), every goroutine block its parent. So only one goroutine works at one moment. Lets deph to be 999 - there will be moment when 998 goroutines wait for last one. I think that it is not usecase for goroutines. Actually I feel that it can be pretty expensive approach."}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "reply_to_user": {"reputation": 4968, "user_id": 244330, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/66b048081841e1854319684966683663?s=128&d=identicon&r=PG", "display_name": "newguy", "link": "https://stackoverflow.com/users/244330/newguy"}, "edited": false, "score": 0, "creation_date": 1506588430, "post_id": 46458118, "comment_id": 79884425, "body": "Flat = only main spawn goroutines, no recursion"}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "reply_to_user": {"reputation": 4968, "user_id": 244330, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/66b048081841e1854319684966683663?s=128&d=identicon&r=PG", "display_name": "newguy", "link": "https://stackoverflow.com/users/244330/newguy"}, "edited": false, "score": 0, "creation_date": 1506589405, "post_id": 46458118, "comment_id": 79885092, "body": "Btw my code needs little tweaking to work properly. Like to optimize channel length / number of workers and probably improve filtering of unique addresses. I met deadlock when pages contained many unique links so later I included also protection against that (select).."}], "tags": [], "owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "is_accepted": false, "score": 0, "last_activity_date": 1506552869, "last_edit_date": 1506552869, "creation_date": 1506550934, "answer_id": 46458118, "question_id": 46386353, "link": "https://stackoverflow.com/questions/46386353/understanding-correct-use-of-channels-in-golang-concurrent-context/46458118#46458118", "title": "Understanding correct use of channels in golang concurrent context", "body": "<p>I think that recursive calling of goroutines is not good idea. It can simply goes out of control.. I would prefer more flat model like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"strings\"\n    \"sync\"\n\n    \"golang.org/x/net/html\"\n)\n\nfunc main() {\n\n    if len(os.Args) != 2 {\n        fmt.Println(\"Usage: crawl [URL].\")\n    }\n\n    url := os.Args[1]\n    if !strings.HasPrefix(url, \"http://\") {\n        url = \"http://\" + url\n    }\n\n    wg := NewWorkGroup(1)\n    wg.Crawl(url)\n    for k, v := range wg.urlMap {\n        fmt.Printf(\"%s: %d\\n\", k, v)\n    }\n}\n\n// represents single link and its deph\ntype Link struct {\n    url  string\n    deph uint32\n}\n\n// wraps all around to group\ntype WorkGroup struct {\n    *sync.WaitGroup\n    maxDeph uint32\n    numW    int\n    pool    chan *Worker\n    linkQ   chan Link\n    urlMap  map[string]uint32\n}\n\ntype Worker struct {\n    result chan []Link\n}\n\nfunc newWorker() *Worker {\n    return &amp;Worker{\n        result: make(chan []Link),\n    }\n}\n\nfunc NewWorkGroup(maxDeph uint32) *WorkGroup {\n    numW := int(maxDeph)\n    if maxDeph &gt; 10 {\n        numW = 10\n    }\n    return &amp;WorkGroup{\n        WaitGroup: new(sync.WaitGroup),\n        maxDeph:   maxDeph,\n        numW:      numW,\n        pool:      make(chan *Worker, numW),\n        linkQ:     make(chan Link, 100),\n        urlMap:    make(map[string]uint32),\n    }\n}\n\n// dispatch workers -&gt; filter visited -&gt; send not visited to channel\n// pool + dispatcher keep order so workers go level by level\nfunc (wg *WorkGroup) spawnDispatcher() {\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        defer close(wg.linkQ)\n\n        for w := range wg.pool {\n            links := &lt;-w.result\n            for i := 0; i &lt; len(links); i++ {\n                if _, ok := wg.urlMap[links[i].url]; !ok {\n                    wg.urlMap[links[i].url] = links[i].deph\n\n                    // dont process links that reach max deph\n                    if links[i].deph &lt; wg.maxDeph {\n                        select {\n                        case wg.linkQ &lt;- links[i]:\n                            // goes well\n                            continue\n                        default:\n                            // channel is too short, protecting possible deadlock\n                        }\n                        // drop rest of links\n                        break\n                    }\n                }\n            }\n            // empty link channel + nothing in process = end\n            if len(wg.linkQ) == 0 &amp;&amp; len(wg.pool) == 0 {\n                return\n            }\n        }\n    }()\n}\n\n//initialize goroutines and crawl url\nfunc (wg *WorkGroup) Crawl(url string) {\n    defer close(wg.pool)\n    wg.spawnCrawlers()\n    wg.spawnDispatcher()\n    wg.linkQ &lt;- Link{url: url, deph: 0}\n    wg.Wait()\n}\n\nfunc (wg *WorkGroup) spawnCrawlers() {\n    // custom num of workers, used maxDeph\n    for i := 0; i &lt; wg.numW; i++ {\n        wg.newCrawler()\n    }\n}\n\nfunc (wg *WorkGroup) newCrawler() {\n    wg.Add(1)\n    go func(w *Worker) {\n        defer wg.Done()\n        defer close(w.result)\n\n        for link := range wg.linkQ {\n            wg.pool &lt;- w\n            w.result &lt;- getExternalUrls(link)\n        }\n    }(newWorker())\n}\n\n// default sligtly modified crawl function\nfunc getExternalUrls(source Link) []Link {\n    resp, err := http.Get(source.url)\n    if err != nil {\n        log.Printf(\"Can not reach the site. Error = %v\\n\", err)\n        return nil\n    }\n\n    b := resp.Body\n    defer b.Close()\n\n    z := html.NewTokenizer(b)\n\n    links := []Link{}\n\n    for {\n        token := z.Next()\n\n        switch token {\n        case html.ErrorToken:\n            return links\n        case html.StartTagToken:\n            current := z.Token()\n            if current.Data != \"a\" {\n                continue\n            }\n            url, ok := getHrefTag(current)\n            if ok &amp;&amp; strings.HasPrefix(url, \"http\") {\n                links = append(links, Link{url: url, deph: source.deph + 1})\n            }\n        }\n    }\n    return links\n}\n\n//default function\nfunc getHrefTag(token html.Token) (result string, ok bool) {\n    for _, a := range token.Attr {\n        if a.Key == \"href\" {\n            result = a.Val\n            ok = true\n            break\n        }\n    }\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 4968, "user_id": 244330, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/66b048081841e1854319684966683663?s=128&d=identicon&r=PG", "display_name": "newguy", "link": "https://stackoverflow.com/users/244330/newguy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 829, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1506552869, "creation_date": 1506224267, "last_edit_date": 1506250556, "question_id": 46386353, "link": "https://stackoverflow.com/questions/46386353/understanding-correct-use-of-channels-in-golang-concurrent-context", "title": "Understanding correct use of channels in golang concurrent context", "body": "<p>I am writing a go project which is a simple web crawler to crawl links on the website. I want to experiment the concurrent features such as goroutines and channels. But when I run it it didn't go through. Nothing is showed as if there is nothing happening. I have no idea what went wrong. Can somebody point it out for me?</p>\n\n<p>It works and shows all the crawled links if I remove the channels logic but I want it to send the links into a buffered channel and then display the links before ending the program. The program is supposed to be able to go to any depth as specified in the program. Currently the depth is 1.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"strings\"\n    \"time\"\n\n    \"golang.org/x/net/html\"\n)\n\n// Link type to be sent over channel\ntype Link struct {\n    URL string\n    ok  bool\n}\n\nfunc main() {\n    if len(os.Args) != 2 {\n        fmt.Println(\"Usage: crawl [URL].\")\n    }\n\n    url := os.Args[1]\n    if !strings.HasPrefix(url, \"http://\") {\n        url = \"http://\" + url\n    }\n\n    ch := make(chan *Link, 5)\n    crawl(url, 1, ch)\n\n    visited := make(map[string]bool)\n\n    time.Sleep(2 * time.Second)\n\n    for link := range ch {\n        if _, ok := visited[link.URL]; !ok {\n            visited[link.URL] = true\n        }\n    }\n\n    close(ch)\n    for l := range visited {\n        fmt.Println(l)\n    }\n}\n\nfunc crawl(url string, n int, ch chan *Link) {\n    if n &lt; 1 {\n        return\n    }\n    resp, err := http.Get(url)\n    if err != nil {\n        log.Fatalf(\"Can not reach the site. Error = %v\\n\", err)\n        os.Exit(1)\n    }\n\n    b := resp.Body\n    defer b.Close()\n\n    z := html.NewTokenizer(b)\n\n    nextN := n - 1\n    for {\n        token := z.Next()\n\n        switch token {\n        case html.ErrorToken:\n            return\n        case html.StartTagToken:\n            current := z.Token()\n            if current.Data != \"a\" {\n                continue\n            }\n            result, ok := getHrefTag(current)\n            if !ok {\n                continue\n            }\n\n            hasProto := strings.HasPrefix(result, \"http\")\n            if hasProto {\n                go crawl(result, nextN, ch)\n                ch &lt;- &amp;Link{result, true}\n            }\n        }\n    }\n\n}\n\nfunc getHrefTag(token html.Token) (result string, ok bool) {\n    for _, a := range token.Attr {\n        if a.Key == \"href\" {\n            result = a.Val\n            ok = true\n            break\n        }\n    }\n    return\n}\n</code></pre>\n\n<p><strong>UPDATED:</strong></p>\n\n<p>After some fiddling I figured out to change the code to remove the data races, however I still don't know how to avoid crawling urls that were visited previously (maybe I should start another question?):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"strings\"\n\n    \"golang.org/x/net/html\"\n)\n\nfunc main() {\n    if len(os.Args) != 2 {\n        fmt.Println(\"Usage: crawl [URL].\")\n    }\n\n    url := os.Args[1]\n    if !strings.HasPrefix(url, \"http://\") {\n        url = \"http://\" + url\n    }\n\n    for link := range newCrawl(url, 1) {\n        fmt.Println(link)\n    }\n}\n\nfunc newCrawl(url string, num int) chan string {\n    ch := make(chan string, 20)\n\n    go func() {\n        crawl(url, 1, ch)\n        close(ch)\n    }()\n\n    return ch\n}\n\nfunc crawl(url string, n int, ch chan string) {\n    if n &lt; 1 {\n        return\n    }\n    resp, err := http.Get(url)\n    if err != nil {\n        log.Fatalf(\"Can not reach the site. Error = %v\\n\", err)\n        os.Exit(1)\n    }\n\n    b := resp.Body\n    defer b.Close()\n\n    z := html.NewTokenizer(b)\n\n    nextN := n - 1\n    for {\n        token := z.Next()\n\n        switch token {\n        case html.ErrorToken:\n            return\n        case html.StartTagToken:\n            current := z.Token()\n            if current.Data != \"a\" {\n                continue\n            }\n            result, ok := getHrefTag(current)\n            if !ok {\n                continue\n            }\n\n            hasProto := strings.HasPrefix(result, \"http\")\n            if hasProto {\n                done := make(chan struct{})\n                go func() {\n                    crawl(result, nextN, ch)\n                    close(done)\n                }()\n                &lt;-done\n                ch &lt;- result\n            }\n        }\n    }\n}\n\nfunc getHrefTag(token html.Token) (result string, ok bool) {\n    for _, a := range token.Attr {\n        if a.Key == \"href\" {\n            result = a.Val\n            ok = true\n            break\n        }\n    }\n    return\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "answers": [{"tags": [], "owner": {"reputation": 1322, "user_id": 2936650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21pIQ.png?s=128&g=1", "display_name": "ashburshui", "link": "https://stackoverflow.com/users/2936650/ashburshui"}, "is_accepted": true, "score": 0, "last_activity_date": 1506248523, "creation_date": 1506248523, "answer_id": 46389008, "question_id": 46386163, "link": "https://stackoverflow.com/questions/46386163/goroutine-didnt-take-effect-in-crawl-example-of-a-tour-of-go/46389008#46389008", "title": "goroutine didn&#39;t take effect in Crawl example of &#39;A Tour of Go&#39;", "body": "<p><strong>In your program, you have no any synchronized tool for your go routines.</strong></p>\n\n<p>So the behavior of this code is undefined. <strong>Perhaps main go thread will end soon.</strong></p>\n\n<p><strong>Please remember that the main go routine will never block to wait other go routines for termination, only if you explicitly use some kind of util to synchronize the execution of go routines.</strong></p>\n\n<p><strong>Such as channels or useful sync utils.</strong></p>\n\n<p>Let me help to give a version.</p>\n\n<pre><code>type fetchState struct {\n    mu      sync.Mutex\n    fetched map[string]bool\n}\n\nfunc (f *fetchState) CheckAndMark(url string) bool {\n    defer f.mu.Unlock()\n\n    f.mu.Lock()\n    if f.fetched[url] {\n        return true\n    }\n    f.fetched[url] = true\n    return false\n}\n\nfunc mkFetchState() *fetchState {\n    f := &amp;fetchState{}\n    f.fetched = make(map[string]bool)\n    return f\n}\n\nfunc CrawlConcurrentMutex(url string, fetcher Fetcher, f *fetchState) {\n    if f.CheckAndMark(url) {\n        return\n    }\n\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"found: %s %q\\n\", url, body)\n    var done sync.WaitGroup\n    for _, u := range urls {\n        done.Add(1)\n        go func(u string) {\n            defer done.Done()\n            CrawlConcurrentMutex(u, fetcher, f)\n        }(u) // Without the u argument there is a race\n    }\n    done.Wait()\n    return\n}\n</code></pre>\n\n<p><strong>Please pay attention to the usage of sync.WaitGroup, please refer the <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">doc</a> and you can understand the whole story.</strong></p>\n"}], "owner": {"reputation": 3, "user_id": 8663120, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-EuyplWE0X9U/AAAAAAAAAAI/AAAAAAAAAAA/11nhDwkWme8/photo.jpg?sz=128", "display_name": "kooder", "link": "https://stackoverflow.com/users/8663120/kooder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "accepted_answer_id": 46389008, "answer_count": 1, "score": 0, "last_activity_date": 1506248523, "creation_date": 1506222074, "question_id": 46386163, "link": "https://stackoverflow.com/questions/46386163/goroutine-didnt-take-effect-in-crawl-example-of-a-tour-of-go", "title": "goroutine didn&#39;t take effect in Crawl example of &#39;A Tour of Go&#39;", "body": "<p>As the hits mentioned in Crawl example of 'A Tour of Go', I modified the Crawl function and just wonder why the 'go Crawl' failed to spawn another thread as only one url was found printed out.</p>\n\n<p>Is there anything wrong with my modification?</p>\n\n<p>List my modification as below,</p>\n\n<pre><code>// Crawl uses fetcher to recursively crawl\n// pages starting with url, to a maximum of depth.\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n    // TODO: Fetch URLs in parallel.\n    // TODO: Don't fetch the same URL twice.\n    // This implementation doesn't do either:\n    if depth &lt;= 0 {\n        fmt.Printf(\"depth &lt;= 0 return\")\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"found: %s %q\\n\", url, body)\n    crawled.mux.Lock()\n    crawled.c[url]++\n    crawled.mux.Unlock()\n    for _, u := range urls {\n        //crawled.mux.Lock()\n        if cnt, ok := crawled.c[u]; ok {\n            cnt++\n        } else {\n            fmt.Println(\"go ...\", u)\n            go Crawl(u, depth-1, fetcher)\n        }\n        //crawled.mux.Unlock()\n        //Crawl(u, depth-1, fetcher)\n    }\n    return\n}\n\n\ntype crawledUrl struct {\n    c   map[string]int\n    mux sync.Mutex\n}\n\nvar crawled = crawledUrl{c: make(map[string]int)}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 9116, "user_id": 395258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/613cdeb318951f568212eaaf9bec19e7?s=128&d=identicon&r=PG", "display_name": "C. E.", "link": "https://stackoverflow.com/users/395258/c-e"}, "edited": false, "score": 0, "creation_date": 1506205088, "post_id": 46384537, "comment_id": 79727682, "body": "And let&#39;s say I wanted to create a new <code>[]int</code> array in the <code>main</code> function with the values of all nodes in the tree, how would I do that?"}, {"owner": {"reputation": 2702, "user_id": 2923336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LmjCO.png?s=128&g=1", "display_name": "Francois", "link": "https://stackoverflow.com/users/2923336/francois"}, "reply_to_user": {"reputation": 9116, "user_id": 395258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/613cdeb318951f568212eaaf9bec19e7?s=128&d=identicon&r=PG", "display_name": "C. E.", "link": "https://stackoverflow.com/users/395258/c-e"}, "edited": false, "score": 0, "creation_date": 1506205528, "post_id": 46384537, "comment_id": 79727768, "body": "I have updated my answer with the extraction of all values in nodes"}, {"owner": {"reputation": 9116, "user_id": 395258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/613cdeb318951f568212eaaf9bec19e7?s=128&d=identicon&r=PG", "display_name": "C. E.", "link": "https://stackoverflow.com/users/395258/c-e"}, "edited": false, "score": 0, "creation_date": 1506206772, "post_id": 46384537, "comment_id": 79728019, "body": "Thanks, that&#39;s what I suspected but wanted to make sure that was the plan. I will accept an answer after a while, I want to give others a chance to answer first though."}, {"owner": {"reputation": 2702, "user_id": 2923336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LmjCO.png?s=128&g=1", "display_name": "Francois", "link": "https://stackoverflow.com/users/2923336/francois"}, "reply_to_user": {"reputation": 9116, "user_id": 395258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/613cdeb318951f568212eaaf9bec19e7?s=128&d=identicon&r=PG", "display_name": "C. E.", "link": "https://stackoverflow.com/users/395258/c-e"}, "edited": false, "score": 0, "creation_date": 1506207305, "post_id": 46384537, "comment_id": 79728109, "body": "Sure no problem, I would also be happy to see what other Gophers say about it :)"}], "tags": [], "owner": {"reputation": 2702, "user_id": 2923336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LmjCO.png?s=128&g=1", "display_name": "Francois", "link": "https://stackoverflow.com/users/2923336/francois"}, "is_accepted": true, "score": 1, "last_activity_date": 1506205506, "last_edit_date": 1506205506, "creation_date": 1506202866, "answer_id": 46384537, "question_id": 46384303, "link": "https://stackoverflow.com/questions/46384303/traversing-tree-and-extracting-information-with-reusable-components/46384537#46384537", "title": "Traversing tree and extracting information with reusable components", "body": "<p>You could also add the walk function to your tree type, add a pointer to the parent in a node and add a deleteChild method to a node which takes the index of the child as argument which would allow you to manipulate easily.</p>\n\n<p>Example (here i called walk apply):  </p>\n\n<pre><code>type node struct {\n    children []*node\n    parent   *node\n    value    int\n}\n\nfunc (n *node) deleteChild(index int) {\n    n.children = append(n.children[:index], n.children[index+1:]...)\n}\n\nfunc (n *node) delete(index int) {\n    if n.parent != nil {\n        n.parent.deleteChild(index)\n    }\n}\n\nfunc (n *node) apply(index int, f func(int, *node)) {\n    f(index, n)\n    for childIndex, child := range n.children {\n        child.apply(childIndex, f)\n    }\n}\n\nfunc main() {\n    t := &amp;node{}\n    t.children = []*node{\n        &amp;node{\n            children: []*node{\n                &amp;node{value: 2},\n            },\n            value:    1,\n            parent:   t,\n        },\n    }\n\n    // extract all values in nodes\n    values := []int{}\n    t.apply(0, func(index int, n *node) {\n        values = append(values, n.value)\n    })\n    fmt.Println(values) // [0 1 2]\n\n    // delete a node\n    fmt.Println(t.children) // [0xc4.....]\n    t.apply(0, func(index int, n *node) {\n        n.delete(index)\n    })\n    fmt.Println(t.children) // []\n}\n</code></pre>\n"}], "owner": {"reputation": 9116, "user_id": 395258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/613cdeb318951f568212eaaf9bec19e7?s=128&d=identicon&r=PG", "display_name": "C. E.", "link": "https://stackoverflow.com/users/395258/c-e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 46384537, "answer_count": 1, "score": 0, "last_activity_date": 1506205506, "creation_date": 1506200833, "question_id": 46384303, "link": "https://stackoverflow.com/questions/46384303/traversing-tree-and-extracting-information-with-reusable-components", "title": "Traversing tree and extracting information with reusable components", "body": "<p>I have a tree of nested structs in a Go project. I would like to walk through the tree and perform different actions, such as picking out certain structs at different levels in the tree and appending them to a list, or modifying the structs in place.</p>\n\n<p>I would like to do this using reusable components so that I can focus on implementing that perform the tasks, not having to reimplement the walker for every such function. So far the only thing I can think of is this API:</p>\n\n<pre><code>type applyFunc func(*Node)\nfunc walker(node *Node, f applyFunc) {\n     ....\n     for _, child := range node.children() {\n         walker(child, f)\n     }\n}\n</code></pre>\n\n<p>The function <code>walker</code> can clearly be used to modify the tree because it is passed pointers to the tree nodes. I like it because I can write <code>applyFunc</code> functions separately without having to bother with the actual recursive walker code. However, extracting nodes or deleting them is more difficult.</p>\n\n<p>For extracting information from nodes, perhaps I can use a closure:</p>\n\n<pre><code>values := &amp;[]int{}\nf := func(node *Node) {\n   values.append(node.val)\n}\nwalker(root, f)\n//values now hold the information I am interested in\n</code></pre>\n\n<p>Would this be a good solution? Are there better ones?</p>\n"}, {"tags": ["go", "blockchain", "hyperledger-fabric", "hyperledger"], "answers": [{"comments": [{"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1506269639, "post_id": 46389343, "comment_id": 79741395, "body": "This information seems helpful since I am not aware about these. But still I couldn&#39;t reach to my requirement. To make it clear about the things in my mind, I am just updating the post. Can you just go through it and please suggest to achieve this requirement."}, {"owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "reply_to_user": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1506281002, "post_id": 46389343, "comment_id": 79745028, "body": "it looks that after the update you asking same question as the first bullet from here: <a href=\"https://stackoverflow.com/questions/46352182/implement-inter-channel-security-among-the-peers-within-the-same-channel-in-hype\" title=\"implement inter channel security among the peers within the same channel in hype\">stackoverflow.com/questions/46352182/&hellip;</a>, am I correct?"}, {"owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "reply_to_user": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1506281055, "post_id": 46389343, "comment_id": 79745040, "body": "do you mind to extract the updated section into separate question?"}, {"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1506283007, "post_id": 46389343, "comment_id": 79745675, "body": "Actually the first question is one of my logic to implement the updated section, like if I know the invoking organisation, then I can protect it accordingly. But as per your answer I understood that it will not provide such API since the chaincode has to be agnostic to that type of data. That&#39;s why I have given the details of the actual problem in the updated section."}, {"owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "reply_to_user": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1506283115, "post_id": 46389343, "comment_id": 79745706, "body": "Yes, I understand that, but I think it will be more clear if I can provide you an answer to updated question in separate thread, where it will make it will be more easy to concentrate on your specific use case."}, {"owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1506283760, "post_id": 46389343, "comment_id": 79745923, "body": "Ok. I have added it in a separate question <a href=\"https://stackoverflow.com/questions/46352182/implement-inter-channel-security-among-the-peers-within-the-same-channel-in-hype\" title=\"implement inter channel security among the peers within the same channel in hype\">stackoverflow.com/questions/46352182/&hellip;</a>. Please go through it and give one suggestion."}, {"owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "reply_to_user": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "edited": false, "score": 0, "creation_date": 1506290230, "post_id": 46389343, "comment_id": 79747722, "body": "As an alternative approach you consider to read the answer of @yacom here: <a href=\"https://stackoverflow.com/questions/46339422/user-level-restriction-in-hyperledger-fabric-1-0\" title=\"user level restriction in hyperledger fabric 1 0\">stackoverflow.com/questions/46339422/&hellip;</a>"}], "tags": [], "owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "is_accepted": true, "score": 2, "last_activity_date": 1506250831, "creation_date": 1506250831, "answer_id": 46389343, "question_id": 46383752, "link": "https://stackoverflow.com/questions/46383752/identify-invoking-peer-organisation-inside-hyperledger-fabric-v1-0-chaincode/46389343#46389343", "title": "Identify invoking peer/organisation inside Hyperledger Fabric V1.0 chaincode", "body": "<p>Currently all API's available for chaincode is described in <a href=\"https://github.com/hyperledger/fabric/blob/release/core/chaincode/shim/interfaces.go#L42\" rel=\"nofollow noreferrer\"><code>interface.go</code></a> file. At the moment there is no API which will allow you to identify invoking peer and organization inside the chaincode. I think the main reason for that is that chaincode has to be agnostic to that type of information, since all ACL's managed by the peer and chaincode should stay agnostic to it, preserve deterministic behavior regardless of whoever invoking it and be stateless. </p>\n\n<p>If need you probably could try to leverage the identity of the client who created transaction proposal request, by using <a href=\"https://github.com/hyperledger/fabric/blob/release/core/chaincode/shim/interfaces.go#L42\" rel=\"nofollow noreferrer\"><code>GetCreator</code></a> API:</p>\n\n<pre><code>    // GetCreator returns `SignatureHeader.Creator` (e.g. an identity)\n    // of the `SignedProposal`. This is the identity of the agent (or user)\n    // submitting the transaction.\n    GetCreator() ([]byte, error)\n</code></pre>\n\n<p>And then to parse client certificate to learn about the client, also you can also consider to use <a href=\"https://github.com/hyperledger/fabric/blob/release/core/chaincode/shim/interfaces.go#L42\" rel=\"nofollow noreferrer\">transient fields</a> to make client to put there relevant information which could be read by chaincode later:</p>\n\n<pre><code>// GetTransient returns the `ChaincodeProposalPayload.Transient` field.\n// It is a map that contains data (e.g. cryptographic material)\n// that might be used to implement some form of application-level\n// confidentiality. The contents of this field, as prescribed by\n// `ChaincodeProposalPayload`, are supposed to always\n// be omitted from the transaction and excluded from the ledger.\nGetTransient() (map[string][]byte, error)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 6113163, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bbcdcb246313eb7df95ca264840f4a6?s=128&d=identicon&r=PG&f=1", "display_name": "DanielYang", "link": "https://stackoverflow.com/users/6113163/danielyang"}, "is_accepted": false, "score": 2, "last_activity_date": 1525321729, "creation_date": 1525321729, "answer_id": 50146991, "question_id": 46383752, "link": "https://stackoverflow.com/questions/46383752/identify-invoking-peer-organisation-inside-hyperledger-fabric-v1-0-chaincode/50146991#50146991", "title": "Identify invoking peer/organisation inside Hyperledger Fabric V1.0 chaincode", "body": "<p>In fabric 1.1, there seems a new lib <strong>cid</strong> can reach to your requirements.</p>\n\n<h3>Getting the client's ID</h3>\n\n<pre><code>// GetID returns the ID associated with the invoking identity.  This ID\n// is guaranteed to be unique within the MSP.\nfunc GetID(stub ChaincodeStubInterface) (string, error) \n</code></pre>\n\n<h3>Getting the MSP ID</h3>\n\n<pre><code>// GetMSPID returns the ID of the MSP associated with the identity that\n// submitted the transaction\nfunc GetMSPID(stub ChaincodeStubInterface) (string, error)\n</code></pre>\n\n<p>For full information your can refer <a href=\"https://github.com/hyperledger/fabric/tree/release-1.1/core/chaincode/lib/cid\" rel=\"nofollow noreferrer\">Client Identity Chaincode Library</a></p>\n"}, {"tags": [], "owner": {"reputation": 1691, "user_id": 6352772, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/WnyOn.jpg?s=128&g=1", "display_name": "Kartik Chauhan", "link": "https://stackoverflow.com/users/6352772/kartik-chauhan"}, "is_accepted": false, "score": 0, "last_activity_date": 1548876757, "creation_date": 1548876757, "answer_id": 54448197, "question_id": 46383752, "link": "https://stackoverflow.com/questions/46383752/identify-invoking-peer-organisation-inside-hyperledger-fabric-v1-0-chaincode/54448197#54448197", "title": "Identify invoking peer/organisation inside Hyperledger Fabric V1.0 chaincode", "body": "<p>The <a href=\"https://github.com/hyperledger/fabric/tree/release-1.4/core/chaincode/lib/cid\" rel=\"nofollow noreferrer\">client identity</a> chaincode library enables developers to write chaincode which makes access control decisions based on the identity of the client (i.e. the invoker of the chaincode).</p>\n\n<p>You can get the id of the calling client by using <code>GetID</code> function available in the <a href=\"https://github.com/hyperledger/fabric/tree/release-1.4/core/chaincode/lib/cid\" rel=\"nofollow noreferrer\">cid</a> package.</p>\n\n<p>Few other functions available that you may find useful in the above-mentioned package are:</p>\n\n<ul>\n<li><code>GetX509Certificate</code> It can be used to get the <code>X509</code> certificate of the client.</li>\n<li><code>GetAttributeValue</code> to get the attributes that were associated with the client during the time of his registration.</li>\n</ul>\n\n<p>Other than the functions available in <code>cid</code> package, you may find these functions helpful too.</p>\n\n<ul>\n<li><a href=\"https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#MockStub.GetSignedProposal\" rel=\"nofollow noreferrer\">GetSignedProposal</a> It returns the signed proposal object, which contains all data elements part of a transaction proposal.</li>\n<li><a href=\"https://godoc.org/github.com/hyperledger/fabric/core/chaincode/shim#ChaincodeStub.GetCreator\" rel=\"nofollow noreferrer\">GetCreator</a> It returns <code>SignatureHeader.Creator</code> (e.g. an identity) of the <code>SignedProposal</code>. This is the identity of the agent (or user) submitting the transaction.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 470, "user_id": 11599033, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vd1M5.png?s=128&g=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/11599033/paul"}, "is_accepted": false, "score": 0, "last_activity_date": 1568107228, "creation_date": 1568107228, "answer_id": 57867697, "question_id": 46383752, "link": "https://stackoverflow.com/questions/46383752/identify-invoking-peer-organisation-inside-hyperledger-fabric-v1-0-chaincode/57867697#57867697", "title": "Identify invoking peer/organisation inside Hyperledger Fabric V1.0 chaincode", "body": "<p>I ended up on this question by looking for a way to restrict non-members of private data collections to query private data from a peer. I was considering adding a verifier in the chaincode to see if the client belonged to the same organization as the peer.</p>\n\n<p>If you are looking to do the same, use the <code>memberOnlyRead</code> attribute when creating the private data collection. You might be able to build more advanced restrictions using this technique.</p>\n"}], "owner": {"reputation": 352, "user_id": 1020747, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/GPeLI.jpg?s=128&g=1", "display_name": "Girish007", "link": "https://stackoverflow.com/users/1020747/girish007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1366, "favorite_count": 1, "accepted_answer_id": 46389343, "answer_count": 4, "score": 0, "last_activity_date": 1568107228, "creation_date": 1506196722, "last_edit_date": 1506283673, "question_id": 46383752, "link": "https://stackoverflow.com/questions/46383752/identify-invoking-peer-organisation-inside-hyperledger-fabric-v1-0-chaincode", "title": "Identify invoking peer/organisation inside Hyperledger Fabric V1.0 chaincode", "body": "<p>Is there any way to know the invoking peer and organisation inside <strong>golang</strong> <strong>chaincode</strong> for <strong>Hyperledger Fabric V1.0</strong>?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506354082, "post_id": 46381939, "comment_id": 79775863, "body": "Don&#39;t confuse flag.BoolVar with flag.Bool."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1506537851, "post_id": 46381939, "comment_id": 79865681, "body": "@Peter thanks for the input, I have updated the answer hopefully it clarifies the point"}], "tags": [], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "is_accepted": false, "score": 1, "last_activity_date": 1506538126, "last_edit_date": 1506538126, "creation_date": 1506184937, "answer_id": 46381939, "question_id": 46381817, "link": "https://stackoverflow.com/questions/46381817/golang-command-line-arguments-undefined-variable/46381939#46381939", "title": "Golang : command-line-arguments undefined: variable", "body": "<p>A couple of things wrong in your example: </p>\n\n<ul>\n<li>The variables you are trying to use in your usage function are not in scope since all your flag variables are declared inside main (.</li>\n<li><s>The flag variables themselves are of the wrong type, you should use types from the flag package </s></li>\n<li>Others errors include, adding '-' at the front of flag text (2nd arg) <s>and not dereferencing the flag variables (they will be pointers)</s></li>\n</ul>\n\n<p>There is a good example here: <a href=\"https://gobyexample.com/command-line-flags\" rel=\"nofollow noreferrer\">golang flags example</a> and you should check <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow noreferrer\">godocs on flags</a> particularly for default behavior and custom usage functions, if you have trouble modifying the example then ask again here</p>\n\n<p><strong>Updated:</strong>\nSorry, as Peter pointed to in comments my answer is a little muddled and incorrect.</p>\n\n<p>To Clarify, in the example provided in the \"golang flags example\" link given flag.Bool is used. When using flag.Bool a pointer is returned.</p>\n\n<p>In the Question you use flag.BoolVar which allows you to reference a bool value. your use of flag.BoolVar in the question is in fact correct.</p>\n\n<p>So all you need to do is address the scoping issue, not really clear what you are trying to do with your Usage but here is a working example that should clarify:</p>\n\n<p>Note: in this example the flag vars could have stayed inside main as they are not required in the Usage function</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc Usage() {\n    // custom usage (help) output here if needed\n    fmt.Println(\"\")\n    fmt.Println(\"Application Flags:\")\n    flag.PrintDefaults()\n    fmt.Println(\"\")\n}\n\nvar ArgTest, ArgSend, ArgMacro bool\n\nfunc main() {\n\n    // Args parse\n    flag.BoolVar(&amp;ArgTest, \"test\", false, \"run test mode\")\n    flag.BoolVar(&amp;ArgSend, \"send\", false, \"run send mode\")\n    flag.BoolVar(&amp;ArgMacro, \"macro\", false, \"run macro mode\")\n\n    flag.Parse()\n\n    // assign custom usage function (will be shown by default if -h or --help flag is passed)\n    flag.Usage = Usage\n\n    // if no flags print usage (not default behaviour)\n    if len(os.Args) == 1 {\n        Usage()\n    }\n\n    fmt.Printf(\"ArgTest val: %t\\n\", ArgTest)\n    fmt.Printf(\"ArgSend val: %t\\n\", ArgSend)\n    fmt.Printf(\"ArgMacro val: %t\\n\", ArgMacro)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 8629072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5731c78f87782981828c2e3b18f5fb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefano Conte", "link": "https://stackoverflow.com/users/8629072/stefano-conte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6157, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1506538126, "creation_date": 1506184081, "last_edit_date": 1506227800, "question_id": 46381817, "link": "https://stackoverflow.com/questions/46381817/golang-command-line-arguments-undefined-variable", "title": "Golang : command-line-arguments undefined: variable", "body": "<p>I want to create an external function for usage display in Golang, but I don't know how to call the flag variable. This is my actual code:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc Usage() {\n    if ArgSend {\n        fmt.Printf(\"Usage: SEND\")\n        flag.PrintDefaults()\n        os.Exit(0)\n\n    } else if ArgTest {\n        fmt.Printf(\"Usage: -test\")\n        flag.PrintDefaults()\n        os.Exit(0)\n\n    } else if ArgMacro {\n        fmt.Printf(\"Usage: -macro\")\n        os.Exit(0)\n\n    } else {\n        fmt.Printf(\"Usage of: &lt;-test|-send|-macro&gt;\\n\")\n        os.Exit(0)\n    }\n}\n\n\n\nfunc main() {\n\n    //defaults variables\n    ArgTest, ArgSend, ArgMacro  := false, false, false\n\n    // Args parse\n    flag.BoolVar(&amp;ArgTest, \"-test\", false, \"run test mode\")\n    flag.BoolVar(&amp;ArgSend, \"-send\", false, \"run send mode\")\n    flag.BoolVar(&amp;ArgMacro, \"-macro\", false, \"run macro mode\")\n\n    flag.Parse()\n\n    Usage()\n}\n</code></pre>\n\n<p>Return this error:</p>\n\n<pre><code>F:\\dev\\GoLang\\gitlab\\EasySend\\tmp&gt;go run stackoverflow.go -test\n# command-line-arguments\n.\\stackoverflow.go:10:5: undefined: ArgSend\n.\\stackoverflow.go:15:12: undefined: ArgTest\n.\\stackoverflow.go:20:12: undefined: ArgMacro\n</code></pre>\n\n<p>How can  I check flag parse if ArgSend is true/false?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1506179268, "last_edit_date": 1506179268, "creation_date": 1506178883, "answer_id": 46380950, "question_id": 46380919, "link": "https://stackoverflow.com/questions/46380919/golang-error-fatal-error-all-goroutines-are-asleep-deadlock/46380950#46380950", "title": "golang error: fatal error: all goroutines are asleep deadlock", "body": "<p>The program deadlocks because main is waiting for the goroutines to complete and the goroutines are waiting for work on the channel. To fix the problem, swap the order of these lines in main</p>\n\n<pre><code>wg.Wait()\nclose(toSend)\n</code></pre>\n\n<p>to </p>\n\n<pre><code>close(toSend)\nwg.Wait()\n</code></pre>\n\n<p>When the channel is closed, the for loop on the channel in the workers exit and the workers call wg.Done().</p>\n"}], "owner": {"reputation": 93, "user_id": 7204615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54176ff575fc7ec6f336c97869756259?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/7204615/lucian-blaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2601, "favorite_count": 0, "accepted_answer_id": 46380950, "answer_count": 1, "score": 1, "last_activity_date": 1506247523, "creation_date": 1506178671, "last_edit_date": 1506247523, "question_id": 46380919, "link": "https://stackoverflow.com/questions/46380919/golang-error-fatal-error-all-goroutines-are-asleep-deadlock", "title": "golang error: fatal error: all goroutines are asleep deadlock", "body": "<p>I want to develop a simple email sender in Go, but I have encountered some problems, This is my actual code:</p>\n\n<pre><code>package main\n\n\nimport (\n    \"flag\"\n    \"sync\"\n    \"fmt\"\n)\n\nvar logLevel = 0\n\nfunc sendEmail(try combo){\n        fmt.Printf(\"test send %s %s %s\\n\", try.to, try.from, try.subject)\n}\n\n// where we actually do the work\nfunc work(toSend chan combo, wg *sync.WaitGroup) {\n    for send := range toSend {\n        sendEmail(send)\n    }\n\n    // let the main thread know we're done\n    wg.Done()\n}\n\n// the basic unit that we pass around\ntype combo struct {\n    to       string\n    from     string\n    subject  string\n    header   string\n    body     string\n    success bool\n}\n\n\nfunc main() {\n\n    //defaults variables\n    emailsList, smtpList        := \"\", \"\"  \n    typeConnect, ConnFileName  := \"\", \"\"\n    delimStart, delimEnd       := \"_STARTSUB_\", \"_ENDSUB_\"\n    threads, bcc := 5,  1\n    skip := 0\n    logFile := \"\"\n\n    // Args parse\n    flag.StringVar(&amp;emailsList, \"e\", \"\", \"load email list (required)\") \n    flag.StringVar(&amp;smtpList, \"s\", \"\", \"load smtp list - (required)\")\n    flag.IntVar(&amp;bcc, \"b\", 1, \"number of emails sent per connection\")\n    flag.IntVar(&amp;threads,\"t\", 2, \"run `N` attempts in parallel threads\")\n    flag.StringVar(&amp;typeConnect, \"c\", \"\",\"direct - send emails directly through smtp\\n\"+\"\\tsocks - send emails through smtp via socks5 [requires -f argument]\\n\"+\"\\thosts - send emails through smtp via server's ip addresses [requires -f argument]\\n\")\n    flag.StringVar(&amp;ConnFileName, \"f\", \"\", \"if sending via socks the list should contain socks5 proxies in the following formats\\n\"+\"\\tip:port\\n\"+\"\\tip:port:user:pass\\n\")\n    flag.StringVar(&amp;delimStart, \"q\", \"_STARTSUB_\", \"start delimiter for subject.\")\n    flag.StringVar(&amp;delimEnd, \"w\", \"_ENDSUB_\", \"end delimiter for subject.\")\n    flag.IntVar(&amp;skip, \"l\", 0, \"skip first `n` lines of input\")\n    flag.StringVar(&amp;logFile, \"debug\", \"\", \"write debug output to `file`\")\n    flag.IntVar(&amp;logLevel, \"d\", 0, \"set debug `level`\")\n\n    flag.Parse()\n\n    var wg sync.WaitGroup // keep track of the workers\n    toSend := make(chan combo) // to the workers\n\n    // initialize n workers\n    wg.Add(int(threads))\n    for i := 0; i &lt; int(threads); i++ {\n        go work(toSend, &amp;wg)\n    }\n\n    for email := range StreamLines(\"EMAILS\", emailsList, skip) {\n\n        from := \"info@testfrom.com\"\n        subject := \"test subject\"\n        header := \"test header\"\n        body   := \"test boady\"\n\n        try := combo{email,from, subject, header, body, false}\n        toSend &lt;- try\n    }\n\n    wg.Wait()\n    close(toSend)\n\n    fmt.Println(\"Send emails Done!\")\n}\n</code></pre>\n\n<p>I'm try to use channels for pass email to workers in golang, and return this error:</p>\n\n<pre><code>F:\\dev\\GoLang\\gitlab\\EasySend&gt;go run main.go usage.go utils.go  -e emails.txt\ntest send test@gmail.com info@testfrom.com test subject\ntest send test@gmail.com info@testfrom.com test subject\ntest send test@gmail.com info@testfrom.com test subject\ntest send test@gmail.com info@testfrom.com test subject\ntest send test@gmail.com info@testfrom.com test subject\ntest send test@gmail.com info@testfrom.com test subject\ntest send test@gmail.com info@testfrom.com test subject\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [semacquire]:\nsync.runtime_Semacquire(0xc04204c0fc)\n        C:/Go/src/runtime/sema.go:56 +0x40\nsync.(*WaitGroup).Wait(0xc04204c0f0)\n        C:/Go/src/sync/waitgroup.go:131 +0x79\nmain.main()\n        F:/dev/GoLang/gitlab/EasySend/main.go:90 +0x7af\n\ngoroutine 18 [chan receive]:\nmain.work(0xc04203e0c0, 0xc04204c0f0)\n        F:/dev/GoLang/gitlab/EasySend/main.go:19 +0x110\ncreated by main.main\n        F:/dev/GoLang/gitlab/EasySend/main.go:76 +0x5db\n\ngoroutine 19 [chan receive]:\nmain.work(0xc04203e0c0, 0xc04204c0f0)\n        F:/dev/GoLang/gitlab/EasySend/main.go:19 +0x110\ncreated by main.main\n        F:/dev/GoLang/gitlab/EasySend/main.go:76 +0x5db\nexit status 2\n</code></pre>\n\n<p>I want to know where I'm wrong? Way return this error </p>\n\n<blockquote>\n  <p>\"fatal error: all goroutines are asleep - deadlock!\"</p>\n</blockquote>\n"}, {"tags": ["mysql", "database", "go", "web", "blob"], "answers": [{"tags": [], "owner": {"reputation": 119, "user_id": 2707807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k8CyS.jpg?s=128&g=1", "display_name": "wgoudsbloem", "link": "https://stackoverflow.com/users/2707807/wgoudsbloem"}, "is_accepted": true, "score": 2, "last_activity_date": 1506171145, "creation_date": 1506171145, "answer_id": 46379787, "question_id": 46379393, "link": "https://stackoverflow.com/questions/46379393/image-blob-jpeg-from-mysql-database-to-html-using-golang/46379787#46379787", "title": "image (blob/jpeg) from MySql database to html using GoLang", "body": "<p>you have to base64 the binary and add that to an image src attribute. not really a go question, so here is more info:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/8499633/how-to-display-base64-images-in-html\">How to display Base64 images in HTML?</a></p>\n"}], "owner": {"reputation": 15, "user_id": 8540529, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PeooUmbAsmk/AAAAAAAAAAI/AAAAAAAAB5c/DPxF1qrg7_I/photo.jpg?sz=128", "display_name": "Ara Balaki Mr Balaki", "link": "https://stackoverflow.com/users/8540529/ara-balaki-mr-balaki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 700, "favorite_count": 0, "closed_date": 1506251954, "accepted_answer_id": 46379787, "answer_count": 1, "score": 1, "last_activity_date": 1506171145, "creation_date": 1506168421, "question_id": 46379393, "link": "https://stackoverflow.com/questions/46379393/image-blob-jpeg-from-mysql-database-to-html-using-golang", "closed_reason": "Needs details or clarity", "title": "image (blob/jpeg) from MySql database to html using GoLang", "body": "<p>I have started using Go lately, and right now developing an example ecommerce website and i want to make item cards with thumbnails but i can't find a way to get the images from my database to html templates inside  tags.</p>\n\n<p>I'm using Go's native http server.</p>\n\n<p>Every bit of help would be great, Thanks!</p>\n"}, {"tags": ["go", "tensorflow", "tensorflow-serving"], "comments": [{"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506168138, "post_id": 46378102, "comment_id": 79717202, "body": "Are you sure that <code>save_1&#47;StringJoin&#47;inputs_1</code> is the same vaue of <code>input_dict[&quot;inputs&quot;]</code> ?"}, {"owner": {"reputation": 492, "user_id": 1579570, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ae6d56376ff1a1bc50e5d31fd58e34ae?s=128&d=identicon&r=PG", "display_name": "Yegor Lukash", "link": "https://stackoverflow.com/users/1579570/yegor-lukash"}, "reply_to_user": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506326517, "post_id": 46378102, "comment_id": 79757628, "body": "I updated topic with info about &quot;save_1/StringJoin/inputs_1&quot;. I tried other keys, but result was the same - error."}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506328698, "post_id": 46378102, "comment_id": 79758835, "body": "Can you show the output of <code>print(input_dict[&quot;inputs&quot;])</code>?"}, {"owner": {"reputation": 492, "user_id": 1579570, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ae6d56376ff1a1bc50e5d31fd58e34ae?s=128&d=identicon&r=PG", "display_name": "Yegor Lukash", "link": "https://stackoverflow.com/users/1579570/yegor-lukash"}, "reply_to_user": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506330663, "post_id": 46378102, "comment_id": 79760124, "body": "All input_dict: <code>{u&#39;inputs&#39;: &lt;tf.Tensor &#39;Placeholder:0&#39; shape=(?,) dtype=string&gt;}</code>"}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506331361, "post_id": 46378102, "comment_id": 79760637, "body": "Hm.. what happens if you change your Go feed dict from ` m.Graph.Operation(&quot;save_1/StringJoin/inputs_1&quot;).Output(0): t,` to ` m.Graph.Operation(&quot;Placeholder&quot;).Output(0): t,` ?"}, {"owner": {"reputation": 492, "user_id": 1579570, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ae6d56376ff1a1bc50e5d31fd58e34ae?s=128&d=identicon&r=PG", "display_name": "Yegor Lukash", "link": "https://stackoverflow.com/users/1579570/yegor-lukash"}, "reply_to_user": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506332735, "post_id": 46378102, "comment_id": 79761570, "body": "It seems like works. Does exist rule how to find correct name? I will check more carefully and write result here."}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1506333428, "post_id": 46378102, "comment_id": 79762004, "body": "I write the answer"}], "answers": [{"tags": [], "owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "is_accepted": true, "score": 0, "last_activity_date": 1506333686, "creation_date": 1506333686, "answer_id": 46402484, "question_id": 46378102, "link": "https://stackoverflow.com/questions/46378102/how-to-feed-input-string-with-shape-to-tensorflow-model-using-golang/46402484#46402484", "title": "How to feed input string with shape=[?] to tensorflow model using golang", "body": "<p>The error tells you <code>You must feed a value for placeholder tensor 'Placeholder'</code>: this means that the graph can't be built until you feed a value for that placeholder.</p>\n\n<p>In your python code, your feed it at the line: </p>\n\n<pre><code>input_dict[\"inputs\"]: (\"I went and saw this movie last night\",)\n</code></pre>\n\n<p>In fact, <code>input_dict[\"inputs\"]</code> is evaluated to: <code>&lt;tf.Tensor 'Placeholder:0' shape=(?,) dtype=string&gt;</code>.</p>\n\n<p>In your Go code, instead, you're looking for a tensor named <code>save_1/StringJoin/inputs_1</code> that's not the placeholder.</p>\n\n<p>The rule to follow is: use the same input both in Python &amp; Go.</p>\n\n<p>To solve the problem, thus, you just have to extract from the graph the placeholder named <code>Placeholder</code> (just like in python) and then use it.</p>\n\n<pre><code>m.Graph.Operation(\"Placeholder\").Output(0): t,\n</code></pre>\n\n<p>Also, I suggest you to use a more complete and easy to use wrapper around the tensorflow API: <a href=\"https://github.com/galeone/tfgo\" rel=\"nofollow noreferrer\">tfgo</a></p>\n"}, {"tags": [], "owner": {"reputation": 492, "user_id": 1579570, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ae6d56376ff1a1bc50e5d31fd58e34ae?s=128&d=identicon&r=PG", "display_name": "Yegor Lukash", "link": "https://stackoverflow.com/users/1579570/yegor-lukash"}, "is_accepted": false, "score": 0, "last_activity_date": 1508772253, "creation_date": 1508772253, "answer_id": 46893010, "question_id": 46378102, "link": "https://stackoverflow.com/questions/46378102/how-to-feed-input-string-with-shape-to-tensorflow-model-using-golang/46893010#46893010", "title": "How to feed input string with shape=[?] to tensorflow model using golang", "body": "<p>One more thing. I read TF docs and found this <a href=\"https://www.tensorflow.org/programmers_guide/saved_model#cli_to_inspect_and_execute_savedmodel\" rel=\"nofollow noreferrer\">topic</a></p>\n\n<p>It helps to find correct input/output keys, example of response:</p>\n\n<pre><code>The given SavedModel SignatureDef contains the following input(s): inputs['inputs'] tensor_info:\n    dtype: DT_STRING\n    shape: (-1)\n    name: Placeholder:0\n</code></pre>\n\n<p>PS/ Posted as answer for focusing</p>\n"}], "owner": {"reputation": 492, "user_id": 1579570, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/ae6d56376ff1a1bc50e5d31fd58e34ae?s=128&d=identicon&r=PG", "display_name": "Yegor Lukash", "link": "https://stackoverflow.com/users/1579570/yegor-lukash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1806, "favorite_count": 0, "accepted_answer_id": 46402484, "answer_count": 2, "score": 1, "last_activity_date": 1508772253, "creation_date": 1506159120, "last_edit_date": 1506326427, "question_id": 46378102, "link": "https://stackoverflow.com/questions/46378102/how-to-feed-input-string-with-shape-to-tensorflow-model-using-golang", "title": "How to feed input string with shape=[?] to tensorflow model using golang", "body": "<p>Python code of train model:</p>\n\n<pre><code>input_schema = dataset_schema.from_feature_spec({\n    REVIEW_COLUMN: tf.FixedLenFeature(shape=[], dtype=tf.string),\n    LABEL_COLUMN: tf.FixedLenFeature(shape=[], dtype=tf.int64)\n})\n</code></pre>\n\n<p>In python predictions work fine. Example of client:</p>\n\n<pre><code>loaded_model = tf.saved_model.loader.load(sess, [\"serve\"], '/tmp/model/export/Servo/1506084916')\ninput_dict, output_dict =_signature_def_to_tensors(loaded_model.signature_def['default_input_alternative:None'])\nstart = datetime.datetime.now()\nout = sess.run(output_dict, feed_dict={input_dict[\"inputs\"]: (\"I went and saw this movie last night\",)})\nprint(out)\nprint(\"Time all: \", datetime.datetime.now() - start)\n</code></pre>\n\n<p>But golang client does not work:</p>\n\n<pre><code>m, err := tf.LoadSavedModel(\"/tmp/model/export/Servo/1506084916\", []string{\"serve\"}, &amp;tf.SessionOptions{})\nif err != nil {\n    panic(fmt.Errorf(\"load model: %s\", err))\n}\n\ndata := \"I went and saw this movie last night\"\nt, err := tf.NewTensor([]string{data})\nif err != nil {\n    panic(fmt.Errorf(\"tensor err: %s\", err))\n}\nfmt.Printf(\"tensor: %v\", t.Shape())\n\noutput, err = m.Session.Run(\n    map[tf.Output]*tf.Tensor{\n        m.Graph.Operation(\"save_1/StringJoin/inputs_1\").Output(0): t,\n    }, []tf.Output{\n        m.Graph.Operation(\"linear/binary_logistic_head/predictions/classes\").Output(0),\n    }, nil,\n)\nif err != nil {\n    panic(fmt.Errorf(\"run model: %s\", err))\n}\n</code></pre>\n\n<p>I got error:</p>\n\n<blockquote>\n  <p>panic: run model: You must feed a value for placeholder tensor\n  'Placeholder' with dtype string and shape [?]\n           [[Node: Placeholder = Placeholder_output_shapes=[[?]], dtype=DT_STRING, shape=[?],\n  _device=\"/job:localhost/replica:0/task:0/cpu:0\"]]</p>\n</blockquote>\n\n<p>How can I present <code>shape=[?]</code> tensor with golang? Or I need to change input format of python training script?</p>\n\n<p>UPD:</p>\n\n<p>This string <code>\"save_1/StringJoin/inputs_1\"</code> I received after running this python-code:</p>\n\n<pre><code>for n in sess.graph.as_graph_def().node:\n    if \"inputs\" in n.name:\n        print(n.name)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>transform/transform/inputs/review/Placeholder \ntransform/transform/inputs/review/Identity \ntransform/transform/inputs/label/Placeholder \ntransform/transform/inputs/label/Identity \ntransform/transform_1/inputs/review/Placeholder \ntransform/transform_1/inputs/review/Identity \ntransform/transform_1/inputs/label/Placeholder \ntransform/transform_1/inputs/label/Identity \nsave_1/StringJoin/inputs_1 \nsave_2/StringJoin/inputs_1\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1506156803, "post_id": 46377604, "comment_id": 79714172, "body": "It&#39;s called &quot;internal&quot; for a reason. You cannot import some other project&#39;s <code>internal</code>s."}], "answers": [{"tags": [], "owner": {"reputation": 26448, "user_id": 10322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa46a3814b72439b1d2efa8f7c9162c2?s=128&d=identicon&r=PG", "display_name": "ctcherry", "link": "https://stackoverflow.com/users/10322/ctcherry"}, "is_accepted": true, "score": 2, "last_activity_date": 1506157086, "creation_date": 1506157086, "answer_id": 46377844, "question_id": 46377604, "link": "https://stackoverflow.com/questions/46377604/cannot-find-package-internal-cpu-error-in-go/46377844#46377844", "title": "Cannot find package &quot;internal/cpu&quot; error in GO", "body": "<p>You will not be able to import <code>internal/cpu</code> due to this rule:</p>\n\n<blockquote>\n  <p>Code in or below a directory named \"internal\" is importable only by code in the directory tree rooted at the parent of \"internal\".</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/cmd/go/#hdr-Internal_Directories\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-Internal_Directories</a></p>\n\n<p>You can copy out the parts of the code you need, just make sure to follow the LICENSE, which is fairly open:</p>\n\n<p><a href=\"https://golang.org/LICENSE\" rel=\"nofollow noreferrer\">https://golang.org/LICENSE</a></p>\n"}], "owner": {"reputation": 4223, "user_id": 710955, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GvorM.png?s=128&g=1", "display_name": "LeMoussel", "link": "https://stackoverflow.com/users/710955/lemoussel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 398, "favorite_count": 0, "accepted_answer_id": 46377844, "answer_count": 1, "score": -1, "last_activity_date": 1506157086, "creation_date": 1506155191, "last_edit_date": 1506155919, "question_id": 46377604, "link": "https://stackoverflow.com/questions/46377604/cannot-find-package-internal-cpu-error-in-go", "title": "Cannot find package &quot;internal/cpu&quot; error in GO", "body": "<p>Go as an internal package <a href=\"https://github.com/golang/go/blob/master/src/internal/cpu/cpu.go#L15:L32\" rel=\"nofollow noreferrer\">internal/cpu</a> that exposes all the necessary functions to detect flavors of SIMD. \nSee an example of use in the <a href=\"https://github.com/golang/go/blob/master/src/bytes/bytes_amd64.go#L19\" rel=\"nofollow noreferrer\">bytes package</a>.</p>\n\n<p>I'm trying to get capability flags variables from <code>internal/cpu</code> package but when i'm trying to execute go build, i'm getting following error: <code>cannot find package \"internal/cpu</code></p>\n\n<pre><code>import (\n    \"fmt\"\n    \"internal/cpu\"\n)\n\nfunc main() {\n    if cpu.X86.HasAVX2 {\n        fmt.Println(\"AVX2 SIMD instructions available\")\n    }\n}\n</code></pre>\n\n<p>What i did wrong?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 2, "last_activity_date": 1506153355, "creation_date": 1506153355, "answer_id": 46377381, "question_id": 46377302, "link": "https://stackoverflow.com/questions/46377302/golang-when-iterate-map-how-to-get-key-as-pointer/46377381#46377381", "title": "golang when iterate map, how to get key as pointer?", "body": "<p>You are correct about the issue being related to <code>k</code> in the range loop. <code>k</code> is a local variable and in each iteration you are simply adding the same pointer address to <code>slice</code>.</p>\n\n<p>You can always use pointer to a <code>MyIntC</code> as map key.</p>\n\n<pre><code>// ...\nslice := make([]*MyIntC,0, 5)\n// ...\nmapInts := make(map[*MyIntC]string)\n// ...\nfor k, _ := range mapInts {\n   slice = append(slice, k)\n}\n// ...\n</code></pre>\n\n<p>Working example: <a href=\"https://play.golang.org/p/Opd7RVywNa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Opd7RVywNa</a></p>\n"}, {"tags": [], "owner": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "is_accepted": false, "score": 0, "last_activity_date": 1611176838, "creation_date": 1611176838, "answer_id": 65817669, "question_id": 46377302, "link": "https://stackoverflow.com/questions/46377302/golang-when-iterate-map-how-to-get-key-as-pointer/65817669#65817669", "title": "golang when iterate map, how to get key as pointer?", "body": "<p>You can't get an address of a map key. That's to prevent you from modifying the key, as doing so could affect the position of the value inside the map.\nIn addition, Go also disallows <a href=\"https://stackoverflow.com/questions/32495402/why-does-go-forbid-taking-the-address-of-map-member-yet-allows-slice-el\">getting the address of a map <em>value</em></a>.</p>\n<p>Beware of the &quot;solution&quot; of storing pointers as map keys as the semantics of doing so is very different - the value of the <strong>pointer</strong> to the key will be used for lookup and uniqueness, instead of the value of the <strong>key</strong> itself.</p>\n<pre><code>type MyIntC struct {\n   MyInt int\n}\n\nfunc main() {\n  myInt5 := &amp;MyIntC{MyInt: 50}\n\n  mapInts := make(map[*MyIntC]string)\n  mapInts[myInt5] = &quot;something 50&quot;\n\n  _, found := mapInts[&amp;MyIntC{MyInt: 50}]\n\n  fmt.Println(found)\n}\n</code></pre>\n<p>Prints <code>false</code>.</p>\n<p>See <a href=\"https://abhinavg.net/posts/pointers-as-map-keys/\" rel=\"nofollow noreferrer\">Go Gotcha: Struct pointers as map keys</a> for more details on that.</p>\n<p>The real solution is to &quot;live with it&quot;, i.e. accept the fact that you will get copies of keys when iterating over the map. After all, the keys should be short and unique, so copying them shouldn't be an issue.</p>\n"}], "owner": {"reputation": 21, "user_id": 8659788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c72241116c5a9fa222c50eaec600cc3c?s=128&d=identicon&r=PG&f=1", "display_name": "briancrypto", "link": "https://stackoverflow.com/users/8659788/briancrypto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 879, "favorite_count": 1, "accepted_answer_id": 46377381, "answer_count": 2, "score": 1, "last_activity_date": 1611176838, "creation_date": 1506152684, "question_id": 46377302, "link": "https://stackoverflow.com/questions/46377302/golang-when-iterate-map-how-to-get-key-as-pointer", "title": "golang when iterate map, how to get key as pointer?", "body": "<p>Currently I am storing a map with key being a Struct (MyIntC). I would like to retrieve all the key in the map as a slice. The slice will be pointer to map key. This is so there is no copy of multiple key.</p>\n\n<p>When I tried in here (<a href=\"https://play.golang.org/p/bclmCh_YV5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bclmCh_YV5</a>), it is not working.</p>\n\n<p>All elements in the slice will point to the last map key element iterated.</p>\n\n<p>Why is that so? How could I overcome this?</p>\n\n<p>Note: I suspect it is very similar issue to <a href=\"https://stackoverflow.com/questions/45468089/slice-of-structs-vs-a-slice-of-pointers-to-structs\">Slice of structs vs a slice of pointers to structs</a>, in which I am always using the local variable address.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1506144994, "post_id": 46376093, "comment_id": 79711681, "body": "Group it based on what, same value for same key or based on a predefined values? Please update the grouping criteria"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1506155965, "post_id": 46376093, "comment_id": 79713963, "body": "You might want to read <a href=\"http://stackoverflow.com/help/how-to-ask\">How do I ask a good question</a>, which enhances the probability for getting a useful answer <i>drastically</i>. You might find <a href=\"https://en.m.wikipedia.org/wiki/Eric_S._Raymond\" rel=\"nofollow noreferrer\">ESR</a>&#39;s excellent essay <a href=\"http://catb.org/~esr/faqs/smart-questions.html\" rel=\"nofollow noreferrer\">How To Ask Questions The Smart Way</a> helpful. And keep in mind that your are not talking to subordinates, but to peers."}], "owner": {"reputation": 375, "user_id": 1421891, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/a718dd0db1d5aee7fe226027f8e731e8?s=128&d=identicon&r=PG", "display_name": "Krishna Satya", "link": "https://stackoverflow.com/users/1421891/krishna-satya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1506145075, "creation_date": 1506141515, "last_edit_date": 1506145075, "question_id": 46376093, "link": "https://stackoverflow.com/questions/46376093/how-to-select-a-single-column-and-group-array", "title": "How to select a single column and group array", "body": "<p>I want to select a single column in mgo which is array of strings currently using this returns a empty array</p>\n\n<pre><code>classifiedColl.Find(nil).Distinct(\"Tags\", &amp;tags)\n</code></pre>\n\n<p>and i want to group it how do i do it. The value i want to group is array of strings.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-ec2", "bigdata"], "comments": [{"owner": {"reputation": 4764, "user_id": 1517410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d0f3c5b683ae64c738cf1af18796e1e?s=128&d=identicon&r=PG", "display_name": "ketan vijayvargiya", "link": "https://stackoverflow.com/users/1517410/ketan-vijayvargiya"}, "edited": false, "score": 1, "creation_date": 1506152316, "post_id": 46375938, "comment_id": 79713117, "body": "I don&#39;t see why you need a burstable EC2 instance for this."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1506192881, "post_id": 46375938, "comment_id": 79724560, "body": "you might like to look at aws lambda"}], "answers": [{"tags": [], "owner": {"reputation": 788, "user_id": 6863801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01618b5209da3de1f5cd30dd362a44eb?s=128&d=identicon&r=PG&f=1", "display_name": "Jinesh Shah", "link": "https://stackoverflow.com/users/6863801/jinesh-shah"}, "is_accepted": true, "score": 1, "last_activity_date": 1506145254, "creation_date": 1506145254, "answer_id": 46376440, "question_id": 46375938, "link": "https://stackoverflow.com/questions/46375938/best-ec2-instance-for-burst-data-processing/46376440#46376440", "title": "Best EC2 Instance for Burst Data Processing", "body": "<p>You can use T2 type of instance. It is suitable for Burstable Performance. You can read more about this <a href=\"https://aws.amazon.com/blogs/aws/low-cost-burstable-ec2-instances/\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Also have a look at <a href=\"https://aws.amazon.com/blogs/aws/choosing-the-right-ec2-instance-type-for-your-application/\" rel=\"nofollow noreferrer\">how to choose right type of instances available in EC2</a></p>\n"}], "owner": {"reputation": 339, "user_id": 597546, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/CPxsU.jpg?s=128&g=1", "display_name": "Shane Da Silva", "link": "https://stackoverflow.com/users/597546/shane-da-silva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 46376440, "answer_count": 1, "score": 0, "last_activity_date": 1506145254, "creation_date": 1506139720, "question_id": 46375938, "link": "https://stackoverflow.com/questions/46375938/best-ec2-instance-for-burst-data-processing", "title": "Best EC2 Instance for Burst Data Processing", "body": "<p>I need some advice on what type of EC2 instance to use for my data processing application. It's a Golang application that utilizes goroutines and channels. It scheduled to check a data source every 10 seconds and could process around one million entries into a database per hour.</p>\n\n<p>Thanks for the help.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3788941"}, "edited": false, "score": 0, "creation_date": 1527735236, "post_id": 46377542, "comment_id": 88241826, "body": "Maybe go should allow people to hold dependencies locally"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 2, "last_activity_date": 1506154680, "creation_date": 1506154680, "answer_id": 46377542, "question_id": 46375642, "link": "https://stackoverflow.com/questions/46375642/golang-error-cannot-find-package-when-running-go-get/46377542#46377542", "title": "golang Error: `cannot find package` when running go get", "body": "<p>You've copied outdated code, which won't compile. </p>\n\n<p>code.google.com/p/go.net/context</p>\n\n<p>code.google.com has shut down, this is an old import path which can no longer be used. The error tells you what has gone wrong, that path can't be imported as it doesn't exist (try visiting it in a browser). </p>\n\n<p>You could try to spend a lot of time fixing up the old imports, only to find that the packages have changed anyway and will no longer compile, so I'd recommend starting with the latest version and contacting the authors of github.com/ipfs/go-ipfs on github, or choosing another package to work with. </p>\n"}], "owner": {"reputation": 5661, "user_id": 2541276, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/100001587714573/picture?type=large", "display_name": "Rajkumar Natarajan", "link": "https://stackoverflow.com/users/2541276/rajkumar-natarajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 922, "favorite_count": 0, "accepted_answer_id": 46377542, "answer_count": 1, "score": -2, "last_activity_date": 1506154680, "creation_date": 1506136212, "question_id": 46375642, "link": "https://stackoverflow.com/questions/46375642/golang-error-cannot-find-package-when-running-go-get", "title": "golang Error: `cannot find package` when running go get", "body": "<p>I'm trying to solve the example provided in Orielly book Decentrallized Applications.</p>\n\n<p>The <code>go-ipfs</code> package seems to be outdated and the new version is not working fine. so I manually coping the older releases and try to compile go-kerala.</p>\n\n<p>Eventhough some of the folder exists in the path I get error.</p>\n\n<p>For example, \n<code>/home/rajkumar/go/src/github.com/ipfs/go-\n     ipfs/Godeps/_workspace/src/github.com/jbenet/go-base58 (from $GOPATH)</code> is present after I have manually copied older release file but still go-get command gives error.</p>\n\n<pre><code> $go get -d github.com/llSourcell/kerala\n package code.google.com/p/go.net/context: unrecognized import path \n \"code.google.com/p/go.net/context\" (parse \n https://code.google.com/p/go.net/context?go-get=1: no go-import meta \n tags (meta tag github.com/golang/go did not match import path \n code.google.com/p/go.net/context))\n package github.com/ipfs/go-\n ipfs/Godeps/_workspace/src/github.com/jbenet/go-base58: cannot find \n package \"github.com/ipfs/go-\n ipfs/Godeps/_workspace/src/github.com/jbenet/go-base58\" in any of:\n    /usr/local/go/src/github.com/ipfs/go-\n ipfs/Godeps/_workspace/src/github.com/jbenet/go-base58 (from $GOROOT)\n    /home/rajkumar/go/src/github.com/ipfs/go-\n ipfs/Godeps/_workspace/src/github.com/jbenet/go-base58 (from $GOPATH)\n package github.com/ipfs/go-\n ipfs/Godeps/_workspace/src/github.com/jbenet/go-ctxgroup: cannot find \n package \"github.com/ipfs/go-\n ipfs/Godeps/_workspace/src/github.com/jbenet/go-ctxgroup\" in any of:\n    /usr/local/go/src/github.com/ipfs/go-\n ipfs/Godeps/_workspace/src/github.com/jbenet/go-ctxgroup (from $GOROOT)\n /home/rajkumar/go/src/github.com/ipfs/go-\n   ipfs/Godeps/_workspace/src/github.com/jbenet/go-ctxgroup (from $GOPATH)\n package github.com/ipfs/go-ipfs/Godeps/_workspace/src/github.com/jbenet/go-datastore: cannot find \n package \"github.com/ipfs/go-ipfs/Godeps/_workspace/src/github.com/jbenet/go-datastore\" in any of:\n    /usr/local/go/src/github.com/ipfs/go-ipfs/Godeps/_workspace/src/github.com/jbenet/go-datastore (from $GOROOT)\n    /home/rajkumar/go/src/github.com/ipfs/go-ipfs/Godeps/_workspace/src/github.com/jbenet/go-datastore (from $GOPATH)\n package github.com/ipfs/go-ipfs/Godeps/_workspace/src/github.com/jbenet/go-datastore/sync: cannot find package \"github.com/ipfs/go-ipfs/Godeps/_workspace/src/github.com/jbenet/go-datastore/sync\" in any of:\n    /usr/local/go/src/github.com/ipfs/go-ipfs/Godeps/_workspace/src/github.com/jbenet/go-datastore/sync (from $GOROOT)\n    /home/rajkumar/go/src/github.com/ipfs/go-ipfs/Godeps/_workspace/src/github.com/jbenet/go-datastore/sync (from $GOPATH)\n</code></pre>\n\n<p>Is there any step I'm missing to resolve the error.</p>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 1, "creation_date": 1506128630, "post_id": 46374933, "comment_id": 79709330, "body": "Refer to <code>crypto&#47;cipher&#47;xor.go</code> XOR bytes implementation <a href=\"https://github.com/golang/go/blob/master/src/crypto/cipher/xor.go#L45-L54\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/crypto/cipher/&hellip;</a> and design yours."}, {"owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1506130390, "post_id": 46374933, "comment_id": 79709605, "body": "@jeevatkm the variable &quot;a&quot; in the example doesn&#39;t seem to be &quot;byte&quot; or a slice, which makes it different than mine. Unless if I&#39;m missing something?"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1506139951, "post_id": 46374933, "comment_id": 79710945, "body": "In the above source code reference link; <code>dst</code>, <code>a</code>, <code>b</code> is a byte slice."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1506138294, "last_edit_date": 1506138294, "creation_date": 1506128632, "answer_id": 46375007, "question_id": 46374933, "link": "https://stackoverflow.com/questions/46374933/xoring-a-slice-in-go/46375007#46375007", "title": "xoring a slice in Go", "body": "<p>The application should xor the individual bytes.  Something like this:</p>\n\n<pre><code>var random [4]byte\nfor i, b := range something {\n    random[i&amp;3] ^= b  // xor b on element of random\n}\n</code></pre>\n\n<p>This sets </p>\n\n<pre><code>random[0] = random[0] ^ something[0] ^ something[4] ....\nrandom[1] = random[1] ^ something[1] ^ something[5] ...\n... and so on\n</code></pre>\n"}], "owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4073, "favorite_count": 1, "accepted_answer_id": 46375007, "answer_count": 1, "score": 2, "last_activity_date": 1506138294, "creation_date": 1506127715, "last_edit_date": 1506135264, "question_id": 46374933, "link": "https://stackoverflow.com/questions/46374933/xoring-a-slice-in-go", "title": "xoring a slice in Go", "body": "<p>So I'm trying to xor random, which is 4 bytes, with every four bytes of something. The thing is, I want to change random to ans (which is the result of the xor) and then keep going. So basically the random variable will be a fixed number the first time but will change afterwards until the loop ends. My code seems to have the correct logic, however, I keep getting\n(operator ^ not defined on slice)</p>\n\n<pre><code>random := 4 bytes\nfor j:=0;j&lt;len(something);j+=4{\nans:=something[j:j+4] ^ random\nrandom=ans\n}\n</code></pre>\n\n<p>My guess is, slice doesn't allow xor, and something will have to be slice since I'm kind of slicing the array into multiple bytes. Any idea how to solve this problem?</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506127711, "post_id": 46374920, "comment_id": 79709167, "body": "That seems right.  0x10410028 is the address of 1. Whereas X{} is an empty struct which has is no address so &amp;{}.  Empty structs don&#39;t take space. Change <code>type X struct{}</code> to <code>type X int</code> and see what happens."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506127867, "post_id": 46374920, "comment_id": 79709189, "body": "The default format is <code>%v</code>, and the <a href=\"https://golang.org/pkg/fmt/#hdr-Printing\" rel=\"nofollow noreferrer\">documentation</a> lists the default format for each type."}, {"owner": {"reputation": 1612, "user_id": 1806348, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/7TqKN.png?s=128&g=1", "display_name": "Jochem Kuijpers", "link": "https://stackoverflow.com/users/1806348/jochem-kuijpers"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506127870, "post_id": 46374920, "comment_id": 79709190, "body": "@reticentroot Oh, I was trying to give a minimal working example. I&#39;ve edited the struct to include a string; same behaviour."}, {"owner": {"reputation": 1612, "user_id": 1806348, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/7TqKN.png?s=128&g=1", "display_name": "Jochem Kuijpers", "link": "https://stackoverflow.com/users/1806348/jochem-kuijpers"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506127977, "post_id": 46374920, "comment_id": 79709215, "body": "@JimB Ok good, but then the question remains: Why did they not give primitive types a <code>&#39;&amp;&#39; + printable value</code> for <code>%v</code>? That seems inconsistent to me."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506128043, "post_id": 46374920, "comment_id": 79709234, "body": "@JochemKuijpers <a href=\"https://goplay.space/#JbyofJq88Y\" rel=\"nofollow noreferrer\">goplay.space/#JbyofJq88Y</a> works as expected."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506128360, "post_id": 46374920, "comment_id": 79709281, "body": "@JochemKuijpers example 2.. <a href=\"https://goplay.space/#umNrESpnqY\" rel=\"nofollow noreferrer\">goplay.space/#umNrESpnqY</a> , see this article  <a href=\"https://dave.cheney.net/2014/03/25/the-empty-struct\" rel=\"nofollow noreferrer\">dave.cheney.net/2014/03/25/the-empty-struct</a> also  <a href=\"https://stackoverflow.com/questions/44752447/access-address-of-field-within-structure-variable-in-golang\" title=\"access address of field within structure variable in golang\">stackoverflow.com/questions/44752447/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1506128501, "post_id": 46374920, "comment_id": 79709311, "body": "@JochemKuijpers: they made <code>%v</code> print some useful defaults. You don&#39;t normally print pointers to ints, so it wasn&#39;t included as a default format. These aren&#39;t meant to be tightly specified for machine consumption, this is for human readable output, and if the default doesn&#39;t print exactly what you want you can choose to format it another way. It prints what it prints because the authors wrote it that way"}, {"owner": {"reputation": 1612, "user_id": 1806348, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/7TqKN.png?s=128&g=1", "display_name": "Jochem Kuijpers", "link": "https://stackoverflow.com/users/1806348/jochem-kuijpers"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506128503, "post_id": 46374920, "comment_id": 79709312, "body": "@reticentroot RE: Example 2. How does that work? Does the variable <code>x</code> not have an address, even though I can make a pointer for it?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506128776, "post_id": 46374920, "comment_id": 79709355, "body": "@JochemKuijpers In example two X is no longer an empty struct.  It hold data of type string.  The struct allocates memory to hold your string data. Therefore X.S has an address, whereas In the first example you have an empty struct... there is nothing allocate and Go is knows that so no address is returned. You can take advantage of that fact for example, in implementing a set using a map, map[string]bool vs map[string]struct{}{}, the second will use less memory because struct takes no space and can be nil."}, {"owner": {"reputation": 1612, "user_id": 1806348, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/7TqKN.png?s=128&g=1", "display_name": "Jochem Kuijpers", "link": "https://stackoverflow.com/users/1806348/jochem-kuijpers"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506129059, "post_id": 46374920, "comment_id": 79709395, "body": "@reticentroot I think you missed my edit. I added a string to my original X struct, and it&#39;s pointer still does not display an address. My (only) question boils down to: Why does it not display an address?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1506129559, "post_id": 46374920, "comment_id": 79709487, "body": "@JochemKuijpers Thats normal print behavior as Jim said. If you <code>fmt.Println(&amp;x.S)</code> you&#39;ll get the address of the string.  <a href=\"https://stackoverflow.com/questions/4938612/how-do-i-print-the-pointer-value-of-a-go-object-what-does-the-pointer-value-mea\" title=\"how do i print the pointer value of a go object what does the pointer value mea\">stackoverflow.com/questions/4938612/&hellip;</a>  If you <code>fmt.Printf(&quot;%p\\n&quot;, &amp;x)</code> you&#39;ll get the address of the struct itself  Also read <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\">golang.org/pkg/fmt</a>"}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 1, "last_activity_date": 1506135213, "creation_date": 1506135213, "answer_id": 46375557, "question_id": 46374920, "link": "https://stackoverflow.com/questions/46374920/why-is-fmt-println-not-consistent-when-printing-pointers/46375557#46375557", "title": "Why is fmt.Println not consistent when printing pointers?", "body": "<p>The \"technical\" answer to your question can be found here:</p>\n\n<p><a href=\"https://golang.org/src/fmt/print.go?#L839\" rel=\"nofollow noreferrer\">https://golang.org/src/fmt/print.go?#L839</a></p>\n\n<p>As you can see, when printing pointers to Array, Slice, Struct or Map types, the special rule of printing \"&amp;\" + value applies, but in all other cases the address is printed.</p>\n\n<p>As for why they decided to only apply the rule for those, it seems the authors considered that for \"compound\" objects you'd be interested in always seeing the values (even when using a pointer), but for other simple values this was not the case.</p>\n\n<p>You can see that reasoning here, where they added the rule for the Map type which was not there before:</p>\n\n<p><a href=\"https://github.com/golang/go/commit/a0c5adc35cbfe071786b6115d63abc7ad90578a9#diff-ebda2980233a5fb8194307ce437dd60a\" rel=\"nofollow noreferrer\">https://github.com/golang/go/commit/a0c5adc35cbfe071786b6115d63abc7ad90578a9#diff-ebda2980233a5fb8194307ce437dd60a</a></p>\n\n<p>I would guess this had to do with the fact that it is very common to use for example pointers to Struct to pass them around (so many times you'd just forget to de-reference the pointer when wanting to print the value), but no so common to use pointers to int or string to pass those around (so if you were printing the pointer you were probably interested in seeing the actual address).</p>\n"}], "owner": {"reputation": 1612, "user_id": 1806348, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/7TqKN.png?s=128&g=1", "display_name": "Jochem Kuijpers", "link": "https://stackoverflow.com/users/1806348/jochem-kuijpers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 46375557, "answer_count": 1, "score": -1, "last_activity_date": 1506135213, "creation_date": 1506127570, "last_edit_date": 1506129120, "question_id": 46374920, "link": "https://stackoverflow.com/questions/46374920/why-is-fmt-println-not-consistent-when-printing-pointers", "title": "Why is fmt.Println not consistent when printing pointers?", "body": "<p>I'm an experienced programmer but have never before touched Go in my life. </p>\n\n<p>I just started playing around with it and I found that <code>fmt.Println()</code> will actually print the values of pointers prefixed by <code>&amp;</code>, which is neat.</p>\n\n<p>However, it doesn't do this with all types. I'm pretty sure it is because the types it does not work with are primitives (or at least, Java would call them that, does Go?).</p>\n\n<p>Does anyone know why this inconsistent behaviour exists in the Go <code>fmt</code> library? I can easily retrieve the value by using <code>*p</code>, but for some reason <code>Println</code> doesn't do this.</p>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype X struct {\n    S string\n}\n\nfunc main() {\n    x := X{\"Hello World\"}\n    fmt.Println(&amp;x)     // &amp;{Hello World} &lt;-- displays the pointed-to value prefixed with &amp;\n    fmt.Println(*(&amp;x))  // {Hello World}\n\n    i := int(1)\n    fmt.Println(&amp;i)     // 0x10410028     &lt;-- instead of &amp;1 ?\n    fmt.Println(*(&amp;i))  // 1\n}\n</code></pre>\n"}, {"tags": ["go", "text", "file-io", "io", "output"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1506127309, "post_id": 46374433, "comment_id": 79709098, "body": "On your question hover the mouse atop the tag for go which appears two inches above this comment ..  then click on info to see TONS of documentation on golang with tuts taboot - Welcome to SO ... critical skill of a great developer is ability to become self sufficient and read the docs ... bonus points for reading the spec of whichever language"}], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 8455563, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-BQpkPZ1wjP8/AAAAAAAAAAI/AAAAAAAASBs/eQ2lD0_YioA/photo.jpg?sz=128", "display_name": "M. Knepper", "link": "https://stackoverflow.com/users/8455563/m-knepper"}, "edited": false, "score": 1, "creation_date": 1506124089, "post_id": 46374481, "comment_id": 79708552, "body": "I could do it that way, but I don&#39;t want to rely on the terminal/BASH to output to a file. I&#39;d rather have Go do it from within the program."}], "tags": [], "owner": {"reputation": 186, "user_id": 8657938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7924493761f5c1e272185206b329bfe2?s=128&d=identicon&r=PG&f=1", "display_name": "Krassi Em", "link": "https://stackoverflow.com/users/8657938/krassi-em"}, "is_accepted": false, "score": -1, "last_activity_date": 1506124588, "last_edit_date": 1506124588, "creation_date": 1506122920, "answer_id": 46374481, "question_id": 46374433, "link": "https://stackoverflow.com/questions/46374433/output-to-a-plain-text-file-with-go-programming-language/46374481#46374481", "title": "Output to a plain text file with Go programming language?", "body": "<p>I think it's easy to output to a text file. Simply redirect the program output. On the terminal command line \ngoprogram >> outputFile.txt\nAnyway, I am only providing a suggestion, you don't have to click minuses, given that no explanation is provided if that is urgent, if it's for academia etc. </p>\n"}, {"comments": [{"owner": {"reputation": 153, "user_id": 8455563, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-BQpkPZ1wjP8/AAAAAAAAAAI/AAAAAAAASBs/eQ2lD0_YioA/photo.jpg?sz=128", "display_name": "M. Knepper", "link": "https://stackoverflow.com/users/8455563/m-knepper"}, "edited": false, "score": 0, "creation_date": 1506128854, "post_id": 46374509, "comment_id": 79709369, "body": "This looks super useful! Thank you, I&#39;m going to give it a try! :)"}], "tags": [], "owner": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "is_accepted": false, "score": 3, "last_activity_date": 1506123070, "creation_date": 1506123070, "answer_id": 46374509, "question_id": 46374433, "link": "https://stackoverflow.com/questions/46374433/output-to-a-plain-text-file-with-go-programming-language/46374509#46374509", "title": "Output to a plain text file with Go programming language?", "body": "<p>You can write to a file using <a href=\"https://golang.org/pkg/io/ioutil/#WriteFile\" rel=\"nofollow noreferrer\">ioutil.WriteFile</a>:</p>\n\n<pre><code>data := fmt.Sprintf(\"Age: %d\\nName: %s\\n\", age, name)\n\nerr := ioutil.WriteFile(\"Survey.txt\", []byte(data), 0644)\nif err != nil {\n    log.Fatalf(\"error writing Survey.txt: %s\", err)\n}\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 8455563, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-BQpkPZ1wjP8/AAAAAAAAAAI/AAAAAAAASBs/eQ2lD0_YioA/photo.jpg?sz=128", "display_name": "M. Knepper", "link": "https://stackoverflow.com/users/8455563/m-knepper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1506124588, "creation_date": 1506122567, "question_id": 46374433, "link": "https://stackoverflow.com/questions/46374433/output-to-a-plain-text-file-with-go-programming-language", "title": "Output to a plain text file with Go programming language?", "body": "<p>So I'm trying to get my little program to output to a plain text file. I've been successful with Python, C, C++ and C#, but I can't seem to find any documentation on outputting data to a plain text file with Go. Here's my code:</p>\n\n<pre><code>package main\nimport \"fmt\"\nimport \"strconv\"\n\nfunc main() {\n    var age string\n    fmt.Print(\"\\nWelcome to Survey! What is your age?\\n\\n\")\n    fmt.Scanf(\"%s\", &amp;age)\n      if _, err := strconv.ParseInt(age,10,64); err == nil  {\n          fmt.Printf(\"\\nYou are %s years old!\\n\", age)\n        } else {\n        fmt.Printf(\"\\nThat's not an age! Try again... \\n\")\n      }\n    fmt.Println(\"\\nNice! Now, what is your name?\\n\")\n    fmt.Printf(\"Enter your name: \")\n    var name string\n    fmt.Scanf(\"%s\", &amp;name)\n    fmt.Println(\"\\nHello \" + name + \"! It's nice to meet you!\")\n    fmt.Println(\"\\nWould you like to write your age and name to a text file?\")\n    fmt.Println(\"\\nPress 1 for yes or any other key for no!\\n\")\n    var yes int\n    fmt.Scanf(\"%d\", &amp;yes)\n    if yes == 1 {\n      fmt.Printf(\"\\nAll done! Check Survey.txt in the current directory!\\n\")\n    } else {\n      fmt.Printf(\"\\nOkay! Exiting... \\n\\n\")\n    }\n}\n</code></pre>\n\n<p>You can see if the user enters 1, it prints a message to check the current directory for Survey.txt. Basically all I'm trying to do is have Go write the age and name variables to a plain text file called Survey.txt.</p>\n\n<p>Example:</p>\n\n<pre><code>Age: x\nName: x\n</code></pre>\n\n<p>If anyone has an idea of how to do this, it'd be awesome. My operating system is Xubuntu 16.04.3 LTS, but I don't think that will have much of an impact. The code works fine as is right now, I just want to add that feature. Thanks!</p>\n"}, {"tags": ["math", "go", "floating-point"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 3, "creation_date": 1506121667, "post_id": 46374304, "comment_id": 79708051, "body": "Your output is about as accurate as your inputs were. Your inputs were float64s. If you want more accuracy, don&#39;t start with float64s."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 2, "creation_date": 1506123356, "post_id": 46374304, "comment_id": 79708396, "body": "@user2357112: Accuracy is also a function of the internal representation, which is binary floating point (for decimal, an approximation)."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 7, "last_activity_date": 1506197159, "last_edit_date": 1506197159, "creation_date": 1506121726, "answer_id": 46374331, "question_id": 46374304, "link": "https://stackoverflow.com/questions/46374304/dealing-with-floating-point-number-precision-in-go-arithmetic/46374331#46374331", "title": "Dealing with floating point number precision in Go arithmetic?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/math/big/\" rel=\"noreferrer\">Package big</a></p>\n  \n  <p>import \"math/big\"</p>\n  \n  <p><a href=\"https://golang.org/pkg/math/big/#Float.String\" rel=\"noreferrer\">func (*Float) String</a></p>\n\n<pre><code>func (x *Float) String() string\n</code></pre>\n  \n  <p>String formats x like x.Text('g', 10). (String must be called\n  explicitly, Float.Format does not support %s verb.)</p>\n</blockquote>\n\n<p>Use string input and round the output, for example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    const prec = 200\n    a, _ := new(big.Float).SetPrec(prec).SetString(\"5000\")\n    b, _ := new(big.Float).SetPrec(prec).SetString(\"4000.30\")\n    result := new(big.Float).Sub(a, b)\n    fmt.Println(result)\n    fmt.Println(result.String())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>999.6999999999999999999999999999999999999999999999999999999995\n999.7\n</code></pre>\n\n<p>For decimal, by definition, binary floating-point numbers are an approximation. For example, the decimal number <code>0.1</code> cannot be represented exactly, it is approximately <code>1.10011001100110011001101 * (2**(-4))</code>.</p>\n\n<p>You are already used to this sort of thing since you know about repeating decimals, an approximation for rational numbers: <code>1 / 3 = .333...</code> and <code>3227 / 555 = 5.8144144144...</code>.</p>\n\n<p>See <a href=\"https://docs.oracle.com/cd/E19957-01/800-7895/800-7895.pdf\" rel=\"noreferrer\">What Every Computer Scientist Should Know About Floating-Point Arithmetic</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 402, "user_id": 3358138, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YOGtR.jpg?s=128&g=1", "display_name": "dirk", "link": "https://stackoverflow.com/users/3358138/dirk"}, "is_accepted": false, "score": 1, "last_activity_date": 1506241204, "creation_date": 1506241204, "answer_id": 46388046, "question_id": 46374304, "link": "https://stackoverflow.com/questions/46374304/dealing-with-floating-point-number-precision-in-go-arithmetic/46388046#46388046", "title": "Dealing with floating point number precision in Go arithmetic?", "body": "<p>Maybe try <a href=\"https://github.com/shopspring/decimal\" rel=\"nofollow noreferrer\">github.com/shopspring/decimal</a>.</p>\n\n<p>It calls itself a package for \"arbitrary-precision fixed-point decimal numbers in go\".</p>\n\n<p><em>NOTE: can \"only\" represent numbers with a maximum of 2^31 digits after the decimal point.</em></p>\n"}], "owner": {"reputation": 2155, "user_id": 310783, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d1b0117d379a7ee82da5a716718f1ed?s=128&d=identicon&r=PG", "display_name": "patrick-fitzgerald", "link": "https://stackoverflow.com/users/310783/patrick-fitzgerald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6058, "favorite_count": 2, "accepted_answer_id": 46374331, "answer_count": 2, "score": 2, "last_activity_date": 1506241204, "creation_date": 1506121538, "question_id": 46374304, "link": "https://stackoverflow.com/questions/46374304/dealing-with-floating-point-number-precision-in-go-arithmetic", "title": "Dealing with floating point number precision in Go arithmetic?", "body": "<p>I'm interested in a way to accurately subtract 2 float's in Go.</p>\n\n<p>I've tried to use the  <code>math/big</code> library but I can't get an accurate result.</p>\n\n<p>I've used the <a href=\"https://github.com/MikeMcl/big.js\" rel=\"nofollow noreferrer\">big.js</a> library in Javascript which solves this problem. Is there a similar library/method for Go arithmetic?</p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n        \"math/big\"\n    )\n\n    func main() {\n        const prec = 200\n        a := new(big.Float).SetPrec(prec).SetFloat64(5000.0)\n        b := new(big.Float).SetPrec(prec).SetFloat64(4000.30)\n        result := new(big.Float).Sub(a, b)\n        fmt.Println(result)\n    }\n    Result: 999.6999999999998181010596454143524169921875\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/vomAr87Xln\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vomAr87Xln</a></p>\n"}, {"tags": ["arrays", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "edited": false, "score": 0, "creation_date": 1506188386, "post_id": 46374264, "comment_id": 79723169, "body": "This looks like exactly what I need.  What are the constructs here? How would I search for this again if I wanted to relearn it. Sometimes the hardest thing is to Google what I&#39;m looking for."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 0, "last_activity_date": 1506121246, "creation_date": 1506121246, "answer_id": 46374264, "question_id": 46374203, "link": "https://stackoverflow.com/questions/46374203/creating-a-function-from-a-repetitive-range/46374264#46374264", "title": "Creating a function from a repetitive range", "body": "<p>It sounds like you want to do something like:</p>\n\n<pre><code>func EachHost(datacenter string, f func(Host)) {\n    for _, d := range datacenters {\n        if datacenter == d.Name || datacenter == \"\" {\n            for _, h := range d.Hosts {\n                // do something on each host in the range here\n                f(h)\n            }\n        }\n     }\n}\n</code></pre>\n\n<p>And then you can do something like:</p>\n\n<pre><code>listHostNames := func(datacenter string) {\n    EachHost(datacenter, func(h Host) {\n        fmt.Println(h.Name)\n    });\n}\nlistHostNames(\"dc1\")\n</code></pre>\n"}], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26, "favorite_count": 0, "accepted_answer_id": 46374264, "answer_count": 1, "score": 0, "last_activity_date": 1506121246, "creation_date": 1506120594, "question_id": 46374203, "link": "https://stackoverflow.com/questions/46374203/creating-a-function-from-a-repetitive-range", "title": "Creating a function from a repetitive range", "body": "<p>I have a some structs like so:</p>\n\n<pre><code>type Datacenter struct {\n  Name  string\n  Key   string\n  Hosts []Host\n}\n\ntype Host struct {\n  Name string\n  Port int\n}\n</code></pre>\n\n<p>When these structs are populated, they look like this:</p>\n\n<pre><code>[]config.Datacenter (len=2) {\n  Datacenter {\n    Name: \"dc1\",\n    Key: \"string\",\n    Hosts: []config.Host (len=1) {\n      Host {\n        Name: \"dc1-server-1\",\n        Port: 8200 (int)\n      }\n    }\n  },\n  Datacenter {\n    Name: \"dc2\",\n    Key: \"Another string\",\n    Hosts: []config.Host (len=2) {\n      Host {\n        Name: \"dc2-server-1\",\n        Port: 8200 (int)\n      },\n      Host {\n        Name: \"dc2-server-2\",\n        Port: 8200 (int)\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>I am creating a CLI tool, and for almost every command, I range over these structs in this manner:</p>\n\n<pre><code>for _, d := range datacenters {\n  if datacenter == d.Name || datacenter == \"\" {\n    for _, h := range d.Hosts {\n      // do something on each host in the range here\n    }\n  }\n}\n</code></pre>\n\n<p>Because I'm an awful, awful go developer, I know there is a better way to do this. The code is not very DRY at the moment, I am literally coping and pasting the range into each new subcommand, which looks awful and generally makes me feel stupid.</p>\n\n<p>I think I need to creation a function and do the ranging inside that, and then decide on the return values. I just can't figure out what it should be, the concepts aren't there. Any help will be greatly appreciated.</p>\n"}, {"tags": ["unit-testing", "go", "testify"], "comments": [{"owner": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "edited": false, "score": 0, "creation_date": 1506123463, "post_id": 46374174, "comment_id": 79708415, "body": "What package are you using which provides this <code>On</code> method? It seems that is the problem here, not Go itself."}, {"owner": {"reputation": 2336, "user_id": 2182674, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/ac50caa222fd72b83e0e9c20409c0fc0?s=128&d=identicon&r=PG&f=1", "display_name": "TechCrunch", "link": "https://stackoverflow.com/users/2182674/techcrunch"}, "reply_to_user": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "edited": false, "score": 1, "creation_date": 1506123994, "post_id": 46374174, "comment_id": 79708528, "body": "stretchr/testify"}, {"owner": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "edited": false, "score": 2, "creation_date": 1506124558, "post_id": 46374174, "comment_id": 79708639, "body": "It looks like the library just appends to an internal list, so when the method gets called it always matches the first return result which was registered. Have you considered using a new mock for each test run?"}, {"owner": {"reputation": 2336, "user_id": 2182674, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/ac50caa222fd72b83e0e9c20409c0fc0?s=128&d=identicon&r=PG&f=1", "display_name": "TechCrunch", "link": "https://stackoverflow.com/users/2182674/techcrunch"}, "reply_to_user": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "edited": false, "score": 0, "creation_date": 1506150374, "post_id": 46374174, "comment_id": 79712697, "body": "I considered that but din&#39;t try seriously because of the way <code>MockCSClient</code> is created in my test. But thats a good idea, will try that."}, {"owner": {"reputation": 183, "user_id": 2823667, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c26c4b4b161ec87ca5798301b2a306e0?s=128&d=identicon&r=PG&f=1", "display_name": "user2823667", "link": "https://stackoverflow.com/users/2823667/user2823667"}, "edited": false, "score": 2, "creation_date": 1554442310, "post_id": 46374174, "comment_id": 97761090, "body": "Hey Did you find any solution for this ?"}, {"owner": {"reputation": 304, "user_id": 1920432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecf52ab8b4891d2477fae50f7b487bcb?s=128&d=identicon&r=PG&f=1", "display_name": "Rajan Ponnappan", "link": "https://stackoverflow.com/users/1920432/rajan-ponnappan"}, "edited": false, "score": 0, "creation_date": 1585158665, "post_id": 46374174, "comment_id": 107667728, "body": "I ran into the same problem. If the function that is being tested can be broken down, then we can reset the mocks when testing different parts.."}, {"owner": {"reputation": 304, "user_id": 1920432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecf52ab8b4891d2477fae50f7b487bcb?s=128&d=identicon&r=PG&f=1", "display_name": "Rajan Ponnappan", "link": "https://stackoverflow.com/users/1920432/rajan-ponnappan"}, "edited": false, "score": 0, "creation_date": 1585158879, "post_id": 46374174, "comment_id": 107667819, "body": "Looks like on recent version, you can call On() multiple times and stretchr seems to be using the setup"}, {"owner": {"reputation": 3906, "user_id": 624395, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/202bfd99f4900ed88a72e4c1721dbe95?s=128&d=identicon&r=PG", "display_name": "Marco", "link": "https://stackoverflow.com/users/624395/marco"}, "edited": false, "score": 0, "creation_date": 1586355458, "post_id": 46374174, "comment_id": 108098468, "body": "Would it be possible to make an extract of this in <a href=\"https://play.golang.org\" rel=\"nofollow noreferrer\">play.golang.org</a>. It is very hard to judge without being able to reproduce.  I do see some strange things like the line in the for loop where you are doing <code>test := test</code>. In for loops you have to keep in mind pointers, which is a common pitfall.  This article might highlight the problem you are facing <a href=\"https://medium.com/@pedram.esmaeeli/golang-pitfalls-f2ebae9c8208\" rel=\"nofollow noreferrer\">medium.com/@pedram.esmaeeli/golang-pitfalls-f2ebae9c8208</a>"}], "answers": [{"tags": [], "owner": {"reputation": 662, "user_id": 2271198, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yQvbG.jpg?s=128&g=1", "display_name": "Marcos", "link": "https://stackoverflow.com/users/2271198/marcos"}, "is_accepted": false, "score": 14, "last_activity_date": 1600783340, "last_edit_date": 1600783340, "creation_date": 1586618738, "answer_id": 61159213, "question_id": 46374174, "link": "https://stackoverflow.com/questions/46374174/how-to-mock-for-same-input-and-different-return-values-in-a-for-loop-in-golang/61159213#61159213", "title": "How to mock for same input and different return values in a for loop in golang", "body": "<p>I had a similar problem.</p>\n<p>The solution was the method <code>Once()</code></p>\n<p>In your mock add an <code>.Once()</code> and repeat the mock with each result you need.</p>\n<p>Something like this:</p>\n<pre><code>lib.Mock.On(&quot;method&quot;, arg).Return(test.mockError).Once()\nlib.Mock.On(&quot;method&quot;, arg).Return(nil).Once()\n</code></pre>\n<p>Each mock result will be returned only once.</p>\n<p><a href=\"https://godoc.org/github.com/stretchr/testify/mock#Call.Once\" rel=\"noreferrer\">https://godoc.org/github.com/stretchr/testify/mock#Call.Once</a></p>\n"}], "owner": {"reputation": 2336, "user_id": 2182674, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/ac50caa222fd72b83e0e9c20409c0fc0?s=128&d=identicon&r=PG&f=1", "display_name": "TechCrunch", "link": "https://stackoverflow.com/users/2182674/techcrunch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5673, "favorite_count": 1, "answer_count": 1, "score": 14, "last_activity_date": 1600783340, "creation_date": 1506120228, "last_edit_date": 1506124061, "question_id": 46374174, "link": "https://stackoverflow.com/questions/46374174/how-to-mock-for-same-input-and-different-return-values-in-a-for-loop-in-golang", "title": "How to mock for same input and different return values in a for loop in golang", "body": "<p>I'm running a test with multiple parameters in a for loop using go lang testing. </p>\n\n<p>I ran into a situation where same return value (and first set) is returned every time the mock is called. What I want to be able to do is change the return value for each test when the input is same i.e., same <code>On</code> but different <code>Return</code> in a loop. </p>\n\n<p>I am using stretchr/testify for mocks. It looks like it will not overwrite already created mock when <code>On</code> is same.</p>\n\n<pre><code>func TestUpdateContactWithNewActions(t *testing.T) {\n    tests := []struct {\n        testName  string\n        getParams func() *activities.UpdateContactWithNewActionsActivity\n        mockError error\n    }{\n\n        {\"UpdateContactWithNewActions with error from contact service\",\n            func() *activities.UpdateContactWithNewActionsActivity {\n                return fixtures.GetUpdateContactWithNewActionsActivity()\n            }, fixtures.Err},\n        {\"UpdateContactWithNewActions valid\",\n            func() *activities.UpdateContactWithNewActionsActivity {\n                return fixtures.GetUpdateContactWithNewActionsActivity()\n            }, nil},\n    }\n\n    lib.LoadWithMockClients()\n\n    for _, test := range tests {\n        test := test\n        t.Run(test.testName, func(t *testing.T) {\n            lib.MockCSClient.On(\n                \"UpdateContactWithNewActions\",\n                mock.AnythingOfType(\"tchannel.headerCtx\"),\n                fixtures.UpdateContactWithNewActions).Return(test.mockError)\n\n            returnedResult, err := test.getParams().Execute(fixtures.Ctx)\n            if test.mockError == nil {\n                // some assertion\n            }\n            assert.Error(t, err)\n        })\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4797, "user_id": 1970832, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/74a51ccbe8e8fa185b782c6d64ee65e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul Sharma", "link": "https://stackoverflow.com/users/1970832/rahul-sharma"}, "edited": false, "score": 2, "creation_date": 1506116947, "post_id": 46372728, "comment_id": 79706880, "body": "I missed completely about the archival part. Many thanks it worked."}, {"owner": {"reputation": 115, "user_id": 4515109, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c4552b9c40bf0fe4e93e14fee717395e?s=128&d=identicon&r=PG&f=1", "display_name": "Piu", "link": "https://stackoverflow.com/users/4515109/piu"}, "edited": false, "score": 0, "creation_date": 1527814911, "post_id": 46372728, "comment_id": 88279629, "body": "I can not change PATH and GOROOT without admin rights."}, {"owner": {"reputation": 325, "user_id": 7513482, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/999d62fece582a09bb6f4f7e249dd4d0?s=128&d=identicon&r=PG&f=1", "display_name": "big.nerd", "link": "https://stackoverflow.com/users/7513482/big-nerd"}, "reply_to_user": {"reputation": 115, "user_id": 4515109, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c4552b9c40bf0fe4e93e14fee717395e?s=128&d=identicon&r=PG&f=1", "display_name": "Piu", "link": "https://stackoverflow.com/users/4515109/piu"}, "edited": false, "score": 0, "creation_date": 1529593448, "post_id": 46372728, "comment_id": 88940042, "body": "@Piu - If your group policies are blocking you from setting user level environment variables you can create a batch file or ps1 file to temporarily (for the session) set goroot."}, {"owner": {"reputation": 325, "user_id": 7513482, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/999d62fece582a09bb6f4f7e249dd4d0?s=128&d=identicon&r=PG&f=1", "display_name": "big.nerd", "link": "https://stackoverflow.com/users/7513482/big-nerd"}, "reply_to_user": {"reputation": 115, "user_id": 4515109, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/c4552b9c40bf0fe4e93e14fee717395e?s=128&d=identicon&r=PG&f=1", "display_name": "Piu", "link": "https://stackoverflow.com/users/4515109/piu"}, "edited": false, "score": 0, "creation_date": 1529593852, "post_id": 46372728, "comment_id": 88940262, "body": "@Piu Sorry just realized - you can also setup your powershell profile and set the two env var&#39;s needed. This doesn&#39;t help CMD but it will definitely work."}, {"owner": {"reputation": 1759, "user_id": 4417818, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/100000126145913/picture?type=large", "display_name": "Nilesh", "link": "https://stackoverflow.com/users/4417818/nilesh"}, "edited": false, "score": 0, "creation_date": 1589958679, "post_id": 46372728, "comment_id": 109495447, "body": "For those who couldnt modify environment variables from non-admin accounts - <a href=\"https://support.microsoft.com/en-in/help/931715/you-cannot-modify-user-environment-variables-in-the-system-properties\" rel=\"nofollow noreferrer\">support.microsoft.com/en-in/help/931715/&hellip;</a>"}], "tags": [], "owner": {"reputation": 2843, "user_id": 165713, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/98d4242c872913f1d9c6e3fc37c529d9?s=128&d=identicon&r=PG", "display_name": "Chris Long", "link": "https://stackoverflow.com/users/165713/chris-long"}, "is_accepted": true, "score": 14, "last_activity_date": 1506112514, "last_edit_date": 1506112514, "creation_date": 1506112005, "answer_id": 46372728, "question_id": 46372684, "link": "https://stackoverflow.com/questions/46372684/how-to-install-go-language-on-windows-without-admin-rights/46372728#46372728", "title": "how to install Go language on windows without admin rights?", "body": "<p>Can you download the <a href=\"https://golang.org/doc/install#windows\" rel=\"noreferrer\">Windows ZIP archive</a> and extract it to somewhere in your User folder?</p>\n\n<p>You would then need to update the <code>GOROOT</code> and <code>PATH</code> environment variables accordingly.</p>\n"}], "owner": {"reputation": 4797, "user_id": 1970832, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/74a51ccbe8e8fa185b782c6d64ee65e9?s=128&d=identicon&r=PG&f=1", "display_name": "Rahul Sharma", "link": "https://stackoverflow.com/users/1970832/rahul-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4611, "favorite_count": 1, "accepted_answer_id": 46372728, "answer_count": 1, "score": 10, "last_activity_date": 1513169310, "creation_date": 1506111815, "question_id": 46372684, "link": "https://stackoverflow.com/questions/46372684/how-to-install-go-language-on-windows-without-admin-rights", "title": "how to install Go language on windows without admin rights?", "body": "<p>I don't have admin rights on my windows machine and I am trying to install Go which needs admin rights complete the installation. </p>\n\n<p>is there any way to install GO on windows without admin rights?</p>\n"}, {"tags": ["go", "runtime-error"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1506112241, "post_id": 46372662, "comment_id": 79705076, "body": "if <code>err</code> is nil, then <code>err.Error</code> is a <code>nil pointer dereference</code>. It&#39;s possible that <code>err.Error()</code> dereferences a nil pointer somewhere else, but we can&#39;t tell without the stack trace or context around where you&#39;re calling it."}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1506112452, "post_id": 46372662, "comment_id": 79705180, "body": "did you maybe do <code>if err == nil { return errors.New(&quot;Some text for debugging: &quot; + err.Error()) }</code> instead of <code>if err != nil</code>?"}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506112779, "post_id": 46372662, "comment_id": 79705363, "body": "@JimB - My first impulse was thinking err was nil, but the return was in an &quot;if err != nil&quot; block."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1506112886, "post_id": 46372662, "comment_id": 79705414, "body": "@dave - I triple checked...all the if err&#39;s are != checks. That&#39;s part of why this was so strange to me!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506112958, "post_id": 46372662, "comment_id": 79705455, "body": "@BartSilverstrim: then you may have either introduced a dynamic type in the interface (see <a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">golang.org/doc/faq#nil_error</a>), or the error value itself has a nil pointer that is hit during <code>Error()</code>. Either way we need a full example and the actual output you see."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506113622, "post_id": 46372662, "comment_id": 79705754, "body": "@JimB I tried adding a snippet of what triggered the panic. The trace just points to the return line and the calling line number for that function."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1506113931, "post_id": 46372662, "comment_id": 79705868, "body": "@BartSilverstrim: you&#39;re not showing how <code>err</code> is declared and used up to that point. I&#39;m guessing it has had a typed <code>nil</code> assigned to it at some point. Use <code>fmt.Errof</code> or stick a <code>fmt.Printf</code> in there and see what the actual value of <code>err</code> is. (BTW, there is a <code>time.Sleep</code> function)"}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 0, "creation_date": 1506116813, "post_id": 46372662, "comment_id": 79706825, "body": "I agree with JimB. There are only two possibilities. err is not type of Error interface (check err.(*ErrorType)) or err value changes somewhere outside before return is reached.."}, {"owner": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "edited": false, "score": 0, "creation_date": 1506124037, "post_id": 46372662, "comment_id": 79708540, "body": "Can you post the stack trace?"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1506160090, "post_id": 46372662, "comment_id": 79714968, "body": "Just for the record you can call methods on <code>nil</code> pointers in Go (in general) and it does not necessarily panics (or give an error)."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "edited": false, "score": 0, "creation_date": 1506352172, "post_id": 46372662, "comment_id": 79774641, "body": "@lmars Added a crash trace."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1506119939, "creation_date": 1506119939, "answer_id": 46374133, "question_id": 46372662, "link": "https://stackoverflow.com/questions/46372662/is-there-something-in-an-error-that-could-trigger-an-invalid-memory-address-or/46374133#46374133", "title": "Is there something in an error that could trigger an &quot;invalid memory address or nil pointer dereference&quot;?", "body": "<p>Here's an example,</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n)\n\nfunc f() error {\n    err := error(nil)\n    return errors.New(\"Could not parse integer: \" + err.Error())\n}\n\nfunc main() {\n    f()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x44ecd6]\n\ngoroutine 1 [running]:\nmain.f(0xc420022070, 0xc420022070)\n    /home/peter/gopath/src/so/error.go:9 +0x26\nmain.main()\n    /home/peter/gopath/src/so/error.go:13 +0x22\nexit status 2\n</code></pre>\n\n<p>See <a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a>.</p>\n"}], "owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1506351242, "creation_date": 1506111684, "last_edit_date": 1506351242, "question_id": 46372662, "link": "https://stackoverflow.com/questions/46372662/is-there-something-in-an-error-that-could-trigger-an-invalid-memory-address-or", "title": "Is there something in an error that could trigger an &quot;invalid memory address or nil pointer dereference&quot;?", "body": "<p>I had an application where I was occasionally crashing with a:</p>\n\n<p>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x122e64a]</p>\n\n<p>The trace kept leading to a return statement that returned a struct and errors.New(\"Some text for debugging: \" + err.Error())</p>\n\n<p>The struct didn't seem to have anything that would be dereferencing a pointer, but I restructured the function so it used a pass by reference and didn't need to return the function; it only returned the errors.New(). The panic still happened.</p>\n\n<p>I went through the function and changed it so it returned just the err, no errors.New() string plus err.Error(). Now I can't seem to induce the panic anymore...</p>\n\n<p>So the question: is there something about errors.New() using the err.Error() concatenated to a string that would cause that type of panic in a return statement? </p>\n\n<p>EDIT: Adding a snippet of code that triggered the occasional panic:</p>\n\n<pre><code>strctStats.intThreadPool80ConnectionCount, err = strconv.ParseInt(strctStats.strThreadPool80ConnectionCount, 10, 64)\nif err != nil {\n    // Exit external application; send the closing sequences\n    tmPause := time.NewTimer(time.Second * 2)\n    &lt;-tmPause.C\n    stdIn.Write([]byte(\"close\\n\"))\n    tmPause = time.NewTimer(time.Second * 2)\n    &lt;-tmPause.C\n    stdIn.Write([]byte(\"quit\\n\"))\n    return errors.New(\"Could not parse integer: \" + err.Error())\n}\n</code></pre>\n\n<p>EDIT 2: @lmars requested a stack trace. This is what is dumped to the console. Not sure how it helps (could you explain what it tells beyond the function stack and line numbers where the error/calls originated? I'm new to working on some of these traces)</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x122e64a]\n\ngoroutine 1 [running]:\nmain.JMXCheck(0xc42012c000, 0x1a, 0xc420018084, 0x2e, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\n\n/Users/bsilver/go/src/nagios_tomcat_threadinfo/nagios_tomcat_threadinfo.go:590 +0x38ca\nmain.main()\n/Users/bsilver/go/src/nagios_tomcat_threadinfo/nagios_tomcat_threadinfo.go:146 +0x3cc\n</code></pre>\n"}, {"tags": ["html", "css", "go"], "comments": [{"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "edited": false, "score": 0, "creation_date": 1506110176, "post_id": 46372107, "comment_id": 79704086, "body": "&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/bootstrap.min.css&quot;&gt; otherwise you &quot;attach&quot; the url in href to the active url"}, {"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "edited": false, "score": 0, "creation_date": 1506110299, "post_id": 46372107, "comment_id": 79704142, "body": "even tho you are new and wann to learn, i get that. Still may have a look at the echo http server. It will save you a lot of coding if you really want to make a website. :)"}, {"owner": {"reputation": 23, "user_id": 8657810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f16c95e40421186ceab50b11384a80d?s=128&d=identicon&r=PG&f=1", "display_name": "rav_dwag", "link": "https://stackoverflow.com/users/8657810/rav-dwag"}, "reply_to_user": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "edited": false, "score": 0, "creation_date": 1506118005, "post_id": 46372107, "comment_id": 79707162, "body": "Thanks that worked!! Ill try to understand echo in order to use it"}], "answers": [{"tags": [], "owner": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "is_accepted": true, "score": 0, "last_activity_date": 1506125268, "creation_date": 1506125268, "answer_id": 46374750, "question_id": 46372107, "link": "https://stackoverflow.com/questions/46372107/go-is-not-rendering-css-elements-for-all-html-pages/46374750#46374750", "title": "Go is not rendering CSS elements for all HTML pages", "body": "<p>You need to use absolute paths in the <code>href</code> attribute (i.e. use a path which starts with a <code>/</code>), otherwise the path is treated as relative to the current page leading to the behaviour you are seeing.</p>\n\n<p>So for example:</p>\n\n<pre><code>&lt;link rel=\"stylesheet\" href=\"/css/bootstrap.min.css\"&gt;\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8657810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f16c95e40421186ceab50b11384a80d?s=128&d=identicon&r=PG&f=1", "display_name": "rav_dwag", "link": "https://stackoverflow.com/users/8657810/rav-dwag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 46374750, "answer_count": 1, "score": 2, "last_activity_date": 1506125268, "creation_date": 1506109180, "question_id": 46372107, "link": "https://stackoverflow.com/questions/46372107/go-is-not-rendering-css-elements-for-all-html-pages", "title": "Go is not rendering CSS elements for all HTML pages", "body": "<p>I am a novice at go programming. I followed this (<a href=\"https://golang.org/doc/articles/wiki/\" rel=\"nofollow noreferrer\">https://golang.org/doc/articles/wiki/</a>) tutorial. I wanted to build on top of this a site with multiple pages and CSS elements. </p>\n\n<p>In the main method I used</p>\n\n<pre><code>http.Handle(\"/css/\", http.StripPrefix(\"/css/\", http.FileServer(http.Dir(\"css\")))) \n</code></pre>\n\n<p>This is my makeHandler function. It is supposed to direct all requests to the correct handler. </p>\n\n<pre><code>func makeHandler( fn func( http.ResponseWriter, *http.Request, string)) http.HandlerFunc{\n    return func( w http.ResponseWriter, r *http.Request ){\n            //extract page title from request\n            //and call the provided handler 'fn'\n            m := validPath.FindStringSubmatch(r.URL.Path)\n            fmt.Println(m)\n            if m == nil{\n                    http.NotFound(w,r)\n                    return\n            }\n            fn(w,r,m[2])\n    }\n</code></pre>\n\n<p>}</p>\n\n<p>When I printed 'm', all the requests were prefixed by view (I have a viewHandler that is then called to render the templates).</p>\n\n<pre><code>        http.HandleFunc(\"/view/\", makeHandler(viewHandler))\n</code></pre>\n\n<p>So if I wanted to view an aboutSite page, the url would have /view/aboutSite which would then be directed to viewHandler. </p>\n\n<p>The issue is that the html templates have CSS links and the links are being prefixed by 'view' as well. So if I had this line of code in my html template</p>\n\n<pre><code>&lt;link rel=\"stylesheet\" href=\"css/bootstrap.min.css\"&gt;\n</code></pre>\n\n<p>makeHandler would receive a 'view' prefixed url. /view/css/bootstrap.min.css</p>\n\n<p>what do I need to add/change so that the CSS elements are rendered?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 144, "user_id": 8075949, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeTbN.png?s=128&g=1", "display_name": "nk2ge5k", "link": "https://stackoverflow.com/users/8075949/nk2ge5k"}, "edited": false, "score": 4, "creation_date": 1506103320, "post_id": 46370601, "comment_id": 79700834, "body": "It is probably spaces between tag name and tag value, try like this: <code>json:&quot;name&quot;</code>"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 2, "creation_date": 1506103391, "post_id": 46370601, "comment_id": 79700873, "body": "btw <code>go vet</code> catches this error; probably a good idea to run <code>go vet</code> on save in your editor."}, {"owner": {"reputation": 28387, "user_id": 55093, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/c2f43d6b1d79c82a463ec53effbec873?s=128&d=identicon&r=PG", "display_name": "Amokrane Chentir", "link": "https://stackoverflow.com/users/55093/amokrane-chentir"}, "edited": false, "score": 1, "creation_date": 1506114815, "post_id": 46370601, "comment_id": 79706170, "body": "Thanks, that was it indeed. Great tip regarding go vet."}], "answers": [{"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 3, "last_activity_date": 1506103398, "creation_date": 1506103398, "answer_id": 46370738, "question_id": 46370601, "link": "https://stackoverflow.com/questions/46370601/json-field-tag-issue-not-taken-into-account-during-encoding/46370738#46370738", "title": "JSON field tag issue not taken into account during encoding", "body": "<p>Your struct tags aren't proper so the parser isn't working as expected </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype Version struct {\n    Name      string `json:\"name\"`\n    Project   string `json:\"project\"`\n    ProjectId int    `json:\"project_id\"`\n}\n\nfunc main() {\n    b := new(bytes.Buffer)\n    if err := json.NewEncoder(b).Encode(&amp;Version{\"foo\", \"bar\", 42}); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"JSON %v\", b)\n}\n</code></pre>\n\n<p>works as expected</p>\n"}], "owner": {"reputation": 28387, "user_id": 55093, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/c2f43d6b1d79c82a463ec53effbec873?s=128&d=identicon&r=PG", "display_name": "Amokrane Chentir", "link": "https://stackoverflow.com/users/55093/amokrane-chentir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 46370738, "answer_count": 1, "score": 0, "last_activity_date": 1506103398, "creation_date": 1506102887, "question_id": 46370601, "link": "https://stackoverflow.com/questions/46370601/json-field-tag-issue-not-taken-into-account-during-encoding", "title": "JSON field tag issue not taken into account during encoding", "body": "<p>I have the following Go code</p>\n\n<pre><code>    type Version struct {\n        Name string `json: \"name\"`\n        Project   string `json: \"project\"`\n        ProjectId int    `json: \"projectId\"`\n    }\n\n    b := new(bytes.Buffer)\n    if err := json.NewEncoder(b).Encode(&amp;Version{\"foo\", \"bar\", 42}); err != nil {\n        log.Fatal(err)\n        return false\n    }\n\n    fmt.Printf(\"JSON %v\", b)\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>{\"Name\":\"foo\",\"Project\":\"bar\",\"ProjectId\": 42}\n</code></pre>\n\n<p>instead of:</p>\n\n<pre><code>{\"name\":\"foo\",\"project\":\"bar\",\"projectId\": 42}\n</code></pre>\n\n<p>Any thoughts why?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 875, "user_id": 1559116, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/60142865cf37f406416ac3c25586318f?s=128&d=identicon&r=PG", "display_name": "Alex Aung", "link": "https://stackoverflow.com/users/1559116/alex-aung"}, "edited": false, "score": 0, "creation_date": 1506152754, "post_id": 46369946, "comment_id": 79713229, "body": "Thanks Dave. I don&#39;t know that MST is GMT-0700. It is working now."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 1, "last_activity_date": 1506100900, "last_edit_date": 1592644375, "creation_date": 1506100403, "answer_id": 46369946, "question_id": 46369920, "link": "https://stackoverflow.com/questions/46369920/convert-string-date-to-time-time-in-golang/46369946#46369946", "title": "Convert string date to time.Time in golang", "body": "<blockquote>\n<p>These are predefined layouts for use in Time.Format and Time.Parse. The reference time used in the layouts is the specific time:</p>\n<p>Mon Jan 2 15:04:05 MST 2006</p>\n<p>which is Unix time 1136239445. Since MST is GMT-0700, the reference time can be thought of as</p>\n<p>01/02 03:04:05PM '06 -0700</p>\n</blockquote>\n<p>So you need to put the date <code>Mon Jan 2 15:04:05 MST 2006</code> into the format that you are expecting, which seems like it would be:</p>\n<pre><code>layout := &quot;Mon Jan 02 2006 15:04:05 GMT-0700&quot;\n</code></pre>\n<p><a href=\"https://play.golang.org/p/I9dRT5JdOA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/I9dRT5JdOA</a></p>\n"}], "owner": {"reputation": 875, "user_id": 1559116, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/60142865cf37f406416ac3c25586318f?s=128&d=identicon&r=PG", "display_name": "Alex Aung", "link": "https://stackoverflow.com/users/1559116/alex-aung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12838, "favorite_count": 0, "closed_date": 1506110139, "accepted_answer_id": 46369946, "answer_count": 1, "score": 0, "last_activity_date": 1506104863, "creation_date": 1506100303, "last_edit_date": 1506104863, "question_id": 46369920, "link": "https://stackoverflow.com/questions/46369920/convert-string-date-to-time-time-in-golang", "closed_reason": "Duplicate", "title": "Convert string date to time.Time in golang", "body": "<p>How to convert string, \"Fri Sep 22 2017 15:38:22 GMT+0630\" in go.</p>\n\n<pre><code>layout := \"Fri Sep 22 2017 15:38:22 GMT+0630\"\n    str := \"Fri Sep 23 2017 15:38:22 GMT+0630\"\n    t, err := time.Parse(layout, str)\n    if err != nil {\n        WriteError(w, err)\n        return\n    }\n</code></pre>\n\n<p>Thanks,\nAlex</p>\n"}, {"tags": ["go", "smtp", "sendmail"], "answers": [{"comments": [{"owner": {"reputation": 781, "user_id": 826104, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/17c3ef4ae53fb0bdd31e12c9f9cfee63?s=128&d=identicon&r=PG", "display_name": "lamp ard", "link": "https://stackoverflow.com/users/826104/lamp-ard"}, "edited": false, "score": 1, "creation_date": 1506102862, "post_id": 46369988, "comment_id": 79700606, "body": "That did it, thank you! I did not notice the collapsed examples."}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": true, "score": 4, "last_activity_date": 1506100926, "last_edit_date": 1506100926, "creation_date": 1506100572, "answer_id": 46369988, "question_id": 46369598, "link": "https://stackoverflow.com/questions/46369598/how-to-define-senders-name-in-golang-net-smtp-sendmail/46369988#46369988", "title": "How to define sender&#39;s name in golang net/smtp.sendmail?", "body": "<p>You could add it to the <code>msg</code> for example, extending the example from the <a href=\"https://golang.org/pkg/net/smtp/#SendMail\" rel=\"nofollow noreferrer\">official docs</a> you could use:</p>\n\n<pre><code>msg := []byte(\"From: the name &lt;sender@example.org&gt;\\r\\n\" +\n        \"To: recipient@example.net\\r\\n\" +\n        \"Subject: discount Gophers!\\r\\n\" +\n        \"\\r\\n\" +\n        \"This is the email body.\\r\\n\")\n</code></pre>\n\n<p>Notice the: <code>From: the name &lt;sender@example.org&gt;</code></p>\n\n<blockquote>\n  <p>The msg parameter should be an RFC 822-style email with headers first, a blank line, and then the message body. The lines of msg should be CRLF terminated. The msg headers should usually include fields such as \"From\", \"To\", \"Subject\", and \"Cc\".</p>\n</blockquote>\n"}], "owner": {"reputation": 781, "user_id": 826104, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/17c3ef4ae53fb0bdd31e12c9f9cfee63?s=128&d=identicon&r=PG", "display_name": "lamp ard", "link": "https://stackoverflow.com/users/826104/lamp-ard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1114, "favorite_count": 1, "accepted_answer_id": 46369988, "answer_count": 1, "score": 2, "last_activity_date": 1506100926, "creation_date": 1506098902, "question_id": 46369598, "link": "https://stackoverflow.com/questions/46369598/how-to-define-senders-name-in-golang-net-smtp-sendmail", "title": "How to define sender&#39;s name in golang net/smtp.sendmail?", "body": "<p>My question is short, I have a golang application from which I am trying to send an email using net/smtp.sendmail:</p>\n\n<p>This is the command which I am going to use</p>\n\n<pre><code>smtp.SendMail(server, auth, **from**, to, msg)\n</code></pre>\n\n<p>No usually people pass the sender's email address to <strong>from</strong>. Is there anyway I can pass a sender's name as well?</p>\n\n<p>So the recipient will get an email from:</p>\n\n<pre><code>Foo Bar &lt;foo@bar.com&gt;\n</code></pre>\n\n<p>instead of an email from</p>\n\n<pre><code>&lt;foo@bar.com&gt;\n</code></pre>\n\n<p>I checked the official documentation and dozens of examples online but could not find anything.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 8656817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a6f69f41efc9a79f2cfb5e353627a5?s=128&d=identicon&r=PG&f=1", "display_name": "Silent Error", "link": "https://stackoverflow.com/users/8656817/silent-error"}, "edited": false, "score": 0, "creation_date": 1506114867, "post_id": 46369061, "comment_id": 79706188, "body": "Thanks for the links.  Those are helpful.  I ended up having to range over the map and assign the keys to the hostnames and the values to &lt;nil&gt;.      hosts := []string{strings.TrimSuffix(hostlist, &quot;,&quot;)}     hosts = strings.split(hosts[0], &quot;,&quot;)     hashResults := make(map[string]interface{})     for _, host := range hosts {     hashResults[host] = nil     }"}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 2, "last_activity_date": 1506097195, "last_edit_date": 1506097195, "creation_date": 1506096892, "answer_id": 46369061, "question_id": 46368991, "link": "https://stackoverflow.com/questions/46368991/formatting-a-map-in-golang/46369061#46369061", "title": "Formatting a map[] in golang", "body": "<p>Loop over your slice of strings. Set each map entry to nil. </p>\n\n<p>There is no fancy syntax like Python's list comprehensions or Perl's freaky group assignments.</p>\n\n<p>And remember that StackOverflow's tag info is often really useful. See: <a href=\"https://stackoverflow.com/tags/go/info\">https://stackoverflow.com/tags/go/info</a></p>\n\n<p>And from there to the language specification. One bit that will help is <a href=\"https://golang.org/ref/spec#For_range\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#For_range</a> if you aren't familiar with Go's <code>for</code> syntax to loop over slices.</p>\n"}], "owner": {"reputation": 47, "user_id": 8656817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a6f69f41efc9a79f2cfb5e353627a5?s=128&d=identicon&r=PG&f=1", "display_name": "Silent Error", "link": "https://stackoverflow.com/users/8656817/silent-error"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1506109035, "creation_date": 1506096676, "last_edit_date": 1592644375, "question_id": 46368991, "link": "https://stackoverflow.com/questions/46368991/formatting-a-map-in-golang", "title": "Formatting a map[] in golang", "body": "<p>I have a list of hosts inbound in the form of one string separated by commas.</p>\n<h3>EXAMPLE: &quot;host01,host02,host03,&quot;</h3>\n<p>I have this line that was an array of strings but I need it to be a <code>map[string]interface{}</code></p>\n<p>Here is what it is how do I make it a <code>map[string]interface{}</code>?</p>\n<p>\u2022 Removing the trailing or any trailing comma.</p>\n<p><code>hosts := []string{strings.TrimSuffix(hostlist, &quot;,&quot;)}</code></p>\n<p>\u2022 Later I split them on the comma like this.</p>\n<p><code>hosts = strings.split(hosts[0], &quot;,&quot;)</code></p>\n<p>I just need to make it so names are keys and the values are unknown from APIs so an <code>interface{}</code>.</p>\n<p>Thanks and forgive me I know this is super simple I am just not seeing it.</p>\n"}, {"tags": ["go", "tensorflow"], "comments": [{"owner": {"reputation": 1158, "user_id": 6117625, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cff13813080b5f227531191b1dc96b60?s=128&d=identicon&r=PG&f=1", "display_name": "Dean coakley", "link": "https://stackoverflow.com/users/6117625/dean-coakley"}, "edited": false, "score": 0, "creation_date": 1506097173, "post_id": 46368514, "comment_id": 79697779, "body": "I&#39;m not too experienced in this field but I believe <code>matmul</code> requires a 2D tensor instead of a vector."}], "answers": [{"comments": [{"owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1506356736, "post_id": 46369094, "comment_id": 79777469, "body": "Thank you for your response. That does solve my problem. However I am still not able to make the predictions on the saved model. I have two dictionaries <code>weights</code> and <code>biases</code> defined in my program while training my model. Do I need to define it while making the predictions using the GO API as well? Or can I fetch it from my saved model?"}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "reply_to_user": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1506358478, "post_id": 46369094, "comment_id": 79778353, "body": "You only have to know the complete name of the nodes you defined in the 2 dictionaries (you can get them printing every item in the dictionary) if you want to fetch the values of the weights and the biases. Also, you don&#39;t need this if you only want to do predictions. Your code should work. But this is another question and deserve another thread. You can mark this answer as accepted since it solved your problem and open a new thread with the new one."}, {"owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "edited": false, "score": 0, "creation_date": 1506361082, "post_id": 46369094, "comment_id": 79779667, "body": "Sure would do that. Thanks!!"}], "tags": [], "owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "is_accepted": true, "score": 0, "last_activity_date": 1506096990, "creation_date": 1506096990, "answer_id": 46369094, "question_id": 46368514, "link": "https://stackoverflow.com/questions/46368514/unable-to-make-predictions-using-tensorflow-go-api/46369094#46369094", "title": "Unable to make predictions using TensorFlow Go API", "body": "<p>The error is clear: <code>In[0] is not a matrix</code>.</p>\n\n<p>Your <code>In[0]</code> is: <code>df := []float32{9.5,0.0,7.5,0.0,0.0,2.0,0.0,0.0,0.0,0.0,1505292248.0}</code></p>\n\n<p>This is a 1-dimensional tensor, not a matrix.</p>\n\n<p>The <code>matmul</code> node requires both its arguments to be matrices, thus 2-dimensional tensors.</p>\n\n<p>Therefore, you have to change your <code>df</code> definition in order to define a 2-D tensor, like that:</p>\n\n<pre><code>df := [][]float32{{9.5},{0.0},{7.5},{0.0},{0.0},{2.0},{0.0},{0.0},{0.0},{0.0},{1505292248.0}}\n</code></pre>\n\n<p>A good reference on how to think/debug tensorflow + go code is: <a href=\"https://pgaleone.eu/tensorflow/go/2017/05/29/understanding-tensorflow-using-go/\" rel=\"nofollow noreferrer\">https://pgaleone.eu/tensorflow/go/2017/05/29/understanding-tensorflow-using-go/</a></p>\n"}], "owner": {"reputation": 783, "user_id": 6865456, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a11db9c620a28f26e5593a3fab778fd5?s=128&d=identicon&r=PG", "display_name": "Vasanti", "link": "https://stackoverflow.com/users/6865456/vasanti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 1, "accepted_answer_id": 46369094, "answer_count": 1, "score": 2, "last_activity_date": 1506355727, "creation_date": 1506095079, "last_edit_date": 1506355727, "question_id": 46368514, "link": "https://stackoverflow.com/questions/46368514/unable-to-make-predictions-using-tensorflow-go-api", "title": "Unable to make predictions using TensorFlow Go API", "body": "<p>I have a MLP coded using Tensorflow Python API. The following is the code snippet:</p>\n\n<pre><code># tf Graph input\nx = tf.placeholder(\"float\", [None, 11],name=\"x\")\ny = tf.placeholder(\"float\", [None])\n\n# Store layers weight &amp; bias\nweights = {\n    'h1': tf.Variable(tf.random_normal([11, 32], 0, 0.1)),\n    'h2': tf.Variable(tf.random_normal([32, 200], 0, 0.1)),\n    'out': tf.Variable(tf.random_normal([200, 1], 0, 0.1))\n}\n\nbiases = {\n    'b1': tf.Variable(tf.random_normal([32], 0, 0.1)),\n    'b2': tf.Variable(tf.random_normal([200], 0, 0.1)),\n    'out': tf.Variable(tf.random_normal([1], 0, 0.1))\n}\n\n# Create model\ndef multilayer_perceptron(x, weights, biases):\n    # Hidden layer with RELU activation\n    layer_1 = tf.add(tf.matmul(x, weights['h1']), biases['b1'])\n    layer_1 = tf.nn.relu(layer_1)\n\n    # Hidden layer with RELU activation\n    layer_2 = tf.add(tf.matmul(layer_1, weights['h2']), biases['b2'])\n    layer_2 = tf.nn.relu(layer_2)\n\n    # Output layer with linear activation\n    out_layer = tf.matmul(layer_2, weights['out']) + biases['out']\n    return out_layer\n\n# Construct model\npred = multilayer_perceptron(x, weights, biases)\npred = tf.identity(pred, name=\"pred\")\n</code></pre>\n\n<p>The model has been trained and saved using the <code>saved_model_builder.SavedModelBuilder</code> method. The predictions using the Python API can be done using the following code:</p>\n\n<pre><code>with tf.Session() as sess:\n    sess.run(tf.global_variables_initializer())\n    tf.saved_model.loader.load(sess, [\"tag\"], \"/tmp/saved_models\")\n    my_pred= sess.graph.get_tensor_by_name('pred:0')\n    predictions = sess.run(my_pred, feed_dict={x: pred_data})\n    print(\"The prediction is\", predictions)\n</code></pre>\n\n<p>I am trying to make the same predictions using the Go API using the following code snippet:</p>\n\n<pre><code>df := []float32{9.5,0.0,7.5,0.0,0.0,2.0,0.0,0.0,0.0,0.0,1505292248.0}\n tensor, terr := tf.NewTensor(df) \n result, runErr := model.Session.Run(\n     map[tf.Output]*tf.Tensor{\n         model.Graph.Operation(\"x\").Output(0): tensor,\n     },\n     []tf.Output{\n         model.Graph.Operation(\"pred\").Output(0),\n     },\n     nil,\n   )\n</code></pre>\n\n<p>However, I encounter with the following error:</p>\n\n<pre><code>Error running the session with input, err: In[0] is not a matrix\n         [[Node: MatMul = MatMul[T=DT_FLOAT, _output_shapes=[[?,32]], transpose_a=false, transpose_b=false, _device=\"/job:localhost/replica:0/task:0/cpu:0\"](_arg_x_0_0, Variable/read)]]\n</code></pre>\n\n<p>Can someone point out the reason for this error?</p>\n"}, {"tags": ["go", "exec"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506103424, "post_id": 46367792, "comment_id": 79700893, "body": "This is how unix process work, you always need to <code>wait</code> on them. The <code>init</code>  process (PID 1) does this for you if they are left when the parent exits, but you should clean up your own processes."}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1506141520, "post_id": 46367792, "comment_id": 79711181, "body": "An alternative, from answer here: <a href=\"https://stackoverflow.com/questions/36050503/golang-child-processes-become-zombies\" title=\"golang child processes become zombies\">stackoverflow.com/questions/36050503/&hellip;</a>  it seems that if the parent process ignores SIGCHLD, then a child process will not become zombie if it exit? If this is correct, then I might just use FindProcess to see if the sub process is still there?"}], "answers": [{"comments": [{"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "edited": false, "score": 0, "creation_date": 1506141412, "post_id": 46368249, "comment_id": 79711161, "body": "This is exactly what I do <i>not</i> want. Because I cannot control the goroutine, and if it does not exit, I will have to use a for loop or something ? This makes the program structure clumsy..."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "edited": false, "score": 1, "creation_date": 1506332429, "post_id": 46368249, "comment_id": 79761386, "body": "Not sure what mean by &quot;I cannot control the goroutine&quot;. If the process does not exit, it simply blocks on Wait() forever. The check for whether it has exited or not is the select statement in the main goroutine."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 4, "last_activity_date": 1506094227, "creation_date": 1506094227, "answer_id": 46368249, "question_id": 46367792, "link": "https://stackoverflow.com/questions/46367792/detect-zombie-child-process/46368249#46368249", "title": "Detect zombie child process", "body": "<p>Judging from the docs the only way to get the process state is to call os.Process.Wait. So it seems you will have to call wait in a goroutine, and then you can easily check if that goroutine has exited yet:</p>\n\n<pre><code>var cmd exec.Cmd\n\ndone := make(chan error, 1)\ngo func() {\n    done &lt;- cmd.Wait()\n}()\n\nselect {\ncase err := &lt;-done:\n    // inspect err to check if service exited normally\ndefault:\n    // not done yet\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "edited": false, "score": 0, "creation_date": 1507799565, "post_id": 46700705, "comment_id": 80358091, "body": "Actually, the signal catching is NOT necessary. It&#39;s as simple as: go cmd.Wait() !"}], "tags": [], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "is_accepted": true, "score": 1, "last_activity_date": 1507777135, "creation_date": 1507777135, "answer_id": 46700705, "question_id": 46367792, "link": "https://stackoverflow.com/questions/46367792/detect-zombie-child-process/46700705#46700705", "title": "Detect zombie child process", "body": "<p>The best solution (for me) is:</p>\n\n<ol>\n<li>add a signal handler listen for SIGCHLD</li>\n<li>on receiving SIGCHLD, call cmd.Wait()</li>\n</ol>\n\n<p>This way, the zombie process will disappear.</p>\n"}], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 866, "favorite_count": 0, "accepted_answer_id": 46700705, "answer_count": 2, "score": 0, "last_activity_date": 1507777135, "creation_date": 1506092606, "last_edit_date": 1506095079, "question_id": 46367792, "link": "https://stackoverflow.com/questions/46367792/detect-zombie-child-process", "title": "Detect zombie child process", "body": "<p>My golang program starts a service program which is supposed to run forever, like this:</p>\n\n<pre><code>cmd := exec.Command(\"/path/to/service\")\ncmd.Start()\n</code></pre>\n\n<p>I do NOT want to wait for the termination of \"service\" because it is supposed to be running forever.  However, if service starts with some error (e.g. it will terminate if another instance is already running), the child process will exit and become zombie.</p>\n\n<p>My question is, after cmd.Start(), can I somehow detect if the child process is still running, rather than becomes a zombie? The preferred way might be:</p>\n\n<pre><code>if cmd.Process.IsZombie() {\n    ... ...\n}\n</code></pre>\n\n<p>or,</p>\n\n<pre><code>procStat := cmd.GetProcessStatus()\nif procStat.Zombie == true {\n    ... ...\n}\n</code></pre>\n\n<p>i.e. I hope there are some way to get the status of a (child) process without waiting for its exit code, or, to \"peek\" its status code without blocking.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1506091509, "post_id": 46367407, "comment_id": 79694439, "body": "Try reading through documentation for the <a href=\"https://golang.org/pkg/strings/\" rel=\"nofollow noreferrer\"><code>strings</code></a> package. I&#39;m sure there&#39;s a function there that could help you; finding out <i>which</i> is left as an exercise ;-)"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1506091569, "post_id": 46367407, "comment_id": 79694474, "body": "You encounderd byte order mark <a href=\"https://en.wikipedia.org/wiki/Byte_order_mark\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Byte_order_mark</a>"}, {"owner": {"reputation": 148712, "user_id": 19750, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/13b41b2620da0b1e630715e0c91a0b03?s=128&d=identicon&r=PG", "display_name": "Josh Lee", "link": "https://stackoverflow.com/users/19750/josh-lee"}, "edited": false, "score": 1, "creation_date": 1506091924, "post_id": 46367407, "comment_id": 79694690, "body": "Do you <i>actually</i> have a double-encoded BOM in your test case? If so, then just delete it. If not, then this code snippet obviously has nothing to do with your actual problem."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1506092024, "post_id": 46367407, "comment_id": 79694751, "body": "Just cut it of via s[3:] or whatever fits your need."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8400306, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FKlKeRGcIfE/AAAAAAAAAAI/AAAAAAAAABI/K8VIhNnysgE/photo.jpg?sz=128", "display_name": "Yves Dusenge", "link": "https://stackoverflow.com/users/8400306/yves-dusenge"}, "edited": false, "score": 0, "creation_date": 1506100860, "post_id": 46367521, "comment_id": 79699598, "body": "What I am trying to do, is check runes, see if they match BOM if they do, delete if not keep them. Thanks"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 1, "last_activity_date": 1506091702, "creation_date": 1506091702, "answer_id": 46367521, "question_id": 46367407, "link": "https://stackoverflow.com/questions/46367407/how-do-i-remove-%c3%af-in-golang-in-the-beginning-of-a-file/46367521#46367521", "title": "how do i remove &#239;&#187;&#191; in golang in the beginning of a file?", "body": "<p>In Go package <a href=\"https://golang.org/pkg/go/scanner/\" rel=\"nofollow noreferrer\">scanner</a> can skip byte order marks.</p>\n"}], "owner": {"reputation": 11, "user_id": 8400306, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-FKlKeRGcIfE/AAAAAAAAAAI/AAAAAAAAABI/K8VIhNnysgE/photo.jpg?sz=128", "display_name": "Yves Dusenge", "link": "https://stackoverflow.com/users/8400306/yves-dusenge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "closed_date": 1506156257, "answer_count": 1, "score": -3, "last_activity_date": 1506091702, "creation_date": 1506091384, "last_edit_date": 1506091460, "question_id": 46367407, "link": "https://stackoverflow.com/questions/46367407/how-do-i-remove-%c3%af-in-golang-in-the-beginning-of-a-file", "closed_reason": "Not suitable for this site", "title": "how do i remove &#239;&#187;&#191; in golang in the beginning of a file?", "body": "<pre><code>func Test_Read_Unicode(t *testing.T) {\n    s := \"\u00ef\u00bb\u00bf\u039f\u1f50\u03c7\u1f76 \u03c4\u03b1\u1f50\u03c4\u1f70, \u03c0\u03b1\u03c1\u1f77\u03c3\u03c4\u03b1\u03c4\u03b1\u1f77 \u03bc\u03bf\u03b9, \u03b3\u03b9\u03b3\u03bd\u1f7d\u03c3\u03ba\u03b5\u03b9\u03bd \u1f66, \u1f04\u03bd\u03b4\u03c1\u03b5\u03c2 \u1fbf\u0391\u03b8\u03b7\u03bd\u03b1\u1fd6\u03bf\u03b9\\n\" +\n        \"\u1f45\u03c4\u03b1\u03bd \u03c4\u1fbf, \u03b5\u1f30\u03c2 \u03c4\u1f70 \u03c0\u03c1\u1f71\u03b3\u03bc\u03b1\u03c4\u03b1 \u1f00\u03c0\u03bf\u03b2\u03bb\u1f73\u03c8\u03c9, \u03ba\u03b1\u1f76 \u1f45\u03c4\u03b1\u03bd, \u03c0\u03c1\u1f78\u03c2 \u03c4\u03bf\u1f7a\u03c2\\n\"\n\n    runes := []rune(s)\n</code></pre>\n"}, {"tags": ["python", "go", "tensorflow", "keras"], "answers": [{"comments": [{"owner": {"reputation": 1424, "user_id": 3585387, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/WPE9J.jpg?s=128&g=1", "display_name": "Jan Sila", "link": "https://stackoverflow.com/users/3585387/jan-sila"}, "edited": false, "score": 0, "creation_date": 1506098263, "post_id": 46369199, "comment_id": 79698355, "body": "great, thanks a lot! The node&#39;s name is <code>inputNode_input</code> if anyone is interested. Now I only need to parse the one image I&#39;m testing into correct format :)"}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "reply_to_user": {"reputation": 1424, "user_id": 3585387, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/WPE9J.jpg?s=128&g=1", "display_name": "Jan Sila", "link": "https://stackoverflow.com/users/3585387/jan-sila"}, "edited": false, "score": 1, "creation_date": 1506098849, "post_id": 46369199, "comment_id": 79698632, "body": "You&#39;re welcome! However, consider using tfgo, you can read the image and do preprocessing stuff easily"}, {"owner": {"reputation": 331, "user_id": 2752983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pVzq5.jpg?s=128&g=1", "display_name": "abggcv", "link": "https://stackoverflow.com/users/2752983/abggcv"}, "edited": false, "score": 1, "creation_date": 1519187733, "post_id": 46369199, "comment_id": 84801890, "body": "the input Node identifier may not be one of the <code>inputNode</code> or <code>inputNode_input</code> if you have trained the model using keras. In my case it is <code>input_1</code>"}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "edited": false, "score": 0, "creation_date": 1519196961, "post_id": 46369199, "comment_id": 84805232, "body": "yeah, every wrapper built upon Tensorflow changes the scopes as it whish: this is boring when working with Go. We have to remember to always load the model and print every node and look for the correct input name"}], "tags": [], "owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "is_accepted": true, "score": 4, "last_activity_date": 1506097385, "creation_date": 1506097385, "answer_id": 46369199, "question_id": 46366954, "link": "https://stackoverflow.com/questions/46366954/saving-tf-model-trained-with-keras-and-then-evaluated-in-go/46369199#46369199", "title": "Saving TF model trained with keras and then evaluated in Go", "body": "<p>Your code should work fine. You're right about the cause of the nil-operation.</p>\n\n<p>You just have to find the complete node name of your \"inputNode\".</p>\n\n<p>From python, after your model definition, you can loop over the graph nodes and look for the complete name, in that way:</p>\n\n<pre><code>for n in sess.graph.as_graph_def().node:\n    if \"inputNode\" in n.name:\n        print(n.name)\n</code></pre>\n\n<p>Once you got the complete name, you can use it in your Go program.</p>\n\n<p>Also, I suggest you to use a more complete and easy to use wrapper around the tensorflow API: <a href=\"https://github.com/galeone/tfgo\" rel=\"nofollow noreferrer\">tfgo</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13990731, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f8fba30033d3314e1facc8b9387767a?s=128&d=identicon&r=PG", "display_name": "Rozzati Marco", "link": "https://stackoverflow.com/users/13990731/rozzati-marco"}, "is_accepted": false, "score": 0, "last_activity_date": 1595621729, "creation_date": 1595621729, "answer_id": 63080850, "question_id": 46366954, "link": "https://stackoverflow.com/questions/46366954/saving-tf-model-trained-with-keras-and-then-evaluated-in-go/63080850#63080850", "title": "Saving TF model trained with keras and then evaluated in Go", "body": "<p>to show all the items in the session.graph list (in Golang):</p>\n<pre><code>ops := model.Graph.Operations()\nfor _, op := range ops {\n    fmt.Println(op.Name())\n}\n</code></pre>\n"}], "owner": {"reputation": 1424, "user_id": 3585387, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/WPE9J.jpg?s=128&g=1", "display_name": "Jan Sila", "link": "https://stackoverflow.com/users/3585387/jan-sila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1181, "favorite_count": 0, "accepted_answer_id": 46369199, "answer_count": 2, "score": 4, "last_activity_date": 1595621729, "creation_date": 1506090015, "question_id": 46366954, "link": "https://stackoverflow.com/questions/46366954/saving-tf-model-trained-with-keras-and-then-evaluated-in-go", "title": "Saving TF model trained with keras and then evaluated in Go", "body": "<p>I'm trying to setup a classical MNIST challenge model with <code>keras</code>, then save the <code>tensorflow</code> graph and subsequently load it in <code>Go</code> and evaluate with some input. I've been following <a href=\"https://nilsmagnus.github.io/post/go-tensorflow/\" rel=\"nofollow noreferrer\">this article</a> which supplies full code on <a href=\"https://github.com/nilsmagnus/tensorflow-with-go\" rel=\"nofollow noreferrer\">github</a>. Nils is using just tensorflow to setup the comp.graph but I would like to use <code>keras</code>. I managd to save the model the same way as he does </p>\n\n<p>model:</p>\n\n<pre><code>   model = Sequential()\nmodel.add(Conv2D(32, kernel_size=(3, 3),\n                 activation='relu',\n                 input_shape=(28,28,1), name=\"inputNode\"))\nmodel.add(Conv2D(64, (3, 3), activation='relu'))\nmodel.add(MaxPooling2D(pool_size=(2, 2)))\nmodel.add(Dropout(0.25))\nmodel.add(Flatten())\nmodel.add(Dense(128, activation='relu'))\nmodel.add(Dropout(0.5))\nmodel.add(Dense(10, activation='softmax', name=\"inferNode\"))\n</code></pre>\n\n<p>which runs ok, trains and evaluates and then saving as posted above:</p>\n\n<pre><code>builder = tf.saved_model.builder.SavedModelBuilder(\"mnistmodel_my\")\n# GOLANG note that we must tag our model so that we can retrieve it at inference-time\nbuilder.add_meta_graph_and_variables(sess, [\"serve\"])\nbuilder.save()\n</code></pre>\n\n<p>Which I then try to evaluate as :</p>\n\n<pre><code>result, runErr := model.Session.Run(\n        map[tf.Output]*tf.Tensor{\n            model.Graph.Operation(\"inputNode\").Output(0): tensor,\n        },\n        []tf.Output{\n            model.Graph.Operation(\"inferNode\").Output(0),\n        },\n        nil,\n    )\n</code></pre>\n\n<p>In Go I follow the example but when evaluating, I get:</p>\n\n<pre><code>    panic: nil-Operation. If the Output was created with a Scope object, see Scope.Err() for details.\n\ngoroutine 1 [running]:\ngithub.com/tensorflow/tensorflow/tensorflow/go.Output.c(0x0, 0x0, 0x0, 0x0)\n    /Users/air/go/src/github.com/tensorflow/tensorflow/tensorflow/go/operation.go:119 +0xbb\ngithub.com/tensorflow/tensorflow/tensorflow/go.newCRunArgs(0xc42006e210, 0xc420047ef0, 0x1, 0x1, 0x0, 0x0, 0x0, 0xc4200723c8)\n    /Users/air/go/src/github.com/tensorflow/tensorflow/tensorflow/go/session.go:307 +0x22d\ngithub.com/tensorflow/tensorflow/tensorflow/go.(*Session).Run(0xc420078060, 0xc42006e210, 0xc420047ef0, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\n    /Users/air/go/src/github.com/tensorflow/tensorflow/tensorflow/go/session.go:85 +0x153\nmain.main()\n    /Users/air/PycharmProjects/GoTensor/custom.go:36 +0x341\nexit status 2\n</code></pre>\n\n<p>Since it says <code>nil-Operation</code> I think I might have incorrectly labelled the nodes. But I don't know which other nodes should I then label?</p>\n\n<p>Many thanks!!!</p>\n"}]