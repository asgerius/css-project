[{"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1524097872, "post_id": 49910681, "comment_id": 86837710, "body": "Are you sure that <i>every</i> record has a release_date that is a time.Time?  that seems like the most likely cause - there actually <i>is</i> a record (or records) with an int for that field, and there actually are records with a time.Time, so no matter which one you choose, when you do <code>GetAll</code>, it fails, since it will find at least one that doesn&#39;t match."}, {"owner": {"reputation": 2151, "user_id": 1828137, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d1c33b5212cd795da1f7ab47f532f18b?s=128&d=identicon&r=PG&f=1", "display_name": "tmwoods", "link": "https://stackoverflow.com/users/1828137/tmwoods"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1524098213, "post_id": 49910681, "comment_id": 86837783, "body": "I did check (I&#39;m only testing with three entities right now) and just double-checked to be sure. All are the same data type."}, {"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1524100030, "post_id": 49910681, "comment_id": 86838221, "body": "There&#39;s not enough information here to help -- it still looks like either @dave is right about the entities not all having been stored in the same way, or possibly that you have two different entity types.  We don&#39;t see how you create your key (<code>k</code>) in the <code>Get</code> example, so we don&#39;t know if that&#39;s using the same <code>&quot;myEntityType&quot;</code> as the <code>GetAll</code> example.  One way or another, though, we know from your error messages that you&#39;ve stored some entities&#39; <code>Release_Date</code> as <code>int</code> and some as <code>time.Time</code>."}, {"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "edited": false, "score": 0, "creation_date": 1524100226, "post_id": 49910681, "comment_id": 86838273, "body": "Also, I&#39;ve never seen <code>NewQuery</code>, <code>Project</code>, or <code>Order</code> with lower-case parameters, since they only work with exported types and fields.  I&#39;m not sure if the datastore package just treats them case-insensitively (since these are just string parameters referring to things you&#39;ve already stored, that&#39;s entirely possible), but it stands at to me as unusual, and incongruous."}, {"owner": {"reputation": 2151, "user_id": 1828137, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d1c33b5212cd795da1f7ab47f532f18b?s=128&d=identicon&r=PG&f=1", "display_name": "tmwoods", "link": "https://stackoverflow.com/users/1828137/tmwoods"}, "edited": false, "score": 0, "creation_date": 1524100621, "post_id": 49910681, "comment_id": 86838373, "body": "I added where I create <code>k</code>. I also nuked all entries in my datastore and added a single entry (fun fact, it means you have to rebuild the indexes) triple-checking the data types. The parameters you refer to are the named fields in my datastore so they should match case, no?"}, {"owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "edited": false, "score": 0, "creation_date": 1524122530, "post_id": 49910681, "comment_id": 86845571, "body": "Well, the struct fields are exported/capitalized: <code>Field1</code>, <code>Field2</code>, and <code>Release_Date</code>, and you&#39;re using the parameters: <code>&quot;field1&quot;, &quot;field2&quot;, &quot;release_date&quot;</code>.  Again, I don&#39;t know if that&#39;s actually an issue; it just stands out as non-standard (and possibly an issue).  In any case, I recommend updating with a single-file minimal reproducible example.  I don&#39;t see anything obviously wrong with what you&#39;ve posted.  It could turn out that you have two different <code>myStruct</code> types in different packages, or any number of things like that, that we just can&#39;t identify based on what we can see here."}, {"owner": {"reputation": 1585, "user_id": 6650788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10205931104110360/picture?type=large", "display_name": "komarkovich", "link": "https://stackoverflow.com/users/6650788/komarkovich"}, "edited": false, "score": 0, "creation_date": 1525962304, "post_id": 49910681, "comment_id": 87566917, "body": "@tmwoods Can you confirm if what Darshan Rivka Whittle stated in the last comment was the issue?"}, {"owner": {"reputation": 2151, "user_id": 1828137, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d1c33b5212cd795da1f7ab47f532f18b?s=128&d=identicon&r=PG&f=1", "display_name": "tmwoods", "link": "https://stackoverflow.com/users/1828137/tmwoods"}, "reply_to_user": {"reputation": 1585, "user_id": 6650788, "user_type": "registered", "accept_rate": 80, "profile_image": "https://graph.facebook.com/10205931104110360/picture?type=large", "display_name": "komarkovich", "link": "https://stackoverflow.com/users/6650788/komarkovich"}, "edited": false, "score": 0, "creation_date": 1525967036, "post_id": 49910681, "comment_id": 87569956, "body": "@komarkovich No, I don&#39;t believe it was. I&#39;ll add my process as an answer, although it&#39;s not a very good solution. It&#39;s based more on a theory than fact, although it would be easy to test and reproduce."}], "answers": [{"tags": [], "owner": {"reputation": 2151, "user_id": 1828137, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d1c33b5212cd795da1f7ab47f532f18b?s=128&d=identicon&r=PG&f=1", "display_name": "tmwoods", "link": "https://stackoverflow.com/users/1828137/tmwoods"}, "is_accepted": false, "score": 1, "last_activity_date": 1525967733, "creation_date": 1525967733, "answer_id": 50276881, "question_id": 49910681, "link": "https://stackoverflow.com/questions/49910681/cloud-datastore-client-getall-type-mismatch-but-client-get-works/50276881#50276881", "title": "Cloud datastore client.GetAll type mismatch but client.Get works", "body": "<p>So this isn't an elegant solution, but it's what worked for me.</p>\n\n<p>What I <em>think</em> was the cause is that the very first entity I created had a field <code>Release_Date</code> of a type <code>int</code> but I later added entities using the type <code>Date/Time</code>. During my testing I had ended up removing the entity with type <code>int</code> for <code>Release_Date</code> so the only remaining entities had <code>Date/Time</code>. Despite having no entities with type <code>int</code> for <code>Release_Date</code>, my code failed server-side. It kept expecting that field to be of type <code>int</code>.</p>\n\n<p>My theory is that the entity definition was established when I first created the entity and was not updated when I changed the data type later on even though no entities remained using type <code>int</code>.</p>\n\n<p>So what I ended up doing was backing up my entities, removing ALL of them, then re-adding the entities with only <code>Date/Time</code> in the <code>Release_Date</code> field. Once I did that, everything worked fine. I still have the casing the same as shown above (i.e. my <code>Struct</code> uses <code>Field</code> but my query uses <code>field</code>).</p>\n\n<p>This would likely be an easy thing to reproduce but I haven't gotten around to it. If anyone else gets around to testing please add a comment, otherwise I will eventually and submit a bug report.</p>\n"}], "owner": {"reputation": 2151, "user_id": 1828137, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d1c33b5212cd795da1f7ab47f532f18b?s=128&d=identicon&r=PG&f=1", "display_name": "tmwoods", "link": "https://stackoverflow.com/users/1828137/tmwoods"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1525967733, "creation_date": 1524095877, "last_edit_date": 1524112179, "question_id": 49910681, "link": "https://stackoverflow.com/questions/49910681/cloud-datastore-client-getall-type-mismatch-but-client-get-works", "title": "Cloud datastore client.GetAll type mismatch but client.Get works", "body": "<p>I am writing a <code>go</code> application in <code>app engine</code> that connects and returns some info from <code>datastore</code> entities. I'm having an issue where <code>client.Get</code> is working with a predefined struct but <code>client.GetAll</code> is throwing a type mismatch (or vice versa).</p>\n\n<p>I am using the following struct with both:</p>\n\n<pre><code>type myStruct struct {\n    ID              int64\n    Field1          string\n    Field2          string\n    Release_Date    time.Time\n}\n</code></pre>\n\n<p>This works when <code>Release_Date</code> is defined as <code>time.Time</code> (fails if <code>int</code>):</p>\n\n<pre><code>k := db.datastoreKey(id)\nmyStruct := &amp;myStruct{}\nif err := db.client.Get(ctx, k, myStruct ); err != nil {\n        return nil, fmt.Errorf(\"datastore: %v\", err)\n}\n\nfunc (db *datastoreDB) datastoreKey(id int64) *datastore.Key {\n    return datastore.IDKey(\"myEntityType\", id, nil)\n}\n</code></pre>\n\n<p>This fails when <code>Release_Date</code> is defined as <code>time.Time</code> (works if <code>int</code>):</p>\n\n<pre><code>var myStructs []*myStruct \nq := datastore.NewQuery(\"myEntityType\").\n            Project(\"field1\", \"field2\", \"release_date\").\n            Order(\"field1\")\nkeys, err := db.client.GetAll(ctx, q, &amp;myStructs)\nif err != nil {\n        return nil, fmt.Errorf(\"datastore: %v\", err)\n}\n</code></pre>\n\n<p>The error:</p>\n\n<blockquote>\n  <p>datastore: cannot load field \"release_date\" into a \"myStruct\": type mismatch: int versus time.Time</p>\n</blockquote>\n\n<p>(or vice versa when I swap the <code>Release_Date</code> definition).</p>\n\n<p>Any ideas what is wrong or is this a bug?</p>\n\n<p><strong>Additional info:</strong></p>\n\n<p>I've looked at the entity dashboard and there it lists the data type as <code>Data/Time</code> and when I retrieve the entity with <code>Get</code> it loads fine into the struct and I can use the object in my code.</p>\n\n<p>I have no idea why this isn't working.</p>\n"}, {"tags": ["docker", "go", "redis", "redigo"], "answers": [{"comments": [{"owner": {"reputation": 1203, "user_id": 190296, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/467893969a8740d363c40413bb48c133?s=128&d=identicon&r=PG", "display_name": "Schroedinger", "link": "https://stackoverflow.com/users/190296/schroedinger"}, "edited": false, "score": 0, "creation_date": 1524186719, "post_id": 49910392, "comment_id": 86880495, "body": "Thanks, could you think as to why we may get a conn refused from redis? Just network noise?"}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 1, "last_activity_date": 1524093480, "creation_date": 1524093480, "answer_id": 49910392, "question_id": 49910285, "link": "https://stackoverflow.com/questions/49910285/redis-dial-tcp-redis-address-connect-connection-refused/49910392#49910392", "title": "redis: dial tcp [REDIS ADDRESS] connect: connection refused", "body": "<p>You could retry the dial using some sort of exponential backoff:</p>\n\n<pre><code>Dial: func() (redis.Conn, error) {\n    c, err := redis.Dial(\"tcp\", address, options...)\n    for retries := 0; err != nil &amp;&amp; retries &lt; 5; retries++ {\n        time.Sleep((50 &lt;&lt; retries) * time.Millisecond)\n        c, err = redis.Dial(\"tcp\", address, options...)\n    }\n    return c, err\n},\n</code></pre>\n"}], "owner": {"reputation": 1203, "user_id": 190296, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/467893969a8740d363c40413bb48c133?s=128&d=identicon&r=PG", "display_name": "Schroedinger", "link": "https://stackoverflow.com/users/190296/schroedinger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1451, "favorite_count": 0, "accepted_answer_id": 49910392, "answer_count": 1, "score": 1, "last_activity_date": 1524129470, "creation_date": 1524092633, "last_edit_date": 1524129470, "question_id": 49910285, "link": "https://stackoverflow.com/questions/49910285/redis-dial-tcp-redis-address-connect-connection-refused", "title": "redis: dial tcp [REDIS ADDRESS] connect: connection refused", "body": "<p>I'm using redigo in go with docker. I have a server that processes incoming events and uses redis for rate limiting. One in every 100k+ connections or so I get the following error:</p>\n\n<p><code>redis: dial tcp IP ADDRESS: connect: connection refused</code></p>\n\n<p>The configuration is all inside docker using docker-compose. I've got sentry sending me these errors, I was wondering if there were any tweaks/settings I could do to remove/reduce this error</p>\n\n<p>My redigo configuration is</p>\n\n<pre><code>redis := &amp;redis.Pool{\n    MaxActive: idleConnections,\n    MaxIdle:   idleConnections,\n    Wait:      true,\n    Dial: func() (redis.Conn, error) {\n        return redis.Dial(\"tcp\", address, options...)\n    },\n}\n</code></pre>\n"}, {"tags": ["windows", "api", "go"], "answers": [{"comments": [{"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1524155923, "post_id": 49912161, "comment_id": 86868131, "body": "Thanks a lot, I knew the concept from previous experience with C programming but obviously misunderstood the concept of mapping &quot;bytes&quot; to string in Go."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1524107808, "creation_date": 1524107808, "answer_id": 49912161, "question_id": 49910002, "link": "https://stackoverflow.com/questions/49910002/handling-lptstr-in-golang-with-lxn-win/49912161#49912161", "title": "Handling LPTSTR in golang with lxn/win", "body": "<p>Approach the problem in a logical, systematic fashion.</p>\n\n<hr>\n\n<p>Carefully read the Microsoft documentation for the function.</p>\n\n<p><a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/bb762204.aspx\" rel=\"nofollow noreferrer\">SHGetSpecialFolderPath function</a></p>\n\n<hr>\n\n<p>Carefully read the <code>lxn/win</code> package documentation for the function.</p>\n\n<p><a href=\"https://godoc.org/github.com/lxn/win\" rel=\"nofollow noreferrer\">package win</a></p>\n\n<pre><code>import \"github.com/lxn/win\" \n</code></pre>\n\n<p><a href=\"https://godoc.org/github.com/lxn/win#SHGetSpecialFolderPath\" rel=\"nofollow noreferrer\">func SHGetSpecialFolderPath</a></p>\n\n<pre><code>func SHGetSpecialFolderPath(hwndOwner HWND, lpszPath *uint16, csidl CSIDL, fCreate bool) bool\n</code></pre>\n\n<hr>\n\n<p>Now, using the documentation, implement the function call in Go. Go Unicode strings are UTF-8 encoded. Windows Unicode strings are UTF-16 encoded.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n\n    \"github.com/lxn/win\"\n)\n\nfunc main() {\n    buf := make([]uint16, win.MAX_PATH)\n    rv := win.SHGetSpecialFolderPath(win.HWND(0), &amp;buf[0], win.CSIDL_WINDOWS, false)\n    fmt.Println(rv)\n    path := syscall.UTF16ToString(buf)\n    fmt.Println(path)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>true\nC:\\Windows\n</code></pre>\n"}], "owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 1, "accepted_answer_id": 49912161, "answer_count": 1, "score": 1, "last_activity_date": 1524107808, "creation_date": 1524090821, "last_edit_date": 1524091643, "question_id": 49910002, "link": "https://stackoverflow.com/questions/49910002/handling-lptstr-in-golang-with-lxn-win", "title": "Handling LPTSTR in golang with lxn/win", "body": "<p>I have this piece of code which runs without returning <code>err</code> but simply doesn't do its job because it doesn't return the expected value.\nThe idea is to use <a href=\"https://msdn.microsoft.com/de-de/library/windows/desktop/bb762204(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>SHGetSpecialFolderPath</code></a> in order to retrieve the path to the Windows directory (<code>C:\\Windows</code> for example). This api call has the following signature:</p>\n\n<pre><code>BOOL SHGetSpecialFolderPath(\n        HWND   hwndOwner, \n        _Out_ LPTSTR lpszPath,\n        _In_  int    csidl,\n        _In_  BOOL   fCreate );\n</code></pre>\n\n<p>I know it is deprecated, but still available even on current Windows versions. I have to use this API because I need to support Windows versions older than Windows 7 (I know that these are old or even end of life)</p>\n\n<p>This is the piece of code:</p>\n\n<pre><code>target := \"XXX...XXX\" // hard coded string with more than 600 characters\nbuffer, err := syscall.UTF16PtrFromString(target)\nif err != nil {\n        fmt.Println(\"conversion of string:\", err)\n}\n\nresult := win.SHGetSpecialFolderPath(0, buffer, win.CSIDL_WINDOWS, false)\nif err != nil {\n    fmt.Println(\"result of get folder:\", err)\n}\n\nfmt.Println(\"folder retrieved ok: \", result)\nfmt.Println(\"folder: \", target)\n}\n</code></pre>\n\n<p>None of the <code>err</code> is set, the API call returns <code>true</code> but the string is unchanged:</p>\n\n<pre><code>folder retrieved ok:  true\nfolder: XXX...XXX\n</code></pre>\n\n<p>The result is the same on Windows 10 x64 and on my testing VM running Windows XP SP3 (I know that XP is inherently unsafe)</p>\n\n<p>I have seen examples how to use <code>LPTRSTR</code> with <code>unsafe</code> and <code>uintptr</code> here <a href=\"https://stackoverflow.com/questions/35238933/golang-call-getvolumeinformation-winapi-function\">on SO</a> and other sites but none of them compile on my version of golang (which is <code>go version go1.10.1 windows/amd64</code>, I compiled with <code>GOARCH=386</code>)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 2, "creation_date": 1524088065, "post_id": 49909281, "comment_id": 86834941, "body": "just getting started? read the doc, it is really well written <a href=\"https://golang.org/pkg/encoding/json/#example_Unmarshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#example_Unmarshal</a> you&#39;re not going away with anything in go without at least taking a peek at its excellent documentation"}], "answers": [{"tags": [], "owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "is_accepted": true, "score": 3, "last_activity_date": 1524087660, "creation_date": 1524087660, "answer_id": 49909440, "question_id": 49909281, "link": "https://stackoverflow.com/questions/49909281/passing-a-json-file-to-golang-function/49909440#49909440", "title": "Passing a json file to GoLang function", "body": "<p>If the structure of your JSON is not well defined and can change, that's the way to go:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    var b = []byte(`{\"a\":\"b\", \"c\":1, \"d\": [\"e\", \"f\"]}`)\n    var j map[string]interface{}\n    err := json.Unmarshal(b, &amp;j)\n    if (err != nil) {\n        return\n    }\n\n    printJson(j)\n}\n\nfunc printJson(j map[string]interface{}) {\n\n    for k, v := range j {\n        fmt.Printf(\"%v %v\\n\", k, v)\n    }\n}\n</code></pre>\n\n<p>If your JSON is well defined, though, you can unmarshal it into struct, which is usually better:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Message struct {\n    A string\n    C int\n    D []string\n}\n\nfunc main() {\n    var b = []byte(`{\"a\":\"b\", \"c\":1, \"d\": [\"e\", \"f\"]}`)\n    var j Message\n    err := json.Unmarshal(b, &amp;j)\n    if (err != nil) {\n        return\n    }\n\n    printJson(j)\n}\n\nfunc printJson(j Message) {\n    fmt.Printf(\"A %v\\n\", j.A)\n    fmt.Printf(\"C %v\\n\", j.C)\n    fmt.Printf(\"D %v\\n\", j.D)\n}\n</code></pre>\n\n<p>You can play with later code here: <a href=\"https://play.golang.org/p/wDPy4m2x2_t\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wDPy4m2x2_t</a></p>\n"}], "owner": {"reputation": 738, "user_id": 2405589, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e4b3e1440b7e8a972e451917bb178d35?s=128&d=identicon&r=PG", "display_name": "user2405589", "link": "https://stackoverflow.com/users/2405589/user2405589"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1739, "favorite_count": 1, "accepted_answer_id": 49909440, "answer_count": 1, "score": 0, "last_activity_date": 1524087660, "creation_date": 1524086879, "question_id": 49909281, "link": "https://stackoverflow.com/questions/49909281/passing-a-json-file-to-golang-function", "title": "Passing a json file to GoLang function", "body": "<p>Just getting started with Go. </p>\n\n<p>I have a Go function as below to which I have to pass a json file. How can I pass a json file reference to this function i.e. accept it as a map of interfaces? </p>\n\n<pre><code>func compressOIds(mapDocument map[string]interface{}) string {\n    var objectIdValue string\n    for key, value := range mapDocument {\n       ....\n    }\n    return \"\"\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1524082454, "post_id": 49908247, "comment_id": 86832455, "body": "What exactly does &quot;not working&quot; mean? Remember that a slice contains a pointer to an array, but a) <code>append</code> returns a new slice which may point to a new array, and b) changes to the slice bounds won&#39;t be reflected in another copy of the slice"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1524082456, "post_id": 49908247, "comment_id": 86832457, "body": "True the slice contains a pointer to the array but also the len and cap, which are copied over when you pass it to a func and therefore they are not changed outside of the func."}, {"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 0, "creation_date": 1524082463, "post_id": 49908247, "comment_id": 86832462, "body": "slices are copied when passed to a function as a parameter, period. the fact that slice elements point to value doesn&#39;t change that fact. Either pass a pointer to struct containing the slice or pass a &quot;pointer to slice&quot;."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1524082715, "post_id": 49908247, "comment_id": 86832592, "body": "Btw you should be able to fix your issue by passing a pointer to the slice to <code>mockWriter</code> and inside do <code>*messageSent = append(*messageSent, input)</code>."}, {"owner": {"reputation": 2382, "user_id": 1970079, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/62f9d3f99ec13c1986f2194475f5f059?s=128&d=identicon&r=PG", "display_name": "Pratik Bothra", "link": "https://stackoverflow.com/users/1970079/pratik-bothra"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1524082844, "post_id": 49908247, "comment_id": 86832649, "body": "@mkopriva That would explain it. I guess then I&#39;m looking at something like this: <a href=\"https://stackoverflow.com/questions/20195296/golang-append-an-item-to-a-slice\" title=\"golang append an item to a slice\">stackoverflow.com/questions/20195296/&hellip;</a>. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1524087719, "post_id": 49908414, "comment_id": 86834804, "body": "Remember that all function parameters are passed by value. And that appending to a slice returns a new slice. So you have to use a pointer this way so that the caller gets the new slice."}, {"owner": {"reputation": 265, "user_id": 3604851, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/4EmZK.png?s=128&g=1", "display_name": "Martin Spasov", "link": "https://stackoverflow.com/users/3604851/martin-spasov"}, "edited": false, "score": 0, "creation_date": 1524092350, "post_id": 49908414, "comment_id": 86836318, "body": "Havent tried it but i believe that it should be <code>*messageSent = append(*messageSent, input)</code> instead of <code>*messageSent = *append(messageSent, input)</code>"}], "tags": [], "owner": {"reputation": 2382, "user_id": 1970079, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/62f9d3f99ec13c1986f2194475f5f059?s=128&d=identicon&r=PG", "display_name": "Pratik Bothra", "link": "https://stackoverflow.com/users/1970079/pratik-bothra"}, "is_accepted": false, "score": 1, "last_activity_date": 1524082980, "last_edit_date": 1524082980, "creation_date": 1524082917, "answer_id": 49908414, "question_id": 49908247, "link": "https://stackoverflow.com/questions/49908247/appending-an-item-to-slice-in-a-function-isnt-changing-the-original-slice/49908414#49908414", "title": "Appending an item to slice in a function isn&#39;t changing the original slice", "body": "<p>This was the answer, all credits to @mkopriva. </p>\n\n<pre><code>func mockWriter(messageSent *[]*sqs.SendMessageInput) *SQSWriter{\n    return &amp;SQSWriter{\n        queueURL: aws.String(\"aQueueURL\"),\n        service: &amp;mock.SQS{\n            SendMessageStub: func(input *sqs.SendMessageInput) (*sqs.SendMessageOutput, error) {\n                *messageSent = *append(messageSent, input)\n                return nil, nil\n            },\n        },\n    }\n}\n\nfunc TestProcessRecords(t *testing.T) {\n    messageSent := []*sqs.SendMessageInput{}\n    inputEvent := readFirehoseEventFromFile(t, \"../../../../testdata/firehose_event.json\")\n    processRecords(inputEvent.Records, mockWriter(&amp;messageSent))\n    assert.Equal(t, 2, len(inputEvent.Records))\n    assert.Equal(t, 1, len(messageSent))\n}\n</code></pre>\n"}], "owner": {"reputation": 2382, "user_id": 1970079, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/62f9d3f99ec13c1986f2194475f5f059?s=128&d=identicon&r=PG", "display_name": "Pratik Bothra", "link": "https://stackoverflow.com/users/1970079/pratik-bothra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524083094, "creation_date": 1524082226, "last_edit_date": 1524083094, "question_id": 49908247, "link": "https://stackoverflow.com/questions/49908247/appending-an-item-to-slice-in-a-function-isnt-changing-the-original-slice", "title": "Appending an item to slice in a function isn&#39;t changing the original slice", "body": "<p>Can someone explain why the two aren't equivalent? The latter does build, but doesn't work as expected. I thought slices would be changed automatically, as contain a pointer to the array. </p>\n\n<p>// Working spec</p>\n\n<pre><code>func TestProcessRecords(t *testing.T) {\n    var messageSent []*sqs.SendMessageInput\n    w := &amp;SQSWriter{\n        queueURL: aws.String(\"aQueueURL\"),\n        service: &amp;mock.SQS{\n            SendMessageStub: func(input *sqs.SendMessageInput) (*sqs.SendMessageOutput, error) {\n                messageSent = append(messageSent, input)\n                return nil, nil\n            },\n        },\n    }\n    inputEvent := readFirehoseEventFromFile(t, \"../../../../testdata/firehose_event.json\")\n    processRecords(inputEvent.Records, w)\n    assert.Equal(t, 2, len(inputEvent.Records))\n    assert.Equal(t, 1, len(messageSent))\n}\n</code></pre>\n\n<p>Attempted refactoring, as the mockedWriter will be used across specs</p>\n\n<p>// Not Working spec</p>\n\n<pre><code>func mockWriter(messageSent []*sqs.SendMessageInput) *SQSWriter{\n    return &amp;SQSWriter{\n        queueURL: aws.String(\"aQueueURL\"),\n        service: &amp;mock.SQS{\n            SendMessageStub: func(input *sqs.SendMessageInput) (*sqs.SendMessageOutput, error) {\n                messageSent = append(messageSent, input)\n                return nil, nil\n            },\n        },\n    }\n}\n\nfunc TestProcessRecords(t *testing.T) {\n    messageSent := []*sqs.SendMessageInput{}\n    inputEvent := readFirehoseEventFromFile(t, \"../../../../testdata/firehose_event.json\")\n    processRecords(inputEvent.Records, mockWriter(messageSent))\n    assert.Equal(t, 2, len(inputEvent.Records))\n    assert.Equal(t, 1, len(messageSent))\n}\n</code></pre>\n\n<p>I should mention that I'm coming from a background in JS/Ruby/Python, and it is taking a bit of time to get a firmer grasp of go fundamentals. </p>\n\n<p>Thanks in advance </p>\n"}, {"tags": ["go", "networking"], "comments": [{"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "edited": false, "score": 0, "creation_date": 1524079114, "post_id": 49907208, "comment_id": 86830664, "body": "What is output after <code>signalHandler() received signal</code>?  I don&#39;t believe <code>signal.Ignore()</code> is actually ignoring anything, so it&#39;s possible another signal is received before <code>SIGINT</code> or <code>SIGHUP</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1524079172, "post_id": 49907208, "comment_id": 86830708, "body": "You have a data race. Run your code through shutdown with the race detector."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1524080091, "post_id": 49907208, "comment_id": 86831213, "body": "Setting a global var like this is not thread-safe. Generally in Go you would use a channel to signal shutdown."}, {"owner": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "edited": false, "score": 0, "creation_date": 1524081285, "post_id": 49907208, "comment_id": 86831840, "body": "Thanks for your responses. After protecting the global variable the problem went away. Also thanks for the tip to use race detector."}], "owner": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 544, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524078162, "creation_date": 1524078162, "question_id": 49907208, "link": "https://stackoverflow.com/questions/49907208/signal-handling-in-golang-with-network-programming", "title": "signal handling in golang with network programming", "body": "<p>Trying to learn golang network programming. Implemented simple\nserver with unix domain sockets. The server has:</p>\n\n<ol>\n<li>taskChan: Unbuf channel for client connection object.</li>\n<li>sigChan: buf channel for signals</li>\n<li>srvDone: unbuf channel to indicate server done.</li>\n<li>blocks all async signals except SIGINT/SIGHUP.</li>\n</ol>\n\n<p>Then starts signalHandler(), three taskWorker(), acceptClientReqs()\nin goroutines. On receiving the signal (send the signal to this process with kill -SIGINT ), the signal handler sets global variable <strong>serverShutdown</strong>. My intention is - all the goroutines to read <strong>serverShutdown</strong> and exit cleanly. However, some times all the worker\nthreads exiting and other times they don't. Do you see any bug in my code?\nOr am I missing some thing?</p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\nimport \"fmt\"\nimport \"net\"\nimport \"os\"\nimport \"os/signal\"\nimport \"syscall\"\nimport \"time\"\n\nvar srvShutdown = false\n\ntype netServer struct {\n    listener     *net.UnixListener // unix local sock\n    taskChan     chan net.Conn     // unbuf channel for client connections\n    sigChan      chan os.Signal    // buffered channel\n    srvDone      chan bool\n    numOfWorkers int\n}\n\n// initialize signals.\nfunc initSignals() {\n    // block all async signals to this server except SIGINT/SIGHUP\n    signal.Ignore()\n}\n\n// initializes server:\n//   1) creates listener.\n//   2) creates task channel - client connections accepted on this channel.\n//   3) initializes few other things such as signal channel, num of workers etc.\nfunc initServer() (*netServer, error) {\n    sockAddr, err := net.ResolveUnixAddr(\"unix\", \"/tmp/unix.socket\")\n    if err != nil {\n        fmt.Println(\"initServer() failed on ResolveUnixAddr(): \", err)\n        return nil, err\n    }\n    srvlistener, err := net.ListenUnix(\"unix\", sockAddr)\n    if err != nil {\n        fmt.Println(\"initServer() failed on ListenUnix(): \", err)\n        return nil, err\n    }\n    netSrv := &amp;netServer{\n        listener:     srvlistener,\n        taskChan:     make(chan net.Conn),\n        sigChan:      make(chan os.Signal, 1),\n        srvDone:      make(chan bool),\n        numOfWorkers: 3,\n    }\n    initSignals()\n    return netSrv, nil\n}\n\n// Accept client connections. Each connection is directed onto\n// a channel. Worker threads pickup and work on these connections.\nfunc (netSrv *netServer) acceptClientReqs() {\n    fmt.Println(\"Listening on /tmp/unix.socket\")\n    for srvShutdown != true {\n        netSrv.listener.SetDeadline(time.Now().Add(time.Second))\n        conn, err := netSrv.listener.Accept()\n        if err != nil {\n            fmt.Println(\"Accept failed : \", err)\n            continue\n        }\n        netSrv.taskChan &lt;- conn\n    }\n    netSrv.srvDone &lt;- true\n    fmt.Println(\"Exiting server\")\n}\n\n// Pickup a client connection, work on it and close connection.\nfunc (netSrv *netServer) taskWorker(workerId int) {\n    fmt.Println(\"taskWorker(): starting worker-\", workerId)\n    // for conn := range netSrv.taskChan {\n    for srvShutdown != true {\n        conn := &lt;-netSrv.taskChan\n        if conn == nil {\n            fmt.Println(\"taskWorker(): worker-\", workerId, \" continue\")\n            continue\n        }\n        fmt.Println(\"taskWorker(): worker-\", workerId, \" processing client connection: \", conn)\n        dec := json.NewDecoder(conn)\n        var Cmd string\n        dec.Decode(&amp;Cmd)\n        fmt.Println(\" cmd: \", Cmd)\n\n        // reply to client\n        _, err := conn.Write([]byte(\"AUTH SUCCESS\"))\n        if err != nil {\n            return\n        }\n        conn.Close()\n        fmt.Println(\"taskWorker(): worker-\", workerId, \" processed client connection: \", conn)\n    }\n    fmt.Println(\"taskWorker(): exiting worker-\", workerId)\n}\n\n// Handle SIGINT and SIGHUP for now.\nfunc (netSrv *netServer) signalHandler() {\n    signal.Notify(netSrv.sigChan, syscall.SIGINT, syscall.SIGHUP)\n    sig := &lt;-netSrv.sigChan\n    fmt.Println(\"signalHandler() received signal\", sig)\n    srvShutdown = true\n}\n\nfunc (netSrv *netServer) cleanUp() {\n    close(netSrv.taskChan)\n    netSrv.listener.Close()\n    close(netSrv.srvDone)\n}\n\nfunc main() {\n    srv, err := initServer()\n    if err != nil {\n        fmt.Println(\"initServer() failed - \", err)\n        return\n    }\n    go srv.signalHandler()\n\n    for i := 1; i &lt;= srv.numOfWorkers; i++ {\n        go srv.taskWorker(i)\n    }\n    go srv.acceptClientReqs()\n\n    // wait server to complete\n    &lt;-srv.srvDone\n    srv.cleanUp()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1524076630, "post_id": 49906753, "comment_id": 86829357, "body": "If you&#39;re trying to produce JSON, why not just use <code>encoding&#47;json</code>? It&#39;s built for the purpose so you won&#39;t have to use weird workarounds for stuff like this."}, {"owner": {"reputation": 12150, "user_id": 1143724, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/47fa5f1bc077c8158fe5ad1287105381?s=128&d=identicon&r=PG", "display_name": "MrDuk", "link": "https://stackoverflow.com/users/1143724/mrduk"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1524076673, "post_id": 49906753, "comment_id": 86829381, "body": "I&#39;m honestly really new to go, so I hadn&#39;t even considered that as an option :)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1524076704, "post_id": 49906753, "comment_id": 86829404, "body": "A quick web search for &quot;golang json&quot; would turn up some valuable information."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1524087300, "post_id": 49906753, "comment_id": 86834632, "body": "Don&#39;t reinvent the wheel..or the standard library."}, {"owner": {"reputation": 265, "user_id": 3604851, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/4EmZK.png?s=128&g=1", "display_name": "Martin Spasov", "link": "https://stackoverflow.com/users/3604851/martin-spasov"}, "edited": false, "score": 0, "creation_date": 1524094114, "post_id": 49906753, "comment_id": 86836782, "body": "not really an answer, but if you plan on receiving json and you will only need part of it, then take a look at this library (<a href=\"https://github.com/buger/jsonparser\" rel=\"nofollow noreferrer\">github.com/buger/jsonparser</a>)."}], "answers": [{"comments": [{"owner": {"reputation": 12150, "user_id": 1143724, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/47fa5f1bc077c8158fe5ad1287105381?s=128&d=identicon&r=PG", "display_name": "MrDuk", "link": "https://stackoverflow.com/users/1143724/mrduk"}, "edited": false, "score": 0, "creation_date": 1524145069, "post_id": 49911790, "comment_id": 86860674, "body": "I appreciate the help instead of just pointing out the libraries to consider."}], "tags": [], "owner": {"reputation": 1917, "user_id": 6401895, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e169f96fa9c3c6a770dd828e3319263a?s=128&d=identicon&r=PG", "display_name": "Ivan Beldad", "link": "https://stackoverflow.com/users/6401895/ivan-beldad"}, "is_accepted": true, "score": 5, "last_activity_date": 1524104884, "creation_date": 1524104884, "answer_id": 49911790, "question_id": 49906753, "link": "https://stackoverflow.com/questions/49906753/how-can-i-join-an-array-into-a-string-while-preserving-quotes/49911790#49911790", "title": "How can I join an array into a string while preserving quotes?", "body": "<p>Your tricky approach fixed:</p>\n\n<pre><code>tags := []string{\"prod\", \"stats\"}\n\njsonStr := []byte(fmt.Sprintf(`{\"isRegion\":true, \"tags\":[\"%s\"]}`, \n    strings.Join(data, `\", \"`)))\n</code></pre>\n\n<p>The easy and correct way:</p>\n\n<pre><code>// This will be your JSON object\ntype Whatever struct {\n    // Field appears in JSON as key \"isRegion\"\n    IsRegion bool     `json:\"isRegion\"` \n    Tags     []string `json:\"tags\"`\n}\n\ntags := []string{\"prod\", \"stats\"}\nw := Whatever{IsRegion: true, Tags: tags}\n\n// here is where we encode the object\njsonStr, err := json.MarshalIndent(w, \"\", \"  \")\nif err != nil {\n    // Handle the error\n}\n\nfmt.Print(string(jsonStr))\n</code></pre>\n\n<p>You can either use json.MarshalIndent or json.Marshal to encode JSON, and json.UnMarshal to decode. Check more info about this at the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"noreferrer\">official documentation</a>.</p>\n"}], "owner": {"reputation": 12150, "user_id": 1143724, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/47fa5f1bc077c8158fe5ad1287105381?s=128&d=identicon&r=PG", "display_name": "MrDuk", "link": "https://stackoverflow.com/users/1143724/mrduk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2666, "favorite_count": 0, "accepted_answer_id": 49911790, "answer_count": 1, "score": 1, "last_activity_date": 1524104884, "creation_date": 1524076551, "last_edit_date": 1524076632, "question_id": 49906753, "link": "https://stackoverflow.com/questions/49906753/how-can-i-join-an-array-into-a-string-while-preserving-quotes", "title": "How can I join an array into a string while preserving quotes?", "body": "<p>I have a string: <code>{\"isRegion\":true, \"tags\":?}</code></p>\n\n<p>Where I want to join an array of strings in place of <code>?</code>, surrounded by quotes.</p>\n\n<p>My current attempt doesn't quite work:</p>\n\n<pre><code>jsonStr := []byte(fmt.Sprintf(`{\"isRegion\":true, \"tags\":[%q]}, strings.Join(tags, `\",\"`)))\n</code></pre>\n\n<p>The above gives the output:  <code>\"tags\":[\"prod\\\",\\\"stats\"]</code></p>\n\n<p>I instead need the quotes to persist without escaping: <code>\"tags\":[\"prod\",\"stats\"]</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 2, "creation_date": 1524062122, "post_id": 49902437, "comment_id": 86820323, "body": "&quot;Why is that not var MyFloat float64&quot; Because its a type, not a variable."}, {"owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "edited": false, "score": 0, "creation_date": 1524063435, "post_id": 49902437, "comment_id": 86821369, "body": "In this particular case, they made the MyFloat type so that they could then write a method against it.  so it can be called myfloat.Abs(), instead of writing a basic function like Abs(myfloat) or Abs(float)."}], "owner": {"reputation": 29, "user_id": 7691068, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001961640120/picture?type=large", "display_name": "Boygee", "link": "https://stackoverflow.com/users/7691068/boygee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 238, "favorite_count": 0, "closed_date": 1524062115, "answer_count": 0, "score": 1, "last_activity_date": 1524062025, "creation_date": 1524062025, "question_id": 49902437, "link": "https://stackoverflow.com/questions/49902437/why-use-non-struct-types-in-golang", "closed_reason": "Duplicate", "title": "Why use non-struct types in Golang?", "body": "<p>I have been learning Golang for quite some time. I came across <code>type MyFloat float64</code>. Why is that not <code>var MyFloat float64</code> or<br>\n<code>type MyFloat struct{param float64}</code>? What is the purpose of having something like that?</p>\n\n<p>In case you were wondering where I got that from, it is from the Golang tour <a href=\"https://tour.golang.org/methods/9\" rel=\"nofollow noreferrer\">here</a> on line 27.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1524059674, "post_id": 49901532, "comment_id": 86818452, "body": "Check out <a href=\"https://mholt.github.io/curl-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/curl-to-go</a> (no affiliation, just something I&#39;ve found useful before)"}, {"owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1524059720, "post_id": 49901532, "comment_id": 86818486, "body": "@Adrian yes, but this not convert me the complet curl command"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1524059847, "post_id": 49901532, "comment_id": 86818590, "body": "What is missing?"}, {"owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1524060138, "post_id": 49901532, "comment_id": 86818811, "body": "--data-binary @build.bat"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1524062371, "post_id": 49901532, "comment_id": 86820535, "body": "It&#39;s the same as <code>--data</code>. Go doesn&#39;t make a distinction between handling of binary and ASCII."}], "answers": [{"comments": [{"owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "edited": false, "score": 0, "creation_date": 1524062164, "post_id": 49902150, "comment_id": 86820365, "body": "Thank you so much @Peter"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 2, "last_activity_date": 1524061234, "creation_date": 1524061234, "answer_id": 49902150, "question_id": 49901532, "link": "https://stackoverflow.com/questions/49901532/convert-curl-command-to-golang-function/49902150#49902150", "title": "convert curl command to golang function", "body": "<p><code>--data-binary @build.bat</code> says \"Use the contents of the file named build.bat as the request body\". Since any io.Reader works as an HTTP body in Go, and *os.File implements io.Reader that's easy enough:</p>\n\n<pre><code>f, err := os.Open(\"build.bat\")\ndefer f.Close()\nreq, err := http.NewRequest(\"POST\", \"https://content.dropboxapi.com/2/files/upload\", f)\n</code></pre>\n\n<p>The Dropbox-Api-Arg header is already there. Presumably its content isn't static, so just replace it with the JSON encoding of your map:</p>\n\n<pre><code>jsonData := make(map[string]string)\njsonData[\"path\"] = \"/file_upload.txt\"\njsonData[\"mode\"] = \"add\"\njsonData[\"autorename\"] = true\njsonData[\"mute\"] = false\n\nb, err := json.Marshal(jsonData)\nreq.Header.Set(\"Dropbox-Api-Arg\", string(b))\n</code></pre>\n"}], "owner": {"reputation": 977, "user_id": 2752185, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dd5f32012130adff6fa78ed329229bc4?s=128&d=identicon&r=PG&f=1", "display_name": "kingcope", "link": "https://stackoverflow.com/users/2752185/kingcope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 842, "favorite_count": 1, "accepted_answer_id": 49902150, "answer_count": 1, "score": 1, "last_activity_date": 1524061234, "creation_date": 1524059608, "question_id": 49901532, "link": "https://stackoverflow.com/questions/49901532/convert-curl-command-to-golang-function", "title": "convert curl command to golang function", "body": "<p>I'am new in golang developing, i want to upload file to dropbox using golang, this is my curl command :</p>\n\n<pre><code>curl -X POST https://content.dropboxapi.com/2/files/upload --header \"Authorization: Bearer &lt;token&gt;\" --header \"Dropbox-API-Arg: {\\\"path\\\": \\\"/file_upload.txt\\\",\\\"mode\\\": \\\"add\\\",\\\"autorename\\\": true,\\\"mute\\\": false}\" --header \"Content-Type: application/octet-stream\" --data-binary @build.bat\n</code></pre>\n\n<p>this is my actual function :</p>\n\n<pre><code>func uploadFile(filename string, token string){\n\n    jsonData := make(map[string]string)\n    jsonData[\"path\"] = \"/file_upload.txt\"\n    jsonData[\"mode\"] = \"add\"\n    jsonData[\"autorename\"] = true\n    jsonData[\"mute\"] = false\n\n    req, err := http.NewRequest(\"POST\", \"https://content.dropboxapi.com/2/files/upload\", nil)\n    if err != nil {\n        // handle err\n    }\n    req.Header.Set(\"Authorization\", \"Bearer \"+token)\n    req.Header.Set(\"Dropbox-Api-Arg\", \"{\\\"path\\\": \\\"/file_upload.txt\\\",\\\"mode\\\": \\\"add\\\",\\\"autorename\\\": true,\\\"mute\\\": false}\")\n    req.Header.Set(\"Content-Type\", \"application/octet-stream\")\n\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        // handle err\n    }\n    defer resp.Body.Close()\n}\n</code></pre>\n\n<p>problem is i dont know how add --data-binary @build.bat in my go code, and how use my variable jsonData in Dropbox-Api-Arg set.</p>\n"}, {"tags": ["windows", "go", "ffmpeg"], "answers": [{"comments": [{"owner": {"reputation": 612, "user_id": 1551924, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/1d04ae409af850c5285e869aefb90ea9?s=128&d=identicon&r=PG&f=1", "display_name": "nevernew", "link": "https://stackoverflow.com/users/1551924/nevernew"}, "edited": false, "score": 0, "creation_date": 1524063671, "post_id": 49902929, "comment_id": 86821552, "body": "I&#39;m now getting these errors: src\\github.com\\giorgisio\\goav\\avcodec\\codecs.go:57:48: could not determine kind of name for C.AV_CODEC_ID_ADPCM_VIMA_DEPRECATED"}], "tags": [], "owner": {"reputation": 612, "user_id": 1551924, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/1d04ae409af850c5285e869aefb90ea9?s=128&d=identicon&r=PG&f=1", "display_name": "nevernew", "link": "https://stackoverflow.com/users/1551924/nevernew"}, "is_accepted": false, "score": 1, "last_activity_date": 1524063284, "creation_date": 1524063284, "answer_id": 49902929, "question_id": 49901330, "link": "https://stackoverflow.com/questions/49901330/how-do-you-set-up-golang-on-windows-with-the-header-files-for-goav/49902929#49902929", "title": "How do you set up golang on windows with the header files for goav", "body": "<p>The solution to my problem was to set the CGO_CFLAGS environment variable before building to tell the compiler where the include files are for ffmpeg:</p>\n\n<pre><code>@set CGO_CFLAGS=-IC:\\path\\to\\FFmpeg\\\n</code></pre>\n\n<p>... My project is still not building, but that error isn't showing up anymore</p>\n"}], "owner": {"reputation": 612, "user_id": 1551924, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/1d04ae409af850c5285e869aefb90ea9?s=128&d=identicon&r=PG&f=1", "display_name": "nevernew", "link": "https://stackoverflow.com/users/1551924/nevernew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 357, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524063284, "creation_date": 1524059024, "last_edit_date": 1524062693, "question_id": 49901330, "link": "https://stackoverflow.com/questions/49901330/how-do-you-set-up-golang-on-windows-with-the-header-files-for-goav", "title": "How do you set up golang on windows with the header files for goav", "body": "<p>I'm trying to compile goav on Windows and I've got quite far\nI've compiled the ffmpeg libraries in MSYS2 and linked the packages with:</p>\n\n<pre><code>set PKG_CONFIG_PATH=%~dp0FFmpeg\\libavformat;%~dp0FFmpeg\\libavcodec;%~dp0FFmpeg\\libavutil;%~dp0FFmpeg\\libswresample;\n</code></pre>\n\n<p>which has worked!</p>\n\n<p>However, here's the problem now:</p>\n\n<pre><code># github.com/giorgisio/goav/avcodec\nsource\\src\\github.com\\giorgisio\\goav\\avcodec\\avcodec.go:14:34: fatal error: libavformat/avformat.h: No such file or directory\n //#include &lt;libavformat/avformat.h&gt;\n</code></pre>\n\n<p>When compiling, Golang can't find the avformat.h (and I assume the other ffmpeg header files, but compilation terminated).</p>\n\n<p>How do I tell go where these files are? I've checked and they are in the folders described in the PKG_CONFIG_PATH, but I guess it's not looking for them there.</p>\n\n<p>Side note: I see that on linux-debian based systems I just have to do a <code>apt-get install libavformat-dev</code> but I want to compile on windows.</p>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1524059170, "post_id": 49901287, "comment_id": 86818075, "body": "How do you want to handle collisions (e.g. a tag named &quot;title&quot;)? Is performance a concern?"}, {"owner": {"reputation": 6375, "user_id": 84750, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jbFti.jpg?s=128&g=1", "display_name": "silverfighter", "link": "https://stackoverflow.com/users/84750/silverfighter"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1524059478, "post_id": 49901287, "comment_id": 86818297, "body": "perf is not a concern. It is just a small util. dublicate keys could be overriden"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1524061535, "post_id": 49901287, "comment_id": 86819875, "body": "Related / similar: <a href=\"https://stackoverflow.com/questions/42709680/adding-arbitrary-fields-to-json-output-of-an-unknown-struct/42715610#42715610\">Adding Arbitrary fields to json output of an unknown struct</a>"}], "answers": [{"comments": [{"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 1, "creation_date": 1524061702, "post_id": 49901854, "comment_id": 86820014, "body": "Be careful to remove the space between &quot;json: &quot; and &quot;body&quot; in the struct tag, because right now it is ignored, and the output json contains an uppercase &quot;Body&quot; key."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 0, "creation_date": 1524061923, "post_id": 49901854, "comment_id": 86820171, "body": "@SirDarius Yes, but it&#39;s actually copied from the question, and it&#39;s already  messed up in the question."}, {"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1524062055, "post_id": 49901854, "comment_id": 86820264, "body": "@icza indeed, but at least let&#39;s make sure the answer is perfectly correct :)"}, {"owner": {"reputation": 6375, "user_id": 84750, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jbFti.jpg?s=128&g=1", "display_name": "silverfighter", "link": "https://stackoverflow.com/users/84750/silverfighter"}, "edited": false, "score": 0, "creation_date": 1524062566, "post_id": 49901854, "comment_id": 86820687, "body": "thanks!, I also fixed the spacing around json:&quot;Body&quot; in the question"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1524063977, "last_edit_date": 1524063977, "creation_date": 1524060409, "answer_id": 49901854, "question_id": 49901287, "link": "https://stackoverflow.com/questions/49901287/embed-mapstringstring-in-go-json-marshaling-without-extra-json-property-inlin/49901854#49901854", "title": "Embed map[string]string in Go JSON marshaling without extra JSON property (inline)", "body": "<p>There is no native way to \"flatten\" fields, but you can do it manually with a series of Marshal/Unmarshal steps (error handling omitted for brevity):</p>\n\n<pre><code>type Post struct {\n    Title string            `yaml:\"title\" json:\"title\"`\n    Body  string            `yaml:\"body\" json:\"body\"`\n    Tags  map[string]string `yaml:\"tags\" json:\"-\"` // handled by Post.MarshalJSON\n}\n\nfunc (p Post) MarshalJSON() ([]byte, error) {\n    // Turn p into a map\n    type Post_ Post // prevent recursion\n    b, _ := json.Marshal(Post_(p))\n\n    var m map[string]json.RawMessage\n    _ = json.Unmarshal(b, &amp;m)\n\n    // Add tags to the map, possibly overriding struct fields\n    for k, v := range p.Tags {\n        // if overriding struct fields is not acceptable:\n        // if _, ok := m[k]; ok { continue }\n        b, _ = json.Marshal(v)\n        m[k] = b\n    }\n\n    return json.Marshal(m)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Xvu2VYeZFGh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Xvu2VYeZFGh</a></p>\n"}], "owner": {"reputation": 6375, "user_id": 84750, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/jbFti.jpg?s=128&g=1", "display_name": "silverfighter", "link": "https://stackoverflow.com/users/84750/silverfighter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1400, "favorite_count": 1, "accepted_answer_id": 49901854, "answer_count": 1, "score": 1, "last_activity_date": 1524063977, "creation_date": 1524058891, "last_edit_date": 1524063853, "question_id": 49901287, "link": "https://stackoverflow.com/questions/49901287/embed-mapstringstring-in-go-json-marshaling-without-extra-json-property-inlin", "title": "Embed map[string]string in Go JSON marshaling without extra JSON property (inline)", "body": "<p>Is there a way to embed a <code>map[string]string</code> inline?</p>\n\n<p>What I got is:</p>\n\n<pre><code>{\n    \"title\": \"hello world\",\n    \"body\": \"this is a hello world post\",\n    \"tags\": {\n        \"hello\": \"world\"\n    }\n}\n</code></pre>\n\n<p>What I mean with embed or inline would be an expected result like this:</p>\n\n<pre><code>    {\n    \"title\": \"hello world\",\n    \"body\": \"this is a hello world post\",\n    \"hello\": \"world\"\n}\n</code></pre>\n\n<p>This is my code... I load the information from a yaml file an want to return the JSON in the desired format from above:</p>\n\n<p>This is my yaml:</p>\n\n<pre><code>title: hello world\nbody: this is a hello world post\ntags:\n  hello: world\n</code></pre>\n\n<p>This is my Go code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\ntype Post struct {\n    Title string            `yaml:\"title\" json:\"title\"`\n    Body  string            `yaml:\"body\" json:\"body\"`\n    Tags  map[string]string `yaml:\"tags\" json:\",inline\"`\n}\n\nfunc main() {\n\n    yamlBytes, err := ioutil.ReadFile(\"config.yaml\")\n    if err != nil {\n        panic(err)\n    }\n\n    var post Post\n\n    yaml.Unmarshal(yamlBytes, &amp;post)\n\n    jsonBytes, err := json.Marshal(post)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(string(jsonBytes))\n\n}\n</code></pre>\n\n<p>This obviously does work:</p>\n\n<pre><code>Tags map[string]string `yaml:\"tags\" json:\",inline\"`\n</code></pre>\n\n<p>but I was hoping that something similar exists to embed the <code>tags</code> map without the JSON property <code>tags</code>.</p>\n"}, {"tags": ["go", "p2p", "ipfs"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 2, "creation_date": 1524059009, "post_id": 49901233, "comment_id": 86817981, "body": "I think the issues in the github project would be the better place for such questions. Members of the project get notified and can answer your questions much better."}, {"owner": {"reputation": 154, "user_id": 8913763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICicn.jpg?s=128&g=1", "display_name": "VadimFilin", "link": "https://stackoverflow.com/users/8913763/vadimfilin"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1524060394, "post_id": 49901233, "comment_id": 86819004, "body": "@mbuechmann thank you for your advice, but i&#39;ve seen here bunch of p2p networking specialists."}, {"owner": {"reputation": 2081, "user_id": 360186, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/016cdb9ef71ae41514284cf8bbe12576?s=128&d=identicon&r=PG", "display_name": "Victor Bjelkholm", "link": "https://stackoverflow.com/users/360186/victor-bjelkholm"}, "edited": false, "score": 1, "creation_date": 1524143098, "post_id": 49901233, "comment_id": 86859294, "body": "Please open a new thread in our forum instead <a href=\"https://discuss.ipfs.io/\" rel=\"nofollow noreferrer\">discuss.ipfs.io</a> We generally try to keep the issue tracker for development-specific discussions"}, {"owner": {"reputation": 154, "user_id": 8913763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICicn.jpg?s=128&g=1", "display_name": "VadimFilin", "link": "https://stackoverflow.com/users/8913763/vadimfilin"}, "edited": false, "score": 0, "creation_date": 1528484397, "post_id": 49901233, "comment_id": 88541194, "body": "The answer is here: <a href=\"https://discuss.ipfs.io/t/go-ipfs-p2p-experimental-feature/2797\" rel=\"nofollow noreferrer\">discuss.ipfs.io/t/go-ipfs-p2p-experimental-feature/2797</a>"}], "owner": {"reputation": 154, "user_id": 8913763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICicn.jpg?s=128&g=1", "display_name": "VadimFilin", "link": "https://stackoverflow.com/users/8913763/vadimfilin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 248, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1613799199, "creation_date": 1524058729, "question_id": 49901233, "link": "https://stackoverflow.com/questions/49901233/ipfs-p2p-experimental-feature", "title": "IPFS p2p experimental feature", "body": "<p>Can't understand basic usage of this feature:\n<a href=\"https://github.com/ipfs/go-ipfs/blob/master/docs/experimental-features.md#ipfs-p2p\" rel=\"nofollow noreferrer\">https://github.com/ipfs/go-ipfs/blob/master/docs/experimental-features.md#ipfs-p2p</a></p>\n\n<blockquote>\n  <p>Open a listener on one node (node A) ipfs p2p listener open > p2p-test /ip4/127.0.0.1/tcp/10101</p>\n</blockquote>\n\n<p>Ok. It's easy.</p>\n\n<blockquote>\n  <p>Where /ip4/127.0.0.1/tcp/10101 put address of application > you want to pass p2p connections to</p>\n</blockquote>\n\n<p>What application? Side app? What does it mean \"pass p2p connections to\"? Where? Usual host:port format?</p>\n\n<blockquote>\n  <p>On the other node, connect to the listener on node A ipfs > p2p stream dial $NODE_A_PEERID p2p-test /ip4/127.0.0.1/tcp/10102</p>\n</blockquote>\n\n<p>Why different port? How connect if node B dial makes similar listener as listener on node A?</p>\n\n<blockquote>\n  <p>Node B is now listening for a connection on TCP at > 127.0.0.1:10102, connect your application there to complete the connection</p>\n</blockquote>\n\n<p>What app? How connect? How this scheme is working and looking?</p>\n\n<p>Maybe somebody has a code example? Thank you all.</p>\n"}, {"tags": ["go", "subprocess", "pipe", "exec", "piping"], "answers": [{"tags": [], "owner": {"reputation": 609, "user_id": 5837426, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FtspY.jpg?s=128&g=1", "display_name": "Sumit Ghosh", "link": "https://stackoverflow.com/users/5837426/sumit-ghosh"}, "is_accepted": true, "score": 5, "last_activity_date": 1524058527, "creation_date": 1524058527, "answer_id": 49901167, "question_id": 49900996, "link": "https://stackoverflow.com/questions/49900996/pipe-string-into-stdin-of-command-in-golang/49901167#49901167", "title": "Pipe string into STDIN of command in Golang", "body": "<p>I figured out how to do it.</p>\n\n<pre><code>package main\n\nimport \"os/exec\"\nimport \"strings\"\n\nfunc main() {\n    cmd := exec.Command(\"kinit\", username)\n    cmd.Stdin = strings.NewReader(password)\n    err := cmd.Run()\n}\n</code></pre>\n\n<p>The <code>Stdin</code> attribute of the <code>Command</code> object is the <code>STDIN</code> pipe, we can set it to a <code>strings.NewReader</code> object containing the input string to achieve the same effect as of the Python snipped mentioned in the question.</p>\n"}], "owner": {"reputation": 609, "user_id": 5837426, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FtspY.jpg?s=128&g=1", "display_name": "Sumit Ghosh", "link": "https://stackoverflow.com/users/5837426/sumit-ghosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2165, "favorite_count": 0, "accepted_answer_id": 49901167, "answer_count": 1, "score": 3, "last_activity_date": 1524058567, "creation_date": 1524058103, "last_edit_date": 1524058567, "question_id": 49900996, "link": "https://stackoverflow.com/questions/49900996/pipe-string-into-stdin-of-command-in-golang", "title": "Pipe string into STDIN of command in Golang", "body": "<p>I want to replicate the following <code>subprocess.run</code> function call in Golang. What would be the correct way to do it? </p>\n\n<pre><code>subprocess.run(['kinit', username], input=password.encode())\n</code></pre>\n\n<p>So far, I've figured out how to use <code>exec.Command</code> to run external commands, but what's confusing me is passing strings as input to <code>STDIN</code> of that command. Python's <code>subprocess.run</code> has a handy <code>input</code> parameter that takes care of this, how can I achieve similar results in Golang?</p>\n"}, {"tags": ["go", "struct", "reflection", "interface", "slice"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1524058554, "creation_date": 1524058554, "answer_id": 49901175, "question_id": 49900970, "link": "https://stackoverflow.com/questions/49900970/interface-for-a-slice-of-arbitrary-structs-to-use-as-a-function-parameter-golan/49901175#49901175", "title": "Interface for a slice of arbitrary structs to use as a function parameter (golang)", "body": "<p>Use the <a href=\"https://godoc.org/refelect\" rel=\"nofollow noreferrer\">reflect</a> package to iterate over arbitrary slice types:</p>\n\n<pre><code>func printArrayAny(data interface{}) {\n    v := reflect.ValueOf(data)\n    for i := 0; i &lt; v.Len(); i++ {\n        fmt.Printf(\"printArrayAny row %d: %v\\n\", i, v.Index(i).Interface())\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6JmgE-vEpBC\" rel=\"nofollow noreferrer\">Playground Example</a>.</p>\n"}], "owner": {"reputation": 142, "user_id": 4496740, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JQzDF.png?s=128&g=1", "display_name": "stacker-baka", "link": "https://stackoverflow.com/users/4496740/stacker-baka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 49901175, "answer_count": 1, "score": 0, "last_activity_date": 1524063714, "creation_date": 1524058008, "last_edit_date": 1524063714, "question_id": 49900970, "link": "https://stackoverflow.com/questions/49900970/interface-for-a-slice-of-arbitrary-structs-to-use-as-a-function-parameter-golan", "title": "Interface for a slice of arbitrary structs to use as a function parameter (golang)", "body": "<p>I have two different types of structs in my app. </p>\n\n<p><em>I'll show it as a simplified example:</em></p>\n\n<pre><code>type typeA struct {\n    fieldA1 int\n    fieldA2 string\n}\n\ntype typeB struct {\n    fieldB1 float32\n    fieldB2 bool\n}\n</code></pre>\n\n<p>First I init slices of them, then I want to store them in DB. </p>\n\n<pre><code>a := []typeA{\n    {10, \"foo\"},\n    {20, \"boo\"},\n}\nb := []typeB{\n    {2.5, true},\n    {3.5, false},\n}\n</code></pre>\n\n<p>My first attempt was to iterate over first slice, then over second slice. It works just fine, but doesn't look <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\" rel=\"nofollow noreferrer\">DRY</a>. The code is clearly duplicated: </p>\n\n<pre><code>printBothArrays(a, b)\n\n// ...\n\nfunc printBothArrays(dataA []typeA, dataB []typeB) {\n    // Not DRY\n    for i, row := range dataA {\n        fmt.Printf(\"printBothArrays A row %d: %v\\n\", i, row)\n    }\n    for i, row := range dataB {\n        fmt.Printf(\"printBothArrays B row %d: %v\\n\", i, row)\n    }\n}\n</code></pre>\n\n<p>A wrong way to make it DRY is to split it into 2 functions:</p>\n\n<pre><code>printArrayA(a)\nprintArrayB(b)\n\n// ...\n\nfunc printArrayA(data []typeA) {\n    // Not DRY too, because the code is just split between 2 funcs\n    for i, row := range data {\n        fmt.Printf(\"printArrayA row %d: %v\\n\", i, row)\n    }\n}\n\nfunc printArrayB(data []typeB) {\n    // Not DRY too, because the code is just split between 2 funcs\n    for i, row := range data {\n        fmt.Printf(\"printArrayB row %d: %v\\n\", i, row)\n    }\n}\n</code></pre>\n\n<p>These two functions' signatures are different, but the code is just the same!</p>\n\n<p>I thought of an universal function which can take any []struct and just store it. As my store function can take any interface{}, I thought of this:</p>\n\n<pre><code>func printArrayAny(data [](interface{})) {\n    for i, row := range data {\n        fmt.Printf(\"printArrayAny row %d: %v\\n\", i, row)\n    }\n}\n</code></pre>\n\n<p>But I've tried different ways and I can't match any shared interface. I'm getting errors like:</p>\n\n<p><code>cannot use a (type []typeA) as type []interface {} in argument to printArrayAny</code></p>\n\n<p>I don't really want to make any heavy lifting like converting it to <code>[]map[string]interface</code>, or using <code>reflect</code>, as both slices are really big. </p>\n\n<p>Is there a way to modify <code>printArrayAny</code> so it can receive and iterate over any arbitrary <code>[]struct</code> ?</p>\n\n<p>Go playground link: <a href=\"https://play.golang.org/p/qHzcQNUtLIX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qHzcQNUtLIX</a></p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1524056282, "post_id": 49900333, "comment_id": 86816060, "body": "Why would you think it&#39;s not being started?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1524059792, "post_id": 49900333, "comment_id": 86818538, "body": "If <code>go somefunction()</code> happens, the goroutine is created. This is covered by the Go language/runtime tests, not something you need to test in your own applications. This is like testing that <code>1 + 1</code> results in <code>2</code>."}], "answers": [{"tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": false, "score": 6, "last_activity_date": 1524056432, "creation_date": 1524056432, "answer_id": 49900408, "question_id": 49900333, "link": "https://stackoverflow.com/questions/49900333/how-do-i-test-that-the-code-is-actually-starting-a-go-routine/49900408#49900408", "title": "How do I test that the code is actually starting a go routine?", "body": "<blockquote>\n  <p>how do I write a test case that tests whether a goroutine is being created</p>\n</blockquote>\n\n<p>This is never what you're looking for. Instead you should instrument your test to check that whatever the go routine is supposed to do actually happens.</p>\n"}], "owner": {"reputation": 11, "user_id": 9664412, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "warlord -x", "link": "https://stackoverflow.com/users/9664412/warlord-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1524056432, "creation_date": 1524056195, "question_id": 49900333, "link": "https://stackoverflow.com/questions/49900333/how-do-i-test-that-the-code-is-actually-starting-a-go-routine", "title": "How do I test that the code is actually starting a go routine?", "body": "<p>if I am creating a go routine in my code, how do I write a test case that tests whether a goroutine is being created.</p>\n"}, {"tags": ["go", "struct", "interface"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 2, "creation_date": 1524052855, "post_id": 49899113, "comment_id": 86813798, "body": "<a href=\"https://play.golang.org/p/tE8ao7eyS0e\" rel=\"nofollow noreferrer\">play.golang.org/p/tE8ao7eyS0e</a>"}, {"owner": {"reputation": 173, "user_id": 3641692, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0rbRy.png?s=128&g=1", "display_name": "zio", "link": "https://stackoverflow.com/users/3641692/zio"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1524053273, "post_id": 49899113, "comment_id": 86814062, "body": "@dm03514 thanks! I guess it has to work this way. I maybe misunderstood the way how interfaces are working"}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 2, "creation_date": 1524053366, "post_id": 49899113, "comment_id": 86814119, "body": "The whole pointer to an interface is really confusing, i&#39;m trying to think how to explain it but am not even familiar with what technically is going on under the hood. <a href=\"https://stackoverflow.com/questions/44370277/type-is-pointer-to-interface-not-interface-confusion\" title=\"type is pointer to interface not interface confusion\">stackoverflow.com/questions/44370277/&hellip;</a>  has a good explanation, and a couple of really good links"}], "answers": [{"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 4, "last_activity_date": 1524053224, "creation_date": 1524053224, "answer_id": 49899332, "question_id": 49899113, "link": "https://stackoverflow.com/questions/49899113/new-function-in-interface-type-not-working/49899332#49899332", "title": "New function in interface type not working", "body": "<p>For <code>Entity</code> to fulfill your interface it must comply strictly with the interface definition:</p>\n\n<p>Trying to print an entity using</p>\n\n<pre><code>func msg(m Message) {\n  fmt.Println(m.Get())\n}\n</code></pre>\n\n<p>shows:</p>\n\n<pre><code>func main() {\n    fmt.Println(\"Hello, playground\")\n    e := &amp;Entity{}\n    e2 := e.New()\n    msg(e2)\n}\nprog.go:28:5: cannot use e2 (type *Entity) as type Message in argument to msg:\n    *Entity does not implement Message (wrong type for New method)\n        have New() *Entity\n        want New() *Message\n</code></pre>\n\n<p>Updating <code>Entity.New()</code> to return a pointer to a <code>Message</code> interface now shows:</p>\n\n<pre><code>type Message interface {\n  New() *Message\n  Get() string\n}\n\ntype Entity struct {}\nfunc (e *Entity) New() *Message {\n  return e\n\nprog.go:14:3: cannot use e (type *Entity) as type *Message in return argument:\n    *Message is pointer to interface, not interface\nprog.go:28:5: cannot use e2 (type *Message) as type Message in argument to msg:\n    *Message is pointer to interface, not interface\n</code></pre>\n\n<p>More about this can be read:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/44370277/type-is-pointer-to-interface-not-interface-confusion\">&quot;&lt;type&gt; is pointer to interface, not interface&quot; confusion</a></p>\n\n<p>Now updating your methods to return an interface instead of a pointer to an interface yields:</p>\n\n<pre><code>type Message interface {\n  New() Message\n  Get() string\n}\n\ntype Entity struct {}\nfunc (e *Entity) New() Message {\n  return e\n}\nfunc (e Entity) Get() string {\n  return \"hi\"\n}\n\nfunc msg(m Message) {\n  fmt.Println(m.Get())\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    e := &amp;Entity{}\n    e2 := e.New()\n    msg(e2)\n}\n\nHello, playground\nhi\n</code></pre>\n"}], "owner": {"reputation": 173, "user_id": 3641692, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0rbRy.png?s=128&g=1", "display_name": "zio", "link": "https://stackoverflow.com/users/3641692/zio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 906, "favorite_count": 1, "accepted_answer_id": 49899332, "answer_count": 1, "score": -1, "last_activity_date": 1525049342, "creation_date": 1524052526, "last_edit_date": 1525049342, "question_id": 49899113, "link": "https://stackoverflow.com/questions/49899113/new-function-in-interface-type-not-working", "title": "New function in interface type not working", "body": "<p>If I have an interface type like:</p>\n\n<pre><code>type Message interface {\n  New() *Message\n  Get() string\n}\n</code></pre>\n\n<p>and a structure like this:</p>\n\n<pre><code>type Entity struct {}\nfunc (e *Entity) New() *Entity {\n  return e\n}\nfunc (e Entiy) Get() string {\n  return \"hi\"\n}\n</code></pre>\n\n<p>Entity will not be a Message type unless I remove the <code>New() *Message</code>.\nCan someone explain to me why that is not working and/or where my issue is?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "edited": false, "score": 0, "creation_date": 1524050626, "post_id": 49898475, "comment_id": 86812282, "body": "see the data i retrieved it is without <code>key</code>."}, {"owner": {"reputation": 75, "user_id": 7441872, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rv-wF8TSzaQ/AAAAAAAAAAI/AAAAAAAAABQ/6wOc0C5W9FA/photo.jpg?sz=128", "display_name": "Rangga Adhitya Prawira", "link": "https://stackoverflow.com/users/7441872/rangga-adhitya-prawira"}, "reply_to_user": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "edited": false, "score": 0, "creation_date": 1524051261, "post_id": 49898475, "comment_id": 86812718, "body": "yes you can. On golang, if you pass the data on struct type, it wont show the key on console. you should can get the value and try to log on console. If the data is in array, you can  map it too."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "edited": false, "score": 0, "creation_date": 1524051878, "post_id": 49898475, "comment_id": 86813173, "body": "@Puneet, Println does not show field names by default. <code>fmt.Println(data)</code> is the same as <code>fmt.Printf(&quot;%v\\n&quot;, data)</code>. <a href=\"https://golang.org/pkg/fmt/#hdr-Printing\" rel=\"nofollow noreferrer\">&quot;when printing structs, the plus flag (%+v) adds field names&quot;</a>."}, {"owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "edited": false, "score": 0, "creation_date": 1524052311, "post_id": 49898475, "comment_id": 86813460, "body": "@okay sir thank you to helping me for solving this problem."}], "tags": [], "owner": {"reputation": 75, "user_id": 7441872, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rv-wF8TSzaQ/AAAAAAAAAAI/AAAAAAAAABQ/6wOc0C5W9FA/photo.jpg?sz=128", "display_name": "Rangga Adhitya Prawira", "link": "https://stackoverflow.com/users/7441872/rangga-adhitya-prawira"}, "is_accepted": false, "score": 0, "last_activity_date": 1524050555, "creation_date": 1524050555, "answer_id": 49898475, "question_id": 49898052, "link": "https://stackoverflow.com/questions/49898052/how-to-match-all-user-name-with-password-in-golang/49898475#49898475", "title": "How to match all user_name with password in golang?", "body": "<p>You can give an <code>if</code> condition to check if the userid or email is empty or not on your <code>Matching</code> function like:</p>\n\n<pre><code>....\n\nif data.userid != \"\" {\n    data.username = data.userid\n} \n\ndata.password\n\n....\n</code></pre>\n\n<p>You can create new struct for the query and use it to create your <code>Matching</code> function.</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 2186219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae7741de7238b3446036b6ba197ee1c?s=128&d=identicon&r=PG", "display_name": "tolok", "link": "https://stackoverflow.com/users/2186219/tolok"}, "is_accepted": false, "score": 0, "last_activity_date": 1524050849, "creation_date": 1524050849, "answer_id": 49898571, "question_id": 49898052, "link": "https://stackoverflow.com/questions/49898052/how-to-match-all-user-name-with-password-in-golang/49898571#49898571", "title": "How to match all user_name with password in golang?", "body": "<pre><code>    for _, signup := range data {\n        if userId == signup.Id &amp;&amp; password == signup.Password {\n            println(\"Match!\")\n        }\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": false, "score": 0, "last_activity_date": 1524059773, "creation_date": 1524059773, "answer_id": 49901591, "question_id": 49898052, "link": "https://stackoverflow.com/questions/49898052/how-to-match-all-user-name-with-password-in-golang/49901591#49901591", "title": "How to match all user_name with password in golang?", "body": "<p>This is not answering your question directly, but is <strong>very</strong> important nonetheless. It seems that you are saving the passwords of your users in plain text in the database. This is very careless and you should add some encryption like bcrypt: <a href=\"https://godoc.org/golang.org/x/crypto/bcrypt\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/crypto/bcrypt</a></p>\n\n<p>When you have added some encryption, your matching would be quite different than all given answers. This depends on the used encryption package. But please ignore the other answers. They might work, but only for plain text passwords.</p>\n"}], "owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 491, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1524059773, "creation_date": 1524049245, "last_edit_date": 1524050003, "question_id": 49898052, "link": "https://stackoverflow.com/questions/49898052/how-to-match-all-user-name-with-password-in-golang", "title": "How to match all user_name with password in golang?", "body": "<p>Using a struct, I'm saving the data in the JSON form to collection like so:</p>\n\n<pre><code>type SignUp struct {\n Id           int      `json:\"_id\" bson:\"_id\"`\n UserName     string   `json:\"user_name\" bson:\"user_name\"`\n EmailId         string   `json:\"email_id\" bson:\"email_id\"`\n Password    string   `json:\"password\" bson:\"password\"`\n}\ntype SignUps []SignUp\n</code></pre>\n\n<p>And retrieved the data from the collection of mongodb using function</p>\n\n<pre><code>func Login(c *gin.Context) {\n response := ResponseControllerList{}\n conditions := bson.M{}\n data, err := GetAllUser(conditions)\n fmt.Println(data)\n fmt.Println(err)\n Matching(data)\n return\n}\n\nfunc GetAllUser(blogQuery interface{}) (result SignUps, err error) {\n mongoSession := config.ConnectDb()\n sessionCopy := mongoSession.Copy()\n defer sessionCopy.Close()\n getCollection := mongoSession.DB(\"sign\").C(\"signup\")\n err = getCollection.Find(blogQuery).Select(bson.M{}).All(&amp;result)\n if err != nil {\n    return result, err\n }\n return result, nil\n}\n</code></pre>\n\n<p>But the data retrieved without its keys like shown below:-</p>\n\n<pre><code>[{1 puneet puneet@gmail.com puneet} {2 Rohit abc@gmail.com puneet}]\n</code></pre>\n\n<p><strong>Issue</strong> is that I want to collect all the existing <code>EmailId</code> and <code>Password</code>\nand match them with <code>userid</code> and <code>password</code> entered by the user in fucntion given bellow:-</p>\n\n<pre><code>func Matching(data Signups){\n  userid=\"abc@gmail.com\"\n  password=\"puneet\"\n  //match?\n }\n</code></pre>\n\n<p>How can I match the <code>userid</code> and <code>password</code> with the <code>EmailId</code> and <code>Password</code> fields?</p>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1524045861, "post_id": 49896677, "comment_id": 86809009, "body": "JSON is a text format and as such has no number representation other than decimal strings. You may get shorter messages by using string fields and manually encoding numbers in a base larger than 10 (64, for instance). For the shortest possible messages, pick a binary encoding, not text."}, {"owner": {"reputation": 2303, "user_id": 109274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a59b0daee5e5570e07a9f976721017e7?s=128&d=identicon&r=PG", "display_name": "mikezter", "link": "https://stackoverflow.com/users/109274/mikezter"}, "edited": false, "score": 1, "creation_date": 1524048575, "post_id": 49896677, "comment_id": 86810877, "body": "if you dearly want to save bytes on the wire, have a look into protobuf library. you will not be able to talk to your mqtt directly, but need a decoder on the other end."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1524051582, "creation_date": 1524051582, "answer_id": 49898805, "question_id": 49896677, "link": "https://stackoverflow.com/questions/49896677/json-marshal-uint-or-int-as-integer/49898805#49898805", "title": "JSON Marshal uint or int as integer", "body": "<p>To re-interate my comment: JSON is a text format, and text format are not designed to produce small messages. In particular there is no representation for numbers other than decimal strings in JSON.</p>\n\n<p>Encoding numbers in a base larger than 10 will reduce the message size for large enough numbers.</p>\n\n<p>You can reduce the message size your \"ugly\" code produces by removing leading zero bytes and encoding with base64.RawStdEncoding (which omits the padding characters). Doing this pays of for numbers >= 1e6.</p>\n\n<p>If you put this all in a custom type it becomes much nicer to use:</p>\n\n<pre><code>package main\n\nimport (\n        \"bytes\"\n        \"encoding/base64\"\n        \"encoding/binary\"\n        \"encoding/json\"\n        \"fmt\"\n)\n\ntype IntB64 uint32\n\nfunc (n IntB64) MarshalJSON() ([]byte, error) {\n        b := make([]byte, 4)\n\n        binary.BigEndian.PutUint32(b, uint32(n))\n        b = bytes.TrimLeft(b, string(0))\n\n        // All characters in the base64 alphabet need not be escaped, so we don't\n        // have to call json.Marshal here.\n        l := base64.RawStdEncoding.EncodedLen(len(b)) + 2\n        j := make([]byte, l)\n\n        base64.RawStdEncoding.Encode(j[1:], b)\n        j[0], j[l-1] = '\"', '\"'\n\n        return j, nil\n}\n\nfunc main() {\n        enc(1)          // \"AQ\"\n        enc(1000)       // \"A+g\"\n        enc(1e6 - 1)    // \"D0I/\"\n        enc(1e6)        // \"D0JA\"\n        enc(1524036831) // \"Wtb03w\"\n}\n\nfunc enc(n int64) {\n        b, _ := json.Marshal(IntB64(n))\n        fmt.Printf(\"%10d %s\\n\", n, string(b))\n}\n</code></pre>\n\n<p>Updated playground: <a href=\"https://play.golang.org/p/7Z03VE9roqN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7Z03VE9roqN</a></p>\n"}], "owner": {"reputation": 389, "user_id": 4240602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xViB3UuIiOQ/AAAAAAAAAAI/AAAAAAAAARU/fC7541hHB6c/photo.jpg?sz=128", "display_name": "RataDP", "link": "https://stackoverflow.com/users/4240602/ratadp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 853, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1524051582, "creation_date": 1524045392, "last_edit_date": 1524047170, "question_id": 49896677, "link": "https://stackoverflow.com/questions/49896677/json-marshal-uint-or-int-as-integer", "title": "JSON Marshal uint or int as integer", "body": "<p>I'm looking for information about the json marshal with Go. I'll explain the situation first.</p>\n\n<p>I'm developing an app for a IoT device. The app sends a JSON inside a MQTT Packet to our broker. How the device is using a SIM for data connection I need to reduce to minimum the bytes of the packet.</p>\n\n<p>Right now, The JSON has this structure</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>{\n  \"d\": 1524036831\n  \"p\": \"important message\"\n}\n</code></pre>\n\n<p>The field <code>d</code> is a timestamp and <code>p</code> is the payload.</p>\n\n<p>When the app sends this JSON it has 40 bytes. But if <code>d</code> is 1000, pe, the JSON will be 34 bytes. So the marshal is converting the field <code>d</code> as uint32 to ASCII representation of the number and then sends the string.</p>\n\n<p>What I want is to send this field as a true int or uint. I want to say, <code>1524036831</code> is a <code>int32</code>, 4 bytes, the same as <code>1000</code>. So with this change I could reduce the packet size some bytes and the number is be able to grow to 32 bits.</p>\n\n<p>I read the docs for json.Marshal and I did not find anything about this.</p>\n\n<p>I found a \"solution\" but I guest it is not pretty but does the work. I want another opinions.</p>\n\n<p><strong>Ugly solution (for me)</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/binary\"\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype test struct {\n    Data    uint32 `json:\"d\"`\n    Payload string `json:\"p\"`\n}\ntype testB struct {\n    Data    []byte `json:\"d\"`\n    Payload string `json:\"p\"`\n}\n\nfunc main() {\n    fmt.Println(\"TEST with uin32\")\n    d := []test{test{Data: 5, Payload: \"Important Message\"}, test{Data: 10, Payload: \"Important Message\"}, test{Data: 1000, Payload: \"Important Message\"}, test{Data: 1524036831, Payload: \"Important Message\"}}\n    for _, i := range d {\n        j, _ := json.Marshal(i)\n        fmt.Println(string(j))\n        fmt.Println(\"All:\", len(j))\n        fmt.Println(\"-----------\")\n    }\n    fmt.Println(\"\\nTEST with []Byte\")\n    d1 := []testB{testB{Data: make([]byte, 4), Payload: \"Important Message\"}, testB{Data: make([]byte, 4), Payload: \"Important Message\"}, testB{Data: make([]byte, 4), Payload: \"Important Message\"}, testB{Data: make([]byte, 4), Payload: \"Important Message\"}}\n    binary.BigEndian.PutUint32(d1[0].Data, 5)\n    binary.BigEndian.PutUint32(d1[1].Data, 20)\n    binary.BigEndian.PutUint32(d1[2].Data, 1000)\n    binary.BigEndian.PutUint32(d1[3].Data, 1524036831)\n    for _, i := range d1 {\n        j, _ := json.Marshal(i)\n        fmt.Println(string(j))\n        fmt.Println(len(j))\n        fmt.Println(\"-----------\")\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/x5ksU-oTuWj\" rel=\"nofollow noreferrer\">Play</a></p>\n"}, {"tags": ["regex", "variables", "go", "dgraph"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1524042760, "post_id": 49895603, "comment_id": 86806634, "body": "Nothing about your sample code is valid. Try starting with code that compiles."}, {"owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1524488314, "post_id": 49895603, "comment_id": 86979518, "body": "That is part of a dgraph query made using the Go client. It compiles."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1524489428, "post_id": 49895603, "comment_id": 86980300, "body": "No, it does not compile. It&#39;s nothing like valid Go. <a href=\"https://play.golang.org/p/zIYxcejFufP\" rel=\"nofollow noreferrer\">See here</a>."}, {"owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1524649236, "post_id": 49895603, "comment_id": 87053816, "body": "Dgraph developers have fixed the issue. <a href=\"https://github.com/dgraph-io/dgraph/pull/2353\" rel=\"nofollow noreferrer\">github.com/dgraph-io/dgraph/pull/2353</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1524042800, "creation_date": 1524042800, "answer_id": 49895710, "question_id": 49895603, "link": "https://stackoverflow.com/questions/49895603/dgraph-regex-query-with-variables-when-using-dgraph-go-client-querywithvars/49895710#49895710", "title": "Dgraph regex query with variables when using Dgraph Go client QueryWithVars", "body": "<p>Not the way you're doing it. But you can build a dynamic regex pattern by joining strings the normal way:</p>\n\n<pre><code>re, err := regexp.Compile(\"\u02c6.*\" + regexp.QuoteMeta(searchTerm))\n</code></pre>\n"}], "owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1524053293, "creation_date": 1524042505, "last_edit_date": 1524053293, "question_id": 49895603, "link": "https://stackoverflow.com/questions/49895603/dgraph-regex-query-with-variables-when-using-dgraph-go-client-querywithvars", "title": "Dgraph regex query with variables when using Dgraph Go client QueryWithVars", "body": "<p>Is it possible to use variables with regex search when using the Dgraph go client?</p>\n\n<p>We could built the query with SprintF but that would be insecure.</p>\n\n<pre><code>q :=query Search($searchterm: string) {\n        subdomains(func: regexp(name, /^.*$searchterm/)) {\n        uid:uid\n        name:name\n    }\n}\n</code></pre>\n\n<p>The following query does not return any results, even tho they exist.</p>\n\n<pre><code>q := `query Search($searchterm: string) {\n        subdomains(func: regexp(name, /$searchterm/)) {\n            uid:uid\n            name:name\n        }\n    }`\n</code></pre>\n\n<p>Or this</p>\n\n<pre><code>q := `query Search($searchterm: string) {\n        subdomains(func: regexp(name, /.*$searchterm.*/)) {\n            uid:uid\n            name:name\n        }\n    }`\n</code></pre>\n\n<p>Then send the query to dgraph using: txn.QueryWithVars(ctx, q, variableMap)</p>\n\n<p>Edit: This is a bug.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1524042137, "post_id": 49895459, "comment_id": 86806208, "body": "What have you tried and what problems are you having? Please include your attempt in the question. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1524042173, "post_id": 49895459, "comment_id": 86806223, "body": "Please post the attempt you have tried to resolve your problem."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1524045627, "post_id": 49895459, "comment_id": 86808850, "body": "Just adapt <a href=\"https://golang.org/pkg/sort/#example_\" rel=\"nofollow noreferrer\">the sort package example</a> to work with maps instead of structs. This question is essentially &quot;How do I access the &#39;population&#39; field in my map?&quot;"}, {"owner": {"reputation": 317, "user_id": 2060735, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kJFRk.jpg?s=128&g=1", "display_name": "Ali Altun", "link": "https://stackoverflow.com/users/2060735/ali-altun"}, "edited": false, "score": 0, "creation_date": 1524047300, "post_id": 49895459, "comment_id": 86809979, "body": "Thanks Peter, Your recommendation made me solve it. The solution: <a href=\"https://play.golang.org/p/7AVfIt_Zihx\" rel=\"nofollow noreferrer\">play.golang.org/p/7AVfIt_Zihx</a>"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1524059467, "post_id": 49897376, "comment_id": 86818288, "body": "Link-only answers are not particularly helpful for future readers. I took the liberty of pasting it into the answer."}], "tags": [], "owner": {"reputation": 317, "user_id": 2060735, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kJFRk.jpg?s=128&g=1", "display_name": "Ali Altun", "link": "https://stackoverflow.com/users/2060735/ali-altun"}, "is_accepted": false, "score": 1, "last_activity_date": 1524059435, "last_edit_date": 1524059435, "creation_date": 1524047245, "answer_id": 49897376, "question_id": 49895459, "link": "https://stackoverflow.com/questions/49895459/sorting-slice-according-to-value-having-a-mapstringinterface-items/49897376#49897376", "title": "Sorting slice according to value having a map[string]interface items", "body": "<p>I solved the problem after getting tip from Peter in the comment.</p>\n\n<p>The solution: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype ByListOrder []map[string]interface{}\n\nfunc (a ByListOrder) Len() int           { return len(a) }\nfunc (a ByListOrder) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }\nfunc (a ByListOrder) Less(i, j int) bool { return a[i][\"listorder\"].(string) &lt; a[j][\"listorder\"].(string) }\n\n\nfunc main() {\n    fields := []map[string]interface{} {\n          {\"fieldname\": \"id\",         \"label\": \"Id No\",      \"listorder\": \"01\"},\n          {\"fieldname\": \"name\",       \"label\": \"City Name\",  \"listorder\": \"03\"},\n          {\"fieldname\": \"phonecode\",  \"label\": \"Phone Code\", \"listorder\": \"02\"},\n          {\"fieldname\": \"population\", \"label\": \"Population\", \"listorder\": \"04\"},\n    }      \n\n    fmt.Println(fields)\n    sort.Sort(ByListOrder(fields))\n    fmt.Println(fields)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/7AVfIt_Zihx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7AVfIt_Zihx</a></p>\n"}], "owner": {"reputation": 317, "user_id": 2060735, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kJFRk.jpg?s=128&g=1", "display_name": "Ali Altun", "link": "https://stackoverflow.com/users/2060735/ali-altun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1524059435, "creation_date": 1524042086, "last_edit_date": 1524047409, "question_id": 49895459, "link": "https://stackoverflow.com/questions/49895459/sorting-slice-according-to-value-having-a-mapstringinterface-items", "title": "Sorting slice according to value having a map[string]interface items", "body": "<p>After Edit</p>\n\n<p>The real situation is a little different from the sample data. </p>\n\n<p>I have a table having all the fields and properties related to user interface I use in the application. I need a simple slice ordered by listorder having only fields name list like this.</p>\n\n<pre><code>colons=[]string{'id', 'name', 'population', 'phonecode'}\n</code></pre>\n\n<p>But the data source is a slice consist of <code>map[string]interface{}</code> values getting from a sql query like this </p>\n\n<pre><code>select fieldname, \n       label, \n       listorder \n  from tablefields \n where tablename=\"city\"  \n order by fieldname\n\n\nfields := []map[string]interface{} {\n  {\"fieldname\": \"id\",         \"label\": \"Id No\",      \"listorder\": \"01\"},\n  {\"fieldname\": \"name\",  ,    \"label\": \"City Name\",  \"listorder\": \"03\"},\n  {\"fieldname\": \"phonecode\",  \"label\": \"Phone Code\", \"listorder\": \"02\"},\n  {\"fieldname\": \"population\", \"label\": \"Population\", \"listorder\": \"04\"},\n}\n</code></pre>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 1, "creation_date": 1524044535, "post_id": 49892819, "comment_id": 86807979, "body": "I see, you created an issue in kubernetes/client-go repo. It&#39;s better to include the link of the issue too in this description. <a href=\"https://github.com/kubernetes/client-go/issues/398\" rel=\"nofollow noreferrer\">github.com/kubernetes/client-go/issues/398</a>"}], "owner": {"reputation": 241, "user_id": 5710969, "user_type": "registered", "accept_rate": 10, "profile_image": "https://lh5.googleusercontent.com/-SGM8qPw43sk/AAAAAAAAAAI/AAAAAAAAAMQ/FlelWLxtIV4/photo.jpg?sz=128", "display_name": "Anumantha Raja", "link": "https://stackoverflow.com/users/5710969/anumantha-raja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 200, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1536934265, "creation_date": 1524033544, "last_edit_date": 1524046053, "question_id": 49892819, "link": "https://stackoverflow.com/questions/49892819/option-to-rollback-using-client-go", "title": "Option to rollback using client-go", "body": "<p>I would like to rollback the deployment to a particular revision(rollout history) using client-go(6.0.0) library of k8s. I created a deployment using workload API object <code>apps/v1beta2</code>. Seems in <code>apps/v1beta2</code> there is no <code>.spec.rollbackTo options</code>. Where can i find the options to rollback to particular revision using client-go(6.0.0) library. Github Issue <a href=\"https://github.com/kubernetes/client-go/issues/398\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go/issues/398</a>.</p>\n"}, {"tags": ["go", "proxy"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1524034480, "post_id": 49892499, "comment_id": 86801614, "body": "You may be interested in <a href=\"https://github.com/elazarl/goproxy\" rel=\"nofollow noreferrer\">elazarl/goproxy</a> (if only for inspiration), and <a href=\"https://godoc.org/golang.org/x/sync/singleflight\" rel=\"nofollow noreferrer\">golang.org/x/sync/singleflight</a> for dealing with concurrent requests to the same object."}], "answers": [{"comments": [{"owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "edited": false, "score": 0, "creation_date": 1524034731, "post_id": 49893069, "comment_id": 86801734, "body": "Umm sorry.  I just noticed I posted the wrong code.   Will update with the right code tomorrow.   This one actually works in that it does the connect stuff but I&#39;m wanting to do the request on behalf of my s3 client and potentially just respond from cache."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1524034418, "creation_date": 1524034418, "answer_id": 49893069, "question_id": 49892499, "link": "https://stackoverflow.com/questions/49892499/http-to-https-proxy-in-go/49893069#49893069", "title": "http to https proxy in go", "body": "<p>You are sending the 200 OK response too early; send it after the error checking.</p>\n\n<p><a href=\"https://tools.ietf.org/html/rfc7231#section-4.3.6\" rel=\"nofollow noreferrer\">https://tools.ietf.org/html/rfc7231#section-4.3.6</a> (emphasize mine):</p>\n\n<blockquote>\n  <p>CONNECT is intended only for use in requests to a proxy.  An origin\n  server that receives a CONNECT request for itself MAY respond with a\n  2xx (Successful) status code <em>to indicate that a connection is\n  established</em>.</p>\n</blockquote>\n\n<pre><code>func handleTunneling(w http.ResponseWriter, r *http.Request) {\n    dest_conn, err := net.DialTimeout(\"tcp\", r.Host, 10*time.Second)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusServiceUnavailable)\n        return\n    }\n\n    // too early: w.WriteHeader(http.StatusOK)\n\n    hijacker, ok := w.(http.Hijacker)\n    if !ok {\n        http.Error(w, \"Hijacking not supported\", http.StatusInternalServerError)\n        return\n    }\n    client_conn, _, err := hijacker.Hijack()\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusServiceUnavailable)\n        return // missing in your sample code\n    }\n\n    w.WriteHeader(http.StatusOK) // respond 2xx here\n    go transfer(dest_conn, client_conn)\n    go transfer(client_conn, dest_conn)\n}\n</code></pre>\n"}], "owner": {"reputation": 30596, "user_id": 134702, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7c1594304f3515b88e31bc8888f0f593?s=128&d=identicon&r=PG", "display_name": "Matt Hook", "link": "https://stackoverflow.com/users/134702/matt-hook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1380, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524034418, "creation_date": 1524032401, "question_id": 49892499, "link": "https://stackoverflow.com/questions/49892499/http-to-https-proxy-in-go", "title": "http to https proxy in go", "body": "<p>I've started working on a cache to put into our data center for S3 objects that get frequently pulled from various S3 servers.  Some of them are in the GB size and many servers are requesting the same objects.  So to improve performance, this cache is needed.</p>\n\n<p>However, unlike other S3 caches I've seen, I don't need the s3 authentication part.  It's already included in the headers of the requests from my client.</p>\n\n<p>So the plan is to parse the request, check if the object exists completely locally, or is currently being fetched.  And when complete, return the result.\nObjects are conveniently hashed.  So if it's contents changes it's a new hash and a new object.</p>\n\n<p>The requests already contain everything needed to authenticate with S3.  But where I'm slightly stuck is I'm not familiar with HTTP's proxy Connect protocol.  I modified some example beginning code I found to not use Hijack so I could interpret what is going on and make decisions on whether I need to in fact get the upstream object.  But it's not working.  The client spits out:</p>\n\n<p>Get <a href=\"https://example.com\" rel=\"nofollow noreferrer\">https://example.com</a>: tls: first record does not look like a TLS handshake</p>\n\n<p>hmmm.</p>\n\n<p>Here is the proxy listening on HTTP (it'll be behind a firewall so I have made it deliberately insecure for simplicity).  </p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"io\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc handleTunneling(w http.ResponseWriter, r *http.Request) {\n    dest_conn, err := net.DialTimeout(\"tcp\", r.Host, 10*time.Second)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusServiceUnavailable)\n        return\n    }\n    w.WriteHeader(http.StatusOK)\n    hijacker, ok := w.(http.Hijacker)\n    if !ok {\n        http.Error(w, \"Hijacking not supported\", http.StatusInternalServerError)\n        return\n    }\n    client_conn, _, err := hijacker.Hijack()\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusServiceUnavailable)\n    }\n    go transfer(dest_conn, client_conn)\n    go transfer(client_conn, dest_conn)\n}\n\nfunc transfer(destination io.WriteCloser, source io.ReadCloser) {\n    defer destination.Close()\n    defer source.Close()\n    io.Copy(destination, source)\n}\n\nfunc handleHTTP(w http.ResponseWriter, req *http.Request) {\n    resp, err := http.DefaultTransport.RoundTrip(req)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusServiceUnavailable)\n        return\n    }\n    defer resp.Body.Close()\n\n    log.Println(req.RemoteAddr, \" \", resp.Status)\n\n    copyHeader(w.Header(), resp.Header)\n    w.WriteHeader(resp.StatusCode)\n    io.Copy(w, resp.Body)\n}\n\nfunc copyHeader(dst, src http.Header) {\n    for k, vv := range src {\n        for _, v := range vv {\n            dst.Add(k, v)\n        }\n    }\n}\n\nfunc main() {\n    server := &amp;http.Server{\n        Addr: \":8080\",\n        Handler: http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            if r.Method == http.MethodConnect {\n                handleTunneling(w, r)\n            } else {\n                handleHTTP(w, r)\n            }\n        }),\n        // Disable HTTP/2.\n        TLSNextProto: make(map[string]func(*http.Server, *tls.Conn, http.Handler)),\n    }\n\n    log.Fatal(server.ListenAndServe())\n}\n</code></pre>\n\n<p>The client looks like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"net/url\"\n)\n\nfunc main() {  \n    args := os.Args[1:]\n    var whereTo string\n    if len(args) &gt; 0 {\n        whereTo = args[0]\n    } else {\n        fmt.Println(\"Usage: htclient [url]\")\n        os.Exit(1)\n    }\n\n    proxyUrl, err := url.Parse(\"http://localhost:8080\")\n    client := &amp;http.Client{Transport: &amp;http.Transport{Proxy: http.ProxyURL(proxyUrl)}}\n\n    req, err := http.NewRequest(\"GET\", whereTo, nil)\n\n    response, err := client.Do(req)\n    if err != nil {\n        fmt.Printf(\"%s\", err)\n        os.Exit(1)\n    } else {\n        defer response.Body.Close()\n        contents, err := ioutil.ReadAll(response.Body)\n        if err != nil {\n            fmt.Printf(\"%s\", err)\n            os.Exit(1)\n        }\n        fmt.Printf(\"%s\\n\", string(contents))\n    }\n}\n</code></pre>\n\n<p>Suggestions?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1169, "user_id": 879889, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/wLsC6.png?s=128&g=1", "display_name": "iamtoc", "link": "https://stackoverflow.com/users/879889/iamtoc"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 1, "creation_date": 1524050543, "post_id": 49890201, "comment_id": 86812232, "body": "commented out v.Vars but still no output. Will continue to research. I also added a link to the github code for the project."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 1, "creation_date": 1524058116, "post_id": 49890201, "comment_id": 86817354, "body": "there is something wrong with your copy of blueprint, I checked the original repo and it worked as expected, but your copy from github is broken. just this line in the import isn&#39;t correct<code>&quot;github.com&#47;blue-jay&#47;blueprint&#47;model&#47;category&quot;</code> and I stopped checking for more errors after that"}], "answers": [{"comments": [{"owner": {"reputation": 1169, "user_id": 879889, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/wLsC6.png?s=128&g=1", "display_name": "iamtoc", "link": "https://stackoverflow.com/users/879889/iamtoc"}, "edited": false, "score": 0, "creation_date": 1524184022, "post_id": 49901978, "comment_id": 86879939, "body": "vitr was correct, my initial project setup was faulty. I reset up the project from scratch again and it all worked as expected. ps <a href=\"https://github.com/iamtoc/blueprint-ledger\" rel=\"nofollow noreferrer\">github.com/iamtoc/blueprint-ledger</a> is now obsolete but will update it soon. Thanks vitr!"}], "tags": [], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "is_accepted": false, "score": 1, "last_activity_date": 1524060767, "creation_date": 1524060767, "answer_id": 49901978, "question_id": 49890201, "link": "https://stackoverflow.com/questions/49890201/go-blue-jay-blueprint-how-to-assign-variable-in-controller-and-use-it-in-html-t/49901978#49901978", "title": "Go blue-jay/blueprint, how to assign variable in controller and use it in html/template view?", "body": "<p>I've checked out your github repository and found lots of broken imports like</p>\n\n<pre><code>\"github.com/blue-jay/blueprint/model/category\"\n</code></pre>\n\n<p>after replacing <code>blue-jay/blueprint</code> with your repo path <code>iamtoc/blueprint-ledger</code> I was able to run your original code</p>\n\n<pre><code>v.Vars[\"test\"] = \"Testing\"  &lt;--- VARIABLE IN QUESTION\n\n   form.Repopulate(\n     r.Form,\n     v.Vars,\n     \"parent_id\",\n...\n</code></pre>\n\n<p>without any issues and could see the test template variable printed out.\nI suspect, you just copied the original blue-jay/blueprint project incorrectly, as, I also tested this case with the original repo and again it worked as expected.</p>\n"}], "owner": {"reputation": 1169, "user_id": 879889, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/wLsC6.png?s=128&g=1", "display_name": "iamtoc", "link": "https://stackoverflow.com/users/879889/iamtoc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1524060767, "creation_date": 1524018363, "last_edit_date": 1524052087, "question_id": 49890201, "link": "https://stackoverflow.com/questions/49890201/go-blue-jay-blueprint-how-to-assign-variable-in-controller-and-use-it-in-html-t", "title": "Go blue-jay/blueprint, how to assign variable in controller and use it in html/template view?", "body": "<p>blue-jay/blueprint is an MVC (<a href=\"https://blue-jay.github.io/views/\" rel=\"nofollow noreferrer\">https://blue-jay.github.io/views/</a>) fast start golang webapp, with CRUD against mysql and other out of the box features.</p>\n\n<p>Database fields from the 'struct' are not in question, those are loading and rendering fine. How to declare a variable that has nothing to do with the database fields or 'struct'.</p>\n\n<p><strong>controller/categories/category.go:</strong></p>\n\n<pre><code>// Package category provides a simple CRUD in a web page.\npackage category\n\nimport (\n   \"net/http\"\n\n   \"github.com/blue-jay/blueprint/lib/flight\"\n   \"github.com/blue-jay/blueprint/middleware/acl\"\n   \"github.com/blue-jay/blueprint/model/category\"\n   \"github.com/blue-jay/core/form\"\n   \"github.com/blue-jay/core/pagination\"\n   \"github.com/blue-jay/core/router\"\n)\n\nvar (\n  uri = \"/categories\"\n)\n\n// Load routes.\nfunc Load() {\n   c := router.Chain(acl.DisallowAnon)\n   router.Get(uri, Index, c...)\n   router.Get(uri+\"/create\", Create, c...)\n   router.Post(uri+\"/create\", Store, c...)    \n}\n\n// Create displays html page.    \nfunc Create(w http.ResponseWriter, r *http.Request) {\n   c := flight.Context(w, r)\n   v := c.View.New(\"categories/create\")  \n   v.Vars[\"test\"] = \"Testing\"  &lt;--- VARIABLE IN QUESTION\n\n   form.Repopulate(\n     r.Form,\n     v.Vars,\n     \"parent_id\",\n     \"title\",\n     \"icon\",\n     \"description\",\n     \"url\",\n     \"sort\",\n     \"status_id\",\n     \"guid_id\",\n     \"role_id\",\n     \"user_id\")\n     v.Render(w, r)\n}\n</code></pre>\n\n<p><strong>view/categories/create.tmpl</strong></p>\n\n<pre><code>{{define \"title\"}}New Category{{end}}\n{{define \"head\"}}{{end}}\n{{define \"content\"}}\n   &lt;div class=\"page-header\"&gt;&lt;h1&gt;{{template \"title\" .}}&lt;/h1&gt;&lt;/div&gt;   \n   {{ .test }}  &lt;--- VARIABLE IN QUESTION\n   {{template \"footer\" .}}\n{{end}}\n{{define \"foot\"}}{{end}}\n</code></pre>\n\n<p>I have eliminated most of the form and the model (model/category/category.go),  for the sake of brevity.</p>\n\n<p><em>All we are looking for here is how to create and fill a variable \"test\" from within the controller, and get it to display its value \"Testing\" in the template.</em> Currently, it outputs nothing.</p>\n\n<p>The thing that has me baffled is that i have declared a variable 'guid' and called it this way (seemingly) in another controller (\"controller/register/register.go\" in func Index and output in /view/register/index.tmpl as found at the github link below.) which seems to work fine. I can't locate what i am doing different here. Something i'm not understanding apparently. </p>\n\n<p>Rest of the code: <a href=\"https://github.com/iamtoc/blueprint-ledger\" rel=\"nofollow noreferrer\">https://github.com/iamtoc/blueprint-ledger</a></p>\n\n<p>Only a few days into golang so still very new. Any idea as to how this is possible? Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1524024483, "post_id": 49889517, "comment_id": 86797643, "body": "You are using SwapPointer on an interface value. Interface values are not pointers."}, {"owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1524024677, "post_id": 49889517, "comment_id": 86797691, "body": "@CeriseLim&#243;n yes I try to use []*Element, it works. Thanks for your comment"}], "owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 519, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1524015394, "creation_date": 1524012930, "last_edit_date": 1524015394, "question_id": 49889517, "link": "https://stackoverflow.com/questions/49889517/golang-atomic-swappointer-not-working-by-interface", "title": "golang atomic SwapPointer() not working by interface", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync/atomic\"\n    \"unsafe\"\n    \"strconv\"\n)\n\ntype Element interface {\n    Check() bool\n    Clear()\n}\n\n\ntype S struct {\n    S string\n}\n\nfunc (s *S) Clear() {}\n\nfunc (s *S) Check() bool {\n    return true\n}\n\nfunc NewS() Element {\n    return &amp;S{\"hello\"}\n}\n\n\nfunc main() {\n    elemList := make([]Element, 10)\n    for i := 0; i &lt; 10; i++ {\n        elemList[i] = NewS()\n        }\n    elemPointer := (*unsafe.Pointer)(unsafe.Pointer(&amp;(elemList[0])))\n    elem := atomic.SwapPointer(elemPointer, nil)\n    fmt.Println(elemList)\n    fmt.Println(elem)\n\n    strList := make([]*string, 10)\n    for i := 0; i &lt; 10; i++ {\n        s := strconv.FormatInt(int64(i)+100, 10)\n        strList[i] = &amp;s\n        }\n    strPointer := (*unsafe.Pointer)(unsafe.Pointer(&amp;strList[0]))\n    strElem := atomic.SwapPointer(strPointer, nil)\n    fmt.Println(strList)\n    fmt.Println(strElem)\n    s := *(*string)(strElem)\n    fmt.Println(s)\n\n}\n</code></pre>\n\n<p>I want to implement a lock-free pool. When I use specific type slice, <code>atomic.SwapPointer()</code> work correctly, but when I use a interface slice, it does not.Why? Above code show the <code>elem</code> address is completely different from other address of element in <code>elemList</code>.</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-sdk", "amazon-sns"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1524018599, "post_id": 49889513, "comment_id": 86796279, "body": "What is the text of the message you are trying to send?"}, {"owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1524044859, "post_id": 49889513, "comment_id": 86808213, "body": "Hi Michael it&#39;s plain text without special characters: Obrigado por comprar no Xxxxxx. Segue o link para seu boleto bancario <a href=\"http://www.xxxxx.com/s/aA0sf\" rel=\"nofollow noreferrer\">xxxxx.com/s/aA0sf</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1524045669, "post_id": 49889513, "comment_id": 86808881, "body": "Hm. That&#39;s not the real text. Try pasting the real text into <a href=\"https://chadselph.github.io/smssplit/\" rel=\"nofollow noreferrer\">this tool</a> and it will tell you if there are characters that force UCS-2."}, {"owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1524053154, "post_id": 49889513, "comment_id": 86813993, "body": "Hi Michael o typed my text message (the real one) on the tool and the message is GSM and shouldn&#39;t be splited, but the amazon SNS uses UC2 always and splits my message on Go SKD."}], "owner": {"reputation": 429, "user_id": 1433721, "user_type": "registered", "accept_rate": 85, "profile_image": "https://lh5.googleusercontent.com/-lD6AeV9Tf58/AAAAAAAAAAI/AAAAAAAAAVs/0nRvIZ5-4NA/photo.jpg?sz=128", "display_name": "Andr&#233; G. Andrade", "link": "https://stackoverflow.com/users/1433721/andr%c3%a9-g-andrade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 681, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1524012827, "creation_date": 1524012827, "question_id": 49889513, "link": "https://stackoverflow.com/questions/49889513/send-long-sms-with-aws-sns-using-go-and-gsm-or-ascii-encoding", "title": "Send long SMS with AWS SNS using Go and GSM or ASCII encoding", "body": "<p>Hi I read on AWS SNS <a href=\"https://docs.aws.amazon.com/sns/latest/dg/sms_publish-to-phone.html\" rel=\"nofollow noreferrer\">documentation</a> that SMS messages sent using GSM-7 encoding can have 160 characters or 140 on ASCII or 70 on UC-2. The SNS will select the best encoding for the message. I'm using the following code to send SMS messages and it always selects the UC-2 encoding breaking my messages in two or more parts. There is a way to force SNS use ASCII or GSM encoding ?</p>\n\n<pre><code>svc := sns.New(newSession())\n\nif _, err = svc.Publish(&amp;sns.PublishInput{\n    Message:     aws.String(content),\n    PhoneNumber: aws.String(number),\n    MessageAttributes: map[string]*sns.MessageAttributeValue{\n        \"DefaultSMSType\": {\n             DataType: aws.String(\"String\"),\n             StringValue: aws.String(\"Transactional\")},\n        },\n}); err != nil {\n    log.Println(err.Error())\n    return\n}\n</code></pre>\n"}, {"tags": ["elasticsearch", "go", "go-gin"], "comments": [{"owner": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1524012162, "post_id": 49888870, "comment_id": 86794918, "body": "can you provide an example of what <code>string(result)</code> looks like with 1 and multiple results?"}, {"owner": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "reply_to_user": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1524068873, "post_id": 49888870, "comment_id": 86825128, "body": "It is what it should be, {&quot;CID&quot;:&quot;XXXXXXXXXX&quot;,&quot;Link&quot;:&quot;XXXXXXXXX&quot;,} etc"}], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "edited": false, "score": 0, "creation_date": 1524036797, "post_id": 49889573, "comment_id": 86802921, "body": "Just tried this and I get the same error, invalid character &#39;{&#39; after top-level value"}, {"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "reply_to_user": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "edited": false, "score": 0, "creation_date": 1524065253, "post_id": 49889573, "comment_id": 86822776, "body": "@Coder99 Did you try to run the example on the playground <a href=\"https://play.golang.org/p/D_bVAd4jBlI\" rel=\"nofollow noreferrer\">play.golang.org/p/D_bVAd4jBlI</a> ?"}, {"owner": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "edited": false, "score": 0, "creation_date": 1524066127, "post_id": 49889573, "comment_id": 86823365, "body": "I will do, sorry been busy all day, looking into it in more detail now. Thanks"}, {"owner": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "edited": false, "score": 0, "creation_date": 1524068290, "post_id": 49889573, "comment_id": 86824783, "body": "I am very new to go but dont see how this will help me, I have tried it with my data and still get the same error. I have updated the question"}, {"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "reply_to_user": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "edited": false, "score": 0, "creation_date": 1524079892, "post_id": 49889573, "comment_id": 86831110, "body": "@Coder99 Can you edit the example on the playground to provide a runnable code showing exactly how it is failing for you?"}], "tags": [], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "is_accepted": false, "score": 0, "last_activity_date": 1524013410, "creation_date": 1524013410, "answer_id": 49889573, "question_id": 49888870, "link": "https://stackoverflow.com/questions/49888870/golang-unmarshal-json-from-elastic-search-result/49889573#49889573", "title": "GoLang Unmarshal JSON From Elastic Search Result", "body": "<p>Try to unmarshal multiple results into a slice:</p>\n\n<pre><code>var q []Api\nerr = json.Unmarshal(result, &amp;q)\n</code></pre>\n\n<p>See on playground <a href=\"https://play.golang.org/p/D_bVAd4jBlI\" rel=\"nofollow noreferrer\">https://play.golang.org/p/D_bVAd4jBlI</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Api struct {\n    Total interface{}\n    Data  interface{}\n}\n\nfunc main() {\n\n    data := Api{\n        Total: 1,\n        Data:  \"2\",\n    }\n\n    result, err := json.Marshal(data)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"single data: %s\\n\", result)\n\n    var p Api\n    err = json.Unmarshal(result, &amp;p)\n    if err != nil {\n        panic(err)\n    }\n\n    dataSlice := []Api{data}\n\n    result, err = json.Marshal(dataSlice)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"slice of data: %s\\n\", result)\n\n    var q []Api\n    err = json.Unmarshal(result, &amp;q)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "edited": false, "score": 0, "creation_date": 1524068240, "post_id": 49892162, "comment_id": 86824745, "body": "Just give this ago and still get the same error,  invalid character &#39;{&#39; after top-level value"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "edited": false, "score": 0, "creation_date": 1524070175, "post_id": 49892162, "comment_id": 86825866, "body": "This suggests that you are trying to Unmarshal multiple concatenated JSON documents. Use a json.Decoder instead: <a href=\"https://play.golang.org/p/85WPi0NxYrT\" rel=\"nofollow noreferrer\">play.golang.org/p/85WPi0NxYrT</a>"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 0, "last_activity_date": 1524030899, "creation_date": 1524030899, "answer_id": 49892162, "question_id": 49888870, "link": "https://stackoverflow.com/questions/49888870/golang-unmarshal-json-from-elastic-search-result/49892162#49892162", "title": "GoLang Unmarshal JSON From Elastic Search Result", "body": "<p>Use <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\">json.RawMessage</a> to store arbitrary JSON documents:</p>\n\n<pre><code>var p json.RawMessage\n\nerr := json.Unmarshal(result, &amp;p)\nif err != nil {\n    panic(err)\n}\n\ntotalData := Api {\n    Total: myTotal,\n    Data: p,\n}\n\nc.JSON(http.StatusOK, totalData)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "is_accepted": false, "score": 0, "last_activity_date": 1524091191, "creation_date": 1524091191, "answer_id": 49910065, "question_id": 49888870, "link": "https://stackoverflow.com/questions/49888870/golang-unmarshal-json-from-elastic-search-result/49910065#49910065", "title": "GoLang Unmarshal JSON From Elastic Search Result", "body": "<p>I have a working solution to my problem, I just use the Hits Hits From the data returned by elastic search, I would like just the source data but i think it does what I need it to do... for now.</p>\n\n<p>Thanks.</p>\n"}], "owner": {"reputation": 59, "user_id": 9395733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/78a369b7ebaf486b65d834821e0f11c8?s=128&d=identicon&r=PG&f=1", "display_name": "Coder99", "link": "https://stackoverflow.com/users/9395733/coder99"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1563, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1524091191, "creation_date": 1524007187, "last_edit_date": 1524068498, "question_id": 49888870, "link": "https://stackoverflow.com/questions/49888870/golang-unmarshal-json-from-elastic-search-result", "title": "GoLang Unmarshal JSON From Elastic Search Result", "body": "<p>I have data returned from Elasticsearch, using \"github.com/olivere/elastic\". That sort of works, when i add it to my struct and string it, like so,</p>\n\n<pre><code>data := Api {\n    Total: myTotal,\n    Data: string(result),\n}\n\nc.JSON(http.StatusOK, totalData)\n</code></pre>\n\n<p>the api is a struct like so,</p>\n\n<pre><code>type Api struct {\n   Total interface{}\n   Data interface{} \n}\n</code></pre>\n\n<p>This returns data ok, from 1 to any number of results on request. How the results loaded into the data interface are not escaped or something, e.g.</p>\n\n<pre><code>\"Data\":\"{\\\"CID\\\":\\\"XXXXXXXXXX\\\",\\\"Link\\\":\\\"XXXXXXXXX\\\",\n</code></pre>\n\n<p>So I have tried to unmarshal the data before adding it to the api struct.</p>\n\n<pre><code>var p DataApi\n\nerr := json.Unmarshal(result, &amp;p)\nif err != nil {\n    panic(err)\n}\n\ntotalData := Api {\n    Total: myTotal,\n    Data: p,\n}\n\nc.JSON(http.StatusOK, totalData)\n</code></pre>\n\n<p>This sort of works fine, returns the data in the correct way, but only when loading one result. When 2 or more results are requested, I get this error from the unmarshal panic </p>\n\n<pre><code>invalid character '{' after top-level value\n</code></pre>\n\n<p>I have tried and google all over but can not find a solution to this? I am not sure what I am doing wrong? The DataApi is a nested set of structs, I was not sure if there was anything I should be being because of that?</p>\n\n<p>This is being run within the Gin framework.</p>\n\n<p>Thanks.</p>\n\n<p>EDIT</p>\n\n<p>So when I use <code>fmt.Println</code> on the string(result) I can print any number of results on the screen. How can I add this to the API struct and then I need the struct converted into JSON data. Is there some way of appending this string data on the JSON converted API struct? </p>\n"}, {"tags": ["go", "garbage-collection", "ipc", "cgo"], "comments": [{"owner": {"reputation": 236, "user_id": 2387736, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/J9dHK.jpg?s=128&g=1", "display_name": "Huarache", "link": "https://stackoverflow.com/users/2387736/huarache"}, "edited": false, "score": 1, "creation_date": 1524002432, "post_id": 49888041, "comment_id": 86792319, "body": "Just a quick Google yields this link: <a href=\"https://blog.golang.org/share-memory-by-communicating\" rel=\"nofollow noreferrer\">blog.golang.org/share-memory-by-communicating</a>.  Apparently, communicating via shared memory using a POSIX-style shared memory interface is something the Go designers thought was in poor form.  I&#39;m not saying what you&#39;re doing is a bad idea if you know what you are doing.  However, it&#39;s easy to get wrong."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1524002581, "post_id": 49888041, "comment_id": 86792365, "body": "RE the garbage collector, several things.  First, it <i>only</i> works on heap objects, stuff on the stack does get GC&#39;d because it vanishes when the stack frame does.  Second, the compiler chooses whether to put it on the heap or stack via escape analysis (not sure how this works with cgo pointers, though).  Third, the garbage collector won&#39;t do anything to memory as long as there&#39;s still a reference to it in the code.  Also, pretty sure it only works on <i>Go</i> types, so arbitrary cgo pointers are out of bounds.  It won&#39;t GC your struct in program B, as far as I know."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 236, "user_id": 2387736, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/J9dHK.jpg?s=128&g=1", "display_name": "Huarache", "link": "https://stackoverflow.com/users/2387736/huarache"}, "edited": false, "score": 3, "creation_date": 1524002654, "post_id": 49888041, "comment_id": 86792394, "body": "Also, as @RunFun points out, sharing memory is a no-no.  Go specifically makes it difficult, and also strongly discourages it, because it&#39;s where a HUGE amount of race conditions come from.  Far better to communicate between concurrent processes (or even concurrent programs) rather than share memory."}, {"owner": {"reputation": 341, "user_id": 529321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e974ce23b1f3016285b373fcba49c310?s=128&d=identicon&r=PG", "display_name": "skomp", "link": "https://stackoverflow.com/users/529321/skomp"}, "edited": false, "score": 1, "creation_date": 1524032046, "post_id": 49888041, "comment_id": 86800286, "body": "Although RunFun and Kaedys are right from the philosophical perspective, I still find this question interesting from a technical point of view. The answer might be hidden here somewhere <a href=\"https://groups.google.com/d/msg/golang-nuts/yNis7bQG_rY/yaJFoSx1hgIJ\" rel=\"nofollow noreferrer\">groups.google.com/d/msg/golang-nuts/yNis7bQG_rY/yaJFoSx1hgIJ</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1524052941, "post_id": 49888041, "comment_id": 86813856, "body": "First, read the documentaion: <a href=\"https://golang.org/cmd/cgo/#hdr-Passing_pointers\" rel=\"nofollow noreferrer\">Passing pointers</a>, <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Command cgo</a>. Now that you have read the documentation, what, specifically, don&#39;t you understand? The <code>ptr</code> value is not a Go pointer."}], "owner": {"reputation": 161, "user_id": 3813122, "user_type": "registered", "accept_rate": 10, "profile_image": "https://www.gravatar.com/avatar/aa0adcb3ccd6fddc6f52f50eed2e74e0?s=128&d=identicon&r=PG&f=1", "display_name": "Aroto", "link": "https://stackoverflow.com/users/3813122/aroto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 504, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1524002900, "creation_date": 1524001923, "last_edit_date": 1524002900, "question_id": 49888041, "link": "https://stackoverflow.com/questions/49888041/maintaining-go-pointers-to-shared-memory", "title": "Maintaining Go Pointers to Shared Memory", "body": "<p>From what research I have done there are no libraries out there to create and manage shared memory in Go. I thought it might be easy enough to pull of with some basic cgo code, and as it turns out it is. The concern that I would like to address before I move forward involves the interaction between the Go runtime and Go pointers to shared memory.</p>\n\n<p>To demonstrate my concern, I created a simple Go struct</p>\n\n<pre><code>type Test struct {\n    X int32\n    Y float64\n    Z [5]int32\n}\n</code></pre>\n\n<p>That I expose in two seperate Go programs, A and B along with some cgo code.</p>\n\n<pre><code>#include &lt;sys/ipc.h&gt;\n#include &lt;sys/shm.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\nint get_mem() {\n    key_t key = ftok(\"shared_mem\",65);\n    return shmget(key,1024,0666|IPC_CREAT);\n}\n\nchar * attach_mem(int id) {\n    return (char*) shmat(id,(void*)0,0);\n}\n\nvoid detach_mem(char * str) {\n    shmdt(str);\n}\n\nvoid destroy_mem(int id) {\n    shmctl(id,IPC_RMID,NULL);\n}\n\nvoid write(char * str, char * data, int len) {\n    memcpy(str, data, len);\n}\n</code></pre>\n\n<p>Program A then creates a <code>Test</code> struct, writes it to shared memory, creates a <code>*Test</code> pointer called <code>ptr</code> to that memory, waits 10 seconds, then prints the value at <code>ptr</code>.</p>\n\n<pre><code>// Program A\nfunc main() {\n    id := C.get_mem()\n    str := C.attach_mem(id)\n    dataLocal := Test{1, 2.0, [5]int32{3, 4, 5, 6, 7}}\n    C.write(str, (*C.char)(unsafe.Pointer(&amp;dataLocal)), C.int(unsafe.Sizeof(dataLocal)))\n    ptr := (*Test)(unsafe.Pointer(str))\n    time.Sleep(10 * time.Second)\n    fmt.Println(ptr)\n    C.detach_mem(str)\n    C.destroy_mem(id)\n}\n</code></pre>\n\n<p>In those 10 seconds, Program B starts, creates a <code>*Test</code> pointer to the shared memory, and modifies one of the fields.</p>\n\n<pre><code>// Program B\nfunc main() {\n    id := C.get_mem()\n    str := C.attach_mem(id)\n    data := (*Test)(unsafe.Pointer(str))\n    data.X = 10\n    C.detach_mem(str)\n}\n</code></pre>\n\n<p>Obviously this is not a practical IPC implementation, but it works. Program A prints </p>\n\n<pre><code>&amp;{10 2 [3 4 5 6 7]}\n</code></pre>\n\n<p>My concern is that the Go runtime, namely the garbage collector, won't play nice with this implementation. Specifically, how will Go treat <code>ptr</code> in Program A? I know that the Go GC will move data in the heap around, but does that apply to data referenced by Go pointers that lie outside of the heap? Now that a Go pointer references this data, will it be garbage collected?</p>\n\n<p>If neither of those issues apply, is this approach unsafe or otherwise considered to be bad style? If so what other alternatives are there?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 691, "user_id": 5562092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6794fb661ad63d244a9bb592352f6d93?s=128&d=identicon&r=PG&f=1", "display_name": "A H Bensiali", "link": "https://stackoverflow.com/users/5562092/a-h-bensiali"}, "edited": false, "score": 0, "creation_date": 1523994051, "post_id": 49884606, "comment_id": 86788536, "body": "can we have feedback on why this question is getting a negative rating?"}], "answers": [{"tags": [], "owner": {"reputation": 136, "user_id": 9660278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CDxvR.jpg?s=128&g=1", "display_name": "Brent Dimmig", "link": "https://stackoverflow.com/users/9660278/brent-dimmig"}, "is_accepted": true, "score": 7, "last_activity_date": 1523988690, "creation_date": 1523988690, "answer_id": 49884820, "question_id": 49884606, "link": "https://stackoverflow.com/questions/49884606/golang-json-decoding-returns-empty/49884820#49884820", "title": "Golang json decoding returns empty", "body": "<p>For the json package to properly decode from json in go, fields must be exported (capitalized) within the struct definition.</p>\n\n<p>Changing <code>Config</code> to:</p>\n\n<pre><code>type Config struct {\n    MongoConnectionString string `json:\"database\"`\n    Elastic struct{\n        Main string `json:\"main\"`\n        Log string `json:\"log\"`\n    } `json:\"elastic\"`\n    LogFilePath  string `json:\"logfile\"`\n}\n</code></pre>\n\n<p>will make all fields deserialize correctly.</p>\n"}], "owner": {"reputation": 21, "user_id": 9660189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29db1977d45ecb21b115817fb971d26f?s=128&d=identicon&r=PG&f=1", "display_name": "wolter", "link": "https://stackoverflow.com/users/9660189/wolter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1237, "favorite_count": 0, "closed_date": 1524034106, "accepted_answer_id": 49884820, "answer_count": 1, "score": -1, "last_activity_date": 1523988690, "creation_date": 1523987835, "question_id": 49884606, "link": "https://stackoverflow.com/questions/49884606/golang-json-decoding-returns-empty", "closed_reason": "Duplicate", "title": "Golang json decoding returns empty", "body": "<p>Can some one please explain to me why this code fail to decode json properly: </p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"os\"\n    \"log\"\n    \"encoding/json\"\n)\n\ntype Config struct {\n    mongoConnectionString string `json:\"database\"`\n    Elastic struct{\n        main string `json:\"main\"`\n        log string `json:\"log\"`\n    } `json:\"elastic\"`\n    logFilePath  string `json:\"logfile\"`\n}\n\n\nfunc main(){ \n    loadConfiguration(\"./config.json\")\n}\n\nfunc loadConfiguration(file string){\n    var configuration Config\n\n    configFile, err := os.Open(file); if err != nil {\n        log.Panic(\"Could not open\", file)\n    }\n    defer configFile.Close()\n\n    if err := json.NewDecoder(configFile).Decode(&amp;configuration); err != nil {\n            log.Panic(\"./config.json is currupted\")\n    }\n\n    fmt.Print(configuration.logFilePath)\n}\n</code></pre>\n\n<p>Json data:</p>\n\n<pre><code>{\n  \"database\": \"localhost\",\n  \"elastic\": {\n    \"main\": \"test\",\n    \"log\": \"test\"\n  },\n  \"logfile\": \"./logs/log.log\"\n}\n</code></pre>\n\n<p>The execution of this program will result in empty configuration.logFilePath</p>\n\n<p>What am i missing? </p>\n\n<p>Thanks</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523987640, "post_id": 49884503, "comment_id": 86785126, "body": "If you wants to hide some fields use <code>json:&quot;-&quot;</code> tags to ignore the values by creating an struct for all fields."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523992773, "post_id": 49884503, "comment_id": 86787865, "body": "@Himanshu that&#39;s totally unnecessary. You can just omit the fields entirely if you don&#39;t need them."}, {"owner": {"reputation": 12150, "user_id": 1143724, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/47fa5f1bc077c8158fe5ad1287105381?s=128&d=identicon&r=PG", "display_name": "MrDuk", "link": "https://stackoverflow.com/users/1143724/mrduk"}, "edited": false, "score": 0, "creation_date": 1523992947, "post_id": 49884503, "comment_id": 86787955, "body": "I&#39;m not entirely sure why the downvotes -- is my question not clear enough?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1524033098, "post_id": 49884503, "comment_id": 86800775, "body": "@Adrian you are right. I should consider that myself. Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 12150, "user_id": 1143724, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/47fa5f1bc077c8158fe5ad1287105381?s=128&d=identicon&r=PG", "display_name": "MrDuk", "link": "https://stackoverflow.com/users/1143724/mrduk"}, "edited": false, "score": 0, "creation_date": 1523988528, "post_id": 49884620, "comment_id": 86785607, "body": "Thanks a bunch, I really appreciate the thorough examples."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1523988319, "last_edit_date": 1523988319, "creation_date": 1523987914, "answer_id": 49884620, "question_id": 49884503, "link": "https://stackoverflow.com/questions/49884503/does-json-unmarshal-require-your-result-structure-to-match-exactly-the-json-pass/49884620#49884620", "title": "Does json.Unmarshal require your result structure to match exactly the JSON passed in?", "body": "<p>You can unmarshal into structs that represent only some fields of your JSON document, but the field types have to match, as the error clearly states:</p>\n\n<blockquote>\n  <p>cannot unmarshal number into Go struct field Result.id of type string</p>\n</blockquote>\n\n<p>You cannot unmarshal a number into a string. If you define the ID field as any numeric type it'll work just fine:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nvar j = []byte(`\n{\n  \"id\":1720,\n  \"prevState\":\"ok\",\n  \"time\":1523983581000,\n  \"text\":\"\",\n  \"regionId\":0\n}\n`)\n\ntype Result struct {\n    ID   int   `json:\"id\"` // or any other integer type, or float{32,64}, or json.Number\n    Time int64 `json:\"time\"`\n}\n\nfunc main() {\n    var r Result\n    err := json.Unmarshal(j, &amp;r)\n    fmt.Println(r, err)\n}\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/lqsQwLW2dHZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lqsQwLW2dHZ</a></p>\n\n<p><strong>Update</strong></p>\n\n<p>You have just edited your question with the actual error you receive. You have to unmarshal JSON arrays into slices. So if the HTTP response in fact returns a JSON array, unmarshal into []Result: </p>\n\n<pre><code>var j = []byte(`\n[\n    {\n      \"id\":1720,\n      \"prevState\":\"ok\",\n      \"time\":1523983581000,\n      \"text\":\"\",\n      \"regionId\":0\n    }\n]\n`)\n\nvar r []Result\nerr := json.Unmarshal(j, &amp;r)\nfmt.Println(r[0], err)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/EbOVA8CbcFO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/EbOVA8CbcFO</a></p>\n\n<p>To generate Go types that match your JSON document pretty well, use <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a>.</p>\n"}], "owner": {"reputation": 12150, "user_id": 1143724, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/47fa5f1bc077c8158fe5ad1287105381?s=128&d=identicon&r=PG", "display_name": "MrDuk", "link": "https://stackoverflow.com/users/1143724/mrduk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 858, "favorite_count": 1, "accepted_answer_id": 49884620, "answer_count": 1, "score": -3, "last_activity_date": 1523988319, "creation_date": 1523987446, "last_edit_date": 1523987939, "question_id": 49884503, "link": "https://stackoverflow.com/questions/49884503/does-json-unmarshal-require-your-result-structure-to-match-exactly-the-json-pass", "title": "Does json.Unmarshal require your result structure to match exactly the JSON passed in?", "body": "<p>I have a JSON string I want to unmarshal:</p>\n\n<pre><code>{\n  \"id\":1720,\n  \"alertId\":1,\n  \"alertName\":\"{stats} Test Lambda Alert\",\n  \"dashboardId\":5,\n  \"panelId\":2,\n  \"userId\":0,\n  \"newState\":\"alerting\",\n  \"prevState\":\"ok\",\n  \"time\":1523983581000,\n  \"text\":\"\",\n  \"regionId\":0,\n  \"tags\":[],\n  \"login\":\"\",\n  \"email\":\"\",\n  \"avatarUrl\":\"\",\n  \"data\":{\n    \"evalMatches\":[\n        {\n         \"metric\":\"{prod}{stats} Lambda Alert Test\",\n         \"tags\":null,\n         \"value\":16.525333333333332\n         }\n     ]\n   }\n}\n</code></pre>\n\n<p>I get the raw stream via a request: <code>bodyBytes, err := ioutil.ReadAll(resp.Body)</code></p>\n\n<p>I was hoping I could just specify a struct that pulls the values I care about, e.g.,</p>\n\n<pre><code>type Result struct {\n    ID string `json:\"id\"`\n    Time int64 `json:\"time\"`\n}\n</code></pre>\n\n<p>However, when I try this, I get errors.</p>\n\n<pre><code>type Result struct {\n    ID   string `json:\"id\"`\n    Time string `json:\"time\"`\n}\n\nvar result Result\nerr2 := json.Unmarshal(bodyBytes, &amp;result)\nif err2 != nil {\n    log.Fatal(fmt.Sprintf(`Error Unmarshalling: %s`, err2))\n}\nfmt.Println(result.ID)\n</code></pre>\n\n<blockquote>\n  <p>Error Unmarshalling: json: cannot unmarshal array into Go value of type main.Result</p>\n</blockquote>\n\n<p>I suspect this error may be due to what's actually returned from <code>ioutil.ReadAll()</code>, since it has the above JSON string wrapped in <code>[ ]</code> if I do a <code>fmt.Println(string(bodyBytes))</code>, but if I try to <code>json.Unmarshal(bodyBytes[0], &amp;result)</code>, I just get compile errors, so I'm not sure.</p>\n\n<p>If I want to unmarshal a JSON string, do I have to specify the full structure in my <code>type Result struct</code>? Is there a way around this? I don't want to be bound to the JSON object I receive (if the API changes upstream, it requires us to modify our code to recognize that, etc.).</p>\n"}, {"tags": ["go", "hyperledger-fabric", "hyperledger"], "comments": [{"owner": {"reputation": 124, "user_id": 9643375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b383e1b8e6064591f336ca29e3440f?s=128&d=identicon&r=PG&f=1", "display_name": "Faran", "link": "https://stackoverflow.com/users/9643375/faran"}, "edited": false, "score": 0, "creation_date": 1523974461, "post_id": 49880334, "comment_id": 86776616, "body": "Can you share the command you ran to install the chaincode?"}, {"owner": {"reputation": 31, "user_id": 9574638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c184435ebcf73f023739ff0e665fe2cb?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/9574638/johan"}, "reply_to_user": {"reputation": 124, "user_id": 9643375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b383e1b8e6064591f336ca29e3440f?s=128&d=identicon&r=PG&f=1", "display_name": "Faran", "link": "https://stackoverflow.com/users/9643375/faran"}, "edited": false, "score": 0, "creation_date": 1523974894, "post_id": 49880334, "comment_id": 86776950, "body": "<code>peer chaincode install chaincode&#47;go&#47;test_cc&#47;test_cc_signed_pack.out</code>  I am running it from <code>&#47;opt&#47;gopath&#47;src</code> (on the CLI)."}, {"owner": {"reputation": 124, "user_id": 9643375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b383e1b8e6064591f336ca29e3440f?s=128&d=identicon&r=PG&f=1", "display_name": "Faran", "link": "https://stackoverflow.com/users/9643375/faran"}, "edited": false, "score": 0, "creation_date": 1523977748, "post_id": 49880334, "comment_id": 86779138, "body": "Can you also share the command you used for packaging the chaincode?"}, {"owner": {"reputation": 31, "user_id": 9574638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c184435ebcf73f023739ff0e665fe2cb?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/9574638/johan"}, "reply_to_user": {"reputation": 124, "user_id": 9643375, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b383e1b8e6064591f336ca29e3440f?s=128&d=identicon&r=PG&f=1", "display_name": "Faran", "link": "https://stackoverflow.com/users/9643375/faran"}, "edited": false, "score": 0, "creation_date": 1523979114, "post_id": 49880334, "comment_id": 86780087, "body": "<code>peer chaincode package -n test_cc -p chaincode&#47;go&#47;test_cc -v 0.1 -s -S chaincode&#47;go&#47;test_cc&#47;test_cc_pack.out</code> Also running it from <code>&#47;opt&#47;gopath&#47;src</code> on the CLI. Sign: <code>peer chaincode signpackage chaincode&#47;go&#47;test_cc&#47;test_cc_pack.out chaincode&#47;go&#47;test_cc&#47;test_cc_signed_pack.out</code>"}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 9574638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c184435ebcf73f023739ff0e665fe2cb?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/9574638/johan"}, "is_accepted": false, "score": 3, "last_activity_date": 1524051792, "creation_date": 1524051792, "answer_id": 49898866, "question_id": 49880334, "link": "https://stackoverflow.com/questions/49880334/hyperledger-fabric-fails-to-instantiate-chaincode/49898866#49898866", "title": "Hyperledger-fabric fails to instantiate chaincode", "body": "<p>The issue was that in the Go source files I used 'package test_package', which, when building, does not create an executable file, but a linkable object file.</p>\n\n<p>Having 'package main' in my Go files, then rebuilding and repackaging, made the 'peer chaincode install' and 'peer chaincode instantiate' commands working as expected.</p>\n"}], "owner": {"reputation": 31, "user_id": 9574638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c184435ebcf73f023739ff0e665fe2cb?s=128&d=identicon&r=PG", "display_name": "Johan", "link": "https://stackoverflow.com/users/9574638/johan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1678, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1524051792, "creation_date": 1523974086, "last_edit_date": 1523986512, "question_id": 49880334, "link": "https://stackoverflow.com/questions/49880334/hyperledger-fabric-fails-to-instantiate-chaincode", "title": "Hyperledger-fabric fails to instantiate chaincode", "body": "<p>I am unable to instantiate chaincode in Hyperledge Fabric.</p>\n\n<p>When executing:</p>\n\n<pre><code>peer chaincode instantiate -o orderer -n test_cc -C test-channel -v 0.1 -c '{\"Args\":[\"initLedger\"]}'\n</code></pre>\n\n<p>I get the error:</p>\n\n<pre><code>peer0       | 2018-04-17 13:02:11.097 UTC [dockercontroller] Start -&gt; ERRO 046 start-could not start container: API error (400): {\"message\":\"OCI runtime create failed: container_linux.go:348: starting container process caused \\\"exec: \\\\\\\"chaincode\\\\\\\": executable file not found in $PATH\\\": unknown\"}\n</code></pre>\n\n<p>When searching the internet, the error message is the same as on the original post at [<a href=\"https://stackoverflow.com/questions/48852755/oci-runtimer-error-when-installing-hyperledger-chaincode-via-java-sdk]\">OCI Runtimer Error when installing Hyperledger Chaincode via Java-SDK</a> and [<a href=\"https://stackoverflow.com/questions/47593097/oci-runtime-error-when-sending-hyperledger-fabrics-chaincode-instantiation-requ]\">OCI runtime error when sending Hyperledger Fabric&#39;s chaincode instantiation request to peers</a>, but the comments on these posts did not led me to the solution.</p>\n\n<p>I am using the following software versions:\nHyperledger 1.1.0\nDocker version 18.03.0-ce (on Linux), Hyperledger Docker images: x86_64-1.1.0</p>\n\n<p>The following steps succeed:</p>\n\n<ul>\n<li>Building the chaincode. The code compiles without errors. I did not include any dependencies except the two required \"github.com/hyperledger/fabric/core/chaincode/shim\" and \n\"github.com/hyperledger/fabric/protos/peer\"</li>\n<li>Packaging the chaincode.</li>\n<li>Signing the chaincode.</li>\n<li>Installing the chaincode (it ends up in the peer's /var/hyperledger/production/chaincodes/test_cc.0.1.</li>\n</ul>\n\n<p>(Steps according to Hyperledger documentation: [<a href=\"http://hyperledger-fabric-docs.readthedocs.io/en/latest/chaincode4noah.html]\" rel=\"nofollow noreferrer\">http://hyperledger-fabric-docs.readthedocs.io/en/latest/chaincode4noah.html]</a>)</p>\n\n<p>In the CLI Docker container, files are located in the directory <code>/opt/gopath/src/chaincode/go/test_cc/</code>, where 4 files are present: <code>test_cc, test_cc.go, test_cc_pack.out, test_cc_signed_pack.out</code> (the binary, source file, packaged file and signed package file).</p>\n\n<p>The full output of the orderer and peer is:</p>\n\n<pre><code>orderer    | 2018-04-17 13:29:43.617 UTC [orderer/common/server] Broadcast -&gt; DEBU 167 Starting new Broadcast handler\norderer    | 2018-04-17 13:29:43.617 UTC [orderer/common/broadcast] Handle -&gt; DEBU 168 Starting new broadcast loop for 172.18.0.6:41228\ncouchdb    | [notice] 2018-04-17T13:29:43.624931Z nonode@nohost &lt;0.16042.3&gt; b5d38cd27d couchdb:5984 172.18.0.5 undefined GET /test-channel_lscc/test_cc?attachments=true 404 ok 2\npeer       | 2018-04-17 13:29:44.416 UTC [dockercontroller] Start -&gt; ERRO 04a start-could not start container: API error (400): {\"message\":\"OCI runtime create failed: container_linux.go:348: starting container process caused \\\"exec: \\\\\\\"chaincode\\\\\\\": executable file not found in $PATH\\\": unknown\"}\npeer       | 2018-04-17 13:29:44.647 UTC [chaincode] Launch -&gt; ERRO 04b launchAndWaitForRegister failed: API error (400): {\"message\":\"OCI runtime create failed: container_linux.go:348: starting container process caused \\\"exec: \\\\\\\"chaincode\\\\\\\": executable file not found in $PATH\\\": unknown\"}\npeer       | \npeer       | error starting container\npeer       | 2018-04-17 13:29:44.647 UTC [endorser] simulateProposal -&gt; ERRO 04c [test-channel][39e4414a] failed to invoke chaincode name:\"lscc\" , error: API error (400): {\"message\":\"OCI runtime create failed: container_linux.go:348: starting container process caused \\\"exec: \\\\\\\"chaincode\\\\\\\": executable file not found in $PATH\\\": unknown\"}\npeer       | \npeer       | error starting container\norderer    | 2018-04-17 13:29:44.648 UTC [orderer/common/broadcast] Handle -&gt; DEBU 169 Received EOF from 172.18.0.6:41228, hangup\norderer    | 2018-04-17 13:29:44.648 UTC [orderer/common/server] func1 -&gt; DEBU 16a Closing Broadcast stream\n</code></pre>\n\n<p>It looks like there is some path issue, but the process of the creation of the chaincode container and the variables which influence this process.</p>\n\n<p>I'm messing around with this issue for few days(!) now, tried all path combinations like placing the file in <code>/opt/gopath/bin</code>, etcetera, but to no avail.</p>\n\n<p>Someone who can shine a light on this issue? Or knows what the correct paths are and where they are, or where they should be defined?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "concurrency", "slice", "goroutine"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 7, "creation_date": 1523972061, "post_id": 49879322, "comment_id": 86774804, "body": "Note that you can do a quick check for such code by wrapping into a test and running it via <code>go test -race -run NameOfThatTestFunc .</code> \u2014 if it detects a data race, it panics."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 37, "last_activity_date": 1527682221, "last_edit_date": 1527682221, "creation_date": 1523971778, "answer_id": 49879469, "question_id": 49879322, "link": "https://stackoverflow.com/questions/49879322/can-i-concurrently-write-different-slice-elements/49879469#49879469", "title": "Can I concurrently write different slice elements", "body": "<p>The rule is simple: if multiple goroutines access a <a href=\"https://golang.org/ref/spec#Variables\" rel=\"noreferrer\">variable</a> concurrently, and at least one of the accesses is a write, then synchronization is required.</p>\n\n<p>Your example does not violate this rule. You don't write the slice <em>value</em> (the slice header), you only read it (implicitly, when you index it).</p>\n\n<p>You don't read the slice <em>elements</em>, you only modify the slice elements. And each goroutine only modifies a single, <em>different</em>, <em>designated</em> slice element. And since each slice element has its own address (own memory space), they are like distinct variables. This is covered in <a href=\"https://golang.org/ref/spec#Variables\" rel=\"noreferrer\">Spec: Variables:</a></p>\n\n<blockquote>\n  <p><em>Structured</em> variables of <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"noreferrer\">array</a>, <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"noreferrer\">slice</a>, and <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"noreferrer\">struct</a> types have elements and fields that may be <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"noreferrer\">addressed</a> individually. <strong>Each such element acts like a variable.</strong></p>\n</blockquote>\n\n<p>What must be kept in mind is that you can't read the results from the <code>results</code> slice without synchronization. And the waitgroup you used in your example is a sufficient synchronization. You are allowed to read the slice once <code>wg.Wait()</code> returns, because that can only happen after all worker goroutines called <code>wg.Done()</code>, and none of the worker goroutines modify the elements after they called <code>wg.Done()</code>.</p>\n\n<p>For example, this is a valid (<em>safe</em>) way to check / process the results:</p>\n\n<pre><code>wg.Wait()\n// Safe to read results after the above synchronization point:\nfmt.Println(results)\n</code></pre>\n\n<p>But if you would try to access the elements of <code>results</code> before <code>wg.Wait()</code>, that's a data race:</p>\n\n<pre><code>// This is data race! Goroutines might still run and modify elements of results!\nfmt.Println(results)\nwg.Wait()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1523971971, "post_id": 49879528, "comment_id": 86774742, "body": "Oh, OK, almost word-to-word to the @icza&#39;s answer; he beat me to that :-)"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 7, "last_activity_date": 1523971929, "creation_date": 1523971929, "answer_id": 49879528, "question_id": 49879322, "link": "https://stackoverflow.com/questions/49879322/can-i-concurrently-write-different-slice-elements/49879528#49879528", "title": "Can I concurrently write different slice elements", "body": "<p>Yes, it's perfectly legal: a slice has an array as its underlying data storage, and, being a compound type, an array is a sequence of \"elements\" which behave as individual variables with distinct memory locations; modifying them concurrently is fine.</p>\n\n<p>Just be sure to synchronize <em>the shutdown</em> of your worker goroutines with\nthe main one before it reads the updated contents of the slice.</p>\n\n<p>Using <code>sync.WaitGroup</code> for this\u2014as you do\u2014is perfectly fine.</p>\n\n<p>Also, as @icza said, you must not modify the slice value itself (which is a struct containing a pointer to the backing storage array, the capacity and the length).</p>\n"}, {"tags": [], "owner": {"reputation": 819, "user_id": 701268, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L1UoP.jpg?s=128&g=1", "display_name": "zouying", "link": "https://stackoverflow.com/users/701268/zouying"}, "is_accepted": false, "score": 0, "last_activity_date": 1611011073, "creation_date": 1611011073, "answer_id": 65783277, "question_id": 49879322, "link": "https://stackoverflow.com/questions/49879322/can-i-concurrently-write-different-slice-elements/65783277#65783277", "title": "Can I concurrently write different slice elements", "body": "<p><strong>YES, YOU CAN.</strong></p>\n<h3>tldr</h3>\n<p>In <a href=\"https://godoc.org/golang.org/x/sync/errgroup\" rel=\"nofollow noreferrer\">golang.org/x/sync/errgroup</a> example, it has the same example code in <a href=\"https://godoc.org/golang.org/x/sync/errgroup#example-Group--Parallel\" rel=\"nofollow noreferrer\">Example (Parallel)</a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>Google := func(ctx context.Context, query string) ([]Result, error) {\n    g, ctx := errgroup.WithContext(ctx)\n\n    searches := []Search{Web, Image, Video}\n    results := make([]Result, len(searches))\n    for i, search := range searches {\n        i, search := i, search\n\n        g.Go(func() error {\n            result, err := search(ctx, query)\n            if err == nil {\n                results[i] = result\n            }\n            return err\n        })\n    }\n    if err := g.Wait(); err != nil {\n        return nil, err\n    }\n    return results, nil\n}\n// ...\n</code></pre>\n"}], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5486, "favorite_count": 6, "accepted_answer_id": 49879469, "answer_count": 3, "score": 29, "last_activity_date": 1611011073, "creation_date": 1523971382, "last_edit_date": 1523972346, "question_id": 49879322, "link": "https://stackoverflow.com/questions/49879322/can-i-concurrently-write-different-slice-elements", "title": "Can I concurrently write different slice elements", "body": "<p>I have a slice that contains work to be done, and a slice that will contain the results when everything is done. The following is a sketch of my general process:</p>\n\n<pre><code>var results = make([]Result, len(jobs))\nwg := sync.WaitGroup{}\nfor i, job := range jobs {\n    wg.Add(1)\n    go func(i int, j job) {\n        defer wg.Done()\n        var r Result = doWork(j)\n        results[i] = r\n    }(i, job)\n}\nwg.Wait()\n// Use results\n</code></pre>\n\n<p>It seems to work, but I have not tested it thoroughly and am not sure if it is safe to do. Generally I would not feel good letting multiple goroutines write to <em>anything</em>, but in this case, each goroutine is limited to its own index in the slice, which is pre-allocated. </p>\n\n<p>I suppose the alternative is collecting results via a channel, but since order of results matters, this seemed rather simple. Is it safe to write into slice elements this way?</p>\n"}, {"tags": ["go", "grpc-gateway"], "answers": [{"comments": [{"owner": {"reputation": 3285, "user_id": 158523, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a4aacd0d89b2fd97bc09d2787786db12?s=128&d=identicon&r=PG", "display_name": "Umut Benzer", "link": "https://stackoverflow.com/users/158523/umut-benzer"}, "edited": false, "score": 0, "creation_date": 1524036353, "post_id": 49884259, "comment_id": 86802662, "body": "Hi, that&#39;s one option, however, my intention is to use this endpoint directly as a part of <code>&lt;img src=&quot;https:&#47;&#47;host&#47;endpoint&quot; &#47;&gt;</code> without processing on the frontend."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 3285, "user_id": 158523, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a4aacd0d89b2fd97bc09d2787786db12?s=128&d=identicon&r=PG", "display_name": "Umut Benzer", "link": "https://stackoverflow.com/users/158523/umut-benzer"}, "edited": false, "score": 0, "creation_date": 1524060114, "post_id": 49884259, "comment_id": 86818790, "body": "Then you are probably more limited. All I can think of is modifying the gateway with the feature you want."}, {"owner": {"reputation": 2347, "user_id": 1895600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ5Kg.png?s=128&g=1", "display_name": "mayankcpdixit", "link": "https://stackoverflow.com/users/1895600/mayankcpdixit"}, "edited": false, "score": 0, "creation_date": 1549517409, "post_id": 49884259, "comment_id": 95931849, "body": "@captncraig can this be not done on grpc server side before forwarding response?"}, {"owner": {"reputation": 2347, "user_id": 1895600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ5Kg.png?s=128&g=1", "display_name": "mayankcpdixit", "link": "https://stackoverflow.com/users/1895600/mayankcpdixit"}, "reply_to_user": {"reputation": 3285, "user_id": 158523, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a4aacd0d89b2fd97bc09d2787786db12?s=128&d=identicon&r=PG", "display_name": "Umut Benzer", "link": "https://stackoverflow.com/users/158523/umut-benzer"}, "edited": false, "score": 0, "creation_date": 1549517471, "post_id": 49884259, "comment_id": 95931871, "body": "@UmutBenzer What did you end up doing?"}, {"owner": {"reputation": 3285, "user_id": 158523, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a4aacd0d89b2fd97bc09d2787786db12?s=128&d=identicon&r=PG", "display_name": "Umut Benzer", "link": "https://stackoverflow.com/users/158523/umut-benzer"}, "edited": false, "score": 0, "creation_date": 1549538567, "post_id": 49884259, "comment_id": 95942051, "body": "I ended up implementing our logic on the client side. In one request I get the URL for the image and in the second request, we get the image itself by using the response of the first request.  This was implemented before I learned that such a thing <code>WithOutgoingHeaderMatcher</code> existed. I don&#39;t know if that would&#39;ve been worked for me or not."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 1, "last_activity_date": 1523986573, "creation_date": 1523986573, "answer_id": 49884259, "question_id": 49878855, "link": "https://stackoverflow.com/questions/49878855/how-to-do-a-302-redirect-in-grpc-gateway/49884259#49884259", "title": "How to do a 302 redirect in grpc-gateway", "body": "<p>Looking at the code you mentioned, it appears to be simply mapping the <a href=\"https://github.com/grpc/grpc/blob/master/doc/statuscodes.md\" rel=\"nofollow noreferrer\">grpc status codes</a> directly to their closest http equivalents. It doesn't appear that there are any codes in the spec that really map to an http redirect. Am I correct in assuming you are using the gateway to connect a browser to a grpc service?</p>\n\n<p>My suggestion would be to work redirects into the protocol somehow. What if the response to certain methods was something like:</p>\n\n<pre><code>message HelloResponse {\n  string reply = 1;\n  bool shouldRedirect = 2;\n  string redirectURL = 3;\n}\n</code></pre>\n\n<p>Then if the receiver could detect that from the response and redirect client-side. A little less magical, but still lets you do the redirect if needed.</p>\n"}, {"comments": [{"owner": {"reputation": 1214, "user_id": 2085007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a50ca1bb3d72544cb50171bd7b46105c?s=128&d=identicon&r=PG", "display_name": "Markus", "link": "https://stackoverflow.com/users/2085007/markus"}, "edited": false, "score": 1, "creation_date": 1530864150, "post_id": 50112470, "comment_id": 89392242, "body": "I am running into the same use-case but how can one extract <code>redirectURL</code> from the message? If I do <code>resp.redirectURL</code> the compiler tells me that proto.Message does not implement that. Do I have to do some casting first, or similar?"}, {"owner": {"reputation": 2347, "user_id": 1895600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VQ5Kg.png?s=128&g=1", "display_name": "mayankcpdixit", "link": "https://stackoverflow.com/users/1895600/mayankcpdixit"}, "reply_to_user": {"reputation": 1214, "user_id": 2085007, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a50ca1bb3d72544cb50171bd7b46105c?s=128&d=identicon&r=PG", "display_name": "Markus", "link": "https://stackoverflow.com/users/2085007/markus"}, "edited": false, "score": 0, "creation_date": 1549539030, "post_id": 50112470, "comment_id": 95942332, "body": "@Markus any solution to this?"}], "tags": [], "owner": {"reputation": 56, "user_id": 8532767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae3f34822b09a63e20380ff615058cc6?s=128&d=identicon&r=PG", "display_name": "Yugui Sonoda", "link": "https://stackoverflow.com/users/8532767/yugui-sonoda"}, "is_accepted": true, "score": 3, "last_activity_date": 1605757693, "last_edit_date": 1605757693, "creation_date": 1525157667, "answer_id": 50112470, "question_id": 49878855, "link": "https://stackoverflow.com/questions/49878855/how-to-do-a-302-redirect-in-grpc-gateway/50112470#50112470", "title": "How to do a 302 redirect in grpc-gateway", "body": "<p>There's no straightforward way. But there's a workaround.</p>\n<p>There's no conception in gRPC similar to 302. So simple error code mappings won't work fine.\nBut you can overwrite a response forwarder per method so that it extracts <code>redirectURL</code> from the response and sets the HTTP status code and <code>Location</code> header.</p>\n<p><a href=\"https://grpc-ecosystem.github.io/grpc-gateway/docs/mapping/customizingyourgateway/#mutate-response-messages-or-set-response-headers\" rel=\"nofollow noreferrer\">https://grpc-ecosystem.github.io/grpc-gateway/docs/mapping/customizingyourgateway/#mutate-response-messages-or-set-response-headers</a></p>\n"}, {"tags": [], "owner": {"reputation": 456, "user_id": 2272992, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/dmt6F.jpg?s=128&g=1", "display_name": "rezam", "link": "https://stackoverflow.com/users/2272992/rezam"}, "is_accepted": false, "score": 4, "last_activity_date": 1580101631, "creation_date": 1580101631, "answer_id": 59925385, "question_id": 49878855, "link": "https://stackoverflow.com/questions/49878855/how-to-do-a-302-redirect-in-grpc-gateway/59925385#59925385", "title": "How to do a 302 redirect in grpc-gateway", "body": "<p>you could also use <a href=\"https://grpc-ecosystem.github.io/grpc-gateway/docs/customizingyourgateway.html#mutate-response-messages-or-set-response-headers\" rel=\"nofollow noreferrer\">runtime. WithForwardResponseOption</a> method which allows you to modify your response and response headers.</p>\n\n<p>here is what I did to set <code>Location</code> header in response.</p>\n\n<ol>\n<li>Set <code>Location</code> header in your GRPC method using metadata. this adds <code>Grpc-Metadata-Location</code> header to your response.</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (s *Server) CreatePayment(ctx context.Context, in *proto.Request) (*proto.Response, error) {\n    header := metadata.Pairs(\"Location\", url)\n    grpc.SendHeader(ctx, header)\n\n    return &amp;proto.Response{}, nil\n}\n</code></pre>\n\n<ol start=\"2\">\n<li>If <code>Grpc-Metadata-Location</code> header exists in your GRPC response headers, Set HTTP <code>Location</code> header and status code as well.</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func responseHeaderMatcher(ctx context.Context, w http.ResponseWriter, resp proto.Message) error {\n    headers := w.Header()\n    if location, ok := headers[\"Grpc-Metadata-Location\"]; ok {\n        w.Header().Set(\"Location\", location[0])\n        w.WriteHeader(http.StatusFound)\n    }\n\n    return nil\n}\n</code></pre>\n\n<ol start=\"3\">\n<li>Set this func as an Option in <code>NewServeMux</code>:</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>grpcGatewayMux := runtime.NewServeMux(\n    runtime.WithForwardResponseOption(responseHeaderMatcher),\n)\n</code></pre>\n"}], "owner": {"reputation": 3285, "user_id": 158523, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/a4aacd0d89b2fd97bc09d2787786db12?s=128&d=identicon&r=PG", "display_name": "Umut Benzer", "link": "https://stackoverflow.com/users/158523/umut-benzer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3219, "favorite_count": 2, "accepted_answer_id": 50112470, "answer_count": 3, "score": 6, "last_activity_date": 1605757693, "creation_date": 1523970014, "question_id": 49878855, "link": "https://stackoverflow.com/questions/49878855/how-to-do-a-302-redirect-in-grpc-gateway", "title": "How to do a 302 redirect in grpc-gateway", "body": "<p>I use <a href=\"https://github.com/grpc-ecosystem/grpc-gateway\" rel=\"noreferrer\">grpc-gateway</a> to host an HTTP server out of my proto definitions. It works great overall. </p>\n\n<p>However, for one special endpoint, instead of returning a value back, I want to do a 302 redirect to an image hosted in an s3.</p>\n\n<p>If you want to return an error via grpc-gateway, you can return it like</p>\n\n<pre><code>nil, status.Error(codes.Unauthenticated, \"Nope\")\n</code></pre>\n\n<p>I wonder if there is something similar to do a 302 redirect?</p>\n\n<p>As far as I get from <a href=\"https://github.com/grpc-ecosystem/grpc-gateway/blob/master/runtime/errors.go#L15\" rel=\"noreferrer\">this page</a> it seems unlikely. I hope I overlooked something.</p>\n"}, {"tags": ["go", "visual-studio-code", "delve"], "answers": [{"tags": [], "owner": {"reputation": 317, "user_id": 2060735, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kJFRk.jpg?s=128&g=1", "display_name": "Ali Altun", "link": "https://stackoverflow.com/users/2060735/ali-altun"}, "is_accepted": false, "score": 0, "last_activity_date": 1523969997, "creation_date": 1523969997, "answer_id": 49878847, "question_id": 49878749, "link": "https://stackoverflow.com/questions/49878749/go-debug-adapter-process-has-terminated-unexpectedly-in-vs-code/49878847#49878847", "title": "Go debug adapter process has terminated unexpectedly in VS Code", "body": "<p>The problem originated from the project directory change. \nAfter changing the folder of the project, you reinstall all the go tools in VS Code to run debugger.</p>\n\n<pre><code>Installing 16 tools at E:\\Qlass\\goserv\\bin\ngocode\ngopkgs\ngo-outline\ngo-symbols\nguru\ngorename\ngomodifytags\ngoplay\nimpl\nfillstruct\ngodef\ngodoc\ngoreturns\ngolint\ngotests\ndlv\n</code></pre>\n"}], "owner": {"reputation": 317, "user_id": 2060735, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kJFRk.jpg?s=128&g=1", "display_name": "Ali Altun", "link": "https://stackoverflow.com/users/2060735/ali-altun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1203, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1523969997, "creation_date": 1523969719, "question_id": 49878749, "link": "https://stackoverflow.com/questions/49878749/go-debug-adapter-process-has-terminated-unexpectedly-in-vs-code", "title": "Go debug adapter process has terminated unexpectedly in VS Code", "body": "<p>There is a github issue about this subject. I couldnot find any clue from this github issue. (<a href=\"https://github.com/Microsoft/vscode-go/issues/1052\" rel=\"nofollow noreferrer\">https://github.com/Microsoft/vscode-go/issues/1052</a>) \nI have reinstalled vscode go extension and delve. I have controlled all environmental settings. But I haven't solved the problem.</p>\n\n<p>Any suggestions what might be wrong with debugging?</p>\n\n<pre><code>VS Code version: 1.22.2\nGo version: 1.9.1\nGo VS Code Extension: 0.6.78 \nWindow 10 Pro x64\n\n\"configurations\": [ {\n    \"name\": \"Delve\",\n    \"type\": \"go\",\n    \"request\": \"launch\",\n    \"mode\": \"debug\",\n    \"remotePath\": \"\",\n    \"host\": \"127.0.0.1\",\n    \"program\": \"E:/Qlass/goserv/src/\",\n    \"args\": [],\n    \"showLog\": true\n}\n</code></pre>\n"}, {"tags": ["go", "encoding", "google-drive-api"], "answers": [{"tags": [], "owner": {"reputation": 76, "user_id": 8261044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cda54d8bf5a0407c5ccb3fcb77ac772?s=128&d=identicon&r=PG&f=1", "display_name": "MTvB", "link": "https://stackoverflow.com/users/8261044/mtvb"}, "is_accepted": false, "score": 0, "last_activity_date": 1523968521, "creation_date": 1523968521, "answer_id": 49878300, "question_id": 49877985, "link": "https://stackoverflow.com/questions/49877985/google-drive-api-v3-how-to-correctly-escape-query-param/49878300#49878300", "title": "Google drive API V3 how to correctly escape query param?", "body": "<p>The query needs to be double encoded to work, so call url.QueryEscape first on the search given above and then again on the query string. </p>\n\n<p>If you look at the API Explorer with Chrome devtools, you will see the double encoded values despite the misleading display on the page itself.</p>\n\n<p>e.g. something like <code>https://content.googleapis.com/drive/v3/files?q=name%3D%2707+Dirname%27+and+mimeType%3D%27application%2Fvnd.google-apps.folder%27+and+%270B22uLx7BCvv9T0FWRmNaREY4VEE%27+in+parents+and+trashed%3Dfalse&amp;key={APIKEY}</code></p>\n"}, {"tags": [], "owner": {"reputation": 2072, "user_id": 1195266, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/6c5Fj.jpg?s=128&g=1", "display_name": "Macilias", "link": "https://stackoverflow.com/users/1195266/macilias"}, "is_accepted": false, "score": 0, "last_activity_date": 1524061621, "last_edit_date": 1524061621, "creation_date": 1524052851, "answer_id": 49899224, "question_id": 49877985, "link": "https://stackoverflow.com/questions/49877985/google-drive-api-v3-how-to-correctly-escape-query-param/49899224#49899224", "title": "Google drive API V3 how to correctly escape query param?", "body": "<p>I found the reason why the access to this directory was not working. It was the default scope which is:</p>\n\n<blockquote>\n  <p><a href=\"https://www.googleapis.com/auth/drive.file\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/drive.file</a>    Per-file access to files\n  created or opened by the app. File authorization is granted on a\n  per-user basis and is revoked when the user deauthorizes the app.</p>\n</blockquote>\n\n<p>But to have access also to folders not created by the app, I need this one:</p>\n\n<blockquote>\n  <p><a href=\"https://www.googleapis.com/auth/drive\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/drive</a> Full, permissive scope to access\n  all of a user's files, excluding the Application Data folder. Request\n  this scope only when it is strictly necessary.</p>\n</blockquote>\n\n<p>Which can be requested by setting the scope of the config like so:</p>\n\n<pre><code>func establishConnection() (*drive.Service, error) {\n    b, err := ioutil.ReadFile(\"client_secret.json\")\n    if err != nil {\n        logrus.Fatalf(\"Unable to read client secret file: %v\", err)\n    }\n\n    // If modifying these scopes, delete your previously saved client_secret.json.\n    config, err := google.ConfigFromJSON(b, drive.DriveScope)\n    if err != nil {\n        logrus.Fatalf(\"Unable to parse client secret file to config: %v\", err)\n    }\n\n    return drive.New(getClient(config))\n}\n</code></pre>\n"}], "owner": {"reputation": 2072, "user_id": 1195266, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/6c5Fj.jpg?s=128&g=1", "display_name": "Macilias", "link": "https://stackoverflow.com/users/1195266/macilias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 334, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1524061621, "creation_date": 1523967611, "last_edit_date": 1523970825, "question_id": 49877985, "link": "https://stackoverflow.com/questions/49877985/google-drive-api-v3-how-to-correctly-escape-query-param", "title": "Google drive API V3 how to correctly escape query param?", "body": "<p>Given: working access to Google Drive with some Folders with Space in Name</p>\n\n<p>Problem: The query:</p>\n\n<pre><code>name='07 Dirname' and mimeType='application/vnd.google-apps.folder' and '0B22uLx7BCvv9T0FWRmNaREY4VEE' in parents and trashed=false\n</code></pre>\n\n<p>does not work over the API, but does if the dir is without space in it.\nThe query does work however if you run it from the <a href=\"https://developers.google.com/apis-explorer/#p/drive/v3/drive.files.list\" rel=\"nofollow noreferrer\">API-Explorer</a> which provides as hint: <em>This parameter was URL encoded</em>.</p>\n\n<p>However when I encode the name field with <strong>url.QueryEscape</strong> or <strong>url.PathEscape</strong> the folder can not be found. As far as I understand it its not necessary to encode the whole query, just the param, but how?</p>\n\n<p>Thx.</p>\n"}, {"tags": ["go", "rsa", "pkix"], "comments": [{"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 1, "creation_date": 1523971163, "post_id": 49876521, "comment_id": 86774071, "body": "PKCS1 only supports RSA, PKIX aka SubjectPublicKeyInfo is slightly more complex and supports any kind of public key. PKIX is the format implied by Java&#39;s X509EncodedKeySpec and is returned by Java&#39;s PublicKey.getEncoded()"}, {"owner": {"reputation": 735, "user_id": 782409, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a468694290fc76ee203f00107ad7a711?s=128&d=identicon&r=PG", "display_name": "Feng Xi", "link": "https://stackoverflow.com/users/782409/feng-xi"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1524021119, "post_id": 49876521, "comment_id": 86796818, "body": "thanks for your reply."}], "answers": [{"tags": [], "owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "is_accepted": true, "score": 17, "last_activity_date": 1523977803, "last_edit_date": 1523977803, "creation_date": 1523969513, "answer_id": 49878687, "question_id": 49876521, "link": "https://stackoverflow.com/questions/49876521/golang-x509-marshalpkixpublickey-vs-x509-marshalpkcs1publickey/49878687#49878687", "title": "golang x509.MarshalPKIXPublicKey vs x509.MarshalPKCS1PublicKey()", "body": "<p>You don't make clear how much you don't (or do) understand. To start from the basics:</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Abstract_Syntax_Notation_One\" rel=\"noreferrer\"><strong>ASN.1</strong></a> (Abstract Syntax Notation One) is a general scheme for defining the structure of data to be communicated or interchanged between systems or programs.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/X.690#DER_encoding\" rel=\"noreferrer\"><strong>DER</strong></a> (Distinguished Encoding Rules) is a scheme defined to encode ASN.1 data to sequences of bytes that can be communicated and/or stored, and decode those sequences of bytes back to ASN.1 data losslessly.</p>\n\n<p><strong>PKCS1</strong> aka RFCs 2313,2437,3447,<a href=\"https://tools.ietf.org/html/rfc8017\" rel=\"noreferrer\">8017</a> (Public Key Cryptography Standard #1) is a standard that defines a range of things about using the RSA algorithm, among which <a href=\"https://tools.ietf.org/html/rfc8017#appendix-A.1.1\" rel=\"noreferrer\">Appendix A</a> defines an ASN.1 structure named <code>RSAPublicKey</code> to represent an RSA public key, which like any ASN.1 structure can be DER-encoded. </p>\n\n<blockquote>\n  <p>MarshalPKCS1PublicKey converts an RSA public key to PKCS#1, ASN.1 DER form.</p>\n</blockquote>\n\n<p>clearly means the DER encoding of the ASN.1 structure for an RSA public key in PKCS1.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/X.509\" rel=\"noreferrer\"><strong>PKIX</strong></a> (Public Key Infrastructure X.509) is an Internet variant (formally, a profile) of the X.509 standard originally defined by then-CCITT now-ITU-T, currently in <a href=\"https://tools.ietf.org/html/rfc5280\" rel=\"noreferrer\">rfc5280</a>. X.509, and PKIX, primarily defines a format for a public-key <strong>certificate</strong> which binds a public-key to an identity along with other metadata. To do this it has to contain a representation of a public-key that can handle multiple public-key algorithms, which is done using the <a href=\"https://tools.ietf.org/html/rfc5280#section-4.1\" rel=\"noreferrer\"><code>SubjectPublicKeyInfo</code> structure</a> which, fairly simply, consists of <a href=\"https://tools.ietf.org/html/rfc5280#section-4.1.2.7\" rel=\"noreferrer\">an AlgorithmIdentifier that identifies the algorithm, plus a BIT STRING that contains the actual public-key value in an algorithm-dependent manner</a>. The algorithm-dependent part for RSA is specified in <a href=\"https://tools.ietf.org/html/rfc3279#section-2.3.1\" rel=\"noreferrer\">rfc3279 sec 2.3.1</a> and as you see it is the RSAPublicKey strucuture from PKCS1, DER encoded. </p>\n\n<p>Thus 'DER-encoded PKIX format' <em>of an RSA public key</em> means the DER encoding of a PKIX/X.509 SubjectPublicKeyInfo structure containing the algorithmIdentifier for RSA (OID 1.2.840.113549.1.1.1 and parameters NULL) and a BIT STRING containing the DER encoded PKCS1 RSAPublicKey.</p>\n\n<p>Related or similar (although most include private not public and/or PEM not DER):<br>\n<a href=\"https://stackoverflow.com/questions/1193529/how-to-store-retrieve-rsa-public-private-key\">How to store/retrieve RSA public/private key</a><br>\n<a href=\"https://stackoverflow.com/questions/4032985/how-do-we-convert-a-string-from-pem-to-der-format\">How do we convert a String from PEM to DER format</a><br>\n<a href=\"https://stackoverflow.com/questions/4739662/problem-transmiting-a-rsa-public-key-javame-bouncy-castle/\">Problem transmiting a RSA public key, javaME , bouncy castle</a><br>\n<a href=\"https://stackoverflow.com/questions/7611383/generating-rsa-keys-in-pkcs1-format-in-java\">Generating RSA keys in PKCS#1 format in Java</a><br>\n<a href=\"https://stackoverflow.com/questions/10783366/how-to-generate-pkcs1-rsa-keys-in-pem-format\">How to generate PKCS#1 RSA keys in PEM Format?</a><br>\n<a href=\"https://stackoverflow.com/questions/18995687/converting-rsa-keys-into-subjectpublickeyinfo-form-from-bigintegers\">Converting RSA keys into SubjectPublicKeyInfo Form from BigIntegers</a><br>\n<a href=\"https://stackoverflow.com/questions/31685734/convert-a-x509-public-key-to-rsa-public-key\">Convert a X509 Public key to RSA public key</a><br>\n<a href=\"https://stackoverflow.com/questions/45123969/load-public-key-to-create-rsa-object-for-public-encryption\">Load public key to create rsa object for public encryption</a><br>\nand cross-stack:<br>\n<a href=\"https://crypto.stackexchange.com/questions/19149/what-is-the-technical-name-for-a-public-key-container-in-der-format\">https://crypto.stackexchange.com/questions/19149/what-is-the-technical-name-for-a-public-key-container-in-der-format</a><br>\n<a href=\"https://crypto.stackexchange.com/questions/54121/rsa-key-differences-openssl-cli-vs-openssl-ssl-h-c-function\">https://crypto.stackexchange.com/questions/54121/rsa-key-differences-openssl-cli-vs-openssl-ssl-h-c-function</a>  </p>\n"}], "owner": {"reputation": 735, "user_id": 782409, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a468694290fc76ee203f00107ad7a711?s=128&d=identicon&r=PG", "display_name": "Feng Xi", "link": "https://stackoverflow.com/users/782409/feng-xi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1553, "favorite_count": 4, "accepted_answer_id": 49878687, "answer_count": 1, "score": 9, "last_activity_date": 1523977803, "creation_date": 1523963385, "question_id": 49876521, "link": "https://stackoverflow.com/questions/49876521/golang-x509-marshalpkixpublickey-vs-x509-marshalpkcs1publickey", "title": "golang x509.MarshalPKIXPublicKey vs x509.MarshalPKCS1PublicKey()", "body": "<p>Can anyone help me understand the difference between MarshalPKIXPublicKey() and MarshalPKCS1PublicKey()?</p>\n\n<p>according to the comment:\n// MarshalPKIXPublicKey serialises a public key to DER-encoded PKIX format.</p>\n\n<p>// MarshalPKCS1PublicKey converts an RSA public key to PKCS#1, ASN.1 DER form.</p>\n\n<p>what is a DER-encoded PKIX format ?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1523959437, "creation_date": 1523959437, "answer_id": 49875214, "question_id": 49875046, "link": "https://stackoverflow.com/questions/49875046/concurrency-problems-using-unbuffered-channel/49875214#49875214", "title": "Concurrency Problems using unbuffered channel", "body": "<p>2 mistakes that immediately stand out.</p>\n\n<p>First, in <code>CheckWildcardSubdomain()</code> you should range over the <code>words</code> channel like this:</p>\n\n<pre><code>for word := range words {\n    preparedSubdomain := word + \".\" + domain\n    // ...\n}\n</code></pre>\n\n<p>The <code>for ... range</code> over a channel will terminate once all values sent on the channel (sent before the channel was closed) are received. Note that the simple <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">receive operator</a> will not terminate nor panic if the channel is closed, instead it will yield the zero value of the channel's element type. So your original loop would never terminate. <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">Spec: Receive operator:</a></p>\n\n<blockquote>\n  <p>A receive operation on a <a href=\"https://golang.org/ref/spec#Close\" rel=\"nofollow noreferrer\">closed</a> channel can always proceed immediately, yielding the element type's <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> after any previously sent values have been received.</p>\n</blockquote>\n\n<p>Second, inside <code>CheckWildcardSubdomain()</code> the <code>state.FinalResults</code> field is read / modified concurrently, without synchronization. This is undefined behavior.</p>\n\n<p>You must synchronize access to this field, e.g. using a mutex, or you should find other ways to communicate and collect results, e.g. using a channel.</p>\n\n<p>See this related question for an elegant, efficient and scalabe way to do it:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a></p>\n"}], "owner": {"reputation": 75, "user_id": 9546749, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20ea767689874e11b4703b8ed4c6126e?s=128&d=identicon&r=PG&f=1", "display_name": "Ice3man", "link": "https://stackoverflow.com/users/9546749/ice3man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 1, "accepted_answer_id": 49875214, "answer_count": 1, "score": 1, "last_activity_date": 1602102037, "creation_date": 1523958939, "last_edit_date": 1602102037, "question_id": 49875046, "link": "https://stackoverflow.com/questions/49875046/concurrency-problems-using-unbuffered-channel", "title": "Concurrency Problems using unbuffered channel", "body": "<p>I created a tool in Go that could bruteforce subdomains using Go concurrency. The problem is that it just shows first few results. I mean if the threads i specify are 10, it shows 10, if 100 then it shows 100. Any solutions for this. I am following <a href=\"http://divan.github.io/posts/go_concurrency_visualize/\" rel=\"nofollow noreferrer\">this</a> example.</p>\n<pre><code>func CheckWildcardSubdomain(state *State, domain string, words &lt;-chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    for {\n        preparedSubdomain := &lt;-words + &quot;.&quot; + domain\n        ipAddress, err := net.LookupHost(preparedSubdomain)\n\n        if err == nil {\n            if !state.WildcardIPs.ContainsAny(ipAddress) {\n                if state.Verbose == true {\n                    fmt.Printf(&quot;\\n%s&quot;, preparedSubdomain)\n                }\n\n                state.FinalResults = append(state.FinalResults, preparedSubdomain)\n            }\n        }\n    }\n}\n\nfunc RemoveWildcardSubdomains(state *State, subdomains []string) []string {\n    var wg sync.WaitGroup\n    var channel = make(chan string)\n\n    wg.Add(state.Threads)\n\n    for i := 0; i &lt; state.Threads; i++ {\n        go CheckWildcardSubdomain(state, state.Domain, channel, &amp;wg)\n    }\n\n    for _, entry := range subdomains {\n        sub := strings.Join(strings.Split(entry, &quot;.&quot;)[:2][:], &quot;.&quot;)\n        channel &lt;- sub\n    }\n\n    close(channel)\n    wg.Wait()\n\n    return state.FinalResults\n}\n</code></pre>\n<p>Thanks in advance for your help.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 116, "user_id": 8984194, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUrclvdaRpk/AAAAAAAAAAI/AAAAAAAAAMg/W3ycGrAbIFg/photo.jpg?sz=128", "display_name": "Mahak Mukhi", "link": "https://stackoverflow.com/users/8984194/mahak-mukhi"}, "is_accepted": false, "score": 0, "last_activity_date": 1524082871, "creation_date": 1524082871, "answer_id": 49908400, "question_id": 49874945, "link": "https://stackoverflow.com/questions/49874945/acme-certificate-for-grpc/49908400#49908400", "title": "ACME certificate for GRPC", "body": "<p>Hopefully this will be helpful:</p>\n\n<p>Documentation: <a href=\"https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-auth-support.md\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc-go/blob/master/Documentation/grpc-auth-support.md</a></p>\n\n<p>Example Code: <a href=\"https://github.com/grpc/grpc-go/tree/master/examples/oauth\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc-go/tree/master/examples/oauth</a></p>\n"}, {"tags": [], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "is_accepted": true, "score": 0, "last_activity_date": 1556887787, "last_edit_date": 1556887787, "creation_date": 1524406207, "answer_id": 49966863, "question_id": 49874945, "link": "https://stackoverflow.com/questions/49874945/acme-certificate-for-grpc/49966863#49966863", "title": "ACME certificate for GRPC", "body": "<p><a href=\"https://github.com/golang/go/issues/24894\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/24894</a></p>\n\n<blockquote>\n  <p>Use NewTLS instead of NewServerTLSFromCert.</p>\n</blockquote>\n\n<p><a href=\"https://godoc.org/google.golang.org/grpc/credentials#NewTLS\" rel=\"nofollow noreferrer\">https://godoc.org/google.golang.org/grpc/credentials#NewTLS</a></p>\n\n<p>Credits to <code>FiloSottile</code></p>\n\n<pre><code>    m := &amp;autocert.Manager{\n    Cache:      autocert.DirCache(\"tls\"),\n    Prompt:     autocert.AcceptTOS,\n    HostPolicy: autocert.HostWhitelist(\"example.com\"),\n}\ngo http.ListenAndServe(\":http\", m.HTTPHandler(nil))\ncreds := credentials.NewTLS(&amp;tls.Config{GetCertificate: m.GetCertificate})\nsrv := grpc.NewServer(grpc.Creds(creds))\nreflection.Register(srv)\n</code></pre>\n"}], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 49966863, "answer_count": 2, "score": 1, "last_activity_date": 1556887787, "creation_date": 1523958681, "last_edit_date": 1523959765, "question_id": 49874945, "link": "https://stackoverflow.com/questions/49874945/acme-certificate-for-grpc", "title": "ACME certificate for GRPC", "body": "<p>Is it possible to fit a m.GetCertificate into a GRPC client / server?</p>\n\n<pre><code>   m := &amp;autocert.Manager{\n        Cache:      autocert.DirCache(\"tls\"),\n        Prompt:     autocert.AcceptTOS,\n        HostPolicy: autocert.HostWhitelist(\"example.com\"),\n    }\n    go http.ListenAndServe(\":http\", m.HTTPHandler(nil))\n    cert, err := m.GetCertificate(...)\n    if err != nil {\n        t.Fatalf(\"Failed to generate certificates %s\", err)\n    }\n    creds := credentials.NewServerTLSFromCert(cert)\n    srv := grpc.NewServer(grpc.Creds(creds))\n    reflection.Register(srv)\n</code></pre>\n\n<p><a href=\"https://godoc.org/golang.org/x/crypto/acme/autocert\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/crypto/acme/autocert</a></p>\n"}, {"tags": ["go", "concurrency", "timeout", "channel", "idioms"], "comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523953102, "post_id": 49872097, "comment_id": 86761366, "body": "please, consider <code>go func()</code> as a stub, I don&#39;t create the data channel, don&#39;t send to it anything and have no power to close it"}], "answers": [{"comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523954340, "post_id": 49872216, "comment_id": 86762127, "body": "thank you, and, yes, <code>go func()</code> is a dumb example, I added some comments in the code"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 2, "creation_date": 1523954484, "post_id": 49872216, "comment_id": 86762219, "body": "@vitr, if dataChan provides values non-stop, the select will be <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">pseudo-random</a> after 5 seconds and may not hit the afterCh case reliably. If you cannot tolerate that, check afterCh explicitly before attempting to receive from dataChan: <a href=\"https://play.golang.org/p/3_odFeXbWLf\" rel=\"nofollow noreferrer\">play.golang.org/p/3_odFeXbWLf</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523954783, "post_id": 49872216, "comment_id": 86762387, "body": "@Peter Good tip, that question has been surfaced a couple of times. Added links to those questions."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523955292, "post_id": 49872216, "comment_id": 86762709, "body": "@Peter And in your example, you actually check the <code>dataChan</code> twice, I think you meant to check the <code>afterCh</code> twice."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523955771, "post_id": 49872216, "comment_id": 86763041, "body": "thank you @Peter, so, in the edge case when the timer and  the reciever occur in exact moment in time, the timer may fail (randomly)."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523955942, "post_id": 49872216, "comment_id": 86763145, "body": "@icza you mentioned &quot;immediately&quot; after timeout in the edited answer, does it mean the timeout may happen a moment later or is there a chance to miss it forever?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 1, "creation_date": 1523956042, "post_id": 49872216, "comment_id": 86763231, "body": "@vitr <b>If</b> <code>dataCh</code> is &quot;always&quot; ready, then after the timeout the chance to miss it forever is zero. To get a rough picture: chance to miss it once is 0.5. Chance to miss it twice is 0.25. Chance to miss it three times is 0.125. Chance to miss it after 10 iterations is less than 0.001. Chance to miss it after <code>n</code> iterations is <code>2 ^ -n</code>. Also there is no guarantee that a timeout will happen immediately after 5 seconds. Please read the linked answer for details: <a href=\"https://stackoverflow.com/questions/43616295/golang-timers-with-0-length/43616551#43616551\">Golang Timers with 0 length</a>."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523956341, "post_id": 49872216, "comment_id": 86763445, "body": "@icza the iteration duration in this example is 5 seconds, that means I&#39;ll be reading for 10 second, then 15, etc. this is actually scary) I&#39;d prefer an extra check then"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 1, "creation_date": 1523956434, "post_id": 49872216, "comment_id": 86763518, "body": "@vitr No, you misunderstood. We&#39;re talking about the <code>for</code> loop iterations, <b>not</b> the iterations of the timer. The timer will only fire once. So for example if <code>dataChan</code> is always ready and processing a data value takes let&#39;s say 0.5 ms, then 10 additional iterations would only take 5 seconds + 5 ms, and it would terminate with 99.9% probability. And this only means if <code>dataChan</code> is <i>truly</i> always ready to receive from. If just in one iteration it would not be ready, the timeout channel would be chosen with 100% probability."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523956540, "post_id": 49872216, "comment_id": 86763597, "body": "I see, kk, that sounds better"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 12, "last_activity_date": 1523954758, "last_edit_date": 1523954758, "creation_date": 1523950080, "answer_id": 49872216, "question_id": 49872097, "link": "https://stackoverflow.com/questions/49872097/idiomatic-way-for-reading-from-the-channel-for-a-certain-time/49872216#49872216", "title": "Idiomatic way for reading from the channel for a certain time", "body": "<p>That's pretty much it. But if you don't need to stop or reset the timer, simply use <a href=\"https://golang.org/pkg/time/#After\" rel=\"noreferrer\"><code>time.After()</code></a> instead of <a href=\"https://golang.org/pkg/time/#NewTimer\" rel=\"noreferrer\"><code>time.NewTimer()</code></a>. <code>time.After()</code> is <em>\"equivalent to NewTimer(d).C\"</em>.</p>\n\n<pre><code>afterCh := time.After(5 * time.Second)\nfor {\n    select {\n    case d := &lt;-dataChan:\n        fmt.Println(\"Got:\", d)\n    case &lt;-afterCh:\n        fmt.Println(\"Time's up!\")\n        return\n    }\n}\n</code></pre>\n\n<p>Alternatively (to your liking), you may declare the after channel in the <code>for</code> statement like this:</p>\n\n<pre><code>for afterCh := time.After(5 * time.Second); ; {\n    select {\n    case d := &lt;-dataChan:\n        fmt.Println(\"Got:\", d)\n    case &lt;-afterCh:\n        fmt.Println(\"Time's up!\")\n        return\n    }\n}\n</code></pre>\n\n<p>Also I know this is just an example, but always think how a goroutine you start will properly end, as the goroutine producing data in your case will never terminate.</p>\n\n<p>Also don't forget that if multiple cases may be executed without blocking, one is chosen randomly. So if <code>dataChan</code> is ready to receive from \"non-stop\", there is no guarantee that the loop will terminate <em>immediately</em> after the timeout. In practice this is usually not a problem (starting with that even the timeout is not a guarantee, see details at <a href=\"https://stackoverflow.com/questions/43616295/golang-timers-with-0-length/43616551#43616551\">Golang Timers with 0 length</a>), but you should not forget about it in \"mission-critial\" applications. For details, see related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/46200343/force-priority-of-go-select-statement/46202533#46202533\">force priority of go select statement</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/47645808/golang-how-the-select-worked-when-multiple-channel-involved/47648910#47648910\">golang: How the select worked when multiple channel involved?</a></p>\n"}, {"comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523953222, "post_id": 49872600, "comment_id": 86761443, "body": "thank you, it&#39;s an interesting approach in general, but doesn&#39;t fit my particular case, as I don&#39;t control the dataChan"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523954794, "post_id": 49872600, "comment_id": 86762396, "body": "You don&#39;t have to close the channel in the &quot;generator routine&quot;, I did it just so that the reader loop is simpler. Just send the channel in as a parameter (like context is right now) and remove the <code>close(dataChan)</code>. Of course if you do it with the simple examle given here you&#39;ll have infinite loop (when goroutine ends, no more items is sent to the channel but range loop will not end) but in your real code you presumaly have more complex structure anyway..."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523956648, "post_id": 49872600, "comment_id": 86763672, "body": "gotcha, what about that randomness issue from icza&#39;s  answer? does the context suffer from the same?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 2, "creation_date": 1523956820, "post_id": 49872600, "comment_id": 86763802, "body": "@vitr This randomness is not a &quot;property&quot; of <code>Context</code>, it&#39;s in the &quot;nature&quot; of the <code>select</code> statement. So wherever you see a <code>select</code> statement, it is in &quot;play&quot;."}], "tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": false, "score": 3, "last_activity_date": 1523952408, "last_edit_date": 1523952408, "creation_date": 1523951446, "answer_id": 49872600, "question_id": 49872097, "link": "https://stackoverflow.com/questions/49872097/idiomatic-way-for-reading-from-the-channel-for-a-certain-time/49872600#49872600", "title": "Idiomatic way for reading from the channel for a certain time", "body": "<p>It looks like context with deadline would be good fit, something like</p>\n\n<pre><code>func main() {\n    dataChan := make(chan string)\n\n    ctx, cancel := context.WithDeadline(context.Background(), time.Now().Add(5*time.Second))\n    defer cancel()\n\n    go func(ctx context.Context) {\n        for {\n            select {\n            case dataChan &lt;- \"some data\":\n                time.Sleep(time.Second)\n            case &lt;-ctx.Done():\n                fmt.Println(ctx.Err())\n                close(dataChan)\n                return\n            }\n        }\n    }(ctx)\n\n    for d := range dataChan {\n        fmt.Println(\"Got:\", d)\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3394, "favorite_count": 1, "accepted_answer_id": 49872216, "answer_count": 2, "score": 7, "last_activity_date": 1524031291, "creation_date": 1523949647, "last_edit_date": 1524031291, "question_id": 49872097, "link": "https://stackoverflow.com/questions/49872097/idiomatic-way-for-reading-from-the-channel-for-a-certain-time", "title": "Idiomatic way for reading from the channel for a certain time", "body": "<p>I need to read data from the Go channel for a certain period of time (say 5 seconds). The select statement with timeout doesn't work for me, as I need to read as many values as available and stop exactly after 5 seconds. So far, I've come up with a solution using an extra time channel <a href=\"https://play.golang.org/p/yev9CcvzRIL\" rel=\"noreferrer\">https://play.golang.org/p/yev9CcvzRIL</a></p>\n\n<pre><code>package main\n\nimport \"time\"\nimport \"fmt\"\n\nfunc main() {\n    // I have no control over dataChan\n    dataChan := make(chan string)\n    // this is a stub to demonstrate some data coming from dataChan\n    go func() {\n        for {\n            dataChan &lt;- \"some data\"\n            time.Sleep(time.Second)\n        }\n    }()\n\n    // the following is the code I'm asking about\n    timeChan := time.NewTimer(time.Second * 5).C\n    for {\n        select {\n        case d := &lt;-dataChan:\n            fmt.Println(\"Got:\", d)\n        case &lt;-timeChan:\n            fmt.Println(\"Time's up!\")\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>I'm wondering is there any better or more idiomatic way for solving this problem?</p>\n"}, {"tags": ["go", "odbc", "sap", "sap-iq"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1523976182, "post_id": 49871610, "comment_id": 86777947, "body": "There is <a href=\"https://github.com/alexbrainman/odbc\" rel=\"nofollow noreferrer\"><code>github.com&#47;alexbrainman&#47;odbc</code></a> which you could try to use with that whateverAnywhereX.Y.dll"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1523976454, "post_id": 49871610, "comment_id": 86778174, "body": "The wikipedia page and <a href=\"https://help.sap.com/viewer/a894a54d84f21015b142ffe773888f8c/16.1.3.0/en-US/a3171c5084f210159caebadd9e149481.html\" rel=\"nofollow noreferrer\">this</a> say Sybase IQ 16.0 provides native ODBC drivers (that &quot;anywhere&quot; thingy appears to be a .NET assembly)."}], "owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 377, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523947807, "creation_date": 1523947807, "question_id": 49871610, "link": "https://stackoverflow.com/questions/49871610/how-to-connect-to-sybase-iq16-using-go", "title": "How to connect to Sybase IQ16 using Go?", "body": "<p>I have an idea to write an application to work with SAP Sybase IQ16 server using Go language. Platform windows/nix does not matter yet. I had workewd with this database using C# later, and I remember, that there was no ADO.NET driver, so I used ODBC + iAnywhere.Data.SQLAnywhere.v4.0.dll to establish connection. Also, I know, that drivers for IQ, ASE, etc... are not compatible. I looked here <a href=\"https://github.com/golang/go/wiki/SQLDrivers\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/SQLDrivers</a>, but neither \u043ef drivers seems to be compatible. Thus, I can not understand at all is there solution for my problem.</p>\n"}, {"tags": ["go", "logging"], "answers": [{"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": false, "score": 0, "last_activity_date": 1523949181, "creation_date": 1523949181, "answer_id": 49871971, "question_id": 49871231, "link": "https://stackoverflow.com/questions/49871231/does-closing-io-pipewriter-close-the-underlying-file/49871971#49871971", "title": "Does closing io.PipeWriter close the underlying file?", "body": "<p>The closing of <code>io.PipeWriter</code> will not affect actual <code>Writer</code> behind it. The chain of close execution:\n<a href=\"https://golang.org/src/io/pipe.go?s=3691:3725#L158\" rel=\"nofollow noreferrer\">PipeWriter.Close()</a> -> <a href=\"https://golang.org/src/io/pipe.go?s=3691:3725#L167\" rel=\"nofollow noreferrer\">PipeWriter.CloseWithError(err error)</a> ->\n<a href=\"https://golang.org/src/io/pipe.go?s=3691:3725#L107\" rel=\"nofollow noreferrer\">pipe.CloseWrite(err error)</a>\nand it doesn't influence underlying <code>io.Writer</code>.</p>\n\n<p>To close actual writer you need just to close <a href=\"https://github.com/sirupsen/logrus/blob/89742aefa4b206dcf400792f3bd35b542998eb3b/logger.go#L14\" rel=\"nofollow noreferrer\">Logger.Out</a> that is an exported field.</p>\n"}, {"comments": [{"owner": {"reputation": 20, "user_id": 5211579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c3a11e6451777b637f1b8e32f88e19f?s=128&d=identicon&r=PG", "display_name": "CptFoobar", "link": "https://stackoverflow.com/users/5211579/cptfoobar"}, "edited": false, "score": 0, "creation_date": 1523956115, "post_id": 49872506, "comment_id": 86763287, "body": "Thanks for the input. Wrapping the *os.File makes sense. And I know that log rotation shouldn&#39;t be a part of the application, but the target environment (Windows) doesn&#39;t have a good log rotation solution (afaik); plus we&#39;ll be moving to a network logging solution soon anyway, so this would be a temporary solution."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 0, "last_activity_date": 1523951115, "creation_date": 1523951115, "answer_id": 49872506, "question_id": 49871231, "link": "https://stackoverflow.com/questions/49871231/does-closing-io-pipewriter-close-the-underlying-file/49872506#49872506", "title": "Does closing io.PipeWriter close the underlying file?", "body": "<p>For the record, <a href=\"https://12factor.net/logs\" rel=\"nofollow noreferrer\">twelve-factor </a> tells us that applications should not concern themselves with log rotation. If and how logs are handled best depends on how the application is deployed. Systemd has its own logging system, for instance. Writing to files when deployed in (Docker) containers is annoying. Rotating files are annoying during development.</p>\n\n<p>Now, pipes don't have an \"underlying file\". There's a Reader end and a Writer end, and that's it. From <a href=\"https://golang.org/pkg/io/#PipeWriter.Close\" rel=\"nofollow noreferrer\">the docs for PipeWriter</a>:</p>\n\n<blockquote>\n  <p>Close closes the writer; subsequent reads from the read half of the pipe will return no bytes and EOF.</p>\n</blockquote>\n\n<p>So what happens when you close the writer depends on how Logrus handles EOF on the Reader end. Since <a href=\"https://godoc.org/github.com/sirupsen/logrus#Logger\" rel=\"nofollow noreferrer\">Logger.Out</a> is an io.Writer, Logrus cannot possibly call Close on your file.</p>\n\n<p>Your best bet would be to wrap *os.File, perhaps like so:</p>\n\n<pre><code>package main\n\nimport \"os\"\n\ntype RotatingFile struct {\n        *os.File\n        rotate chan struct{}\n}\n\nfunc NewRotatingFile(f *os.File) RotatingFile {\n        return RotatingFile{\n                File:   f,\n                rotate: make(chan struct{}, 1),\n        }\n}\n\nfunc (r RotatingFile) Rotate() {\n        r.rotate &lt;- struct{}{}\n}\n\nfunc (r RotatingFile) doRotate() error {\n        // file rotation logic here\n        return nil\n}\n\nfunc (r RotatingFile) Write(b []byte) (int, error) {\n        select {\n        case &lt;-r.rotate:\n                if err := r.doRotate(); err != nil {\n                        return 0, err\n                }\n        default:\n        }\n\n        return r.File.Write(b)\n}\n</code></pre>\n\n<p>Implementing log file rotation in a robust way is surprisingly tricky. For instance, closing the old file before creating the new one is not a good idea. What if the log directory permissions changed? What if you run out of inodes? If you can't create a new log file you may want to keep writing to the current file. Are you okay with ripping lines apart, or do you only want to rotate after a newline? Do you want to rotate empty files? How do you reliably remove old logs if someone deletes the N-1th file? Will you notice the Nth file or stop looking at the N-2nd?</p>\n\n<p>The best advice I can give you is to leave log rotation to the pros. I like <a href=\"http://smarden.org/runit/svlogd.8.html\" rel=\"nofollow noreferrer\">svlogd</a> (part of runit) as a standalone log rotation tool.</p>\n"}], "owner": {"reputation": 20, "user_id": 5211579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c3a11e6451777b637f1b8e32f88e19f?s=128&d=identicon&r=PG", "display_name": "CptFoobar", "link": "https://stackoverflow.com/users/5211579/cptfoobar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 0, "accepted_answer_id": 49872506, "answer_count": 2, "score": 0, "last_activity_date": 1523954161, "creation_date": 1523946303, "last_edit_date": 1523954161, "question_id": 49871231, "link": "https://stackoverflow.com/questions/49871231/does-closing-io-pipewriter-close-the-underlying-file", "title": "Does closing io.PipeWriter close the underlying file?", "body": "<p>I am using <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a> for logging and have a few custom format loggers. Each is initialized to write to a different file like:</p>\n\n<pre><code>fp, _ := os.OpenFile(path, os.O_APPEND|os.O_WRONLY|os.O_CREATE, 0755)\n// error handling left out for brevity\nlog.Out = fp\n</code></pre>\n\n<p>Later in the application, I need to change the file the logger is writing to (for a log rotation logic). What I want to achieve is to properly close the current file before changing the logger's output file. But the closest thing to the file handle logrus provides me is a <a href=\"https://godoc.org/github.com/sirupsen/logrus#Logger.Writer\" rel=\"nofollow noreferrer\"><code>Writer()</code></a> method that returns a <code>io.PipeWriter</code> pointer. So would calling <code>Close()</code> on the PipeWriter also close the underlying file? \nIf not, what are my options to do this, other than keeping the file pointer stored somewhere.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "edited": false, "score": 1, "creation_date": 1523943655, "post_id": 49870446, "comment_id": 86756476, "body": "JSON decorder is for JSON streams, so your body has two JSON values concatenated (which is not a valid json document)? Eg sth like { &quot;name&quot;: &quot;a&quot; }{ &quot;name&quot;: &quot;b&quot; } See <a href=\"https://ahmet.im/blog/golang-json-decoder-pitfalls/\" rel=\"nofollow noreferrer\">ahmet.im/blog/golang-json-decoder-pitfalls</a> for some info on decoder"}, {"owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "reply_to_user": {"reputation": 9712, "user_id": 66907, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f45da391d77044534895e4dd3770ffd2?s=128&d=identicon&r=PG", "display_name": "Sascha", "link": "https://stackoverflow.com/users/66907/sascha"}, "edited": false, "score": 0, "creation_date": 1523944107, "post_id": 49870446, "comment_id": 86756649, "body": "when the page is run on localhost then the data is in the form of json <code>json.NewDecoder(c.Request.Body).Decode(&amp;provider)</code> this will arrange the data according to the data entered."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1523945459, "creation_date": 1523945459, "answer_id": 49871032, "question_id": 49870446, "link": "https://stackoverflow.com/questions/49870446/how-to-decode-the-two-different-struct-from-different-files-in-a-single-function/49871032#49871032", "title": "How to decode the two different struct from different files in a single function golang?", "body": "<p>The code in the question does not work because the first decoder reads the entire request body.  The second decoder starts at EOF.  </p>\n\n<p>The fix is to slurp up the body to a byte slice and unmarshal twice from that slice:</p>\n\n<pre><code>// slurp up the body.  p is a []byte\np, err := ioutil.ReadAll(c.Request.Body)\nif err != nil {\n   // handler error\n}\n\nvar provider models.Provider\nif err := json.Unmarshal(p, &amp;provider); err != nil {\n    // handle error\n}\n\nvar user models.User\nif err := json.Unmarshal(p, &amp;user); err != nil {\n     // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 1, "accepted_answer_id": 49871032, "answer_count": 1, "score": 0, "last_activity_date": 1523945459, "creation_date": 1523942571, "last_edit_date": 1523945230, "question_id": 49870446, "link": "https://stackoverflow.com/questions/49870446/how-to-decode-the-two-different-struct-from-different-files-in-a-single-function", "title": "How to decode the two different struct from different files in a single function golang?", "body": "<p>I want to decode the two different struct for saving the data into the collection. but it gives error.</p>\n\n<p>The two struct are given below these two files are in the folder named <strong><em>models</em></strong>.</p>\n\n<p>User.go</p>\n\n<pre><code>type User struct {\n Id                         int         `json:\"id\" bson:\"_id,omitempty\"`\n FirstName                  string      `json:\"first_name,omitempty\" bson:\"first_name,omitempty\"`\n LastName                   string      `json:\"last_name,omitempty\" bson:\"last_name,omitempty\"`\n EmailId                    string      `json:\"email_id,omitempty\" bson:\"email_id,omitempty\"`\n Password                   string      `json:\"password,omitempty\" bson:\"password,omitempty\"`\n PhoneNumber                string      `json:\"phone_number,omitempty\" bson:\"phone_number,omitempty\"`\n AltPhoneNumber             string      `json:\"alt_phone_number\" bson:\"alt_phone_number\"`\n Gender                     string      `json:\"gender,omitempty\" bson:\"gender,omitempty\"`\n Note                       string      `json:\"note,omitempty\" bson:\"note,omitempty\"`\n}\n</code></pre>\n\n<p>Provider.go</p>\n\n<pre><code>type Provider struct {\n Id                      int                `json:\"id\" bson:\"_id,omitempty\"`\n Uid                     int                `json:\"uid\" bson:\"uid,omitempty\"`\n Speed                   string             `json:\"speed,omitempty\" bson:\"speed,omitempty\"`\n ProviderCategory        string             `json:\"provider_category,omitempty\" bson:\"provider_category,omitempty\"`\n Priority                int                `json:\"priority,omitempty\" bson:\"priority,omitempty\"`\n}\n</code></pre>\n\n<p>The code I tried to decode them </p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"go-training/models\"\n    \"github.com/gin-gonic/gin\"\n    \"fmt\"\n)\n\nvar provider models.Provider\nvar user models.User\n\nfunc SaveProvider(c *gin.Context) {\n    response := ResponseController{}\n    //decode the struct\n    providerErr := json.NewDecoder(c.Request.Body).Decode(&amp;provider)\n    fmt.Println(providerErr) //Output:- nil\n    userErr := json.NewDecoder(c.Request.Body).Decode(&amp;user)\n    fmt.Println(userErr) //output:- EOF\n    if userErr != nil {\n        fmt.Println(\"data is not properly formatted\")\n    }\n    if providerErr != nil {\n        fmt.Printl?(\"data is not properly formatted\")\n    }\n}\n</code></pre>\n\n<p>Data entered in the json form-</p>\n\n<pre><code>{\n \"Id\":1,\n \"Uid\":1,\n \"speed\":\"new\",\n \"provider_category\":\"WL\",\n \"priority\":1,\n \"first_name\":\"puneet\",\n \"last_name\":\"jindal\",\n \"email_id\":\"puneet@gmail.com\",\n \"password\":\"poiuytrewq\",\n \"phone_number\":\"9876543210\",\n \"alt_phone_number\":\"9876543210\",\n \"gender\":\"male\",\n \"note\":\"phase 7\"\n}    \n</code></pre>\n\n<blockquote>\n  <p>Error:- EOF</p>\n</blockquote>\n\n<p>How can I solve this problem? Can anyone help me? Thank you. </p>\n"}, {"tags": ["windows", "go", "dns"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1523937187, "post_id": 49869391, "comment_id": 86754448, "body": "&quot;On Windows, the resolver always uses C library functions, such as GetAddrInfo and DnsQuery.&quot; - <a href=\"https://golang.org/pkg/net/#hdr-Name_Resolution\" rel=\"nofollow noreferrer\">doc</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4567, "user_id": 1318734, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/S3JJ2.gif?s=128&g=1", "display_name": "rofls", "link": "https://stackoverflow.com/users/1318734/rofls"}, "is_accepted": false, "score": 0, "last_activity_date": 1524002662, "last_edit_date": 1524002662, "creation_date": 1523936937, "answer_id": 49869609, "question_id": 49869391, "link": "https://stackoverflow.com/questions/49869391/ask-lookuptxt-function-in-golang/49869609#49869609", "title": "ask LookupTXT function in golang", "body": "<p>This is not straigtforward to do using golang at this point. You can however use a third party DNS package that allows configuring the resolver. First install the package:</p>\n\n<pre><code>go get github.com/bogdanovich/dns_resolver\n</code></pre>\n\n<p>Here is an example using it and the google resolvers <code>8.8.8.8</code> and <code>8.8.4.4</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"github.com/bogdanovich/dns_resolver\"\n)\n\nfunc main() {\n    resolver := dns_resolver.New([]string{\"8.8.8.8\", \"8.8.4.4\"})\n\n    // In case of i/o timeout\n    resolver.RetryTimes = 5\n\n    ip, err := resolver.LookupHost(\"google.com\")\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n    log.Println(ip)\n    // Output [216.58.192.46]\n}\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/a/32325270/1318734\">Source</a></p>\n\n<p>There is an open issue in golang here, so hopefully it becomes easier to do it with the builtin <code>net</code> package: <a href=\"https://github.com/golang/go/issues/12503\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/12503</a>. It could just be a documentation problem, as it is possible now, I just can't find an example.</p>\n\n<p>EDIT: actually that package only supports <code>lookupHost</code>: <a href=\"https://github.com/bogdanovich/dns_resolver/blob/master/dns_resolver.go#L51-L79\" rel=\"nofollow noreferrer\">https://github.com/bogdanovich/dns_resolver/blob/master/dns_resolver.go#L51-L79</a></p>\n\n<p>So a PR would be required to add a TXT resolver.</p>\n\n<p>2nd Edit: I made a PR with txt lookup <a href=\"https://github.com/bogdanovich/dns_resolver/pull/2\" rel=\"nofollow noreferrer\">here</a>. That project hasn't been touched in years though so it may never get accepted.</p>\n"}], "owner": {"reputation": 3, "user_id": 2491067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e841b7ff16d4c0be70a82031b889f814?s=128&d=identicon&r=PG", "display_name": "user2491067", "link": "https://stackoverflow.com/users/2491067/user2491067"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1524002662, "creation_date": 1523935573, "last_edit_date": 1523943223, "question_id": 49869391, "link": "https://stackoverflow.com/questions/49869391/ask-lookuptxt-function-in-golang", "title": "ask LookupTXT function in golang", "body": "<p>How do I change the IP address of the DNS server?</p>\n\n<p>In situation, I set Google DNS server in Windows Network Settins.</p>\n\n<p>And I use <code>LookupTXT</code> function in Golang for getting DNS txt request.\nBut <code>LookupTXT</code> parameter is just the query string.</p>\n\n<p>Any help or pointers would be highly appreciated. Thanks!</p>\n"}, {"tags": ["go", "type-conversion"], "answers": [{"tags": [], "owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "is_accepted": false, "score": 7, "last_activity_date": 1523934585, "last_edit_date": 1592644375, "creation_date": 1523934281, "answer_id": 49869221, "question_id": 49869175, "link": "https://stackoverflow.com/questions/49869175/implicit-type-conversion-between-uint8-and-byte/49869221#49869221", "title": "Implicit type conversion between uint8 and byte", "body": "<p><strong>byte</strong> is an alias for <strong>uint8</strong> and is equivalent to uint8 in all ways.</p>\n<p>From GoDoc:</p>\n<blockquote>\n<p>type Byte</p>\n<p>byte is an alias for uint8 and is equivalent to uint8 in all ways. It is used, by convention, to distinguish byte values from 8-bit unsigned integer values.</p>\n<p>type byte byte // Really: type byte = uint8 (see golang.org/issue/21601)</p>\n</blockquote>\n<p><a href=\"https://golang.org/pkg/builtin/#byte\" rel=\"noreferrer\">https://golang.org/pkg/builtin/#byte</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1523973060, "last_edit_date": 1523973060, "creation_date": 1523935925, "answer_id": 49869443, "question_id": 49869175, "link": "https://stackoverflow.com/questions/49869175/implicit-type-conversion-between-uint8-and-byte/49869443#49869443", "title": "Implicit type conversion between uint8 and byte", "body": "<p>Earlier, on page 52 of <a href=\"https://www.gopl.io/\" rel=\"nofollow noreferrer\">The Go Programming Language</a>, \"the type byte is a synonym for uint8\".</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">Numeric types</a></p>\n\n<pre><code>uint8       the set of all unsigned  8-bit integers (0 to 255)\n\nbyte        alias for uint8\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 39, "user_id": 8658981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1c227717c59950cdf92ca1d4d2ec42b?s=128&d=identicon&r=PG&f=1", "display_name": "Joseph Yu", "link": "https://stackoverflow.com/users/8658981/joseph-yu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2357, "favorite_count": 2, "answer_count": 2, "score": 0, "last_activity_date": 1523973060, "creation_date": 1523933884, "last_edit_date": 1523946441, "question_id": 49869175, "link": "https://stackoverflow.com/questions/49869175/implicit-type-conversion-between-uint8-and-byte", "title": "Implicit type conversion between uint8 and byte", "body": "<p>As said in The Go Programming Language on page 55: \"an EXPLICIT conversion is required to convert a value from one type to another\", even if both of them have same underlying type.  For example:</p>\n\n<pre><code>type myByte byte\n\nfunc main() {\n    var a byte\n    var b myByte\n\n    a = b       // Compile error: cannot use b (type myByte) as type byte in assignment\n    a = byte(b) // OK\n}\n</code></pre>\n\n<p>But for <code>uint8</code> and <code>byte</code>, I'm surprised that the conversion is implicit:</p>\n\n<pre><code>func main() {\n    var a byte\n    var b uint8\n\n    a = b // OK\n    b = a // OK\n}\n</code></pre>\n\n<p>So why?</p>\n"}, {"tags": ["go", "glog"], "comments": [{"owner": {"reputation": 491, "user_id": 4656380, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/cgNbm.png?s=128&g=1", "display_name": "hsiaoairplane", "link": "https://stackoverflow.com/users/4656380/hsiaoairplane"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1523931850, "post_id": 49868828, "comment_id": 86753245, "body": "I think I do the right tagging. <a href=\"https://github.com/golang/glog\" rel=\"nofollow noreferrer\">github.com/golang/glog</a>"}, {"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 0, "creation_date": 1523940443, "post_id": 49868828, "comment_id": 86755404, "body": "you can provide <code>stderrthreshold</code> and <code>--v</code> by flag, if that what you are asking!"}, {"owner": {"reputation": 491, "user_id": 4656380, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/cgNbm.png?s=128&g=1", "display_name": "hsiaoairplane", "link": "https://stackoverflow.com/users/4656380/hsiaoairplane"}, "reply_to_user": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 0, "creation_date": 1523946510, "post_id": 49868828, "comment_id": 86757662, "body": "@MarufTuhin I think it&#39;s a compile time solution."}], "answers": [{"tags": [], "owner": {"reputation": 267, "user_id": 3590449, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c194f6c98caf853661133c2548936243?s=128&d=identicon&r=PG&f=1", "display_name": "Ibrahim", "link": "https://stackoverflow.com/users/3590449/ibrahim"}, "is_accepted": false, "score": 2, "last_activity_date": 1550945806, "creation_date": 1550945806, "answer_id": 54844623, "question_id": 49868828, "link": "https://stackoverflow.com/questions/49868828/how-to-change-glog-log-level-at-runtime-not-compile-time/54844623#54844623", "title": "How to change glog log level at runtime, not compile time?", "body": "<p><a href=\"https://github.com/golang/glog\" rel=\"nofollow noreferrer\">glog</a> package reads configuration from flags. You can modify the flags at runtime from your code to change glog's behaviour.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n\n    \"github.com/golang/glog\"\n)\n\nfunc main() {\n    // glog needs flag.Parse() call\n    flag.Parse()\n    glog.Info(\"default level\")\n    glog.V(3).Info(\"Level 3 log\")\n    if glog.V(3) {\n        fmt.Println(\"Changing log level to 5\")\n        flag.Lookup(\"v\").Value.Set(\"5\")\n    }\n    glog.V(4).Info(\"Level 4 log\")\n\n    glog.V(5).Info(\"Level 5 log\")\n\n}\n</code></pre>\n\n<p>Results in </p>\n\n<pre><code>\u279c ./main --alsologtostderr -v 2\nI0223 23:42:26.661984    4587 main.go:12] default level\n\u279c ./main --alsologtostderr -v 3\nI0223 23:42:28.209673    4600 main.go:12] default level\nI0223 23:42:28.210174    4600 main.go:13] Level 3 log\nChanging log level to 5\nI0223 23:42:28.210210    4600 main.go:18] Level 4 log\nI0223 23:42:28.210230    4600 main.go:20] Level 5 log\n\u279c ./main --alsologtostderr -v 4\nI0223 23:42:30.927222    4614 main.go:12] default level\nI0223 23:42:30.928018    4614 main.go:13] Level 3 log\nChanging log level to 5\nI0223 23:42:30.928072    4614 main.go:18] Level 4 log\nI0223 23:42:30.928088    4614 main.go:20] Level 5 log\n\n</code></pre>\n"}], "owner": {"reputation": 491, "user_id": 4656380, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/cgNbm.png?s=128&g=1", "display_name": "hsiaoairplane", "link": "https://stackoverflow.com/users/4656380/hsiaoairplane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1474, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1550945806, "creation_date": 1523931184, "last_edit_date": 1523932064, "question_id": 49868828, "link": "https://stackoverflow.com/questions/49868828/how-to-change-glog-log-level-at-runtime-not-compile-time", "title": "How to change glog log level at runtime, not compile time?", "body": "<p>I'm using the <a href=\"https://github.com/golang/glog\" rel=\"nofollow noreferrer\"><code>github.com/golang/glog</code></a>, and want to change the flag <code>stderrthreshold</code> or <em>V-leveled logging</em> at runtime, that is without re-compile the binary and re-run it. I had searched some resource, but all the answers are changes at compile time. Is there anyway to change it at runtime cause I don't want to stop my service?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 8, "creation_date": 1523927144, "post_id": 49868199, "comment_id": 86752133, "body": "Sort your bytes to read, then read by few-kilobytes chunks (in case if bytes are close enough) by a single thread. Otherwise - you cannot improve it, it&#39;s an IO-bound problem, not CPU-bound: get a faster disk."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1523936082, "post_id": 49868199, "comment_id": 86754169, "body": "If you have to check that many dispersed bytes of a file, much or most of it is probably getting read anyway, as the minimum I/O is either 512 or 4096 depending on the disk and some other factors. It would be better to get faster storage, and better still to redesign whatever is creating those files so that the data you need is easier to get at."}], "answers": [{"tags": [], "owner": {"reputation": 5101, "user_id": 153586, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3bc43786cfcbc75521a28870e76759c1?s=128&d=identicon&r=PG", "display_name": "Sankar", "link": "https://stackoverflow.com/users/153586/sankar"}, "is_accepted": true, "score": 3, "last_activity_date": 1524032847, "creation_date": 1524032847, "answer_id": 49892611, "question_id": 49868199, "link": "https://stackoverflow.com/questions/49868199/reading-bytes-from-a-file-concurrently/49892611#49892611", "title": "Reading bytes from a file concurrently", "body": "<p>You slowness is because of I/O and not CPU. Adding more threads will not speed up your program. Read about Amdahl's law. <a href=\"https://en.wikipedia.org/wiki/Amdahl%27s_law\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Amdahl%27s_law</a></p>\n\n<p>If you do not want to read the full file into memory, you could either use a buffered reader and read in parts <a href=\"https://golang.org/pkg/bufio/#NewReader\" rel=\"nofollow noreferrer\">https://golang.org/pkg/bufio/#NewReader</a> or you could even consider using the experimental memory-mapped files package too: <a href=\"https://godoc.org/golang.org/x/exp/mmap\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/exp/mmap</a> </p>\n\n<p>To know more about memory mapped files, see <a href=\"https://en.wikipedia.org/wiki/Memory-mapped_file\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Memory-mapped_file</a></p>\n"}], "owner": {"reputation": 522, "user_id": 5340349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d9d49acc545b7d97ea5b6a9e203b1e6?s=128&d=identicon&r=PG&f=1", "display_name": "JGut", "link": "https://stackoverflow.com/users/5340349/jgut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 738, "favorite_count": 0, "accepted_answer_id": 49892611, "answer_count": 1, "score": 1, "last_activity_date": 1524032847, "creation_date": 1523926231, "question_id": 49868199, "link": "https://stackoverflow.com/questions/49868199/reading-bytes-from-a-file-concurrently", "title": "Reading bytes from a file concurrently", "body": "<p>I've written a program in Go that reads a single byte from a file and checks to see which bits are set. These files are usually pretty large (around 10 - 100 GB), so I don't want to read the entire file into memory. The program normally has to check millions of separate bytes.</p>\n\n<p>Right now, the way I'm performing these reads is by using <code>os.File.ReadAt()</code>. This ended up being pretty slow, so I tried to use Goroutines to speed it up. For example:</p>\n\n<pre><code>var wg sync.WaitGroup\nthreadCount := 8\n\nfor i := 0; i &lt; threadCount; i += 1 {\n    wg.Add(1)\n    go func(id int) {\n        defer wg.Done()\n        index := id\n        myByte := make([]byte, 1)\n\n        for index &lt; numBytesInFile-1 {  // Stop when thread would attempt to read byte outside of file\n            fmt.Println(file.ReadAt(myByte, index))\n            index += threadCount\n        }\n    }(i)\n}\nwg.Wait()\n</code></pre>\n\n<p>However, using Goroutines here didn't speed the program up at all (in fact, it made it slightly slower due to overhead).  I would have thought that files on the disc could be read concurrently as long as they are opened in read-only mode (which I do in my program).  Is what I'm asking for impossible, or <strong>is there some way I make concurrent reads to a file in Go?</strong></p>\n"}, {"tags": ["xml", "go"], "answers": [{"comments": [{"owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "edited": false, "score": 0, "creation_date": 1524014171, "post_id": 49881386, "comment_id": 86795350, "body": "Well I guess that&#39;ll work. Lot of set up though. Thanks!"}], "tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": true, "score": 2, "last_activity_date": 1523976942, "creation_date": 1523976942, "answer_id": 49881386, "question_id": 49866903, "link": "https://stackoverflow.com/questions/49866903/how-to-find-the-value-of-a-known-attribute-and-token-using-the-xml-golang-std-l/49881386#49881386", "title": "How to find the value of a known attribute and token using the xml golang std. lib", "body": "<p>You can use the <code>encoding/xml</code> package to parse your data. For example, define types representing your XML data:</p>\n\n<pre><code>type Something struct {\n    InnerSomething struct {\n        Foo struct {\n            Bar string `xml:\"bar,attr\"`\n        } `xml:\"foo\"`\n    } `xml:\"inner_something\"`\n} \n\ntype Result struct {\n    Something `xml:\"something\"`\n}\n</code></pre>\n\n<p>Then parse the data:</p>\n\n<pre><code>func main() {\n    data := `\n&lt;something&gt;\n    &lt;inner_something&gt;\n        &lt;foo bar='VALUE_I_WANT'&gt;test\n        &lt;/foo &gt;\n    &lt;/inner_something&gt;\n&lt;/something&gt;`\n    v := Result{}\n    err := xml.Unmarshal([]byte(data), &amp;v)\n    if err != nil {\n        fmt.Printf(\"error: %v\", err)\n        return\n    }\n    fmt.Printf(\"bar: %q\", v.Something.InnerSomething.Foo.Bar)\n}\n</code></pre>\n\n<p>See <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/xml/</a>.</p>\n\n<p><a href=\"https://play.golang.org/p/Mv2mZLNVoUc\" rel=\"nofollow noreferrer\">Here</a> is a working sample in the Go Playground.</p>\n"}], "owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 49881386, "answer_count": 1, "score": 0, "last_activity_date": 1523976942, "creation_date": 1523916207, "last_edit_date": 1523916643, "question_id": 49866903, "link": "https://stackoverflow.com/questions/49866903/how-to-find-the-value-of-a-known-attribute-and-token-using-the-xml-golang-std-l", "title": "How to find the value of a known attribute and token using the xml golang std. lib", "body": "<p>I'm parsing the body of an http request that is set up in like this:</p>\n\n<pre><code>&lt;something&gt;\n...\n&lt;inner_something&gt; \n...\n&lt;foo bar='VALUE_I_WANT'&gt;\n... \n&lt;/FOO &gt;\n...\n&lt;/inner_something&gt;\n...\n&lt;/something&gt;\n</code></pre>\n\n<p>What is an idiomatic approach to finding <code>VALUE_I_WANT</code>? Can I loop though the tokens using a decoder? How can check that a token is foo and get the attribute bar? (those names are constant). Is that the only way using the std lib? No way to look up tokens directly? </p>\n"}, {"tags": ["go", "dynamic", "struct"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523913865, "post_id": 49866336, "comment_id": 86748367, "body": "You cannot extend structs at runtime. You&#39;ll have to build a map that you can then JSON encode. sql.Rows.Columns and .ColumnTypes return column names and types of a result set, respectively. You shouldn&#39;t need to query that other table."}], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 9650881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08dc818229903e843cfbf6dfb812c2a6?s=128&d=identicon&r=PG&f=1", "display_name": "oxshxll", "link": "https://stackoverflow.com/users/9650881/oxshxll"}, "is_accepted": false, "score": 1, "last_activity_date": 1523953011, "creation_date": 1523953011, "answer_id": 49873060, "question_id": 49866336, "link": "https://stackoverflow.com/questions/49866336/how-to-dynamically-map-a-database-table-in-golang/49873060#49873060", "title": "How to dynamically map a database table in Golang?", "body": "<p>I would sugges first querying the current tables of your table through a prepared statement: </p>\n\n<pre><code>SELECT * FROM [DatabaseName].INFORMATION_SCHEMA.COLUMNS\nWHERE TABLE_NAME = N'MyTable'\n</code></pre>\n\n<p>Store the results of the query in a string slice. After doing so, create a map with <code>string</code> keys and <code>*interface{}</code> values. </p>\n\n<pre><code> results := make(map[string](*interface{})\n</code></pre>\n\n<p>While iterating over results of your actual query, you can finally assign the values from your previous query to map the results. </p>\n\n<p>Kyle Banks offers a great explanation on receiving dynamic results from Query results on <a href=\"https://kylewbanks.com/blog/query-result-to-map-in-golang\" rel=\"nofollow noreferrer\">this</a> article. </p>\n\n<p>If for any reason you need to actually specify the type of the results, the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\"><code>reflect</code> package</a> will be of a lot of help on auto-resolving the value type for your needs. </p>\n"}], "owner": {"reputation": 71, "user_id": 9378201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36858eae1cf263e91384a4445c8017ec?s=128&d=identicon&r=PG&f=1", "display_name": "pitw", "link": "https://stackoverflow.com/users/9378201/pitw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1357, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1523953011, "creation_date": 1523913247, "question_id": 49866336, "link": "https://stackoverflow.com/questions/49866336/how-to-dynamically-map-a-database-table-in-golang", "title": "How to dynamically map a database table in Golang?", "body": "<p>I have to create a JSON from  a MS-SQL Database through Go. The problem is that some database fields are created dynamically in backend system (not Go).</p>\n\n<p>There could be:</p>\n\n<pre><code>type Demotable struct{\nId int\nName string\nAdress int\nZ_somedynamicfield string\nZ_anotherfield int\n}\n</code></pre>\n\n<p>All fields prefixed with \"Z_\" are dynamic, so struct could also be:</p>\n\n<pre><code>type Demotable struct{\nId int\nName string\nAdress int\nZ_completedifferent int\nZ_notlikefirst string\nZ_evenmorefields string\n}\n</code></pre>\n\n<p>I also have a helper table where every \"dynamic field\" is described:</p>\n\n<pre><code>| tableName | fieldName          | fieldType |\n+-----------+--------------------+-----------+\n| Demotable | Z_somedynamicfield | string    |\n+-----------+--------------------+-----------+\n| Demotable | Z_anotherfield     | int       |\n...\n</code></pre>\n\n<p>Ideally I would dynamically \"extend\" struct with infos from helper table - but I don't have an idea how or if this even is possible?</p>\n"}, {"tags": ["reactjs", "go", "mlab"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523912340, "post_id": 49865752, "comment_id": 86747649, "body": "Is your server handling <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Preflighted_requests\" rel=\"nofollow noreferrer\">OPTION requests</a>?"}, {"owner": {"reputation": 21, "user_id": 7323252, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154963311049729/picture?type=large", "display_name": "Makayla Clausen", "link": "https://stackoverflow.com/users/7323252/makayla-clausen"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523915704, "post_id": 49865752, "comment_id": 86749117, "body": "@peter No I don&#39;t believe it is"}, {"owner": {"reputation": 341, "user_id": 529321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e974ce23b1f3016285b373fcba49c310?s=128&d=identicon&r=PG", "display_name": "skomp", "link": "https://stackoverflow.com/users/529321/skomp"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523943030, "post_id": 49865752, "comment_id": 86756245, "body": "As @Peter mentioned, you should handle the OPTIONS request. Frameworks like gorilla can do this automatically for you."}, {"owner": {"reputation": 21, "user_id": 7323252, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154963311049729/picture?type=large", "display_name": "Makayla Clausen", "link": "https://stackoverflow.com/users/7323252/makayla-clausen"}, "reply_to_user": {"reputation": 341, "user_id": 529321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e974ce23b1f3016285b373fcba49c310?s=128&d=identicon&r=PG", "display_name": "skomp", "link": "https://stackoverflow.com/users/529321/skomp"}, "edited": false, "score": 0, "creation_date": 1523993572, "post_id": 49865752, "comment_id": 86788299, "body": "@skomp I am using Gorilla Mux already, is it a different Gorilla package?"}, {"owner": {"reputation": 341, "user_id": 529321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e974ce23b1f3016285b373fcba49c310?s=128&d=identicon&r=PG", "display_name": "skomp", "link": "https://stackoverflow.com/users/529321/skomp"}, "edited": false, "score": 0, "creation_date": 1523995017, "post_id": 49865752, "comment_id": 86788997, "body": "@Makayla Clausen then check this out: <a href=\"http://www.gorillatoolkit.org/pkg/handlers#CORS\" rel=\"nofollow noreferrer\">gorillatoolkit.org/pkg/handlers#CORS</a> the basic example will handle option requests, you might need to add more settings depending on your service, though."}], "owner": {"reputation": 21, "user_id": 7323252, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154963311049729/picture?type=large", "display_name": "Makayla Clausen", "link": "https://stackoverflow.com/users/7323252/makayla-clausen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 188, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523910660, "creation_date": 1523910660, "question_id": 49865752, "link": "https://stackoverflow.com/questions/49865752/pushing-to-a-go-mongodb-backend-with-reactjs", "title": "Pushing to a Go/MongoDB backend with ReactJS", "body": "<p>I have built a backend using Go with a Mlab Database that I am now trying to Post to using a ReactJS frontend, but every time I try to Post I get a 405 error. I have tested the backend using Postman so I know it accepts Post requests, I must be missing something in React. Does anyone have any ideas as to what is missing? </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>import React, { Component } from 'react';\r\nimport '../Styles/App.css';\r\n\r\n\r\nclass RSVP extends Component {\r\n\r\n  submitRSVP = (e) =&gt; {\r\n      e.preventDefault();\r\n      let newRSVP = {\r\n          first: e.target.first.value,\r\n          last: e.target.last.value,\r\n          attending: e.target.attending.value,\r\n          children: e.target.children.value,\r\n          adults: e.target.adults.value,\r\n      }\r\n      console.log(newRSVP);\r\n      this.createRSVP(newRSVP)\r\n    }\r\n  async createRSVP(rsvp){\r\n  const response = await fetch('https://infinite-mountain-41867.herokuapp.com/guests', {\r\n      method: 'POST',\r\n      body: JSON.stringify(rsvp),\r\n      headers:{\r\n        'Content-Type': 'application/json',\r\n        'Accept': 'application/json',\r\n\r\n      }\r\n    })\r\n    console.log(response);\r\n    this.componentDidMount()\r\n  }\r\n\r\n\r\n\r\n\r\n  render() {\r\n    return (\r\n      &lt;div className=\"rsvp\"&gt;\r\n        &lt;h1 className = \"rsvpHead\"&gt; Please RSVP by November 1, 2018 &lt;/h1&gt;\r\n        &lt;form className = \"rsvpForm\" onSubmit={this.submitRSVP}&gt;\r\n          &lt;label&gt;Names of Invited Guests&lt;/label&gt;\r\n          &lt;input type = \"text\" id = \"first\" className = \"rsvpInput\" placeholder=\"First Name\" name = \"first\" formMethod = \"POST\" required/&gt;\r\n          &lt;input type = \"text\" id = \"last\" className = \"rsvpInput\" placeholder=\"Last Name\" name = \"last\" formMethod = \"POST\" required/&gt;\r\n          &lt;label&gt;Attending?&lt;/label&gt;\r\n          &lt;input type = \"text\" id = \"attending\" className = \"rsvpInput\" placeholder =\"Yes/No\" name=\"attending\" formMethod = \"POST\" required/&gt;\r\n          &lt;div className = \"attending\"&gt;\r\n          &lt;input type = \"number\" id=\"adults\" className = \"rsvpInput adultNumber\" placeholder = \"# of Adults\" name=\"adults\" formMethod = \"POST\" required/&gt;\r\n          &lt;input type = \"number\" id=\"children\" className = \"rsvpInput childNumber\" placeholder = \"# of Children\" name=\"children\" formMethod = \"POST\" required/&gt;\r\n          &lt;/div&gt;\r\n          &lt;button type = \"submit\"&gt;Submit&lt;/button&gt;\r\n        &lt;/form&gt;\r\n      &lt;/div&gt;\r\n    );\r\n  }\r\n}\r\n\r\nexport default RSVP;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1523910582, "post_id": 49865699, "comment_id": 86746783, "body": "If the slice of bytes is already in UTF-8, that&#39;d just be <code>string(bytes)</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523911076, "post_id": 49865699, "comment_id": 86747015, "body": "What is the encoding of the []byte?  If it&#39;s already UTF-8, then use the conversion as suggested in the previous comment."}, {"owner": {"reputation": 7, "user_id": 9655246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c24e7574e5e87b2523131dac47beef21?s=128&d=identicon&r=PG&f=1", "display_name": "Mald", "link": "https://stackoverflow.com/users/9655246/mald"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523912666, "post_id": 49865699, "comment_id": 86747813, "body": "@CeriseLim&#243;n  is there a way to programmatically detect the encoding of the slice of bytes ? for instance how to know which encoding is the return type of <a href=\"https://golang.org/pkg/crypto/rsa/#EncryptPKCS1v15\" rel=\"nofollow noreferrer\">golang.org/pkg/crypto/rsa/#EncryptPKCS1v15</a> ?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1523914794, "post_id": 49865699, "comment_id": 86748753, "body": "EncryptPKCS1v15, like most encryption algorithms, yields random bytes, not displayable strings. You have to encode the output to display it. base64 encoding is a popular choice."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523915574, "post_id": 49865699, "comment_id": 86749069, "body": "Hex encoding is another popular choice.  @Mald edit the question to describe your actual problem: How to convert output from EncryptPKCS1v15 to UTF-8 string?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1523973748, "post_id": 49865699, "comment_id": 86776053, "body": "You probably need something in <a href=\"https://golang.org/pkg/crypto/x509/\" rel=\"nofollow noreferrer\">crypto/x509</a>."}], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 9655246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c24e7574e5e87b2523131dac47beef21?s=128&d=identicon&r=PG&f=1", "display_name": "Mald", "link": "https://stackoverflow.com/users/9655246/mald"}, "edited": false, "score": 0, "creation_date": 1523912913, "post_id": 49865848, "comment_id": 86747940, "body": "Will it work with the return of <a href=\"https://golang.org/pkg/crypto/rsa/#EncryptPKCS1v15\" rel=\"nofollow noreferrer\">golang.org/pkg/crypto/rsa/#EncryptPKCS1v15</a> ?"}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "reply_to_user": {"reputation": 7, "user_id": 9655246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c24e7574e5e87b2523131dac47beef21?s=128&d=identicon&r=PG&f=1", "display_name": "Mald", "link": "https://stackoverflow.com/users/9655246/mald"}, "edited": false, "score": 0, "creation_date": 1523915719, "post_id": 49865848, "comment_id": 86749126, "body": "@Mald that function does not return a UTF-8 encoded string, you probably want to use Base64 or hexadecimal encoding if you&#39;re trying to serialize encrypted data."}], "tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1523911066, "creation_date": 1523911066, "answer_id": 49865848, "question_id": 49865699, "link": "https://stackoverflow.com/questions/49865699/get-utf-8-encoded-string-from-byte/49865848#49865848", "title": "Get UTF-8 encoded string from byte[]", "body": "<pre><code>func bytesToUTF8string(bytes []byte) string {\n    return string(bytes)\n}\n</code></pre>\n\n<p>It's such a common, simple operation that it's arguably not worth wrapping in a function. Unless, of course, you need to translate the from a different source encoding, then it's an entirely different issue, with which <a href=\"https://godoc.org/golang.org/x/text/encoding\" rel=\"nofollow noreferrer\">the <code>golang.org/x/text/encoding</code> package</a> might help</p>\n"}], "owner": {"reputation": 7, "user_id": 9655246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c24e7574e5e87b2523131dac47beef21?s=128&d=identicon&r=PG&f=1", "display_name": "Mald", "link": "https://stackoverflow.com/users/9655246/mald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1523949357, "creation_date": 1523910417, "last_edit_date": 1523949357, "question_id": 49865699, "link": "https://stackoverflow.com/questions/49865699/get-utf-8-encoded-string-from-byte", "title": "Get UTF-8 encoded string from byte[]", "body": "<p>I'm looking to convert a slice  of bytes <code>[]byte</code> into an UTF-8 <code>string</code>.</p>\n\n<p>I want to write a function like that : </p>\n\n<pre><code>func bytesToUTF8string(bytes []byte)(string){\n\n  // Take the slice of bytes and encode it to UTF-8 string\n  // return the UTF-8 string\n\n}\n</code></pre>\n\n<p>What is the most efficient way to perform this </p>\n\n<p>EDIT :</p>\n\n<p>Specifically I want to convert the output of crypto.rsa.EncryptPKCS1v15 or the output of SignPKCS1v15 to an UTF-8 encoded string.</p>\n\n<p>How can I do it ?</p>\n"}, {"tags": ["node.js", "go", "websocket"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523909832, "post_id": 49865285, "comment_id": 86746451, "body": "The first request is probably a <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#Preflighted_requests\" rel=\"nofollow noreferrer\">preflight request</a>. Check the request method, which should be OPTIONS, and handle that request first."}, {"owner": {"reputation": 13, "user_id": 8767204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/912f614776e3dc0c718d88feba64a415?s=128&d=identicon&r=PG&f=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/8767204/paul"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523909971, "post_id": 49865285, "comment_id": 86746518, "body": "@Peter I used to handle the OPTIONS first at my golang part, but I am getting the same error which is 202 for options but still 400 for GET. Btw why do I do not have to go through the preflight request when using google console?"}, {"owner": {"reputation": 13, "user_id": 8767204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/912f614776e3dc0c718d88feba64a415?s=128&d=identicon&r=PG&f=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/8767204/paul"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523911555, "post_id": 49865285, "comment_id": 86747260, "body": "@CeriseLim&#243;n I am doing almost the same thing in my Angular controller .   <code>import WebSocket from&#39;ws&#39;;   const ws = new WebSocket(&#39;ws:&#47;&#47;localhost:8080&#47;ws&#39;, {     origin: &quot;http:&#47;&#47;localhost:4000&quot; });   ws.onmessage = function(msg) { console.log(&quot;Received message:&quot;, JSON.parse(msg.data)) }</code>"}, {"owner": {"reputation": 13, "user_id": 8767204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/912f614776e3dc0c718d88feba64a415?s=128&d=identicon&r=PG&f=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/8767204/paul"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523912195, "post_id": 49865285, "comment_id": 86747577, "body": "@CeriseLim&#243;n For server side it listen to <code>http:&#47;&#47;localhost:8080</code> and client side for <code>http:&#47;&#47;localhost:4000</code>"}, {"owner": {"reputation": 13, "user_id": 8767204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/912f614776e3dc0c718d88feba64a415?s=128&d=identicon&r=PG&f=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/8767204/paul"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523914773, "post_id": 49865285, "comment_id": 86748740, "body": "@CeriseLim&#243;n Tried this before. Also for the upgrader, it already returns true for all Origin. Anything I can add?"}, {"owner": {"reputation": 13, "user_id": 8767204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/912f614776e3dc0c718d88feba64a415?s=128&d=identicon&r=PG&f=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/8767204/paul"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523942495, "post_id": 49865285, "comment_id": 86756086, "body": "@CeriseLim&#243;n  It works when I used web browser client but fails on Node client. So yes, I was asking about how to fix it on Node"}, {"owner": {"reputation": 13, "user_id": 8767204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/912f614776e3dc0c718d88feba64a415?s=128&d=identicon&r=PG&f=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/8767204/paul"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523973511, "post_id": 49865285, "comment_id": 86775869, "body": "@CeriseLim&#243;n Client side console in question means the error I got from chrome devtools when I ran my angular code with node server. Google console is the result that I just use chrome devtools to setup websocket and it works"}], "owner": {"reputation": 13, "user_id": 8767204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/912f614776e3dc0c718d88feba64a415?s=128&d=identicon&r=PG&f=1", "display_name": "Paul", "link": "https://stackoverflow.com/users/8767204/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 333, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1523908714, "creation_date": 1523908714, "question_id": 49865285, "link": "https://stackoverflow.com/questions/49865285/node-websocket-client-side-listen-to-golang-websocket-server", "title": "Node websocket client side listen to Golang websocket server", "body": "<p>I am trying to post messages using Golang websocket and listen on Node client side.</p>\n\n<p>Here's part of code:</p>\n\n<p>Golang:</p>\n\n<pre><code>func NewUpgrader() *websocket.Upgrader {\n    return &amp;websocket.Upgrader{\n        ReadBufferSize:  1024,\n        WriteBufferSize: 1024,\n        CheckOrigin: func(r *http.Request) bool {\n            return true\n        },\n}\n\nfunc (s WebsocketHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    upgrader := NewUpgrader()\n    ws, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Errorf(\"websocket: could not upgrade %v\", err)\n        fmt.Fprintf(w, \"websocket: could not upgrade %v\", err)\n        return\n    }\n\n    go func() {\n        defer ws.Close()\n        for msg := range s.Messages {\n            json, _ := json.Marshal(msg)\n            err := ws.WriteMessage(1, json)\n            if err != nil {\n                log.Errorf(\"websocket: error sending message: %v\", err)\n            }\n        }\n    }()\n</code></pre>\n\n<p>By doing this I can get all the messages when I run the code below on Google console </p>\n\n<p><code>ws = new WebSocket('ws://localhost:8080/ws')\nws.onmessage = function(msg) { console.log(JSON.parse(msg.data)) }</code></p>\n\n<p>And I add the same two lines code on my client side, now I got these errors</p>\n\n<p>Golang side:</p>\n\n<p><code>INFO[0009] 400 GET localhost:8080/ws (0 bytes) id: 77b7355412f2ffcd\nERRO[0009] websocket: could not upgrade websocket: not a websocket handshake: 'upgrade' token not found in 'Connection' header</code></p>\n\n<p>Client side(browser console):</p>\n\n<p><code>GET http://localhost:8080/ws 400 (Bad Request)\nFailed to load http://localhost:8080/ws: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:4000' is therefore not allowed access. The response had HTTP status code 400. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\nUncaught (in promise) TypeError: Failed to fetch</code></p>\n\n<p>I tried to compare these two get request(Google console vs my client-side code). I found out that for google console there's a header <code>Connection:[Upgrade]</code>, but the header looks like this <code>Connection:[keep-alive]</code> in my client-side code.</p>\n\n<p>Not sure if this is the reason why I can not connect these two, any ideas?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1523898093, "post_id": 49862592, "comment_id": 86740325, "body": "Empty length slices in Go are usually <code>nil</code>. A panic will not be generated when trying to take the <code>len</code> of a <code>nil</code> slice slice, nor when ranging over one."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523903645, "post_id": 49862592, "comment_id": 86743437, "body": "copy and append work fine with nil slices too. Protocol buffers are designed to produce small messages, so omitting an empty optional collection entirely makes sense. If you <i>really</i> care about the nil slice you can probably initialize the struct field before calling Hello."}], "owner": {"reputation": 1183, "user_id": 4274484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0dPT2.jpg?s=128&g=1", "display_name": "hypnoglow", "link": "https://stackoverflow.com/users/4274484/hypnoglow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1353, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1523949322, "creation_date": 1523897870, "last_edit_date": 1523949322, "question_id": 49862592, "link": "https://stackoverflow.com/questions/49862592/repeated-field-with-0-elements-results-in-nil-on-client-side", "title": "Repeated field with 0 elements results in nil on client side", "body": "<p>Question:</p>\n\n<p>I wonder why do I get <strong>nil</strong> value on gRPC client when server responds with\nempty slice on <code>repeated</code> field?</p>\n\n<p>Is there any reference/documentation explicitly describing this behavior?</p>\n\n<hr>\n\n<p>Consider the following example:</p>\n\n<p>Simple proto file definitions:</p>\n\n<pre><code>syntax = \"proto3\";\n\noption go_package = \"testdata\";\n\nservice Greeter {\n    rpc Hello (HelloRequest) returns (HelloResponse) {}\n}\n\nmessage HelloRequest {\n    string name = 1;\n}\n\nmessage HelloResponse {\n    repeated string greetings = 1;\n}\n</code></pre>\n\n<p>Greeter service implementation:</p>\n\n<pre><code>type Hello struct{}\n\nfunc (*Hello) Hello(ctx context.Context, req *pb.HelloRequest) (*pb.HelloResponse, error) {\n    return &amp;pb.HelloResponse{\n        Greetings: []string{}, // Note: a slice with 0 elements (not nil slice)\n    }, nil\n}\n</code></pre>\n\n<p>Server implementation:</p>\n\n<pre><code>srv := grpc.NewServer()\npb.RegisterGreeterServer(srv, &amp;Hello{})\n\nlis, err := net.Listen(\"tcp\", \":8123\")\nif err != nil {\n    panic(err)\n}\n\nif err := srv.Serve(lis); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Client code:</p>\n\n<pre><code>    cc, err := grpc.Dial(\":8123\", grpc.WithBlock(), grpc.WithInsecure())\nif err != nil {\n    panic(err)\n}\n\nclient := testdata.NewGreeterClient(cc)\nresp, err := client.Hello(context.TODO(), &amp;testdata.HelloRequest{})\nif err != nil {\n    panic(err)\n}\n\nfmt.Printf(\"%#v\", resp.GetGreetings())\n</code></pre>\n\n<p>Result output:</p>\n\n<pre><code>[]string(nil)\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "google-kubernetes-engine"], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 6, "last_activity_date": 1523891716, "creation_date": 1523891716, "answer_id": 49860773, "question_id": 49860018, "link": "https://stackoverflow.com/questions/49860018/what-are-the-goos-and-goarch-values-to-build-go-executable-file-on-gcp-container/49860773#49860773", "title": "What are the GOOS and GOARCH values to build go executable file on GCP Container-Optimized OS", "body": "<p>Container-Optimized OS is a Linux derivate, and to the best of my knowledge all GCE instances are x86_64 machines. This machine is a n1-standard-1 with the stable COS image:</p>\n\n<pre><code>user@instance-1 ~ $ uname -a\nLinux instance-1 4.4.111+ #1 SMP Thu Apr 5 21:21:21 PDT 2018 x86_64 Intel(R) Xeon(R) CPU @ 2.50GHz GenuineIntel GNU/Linux\n</code></pre>\n\n<p>So to build for COS use</p>\n\n<pre><code>GOOS=linux GOARCH=amd64\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 3728271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80517d46357349c3ae38c64860d11a08?s=128&d=identicon&r=PG", "display_name": "Alec Holmes", "link": "https://stackoverflow.com/users/3728271/alec-holmes"}, "is_accepted": false, "score": -1, "last_activity_date": 1523892296, "creation_date": 1523892296, "answer_id": 49860949, "question_id": 49860018, "link": "https://stackoverflow.com/questions/49860018/what-are-the-goos-and-goarch-values-to-build-go-executable-file-on-gcp-container/49860949#49860949", "title": "What are the GOOS and GOARCH values to build go executable file on GCP Container-Optimized OS", "body": "<p>Here's an example of building Go binaries for various processor architectures and operating systems:</p>\n\n<pre><code>#!/usr/bin/env bash\n\n# Build go binaries for the 3 main architectures that we can use on \ntagged releases\nfor GOOS in darwin linux windows; do\n    for GOARCH in 386 amd64; do\n        go build -v -o gm-fabric-proxy-$GOOS-$GOARCH\n    done\ndone\n</code></pre>\n\n<p>Basically GOOS tells the Go compiler which OS you want to compile to, and GOARCH tells the compiler which processor architecture it needs to conform to. </p>\n\n<p>On unix based systems you can run this command to find your processor architecture and operating sytem kernel info:</p>\n\n<pre><code>Alecs-MacPro:~ user$ uname -a\nDarwin Alecs-MacPro.local 17.4.0 Darwin Kernel Version 17.4.0: Sun Dec 17 09:19:54 PST 2017; root:xnu-4570.41.2~1/RELEASE_X86_64 x86_64\n</code></pre>\n\n<p>The script example provided above will create binaries for the 3 main operating systems and 2 main architectures.</p>\n"}], "owner": {"reputation": 453, "user_id": 3133957, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ead3f4f1cca145fd78487a65142df3ca?s=128&d=identicon&r=PG&f=1", "display_name": "prideloki", "link": "https://stackoverflow.com/users/3133957/prideloki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1690, "favorite_count": 0, "accepted_answer_id": 49860773, "answer_count": 2, "score": 1, "last_activity_date": 1523944327, "creation_date": 1523889596, "last_edit_date": 1523944327, "question_id": 49860018, "link": "https://stackoverflow.com/questions/49860018/what-are-the-goos-and-goarch-values-to-build-go-executable-file-on-gcp-container", "title": "What are the GOOS and GOARCH values to build go executable file on GCP Container-Optimized OS", "body": "<p>I am writing a script that will download the executable binary from Google cloud storage and execute it on the Google cloud compute. </p>\n\n<p>But, I don't know what would be the right values for <code>GOOS</code> and <code>GOARCH</code> environment variables to build the executable with <code>go build</code> command.</p>\n"}, {"tags": ["ssl", "go", "erlang", "rabbitmq"], "answers": [{"tags": [], "owner": {"reputation": 746, "user_id": 2414501, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/88b3f1fcfb3abd4089aecda5865a6406?s=128&d=identicon&r=PG", "display_name": "Filipe Gorges Reuwsaat", "link": "https://stackoverflow.com/users/2414501/filipe-gorges-reuwsaat"}, "is_accepted": true, "score": 0, "last_activity_date": 1523896738, "creation_date": 1523896738, "answer_id": 49862255, "question_id": 49859274, "link": "https://stackoverflow.com/questions/49859274/rabbitmq-tls-tls-connectionformat-status-2-crashed/49862255#49862255", "title": "RabbitMQ TLS tls_connection:format_status/2 crashed", "body": "<p>This line:</p>\n\n<pre><code>\"/certificates/server_key.pem\",{error,eacces}\n</code></pre>\n\n<p>It meant that RabbitMQ had no permission to read the file, so running:</p>\n\n<pre><code>chmod 0644 /certificates/server_key.pem\n</code></pre>\n\n<p>Solved the issue.</p>\n"}], "owner": {"reputation": 746, "user_id": 2414501, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/88b3f1fcfb3abd4089aecda5865a6406?s=128&d=identicon&r=PG", "display_name": "Filipe Gorges Reuwsaat", "link": "https://stackoverflow.com/users/2414501/filipe-gorges-reuwsaat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 646, "favorite_count": 0, "accepted_answer_id": 49862255, "answer_count": 1, "score": 0, "last_activity_date": 1596461547, "creation_date": 1523887531, "last_edit_date": 1523896820, "question_id": 49859274, "link": "https://stackoverflow.com/questions/49859274/rabbitmq-tls-tls-connectionformat-status-2-crashed", "title": "RabbitMQ TLS tls_connection:format_status/2 crashed", "body": "<p>I'm trying to make a simple TLS connection using Go, and RabbitMQ reports this issue upon attempting to create a connection with TLS enabled (Go client):</p>\n\n<pre><code>rabbitmq_1  | 2018-04-16 13:37:54.146 [error] &lt;0.537.0&gt; ** State machine &lt;0.537.0&gt; terminating\nrabbitmq_1  | ** Last event = {{call,{&lt;0.362.0&gt;,#Ref&lt;0.2669730211.1202454530.228189&gt;}},{new_user,&lt;0.359.0&gt;}}\nrabbitmq_1  | ** When server state  = {error,\"tls_connection:format_status/2 crashed\"}\nrabbitmq_1  | ** Reason for termination = error:function_clause\nrabbitmq_1  | ** Callback mode = state_functions\nrabbitmq_1  | ** Stacktrace =\nrabbitmq_1  | **  [{tls_connection,gen_handshake,[error,{call,{&lt;0.362.0&gt;,#Ref&lt;0.2669730211.1202454530.228189&gt;}},{new_user,&lt;0.359.0&gt;},{{options,{keyfil$\n,\"/certificates/server_key.pem\",{error,eacces}}},{state,server,{#Ref&lt;0.2669730211.1202454530.228187&gt;,&lt;0.362.0&gt;},gen_tcp,tls_connection,tcp,tcp_closed,$\ncp_error,\"localhost\",5671,#Port&lt;0.26641&gt;,{ssl_options,tls,[{3,3},{3,2},{3,1}],verify_none,{#Fun&lt;ssl.8.51913203&gt;,[]},#Fun&lt;ssl.9.51913203&gt;,false,false,u$\ndefined,1,&lt;&lt;\"/certificates/server_certificate.pem\"&gt;&gt;,undefined,&lt;&lt;\"/certificates/server_key.pem\"&gt;&gt;,undefined,[],undefined,&lt;&lt;\"/certificates/ca_certifica$\ne.pem\"&gt;&gt;,undefined,undefined,undefined,undefined,undefined,[&lt;&lt;\"\ufffd,\"&gt;&gt;,&lt;&lt;\"\ufffd0\"&gt;&gt;,&lt;&lt;\"\ufffd$\"&gt;&gt;,&lt;&lt;\"\ufffd(\"&gt;&gt;,&lt;&lt;\"\ufffd.\"&gt;&gt;,&lt;&lt;\"\ufffd2\"&gt;&gt;,&lt;&lt;\"\ufffd&amp;\"&gt;&gt;,&lt;&lt;\"\ufffd*\"&gt;&gt;,&lt;&lt;204,20&gt;&gt;,&lt;&lt;204,1$\n&gt;&gt;,&lt;&lt;204,21&gt;&gt;,&lt;&lt;0,159&gt;&gt;,&lt;&lt;0,163&gt;&gt;,&lt;&lt;0,107&gt;&gt;,&lt;&lt;0,106&gt;&gt;,&lt;&lt;0,157&gt;&gt;,&lt;&lt;0,61&gt;&gt;,&lt;&lt;\"\ufffd+\"&gt;&gt;,&lt;&lt;\"\ufffd/\"&gt;&gt;,&lt;&lt;\"\ufffd#\"&gt;&gt;,&lt;&lt;\"\ufffd'\"&gt;&gt;,&lt;&lt;\"\ufffd-\"&gt;&gt;,&lt;&lt;\"\ufffd1\"&gt;&gt;,&lt;&lt;\"\ufffd%\"&gt;&gt;,&lt;&lt;\"\ufffd)\"&gt;&gt;,&lt;&lt;0,1$\n8&gt;&gt;,&lt;&lt;0,162&gt;&gt;,&lt;&lt;0,103&gt;&gt;,&lt;&lt;0,64&gt;&gt;,&lt;&lt;0,156&gt;&gt;,&lt;&lt;0,60&gt;&gt;,&lt;&lt;\"\ufffd\\n\"&gt;&gt;,&lt;&lt;192,20&gt;&gt;,&lt;&lt;0,57&gt;&gt;,&lt;&lt;0,56&gt;&gt;,&lt;&lt;192,5&gt;&gt;,&lt;&lt;192,15&gt;&gt;,&lt;&lt;0,53&gt;&gt;,&lt;&lt;\"\ufffd\\t\"&gt;&gt;,&lt;&lt;192,19&gt;&gt;,&lt;&lt;0,51&gt;&gt;$\n&lt;&lt;0,50&gt;&gt;,&lt;&lt;192,4&gt;&gt;,&lt;&lt;192,14&gt;&gt;,&lt;&lt;0,47&gt;&gt;,&lt;&lt;\"\ufffd\\b\"&gt;&gt;,&lt;&lt;192,18&gt;&gt;,&lt;&lt;0,22&gt;&gt;,&lt;&lt;0,19&gt;&gt;,&lt;&lt;192,3&gt;&gt;,&lt;&lt;\"\ufffd\\r\"&gt;&gt;,&lt;&lt;0,10&gt;&gt;],#Fun&lt;ssl.2.51913203&gt;,true,268435456,false,$\nrue,infinity,false,undefined,undefined,undefined,undefined,true,undefined,[],undefined,false,true,one_n_minus_one,undefined,false,{ssl_crl_cache,{inte$\nnal,[]}},[{sha512,ecdsa},{sha512,rsa},{sha384,ecdsa},{sha384,rsa},{sha256,ecdsa},{sha256,rsa},{sha224,ecdsa},{sha224,rsa},{sha,ecdsa},{sha,rsa},{sha,ds\na}],{elliptic_curves,[{1,3,132,0,39},{1,3,132,0,38},{1,3,132,0,35},{1,3,36,3,3,2,8,1,1,13},{1,3,132,0,36},{1,3,132,0,37},{1,3,36,3,3,2,8,1,1,11},{1,3,1\n32,0,34},{1,3,132,0,16},{1,3,132,0,17},{1,3,36,3,3,2,8,1,1,7},{1,3,132,0,10},{1,2,840,10045,3,1,7},{1,3,132,0,3},{1,3,132,0,26},{1,3,132,0,27},{1,3,132\n,0,32},{1,3,132,0,33},{1,3,132,0,24},{1,3,132,0,25},{1,3,132,0,31},{1,2,840,10045,3,1,1},{1,3,132,0,1},{1,3,132,0,2},{1,3,132,0,15},{1,3,132,0,9},{1,3,\n132,0,8},{1,3,132,0,30}]},false,false,262144},{socket_options,binary,raw,0,0,false},#{current_read =&gt; #{beast_mitigation =&gt; one_n_minus_one,cipher_stat\ne =&gt; undefined,client_verify_data =&gt; undefined,compression_state =&gt; undefined,mac_secret =&gt; undefined,secure_renegotiation =&gt; undefined,security_parame\nters =&gt; {security_parameters,&lt;&lt;0,0&gt;&gt;,0,0,0,0,0,0,0,0,0,0,0,undefined,undefined,undefined,undefined},sequence_number =&gt; 0,server_verify_data =&gt; undefine\nd},current_write =&gt; #{beast_mitigation =&gt; one_n_minus_one,cipher_state =&gt; undefined,client_verify_data =&gt; undefined,compression_state =&gt; undefined,mac_\nsecret =&gt; undefined,secure_renegotiation =&gt; undefined,security_parameters =&gt; {security_parameters,&lt;&lt;0,0&gt;&gt;,0,0,0,0,0,0,0,0,0,0,0,undefined,undefined,und\nefined,undefined},sequence_number =&gt; 0,server_verify_data =&gt; undefined},pending_read =&gt; #{beast_mitigation =&gt; one_n_minus_one,cipher_state =&gt; undefined\n,client_verify_data =&gt; undefined,compression_state =&gt; undefined,mac_secret =&gt; undefined,secure_renegotiation =&gt; undefined,security_parameters =&gt; {secur\nity_parameters,undefined,0,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,&lt;&lt;90\n,212,167,50,197,80,21,183,229,252,83,2,191,100,222,147,149,112,255,82,15,77,192,185,123,46,121,210,16,197,219,183&gt;&gt;,undefined},server_verify_data =&gt; un\ndefined},pending_write =&gt; #{beast_mitigation =&gt; one_n_minus_one,cipher_state =&gt; undefined,client_verify_data =&gt; undefined,compression_state =&gt; undefine\nd,mac_secret =&gt; undefined,secure_renegotiation =&gt; undefined,security_parameters =&gt; {security_parameters,undefined,0,undefined,undefined,undefined,undef\nined,undefined,undefined,undefined,...},...}},...}}],...},...]\nrabbitmq_1  | 2018-04-16 13:37:54.146 [error] &lt;0.537.0&gt; CRASH REPORT Process &lt;0.537.0&gt; with 0 neighbours crashed with reason: no function clause matchi\nng tls_connection:gen_handshake(error, {call,{&lt;0.362.0&gt;,#Ref&lt;0.2669730211.1202454530.228189&gt;}}, {new_user,&lt;0.359.0&gt;}, {{options,{keyfile,\"/certificates\n/server_key.pem\",{error,eacces}}},{state,server,{#Ref&lt;0.2669730211.1202454530.228187&gt;,...},...}}) line 714\nrabbitmq_1  | 2018-04-16 13:37:54.148 [error] &lt;0.203.0&gt; Supervisor tls_connection_sup had child undefined started with {tls_connection,start_link,undef\nined} at &lt;0.537.0&gt; exit with reason no function clause matching tls_connection:gen_handshake(error, {call,{&lt;0.362.0&gt;,#Ref&lt;0.2669730211.1202454530.22818\n9&gt;}}, {new_user,&lt;0.359.0&gt;}, {{options,{keyfile,\"/certificates/server_key.pem\",{error,eacces}}},{state,server,{#Ref&lt;0.2669730211.1202454530.228187&gt;,...}\n,...}}) line 714 in context child_terminated\nrabbitmq_1  | 2018-04-16 13:37:54.148 [error] &lt;0.360.0&gt; Supervisor {&lt;0.360.0&gt;,ranch_acceptors_sup} had child {acceptor,&lt;0.360.0&gt;,1} started with ranch_acceptor:start_link({sslsocket,nil,{#Port&lt;0.26210&gt;,{config,{ssl_options,tls,[{3,3},{3,2},{3,1}],verify_none,{#Fun&lt;ssl.8..&gt;,...},...},...}}}, ranch_ssl,\n &lt;0.359.0&gt;) at &lt;0.362.0&gt; exit with reason {{function_clause,[{tls_connection,gen_handshake,[error,{call,{&lt;0.362.0&gt;,#Ref&lt;0.2669730211.1202454530.228189&gt;\n}},{new_user,&lt;0.359.0&gt;},{{options,{keyfile,\"/certificates/server_key.pem\",{error,eacces}}},{state,server,{#Ref&lt;0.2669730211.1202454530.228187&gt;,&lt;0.362.0\n&gt;},gen_tcp,tls_connection,tcp,tcp_closed,tcp_error,\"localhost\",5671,#Port&lt;0.26641&gt;,{ssl_options,tls,[{3,3},{3,2},{3,1}],verify_none,{#Fun&lt;ssl.8.5191320\n3&gt;,[]},#Fun&lt;ssl.9.51913203&gt;,false,false,undefined,1,&lt;&lt;\"/certificates/server_certifica...\"&gt;&gt;,...},...}}],...},...]},...} in context child_terminated\n</code></pre>\n\n<p>This is my Go client:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"log\"\n  \"crypto/tls\"\n  \"crypto/x509\"\n  \"io/ioutil\"\n\n  \"github.com/streadway/amqp\"\n)\n\nfunc failOnError(err error, msg string) {\n  if err != nil {\n    log.Fatalf(\"%s: %s\", msg, err)\n    panic(fmt.Sprintf(\"%s: %s\", msg, err))\n  }\n}\nfunc main() {\n\ncfg := new(tls.Config)\ncfg.RootCAs = x509.NewCertPool()\n\nif ca, err := ioutil.ReadFile(\"/certificates/ca_certificate.pem\"); err == nil {\n  cfg.RootCAs.AppendCertsFromPEM(ca)\n}\n\nif cert, err := tls.LoadX509KeyPair(\"/certificates/client_certificate.pem\", \"/certificates/client_key.pem\"); err == nil {\n  cfg.Certificates = append(cfg.Certificates, cert)\n}\n\nconn, err := amqp.DialTLS(\"amqps://guest:guest@rabbitmq:5671\", cfg)\n\nfailOnError(err, \"Failed to connect to RabbitMQ\")\ndefer conn.Close()\n\nch, err := conn.Channel()\nfailOnError(err, \"Failed to open a channel\")\ndefer ch.Close()\n\nq, err := ch.QueueDeclare(\n  \"hello\", // name\n  false, // durable\n  false, // delete when unused\n  false, // exclusive\n  false, // no-wait\n  nil, // arguments\n)\nfailOnError(err, \"Failed to declare a queue\")\n\nmsgs, err := ch.Consume(\n q.Name, // queue\n \"\", // consumer\n true, // auto-ack\n false, // exclusive\n false, // no-local\n false, // no-wait\n nil, // args\n)\nfailOnError(err, \"Failed to register a consumer\")\n\nforever := make(chan bool)\n\ngo func() {\n  for d := range msgs {\n    log.Printf(\"Received a message: %s\", d.Body)\n  }\n}()\n\nlog.Printf(\" [*] Waiting for messages. To exit press CTRL+C\")\n&lt;-forever\n}\n</code></pre>\n\n<p>And this is my RabbitMQ config file:</p>\n\n<pre><code>loopback_users.guest = false\nlisteners.tcp.default = 5672\nhipe_compile = false\nmanagement.listener.port = 15672\nmanagement.listener.ssl = false\n\nlisteners.ssl.1 = 5671\nssl_options.cacertfile = /certificates/ca_certificate.pem\nssl_options.certfile = /certificates/server_certificate.pem\nssl_options.keyfile = /certificates/server_key.pem\n</code></pre>\n\n<p>I don't know Erlang nor do I have experience with RabbitMQ itself or even TLS for that matter, and this forum post was the closest I got for this issue:</p>\n\n<p><a href=\"https://bugs.erlang.org/browse/ERL-539\" rel=\"nofollow noreferrer\">https://bugs.erlang.org/browse/ERL-539</a></p>\n\n<p>Any ideas of what could cause this?</p>\n\n<p>Some additional details: </p>\n\n<ul>\n<li><strong>Erlang version</strong>: 20</li>\n<li><strong>Erlang SSL version</strong>: 20.2</li>\n<li><strong>RabbitMQ version</strong>: 3.7.4</li>\n<li>Running within <code>docker-compose</code> using RabbitMQ's official image</li>\n<li>I've generated the certificates using the <strong>tls-gen</strong> tool as suggested by the <a href=\"https://www.rabbitmq.com/ssl.html\" rel=\"nofollow noreferrer\" title=\"official documentation\">official documentation</a>.</li>\n</ul>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1523893322, "post_id": 49858970, "comment_id": 86737631, "body": "See this discussion: <a href=\"https://github.com/google/protobuf/issues/1606\" rel=\"nofollow noreferrer\">github.com/google/protobuf/issues/1606</a>"}], "owner": {"reputation": 547, "user_id": 1964084, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4hE9Q.jpg?s=128&g=1", "display_name": "Delio", "link": "https://stackoverflow.com/users/1964084/delio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1523886662, "creation_date": 1523886662, "question_id": 49858970, "link": "https://stackoverflow.com/questions/49858970/how-to-structure-a-key-based-search-grpc-call-with-protobuf", "title": "How to structure a key-based search gRPC call with protobuf", "body": "<p>a question about gRPC with protobuf. I'm essentially building a set of microservices and we use gRPC and protocol buffer version 3, language used is Go. Everything works well in most of the cases, however we have some rpc functions planned which should perform a search based on a set of keys. The issue we have is with say \"optional\" keys. Let's say we have a message with search keys like name,surname, location. IN this case if they are defaulted to empty string I can assume they don't have to be included in the search so in case i.e. we're using mongodb, we just use omitempty tag to exclude empty fields from the search. IN case of things like \"age\" we might assume that 0 age is null...even though it might be wrong in general. Furthermore if the key is of a boolean type: \"Active\" i.e., we'd like to search for specific values: true, folse...or to exclude it....but we don't have null in protobuf. Has anybody any idea about how to structure the call and the message in these cases?</p>\n"}, {"tags": ["go", "pagination"], "comments": [{"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 2, "creation_date": 1523883584, "post_id": 49857936, "comment_id": 86730469, "body": "What have you tried? Try something and come back when you get an error."}, {"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 0, "creation_date": 1523884235, "post_id": 49857936, "comment_id": 86730944, "body": "You want to slice the data before unmarshalling, or slice the unmarshalled result?"}, {"owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1523884679, "post_id": 49857936, "comment_id": 86731270, "body": "Slice the unmarshalled result"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1523892499, "post_id": 49859533, "comment_id": 86737111, "body": "I updated my question with a sample of the data. I need the name and description to be an entry (a index of a page). So as you can see, I am only dealing with objects, and I should find a way to extract {&quot;name&quot;: &quot;name1&quot;, &quot;description&quot;: &quot;description1&quot;} and append it to an array so that I can index it for pagination."}, {"owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1523966942, "post_id": 49859533, "comment_id": 86770939, "body": "I updated my question with the code I used to transform the data I need into an array that supports indexing. And I used the code you provided and it is working now. Thank you!"}], "tags": [], "owner": {"reputation": 2505, "user_id": 749521, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/302a64f5f51a7f8dc83c0881f4520eb5?s=128&d=identicon&r=PG", "display_name": "Steven Roose", "link": "https://stackoverflow.com/users/749521/steven-roose"}, "is_accepted": false, "score": 2, "last_activity_date": 1523888225, "creation_date": 1523888225, "answer_id": 49859533, "question_id": 49857936, "link": "https://stackoverflow.com/questions/49857936/golang-implementing-pagination-on-mapstringinterface-data/49859533#49859533", "title": "Golang implementing pagination on map[string]interface{} data", "body": "<p>If you're doing pagination, somewhere the data must be represented as a list instead of an object? I assume at some place in your JSON, you have a list of items, otherwise pagination doesn't make sense.</p>\n\n<p>It shouldn't be very hard, something simple like this should work:</p>\n\n<pre><code>const (\n    itemsPerPage = 10\n)\n\nvar data []map[string]interface{}\n\n// pages start at 1, can't be 0 or less.\nfunc GetDataPage(page int) []map[string]interface{} {\n    start := (page - 1) * itemsPerPage\n    stop := start + itemsPerPage\n\n    if start &gt; len(data) {\n        return nil\n    }\n\n    if stop &gt; len(data) {\n        stop = len(data)\n    }\n\n    return data[start:stop]\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "edited": false, "score": 0, "creation_date": 1523897613, "post_id": 49862302, "comment_id": 86740069, "body": "That&#39;s exactly what I am working on right now, I need to extract data and push it into an array so that I can use the index for pagination."}], "tags": [], "owner": {"reputation": 4171, "user_id": 3258698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f432d577e5550e36ec267b85884364?s=128&d=identicon&r=PG", "display_name": "hbejgel", "link": "https://stackoverflow.com/users/3258698/hbejgel"}, "is_accepted": false, "score": 0, "last_activity_date": 1523896918, "creation_date": 1523896918, "answer_id": 49862302, "question_id": 49857936, "link": "https://stackoverflow.com/questions/49857936/golang-implementing-pagination-on-mapstringinterface-data/49862302#49862302", "title": "Golang implementing pagination on map[string]interface{} data", "body": "<p>You are unmarshalling your json into a map which has no order by itself. In order to be able to paginate your results you need to order them in some way.</p>\n\n<p>One way of doing it is to sort your data and then store it into an array. But in order to paginate you need to have ordered data and that is not possible with a map. </p>\n"}], "owner": {"reputation": 69, "user_id": 6819138, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/532254326981860/picture?type=large", "display_name": "Dorra Hadrich", "link": "https://stackoverflow.com/users/6819138/dorra-hadrich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3048, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1523966539, "creation_date": 1523883514, "last_edit_date": 1523966539, "question_id": 49857936, "link": "https://stackoverflow.com/questions/49857936/golang-implementing-pagination-on-mapstringinterface-data", "title": "Golang implementing pagination on map[string]interface{} data", "body": "<p>I have a json file (nested json) that I am unmarshalling its content into a map[string]interface. Now I have to implement pagination as the data is large. The client side will send as a query parameter the desired page, how can I slice the data I have?\nThis is a snippet of the data I am dealing with:</p>\n\n<pre><code>\"packages\":{\n  \"pkg1\": {\n    \"meta\": {\n      \"description\": \"description1\",\n      \"name\": \"pkg1.1\"\n    },\n    \"name\": \"pkg1.1\"\n  },\n  \"pkg2\": {\n    \"meta\": {\n      \"description\": \"description2\",\n      \"name\": \"pkg2.2\"\n    },\n    \"name\": \"pkg2.2\"\n  },\n}\n</code></pre>\n\n<p>So what I did is that I recursively iterated through the data and created an <em>array</em> of a custom type containing the data I need (name, description) for each entry so that I can use it for pagination. Here is the code I used:</p>\n\n<pre><code>type Object struct {\n    name string\n    description string\n}\n\nfunc iterate(aMap map[string]interface{}, result *[]Object){\nfor key, val := range aMap {\n    switch val.(type) {\n        case map[string]interface{}:\n            if(key == \"meta\"){\n                switch reflect.TypeOf(val).Kind() { \n                    case reflect.Map:\n                        s := reflect.ValueOf(val)\n                        var tmpData Object\n                        if(s.MapIndex(reflect.ValueOf(\"name\")).IsValid()){\n                            tmpData.name = s.MapIndex(reflect.ValueOf(\"name\")).Interface().(string)\n                        }\n\n                        if(s.MapIndex(reflect.ValueOf(\"description\")).IsValid()){\n                            tmpData.description = s.MapIndex(reflect.ValueOf(\"description\")).Interface().(string)\n                        }\n                        *result = append(*result, tmpData)\n                }\n            }\n            iterate(val.(map[string]interface{}), result)\n        default: //DO NOTHING!!\n        }\n}\n}\n</code></pre>\n"}, {"tags": ["go", "hyperledger-fabric", "hyperledger"], "answers": [{"tags": [], "owner": {"reputation": 671, "user_id": 8383973, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LMxjr.jpg?s=128&g=1", "display_name": "adnan.c", "link": "https://stackoverflow.com/users/8383973/adnan-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1523895064, "last_edit_date": 1523895064, "creation_date": 1523889553, "answer_id": 49860000, "question_id": 49855723, "link": "https://stackoverflow.com/questions/49855723/hyperledger-fabric-chaincode-not-updated/49860000#49860000", "title": "HyperLedger fabric chaincode not updated", "body": "<p>I would guess you alrwady have version 1.0 installed, thats why its complaining that it already exists. Try it with 1.1 or 2.0 by using <code>-v 2.0</code> instead of <code>-v 1.0</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 983, "user_id": 6499004, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I0fHv3jbsbs/AAAAAAAAAAI/AAAAAAAADUo/bejrpeXzWwg/photo.jpg?sz=128", "display_name": "mahima", "link": "https://stackoverflow.com/users/6499004/mahima"}, "is_accepted": true, "score": 4, "last_activity_date": 1523898924, "creation_date": 1523898924, "answer_id": 49862887, "question_id": 49855723, "link": "https://stackoverflow.com/questions/49855723/hyperledger-fabric-chaincode-not-updated/49862887#49862887", "title": "HyperLedger fabric chaincode not updated", "body": "<p>To make the changes in the chaincode made reflect, following steps were taken:\n1. Stop all the containers</p>\n\n<pre><code>docker stop $(docker ps -aq)\n</code></pre>\n\n<ol start=\"2\">\n<li>Delete all the containers</li>\n</ol>\n\n<p><code>docker rm -f $(docker ps -aq)</code></p>\n\n<ol start=\"3\">\n<li>Find the following image when you run <code>docker images</code> \nOne of the output will be this among the other hyperledger binary images.</li>\n</ol>\n\n<p><code>REPOSITORY TAG,  IMAGE ID,  CREATED, SIZE: dev-peer0.org1.example.com-tuna-app-1.0-b58eb592ed6ced10f52cc063bda0c303a4272089a3f9a99000d921f94b9bae9b,  latest,              0919d7c15f0a,        3 minutes ago,       172MB</code></p>\n\n<p>Delete it using the following command:</p>\n\n<pre><code>docker rmi 0919d7c15f0a\n</code></pre>\n\n<p>Run the fabric again using ./startFabric.sh, npm install, node registerAdmin.js, node registerUser.js and node server.js. It should work</p>\n"}, {"tags": [], "owner": {"reputation": 825, "user_id": 3824841, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hUElY.jpg?s=128&g=1", "display_name": "Ashishkel", "link": "https://stackoverflow.com/users/3824841/ashishkel"}, "is_accepted": false, "score": 0, "last_activity_date": 1570563433, "creation_date": 1570563433, "answer_id": 58292985, "question_id": 49855723, "link": "https://stackoverflow.com/questions/49855723/hyperledger-fabric-chaincode-not-updated/58292985#58292985", "title": "HyperLedger fabric chaincode not updated", "body": "<p>It's pretty tricky once you miss the sequence. \nAs per my knowledge, deployment of a chaincode in HLF is a two step process. </p>\n\n<p>Step 1. Transfer the source code into the peer ( each chaincode gets a chaincode id which approximately is a function of their name, path and version). This gets signed by your keys and transferred to the all the peers you have chosen as target. ( This step by the way, is called installation. )</p>\n\n<p>Step 2. The source code is compiled, with all the vendor libs ( I'm talking about the GoLang chaincode version here, hoping that it would be same for the other ones too.). A docker image is built and a container gets formed with that binary. ( This is the part which is known as instantiation - which also becomes an Upgrade if it's already done earlier. )</p>\n\n<p>In this process, the step 1 would want the chaincode to be unique. If you have installed once, then if you want to send it again, then make sure you have changed the version number to say abc-1.0 to abc-2.0. This will save you at Installation step.</p>\n\n<p>Once your installation is successful, then it's the matter of when to call for an upgrade and when not. If you have run this container earlier, then right step is to upgrade. </p>\n\n<p>Or the other way around is to do what you did. Clean up and start fresh - which works ok for development, but not for production - as your data goes \"poof\" with that clean up. </p>\n"}, {"tags": [], "owner": {"reputation": 154, "user_id": 11339014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5e3141ffd5501b666f34f654cbed6c0?s=128&d=identicon&r=PG&f=1", "display_name": "Block Crasher", "link": "https://stackoverflow.com/users/11339014/block-crasher"}, "is_accepted": false, "score": 0, "last_activity_date": 1571389605, "creation_date": 1571389605, "answer_id": 58447504, "question_id": 49855723, "link": "https://stackoverflow.com/questions/49855723/hyperledger-fabric-chaincode-not-updated/58447504#58447504", "title": "HyperLedger fabric chaincode not updated", "body": "<p>when developing chaincode on hyperledger fabric.</p>\n\n<p>1: we have to remove chaincode docker image for testing each change.\nFor Example: name of install chaincode is mycc</p>\n\n<pre><code>#remove container\ndocker rm -f $(docker ps -aq)\n#remove images\ndocker rmi mycc-0-container id or name\n</code></pre>\n\n<p>2: you can install chaincode just  by changing its name like mycc is currently running then you have to change mycc1 and now you need to use mycc1 and perform your transactions.\nFor Example:</p>\n\n<pre><code>#Already install chaincode has named mycc\n#following command will install same chaincode(updated) with chaincodeName\n#mycc1\ndocker exec cli peer chaincode install -n mycc1 -v 0 -p github.com/sacc\n</code></pre>\n\n<p><strong>Note:</strong> now you need to instantiate , invoke and query chaincode with name mycc1.</p>\n"}], "owner": {"reputation": 983, "user_id": 6499004, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I0fHv3jbsbs/AAAAAAAAAAI/AAAAAAAADUo/bejrpeXzWwg/photo.jpg?sz=128", "display_name": "mahima", "link": "https://stackoverflow.com/users/6499004/mahima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1326, "favorite_count": 1, "accepted_answer_id": 49862887, "answer_count": 4, "score": 2, "last_activity_date": 1571389605, "creation_date": 1523876588, "last_edit_date": 1523955523, "question_id": 49855723, "link": "https://stackoverflow.com/questions/49855723/hyperledger-fabric-chaincode-not-updated", "title": "HyperLedger fabric chaincode not updated", "body": "<p>I am trying to follow along this sample Hyperledger Fabric code: <a href=\"https://github.com/hyperledger/education/tree/master/LFS171x/fabric-material\" rel=\"nofollow noreferrer\">https://github.com/hyperledger/education/tree/master/LFS171x/fabric-material</a></p>\n\n<p>Initially I replaced chaincode/tuna-app/tuna-chaincode.go with my go file chaincode/tuna-app/test.go. test.go had changes just in what we initialize in the ledger through its initLedger function call. It worked fine, with no changes required in tuna-app/.startFabric.sh.</p>\n\n<p>Now when I again try to change the ledger through its initLedger function call, its not happening. Even if I comment the function itself, it still shows the old content of the ledger.</p>\n\n<p>How do I update my chaincode with visible changes?</p>\n\n<p>startFabric.sh contains the following code:</p>\n\n<pre><code>set -e\n\n# don't rewrite paths for Windows Git Bash users\nexport MSYS_NO_PATHCONV=1\n\nstarttime=$(date +%s)\n\nif [ ! -d ~/.hfc-key-store/ ]; then\n    mkdir ~/.hfc-key-store/\nfi\n\n# launch network; create channel and join peer to channel\ncd ../basic-network\n./start.sh\n\n# Now launch the CLI container in order to install, instantiate chaincode\n# and prime the ledger with our 10 tuna catches\ndocker-compose -f ./docker-compose.yml up -d cli\n\ndocker exec -e \"CORE_PEER_LOCALMSPID=Org1MSP\" -e \"CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp\" cli peer chaincode install -n tuna-app -v 1.0 -p github.com/test-app\ndocker exec -e \"CORE_PEER_LOCALMSPID=Org1MSP\" -e \"CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp\" cli peer chaincode instantiate -o orderer.example.com:7050 -C mychannel -n tuna-app -v 1.0 -c '{\"Args\":[\"\"]}' -P \"OR ('Org1MSP.member','Org2MSP.member')\"\nsleep 10\ndocker exec -e \"CORE_PEER_LOCALMSPID=Org1MSP\" -e \"CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp\" cli peer chaincode invoke -o orderer.example.com:7050 -C mychannel -n tuna-app -c '{\"function\":\"initLedger\",\"Args\":[\"\"]}'\n\nprintf \"\\nTotal execution time : $(($(date +%s) - starttime)) secs ...\\n\\n\"\nprintf \"\\nStart with the registerAdmin.js, then registerUser.js, then server.js\\n\\n\"\n</code></pre>\n\n<p>I tried by adding the following line after peer chaincode instantiate :</p>\n\n<pre><code>docker exec -e \"CORE_PEER_LOCALMSPID=Org1MSP\" -e \"CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp\" cli peer chaincode upgrade -o orderer.example.com:7050 -C mychannel -n tuna-app -c '{\"function\":\"initLedger\",\"Args\":[\"\"]}'\n</code></pre>\n\n<p>But it gives the following error:</p>\n\n<pre><code>Error: Chaincode version is not provided for upgrade\n</code></pre>\n\n<p>When I change upgrade statement to:</p>\n\n<pre><code>docker exec -e \"CORE_PEER_LOCALMSPID=Org1MSP\" -e \"CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp\" cli peer chaincode upgrade -o orderer.example.com:7050 -C mychannel -n tuna-app -v 1.0 -c '{\"function\":\"initLedger\",\"Args\":[\"\"]}'\n</code></pre>\n\n<p>Error changes to:</p>\n\n<pre><code>Error: Error endorsing chaincode: rpc error: code = Unknown desc = chaincode error (status: 500, message: version already exists for chaincode with name 'tuna-app')\n</code></pre>\n"}, {"tags": ["arrays", "string", "go"], "comments": [{"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "edited": false, "score": 1, "creation_date": 1523876804, "post_id": 49855704, "comment_id": 86725920, "body": "have you tried <code>reflect.DeepEqual</code> <a href=\"https://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#DeepEqual</a> ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1523876863, "post_id": 49855704, "comment_id": 86725978, "body": "Note that <code>[][]string</code> is not an array. It&#39;s a slice of slices."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1523876907, "post_id": 49855704, "comment_id": 86726003, "body": "You have already written the code for comparing the slices. What&#39;s the problem, exactly (other than missing boundary checks)."}, {"owner": {"reputation": 844, "user_id": 2459515, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SkRr0.jpg?s=128&g=1", "display_name": "StevieB", "link": "https://stackoverflow.com/users/2459515/stevieb"}, "reply_to_user": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "edited": false, "score": 0, "creation_date": 1523877918, "post_id": 49855704, "comment_id": 86726641, "body": "For better performance, check that the slice lengths are equal before checking all the elements are equal. If performance is not a concern you could use DeepEqual as suggested by @AlexEfimov"}, {"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 0, "creation_date": 1523878834, "post_id": 49855704, "comment_id": 86727215, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/15311969/checking-the-equality-of-two-slices\">Checking the equality of two slices</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "is_accepted": false, "score": 3, "last_activity_date": 1523878344, "last_edit_date": 1523878344, "creation_date": 1523877391, "answer_id": 49855962, "question_id": 49855704, "link": "https://stackoverflow.com/questions/49855704/how-to-compare-two-string-arrays-in-golang/49855962#49855962", "title": "how to compare two [][]string arrays in golang", "body": "<p><code>i</code> and <code>j</code> are lengths of <code>test</code> and <code>ans</code>. So, they are not valid index for <code>test[i][j]</code> or <code>ans[i][j]</code>. </p>\n\n<p>You can simply use <a href=\"https://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow noreferrer\">reflect.DeepEqual()</a>.</p>\n\n<p>You can extend <a href=\"https://stackoverflow.com/a/15312182/4628962\">this solution</a> for multiple dimension slices.</p>\n\n<p>One simple example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc assertEq(test [][]string, ans [][]string) bool {\n    return reflect.DeepEqual(test, ans)\n}\n\nfunc main() {\n    str1 := [][]string{{\"1\", \"2\", \"3\"}, {\"1\", \"2\", \"3\"}, {\"1\", \"2\", \"3\"}}\n    str2 := [][]string{{\"1\", \"2\", \"3\"}, {\"1\", \"2\", \"3\"}, {\"1\", \"2\", \"3\"}}\n    str3 := [][]string{{\"1\", \"2\", \"3\"}, {\"1\", \"2\", \"3\"}, {\"1\", \"2\"}}\n\n    fmt.Println(assertEq(str1, str2)) // answer is true\n    fmt.Println(assertEq(str1, str3)) // answer is false\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1523881399, "creation_date": 1523881399, "answer_id": 49857285, "question_id": 49855704, "link": "https://stackoverflow.com/questions/49855704/how-to-compare-two-string-arrays-in-golang/49857285#49857285", "title": "how to compare two [][]string arrays in golang", "body": "<blockquote>\n  <p><a href=\"https://godoc.org/github.com/google/go-cmp/cmp\" rel=\"nofollow noreferrer\">package cmp</a></p>\n\n<pre><code>import \"github.com/google/go-cmp/cmp\"\n</code></pre>\n  \n  <p>Package cmp determines equality of values.</p>\n  \n  <p>This package is intended to be a more powerful and safer alternative\n  to reflect.DeepEqual for comparing whether two values are semantically\n  equal.</p>\n</blockquote>\n\n<hr>\n\n<p>Use package <code>cmp</code>.</p>\n"}], "owner": {"reputation": 21, "user_id": 9327141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1e1fa65411217ec6e103cf9f2bc6aad?s=128&d=identicon&r=PG&f=1", "display_name": "nagulan", "link": "https://stackoverflow.com/users/9327141/nagulan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3706, "favorite_count": 1, "answer_count": 2, "score": -2, "last_activity_date": 1523919382, "creation_date": 1523876533, "last_edit_date": 1523919382, "question_id": 49855704, "link": "https://stackoverflow.com/questions/49855704/how-to-compare-two-string-arrays-in-golang", "title": "how to compare two [][]string arrays in golang", "body": "<pre><code>func assertEq(test [][]string, ans [][]string) {\n    for i := 0; i &lt; len(test); i++ {\n        for j := 0; j &lt; len(ans); j++ {\n            if test[i][j] != ans[i][j] {\n                fmt.Print(test)\n                fmt.Print(\" ! \")\n                fmt.Print(ans)\n            }\n        }\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>In my code it's not checking. I have used two different string arrays to compare each and every character.</p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 35510, "user_id": 3706016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wqmW0.jpg?s=128&g=1", "display_name": "jarlh", "link": "https://stackoverflow.com/users/3706016/jarlh"}, "edited": false, "score": 0, "creation_date": 1523870154, "post_id": 49853336, "comment_id": 86721605, "body": "Are you using MySQL or Postgresql? (Don&#39;t add tags for products not involved.)"}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "reply_to_user": {"reputation": 35510, "user_id": 3706016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wqmW0.jpg?s=128&g=1", "display_name": "jarlh", "link": "https://stackoverflow.com/users/3706016/jarlh"}, "edited": false, "score": 0, "creation_date": 1523870483, "post_id": 49853336, "comment_id": 86721834, "body": "@jarlh i am using Postgresql , the purpose for is that it can be a model for both"}, {"owner": {"reputation": 903, "user_id": 8317643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0HE2P.jpg?s=128&g=1", "display_name": "DEarTh", "link": "https://stackoverflow.com/users/8317643/dearth"}, "edited": false, "score": 0, "creation_date": 1523870630, "post_id": 49853336, "comment_id": 86721943, "body": "What is the data type of <code>valueofname</code> ? Please add table schema."}, {"owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 1, "creation_date": 1523870718, "post_id": 49853336, "comment_id": 86722004, "body": "Voting to close as unclear what you are asking."}, {"owner": {"reputation": 35510, "user_id": 3706016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wqmW0.jpg?s=128&g=1", "display_name": "jarlh", "link": "https://stackoverflow.com/users/3706016/jarlh"}, "edited": false, "score": 3, "creation_date": 1523871021, "post_id": 49853336, "comment_id": 86722218, "body": "Add some sample table data and the expected result. (As formatted text, not images.)"}, {"owner": {"reputation": 35510, "user_id": 3706016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wqmW0.jpg?s=128&g=1", "display_name": "jarlh", "link": "https://stackoverflow.com/users/3706016/jarlh"}, "edited": false, "score": 0, "creation_date": 1523871075, "post_id": 49853336, "comment_id": 86722266, "body": "Remove the <code>and ad_id=&#39;xxx&#39; </code> parts from the case expressions. (Handled by GROUP BY.)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523871201, "post_id": 49853336, "comment_id": 86722354, "body": "You can use <a href=\"https://www.postgresql.org/docs/current/static/functions-conditional.html#FUNCTIONS-NULLIF\" rel=\"nofollow noreferrer\"><code>NULLIF</code></a> if you want <code>NULL</code> instead of <code>&quot;&quot;</code>."}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "reply_to_user": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 0, "creation_date": 1523871561, "post_id": 49853336, "comment_id": 86722610, "body": "Thanks @TimBiegeleisen for the collaboration what you know is just bad voting instead of helping"}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523871568, "post_id": 49853336, "comment_id": 86722614, "body": "@mkopriva  [The start of my problem ](<a href=\"https://stackoverflow.com/questions/49793575/turn-the-distinct-value-of-columns-into-a-rows-postgres/49853146#49853146\" title=\"turn the distinct value of columns into a rows postgres\">stackoverflow.com/questions/49793575/&hellip;</a>). so now when i got the ad_id as condition if existed it returns the valueofname else return NULL for each name"}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "reply_to_user": {"reputation": 35510, "user_id": 3706016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wqmW0.jpg?s=128&g=1", "display_name": "jarlh", "link": "https://stackoverflow.com/users/3706016/jarlh"}, "edited": false, "score": 0, "creation_date": 1523871709, "post_id": 49853336, "comment_id": 86722710, "body": "mr @jarlh here is more details on my problem :<a href=\"https://stackoverflow.com/questions/49793575/turn-the-distinct-value-of-columns-into-a-rows-postgres/49853146#49853146\" title=\"turn the distinct value of columns into a rows postgres\">stackoverflow.com/questions/49793575/&hellip;</a>. thanks indeed"}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "reply_to_user": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1523872771, "post_id": 49853336, "comment_id": 86723420, "body": "@a_horse_with_no_name hope that is more clear , thanks indeed for your help"}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "reply_to_user": {"reputation": 35510, "user_id": 3706016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wqmW0.jpg?s=128&g=1", "display_name": "jarlh", "link": "https://stackoverflow.com/users/3706016/jarlh"}, "edited": false, "score": 0, "creation_date": 1523873706, "post_id": 49853336, "comment_id": 86724038, "body": "@jarlh i edited  hope that is more clear , sorry for any unclear things i still learning how to use the platform"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523874832, "post_id": 49853336, "comment_id": 86724697, "body": "@dev_medo Something like this? <a href=\"http://www.sqlfiddle.com/#!17/8603ee/3\" rel=\"nofollow noreferrer\">sqlfiddle.com/#!17/8603ee/3</a> (updated link)"}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523876451, "post_id": 49853336, "comment_id": 86725712, "body": "@mkopriva yeep that&#39;s  totally what i am looking for as a result i used your query  but i am getting just a blank instead of NULL  , i looked at the description of my table and i found that value is set as not NULL does make any sence ?? for not accepting to be NULL"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523878288, "post_id": 49853336, "comment_id": 86726856, "body": "@dev_medo how did you test the query? For example <code>psql</code> by defaut displays NULLs as blanks and so cannot be easily discerned from an empty string. If you do <code>SELECT NULL;</code> do you see NULL? or a blank? or something else? While in <code>psql</code> you can change how NULLs are displayed with this command <code>\\pset null &#39;(null)&#39;</code>, this will display NULLs as the string <i>(null)</i>."}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523886506, "post_id": 49853336, "comment_id": 86732628, "body": "yeep i checked that and it was the case when i parse them into json  thanks indeed for @mkopriva"}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "edited": false, "score": 0, "creation_date": 1523893567, "post_id": 49853336, "comment_id": 86737778, "body": "@ mkopriva could you please review this <a href=\"https://stackoverflow.com/questions/49859521/merge-two-queries-with-join-and-where-and-group-by-conditions-golang-postg/49860569#49860569\" title=\"merge two queries with join and where and group by conditions golang postg\">stackoverflow.com/questions/49859521/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "edited": false, "score": 0, "creation_date": 1523877078, "post_id": 49855579, "comment_id": 86726136, "body": "@ Gordon Linoff It&#39;s working moreover the having clause is working also , but the <code>NULL</code> problem still existing  for the <code>value</code> field description: [Type:<code>Text</code> ; <code>NOT NULL</code>] but the selection made is just a temporary table so the <code>NOT NULL</code>is not applicated"}], "tags": [], "owner": {"reputation": 1106495, "user_id": 1144035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e514b017977ebf742a418cac697d8996?s=128&d=identicon&r=PG", "display_name": "Gordon Linoff", "link": "https://stackoverflow.com/users/1144035/gordon-linoff"}, "is_accepted": false, "score": 0, "last_activity_date": 1523876140, "creation_date": 1523876140, "answer_id": 49855579, "question_id": 49853336, "link": "https://stackoverflow.com/questions/49853336/multiple-condition-on-a-row-if-not-existed-return-a-null-postgresql/49855579#49855579", "title": "multiple condition on a row if not existed return a NULL postgresql", "body": "<p>To flatten the records for <em>all</em> <code>ad_id</code>s, use:</p>\n\n<pre><code>select ad_id,\n       max(case when name = 'name' then valueofname end) as name,\n       max(case when name = 'age'then valueofname end) as age,\n       max(case when name = 'birthday' then valueofname end) as birthday,\n       max(case when name = 'job' then valueofname end) as job\nfrom t\ngroup by ad_id;\n</code></pre>\n\n<p>To get the results for a single <code>ad_id</code>, add a <code>where</code> clause:</p>\n\n<pre><code>select ad_id,\n       max(case when name = 'name' then valueofname end) as name,\n       max(case when name = 'age'then valueofname end) as age,\n       max(case when name = 'birthday' then valueofname end) as birthday,\n       max(case when name = 'job' then valueofname end) as job\nfrom t\nwhere ad_id = 'xxx' \ngroup by ad_id;\n</code></pre>\n\n<p>Note:  If there are no rows with <code>ad_id = 'xxx'</code> then this will return no rows.</p>\n"}], "owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1523876140, "creation_date": 1523869188, "last_edit_date": 1523872742, "question_id": 49853336, "link": "https://stackoverflow.com/questions/49853336/multiple-condition-on-a-row-if-not-existed-return-a-null-postgresql", "title": "multiple condition on a row if not existed return a NULL postgresql", "body": "<p>I have a schema like:</p>\n\n<pre><code>[ad_id] .  [name] . [valueofname]\n 1 .        name .    \"brian\"\n 1 .        age  .    \"23\"\n 2 .        job  .    \"IT\"\n 2 .        name .    \"Jack\" \n</code></pre>\n\n<p>the row name contains multiple values : age , name, birthday, job, age I'd like to convert it into this:</p>\n\n<pre><code>[ad_id] .      [name]  .       [age] .              [birthday] .    [job]\n[valueofad_id][valueofname] [valueofnameofage] [valueofnameofbirth] [valueofnameofjob]\n</code></pre>\n\n<p>I did this query selection below  to fix it , so in my program i must get the result where <code>ad_id</code>='xxxx' for each when <code>name</code>='<code>name</code> or <code>age</code> or <code>birthday</code> or <code>job</code> ' </p>\n\n<p>Some <code>ad_id</code> have not all the names , as you may see below the schema the <code>ad_id= 1</code> has just the <code>name</code> and <code>age</code> but not the <code>job</code> so i want when the job not found it returns a <code>NULL</code> </p>\n\n<pre><code> [ad_id] .  [name] . [valueofname]\n  1 .        name .    \"brian\"\n  1 .        age  .    \"23\"\n  2 .        job  .    \"IT\"\n  2 .        name .    \"Jack\" \n\n\nselect ad_id,\n\nmax(case when name = 'name' and ad_id='xxx' then valueofname end) as name,\nmax(case when name = 'age' and ad_id='xxx'  then valueofname end) as age,\nmax(case when name = 'birthday' and ad_id='xxx' then valueofname end) as birthday,\nmax(case when name = 'job' and ad_id='xxx' then valueofname end) as job\n\nfrom t\ngroup by ad_id;\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 3, "last_activity_date": 1523866954, "creation_date": 1523866954, "answer_id": 49852663, "question_id": 49851014, "link": "https://stackoverflow.com/questions/49851014/can-i-use-context-done-to-check-server-shutdown/49852663#49852663", "title": "Can I use Context().Done() to check server shutdown?", "body": "<p>No. If you <a href=\"https://golang.org/pkg/net/http/#Server.Shutdown\" rel=\"nofollow noreferrer\">read the docs</a>, it explains exactly what <code>Shutdown</code> does, saying explicitly that it does <em>not</em> interrupt active connections (emphasis added):</p>\n\n<blockquote>\n  <p>Shutdown gracefully shuts down the server <strong>without interrupting any active connections</strong>. Shutdown works by first closing all open listeners, then closing all idle connections, and then waiting indefinitely for connections to return to idle and then shut down. If the provided context expires before the shutdown is complete, Shutdown returns the context's error, otherwise it returns any error returned from closing the Server's underlying Listener(s).</p>\n</blockquote>\n"}], "owner": {"reputation": 325, "user_id": 7861216, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7b000d27aef138af2dba2dcbc888de12?s=128&d=identicon&r=PG&f=1", "display_name": "wangjun", "link": "https://stackoverflow.com/users/7861216/wangjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 158, "favorite_count": 0, "accepted_answer_id": 49852663, "answer_count": 1, "score": 0, "last_activity_date": 1523866954, "creation_date": 1523860929, "last_edit_date": 1523861287, "question_id": 49851014, "link": "https://stackoverflow.com/questions/49851014/can-i-use-context-done-to-check-server-shutdown", "title": "Can I use Context().Done() to check server shutdown?", "body": "<p>As golang <code>http</code> package document saying, <code>http.Server</code> will not close until all handler finished after <code>Shutdown()</code> called. If handler take too long time, context will expires, and <code>Shutdown()</code> returns a error. What should I do for forcing handler to return immediately when <code>server.Shutdown()</code> has been called? Will <code>Context().Done()</code> of <code>http.Request</code> be closed after <code>server.ShutDown()</code> has been called?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1523855355, "post_id": 49849831, "comment_id": 86714430, "body": "You start a new goroutine with a <code>go</code> statement, e.g. <code>go sendEmail(arg1, arg2)</code>. Read more <a href=\"https://golang.org/ref/spec#Go_statements\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523855851, "post_id": 49849831, "comment_id": 86714570, "body": "In Golang we dont need a concepts of message queue and worker threads like celery. ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1523856420, "post_id": 49849831, "comment_id": 86714739, "body": "I don&#39;t know if <i>you</i> need a message queue or not, it depends on your requirements. If all you want to do is to execute some code asynchronously, then a goroutine should be enough. But if, for example you need to maybe offload background tasks to another machine, then you can use a message queue for that, and there are plenty of 3rd party client packages for the multitude of key-value stores, e.g. <a href=\"https://github.com/go-redis/redis\" rel=\"nofollow noreferrer\">redis</a> or message brokers, e.g. <a href=\"https://github.com/streadway/amqp\" rel=\"nofollow noreferrer\">amqp</a>."}, {"owner": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523865053, "post_id": 49849831, "comment_id": 86718687, "body": "Clear explanation. but on the doc about goroutings &quot; When the function terminates, its goroutine also terminates. &quot; It means after view return the value to client the goroutine will be terminate without completion ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523866918, "post_id": 49849831, "comment_id": 86719694, "body": "No, the goroutine terminates when the function executed by the goroutine terminates, not the function that created the goroutine. When <code>sendEmail</code> terminates, the <code>go</code>routine terminates. When <code>ApiView</code> terminates it will not terminate <code>sendEmail</code> if it is still running."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523867646, "post_id": 49849831, "comment_id": 86720126, "body": "<a href=\"https://play.golang.org/p/DgA_iCrW-xR\" rel=\"nofollow noreferrer\">play.golang.org/p/DgA_iCrW-xR</a>"}, {"owner": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523869078, "post_id": 49849831, "comment_id": 86720968, "body": "Great Thanks. I wrongly understand the termination of function. Basically when function terminates(sendEmail) the go routine completes."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523869125, "post_id": 49849831, "comment_id": 86720992, "body": "Yes, that&#39;s correct."}, {"owner": {"reputation": 2178, "user_id": 3067964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CvonS.jpg?s=128&g=1", "display_name": "jwells131313", "link": "https://stackoverflow.com/users/3067964/jwells131313"}, "edited": false, "score": 0, "creation_date": 1523913463, "post_id": 49849831, "comment_id": 86748183, "body": "You might want to give <a href=\"https://github.com/jwells131313/goethe\" rel=\"nofollow noreferrer\">github.com/jwells131313/goethe</a> a try.  It gives you a function queue and a pool of threads along with other utilities you might find to ease the transition"}], "answers": [{"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 0, "last_activity_date": 1524052601, "last_edit_date": 1524052601, "creation_date": 1523879495, "answer_id": 49856647, "question_id": 49849831, "link": "https://stackoverflow.com/questions/49849831/golang-background-worker-process-inside-api-view/49856647#49856647", "title": "golang background worker process inside api view", "body": "<p>Yes! As comments stated you can spawn a new go routine within the context of your view.  The goroutine gets its own stack and allows it to operate \"asynchronously\" from the view handling function:</p>\n\n<pre><code>func ApiView(w http.ResponseWriter, req *http.Request){\n\n //logic\n\n // need to call email/sms service\n go sendEmail(someEmailAddress)\n\n fmt.Fprintf(w, \"TEST\")\n}\n</code></pre>\n\n<p>This will execute <code>sendEmail</code> using a go routine and immediately write <code>TEST</code> to the caller.</p>\n\n<hr>\n\n<p>While trivial it is not equivalent to celery redis/rabbitmq:</p>\n\n<ul>\n<li>How do you handle failures?</li>\n<li>How do you bound concurrency (worker pool)</li>\n<li>How do you buffer tasks? (ie currently in rabbitmq it is out of process)</li>\n<li>How do you retry?</li>\n<li>Should the async task be in a different process/memory space?</li>\n</ul>\n\n<p>None of the above are particularly difficult, and completely doable (and plenty of patterns/blogs/libraries exist for doing this exact thing)</p>\n"}], "owner": {"reputation": 75, "user_id": 8963223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28b3dcf07a38a007436420609f9d708b?s=128&d=identicon&r=PG&f=1", "display_name": "Vish K", "link": "https://stackoverflow.com/users/8963223/vish-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 797, "favorite_count": 0, "accepted_answer_id": 49856647, "answer_count": 1, "score": 1, "last_activity_date": 1524052601, "creation_date": 1523854282, "question_id": 49849831, "link": "https://stackoverflow.com/questions/49849831/golang-background-worker-process-inside-api-view", "title": "golang background worker process inside api view", "body": "<p>We are planning to move to golang from django.</p>\n\n<p>To send an email or sms, we do celery workers with redis/rabbotmq in Django. \nBut how can we do that background tasks on golang.</p>\n\n<p>Eg:</p>\n\n<pre><code>def api_view():\n\n // logic\n\n // celery tasks- call email/sms service\n\n // immediate response to client\n return Response()\n</code></pre>\n\n<p>How can we do in golang</p>\n\n<pre><code>fun ApiView(w http.ResponseWriter, req *http.Request){\n\n //logic\n\n // need to call email/sms service\n\n\n fmt.Fprintf(w, \"TEST\")\n}\n</code></pre>\n\n<p>Is there anything we can start new go routine (without additional redis/workers) inside the API view of gorilla/mux ? </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 1, "creation_date": 1523854279, "post_id": 49849687, "comment_id": 86714201, "body": "here is the official doc of gorm. <a href=\"http://gorm.io/docs/query.html#Joins\" rel=\"nofollow noreferrer\">gorm.io/docs/query.html#Joins</a>. Hope it will be helpful."}, {"owner": {"reputation": 583, "user_id": 2762560, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/1666927820/picture?type=large", "display_name": "Arthur Mastropietro", "link": "https://stackoverflow.com/users/2762560/arthur-mastropietro"}, "reply_to_user": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 0, "creation_date": 1523854535, "post_id": 49849687, "comment_id": 86714249, "body": "Hey @MarufTuhin i tried that. but the joined table does not come populated:  <code>var prop []model.Prop db.Table(&quot;prop&quot;).Select(&quot;*&quot;).Joins(&quot;left join status on prop.status_id = status.id&quot;).Scan(&amp;prop)</code> The result is: <code>[ {&quot;id&quot;:1,&quot;Status&quot;:{&quot;id&quot;:0,&quot;name&quot;:&quot;&quot;},&quot;StatusID&quot;:1,&quot;name&quot;:&quot;Pro&zwnj;&#8203;posal},{&quot;id&quot;:2,&quot;Stat&zwnj;&#8203;us&quot;:{&quot;id&quot;:0,&quot;name&quot;:&quot;&zwnj;&#8203;&quot;},&quot;StatusID&quot;:2,&quot;nam&zwnj;&#8203;e&quot;:&quot;Proposal 2&quot;} </code>] As you can see Status object returns empty"}, {"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 0, "creation_date": 1523855525, "post_id": 49849687, "comment_id": 86714480, "body": "I just read somewhere that, table needs to be preloaded. Try preloading the <code>status</code> table here."}], "answers": [{"tags": [], "owner": {"reputation": 1201, "user_id": 5097493, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/95b290a191545edb4077adfaab317f1a?s=128&d=identicon&r=PG&f=1", "display_name": "RuNpiXelruN", "link": "https://stackoverflow.com/users/5097493/runpixelrun"}, "is_accepted": true, "score": 6, "last_activity_date": 1523945470, "creation_date": 1523945470, "answer_id": 49871034, "question_id": 49849687, "link": "https://stackoverflow.com/questions/49849687/how-to-create-a-left-join-in-jinzhu-gorm/49871034#49871034", "title": "How to create a Left Join in Jinzhu GORM", "body": "<p>Hey @arthur_mastropietro,\nI think Preloading the <code>Prop</code>'s related <code>Status</code> is the key. Try the below:</p>\n\n<pre><code>prop := Prop{}\nif err := db.Model(&amp;prop).Preload(\"Status\").Find(&amp;prop).Error; err != nil {\n  fmt.Println(err)\n}\nfmt.Printf(\"%+v\\n\", prop)\n</code></pre>\n\n<h2>Note</h2>\n\n<p>You can chain the preloading of other structs, ie \n<code>Preload(\"Status\").Preload(\"Something\").</code>..etc. In fact you can chain most <code>Gorm</code> function calls.</p>\n\n<p>Additionally, if <code>Status</code> was to also have another struct as one of it's fields you can load them both at once by calling\n<code>Preload(\"Status.Something\")</code></p>\n\n<p>Hope that helps!</p>\n"}], "owner": {"reputation": 583, "user_id": 2762560, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/1666927820/picture?type=large", "display_name": "Arthur Mastropietro", "link": "https://stackoverflow.com/users/2762560/arthur-mastropietro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5514, "favorite_count": 0, "accepted_answer_id": 49871034, "answer_count": 1, "score": 5, "last_activity_date": 1523945470, "creation_date": 1523853035, "question_id": 49849687, "link": "https://stackoverflow.com/questions/49849687/how-to-create-a-left-join-in-jinzhu-gorm", "title": "How to create a Left Join in Jinzhu GORM", "body": "<p>I can not create a simple query with a left join in jinzhu GORM (MySQL database)</p>\n\n<p>These are my structs:</p>\n\n<pre><code>type Prop struct {\n    ID          uint   \n    Status      Status \n    StatusID    uint\n    Name        string \n}\n\ntype Status struct {\n    ID   uint   \n    Name string\n}\n</code></pre>\n\n<p>Prop has a foreign key to Status</p>\n\n<p>The SQL query i would like to perform is:</p>\n\n<pre><code>SELECT * from prop LEFT JOIN status ON prop.status_id = status.id\n</code></pre>\n\n<p>So i would retrieve all records from prop table joined with status table</p>\n\n<p>I tried:</p>\n\n<pre><code>db.Find(&amp;prop).Related(&amp;status) \n</code></pre>\n\n<p>but no Success. Anyone has some advice? Thanks in advance</p>\n"}, {"tags": ["go", "fasthttp"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1523853126, "post_id": 49849533, "comment_id": 86713946, "body": "I&#39;m not familiar with fasthttp nor do I know how a standard implementation should behave but it seems it&#39;s what the fasthttp devs <a href=\"https://github.com/valyala/fasthttp/blob/master/server.go#L895\" rel=\"nofollow noreferrer\">intended</a>."}, {"owner": {"reputation": 1455, "user_id": 465147, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/e824e3adb5aa777566fa8e53f89bebbe?s=128&d=identicon&r=PG", "display_name": "sprabhakaran", "link": "https://stackoverflow.com/users/465147/sprabhakaran"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523854210, "post_id": 49849533, "comment_id": 86714185, "body": "@mkopriva great find. fasthttp&#39;s document didn&#39;t mention anywhere in the document. So, I am not aware of this. Anyway thanks for your reply."}], "answers": [{"tags": [], "owner": {"reputation": 6794, "user_id": 3290397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/43e4f19880863474b48dcd8b8a4c48ea?s=128&d=identicon&r=PG&f=1", "display_name": "golopot", "link": "https://stackoverflow.com/users/3290397/golopot"}, "is_accepted": false, "score": 0, "last_activity_date": 1604305119, "creation_date": 1604305119, "answer_id": 64641986, "question_id": 49849533, "link": "https://stackoverflow.com/questions/49849533/response-header-settings-is-not-working-for-the-error-case/64641986#64641986", "title": "Response header settings is not working for the error case", "body": "<p>The method <code>ctx.Error</code> clears the headers intentionally:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// ...\n// Warning: this will reset the response headers and body already set!\nfunc (ctx *RequestCtx) Error(msg string, statusCode int) {...}\n</code></pre>\n<p>The solution is to use other methods:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>ctx.SetContentType(&quot;text/plain&quot;)\nctx.SetStatusCode(404)\nctx.SetBodyString(&quot;Unsupported path&quot;)\n</code></pre>\n"}], "owner": {"reputation": 1455, "user_id": 465147, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/e824e3adb5aa777566fa8e53f89bebbe?s=128&d=identicon&r=PG", "display_name": "sprabhakaran", "link": "https://stackoverflow.com/users/465147/sprabhakaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 202, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1604305119, "creation_date": 1523851893, "last_edit_date": 1592644375, "question_id": 49849533, "link": "https://stackoverflow.com/questions/49849533/response-header-settings-is-not-working-for-the-error-case", "title": "Response header settings is not working for the error case", "body": "<p><strong>ctx.Response.Header.Set</strong> function is not working for the error case.</p>\n<p>Please check the below code,</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\nimport &quot;github.com/valyala/fasthttp&quot;\n\nfunc main() {\n    requestHandler := func(ctx *fasthttp.RequestCtx) {\n        ctx.Response.Header.Set(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;)\n        switch string(ctx.Path()) {\n        case &quot;/foo&quot;:\n            fmt.Fprintf(ctx, &quot;Success result&quot;)\n        case &quot;/bar&quot;:\n            ctx.Error(&quot;Unsupported path&quot;, fasthttp.StatusNotFound)\n        }\n    }\n    fasthttp.ListenAndServe(&quot;:8080&quot;, requestHandler)\n}\n</code></pre>\n<p>The /foo URL's response header is,</p>\n<blockquote>\n<p>Server: fasthttp Date: Mon, 16 Apr 2018 04:05:10 GMT</p>\n<p>Content-Type: text/plain; charset=utf-8</p>\n<p>Content-Length: 14</p>\n<p>Access-Control-Allow-Origin: *</p>\n</blockquote>\n<p>But, the /bar 's response header is,</p>\n<blockquote>\n<p>Server: fasthttp</p>\n<p>Date: Mon, 16 Apr 2018 04:05:50 GMT</p>\n<p>Content-Type: text/plain; charset=utf-8</p>\n<p>Content-Length: 16</p>\n</blockquote>\n<p>Access-Control-Allow-Origin header is not applied. Is anything I missed here?</p>\n"}, {"tags": ["go", "ip"], "answers": [{"comments": [{"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1523885029, "post_id": 49849935, "comment_id": 86731503, "body": "I <i>am</i> on Windows."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1523889482, "post_id": 49849935, "comment_id": 86734839, "body": "That&#39;s a little strange, then. I would have expected you to get an error, the same as on IPv4. Maybe Microsoft changed something in IPv6."}, {"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1523890359, "post_id": 49849935, "comment_id": 86735495, "body": "Neither <code>ping</code> nor <code>curl</code>nor Chrome connect to it, but Go does."}], "tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 3, "last_activity_date": 1523855563, "last_edit_date": 1523855563, "creation_date": 1523855089, "answer_id": 49849935, "question_id": 49849240, "link": "https://stackoverflow.com/questions/49849240/why-does-http-gethttp-1234-work/49849935#49849935", "title": "Why does http.Get(&quot;http://[::]:1234&quot;) work?", "body": "<p>At least on a Linux system, this results in a connection being made to localhost.</p>\n\n<p>The address <code>::</code> is <code>IN6ADDR_ANY</code>, typically used when listening to listen for connections to any IPv6 address on the system. It's analogous to <code>INADDR_ANY</code>, also known as <code>0.0.0.0</code> in IPv4.</p>\n\n<p>Occasionally someone attempts to use one of these addresses as the destination address for an outgoing connection. When this happens:</p>\n\n<p>When making an outgoing connection to <code>0.0.0.0</code>, Linux actually connects from <code>127.0.0.1</code> to <code>127.0.0.1</code>.</p>\n\n<p>Similarly, when making an outgoing connection to <code>::</code>, Linux actually connects from <code>::1</code> to <code>::1</code>. Here is an example, taken from one of my websites (which happens to be an IP address lookup tool):</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[error@murloc ~]$ curl -k -H \"Host: myip.addr.space\" https://[::]:8443/\n::1\n</code></pre>\n\n<p>For completeness, here is the IPv4 version:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[error@murloc ~]$ curl -k -H \"Host: myip.addr.space\" https://0.0.0.0:8443/\n127.0.0.1\n</code></pre>\n\n<p>Note that this is OS-specific. You would have received <a href=\"https://stackoverflow.com/a/28230165/1068283\">an error on Windows</a>.</p>\n"}], "owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 1, "accepted_answer_id": 49849935, "answer_count": 1, "score": 2, "last_activity_date": 1523855563, "creation_date": 1523849161, "question_id": 49849240, "link": "https://stackoverflow.com/questions/49849240/why-does-http-gethttp-1234-work", "title": "Why does http.Get(&quot;http://[::]:1234&quot;) work?", "body": "<p>I was writing a test where I wanted an HTTP server to listen on a random port and then connect to this port. I wrote:</p>\n\n<pre><code>mux := http.NewServeMux()\nmux.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"foo\")\n})\n\nlistener, err := net.Listen(\"tcp\", \":0\")\nfmt.Println(err)\n\nhttpServer := &amp;http.Server{Handler: mux}\ngo httpServer.Serve(listener)\n\nfmt.Println(\"http://\" + listener.Addr().String())  \n\nr, err := http.Get(\"http://\" + listener.Addr().String())\nfmt.Println(r)\nfmt.Println(err)\n</code></pre>\n\n<p>I meant to write <code>net.Listen(\"tcp\", \"127.0.0.1:0\")</code> but accidentally wrote <code>net.Listen(\"tcp\", \":0\")</code>.</p>\n\n<p>For <code>\"http://\" + listener.Addr().String()</code> it prints:</p>\n\n<blockquote>\n<pre><code>http://[::]:1709\n</code></pre>\n</blockquote>\n\n<p>where as far as I understand the \"bracket colon colon bracket\" means \"all interfaces\".</p>\n\n<p>To my surprise, the <code>http.Get(\"http://[::]:1709\")</code> works, it connects to the webserver and \"foo\" is printed.</p>\n\n<p>How is \"<a href=\"http://[::]:1709\" rel=\"nofollow noreferrer\">http://[::]:1709</a>\" a valid address?</p>\n"}, {"tags": ["go", "utf-8", "interface"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1523848084, "post_id": 49849073, "comment_id": 86712846, "body": "<code>go 1.10.1</code> here, it compiles and runs fine."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 2, "creation_date": 1523848655, "post_id": 49849073, "comment_id": 86712944, "body": "Have you looked at the file in a hex editor to see if there are some funky bytes in there?"}, {"owner": {"reputation": 47, "user_id": 9090997, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uow4O.jpg?s=128&g=1", "display_name": "smokums", "link": "https://stackoverflow.com/users/9090997/smokums"}, "edited": false, "score": 0, "creation_date": 1523848899, "post_id": 49849073, "comment_id": 86712984, "body": "No I havent, but  it doesnt seem to have this issue when I run on my linux VM for work, its centos7 and my personal machine that its having compile issues on is windows 10 home."}, {"owner": {"reputation": 47, "user_id": 9090997, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uow4O.jpg?s=128&g=1", "display_name": "smokums", "link": "https://stackoverflow.com/users/9090997/smokums"}, "edited": false, "score": 0, "creation_date": 1523849408, "post_id": 49849073, "comment_id": 86713082, "body": "Thank you mu, I would have never thought of using a hex editor as I have never used them before, but I downloaded one, and bam, a single character wasnt registering correctly in UTF-8, it was the apostrophe &quot; &#39; &quot;."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1523853079, "post_id": 49849073, "comment_id": 86713937, "body": "<code>&#39; </code> is a totally valid character. It&#39;s safe to use it in go string literals."}, {"owner": {"reputation": 47, "user_id": 9090997, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uow4O.jpg?s=128&g=1", "display_name": "smokums", "link": "https://stackoverflow.com/users/9090997/smokums"}, "edited": false, "score": 0, "creation_date": 1523853277, "post_id": 49849073, "comment_id": 86713980, "body": "Yeah but that apostrophe that was originally used wasn&#39;t, im not exactly sure why, but when I looked at it through a hex editor, it showed that it was a &quot;.&quot;(period) and was flagged red as a non UTF-8 encoded character. Its probably because I ripped the initial example off of some website. once I replaced it  with the UTF-8 apostrophe it ran just fine."}], "answers": [{"tags": [], "owner": {"reputation": 47, "user_id": 9090997, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uow4O.jpg?s=128&g=1", "display_name": "smokums", "link": "https://stackoverflow.com/users/9090997/smokums"}, "is_accepted": false, "score": 0, "last_activity_date": 1523849510, "creation_date": 1523849510, "answer_id": 49849258, "question_id": 49849073, "link": "https://stackoverflow.com/questions/49849073/why-doesnt-this-compile-with-go-1-10-compiler-but-will-run-on-goplayground/49849258#49849258", "title": "Why doesnt this compile with go 1.10 compiler but will run on goplayground", "body": "<p>Turns out that this was caused by the apostrophe in \"I'm\" //>> fmt.Printf(\"I\u2019m at %v %v %v %v %v\\n\", p.Address.Number,p.Address.Street, p.Address.City, p.Address.State, p.Address.Zip)</p>\n"}], "owner": {"reputation": 47, "user_id": 9090997, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uow4O.jpg?s=128&g=1", "display_name": "smokums", "link": "https://stackoverflow.com/users/9090997/smokums"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1541218647, "creation_date": 1523847763, "last_edit_date": 1523864503, "question_id": 49849073, "link": "https://stackoverflow.com/questions/49849073/why-doesnt-this-compile-with-go-1-10-compiler-but-will-run-on-goplayground", "title": "Why doesnt this compile with go 1.10 compiler but will run on goplayground", "body": "<p>I need to know why this code will not compile, the go compiler keeps telling me im using an invalid-utf encoding, but I don't understand exactly where this is occurring. The error I'm receiving. </p>\n\n<pre><code>$ go build Example#2.go\ncommand-line-arguments\n.\\Example#2.go:32:15: invalid UTF-8 encoding\n</code></pre>\n\n<p>Any help at all on this would be most appreciated. I know its a simple program but its to demonstrate the language to my programming languages class and this is just supposed to be a simple example showing how method names have to be linked to structs and how interfaces work. Like I said this works on <code>go playground</code> but not with the actual compiler.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Person struct {\n    Name    string\n    Address Address\n}\n\ntype Address struct {\n    Number string\n    Street string\n    City   string\n    State  string\n    Zip    string\n}\n    type Citizen struct {\n    Country string\n    Person\n}\ntype speak interface {\n    Talk()\n}\n\nfunc (p *Person) Talk() {\n    fmt.Println(\"Hi, my name is\", p.Name)\n}\n\nfunc (p *Person) Location() {\n    fmt.Printf(\"I\u2019m at %v %v %v %v %v\\n\", p.Address.Number, \n    p.Address.Street, p.Address.City, p.Address.State, p.Address.Zip)\n}\n\nfunc (c *Citizen) Nationality() {\n    fmt.Println(c.Name, \"is a citizen of\", c.Country)\n}\nfunc (c *Citizen) Talk() {\n    fmt.Println(\"this is the citizen talk method\")\n}\nfunc Converse(s speak) {\n    s.Talk()\n}\n\nfunc main() {\n    p := Person{\n        Name: \"Jim\",\n        Address: Address{\n            Number: \"1\",\n            Street: \"College Avenue\",\n            City:   \"exampleland\",\n            State:  \"StateLand\",\n            Zip:    \"8675309\",\n        },\n    }\n    c := Citizen{}\n    c.Name = \"John\"\n    c.Country = \"Somewhereland\"\n    c.Person.Address.Number = \"1337\"\n\n    c.Person.Address.Street = \"Haxor Lane\"\n    c.Person.Address.City = \"Lazy\"\n    c.Person.Address.State = \"Foo\"\n    c.Person.Address.Zip = \"192.168.1.1\"\n\n    p.Talk()\n    p.Location()\n\n    ///////////////\n    fmt.Println(\"\")\n    ///////////////\n\n    c.Person.Talk()\n    c.Talk()\n    ///////////////\n    fmt.Println(\"\")\n    ///////////////\n    c.Nationality()\n    c.Location()\n    ///////////////\n    fmt.Println(\"\")\n    Converse(&amp;p)\n    Converse(&amp;c)\n}\n</code></pre>\n"}, {"tags": ["testing", "go", "cl", "go-cobra", "cobra"], "comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523857209, "post_id": 49848898, "comment_id": 86714956, "body": "is it <a href=\"https://github.com/spf13/cobra\" rel=\"nofollow noreferrer\">github.com/spf13/cobra</a> ?"}, {"owner": {"reputation": 6202, "user_id": 1066615, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/iv68W.png?s=128&g=1", "display_name": "sixty4bit", "link": "https://stackoverflow.com/users/1066615/sixty4bit"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523882201, "post_id": 49848898, "comment_id": 86729436, "body": "Yes that\u2019s the cobra package I\u2019m using"}], "answers": [{"comments": [{"owner": {"reputation": 6202, "user_id": 1066615, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/iv68W.png?s=128&g=1", "display_name": "sixty4bit", "link": "https://stackoverflow.com/users/1066615/sixty4bit"}, "edited": false, "score": 1, "creation_date": 1529102084, "post_id": 50880663, "comment_id": 88768908, "body": "Thanks! Part of the obstacle this cleared up was being able to see that &quot;args&quot; and &quot;flags&quot; are actually both args - just parsed differently."}], "tags": [], "owner": {"reputation": 202, "user_id": 5657035, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QRy929VXFaw/AAAAAAAAAAI/AAAAAAAACBE/ZLxQDTQo0Nc/photo.jpg?sz=128", "display_name": "laverya", "link": "https://stackoverflow.com/users/5657035/laverya"}, "is_accepted": true, "score": 6, "last_activity_date": 1529085829, "creation_date": 1529085829, "answer_id": 50880663, "question_id": 49848898, "link": "https://stackoverflow.com/questions/49848898/cobra-how-to-set-flags-programmatically-in-tests/50880663#50880663", "title": "Cobra: how to set flags programmatically in tests", "body": "<p>You can use the <code>(c *Command) SetArgs(a []string)</code> <a href=\"https://github.com/spf13/cobra/blob/4dab30cb33e6633c33c787106bafbfbfdde7842d/command.go#L202\" rel=\"noreferrer\">function</a> for this. The fact that some of your arguments are integers or booleans doesn't matter here - after all, that's what a user will be entering on the command line!</p>\n\n<p>The <code>(c *Command) DebugFlags()</code> <a href=\"https://github.com/spf13/cobra/blob/4dab30cb33e6633c33c787106bafbfbfdde7842d/command.go#L1100\" rel=\"noreferrer\">function</a> can be used when you're developing the test to ensure that the flags you're passing are being interperted properly, too.</p>\n\n<p>My integration tests with Cobra tend to end up looking like this:</p>\n\n<pre><code>...\n\ncmd := cli.RootCmd()\nbuf := new(bytes.Buffer)\ncmd.SetOutput(buf)\ncmd.SetArgs([]string{\n    \"--some-flag\",\n    fmt.Sprintf(\"--some-string=%s\", value),\n    fmt.Sprintf(\"--some-integer=%d\", integer),\n})\nerr := cmd.Execute()\n\n...\n</code></pre>\n"}], "owner": {"reputation": 6202, "user_id": 1066615, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/iv68W.png?s=128&g=1", "display_name": "sixty4bit", "link": "https://stackoverflow.com/users/1066615/sixty4bit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3012, "favorite_count": 2, "accepted_answer_id": 50880663, "answer_count": 1, "score": 5, "last_activity_date": 1529085829, "creation_date": 1523846112, "last_edit_date": 1523847000, "question_id": 49848898, "link": "https://stackoverflow.com/questions/49848898/cobra-how-to-set-flags-programmatically-in-tests", "title": "Cobra: how to set flags programmatically in tests", "body": "<p>I'm using <code>cobra</code> to build a CLI and want to simulate a command being run with different sets of options/flags. I've been trying to figure out how I can use the cobra APIs to set flags within my test but haven't really gotten it yet.</p>\n\n<p>I have this:</p>\n\n<pre><code>// NewFooCmd returns a cobra.Command fitted to print output to the buffer for easier testing.\nbuf := &amp;bytes.Buffer{}\ncmd := package.NewFooCmd(buf)\n\ncmd.Execute()\n\n// some validations on the content of buf\n</code></pre>\n\n<p>So far the closest thing I've found is:</p>\n\n<p><code>cmd.Flags().Set(name string, value string)</code></p>\n\n<p>...but this doesn't seem right because while the names of flags are all strings, they don't all take strings as values. Also it just doesn't seem to work even if I have an <code>int</code> flag and pass <code>string(1)</code>.</p>\n\n<p>Is there something simple I'm missing here?</p>\n"}, {"tags": ["amazon-web-services", "caching", "go", "nosql", "serverless"], "answers": [{"tags": [], "owner": {"reputation": 641, "user_id": 8267764, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DTJj4AbHIQg/AAAAAAAAAAI/AAAAAAAAE20/uATIeLKnpvU/photo.jpg?sz=128", "display_name": "Joaqu&#237;n Bucca", "link": "https://stackoverflow.com/users/8267764/joaqu%c3%adn-bucca"}, "is_accepted": true, "score": 1, "last_activity_date": 1523832002, "creation_date": 1523832002, "answer_id": 49847468, "question_id": 49847287, "link": "https://stackoverflow.com/questions/49847287/how-do-you-balance-nosql-storage-and-caching-in-serverless-architectures/49847468#49847468", "title": "How do you balance nosql storage and caching in serverless architectures?", "body": "<p>You could go for AWS ElastiCache (redis or memcache) but that isn't really serverless so may not be an option.</p>\n\n<p>AWS Lambda allows you to write in <code>/tmp</code> directory and you could have something cached in memory. I do <strong>NOT</strong> recommend that option though. Lambdas don't always run in the same instance so you won't have any guarantee at all that next time the Lambda is invoked you'll have something on <code>/tmp</code> directory.</p>\n\n<p>Take a look at <a href=\"https://aws.amazon.com/dynamodb/dax/?nc1=h_ls\" rel=\"nofollow noreferrer\">Amazon DynamoDb Accelerator (DAX)</a> that provides a highly available cache in front of DynamoDB.</p>\n"}], "owner": {"reputation": 37, "user_id": 4073129, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/02eabe7699d26aa6910b4da3e0f3dc3a?s=128&d=identicon&r=PG&f=1", "display_name": "Bill", "link": "https://stackoverflow.com/users/4073129/bill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 49847468, "answer_count": 1, "score": 0, "last_activity_date": 1523832002, "creation_date": 1523830345, "question_id": 49847287, "link": "https://stackoverflow.com/questions/49847287/how-do-you-balance-nosql-storage-and-caching-in-serverless-architectures", "title": "How do you balance nosql storage and caching in serverless architectures?", "body": "<p>I'm writing a go-based app for serverless environment (aws). Fairly new to writing app-level code, and I have an infrastructure background.</p>\n\n<p>I understand cache isn't persistent, but do I really need to concern myself with persistence in a true serverless environment? From a requirements standpoint, simple dynamodb tables can accommodate my storage needs, but caching would give me better performance, right? And I need performance, which is a big reason why I'm using go for the app.</p>\n"}, {"tags": ["json", "go", "marshalling"], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": false, "score": 6, "last_activity_date": 1523829808, "creation_date": 1523829808, "answer_id": 49847232, "question_id": 49846968, "link": "https://stackoverflow.com/questions/49846968/golang-json-marshalling-with-embedded-struct-not-working/49847232#49847232", "title": "golang json marshalling with embedded struct not working", "body": "<p>The <code>location</code> field of <code>AWSS3Bucket</code> is not exported (i.e. it doesn't begin with an upper case letter) so the <code>json</code> package cannot find it using reflection. If you export the field:</p>\n\n<pre><code>type AWSS3Bucket struct {\n    s3.Bucket\n    Location string\n}\n</code></pre>\n\n<p>then it will show up in <code>jsonString</code>. If you want it to show up as <code>\"location\":...</code> in the JSON then tag it as such:</p>\n\n<pre><code>type AWSS3Bucket struct {\n    s3.Bucket\n    Location string `json:\"location\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 7638394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f694d100bbeff6d06174a77013999188?s=128&d=identicon&r=PG&f=1", "display_name": "Omprakaash", "link": "https://stackoverflow.com/users/7638394/omprakaash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1809, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523829808, "creation_date": 1523827749, "last_edit_date": 1523829376, "question_id": 49846968, "link": "https://stackoverflow.com/questions/49846968/golang-json-marshalling-with-embedded-struct-not-working", "title": "golang json marshalling with embedded struct not working", "body": "<p>I'm trying to extend the AWS S3 Bucket type to include an additional format and marshal it as JSON, but the marshalling won't pick up the additional field</p>\n\n<p>This is what I have</p>\n\n<pre><code>// AWS has this struct already\ntype Bucket struct {\n    // Date the bucket was created.\n    CreationDate *time.Time `type:\"timestamp\" \n    timestampFormat:\"iso8601\"`\n\n    // The name of the bucket.\n    Name *string `type:\"string\"`\n    // contains filtered or unexported fields\n}\n\n// Extended struct\ntype AWSS3Bucket struct {\n    s3.Bucket\n    location     string\n}\n\nsomefunc()\n{\n    var region string = \"us-west-1\"\n    aws_s3_bucket := AWSS3Bucket{Bucket:*bucket, location:region}\n    jsonString, err := json.Marshal(&amp;aws_s3_bucket)\n    fmt.Printf(\"%s\\n\", jsonString)\n}\n</code></pre>\n\n<p>What I get is just the encoding of Bucket. For e.g., my output from above is always like this without the region included</p>\n\n<pre><code>{\"CreationDate\":\"2016-10-17T22:33:14Z\",\"Name\":\"test-bucket\"}\n</code></pre>\n\n<p>Any ideas why the region is not being marshalled into the json buffer ?</p>\n"}, {"tags": ["go", "concurrency", "cpu"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523825263, "post_id": 49846247, "comment_id": 86708154, "body": "This doesn&#39;t compile; m in main is undefined. Also, a defer statement at the end of a function is redundant. Place it at or near the top or remove the defer. In this case you don&#39;t need the anonymous goroutine in main at all."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523825404, "post_id": 49846247, "comment_id": 86708187, "body": "Ignore the part about m being undefined. I got confused by your wonky indentation. So the question is why the goroutine in main doesn&#39;t make your program faster? Because adding it makes no difference at all, that&#39;s why. You&#39;re just replacing the main goroutine with the anonymous one. main does absolutely nothing but wait."}, {"owner": {"reputation": 1509, "user_id": 4815767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc24bfa1708763d1853a48c6290fbcaa?s=128&d=identicon&r=PG", "display_name": "Popmedic", "link": "https://stackoverflow.com/users/4815767/popmedic"}, "edited": false, "score": 2, "creation_date": 1523838708, "post_id": 49846247, "comment_id": 86711124, "body": "This question makes no sense."}, {"owner": {"reputation": 57, "user_id": 8479510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/217776a6445ea0d5c2dde8bcb8e6336d?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/8479510/chrisdave"}, "edited": false, "score": 0, "creation_date": 1523854975, "post_id": 49846247, "comment_id": 86714349, "body": "so what about the CPU usage...Even if i remove anonymous go in main.. i am still at 3-6% CPU, and as the QPS increases the execution time of the program increases. Why cant the CPU increase to 90% and give me better execution time for increase QPS"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 8479510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/217776a6445ea0d5c2dde8bcb8e6336d?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/8479510/chrisdave"}, "edited": false, "score": 0, "creation_date": 1523853688, "post_id": 49848128, "comment_id": 86714075, "body": "It is asynchronous, i was following <a href=\"https://stackoverflow.com/questions/12398359/throw-all-goroutines-are-asleep-deadlock\" title=\"throw all goroutines are asleep deadlock\">stackoverflow.com/questions/12398359/&hellip;</a>"}, {"owner": {"reputation": 341, "user_id": 529321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e974ce23b1f3016285b373fcba49c310?s=128&d=identicon&r=PG", "display_name": "skomp", "link": "https://stackoverflow.com/users/529321/skomp"}, "edited": false, "score": 1, "creation_date": 1523943512, "post_id": 49848128, "comment_id": 86756429, "body": "stating it again, doesn&#39;t make it more correct. @Popmedic is right. Although there is a go routine doing some work, the caller of the routine just blocks."}], "tags": [], "owner": {"reputation": 1509, "user_id": 4815767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc24bfa1708763d1853a48c6290fbcaa?s=128&d=identicon&r=PG", "display_name": "Popmedic", "link": "https://stackoverflow.com/users/4815767/popmedic"}, "is_accepted": false, "score": 2, "last_activity_date": 1523838619, "creation_date": 1523838619, "answer_id": 49848128, "question_id": 49846247, "link": "https://stackoverflow.com/questions/49846247/golang-asynchronous-and-cpu-usage/49848128#49848128", "title": "Golang asynchronous and CPU usage", "body": "<p>I am not sure exactly what you are trying to do in this little server.  </p>\n\n<p>1) You are creating a WaitGroup and adding 1 to it, calling a anonymous go routine, and waiting in main, this does nothing more then move your main to the anonymous function.</p>\n\n<p>2) Lets look at what your are doing in the <code>check</code> and <code>total</code> functions:</p>\n\n<pre><code>func total(in chan int, out chan int) {\n    res := 0\n    // this will just pull the value, and then wait till the next value \n    // is pushed... till you close the \"in\" channel\n    for iter := range in {\n        res += iter\n    }\n    out &lt;- res // sends back the result\n}\n\nfunc check() {\n\n    ch := make(chan int)\n    rch := make(chan int)\n    go total(ch, rch)\n    // we are pushing this value into a unbuffered channel...\n    ch &lt;- 1  // this gets pushed and waits until it is pulled in the total function \n    ch &lt;- 2  // this gets pushed and waits until it is pulled in the total function \n    ch &lt;- 3  // this gets pushed and waits until it is pulled in the total function \n    close(ch)       // this will end the loop in the total function\n    result := &lt;-rch // waits for total to give the result\n    fmt.Println(\"Total is \", result)\n} \n</code></pre>\n\n<p>Please help me understand how this would use any concurrency when it is completely synchronous?</p>\n\n<p>Maybe if you put the call to <code>check</code> in a go routine it would be a little more efficient, but still really makes no sense to me.</p>\n"}], "owner": {"reputation": 57, "user_id": 8479510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/217776a6445ea0d5c2dde8bcb8e6336d?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/8479510/chrisdave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1032, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1523838619, "creation_date": 1523822657, "last_edit_date": 1523834756, "question_id": 49846247, "link": "https://stackoverflow.com/questions/49846247/golang-asynchronous-and-cpu-usage", "title": "Golang asynchronous and CPU usage", "body": "<p>I am learning Go concurrency, and my expectation is that using goroutines and channels should increase the concurrency. The program takes a few milliseconds to complete. But as the load increases the execution time keeps increasing though there is good amount of CPU idle.</p>\n\n<p>I am sending 1200 QPS/TPS  to the program below to analyze the request to response times, and I see that overall execution time of the program increases over time. Also, the CPU usage is around 3-6%.</p>\n\n<p>As I increase the QPS to 100,000, the execution time of the program increases to seconds (from milliseconds initially). But the CPU usage remains at 8-9%.</p>\n\n<p>So why doesn't the program use the other 90-94% of the available CPU and complete execution of the program more quickly?</p>\n\n<p><code>ulimit -n</code> is 2000000.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/valyala/fasthttp\"\n    \"strings\"\n    \"sync\"\n)\n\nfunc total(in chan int, out chan int) {\n    res := 0\n    for iter := range in {\n        res += iter\n    }\n    out &lt;- res // sends back the result\n}\n\nfunc check() {\n\n    ch := make(chan int)\n    rch := make(chan int)\n    go total(ch, rch)\n    ch &lt;- 1\n    ch &lt;- 2\n    ch &lt;- 3\n    close(ch)       // this will end the loop in the total function\n    result := &lt;-rch // waits for total to give the result\n    fmt.Println(\"Total is \", result)\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(1)\n\n    go func() {\n        m := func(ctx *fasthttp.RequestCtx) {\n\n            maingetpath := ctx.Path()\n            urlPart := strings.Split(string(maingetpath), \"/\")\n            func := urlPart[1]\n            switch string(func) {\n            case \"white\":\n                check()\n            default:\n                ctx.Error(\"not found\", fasthttp.StatusNotFound)\n            }\n        }\n\n        fasthttp.ListenAndServe(\":8080\", m)\n        defer wg.Done()\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523824681, "post_id": 49846123, "comment_id": 86707996, "body": "Placeholders are for data only, you can&#39;t use them for identifiers (table names, column names, etc.). If you feel that you need to do that you&#39;re very likely doing it wrong."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9538230"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523827370, "post_id": 49846123, "comment_id": 86708757, "body": "@Peter I was just testing the package out and thought I&#39;d create a very basic query that could be extended with placeholders to more efficiently test multiple scenarios. Considering that the Prepare() and Query() solution is meant to guard against injection, this restriction makes sense."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9538230"}, "edited": false, "score": 0, "creation_date": 1523827153, "post_id": 49846628, "comment_id": 86708708, "body": "I figured that was the case as I was able to use Exec() to insert strings into a sql string with VALUES(?), but not change the identifiers. The Sprintf() is an interesting end run around the restriction I had not thought of."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523827564, "post_id": 49846628, "comment_id": 86708794, "body": "@spynovel, do take care to only stitch string constants together with sprints, though. It&#39;s easy to go from there to not using parameters anymore."}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 2, "last_activity_date": 1523825224, "creation_date": 1523825224, "answer_id": 49846628, "question_id": 49846123, "link": "https://stackoverflow.com/questions/49846123/using-placeholder-in-go-mysql-query-for-anything-other-than-int/49846628#49846628", "title": "Using placeholder ? in Go mySql query for anything other than int", "body": "<p>You can't use placeholders for identifiers (such as table and column names), placeholders are for <em>values</em>. You can think of identifiers as being similar to variable or function names in Go so being able to use placeholders for identifiers would be akin to having an <code>eval</code> as in various scripting languages.</p>\n\n<p>This reduces you to using <code>fmt.Sprintf</code> and similar string operations for building the SQL when you don't know the identifiers until runtime:</p>\n\n<pre><code>col := \"firstName\"\nsql := fmt.Sprintf(\"select %s from persons\", col)\n</code></pre>\n\n<p>but this opens you up to SQL injection and quoting problems so you'd want some sort of whitelist:</p>\n\n<pre><code>quotedColumns := map[string]string{\n    \"firstName\": \"`firstName`\",\n    \"lastName\": \"`lastName`\",\n    ...\n}\n\nquoted, ok := quotedColumns[columnName]\nif !ok {\n    // Do something with the error here and run away...\n}\nsql := fmt.Sprintf(\"select %s from persons\", quoted)\n</code></pre>\n\n<p>Note that I've included the MySQL backtick quoting in the map's values. There's nothing in the standard interface for quoting/escaping an identifier so you have to do it yourself. If you're already writing the whitelist map by hand then you may as well include the quoting by hand too; otherwise you could write your own quoting function for identifiers by reading the MySQL documentation on quoting and doing a couple (hopefully) simple string operations.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9538230"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1432, "favorite_count": 0, "accepted_answer_id": 49846628, "answer_count": 1, "score": 1, "last_activity_date": 1523825224, "creation_date": 1523821770, "question_id": 49846123, "link": "https://stackoverflow.com/questions/49846123/using-placeholder-in-go-mysql-query-for-anything-other-than-int", "title": "Using placeholder ? in Go mySql query for anything other than int", "body": "<p>I've already setup and pinged my mysql database connection. It is working and I can return rows using both db.Query and by preparing a query first. I can use the placeholder <em>?</em> to then specify an id. Is it possible to use the ? as a placeholder for a column name? In the example here I am trying to return all rows from column <em>firstName</em> in table <em>persons</em>. </p>\n\n<pre><code>qry, err := db.Prepare(\"SELECT ? FROM persons\")\nif err != nil { log.Fatal(err) }\ndefer qry.Close()\nrows, err :=qry.Query(\"firstName\")\nif err != nil { log.Fatal(err) }\ndefer rows.Close()\n</code></pre>\n\n<p>I get the following error:\n<em>Error 1064: You have an error in your SQL syntax; \ncheck the manual that corresponds to your MySQL server version for the right\n syntax to use near '?' at line 1</em>  </p>\n"}, {"tags": ["arrays", "go", "struct", "maps", "slice"], "comments": [{"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 2, "creation_date": 1523821465, "post_id": 49846001, "comment_id": 86707049, "body": "1/ faster for what? maps and arrays have different goals. 2/ maybe it&#39;s faster to do any processing you might want BEFORE fetching results, AKA in the db query, databases are built to be fast 3/ Benchmark benchmark benchmark, until you identified the bottleneck optimization is useless. Your db query could take 5 seconds to respond and using a different data structure might get you a 15 ms gain, is this reasonable to spend time on the later rather than the former?"}, {"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "reply_to_user": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 0, "creation_date": 1523821961, "post_id": 49846001, "comment_id": 86707191, "body": "thanks @mpm for response actually faster in term of getting result from multiple query of the same format and a thousands of result  , for that purpose i &#39;d to think which will be ideal i did some searches before , for example :<a href=\"https://www.darkcoding.net/software/go-slice-search-vs-map-lookup/\" rel=\"nofollow noreferrer\">darkcoding.net/software/go-slice-search-vs-map-lookup</a> but i didn&#39;t understand"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523826002, "post_id": 49846001, "comment_id": 86708371, "body": "There is no X is better than Y answer here. If there would be we wouldn&#39;t have slices <i>and</i> maps. Nothing in your code does any kind of lookup, so I&#39;m not quite sure what the relevance of the linked article is. If you want to speed up the append operations, <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">give your slice an appropriate capacity</a>"}, {"owner": {"reputation": 5499, "user_id": 2160958, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/945c998bee33562c7f4c877a11c950c9?s=128&d=identicon&r=PG", "display_name": "vardius", "link": "https://stackoverflow.com/users/2160958/vardius"}, "edited": false, "score": 0, "creation_date": 1523843017, "post_id": 49846001, "comment_id": 86711884, "body": "Take a look at <a href=\"https://www.darkcoding.net/software/go-slice-search-vs-map-lookup/\" rel=\"nofollow noreferrer\">this lookup</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2298, "user_id": 1147230, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/fe33f45c5990a98cfcb1388581de07af?s=128&d=identicon&r=PG", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/1147230/sebastian"}, "is_accepted": false, "score": 1, "last_activity_date": 1523905132, "creation_date": 1523905132, "answer_id": 49864442, "question_id": 49846001, "link": "https://stackoverflow.com/questions/49846001/performance-searching-using-a-map-or-a-slice/49864442#49864442", "title": "performance searching using a map or a slice", "body": "<p>A slice/array is an (ordered) list of items. You could easily access item #42 but getting <em>the item called \"foo\"</em> is expensive (you need to walk through the list until you find it).</p>\n\n<p>A map is a key/value store: Accessing one item via it's key is fast, but walking through all items costs more than through a slice/array.</p>\n\n<p>The question is: What do you want to do with the data?\nDo you want to grab individual items -> Use a map\nDo you want to use the whole list -> Use a slice/array</p>\n\n<p>Here's an (untested) sample using your code to fill a map, but that might be a very bad solution depending on your usage case.</p>\n\n<p>In case you're writing a generic search function, consider adding some server-side filter logic. Nothing is worse than fetching the whole database table and then filtering it in memory!</p>\n\n<pre><code>func search() (users map[string]Users, err error) {\n\n    users = make(map[string]Users)\n    rows, _ := mysql.Query(\"select name,job from users\")\n\n    for rows.Next() {\n        var user Users\n        rows.Scan(&amp;user.Name, &amp;user.Job)\n        users[user.Name] = user\n    }\n    return\n}\n</code></pre>\n\n<p>See also <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-maps-in-action</a></p>\n"}], "owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1489, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523905132, "creation_date": 1523820983, "last_edit_date": 1523882692, "question_id": 49846001, "link": "https://stackoverflow.com/questions/49846001/performance-searching-using-a-map-or-a-slice", "title": "performance searching using a map or a slice", "body": "<p>I have a struct called Users </p>\n\n<pre><code>type Users struct {\n    name string\n    job  string\n}\n</code></pre>\n\n<p>Search function </p>\n\n<pre><code>func search() (users []Users, err error) {\n\n    users = make([]Users, 0)\n    rows, _ := mysql.Query(\"select name,job from users\")\n\n    for rows.Next() {\n        var user Users\n        rows.Scan(&amp;user.Name, &amp;user.Job)\n        users = append(users, user)\n    }\n    return\n}\n</code></pre>\n\n<p>As you may notice I am working with slice  but due to the huge number of result that I have to handle I must work on performance, I have heard that the map are more faster in term of performance but I don't know if my example is included?\nIf it's the case could you please suggest me via my code who to write a map array and try to append for each line of the query result.</p>\n"}, {"tags": ["go", "command-line-arguments"], "comments": [{"owner": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "edited": false, "score": 2, "creation_date": 1523813655, "post_id": 49844835, "comment_id": 86704488, "body": "Move <code>&lt; 1</code> out of the parenthesis."}, {"owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "reply_to_user": {"reputation": 26552, "user_id": 448932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QgLLl.png?s=128&g=1", "display_name": "500 - Internal Server Error", "link": "https://stackoverflow.com/users/448932/500-internal-server-error"}, "edited": false, "score": 0, "creation_date": 1523813733, "post_id": 49844835, "comment_id": 86704509, "body": "Well that was silly on my part. Thank you for helping! If you want, you can submit that as an answer and I will select it."}], "answers": [{"tags": [], "owner": {"reputation": 500, "user_id": 6556102, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpQ4E.jpg?s=128&g=1", "display_name": "jedruniu", "link": "https://stackoverflow.com/users/6556102/jedruniu"}, "is_accepted": false, "score": 1, "last_activity_date": 1523813701, "creation_date": 1523813701, "answer_id": 49844880, "question_id": 49844835, "link": "https://stackoverflow.com/questions/49844835/how-to-check-for-command-line-arguments-in-go/49844880#49844880", "title": "How to check for command line arguments in GO", "body": "<p>You should check the flags package, with it you can define what is passed to your program and act upon passed flag: <a href=\"https://golang.org/pkg/flag/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/flag/</a></p>\n"}], "owner": {"reputation": 117, "user_id": 8206309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/yJtSm.jpg?s=128&g=1", "display_name": "PushedCrayon", "link": "https://stackoverflow.com/users/8206309/pushedcrayon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1016, "favorite_count": 0, "closed_date": 1523875837, "answer_count": 1, "score": -2, "last_activity_date": 1523814288, "creation_date": 1523813392, "question_id": 49844835, "link": "https://stackoverflow.com/questions/49844835/how-to-check-for-command-line-arguments-in-go", "closed_reason": "Not suitable for this site", "title": "How to check for command line arguments in GO", "body": "<p>I am writing a program that makes a simple web server in GO. The program should check for a port passed in the command line. If no port is given, I want to panic and exit the program. I thought this should work:</p>\n\n<pre><code>if len(os.Args &lt; 1) {\n    panic(\"No port number given!\")\n}\n</code></pre>\n\n<p>But for some reason it is saying mismatched types []string and int. How can I change this simple if so it works correctly? I am new to GO, so I am sorry if this is a simple question.</p>\n"}, {"tags": ["go", "slice", "strconv"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523804840, "post_id": 49843304, "comment_id": 86701378, "body": "Looks like your input isn&#39;t strictly comma separated. Also, the last loop assumes that all slices have the same length, which seems unlikely."}, {"owner": {"reputation": 27, "user_id": 3015224, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100000179411798/picture?type=large", "display_name": "user3015224", "link": "https://stackoverflow.com/users/3015224/user3015224"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523805662, "post_id": 49843304, "comment_id": 86701664, "body": "Here is my input: Crestview,45.344387632924054,-75.73795670904249 BellevueManor,45.37223315413918,-75.73886856878032 Dutchie&#39;sHole,45.420784695340274,-75.66809864107668 Bingham,45.43364510779131,-75.69570714265845 AlvinHeights,45.45147956435529,-75.65100870365318  Britannia,45.36063791083469,-75.79935158132524 Chaudiere,45.40984992554796,-75.71353870063207 Parkdale,45.40138661908912,-75.73023035094172 AltaVista,45.383081724040146,-75.6663971454287 CecilMorrison,45.417175891787146,-75.64599611564647"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523806546, "post_id": 49843304, "comment_id": 86701976, "body": "See? There are newlines in there."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1523805823, "creation_date": 1523805823, "answer_id": 49843584, "question_id": 49843304, "link": "https://stackoverflow.com/questions/49843304/golang-parse-array/49843584#49843584", "title": "Golang parse array", "body": "<p>Your code has <code>strings</code> as a variable name:</p>\n\n<pre><code>var strings []string\n</code></pre>\n\n<p>and <code>strings</code> as a package name:</p>\n\n<pre><code>tokens := strings.Split(str, \",\")\n</code></pre>\n\n<p>Don't do that!</p>\n\n<pre><code>strings.Split undefined (type []string has no field or method Split)\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/HfZGj0jOT-P\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HfZGj0jOT-P</a></p>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 3015224, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100000179411798/picture?type=large", "display_name": "user3015224", "link": "https://stackoverflow.com/users/3015224/user3015224"}, "edited": false, "score": 0, "creation_date": 1523808790, "post_id": 49843707, "comment_id": 86702708, "body": "I do have a struct like that. However, I figured I would read into 3 separate arrays, then use one iterator to read from each of the arrays and assign structs from that so I could just go for i, v := range names{ p := make(Place) p.Name = v p.Latitude = positives[i] p.Longitude = negatives[i] } then append that to a slice"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 27, "user_id": 3015224, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100000179411798/picture?type=large", "display_name": "user3015224", "link": "https://stackoverflow.com/users/3015224/user3015224"}, "edited": false, "score": 0, "creation_date": 1523817196, "post_id": 49843707, "comment_id": 86705724, "body": "I think you&#39;d be better to use the csv library, and read each row into a struct, either would work I guess, but you should consider each row alone really - your problem arose because you code assumes failure to parse float meant &#39;new row&#39; when there can be other causes."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1523806626, "creation_date": 1523806626, "answer_id": 49843707, "question_id": 49843304, "link": "https://stackoverflow.com/questions/49843304/golang-parse-array/49843707#49843707", "title": "Golang parse array", "body": "<p>Your problem above I think lies with the extra \\n attached to each float probably - you get no negative entries if you end in a linefeed or you would get one if you have no linefeed at the end. So insert a printf so that you can see the errors you're getting from strconv.ParseFloat and all will become clear. </p>\n\n<p>Some small points which may help:</p>\n\n<ul>\n<li>Check errors, and don't depend on an error to be of only one type (this is what is confusing you here) - always print the error if it arrives, particularly when debugging</li>\n<li>Don't use the name of a package for a variable (strings), it won't end well</li>\n<li>Use a datastructure which reflects your data</li>\n<li>Use the CSV package to read CSV data </li>\n</ul>\n\n<p>So for example for storing the data you might want:</p>\n\n<pre><code>type Place struct {\n   Name string \n   Latitude int64\n   Longitude int64\n}\n</code></pre>\n\n<p>Then read the data into that, depending on the fact that cols are in a given order, and store it in a []Place.  </p>\n"}, {"tags": [], "owner": {"reputation": 27, "user_id": 3015224, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100000179411798/picture?type=large", "display_name": "user3015224", "link": "https://stackoverflow.com/users/3015224/user3015224"}, "is_accepted": false, "score": 0, "last_activity_date": 1523822136, "creation_date": 1523822136, "answer_id": 49846178, "question_id": 49843304, "link": "https://stackoverflow.com/questions/49843304/golang-parse-array/49846178#49846178", "title": "Golang parse array", "body": "<p>Here's what I tried, it works now! Thanks for the help, everyone!</p>\n\n<pre><code>func main() {\nfindRoute(\"poolss.csv\", 5)\n }\n\nfunc findRoute( filename string, num int) []Edge {\nvar route []Edge\ncsvFile, err := os.Open(filename)\nif err != nil {\n    return route\n}\nreader := csv.NewReader(bufio.NewReader(csvFile))\nvar pools []Pool\nfor {\n    line, error := reader.Read()\n    if error == io.EOF {\n        break\n    } else if error != nil {\n        log.Fatal(error)\n    }\n    lat, err := strconv.ParseFloat(line[1], 64)\n    long, err := strconv.ParseFloat(line[2], 64)\n    if err == nil {\n        pools = append(pools, Pool{\n            name: line[0],\n            latitude:  lat,\n            longitude: long,\n        })\n    }\n}\nreturn route\n}\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 3015224, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/100000179411798/picture?type=large", "display_name": "user3015224", "link": "https://stackoverflow.com/users/3015224/user3015224"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1646, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1523822136, "creation_date": 1523804122, "last_edit_date": 1523808339, "question_id": 49843304, "link": "https://stackoverflow.com/questions/49843304/golang-parse-array", "title": "Golang parse array", "body": "<p>I am trying to figure out why my code is not working. I wish to take a slice of numbers and strings, and separate it into three slices. For each element in the slice, if it is a string, append it to the strings slice, and if it is a positive number, append it to the positive numbers, and likewise with negative. Yet, here is the output</p>\n\n<p>Names: \nEvTremblay\n45.39934611083154\n-75.71148292845268</p>\n\n<p>[Crestview -75.73795670904249\nBellevueManor -75.73886856878032\nDutchie'sHole -75.66809864107668 ...</p>\n\n<p>Positives:[45.344387632924054 45.37223315413918 ... ]\nNegatives: []</p>\n\n<p>Here is my code. Can someone tell me what is causing the Negatives array to not have any values?</p>\n\n<pre><code>func main() {\n    fmt.Printf(\"%q\\n\", strings.Split(\"a,b,c\", \",\"))\n    var names []string\n    var positives, negatives []float64\n    bs, err := ioutil.ReadFile(\"poolss.txt\")\n    if err != nil {\n        return\n    }\n    str := string(bs)\n    fmt.Println(str)\n    tokens := strings.Split(str, \",\")\n    for _, token := range tokens {\n        if num, err := strconv.ParseFloat(token, 64); err == nil {\n            if num &gt; 0 {\n                positives = append(positives, num)\n            } else {\n                negatives = append(negatives, num)\n            }\n\n        } else {\n            names = append(names, token)\n        }\n\n    fmt.Println(token)\n    }\n\n    fmt.Println(fmt.Sprintf(\"Strings: %v\",names))\n    fmt.Println(fmt.Sprintf(\"Positives: %v\", positives))\n    fmt.Println(fmt.Sprintf(\"Negatives: %v\",negatives))\n    for i := range names{\n        fmt.Println(names[i])\n\n        fmt.Println(positives[i])\n\n        fmt.Println(negatives[i])\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523802854, "post_id": 49842546, "comment_id": 86700739, "body": "In a comment to a now deleted answer you said you are measuring memory usage with OS tools. Like most runtimes with garbage collection, Go does not return unused memory to the OS immediately to save malloc calls. How long did you wait after the test completed?"}, {"owner": {"reputation": 4021, "user_id": 1102018, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2dc26c2009c4a0b4a2833de6c5208eaa?s=128&d=identicon&r=PG", "display_name": "user1102018", "link": "https://stackoverflow.com/users/1102018/user1102018"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523805951, "post_id": 49842546, "comment_id": 86701766, "body": "Well, I&#39;ve waited around 10 minutes, and the memory is not yet freed"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1523807073, "post_id": 49842546, "comment_id": 86702140, "body": "take a look with expvar and expvarmon. easy to setup, easy to visualize."}, {"owner": {"reputation": 4021, "user_id": 1102018, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2dc26c2009c4a0b4a2833de6c5208eaa?s=128&d=identicon&r=PG", "display_name": "user1102018", "link": "https://stackoverflow.com/users/1102018/user1102018"}, "edited": false, "score": 0, "creation_date": 1523863093, "post_id": 49842546, "comment_id": 86717611, "body": "I don&#39;t understand the downvotes, as there is clearly a problem here. The &quot;duplicate&quot; question is not duplicate. The comments didn&#39;t help. I&#39;ve waited half an hour and the memory is still high. I called <code>debug.FreeOSMemory()</code> and nothing happens. There&#39;s clearly a problem here and I&#39;m sure that you can create it on your local machine. As I said in the post, I would appreciate any help. Thanks"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523896274, "post_id": 49842546, "comment_id": 86739359, "body": "Note that \u201creleasing\u201d memory is only advisory, depending on the OS it may not reclaim it until there is memory pressure to do so."}], "answers": [{"comments": [{"owner": {"reputation": 4021, "user_id": 1102018, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2dc26c2009c4a0b4a2833de6c5208eaa?s=128&d=identicon&r=PG", "display_name": "user1102018", "link": "https://stackoverflow.com/users/1102018/user1102018"}, "edited": false, "score": 0, "creation_date": 1523862871, "post_id": 49843380, "comment_id": 86717480, "body": "thanks for the suggestion. I monitored the RSS, and after 20 minutes it&#39;s still at its peak. I called <code>FreeOSMemory()</code> a minute after the load test, and nothing happens. This looks really bad"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 4021, "user_id": 1102018, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2dc26c2009c4a0b4a2833de6c5208eaa?s=128&d=identicon&r=PG", "display_name": "user1102018", "link": "https://stackoverflow.com/users/1102018/user1102018"}, "edited": false, "score": 0, "creation_date": 1523868664, "post_id": 49843380, "comment_id": 86720737, "body": "@user1102018: I&#39;ve used your original code and go 1.10.1 on Ubuntu 16.04 and this is the result I&#39;ve got. Did you really look at the RSS and not the VSZ? And, did you rerun tcpkali with the go program still running to see if the size increases further?"}, {"owner": {"reputation": 4021, "user_id": 1102018, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2dc26c2009c4a0b4a2833de6c5208eaa?s=128&d=identicon&r=PG", "display_name": "user1102018", "link": "https://stackoverflow.com/users/1102018/user1102018"}, "edited": false, "score": 0, "creation_date": 1523873666, "post_id": 49843380, "comment_id": 86723999, "body": "I&#39;m running Go 1.9.4 on macOS 10.13.1, and yes, I&#39;m looking at the RSS. After the first run, RSS was at 8516. After the second run, RSS climbed to 8572. Started waiting. 5 minutes into the break, RSS climbed to 8588. 10 minutes into the break, RSS climbed to 8608, and seems stable. After 15 minutes of break, I ran tcpkali again, and RSS climbed to 8684"}, {"owner": {"reputation": 4021, "user_id": 1102018, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2dc26c2009c4a0b4a2833de6c5208eaa?s=128&d=identicon&r=PG", "display_name": "user1102018", "link": "https://stackoverflow.com/users/1102018/user1102018"}, "edited": false, "score": 0, "creation_date": 1523875090, "post_id": 49843380, "comment_id": 86724862, "body": "after 20 more minutes of idle time, I ran tcpkali again. Now the RSS is at 8696. For me, this is memory leak. A long running simple server like this will eventually consume all available memory, if such a behavior persists. This is really frustrating."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 4021, "user_id": 1102018, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2dc26c2009c4a0b4a2833de6c5208eaa?s=128&d=identicon&r=PG", "display_name": "user1102018", "link": "https://stackoverflow.com/users/1102018/user1102018"}, "edited": false, "score": 0, "creation_date": 1523876698, "post_id": 49843380, "comment_id": 86725847, "body": "@user1102018: given that the RSS does not really climb anymore (this small increase might be due to fragmentation when managing the allocated memory) I don&#39;t see it consuming all available memory eventuelly. It is still strange that it does not give the memory back to the OS as it does in my tests."}, {"owner": {"reputation": 4021, "user_id": 1102018, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2dc26c2009c4a0b4a2833de6c5208eaa?s=128&d=identicon&r=PG", "display_name": "user1102018", "link": "https://stackoverflow.com/users/1102018/user1102018"}, "edited": false, "score": 0, "creation_date": 1523879538, "post_id": 49843380, "comment_id": 86727649, "body": "I&#39;ve just tested the same code on Ubuntu 14.04, and the memory is freed as you said. Seems like a macOS issue."}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 4, "last_activity_date": 1523804618, "creation_date": 1523804618, "answer_id": 49843380, "question_id": 49842546, "link": "https://stackoverflow.com/questions/49842546/why-is-my-go-server-memory-leaking/49843380#49843380", "title": "Why is my Go server memory leaking?", "body": "<p>Go does not release memory it allocated from the OS immediately. The reason is probably that allocating memory is costly (needs system calls) and the chance is high that it will be needed in the near future anyway again. But, if memory gets long enough unused it will be released eventually so that the RSS of the process decreases  again. </p>\n\n<p>Doing your test again with slight modifications will show this (it did at least for me):</p>\n\n<ol>\n<li>Start you program and look at the RSS.</li>\n<li>Run tcpkali, wait for tcpkali to end and look at the RSS again. It is much higher now since lots of memory was needed for the program to do the intended task.</li>\n<li>Don't stop the program but run tcpkali again and wait again for it to end. When looking at the RSS you should see that it did not grow (much) further. This means that the program used the already allocated memory again and did not need to allocate new memory from the system.</li>\n<li>Now monitor the RSS and wait. After a while (about 10 minutes on my system) you should see the RSS go down again. This is because the program has determined now that the allocated but unused memory will probably not be used any longer and returned the memory back to the OS.</li>\n</ol>\n\n<p>Note that not all memory might be given back. According to <a href=\"https://deferpanic.com/blog/understanding-golang-memory-usage/\" rel=\"nofollow noreferrer\">Understanding Go Lang Memory Usage</a> it will not return (in go 1.3) the memory used for the stacks of the go routines since it is more likely that this will be needed in the future.</p>\n\n<p>For testing you might also add some <code>debug.FreeOSMemory()</code> (from <code>runtime/debug</code>) at strategic places (like when you break out of the loop in the goroutine) so that the memory gets returned earlier to the OS. But given that the lazy return of memory is for performance such explicit freeing might impact the performance.</p>\n"}], "owner": {"reputation": 4021, "user_id": 1102018, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/2dc26c2009c4a0b4a2833de6c5208eaa?s=128&d=identicon&r=PG", "display_name": "user1102018", "link": "https://stackoverflow.com/users/1102018/user1102018"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 768, "favorite_count": 1, "closed_date": 1523817509, "accepted_answer_id": 49843380, "answer_count": 1, "score": 0, "last_activity_date": 1523880180, "creation_date": 1523799400, "last_edit_date": 1523880180, "question_id": 49842546, "link": "https://stackoverflow.com/questions/49842546/why-is-my-go-server-memory-leaking", "closed_reason": "Duplicate", "title": "Why is my Go server memory leaking?", "body": "<p>I've written a simple TCP server.<br>\nThe problem is that when stress-testing it, it seems that the memory usage is increasing dramatically, and not decreasing when he test is done.\nWhen the server is started, it takes ~700KB.<br>\nDuring and after the stress-test, the memory usage jumps to ~7MB.<br>\nHere's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"log\"\n    \"fmt\"\n    \"bufio\"\n)\n\nfunc main() {\n    ln, err := net.Listen(\"tcp\", \":8888\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer ln.Close()\n    for {\n        conn, err := ln.Accept()\n        if err != nil {\n            fmt.Println(err)\n            continue\n        }\n        go handle(conn)\n    }\n}\n\nfunc handle(conn net.Conn) {\n    defer conn.Close()\n    fmt.Println(\"Accepted\", conn.LocalAddr())\n    for {\n        buf, err := bufio.NewReader(conn).ReadString('\\n')\n        if err != nil {\n            break\n        }\n        msg := string(buf[:len(buf)-2])\n        fmt.Println(\"Received\", msg)\n        conn.Write([]byte(\"OK\\n\"))\n    }\n}\n</code></pre>\n\n<p>Any help is much appreciated.  </p>\n\n<p>Note: I'm using <code>tcpkali</code> for loading it. This is the command line:</p>\n\n<pre><code>tcpkali -em \"testing\\r\\n\" -c 100 -r 1000 -T 60  127.0.0.1:8888\n</code></pre>\n\n<p>EDIT: Following some comments below, I ran some tests and here are the results:</p>\n\n<ol>\n<li>Started the server and ran <code>tcpkali</code>.</li>\n<li>After the first run, RSS was at 8516.</li>\n<li>After a second run, RSS climbed to 8572.</li>\n<li>Server is now idle. 5 minutes later, RSS climbed to 8588.</li>\n<li>5 more minutes later, RSS climbed to 8608, and seems stable.</li>\n<li>After 15 minutes of break, I ran <code>tcpkali</code> again, and RSS climbed to 8684.</li>\n<li>A few minutes break, another <code>tcpkali</code> run, RSS climbs to 8696.</li>\n<li>A few minutes break, another <code>tcpkali</code> run, RSS climbs to 8704.</li>\n<li>A few minutes break, another <code>tcpkali</code> run, RSS climbs to 8712.</li>\n</ol>\n\n<p>Now, I don't know what you call this, but I call this a memory leak. Something is wrong here. No memory is freed, and RSS is keep climbing every time I run a test. Obviously, this thing cannot be deployed to production as it will eventually consume all available memory.<br>\nI also tried calling <code>os.FreeOSMemory()</code> but nothing happens.  </p>\n\n<p>My system is Go 1.9.4 on macOS 10.13.1. Is this environment related or am I missing something?</p>\n\n<p><strong>LAST UPDATE:</strong><br>\nFollowing @Steffen Ullrich answer and the tests that failed on my environment, I gave it a try on Ubuntu server, and the memory is freed after a few minutes of idle time.<br>\nSeems like there's an issue with macOS.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 4, "creation_date": 1523797453, "post_id": 49841673, "comment_id": 86699010, "body": "these instructions work <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">golang.org/doc/install</a>"}, {"owner": {"reputation": 1419, "user_id": 8260045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567463b365e1764b2435bb9f03bee8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Sam_2207", "link": "https://stackoverflow.com/users/8260045/sam-2207"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1523800323, "post_id": 49841673, "comment_id": 86699944, "body": "I have tried that but it gives me the same error message which I mentioned in my question when I am doing <b>source ~/.profile</b>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1523821250, "post_id": 49841673, "comment_id": 86706986, "body": "Try copying and pasting the text instead of typing it manually."}], "answers": [{"tags": [], "owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "is_accepted": false, "score": 0, "last_activity_date": 1523926840, "creation_date": 1523926840, "answer_id": 49868287, "question_id": 49841673, "link": "https://stackoverflow.com/questions/49841673/facing-issues-while-installing-golang/49868287#49868287", "title": "facing issues while installing Golang", "body": "<p>Try this script:</p>\n\n<pre><code>git clone https://github.com/udhos/update-golang\ncd update-golang\nsudo ./update-golang.sh\n</code></pre>\n\n<p>Full details: <a href=\"https://github.com/udhos/update-golang\" rel=\"nofollow noreferrer\">https://github.com/udhos/update-golang</a></p>\n"}], "owner": {"reputation": 1419, "user_id": 8260045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567463b365e1764b2435bb9f03bee8e5?s=128&d=identicon&r=PG&f=1", "display_name": "Sam_2207", "link": "https://stackoverflow.com/users/8260045/sam-2207"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1523926840, "creation_date": 1523793675, "question_id": 49841673, "link": "https://stackoverflow.com/questions/49841673/facing-issues-while-installing-golang", "title": "facing issues while installing Golang", "body": "<p>I am facing some issues while installing go lang, have used below approach to install it.</p>\n\n<p>sudo apt update</p>\n\n<p>$ sudo curl -O <a href=\"https://storage.googleapis.com/golang/go1.10.1.linux-amd64.tar.gz\" rel=\"nofollow noreferrer\">https://storage.googleapis.com/golang/go1.10.1.linux-amd64.tar.gz</a> </p>\n\n<p>$ sudo tar -xvf go1.10.1.linux-amd64.tar.gz</p>\n\n<p>$ sudo mv go /usr/local</p>\n\n<p>everything went fine till the above step.</p>\n\n<p>But when I am giving below command, I am getting a message</p>\n\n<p>$ echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.profile</p>\n\n<p><strong>Message: bash: export: '/usr/local/go/bin': not a valid identifier</strong></p>\n\n<p>$ source ~/.profile</p>\n"}, {"tags": ["testing", "go", "code-coverage"], "answers": [{"tags": [], "owner": {"reputation": 76, "user_id": 8261044, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cda54d8bf5a0407c5ccb3fcb77ac772?s=128&d=identicon&r=PG&f=1", "display_name": "MTvB", "link": "https://stackoverflow.com/users/8261044/mtvb"}, "is_accepted": false, "score": 0, "last_activity_date": 1523780977, "creation_date": 1523780977, "answer_id": 49839975, "question_id": 49839543, "link": "https://stackoverflow.com/questions/49839543/no-test-coverage-when-tests-are-in-a-different-package/49839975#49839975", "title": "No test coverage when tests are in a different package", "body": "<p>use <code>-coverpkg go-test/...,./...</code></p>\n\n<p>go-test is a sibling to i-test, consequently using ./... does not work, as it only selects packages and subpackages of the current directory.</p>\n"}, {"comments": [{"owner": {"reputation": 2587, "user_id": 2091399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeHSj.jpg?s=128&g=1", "display_name": "Peter Dotchev", "link": "https://stackoverflow.com/users/2091399/peter-dotchev"}, "edited": false, "score": 1, "creation_date": 1523963863, "post_id": 49839990, "comment_id": 86768753, "body": "This also runs my unit tests which all fail with <code>[build failed]</code>!? All tests pass without <code>-coverpkg</code> option."}, {"owner": {"reputation": 844, "user_id": 2459515, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SkRr0.jpg?s=128&g=1", "display_name": "StevieB", "link": "https://stackoverflow.com/users/2459515/stevieb"}, "reply_to_user": {"reputation": 2587, "user_id": 2091399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeHSj.jpg?s=128&g=1", "display_name": "Peter Dotchev", "link": "https://stackoverflow.com/users/2091399/peter-dotchev"}, "edited": false, "score": 0, "creation_date": 1524144441, "post_id": 49839990, "comment_id": 86860265, "body": "Not much to go on. I&#39;ve never seen this. I can have a look if you point me at a repo..."}, {"owner": {"reputation": 2587, "user_id": 2091399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeHSj.jpg?s=128&g=1", "display_name": "Peter Dotchev", "link": "https://stackoverflow.com/users/2091399/peter-dotchev"}, "edited": false, "score": 1, "creation_date": 1528356963, "post_id": 49839990, "comment_id": 88478581, "body": "The reason for the failure was circular dependencies between files in the same package. The error message was unclear and it also worked without <code>-coverpkg</code> which confused me."}, {"owner": {"reputation": 4649, "user_id": 5601284, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qVVND.jpg?s=128&g=1", "display_name": "byxor", "link": "https://stackoverflow.com/users/5601284/byxor"}, "edited": false, "score": 1, "creation_date": 1556562431, "post_id": 49839990, "comment_id": 98473142, "body": "I&#39;m also getting the <code>[build failed]</code> error for all of my tests."}], "tags": [], "owner": {"reputation": 844, "user_id": 2459515, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SkRr0.jpg?s=128&g=1", "display_name": "StevieB", "link": "https://stackoverflow.com/users/2459515/stevieb"}, "is_accepted": true, "score": 6, "last_activity_date": 1523781091, "creation_date": 1523781091, "answer_id": 49839990, "question_id": 49839543, "link": "https://stackoverflow.com/questions/49839543/no-test-coverage-when-tests-are-in-a-different-package/49839990#49839990", "title": "No test coverage when tests are in a different package", "body": "<pre><code>go test -v -coverpkg ./... ./...\n</code></pre>\n\n<p>should give you the expected results</p>\n"}], "owner": {"reputation": 2587, "user_id": 2091399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeHSj.jpg?s=128&g=1", "display_name": "Peter Dotchev", "link": "https://stackoverflow.com/users/2091399/peter-dotchev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2495, "favorite_count": 2, "accepted_answer_id": 49839990, "answer_count": 2, "score": 8, "last_activity_date": 1523806313, "creation_date": 1523777727, "last_edit_date": 1523806313, "question_id": 49839543, "link": "https://stackoverflow.com/questions/49839543/no-test-coverage-when-tests-are-in-a-different-package", "title": "No test coverage when tests are in a different package", "body": "<p>I have integration tests which are located in a separate directory. Those tests run my http server in the same process via net/http/httptest. My tests run but I get no coverage.</p>\n\n<p>Here is a very simplified example not using http for brevity.\nDirectory layout:</p>\n\n<pre><code>$GOPATH/src/go-test\n  hello\n    hello.go\n  itest\n    integration_test.go\n</code></pre>\n\n<p><strong>hello.go</strong></p>\n\n<pre><code>package hello\n\nfunc Hello() string {\n    return \"hello\"\n}\n</code></pre>\n\n<p><strong>integration_test.go</strong></p>\n\n<pre><code>package itest\n\nimport (\n    \"go-test/hello\"\n    \"testing\"\n)\n\nfunc TestHello(t *testing.T) {\n    s := hello.Hello()\n    if s != \"hello\" {\n        t.Errorf(\"Hello says %s\", s)\n    }\n}\n</code></pre>\n\n<p>Run the test:</p>\n\n<pre><code>$ go test -v -coverpkg ./... ./itest\n=== RUN   TestHello\n--- PASS: TestHello (0.00s)\nPASS\ncoverage: 0.0% of statements in ./...\nok      go-test/itest   0.001s  coverage: 0.0% of statements in ./...\n</code></pre>\n\n<p>Another attempt:</p>\n\n<pre><code>$ go test -v -coverpkg all ./itest\n=== RUN   TestHello\n--- PASS: TestHello (0.00s)\nPASS\ncoverage: 0.0% of statements in all\nok      go-test/itest   0.001s  coverage: 0.0% of statements in all\n</code></pre>\n\n<p>Notice that coverage is 0%.</p>\n\n<p>According to <code>go help testflag</code>:</p>\n\n<pre><code>-coverpkg pattern1,pattern2,pattern3\n    Apply coverage analysis in each test to packages matching the patterns.\n    The default is for each test to analyze only the package being tested.\n    See 'go help packages' for a description of package patterns.\n    Sets -cover.\n</code></pre>\n\n<p>How can I get the real coverage when my tests are in a different package?</p>\n\n<pre><code>$ go version\ngo version go1.10 linux/amd64\n</code></pre>\n"}, {"tags": ["go", "naming-conventions", "godeps"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1523775342, "post_id": 49838651, "comment_id": 86693401, "body": "<code>go get</code> knows about some code hosting sites (githubs is just one built into go get) and can work with almost any others by via HTML meta tags. Read about it here. <a href=\"https://golang.org/cmd/go/#hdr-Remote_import_paths\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Remote_import_paths</a>. So probably you might want to call you package git.mycompany.com/projeckt if you host it e.g. with gitlab."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1523787168, "post_id": 49838651, "comment_id": 86696107, "body": "To give you a concrete example for the HTML meta tags Volker mentioned, this is our server which directs Go to get packages named go.example.com/foo/bar from gitlab.example.com/foo/bar: <a href=\"https://play.golang.org/p/qMVM_lZ_xjc\" rel=\"nofollow noreferrer\">play.golang.org/p/qMVM_lZ_xjc</a>. go.example.com and gitlab.example.com are different machines. In fact, for some packages it will return GitHub repositories (not shown in the code)."}, {"owner": {"reputation": 2009, "user_id": 518469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d25f5f2f0ff49caee819e3e1805cb436?s=128&d=identicon&r=PG&f=1", "display_name": "yname", "link": "https://stackoverflow.com/users/518469/yname"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1523943366, "post_id": 49838651, "comment_id": 86756365, "body": "@Volker I think that&#39;s what I was looking for. I&#39;ll accept it as the answer if you&#39;ll move your comment to an answer. Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1523887294, "post_id": 49839325, "comment_id": 86733213, "body": "&quot;Your package name must match its hosting location&quot; <i>or provide a go-import header</i>."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1523775832, "creation_date": 1523775832, "answer_id": 49839325, "question_id": 49838651, "link": "https://stackoverflow.com/questions/49838651/caveats-if-go-package-name-doesnt-start-with-github-com/49839325#49839325", "title": "Caveats if go package name doesn&#39;t start with github.com?", "body": "<p>If you set up the web server at <code>mycompany.com</code> to host your Go packages, there's nothing at all wrong with that approach.</p>\n\n<p>But if the only reason to do that is to have \"vanity\" package names, it's probably not worth it.</p>\n\n<p>Put another way: Your package name <em>must</em> match its hosting location.  If you're using GitHub to host your project at <code>github.com/mycompany/foo</code> then your package name <em>is</em> <code>github.com/mycompany/foo</code>--there's no choice in the matter.</p>\n\n<p>If you want to host your software on GitHub but still use <code>mycompany.com</code> as the package name, then you could set up GitHub to host <code>mycompany.com</code>'s web page using the <a href=\"https://pages.github.com/\" rel=\"nofollow noreferrer\">GitHub pages</a> feature. But if you're an established company, then you probably already have your site hosted elsewhere, and it's not an option to move hosting to GitHub.  And even if you don't already have a company web site, there's practically no reason at all to do this for the sake of Go packages.</p>\n"}], "owner": {"reputation": 2009, "user_id": 518469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d25f5f2f0ff49caee819e3e1805cb436?s=128&d=identicon&r=PG&f=1", "display_name": "yname", "link": "https://stackoverflow.com/users/518469/yname"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1523775832, "creation_date": 1523768587, "question_id": 49838651, "link": "https://stackoverflow.com/questions/49838651/caveats-if-go-package-name-doesnt-start-with-github-com", "title": "Caveats if go package name doesn&#39;t start with github.com?", "body": "<p>I've recently started using go and planned to use following directory structure for my code: <code>src/mycompany.com/project</code> (so package name would be <code>mycompany.com/project/component</code>), however during code review my coworker (who worked with go before) pointed out that it's a convention to place code in <code>src/github.com/mycompany/project</code> (so package name would be <code>github.com/mycompany/project/component</code>).</p>\n\n<p>I can understand that this is convenient for personal projects, but it looks weird to me to have it for company projects. Why does it matter which source control website company is using? What if company will decide to move to bitbucket later on - should all projects be refactored to have package names starting with <code>bitbucket.org</code>?</p>\n\n<p>It is definitely possible to not use <code>github.com</code>: <a href=\"https://github.com/kubernetes/kubernetes\" rel=\"nofollow noreferrer\">kubernetes</a> have package name starting with <code>k8s.io/kubernetes</code>, and go book has <a href=\"https://github.com/adonovan/gopl.io/\" rel=\"nofollow noreferrer\">package names</a> which start with <code>gopl.io</code> (and both use github).</p>\n\n<p>Question is: are there any caveats if package name doesn't start with <code>github.com</code>? E.g. maybe <code>dep</code> won't work properly (<code>go get seems to work fine</code>) or something else?</p>\n\n<p>Also: what is the right way to have package name <code>mycompany.com/project</code> and have source code hosted on github?</p>\n"}, {"tags": ["git", "go", "diff", "text-to-html"], "comments": [{"owner": {"reputation": 2009, "user_id": 518469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d25f5f2f0ff49caee819e3e1805cb436?s=128&d=identicon&r=PG&f=1", "display_name": "yname", "link": "https://stackoverflow.com/users/518469/yname"}, "edited": false, "score": 2, "creation_date": 1523770626, "post_id": 49838149, "comment_id": 86692593, "body": "Maybe use something like <a href=\"https://github.com/sourcegraph/go-diff\" rel=\"nofollow noreferrer\">go-diff</a> and then pass it to some html template?"}, {"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 0, "creation_date": 1523775392, "post_id": 49838149, "comment_id": 86693411, "body": "You could also keep the diff as-is and handle the colouring client-side (via a plugin or similar to your e-mail reader); that way you would also get syntax colouring for diffs sent by others."}], "answers": [{"tags": [], "owner": {"reputation": 19, "user_id": 3728271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80517d46357349c3ae38c64860d11a08?s=128&d=identicon&r=PG", "display_name": "Alec Holmes", "link": "https://stackoverflow.com/users/3728271/alec-holmes"}, "is_accepted": false, "score": 1, "last_activity_date": 1523893300, "creation_date": 1523893300, "answer_id": 49861254, "question_id": 49838149, "link": "https://stackoverflow.com/questions/49838149/git-diff-to-html/49861254#49861254", "title": "Git diff to HTML", "body": "<p>You could use the stdlib <code>html/template</code> library to make a pretty HTML template and pass your raw string as a param:</p>\n\n<p><a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/</a></p>\n\n<pre><code>import \"text/template\"\n...\nt, err := template.New(\"foo\").Parse(`{{define \"T\"}}Hello, {{.}}!{{end}}`)\nerr = t.ExecuteTemplate(out, \"T\", \"&lt;script&gt;alert('you have been pwned')&lt;/script&gt;\")\n</code></pre>\n\n<p>will produce this:</p>\n\n<pre><code>Hello, &lt;script&gt;alert('you have been pwned')&lt;/script&gt;!\n</code></pre>\n\n<p>So in your case, define a template in a separate file, read it in, and then call </p>\n\n<pre><code>t, err := template.ParseFiles(\"./path/to/template.html\")\nif err != nil {\n    log.Fatal(err)\n}\n\nerr = t.ExecuteTemplate(out, \"T\", rawDiffString)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>which will take your diff string and stick it into the template wherever you defined the template variable.</p>\n\n<p>You'll have to read the spec for how Go parses through the HTML template to properly format your HTML file.</p>\n"}], "owner": {"reputation": 425, "user_id": 9422034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Q0FlA.jpg?s=128&g=1", "display_name": "Egor Egorov", "link": "https://stackoverflow.com/users/9422034/egor-egorov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1523893300, "creation_date": 1523761904, "question_id": 49838149, "link": "https://stackoverflow.com/questions/49838149/git-diff-to-html", "title": "Git diff to HTML", "body": "<p>I'm writing a webhook in Go that sends me an email with the diff for every commit to certain repository. Right now I am sending the diff as raw text like this:</p>\n\n<p><a href=\"https://github.com/ee92/go-lambda/commit/ac56fc2cfe86c50e9d73ecb0f8db74c672e205cd.diff\" rel=\"nofollow noreferrer\">https://github.com/ee92/go-lambda/commit/ac56fc2cfe86c50e9d73ecb0f8db74c672e205cd.diff</a></p>\n\n<p>I wish to send it as pretty formatted HTML with color like you see on github or bitbucket so it will be easier to read what changed. Really stumped on how to go about this. Appreciate any advice. Thanks.</p>\n"}, {"tags": ["arrays", "go", "directory", "zip", "grpc"], "comments": [{"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1523778679, "post_id": 49837048, "comment_id": 86694061, "body": "<a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow noreferrer\">path.filepath.Walk()</a> if directory <code>mkdir</code>; if file <code>save it</code>."}, {"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1523779000, "post_id": 49837048, "comment_id": 86694150, "body": "and for the fun of it without grpc <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\">http.FileServer()</a> - get root, parse html, get all &lt;a&gt; tags - which represent files and directories, if name ends with <code>&#47;</code> it&#39;s a directory &quot;GET&quot; it and parse again, otherwise its a file so &quot;GET&quot; it. This will choke if there is index.html somewhere.... have fun."}], "answers": [{"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 2, "last_activity_date": 1523784895, "creation_date": 1523784895, "answer_id": 49840481, "question_id": 49837048, "link": "https://stackoverflow.com/questions/49837048/read-a-directory-as-byte-without-zipping-it/49840481#49840481", "title": "Read a directory as []byte without zipping it", "body": "<p>Your are free to use anything that implements <code>io.Writer</code> interface as destination of your zip archive <a href=\"https://golang.org/pkg/archive/zip/#NewWriter\" rel=\"nofollow noreferrer\">zip.NewWriter</a></p>\n\n<p>If you want it to be stored into byte slice and do not know the size of it beforehand I would suggest to use <code>bytes.Buffer</code> as your destination:</p>\n\n<pre><code>buffer := &amp;bytes.Buffer{}\nzip.NewWriter(buffer)\n... do anything you need\nresultBytesSlice := buffer.Bytes()\n</code></pre>\n"}], "owner": {"reputation": 15341, "user_id": 2228325, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Vn6At.png?s=128&g=1", "display_name": "TonyGW", "link": "https://stackoverflow.com/users/2228325/tonygw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 49840481, "answer_count": 1, "score": 1, "last_activity_date": 1523784895, "creation_date": 1523747716, "last_edit_date": 1523775991, "question_id": 49837048, "link": "https://stackoverflow.com/questions/49837048/read-a-directory-as-byte-without-zipping-it", "title": "Read a directory as []byte without zipping it", "body": "<p>I am experimenting <code>grpc</code> for transferring large files and directories from server to clients. When I transfer a directory, I use the <code>zip</code> package to create a zip writer to create an archive of the directory, which is then transferred using grpc. </p>\n\n<pre><code>zipfile, err := os.Create(target)\nzip.NewWriter(zipfile)\n</code></pre>\n\n<p>This works, but I was wondering if there's any convenient way to read a directory and its contents (files and sub-directories) into a []byte array for transfer over the wrire.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 1686, "user_id": 1310740, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/4e09b49b817d88d050bee0dd6f602e24?s=128&d=identicon&r=PG&f=1", "display_name": "dev-jim", "link": "https://stackoverflow.com/users/1310740/dev-jim"}, "edited": false, "score": 0, "creation_date": 1523850292, "post_id": 49838853, "comment_id": 86713248, "body": "Thanks for the reply. It seems to work. However I am not clearly how to do this ` you should only connect and ensure indices once,` , I already make the connection on startup once, but not the indices. If I not misunderstanding, you means that I also need to put the above codes into init function as well?"}, {"owner": {"reputation": 1686, "user_id": 1310740, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/4e09b49b817d88d050bee0dd6f602e24?s=128&d=identicon&r=PG&f=1", "display_name": "dev-jim", "link": "https://stackoverflow.com/users/1310740/dev-jim"}, "edited": false, "score": 0, "creation_date": 1523852994, "post_id": 49838853, "comment_id": 86713911, "body": "Never mind. I figured it out. Thanks for your answer. I got it working now. Thanks."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1523781282, "last_edit_date": 1523781282, "creation_date": 1523770991, "answer_id": 49838853, "question_id": 49834250, "link": "https://stackoverflow.com/questions/49834250/golang-mongodb-unique-indexes-not-working-when-more-than-one-key/49838853#49838853", "title": "golang mongoDB unique indexes not working when more than one key", "body": "<p>The <code>unique</code> index with keys <code>[\"username\", \"email\"]</code> ensures the username-email <em>pairs</em> to be unique.</p>\n\n<p>What you want is both usernames and emails to be unique <em>individually</em>, so create 2 unique indices, one with <code>username</code> and one with <code>email</code> key:</p>\n\n<pre><code>for _, key := range []string{\"username\", \"email\"} {\n    index := mgo.Index{\n        Key:    []string{key},\n        Unique: true,\n    }\n    if err := c.EnsureIndex(index); err != nil {\n        return err\n    }\n}\n</code></pre>\n\n<p>Note that individually unique usernames and emails implicitly ensure unique username-email pairs too.</p>\n\n<p>On a side note: you should not connect and check indices each time you need to interact with MongoDB. Instead you should only connect and ensure indices once, on startup. See these questions for details:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/40999637/mgo-query-performance-seems-consistently-slow-500-650ms/41000876#41000876\">mgo - query performance seems consistently slow (500-650ms)</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/47179890/too-many-open-files-in-mgo-go-server/47180097#47180097\">too many open files in mgo go server</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/42492020/concurrency-in-gopkg-in-mgo-v2-mongo-go/42495522#42495522\">Concurrency in gopkg.in/mgo.v2 (Mongo, Go)</a></p>\n"}], "owner": {"reputation": 1686, "user_id": 1310740, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/4e09b49b817d88d050bee0dd6f602e24?s=128&d=identicon&r=PG&f=1", "display_name": "dev-jim", "link": "https://stackoverflow.com/users/1310740/dev-jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4044, "favorite_count": 0, "accepted_answer_id": 49838853, "answer_count": 1, "score": 3, "last_activity_date": 1523781282, "creation_date": 1523727089, "question_id": 49834250, "link": "https://stackoverflow.com/questions/49834250/golang-mongodb-unique-indexes-not-working-when-more-than-one-key", "title": "golang mongoDB unique indexes not working when more than one key", "body": "<p>I want to insert data into user collection upon registration. \nThus, email and username are unique and can't be duplicate. I use mgo.v2 for mongodb driver and <code>mgo.Index</code> to defined the unique keys.</p>\n\n<p>Here is what I did:</p>\n\n<pre><code>type User struct {\n    ID        bson.ObjectId `bson:\"_id,omitempty\" json:\"_id,omitempty\"`\n    Username  string        `bson:\"username\" json:\"username\"`\n    PW        string        `bson:\"pw\" json:\"pw\"`\n    Email     string        `bson:\"email\" json:\"email\"`\n}\n\n\nfunc (u *User) Add() error {\nmConn := mongodb.Conn()\ndefer mConn.Close()\nindex := mgo.Index{\n    Key:    []string{\"username\", \"email\"},\n    Unique: true,\n}\nc := mConn.DB(DB).C(Collection)\n\nerr := c.EnsureIndex(index)\nif err != nil {\n    return err\n}\nu.CreatedAt = time.Now()\n\nerr = c.Insert(u)\n\nreturn err\n}\n</code></pre>\n\n<p>The problem is I want the username and email completely unique. Which means, if the <code>username</code> and <code>email</code> have been inserted into collection, they will not able to insert again.</p>\n\n<p>But right now, it only check the email AND username together to determine if they are both existed in same document. which means if someone submit same email but different username,it will still get through the insert process. </p>\n\n<p>For eg:\nIf we already have this in our collection</p>\n\n<pre><code>{\"username\" : \"user1\", \"email\" : \"aaa@xxx.com\"}\n</code></pre>\n\n<p>if another user submit :</p>\n\n<pre><code>{\"username\" : \"user1\", \"email\" : \"aaa2@xxx.com\"} //different email\n</code></pre>\n\n<p>this will successfully inserted.  Which is not what I want. </p>\n\n<p>Or, if the user submit:</p>\n\n<pre><code>{\"username\" : \"user2\", \"email\" : \"aaa@xxx.com\"} //different username\n</code></pre>\n\n<p>this will still successfully inserted, which is also not what I wanted. </p>\n\n<p>Any idea how to achieve it? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1523728611, "post_id": 49833524, "comment_id": 86684220, "body": "nil pointers and zero values have nothing to do with each other."}, {"owner": {"reputation": 35, "user_id": 8427092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbf3e3792c572f33d3d3ad6a9f81611f?s=128&d=identicon&r=PG&f=1", "display_name": "onebone", "link": "https://stackoverflow.com/users/8427092/onebone"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523751626, "post_id": 49833524, "comment_id": 86690036, "body": "I mean I can use <code>nil</code> as a value of field when it is pointer. <a href=\"https://play.golang.org/p/3i_84R7Q6_M\" rel=\"nofollow noreferrer\">play.golang.org/p/3i_84R7Q6_M</a>"}], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 8427092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbf3e3792c572f33d3d3ad6a9f81611f?s=128&d=identicon&r=PG&f=1", "display_name": "onebone", "link": "https://stackoverflow.com/users/8427092/onebone"}, "edited": false, "score": 0, "creation_date": 1523723615, "post_id": 49833629, "comment_id": 86682618, "body": "Ah, I think I have chose wrong example. I changed field name in the post. That is just an simple example, actually the value of struct doesn&#39;t change. I have read articles before posting question, but I couldn&#39;t find article &#39;when to use pointer in struct fields&#39;."}, {"owner": {"reputation": 35, "user_id": 8427092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbf3e3792c572f33d3d3ad6a9f81611f?s=128&d=identicon&r=PG&f=1", "display_name": "onebone", "link": "https://stackoverflow.com/users/8427092/onebone"}, "edited": false, "score": 0, "creation_date": 1523724037, "post_id": 49833629, "comment_id": 86682742, "body": "And one more question: I have seen project that uses pointer to non-primitive types as struct field like <code>go-telegram-bot-api</code>. Is it common practice to use pointers like that?"}], "tags": [], "owner": {"reputation": 1509, "user_id": 4815767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc24bfa1708763d1853a48c6290fbcaa?s=128&d=identicon&r=PG", "display_name": "Popmedic", "link": "https://stackoverflow.com/users/4815767/popmedic"}, "is_accepted": false, "score": 0, "last_activity_date": 1523728639, "last_edit_date": 1523728639, "creation_date": 1523723227, "answer_id": 49833629, "question_id": 49833524, "link": "https://stackoverflow.com/questions/49833524/is-it-better-to-use-pointer-for-non-primitive-types-in-struct-fields-in-go/49833629#49833629", "title": "Is it better to use pointer for non-primitive types in struct fields in Go", "body": "<p>Not sure I understand the question. In the case of \"Now\" I would make it a function of the struct i.e.:</p>\n\n<pre><code>type A struct{}\n\nfunc (a A) Now() time.Time { return time.Now(); }\n</code></pre>\n\n<p>otherwise what does <code>Now</code> mean?  Now is constantly changing.</p>\n\n<p>There are great blogs on <a href=\"https://www.google.com/search?q=golang%20when%20to%20use%20pointers&amp;ie=utf-8&amp;oe=utf-8&amp;client=firefox-b-1-ab\" rel=\"nofollow noreferrer\">when to use pointers</a> </p>\n\n<p>The short would be it doesn't really depend on if the value can be <code>nil</code>, but more on memory and concurrency.  Pointers will be passed as references, so less memory, and faster, but also means that changing in one go routine can be very dangerous because the value could be referenced in another go routine and cause race conditions and unexpected behaviors.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 8427092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbf3e3792c572f33d3d3ad6a9f81611f?s=128&d=identicon&r=PG&f=1", "display_name": "onebone", "link": "https://stackoverflow.com/users/8427092/onebone"}, "edited": false, "score": 0, "creation_date": 1523724658, "post_id": 49833734, "comment_id": 86682956, "body": "If I don&#39;t have to share a value over multiple structs, then is it okay to use non-pointer?"}, {"owner": {"reputation": 8, "user_id": 6643866, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-0-CLRsoban4/AAAAAAAAAAI/AAAAAAAACWc/_uImLHvb3TM/photo.jpg?sz=128", "display_name": "Znert", "link": "https://stackoverflow.com/users/6643866/znert"}, "reply_to_user": {"reputation": 35, "user_id": 8427092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbf3e3792c572f33d3d3ad6a9f81611f?s=128&d=identicon&r=PG&f=1", "display_name": "onebone", "link": "https://stackoverflow.com/users/8427092/onebone"}, "edited": false, "score": 0, "creation_date": 1523725077, "post_id": 49833734, "comment_id": 86683096, "body": "Yes, why not :)"}], "tags": [], "owner": {"reputation": 8, "user_id": 6643866, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-0-CLRsoban4/AAAAAAAAAAI/AAAAAAAACWc/_uImLHvb3TM/photo.jpg?sz=128", "display_name": "Znert", "link": "https://stackoverflow.com/users/6643866/znert"}, "is_accepted": true, "score": -4, "last_activity_date": 1523723895, "creation_date": 1523723895, "answer_id": 49833734, "question_id": 49833524, "link": "https://stackoverflow.com/questions/49833524/is-it-better-to-use-pointer-for-non-primitive-types-in-struct-fields-in-go/49833734#49833734", "title": "Is it better to use pointer for non-primitive types in struct fields in Go", "body": "<p>I'm not really a professional or know the ins and outs of Go, so take everything I say with some grain of salt.</p>\n\n<p>But as I am understanding it, you should most likely use pointers.</p>\n\n<p>This is because every time you use a non-pointer type, the whole struct will be part of your struct in memory. As a consequence, you can't share a single instance of a struct between multiple structs - every single one gets a copy of your original struct.</p>\n\n<p>Heres a small example:</p>\n\n<pre><code>// This struct has 2x64 bits in size\ntype MyStruct struct {\n    A uint64\n    B uint64\n}\n\n// This struct has 32 + 2x64 bits in size\ntype MyOtherStruct struct {\n    C uint32\n    Parent MyStruct\n}\n\n// This struct has 32 + the length of an address bits size \ntype MyPointerStruct struct {\n    D uint32\n    Parent *MyStruct\n}\n</code></pre>\n\n<p>But apart from memory concerns, there is also a performance hit if your inner struct is very big. Because every time you set the inner struct the whole memory has to be copied to your instance.</p>\n\n<p><strong>However</strong> you have to be careful if your are dealing with <em>interfaces</em> or <em>structs</em>. At runtime, an <em>interface</em> is represented as a type with two fields: A reference to the actual (runtime) <em>type</em> and one with a <em>reference</em> to the actual instance.</p>\n\n<p>So I - with my unprofessional opinion - would recommend to <strong>not</strong> use pointers if you have interface types because otherwise the CPU has to deference twice (once to get the interface reference, and then again to get the instance of the interface).</p>\n"}], "owner": {"reputation": 35, "user_id": 8427092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbf3e3792c572f33d3d3ad6a9f81611f?s=128&d=identicon&r=PG&f=1", "display_name": "onebone", "link": "https://stackoverflow.com/users/8427092/onebone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 49833734, "answer_count": 2, "score": -4, "last_activity_date": 1523728639, "creation_date": 1523722518, "last_edit_date": 1523728573, "question_id": 49833524, "link": "https://stackoverflow.com/questions/49833524/is-it-better-to-use-pointer-for-non-primitive-types-in-struct-fields-in-go", "title": "Is it better to use pointer for non-primitive types in struct fields in Go", "body": "<p>I am going on a project which process some data, I am wondering that if it is better to use pointer in non-primitive typed fields of struct.</p>\n\n<p>What I've found is that the reason of using pointer is that <code>nil</code> can be used as a zero-value, is this the only reason to use pointer?</p>\n\n<p>For example, I am going to store <code>time.Time</code> in my struct and it cannot be <code>nil</code>, then is it better to use non-pointer field?</p>\n\n<p>So is it okay to use </p>\n\n<pre><code>type A struct {\n   CreatedAt   time.Time\n}\n</code></pre>\n\n<p>rather than</p>\n\n<pre><code>type A struct {\n    CreatedAt   *time.Time\n}\n</code></pre>\n\n<p>when <code>Now</code> is not going to be <code>nil</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523717088, "post_id": 49832478, "comment_id": 86680529, "body": "In your first example it is FIFO <code>{-9,4,0}</code> is the first slice and <code>{7,2,8}</code> is the second slice. output is also like First <code>-5</code> and second <code>17</code>"}, {"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "edited": false, "score": 0, "creation_date": 1523719385, "post_id": 49832478, "comment_id": 86681222, "body": "No. 1st slice (which is <code>s[:len(s)&#47;2]</code>) is referring to <code>0 to len(s)&#47;2 (-1)</code>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523720889, "post_id": 49832478, "comment_id": 86681696, "body": "All channels are FIFO, no matter if buffered or not. Your assumption about which value goes in first is wrong. Since goroutines run concurrently, you can&#39;t predict which sum gets to send its result first. Run these programs often enough and you should see the output change eventually."}], "answers": [{"tags": [], "owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "is_accepted": true, "score": 2, "last_activity_date": 1523722099, "last_edit_date": 1523722099, "creation_date": 1523721695, "answer_id": 49833390, "question_id": 49832478, "link": "https://stackoverflow.com/questions/49832478/go-tutorial-channels-buffered-channels-tutorial/49833390#49833390", "title": "Go tutorial: Channels, Buffered Channels tutorial", "body": "<p>The chnnael <code>c</code>, in your 1st example of unbuffered channel, is not acting as LIFO.</p>\n\n<p>Actually it is happening because of <code>go routines</code>. The <code>go routines</code> executes concurrently.</p>\n\n<p>If you tweak your code to debug, add one extra line in sum to print the sum before sending to channel.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc sum(s []int, c chan int) {\n    sum := 0\n    for _, v := range s {\n        sum += v\n    }\n    fmt.Println(\"slice:\", s)\n    fmt.Println(sum)\n    c &lt;- sum         // send sum to c\n}\n\nfunc main() {\n    s := []int{7, 2, 8, -9, 4, 0}\n\n    c := make(chan int)\n    go sum(s[:2], c)\n    go sum(s[2:4], c)\n    go sum(s[4:6], c)\n    x, y, z := &lt;-c, &lt;-c, &lt;-c // receive from c\n    fmt.Println(x, y, z, x+y+z)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>slice: [4 0]\n4\nslice: [7 2]\n9\nslice: [8 -9]\n-1\n4 9 -1 12\n</code></pre>\n\n<p>So, you can see that <code>x</code> receives the 1st number that was sent through channel.</p>\n\n<p>Furthermore, unbuffered channels sends data directly to receiver.</p>\n\n<p>If you wanna know about the architecture of channels in <code>go</code>, you can watch <a href=\"https://www.youtube.com/watch?v=KBZlN0izeiY\" rel=\"nofollow noreferrer\">this talk of <code>gophercon-2017</code></a>. I found this talk very helpful.</p>\n"}], "owner": {"reputation": 3603, "user_id": 1177952, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2cd2041cb689798a5e7e27c9a2c789d7?s=128&d=identicon&r=PG", "display_name": "shapeare", "link": "https://stackoverflow.com/users/1177952/shapeare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 250, "favorite_count": 2, "accepted_answer_id": 49833390, "answer_count": 1, "score": 1, "last_activity_date": 1523722099, "creation_date": 1523716012, "question_id": 49832478, "link": "https://stackoverflow.com/questions/49832478/go-tutorial-channels-buffered-channels-tutorial", "title": "Go tutorial: Channels, Buffered Channels tutorial", "body": "<p>I am going through Go's official tutorial and have difficulty understanding the difference between Channel and Buffered Channels. The links to the tutorials are <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/2</a> and <a href=\"https://tour.golang.org/concurrency/3\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/3</a></p>\n\n<p>In the Channel tutorial, Channel c first received the sum of [7, 2, 8] which is 17 and then received the sum of [-9, 4, 0] which is -5. When reading from c, it first output -5 to x and then 17 to y, in LIFO order:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc sum(s []int, c chan int) {\n    sum := 0\n    for _, v := range s {\n        sum += v\n    }\n    c &lt;- sum // send sum to c\n}\n\nfunc main() {\n    s := []int{7, 2, 8, -9, 4, 0}\n\n    c := make(chan int)\n    go sum(s[:len(s)/2], c)\n    go sum(s[len(s)/2:], c)\n    x, y := &lt;-c, &lt;-c // receive from c\n\n    fmt.Println(x, y, x+y)\n}\n</code></pre>\n\n<p>(The above output is -5 17 12)</p>\n\n<p>In the Buffered Channel tutorial, the output is 1 2, in FIFO order:</p>\n\n<pre><code>func main() {\n    ch := make(chan int, 2)\n    ch &lt;- 1\n    ch &lt;- 2\n    fmt.Println(&lt;-ch)\n    fmt.Println(&lt;-ch)\n}\n</code></pre>\n\n<p>Why are they different?</p>\n"}, {"tags": ["go", "ffmpeg"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523704063, "post_id": 49829823, "comment_id": 86676674, "body": "Inspect ffmpeg&#39;s error output with <code>cmd.Stderr = os.Stderr</code>, for instance."}, {"owner": {"reputation": 1369, "user_id": 6525347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/4NZOi.gif?s=128&g=1", "display_name": "thelearner", "link": "https://stackoverflow.com/users/6525347/thelearner"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523705138, "post_id": 49829823, "comment_id": 86676985, "body": "@Peter Hello peter, I have added the log to the question. Thanks."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1523706522, "post_id": 49829823, "comment_id": 86677365, "body": "Add <code>&quot;-&quot;</code> as the last argument in your command."}, {"owner": {"reputation": 1369, "user_id": 6525347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/4NZOi.gif?s=128&g=1", "display_name": "thelearner", "link": "https://stackoverflow.com/users/6525347/thelearner"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1523706891, "post_id": 49829823, "comment_id": 86677449, "body": "@TimCooper Hello tim, I updated the command and the error logs. Thanks."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1523720465, "post_id": 49829823, "comment_id": 86681538, "body": "<code>pipe:0: Invalid data found when processing input</code> sounds like the contents of <code>videoData</code> is invalid. Where is this coming from?"}, {"owner": {"reputation": 1369, "user_id": 6525347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/4NZOi.gif?s=128&g=1", "display_name": "thelearner", "link": "https://stackoverflow.com/users/6525347/thelearner"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1523725688, "post_id": 49829823, "comment_id": 86683306, "body": "@Carpetsmoker That&#39;s where it gets weird. I researched on the internet and all indications pointed on an invalid file. However, I&#39;ve tried it with various valid files, and none of them worked."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1523726462, "post_id": 49829823, "comment_id": 86683550, "body": "Maybe you have an error in how you&#39;re reading the files from disk, or something like that? It would be helpful if you could create a complete example (<a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>). It&#39;s possible that the error in your code (if any) is in the code you <i>didn&#39;t</i> post here."}, {"owner": {"reputation": 1369, "user_id": 6525347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/4NZOi.gif?s=128&g=1", "display_name": "thelearner", "link": "https://stackoverflow.com/users/6525347/thelearner"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1523730273, "post_id": 49829823, "comment_id": 86684644, "body": "@Carpetsmoker Hello Carpetsmoker! Thanks a lot for taking your valuable time to help me. I&#39;m reading the video from a http request body and added the code snipped to my original question. Have a good evening!"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523756778, "post_id": 49829823, "comment_id": 86690732, "body": "are you sure that r.Body is properly encoded/decoded? Please, do the following to confirm: 1. save body to a regular video file (avi, mp4, etc.) 2. try to play this file in a video player, if it&#39;s ok 3. exec your ffmpeg command with this file (instead of pipe) in terminal and check the result"}, {"owner": {"reputation": 1369, "user_id": 6525347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/4NZOi.gif?s=128&g=1", "display_name": "thelearner", "link": "https://stackoverflow.com/users/6525347/thelearner"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523821209, "post_id": 49829823, "comment_id": 86706974, "body": "@vitr Hello, Yes I think it&#39;s properly encoded. I was able to play and analyse the file after I uploaded it to S3."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523828005, "post_id": 49829823, "comment_id": 86708903, "body": "<a href=\"https://stackoverflow.com/a/4585976/4986182\">stackoverflow.com/a/4585976/4986182</a>"}], "owner": {"reputation": 1369, "user_id": 6525347, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/4NZOi.gif?s=128&g=1", "display_name": "thelearner", "link": "https://stackoverflow.com/users/6525347/thelearner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 649, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523730222, "creation_date": 1523697273, "last_edit_date": 1592644375, "question_id": 49829823, "link": "https://stackoverflow.com/questions/49829823/ffmpeg-does-not-fill-in-my-provided-buffer", "title": "ffmpeg does not fill in my provided buffer", "body": "<p>I'm trying to pipe a mp4 video to ffmpeg to generate a thumbnail. Unfortunately, ffmpeg does not fill in my provided buffer, even though the whole command execution is successful.</p>\n<p>I'm reading the video from a http request body:</p>\n<pre><code>videoData, err := ioutil.ReadAll(r.Body)\n</code></pre>\n<p>This is how I push it to ffmpeg:</p>\n<pre><code>log.Print(&quot;Creating thumbnail..&quot;)\n\nwidth := 640\nheight := 360\nlog.Print(&quot;Size of the video: &quot;, len(videoData))\n\n\ncmd := exec.Command(&quot;ffmpeg&quot;, &quot;-i&quot;, &quot;pipe:0&quot;, &quot;-vframes&quot;, &quot;1&quot;, &quot;-s&quot;, fmt.Sprintf(&quot;%dx%d&quot;, width, height), &quot;-f&quot;,  &quot;singlejpeg&quot;, &quot;-frame_size&quot;, fmt.Sprintf(&quot;%d&quot;, totalVideoBytes), &quot;-&quot;)\n\ncmd.Stdin = bytes.NewReader(videoData)\n\nvar imageBuffer bytes.Buffer\ncmd.Stdout = &amp;imageBuffer\nerr := cmd.Run()\n\nif err != nil {\n    log.Panic(&quot;ERROR&quot;)\n}\n\nimageBytes := imageBuffer.Bytes()\n</code></pre>\n<p>This is the error output:</p>\n<blockquote>\n<p>[mov,mp4,m4a,3gp,3g2,mj2 @ 0x7ff05d002600]stream 0, offset 0x5ded: partial file</p>\n<p>pipe:0: Invalid data found when processing input</p>\n<p>Finishing stream 0:0 without any data written to it.</p>\n<p>frame=    0 fps=0.0 q=0.0\nLsize=       0kB time=-577014:32:22.77 bitrate=  -0.0kbits/s speed=N/A\nvideo:0kB audio:0kB subtitle:0kB other streams:0kB global headers:0kB\nmuxing overhead: unknown</p>\n<p>Output file is empty, nothing was encoded (check -ss / -t / -frames parameters if used)</p>\n</blockquote>\n<p>Thanks a lot, any help is appreciated.</p>\n"}, {"tags": ["string", "pointers", "go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1523770369, "last_edit_date": 1523770369, "creation_date": 1523693266, "answer_id": 49829255, "question_id": 49829209, "link": "https://stackoverflow.com/questions/49829209/panic-interface-conversion-interface-is-string-not-string/49829255#49829255", "title": "panic: interface conversion: interface {} is **string, not string", "body": "<p>If you can't avoid having a <code>**string</code>, this is how you can handle it: assert <code>**string</code> from the <code>interface{}</code> value (since this is what it contains), and then dereference the pointer which gives you <code>*string</code> which you again can dereference which gives you the <code>string</code> value.</p>\n\n<pre><code>func main() {\n    s := \"ss\"\n    a := &amp;s\n\n    fmt.Println(\"Before a:\", *a)\n    Modify(&amp;a)\n    fmt.Println(\"After a:\", *a)\n    fmt.Println(\"After s:\", s)\n}\n\nfunc Modify(s interface{}) {\n    sp := s.(**string)\n    **sp = \"modified\"\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/8Lx10aOjxUY\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Before a: ss\nAfter a: modified\nAfter s: modified\n</code></pre>\n\n<p>But know that if you already have a variable of <code>*string</code> type (which is <code>a</code>), you don't need to take and pass its address, you can pass it as-is (a <code>*string</code> value):</p>\n\n<pre><code>func main() {\n    s := \"ss\"\n    a := &amp;s\n\n    fmt.Println(\"Before a:\", *a)\n    Modify(a)\n    fmt.Println(\"After a:\", *a)\n    fmt.Println(\"After s:\", s)\n}\n\nfunc Modify(s interface{}) {\n    sp := s.(*string)\n    *sp = \"modified\"\n}\n</code></pre>\n\n<p>Output again will be (try it on the <a href=\"https://play.golang.org/p/PlZTKh6Rsnq\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Before a: ss\nAfter a: modified\nAfter s: modified\n</code></pre>\n\n<p><strong>Note</strong> that in both cases the value pointed by <code>a</code> changed to <code>\"modified\"</code>, but the value of <code>s</code> also changed. This is because inside <code>Modify()</code> we modified the <em>pointed-pointed</em> value. If you only want <code>a</code> to change (more specifically the value pointed by <code>a</code>) but you don't want to change <code>s</code>, then inside <code>Modify()</code> you should only modify the value pointed by <code>sp</code>, which will be the variable <code>a</code>, but not the pointed-pointed value (which is <code>s</code>). In order to only change the pointed value, you have to assign a value of type <code>*string</code> to it:</p>\n\n<pre><code>func main() {\n    s := \"ss\"\n    a := &amp;s\n\n    fmt.Println(\"Before a:\", *a)\n    Modify(&amp;a)\n    fmt.Println(\"After a:\", *a)\n    fmt.Println(\"After s:\", s)\n}\n\nfunc Modify(s interface{}) {\n    sp := s.(**string)\n    newValue := \"modified\"\n    *sp = &amp;newValue\n}\n</code></pre>\n\n<p>This time the output will be (try it on the <a href=\"https://play.golang.org/p/5IVxY3MHlk9\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Before a: ss\nAfter a: modified\nAfter s: ss\n</code></pre>\n\n<p>As you can see, <code>Modify()</code> modified the value pointed by <code>a</code>, but <code>s</code> remained unchanged.</p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 2, "last_activity_date": 1523696720, "last_edit_date": 1523696720, "creation_date": 1523693329, "answer_id": 49829262, "question_id": 49829209, "link": "https://stackoverflow.com/questions/49829209/panic-interface-conversion-interface-is-string-not-string/49829262#49829262", "title": "panic: interface conversion: interface {} is **string, not string", "body": "<p>You require to assert <code>**string</code> to get underlying value wrapped around <code>interface{}</code>. And then dereference the value of string using <code>double</code> pointer. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    s := \"ss\"\n    a := &amp;s\n    Modify(&amp;a)\n}\n\nfunc Modify(s interface{}) {\n     fmt.Println(**s.(**string))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/c8NZeu_90fg\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8827, "favorite_count": 0, "accepted_answer_id": 49829262, "answer_count": 2, "score": 2, "last_activity_date": 1523770369, "creation_date": 1523692997, "last_edit_date": 1523703617, "question_id": 49829209, "link": "https://stackoverflow.com/questions/49829209/panic-interface-conversion-interface-is-string-not-string", "title": "panic: interface conversion: interface {} is **string, not string", "body": "<p>How to convert double pointer string to string?</p>\n\n<p>In this example we can directly pass string argument. But I have double pointer string to string requirement in my app.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    s := \"ss\"\n    a := &amp;s\n    Modify(&amp;a)\n}\n\nfunc Modify(s interface{}) {\n    fmt.Println(s)\n\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/d4hrG9LzLNO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/d4hrG9LzLNO</a></p>\n"}, {"tags": ["unit-testing", "go", "ginkgo", "gomega"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523704513, "post_id": 49828807, "comment_id": 86676789, "body": "How can something be complete if it has never started? Checking for &quot;complete&quot; should suffice."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523706502, "post_id": 49828807, "comment_id": 86677359, "body": "I believe <code>start</code> and <code>end</code> are  sample names, we can have as many return values as r1, r2, r3... without any particular meaning"}], "answers": [{"comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 1, "creation_date": 1523706818, "post_id": 49830889, "comment_id": 86677430, "body": "..and asserts that all other return values are nil or zero-valued, so, then the test will never pass if the function returns true and true."}, {"owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523708047, "post_id": 49830889, "comment_id": 86677758, "body": "I see. I only focused on Eventually functions. I overlooked that <code>Equal</code> only receives one interface parameter. My bad."}], "tags": [], "owner": {"reputation": 2647, "user_id": 4628962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/avtRP.png?s=128&g=1", "display_name": "Abdullah Al Maruf - Tuhin", "link": "https://stackoverflow.com/users/4628962/abdullah-al-maruf-tuhin"}, "is_accepted": false, "score": 0, "last_activity_date": 1523711705, "last_edit_date": 1523711705, "creation_date": 1523704970, "answer_id": 49830889, "question_id": 49828807, "link": "https://stackoverflow.com/questions/49828807/can-gomegas-equal-handle-multiple-values/49830889#49830889", "title": "Can Gomega&#39;s Equal() handle multiple values ?", "body": "<p>In <a href=\"https://onsi.github.io/gomega/#eventually\" rel=\"nofollow noreferrer\"><code>gomega</code>'s doc</a>, It has been said that multiple return is ok to be used. </p>\n\n<blockquote>\n  <p>The function that you pass to Eventually can have more than one return\n  value. In that case, Eventually passes the first return value to the\n  matcher and asserts that all other return values are nil or\n  zero-valued. This allows you to use Eventually with functions that\n  return a value and an error \u2013 a common pattern in Go</p>\n</blockquote>\n\n<p>In your code, can you change this line</p>\n\n<p><code>.Should(Equal((true, true))</code> to <code>.Should(Equal(true, true)</code>. </p>\n\n<p>That should fix the problem.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>I overlooked that Equal only receives one interface parameter. My bad.</p>\n\n<p>For future reference, for comparing multiple values in gomega's <code>eventually</code>,<code>Array</code> of struct (or any datatype) can be useful. </p>\n"}, {"tags": [], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "is_accepted": true, "score": 0, "last_activity_date": 1523716488, "last_edit_date": 1523716488, "creation_date": 1523706260, "answer_id": 49831061, "question_id": 49828807, "link": "https://stackoverflow.com/questions/49828807/can-gomegas-equal-handle-multiple-values/49831061#49831061", "title": "Can Gomega&#39;s Equal() handle multiple values ?", "body": "<p>You can use a wrapper function I wrote based on your pseudocode</p>\n\n<pre><code>g := gomega.NewGomegaWithT(t)\n...\ntestedFunc := func() (bool, bool) {\n...\n    start = false\n    end = true\n\n    if (request.status == \"started\") {\n        start = true\n    }\n    if (request.status == \"complete\") {\n        end = true\n    }\n    return start, end\n}\n\ng.Eventually(func() map[string]bool{\n    r1,r2 := testedFunc()\n    return map[string]bool{\"start\": r1, \"end\": r2}\n}).Should(Equal(map[string]bool{\"start\": true, \"end\": true}))\n</code></pre>\n\n<p>I'm using a map instead of simple <code>r1&amp;r2</code>for verbosity, so, you can see what is actually wrong with the results. In my opinion, it's a bad practice to compare 2 return values unless the second one is an error. You can always combine multiple return values in a single language construct (map, slice, struct, etc.) as I did in my wrapper function. I understand it's hard to do with the async Eventually method, but in general, I'd try to assert each of the return values separately.</p>\n"}], "owner": {"reputation": 1011, "user_id": 2969402, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a971b3c4d070d8af92b98952b702c9bb?s=128&d=identicon&r=PG&f=1", "display_name": "user2969402", "link": "https://stackoverflow.com/users/2969402/user2969402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1843, "favorite_count": 1, "accepted_answer_id": 49831061, "answer_count": 2, "score": 1, "last_activity_date": 1523716488, "creation_date": 1523689290, "question_id": 49828807, "link": "https://stackoverflow.com/questions/49828807/can-gomegas-equal-handle-multiple-values", "title": "Can Gomega&#39;s Equal() handle multiple values ?", "body": "<p>I am testing a function to send a mock request to a server using gomega and I want to verify that 1. the request has started 2. the request has completed. For this I am returning two booleans. They should both evaluate to true in the example below but the values will be subject to change. I have tried this:</p>\n\n<pre><code>g := gomega.NewGomegaWithT(t)\n...\ng.Eventually(func() (bool, bool) {\n...\n    start = false\n    end = true\n\n    if (request.status == \"started\") {\n        start = true\n    }\n    if (request.status == \"complete\") {\n        end = true\n    }\n    return start, end\n}).Should(Equal((true, true))\n</code></pre>\n\n<p>But it seems that gomega's <code>Equal()</code> does not handle multiple variables. Is there any way around this? Is it bad practice to evaluate two return values ?</p>\n"}, {"tags": ["sql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": false, "score": 0, "last_activity_date": 1523709945, "creation_date": 1523709945, "answer_id": 49831592, "question_id": 49828714, "link": "https://stackoverflow.com/questions/49828714/joint-queries-through-foreign-key/49831592#49831592", "title": "Joint queries through foreign key", "body": "<p>Try this one</p>\n\n<pre><code>db.Where(\"is_current = ?\", true).Model(&amp;session).Related(&amp;session.Files)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1201, "user_id": 5097493, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/95b290a191545edb4077adfaab317f1a?s=128&d=identicon&r=PG&f=1", "display_name": "RuNpiXelruN", "link": "https://stackoverflow.com/users/5097493/runpixelrun"}, "is_accepted": true, "score": 0, "last_activity_date": 1524017479, "last_edit_date": 1524017479, "creation_date": 1524017179, "answer_id": 49890049, "question_id": 49828714, "link": "https://stackoverflow.com/questions/49828714/joint-queries-through-foreign-key/49890049#49890049", "title": "Joint queries through foreign key", "body": "<p>@TonyGW the key is using a combination of <code>Preload</code> and <code>Where</code> in your Gorm call.</p>\n\n<pre><code>currentSession := &amp;Session{}\n\nerr := db.Model(&amp;Session{}).Preload(\"Files\").Where(&amp;Session{IsCurrent: true}).Find(&amp;currentSession).Error\nif err != nil {\n  fmt.Println(\"Error:\", err)\n}\n\nfmt.Printf(\"%+v\\n\", currentSession)\n</code></pre>\n\n<p><strong>FYI</strong></p>\n\n<p>There are a number of ways you can structure the <code>Where</code> query. Eg,</p>\n\n<pre><code>db.Model(&amp;Session{}).Preload(\"Files\").Where(\"is_current = ?\", true).Find(&amp;currentSession)\n</code></pre>\n\n<p>and also using a map to build up multiple <code>Where</code> conditions,</p>\n\n<pre><code>db.Model(&amp;Session{}).Preload(\"Files\").Where(map[string]interface{}{\n  \"is_current\": true,\n  \"something_else\": \"value\",\n}).Find(&amp;currentSession)\n</code></pre>\n\n<p>I hope that helps!</p>\n"}], "owner": {"reputation": 15341, "user_id": 2228325, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Vn6At.png?s=128&g=1", "display_name": "TonyGW", "link": "https://stackoverflow.com/users/2228325/tonygw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 49890049, "answer_count": 2, "score": 1, "last_activity_date": 1527757356, "creation_date": 1523688317, "last_edit_date": 1527757356, "question_id": 49828714, "link": "https://stackoverflow.com/questions/49828714/joint-queries-through-foreign-key", "title": "Joint queries through foreign key", "body": "<p>I have the following two models: <code>File</code> and <code>Session</code>, and a single session could have many File objects (one-to-many). </p>\n\n<pre><code>type Session struct {\n    gorm.Model\n    Name            string       `json:\"name,omitempty\"`    \n    IsCurrent       bool         `json:\"is_current\"`\n    Files     []File `gorm:\"foreignkey:SessionID\" json:\"files\"`\n}\n\ntype File struct {\n    gorm.Model\n    Name        string `json:\"name\"`\n    FileType    string `json:\"file_type\"`\n    ParentName  string `json:\"parent_name\"`\n    SessionID   uint   `json:\"session_id\"`\n}\n</code></pre>\n\n<p>I'd like to get all the files associated to the session that has <code>IsCurrent = true</code></p>\n\n<p>I wrote the following raw SQL query that seems to work fine, but I'd like to know if there's any way to do a similar query int he <a href=\"http://doc.gorm.io/advanced.html#compose-primary-key\" rel=\"nofollow noreferrer\">Gorm</a> way.</p>\n\n<blockquote>\n  <p>err = db.Raw(\"SELECT * FROM files, sessions WHERE files.session_id == sessions.id AND sessions.is_current = ?\", true).Scan(&amp;fileObjects).Error</p>\n</blockquote>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1523695023, "post_id": 49827554, "comment_id": 86674230, "body": "The surest way to know is to run some tests with the race detector on. But just intuitively, it sounds dangerous (which you probably agree with since you&#39;re asking the question)."}, {"owner": {"reputation": 297, "user_id": 3601503, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/1557105739/picture?type=large", "display_name": "dan", "link": "https://stackoverflow.com/users/3601503/dan"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523706186, "post_id": 49827554, "comment_id": 86677260, "body": "Thanks, I had no idea that was an option available to me."}], "answers": [{"tags": [], "owner": {"reputation": 297, "user_id": 3601503, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/1557105739/picture?type=large", "display_name": "dan", "link": "https://stackoverflow.com/users/3601503/dan"}, "is_accepted": true, "score": 0, "last_activity_date": 1524553300, "creation_date": 1524553300, "answer_id": 49995287, "question_id": 49827554, "link": "https://stackoverflow.com/questions/49827554/is-it-safe-to-modify-golang-http-transport-while-requests-are-in-flight/49995287#49995287", "title": "Is it safe to modify golang Http Transport while requests are in flight?", "body": "<p>With the race detector it definitely showed that I shouldn't have been modifying the transport. In the end I decided on rotating *http.Transport around instead of proxies, and using unique clients when making concurrent requests.</p>\n\n<p>Thanks to @Flimzy</p>\n"}], "owner": {"reputation": 297, "user_id": 3601503, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/1557105739/picture?type=large", "display_name": "dan", "link": "https://stackoverflow.com/users/3601503/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 0, "accepted_answer_id": 49995287, "answer_count": 1, "score": 0, "last_activity_date": 1524553300, "creation_date": 1523675953, "question_id": 49827554, "link": "https://stackoverflow.com/questions/49827554/is-it-safe-to-modify-golang-http-transport-while-requests-are-in-flight", "title": "Is it safe to modify golang Http Transport while requests are in flight?", "body": "<p>I have an application which rotates through proxies on a per request basis.</p>\n\n<p>Currently I have some code which is:</p>\n\n<pre><code>func (mon *Monitor) MassUrlRetrieve(n int, url string) (respBytes []byte) {\n    funnel := make(chan []byte)\n    go ProductRetrieveTimeout(TIMEOUT_RETRIEVE_URL, funnel)\n    for i := 0; i &lt; n; i++ {\n        go mon.WrapGetUrlToChannel(funnel, url)\n    }\n    return &lt;- funnel\n}\n</code></pre>\n\n<p>which basically sends off multiple requests and returns the first one to respond/ timeout if none respond in a timely manner.</p>\n\n<p>In <code>WrapGetUrlToChannel</code> I create a new proxy url are assign it to <code>mon</code>'s <code>client.tr.Proxy</code>.</p>\n\n<p>My question is - is it safe to modify the transport of the client while requests are in flight? Or to be safe should I have a different transport and client for each proxy to make sure they do not interfere?</p>\n"}, {"tags": ["html", "forms", "go"], "answers": [{"comments": [{"owner": {"reputation": 279, "user_id": 7022312, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/dd356dd2c58f1fd05b75f84fb4cabcf2?s=128&d=identicon&r=PG&f=1", "display_name": "Emjey23", "link": "https://stackoverflow.com/users/7022312/emjey23"}, "edited": false, "score": 0, "creation_date": 1523679019, "post_id": 49827574, "comment_id": 86671034, "body": "<code>os.OpenFile(filename, os.O_APPEND|os.O_WRONLY, 0600)</code>"}], "tags": [], "owner": {"reputation": 144, "user_id": 9643870, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Ryan Lim", "link": "https://stackoverflow.com/users/9643870/ryan-lim"}, "is_accepted": true, "score": 1, "last_activity_date": 1523676203, "creation_date": 1523676203, "answer_id": 49827574, "question_id": 49827197, "link": "https://stackoverflow.com/questions/49827197/golang-saving-to-json-file/49827574#49827574", "title": "Golang saving to json file", "body": "<p>I believe that os.Open defaults to read-only. I think you want something like os.OpenFile. </p>\n"}], "owner": {"reputation": 279, "user_id": 7022312, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/dd356dd2c58f1fd05b75f84fb4cabcf2?s=128&d=identicon&r=PG&f=1", "display_name": "Emjey23", "link": "https://stackoverflow.com/users/7022312/emjey23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2718, "favorite_count": 0, "accepted_answer_id": 49827574, "answer_count": 1, "score": 1, "last_activity_date": 1523676203, "creation_date": 1523671891, "question_id": 49827197, "link": "https://stackoverflow.com/questions/49827197/golang-saving-to-json-file", "title": "Golang saving to json file", "body": "<p>I am wondering why saving to json file does'nt work as I expected.</p>\n\n<p>-If I input values in the fields and click submit button</p>\n\n<p>-The form will submit and the <em>process function</em> executes</p>\n\n<p>-The <em>process.html</em> renders the input values.</p>\n\n<p>-The input values not saving to the <em>json file</em>.</p>\n\n<pre><code>import (\n    \"net/http\" \n    \"html/template\" \n    \"os\" \n    \"encoding/json\"\n)\n\nvar tpl *template.Template\n\ntype Data struct {\n    First string `json:\"First\"`\n    Last string `json:\"Last\"`\n}\n\nfunc init() {\n    tpl = template.Must(template.ParseGlob(\"templates/*.gohtml\"))    \n}\n\nfunc main() {\n    http.HandleFunc(\"/\", index);\n    http.HandleFunc(\"/process\", process); \n    http.ListenAndServe(\":80\", nil);   \n}\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    tpl.ExecuteTemplate(w, \"index.gohtml\", nil)\n}\n\nfunc process(w http.ResponseWriter, r *http.Request) {\n    if r.Method != \"POST\" {\n        http.Redirect(w, r, \"/\", http.StatusSeeOther)\n        return\n    }\n\n    f, err := os.Open(\"name.json\");\n    if err != nil {\n        http.Error(w, err.Error(), 500)\n        return\n    }\n    defer f.Close();\n\n    data := new(Data)\n    data.First = r.FormValue(\"first\");\n    data.Last = r.FormValue(\"last\");\n\n    b, err := json.Marshal(data)\n    if err != nil {\n        http.Error(w, err.Error(), 500)\n        return\n    }\n\n    f.Write(b)\n    f.Close()\n\n    tpl.ExecuteTemplate(w, \"process.gohtml\", data)\n}\n</code></pre>\n"}, {"tags": ["angular", "go", "localhost", "nativescript"], "comments": [{"owner": {"reputation": 811, "user_id": 4155829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b3c6da623778514d7216da4f7d32259?s=128&d=identicon&r=PG", "display_name": "Osei Fortune", "link": "https://stackoverflow.com/users/4155829/osei-fortune"}, "edited": false, "score": 0, "creation_date": 1523664123, "post_id": 49826426, "comment_id": 86668771, "body": "connecting to <code>http:&#47;&#47;localhost:8080&#47;</code> will only work if you are using an IOS device use the following for android <code>http:&#47;&#47;10.0.2.2:8080&#47;</code> if you are using the default avd or <code>http:&#47;&#47;10.0.3.2:8080</code> if you are using genymotion also you can use <code>go run main.go</code> instead of calling build each time there is a change"}, {"owner": {"reputation": 1102, "user_id": 5660197, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/97df5665e51bcf688208167c32a7bb4e?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/5660197/tony"}, "reply_to_user": {"reputation": 811, "user_id": 4155829, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b3c6da623778514d7216da4f7d32259?s=128&d=identicon&r=PG", "display_name": "Osei Fortune", "link": "https://stackoverflow.com/users/4155829/osei-fortune"}, "edited": false, "score": 0, "creation_date": 1523665278, "post_id": 49826426, "comment_id": 86668976, "body": "Thanks, unfortunately that didn&#39;t work my command line remains un-printed.  I just saw that <code>@angular&#47;http</code> might be the outdated version so i&#39;m going to try out <code>@angular&#47;common&#47;http</code>"}, {"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1523666776, "post_id": 49826426, "comment_id": 86669251, "body": "You could debug the backend apart from Angular to be sure it responds properly. @angular/http is deprecated but workable. You&#39;re using it incorrectly. There&#39;s no <code>.map(res =&gt; ..)</code>, and get_test() observable isn&#39;t subscribed. Just check the examples in the guide and paste them."}, {"owner": {"reputation": 1102, "user_id": 5660197, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/97df5665e51bcf688208167c32a7bb4e?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/5660197/tony"}, "edited": false, "score": 0, "creation_date": 1523667275, "post_id": 49826426, "comment_id": 86669323, "body": "so <code>curl localhost:8080</code> prints out <code>recieved</code> so I know that&#39;s working.  I didn&#39;t think I would need to write out all the success/error code because I just want to see if I can hit my service but i&#39;ll try that."}, {"owner": {"reputation": 1102, "user_id": 5660197, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/97df5665e51bcf688208167c32a7bb4e?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/5660197/tony"}, "reply_to_user": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1523669967, "post_id": 49826426, "comment_id": 86669734, "body": "@estus Can you explain what this means: <code>get_test() observable isn&#39;t subscribed</code>?  I&#39;m not using a guide for the nativescript stuff, I built the app without looking at any of the backend stuff first.  Regretting that now."}, {"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1523679105, "post_id": 49826426, "comment_id": 86671048, "body": "An observable isn&#39;t fired if you didn&#39;t call .subscribe() on it. If you didn&#39;t check the guide, then probably should <a href=\"https://angular.io/guide/http\" rel=\"nofollow noreferrer\">angular.io/guide/http</a> . You can&#39;t develop Angular app without knowing how to develop it."}], "answers": [{"tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 0, "last_activity_date": 1524440391, "creation_date": 1524440391, "answer_id": 49971729, "question_id": 49826426, "link": "https://stackoverflow.com/questions/49826426/developing-golang-backend-locally-for-nativescript-mobile-application/49971729#49971729", "title": "Developing Golang backend locally for Nativescript mobile application", "body": "<p>There's nothing wrong with your server-side code. It sounds to me like either (a) your frontend code isn't actually triggering the http request (which you should be able to detect by attaching to your browser's debugger) or (b) your frontend is trying to make the request but doesn't know how to find the server (i.e. a networking issue). </p>\n"}], "owner": {"reputation": 1102, "user_id": 5660197, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/97df5665e51bcf688208167c32a7bb4e?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/5660197/tony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 259, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1524440391, "creation_date": 1523662606, "question_id": 49826426, "link": "https://stackoverflow.com/questions/49826426/developing-golang-backend-locally-for-nativescript-mobile-application", "title": "Developing Golang backend locally for Nativescript mobile application", "body": "<p>I'm working on a Nativescript mobile application, and at the same time trying to design a Golang backend.  I have no experience actually deploying a backend though, so for now i'm just trying to develop locally.  So I have some button on my emulated application:</p>\n\n<pre><code>import { Http } from \"@angular/http\"                                                                \n\n+@Component({...}\n+export class LoginComponent implements OnInit {...}{\n\n    . . .\n\n    // &lt;Button ... (tap)=\"get_test()\"&gt;&lt;/Button&gt; \n    public get_test(){                                                                              \n        this.http.get(\"http://localhost:8080/\");                                                    \n    }                                                                                               \n\n}  \n</code></pre>\n\n<p>And a small web server I copied from the <a href=\"https://golang.org/doc/articles/wiki/\" rel=\"nofollow noreferrer\">golang website</a>:</p>\n\n<pre><code> package main\n\n import (\n     \"log\"\n     \"net/http\"\n )\n\n func handler(w http.ResponseWriter, r *http.Request) {\n     print(\"recieved\")\n }\n\n func main() {\n     http.HandleFunc(\"/\", handler)\n     log.Fatal(http.ListenAndServe(\":8080\", nil))\n }\n</code></pre>\n\n<p>I start up the <code>go</code> \"server\":</p>\n\n<pre><code>go build main.go\n./main\n</code></pre>\n\n<p>Now my thinking was that by clicking the button, the command line should print out <code>recieved</code> and I could use this going forward for designing my requests.  Yet nothing happens on either side.  There might be plenty of errors here in the code, and i'm not even sure you can emulate this locally.  But any help would be appreciated.</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 3224720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f122d270b2de6bb1ed46c4514835f77?s=128&d=identicon&r=PG&f=1", "display_name": "Arajit", "link": "https://stackoverflow.com/users/3224720/arajit"}, "edited": false, "score": 0, "creation_date": 1578344781, "post_id": 49962147, "comment_id": 105401352, "body": "Any code sample on how to converta json string to proto struct type using <code>jsobpb</code> would be helpful."}], "tags": [], "owner": {"reputation": 46, "user_id": 5005042, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hWGqj-bApRk/AAAAAAAAAAI/AAAAAAAABR4/s12XC61aNE0/photo.jpg?sz=128", "display_name": "mechinn", "link": "https://stackoverflow.com/users/5005042/mechinn"}, "is_accepted": true, "score": 1, "last_activity_date": 1524370255, "last_edit_date": 1524370255, "creation_date": 1524366699, "answer_id": 49962147, "question_id": 49826236, "link": "https://stackoverflow.com/questions/49826236/unmarshal-custom-types-with-jsonpb/49962147#49962147", "title": "Unmarshal custom types with jsonpb", "body": "<p>With _list being inconsistent (not just a list of strings/map of values/etc) and you mentioning you looked into using Any you could consider making your message:</p>\n\n<p><code>message Something {\n     string name = 1;\n     google.protobuf.Struct _list = 2;\n}</code></p>\n\n<p><a href=\"https://github.com/golang/protobuf/blob/master/ptypes/struct/struct.proto\" rel=\"nofollow noreferrer\">https://github.com/golang/protobuf/blob/master/ptypes/struct/struct.proto</a></p>\n\n<p>With that you can marshal/unmarshal json to/from proto messages using <a href=\"https://godoc.org/github.com/golang/protobuf/jsonpb\" rel=\"nofollow noreferrer\">github.com/golang/protobuf/jsonpb</a> which is actually designed for use with the grpc gateway but you can use it too</p>\n"}], "owner": {"reputation": 523, "user_id": 2502761, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/eac8ddf404d16c2e2b0a23c8b3b4755e?s=128&d=identicon&r=PG", "display_name": "user2502761", "link": "https://stackoverflow.com/users/2502761/user2502761"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2605, "favorite_count": 0, "accepted_answer_id": 49962147, "answer_count": 1, "score": 1, "last_activity_date": 1524370255, "creation_date": 1523660965, "question_id": 49826236, "link": "https://stackoverflow.com/questions/49826236/unmarshal-custom-types-with-jsonpb", "title": "Unmarshal custom types with jsonpb", "body": "<p>What's the best way to convert this json object to protobuf?</p>\n\n<p>JSON:</p>\n\n<pre><code>{\n  \"name\": \"test\",\n  \"_list\": {\n    \"some1\": { \"value\": 1 },\n    \"some2\": [\n      { \"value\": 2 },\n      { \"value\": 3 },\n    ]\n  }\n}\n</code></pre>\n\n<p>Proto:</p>\n\n<pre><code>message Something {\n     string name = 1;\n     message ListType {\n       repeated string = 1;\n     }\n     map&lt;string, ListType&gt; _list = 2;\n   }\n</code></pre>\n\n<p>Without having the <code>_list</code> in the message I would use jsonpb.Unmarsal, but I can't think of a way to define the Unmarshaler interface on a type that is generated in a diff package.</p>\n\n<p>I also thought of having <code>_list</code> as a Any (json.RawMessage) and handle it after the Unmarshal (but can't make this to work; err message: <code>Any JSON doesn't have '@type'</code>)</p>\n"}, {"tags": ["go", "revel"], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 41, "last_activity_date": 1523660199, "creation_date": 1523660199, "answer_id": 49826151, "question_id": 49826038, "link": "https://stackoverflow.com/questions/49826038/how-to-add-variable-to-string-variable-in-golang/49826151#49826151", "title": "How to add variable to string variable in golang", "body": "<p>Why not use <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"noreferrer\"><code>fmt.Sprintf</code></a>?</p>\n\n<pre><code>data := 14\nresponse := fmt.Sprintf(\"Variable string %d content\", data)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1288, "user_id": 7225929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa26a9a36b086d9872cbe4c70355dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "omotto", "link": "https://stackoverflow.com/users/7225929/omotto"}, "edited": false, "score": 9, "creation_date": 1572607352, "post_id": 57235016, "comment_id": 103619737, "body": "<code>data</code> is an <code>Integer</code> and you can not insert directly on <code>String</code> on this way. Otherwise you will have the following error:  <code>invalid operation: &quot;Variable string&quot; + data (mismatched types string and int)</code>"}], "tags": [], "owner": {"reputation": 991, "user_id": 1594024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34d34684960de85c9b10114a697640a0?s=128&d=identicon&r=PG", "display_name": "Ari Pratomo", "link": "https://stackoverflow.com/users/1594024/ari-pratomo"}, "is_accepted": false, "score": 6, "last_activity_date": 1564252355, "creation_date": 1564252355, "answer_id": 57235016, "question_id": 49826038, "link": "https://stackoverflow.com/questions/49826038/how-to-add-variable-to-string-variable-in-golang/57235016#57235016", "title": "How to add variable to string variable in golang", "body": "<p>If you want to keep the string in variable rather than to print out, try like this:</p>\n\n<pre><code>data := 14\nresponse := \"Variable string\" + data + \"content\"\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1193, "user_id": 3168185, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/iWFTu.jpg?s=128&g=1", "display_name": "Bayu", "link": "https://stackoverflow.com/users/3168185/bayu"}, "is_accepted": false, "score": 4, "last_activity_date": 1606662994, "last_edit_date": 1606662994, "creation_date": 1587529341, "answer_id": 61357281, "question_id": 49826038, "link": "https://stackoverflow.com/questions/49826038/how-to-add-variable-to-string-variable-in-golang/61357281#61357281", "title": "How to add variable to string variable in golang", "body": "<p>I believe that the accepted answer is already the best practice one. Just like to give an alternative option based on @Ari Pratomo answer:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;strconv&quot;\n)\n\nfunc main() {\n    data := 14\n    response := &quot;Variable string &quot; + strconv.Itoa(data) + &quot; content&quot;\n    fmt.Println(response) //Output: Variable string 14 content\n}\n\n</code></pre>\n<p>It using <code>strconv.Itoa()</code> to convert an integer to string, so it can be concatenated with the rest of strings.</p>\n<p>Demo: <a href=\"https://play.golang.org/p/VnJBrxKBiGm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VnJBrxKBiGm</a></p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1618084763, "creation_date": 1618084763, "answer_id": 67038694, "question_id": 49826038, "link": "https://stackoverflow.com/questions/49826038/how-to-add-variable-to-string-variable-in-golang/67038694#67038694", "title": "How to add variable to string variable in golang", "body": "<p>You can also use <code>os.Expand</code>:</p>\n<pre><code>package main\n\nimport (\n   &quot;fmt&quot;\n   &quot;os&quot;\n)\n\nfunc main() {\n   data := 14\n   response := &quot;Variable string $data content&quot;\n   response = os.Expand(response, func(s string) string {\n      switch s {\n      case &quot;data&quot;: return fmt.Sprint(data)\n      default: return &quot;&quot;\n      }\n   })\n   println(response == &quot;Variable string 14 content&quot;)\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/os#Expand\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os#Expand</a></p>\n"}], "owner": {"reputation": 458, "user_id": 2391750, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Flsmz.jpg?s=128&g=1", "display_name": "omalave", "link": "https://stackoverflow.com/users/2391750/omalave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40690, "favorite_count": 1, "accepted_answer_id": 49826151, "answer_count": 4, "score": 24, "last_activity_date": 1618084763, "creation_date": 1523659216, "question_id": 49826038, "link": "https://stackoverflow.com/questions/49826038/how-to-add-variable-to-string-variable-in-golang", "title": "How to add variable to string variable in golang", "body": "<p>I'm trying to add a value to a variable string in golang, without use printf because I'm using revel framework and this is for a web enviroment instead of console, this is the case:</p>\n\n<pre><code>data := 14\nresponse := `Variable string content`\n</code></pre>\n\n<p>so I can't get variable data inside variable response, like this</p>\n\n<pre><code>response := `Variable string 14 content`\n</code></pre>\n\n<p>Any idea?</p>\n"}, {"tags": ["go", "udp"], "comments": [{"owner": {"reputation": 23069, "user_id": 156811, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/380335e95e6be9740e56b64d667279b3?s=128&d=identicon&r=PG", "display_name": "Havenard", "link": "https://stackoverflow.com/users/156811/havenard"}, "edited": false, "score": 0, "creation_date": 1523659181, "post_id": 49825924, "comment_id": 86667736, "body": "UDP doesn&#39;t establish a connection, usually when you are working with UDP you deal with packets directly, that are addressed individually, so when receiving and sending each packet you also need to either receive or inform the peer&#39;s IP+port to know who you are talking to or from who the information came from. There are two syscalls used for that, <code>recvfrom()</code> and <code>sendto()</code>, I don&#39;t know how Go implemented this but I&#39;m pretty sure <code>net.TCPConn.Read()</code> won&#39;t work for UDP at all."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523661223, "post_id": 49825924, "comment_id": 86668209, "body": "You can\u2019t send or receive UDP packets from a TCP connection. If you need to send UDP packets, use a UDP connection."}, {"owner": {"reputation": 531, "user_id": 3918996, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5ced6373dbacd78f120f945256908c00?s=128&d=identicon&r=PG&f=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/3918996/rob"}, "edited": false, "score": 0, "creation_date": 1523684492, "post_id": 49825924, "comment_id": 86672022, "body": "I know that UDP is connectionless but it is <a href=\"https://linux.die.net/man/2/sendto\" rel=\"nofollow noreferrer\">perfectly valid sockets</a> to send a UDP packet down a connected socket; you just leave the destination address off the <code>sendto()</code> and it figures out what you mean.  I know this because this is exactly what the other end of the link, coded in C, is doing in this case.  Surely Golang has allowed for what is a quite normal sockets operation in its <code>net</code> implementation!?  The comment in <a href=\"https://golang.org/pkg/net/#UDPConn.WriteMsgUDP\" rel=\"nofollow noreferrer\">net.UDPConn.WriteMsgUDP()</a> implies it has, I just can&#39;t figure out how it works."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523706225, "post_id": 49825924, "comment_id": 86677273, "body": "You cannot send UDP packets over a TCP connection, it doesn\u2019t make any sense. I can assure you you\u2019re not receiving a UDP packet on the TCP connection, and since the ssh tunnel is TCP, you cannot send it a UDP packet. There might be a UDP socket listening on the same port number, but it is completely separate from the TCP connection."}], "answers": [{"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 1, "last_activity_date": 1523687234, "creation_date": 1523687234, "answer_id": 49828608, "question_id": 49825924, "link": "https://stackoverflow.com/questions/49825924/send-udp-packet-on-tcp-connected-port/49828608#49828608", "title": "Send UDP packet on TCP connected port", "body": "<p>If you just want to send a UDP packet to a \"client\" that first reaches your application via TCP, what probably you could is to get the remote <a href=\"https://golang.org/pkg/net/#Addr\" rel=\"nofollow noreferrer\">address</a>:</p>\n\n<pre><code>addr = net.TCPConn.RemoteAddr()\n</code></pre>\n\n<p>Then assuming this client is also a server and listening on port <code>UDP</code> in <code>1234</code></p>\n\n<pre><code>ServerAddr, err := net.ResolveUDPAddr(\"udp\", fmt.Sprintf(\"%s:1234\", addr))\n</code></pre>\n\n<p>Then you could just write back by doing:</p>\n\n<pre><code> conn, err := net.DialUDP(\"udp\", nil, ServerAddr)\n if err != nil {\n     log.Fatal(err)\n }\n defer close(conn)\n buf := []byte(\"ping\")\n _, err = conn.Write(buf)\n</code></pre>\n\n<p>Don't know if this is exactly what you want but hope can give you some more ideas.</p>\n"}, {"tags": [], "owner": {"reputation": 531, "user_id": 3918996, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5ced6373dbacd78f120f945256908c00?s=128&d=identicon&r=PG&f=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/3918996/rob"}, "is_accepted": true, "score": 1, "last_activity_date": 1523724098, "creation_date": 1523724098, "answer_id": 49833766, "question_id": 49825924, "link": "https://stackoverflow.com/questions/49825924/send-udp-packet-on-tcp-connected-port/49833766#49833766", "title": "Send UDP packet on TCP connected port", "body": "<p>After a discussion on the <a href=\"https://forum.golangbridge.org/t/net-pkg-sending-a-udp-packet-on-a-connected-socket/8810\" rel=\"nofollow noreferrer\">Golang forums</a> all has become clear.</p>\n\n<p>@JimB is quite right that you cannot send a UDP packet on a TCP port.  The reason I thought this was possible is that the definition of <code>sendto()</code> says:</p>\n\n<blockquote>\n  <p>If <code>sendto()</code> is used on a connection-mode (<code>SOCK_STREAM</code>,\n  <code>SOCK_SEQPACKET</code>) socket, the arguments <code>dest_addr</code> and <code>addrlen</code> are\n  ignored (and the error <code>EISCONN</code> may be returned when they are not\n  <code>NULL</code> and 0), and the error <code>ENOTCONN</code> is returned when the socket\n  was not actually connected.</p>\n</blockquote>\n\n<p>...and when I called <code>sendto()</code> on my TCP connected port the data I sent did indeed turn up at my Golang <code>net.TCPConn</code> end-point.  However, what is happening in this scenario is that, under the hood, <code>sendto()</code> has effectively become an alias for <code>send()</code> and, despite calling <code>sendto()</code>, the data sent is actually being transported in a TCP packet and not a UDP packet at all.  This was proved by using <code>netcat -u $host $port</code> to send UDP traffic to the server and <code>netcat $host $port</code> to send TCP traffic to the server: the former did not produce any data at the <code>net.TCPConn</code> end-point while the latter did.</p>\n\n<p>The correct way to do this is for the client to open a TCP <em>and</em> a UDP socket to the server on the same port at the same time while the server, likewise, listens simultaneously for TCP and UDP \"connections\" (the UDP connection is not a connection at all of course, it is simply an association with a local port number) on the same port.  The TCP server then handles my stream and the UDP server handles my UDP test/measurement packets, both down the same SSH port forwarding tunnel.</p>\n"}], "owner": {"reputation": 531, "user_id": 3918996, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5ced6373dbacd78f120f945256908c00?s=128&d=identicon&r=PG&f=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/3918996/rob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3172, "favorite_count": 0, "closed_date": 1523738020, "accepted_answer_id": 49833766, "answer_count": 2, "score": -2, "last_activity_date": 1523724098, "creation_date": 1523658495, "last_edit_date": 1523696181, "question_id": 49825924, "link": "https://stackoverflow.com/questions/49825924/send-udp-packet-on-tcp-connected-port", "closed_reason": "Needs details or clarity", "title": "Send UDP packet on TCP connected port", "body": "<p>I have a Golang TCP server, i.e. <code>net.TCPConn</code>, connected on a port which, in addition to a TCP stream, also has to receive UDP packets and respond with UDP packets.  The incoming UDP packet pops out at the server (from a <code>net.TCPConn.Read()</code>) but I can't figure out how to send a UDP packet back again.  All of the UDP write methods apply only to <code>net.UDPConn</code>.  <code>net.UDPConn.WriteMsgUDP()</code> tantalisingly talks of whether it is applied to a connected or a non-connected socket, but I can't figure out how to derive <code>net.UDPConn</code> from <code>net.TCPConn</code>; I've tried casting <code>net.TCPConn</code> to <code>net.UDPConn</code> but that causes a panic.</p>\n\n<p>What is the correct way to do this?</p>\n\n<p>FYI, I do have a UDP listener open on the same port ('cos the client at the other end can chose to operate in completely connectionless mode) but since, when the socket is connected, the UDP packet arrives at the TCP server rather than the UDP server, I'd like to send the UDP response back down the same hole, rather than having to mix the two up in some unholy manner.  Or is unholiness the answer?</p>\n\n<p>EDIT: a word on the system design here: the purpose of this UDP packet is to test the connection on this socket (the server simply echoes it back).  The socket is a [hopefully] established SSH port-forwarding tunnel, hence I don't want to use another socket as this wouldn't test what I'm trying to test (i.e. that both the socket and the SSH tunnel are open; it is a shortcoming of SSH port-forwarding tunnels that, since the application makes a connection to <code>localhost</code>, the socket will report connected immediately, even if the server isn't actually connected at the time).  The SSH tunnel otherwise carries a stream of TCP traffic and I specifically want to use UDP for this as I don't want my UDP connection test to be stuck behind the queue of TCP traffic; timing is important in this application and the UDP packet carries timestamps to measure it.  <a href=\"https://linux.die.net/man/2/sendto\" rel=\"nofollow noreferrer\">Sending a UDP packet on a connected socket</a> is a valid sockets operation, Go must have a way to do it...?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1523658780, "post_id": 49825824, "comment_id": 86667640, "body": "This would make the new context only visible to the HandleFunc though? Meaning <code>myContext</code> key is not available for any handler downstream."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "edited": false, "score": 0, "creation_date": 1523661928, "post_id": 49825824, "comment_id": 86668320, "body": "Pass the new request to the downstream handler instead of the original handler.  See edited answer."}, {"owner": {"reputation": 133, "user_id": 2289619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1538dc1d9252a139ffb85868e68de7f4?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/2289619/stefan"}, "edited": false, "score": 0, "creation_date": 1608300844, "post_id": 49825824, "comment_id": 115548500, "body": "But what is the setValue function? I don&#39;t have it available."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 133, "user_id": 2289619, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1538dc1d9252a139ffb85868e68de7f4?s=128&d=identicon&r=PG", "display_name": "Stefan", "link": "https://stackoverflow.com/users/2289619/stefan"}, "edited": false, "score": 0, "creation_date": 1608306868, "post_id": 49825824, "comment_id": 115551313, "body": "@Stefan The <code>setValue</code> function is declared on the first line of code in this answer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 5, "last_activity_date": 1577519069, "last_edit_date": 1577519069, "creation_date": 1523657954, "answer_id": 49825824, "question_id": 49825733, "link": "https://stackoverflow.com/questions/49825733/how-to-set-context-value-inside-http-handlefunc/49825824#49825824", "title": "How to set context value inside http.HandleFunc?", "body": "<p>The code in the question overwrites the request object. This can result in code up the stack using the wrong context value. <code>Request.WithContext</code> creates a shallow copy of the request to avoid this. Return a pointer to that shallow copy.</p>\n\n<pre><code>func setValue(r *http.Request, val string) *http.Request {\n  return r.WithContext(context.WithValue(r.Context(), myContext, val))\n}\n\nhttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    r = setValue(r, \"foobar\")\n})\n</code></pre>\n\n<p>If then handler invokes some other handler, then pass the new request along to the new handler:</p>\n\n<pre><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    r = setValue(r, \"foobar\")\n    someOtherHandler.ServeHTTP(w, r)\n})\n</code></pre>\n"}], "owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1391, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577519069, "creation_date": 1523657254, "last_edit_date": 1529387853, "question_id": 49825733, "link": "https://stackoverflow.com/questions/49825733/how-to-set-context-value-inside-http-handlefunc", "title": "How to set context value inside http.HandleFunc?", "body": "<p>I want to set a context value inside an http.HandleFunc. The following approach seems to work. </p>\n\n<p>I'm a little worried about <code>*r = *r.WithContext(ctx)</code> though.</p>\n\n<pre><code>type contextKey string\nvar myContext = contextKey(\"myContext\")\n\nfunc setValue(r *http.Request, val string)  {\n  ctx := context.WithValue(r.Context(), myContext, val)\n  *r = *r.WithContext(ctx)\n}\n\nhttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    setValue(r, \"foobar\")\n})\n</code></pre>\n\n<p>What's the best approach to set a context variable inside an http.HandleFunc?</p>\n"}, {"tags": ["java", "go", "ecdsa"], "comments": [{"owner": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "edited": false, "score": 2, "creation_date": 1523679703, "post_id": 49825455, "comment_id": 86671155, "body": "Java generates (and expects) ECDSA signatures (like DSA) in an ASN.1 encoding defined in X9.62 and SECG SEC1 but more conveniently in RFC3279 section 2.2.3. If Go wants the components as bignums, you need to parse this ASN.1 not just arbitrarily split the bytes in half. See <a href=\"https://crypto.stackexchange.com/questions/33095/shouldnt-a-signature-using-ecdsa-be-exactly-96-bytes-not-102-or-103\" title=\"shouldnt a signature using ecdsa be exactly 96 bytes not 102 or 103\">crypto.stackexchange.com/questions/33095/&hellip;</a>"}, {"owner": {"reputation": 849, "user_id": 1187237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7777f63763f53aa6b66ea8686de34494?s=128&d=identicon&r=PG", "display_name": "kg_sYy", "link": "https://stackoverflow.com/users/1187237/kg-syy"}, "reply_to_user": {"reputation": 23625, "user_id": 2868801, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ec5567811049b7ce8192be0bc0246d1?s=128&d=identicon&r=PG&f=1", "display_name": "dave_thompson_085", "link": "https://stackoverflow.com/users/2868801/dave-thompson-085"}, "edited": false, "score": 0, "creation_date": 1523710161, "post_id": 49825455, "comment_id": 86678427, "body": "Thanks @dave_thompson_085, I managed to lead my search from ASN.1 to a working solution.."}], "answers": [{"tags": [], "owner": {"reputation": 849, "user_id": 1187237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7777f63763f53aa6b66ea8686de34494?s=128&d=identicon&r=PG", "display_name": "kg_sYy", "link": "https://stackoverflow.com/users/1187237/kg-syy"}, "is_accepted": false, "score": 3, "last_activity_date": 1523710033, "creation_date": 1523710033, "answer_id": 49831609, "question_id": 49825455, "link": "https://stackoverflow.com/questions/49825455/ecdsa-signature-java-vs-go/49831609#49831609", "title": "ECDSA signature Java vs Go", "body": "<p>Managed to get this to work. So just to document it for myself and anyone interested..</p>\n\n<p>As pointed by in comments, the signature from Java is in ASN1 format. Found a nice description of the format here: <a href=\"https://crypto.stackexchange.com/questions/1795/how-can-i-convert-a-der-ecdsa-signature-to-asn-1\">https://crypto.stackexchange.com/questions/1795/how-can-i-convert-a-der-ecdsa-signature-to-asn-1</a>.</p>\n\n<p>I also found some good examples on how to do SHAxx with ECDSA in Go at <a href=\"https://github.com/gtank/cryptopasta\" rel=\"nofollow noreferrer\">https://github.com/gtank/cryptopasta</a> (sign.go and sign_test.go). Just need to run the relevant SHA function before the ECDSA code.</p>\n\n<p>Found example code for building the public keys from parameters in Go at <a href=\"http://codrspace.com/supcik/golang-jwt-ecdsa/\" rel=\"nofollow noreferrer\">http://codrspace.com/supcik/golang-jwt-ecdsa/</a>.</p>\n\n<p>I paste the relevant code below, if someone finds an issue, please let me know..</p>\n\n<p>Relevant Java code:</p>\n\n<pre><code>public static PublicKey bytesToPublicKey(byte[] x509key) throws GeneralSecurityException {\n    X509EncodedKeySpec spec = new X509EncodedKeySpec(x509key);\n    KeyFactory factory = KeyFactory.getInstance(\"EC\");\n    ECPublicKey publicKey = (ECPublicKey) factory.generatePublic(spec);\n    //We should be able to use these X and Y in Go to build the public key\n    BigInteger x = publicKey.getW().getAffineX();\n    BigInteger y = publicKey.getW().getAffineY();\n    System.out.println(publicKey.toString());\n    return publicKey;\n}\n\n//we can either use the Java standard signature ANS1 format output, or just take the R and S parameters from it, and pass those to Go\n//https://stackoverflow.com/questions/48783809/ecdsa-sign-with-bouncycastle-and-verify-with-crypto\npublic static BigInteger extractR(byte[] signature) throws Exception {\n    int startR = (signature[1] &amp; 0x80) != 0 ? 3 : 2;\n    int lengthR = signature[startR + 1];\n    return new BigInteger(Arrays.copyOfRange(signature, startR + 2, startR + 2 + lengthR));\n}\n\npublic static BigInteger extractS(byte[] signature) throws Exception {\n    int startR = (signature[1] &amp; 0x80) != 0 ? 3 : 2;\n    int lengthR = signature[startR + 1];\n    int startS = startR + 2 + lengthR;\n    int lengthS = signature[startS + 1];\n    return new BigInteger(Arrays.copyOfRange(signature, startS + 2, startS + 2 + lengthS));\n}\n\npublic static byte[] signMsg(String msg, PrivateKey priv) throws Exception {\n    Signature ecdsa = Signature.getInstance(\"SHA1withECDSA\");\n\n    ecdsa.initSign(priv);\n\n    byte[] strByte = msg.getBytes(\"UTF-8\");\n    ecdsa.update(strByte);\n\n    byte[] realSig = ecdsa.sign();\n\n    //this is the R and S we could also pass as the signature\n    System.out.println(\"R: \"+extractR(realSig));\n    System.out.println(\"S: \"+extractS(realSig));\n\n    return realSig;\n}\n</code></pre>\n\n<p>Relevant Go code:</p>\n\n<pre><code>func verifyMySig(pub *ecdsa.PublicKey, msg string, sig []byte) bool {\n    //https://github.com/gtank/cryptopasta\n    digest := sha1.Sum([]byte(msg))\n\n    var esig ecdsaSignature\n    asn1.Unmarshal(sig, &amp;esig)\n    //above is ASN1 decoding from the Java format. Alternatively, we can just transfer R and S parameters and set those\n    //  esig.R.SetString(\"89498588918986623250776516710529930937349633484023489594523498325650057801271\", 0)\n    //  esig.S.SetString(\"67852785826834317523806560409094108489491289922250506276160316152060290646810\", 0)\n    fmt.Printf(\"R: %d , S: %d\", esig.R, esig.S)\n    println()\n    return ecdsa.Verify(pub, digest[:], esig.R, esig.S)\n}\n\nfunc hexToPrivateKey(hexStr string)  *ecdsa.PrivateKey {\n    bytes, err := hex.DecodeString(hexStr)\n    print(err)\n\n    k := new(big.Int)\n    k.SetBytes(bytes)\n    println(\"k:\")\n    fmt.Println(k.String())\n\n    priv := new(ecdsa.PrivateKey)\n    curve := elliptic.P256()\n    priv.PublicKey.Curve = curve\n    priv.D = k\n    priv.PublicKey.X, priv.PublicKey.Y = curve.ScalarBaseMult(k.Bytes())\n    //we can check these against the Java implementation to see if it matches to know key was transferred OK\n    fmt.Printf(\"X: %d, Y: %d\", priv.PublicKey.X, priv.PublicKey.Y)\n    println()\n\n    return priv\n}\n</code></pre>\n"}], "owner": {"reputation": 849, "user_id": 1187237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7777f63763f53aa6b66ea8686de34494?s=128&d=identicon&r=PG", "display_name": "kg_sYy", "link": "https://stackoverflow.com/users/1187237/kg-syy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1459, "favorite_count": 3, "answer_count": 1, "score": 3, "last_activity_date": 1523710033, "creation_date": 1523655430, "question_id": 49825455, "link": "https://stackoverflow.com/questions/49825455/ecdsa-signature-java-vs-go", "title": "ECDSA signature Java vs Go", "body": "<p>I am trying to learn some Go and blockchains.. Starting with ECDSA signatures. Trying to figure out how to test if I had a correctly working Go implementation of ECDSA signatures, I figured I would try to create a similar version in Java and compare the results to see if I can get them to match.</p>\n\n<p>So Java attempt:</p>\n\n<pre><code>public static void main(String[] args) throws Exception {\n    //the keys below are previously generated with \"generateKey();\" and base64 encoded\n    generateKey();\n    String privStr = \"MEECAQAwEwYHKoZIzj0CAQYIKoZIzj0DAQcEJzAlAgEBBCAQ7bMVIcWr9NpSD3hPkns5C0qET87UvyY5WI6UML2p0Q==\";\n    String pubStr = \"MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAES8VdACZT/9u1NmaiQk0KIjEXxiaxms74nu/ps6bP0OvYMIlTdIWWU2s35LEKsNJH9u5QM2ocX53BPjwbsENXJw==\";\n    PrivateKey privateKey = base64ToPrivateKey(privStr);\n    PublicKey publicKey = base64ToPublicKey(pubStr);\n    String str = \"This is string to sign\";\n    byte[] signature = signMsg(str, privateKey);\n    boolean ok = verifySignature(publicKey, str, signature);\n    System.out.println(\"signature ok:\" + ok);\n    String privHex = getPrivateKeyAsHex(privateKey);\n}\n\npublic static byte[] signMsg(String msg, PrivateKey priv) throws Exception {\n    Signature ecdsa = Signature.getInstance(\"SHA1withECDSA\");\n\n    ecdsa.initSign(priv);\n\n    byte[] strByte = msg.getBytes(\"UTF-8\");\n    ecdsa.update(strByte);\n\n    byte[] realSig = ecdsa.sign();\n    //the printed signature from here is what is used in the Go version (hex string)\n    System.out.println(\"Signature: \" + new BigInteger(1, realSig).toString(16));\n    return realSig;\n}\n\n//https://stackoverflow.com/questions/30175149/error-when-verifying-ecdsa-signature-in-java-with-bouncycastle\n\nprivate static boolean verifySignature(PublicKey pubKey, String msg, byte[] signature) throws Exception {\n    byte[] message = msg.getBytes(\"UTF-8\");\n    Signature ecdsa = Signature.getInstance(\"SHA1withECDSA\");\n    ecdsa.initVerify(pubKey);\n    ecdsa.update(message);\n    return ecdsa.verify(signature);\n}\n\npublic static String generateKey() throws Exception {\n    KeyPairGenerator keyGen = KeyPairGenerator.getInstance(\"EC\");\n    SecureRandom random = SecureRandom.getInstance(\"SHA1PRNG\");\n\n    keyGen.initialize(256, random); //256 bit key size\n\n    KeyPair pair = keyGen.generateKeyPair();\n    PrivateKey priv = pair.getPrivate();\n    ECPrivateKey ePriv = (ECPrivateKey) priv;\n    PublicKey pub = pair.getPublic();\n\n    //https://stackoverflow.com/questions/5355466/converting-secret-key-into-a-string-and-vice-versa\n    String encodedPrivateKey = Base64.getEncoder().encodeToString(priv.getEncoded());\n    byte[] pubEncoded = pub.getEncoded();\n    String encodedPublicKey = Base64.getEncoder().encodeToString(pubEncoded);\n    System.out.println(encodedPrivateKey);\n    System.out.println(encodedPublicKey);\n    return encodedPrivateKey;\n}\n\npublic static PrivateKey base64ToPrivateKey(String encodedKey) throws Exception {\n    byte[] decodedKey = Base64.getDecoder().decode(encodedKey);\n    return bytesToPrivateKey(decodedKey);\n}\n\npublic static PrivateKey bytesToPrivateKey(byte[] pkcs8key) throws GeneralSecurityException {\n    PKCS8EncodedKeySpec spec = new PKCS8EncodedKeySpec(pkcs8key);\n    KeyFactory factory = KeyFactory.getInstance(\"EC\");\n    PrivateKey privateKey = factory.generatePrivate(spec);\n    return privateKey;\n}\n\npublic static PublicKey base64ToPublicKey(String encodedKey) throws Exception {\n    byte[] decodedKey = Base64.getDecoder().decode(encodedKey);\n    return bytesToPublicKey(decodedKey);\n}\n\npublic static PublicKey bytesToPublicKey(byte[] x509key) throws GeneralSecurityException {\n    X509EncodedKeySpec spec = new X509EncodedKeySpec(x509key);\n    KeyFactory factory = KeyFactory.getInstance(\"EC\");\n    PublicKey publicKey = factory.generatePublic(spec);\n    return publicKey;\n}\n\n//https://stackoverflow.com/questions/40552688/generating-a-ecdsa-private-key-in-bouncy-castle-returns-a-public-key\nprivate static String getPrivateKeyAsHex(PrivateKey privateKey) {\n    ECPrivateKey ecPrivateKey = (ECPrivateKey) privateKey;\n    byte[] privateKeyBytes = ecPrivateKey.getS().toByteArray();\n    System.out.println(\"S:\"+ecPrivateKey.getS());\n\n    String hex = bytesToHex(privateKeyBytes);\n\n    System.out.println(\"Private key bytes: \" + Arrays.toString(privateKeyBytes));\n    System.out.println(\"Private key hex: \" + hex);\n\n    return hex;\n}\n\nprivate final static char[] hexArray = \"0123456789ABCDEF\".toCharArray();\n\npublic static String bytesToHex(byte[] bytes) {\n    char[] hexChars = new char[bytes.length * 2];\n    for (int j = 0 ; j &lt; bytes.length ; j++) {\n        int v = bytes[j] &amp; 0xFF;\n        hexChars[j * 2] = hexArray[v &gt;&gt;&gt; 4];\n        hexChars[j * 2 + 1] = hexArray[v &amp; 0x0F];\n    }\n    return new String(hexChars);\n}\n</code></pre>\n\n<p>Doing the signing and verification in Java works just fine. Easy to configure of course, since they are all the same libs, parameters, and all.</p>\n\n<p>To verify the same signature in Go, I tried:</p>\n\n<pre><code>func TestSigning(t *testing.T) {\n    privKey := hexToPrivateKey(\"10EDB31521C5ABF4DA520F784F927B390B4A844FCED4BF2639588E9430BDA9D1\")\n    pubKey := privKey.Public()\n    sig := \"3045022071f06054f450f808aa53294d34f76afd288a23749628cc58add828e8b8f2b742022100f82dcb51cc63b29f4f8b0b838c6546be228ba11a7c23dc102c6d9dcba11a8ff2\"\n    sigHex, _ := hex.DecodeString(sig)\n    ePubKey := pubKey.(*ecdsa.PublicKey)\n    ok := verifyMySig(ePubKey, \"This is string to sign\", sigHex)\n    println(ok)\n}\n\nfunc verifyMySig(pub *ecdsa.PublicKey, msg string, sig []byte) bool {\n    r := new(big.Int).SetBytes(sig[:len(sig)/2])\n    s := new(big.Int).SetBytes(sig[len(sig)/2:])\n    return ecdsa.Verify(pub, []byte(msg), r, s)\n}\n\nfunc hexToPrivateKey(hexStr string)  *ecdsa.PrivateKey {\n    bytes, _ := hex.DecodeString(hexStr)\n\n    k := new(big.Int)\n    k.SetBytes(bytes)\n    println(\"k:\")\n    fmt.Println(k.String())\n\n    priv := new(ecdsa.PrivateKey)\n    curve := elliptic.P256()\n    priv.PublicKey.Curve = curve\n    priv.D = k\n    priv.PublicKey.X, priv.PublicKey.Y = curve.ScalarBaseMult(k.Bytes())\n\n    return priv\n}\n</code></pre>\n\n<p>Initially, I tried to just export the Private key in Java as a base64 encoded string, and import that into Go. But I could not figure out how to get Go to load the key in the format Java stores if (X509EncodedKeySpec). So instead, I tried this way to copy the big integer of the private key only, and generate the public key from that. If I get that to work, then try to copy just the public key..</p>\n\n<p>Anyway, the Go code fails to verify the signature. It is always false. Also, I cannot figure out where to put the SHA function in Go from \"SHA1withECDSA\" part.</p>\n\n<p>I am sure I am missing some basic concepts here. How to do this properly?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1523645986, "post_id": 49823379, "comment_id": 86662816, "body": "The braces <code>{}</code> in <code>Foo{}</code> you intend to be part of the struct literal cause a parsing ambiguity, as the compiler can&#39;t tell if they&#39;re part of the struct literal or they form the body of the <code>if</code> statement. You have to parenthesize it: <code>if fooNum, err := (Foo{}).One(); err == nil { ... }</code>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523646359, "post_id": 49823379, "comment_id": 86663003, "body": "You may want to simplify your syntax a bit: <a href=\"https://play.golang.org/p/ZXn7YMjr1bu\" rel=\"nofollow noreferrer\">play.golang.org/p/ZXn7YMjr1bu</a>. Alternatively, if you&#39;re not causing import cycles, just make a package called foo."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1523649069, "post_id": 49823379, "comment_id": 86664288, "body": "As a sidenote: If you do not need the struct, you could define the <code>func</code> on package level. If you had the package <code>foo</code>, then the call would be <code>foo.One()</code> and <code>foo.Two()</code>."}], "owner": {"reputation": 461, "user_id": 7359470, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d7fb653bc3eb067f9dd9b2019e653bd?s=128&d=identicon&r=PG&f=1", "display_name": "mofury", "link": "https://stackoverflow.com/users/7359470/mofury"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "closed_date": 1523645946, "answer_count": 0, "score": 2, "last_activity_date": 1523645059, "creation_date": 1523645059, "question_id": 49823379, "link": "https://stackoverflow.com/questions/49823379/why-is-my-initialization-statement-in-if-syntactically-incorrect", "closed_reason": "Duplicate", "title": "Why is my initialization statement in `if` syntactically incorrect?", "body": "<p>Please excuse me for not knowing the proper name for the following syntax </p>\n\n<pre><code>type Foo struct{}\nfunc (Foo) One() (int, error) {\n     // Logic...\n}\n\nfunc (Foo) Two() (int, error) {\n    // Logic\n}\n</code></pre>\n\n<p>I am using the empty struct <code>Foo</code> as a way to group some of the similar functions. So when I call the function <code>One</code>, I will use the following syntax:</p>\n\n<pre><code>fooNum, err := Foo{}.One()\n</code></pre>\n\n<p>It works perfectly fine until I try to do the following:</p>\n\n<pre><code>if fooNum, err := Foo{}.One(); err == nil {\n    // Logic...\n}\n</code></pre>\n\n<p>I get <code>syntax error: unexpected newline, expecting comma or }</code>. I wonder why is this the case? Is there a bigger reason behind this error? Am I doing something that is discouraged by general Go style?</p>\n"}, {"tags": ["go", "dependencies", "protocol-buffers", "dependency-management", "grpc"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523644376, "post_id": 49823114, "comment_id": 86662016, "body": "The problem here is that you have two copies of the github.com/golang/protobuf/ptypes package. Don&#39;t do that. And it&#39;s not malpractice to export your own types. Virtually <i>every</i> package does that and it is what makes them useful. You could have also said it&#39;s wrong that the time package exports Time, and should instead only accept and return ints."}, {"owner": {"reputation": 1525, "user_id": 181218, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d51a82e095a90c92dee70dc85ea0340?s=128&d=identicon&r=PG", "display_name": "user181218", "link": "https://stackoverflow.com/users/181218/user181218"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523645243, "post_id": 49823114, "comment_id": 86662449, "body": "Hey Peter, I am not sure I understand the answer. I am aware that there are two copies and that creates the issue - it is the way around it that I don&#39;t understand: The generated code exposes Timestamp and I need to populate it. How do I write code to do that without another copy of the dependency being created and causing the confusion between my library&#39;s copy and the one the auto-generated code depends on?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523645728, "post_id": 49823114, "comment_id": 86662684, "body": "It&#39;s hard to tell. It looks like you may have nested vendor directories. Add your directory layout to the question, starting at GOPATH and including all subdirectories that lead to those called ptypes."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523646738, "post_id": 49823114, "comment_id": 86663192, "body": "Move the vendor directory to the project root. Otherwise go-statuses sees a different ptypes package than my_package."}, {"owner": {"reputation": 1525, "user_id": 181218, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d51a82e095a90c92dee70dc85ea0340?s=128&d=identicon&r=PG", "display_name": "user181218", "link": "https://stackoverflow.com/users/181218/user181218"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523646846, "post_id": 49823114, "comment_id": 86663250, "body": "Let me try that."}, {"owner": {"reputation": 1525, "user_id": 181218, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d51a82e095a90c92dee70dc85ea0340?s=128&d=identicon&r=PG", "display_name": "user181218", "link": "https://stackoverflow.com/users/181218/user181218"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523647204, "post_id": 49823114, "comment_id": 86663432, "body": "Peter this seems to have done the trick!"}], "owner": {"reputation": 1525, "user_id": 181218, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d51a82e095a90c92dee70dc85ea0340?s=128&d=identicon&r=PG", "display_name": "user181218", "link": "https://stackoverflow.com/users/181218/user181218"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 521, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523648058, "creation_date": 1523643917, "last_edit_date": 1523648058, "question_id": 49823114, "link": "https://stackoverflow.com/questions/49823114/google-protobuf-dependency-collision", "title": "Google Protobuf dependency collision", "body": "<p>I am working on a Golang library that leverages Google <a href=\"https://github.com/golang/protobuf\" rel=\"nofollow noreferrer\">Protobuf</a>. It does so by using code auto-generated by protoc-gen-go, the compiler plugin. I am using <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">Dep</a> for dependency management. \nThe generated code exports the <code>InstanceStatusUpdate</code> struct, for which the field <code>Timestamp</code> is of the type <code>github.com/golang/protobuf/ptypes/timestamp.Timestamp</code>:</p>\n\n<pre><code>type InstanceStatusUpdate struct {\n    EvaluationId  string\n    VariationId   string\n    AttemptNumber int32\n    Timestamp     *google_protobuf.Timestamp\n    Stage         string\n    Metadata      string\n    JobId         string\n}\n</code></pre>\n\n<p>The problem I have is that writing library code to populate the Timestamp field triggers a redundant auto-importing of <code>\"github.com/golang/protobuf/ptypes\"</code>, since that is where the type that needs to be assigned to Timestamp lives. This redundancy causes this error:</p>\n\n<blockquote>\n  <p>cannot use timestamp (type\n  *\"my_path/vendor/github.com/golang/protobuf/ptypes/timestamp\".Timestamp)\n  as type *\"github.com/golang/protobuf/ptypes/timestamp\".Timestamp in\n  field value</p>\n</blockquote>\n\n<p>Any ideas? </p>\n\n<p>library structure (only one vendor folder):</p>\n\n<pre><code>code_root\n|\n -lib\n|  |\n|   -go-statuses\n -my_package /*Contains code that refers to the auto-generated code in \n   |          go-statuses*/\n   |\n    -vendor\n</code></pre>\n"}, {"tags": ["go", "hyperledger-fabric", "hyperledger"], "comments": [{"owner": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1523702351, "post_id": 49822717, "comment_id": 86676132, "body": "You&#39;ll need to make sure you vendor the proper version of Fabric here.  Which Fabric packages are you vendoring and which tool (e.g. govendor) are you using?"}, {"owner": {"reputation": 51, "user_id": 2773151, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006042280800/picture?type=large", "display_name": "Jo&#227;o Antunes", "link": "https://stackoverflow.com/users/2773151/jo%c3%a3o-antunes"}, "reply_to_user": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1523834911, "post_id": 49822717, "comment_id": 86710412, "body": "I&#39;m using govendor from github.com/kardianos/govendor I&#39;ve also passed the project to an inside folder of hyperledger fabric, and just do the usual commands for the govendor."}, {"owner": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1523863725, "post_id": 49822717, "comment_id": 86717973, "body": "2 solutions: 1) Move to Fabric v1.1 which was just recently released 2) I was unable to get govendor to work properly in terms of pulling down the right version of Fabric.  So you could do a &quot;go get&quot; for &quot;github.com/hyperledger/fabric&quot;, then &quot;cd $GOPATH/src/github.com/hyperleger/fabric&quot;, then &quot;git checkout v1.0.3&quot; and then go back to your chaincode project and do &quot;govendor add ...&quot; for whichever Fabric packages you need."}, {"owner": {"reputation": 51, "user_id": 2773151, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006042280800/picture?type=large", "display_name": "Jo&#227;o Antunes", "link": "https://stackoverflow.com/users/2773151/jo%c3%a3o-antunes"}, "reply_to_user": {"reputation": 7694, "user_id": 5529712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7uvxg.png?s=128&g=1", "display_name": "Gari Singh", "link": "https://stackoverflow.com/users/5529712/gari-singh"}, "edited": false, "score": 0, "creation_date": 1523976849, "post_id": 49822717, "comment_id": 86778492, "body": "Thank you Gari Singh. that was the solution."}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 2773151, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006042280800/picture?type=large", "display_name": "Jo&#227;o Antunes", "link": "https://stackoverflow.com/users/2773151/jo%c3%a3o-antunes"}, "is_accepted": true, "score": 1, "last_activity_date": 1523976899, "creation_date": 1523976899, "answer_id": 49881374, "question_id": 49822717, "link": "https://stackoverflow.com/questions/49822717/hyperledger-chaincode-lib-not-found/49881374#49881374", "title": "hyperledger chaincode lib not found", "body": "<p>This answer was provided by Gari Singh, on a comment above:</p>\n\n<p>2 solutions: 1) Move to Fabric v1.1 which was just recently released 2) I was unable to get govendor to work properly in terms of pulling down the right version of Fabric. So you could do a \"go get\" for \"github.com/hyperledger/fabric\", then \"cd $GOPATH/src/github.com/hyperleger/fabric\", then \"git checkout v1.0.3\" and then go back to your chaincode project and do \"govendor add ...\" for whichever Fabric packages you need. \n\u2013 Gari Singh</p>\n"}], "owner": {"reputation": 51, "user_id": 2773151, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006042280800/picture?type=large", "display_name": "Jo&#227;o Antunes", "link": "https://stackoverflow.com/users/2773151/jo%c3%a3o-antunes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 49881374, "answer_count": 1, "score": 1, "last_activity_date": 1523976899, "creation_date": 1523642256, "question_id": 49822717, "link": "https://stackoverflow.com/questions/49822717/hyperledger-chaincode-lib-not-found", "title": "hyperledger chaincode lib not found", "body": "<p>Hi to all who can help.</p>\n\n<p>Currently developing a chaincode for fabric version 1.0.\nThe problem is, even after vendoring, when I do the deployment, I get this error.</p>\n\n<pre><code>[DEBUG] instantiate-chaincode - \n============ Instantiate chaincode on organization XYZ ============\n\nerror: [client-utils.js]: sendPeersProposal - Promise is rejected: Error: Error starting container: Failed to generate platform-specific docker build: Error returned from build: 1 \"chaincode/input/src/XYZ/vendor/github.com/hyperledger/fabric/bccsp/factory/pluginfactory.go:12:2: cannot find package \"plugin\" in any of:\n        /chaincode/input/src/XYZ/vendor/plugin (vendor tree)\n        /opt/go/src/plugin (from $GOROOT)\n        /chaincode/input/src/plugin (from $GOPATH)\n        /opt/gopath/src/plugin\n\"\n    at /usr/src/app/node_modules/grpc/src/node/src/client.js:434:17\nerror: [client-utils.js]: sendPeersProposal - Promise is rejected: Error: Error starting container: Failed to generate platform-specific docker build: Error returned from build: 1 \"chaincode/input/src/XYZ/vendor/github.com/hyperledger/fabric/bccsp/factory/pluginfactory.go:12:2: cannot find package \"plugin\" in any of:\n        /chaincode/input/src/XYZ/vendor/plugin (vendor tree)\n        /opt/go/src/plugin (from $GOROOT)\n        /chaincode/input/src/plugin (from $GOPATH)\n        /opt/gopath/src/plugin\n\"\n</code></pre>\n\n<p>The fabric images that I'm using are:</p>\n\n<ul>\n<li>hyperledger/fabric-peer:x86_64-1.0.3</li>\n<li>hyperledger/fabric-ca:x86_64-1.0.3 </li>\n<li>hyperledger/fabric-tools:x86_64-1.0.3</li>\n<li>hyperledger/fabric-couchdb:x86_64-0.4.6</li>\n<li>hyperledger/fabric-orderer:x86_64-1.0.3</li>\n</ul>\n"}, {"tags": ["json", "function", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523635136, "post_id": 49820883, "comment_id": 86657094, "body": "<a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Take the Go Tour</a>. And also this <code>return resp, http.Get(path)</code> is never gonna compile."}], "answers": [{"comments": [{"owner": {"reputation": 5298, "user_id": 3405291, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6499e84a22df10a3f4fec15a8bd0d06?s=128&d=identicon&r=PG&f=1", "display_name": "user3405291", "link": "https://stackoverflow.com/users/3405291/user3405291"}, "edited": false, "score": 0, "creation_date": 1523662494, "post_id": 49820965, "comment_id": 86668415, "body": "Shouldn&#39;t it be <code>test.Name</code> rather than <code>test.name</code>? I mean, the struct <code>Info</code> has a <code>Name</code> field not <code>name</code> field."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 0, "last_activity_date": 1523690611, "last_edit_date": 1523690611, "creation_date": 1523634946, "answer_id": 49820965, "question_id": 49820883, "link": "https://stackoverflow.com/questions/49820883/cannot-get-1-object-from-json-response/49820965#49820965", "title": "Cannot get 1 object from Json response", "body": "<p>Use <code>.</code> parameter to get name from resp like</p>\n\n<pre><code>func main() {\n    test, err := Base.GetInfo()\n    fmt.Println(test.Name, err)\n}\n</code></pre>\n\n<p>But if there are multiple fields. Then you should save them in array of struct <code>Info</code> as:</p>\n\n<pre><code>func (b *Base) GetInfo() ([]Info, error) {\n    var resp []Info\n    path := \"example.com\"\n    return resp, http.Get(path)\n}\n\nfunc main() {\n    test, err := Base.GetInfo()\n    fmt.Println(test[0].Name, err)\n}\n</code></pre>\n"}], "owner": {"reputation": 549, "user_id": 5625598, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3b6ac4348e916b2fc4b3da0f9aa3c01d?s=128&d=identicon&r=PG&f=1", "display_name": "frostrock", "link": "https://stackoverflow.com/users/5625598/frostrock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "closed_date": 1523635901, "accepted_answer_id": 49820965, "answer_count": 1, "score": 0, "last_activity_date": 1523690611, "creation_date": 1523634678, "last_edit_date": 1523642648, "question_id": 49820883, "link": "https://stackoverflow.com/questions/49820883/cannot-get-1-object-from-json-response", "closed_reason": "Duplicate", "title": "Cannot get 1 object from Json response", "body": "<p>I am a beginner to Golang. Can you help me with call of function.\nHere is an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\ntype Info struct {\n    Name string  `json:\"name\"`\n    Year float64 `json:\"year,string\"`\n}\n\nfunc (b *Base) GetInfo() (Info, error) {\n    var resp Info\n    path := \"example.com\"\n\n    return resp, http.Get(path)\n}\n\nfunc main() {\n    test, err := Base.GetInfo()\n    fmt.Println(test, err)\n\n}\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>{Name Bob Year 10}\n</code></pre>\n\n<p>How I can get only <code>\"Bob\"</code> ?</p>\n\n<p>And If my response contains more objects example</p>\n\n<pre><code>{Name Bob Year 10}{Name Jane Year 2}.\n</code></pre>\n\n<p>How I can get only names? Didnt understand how to decode it or call.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523634658, "post_id": 49820863, "comment_id": 86656775, "body": "Please clear what you actually trying to accomplish."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1523634780, "post_id": 49820863, "comment_id": 86656851, "body": "Use <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">text/template</a> to write Go code. Use <a href=\"https://golang.org/pkg/go/printer/\" rel=\"nofollow noreferrer\">go/printer</a> to format it."}, {"owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523635124, "post_id": 49820863, "comment_id": 86657087, "body": "@Peter Could you please explain me with details or an example"}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1523636335, "creation_date": 1523636335, "answer_id": 49821332, "question_id": 49820863, "link": "https://stackoverflow.com/questions/49820863/how-to-create-a-struct-and-its-attributes-dynamically-using-go-code/49821332#49821332", "title": "How to create a struct and its attributes dynamically using go code?", "body": "<p>Use <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">text/template</a> to write Go code. Since I don't know how you want to do this in detail, I'll use a trivial template in the example. Any kind of real world template is bound produce ill-formated code, but thanks to go fmt you pretty much only have to get the newlines right (leverage semicolons if you ever have trouble with that). go fmt uses <a href=\"https://golang.org/pkg/go/printer/\" rel=\"nofollow noreferrer\">go/printer</a> under the hood, and you can too.</p>\n\n<p>See the linked package documentation and examples for details.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"go/parser\"\n    \"go/printer\"\n    \"go/token\"\n    \"html/template\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nvar structTpl = `\n    package main\n\n    type {{ . }} struct {\n            Name string\n    }\n    `\n\nfunc main() {\n    // Only do this once per template at the start of your program.\n    // Then simply call Execute as necessary.\n    tpl := template.Must(template.New(\"foo\").Parse(structTpl))\n\n    messy := &amp;bytes.Buffer{}\n    tpl.Execute(messy, \"User\")\n\n    // Parse the code\n    fset := &amp;token.FileSet{}\n    ast, err := parser.ParseFile(fset, \"\", messy, parser.ParseComments|parser.DeclarationErrors)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Print the code, neatly formatted.\n    neat := &amp;bytes.Buffer{}\n    err = printer.Fprint(neat, fset, ast)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    io.Copy(os.Stdout, neat) // Or write to file as desired.\n}\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/YhPAeos4-ek\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YhPAeos4-ek</a></p>\n"}, {"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1523678191, "last_edit_date": 1523678191, "creation_date": 1523647487, "answer_id": 49823852, "question_id": 49820863, "link": "https://stackoverflow.com/questions/49820863/how-to-create-a-struct-and-its-attributes-dynamically-using-go-code/49823852#49823852", "title": "How to create a struct and its attributes dynamically using go code?", "body": "<p>If you are looking for ast based meta info about struct, receivers, etc  you may consider the following:</p>\n\n<pre><code>package main\nimport  \"github.com/viant/toolbox\"\n\nfunc main() {\n\n    goCodeLocation := \"..\"\n    fileSetInfo, err := toolbox.NewFileSetInfo(goCodeLocation)\n    if err != nil {\n        panic(err)\n    }\n    toolbox.Dump(fileSetInfo)\n}\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 9487414, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RPNNiWhePUU/AAAAAAAAAAI/AAAAAAAAAHY/x9ECES-Kbi8/photo.jpg?sz=128", "display_name": "Nagaraja SV", "link": "https://stackoverflow.com/users/9487414/nagaraja-sv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 2, "answer_count": 2, "score": 0, "last_activity_date": 1523678191, "creation_date": 1523634605, "last_edit_date": 1523634845, "question_id": 49820863, "link": "https://stackoverflow.com/questions/49820863/how-to-create-a-struct-and-its-attributes-dynamically-using-go-code", "title": "How to create a struct and its attributes dynamically using go code?", "body": "<p>I am new to golang \nHow to create a struct and attributes dynamically from gocode,\nit has to store it as a file in the end.</p>\n\n<p><strong>For example:</strong></p>\n\n<p>Struct name: <code>user</code> \nBy default, it has to create <code>Name</code> attribute </p>\n\n<pre><code>type User struct {\n    Name string\n}\n</code></pre>\n\n<p>it has to store as a file <code>ex: user_struct.go</code> </p>\n\n<p>Could you please someone help to find a way to do it </p>\n"}, {"tags": ["debugging", "go", "debug-symbols", "delve", "goland"], "comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 2, "creation_date": 1523635192, "post_id": 49820229, "comment_id": 86657128, "body": "From what I understand in <a href=\"https://stackoverflow.com/questions/49805029/golang-debugger-stops-on-empty-lines-why/\" title=\"golang debugger stops on empty lines why\">stackoverflow.com/questions/49805029/&hellip;</a> you are using Go 1.10+. When doing so, please use ` -gcflags=&quot;all=-N -l&quot; ` in order to ensure that all debugged packages are properly compiled with the debug symbols on and no optimizations."}, {"owner": {"reputation": 12150, "user_id": 1143724, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/47fa5f1bc077c8158fe5ad1287105381?s=128&d=identicon&r=PG", "display_name": "MrDuk", "link": "https://stackoverflow.com/users/1143724/mrduk"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1524492996, "post_id": 49820229, "comment_id": 86983024, "body": "Thanks @dlsniper - I never came back to say this worked for me; it worked for me."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1524504569, "post_id": 49820229, "comment_id": 86989858, "body": "Happy to hear this works now. I&#39;ll add this as a proper response so it can be closed as answered."}], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 8, "last_activity_date": 1524504665, "creation_date": 1524504665, "answer_id": 49986827, "question_id": 49820229, "link": "https://stackoverflow.com/questions/49820229/why-doesnt-my-go-debugger-load-all-symbols-causing-local-variables-to-be-missi/49986827#49986827", "title": "Why doesn&#39;t my Go debugger load all symbols, causing local variables to be missing from the debugger?", "body": "<p>When using Go 1.10 or newer, in order to have a better debugging experience and remove the optimizations the compiler does, you need to build the target application using <code>-gcflags=\"all=-N -l\"</code>.</p>\n\n<p>Before Go 1.10, you need to use <code>-gcflags=\"-N -l\"</code>.</p>\n\n<p>The IDE adds these flags automatically when compiling an application for debugging.</p>\n"}], "owner": {"reputation": 12150, "user_id": 1143724, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/47fa5f1bc077c8158fe5ad1287105381?s=128&d=identicon&r=PG", "display_name": "MrDuk", "link": "https://stackoverflow.com/users/1143724/mrduk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1467, "favorite_count": 1, "accepted_answer_id": 49986827, "answer_count": 1, "score": 7, "last_activity_date": 1524504665, "creation_date": 1523632484, "question_id": 49820229, "link": "https://stackoverflow.com/questions/49820229/why-doesnt-my-go-debugger-load-all-symbols-causing-local-variables-to-be-missi", "title": "Why doesn&#39;t my Go debugger load all symbols, causing local variables to be missing from the debugger?", "body": "<p>I've built my binary with: <code>go build -gcflags \"$gc_flags\" -o ./bin/grafana-server ./pkg/cmd/grafana-server</code>, where <code>$gc_flags</code> is <code>'-N -l'</code>.</p>\n\n<p>When I run this file, <code>./bin/grafana-server</code>, and attach to it in my debugger (Goland), not all of my symbols are loaded. Further, some breakpoints display the message:</p>\n\n<blockquote>\n  <p>no code at /Users/.../file.go:186</p>\n</blockquote>\n\n<p>The code I'd like to debug is below:</p>\n\n<p><a href=\"https://i.stack.imgur.com/oEbvD.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/oEbvD.png\" alt=\"enter image description here\"></a></p>\n\n<p>The section I've <em>added</em> to the original project is lines <code>186-199</code>. What you can see is that the execution has made it into the <code>for _, ..</code> loop (line 196), indicating that <code>query</code> has data, and we were able to pull data from the database using that <code>query</code> via <code>repo.Find(query)</code>. However, <code>query</code> is nowhere to be found in my debugger:</p>\n\n<p><a href=\"https://i.stack.imgur.com/q7Qz4.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/q7Qz4.png\" alt=\"enter image description here\"></a></p>\n\n<p>So I'm unsure what's going on at this point. I'm really really new to golang unfortunately; this is making it incredibly difficult for me to make any progress.</p>\n"}, {"tags": ["go", "redis", "ttl"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1523631603, "post_id": 49819777, "comment_id": 86654755, "body": "The behaviour is documented in the package as <a href=\"https://godoc.org/github.com/go-redis/redis#DurationCmd.Result\" rel=\"nofollow noreferrer\">such</a>. If you don&#39;t think it&#39;s ok open an issue on github not a question on SO."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523632422, "post_id": 49819777, "comment_id": 86655303, "body": "Go is statically typed. TTL returns a duration. It can&#39;t sometimes return an integer instead of a duration."}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523632973, "post_id": 49819777, "comment_id": 86655674, "body": "@mkopriva to be precise behavior for negative ttl is not documented at go-redis, unless you treat the source as ultimate documentation ;). Also, it&#39;s perfectly valid to post a question to SO when having doubts, especially that the OP provided valid piece of code. Cheers"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 1, "creation_date": 1523633671, "post_id": 49819777, "comment_id": 86656134, "body": "@WojciechKaczmarek the negative value is documented in the redis documentation, the return type is documented in the go-redis documentation. His problem is that he&#39;s getting back a <code>time.Duration</code> instead of an <code>int</code>. Why the TTL method in the go-redis package returns a time.Duration instead of an int is a question to the developers of that package."}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1523635271, "post_id": 49819777, "comment_id": 86657196, "body": "You pointed to the go-redis doc not the original Redis doc, that&#39;s why I started this conversation in the first place."}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1523635383, "post_id": 49819777, "comment_id": 86657257, "body": "I also don&#39;t quite get the idea that this question would be invalid. It&#39;s perfectly valid and good formulated question when one has doubts about an API."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 1, "creation_date": 1523638223, "post_id": 49819777, "comment_id": 86658855, "body": "@WojciechKaczmarek you don&#39;t have to get the idea, you like the question? Fine by me. I&#39;ve pointed to go-redis docs because his main problem is the type returned by the <code>DurationCmd.Result</code> method. Quoting OP: <code>I think that the GO method TTL should return an integer, instead of a negative duration.</code> you can see their problem is the type of the return value in case it&#39;s negative, so it seems they are fine with a positive duration just not  a negative one, but Go is a statically typed language and you can&#39;t have a single method return two different types based on some arbitrary criteria."}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1523795630, "post_id": 49819777, "comment_id": 86698482, "body": "You pointed to the place with no documentation (just a function/method signature is hardly a documentation) saying the behavior is documented. That looks more like attempt to bash the question, not to help the guy."}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1523795813, "post_id": 49819777, "comment_id": 86698532, "body": "Also, statical typedness is not exactly the point. There are languages statically typed with variant types / ADTs, where function could return different types."}], "answers": [{"comments": [{"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 1, "creation_date": 1523641020, "post_id": 49820207, "comment_id": 86660342, "body": "DurationCmd itself returns (time.Duration, error) upon calling Result. The issue is rather that, if I understand correctly, OP would rather see special cases of negative ttl as errors. I tend to agree this would be more consistent."}], "tags": [], "owner": {"reputation": 31, "user_id": 2186219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ae7741de7238b3446036b6ba197ee1c?s=128&d=identicon&r=PG", "display_name": "tolok", "link": "https://stackoverflow.com/users/2186219/tolok"}, "is_accepted": false, "score": 1, "last_activity_date": 1523632413, "creation_date": 1523632413, "answer_id": 49820207, "question_id": 49819777, "link": "https://stackoverflow.com/questions/49819777/go-redis-ttl-returns-a-negative-duration-when-the-key-does-not-exist/49820207#49820207", "title": "go-redis: TTL returns a negative duration when the key does not exist", "body": "<p>It is more useful to get TTL of the existing key from redis as time.Duration. -1 and -2 are the exceptions, asserted to the primary type. Maybe it could be more convenient if TTL returned (*DurationCmd, error) but I didn't dive deep into go-redis logic. I don't see a problem here. Just consider your always get time.Duration as a result.</p>\n"}, {"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523637774, "post_id": 49820337, "comment_id": 86658593, "body": "The value would be -2e9 though, not -2 (nanosecond)."}], "tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": false, "score": 1, "last_activity_date": 1523640963, "last_edit_date": 1523640963, "creation_date": 1523632849, "answer_id": 49820337, "question_id": 49819777, "link": "https://stackoverflow.com/questions/49819777/go-redis-ttl-returns-a-negative-duration-when-the-key-does-not-exist/49820337#49820337", "title": "go-redis: TTL returns a negative duration when the key does not exist", "body": "<p>In this implementation of Redis client <code>TTL</code> is returning <code>*DurationCmd</code> which itself doesn't interpret <code>-2</code> and <code>-1</code> in any special way, so after calling <code>Result</code> the value is represented as <code>time.Duration</code>.</p>\n\n<p>Then your code is correct; please also note <code>time.Duration</code> is just a wrapped int with a special <code>Stringer</code> implementation, thus you have this misleading <code>-2s</code> output.</p>\n\n<p>It would be more elegant for your code to simply print the duration after checking for special negative cases. <strike>By the way, you don't need to call <code>duration.Seconds()</code></strike> With regard to comparison - you can directly compare <code>time.Duration</code> to raw int, but then the returned value would be in nanoseconds - even more mimsleading (thanks @Peter for pointing that); so, you're doing the right thing with <code>ttl.Seconds()</code>.</p>\n\n<p>Please also note it'd be better to not ignore error where you call <code>Result</code>, so the line would become:</p>\n\n<pre><code>ttl, err := client.TTL(\"MyKey\").Result()\n</code></pre>\n\n<p>If you feel that it would be more valid and elegant to treat <code>-2</code> and <code>-1</code> as special cases requiring dedicated errors, then there's a space to open an issue on GitHub.</p>\n\n<p>Hope this helps,</p>\n"}], "owner": {"reputation": 63, "user_id": 7992250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4865c98587f39c9c41dd9fe1e88c575?s=128&d=identicon&r=PG&f=1", "display_name": "Denis Kertios", "link": "https://stackoverflow.com/users/7992250/denis-kertios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2564, "favorite_count": 2, "answer_count": 2, "score": 0, "last_activity_date": 1523640963, "creation_date": 1523631218, "question_id": 49819777, "link": "https://stackoverflow.com/questions/49819777/go-redis-ttl-returns-a-negative-duration-when-the-key-does-not-exist", "title": "go-redis: TTL returns a negative duration when the key does not exist", "body": "<p>I am using <a href=\"https://github.com/go-redis/redis\" rel=\"nofollow noreferrer\">go-redis</a> to interact with a REDIS server (version 3.2.100).</p>\n\n<p>According to the <a href=\"https://redis.io/commands/ttl\" rel=\"nofollow noreferrer\">Redis documentation</a>, if a key does not exist, then the command TTL should return the value -2.</p>\n\n<p>However, if the key does not exist, the method TTL returns a value which represents some duration (-2s), instead of an integer.</p>\n\n<p>The code below illustrates this behaviour.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/go-redis/redis\"\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Print(\"Create a REDIS client now.\\n\")\n    client := redis.NewClient(&amp;redis.Options{\n        Addr:     \"localhost:6379\",\n        Password: \"\", // no password set\n        DB:       0,  // use default DB\n    })\n\n    ttl, _ := client.TTL(\"MyKey\").Result()\n    fmt.Printf(\"%v\\n\", ttl)\n    if ttl &lt; 0 {\n        if -1 == ttl.Seconds() {\n            fmt.Print(\"The key will not expire.\\n\")\n        } else if -2 == ttl.Seconds() {\n            fmt.Print(\"The key does not exist.\\n\")\n        } else {\n            fmt.Printf(\"Unexpected error %d.\\n\", ttl.Seconds())\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Create a REDIS client now.\n-2s\nThe key does not exist.\n</code></pre>\n\n<p>Is it OK ? I think that the GO method TTL should return an integer, instead of a negative duration.</p>\n"}]