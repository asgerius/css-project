[{"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1519253467, "post_id": 48916854, "comment_id": 84840149, "body": "If you&#39;re only trying to split on exactly on the string &quot;&amp;&amp;&quot;, why do you need a regex? You normally <i>match</i> what you want to split. What is the output you expect?"}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1519253617, "post_id": 48916854, "comment_id": 84840199, "body": "Good question. This is only a small part of the complete regex I am using. I wanted to keep the question focused on just this aspect rather than post a long regex."}], "answers": [{"comments": [{"owner": {"reputation": 4252, "user_id": 3103891, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mZxsu.jpg?s=128&g=1", "display_name": "GalAbra", "link": "https://stackoverflow.com/users/3103891/galabra"}, "edited": false, "score": 0, "creation_date": 1519257372, "post_id": 48916941, "comment_id": 84841416, "body": "That&#39;s brilliant! How did you get the regex to match the text even though everything&#39;s inside a non-capturing group?"}, {"owner": {"reputation": 19159, "user_id": 3600709, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/731c8c4c0029d3414563333de16b8977?s=128&d=identicon&r=PG&f=1", "display_name": "ctwheels", "link": "https://stackoverflow.com/users/3600709/ctwheels"}, "reply_to_user": {"reputation": 4252, "user_id": 3103891, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mZxsu.jpg?s=128&g=1", "display_name": "GalAbra", "link": "https://stackoverflow.com/users/3103891/galabra"}, "edited": false, "score": 1, "creation_date": 1519257555, "post_id": 48916941, "comment_id": 84841470, "body": "@GalAbra a non-capture group doesn&#39;t <i>capture</i> but it will still match :)"}], "tags": [], "owner": {"reputation": 19159, "user_id": 3600709, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/731c8c4c0029d3414563333de16b8977?s=128&d=identicon&r=PG&f=1", "display_name": "ctwheels", "link": "https://stackoverflow.com/users/3600709/ctwheels"}, "is_accepted": true, "score": 5, "last_activity_date": 1519254231, "last_edit_date": 1519254231, "creation_date": 1519253841, "answer_id": 48916941, "question_id": 48916854, "link": "https://stackoverflow.com/questions/48916854/how-do-i-match-any-character-but/48916941#48916941", "title": "How do I match any character but &quot;&amp;&amp;&quot;?", "body": "<p>Normally, you would be able to use <a href=\"https://regex101.com/r/kgVVvB/4\" rel=\"noreferrer\"><code>(?:(?!&amp;&amp;|(?&lt;=&amp;)&amp;).)+</code></a>, but since <a href=\"https://golang.org/pkg/regexp/syntax/\" rel=\"noreferrer\">golang doesn't currently support lookaheads or lookbehinds</a>, you have to hack your way around this using regex. Obviously, using string functions may work for your case, but as you mention in the comments below your question this is part of a larger regex, so here it is:</p>\n\n<p><a href=\"https://regex101.com/r/kgVVvB/2\" rel=\"noreferrer\">See regex in use here</a></p>\n\n<pre><code>(?:(?:^|[^&amp;])&amp;(?:[^&amp;]|$)|[^&amp;])+\n</code></pre>\n\n<ul>\n<li><code>(?:(?:^|[^&amp;])&amp;(?:[^&amp;]|$)|[^&amp;])+</code> Match either of the following one or more times\n\n<ul>\n<li><code>(?:^|[^&amp;])&amp;(?:[^&amp;]|$)</code>\n\n<ul>\n<li><code>(?:^|[^&amp;])</code> Assert position at the start of the line or match any character that is not <code>&amp;</code></li>\n<li><code>&amp;</code> Match this literally</li>\n<li><code>(?:^|[^&amp;])</code> Assert position at the end of the line or match any character that is not <code>&amp;</code></li>\n</ul></li>\n<li><code>[^&amp;]</code> Match any character that is not <code>&amp;</code></li>\n</ul></li>\n</ul>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 2, "accepted_answer_id": 48916941, "answer_count": 1, "score": 2, "last_activity_date": 1519254231, "creation_date": 1519253377, "question_id": 48916854, "link": "https://stackoverflow.com/questions/48916854/how-do-i-match-any-character-but", "title": "How do I match any character but &quot;&amp;&amp;&quot;?", "body": "<p>I have the following string:</p>\n\n<pre><code>a simple string that may contain this &amp; that but I want it to skip &amp;&amp;. Do you follow? \n</code></pre>\n\n<p>I am working with the following regex to try to split it on a double occurrence of \"&amp;&amp;\":</p>\n\n<pre><code>[^&amp;]*\\s\n</code></pre>\n\n<p>This picks up the single \"&amp;\" occurrence.</p>\n\n<p>I've also tried:    </p>\n\n<pre><code>[^&amp;]{2}*\\s\n</code></pre>\n\n<p>But that doesn't pick up anything.</p>\n\n<p>The stuff I have found online apply to PCRE regex and I am unable to find an RE2 type solution that go uses.</p>\n\n<p><a href=\"https://regex101.com/r/kgVVvB/1\" rel=\"nofollow noreferrer\">https://regex101.com/r/kgVVvB/1</a></p>\n"}, {"tags": ["go", "types", "casting"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519250999, "post_id": 48916313, "comment_id": 84839116, "body": "Do you have a limited set of map types you&#39;re using? Then just type switch on those, otherwise you&#39;re going to have to use reflection,"}, {"owner": {"reputation": 3555, "user_id": 1831118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/c240e46e93b7e692ae8319c40f40e7cc?s=128&d=identicon&r=PG", "display_name": "Nathan Hanna", "link": "https://stackoverflow.com/users/1831118/nathan-hanna"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519251123, "post_id": 48916313, "comment_id": 84839173, "body": "No, my use case is reading json schema $ref paths, so the map values could be anything, but the keys will always be strings."}, {"owner": {"reputation": 3555, "user_id": 1831118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/c240e46e93b7e692ae8319c40f40e7cc?s=128&d=identicon&r=PG", "display_name": "Nathan Hanna", "link": "https://stackoverflow.com/users/1831118/nathan-hanna"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519251458, "post_id": 48916313, "comment_id": 84839332, "body": "@JimB How would you use reflection to solve this problem?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1519252017, "post_id": 48916313, "comment_id": 84839585, "body": "If the application is reading a value decoded to an <code>interface{}</code> by the <a href=\"http://godoc.org/encoding/json\" rel=\"nofollow noreferrer\">json</a> package, then the maps are all of type <code>map[string]interface{}</code> and the code in the question will work as is."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1519252204, "post_id": 48916313, "comment_id": 84839671, "body": "If you expect map keys to be of any type, why is your <code>key string</code>? At the moment you can only handle <code>string</code> map keys."}, {"owner": {"reputation": 3555, "user_id": 1831118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/c240e46e93b7e692ae8319c40f40e7cc?s=128&d=identicon&r=PG", "display_name": "Nathan Hanna", "link": "https://stackoverflow.com/users/1831118/nathan-hanna"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1519252539, "post_id": 48916313, "comment_id": 84839806, "body": "@MichaelHampton sorry if my wording was unclear.  I expect the keys to always be strings, but the values to be of an arbitrary type."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1519251810, "creation_date": 1519251810, "answer_id": 48916527, "question_id": 48916313, "link": "https://stackoverflow.com/questions/48916313/how-can-i-access-the-key-of-a-map-without-knowing-the-type-of-the-values/48916527#48916527", "title": "How can I access the key of a map without knowing the type of the values?", "body": "<p>Use the <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflect</a> package to operate on arbitrary map types:</p>\n\n<pre><code>func GetMapKey(reference interface{}, key string) (interface{}, error) {\n    m := reflect.ValueOf(reference)\n    if m.Kind() != reflect.Map {\n        return nil, errors.New(\"not a map\")\n    }\n    v := m.MapIndex(reflect.ValueOf(key))\n    if !v.IsValid() {\n        return nil, errors.New(\"The \" + key + \" key was not present in the map\")\n    }\n    return v.Interface(), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 3555, "user_id": 1831118, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/c240e46e93b7e692ae8319c40f40e7cc?s=128&d=identicon&r=PG", "display_name": "Nathan Hanna", "link": "https://stackoverflow.com/users/1831118/nathan-hanna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 48916527, "answer_count": 1, "score": 1, "last_activity_date": 1519251810, "creation_date": 1519250809, "question_id": 48916313, "link": "https://stackoverflow.com/questions/48916313/how-can-i-access-the-key-of-a-map-without-knowing-the-type-of-the-values", "title": "How can I access the key of a map without knowing the type of the values?", "body": "<p>If I have a map in an interface variable and want to access a key, but do not know what type the values of the map will be, how can I access that key?</p>\n\n<p><a href=\"https://play.golang.org/p/R4trOpx06re\" rel=\"nofollow noreferrer\">Here</a> is an example on go playground</p>\n\n<p>To solve my problem I need to figure out how to make the main function run without errors.</p>\n"}, {"tags": ["go", "websocket", "ascii", "gorilla"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1519243693, "post_id": 48914378, "comment_id": 84835460, "body": "How did you land on those hex codes in the first place? There isn&#39;t an &quot;equivalent hex code&quot; for a process signal."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519243802, "post_id": 48914378, "comment_id": 84835539, "body": "You could write the signal codes directly as bytes, but that doesn&#39;t make much sense. It looks like you are doing whatever it is you consider to be proper &quot;conversion&quot; of the signals to byte values."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1519243816, "post_id": 48914378, "comment_id": 84835545, "body": "The hex codes are defined by the UNIX terminal facility.  It&#39;s possible to use the system terminal library to  detect the terminal info, query the termcap db, and get at them, but that is likely more trouble than it&#39;s worth..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1519243900, "post_id": 48914378, "comment_id": 84835587, "body": "(are you making potentially bad assumptions about the listening client, perhaps, in light of this?)"}, {"owner": {"reputation": 27, "user_id": 9383609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "kittu", "link": "https://stackoverflow.com/users/9383609/kittu"}, "edited": false, "score": 0, "creation_date": 1519243904, "post_id": 48914378, "comment_id": 84835588, "body": "<a href=\"http://donsnotes.com/tech/charsets/ascii.html#EOL\" rel=\"nofollow noreferrer\">donsnotes.com/tech/charsets/ascii.html#EOL</a> hex codes are here"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519243932, "post_id": 48914378, "comment_id": 84835603, "body": "Where are you getting these numbers from? syscall.Signal values are just ints."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519243984, "post_id": 48914378, "comment_id": 84835636, "body": "Are you confusing control characters/sequences and signals?"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1519244027, "post_id": 48914378, "comment_id": 84835661, "body": "@kittu -  Even in the guide you just posted - which is not complete - do you see how different systems/terms sometimes map character code differently?"}, {"owner": {"reputation": 27, "user_id": 9383609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "kittu", "link": "https://stackoverflow.com/users/9383609/kittu"}, "edited": false, "score": 0, "creation_date": 1519244176, "post_id": 48914378, "comment_id": 84835738, "body": "From my previous question, <a href=\"https://stackoverflow.com/questions/48877342/how-to-capture-os-signals-like-ctrlc-and-send-them-through-gorilla-websocket-in/48877740#48877740\" title=\"how to capture os signals like ctrlc and send them through gorilla websocket in\">stackoverflow.com/questions/48877342/&hellip;</a> . I found that we can capture ctrl+c signal and write its equivalent to websockets. Is it not possible to capture all signals and write it&#39;s equivalent ?"}, {"owner": {"reputation": 27, "user_id": 9383609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "kittu", "link": "https://stackoverflow.com/users/9383609/kittu"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1519244290, "post_id": 48914378, "comment_id": 84835785, "body": "@BadZen - here is the correct link - <a href=\"http://donsnotes.com/tech/charsets/ascii.html#cntrl\" rel=\"nofollow noreferrer\">donsnotes.com/tech/charsets/ascii.html#cntrl</a> . I am currently focussing on linux/unix"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1519244444, "post_id": 48914378, "comment_id": 84835875, "body": "Let me put it this way:   a user&#39;s dotfile or the system dotfiles could change that character with <code>stty</code> and that would break your entire scheme.   The keycodes are not mapped to signals in a neat way like you think.  What are you doing on the other side that you think you need the keycode for?   (It&#39;s probably buggy-by-design in light of what I&#39;ve just told you...)"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519244522, "post_id": 48914378, "comment_id": 84835927, "body": "If OTOH you aren&#39;t using the keycode in a terminal / process input at all, just use the signal number instead as @JimB suggested  No &quot;conversion&quot; nec&#39;y and your code simplifies."}, {"owner": {"reputation": 27, "user_id": 9383609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "kittu", "link": "https://stackoverflow.com/users/9383609/kittu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519326488, "post_id": 48914378, "comment_id": 84877358, "body": "@JimB can you please explain what do you mean by write signal codes directly as bytes?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519326779, "post_id": 48914378, "comment_id": 84877510, "body": "@kittu: signals are just a integer value, and can all be expressed as a single byte."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1519653678, "post_id": 48940819, "comment_id": 84985064, "body": "I&#39;d also note that POSIX did not cover all the signals used (refer to the <code>signal(7)</code> manual page for more info\u2014that is, run `man 7 signal). Hence, instead of trying to &quot;hex-encode&quot; signals somehow I&#39;d probably map them onto something human-readable (like strings) if possible."}], "tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": true, "score": 0, "last_activity_date": 1519357833, "creation_date": 1519357833, "answer_id": 48940819, "question_id": 48914378, "link": "https://stackoverflow.com/questions/48914378/converting-control-signals-to-byte-ascii-hex-code-in-golang/48940819#48940819", "title": "Converting control signals to byte ascii hex code in golang", "body": "<p>It sounds like you're trying to communicate a signal over a websocket. And thus you need a way to encode it won't get confused with other characters so using the unprintable ascii characters is a reasonable move.</p>\n\n<p>Since there is no convention for mapping <code>syscall</code> signals into a <code>byte</code>, you can't just import it - but good news! - you get to create your own!</p>\n\n<p>Create a  <code>map[syscall.Signal]byte</code> or <code>map[os.Signal]byte</code> and do the translation from there:</p>\n\n<pre><code>// Create a mapping between syscalls and bytes\nvar syscallByteMap = map[syscall.Signal]byte{\n  syscall.SIGINT: '\\003',\n  ...more here...\n}\n\n...truncated...\n\n        go func() {\n        for {\n            s := &lt;-d\n            // Look up the signal in the map\n            b, ok := syscallByteMap[s]\n            if ok {\n                err = c.ws.WriteMessage(websocket.TextMessage, []byte{b})\n            } else {\n                err = nil\n            }\n\n        }\n    }()\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 9383609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "kittu", "link": "https://stackoverflow.com/users/9383609/kittu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 535, "favorite_count": 0, "accepted_answer_id": 48940819, "answer_count": 1, "score": 1, "last_activity_date": 1519357833, "creation_date": 1519242863, "last_edit_date": 1519244351, "question_id": 48914378, "link": "https://stackoverflow.com/questions/48914378/converting-control-signals-to-byte-ascii-hex-code-in-golang", "title": "Converting control signals to byte ascii hex code in golang", "body": "<p>I am trying to capture signals like ctrl+c, ctrl+z, ctrl+\\ in golang and write its equivalent hex code to websocket. I am doing something like below.</p>\n\n<pre><code>func (c *poc) writePump() {\n    var b = make([]byte, 1)\n    d := make(chan os.Signal, 1)\n    signal.Notify(d, syscall.SIGINT, syscall.SIGTSTP, syscall.SIGQUIT)\n\n    for {\n        os.Stdin.Read(b)\n        err = c.ws.WriteMessage(websocket.TextMessage, b)\n\n        go func() {\n            for {\n                s := &lt;-d\n                err = cli.sendControlSignalToWebsockets(s)\n            }\n        }()\n\n        if err != nil {\n            log.Printf(\"Failed to send UTF8 char: %s\", err)\n        }\n    }\n}\n\nfunc (c *poc) sendControlSignalToWebsockets(s os.Signal) error {\n    var err error\n\n    switch s {\n    case syscall.SIGINT:\n        err = c.ws.WriteMessage(websocket.TextMessage, []byte{'\\003'})\n    case syscall.SIGTSTP:\n        err = c.ws.WriteMessage(websocket.TextMessage, []byte{'\\x1a'})\n    case syscall.SIGQUIT:\n        err = c.ws.WriteMessage(websocket.TextMessage, []byte{'\\x1c'})\n    }\n\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>Instead I want to do something like, capturing all signals and instead of hardcoding each signals equivalent to it's hexcode, convert signal to hexcode.</p>\n\n<pre><code>func (c *poc) writePump() {\n    var b = make([]byte, 1)\n    d := make(chan os.Signal, 1)\n    signal.Notify(d)\n\n    for {\n        os.Stdin.Read(b)\n        err = c.ws.WriteMessage(websocket.TextMessage, b)\n\n        go func() {\n            for {\n                s := &lt;-d\n                //???? do some conversions and write it to websocket\n            }\n        }()\n\n        if err != nil {\n            log.Printf(\"Failed to send UTF8 char: %s\", err)\n        }\n    }\n}\n</code></pre>\n\n<p>Curious to know if anyone has any idea. Thanks!</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "is_accepted": false, "score": 0, "last_activity_date": 1519846837, "creation_date": 1519846837, "answer_id": 49037344, "question_id": 48914025, "link": "https://stackoverflow.com/questions/48914025/generate-golang-grpc-custom-proto-object/49037344#49037344", "title": "Generate Golang grpc + custom proto object", "body": "<p>Per the protoc documentation here: <a href=\"https://github.com/golang/protobuf#parameters\" rel=\"nofollow noreferrer\">https://github.com/golang/protobuf#parameters</a></p>\n\n<blockquote>\n  <p>To pass extra parameters to the plugin, use a comma-separated parameter list separated from the output directory by a colon:</p>\n</blockquote>\n\n<p>So I believe the right command would be:\n<code>protoc -I.:../ --go_out=plugins=grpc,Muser/messages.proto=github.com/.../.../user:. messages.proto</code></p>\n"}], "owner": {"reputation": 1169, "user_id": 3276768, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/281d13be910548f09ba1ef72f3cedc86?s=128&d=identicon&r=PG&f=1", "display_name": "user3276768", "link": "https://stackoverflow.com/users/3276768/user3276768"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 452, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1519846837, "creation_date": 1519241519, "question_id": 48914025, "link": "https://stackoverflow.com/questions/48914025/generate-golang-grpc-custom-proto-object", "title": "Generate Golang grpc + custom proto object", "body": "<p>I am trying to generate a gRPC client that returns a self defined proto object. This is my current proto command</p>\n\n<p><code>protoc -I.:../ --go_out=plugins=grpc:Muser/messages.proto=github.com/.../.../user:. messages.proto</code></p>\n\n<p>and this is the error\n<code>Muser/messages.proto=github.com/.../.../user:./: No such file or directory</code></p>\n\n<p>However this command:</p>\n\n<p><code>protoc -I.:../ \n--go_out=Muser/messages.proto=github.com/.../.../user:. messages.proto</code></p>\n\n<p>and this one:</p>\n\n<p><code>protoc -I.:../ --go_out=plugins=grpc:. messages.proto</code> </p>\n\n<p>work perfectly. The problem is when I try to use the <code>plugins:grpc</code> part in conjunction to the path of the <code>user/messages.proto</code> file.</p>\n\n<p>Any clue what the problem might be?</p>\n"}, {"tags": ["go", "bson", "mgo"], "comments": [{"owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "edited": false, "score": 0, "creation_date": 1519242284, "post_id": 48913850, "comment_id": 84834662, "body": "Are you using this <a href=\"https://godoc.org/labix.org/v2/mgo/bson\" rel=\"nofollow noreferrer\">godoc.org/labix.org/v2/mgo/bson</a> ?"}, {"owner": {"reputation": 13, "user_id": 9254200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f582d9c18cc6a237eef94f50ad97f316?s=128&d=identicon&r=PG", "display_name": "Kurayami", "link": "https://stackoverflow.com/users/9254200/kurayami"}, "reply_to_user": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "edited": false, "score": 0, "creation_date": 1519250592, "post_id": 48913850, "comment_id": 84838919, "body": "Yes, I am using godoc.org/labix.org/v2/mgo/bson"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 9254200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f582d9c18cc6a237eef94f50ad97f316?s=128&d=identicon&r=PG", "display_name": "Kurayami", "link": "https://stackoverflow.com/users/9254200/kurayami"}, "edited": false, "score": 0, "creation_date": 1519432990, "post_id": 48921790, "comment_id": 84923243, "body": "Thanks mbuechmann, that did the trick. It also made me realize I overthought it too much, as I could also just put it into an interface then run it through my prettyJSON function. I appreciate the assistance."}], "tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": true, "score": 2, "last_activity_date": 1519284996, "last_edit_date": 1519284996, "creation_date": 1519284581, "answer_id": 48921790, "question_id": 48913850, "link": "https://stackoverflow.com/questions/48913850/how-to-view-mgos-bson-raw-in-pretty-text/48921790#48921790", "title": "How to view mgo&#39;s bson.Raw in &quot;pretty&quot; text", "body": "<p>bson is a binary format and it is just a slice of bytes. It is in itself not readable by a human as this format holds information about the length of fields, etc. and holds all data very compact. It is already encoded, so there is no need to marshal it.</p>\n\n<p>You can output as it is, but it will be not readable.</p>\n\n<p>See the bson spec here: <a href=\"http://bsonspec.org/#/specification\" rel=\"nofollow noreferrer\">http://bsonspec.org/#/specification</a></p>\n\n<p>If you want to see all contents of the bson, you could Unmarshal it into a map:</p>\n\n<pre><code>m := map[string]interface{}{}\nrawData.Unmarshal(&amp;m)\nfmt.Printf(\"%+v\\n\", m)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 9254200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f582d9c18cc6a237eef94f50ad97f316?s=128&d=identicon&r=PG", "display_name": "Kurayami", "link": "https://stackoverflow.com/users/9254200/kurayami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1350, "favorite_count": 0, "accepted_answer_id": 48921790, "answer_count": 1, "score": 1, "last_activity_date": 1519284996, "creation_date": 1519240898, "question_id": 48913850, "link": "https://stackoverflow.com/questions/48913850/how-to-view-mgos-bson-raw-in-pretty-text", "title": "How to view mgo&#39;s bson.Raw in &quot;pretty&quot; text", "body": "<p>I want to be able to output raw bson data I am getting from golang's mgo library to the console for debugging purposes, but have been unable to find out how to accomplish this.</p>\n\n<p>With JSON I do it like this:</p>\n\n<pre><code>    formatedData, err := json.MarshalIndent(rawData, \"\", \"   \")\n        if err != nil {\n        log.Print(err)\n    }\n    fmt.Printf(\"%s\", formatedData)\n</code></pre>\n\n<p>Is there an equivalent way to do this with BSON?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1519238216, "post_id": 48912343, "comment_id": 84832543, "body": "The error that BindJSON returns will probably tell you that the input isn&#39;t JSON. Don&#39;t just compare it to nil, print it for debugging, and maybe even return it to the client."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519238317, "post_id": 48912343, "comment_id": 84832601, "body": "And in case you&#39;re not aware, all public Go code is documented on godoc.org: <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.BindJSON\" rel=\"nofollow noreferrer\">godoc.org/github.com/gin-gonic/gin#Context.BindJSON</a>"}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519242234, "post_id": 48912343, "comment_id": 84834632, "body": "@Peter Yeah, I&#39;ve already looked through the godoc.org documentation, it&#39;s just that I&#39;m still so early on in learning Go that much of it doesn&#39;t really make sense to me.  Even though I use the term &quot;error&quot; in my question, BindJSON isn&#39;t returning an error per se. It is returning the JSON object provided in the line <code>c.JSON(406, gin.H{&quot;message&quot;: &quot;Invalid signin form&quot;, &quot;form&quot;: signinForm})</code>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519242932, "post_id": 48912343, "comment_id": 84835021, "body": "BindJSON <i>does</i> return a value of type <code>error</code>: <code>func (c *Context) BindJSON(obj interface{}) error</code>."}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519243237, "post_id": 48912343, "comment_id": 84835191, "body": "It doesn&#39;t do that for me. Are you trying to replicate from my code examples?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519244151, "post_id": 48912343, "comment_id": 84835717, "body": "I&#39;m not replicating anything. It&#39;s just obvious (and not arguable) from the method signature."}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519244452, "post_id": 48912343, "comment_id": 84835882, "body": "Either it is arguable, or we&#39;re not talking about the same thing. I have not seen that error."}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519244611, "post_id": 48912343, "comment_id": 84835978, "body": "I think perhaps you are meaning that <code>c.BindJSON(&amp;signinForm) != nil</code>. Yes, of course that is the case because the <code>if</code> conditional is being triggered. I am talking about what the <code>if</code> block itself logs. Looking back, my earlier comment should have said that that returned an error, not <code>BindJSON</code> itself."}], "answers": [{"comments": [{"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "edited": false, "score": 0, "creation_date": 1519242390, "post_id": 48912850, "comment_id": 84834720, "body": "The first block of code you provided prevents my application from running with the error <code>undefined: binding in binding.Form</code>."}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "edited": false, "score": 0, "creation_date": 1519242609, "post_id": 48912850, "comment_id": 84834847, "body": "In keeping with the second part of your answer, I&#39;m trying to add <code>enctype=&quot;application&#47;json&quot;</code> to my <code>form</code> HTML element, but according to <a href=\"https://stackoverflow.com/questions/38017123/is-form-enctype-appication-json-available\">this</a> that is not possible.  Where should I define the <code>Content-Type</code> header then?"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "edited": false, "score": 0, "creation_date": 1519242813, "post_id": 48912850, "comment_id": 84834963, "body": "You would need to import <code>&quot;github.com&#47;gin-gonic&#47;gin&#47;binding&quot;</code>"}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "edited": false, "score": 0, "creation_date": 1519243574, "post_id": 48912850, "comment_id": 84835401, "body": "Thanks @sberry. This is <i>part</i> of the answer. <code>signinForm</code> now includes the correct form data. I still need to change something so that this <code>if</code> statement isn&#39;t being triggered in the first place. The rest of my code, which handles a successful form submission, is inside an <code>if err == nil</code> conditional."}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "edited": false, "score": 0, "creation_date": 1519243860, "post_id": 48912850, "comment_id": 84835573, "body": "This is the <code>err</code> when I log it: <code>Key: &#39;SigninForm.Email&#39; Error:Field validation for &#39;Email&#39; failed on the &#39;email&#39; tag</code>."}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "edited": false, "score": 0, "creation_date": 1519250562, "post_id": 48912850, "comment_id": 84838905, "body": "Ok, so I&#39;ve figured out validation with <a href=\"https://github.com/go-ozzo/ozzo-validation\" rel=\"nofollow noreferrer\">this</a> package. @sberry, can you just help explain to me what <code>ShouldBindWith</code> is doing?"}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "edited": false, "score": 0, "creation_date": 1519256235, "post_id": 48912850, "comment_id": 84841095, "body": "Your response is close enough to the answer I&#39;m looking for, so I am going to accept it and rephrase the question from my previous comment in a new post."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 2, "last_activity_date": 1519237056, "creation_date": 1519237056, "answer_id": 48912850, "question_id": 48912343, "link": "https://stackoverflow.com/questions/48912343/how-to-bindjson-in-golang/48912850#48912850", "title": "How to BindJSON in Golang", "body": "<p>I may be misunderstanding here, but if your content is available in <code>PostForm</code> calls then I would assume the <code>Content-Type</code> is not <code>application/json</code> but probably <code>application/x-www-form-urlencoded</code>.  If that is the case, then using <code>BindJSON</code> won't work as it is trying to bind the post data to the struct defined by parsing the post data as json.  I <strong>think</strong> this might work:</p>\n\n<pre><code>if err := c.ShouldBindWith(&amp;signinForm, binding.Form); err != nil {\n   c.JSON(406, gin.H{\"message\": \"Invalid signin form\", \"form\": signinForm})\n   c.Abort()\n   return\n}\n</code></pre>\n\n<p>The alternative would be to actually send your post data as json similar to:</p>\n\n<pre><code>{\"email\": \"test@example.com\", \"password\": \"pass\"}\n</code></pre>\n\n<p>And make sure the <code>Content-Type</code> header is <code>application/json</code></p>\n\n<p>I have never used Gin, so this may be completely wrong.</p>\n"}], "owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7787, "favorite_count": 0, "accepted_answer_id": 48912850, "answer_count": 1, "score": 4, "last_activity_date": 1519237056, "creation_date": 1519235255, "question_id": 48912343, "link": "https://stackoverflow.com/questions/48912343/how-to-bindjson-in-golang", "title": "How to BindJSON in Golang", "body": "<p>I am passing form data to a controller in Go. I have verified that the data is reaching the controller as its values appear in these variables:</p>\n\n<pre><code>emailValue := c.PostForm(\"email\");\npasswordValue := c.PostForm(\"password\");\n</code></pre>\n\n<p>However, I am working from a <a href=\"https://github.com/Massad/gin-boilerplate/blob/master/README.md\" rel=\"nofollow noreferrer\">boilerplate project</a> to try to teach myself Go, and I am confused about some further processing included there. The \"Invalid signin form\" error always gets triggered in the following function:</p>\n\n<pre><code>func (ctrl UserController) Signin(c *gin.Context) {\nvar signinForm forms.SigninForm\n\nif c.BindJSON(&amp;signinForm) != nil {\n    c.JSON(406, gin.H{\"message\": \"Invalid signin form\", \"form\": signinForm})\n    c.Abort()\n    return\n}\n\nuser, err := userModel.Signin(signinForm)\nif err == nil {\n    session := sessions.Default(c)\n    session.Set(\"user_id\", user.ID)\n    session.Set(\"user_email\", user.Email)\n    session.Set(\"user_name\", user.Name)\n    session.Save()\n\n    c.JSON(200, gin.H{\"message\": \"User signed in\", \"user\": user})\n} else {\n    c.JSON(406, gin.H{\"message\": \"Invalid signin details\", \"error\": err.Error()})\n}\n\n}\n</code></pre>\n\n<p>I can't figure out from reading the docs and other Stack Overflow questions what exactly BindJSON is doing in a case like this. Here is the relevant <code>struct</code> in the <code>forms</code> file:</p>\n\n<pre><code>type SigninForm struct {\n    Email    string `form:\"email\" json:\"email\" binding:\"required,email\"`\n    Password string `form:\"password\" json:\"password\" binding:\"required\"`\n}\n</code></pre>\n\n<p>What is <code>BindJSON</code> doing and how do I ensure that <code>c.BindJSON(&amp;signinForm) == nil</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1519232265, "post_id": 48911339, "comment_id": 84829132, "body": "Post the json that you are trying to use here"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1519232482, "post_id": 48911339, "comment_id": 84829269, "body": "<a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\">json.RawMessage</a> if you want to ensure that the value can be encoded, otherwise interface{}"}], "answers": [{"comments": [{"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "edited": false, "score": 0, "creation_date": 1519232369, "post_id": 48911407, "comment_id": 84829205, "body": "I am sorry if I could not write proper question. Actually I need Data to store only one type of value but Dynamically. Not just  Person or just Instruments."}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "edited": false, "score": 0, "creation_date": 1519232938, "post_id": 48911407, "comment_id": 84829590, "body": "How do I push? Can you write a pseudo code. I tried google, but not sure."}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "edited": false, "score": 0, "creation_date": 1519265839, "post_id": 48911407, "comment_id": 84843504, "body": "Thanks it resolved my query! I will update question soon with solution."}], "tags": [], "owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "is_accepted": true, "score": 1, "last_activity_date": 1519242135, "last_edit_date": 1519242135, "creation_date": 1519232226, "answer_id": 48911407, "question_id": 48911339, "link": "https://stackoverflow.com/questions/48911339/dynamic-nested-structure-in-golang/48911407#48911407", "title": "Dynamic Nested structure in GoLang", "body": "<p>You should use RawMessage in the type definition</p>\n\n<pre><code>type GeneralResponse struct {\n  Success string\n  Message string\n  Data    json.RawMessage\n  Error   string\n}\n</code></pre>\n\n<p>and subsequently push a <code>Marshal</code>led json into that attribute. \nYou can do that by encoding other types in <code>[]byte</code>s and setting them to the <code>Data</code> attribute.</p>\n\n<p>Like in <a href=\"https://play.golang.org/p/CyoN5pe_aNV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CyoN5pe_aNV</a></p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1519232351, "creation_date": 1519232351, "answer_id": 48911454, "question_id": 48911339, "link": "https://stackoverflow.com/questions/48911339/dynamic-nested-structure-in-golang/48911454#48911454", "title": "Dynamic Nested structure in GoLang", "body": "<p>If you put marshalled JSON into a string, it will be marshalled as a string (because it's a string) and the receiving end will have to unmarshal it twice (because it's been marshalled twice). What you want is probably more along the lines of:</p>\n\n<pre><code>type GeneralResponse struct {\n    Success string\n    Message string\n    Data    interface{}  // interface{} can be anything\n    Error   string\n}\n</code></pre>\n\n<p>This way you can put any data into <code>Data</code> and it will be marshalled directly into the response.</p>\n"}, {"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519232646, "post_id": 48911475, "comment_id": 84829378, "body": "No reason to use pointers to RawMessage. RawMessage is already a slice type. It&#39;s much more inconvenient to work with pointers, because they can&#39;t be used as a []byte."}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "edited": false, "score": 0, "creation_date": 1519233384, "post_id": 48911475, "comment_id": 84829860, "body": "How do I dump a json array in Data now?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1519233854, "post_id": 48911475, "comment_id": 84830151, "body": "I have added code by modifying the data and dumping array into interface{}"}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "edited": false, "score": 0, "creation_date": 1519234197, "post_id": 48911475, "comment_id": 84830382, "body": "You are showing code using interface{} , I thought it should be RawMessage?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1519234277, "post_id": 48911475, "comment_id": 84830421, "body": "you wants to dump data json.RawMessage is used when you are not using any underlying type to get the value. Here you are already using slice[]"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1519233820, "last_edit_date": 1519233820, "creation_date": 1519232406, "answer_id": 48911475, "question_id": 48911339, "link": "https://stackoverflow.com/questions/48911339/dynamic-nested-structure-in-golang/48911475#48911475", "title": "Dynamic Nested structure in GoLang", "body": "<p>json.RawMessage comes to rescue in case you wants to capture whole json without knowing its format.</p>\n\n<pre><code>type GeneralResponse struct {\n    Success string\n    Message string\n    Data    json.RawMessage\n    Error   string\n}\n</code></pre>\n\n<p>Checkout this <a href=\"https://play.golang.org/p/eKKsmrEVJl8\" rel=\"nofollow noreferrer\">code</a>. I have modified your code to dump data into response</p>\n"}, {"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": false, "score": 0, "last_activity_date": 1519232839, "creation_date": 1519232839, "answer_id": 48911631, "question_id": 48911339, "link": "https://stackoverflow.com/questions/48911339/dynamic-nested-structure-in-golang/48911631#48911631", "title": "Dynamic Nested structure in GoLang", "body": "<p>You can use <code>json.RawMessage</code> for that.\nI have implemented the encoding part, you find more here to decode - <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#RawMessage</a></p>\n"}], "owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 754, "favorite_count": 0, "accepted_answer_id": 48911407, "answer_count": 4, "score": -1, "last_activity_date": 1519266211, "creation_date": 1519232035, "last_edit_date": 1519266211, "question_id": 48911339, "link": "https://stackoverflow.com/questions/48911339/dynamic-nested-structure-in-golang", "title": "Dynamic Nested structure in GoLang", "body": "<p>I am learning golang and want to write generic response from microservices response.</p>\n\n<p>My General Response is like:</p>\n\n<pre><code>type GeneralResponse struct {\n    Success string\n    Message string\n    Data    string\n    Error   string\n}\n</code></pre>\n\n<p>In the <code>Data</code> section I want to return any json, say list of <code>Person</code>, <code>Instruments</code> or any type of objects.</p>\n\n<p>But it should be another json. \nI tried assigning other json objects but it did not work.\nIt is fine if I dump json array as string into it but it should unmarshal from receiver end.\nHow should I go about it?</p>\n\n<p>I am trying over here. <a href=\"https://play.golang.org/p/dc0uKtS76aA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/dc0uKtS76aA</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1519231887, "post_id": 48911208, "comment_id": 84828836, "body": "Not at all clear what you&#39;re asking here... can you create re-usable code? Yes, that&#39;s the purpose of functions and methods and most programming language features in every language."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1519231965, "post_id": 48911208, "comment_id": 84828908, "body": "@Adrian - This is not what Im talking about, my question if there is option to extend the log api or other logs api of go to support this secnario"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1519232011, "post_id": 48911208, "comment_id": 84828954, "body": "You&#39;ve already extended the API, you&#39;re just doing it by copy and pasting. You could easily write a function or a type that does the same thing."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1519232299, "post_id": 48911208, "comment_id": 84829164, "body": "@Adrian - im not sure what do you mean ? can you provide example ?"}, {"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1519232354, "post_id": 48911208, "comment_id": 84829194, "body": "@RaynD Do you mean you want to be able to do something like <code>log.Println(levels.Error, &quot;bla bla&quot;)</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1519240877, "post_id": 48911208, "comment_id": 84833909, "body": "@EmilePels - what is &quot;levels.Error, &quot; you cannot compile it..."}, {"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1519241790, "post_id": 48911208, "comment_id": 84834391, "body": "@RaynD Obviously... everybody is still trying to figure out what your problem is."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1519241973, "post_id": 48911208, "comment_id": 84834494, "body": "@EmilePels - I think the answer is the direction ...see my comments please"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1519240622, "post_id": 48912124, "comment_id": 84833778, "body": "Thanks 1+, two questions :)  I want to use logrus how would you use it in logrus for the same purpose ? 2. you tell to pass it as argument instead of global, what If I&#39;ve file that 10 func need the logrus so should I pass it to all the function ??"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1519241334, "post_id": 48912124, "comment_id": 84834136, "body": "in addition if you want to use your example in two diffrent packages in the same application, how would you do it?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1519242186, "post_id": 48912124, "comment_id": 84834612, "body": "Just to make it clear, when I talking about packages, im talking only about my app packages , not others"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1519278578, "post_id": 48912124, "comment_id": 84847230, "body": "From last to first, as you put in the question, it&#39;s possible to simply put the loggers (in my answer) inside a package that all other packages will use. You can group functions by defining a struct. Putting the logger inside the struct will make it available for that group of functions. To be honest, there are occasions that I myself find the global logger more convenient."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1519283985, "post_id": 48912124, "comment_id": 84849592, "body": "it will be great if you can also provide example how to do the same in logrus. thanks!"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1519285863, "post_id": 48912124, "comment_id": 84850540, "body": "I&#39;ve used zap mostly. But with zap or logrus you don&#39;t need to do that! They already have methods for leveled logging (<code>Error(...)</code>, <code>Info(...)</code>, <code>Warn(...)</code>, etc)."}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": true, "score": 1, "last_activity_date": 1519234406, "creation_date": 1519234406, "answer_id": 48912124, "question_id": 48911208, "link": "https://stackoverflow.com/questions/48911208/golang-create-custom-logger-to-share-on-files-and-packages-across-app/48912124#48912124", "title": "Golang - Create custom logger to share on files and packages across app", "body": "<p>It's best to use a more proper logger like <a href=\"https://github.com/uber-go/zap\" rel=\"nofollow noreferrer\">zap</a> or <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a>. Also prefer passing the logger explicitly as an argument and avoid global loggers.</p>\n\n<p>Yet if the exact logging workflow with the built-in one is needed, with the provided sample output, it's possible to define them with proper prefixes, instead of repeating the level in each string:</p>\n\n<pre><code>var (\n    warnlog  = log.New(os.Stderr, \"[ warn  ]\", log.Ltime|log.Lshortfile)\n    infolog  = log.New(os.Stderr, \"[ info  ]\", log.Ltime|log.Lshortfile)\n    buildlog = log.New(os.Stderr, \"[ build ]\", log.Ltime|log.Lshortfile)\n    errlog   = log.New(os.Stderr, \"[ error ]\", log.Ltime|log.Lshortfile)\n)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2213, "favorite_count": 0, "accepted_answer_id": 48912124, "answer_count": 1, "score": 1, "last_activity_date": 1519234406, "creation_date": 1519231619, "question_id": 48911208, "link": "https://stackoverflow.com/questions/48911208/golang-create-custom-logger-to-share-on-files-and-packages-across-app", "title": "Golang - Create custom logger to share on files and packages across app", "body": "<p>In my program there is a lot places where I should  create logs like following</p>\n\n<pre><code>log.Println(\"[Build]: bla bla\u201c)\n\nlog.Println(\u201c[INFO]: bla bla\u201c)\n\nlog.Printf(\u201c[ERROR]: bla bla\u201c)\n\nlog.Println(\u201c[WARNING]: bla bla\u201c)\n</code></pre>\n\n<p>I use it for all my logging in different packages inside the application\nand it\u2019s bit frustrating to copy this, is there a way to create some generic \nlog which I can simple re-use it inside my program.</p>\n\n<p>I read about logrus etc but they provide some way to do it but not provide some custom way or \nmaybe I miss something.</p>\n\n<p>My program is command line tool </p>\n"}, {"tags": ["go", "memory-management"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1519231951, "post_id": 48911139, "comment_id": 84828897, "body": "The garbage collector collects <i>garbage</i> - values to which there are <i>no references</i>. If you can try to use it, you must have a reference to it, therefor it isn&#39;t garbage, and won&#39;t be collected."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1519233617, "post_id": 48911139, "comment_id": 84829995, "body": "Also read <a href=\"https://golang.org/doc/faq#stack_or_heap\" rel=\"nofollow noreferrer\">golang.org/doc/faq#stack_or_heap</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1519233716, "post_id": 48911139, "comment_id": 84830064, "body": "You&#39;re not referencing anything outside of it&#39;s declaration scope, as <code>subject1config</code> is part of <code>p</code>, which is of course declared in the same scope you&#39;re using it."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1519293383, "post_id": 48917715, "comment_id": 84854977, "body": "Oh, please, don&#39;t add to the confusion! The statement &#171;In Go all variables are effectively references&#187; is plain wrong. The fact you can return <i>a pointer to</i> a variable of any type from a function, and the escape analysis done by compiler will notice this fact and will make sure the <i>pointed to</i> variable is allocated on the heap to be able to outlive the scope of the function in which it was created, still has nothing to do with its semantics \u2014simply because a pointer is explicitly used, and <i>it</i> is what has reference semantics, not the variable it points to."}, {"owner": {"reputation": 1260, "user_id": 695459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8766f0303f842207f52c2789896a7214?s=128&d=identicon&r=PG", "display_name": "mikijov", "link": "https://stackoverflow.com/users/695459/mikijov"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1519305506, "post_id": 48917715, "comment_id": 84863099, "body": "Thanks @kostix. I really tried not to add to confusion.  From my understanding it is not as simple as &quot;do we have a reference&quot; but there is real, albeit simple escape analysis. So even if you use pointers but don&#39;t return them compiler will use stack. I do agree that in sample code provided there is no return. But I do think my explanation is relevant. If you recommend how to better explain it, I am open to changing my answer... One of my references: www.agardner.me/golang/garbage/collection/gc/escape/analysis&zwnj;&#8203;/2015/10/18/go-escap&zwnj;&#8203;e-analysis.html"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1519315429, "post_id": 48917715, "comment_id": 84870611, "body": "The essense of your answer is quite okay, IMO, but wording is paramount: any newfangled gopher who would read &#171;In Go all variables are effectively references&#187; would beleive this is true and would spread this nonsense forward\u2014no matter whether the surrounding context of that phrase downplayed its boldness and falsehood or not."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1519315631, "post_id": 48917715, "comment_id": 84870766, "body": "The reason for be being so picky about this is that the distinction about reference/value semantics in Go is already a pain point for certain kind of freshmen\u2014those coming from languages such as JS or Python or PHP where values of any type other than primitive (such as <code>int</code>) is passed by reference; these people usually have troubles grasping the idea that in Go everything (and I mean this literally) is passed by value <i>but</i> at the same there are types which implement reference semantics\u2014both built-in and created by the user."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1519319654, "post_id": 48917715, "comment_id": 84873529, "body": "Hence there&#39;s no need to add to the confusion\u2014especially such needlessly and factually false but bold claims. Here&#39;s a simple example: &lt;<a href=\"https://play.golang.org/p/uZDb1f3rE26\" rel=\"nofollow noreferrer\">play.golang.org/p/uZDb1f3rE26</a>&gt;. As you can see, the variable created in the function &quot;is returned&quot; from it, but this means its <i>value</i> is returned <i>by copying</i> it, not returning a reference to it somehow."}, {"owner": {"reputation": 1260, "user_id": 695459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8766f0303f842207f52c2789896a7214?s=128&d=identicon&r=PG", "display_name": "mikijov", "link": "https://stackoverflow.com/users/695459/mikijov"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1519344170, "post_id": 48917715, "comment_id": 84885438, "body": "Agreed @kostix. I don&#39;t think I can sufficiently edit the answer to point out the difference. I will however add reference to this exchange."}], "tags": [], "owner": {"reputation": 1260, "user_id": 695459, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8766f0303f842207f52c2789896a7214?s=128&d=identicon&r=PG", "display_name": "mikijov", "link": "https://stackoverflow.com/users/695459/mikijov"}, "is_accepted": false, "score": -1, "last_activity_date": 1519344508, "last_edit_date": 1519344508, "creation_date": 1519259027, "answer_id": 48917715, "question_id": 48911139, "link": "https://stackoverflow.com/questions/48911139/can-memory-for-a-golang-variable-be-used-outside-its-declaration-scope/48917715#48917715", "title": "can memory for a golang variable be used outside its declaration scope", "body": "<p>Go looks simple, but in fact it does a lot to help the programmer.</p>\n\n<p>In Go all variables are effectively references. The compiler tracks if any memory \"escapes\" a scope, and then automatically allocates is on the heap (shared memory pool). If the memory does not escape the scope, compiler allocates it on the stack which is much faster.</p>\n\n<p>In your case, when you assign the p.subject1config = &amp;subject1config, this tells the compiler that the value or the memory will leave the scope. Compiler will allocte the memory from heap and thus via the reference p.subject1config you can access the memory in the outer scope.</p>\n\n<p>Go garbage collector regularly checks if the memory blocks still have any refences pointing to it, and frees up the memory when no references remain.</p>\n\n<p>In short, you are confusing \"variable\" and \"memory\", probably because Go automatically manages memory for you.</p>\n\n<p>EDIT: This answer might be too simplisic. Please read comments below for more info. See these links for more information:\n<a href=\"http://www.tapirgames.com/blog/golang-memory-management\" rel=\"nofollow noreferrer\">http://www.tapirgames.com/blog/golang-memory-management</a>\n<a href=\"https://dougrichardson.org/2016/01/23/go-memory-allocations.html\" rel=\"nofollow noreferrer\">https://dougrichardson.org/2016/01/23/go-memory-allocations.html</a></p>\n"}], "owner": {"reputation": 416, "user_id": 4032638, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "suppandi g", "link": "https://stackoverflow.com/users/4032638/suppandi-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 535, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519344508, "creation_date": 1519231370, "question_id": 48911139, "link": "https://stackoverflow.com/questions/48911139/can-memory-for-a-golang-variable-be-used-outside-its-declaration-scope", "title": "can memory for a golang variable be used outside its declaration scope", "body": "<p>I am trying to understand memory management in go. can i safely use the memory allocated inside a scope.</p>\n\n<pre><code>type BigConfigurationData struct {\n   subject1config *Subject1Config\n   subject2config *Subject2Config\n   ...\n}\n\nvar p BigConfigurationData\nif aFlag {\n   var subject1config = Subject1Config {\n      foo: bar\n   }\n   p.subject1config = &amp;subject1config\n}\n// can i use p.subject1config here and expect the memory has not been cleaned up?\n</code></pre>\n"}, {"tags": ["go", "data-structures", "heap"], "comments": [{"owner": {"reputation": 90, "user_id": 2626428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/963b0a4540ae03db2e4dc89e186211fd?s=128&d=identicon&r=PG", "display_name": "Zach Taylor", "link": "https://stackoverflow.com/users/2626428/zach-taylor"}, "edited": false, "score": 0, "creation_date": 1519229805, "post_id": 48910488, "comment_id": 84827335, "body": "There is a 3rd option with your type declaration for go 1.10 type MaxHeapInt = MinHeapInt"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 90, "user_id": 2626428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/963b0a4540ae03db2e4dc89e186211fd?s=128&d=identicon&r=PG", "display_name": "Zach Taylor", "link": "https://stackoverflow.com/users/2626428/zach-taylor"}, "edited": false, "score": 1, "creation_date": 1519229913, "post_id": 48910488, "comment_id": 84827416, "body": "@ZachTaylor: that&#39;s not what a <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">type alias</a> (from go1.9) is for, it doesn&#39;t allow you to change any methods"}], "answers": [{"comments": [{"owner": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "edited": false, "score": 0, "creation_date": 1519230551, "post_id": 48910538, "comment_id": 84827873, "body": "Thanks for correcting me! However, the <code>MaxHeapInt</code> seems still not a good one. No sure if there I could find better way."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "edited": false, "score": 0, "creation_date": 1519230637, "post_id": 48910538, "comment_id": 84827939, "body": "@dapangmao: what do you mean by &quot;not a good one&quot;? What are you looking for?"}, {"owner": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "edited": false, "score": 1, "creation_date": 1519230989, "post_id": 48910538, "comment_id": 84828222, "body": "The <code>MaxHeapInts</code> works but has to be called such as <code>var maxHeap = &amp;MaxHeapInt{MinHeapInt{1, 5, 3}}</code>, which is different from <code>var minHeap = &amp;MinHeapInt{1, 5, 3}</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1519231862, "last_edit_date": 1519231862, "creation_date": 1519229652, "answer_id": 48910538, "question_id": 48910488, "link": "https://stackoverflow.com/questions/48910488/how-to-embed-and-override-a-struct-in-go/48910538#48910538", "title": "How to embed and override a struct in Go", "body": "<p>Your first solution is trying to index the <code>MaxHeapInt</code> struct, not the <code>MinHeapInt</code> slice.</p>\n\n<pre><code>type MaxHeapInt struct {\n    MinHeapInt\n}\n\nfunc (h MaxHeapInt) Less(i, j int) bool {\n    return h.MinHeapInt[i] &gt; h.MinHeapInt[j]\n}\n</code></pre>\n\n<p>If you want them to be initialized the same, then create a partial heap implementation, and wrap in the desired struct (similar to the <a href=\"https://golang.org/pkg/sort/#example__sortWrapper\" rel=\"nofollow noreferrer\">wrapper example</a> in the sort package).</p>\n\n<pre><code>type Max struct{ IntHeap }\n\nfunc (h Max) Less(i, j int) bool {\n    return h.IntHeap[i] &gt; h.IntHeap[j]\n}\n\ntype Min struct{ IntHeap }\n\nfunc (h Min) Less(i, j int) bool {\n    return h.IntHeap[i] &lt; h.IntHeap[j]\n}\n\ntype IntHeap []int\n\nfunc (h IntHeap) Len() int { return len(h) }\n\nfunc (h IntHeap) Swap(i, j int) { h[i], h[j] = h[j], h[i] }\n\nfunc (h *IntHeap) Peek() interface{} { return (*h)[0] }\n\nfunc (h *IntHeap) Push(x interface{}) {\n    *h = append(*h, x.(int))\n}\n\nfunc (h *IntHeap) Pop() interface{} {\n    length := len(*h)\n    res := (*h)[length-1]\n    *h = (*h)[0 : length-1]\n    return res\n}\n\n// Now these can be initialized like\n//     Min{IntHeap{1, 2, 3}}\n//     Max{IntHeap{1, 2, 3}}\n</code></pre>\n"}], "owner": {"reputation": 2437, "user_id": 1914002, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ae822f979980ea450842c7cc36baeb94?s=128&d=identicon&r=PG", "display_name": "dapangmao", "link": "https://stackoverflow.com/users/1914002/dapangmao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 1, "accepted_answer_id": 48910538, "answer_count": 1, "score": 0, "last_activity_date": 1519242600, "creation_date": 1519229503, "last_edit_date": 1519242600, "question_id": 48910488, "link": "https://stackoverflow.com/questions/48910488/how-to-embed-and-override-a-struct-in-go", "title": "How to embed and override a struct in Go", "body": "<p>I am constructing the min/max heaps of ints to satisfy the interface from <code>container/heap</code>.</p>\n\n<p>The min heap works well such as </p>\n\n<pre><code>type MinHeapInt []int\n\nfunc (h MinHeapInt) Len() int {\n    return len(h)\n}\n\nfunc (h MinHeapInt) Less(i, j int) bool {\n    return h[i] &lt; h[j]\n}\n\nfunc (h MinHeapInt) Swap(i, j int) {\n    h[i], h[j] = h[j], h[i]\n}\n\nfunc (h *MinHeapInt) Peek() interface{} {\n    return (*h)[0]\n}\n\nfunc (h *MinHeapInt) Push(x interface{}) {\n    *h = append(*h, x.(int))\n}\n\nfunc (h *MinHeapInt) Pop() interface{} {\n    length := len(*h)\n    res := (*h)[length - 1]\n    *h = (*h)[0 : length - 1]\n    return res\n}\n</code></pre>\n\n<p>Now I am trying to develop the max heap by only overriding the <code>Less</code> method.</p>\n\n<p>The first solution does not work since it cannot find the array</p>\n\n<pre><code>type MaxHeapInt struct {\n    MinHeapInt\n}\n\nfunc (h MaxHeapInt) Less(i, j int) bool {\n    return h[i] &gt; h[j]\n}\n</code></pre>\n\n<p>The second solution only keeps the <code>Less</code> method.</p>\n\n<pre><code>type MaxHeapInt MinHeapInt\n\nfunc (h MaxHeapInt) Less(i, j int) bool {\n    return h[i] &gt; h[j]\n}\n</code></pre>\n\n<p>Wonder if there is anyway to get around. Thanks!</p>\n"}, {"tags": ["html", "forms", "go", "routing"], "comments": [{"owner": {"reputation": 793711, "user_id": 19068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2d3229ed1961d2bd81853242493247?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/19068/quentin"}, "edited": false, "score": 1, "creation_date": 1519226703, "post_id": 48909476, "comment_id": 84825105, "body": "<a href=\"http://www.456bereastreet.com/archive/201204/the_html5_placeholder_attribute_is_not_a_substitute_for_the_label_element/\" rel=\"nofollow noreferrer\">The HTML5 placeholder attribute is not a substitute for the label element</a>"}, {"owner": {"reputation": 793711, "user_id": 19068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2d3229ed1961d2bd81853242493247?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/19068/quentin"}, "edited": false, "score": 1, "creation_date": 1519226910, "post_id": 48909476, "comment_id": 84825242, "body": "<code>&lt;br &#47;&gt;&lt;br &#47;&gt;</code> \u2014 In 1996 the CSS margin property was introduced. It has pretty good support these days."}, {"owner": {"reputation": 793711, "user_id": 19068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2d3229ed1961d2bd81853242493247?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/19068/quentin"}, "edited": false, "score": 1, "creation_date": 1519226925, "post_id": 48909476, "comment_id": 84825249, "body": "<code>&lt;input type=&quot;submit&quot;&gt;&lt;&#47;input&gt;</code> \u2014 The end tag for the input element is forbidden in HTML."}, {"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "reply_to_user": {"reputation": 793711, "user_id": 19068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2d3229ed1961d2bd81853242493247?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/19068/quentin"}, "edited": false, "score": 0, "creation_date": 1519227580, "post_id": 48909476, "comment_id": 84825684, "body": "Thanks for the pointers."}], "answers": [{"comments": [{"owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "edited": false, "score": 0, "creation_date": 1519227595, "post_id": 48909611, "comment_id": 84825694, "body": "That did it. Thank you!"}], "tags": [], "owner": {"reputation": 793711, "user_id": 19068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2d3229ed1961d2bd81853242493247?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/19068/quentin"}, "is_accepted": true, "score": 4, "last_activity_date": 1519226873, "creation_date": 1519226873, "answer_id": 48909611, "question_id": 48909476, "link": "https://stackoverflow.com/questions/48909476/post-html-form-with-golang-gin-backend/48909611#48909611", "title": "POST HTML form with Golang/Gin backend", "body": "<p>Your form:</p>\n\n<blockquote>\n<pre><code>name=\"email\"\nname=\"password\"\n</code></pre>\n</blockquote>\n\n<p>Your server-side code:</p>\n\n<blockquote>\n<pre><code>formContent := c.PostForm(\"loginForm\")\n</code></pre>\n</blockquote>\n\n<p>You are looking for a field which does not exist. </p>\n\n<pre><code>emailValue := c.PostForm(\"email\");\npasswordValue := c.PostForm(\"password\");\n</code></pre>\n"}], "owner": {"reputation": 795, "user_id": 6391321, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/116f9a999ac8e62526b71b583f969c91?s=128&d=identicon&r=PG&f=1", "display_name": "223seneca", "link": "https://stackoverflow.com/users/6391321/223seneca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1325, "favorite_count": 1, "accepted_answer_id": 48909611, "answer_count": 1, "score": 0, "last_activity_date": 1519226873, "creation_date": 1519226505, "question_id": 48909476, "link": "https://stackoverflow.com/questions/48909476/post-html-form-with-golang-gin-backend", "title": "POST HTML form with Golang/Gin backend", "body": "<p>I am trying to POST a simple HTML form to my backend, which uses Golang and <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">Gin</a>. Here is the HTML:</p>\n\n<pre><code>&lt;form action=\"/login\" method=\"post\" name=\"loginForm\"&gt;\n          &lt;div&gt;\n            &lt;input type=\"text\" placeholder=\"Email\" name=\"email\"&gt;&lt;/input&gt;\n          &lt;/div&gt;\n          &lt;br /&gt;&lt;br /&gt;\n          &lt;div&gt;\n            &lt;input type=\"password\" placeholder=\"Password\" name=\"password\"&gt;&lt;/input&gt;\n          &lt;/div&gt;\n          &lt;br /&gt;&lt;br /&gt;\n          &lt;input type=\"submit\"&gt;&lt;/input&gt;\n          &lt;br /&gt;&lt;br /&gt;\n        &lt;/form&gt;\n</code></pre>\n\n<p>And here is the route from my <code>main.go</code>:</p>\n\n<pre><code>r.POST(\"/login\", func(c *gin.Context) {\n        //What do I need to put here?\n        formContent := c.PostForm(\"loginForm\")\n\n        c.JSON(200, gin.H{\n            \"status\":  \"posted to login\",\n            \"message\": \"whoo\",\n            \"form\": formContent})\n    })\n</code></pre>\n\n<p>When I submit the form, I receive the JSON response, but <code>formContent</code> is an empty string. I'm guessing I'm using the wrong method on <code>c</code>, but I'm not too experienced with Golang so not sure what to replace it with. I'm also not sure what additional capabilities Gin introduces here, as I'm essentially learning with trial and error from <a href=\"https://github.com/Massad/gin-boilerplate/blob/master/README.md\" rel=\"nofollow noreferrer\">an example project</a>.</p>\n\n<p>How do I properly access the form data on the backend?</p>\n"}, {"tags": ["go", "unmarshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1519222851, "post_id": 48907574, "comment_id": 84822190, "body": "Not sure I understand exactly what you want, but you should try changing the <code>Children</code> field&#39;s type to <code>[]*Thing</code> since <code>UnmarshalJSON</code> is defined on <code>*Thing</code> not <code>Thing</code>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519223239, "post_id": 48907574, "comment_id": 84822499, "body": "Can you add a sample JSON document?"}, {"owner": {"reputation": 97, "user_id": 8226424, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2bcc00cc849529549ab8bdb8490e4091?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Kirwan", "link": "https://stackoverflow.com/users/8226424/alex-kirwan"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519223633, "post_id": 48907574, "comment_id": 84822812, "body": "Thank you mkopriva for that advice. Also i updated with a JSON sample @Peter"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1519225740, "post_id": 48907574, "comment_id": 84824395, "body": "@AlexKirwan <a href=\"https://play.golang.org/p/wv6LXlLsfm2\" rel=\"nofollow noreferrer\">play.golang.org/p/wv6LXlLsfm2</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1548920726, "post_id": 48907574, "comment_id": 95719239, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/33436730/unmarshal-json-with-unknown-fields\">Unmarshal JSON with unknown fields</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1519223990, "creation_date": 1519223990, "answer_id": 48908631, "question_id": 48907574, "link": "https://stackoverflow.com/questions/48907574/how-to-unmarshal-nested-unknown-fields/48908631#48908631", "title": "How to unmarshal nested unknown fields", "body": "<p>In your case you needs to create a recursive function which will get the nested value of underlying <code>interface{}</code> till last depth. There is no way we can get nested value from <code>interface{}</code> with unknown underlying type. Here is an <a href=\"https://stackoverflow.com/questions/48167286/golang-json-and-slices-of-interface/48169341#48169341\">example</a> of what you can do in your code</p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 4, "last_activity_date": 1519225183, "creation_date": 1519225183, "answer_id": 48909049, "question_id": 48907574, "link": "https://stackoverflow.com/questions/48907574/how-to-unmarshal-nested-unknown-fields/48909049#48909049", "title": "How to unmarshal nested unknown fields", "body": "<p>This is exactly what <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\">json.RawMessage</a> is for (look at the unmarshal example in the docs). Unmarshal the top-level of the JSON Object first, inspect the kind field, then unmarshal the data field:</p>\n\n<pre><code>type Listing struct {                                           \n    WhitelistStatus string  `json:\"whitelist_status\"`           \n    Children        []Thing `json:\"children\"`                   \n}                                                               \n\ntype T3 struct {                                                \n    Domain              string `json:\"domain\"`                  \n    CrosspostParentList []struct {                              \n            Domain string `json:\"domain\"`                       \n    } `json:\"crosspost_parent_list\"`                            \n}                                                               \n\ntype Thing struct {\n    Kind string      `json:\"kind\"`\n    Data interface{} `json:\"data\"`\n}\n\nfunc (t *Thing) UnmarshalJSON(b []byte) error {\n    var step1 struct {\n            Kind string          `json:\"kind\"`\n            Data json.RawMessage `json:\"data\"` \n    }\n\n    if err := json.Unmarshal(b, &amp;step1); err != nil {\n            return err\n    }\n\n    var step2 interface{}\n    switch step1.Kind {\n    case \"Listing\":\n            step2 = &amp;Listing{}\n    case \"t3\":\n            step2 = &amp;T3{}\n    default:\n            return errors.New(\"unknown kind: \" + step1.Kind) // or simply ignore\n    }\n\n    if err := json.Unmarshal(b, step2); err != nil {\n            return err\n    }\n\n    t.Kind = step1.Kind\n    t.Data = step2\n\n    return nil\n}\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/giBVT2IWPd-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/giBVT2IWPd-</a></p>\n"}], "owner": {"reputation": 97, "user_id": 8226424, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2bcc00cc849529549ab8bdb8490e4091?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Kirwan", "link": "https://stackoverflow.com/users/8226424/alex-kirwan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1427, "favorite_count": 0, "accepted_answer_id": 48909049, "answer_count": 2, "score": 1, "last_activity_date": 1572797322, "creation_date": 1519220843, "last_edit_date": 1572797322, "question_id": 48907574, "link": "https://stackoverflow.com/questions/48907574/how-to-unmarshal-nested-unknown-fields", "title": "How to unmarshal nested unknown fields", "body": "<p>I forked a great project <a href=\"https://github.com/sridharv/reddit-go/blob/master/types.go\" rel=\"nofollow noreferrer\">here</a>, and have just been having a mess around with it learning some go. My issue I can't figure out is some things about custom unmarshaling, if you see <a href=\"https://github.com/yawlhead91/reddit-go/blob/682b83c99eda47b95e43d8f69b77a5ed53ac2029/types.go#L29\" rel=\"nofollow noreferrer\">here</a> you can see this unmarshals the <code>Thing</code> struct which holds a <code>Data interface{}</code> field that is then unmarshalled using the <code>Kind string</code> field. This all works great except the nested situations. So the best thing is an example: </p>\n\n<p>Just say you have <code>Thing</code> struct that's kind is a <code>listing</code>, thus the <code>Thing.Data</code> this is unmarshalled to type <code>listing</code>. Then <code>listing</code> has 3 <code>Children</code> of type <code>link</code> that is held in the <code>Children []Thing</code> field. These Children end up being of type <code>map[string]interface {}</code> which is my issue. How can I have this unmarshall down through nested data? So that the <code>Children.Data</code> is also unmarshalled. Is there a way to do this in go or will I have to write a big loop or recursion algorithm? Please let me know what you think or if I am looking at this situation all wrong. Thank you</p>\n\n<p><strong>UPDATE</strong>\nHere is a json sample</p>\n\n<pre><code>{\n    \"kind\": \"Listing\",\n    \"data\": {\n        \"after\": null,\n        \"dist\": 10,\n        \"facets\": {},\n        \"modhash\": null,\n        \"whitelist_status\": \"all_ads\",\n        \"children\": [\n            {\n                \"kind\": \"t3\",\n                \"data\": {\n                    \"domain\": \"self.nanocurrency\",\n                    \"approved_at_utc\": null,\n                    \"mod_reason_by\": null,\n                    \"banned_by\": null,\n                    \"num_reports\": null,\n                    \"subreddit_id\": \"t5_2wlj3\",\n                    \"thumbnail_width\": null,\n                    \"subreddit\": \"CryptoCurrency\",\n                    \"selftext_html\": null,\n                    \"selftext\": \"\",\n                    \"likes\": null,\n                    \"suggested_sort\": null,\n                    \"crosspost_parent_list\": [\n                        {\n                            \"domain\": \"self.nanocurrency\",\n                            \"approved_at_utc\": null,\n                            \"mod_reason_by\": null,\n                            \"banned_by\": null,\n                            \"num_reports\": null,\n                            \"subreddit_id\": \"t5_4br49\",\n                            \"thumbnail_width\": null,\n                            \"subreddit\": \"nanocurrency\",\n                            \"selftext_html\": \"&amp;lt;!-- SC_OFF --&amp;gt;&amp;lt;div class=\\\"md\\\"&amp;gt;&amp;lt;p&amp;gt;Seeing lots of comments about the lack of timestamps in the protocol, and just wanted to provide some information on why objectively accurate, global time timestamps are an illusion in decentralized systems. Logical time on the other hand is achievable and is in fact achieved in Nano via the individual block chains and the directed, acyclic graph (DAG). &amp;lt;/p&amp;gt;\\n\\n&amp;lt;p&amp;gt;Generally, in a decentralized, distributed system, only logical time (C happened after B happened after A) can be agreed on globally (e.g. Lamport time: &amp;lt;a href=\\\"https://amturing.acm.org/p558-lamport.pdf\\\"&amp;gt;https://amturing.acm.org/p558-lamport.pdf&amp;lt;/a&amp;gt; or vector clocks). This is what the nano ledger does via chaining blocks, just as any other blockchain. Then it connects those chains via a DAG. Syncing global time to logical time is a hard problem that can either be approached via a consensus approach which is prone to sybil attacks, via a probabilistic approach which is what most blockchains go with - essentially relying on their peers - or a centralized approach like NTP which is a no-go in a decentralized system. If you&amp;amp;#39;re interested, check e.g. this paper: &amp;lt;a href=\\\"http://soft.vub.ac.be/%7Etvcutsem/distsys/clocks.pdf\\\"&amp;gt;http://soft.vub.ac.be/~tvcutsem/distsys/clocks.pdf&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;\\n\\n&amp;lt;p&amp;gt;So what you&amp;amp;#39;re running into is the problem that while theoretically all or a relevant subset of nodes within the Nano or Bitcoin or Ethereum network could agree to call a certain time &amp;amp;quot;Monday February 12 2018 20:35:23&amp;amp;quot;, this timestamp could still be incorrect vs the outside world.&amp;lt;/p&amp;gt;\\n\\n&amp;lt;p&amp;gt;That&amp;amp;#39;s why any accurate global timestamps in software today rely on centralized information and trusted entities. The only way this can change is if machines start setting their clocks on their own accurately (e.g. chip-scale atomic clocks)&amp;lt;/p&amp;gt;\\n\\n&amp;lt;p&amp;gt;Some people think this is bad news for Nano because in traditional blockchain, timestamps are fairly important because they are used in new block validation: &amp;lt;a href=\\\"http://culubas.blogspot.co.uk/2011/05/timejacking-bitcoin_802.html\\\"&amp;gt;http://culubas.blogspot.co.uk/2011/05/timejacking-bitcoin_802.html&amp;lt;/a&amp;gt; . Timestamps are a blessing and a curse at the same time in blockchain: They allow for timing and validation of blocks and therefore regulation of coin mining, but also allow for timestamp double spend attacks. Since Nano does not use mining, it is not susceptible to those attacks.&amp;lt;/p&amp;gt;\\n\\n&amp;lt;p&amp;gt;Even with the relative importance of time and timestamps in Bitcoin, timestamp in Bitcoin are not guaranteed to be corresponding to logical time on the chain. Here&amp;amp;#39;s the bitcoin wiki talking about the bitcoin block timestamp: &amp;lt;a href=\\\"https://en.bitcoin.it/wiki/Block_timestamp\\\"&amp;gt;https://en.bitcoin.it/wiki/Block_timestamp&amp;lt;/a&amp;gt; &amp;lt;/p&amp;gt;\\n\\n&amp;lt;blockquote&amp;gt;\\n&amp;lt;p&amp;gt;A timestamp is accepted as valid if it is greater than the median timestamp of previous 11 blocks, and less than the network-adjusted time + 2 hours. &amp;amp;quot;Network-adjusted time&amp;amp;quot; is the median of the timestamps returned by all nodes connected to you. As a result, block timestamps are not exactly accurate, and they do not even need to be in order. Block times are accurate only to within an hour or two. &amp;lt;/p&amp;gt;\\n&amp;lt;/blockquote&amp;gt;\\n\\n&amp;lt;p&amp;gt;This is probably as good as it gets. Still no ordering guarantees though, and a possibilities for attacks which have been discussed again and again. There are certain guards in Bitcoin code to prevent these from happening. &amp;lt;/p&amp;gt;\\n\\n&amp;lt;p&amp;gt;So if you have somebody lecturing you about how architecturally superior coins would have a accurate and monotonically increasing timestamps, point them here, or here: &amp;lt;a href=\\\"https://cointelegraph.com/news/timestamp-hacking-debunking-the-myth-of-precision-timestamps\\\"&amp;gt;https://cointelegraph.com/news/timestamp-hacking-debunking-the-myth-of-precision-timestamps&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;\\n\\n&amp;lt;p&amp;gt;Would timestamps be convenient to have on the protocol? Yes, and that would likely be a good reason to include them. Are timestamps accurately depicting global time, and can they be used as evidence in any chain? No they can&amp;amp;#39;t.&amp;lt;/p&amp;gt;\\n\\n&amp;lt;p&amp;gt;Why are we seeing inaccurate timestamps in the block explorer? Because these are kept in a db outside of the ledger and have been set January 19. Nothing more to it.&amp;lt;/p&amp;gt;\\n\\n&amp;lt;p&amp;gt;Why do people like to babble about how this is a weakness in Nano? No clue.&amp;lt;/p&amp;gt;\\n&amp;lt;/div&amp;gt;&amp;lt;!-- SC_ON --&amp;gt;\",\n                            \"selftext\": \"Seeing lots of comments about the lack of timestamps in the protocol, and just wanted to provide some information on why objectively accurate, global time timestamps are an illusion in decentralized systems. Logical time on the other hand is achievable and is in fact achieved in Nano via the individual block chains and the directed, acyclic graph (DAG). \\n\\nGenerally, in a decentralized, distributed system, only logical time (C happened after B happened after A) can be agreed on globally (e.g. Lamport time: https://amturing.acm.org/p558-lamport.pdf or vector clocks). This is what the nano ledger does via chaining blocks, just as any other blockchain. Then it connects those chains via a DAG. Syncing global time to logical time is a hard problem that can either be approached via a consensus approach which is prone to sybil attacks, via a probabilistic approach which is what most blockchains go with - essentially relying on their peers - or a centralized approach like NTP which is a no-go in a decentralized system. If you're interested, check e.g. this paper: http://soft.vub.ac.be/~tvcutsem/distsys/clocks.pdf\\n\\nSo what you're running into is the problem that while theoretically all or a relevant subset of nodes within the Nano or Bitcoin or Ethereum network could agree to call a certain time \\\"Monday February 12 2018 20:35:23\\\", this timestamp could still be incorrect vs the outside world.\\n\\nThat's why any accurate global timestamps in software today rely on centralized information and trusted entities. The only way this can change is if machines start setting their clocks on their own accurately (e.g. chip-scale atomic clocks)\\n\\nSome people think this is bad news for Nano because in traditional blockchain, timestamps are fairly important because they are used in new block validation: http://culubas.blogspot.co.uk/2011/05/timejacking-bitcoin_802.html . Timestamps are a blessing and a curse at the same time in blockchain: They allow for timing and validation of blocks and therefore regulation of coin mining, but also allow for timestamp double spend attacks. Since Nano does not use mining, it is not susceptible to those attacks.\\n\\nEven with the relative importance of time and timestamps in Bitcoin, timestamp in Bitcoin are not guaranteed to be corresponding to logical time on the chain. Here's the bitcoin wiki talking about the bitcoin block timestamp: https://en.bitcoin.it/wiki/Block_timestamp \\n\\n&amp;gt; A timestamp is accepted as valid if it is greater than the median timestamp of previous 11 blocks, and less than the network-adjusted time + 2 hours. \\\"Network-adjusted time\\\" is the median of the timestamps returned by all nodes connected to you. As a result, block timestamps are not exactly accurate, and they do not even need to be in order. Block times are accurate only to within an hour or two. \\n\\nThis is probably as good as it gets. Still no ordering guarantees though, and a possibilities for attacks which have been discussed again and again. There are certain guards in Bitcoin code to prevent these from happening. \\n\\nSo if you have somebody lecturing you about how architecturally superior coins would have a accurate and monotonically increasing timestamps, point them here, or here: https://cointelegraph.com/news/timestamp-hacking-debunking-the-myth-of-precision-timestamps\\n\\nWould timestamps be convenient to have on the protocol? Yes, and that would likely be a good reason to include them. Are timestamps accurately depicting global time, and can they be used as evidence in any chain? No they can't.\\n\\nWhy are we seeing inaccurate timestamps in the block explorer? Because these are kept in a db outside of the ledger and have been set January 19. Nothing more to it.\\n\\nWhy do people like to babble about how this is a weakness in Nano? No clue.\",\n                            \"likes\": null,\n                            \"suggested_sort\": null,\n                            \"user_reports\": [],\n                            \"secure_media\": null,\n                            \"is_reddit_media_domain\": false,\n                            \"link_flair_text\": null,\n                            \"id\": \"7ww6bm\",\n                            \"banned_at_utc\": null,\n                            \"mod_reason_title\": null,\n                            \"view_count\": null,\n                            \"archived\": false,\n                            \"clicked\": false,\n                            \"media_embed\": {},\n                            \"report_reasons\": null,\n                            \"author\": \"ohlookaballoon\",\n                            \"num_crossposts\": 2,\n                            \"saved\": false,\n                            \"mod_reports\": [],\n                            \"can_mod_post\": false,\n                            \"is_crosspostable\": true,\n                            \"pinned\": false,\n                            \"score\": 24,\n                            \"approved_by\": null,\n                            \"over_18\": false,\n                            \"hidden\": false,\n                            \"thumbnail\": \"self\",\n                            \"edited\": false,\n                            \"link_flair_css_class\": null,\n                            \"author_flair_css_class\": null,\n                            \"contest_mode\": false,\n                            \"gilded\": 0,\n                            \"downs\": 0,\n                            \"brand_safe\": false,\n                            \"secure_media_embed\": {},\n                            \"removal_reason\": null,\n                            \"author_flair_text\": null,\n                            \"stickied\": false,\n                            \"can_gild\": true,\n                            \"thumbnail_height\": null,\n                            \"parent_whitelist_status\": null,\n                            \"name\": \"t3_7ww6bm\",\n                            \"spoiler\": false,\n                            \"permalink\": \"/r/nanocurrency/comments/7ww6bm/why_global_time_objectively_accurate_timestamps/\",\n                            \"subreddit_type\": \"public\",\n                            \"locked\": false,\n                            \"hide_score\": false,\n                            \"created\": 1518417258,\n                            \"url\": \"https://www.reddit.com/r/nanocurrency/comments/7ww6bm/why_global_time_objectively_accurate_timestamps/\",\n                            \"whitelist_status\": null,\n                            \"quarantine\": false,\n                            \"title\": \"Why global time, objectively accurate timestamps are not achievable in decentralized systems\",\n                            \"created_utc\": 1518388458,\n                            \"subreddit_name_prefixed\": \"r/nanocurrency\",\n                            \"ups\": 24,\n                            \"media\": null,\n                            \"num_comments\": 18,\n                            \"is_self\": true,\n                            \"visited\": false,\n                            \"mod_note\": null,\n                            \"is_video\": false,\n                            \"distinguished\": null\n                        }\n                    ],\n                    \"user_reports\": [],\n                    \"secure_media\": null,\n                    \"is_reddit_media_domain\": false,\n                    \"link_flair_text\": null,\n                    \"id\": \"7x3r45\",\n                    \"banned_at_utc\": null,\n                    \"mod_reason_title\": null,\n                    \"view_count\": null,\n                    \"archived\": false,\n                    \"clicked\": false,\n                    \"media_embed\": {},\n                    \"report_reasons\": null,\n                    \"author\": \"ohlookaballoon\",\n                    \"num_crossposts\": 0,\n                    \"saved\": false,\n                    \"mod_reports\": [],\n                    \"can_mod_post\": false,\n                    \"is_crosspostable\": true,\n                    \"pinned\": false,\n                    \"score\": 2,\n                    \"approved_by\": null,\n                    \"over_18\": false,\n                    \"hidden\": false,\n                    \"thumbnail\": \"default\",\n                    \"edited\": false,\n                    \"link_flair_css_class\": null,\n                    \"author_flair_css_class\": \"New\",\n                    \"contest_mode\": false,\n                    \"gilded\": 0,\n                    \"downs\": 0,\n                    \"brand_safe\": true,\n                    \"secure_media_embed\": {},\n                    \"removal_reason\": null,\n                    \"author_flair_text\": \"Redditor for 27 days.\",\n                    \"stickied\": false,\n                    \"can_gild\": true,\n                    \"thumbnail_height\": null,\n                    \"parent_whitelist_status\": \"all_ads\",\n                    \"name\": \"t3_7x3r45\",\n                    \"crosspost_parent\": \"t3_7ww6bm\",\n                    \"spoiler\": false,\n                    \"permalink\": \"/r/CryptoCurrency/comments/7x3r45/why_global_time_objectively_accurate_timestamps/\",\n                    \"subreddit_type\": \"public\",\n                    \"locked\": false,\n                    \"hide_score\": false,\n                    \"created\": 1518496223,\n                    \"url\": \"https://np.reddit.com/r/nanocurrency/comments/7ww6bm/why_global_time_objectively_accurate_timestamps/\",\n                    \"whitelist_status\": \"all_ads\",\n                    \"quarantine\": false,\n                    \"title\": \"Why global time, objectively accurate timestamps are not achievable in decentralized systems\",\n                    \"created_utc\": 1518467423,\n                    \"subreddit_name_prefixed\": \"r/CryptoCurrency\",\n                    \"ups\": 2,\n                    \"media\": null,\n                    \"num_comments\": 0,\n                    \"is_self\": false,\n                    \"visited\": false,\n                    \"mod_note\": null,\n                    \"is_video\": false,\n                    \"distinguished\": null\n                }\n            },\n</code></pre>\n"}, {"tags": ["go", "interface", "visibility", "embedding"], "comments": [{"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 2, "creation_date": 1519218477, "post_id": 48906699, "comment_id": 84819111, "body": "Have you tried doing the same ?"}], "answers": [{"comments": [{"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 1, "creation_date": 1519218588, "post_id": 48906742, "comment_id": 84819185, "body": "That is really interesting. I would have thought that <code>G</code> would be hidden because of being &quot;behind&quot; <code>b</code>. Thanks."}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1519229078, "post_id": 48906742, "comment_id": 84826832, "body": "&quot;but if it would be (along with the <code>A.b</code> field), <code>a.b.G()</code> would be called no problem.&quot; - What do you mean here. Its not clear"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 1, "creation_date": 1519229192, "post_id": 48906742, "comment_id": 84826916, "body": "@aerokite The phrasing wasn&#39;t completely right, edited it. I mean that in my example <code>a</code> is <code>nil</code>. If you would assign a non-<code>nil</code> value to it (that implements <code>subplay.A</code>), then the <code>a.G()</code> call would not panic. See edited answer."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1519230952, "post_id": 48906742, "comment_id": 84828194, "body": "@Ralph Completely reworked my answer, please check the new version."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1519231244, "post_id": 48906742, "comment_id": 84828380, "body": "The fact that public promoted values can be referenced outside of the defining package could be problematic if there is an ambiguity because of two embedded private types having the same name. Thanks for the thorough answer."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1519231391, "post_id": 48906742, "comment_id": 84828488, "body": "@Ralph Please note that the spec states <i>&quot;...promoted if <code>x.f</code> is a <b>legal</b> <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">selector</a>...&quot;</i>. If your struct embeds 2 different types both having a field or method with the same name, then <code>x.f</code> will <b>not</b> be legal, and the <code>x.f</code> selector will be a compile-time error."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1519231538, "post_id": 48906742, "comment_id": 84828598, "body": "Understood. This all started because I had a private interface that contained several private embedded interfaces. I did not want to change the embedded interfaces to public because I was too lazy to write comments for them. :-) In my case it does not matter because there is no name overlap. I can keep them private."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1519233525, "last_edit_date": 1592644375, "creation_date": 1519218468, "answer_id": 48906742, "question_id": 48906699, "link": "https://stackoverflow.com/questions/48906699/visibility-of-embedded-private-interfaces-in-go/48906742#48906742", "title": "Visibility of embedded private interfaces in Go", "body": "<h2>Embedding unexported interface in interface</h2>\n<p>Interface embedding in interface is nothing more than merging the <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> of the embedded interface into the embedder, so it becomes part of the method set of the embedder type. It doesn't matter if the embedded interface type is exported or not. Quoting from <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">Spec: Interface types:</a></p>\n<blockquote>\n<p>An interface <code>T</code> may use a (possibly qualified) interface type name <code>E</code> in place of a method specification. This is called <em>embedding</em> interface <code>E</code> in <code>T</code>; it adds all (exported and non-exported) methods of <code>E</code> to the interface <code>T</code>.</p>\n</blockquote>\n<p>All that happens in your code is that <code>A</code> will be an interface with 2 methods: <code>F() string</code> and <code>G() int</code>. There won't be a &quot;field&quot; like <code>A.b</code> because <code>A</code> is an interface type, not a struct. So this isn't particularly &quot;interesting&quot;.</p>\n<p>How can you try it?</p>\n<p>Create a folder <code>subplay</code> in any package, <code>subplay.go</code>:</p>\n<pre><code>package subplay\n\ntype b interface {\n    G() int\n}\n\ntype A interface {\n    F() string\n    b\n}\n</code></pre>\n<p>Create another <code>go</code> file that imports this <code>subplay</code>, e.g. <code>play.go</code>:</p>\n<pre><code>package main\n\nimport &quot;play/subplay&quot;\n\nfunc main() {\n    var a subplay.A\n    a.G()\n}\n</code></pre>\n<p>And it compiles. Runtime panic occurs though because <code>a</code> is not initialized (or rather left being <code>nil</code>), but if it would be, the <code>a.G()</code> call would not panic.</p>\n<p>With the following additions there will be no run-time panic:</p>\n<p>In <code>subplay.go</code>, add:</p>\n<pre><code>type aimpl struct{}\n\nfunc (aimpl) F() string { return &quot;aimpl.F() called&quot; }\nfunc (aimpl) G() int    { return 1 }\n\nfunc NewA() A {\n    return aimpl{}\n}\n</code></pre>\n<p>And in <code>play.go</code>:</p>\n<pre><code>func main() {\n    var a subplay.A\n    a = subplay.NewA()\n    a.G()\n}\n</code></pre>\n<p>The above code compiles and runs, and does not panic.</p>\n<p>Also note that you can create a type in another package that implements <code>subplay.A</code>, you do not need to refer to <code>subplay.b</code>, because all that matters is the method set. The following <code>another</code> type also implements <code>subplay.A</code>, you can place this in <code>play.go</code>:</p>\n<pre><code>type another struct{}\n\nfunc (another) F() string { return &quot;aimpl.F() called&quot; }\nfunc (another) G() int    { return 1 }\n\nfunc main() {\n    var a subplay.A\n    a = another{}\n    a.G()\n}\n</code></pre>\n<p>This again compiles and runs without run-time panic.</p>\n<h2>Embedding unexported interface in struct</h2>\n<p>A similar and more interesting case would be to embed an unexported struct (or an interface) type in a struct (and not in an interface), which &quot;truly&quot; creates an <code>A.b</code> field. Moreover, fields and methods of the embedded type get promoted to the embedder as if they would be fields or methods of the embedder. Quoting from <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Spec: Struct types:</a></p>\n<blockquote>\n<p>A field or method <code>f</code> of an embedded field in a struct <code>x</code> is called <em>promoted</em> if <code>x.f</code> is a legal <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">selector</a> that denotes that field or method <code>f</code>.</p>\n<p>Promoted fields act like ordinary fields of a struct except that they cannot be used as field names in <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literals</a> of the struct.</p>\n</blockquote>\n<p>Code outside of the defining package cannot refer to the embedded field <code>A.b</code>, this is correct, but code outside of the defining package <em>can</em> call the promoted <code>A.G()</code> method because this identifier is not lower-cased, so the restriction does not apply to it.</p>\n<p>The restriction for non-exported identifiers is enforced by the compiler when you attempt to refer to them. Writing <code>a.b.G()</code> from another package is a compile-time error, because you are referring to a non-exported identifier (<code>a.b</code>). When you write <code>a.G()</code>, you are not referring to any non-exported identifiers, only to the exported <code>a.G</code> identifier, so it is allowed.</p>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2123, "favorite_count": 0, "accepted_answer_id": 48906742, "answer_count": 1, "score": 4, "last_activity_date": 1536937127, "creation_date": 1519218341, "last_edit_date": 1536937127, "question_id": 48906699, "link": "https://stackoverflow.com/questions/48906699/visibility-of-embedded-private-interfaces-in-go", "title": "Visibility of embedded private interfaces in Go", "body": "<p>If I embed an interface with a lowercase name (private) into another interface with an uppercase name (public), I assume that code outside of the defining package cannot see the embedded private interface. Is this assumption correct?</p>\n\n<pre><code>type b interface {\n    G() int\n}\n\ntype A interface {\n    F() string\n    b\n}\n</code></pre>\n\n<p>Code outside of the defining package cannot \"see\" the embedded <code>b</code>, correct? Outside code cannot call <code>G</code> through an instance of <code>A</code>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1519217935, "post_id": 48906483, "comment_id": 84818742, "body": "Use the  <code>os&#47;exec</code> package to execute commands."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1519217944, "post_id": 48906483, "comment_id": 84818752, "body": "Why are you using <code>syscall.Exec</code> over <code>os&#47;exec</code>? btw, you&#39;re going to have trouble exec&#39;ing, as the first <code>args</code> value is not the path to the executable."}, {"owner": {"reputation": 153, "user_id": 6800168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf082fcfc36c6d73d2b68efd0a7abb57?s=128&d=identicon&r=PG&f=1", "display_name": "S. Dragomir", "link": "https://stackoverflow.com/users/6800168/s-dragomir"}, "edited": false, "score": 0, "creation_date": 1519218868, "post_id": 48906483, "comment_id": 84819394, "body": "I was using <code>syscall.Exec</code> b/c this article <a href=\"https://gobyexample.com/execing-processes\" rel=\"nofollow noreferrer\">gobyexample.com/execing-processes</a> was using it in its example"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519219755, "post_id": 48906483, "comment_id": 84820027, "body": "You\u2019re just missing the first argv for the syscall, but there\u2019s still no reason to not just use os/exec which Takes care of all the details for you."}, {"owner": {"reputation": 153, "user_id": 6800168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf082fcfc36c6d73d2b68efd0a7abb57?s=128&d=identicon&r=PG&f=1", "display_name": "S. Dragomir", "link": "https://stackoverflow.com/users/6800168/s-dragomir"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519219862, "post_id": 48906483, "comment_id": 84820110, "body": "@JimB oh god, why did i miss it"}, {"owner": {"reputation": 334, "user_id": 6076531, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eede706b03a6e2a1b7a09e1f57cb148?s=128&d=identicon&r=PG&f=1", "display_name": "quant2016", "link": "https://stackoverflow.com/users/6076531/quant2016"}, "edited": false, "score": 0, "creation_date": 1616497844, "post_id": 48906483, "comment_id": 118014805, "body": "Why not to use <code>syscall.Settimeofday</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 153, "user_id": 6800168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf082fcfc36c6d73d2b68efd0a7abb57?s=128&d=identicon&r=PG&f=1", "display_name": "S. Dragomir", "link": "https://stackoverflow.com/users/6800168/s-dragomir"}, "is_accepted": true, "score": 4, "last_activity_date": 1519218719, "creation_date": 1519218719, "answer_id": 48906858, "question_id": 48906483, "link": "https://stackoverflow.com/questions/48906483/how-to-set-systems-date-and-time-via-go-syscall/48906858#48906858", "title": "How to set systems date and time via go syscall", "body": "<p>@JimB and @Tim Cooper you are right using os/exec works like a charm...</p>\n\n<p>This is now the updated function:</p>\n\n<pre><code>func SetSystemDate(newTime time.Time) error {\n    _, lookErr := exec.LookPath(\"date\")\n    if lookErr != nil {\n        fmt.Printf(\"Date binary not found, cannot set system date: %s\\n\", lookErr.Error())\n        return lookErr\n    } else {\n        //dateString := newTime.Format(\"2006-01-2 15:4:5\")\n        dateString := newTime.Format(\"2 Jan 2006 15:04:05\")\n        fmt.Printf(\"Setting system date to: %s\\n\", dateString)\n        args := []string{\"--set\", dateString}\n        return exec.Command(\"date\", args...).Run()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 6800168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf082fcfc36c6d73d2b68efd0a7abb57?s=128&d=identicon&r=PG&f=1", "display_name": "S. Dragomir", "link": "https://stackoverflow.com/users/6800168/s-dragomir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2046, "favorite_count": 0, "accepted_answer_id": 48906858, "answer_count": 1, "score": 2, "last_activity_date": 1519218719, "creation_date": 1519217689, "last_edit_date": 1592644375, "question_id": 48906483, "link": "https://stackoverflow.com/questions/48906483/how-to-set-systems-date-and-time-via-go-syscall", "title": "How to set systems date and time via go syscall", "body": "<p>I am trying to set the linux system time and date with a go syscall, but I always get an <em>invalid date</em> error. When i execute the call on the terminal with the presumably wrong date it always ends successful.</p>\n<p>This is my test code:</p>\n<pre><code>package main\n\nimport (\n    &quot;os/exec&quot;\n    &quot;time&quot;\n    &quot;os&quot;\n    &quot;syscall&quot;\n    &quot;fmt&quot;\n)\n\nfunc main() {\n    fiveDaysFromNow := time.Now().Add(time.Hour * 24 * 5)\n    err := SetSystemDate(fiveDaysFromNow)\n    if err != nil {\n        fmt.Printf(&quot;Error: %s&quot;, err.Error())\n    }\n}\n\nfunc SetSystemDate(newTime time.Time) error {\n    binary, lookErr := exec.LookPath(&quot;date&quot;)\n    if lookErr != nil {\n        fmt.Printf(&quot;Date binary not found, cannot set system date: %s\\n&quot;, lookErr.Error())\n        return lookErr\n    } else {\n        //dateString := newTime.Format(&quot;2006-01-2 15:4:5&quot;)\n        dateString := newTime.Format(&quot;2 Jan 2006 15:04:05&quot;)\n        fmt.Printf(&quot;Setting system date to: %s\\n&quot;, dateString)\n        args := []string{&quot;--set&quot;, dateString}\n        env := os.Environ()\n        return syscall.Exec(binary, args, env)\n    }\n}\n</code></pre>\n<p>And the output I get is:</p>\n<blockquote>\n<p>Setting system date to: 26 Feb 2018 13:36:52</p>\n<p>--set: invalid date \u201826 Feb 2018 13:36:52\u2019</p>\n<p>Process finished with exit code 1</p>\n</blockquote>\n<p>Executing in the terminal:</p>\n<pre><code>date -s '26 Feb 2018 13:36:52'\n</code></pre>\n<p>nevertheless succeeds without any problems.</p>\n<p>I am testing this on Ubuntu 16.04.3 LTS with KDE installed, but this will be used on an embedded device with an custom Yocto Yogurt image. Will there be any difference?</p>\n<p>Do i need to use different formatting for the date string when using <em>syscall.Exec()</em>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2236, "user_id": 3385651, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OS7Kn.png?s=128&g=1", "display_name": "Bruno", "link": "https://stackoverflow.com/users/3385651/bruno"}, "edited": false, "score": 0, "creation_date": 1519216187, "post_id": 48905939, "comment_id": 84817547, "body": "As fas I understand GO, you dont have to create many packages as others OO languages. Take a look at some repos in Github"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519216294, "post_id": 48905939, "comment_id": 84817616, "body": "Let&#39;s see some code. &quot;/&quot; is already a constant."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519216364, "post_id": 48905939, "comment_id": 84817664, "body": "@Peter - see my update, I use it in different place&#39;s in the code"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 1, "creation_date": 1519216842, "post_id": 48906112, "comment_id": 84817988, "body": "Thank you, but for the first suggestion I need to define it in several different files, why it&#39;s better then creating constants file which I can share and use  in different files"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1519285855, "post_id": 48906112, "comment_id": 84850537, "body": "Using a constants file makes perfect sense to me in that case."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 0, "last_activity_date": 1519216594, "creation_date": 1519216594, "answer_id": 48906112, "question_id": 48905939, "link": "https://stackoverflow.com/questions/48905939/using-paths-in-different-packages-convenient-way/48906112#48906112", "title": "Using paths in different packages convenient way", "body": "<ol>\n<li><p>Set a variable, and use that everywhere:</p>\n\n<pre><code>path := \"../\"\n</code></pre>\n\n<p>or</p>\n\n<pre><code>path := \"..\" + string(os.PathSeparator)\n</code></pre>\n\n<p>then later:</p>\n\n<pre><code>dir.zip(path+tmpDirName, path+m.Id+\".zip\", path+tmpDirName)\n</code></pre>\n\n<p>This makes it very easy to change the path in the future, via a command line option, configuration, or just editing the value.</p></li>\n<li><p>Yes. <a href=\"https://golang.org/pkg/os/#pkg-constants\" rel=\"nofollow noreferrer\">os.PathSeparator</a> is the OS-specific path separator for the current architecture.</p></li>\n<li>n/a</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "is_accepted": false, "score": 0, "last_activity_date": 1522748781, "last_edit_date": 1522748781, "creation_date": 1519393526, "answer_id": 48949252, "question_id": 48905939, "link": "https://stackoverflow.com/questions/48905939/using-paths-in-different-packages-convenient-way/48949252#48949252", "title": "Using paths in different packages convenient way", "body": "<ol>\n<li>declare a global const somewhere, but I would just use \"..\" everywhere</li>\n<li>os.PathSeparator</li>\n<li>use <code>filepath.Join(\"..\", someDir, someFilename)</code></li>\n</ol>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 1, "accepted_answer_id": 48906112, "answer_count": 2, "score": -1, "last_activity_date": 1522748781, "creation_date": 1519216032, "last_edit_date": 1519216498, "question_id": 48905939, "link": "https://stackoverflow.com/questions/48905939/using-paths-in-different-packages-convenient-way", "title": "Using paths in different packages convenient way", "body": "<p>I have a program in which I use a lot \"../\" which is to go one level up\nin the file system and run some process on the directory with specific name. I have a command line tool in Go.</p>\n\n<p>I have 3 questions</p>\n\n<blockquote>\n  <ol>\n  <li>there is nicer way to do it instead of \u201c../\u201c </li>\n  <li>is there a const with which I can use instead of \u201c/\u201c</li>\n  <li>if 2 is not available should I create \u201cconstants\u201c  under that internal package to share the \u201c/\u201c between packages since I need it in\n  many place (from diff packages...)</li>\n  </ol>\n</blockquote>\n\n<p>example </p>\n\n<pre><code>   dir.zip(\"../\"+tmpDirName, \"../\"+m.Id+\".zip\", \"../\"+tmpDirName)\n</code></pre>\n"}, {"tags": ["sqlite", "go", "plot", "writer", "reader"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519216409, "post_id": 48905897, "comment_id": 84817699, "body": "You&#39;re not using an io.Reader or io.Writer at all. But to learn about those, you should go through <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">A tour of Go</a>, particularly the section on <a href=\"https://tour.golang.org/methods/21\" rel=\"nofollow noreferrer\">Readers</a>."}, {"owner": {"reputation": 73, "user_id": 9390723, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FAZ4K.png?s=128&g=1", "display_name": "sonik-88", "link": "https://stackoverflow.com/users/9390723/sonik-88"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519218443, "post_id": 48905897, "comment_id": 84819086, "body": "@Flimzy Thanks a lot. So, would you say that what I described, is possible to do it by using io.Writers?"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1519245628, "post_id": 48905897, "comment_id": 84836508, "body": "I think you&#39;re on the right track. Look closely at the return types of the WriterTo method. Interestingly, the <a href=\"https://github.com/gonum/plot/blob/master/plot.go#L455\" rel=\"nofollow noreferrer\">Save</a> method uses WriterTo itself."}, {"owner": {"reputation": 73, "user_id": 9390723, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FAZ4K.png?s=128&g=1", "display_name": "sonik-88", "link": "https://stackoverflow.com/users/9390723/sonik-88"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1519290758, "post_id": 48905897, "comment_id": 84853208, "body": "@Mark Thanks a lot! I checked the save method too. I think that being new to GO, I find Read/Write interfaces a bit complicated to understand, but I will get there I hope. Thanks"}], "owner": {"reputation": 73, "user_id": 9390723, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FAZ4K.png?s=128&g=1", "display_name": "sonik-88", "link": "https://stackoverflow.com/users/9390723/sonik-88"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 129, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1519219986, "creation_date": 1519215908, "last_edit_date": 1519219986, "question_id": 48905897, "link": "https://stackoverflow.com/questions/48905897/go-gonum-plot-storing-png-data-to-database", "title": "Go gonum plot, storing png data to Database", "body": "<p>I am generating some Histograms from the gonum/plot library in Go. Normally you would save the image, as .png for instance like this:</p>\n\n<pre><code>if err := plot.Save(2.5*vg.Inch, 2.5*vg.Inch, \"my_histo.png\"); err != nil {\n    log.Println(\"[!] error creating plot\", err)\n}\n</code></pre>\n\n<p>And this generates all the .png at the folder. No issue with that.</p>\n\n<p>I want to use this plots on a GUI(Python tk) and basically I want to store them in an SQLITE database, with a text key that corresponds to the physical object, which this histogram data was generated from, in order to access them from Python. On the GUI, there is a dictionary and you choose which histogram data you wish to display, and this is synced from the database.</p>\n\n<p>I want to save this png Histogram at a column in my Database that it is Blob type and then I want to extract it from there, when needed.</p>\n\n<p>Now, I know that this might not be the best way to implement this, but I would like to understand how Reader/Writer works, so I would like to know if I can do what I describe and if yes, how?</p>\n\n<p>For example, I can generate those png histograms on a folder and then save the location that they were saved as a text at the database, instead of sending larger amount of bytes, but I was wondering if I can avoid saving the png and save it directly at the database, as a []bytes possible?</p>\n\n<p>To that extend, I noticed that my plot object has the attribute WriterTo and I can do something like this:</p>\n\n<pre><code>n, err := plot.WriterTo(2.5*vg.Inch, 2.5*vg.Inch, \"png\")\n</code></pre>\n\n<p>This returns the number of bytes written, and if there was an error. So, what is this actually useful for?\nHow do I access my data/png, after using this WriterTo method?</p>\n"}, {"tags": ["go", "usb", "uart", "tty"], "comments": [{"owner": {"reputation": 2217, "user_id": 2604708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b62fe48f9c75ebe5e3868f9d428c125?s=128&d=identicon&r=PG", "display_name": "Dirbaio", "link": "https://stackoverflow.com/users/2604708/dirbaio"}, "edited": false, "score": 0, "creation_date": 1535580334, "post_id": 48903537, "comment_id": 91123671, "body": "I&#39;m seeing exactly the same issue! nRF52840 DK (not the preview one.) Except in my case it&#39;s &quot;USBSP&quot; with uppercase P.  When sending large messages, random chunks get overwritten with &quot;USBSP\\0\\0\\..&quot;.  Any help would be extremely appreciated!"}, {"owner": {"reputation": 489, "user_id": 7281683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7vCfC.jpg?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/7281683/martin"}, "reply_to_user": {"reputation": 2217, "user_id": 2604708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b62fe48f9c75ebe5e3868f9d428c125?s=128&d=identicon&r=PG", "display_name": "Dirbaio", "link": "https://stackoverflow.com/users/2604708/dirbaio"}, "edited": false, "score": 0, "creation_date": 1535609257, "post_id": 48903537, "comment_id": 91130173, "body": "I had this problem communicating from the PC to the DK, I didn&#39;t have this problem the other way around. What I ended up doing was adding wait-states on the PC side, so I&#39;ve simply added a tiny delay of &lt; 1 ms after sending a chunk of data (don&#39;t remember the size though). I suggest playing around with those parameters (chunk size and timeout) and think about flushing the serial every now and then."}, {"owner": {"reputation": 489, "user_id": 7281683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7vCfC.jpg?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/7281683/martin"}, "reply_to_user": {"reputation": 2217, "user_id": 2604708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b62fe48f9c75ebe5e3868f9d428c125?s=128&d=identicon&r=PG", "display_name": "Dirbaio", "link": "https://stackoverflow.com/users/2604708/dirbaio"}, "edited": false, "score": 0, "creation_date": 1535712804, "post_id": 48903537, "comment_id": 91178216, "body": "also: this might help <a href=\"https://electronics.stackexchange.com/questions/178839/what-is-the-maximum-number-of-bytes-that-can-be-sent-through-usb-to-serial-com-p/178858\" title=\"what is the maximum number of bytes that can be sent through usb to serial com p\">electronics.stackexchange.com/questions/178839/&hellip;</a> try reducing your packet size to 64 bit, little timeout inbetween"}], "answers": [{"comments": [{"owner": {"reputation": 489, "user_id": 7281683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7vCfC.jpg?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/7281683/martin"}, "edited": false, "score": 0, "creation_date": 1519397863, "post_id": 48930819, "comment_id": 84907676, "body": "the communication settings are identical (triple-checked that), normal communication works without problems. couldn&#39;t think of a usable snipped since it is literally serial.write on one side and serial.read on the other. what might be the issue is the USB-to-serial conversion on the board: it is integrated in the silicon, which is an engineering sample ... still investigating. thanks for the input on the linux distros"}, {"owner": {"reputation": 489, "user_id": 7281683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7vCfC.jpg?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/7281683/martin"}, "edited": false, "score": 0, "creation_date": 1529318265, "post_id": 48930819, "comment_id": 88814946, "body": "to close this: we&#39;ve switched MCU so it really seems that it was a problem with the USB of the nRF, didn&#39;t have this problem with the new MCU and could remove all workarounds."}], "tags": [], "owner": {"reputation": 8071, "user_id": 5230735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97305d39e366bd0cf7e0e9bf5b19c179?s=128&d=identicon&r=PG&f=1", "display_name": "ralf htp", "link": "https://stackoverflow.com/users/5230735/ralf-htp"}, "is_accepted": true, "score": 0, "last_activity_date": 1519312673, "last_edit_date": 1519312673, "creation_date": 1519312305, "answer_id": 48930819, "question_id": 48903537, "link": "https://stackoverflow.com/questions/48903537/ttyusb-uart-sends-usb-during-transfer/48930819#48930819", "title": "ttyusb/uart sends &#39;USB&#39; during transfer", "body": "<p>you have to configure the serial port. the settings for both devices for baud rate, start/stop bits, ... have to match. then there are libraries in go like <a href=\"https://github.com/jacobsa/go-serial\" rel=\"nofollow noreferrer\">https://github.com/jacobsa/go-serial</a> that enable standard serial port communication with that you can also use any hex values.</p>\n\n<p>i can not say why the <code>USBSp</code> is sent because you did not post any code and gave no information what libraries you use. very likely this is not generated by the kernel module and instead by higher layer software because the kernel module used is <code>usb-serial</code> and <code>USBSp</code> does not appear in the source code :</p>\n\n<p><a href=\"https://elixir.bootlin.com/linux/v4.0/source/drivers/usb/serial/usb-serial.c\" rel=\"nofollow noreferrer\">https://elixir.bootlin.com/linux/v4.0/source/drivers/usb/serial/usb-serial.c</a></p>\n\n<p>also not in kernel module <code>ftdi-sio</code> ( if you use ftdi chip ) </p>\n\n<p><a href=\"https://elixir.bootlin.com/linux/v4.0/source/drivers/usb/serial/ftdi_sio.c\" rel=\"nofollow noreferrer\">https://elixir.bootlin.com/linux/v4.0/source/drivers/usb/serial/ftdi_sio.c</a></p>\n\n<p>and also not in <a href=\"https://elixir.bootlin.com/linux/v3.3/source/drivers/usb/core/urb.c\" rel=\"nofollow noreferrer\">https://elixir.bootlin.com/linux/v3.3/source/drivers/usb/core/urb.c</a></p>\n"}], "owner": {"reputation": 489, "user_id": 7281683, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7vCfC.jpg?s=128&g=1", "display_name": "martin", "link": "https://stackoverflow.com/users/7281683/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 48930819, "answer_count": 1, "score": 3, "last_activity_date": 1519398163, "creation_date": 1519208817, "last_edit_date": 1519398163, "question_id": 48903537, "link": "https://stackoverflow.com/questions/48903537/ttyusb-uart-sends-usb-during-transfer", "title": "ttyusb/uart sends &#39;USB&#39; during transfer", "body": "<p>I am using Go for a project and am transmitting data to an embedded device via the serial port (ttyusb). During fast and \"large\" transfers I've noticed that the transmitted data did not match the values I'd wanted to send.</p>\n\n<p>I've tried various available libraries, in the end they all read and write using syscalls. So I've attached a Logic Analyzer to see what's going on.</p>\n\n<p>Then I noticed that the data mismatch in the output had a clear pattern: Instead of sending my data the serial port would interleave my data with the following values:</p>\n\n<p><code>0x55, 0x53, 0x42, 0x53, 0x70, 0x02</code></p>\n\n<p>Followed by zeros (<code>0x00</code>). In total 22 Bytes. The total number of bytes transmitted via the serial line did match the number of bytes I wanted to write > so essentially my data was masked with these 22 Byte-Blocks. The weird thing is that I can translate those bytes to ASCII</p>\n\n<p><code>0x55, 0x53, 0x42, 0x53, 0x70 = \"USBSp\"</code></p>\n\n<p>Now my <strong>Question</strong> is: Can't I send arbitrary data (HEX values) over the serial port or are there some control characters that I should be aware of that would make the serial port send out Identity information or the like? </p>\n\n<p><strong>[EDIT]: Additional Information:</strong></p>\n\n<ul>\n<li><p>Host is MacOS running Go v1.10; tried with <code>go.bug.st/serial.v1</code> and <code>github.com/tarm/serial</code>, various communication settings (bitrate etc.)</p></li>\n<li><p>Target is <a href=\"https://www.nordicsemi.com/eng/Products/nRF52840-Preview-DK\" rel=\"nofollow noreferrer\">nRF52840 preview development kit</a>, using Nordic nRF5 SDK v12.3.0_d7731ad (not the newest, I know, but the only one supporting other boards too). Using <code>app_uart_x</code> API</p></li>\n</ul>\n"}, {"tags": ["url", "go", "request.querystring", "querystringparameter"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519208619, "post_id": 48903374, "comment_id": 84812264, "body": "You haven&#39;t included the code you&#39;re having problems with, but the error message should make the solution pretty obvious: You need to operate on a string, not on a <code>url.URL</code>."}], "answers": [{"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": false, "score": 0, "last_activity_date": 1519208718, "creation_date": 1519208718, "answer_id": 48903493, "question_id": 48903374, "link": "https://stackoverflow.com/questions/48903374/extract-case-insensitive-query-parameter-from-url/48903493#48903493", "title": "Extract case-insensitive query parameter from URL", "body": "<pre><code>cannot use r.URL (type *url.URL) as type string in argument to strings.ToLower\n</code></pre>\n\n<p>This is because you are passing <code>ur.URL</code> instead of <code>string</code>. Get the string from url through <code>String()</code> function.</p>\n\n<pre><code>url.String()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 5, "last_activity_date": 1519210851, "creation_date": 1519210851, "answer_id": 48904210, "question_id": 48903374, "link": "https://stackoverflow.com/questions/48903374/extract-case-insensitive-query-parameter-from-url/48904210#48904210", "title": "Extract case-insensitive query parameter from URL", "body": "<p>*URL.Query() returns a value of type url.Values, which is just a <code>map[string][]string</code> with a few extra methods.</p>\n\n<p>Since URL values are by definition case-sensitive, you will have to access the map directly.</p>\n\n<pre><code>var query url.Values\n\nfor k, vs := range query {\n    if strings.ToLower(k) == \"ok\" {\n        // do something with vs\n    }\n}\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/7YVuxI3GO6X\" rel=\"noreferrer\">https://play.golang.org/p/7YVuxI3GO6X</a></p>\n"}], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1843, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1519211035, "creation_date": 1519208352, "last_edit_date": 1519211035, "question_id": 48903374, "link": "https://stackoverflow.com/questions/48903374/extract-case-insensitive-query-parameter-from-url", "title": "Extract case-insensitive query parameter from URL", "body": "<p>I am trying to extract the case-insensitive query parameter <code>/staging/ec/23463/front-view-72768.jpg?angle=90&amp;or=0x0&amp;wd=400&amp;ht=200</code> from the URL. When I try to convert the whole URL in lowercase it throws the following exception :</p>\n\n<pre><code>cannot use r.URL (type *url.URL) as type string in argument to strings.ToLower\n</code></pre>\n\n<p>I printed the value of URL which says underlying it stores all the query strings as map i.e. <code>map[angle:[90] or:[0x0] wd:[400] ht:[200]]</code>. Hence I will get the correct value using this <code>r.URL.Query().Get(\"or\")</code> But if query string comes out <code>Or</code>. It will fail.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1233, "user_id": 4983242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQbOP.jpg?s=128&g=1", "display_name": "Dharma Saputra", "link": "https://stackoverflow.com/users/4983242/dharma-saputra"}, "edited": false, "score": 0, "creation_date": 1519206693, "post_id": 48902369, "comment_id": 84810758, "body": "I think this package worth to try <a href=\"https://godoc.org/github.com/pkg/sftp\" rel=\"nofollow noreferrer\">godoc.org/github.com/pkg/sftp</a>. Never use it, but after fast reading the doc, it more roubust than the package that you use above. Hope it helps."}, {"owner": {"reputation": 739, "user_id": 3390851, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/HEm4K.jpg?s=128&g=1", "display_name": "Katiyman", "link": "https://stackoverflow.com/users/3390851/katiyman"}, "reply_to_user": {"reputation": 1233, "user_id": 4983242, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQbOP.jpg?s=128&g=1", "display_name": "Dharma Saputra", "link": "https://stackoverflow.com/users/4983242/dharma-saputra"}, "edited": false, "score": 0, "creation_date": 1519207100, "post_id": 48902369, "comment_id": 84811091, "body": "Yes its better only thing is that i have the limit of using scp"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1519232127, "post_id": 48902369, "comment_id": 84829049, "body": "scp is the same as sftp internally. You can use it."}], "owner": {"reputation": 739, "user_id": 3390851, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/HEm4K.jpg?s=128&g=1", "display_name": "Katiyman", "link": "https://stackoverflow.com/users/3390851/katiyman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 784, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1519205499, "creation_date": 1519205499, "question_id": 48902369, "link": "https://stackoverflow.com/questions/48902369/copy-dir-from-local-server-to-the-remote-server-using-scp-in-golang", "title": "Copy Dir from local server to the remote server using SCP in GOLANG", "body": "<p>I am using </p>\n\n<p>github.com/tmc/scp</p>\n\n<p>package for copying files from the local server to remote server, I found the implementation easy, but when i use this for copying the directory it doesn't work properly.\nIt takes the directory path also as a file and just creates a file with directory name in the remote server.</p>\n\n<p>My current code implementation is below  </p>\n\n<pre><code>//PerformSCP Input keypath, remote ip,ssh port , source dir, destn dir, remote user\nfunc PerformSCP(keyPath, remoteIP, sshPort, srcDir, destDir, remoteUser string) error {\n    Debug(\"Inside PerformSCP\")\n    key, err := getKeyFile(keyPath)\n    if err != nil {\n        return err\n    }\n\n    // Define the Client Config\n    config := &amp;ssh.ClientConfig{\n        User: \"root\",\n        Auth: []ssh.AuthMethod{\n            ssh.PublicKeys(key),\n        },\n        HostKeyCallback: func(hostname string, remote net.Addr, key ssh.PublicKey) error {\n            return nil\n        },\n    }\n    client, err := ssh.Dial(\"tcp\", remoteIP+\":\"+sshPort, config)\n    if err != nil {\n        return err\n    }\n\n    srcFileList, _ := SearchDir(srcDir)//gives list of all file and folder paths within the folder path passed\n    for _, k := range srcFileList {\n        session, err := client.NewSession() // because of 'StdinPipe after process started' error need to close and then again create session for all copy\n        if err != nil {\n            return err\n        }\n\n        err = scp.CopyPath(k, destDir, session)\n        if err != nil {\n            fmt.Println(err.Error())\n            return err\n        }\n        session.Close()\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Is there any other package which can help me with folder copy using scp</p>\n\n<p>I post this question so it helps me as well others having same requirement in the future as well</p>\n\n<p>TIA</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7555445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea03d022cf88d2fff5a3a37175c4e10a?s=128&d=identicon&r=PG&f=1", "display_name": "Atonium", "link": "https://stackoverflow.com/users/7555445/atonium"}, "edited": false, "score": 0, "creation_date": 1519211224, "post_id": 48902054, "comment_id": 84814162, "body": "<code>go version</code>&#39;s output is something like 1.9.4 -- Not booted into Linux so I can&#39;t say with certainty. So thank you."}, {"owner": {"reputation": 21, "user_id": 7555445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea03d022cf88d2fff5a3a37175c4e10a?s=128&d=identicon&r=PG&f=1", "display_name": "Atonium", "link": "https://stackoverflow.com/users/7555445/atonium"}, "edited": false, "score": 1, "creation_date": 1519266204, "post_id": 48902054, "comment_id": 84843594, "body": "Btw, Peter&#39;s answer should be voted best if anyone has the rep to do it. Upgrading to 1.10 solved my issues. I did have to change <code>keyBytes.PublicKey</code> to <code>&amp;keyBytes.PublicKey</code> since the function requires type <code>*rsa.PublicKey</code>. Thanks Peter!"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1519204980, "last_edit_date": 1519204980, "creation_date": 1519204627, "answer_id": 48902054, "question_id": 48901966, "link": "https://stackoverflow.com/questions/48901966/undefined-x509-marshalpkcs1publickey-when-calling-on-rsa-publickey/48902054#48902054", "title": "undefined: x509.MarshalPKCS1PublicKey when calling on *rsa.PublicKey", "body": "<p>x509.MarshalPKCS1PublicKey is <a href=\"https://golang.org/doc/go1.10#crypto/x509\" rel=\"nofollow noreferrer\">new in Go 1.10</a>. You are probably running an older version.</p>\n\n<p>If you can't upgrade: <a href=\"https://github.com/golang/go/commit/9dbeb92711b86ed4f0a37ad6ce465fb2d9053f2f\" rel=\"nofollow noreferrer\">the function is very simple</a> and you can just copy it into your own package:</p>\n\n<pre><code>// pkcs1PublicKey reflects the ASN.1 structure of a PKCS#1 public key.\ntype pkcs1PublicKey struct {\n    N *big.Int\n    E int\n}\n\n// MarshalPKCS1PublicKey converts an RSA public key to PKCS#1, ASN.1 DER form.\nfunc MarshalPKCS1PublicKey(key *rsa.PublicKey) []byte {\n    derBytes, _ := asn1.Marshal(pkcs1PublicKey{\n            N: key.N,\n            E: key.E,\n    })\n    return derBytes\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1506, "user_id": 8689709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cd57855e7bff23fbca35abc8ddc0073?s=128&d=identicon&r=PG", "display_name": "Bill Zelenko", "link": "https://stackoverflow.com/users/8689709/bill-zelenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1586280902, "creation_date": 1586280902, "answer_id": 61085983, "question_id": 48901966, "link": "https://stackoverflow.com/questions/48901966/undefined-x509-marshalpkcs1publickey-when-calling-on-rsa-publickey/61085983#61085983", "title": "undefined: x509.MarshalPKCS1PublicKey when calling on *rsa.PublicKey", "body": "<p>RSA public key can be generated this way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"fmt\"\n    \"golang.org/x/crypto/ssh\"\n)\n\nfunc main(){\n    key, b, err := generatePrivateKey()\n    if err != nil{\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Println(string(b))\n\n    public2, err := generateSSHPublicKey(key)\n    if err != nil{\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(string(public2))\n}\n\nfunc generatePrivateKey() (*rsa.PrivateKey, []byte, error) {\n    // keyBytes, err := rsa.GenerateKey(rand.Reader, 2048)\n    keyBytes, err := rsa.GenerateKey(rand.Reader, 4096)\n    if err != nil {\n        return nil, nil, err\n    }\n\n    certBytes := new(bytes.Buffer)\n\n    err = pem.Encode(certBytes, &amp;pem.Block{Type: \"RSA PRIVATE KEY\", Bytes: x509.MarshalPKCS1PrivateKey(keyBytes)})\n    if err != nil{\n        return nil, nil, err\n    }\n\n    return keyBytes, certBytes.Bytes(), nil\n}\n\nfunc generateSSHPublicKey(key *rsa.PrivateKey) ([]byte, error){\n\n    public, err := ssh.NewPublicKey(&amp;key.PublicKey) // *rsaPublicKey\n    if err != nil{\n        return nil, err\n    }\n\n    certBytes := new(bytes.Buffer)\n\n    err = pem.Encode(certBytes, &amp;pem.Block{Type: \"PUBLIC KEY\", Bytes: public.Marshal()})\n    if err != nil{\n        return nil, err\n    }\n\n    return certBytes.Bytes(), nil\n}\n\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 7555445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea03d022cf88d2fff5a3a37175c4e10a?s=128&d=identicon&r=PG&f=1", "display_name": "Atonium", "link": "https://stackoverflow.com/users/7555445/atonium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 746, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1586280902, "creation_date": 1519204353, "question_id": 48901966, "link": "https://stackoverflow.com/questions/48901966/undefined-x509-marshalpkcs1publickey-when-calling-on-rsa-publickey", "title": "undefined: x509.MarshalPKCS1PublicKey when calling on *rsa.PublicKey", "body": "<p>I'm having trouble accessing the <code>PublicKey</code> field of <code>*rsa.PrivateKey</code></p>\n\n<p>Whenever I call <code>x509.MarshalPKCS1PublicKey(keyBytes.PublicKey)</code> in the code below, I get:</p>\n\n<pre><code>[tony@localhost app]$ go run gencsr.go\n# command-line-arguments\n./gencsr.go:37:90: undefined: x509.MarshalPKCS1PublicKey\n</code></pre>\n\n<p>As you can see, I've included the <code>x509</code> package and I'm able to access <code>keyBytes.PublicKey</code> and see that it's of type <code>PublicKey</code>.</p>\n\n<p>Sources:<br>\n<a href=\"https://golang.org/pkg/crypto/x509/#MarshalPKCS1PublicKey\" rel=\"nofollow noreferrer\">crypto/x509</a><br>\n<a href=\"https://golang.org/pkg/crypto/rsa/#PrivateKey\" rel=\"nofollow noreferrer\">crypto/rsa</a></p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"crypto/x509/pkix\"\n    \"encoding/asn1\"\n    \"encoding/pem\"\n    \"fmt\"\n)\n\nvar oidEmailAddress = asn1.ObjectIdentifier{1, 2, 840, 113549, 1, 9, 1}\n\nfunc main() {\n\n    email := \"\"\n    subj := pkix.Name{\n        CommonName:         \"example.com\",\n        Country:            []string{\"US\"},\n        Province:           []string{\"New York\"},\n        Locality:           []string{\"Albany\"},\n        Organization:       []string{\"My Company Ltd\"},\n        OrganizationalUnit: []string{\"IT\"},\n    }\n    bits := 4096\n\n    key, csr := genCSR(subj, email, bits)\n    fmt.Printf(key)\n    fmt.Printf(csr)\n\n}\n\nfunc genCSR(subj pkix.Name, email string, bits int) (pemKey, csr string) {\n\n    keyBytes, _ := rsa.GenerateKey(rand.Reader, bits)\n    pemPubKey := string(pem.EncodeToMemory(&amp;pem.Block{Type: \"RSA PUBLIC KEY\", Bytes: x509.MarshalPKCS1PublicKey(keyBytes.PublicKey)}))\n    pemKey = string(pem.EncodeToMemory(&amp;pem.Block{Type: \"RSA PRIVATE KEY\", Bytes: x509.MarshalPKCS1PrivateKey(keyBytes)}))\n    fmt.Printf(pemPubKey)\n\n    rawSubj := subj.ToRDNSequence()\n    if len(email) &gt; 0 {\n        rawSubj = append(rawSubj, []pkix.AttributeTypeAndValue{\n            {Type: oidEmailAddress, Value: email},\n        })\n    }\n\n    asn1Subj, _ := asn1.Marshal(rawSubj)\n    template := x509.CertificateRequest{\n        RawSubject:         asn1Subj,\n        SignatureAlgorithm: x509.SHA256WithRSA,\n    }\n\n    csrBytes, _ := x509.CreateCertificateRequest(rand.Reader, &amp;template, keyBytes)\n    csr = string(pem.EncodeToMemory(&amp;pem.Block{Type: \"CERTIFICATE REQUEST\", Bytes: csrBytes}))\n\n    return pemKey, csr\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519201832, "post_id": 48901154, "comment_id": 84807741, "body": "Thank you! Any recommendations on keeping up with the latest recommended methods with newer Go versions of doing something? Often I land up on google results which are doing some hackery to accomplish something which is not needed anymore but I just don&#39;t know that. Makes sense?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519202018, "post_id": 48901154, "comment_id": 84807842, "body": "@Ashfame: Read the release notes for every new Go release."}, {"owner": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519202523, "post_id": 48901154, "comment_id": 84808103, "body": "@FlimzyThat&#39;s doable when I have gained some experience with the language but difficult when just starting out with a language."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519202728, "post_id": 48901154, "comment_id": 84808197, "body": "@Ashfame: The release notes are pretty short for every version. It shouldn&#39;t be very intimidating at all. Skip over the parts that don&#39;t interest you."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519202848, "post_id": 48901154, "comment_id": 84808249, "body": "You can start <a href=\"https://golang.org/doc/go1.10\" rel=\"nofollow noreferrer\">here</a> with the Go 1.10 release notes which was released just recently."}, {"owner": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519203002, "post_id": 48901154, "comment_id": 84808330, "body": "Yep checked that out. I guess it will start making sense sooner or later. But to start with, I don&#39;t even understand what I am looking to extract out of those release notes. Like, I am not up to speed up on things as I am just beginning, so what has changed is less significant for me vs a guide dictating how to do things properly."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519203437, "post_id": 48901154, "comment_id": 84808592, "body": "@Ashfame: Well, you asked how to keep up to date with recommendations with newer versions of Go. There&#39;s really only one answer :)"}, {"owner": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519203635, "post_id": 48901154, "comment_id": 84808716, "body": "True, I guess I recognize this problem now that I have experience and starting with a new language. How would you answer this: What&#39;s a Comprehensive / Definitive guide to becoming a badass go developer? And you can only answer in definitive manner :P"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 6, "last_activity_date": 1519201620, "last_edit_date": 1592644375, "creation_date": 1519201620, "answer_id": 48901154, "question_id": 48900772, "link": "https://stackoverflow.com/questions/48900772/specify-timeout-when-tracing-http-request-in-go/48901154#48901154", "title": "Specify timeout when tracing HTTP request in Go", "body": "<blockquote>\n<p>I know the usual method of specifying a timeout with HTTP requests by doing:</p>\n<pre><code>httpClient := http.Client{\n    Timeout: time.Duration(5 * time.Second),\n}\n</code></pre>\n</blockquote>\n<p>Actually, the preferred method is to use a <a href=\"https://golang.org/pkg/context/\" rel=\"noreferrer\">context.Context</a> on the request. The method you've used is just a short-cut suitable for simple use cases.</p>\n<pre><code>req, err := http.NewRequest(http.MethodGet, url, nil)\nif err != nil {\n    return nil, err\n}\nctx, cancel := context.WithTimeout(context.Background(), 5 * time.Second)\ndefer cancel()\nreq = req.WithContext(ctx)\n</code></pre>\n<p>And this method should work nicely for your situation as well.</p>\n"}], "owner": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1492, "favorite_count": 1, "accepted_answer_id": 48901154, "answer_count": 1, "score": 5, "last_activity_date": 1519201620, "creation_date": 1519200077, "last_edit_date": 1519201455, "question_id": 48900772, "link": "https://stackoverflow.com/questions/48900772/specify-timeout-when-tracing-http-request-in-go", "title": "Specify timeout when tracing HTTP request in Go", "body": "<p>I know the usual method of specifying a timeout with HTTP requests by doing:</p>\n\n<pre><code>httpClient := http.Client{\n    Timeout: time.Duration(5 * time.Second),\n}\n</code></pre>\n\n<p>However, I can't seem to figure out how to do the same when tracing HTTP requests. Here is the piece of code I am working with:</p>\n\n<pre><code>func timeGet(url string) (httpTimingBreakDown, error) {\n    req, _ := http.NewRequest(\"GET\", url, nil)\n\n    var start, connect, dns, tlsHandshake time.Time\n    var timingData httpTimingBreakDown\n    timingData.url = url\n\n    trace := &amp;httptrace.ClientTrace{\n        TLSHandshakeStart:    func() { tlsHandshake = time.Now() },\n        TLSHandshakeDone:     func(cs tls.ConnectionState, err error) { timingData.tls = time.Since(tlsHandshake) },\n    }\n\n    req = req.WithContext(httptrace.WithClientTrace(req.Context(), trace))\n    start = time.Now()\n\n    http.DefaultTransport.(*http.Transport).ResponseHeaderTimeout = time.Second * 10 // hacky way, worked earlier but don't work anymore\n\n    if _, err := http.DefaultTransport.RoundTrip(req); err != nil {\n        fmt.Println(err)\n        return timingData, err\n    }\n\n    timingData.total = time.Since(start)\n\n    return timingData, nil\n}\n</code></pre>\n\n<p>I am firing this function inside a goroutine. My sample data set is 100 urls. All goroutines fire, but eventually the program ends in 30+ secs as if the timeout is 30secs.</p>\n\n<p>Earlier I made the same to work by using the hacky way of changing the default inside of it to 10 secs and anything that took too long, timed out and the program ended at 10.xxx secs but now its taking 30.xx secs.</p>\n\n<p>What would be a proper way of specifying a timeout in this scenario?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519200484, "post_id": 48900617, "comment_id": 84807016, "body": "I use this tool to generate a struct to hold JSON response - <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a>"}, {"owner": {"reputation": 313, "user_id": 9239185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3586d9a7d60fc4007416053c1e3e73f7?s=128&d=identicon&r=PG&f=1", "display_name": "MengCheng Wei", "link": "https://stackoverflow.com/users/9239185/mengcheng-wei"}, "reply_to_user": {"reputation": 1683, "user_id": 551713, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1CwVu.jpg?s=128&g=1", "display_name": "Ashish Kumar - Ashfame", "link": "https://stackoverflow.com/users/551713/ashish-kumar-ashfame"}, "edited": false, "score": 0, "creation_date": 1519201092, "post_id": 48900617, "comment_id": 84807351, "body": "Thanks, I&#39;ve tried this, but it only generate the first element&#39;s struct for me, so it will conversion fail when processing 2nd and 3rd elements."}], "answers": [{"tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": false, "score": 0, "last_activity_date": 1519200356, "last_edit_date": 1519200356, "creation_date": 1519199625, "answer_id": 48900677, "question_id": 48900617, "link": "https://stackoverflow.com/questions/48900617/how-do-i-map-dynamic-json-response-to-go-struct/48900677#48900677", "title": "How do I map dynamic JSON response to GO struct?", "body": "<p>This should work for you</p>\n\n<pre><code>type Test []struct {\n    Data map[string]interface{} `json:\"Data\"`\n    Type int `json:\"Type\"`\n}\n</code></pre>\n\n<p>since the only variable keys and values are in Data, make that a map instead and look for the keys inside based on the type received</p>\n"}], "owner": {"reputation": 313, "user_id": 9239185, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3586d9a7d60fc4007416053c1e3e73f7?s=128&d=identicon&r=PG&f=1", "display_name": "MengCheng Wei", "link": "https://stackoverflow.com/users/9239185/mengcheng-wei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 350, "favorite_count": 0, "closed_date": 1519201654, "answer_count": 1, "score": -1, "last_activity_date": 1519200356, "creation_date": 1519199376, "question_id": 48900617, "link": "https://stackoverflow.com/questions/48900617/how-do-i-map-dynamic-json-response-to-go-struct", "closed_reason": "Duplicate", "title": "How do I map dynamic JSON response to GO struct?", "body": "<p>I am new to golang and trying to parse some response from a web service, and the response looks like:</p>\n\n<pre><code>[\n  {\n    \"Data\": {\n      \"KeyA\": 1,\n      \"KeyB\": 2\n    },\n    \"Type\": 0\n  },\n  {\n    \"Data\": {\n      \"KeyX\": \"ValueX\",\n      \"KeyY\": 999\n    },\n    \"Type\": 1\n  },\n  {\n    \"Data\": {\n      \"Val\": 123,\n      \"Id\": \"999\",\n      \"Cnt\": 100\n    },\n    \"Type\": 2\n  }\n]\n</code></pre>\n\n<p>You can see that each element has a Key \"Data\" and \"Type\" (Must), but with different 'Type' comes the different 'Data' field.</p>\n\n<p>Could you please suggest a efficiency way to construct this kind of response to Golang structure?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519198267, "post_id": 48899505, "comment_id": 84805903, "body": "You are asking the go tool to run TestSomeController only and are now wondering why TestAuthUserController doesn&#39;t run? You are getting exactly what you ordered."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1519201295, "post_id": 48899505, "comment_id": 84807447, "body": "Don&#39;t use <code>TestMain</code>. Just have each test instead call the setup function directly."}, {"owner": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519202640, "post_id": 48899505, "comment_id": 84808154, "body": "@Peter, I ask to run TestSomeController, but my TestAuthUserController must be called in TestMain(m *testing.M), and TestMain is run in all cases..."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519202852, "post_id": 48899505, "comment_id": 84808250, "body": "If TestAuthUserController isn&#39;t a test, but rather some setup code, don&#39;t make it look like a test."}, {"owner": {"reputation": 904, "user_id": 2759462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de467ec1a458adebfcad737f12070b17?s=128&d=identicon&r=PG", "display_name": "Rafael Barros", "link": "https://stackoverflow.com/users/2759462/rafael-barros"}, "edited": false, "score": 0, "creation_date": 1549394417, "post_id": 48899505, "comment_id": 95884374, "body": "I&#39;m having the same problem. No solution yet."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "edited": false, "score": 0, "creation_date": 1519198935, "post_id": 48900237, "comment_id": 84806232, "body": "in my tests this case works too. But if you will  add any other unit test and run it in the same order, then <code>TestAuthUserController</code> will be not called..."}, {"owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "reply_to_user": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "edited": false, "score": 0, "creation_date": 1519199323, "post_id": 48900237, "comment_id": 84806415, "body": "I added <b>TestSomeController(t *testing.T)</b> in main_test.go file and run  <b>go test -run TestSomeController</b> it works also.."}, {"owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "reply_to_user": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "edited": false, "score": 0, "creation_date": 1519200005, "post_id": 48900237, "comment_id": 84806760, "body": "I created also name_test.go and put <b>TestSomeController(m *testing.T)</b> with <b>TestAnotherMain(m *testing.T)</b> and it works also. take note that if you add another unit test(test file) you must add suffix &quot;_test&quot;."}, {"owner": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "edited": false, "score": 0, "creation_date": 1519200128, "post_id": 48900237, "comment_id": 84806823, "body": "your <code>func TestMain(m *testing.T)</code> accept testing.T pointer  in place of testing.M. I tried your example. But when I run <code>go test -run TestAuthUserController</code> I have this output: <code>create user... testCreateUserSuccessBeforeAuthorize authorize user... testAuthorizeUserSuccess </code> It seems programm doesn&#39;t call <code>TestMain</code>"}, {"owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "reply_to_user": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "edited": false, "score": 0, "creation_date": 1519200404, "post_id": 48900237, "comment_id": 84806979, "body": "If you want to call TestMain, you can put TestMain inside your ** TestAuthUserController** like this <b>t.Run(&quot;testMain()&quot;, TestMain)</b> and run it again go test -run TestAuthUserController"}, {"owner": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "edited": false, "score": 0, "creation_date": 1519201300, "post_id": 48900237, "comment_id": 84807451, "body": "I have a lot of controllers and tests for them (in different files) and I want to be able to run them either all together or each separately. But in any case, <code>TestAuthUserController</code> should be called first. if I put TestMain to my <b>TestAuthUserController</b> and apply <code>t.Run</code>, I will be not able do this, because if I run  <code>go test -run TestAuthUserController</code> it&#39;s ok, and if I run <code>go test -run TestSomeController</code> it&#39;s not."}, {"owner": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "edited": false, "score": 0, "creation_date": 1519201602, "post_id": 48900237, "comment_id": 84807618, "body": "please see my screenshot above"}, {"owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "reply_to_user": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "edited": false, "score": 0, "creation_date": 1519202041, "post_id": 48900237, "comment_id": 84807852, "body": "TestMain runs in main goroutine. so it is impossible to call without using r.Run in your test method (TestAuthUserController)."}], "tags": [], "owner": {"reputation": 306, "user_id": 2536252, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34e29959d1027ff89ba83767e9d9517a?s=128&d=identicon&r=PG", "display_name": "Adriel Artiza", "link": "https://stackoverflow.com/users/2536252/adriel-artiza"}, "is_accepted": false, "score": 0, "last_activity_date": 1519197959, "creation_date": 1519197959, "answer_id": 48900237, "question_id": 48899505, "link": "https://stackoverflow.com/questions/48899505/calling-distinct-test-func-in-testmain-in-golang/48900237#48900237", "title": "Calling distinct test func in TestMain() in Golang", "body": "<p>I've created main.go file and main_test.go for test file. In main_test.go file it contains below code:</p>\n\n<pre><code>func TestMain(m *testing.T)  {\n    fmt.Println(\"Testing is running...\")\n    AuthUserController()\n}\n\nfunc AuthUserController() func(t *testing.T){\n    fmt.Println(\"in wrapper\")\n    return TestAuthUserController\n}\n\n\nfunc testCreateUserSuccessBeforeAuthorize(m *testing.T)  {\n    fmt.Println(\"create user... testCreateUserSuccessBeforeAuthorize\")\n}\n\nfunc testAuthorizeUserSuccess(m *testing.T)  {\n    fmt.Println(\"authorize user... testAuthorizeUserSuccess\")\n}\n\nfunc TestAuthUserController(t *testing.T) {\n    t.Run(\"testCreateUserSuccessBeforeAuthorize\", testCreateUserSuccessBeforeAuthorize)\n    t.Run(\"testAuthorizeUserSuccess\", testAuthorizeUserSuccess)\n}\n</code></pre>\n\n<p>When you run this command: <strong>go test -run TestAuthUserController</strong></p>\n\n<pre><code>//Here is the output:\nTesting is running... testCreateUserSuccessBeforeAuthorize\nTesting is running... testAuthorizeUserSuccess\nPASS\n</code></pre>\n\n<p>Hope that this is what your expected. :)</p>\n"}, {"tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": false, "score": 0, "last_activity_date": 1531141203, "creation_date": 1531141203, "answer_id": 51246206, "question_id": 48899505, "link": "https://stackoverflow.com/questions/48899505/calling-distinct-test-func-in-testmain-in-golang/51246206#51246206", "title": "Calling distinct test func in TestMain() in Golang", "body": "<pre><code>func setupTestUserAndAuthorise(){\n   // create user, authorise\n\n   // return User\n}\n\nfunc deleteTestUser(user User){\n   // delete user and other clean up actions\n}\n\nfunc TestCase1(t *testing.T){\n    user := setupUserAndAuthorise()\n    defer deleteTestUser(user)\n\n    // use this user in test\n}\n</code></pre>\n\n<p>You can create a function that creates a new user, authorises and returns it.\nAfter the test runs, you can call a cleanup function that deletes user etc.</p>\n\n<p>The order of execution of unit tests should not affect the outcome of tests.</p>\n"}], "owner": {"reputation": 11, "user_id": 9235176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/252a477b5e898f1cac7b2b9be503b4c8?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Savostin", "link": "https://stackoverflow.com/users/9235176/vladimir-savostin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1099, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1531141203, "creation_date": 1519194803, "last_edit_date": 1519201243, "question_id": 48899505, "link": "https://stackoverflow.com/questions/48899505/calling-distinct-test-func-in-testmain-in-golang", "title": "Calling distinct test func in TestMain() in Golang", "body": "<p>I'm trying to test my http controllers and I use TestMain func to prepare my testing, but before I run all test requests I need to first run <code>TestAuthUserController</code> test, which creates and authorizes the user. For this I use wrapper func, which helps me to call <code>TestAuthUserController</code>:</p>\n\n<pre><code>func TestMain(m *testing.M)  {\n    //some prepearing steps\n    AuthUserController()//create and authorize user before all other tests\n    m.Run()\n    fmt.Println(\"after all in main\")\n    dbMdm.End()\n}\n\n    //AuthUserController is a wrapper func to run TestAuthUserController before all other tests in TestMain func\nfunc AuthUserController() func(t *testing.T){\n    fmt.Println(\"in wrapper\")\n    return TestAuthUserController\n}\n</code></pre>\n\n<p>this is my <code>TestAuthUserController</code>:</p>\n\n<pre><code>//TestAuthUserController tests in series creation of new user and his authorization\nfunc TestAuthUserController(t *testing.T) {\n    t.Run(\"testCreateUserSuccessBeforeAuthorize\", testCreateUserSuccessBeforeAuthorize)\n    t.Run(\"testAuthorizeUserSuccess\", testAuthorizeUserSuccess)\n}\n</code></pre>\n\n<p>when I run command <code>go test</code> - it's ok! the TestMain call it successfuly,\nBut when I'm trying to run some test separately, for example <code>go test -run TestSomeController</code> it failed, because of <code>TestAuthUserController</code> doesn't runs in this case.</p>\n"}, {"tags": ["go", "middleware"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519198497, "post_id": 48899277, "comment_id": 84806009, "body": "You don&#39;t need to break the loop. The loop is long done by the time the HandlerFunc is called. Simply return without calling h.ServeHTTP."}, {"owner": {"reputation": 1351, "user_id": 3987993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j1isS.jpg?s=128&g=1", "display_name": "Ankit Kumar", "link": "https://stackoverflow.com/users/3987993/ankit-kumar"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519199127, "post_id": 48899277, "comment_id": 84806322, "body": "Hi @Peter Can you please explain, how the execution will be done if have 3 middleware and I&#39;m sending back response from middle-ware 2"}], "answers": [{"comments": [{"owner": {"reputation": 1351, "user_id": 3987993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j1isS.jpg?s=128&g=1", "display_name": "Ankit Kumar", "link": "https://stackoverflow.com/users/3987993/ankit-kumar"}, "edited": false, "score": 0, "creation_date": 1519195043, "post_id": 48899454, "comment_id": 84804324, "body": "yes that i have, Just sample code I&#39;ve written here, even after having sending the http status remaining middle-ware will be invoked by the <code>for</code> loop. I want to break the for loop somehow"}, {"owner": {"reputation": 1351, "user_id": 3987993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j1isS.jpg?s=128&g=1", "display_name": "Ankit Kumar", "link": "https://stackoverflow.com/users/3987993/ankit-kumar"}, "edited": false, "score": 0, "creation_date": 1519199843, "post_id": 48899454, "comment_id": 84806680, "body": "hey I&#39;m still confused, I don&#39;t see any difference in using recursive function instead of for loop, Can you plz explain the control flow"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1519200483, "post_id": 48899454, "comment_id": 84807014, "body": "gorilla/mux can chain middleware now, so if you&#39;re using that then you can probably refactor to get rid of alice."}, {"owner": {"reputation": 6967, "user_id": 7803650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WH7uu.png?s=128&g=1", "display_name": "Oswin Noetzelmann", "link": "https://stackoverflow.com/users/7803650/oswin-noetzelmann"}, "edited": false, "score": 0, "creation_date": 1519200875, "post_id": 48899454, "comment_id": 84807233, "body": "I added a sentence about how the middleware chain stops when an auth fails, if that was your question."}], "tags": [], "owner": {"reputation": 6967, "user_id": 7803650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WH7uu.png?s=128&g=1", "display_name": "Oswin Noetzelmann", "link": "https://stackoverflow.com/users/7803650/oswin-noetzelmann"}, "is_accepted": false, "score": 1, "last_activity_date": 1519202087, "last_edit_date": 1519202087, "creation_date": 1519194576, "answer_id": 48899454, "question_id": 48899277, "link": "https://stackoverflow.com/questions/48899277/what-is-the-best-way-to-send-back-the-response-from-the-middle-ware-in-golang/48899454#48899454", "title": "What is the best way to send back the response from the middle-ware in Golang", "body": "<p>Middleware is typically chained. There are frameworks that can do it for you. A sleek example is <a href=\"https://github.com/justinas/alice\" rel=\"nofollow noreferrer\">Alice</a>.</p>\n\n<pre><code>chain := alice.New(th.Throttle, timeoutHandler, nosurf.NewPure).Then(myHandler)\n</code></pre>\n\n<p>If you want to do it yourself you can use recursion to avoid a for loop. For example (from this <a href=\"https://gist.github.com/husobee/fd23681261a39699ee37\" rel=\"nofollow noreferrer\">link</a>):</p>\n\n<pre><code>// buildChain builds the middlware chain recursively, functions are first class\nfunc buildChain(f http.HandlerFunc, m ...middleware) http.HandlerFunc {\n        // if our chain is done, use the original handlerfunc\n        if len(m) == 0 {\n                return f\n        }\n        // otherwise nest the handlerfuncs\n        return m[0](buildChain(f, m[1:cap(m)]...))\n}\n</code></pre>\n\n<p>Each middleware receives the next as parameter. As such the next has to be manually called by the previous handler otherwise the chain stops. So in your auth middleware you don't have to call the next one if auth fails and the chain stops with your error status being the last thing returned. So in your code you need to accept a parameter of <code>http.Handler</code> and that is the next handler (a middleware function has to have the signature of <code>func(http.Handler) http.Handler</code>). See this <a href=\"http://www.alexedwards.net/blog/making-and-using-middleware\" rel=\"nofollow noreferrer\">blog</a> for more details.</p>\n\n<p>You may want to set the correct http status codes as well. Include something like this:</p>\n\n<pre><code>http.Error(w, \"Forbidden: xyz\", http.StatusForbidden)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": false, "score": 3, "last_activity_date": 1519200600, "creation_date": 1519200600, "answer_id": 48900887, "question_id": 48899277, "link": "https://stackoverflow.com/questions/48899277/what-is-the-best-way-to-send-back-the-response-from-the-middle-ware-in-golang/48900887#48900887", "title": "What is the best way to send back the response from the middle-ware in Golang", "body": "<p>The next middleware in the chain only runs if you <em>explicitly</em> call it.</p>\n\n<p>That next middleware is passed to your closure as <code>h</code>, and you are calling it by invoking <code>h.ServeHTTP()</code>. If you do not call this, no other middleware runs, so you must supply the complete HTTP response.</p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1519203572, "creation_date": 1519203572, "answer_id": 48901716, "question_id": 48899277, "link": "https://stackoverflow.com/questions/48899277/what-is-the-best-way-to-send-back-the-response-from-the-middle-ware-in-golang/48901716#48901716", "title": "What is the best way to send back the response from the middle-ware in Golang", "body": "<p>The Adapt function is not relevant for serving requests. It is executed once (and only once) before the HTTP server even starts. Note that it <em>returns</em> an http.Handler but it isn't an http.Handler itself.</p>\n\n<p>That handler that Adapt returns in this case behaves like this:</p>\n\n<pre><code>var indexHandler http.Handler\n\nfunc handlerWithMiddleWare(w http.ResponseWriter, r *http.Request) {\n    notify := func(w http.ResponseWriter, r *http.Request) {\n            copyMgoSession := func(w http.ResponseWriter, r *http.Request) {\n                    checkAuth := func(w http.ResponseWriter, r *http.Request) {\n                            addHeader := func(w http.ResponseWriter, r *http.Request) {\n                                    indexHandler.ServeHTTP(w, r)\n                            }\n\n                            addHeader(w, r)\n                    }\n\n                    checkAuth(w, r)\n            }\n\n            copyMgoSession(w, r)\n    }\n\n    notify(w, r)\n}\n</code></pre>\n\n<p>So if you let CheckAuth return without calling the next middleware, you can send whatever response you like; just as you would in any other handler.</p>\n\n<p>By the way, you way want to let Adapt iterate in reverse order. I'm not sure that you're aware that Notify executes first, then CopyMgoSession, then CheckAuth, and then AddHeader.</p>\n"}], "owner": {"reputation": 1351, "user_id": 3987993, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j1isS.jpg?s=128&g=1", "display_name": "Ankit Kumar", "link": "https://stackoverflow.com/users/3987993/ankit-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 952, "favorite_count": 3, "answer_count": 3, "score": 3, "last_activity_date": 1519203572, "creation_date": 1519193807, "question_id": 48899277, "link": "https://stackoverflow.com/questions/48899277/what-is-the-best-way-to-send-back-the-response-from-the-middle-ware-in-golang", "title": "What is the best way to send back the response from the middle-ware in Golang", "body": "<p>I have created middle-wares using Adapter pattern. One of my middle-ware is for authentication. So if the user is not authorized then I have to send back response to the user and the next middle-ware/s should not be called.</p>\n\n<pre><code>// Adapter type\n\ntype Adapter func(http.Handler) http.Handler\n\n// Adapt func\nfunc Adapt(h http.Handler, adapters ...Adapter) http.Handler {\n    // Call all middleware\n    for _, adapter := range adapters {\n        h = adapter(h)\n    }\n    return h\n}\n\n// CheckAuth middleware\nfunc CheckAuth() Adapter {\n    return func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            // Get Authorization token from the header\n            // Validate the token\n            // if valid token then call h.ServeHTTP(w, r)\n            // else send response 401 to the user,\n            if(validUser){\n                h.ServeHTTP(w, r)\n            }else{\n                fmt.Fprintf(w, \"Unauthorized\")\n            }\n            return h\n        }\n    }\n}\n\nhttp.Handle(\"/\", Adapt(indexHandler, AddHeader(),\n                                 CheckAuth(),\n                                 CopyMgoSession(db),\n                                 Notify(logger), \n                               )\n</code></pre>\n\n<p>in the CheckAuth middleware I'm calling <code>h.ServeHTTP(w, r)</code> only if the user is authorized, so for the else condtition we also need to break the <code>for</code> loop of the <code>Adapt</code> function or else it will call next middleware even after sending the response.</p>\n\n<p>let me know if there is any other way to handle such situation.</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 422, "user_id": 6037581, "user_type": "registered", "profile_image": "https://graph.facebook.com/462162247307331/picture?type=large", "display_name": "arundeepak", "link": "https://stackoverflow.com/users/6037581/arundeepak"}, "is_accepted": true, "score": 5, "last_activity_date": 1519199564, "creation_date": 1519199564, "answer_id": 48900661, "question_id": 48899014, "link": "https://stackoverflow.com/questions/48899014/fetching-null-datetime-value-in-mysql-using-gorm/48900661#48900661", "title": "Fetching NULL datetime value in MySQL using GORM", "body": "<p>Go doesn't recognize NULL in particular. \nI think you can achieve it using a raw query in GORM. \nlike this. </p>\n\n<pre><code>db.Raw(\"SELECT * FROM visit_details WHERE out_time is NULL order by id desc limit 1\").Scan(&amp;visitDetail)\n</code></pre>\n\n<p>This is one one to fetch the column. Hope this helps.</p>\n"}, {"comments": [{"owner": {"reputation": 2056, "user_id": 4379903, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/JB2QN.jpg?s=128&g=1", "display_name": "Abhishek Ghosh", "link": "https://stackoverflow.com/users/4379903/abhishek-ghosh"}, "edited": false, "score": 0, "creation_date": 1573780717, "post_id": 48907021, "comment_id": 104006944, "body": "This answer should have been accepted! (not all people are using gorm)"}], "tags": [], "owner": {"reputation": 96, "user_id": 7033157, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2aFEUZ3yjLo/AAAAAAAAAAI/AAAAAAAAAKg/QQOCxWY5OSM/photo.jpg?sz=128", "display_name": "Emmanuel Vlad", "link": "https://stackoverflow.com/users/7033157/emmanuel-vlad"}, "is_accepted": false, "score": 6, "last_activity_date": 1519219127, "creation_date": 1519219127, "answer_id": 48907021, "question_id": 48899014, "link": "https://stackoverflow.com/questions/48899014/fetching-null-datetime-value-in-mysql-using-gorm/48907021#48907021", "title": "Fetching NULL datetime value in MySQL using GORM", "body": "<p>You can set OutTime as a pointer so that it could be null. As seen in the <a href=\"http://gorm.io/docs/conventions.html#gorm-Model\" rel=\"noreferrer\">doc</a>:</p>\n\n<pre><code>type YourStruct struct {\n     OutTime *time.Time\n}\n</code></pre>\n\n<p>Then run your query</p>\n\n<pre><code>db.Where(\"out_time = ?\", nil).Last(&amp;visitDetail)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 88, "user_id": 9640539, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-edmbUAlE0F8/AAAAAAAAAAI/AAAAAAAAAAc/Uv1tsF56-Co/photo.jpg?sz=128", "display_name": "Jess", "link": "https://stackoverflow.com/users/9640539/jess"}, "is_accepted": false, "score": 2, "last_activity_date": 1562128527, "creation_date": 1562128527, "answer_id": 56862968, "question_id": 48899014, "link": "https://stackoverflow.com/questions/48899014/fetching-null-datetime-value-in-mysql-using-gorm/56862968#56862968", "title": "Fetching NULL datetime value in MySQL using GORM", "body": "<p>Just specify <code>IS NULL</code> in the query without the wildcard.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>db.Where(\"out_time IS NULL\").Last(&amp;visitDetail)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 7531, "user_id": 2359227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57758277a5b44a41d8dc112c91eeeca7?s=128&d=identicon&r=PG", "display_name": "Tomer Shetah", "link": "https://stackoverflow.com/users/2359227/tomer-shetah"}, "edited": false, "score": 1, "creation_date": 1601379878, "post_id": 64118550, "comment_id": 113383981, "body": "Hey Artem. This answer repeats @Emmanuel answer. Please read <a href=\"https://stackoverflow.com/help/how-to-answer\">How do I write a good answer?</a>"}], "tags": [], "owner": {"reputation": 1, "user_id": 8510476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4702021169145f011ba5767e61593a7d?s=128&d=identicon&r=PG&f=1", "display_name": "Artem Kryhin", "link": "https://stackoverflow.com/users/8510476/artem-kryhin"}, "is_accepted": false, "score": 0, "last_activity_date": 1601378407, "creation_date": 1601378407, "answer_id": 64118550, "question_id": 48899014, "link": "https://stackoverflow.com/questions/48899014/fetching-null-datetime-value-in-mysql-using-gorm/64118550#64118550", "title": "Fetching NULL datetime value in MySQL using GORM", "body": "<p>The correct code is :</p>\n<pre><code>db.Where(&quot;out_time is ?&quot;, nil).Last(&amp;visitDetail)\n</code></pre>\n"}], "owner": {"reputation": 35671, "user_id": 1722818, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/sQrwd.jpg?s=128&g=1", "display_name": "duggu", "link": "https://stackoverflow.com/users/1722818/duggu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8249, "favorite_count": 2, "accepted_answer_id": 48900661, "answer_count": 4, "score": 6, "last_activity_date": 1601378407, "creation_date": 1519192576, "last_edit_date": 1527756646, "question_id": 48899014, "link": "https://stackoverflow.com/questions/48899014/fetching-null-datetime-value-in-mysql-using-gorm", "title": "Fetching NULL datetime value in MySQL using GORM", "body": "<p>I want to fetch the last visit_details row having out_time as <code>NULL</code> using Gorm.\n<code>NIL</code> is itself a type where VisitDetail OutTime is <code>mysql.NullTime</code>. </p>\n\n<p><strong>Code:-</strong></p>\n\n<pre><code>var visitDetail models.VisitDetail\ndb.Where(\"out_time=? \", nil).Last(&amp;visitDetail)\n\n//model VisitDetails\ntype VisitDetail struct {\n    Id              int\n    Visitor         Visitor  `gorm:\"foreignkey:ClientId;association_foreignkey:Id\"`\n    VisitorId       int      `gorm:\"not null;\"`\n    Location        Location `gorm:\"foreignkey:LocationId;association_foreignkey:Id\"`\n    LocationId      int      `gorm:\"not null;\"`\n    Purpose         string\n    InTime          time.Time `gorm:\"not null;\"`\n    OutTime         mysql.NullTime\n    User            User `gorm:\"foreignkey:ClientId;association_foreignkey:Id\"`\n    UserId          int  `gorm:\"not null;\"`\n    Status          int  `gorm:\"not null;\"`\n    ApproveByClient int  `gorm:\"not null;\"`\n}\n</code></pre>\n\n<p><strong>Query:-</strong></p>\n\n<pre><code>select * from visit_details where out_time is NULL order by id desc limit 1;\n+----+------------+-------------+---------+---------------------+----------+---------+--------+-------------------+\n| id | visitor_id | location_id | purpose | in_time             | out_time | user_id | status | approve_by_client |\n+----+------------+-------------+---------+---------------------+----------+---------+--------+-------------------+\n| 20 |          1 |           8 |         | 2018-02-20 17:13:25 | NULL     |    1609 |      0 |                 0 |\n+----+------------+-------------+---------+---------------------+----------+---------+--------+-------------------+\n1 row in set (0.04 sec)\n</code></pre>\n"}, {"tags": ["json", "unit-testing", "go"], "comments": [{"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 4, "creation_date": 1519191033, "post_id": 48898542, "comment_id": 84802833, "body": "Amazingly, the documentation describes some conditions under which Marshal() returns an error. <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Marshal</a> :)"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 7, "last_activity_date": 1519201977, "creation_date": 1519201977, "answer_id": 48901259, "question_id": 48898542, "link": "https://stackoverflow.com/questions/48898542/how-to-write-unit-test-for-failure-case-of-json-marshall/48901259#48901259", "title": "How to write unit test for failure case of json.Marshall?", "body": "<p>Feed it a value that cannot be represented in JSON.  There are many ways to do this, including creating a type with a custom marshaler that always returns an error. But one of the simplest ways is to try to marshal a channel:</p>\n\n<pre><code>x := map[string]interface{}{\n    \"foo\": make(chan int),\n}\n_, err := json.Marshal(x)\nfmt.Printf(\"Marshal error: %s\\n\", err)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/D2qoJ_azKVk\" rel=\"noreferrer\">Playground link</a></p>\n"}, {"comments": [{"owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "edited": false, "score": 0, "creation_date": 1607565125, "post_id": 48901444, "comment_id": 115315722, "body": "Is there any easy way to do this for <code>Unmarshal</code>?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "edited": false, "score": 0, "creation_date": 1607583293, "post_id": 48901444, "comment_id": 115319420, "body": "@ArunaHerath, in the same way, just implement the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">Unmarshaler</a> interface."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 5, "last_activity_date": 1519202688, "creation_date": 1519202688, "answer_id": 48901444, "question_id": 48898542, "link": "https://stackoverflow.com/questions/48898542/how-to-write-unit-test-for-failure-case-of-json-marshall/48901444#48901444", "title": "How to write unit test for failure case of json.Marshall?", "body": "<p>Define a type that implements <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"noreferrer\">json.Marshaler</a>. Use this type to produce any error you want (including error values from the json package):</p>\n\n<pre><code>type FakeValue struct {\n    err error\n}\n\nfunc (v FakeValue) MarshalJSON() ([]byte, error) {\n    if v.err != nil {\n            return nil, v.err\n    }\n\n    return []byte(`null`), v.err\n}\n\nfunc TestPolicyString(t *testing.T) {\n    doc := map[string]interface{}{\n            \"fake_error\": FakeValue{errors.New(\"fail!\")},\n    }\n\n    _, err := policyDocumentToStr(doc)\n    if err == nil {\n            t.Fatal(\"Got nil, want error\")\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 261, "user_id": 3296970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cf279565c0a40258ff31c03d0221a5e?s=128&d=identicon&r=PG&f=1", "display_name": "Archie Yalakki", "link": "https://stackoverflow.com/users/3296970/archie-yalakki"}, "is_accepted": false, "score": 1, "last_activity_date": 1594896373, "creation_date": 1594896373, "answer_id": 62932990, "question_id": 48898542, "link": "https://stackoverflow.com/questions/48898542/how-to-write-unit-test-for-failure-case-of-json-marshall/62932990#62932990", "title": "How to write unit test for failure case of json.Marshall?", "body": "<blockquote>\n<p>Monkey patching is one of the ways to facilitate testing by changing a program at runtime, either by replacing a function or a variable. Here we are swapping the json.Marshal and we can mock it while testing.</p>\n</blockquote>\n<pre><code>var (\n   jsonMarshal = json.Marshal\n)\n</code></pre>\n<blockquote>\n<p>This is your piece of code</p>\n</blockquote>\n<pre><code>func policyDocumentToStr(doc map[string]interface{}) (*string, error) {\n  policy, err := jsonMarshal(doc)\n  if err != nil {\n    fmt.Printf(&quot;Error converting policy document to string. Error %s&quot;, err)\n    return nil, err\n  }\n\n  policyAsString := string(policy)\n  return &amp;policyAsString, nil\n}\n</code></pre>\n<blockquote>\n<p>The test code would look something like this</p>\n</blockquote>\n<pre><code>import (\n    &quot;testing&quot;\n    &quot;errors&quot;\n)\n\nfunc fakemarshal(v interface{}) ([]byte, error) {\n    return []byte{}, errors.New(&quot;Marshalling failed&quot;)\n}\n\nfunc restoremarshal(replace func(v interface{}) ([]byte, error)) {\n    jsonMarshal = replace\n}\n\nfunc TestPolicyDocumentToStr(t * testing.T){\n    storedMarshal := jsonMarshal\n    jsonMarshal = fakemarshal\n    defer restoremarshal(storedMarshal)\n\n    input := map[string]interface{} {\n        &quot;test&quot;: &quot;test1&quot;,\n    }\n    tests := []struct {\n        name string\n        arg map[string]interface{}\n        wantErr string\n    }{\n        {\n            name: &quot;Test if JSON Marshalling fails&quot;,\n            arg: input,\n            wantErr: &quot;Marshalling failed&quot;,\n        },\n    }\n\n    for _, tt := range tests {\n        _, gotErr := policyDocumentToStr(tt.arg)\n       if gotErr != nil &amp;&amp; gotErr.Error() != tt.wantErr {\n            t.Errorf(&quot;Expected %s but got %s&quot;, tt.wantErr, gotErr.Error())\n       }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 6621961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22a18e9951bc4b8029ad74b924e61ea0?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/6621961/abhishek-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6279, "favorite_count": 0, "accepted_answer_id": 48901259, "answer_count": 3, "score": 2, "last_activity_date": 1599334327, "creation_date": 1519189675, "last_edit_date": 1599334327, "question_id": 48898542, "link": "https://stackoverflow.com/questions/48898542/how-to-write-unit-test-for-failure-case-of-json-marshall", "title": "How to write unit test for failure case of json.Marshall?", "body": "<p>I have following code:</p>\n\n<pre><code>func policyDocumentToStr(doc map[string]interface{}) (*string, error) {\n   policy, err := json.Marshal(doc)\n   if err != nil {\n     log.Debugf(\"Error converting policy document to string. Error %s\", err)\n     return nil, err\n   }\n\n   policyAsString := string(policy)\n   return &amp;policyAsString, nil\n}\n</code></pre>\n\n<p>I want to write a unit test which would cover the case of <code>json.Marshal(doc)</code> returning an error. Can anybody suggest how can I generate an error? What kind of input to function would result in error at line <code>policy, err := json.Marshal(doc)</code>?</p>\n"}, {"tags": ["debugging", "go", "alexa", "alexa-skills-kit", "alexa-skill"], "comments": [{"owner": {"reputation": 920, "user_id": 6890234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://lh5.googleusercontent.com/-aKC2DR_lnUc/AAAAAAAAAAI/AAAAAAAAABE/2KLbaG2ZxVU/photo.jpg?sz=128", "display_name": "Nikhil Wagh", "link": "https://stackoverflow.com/users/6890234/nikhil-wagh"}, "edited": false, "score": 0, "creation_date": 1524608277, "post_id": 48897675, "comment_id": 87039406, "body": "Did you find any cure to this? I&#39;m also facing the same issue."}, {"owner": {"reputation": 310, "user_id": 4317190, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/91ead7da4d55ff9f56f05a9a8a27bf85?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Cheek", "link": "https://stackoverflow.com/users/4317190/tyler-cheek"}, "reply_to_user": {"reputation": 920, "user_id": 6890234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://lh5.googleusercontent.com/-aKC2DR_lnUc/AAAAAAAAAAI/AAAAAAAAABE/2KLbaG2ZxVU/photo.jpg?sz=128", "display_name": "Nikhil Wagh", "link": "https://stackoverflow.com/users/6890234/nikhil-wagh"}, "edited": false, "score": 0, "creation_date": 1524622550, "post_id": 48897675, "comment_id": 87042538, "body": "Unfortunately not :("}, {"owner": {"reputation": 920, "user_id": 6890234, "user_type": "registered", "accept_rate": 76, "profile_image": "https://lh5.googleusercontent.com/-aKC2DR_lnUc/AAAAAAAAAAI/AAAAAAAAABE/2KLbaG2ZxVU/photo.jpg?sz=128", "display_name": "Nikhil Wagh", "link": "https://stackoverflow.com/users/6890234/nikhil-wagh"}, "edited": false, "score": 0, "creation_date": 1524675793, "post_id": 48897675, "comment_id": 87071556, "body": "Did you test it on Skill Tester? or an actual device? I tried it on the new Skill Tester, and It seems that the <code>dialogState</code> does change to <code>&quot;COMPLETED&quot;</code>, but it is not shown in the JSON Input. I was testing it locally using <code>python-lamda-local</code> library for Python runtime environment, and I had to hard code the JSON Input and had to put a <code>&quot;COMPLETED&quot;</code> inplace of <code>&quot;IN_PROGRESS&quot;</code>. And It worked for me, on my local machine as well as in the skill tester too. I did not put anything in the INPUT for my skill tester, it worked just fine."}], "owner": {"reputation": 310, "user_id": 4317190, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/91ead7da4d55ff9f56f05a9a8a27bf85?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Cheek", "link": "https://stackoverflow.com/users/4317190/tyler-cheek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 772, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1533714793, "creation_date": 1519183132, "question_id": 48897675, "link": "https://stackoverflow.com/questions/48897675/the-last-slot-in-an-alexa-skill-filled-by-the-dialog-model-always-throws-an-issu", "title": "The last slot in an Alexa Skill filled by the dialog model always throws an issue, with no error in the Cloudwatch logs", "body": "<p>I'm trying to build a custom Alexa skill that takes 4 values as input, the first 3 of which are required. I have my dialog model fully set up so that Alexa will ask the user for required values until all slots are filled. My problem is that whenever Alexa gets to the last required slot to fill, once the user gives their input, the skill invariably says \"Sorry, something went wrong\" (physical device) or \"There was a problem processing your input\" (simulator). When making the first 3 required, it fails after the user gives an answer to the 3rd slot. If I make only 2 required, it fails after the user gives an answer to the 2nd slot. Same thing if only one is required. If all 4 are required, the skill works in the simulator, but not on the physical device. Here's my Intent, in golang:</p>\n\n<pre><code>case \"OpenTicketIntent\":\n    log.Println(\"OpenTicketIntent triggered\")\n\n    // The request variable here is the IntentRequest object sent to the skill.\n    if strings.ToUpper(request.DialogState) == \"STARTED\" {\n\n        log.Println(\"DialogState == STARTED\")\n        // Pre-fill slots: update the intent object with slot values for which\n        // you have defaults, then return Dialog.Delegate with this updated intent\n        // in the updatedIntent property.\n        // myMap := make(map[string]alexa.IntentSlot)\n        // myMap[\"Assignee\"] = alexa.IntentSlot{\n        //  Name:               \"assignee\",\n        //  Value:              \"Unassigned\",\n        //  ConfirmationStatus: \"NONE\",\n        // }\n        // i := &amp;alexa.Intent{\n        //  Name:               \"OpenTicketIntent\",\n        //  ConfirmationStatus: \"NONE\",\n        //  Slots:              myMap,\n        // }\n        response.AddDialogDirective(\"Dialog.Delegate\", nil)\n        response.ShouldSessionEnd = false\n        log.Println(\"DialogState has exited STARTED\")\n\n    } else if strings.ToUpper(request.DialogState) != \"COMPLETED\" {\n\n        log.Println(\"DialogState == IN PROGRESS\")\n        // return a Dialog.Delegate directive with no updatedIntent property.\n        response.ShouldSessionEnd = false\n        response.AddDialogDirective(\"Dialog.Delegate\", nil)\n        log.Println(\"DialogState has exited IN PROGRESS\")\n\n    } else {\n\n        log.Println(\"DialogState == COMPLETED\")\n        // Dialog is now complete and all required slots should be filled,\n        // so call your normal intent handler.\n        ticketType := request.Intent.Slots[\"TicketType\"].Value\n        project := request.Intent.Slots[\"Project\"].Value\n        summary := request.Intent.Slots[\"Summary\"].Value\n        assignee := request.Intent.Slots[\"Assignee\"].Value\n        response.ShouldSessionEnd = false\n        log.Printf(\"Ticket Type is %s, Project is %s, Issue Title is %s, and Assignee is %s\\n\", ticketType, project, summary, assignee)\n\n        jiraClient, err := jira.NewClient(nil, \"https://imaginovation.atlassian.net/\")\n        if err != nil {\n            log.Println(err.Error())\n            response.SetOutputText(\"There was a problem creating the Jira Client\")\n            log.Printf(\"Set Output speech, value now: %s\", response.OutputSpeech.Text)\n        }\n        log.Println(\"Created Jira Client...\")\n        jiraClient.Authentication.SetBasicAuth(\"tcheek@imaginovation.net\", \"Stormlight94\")\n\n        i := &amp;jira.Issue{\n            Fields: &amp;jira.IssueFields{\n                Summary: \"Created from JiraBot\",\n                Type: jira.IssueType{\n                    ID: \"10000\",\n                },\n                Project: jira.Project{\n                    Key: \"IMJ\",\n                },\n                Assignee: &amp;jira.User{\n                    Name: \"tcheek\",\n                },\n            },\n        }\n        _, jiraResponse, err := jiraClient.Issue.Create(i)\n        log.Println(jiraResponse.Status)\n        if jiraResponse.StatusCode == 400 {\n            buf := new(bytes.Buffer)\n            buf.ReadFrom(jiraResponse.Body)\n            jiraResponseStr := buf.String()\n            log.Println(jiraResponseStr)\n        }\n        if err != nil {\n            log.Println(err.Error())\n            response.SetOutputText(\"There was a problem creating the Jira ticket\")\n            log.Printf(\"Set Output speech, value now: %s\", response.OutputSpeech.Text)\n        }\n        log.Println(\"DialogState has exited COMPLETED\")\n\n    }\n</code></pre>\n\n<p>The first thing you might think of is that I'm setting response.ShouldSessionEnd to false. But this doesn't change anything, it fails the same way if it's true or false. I am making it false because 3 seconds is sometimes not enough time for the skill to do the things it needs to do after the else statement, and setting this to false gives the skill the 8 seconds that Alexa gives while expecting a response. If there is no response or the skill finishes, the session will end normally.</p>\n\n<p>The second thing you might think of is that there is an error somewhere I'm not looking for. Here's the Cloudwatch output:</p>\n\n<p><a href=\"https://i.stack.imgur.com/JBlyd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/JBlyd.png\" alt=\"enter image description here\"></a>\n<a href=\"https://i.stack.imgur.com/ReLEH.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ReLEH.png\" alt=\"enter image description here\"></a></p>\n\n<p>The skill goes through the motions of getting each slot value until the 3rd required slot is filled and then quietly stops.</p>\n\n<p>I'm also getting an Internal Service Error when looking at the logs through the simulator.</p>\n\n<pre><code>{\n    \"header\": {\n        \"namespace\": \"System\",\n        \"name\": \"Exception\",\n        \"messageId\": \"b528b1ac-9809-4c1a-a2ad-bbff68988ce8\"\n    },\n    \"payload\": {\n        \"code\": \"INTERNAL_SERVICE_EXCEPTION\",\n        \"description\": \"Request could not be executed due to an internal service error.\"\n    }\n}\n</code></pre>\n\n<p>Why might my skill be failing on the last slot?</p>\n"}, {"tags": ["go", "ibm-cloud", "openwhisk"], "comments": [{"owner": {"reputation": 4877, "user_id": 721344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7aef4394952bae90b8d2de46a663379c?s=128&d=identicon&r=PG", "display_name": "csantanapr", "link": "https://stackoverflow.com/users/721344/csantanapr"}, "edited": false, "score": 0, "creation_date": 1519192573, "post_id": 48897061, "comment_id": 84803377, "body": "I just tried this and I didn&#39;t have any problems. It could be the activation record you are seeing is for an old run, do bx wsk activation list to be sure you see the latest run.  Also try to build locally and run it on your computer to make sure the executable works, then re-compile for linux and deploy again and run it again \ud83d\udca9  $ GOARCH=amd64 go build -o exec sample.go ~/dev/whisk/demos/godemo \ud83d\udca9  $ ./exec {&quot;msg&quot;:&quot;Done !&quot;}"}, {"owner": {"reputation": 4055, "user_id": 1427084, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zT5I_gPn0kw/AAAAAAAAAAI/AAAAAAAAADo/Bn7X3Tf8GmU/photo.jpg?sz=128", "display_name": "James Thomas", "link": "https://stackoverflow.com/users/1427084/james-thomas"}, "reply_to_user": {"reputation": 4877, "user_id": 721344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7aef4394952bae90b8d2de46a663379c?s=128&d=identicon&r=PG", "display_name": "csantanapr", "link": "https://stackoverflow.com/users/721344/csantanapr"}, "edited": false, "score": 0, "creation_date": 1519209096, "post_id": 48897061, "comment_id": 84812601, "body": "I&#39;ve also tried the instructions above and it runs without issue. Can you try @csantanapr&#39;s instructions above to check this works? What operating system are you using? Could you post your zip file somewhere for us to try?"}, {"owner": {"reputation": 4055, "user_id": 1427084, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zT5I_gPn0kw/AAAAAAAAAAI/AAAAAAAAADo/Bn7X3Tf8GmU/photo.jpg?sz=128", "display_name": "James Thomas", "link": "https://stackoverflow.com/users/1427084/james-thomas"}, "edited": false, "score": 0, "creation_date": 1520956968, "post_id": 48897061, "comment_id": 85524867, "body": "Sorry for the delay in helping with this but I&#39;ve now found the issue! See below."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9439922, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/b6af40941515412287d9618d9a2dda91?s=128&d=identicon&r=PG", "display_name": "jamie", "link": "https://stackoverflow.com/users/9439922/jamie"}, "is_accepted": false, "score": -1, "last_activity_date": 1520551454, "last_edit_date": 1520551454, "creation_date": 1520119819, "answer_id": 49090353, "question_id": 48897061, "link": "https://stackoverflow.com/questions/48897061/how-to-run-a-go-function-with-redis-package-on-openwhisk/49090353#49090353", "title": "How to run a Go function with redis package on OpenWhisk?", "body": "<blockquote>\n  <p>\"error\": \"The action did not return a dictionary.\"</p>\n</blockquote>\n\n<p>This is an open wsk error message.\nIt means that you did not return a dictionary on stdout</p>\n\n<p>below is a valid return as it returns a json object</p>\n\n<blockquote>\n  <p>{\"error\":\"something broke!\"}</p>\n</blockquote>\n\n<p>below would be invalid</p>\n\n<blockquote>\n  <p>\"something broke!\"</p>\n</blockquote>\n\n<p>suggestions: check to see if there is any errors when you build ( normally )\nthe file in your dropbox doesnt look like a binary file...I suggest checking you can build the binary first</p>\n"}, {"comments": [{"owner": {"reputation": 4877, "user_id": 721344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7aef4394952bae90b8d2de46a663379c?s=128&d=identicon&r=PG", "display_name": "csantanapr", "link": "https://stackoverflow.com/users/721344/csantanapr"}, "edited": false, "score": 0, "creation_date": 1520961310, "post_id": 49260676, "comment_id": 85527743, "body": "James what would be the command to build a static that includes everything?"}, {"owner": {"reputation": 4055, "user_id": 1427084, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zT5I_gPn0kw/AAAAAAAAAAI/AAAAAAAAADo/Bn7X3Tf8GmU/photo.jpg?sz=128", "display_name": "James Thomas", "link": "https://stackoverflow.com/users/1427084/james-thomas"}, "reply_to_user": {"reputation": 4877, "user_id": 721344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7aef4394952bae90b8d2de46a663379c?s=128&d=identicon&r=PG", "display_name": "csantanapr", "link": "https://stackoverflow.com/users/721344/csantanapr"}, "edited": false, "score": 1, "creation_date": 1521017184, "post_id": 49260676, "comment_id": 85548881, "body": "It depends on the external libraries used. There isn&#39;t a single command for this AFAIK. This blog post goes into details <a href=\"https://medium.com/@diogok/on-golang-static-binaries-cross-compiling-and-plugins-1aed33499671\" rel=\"nofollow noreferrer\">medium.com/@diogok/&hellip;</a> Compiling using the Docker runtime is the best option."}, {"owner": {"reputation": 4877, "user_id": 721344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7aef4394952bae90b8d2de46a663379c?s=128&d=identicon&r=PG", "display_name": "csantanapr", "link": "https://stackoverflow.com/users/721344/csantanapr"}, "edited": false, "score": 0, "creation_date": 1521090107, "post_id": 49260676, "comment_id": 85586439, "body": "oh I I think I miss undertood. Yes 100% agree compile, zip, npm install all the things inside the docker runtime using <code>docker run --rm -v $(pwd):&#47;owexec ....</code>"}], "tags": [], "owner": {"reputation": 4055, "user_id": 1427084, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-zT5I_gPn0kw/AAAAAAAAAAI/AAAAAAAAADo/Bn7X3Tf8GmU/photo.jpg?sz=128", "display_name": "James Thomas", "link": "https://stackoverflow.com/users/1427084/james-thomas"}, "is_accepted": true, "score": 3, "last_activity_date": 1520956934, "creation_date": 1520956934, "answer_id": 49260676, "question_id": 48897061, "link": "https://stackoverflow.com/questions/48897061/how-to-run-a-go-function-with-redis-package-on-openwhisk/49260676#49260676", "title": "How to run a Go function with redis package on OpenWhisk?", "body": "<p>The binary in the zip file is dynamically linked against shared libraries not available on the platform. </p>\n\n<p>Using <code>file</code> and <code>ldd</code> confirms this:</p>\n\n<pre><code>$ file exec \nexec: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, not stripped \n$ ldd exec\n/lib64/ld-linux-x86-64.so.2 (0x7f3f63f10000)\nlibpthread.so.0 =&gt; /lib64/ld-linux-x86-64.so.2 (0x7f3f63f10000)\nlibc.so.6 =&gt; /lib64/ld-linux-x86-64.so.2 (0x7f3f63f10000)\n</code></pre>\n\n<p>Build a static binary or build a dynamically linked binary inside the Docker image used by the platform (<code>openwhisk/dockerskeleton</code>).</p>\n\n<p>The <code>file not found</code> error is misleading but <a href=\"https://stackoverflow.com/questions/2716702/no-such-file-or-directory-error-when-executing-a-binary\">reported by bash</a> when executing files with this issue.</p>\n"}], "owner": {"reputation": 3310, "user_id": 3936644, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/c5rHq.png?s=128&g=1", "display_name": "Cinn", "link": "https://stackoverflow.com/users/3936644/cinn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 385, "favorite_count": 0, "accepted_answer_id": 49260676, "answer_count": 2, "score": 1, "last_activity_date": 1520956934, "creation_date": 1519178263, "question_id": 48897061, "link": "https://stackoverflow.com/questions/48897061/how-to-run-a-go-function-with-redis-package-on-openwhisk", "title": "How to run a Go function with redis package on OpenWhisk?", "body": "<p>I am having some troubles to run a golang package on OpenWhisk (IBM Cloud Functions).</p>\n\n<p>I ran the following on my local computer and it works without any problems (<code>go run sample.go</code>):</p>\n\n<pre><code>package main\n\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"github.com/go-redis/redis\"\n)\n\n\nfunc main() {\n\n    var redisClient *redis.Client = redis.NewClient(&amp;redis.Options{\n        Addr: \"...\",\n        Password: \"...\",\n        DB: 0,\n    })\n\n    redisClient.Set(\"foo\", \"bar\", 0)\n\n    defer redisClient.Close()\n\n    msg := map[string]string{\"msg\": (\"Done !\")}\n    res, _ := json.Marshal(msg)\n    fmt.Println(string(res))\n\n}\n</code></pre>\n\n<p>But i didn't find any way to make it working on OpenWhisk. I ran the following:</p>\n\n<pre><code>GOOS=linux GOARCH=amd64 go build -o exec sample.go\n\nzip exec.zip exec\n\nbx wsk action update myfunction --native exec.zip\n\nbx wsk action invoke myfunction -r\nbx wsk activation logs --last --strip\n</code></pre>\n\n<blockquote>\n  <p>\"error\": \"The action did not return a dictionary.\"</p>\n  \n  <p>\"2018-02-21T01:21:05.962244788Z stdout: [Errno 2] No such file or\n  directory: '/action/exec'\"</p>\n</blockquote>\n\n<p>The problem is related to the <code>github.com/go-redis/redis</code> package, when i remove it and its code then the function is running well. I met the same problem with the <code>mgo</code> package (MongoDB)...</p>\n\n<p>I am new in Golang so it may be obvious, but for now i am stuck :/</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519202168, "post_id": 48895634, "comment_id": 84807935, "body": "Use <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">build constraints</a>."}, {"owner": {"reputation": 15, "user_id": 1938301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a19f7b056001c9051c5d463062b15a?s=128&d=identicon&r=PG", "display_name": "mucc", "link": "https://stackoverflow.com/users/1938301/mucc"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519210524, "post_id": 48895634, "comment_id": 84813665, "body": "@Flimzy it&#39;s not really what I&#39;m looking for, build constraints ignored if suffixes are present in OS specific files.. And still there is a common <code>handle</code> which needs to be built for multiply OSes."}], "answers": [{"comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1519178885, "post_id": 48896657, "comment_id": 84799911, "body": "So, consider adding a <code>linux</code> target."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1519186744, "post_id": 48896657, "comment_id": 84801656, "body": "@MichaelHampton For linux, follow the pattern for the other targets: put the Linux specific code in file2_linux.go."}, {"owner": {"reputation": 15, "user_id": 1938301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a19f7b056001c9051c5d463062b15a?s=128&d=identicon&r=PG", "display_name": "mucc", "link": "https://stackoverflow.com/users/1938301/mucc"}, "edited": false, "score": 0, "creation_date": 1519200335, "post_id": 48896657, "comment_id": 84806939, "body": "@CeriseLim&#243;n Thanks! So to cover cross-platform components I need to write OS specific tests and setup OS specific build machines to run it?"}, {"owner": {"reputation": 15, "user_id": 1938301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a19f7b056001c9051c5d463062b15a?s=128&d=identicon&r=PG", "display_name": "mucc", "link": "https://stackoverflow.com/users/1938301/mucc"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1519200613, "post_id": 48896657, "comment_id": 84807085, "body": "@MichaelHampton yeah, but I don&#39;t really want to add something that won&#39;t be used right now and in the future.. Do you mean kind of mock for <code>linux</code> target?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 15, "user_id": 1938301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a19f7b056001c9051c5d463062b15a?s=128&d=identicon&r=PG", "display_name": "mucc", "link": "https://stackoverflow.com/users/1938301/mucc"}, "edited": false, "score": 0, "creation_date": 1519200710, "post_id": 48896657, "comment_id": 84807129, "body": "@mucc Your CI build server runs Linux. Having Linux code means it can actually run your (non-OS-specific) tests."}, {"owner": {"reputation": 15, "user_id": 1938301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a19f7b056001c9051c5d463062b15a?s=128&d=identicon&r=PG", "display_name": "mucc", "link": "https://stackoverflow.com/users/1938301/mucc"}, "edited": false, "score": 0, "creation_date": 1519200871, "post_id": 48896657, "comment_id": 84807231, "body": "@CeriseLim&#243;n About <code>Manager</code> interface, I wanted to limit and strictly define actions that must be added for the future when someone will be adding <code>darwin</code> implementation"}, {"owner": {"reputation": 15, "user_id": 1938301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a19f7b056001c9051c5d463062b15a?s=128&d=identicon&r=PG", "display_name": "mucc", "link": "https://stackoverflow.com/users/1938301/mucc"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1519201776, "post_id": 48896657, "comment_id": 84807712, "body": "@MichaelHampton I understand that, so if the project has a lot of OS specific code, it should be covered and tested on every particular target."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 15, "user_id": 1938301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a19f7b056001c9051c5d463062b15a?s=128&d=identicon&r=PG", "display_name": "mucc", "link": "https://stackoverflow.com/users/1938301/mucc"}, "edited": false, "score": 0, "creation_date": 1519230623, "post_id": 48896657, "comment_id": 84827933, "body": "@mucc  You can run non-OS specific tests on any OS.  Run tests with OS specific code on that particular OS."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1519230313, "last_edit_date": 1519230313, "creation_date": 1519174935, "answer_id": 48896657, "question_id": 48895634, "link": "https://stackoverflow.com/questions/48895634/design-and-unit-test-cross-platform-application/48896657#48896657", "title": "Design and unit-test cross-platform application", "body": "<p>Place the Windows specific code in file2_windows.go. This file is built for Windows targets only.</p>\n\n<pre><code>package management\n\ntype Manager struct {\n    ... Windows specific type\n}\n\nfunc (Manager) Action1() {\n   ... Windows specific code\n}\n\nfunc InitManager() Manager {\n    create and return inited Manager with configs\n}\n</code></pre>\n\n<p>Place the Darwin specific code in file2_darwin.go. This file is built for Darwin targets only.</p>\n\n<pre><code>package management\n\ntype Manager struct {\n    ... Darwin specific type\n}\n\nfunc (Manager) Action1() {\n   ... Darwin specific code\n}\n\nfunc InitManager() Manager {\n    create and return inited Manager with configs\n}\n</code></pre>\n\n<p>Call InitManager from the Handler function:</p>\n\n<pre><code>m := InitManager()\n</code></pre>\n\n<p>This calls the Darwin version on a Darwin target and the Windows version on a Windows target.</p>\n\n<p>The above uses the file name convention for setting <a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">build constraints</a>.  It's also possible to specify the constraints using comments. Use </p>\n\n<pre><code>// +build windows\n</code></pre>\n\n<p>to specify that the containing file is only built for a Windows target and </p>\n\n<pre><code>// +build darwin\n</code></pre>\n\n<p>to specify that the containing file is only built for a Darwin target.</p>\n\n<p>I assumed that you defined Manager as a common interface for the Windows and Darwin specific managers.  Because only one manager is built into the code at a time, there's no need to define an interface for this purpose.  If there's some other reason that the interface is needed, change type types used above to ManagerImpl or something like that.</p>\n\n<p>Q2: It's not possible to run <code>go test</code> for a target system that's different from the current system.</p>\n"}, {"comments": [{"owner": {"reputation": 15, "user_id": 1938301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a19f7b056001c9051c5d463062b15a?s=128&d=identicon&r=PG", "display_name": "mucc", "link": "https://stackoverflow.com/users/1938301/mucc"}, "edited": false, "score": 0, "creation_date": 1519258063, "post_id": 48897015, "comment_id": 84841604, "body": "Yeah, as for me using suffixes better describes particular file unless you want to build it for specific architecture, e.g. 32/64 bit OS or code is the same for few OSes. Anyway thanks for the info!"}], "tags": [], "owner": {"reputation": 191, "user_id": 5544983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/149b37314382ecb13989a557cadad09f?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Mellar", "link": "https://stackoverflow.com/users/5544983/mark-mellar"}, "is_accepted": false, "score": 2, "last_activity_date": 1519177758, "creation_date": 1519177758, "answer_id": 48897015, "question_id": 48895634, "link": "https://stackoverflow.com/questions/48895634/design-and-unit-test-cross-platform-application/48897015#48897015", "title": "Design and unit-test cross-platform application", "body": "<p>I think build flags are going to be your friend here.</p>\n\n<p>Is there any reason to be compiling the Darwin version of the Manager into your Windows executable? Probably not, so why even reference it? The same goes vice-versa.</p>\n\n<p>You can tell go build/test to only build a file if $GOOS is Windows by putting the following line at the top of the file...</p>\n\n<pre><code>// +build windows\n</code></pre>\n\n<p>This means the file will be totally ignored when building on Darwin.</p>\n\n<p>How is this useful to you? Well, instead of implementing two Manager types, you can implement the same one two different ways! Like this...</p>\n\n<p>windowsmanager.go </p>\n\n<pre><code>// +build windows\n\npackage management\n\ntype MyManager struct {\n    some configs\n}\n\nfunc (MyManager) PlatformGnosticAction1() {\n   ...\n}\n\nfunc InitMyManager() MyManager {\n    create and return inited windows version of MyManager with configs\n}\n</code></pre>\n\n<p>Similarly, for Darwin</p>\n\n<p>darwinmanager.go   </p>\n\n<pre><code>// +build darwin\n\npackage management\n\ntype MyManager struct {\n    some configs\n}\n\nfunc (MyManager) PlatformGnosticAction1() {\n   ...\n}\n\nfunc InitMyManager() MyManager {\n    create and return inited darwin version of MyManager with configs\n}\n</code></pre>\n\n<p>Now, only one version of the MyManager is ever compiles, so the code which calls it doesn't need to be aware of the difference...</p>\n\n<p>handler.go</p>\n\n<pre><code>package handle\n\nfunc handle() {\n    ...\n\n    m := InitMyManager()\n\n    ... \n}\n</code></pre>\n\n<p>Tags impact if <em>files</em> are compiled or not, so if there's a lot of common code between darwinmanager.go and windowsmanager.go you might want to refactor so as much of that common code as possible out of your tagged files, but in the same package. E.G.</p>\n\n<p>mymanager.go</p>\n\n<pre><code>package Manager\n\nfunc (m *MyManager) APlatformAgnosticFunc() {\n    ...\n}\n\n\nfunc (m *MyManager) AnotherPlatformAgnosticFunc() {\n    ...\n}\n</code></pre>\n\n<p>While keeping the platform gnostic stuff in the tagged files.</p>\n\n<p>You can apparently do similar things with file suffixes, but I've never tried that. Dave Cheney, wrote a much more thorough blog on the topic, you can read that <a href=\"https://dave.cheney.net/2013/10/12/how-to-use-conditional-compilation-with-the-go-build-tool\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>Hope that helps!</p>\n\n<p>M</p>\n"}], "owner": {"reputation": 15, "user_id": 1938301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3a19f7b056001c9051c5d463062b15a?s=128&d=identicon&r=PG", "display_name": "mucc", "link": "https://stackoverflow.com/users/1938301/mucc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 825, "favorite_count": 1, "accepted_answer_id": 48896657, "answer_count": 2, "score": 1, "last_activity_date": 1519230313, "creation_date": 1519167874, "last_edit_date": 1519170166, "question_id": 48895634, "link": "https://stackoverflow.com/questions/48895634/design-and-unit-test-cross-platform-application", "title": "Design and unit-test cross-platform application", "body": "<p>I'm working on a project that builds for windows (currently) and will be built for darwin in future.</p>\n\n<p>Here is a quick overview:</p>\n\n<p>file1.go:</p>\n\n<pre><code>package management\n\ntype Manager interface {\n    Action1()\n}\n</code></pre>\n\n<p>file2_windows.go:</p>\n\n<pre><code>package management\n\ntype WinManager struct {\n    some configs\n}\n\nfunc (WinManager) Action1() {\n   ...\n}\n\nfunc InitWinManager() WinManager {\n    create and return inited WinManager with configs\n}\n</code></pre>\n\n<p>handler.go:</p>\n\n<pre><code>package handle\n\nfunc handle() {\n    ...\n\n    var m Manager\n    if runtime.GOOS = \"windows\" {\n        m = InitWinManager()\n    }\n\n    ... \n}\n</code></pre>\n\n<p><strong>Q1:</strong> How to correctly avoid such conditional initialization of the Manager for specific OS?</p>\n\n<p>Few words about CI - since our build machine runs on linux and I need an .exe file I build it like that:</p>\n\n<ol>\n<li>create versioninfo.json with version specific properties and name of the executable</li>\n<li>run <code>GOOS=windows go generate</code> on main.go with <code>//go:generate goversioninfo</code></li>\n<li>run <code>GOOS=windows GOARCH=amd64 go build -o application.exe</code></li>\n</ol>\n\n<p>It builds just fine and I don't have any troubles with it.</p>\n\n<p>Another problem come up with <code>go test ./handle</code>. Before running actual test it tries to compile tested package, but it fails to find <code>InitWinManager()</code> method since my build machine's OS is different from windows.</p>\n\n<p>So <strong>Q2:</strong> How to specify an OS version to run for in <code>go test</code>? </p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "struct"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1519161965, "post_id": 48894435, "comment_id": 84794778, "body": "What&#39;s the problem?"}, {"owner": {"reputation": 309, "user_id": 8452565, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7a63bbab43d9c73ae8b9f8a006ec1679?s=128&d=identicon&r=PG&f=1", "display_name": "FXux", "link": "https://stackoverflow.com/users/8452565/fxux"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1519162130, "post_id": 48894435, "comment_id": 84794848, "body": "Ops... I updated the question"}], "answers": [{"comments": [{"owner": {"reputation": 309, "user_id": 8452565, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7a63bbab43d9c73ae8b9f8a006ec1679?s=128&d=identicon&r=PG&f=1", "display_name": "FXux", "link": "https://stackoverflow.com/users/8452565/fxux"}, "edited": false, "score": 0, "creation_date": 1519164225, "post_id": 48894796, "comment_id": 84795740, "body": "Hm. What about mixing them together? Isn&#39;t that possible?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 309, "user_id": 8452565, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7a63bbab43d9c73ae8b9f8a006ec1679?s=128&d=identicon&r=PG&f=1", "display_name": "FXux", "link": "https://stackoverflow.com/users/8452565/fxux"}, "edited": false, "score": 0, "creation_date": 1519164575, "post_id": 48894796, "comment_id": 84795876, "body": "@FXux: what do you mean by &quot;mixing them together&quot;?"}, {"owner": {"reputation": 309, "user_id": 8452565, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7a63bbab43d9c73ae8b9f8a006ec1679?s=128&d=identicon&r=PG&f=1", "display_name": "FXux", "link": "https://stackoverflow.com/users/8452565/fxux"}, "edited": false, "score": 0, "creation_date": 1519164792, "post_id": 48894796, "comment_id": 84795957, "body": "I&#39;m learning Go, and I have mainly a background in JavaScript. So I&#39;m used to use objects, and they are very flexible, you can combine two or more into one. Is that something doable with structs?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 309, "user_id": 8452565, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7a63bbab43d9c73ae8b9f8a006ec1679?s=128&d=identicon&r=PG&f=1", "display_name": "FXux", "link": "https://stackoverflow.com/users/8452565/fxux"}, "edited": false, "score": 0, "creation_date": 1519165527, "post_id": 48894796, "comment_id": 84796244, "body": "@FXux: You cannot change the structure of the types at runtime."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1519163406, "creation_date": 1519163406, "answer_id": 48894796, "question_id": 48894435, "link": "https://stackoverflow.com/questions/48894435/missing-key-even-when-exist/48894796#48894796", "title": "Missing key even when exist", "body": "<p>If you look at the type <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#PutObjectInput\" rel=\"nofollow noreferrer\"><code>s3.PutObjectInput</code></a>, the <code>key</code> field has a <code>required:\"true\"</code> tag.</p>\n\n<p>The <code>required</code> tag is also used by the <code>envconfig</code> package to indicate that the environment variable is required. </p>\n\n<p>You either need to supply the key from the environment, or not use the aws structs directly with the <code>envconfig</code> package.</p>\n"}], "owner": {"reputation": 309, "user_id": 8452565, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7a63bbab43d9c73ae8b9f8a006ec1679?s=128&d=identicon&r=PG&f=1", "display_name": "FXux", "link": "https://stackoverflow.com/users/8452565/fxux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1519163406, "creation_date": 1519161761, "last_edit_date": 1519162121, "question_id": 48894435, "link": "https://stackoverflow.com/questions/48894435/missing-key-even-when-exist", "title": "Missing key even when exist", "body": "<p>I'm using the following code to create a presigned url:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n    \"github.com/kelseyhightower/envconfig\"\n)\n\nfunc main() {\n    configuration := s3.PutObjectInput{ Key: aws.String(\"default_key\") }\n\n    // Add Bucket to configuration from environment variable\n    // e.g:\n    //    CONFIGURATION_BUCKET -&gt; configuration.Bucket\n    err := envconfig.Process(\"configuration\", &amp;configuration)\n\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n\n    sess := session.Must(session.NewSessionWithOptions(session.Options{\n      SharedConfigState: session.SharedConfigEnable,\n    }))\n    svc := s3.New(sess)\n    req, _ := svc.PutObjectRequest(&amp;configuration)\n\n    url, err := req.Presign(15 * time.Minute)\n\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n    fmt.Println(\"Url is\", url)\n}\n</code></pre>\n\n<p>The key is always the same, but the bucket can change depending on the environment that I'm.</p>\n\n<p>When I print with <code>fmt.Println</code> the Bucket and Key exists:</p>\n\n<pre><code>fmt.Println(configuration.Bucket, configuration.Key) // returns address\n</code></pre>\n\n<p>But the following error happens: <code>required key CONFIGURATION_KEY missing value</code></p>\n\n<p>Thank you!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519160723, "post_id": 48894026, "comment_id": 84794176, "body": "Is <code>A</code> or <code>C</code> supposed to be the &quot;top-level&quot; package here? Even though you don&#39;t have a &quot;main&quot; package, you need to think of the top level conceptually the same way as &quot;main&quot;, nothing else can import it."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519160821, "post_id": 48894026, "comment_id": 84794219, "body": "Wild guess: User doesn&#39;t (and probably shouldn&#39;t) need to know about routes. It only needs some URL, which is a string. Pass that down from the handler. Alternatively, have User depend on some interface, which is defined in model and implemented elsewhere. That being said, you are discovering that organizing things by type ( models, handlers, etc.) is silly. Organize by domain instead (package user, package blog, etc.). And if the project is small, a single package is totally okay too."}, {"owner": {"reputation": 136, "user_id": 3507691, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/o653q.png?s=128&g=1", "display_name": "Tocchetto", "link": "https://stackoverflow.com/users/3507691/tocchetto"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519202050, "post_id": 48894026, "comment_id": 84807857, "body": "@JimB Thanks for the tip, I will try to re imagine the solution with that in mind, I confess I never thought about it since its a server. I guess the main would be the routes package since they are the ones capturing the http requests."}, {"owner": {"reputation": 136, "user_id": 3507691, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/o653q.png?s=128&g=1", "display_name": "Tocchetto", "link": "https://stackoverflow.com/users/3507691/tocchetto"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519202181, "post_id": 48894026, "comment_id": 84807942, "body": "@peter I can&#39;t pass the url down, that would be the best solution I guess( point #2 explains why I can&#39;t pass it down). I see what you are saying, Instead of having routes, for example, centralized in a package, each model  would know about the routes that deal with them. It sounds like a very interesting approach... I will explore that further"}], "answers": [{"comments": [{"owner": {"reputation": 136, "user_id": 3507691, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/o653q.png?s=128&g=1", "display_name": "Tocchetto", "link": "https://stackoverflow.com/users/3507691/tocchetto"}, "edited": false, "score": 0, "creation_date": 1519202611, "post_id": 48894244, "comment_id": 84808138, "body": "Thanks for the reply, but I really don&#39;t quite understand your 2nd and 3rd point. Both kinda that look like the same thing, having an interface that will pass the required info. Even if the interface is locally declared on users, whoever implements it has to pass that to the user function that needs the url, how can I have someone passing something when i trying to keep the functions that lead to the user;s function call generic? I think my explanation was a little confusing, I can post the code in case you want to."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 136, "user_id": 3507691, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/o653q.png?s=128&g=1", "display_name": "Tocchetto", "link": "https://stackoverflow.com/users/3507691/tocchetto"}, "edited": false, "score": 0, "creation_date": 1519232455, "post_id": 48894244, "comment_id": 84829256, "body": "I didn&#39;t say anything about an interface in the second option. Just that your function can <i>receive</i> what it needs, rather than <i>going and getting</i> what it needs."}, {"owner": {"reputation": 136, "user_id": 3507691, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/o653q.png?s=128&g=1", "display_name": "Tocchetto", "link": "https://stackoverflow.com/users/3507691/tocchetto"}, "edited": false, "score": 0, "creation_date": 1519250519, "post_id": 48894244, "comment_id": 84838888, "body": "I&#39;ve read on dependency injection and now I see the difference between the two option but is there a way to inject the dependency without having to pass in on the function call? The function is part of a interface that is being used to simulate generics, so Im not passing any arguments in it. For the third option, how can whoever implement the interface provide User with the information, save by passing as argument"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 136, "user_id": 3507691, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/o653q.png?s=128&g=1", "display_name": "Tocchetto", "link": "https://stackoverflow.com/users/3507691/tocchetto"}, "edited": false, "score": 0, "creation_date": 1519251240, "post_id": 48894244, "comment_id": 84839230, "body": "User will have to take something as a parameter. That&#39;s how you avoid unnecessary dependencies and circular dependencies."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1519160977, "creation_date": 1519160977, "answer_id": 48894244, "question_id": 48894026, "link": "https://stackoverflow.com/questions/48894026/how-to-solve-this-go-cyclical-dependency/48894244#48894244", "title": "How to solve this Go cyclical dependency", "body": "<p>You've got some options, and you've found some of them. The main ways of handling this are:</p>\n\n<ul>\n<li>Refactor your design to turn the cycle into a tree. This doesn't really apply to your situation due to your requirements.</li>\n<li>Refactor your design to use some kind of dependency injection (this is your 2nd option in your question). This is perfectly viable, and probably the cleanest and easiest.</li>\n<li>Refactor your design to take a <em>locally declared</em> interface. This is a more Go-idiomatic version of your option 3. Because interfaces in Go are duck-typed, you get to define it where it's consumed, rather than where it's implemented. So your user package can define a one-method interface for \"a thing that gives me a URL I need\" and it never needs to reference the package that implements the interface.</li>\n</ul>\n"}], "owner": {"reputation": 136, "user_id": 3507691, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/o653q.png?s=128&g=1", "display_name": "Tocchetto", "link": "https://stackoverflow.com/users/3507691/tocchetto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "accepted_answer_id": 48894244, "answer_count": 1, "score": 1, "last_activity_date": 1519264810, "creation_date": 1519159993, "last_edit_date": 1519264810, "question_id": 48894026, "link": "https://stackoverflow.com/questions/48894026/how-to-solve-this-go-cyclical-dependency", "title": "How to solve this Go cyclical dependency", "body": "<p>I've been learning Go for a class course and I am very excited with the language, it really is very useful for web services.</p>\n\n<p>So, I've been writing this CRUD restful API for a final project and I keep running in  the damn circular dependency problem. I've already researched and read on the ways of solving it and will post here just for the sake of it, but first the problem I am having:</p>\n\n<p><em>routes</em> need to know about the handler functions in the <em>handlers</em> package, which in turn need to know about the <em>user</em> structure inside the <em>model</em> package, which in order to send a registration e-mail with a link need to know about the <em>routes</em> path</p>\n\n<p>Classical A -> B -> C -> A</p>\n\n<p>Now, I am trying to write this API using MVC and three layer architecture, this I would love for my routes to be in a controller package, my handlers to be on a business logic package and my user on a model package. This is also needed because I have over 43 model classes, I need them tidy up and tucked away on their package.</p>\n\n<p>Ok, the solutions I found out</p>\n\n<p>1 - <strong>Throw everybody on the same package</strong> : That's what I've been doing so far but is a very horrible solution for obvious reasons.</p>\n\n<p>2- <strong>Pass whatever <em>user</em> needs as argument when it's functions are called</strong>: That would be a good solution, but won't work because the function that is being called from <em>user</em> is from an interface implementation because it has to be a generic call and before anyone goes around saying that my problem is because I am forcing generics in go, well too bad, I need that generic, I will not write over 160 crud functions. The whole point of functions is to avoid code repetition.</p>\n\n<p>3- <strong>Create another package, with another interface, and have it having a instance of handlers and user and have it pass arguments from one to the other</strong>: Despite the reason mentioned above, the need of generic, this sounds like an unnecessarily complicated solution, I refuse to believe that this is better design than circular dependencies.</p>\n\n<p>Bottom line question: How to solve this dependency when C needs to know information from A and generics must be respected</p>\n\n<p>I can post some code here if you need to but I don't see the relevance of specific code when this is more of a high level question.</p>\n\n<p><strong>EDIT</strong>: Solved my dependency problem. Thank you all for the comments and answer as it led me to the answer. I don't think I've implemented any of the solutions suggested but it did taught me a lot about how to solve the problem, and they would all be very acceptable and doable solution if it wasn't for my own constrains where I don't want to pass anything to User.\nTo anyone trying to solve their own dependency problem, what I was able to gather is, instead of making in my case, C ask something from A, give to C whatever it needs, before it has to ask, meaning pass the information to him.</p>\n\n<p>Alas, that was not my solution, what I did was remove the information from A and give the information to Z, now both A and C are asking the path information to Z, which is just a Map, sitting there being all map like and holding information.\nThank you all</p>\n"}, {"tags": ["json", "csv", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 7354977, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MampN.png?s=128&g=1", "display_name": "the_frank", "link": "https://stackoverflow.com/users/7354977/the-frank"}, "edited": false, "score": 0, "creation_date": 1519161394, "post_id": 48891826, "comment_id": 84794510, "body": "Brilliant. Thank you for the detailed response, notes and improvements. Is there a performance benefit using one method or the other?"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 87, "user_id": 7354977, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MampN.png?s=128&g=1", "display_name": "the_frank", "link": "https://stackoverflow.com/users/7354977/the-frank"}, "edited": false, "score": 1, "creation_date": 1519228518, "post_id": 48891826, "comment_id": 84826392, "body": "For an extremely large list, the map is likely going to be more efficient, since it has amortized constant insertion and search time, while the slice version has O(n) search time.  The map version loops over the whole set once at the end to build the slice, while the slice version loops over the partial set on every insertion."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 3, "last_activity_date": 1519150834, "creation_date": 1519150834, "answer_id": 48891826, "question_id": 48890994, "link": "https://stackoverflow.com/questions/48890994/csv-to-struct-advice/48891826#48891826", "title": "CSV to Struct Advice", "body": "<p>Getting rid of the first entry is as easy as <code>billData = billData[1:]</code>.  That, or do an initial read to pull the column names.</p>\n\n<p>On the second part, your current data structure does not tolerate a one-to-many relationship (each Account has one and only one LineItem).  You'll need to do some processing on the list afterwards.  CSV files are necessarily 1:1, as each line is considered a single independent record.  The easiest way is to make it one-to-many is by using a map, but you can also simply loop over a slice (which retains closer to your existing code):</p>\n\n<p><a href=\"https://play.golang.org/p/3uevo0taKR5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3uevo0taKR5</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/csv\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n)\n\nvar data = `Ignore,Customer,Fruit,Number\n123,A,Apple,1\n123,A,Apple,3\n123,B,Orange,4\n123,C,Melon,5`\n\ntype Account struct {\n    Customer  string     `json:\"Customer\"`\n    LineItems []LineItem `json:\"LineItems\"`\n}\n\ntype LineItem struct {\n    ProductName string `json:\"ProductName\"`\n    Count       string `json:\"Count\"`\n}\n\nfunc main() {\n    reader := csv.NewReader(bytes.NewBufferString(data))\n\n    // Read column label data and discard\n    if _, err := reader.Read(); err != nil {\n        log.Fatal(err)\n    }\n\n    var billData []Account\n    for {\n        line, err := reader.Read()\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            log.Fatal(err)\n        }\n        found := false\n        for i := range billData {\n            if billData[i].Customer == line[1] {\n                found = true\n                billData[i].LineItems = append(billData[i].LineItems, LineItem{\n                    ProductName: line[2],\n                    Count:       line[3],\n                })\n                break\n            }\n        }\n        if !found {\n            billData = append(billData, Account{\n                Customer: line[1],\n                LineItems: []LineItem{\n                    {\n                        ProductName: line[2],\n                        Count:       line[3],\n                    },\n                },\n            })\n        }\n    }\n\n    billingJson, err := json.MarshalIndent(billData, \"\", \"  \")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(billingJson))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[\n    {\n        \"Customer\": \"A\",\n        \"LineItems\": [\n            {\n                \"ProductName\": \"Apple\",\n                \"Count\": \"1\"\n            },\n            {\n                \"ProductName\": \"Apple\",\n                \"Count\": \"3\"\n            }\n        ]\n    },\n    {\n        \"Customer\": \"B\",\n        \"LineItems\": [\n            {\n                \"ProductName\": \"Orange\",\n                \"Count\": \"4\"\n            }\n        ]\n    },\n    {\n        \"Customer\": \"C\",\n        \"LineItems\": [\n            {\n                \"ProductName\": \"Melon\",\n                \"Count\": \"5\"\n            }\n        ]\n    }\n]\n</code></pre>\n\n<p>Lastly, I recommend using <code>err</code> or similar for your error variable.  <code>error</code> is the name of the built in error type, so by naming your variable that, you're shadowing the type and making it impossible to declare a variable of that type within the same scope.  While this doesn't affect your current code, it's still quite bad practice and liable to get you into trouble eventually.</p>\n"}], "owner": {"reputation": 87, "user_id": 7354977, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MampN.png?s=128&g=1", "display_name": "the_frank", "link": "https://stackoverflow.com/users/7354977/the-frank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 48891826, "answer_count": 1, "score": 0, "last_activity_date": 1519150834, "creation_date": 1519147676, "last_edit_date": 1519147801, "question_id": 48890994, "link": "https://stackoverflow.com/questions/48890994/csv-to-struct-advice", "title": "CSV to Struct Advice", "body": "<p>If I have a csv read into a struct how can I manipulate the input to build the struct how I want? I am getting stuck in circles following various tutorials. This is the closest I have come.</p>\n\n<p>I essentially want to open a csv, read selected columns, ensure the value is recorded from the same row when referencing the column. Then the resulting data in a format which can be put into a database.</p>\n\n<p>Example CSV:</p>\n\n<pre><code>Ignore,Customer,Fruit,Number\n123,A,Apple,1\n123,A,Apple,3\n123,B,Orange,4\n123,C,Melon,5\n</code></pre>\n\n<p>Example Code:</p>\n\n<pre><code>package main\nimport (\n    \"bufio\"\n    \"encoding/csv\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\ntype Account struct {\n    Customer string `json:\"Customer\"`\n    LineItem *LineItem  `json:\"LineItem\"`\n}\n\ntype LineItem struct {\n    ProductName string `json:\"ProductName\"`\n    Count string `json:\"Count\"`\n}\n\n\nfunc main() {\n    csvFile, _ := os.Open(\"/home/frank/gocode/src/local/billing/fruit.csv\")\n\n    reader := csv.NewReader(bufio.NewReader(csvFile))\n    var billData []Account\n    for {\n        line, error := reader.Read()\n        if error == io.EOF {\n            break\n        } else if error != nil {\n            log.Fatal(error)\n        }\n        billData = append(billData, Account{\n            Customer: line[1],\n            LineItem: &amp;LineItem{\n                ProductName:   line[2],\n                Count: line[3],\n            },\n        })\n    }\n\n    billingJson, _ := json.Marshal(billData)\n    fmt.Println(string(billingJson))\n}\n</code></pre>\n\n<p>The current output is:</p>\n\n<pre><code>[{\"Customer\":\"Customer\",\"LineItem\":{\"ProductName\":\"Fruit\",\"Count\":\"Number\"}},{\"Customer\":\"A\",\"LineItem\":{\"ProductName\":\"Apple\",\"Count\":\"1\"}},{\"Customer\":\"A\",\"LineItem\":{\"ProductName\":\"Apple\",\"Count\":\"3\"}},{\"Customer\":\"B\",\"LineItem\":{\"ProductName\":\"Orange\",\"Count\":\"4\"}},{\"Customer\":\"C\",\"LineItem\":{\"ProductName\":\"Melon\",\"Count\":\"5\"}}]\n</code></pre>\n\n<p>I would like to get rid of first record so the headers are not kept. e.g.</p>\n\n<pre><code>[{\"Customer\":\"A\",\"LineItem\":{\"ProductName\":\"Apple\",\"Count\":\"1\"}},{\"Customer\":\"A\",\"LineItem\":{\"ProductName\":\"Apple\",\"Count\":\"3\"}},{\"Customer\":\"B\",\"LineItem\":{\"ProductName\":\"Orange\",\"Count\":\"4\"}},{\"Customer\":\"C\",\"LineItem\":{\"ProductName\":\"Melon\",\"Count\":\"5\"}}]\n</code></pre>\n\n<p>Consolidate so Customer A is one record with both LineItems e.g.</p>\n\n<pre><code>[{\"Customer\":\"A\",\"LineItem\":{\"ProductName\":\"Apple\",\"Count\":\"1\"},\"LineItem\":{\"ProductName\":\"Apple\",\"Count\":\"3\"}},{\"Customer\":\"B\",\"LineItem\":{\"ProductName\":\"Orange\",\"Count\":\"4\"}},{\"Customer\":\"C\",\"LineItem\":{\"ProductName\":\"Melon\",\"Count\":\"5\"}}]\n</code></pre>\n\n<p>Any best practices - alternate methods welcomed (not sure if a map is better here). Hopefully enough info to give me a hand.</p>\n"}, {"tags": ["mysql", "string", "go", "character-encoding"], "comments": [{"owner": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "edited": false, "score": 0, "creation_date": 1519147666, "post_id": 48890952, "comment_id": 84787185, "body": "Do really need these kinds of characters? Have you tried UTF16?"}, {"owner": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "reply_to_user": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "edited": false, "score": 0, "creation_date": 1519147791, "post_id": 48890952, "comment_id": 84787269, "body": "I have been advised to do so and looks good. But then again, why would &quot; \ud83d\udd25 &quot; get stored and &quot;\ud83c\udf7b&quot; not?"}, {"owner": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "edited": false, "score": 0, "creation_date": 1519148965, "post_id": 48890952, "comment_id": 84787940, "body": "What is the type of the column in which you are trying to save?"}, {"owner": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "reply_to_user": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "edited": false, "score": 0, "creation_date": 1519149201, "post_id": 48890952, "comment_id": 84788101, "body": "That is of type <code>text</code>."}, {"owner": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "edited": false, "score": 0, "creation_date": 1519149547, "post_id": 48890952, "comment_id": 84788296, "body": "Have you tried to set the &quot;char set/collation&quot;: <code>SET utf8mb4 COLLATE utf8mb4_general_ci </code> ?"}, {"owner": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "reply_to_user": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "edited": false, "score": 0, "creation_date": 1519149940, "post_id": 48890952, "comment_id": 84788512, "body": "I did it but no luck I am afraid. See update"}, {"owner": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "reply_to_user": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "edited": false, "score": 0, "creation_date": 1519207448, "post_id": 48890952, "comment_id": 84811375, "body": "It would be really helpful if people could explain the downvote(s)."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1519262920, "post_id": 48890952, "comment_id": 84842844, "body": "Let&#39;s see <code>SHOW CREATE TABLE</code>."}], "answers": [{"comments": [{"owner": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "edited": false, "score": 0, "creation_date": 1519150132, "post_id": 48891567, "comment_id": 84788622, "body": "Thanks for the suggestions, @Dalton.  The second one is what I currently have in place without any luck"}, {"owner": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "reply_to_user": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "edited": false, "score": 0, "creation_date": 1519150721, "post_id": 48891567, "comment_id": 84788938, "body": "You have char set and collation configured to the database and the table? When you print the text before save it to DB, the characters are correct? Are you sure that the problem is only when the character is being saved at DB? Perhaps the problem be when the data is decoded... before you send it to DB."}, {"owner": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "edited": false, "score": 0, "creation_date": 1519157965, "post_id": 48891567, "comment_id": 84792710, "body": "See here: INSERT INTO <code>statuses</code> (<code>text</code>,<code>status_id</code>) VALUES(&#39;The beers are on me in this case!\ufffd&#39;,&#39;943304851980963841&#39;) is the db query that it&#39;s trying to execute. Notice how the &quot;\ud83c\udf7b&quot; char is converted to &quot;\ufffd&quot;"}, {"owner": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "reply_to_user": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "edited": false, "score": 0, "creation_date": 1519167278, "post_id": 48891567, "comment_id": 84796859, "body": "So your problem is not with the DB. I updated the answer. You need to specify better your questions descriptions to avoid unnecessary answers."}, {"owner": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "edited": false, "score": 0, "creation_date": 1519201249, "post_id": 48891567, "comment_id": 84807430, "body": "Thanks for the provided example. I am experimenting with Golang in this mini-project."}, {"owner": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "reply_to_user": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "edited": false, "score": 0, "creation_date": 1519218682, "post_id": 48891567, "comment_id": 84819261, "body": "I added two more suggestions as you just told now what language you are using. I hope you get success!"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 1, "creation_date": 1519263038, "post_id": 48891567, "comment_id": 84842872, "body": "Caution!  Those two <code>ALTER TABLE</code> statements do different things.  One may help, the other may make things worse.  <code>SELECT HEX(text) ...</code> to see what the situation is."}, {"owner": {"reputation": 299, "user_id": 6602638, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JaJlL.jpg?s=128&g=1", "display_name": "jet_choong", "link": "https://stackoverflow.com/users/6602638/jet-choong"}, "edited": false, "score": 1, "creation_date": 1576592667, "post_id": 48891567, "comment_id": 104944841, "body": "I have tried to change the charset and collation in workbench database and table setting, changing the variables start with <code>charset</code> and some other solutions but none of them worked. Thus I follow this answer and try to execute the first 2 statements and surprisingly I&#39;m able to insert Chinese characters successfully. Btw, I&#39;m using AWS RDS and I&#39;m using the <code>utf8mb4</code> charset."}], "tags": [], "owner": {"reputation": 2986, "user_id": 1930814, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/k3Cu7.jpg?s=128&g=1", "display_name": "Dalton C&#233;zane", "link": "https://stackoverflow.com/users/1930814/dalton-c%c3%a9zane"}, "is_accepted": false, "score": 1, "last_activity_date": 1519218630, "last_edit_date": 1519218630, "creation_date": 1519149887, "answer_id": 48891567, "question_id": 48890952, "link": "https://stackoverflow.com/questions/48890952/unicode-encoding-error-1366-incorrect-string-value-xf0-for-column/48891567#48891567", "title": "Unicode encoding - Error 1366: Incorrect string value: &#39;\\xF0&#39; for column", "body": "<p>Two suggestions possible to solve your problem:</p>\n\n<ul>\n<li>Use <code>UTF16</code> charset;</li>\n<li>Use <code>utf8mb4</code> as char set and <code>utf8mb4_unicode_ci</code> as collation.</li>\n</ul>\n\n<p>You can use the following code as an example, <a href=\"https://mathiasbynens.be/notes/mysql-utf8mb4\" rel=\"nofollow noreferrer\">extracted from an online tutorial</a>:</p>\n\n<pre><code># For each database:\nALTER DATABASE database_name CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci;\n# For each table:\nALTER TABLE table_name CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n# For each column:\nALTER TABLE table_name CHANGE column_name column_name VARCHAR(191) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;\n</code></pre>\n\n<p>As your problem is not with the database, you have to use the right code representing the image. I suggest you use <a href=\"https://github.com/vdurmont/emoji-java\" rel=\"nofollow noreferrer\">\"emoji-java\"</a>: a lightweight java library that helps you use Emojis in your java applications.</p>\n\n<p>An example:</p>\n\n<pre><code>String str = \"An :grinning:awesome :smiley:string &amp;#128516;with a few :wink:emojis!\";\nString result = EmojiParser.parseToUnicode(str);\nSystem.out.println(result);\n// Prints:\n// \"An \ud83d\ude00awesome \ud83d\ude03string \ud83d\ude04with a few \ud83d\ude09emojis!\"\n</code></pre>\n\n<p>Another edit:\nYou just tell now the language you are using: Go. In this case, you can take a look at <a href=\"https://github.com/urakozz/go-emoji\" rel=\"nofollow noreferrer\">Go-emoji here</a>. Or even this <a href=\"https://github.com/kyokomi/emoji\" rel=\"nofollow noreferrer\">another emoji project</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "edited": false, "score": 0, "creation_date": 1519288868, "post_id": 48918204, "comment_id": 84852090, "body": "Thanks for your input here, @Rick James. That indicates that something is wrong in the golang side then."}], "tags": [], "owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "is_accepted": false, "score": 0, "last_activity_date": 1519262966, "creation_date": 1519262966, "answer_id": 48918204, "question_id": 48890952, "link": "https://stackoverflow.com/questions/48890952/unicode-encoding-error-1366-incorrect-string-value-xf0-for-column/48918204#48918204", "title": "Unicode encoding - Error 1366: Incorrect string value: &#39;\\xF0&#39; for column", "body": "<p>Do not use utf16 for anything.</p>\n\n<p>Use MySQL's <code>CHARACTER SET utf8mb4</code>; it is equivalent to the outside world's <code>UTF-8</code>, and includes the characters that begin with hex <code>F0</code>.  (MySQL's <code>utf8</code> does not include them.)</p>\n\n<p><code>\ud83d\udd25</code>, hex <code>F09F94A5</code> needs utf8mb4.  Ditto for <code>\ud83c\udf7b</code>, hex <code>F09F8DBB</code>.</p>\n\n<p><code>\ufffd</code> indicates that something is <em>already</em> messed up.  That is, the <code>INSERT</code> was given a bad character.</p>\n\n<p>Please provide <code>SELECT HEX(text) ...</code> to see if you get one of those hex values.</p>\n\n<p>Also see \"black diamond\" in <a href=\"https://stackoverflow.com/questions/38363566/trouble-with-utf8-characters-what-i-see-is-not-what-i-stored\">Trouble with UTF-8 characters; what I see is not what I stored</a></p>\n"}], "owner": {"reputation": 788, "user_id": 1423604, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/1b52c4eda43ea111e295d2cc262bca9c?s=128&d=identicon&r=PG", "display_name": "thitami", "link": "https://stackoverflow.com/users/1423604/thitami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2132, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1519262966, "creation_date": 1519147559, "last_edit_date": 1519218923, "question_id": 48890952, "link": "https://stackoverflow.com/questions/48890952/unicode-encoding-error-1366-incorrect-string-value-xf0-for-column", "title": "Unicode encoding - Error 1366: Incorrect string value: &#39;\\xF0&#39; for column", "body": "<p>I am experiencing some issue with MySQL encoding parsing data and then storing data from the Twitter API. </p>\n\n<p>The tweet that struggles to get stored into the db is: </p>\n\n<pre><code>   INSERT INTO `statuses` (`status_id`,`text`) VALUES('93332222111111','The beers are on me in this case!\ufffd')\n</code></pre>\n\n<p>The <code>\ufffd</code> character is <a href=\"https://www.fileformat.info/info/unicode/char/1f37b/index.htm\" rel=\"nofollow noreferrer\">this one</a>.\nwhereas the following got stored successfully: </p>\n\n<pre><code>INSERT INTO `statuses` (`status_id`,`text`) VALUES('485072105225921','RT @someone: \ud83d\udd25 Don\\'t forget to index timestamp columns like \\\"created_at\\\" if you query against them.\\n\\ne.g.: ORDER BY created_at\\ne.g.: WH')\n</code></pre>\n\n<p>Let's have a look into the character set:</p>\n\n<pre><code>SHOW VARIABLES LIKE 'character_set%'\n</code></pre>\n\n<p>which brings back</p>\n\n<pre><code>character_set_client    utf8mb4\ncharacter_set_connection    utf8mb4\ncharacter_set_database  utf8mb4\ncharacter_set_filesystem    binary\ncharacter_set_results   utf8mb4\ncharacter_set_server    utf8\ncharacter_set_system    utf8\ncharacter_sets_dir  /usr/local/Cellar/mysql/5.7.18_1/share/mysql/charsets/\n</code></pre>\n\n<p>Anything obvious that I am missing?</p>\n\n<p><strong>Update:</strong>\nAlso the following if block:</p>\n\n<pre><code>if utf8.ValidString(strings.Join(values, \",\")) == false {\n            fmt.Println(strings.Join(values, \",\"))\n        }\n</code></pre>\n\n<p>returns:</p>\n\n<pre><code>'The beers are on me in this case!\ufffd','943304851980963841' \n</code></pre>\n"}, {"tags": ["linux", "go", "visual-studio-code"], "comments": [{"owner": {"reputation": 3484, "user_id": 1016425, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GLTjc.gif?s=128&g=1", "display_name": "lloiacono", "link": "https://stackoverflow.com/users/1016425/lloiacono"}, "edited": false, "score": 0, "creation_date": 1519144779, "post_id": 48890029, "comment_id": 84785304, "body": "What is your current GOPATH? Try this in the console: echo $GOPATH"}, {"owner": {"reputation": 295, "user_id": 9295746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4xav.jpg?s=128&g=1", "display_name": "Marcel K&#228;mper", "link": "https://stackoverflow.com/users/9295746/marcel-k%c3%a4mper"}, "reply_to_user": {"reputation": 3484, "user_id": 1016425, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GLTjc.gif?s=128&g=1", "display_name": "lloiacono", "link": "https://stackoverflow.com/users/1016425/lloiacono"}, "edited": false, "score": 0, "creation_date": 1519144985, "post_id": 48890029, "comment_id": 84785449, "body": "echo $GOPATH returns /usr/local/go/bin/go"}, {"owner": {"reputation": 3484, "user_id": 1016425, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GLTjc.gif?s=128&g=1", "display_name": "lloiacono", "link": "https://stackoverflow.com/users/1016425/lloiacono"}, "edited": false, "score": 1, "creation_date": 1519145340, "post_id": 48890029, "comment_id": 84785711, "body": "Your screenshots show that the path is missing the leading /, it looks like usr/local/bin/go"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1519145470, "post_id": 48890029, "comment_id": 84785807, "body": "@MarcelK&#228;mper: ` /usr/local/go/bin/go` is the go binary, that can&#39;t be the GOPATH."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519145586, "post_id": 48890124, "comment_id": 84785889, "body": "GOPATH and GOROOT should <i>not</i> be in your PATH"}], "tags": [], "owner": {"reputation": 3484, "user_id": 1016425, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GLTjc.gif?s=128&g=1", "display_name": "lloiacono", "link": "https://stackoverflow.com/users/1016425/lloiacono"}, "is_accepted": true, "score": 4, "last_activity_date": 1519145685, "last_edit_date": 1519145685, "creation_date": 1519144930, "answer_id": 48890124, "question_id": 48890029, "link": "https://stackoverflow.com/questions/48890029/vscode-go-setup-problems/48890124#48890124", "title": "VsCode Go setup problems", "body": "<p>The error message says that your GOPATH is relative and should be absolute.</p>\n\n<p>Make sure you read <a href=\"https://github.com/Microsoft/vscode-go/wiki/GOPATH-in-the-VS-Code-Go-extension\" rel=\"nofollow noreferrer\">THIS</a> first.</p>\n\n<p>Make sure your GOPATH and GOROOT are defined in absolute paths.</p>\n\n<p>Edit your .bashrc, .profile, .zshrc, etc accordingly:</p>\n\n<pre><code>GOPATH=/path/to/a/directory/inside/home/directory\nGOROOT=/path/to/you/go/library\n</code></pre>\n\n<p>Read <a href=\"https://stackoverflow.com/a/46744872/1016425\">this answer</a> for more details.</p>\n"}], "owner": {"reputation": 295, "user_id": 9295746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4xav.jpg?s=128&g=1", "display_name": "Marcel K&#228;mper", "link": "https://stackoverflow.com/users/9295746/marcel-k%c3%a4mper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1705, "favorite_count": 0, "accepted_answer_id": 48890124, "answer_count": 1, "score": 2, "last_activity_date": 1532518492, "creation_date": 1519144659, "last_edit_date": 1532518492, "question_id": 48890029, "link": "https://stackoverflow.com/questions/48890029/vscode-go-setup-problems", "title": "VsCode Go setup problems", "body": "<p>I want to use VsCode for Go programming, but if I try to create/edit a .go file, VsCode forces me too install \"gocode command\", as you can see in the following:</p>\n\n<p><img src=\"https://i.stack.imgur.com/M4RB3.png\" alt=\"Image\">.  </p>\n\n<p>When I click on install, the output field shows me these errors:</p>\n\n<p><img src=\"https://i.stack.imgur.com/wtlm8.png\" alt=\"Errors_1\"></p>\n\n<p><img src=\"https://i.stack.imgur.com/d9OLe.png\" alt=\"Errors_2\">  </p>\n\n<p>What can I do to fix it?</p>\n"}, {"tags": ["docker", "go", "path", "dockerfile"], "answers": [{"tags": [], "owner": {"reputation": 142005, "user_id": 465183, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/3b518a0ea4c992cfe9965671d0139ba4?s=128&d=identicon&r=PG", "display_name": "Gilles Quenot", "link": "https://stackoverflow.com/users/465183/gilles-quenot"}, "is_accepted": false, "score": 2, "last_activity_date": 1519153648, "last_edit_date": 1519153648, "creation_date": 1519144522, "answer_id": 48889986, "question_id": 48889667, "link": "https://stackoverflow.com/questions/48889667/setting-the-path-variable-and-sourcing-an-env-in-a-dockerfile/48889986#48889986", "title": "Setting the PATH variable and sourcing an env in a Dockerfile", "body": "<p>It's not very clear at a first glance, but your <em>double quotes</em> around <code>PATH</code> are not the good unicode character. You should replace them by the usual <code>\"</code>, not <code>\u201c</code> (Unicode UTF8 codepoint <code>U+201C</code>)</p>\n\n<p>Demo: not the same:</p>\n\n<pre><code>$ od -c &lt;&lt;&lt; \\\"\n0000000   \"  \\n\n0000002\n$ od -c &lt;&lt;&lt; \\\u201c\n0000000 342 200 234  \\n\n0000004\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8066919, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-rJ9HieTZBqQ/AAAAAAAAAAI/AAAAAAAAADk/yY6qyBQoQ94/photo.jpg?sz=128", "display_name": "Dalan Miller", "link": "https://stackoverflow.com/users/8066919/dalan-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 674, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519153648, "creation_date": 1519143515, "last_edit_date": 1519144364, "question_id": 48889667, "link": "https://stackoverflow.com/questions/48889667/setting-the-path-variable-and-sourcing-an-env-in-a-dockerfile", "title": "Setting the PATH variable and sourcing an env in a Dockerfile", "body": "<p>I've written a Dockerfile to create containers that have Golang installed. I have a goss test running the <em>go version</em> command, but the test is failing because the path variable (in the Dockerfile)--for some reason--doesn't stay set.</p>\n\n<p>I've also tried sourcing the .env for go from inside the Dockerfile, but that doesn't seem to work either.</p>\n\n<p><strong>Dockerfile</strong></p>\n\n<pre><code>ENV GIMME_VERSION \"v1.4.0\"\nENV GO_VERSION \"1.4\"\nENV JENKINS_HOME \"/opt/jenkins\"\nENV PATH=\"~/bin:${PATH}\"\nENV PATH=\u201c/opt/jenkins/.gimme/versions/go1.4.linux.amd64/bin:${PATH}\u201c\nENV GOROOT=\"/opt/jenkins/.gimme/versions/go${GO_VERSION}.linux.amd64\"\n\nUSER root\n\nRUN yum -y install git &amp;&amp; \\\n    yum -y clean all &amp;&amp; \\\n    rm -rf /var/cache/yum\n\nWORKDIR $JENKINS_HOME\n\nUSER jenkins\n\nRUN mkdir ~/bin &amp;&amp; \\\n    curl -sL -o ~/bin/gimme https://raw.githubusercontent.com/travis-\n    ci/gimme/${GIMME_VERSION}/gimme &amp;&amp; \\\n    chmod +x ~/bin/gimme &amp;&amp; \\\n    gimme ${GO_VERSION}\n\nUSER root\n\nRUN source /opt/jenkins/.gimme/envs/go${GO_VERSION}.linux.amd64.env\n</code></pre>\n\n<p><strong>Goss Yaml</strong></p>\n\n<pre><code>file:\n  /opt/jenkins/.gimme:\n    exists: true\n    filetype: directory\n  /opt/jenkins/.gimme/envs/go1.4.env:\n    exists: true\n    filetype: file\n  /opt/jenkins/.gimme/versions/go1.4.linux.amd64:\n    exists: true\n    filetype: directory\n  /opt/jenkins/.gimme/versions/go1.4.linux.amd64/bin/go:\n    exists: true\n    filetype: file\n  /opt/jenkins/.gimme/versions/go1.4.linux.amd64/pkg:\n    exists: true\n    filetype: directory\n  /opt/jenkins/.gimme/versions/go1.4.linux.amd64/src:\n    exists: true\n    filetype: directory\n  /opt/jenkins/bin/gimme:\n    filetype: file\n    exists: true\n    mode: '0755'\ncommand:\n  'gimme version':\n  exit-status: 0\n  'go version':\n  exit-status: 0\n</code></pre>\n"}, {"tags": ["go", "unicode", "emoji"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519140256, "post_id": 48887397, "comment_id": 84782209, "body": "Put your code in the question. Playground links (any links, really) tend to go stale, which will render this question worthless later."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1520813209, "last_edit_date": 1520813209, "creation_date": 1519137652, "answer_id": 48887775, "question_id": 48887397, "link": "https://stackoverflow.com/questions/48887397/how-to-map-two-letter-country-codes-to-emoji/48887775#48887775", "title": "How to map two-letter country codes to Emoji?", "body": "<p>The only improvements I would recommend is adding verification that the input characters is a pair of ASCII uppercase letters.  Here is an example of what the template function would look like:</p>\n\n<pre><code>func(x string) (string, error) {\n    if len(x) != 2 {\n        return \"\", errors.New(\"country code must be two letters\")\n    }\n    if x[0] &lt; 'A' || x[0] &gt; 'Z' || x[1] &lt; 'A' || x[1] &gt; 'Z' {\n        return \"\", errors.New(\"invalid country code\")\n    }\n    return string('\ud83c\udde6'+rune(x[0])-'A') + string('\ud83c\udde6'+rune(x[1])-'A'), nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Nkg23qsr2Ga\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Nkg23qsr2Ga</a></p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 6709130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/408e17b8d360e9a96ef1d82c86842d6d?s=128&d=identicon&r=PG", "display_name": "Enes &#199;ak\u0131r", "link": "https://stackoverflow.com/users/6709130/enes-%c3%87ak%c4%b1r"}, "is_accepted": false, "score": 1, "last_activity_date": 1583444039, "creation_date": 1583444039, "answer_id": 60554277, "question_id": 48887397, "link": "https://stackoverflow.com/questions/48887397/how-to-map-two-letter-country-codes-to-emoji/60554277#60554277", "title": "How to map two-letter country codes to Emoji?", "body": "<p>You can use <a href=\"https://github.com/enescakir/emoji\" rel=\"nofollow noreferrer\">enescakir/emoji</a> package. It makes emoji usage easier in Golang.</p>\n\n<p>It can generate country flag emoji from <a href=\"https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2\" rel=\"nofollow noreferrer\">ISO 3166 Alpha2</a> codes.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>emoji.CountryFlag(\"us\") // \ud83c\uddfa\ud83c\uddf8\nemoji.CountryFlag(\"gb\") // \ud83c\uddec\ud83c\udde7\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 48887775, "answer_count": 2, "score": -2, "last_activity_date": 1583444039, "creation_date": 1519136574, "last_edit_date": 1519216128, "question_id": 48887397, "link": "https://stackoverflow.com/questions/48887397/how-to-map-two-letter-country-codes-to-emoji", "title": "How to map two-letter country codes to Emoji?", "body": "<p>Anyone fiddled with <a href=\"https://en.wikipedia.org/wiki/Regional_Indicator_Symbol\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Regional_Indicator_Symbol</a>? I am wondering how to get US printed as a flag \ud83c\uddfa\ud83c\uddf8</p>\n\n<pre><code>package main\n\nimport (\n    \"html/template\"\n    \"os\"\n)\n\nfunc main() {\n\n    t, err := template.New(\"\").Parse(`\n    &lt;p&gt;{{ .Country }}&lt;/p&gt;\n    &lt;p&gt;Want \ud83c\uddfa\ud83c\uddf8&lt;/p&gt;\n    `)\n\n    if err != nil {\n        panic(err)\n    }\n\n    err = t.Execute(os.Stdout, map[string]interface{}{\n        \"Country\": \"US\",\n    })\n\n    if err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/UErXxL645rV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UErXxL645rV</a></p>\n\n<p>IIUC I need to add 0x1F1A5 to capital latin letters, but I don't how to do this in Go.</p>\n\n<p>Update: Eric Hill suggested: <a href=\"https://play.golang.org/p/hEsScaZSh1I\" rel=\"nofollow noreferrer\">https://play.golang.org/p/hEsScaZSh1I</a> .. can anyone come up with improvements?</p>\n"}, {"tags": ["file", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1519139143, "post_id": 48887290, "comment_id": 84781446, "body": "Take a look at <a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a> in the standard library, it does basically this (not as an <code>os.File</code>, that&#39;s impossible, but it exposes a <code>[]byte</code> as an <code>io.ReadWriter</code>)."}, {"owner": {"reputation": 31, "user_id": 8765245, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1uQR1Q09hbc/AAAAAAAAAAI/AAAAAAAAAUU/LqNnrTpEb64/photo.jpg?sz=128", "display_name": "\u0428\u0430\u043c\u0438\u043b\u044c \u0413\u0430\u0440\u0430\u0442\u0443\u0435\u0432", "link": "https://stackoverflow.com/users/8765245/%d0%a8%d0%b0%d0%bc%d0%b8%d0%bb%d1%8c-%d0%93%d0%b0%d1%80%d0%b0%d1%82%d1%83%d0%b5%d0%b2"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1519195833, "post_id": 48887290, "comment_id": 84804681, "body": "@Adrian, thank you, i&#39;ll take a try"}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 1, "last_activity_date": 1519136863, "last_edit_date": 1519136863, "creation_date": 1519136548, "answer_id": 48887387, "question_id": 48887290, "link": "https://stackoverflow.com/questions/48887290/is-it-possible-to-convert-byte-to-os-file-and-vise-versa-in-memory-or-anyhow-e/48887387#48887387", "title": "Is it possible to convert []byte to os.File and vise versa in-memory or anyhow export/import file as os.File to/from database?", "body": "<p>No, you cannot do it because <code>os.File</code> holds a file descriptor, this descriptor is a number managed by operating system. It is valid while the file is open, when it gets closed, it is unusable.</p>\n"}], "owner": {"reputation": 31, "user_id": 8765245, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1uQR1Q09hbc/AAAAAAAAAAI/AAAAAAAAAUU/LqNnrTpEb64/photo.jpg?sz=128", "display_name": "\u0428\u0430\u043c\u0438\u043b\u044c \u0413\u0430\u0440\u0430\u0442\u0443\u0435\u0432", "link": "https://stackoverflow.com/users/8765245/%d0%a8%d0%b0%d0%bc%d0%b8%d0%bb%d1%8c-%d0%93%d0%b0%d1%80%d0%b0%d1%82%d1%83%d0%b5%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1014, "favorite_count": 0, "accepted_answer_id": 48887387, "answer_count": 1, "score": -1, "last_activity_date": 1519138516, "creation_date": 1519136212, "last_edit_date": 1519138516, "question_id": 48887290, "link": "https://stackoverflow.com/questions/48887290/is-it-possible-to-convert-byte-to-os-file-and-vise-versa-in-memory-or-anyhow-e", "title": "Is it possible to convert []byte to os.File and vise versa in-memory or anyhow export/import file as os.File to/from database?", "body": "<p>I'm writing a program on MacOS, that has to make user-space-filesystem via FUSE and <a href=\"https://github.com/hanwen/go-fuse\" rel=\"nofollow noreferrer\">gofuse</a>. The idea is to store all files inside a database (SQLITE for example) and implement FUSE-methods to access those files from FUSE-mountpoint. For this to work I have to efficiently store my files as os.File or have some methods to convert []byte to os.File struct, because I have to work with os.File objects, while implementing Write and Read functions inside FUSE. </p>\n\n<p>Is there any way to convert []byte to os.File in-memory, without making any additional files on hard drive?</p>\n"}, {"tags": ["go", "struct", "reflection"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1519130103, "post_id": 48885332, "comment_id": 84775393, "body": "Are you getting json from outside or struct. Since it is not applicable to create a struct dynamically. You need to declare it then only you can use it"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1519130136, "post_id": 48885332, "comment_id": 84775411, "body": "Please post more code of your json your question is not clear from the code you have posted"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1519130682, "post_id": 48885332, "comment_id": 84775716, "body": "With reflect.TypeOf and reflect.New."}, {"owner": {"reputation": 84, "user_id": 8392778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d814713bef51c89c039b42ebe9a8be8f?s=128&d=identicon&r=PG&f=1", "display_name": "Murat G&#252;zel", "link": "https://stackoverflow.com/users/8392778/murat-g%c3%bczel"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1519134194, "post_id": 48885332, "comment_id": 84778069, "body": "@Himanshu I added more details about my post"}], "answers": [{"tags": [], "owner": {"reputation": 6357, "user_id": 6086311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb99289473f6393b89474785f2d294d1?s=128&d=identicon&r=PG", "display_name": "dtolnay", "link": "https://stackoverflow.com/users/6086311/dtolnay"}, "is_accepted": true, "score": 1, "last_activity_date": 1519716498, "creation_date": 1519716498, "answer_id": 49003327, "question_id": 48885332, "link": "https://stackoverflow.com/questions/48885332/how-to-create-struct-runtime-in-golang/49003327#49003327", "title": "How to create struct runtime in golang", "body": "<p>The <a href=\"https://github.com/mitchellh/copystructure\" rel=\"nofollow noreferrer\"><code>github.com/mitchellh/copystructure</code></a> library handles this operation, which is known as a <a href=\"https://en.wikipedia.org/wiki/Object_copying\" rel=\"nofollow noreferrer\">deep copy</a>. After performing a deep copy, the original and the copy contain the same data but modifications to either one do not affect the other.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/mitchellh/copystructure\"\n)\n\ntype Person struct {\n    Id      int\n    Name    string\n    Surname string\n}\n\nfunc main() {\n    original := Person{Id: 0, Name: \"n\", Surname: \"s\"}\n\n    copy := deepCopy(original)\n\n    // Change fields of the original Person.\n    original.Id = 9\n    fmt.Printf(\"original: %#v\\n\", original)\n\n    // The copy of the Person has not change, still has Id:0.\n    fmt.Printf(\"copy: %#v\\n\", copy)\n}\n\nfunc deepCopy(original interface{}) interface{} {\n    copy, err := copystructure.Copy(original)\n    if err != nil {\n        panic(err)\n    }\n    return copy\n}\n</code></pre>\n"}], "owner": {"reputation": 84, "user_id": 8392778, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d814713bef51c89c039b42ebe9a8be8f?s=128&d=identicon&r=PG&f=1", "display_name": "Murat G&#252;zel", "link": "https://stackoverflow.com/users/8392778/murat-g%c3%bczel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2387, "favorite_count": 1, "accepted_answer_id": 49003327, "answer_count": 1, "score": -2, "last_activity_date": 1519716498, "creation_date": 1519129742, "last_edit_date": 1519143574, "question_id": 48885332, "link": "https://stackoverflow.com/questions/48885332/how-to-create-struct-runtime-in-golang", "title": "How to create struct runtime in golang", "body": "<p>For example, I have a struct that I take from the outside. I do not know the struct in fields and field values. I want to copy and use the same struct.\nWith reflection I find the fields and types in it. But how do I create this struct in the <strong>runtime</strong>?</p>\n\n<p>Edit : I just want to create a struct in the same name as the runtime. Imagine I do not know my person type. I just want to create the same struct by reflection with interface.\nI only know one interface. Person struct I just created it for instance. When a person creates a struct and sends it out, I will create it. instead of person, customer, student etc. You can send.\nconsider the following code as a 3rd party library.</p>\n\n<pre><code>\npackage main\n\nimport(\n\n    \"fmt\" \n    \"reflect\"\n)\n\ntype Person struct {\n    Id  int  \n    Name string   \n    Surname string  \n}\n\nfunc main(){\n\n    person := NewSomething()\n\n    newPerson := typeReflection(person)\n\n    ChangePerson(newPerson)\n\n    fmt.Println(\"Success\")\n}\n\nfunc typeReflection(_person interface{}){\n\n    val := reflect.ValueOf(_person)\n    //How to create same struct\n\n}\n\n\n\n</code></pre>\n"}, {"tags": ["go", "circular-reference"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1519127644, "post_id": 48884459, "comment_id": 84773876, "body": "Types that are codependent belong in the same package. Also never use relative import paths."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 6, "creation_date": 1519127793, "post_id": 48884459, "comment_id": 84773969, "body": "It is not helpful to program Java in Go. If you want to do it in Go: Do it in Go and stop the &quot;but I want to be it like Java&quot; attitude."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1519142592, "post_id": 48884459, "comment_id": 84783837, "body": "Even in Java, circular dependencies are a sign of a poor design. The compiler just doesn&#39;t forbid them."}, {"owner": {"reputation": 1958, "user_id": 3217013, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8fe4c19ed2edcb4fe6e661a5faed0205?s=128&d=identicon&r=PG&f=1", "display_name": "Emil", "link": "https://stackoverflow.com/users/3217013/emil"}, "edited": false, "score": 0, "creation_date": 1519151437, "post_id": 48884459, "comment_id": 84789338, "body": "My guess is that the reason Java allows you to do this is because keywords like <code>protected</code> make a difference as to what goes in the package and what doesn&#39;t. I don&#39;t think the same arguments that can be made for doing this in Java would work for Go based purely on the semantics of each language."}], "answers": [{"comments": [{"owner": {"reputation": 54, "user_id": 6211393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e724b44a45521295b63a71052fc125a4?s=128&d=identicon&r=PG", "display_name": "Titou", "link": "https://stackoverflow.com/users/6211393/titou"}, "edited": false, "score": 0, "creation_date": 1519165485, "post_id": 48884712, "comment_id": 84796227, "body": "&quot;One extra point of a recommendation - use a pointer of structure but not as a value. &quot; Yeah I&#39;ll change that !  Thx for the advice of interfaces but my project is not about pokemons and I don&#39;t have many type of pokemon :)"}], "tags": [], "owner": {"reputation": 196, "user_id": 9318001, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-zqIyjOOecao/AAAAAAAAAAI/AAAAAAAAAv4/QLqiX-BzjTk/photo.jpg?sz=128", "display_name": "alexey_p", "link": "https://stackoverflow.com/users/9318001/alexey-p"}, "is_accepted": false, "score": 0, "last_activity_date": 1519127533, "creation_date": 1519127533, "answer_id": 48884712, "question_id": 48884459, "link": "https://stackoverflow.com/questions/48884459/golang-circular-import-structs/48884712#48884712", "title": "Golang Circular import structs", "body": "<p>I suggest you using interface for Pokemon. Perhaps you will add a several type of a pokemon and PokeTrainer should to train each one.</p>\n\n<p>Example:</p>\n\n<p><strong>poketrainer.go</strong></p>\n\n<pre><code>package pokeTrainers\n\ntype IPokemon interface {\n    train() error\n}\n\ntype PokeTrainer struct {\n   name        string\n   pokemon    []IPokemon\n}\n</code></pre>\n\n<p><strong>pokemon.go</strong></p>\n\n<pre><code>package pokemons\n\nimport \"github.com/pokemonWorld/pokeTrainers\"\n\ntype Pikachu struct {\n   name   string\n   sensei *PokeTrainer\n}\n\nfunc (o *Pikachu) train() error {\n   // your code here\n}\n</code></pre>\n\n<p>One extra point of a recommendation - use a pointer of structure but not as a value.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1519128249, "last_edit_date": 1519128249, "creation_date": 1519127572, "answer_id": 48884722, "question_id": 48884459, "link": "https://stackoverflow.com/questions/48884459/golang-circular-import-structs/48884722#48884722", "title": "Golang Circular import structs", "body": "<p>Either use a <strong>single package</strong>, so no import is needed.</p>\n\n<p>Or designate one of your packages to be a \"master\", and put \"everything\" that is needed from both packages into this \"master\", and so only the other package needs to import \"master\" by definition (and \"master\" doesn't need to import the other).</p>\n\n<p>Or you have to create a 3rd package for the stuff that is needed from both, and your 2 current packages only have to import this 3rd common package.</p>\n\n<p>P.S. And don't use relative imports. Always use the complete package path.</p>\n"}], "owner": {"reputation": 54, "user_id": 6211393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e724b44a45521295b63a71052fc125a4?s=128&d=identicon&r=PG", "display_name": "Titou", "link": "https://stackoverflow.com/users/6211393/titou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 946, "favorite_count": 0, "accepted_answer_id": 48884722, "answer_count": 2, "score": 0, "last_activity_date": 1545227874, "creation_date": 1519126639, "last_edit_date": 1545227874, "question_id": 48884459, "link": "https://stackoverflow.com/questions/48884459/golang-circular-import-structs", "title": "Golang Circular import structs", "body": "<p>My code is simple.</p>\n\n<pre><code>Project/\n    main.go\n    pokemons/\n        pokemon.go\n    pokeTrainers/\n        pokeTrainer.go\n</code></pre>\n\n<hr>\n\n<p>I have some Pokemon trainers which are defined like this :</p>\n\n<pre><code>package pokeTrainers\n\nimport \"../pokemons\"\n\ntype PokeTrainer struct {\n    name        string\n    pokemon    []Pokemon\n}\n</code></pre>\n\n<hr>\n\n<p>And some Pokemon :</p>\n\n<pre><code>package pokemons\n\nimport \"../pokeTrainers\"\n\ntype Pokemon struct {\n    name            string\n    pokeTrainers    PokeTrainer\n    }\n</code></pre>\n\n<hr>\n\n<p>main package is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"./pokemons\"\n    \"./pokeTrainers\"\n)\n\nfunc main() {\n    fmt.Printf(\"ERROR CIRCULAR IMPORT\")\n</code></pre>\n\n<hr>\n\n<p>As always when I have an error, I copy-paste it on google. I learn what's a circular import and how people fix it with interface to use methods from another package without import it. But in my case, the problem is not to use methods but a real Type defined in another package. </p>\n\n<p>So you will probably say: \"Man you are dumb ! You just have to put everything on the same package and it's fine !\" \nSorry, I come from Java and I would like that my code stays clean. ;)</p>\n\n<p>I saw this <a href=\"https://stackoverflow.com/questions/30029502/circular-import-with-structs-in-golang\">link</a> which suggest to use a third party packages ? But you have to imagine that I don't have only pokemon and pokeTrainer, I have many more packages with a type inside and a lot of methods.. </p>\n\n<p>What do you think ? How can I fix this error proprelly ? I'm a beginner in Go</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 288, "user_id": 5991301, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-yAIhcFZOZXo/AAAAAAAAAAI/AAAAAAAAAD0/1-tCngyKkr0/photo.jpg?sz=128", "display_name": "Thinker", "link": "https://stackoverflow.com/users/5991301/thinker"}, "edited": false, "score": 0, "creation_date": 1519198805, "post_id": 48883912, "comment_id": 84806171, "body": "hi Marc&amp;Sarath thanx for the response, But i can do the same task with following codes.      func DoActionWithoutMethodExpression(f func(int), n int){          f(n);     }    func main() {    shouldBark:=false;       var dog Dog;     if (shouldBark) {         DoActionWithoutMethodExpression(dog.Bark,5);     } else {                 DoActionWithoutMethodExpression(dog.Sit,5);     } } So why i use method expression?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 288, "user_id": 5991301, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-yAIhcFZOZXo/AAAAAAAAAAI/AAAAAAAAAD0/1-tCngyKkr0/photo.jpg?sz=128", "display_name": "Thinker", "link": "https://stackoverflow.com/users/5991301/thinker"}, "edited": false, "score": 0, "creation_date": 1519199669, "post_id": 48883912, "comment_id": 84806586, "body": "This is different. In my case, <code>DoAction</code> doesn&#39;t know what the action is, it just runs it. This is useful if you want to pass one of many functions down to helper code."}, {"owner": {"reputation": 288, "user_id": 5991301, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-yAIhcFZOZXo/AAAAAAAAAAI/AAAAAAAAAD0/1-tCngyKkr0/photo.jpg?sz=128", "display_name": "Thinker", "link": "https://stackoverflow.com/users/5991301/thinker"}, "edited": false, "score": 0, "creation_date": 1519199875, "post_id": 48883912, "comment_id": 84806700, "body": "In DoAction you passed the pointer to the function of struct Dog, that it needs to call and I am doing the same, then how it is different?Am i missing something?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 288, "user_id": 5991301, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-yAIhcFZOZXo/AAAAAAAAAAI/AAAAAAAAAD0/1-tCngyKkr0/photo.jpg?sz=128", "display_name": "Thinker", "link": "https://stackoverflow.com/users/5991301/thinker"}, "edited": false, "score": 0, "creation_date": 1519200635, "post_id": 48883912, "comment_id": 84807101, "body": "You&#39;re technically passing the method itself, it&#39;s no longer a method expression. There&#39;s nothing wrong with either, and people tend to use yours. As I mentioned in my answer, method expressions are not very commonly used. One case would be if the method and the object to act on come from different places (eg: I give the methods expression to a function, and it consumes object to apply it on from a channel). A very rare case."}, {"owner": {"reputation": 288, "user_id": 5991301, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-yAIhcFZOZXo/AAAAAAAAAAI/AAAAAAAAAD0/1-tCngyKkr0/photo.jpg?sz=128", "display_name": "Thinker", "link": "https://stackoverflow.com/users/5991301/thinker"}, "edited": false, "score": 0, "creation_date": 1519200809, "post_id": 48883912, "comment_id": 84807187, "body": "ok, I got your point.  This can be the use case.So technically they are two ways of achieving the same thing."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 288, "user_id": 5991301, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-yAIhcFZOZXo/AAAAAAAAAAI/AAAAAAAAAD0/1-tCngyKkr0/photo.jpg?sz=128", "display_name": "Thinker", "link": "https://stackoverflow.com/users/5991301/thinker"}, "edited": false, "score": 0, "creation_date": 1519200960, "post_id": 48883912, "comment_id": 84807276, "body": "In the example from your comment above, they would indeed both be possible solutions. There are other cases (different source of the &quot;action&quot; and the object) where only the method receiver would work."}, {"owner": {"reputation": 288, "user_id": 5991301, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-yAIhcFZOZXo/AAAAAAAAAAI/AAAAAAAAAD0/1-tCngyKkr0/photo.jpg?sz=128", "display_name": "Thinker", "link": "https://stackoverflow.com/users/5991301/thinker"}, "edited": false, "score": 0, "creation_date": 1519201205, "post_id": 48883912, "comment_id": 84807413, "body": "but &quot;actions&quot; need to have the same signature right?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "reply_to_user": {"reputation": 288, "user_id": 5991301, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-yAIhcFZOZXo/AAAAAAAAAAI/AAAAAAAAAD0/1-tCngyKkr0/photo.jpg?sz=128", "display_name": "Thinker", "link": "https://stackoverflow.com/users/5991301/thinker"}, "edited": false, "score": 0, "creation_date": 1519201310, "post_id": 48883912, "comment_id": 84807455, "body": "Yes, but this is true of callbacks in general: if you pass arguments to them, you need to know what types they are. Not many ways around it."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 9, "last_activity_date": 1519129755, "last_edit_date": 1519129755, "creation_date": 1519124975, "answer_id": 48883912, "question_id": 48883754, "link": "https://stackoverflow.com/questions/48883754/can-any-one-explain-this-go-program-which-uses-a-method-expression/48883912#48883912", "title": "Can any one explain this go program which uses a method expression", "body": "<p>A <a href=\"https://golang.org/ref/spec#Method_expressions\" rel=\"noreferrer\">method expression</a> is a function that can be called like a regular function, except that you also pass the object to act on as the first argument. This is because it needs to know which object to use.</p>\n\n<p>Normally, you would just use the following:</p>\n\n<pre><code>d := &amp;Dog{}\nd.Bark(5)\n</code></pre>\n\n<p>But using a method expression, you can \"save\" the function, allowing you to pass it to something else. For example, you could choose to use <code>(*Dog).Bark</code> or <code>(*Dog).Sit</code> as an action, and call it from a helper. eg:</p>\n\n<pre><code>func main() {\n    var b func(*Dog, int)\n    if (shouldBark) {\n        b = (*Dog).Bark\n    } else {\n        b = (*Dog).Sit\n    }\n    d := Dog{}\n    DoAction(b, &amp;d, 3)\n}\n\nfunc DoAction(f func(*Dog, int), d *Dog, n int) {\n    f(d, n)\n}\n</code></pre>\n\n<p>The specific syntax <code>(*Dog).Bark</code> means that you are deriving a function for a method with pointer receiver.</p>\n\n<p>Honestly, these are not very frequently used. I would recommend you get a good grasp of the language first (eg: take the entire <a href=\"https://tour.golang.org/\" rel=\"noreferrer\">Go tour</a>), then explore less used functionality at a later date.</p>\n"}], "owner": {"reputation": 288, "user_id": 5991301, "user_type": "registered", "accept_rate": 36, "profile_image": "https://lh5.googleusercontent.com/-yAIhcFZOZXo/AAAAAAAAAAI/AAAAAAAAAD0/1-tCngyKkr0/photo.jpg?sz=128", "display_name": "Thinker", "link": "https://stackoverflow.com/users/5991301/thinker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 653, "favorite_count": 2, "accepted_answer_id": 48883912, "answer_count": 1, "score": 3, "last_activity_date": 1519137591, "creation_date": 1519124497, "last_edit_date": 1519137591, "question_id": 48883754, "link": "https://stackoverflow.com/questions/48883754/can-any-one-explain-this-go-program-which-uses-a-method-expression", "title": "Can any one explain this go program which uses a method expression", "body": "<p>I was going through some go tutorials but I'm not able to understand what method expressions are in go. Can anyone explain this code to me and why/when I should use it?</p>\n\n<pre><code> // Method call with \"method expression\" syntax\n func main() {\n    dog := Dog{}\n    b := (*Dog).Bark // method expression \n    b(&amp;dog, 5)\n }\n type Dog struct {}\n\n // Methods have a receiver, and can also have a pointer\n func (d *Dog) Bark(n int) {\n   for i := 0; i &lt; n; i++ {\n      fmt.Println(\"Bark\");\n   }\n }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1519123056, "post_id": 48883173, "comment_id": 84770657, "body": "@Marc - the code is diffrent ..."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1519123134, "post_id": 48883173, "comment_id": 84770711, "body": "The function call is different, everything else is exactly the same. If you understand your code, the linked answer tells you all you need. If you don&#39;t, please take the time to understand it."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1519123486, "post_id": 48883173, "comment_id": 84770978, "body": "@Marc - the code <code>header.Name = strings.TrimPrefix(path, source)</code> is used and still the basedir is zipped"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1519123735, "post_id": 48883173, "comment_id": 84771176, "body": "That&#39;s because <code>basedir</code> is set to <code>params2</code> which is <code>dir</code>. I believe <code>Walk</code> passes <code>..&#47;dir1</code>, so it won&#39;t trim anything. trace your code, add debug statements, and find which arguments to pass."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1519123838, "post_id": 48883173, "comment_id": 84771244, "body": "@Marc - even if I remove params2 its not working becouse the source is <code>&quot;..&#47;dir1&quot; </code>, any suggestion"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1519124129, "post_id": 48883173, "comment_id": 84771486, "body": "Pass <code>..&#47;dir1&#47;</code> as your <code>params[2]</code>. But really, add print statements to understand what the code does."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1519153023, "post_id": 48883173, "comment_id": 84790241, "body": "@Marc - Thanks for the tip it works!  when I use this logic from my main program it works because providing path like <code>&quot;..&#47;dir1&quot;</code> is simple from the main program, but now I need to call to the zip func deeper in the program,  and im providing the full path to it like <code>os.Getwd()</code> + &quot;dirname&quot;`, any idea?"}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 1, "closed_date": 1523164989, "answer_count": 0, "score": 0, "last_activity_date": 1519130929, "creation_date": 1519122743, "last_edit_date": 1519130929, "question_id": 48883173, "link": "https://stackoverflow.com/questions/48883173/zip-directory-without-header", "closed_reason": "Duplicate", "title": "Zip directory without header", "body": "<p>I use the following code to zip directory , the problem is that I want to zip the dir content without the header e.g. , I try to play with the basedir without success </p>\n\n<pre><code>dir1\n -file1\n -file2\n   -file10\n</code></pre>\n\n<p>when I unzip I need to get only </p>\n\n<pre><code>-file1\n -file2\n   -file10\n</code></pre>\n\n<p>This is the code</p>\n\n<pre><code>func Zip(params ...string) error {\n        zipfile, err := os.Create(params[1])\n        if err != nil {\n            return err\n        }\n        defer zipfile.Close()\n\n        archive := zip.NewWriter(zipfile)\n        defer archive.Close()\n\n        info, err := os.Stat(params[0])\n        if err != nil {\n            return err\n        }\n\n        var baseDir string\n        if info.IsDir(); len(params) &gt; 2 {\n            baseDir = params[2]\n        } else {\n            baseDir = filepath.Base(params[0])\n        }\n\n        if baseDir != \"\" {\n            baseDir += \"/\"\n        }\n\n        filepath.Walk(params[0], func(path string, info os.FileInfo, err error) error {\n            if err != nil {\n                return err\n            }\n\n            if info.IsDir() {\n                return nil\n            }\n\n            header, err := zip.FileInfoHeader(info)\n            if err != nil {\n                return err\n            }\n\n            if baseDir != \"\" {\n                header.Name = filepath.Join(strings.TrimPrefix(path, baseDir))\n            }\n\n            header.Method = zip.Deflate\n\n            writer, err := archive.CreateHeader(header)\n            if err != nil {\n                return err\n            }\n\n            file, err := os.Open(path)\n            if err != nil {\n                return err\n            }\n            defer file.Close()\n            _, err = io.Copy(writer, file)\n            return err\n        })\n\n        return err\n    }\n</code></pre>\n\n<p>And I use it</p>\n\n<pre><code>Zip(\"../dir1\",\"../\"+zipname+\".zip\",\"dir1\")\n</code></pre>\n\n<p>The problem that it zip's also the dir name...How can I do that ?</p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519122287, "post_id": 48882966, "comment_id": 84770051, "body": "BDD is a pattern primarily for developing UIs. Your code doesn&#39;t appear to relate to a UI, so BDD likely doens&#39;t apply. Second, if you&#39;re writing an auth module, why do you need a non-technical explanation? Only technically inclined people use modules, typically.  This really looks like a problem for plain old vanilla TDD."}, {"owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519122456, "post_id": 48882966, "comment_id": 84770186, "body": "I didn&#39;t see any information showing BDD is only for UI. Another thing, how to apply these human-readable explanations in another module that is more business-related?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519122546, "post_id": 48882966, "comment_id": 84770251, "body": "The B in BDD stands for &quot;Behavior&quot;.  Software &quot;behavior&quot; only exists at a UI level. &quot;Behavior&quot; is what the end-user observes."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1519122590, "post_id": 48882966, "comment_id": 84770294, "body": "Write table driven tests and have one entry in the table with name &quot;less than 6 characters long&quot; and one with &quot;more than 48 ...&quot; you get it. Just take a look how the stdlib does it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519122618, "post_id": 48882966, "comment_id": 84770318, "body": "First, determine if human-readable explanations make sense. I don&#39;t think they do for your example, but I can&#39;t really be the one to judge that.  Second, if you need human-readable explanations, you have two options: 1) A human-readable version, and an executable version, or 2) A human-readable executable version. Go does not provide the latter. Some popular BDD tools, like Cucumber, do."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519122733, "post_id": 48882966, "comment_id": 84770426, "body": "After the comments, this question looks like &quot;Is there a human-readable, executable test specification language I can use in Go?&quot; Which is off-topic (and the answer is probably no--at the moment)."}, {"owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "edited": false, "score": 0, "creation_date": 1519123081, "post_id": 48882966, "comment_id": 84770672, "body": "I see in testing libraries things like suites and tests grouped into suites, that have descriptions like &quot;Auth should return error if password length is less than 8 or longer than 48&quot;. So the question is what&#39;s the possible option to add these lines to tests in Go using standard testing package."}], "answers": [{"tags": [], "owner": {"reputation": 104, "user_id": 9384701, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vTWibx0fC3o/AAAAAAAAAAI/AAAAAAAAFX4/busRlfuEfAU/photo.jpg?sz=128", "display_name": "Axel Wagner", "link": "https://stackoverflow.com/users/9384701/axel-wagner"}, "is_accepted": false, "score": 0, "last_activity_date": 1519122914, "creation_date": 1519122914, "answer_id": 48883223, "question_id": 48882966, "link": "https://stackoverflow.com/questions/48882966/how-to-implement-bdd-practices-with-standard-go-testing-package/48883223#48883223", "title": "How to implement BDD practices with standard Go testing package?", "body": "<p>In Go, the idiomatic way to write these kinds of tests is:</p>\n\n<pre><code>func TestCheckPassword(t *testing.T) {\n    tcs := []struct {\n        pw string\n        hash string\n        want bool\n    }{\n        {\"test\", \"$2a$14$rz.gZgh9CHhXQEfLfuSeRuRrR5uraTqLChRW7/Il62KNOQI9vjO2S\", true},\n        {\"foo\", \"$2a$14$rz.gZgh9CHhXQEfLfuSeRuRrR5uraTqLChRW7/Il62KNOQI9vjO2S\", false},\n        {\"\", \"$2a$14$rz.gZgh9CHhXQEfLfuSeRuRrR5uraTqLChRW7/Il62KNOQI9vjO2S\", false},\n    }\n\n    for _, tc := range tests {\n        got := CheckPasswordHash(tc.pw, tc.hash)\n        if got != tc.want {\n            t.Errorf(\"CheckPasswordHash(%q, %q) = %v, want %v\", tc.pw, tc.hash, got, want)\n        }\n    }\n}\n</code></pre>\n\n<p>This is called \"table-driven testing\". You create a table of inputs and expected outputs, you iterate over that table and call your function and if the expected output does not match what you want, you write an error message describing the failure.</p>\n\n<p>If what you want isn't as simple as comparing a return against a golden value - for example, you want to check that either an error, or a value is returned, or that a well-formed hash+salt is returned, but don't care <em>what</em> salt is used (as that's not part of the API), you'd write additional code for that - in the end, you simply write down what properties the result should have, add some if's to check that and provide a descriptive error message if the result is not as expected. So, say:</p>\n\n<pre><code>func Hash(pw string) (hash string, err error) {\n    // Validate input, create salt, hash thing\u2026\n}\n\nfunc TestHash(t *testing.T) {\n    tcs := []struct{\n        pw string\n        wantError bool\n    }{\n        {\"\", true},\n        {\"foo\", true},\n        {\"foobar\", false},\n        {\"foobarbaz\", true},\n    }\n\n    for _, tc := range tcs {\n        got, err := Hash(tc.pw)\n        if err != nil {\n            if !tc.wantError {\n                t.Errorf(\"Hash(%q) = %q, %v, want _, nil\", tc.pw, got, err)\n            }\n            continue\n        }\n        if len(got) != 52 {\n            t.Errorf(\"Hash(%q) = %q, want 52 character string\", tc.pw, got)\n        }\n        if !CheckPasswordHash(tc.pw, got) {\n            t.Errorf(\"CheckPasswordHash(Hash(%q)) = false, want true\", tc.pw)\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "edited": false, "score": 0, "creation_date": 1519129231, "post_id": 48884579, "comment_id": 84774863, "body": "Seems like the closest solution to my problem, thanks!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1519313428, "last_edit_date": 1519313428, "creation_date": 1519127058, "answer_id": 48884579, "question_id": 48882966, "link": "https://stackoverflow.com/questions/48882966/how-to-implement-bdd-practices-with-standard-go-testing-package/48884579#48884579", "title": "How to implement BDD practices with standard Go testing package?", "body": "<p>In Go, a common way of writing tests to perform related checks is to create a slice of test cases (which is referred to as the <em>\"table\"</em> and the method as <em>\"table-driven tests\"</em>), which we simply loop over and execute one-by-one.</p>\n\n<p>A test case may have arbitrary properties, which is usually modeled by an anonymous struct.<br>\nIf you want to provide a description for test cases, <strong>you can add an additional field to the struct describing a test case</strong>. This will serve both as <em>documentation</em> of the test case and as (part of the) <em>output</em> in case the test case would fail.</p>\n\n<p>For simplicity, let's test the following simple <code>Abs()</code> function:</p>\n\n<pre><code>func Abs(x int) int {\n    if x &lt; 0 {\n        return -x\n    }\n    return x\n}\n</code></pre>\n\n<p>The implementation seems to be right and complete. If we'd want to write tests for this, normally we would add 2 test cases to cover the 2 possible branches: test when <code>x</code> is negative (<code>x &lt; 0</code>), and when <code>x</code> is non-negative. In reality, it's often handy and recommended to also test the special <code>0</code> input and the corner cases: the min and max values of the input.</p>\n\n<p>If we think about it, this <code>Abs()</code> function won't even give a correct result when called with the minimum value of <code>int32</code>, because that is <code>-2147483648</code>, and its absolute value is <code>2147483648</code> which doesn't fit into <code>int32</code> because max value of <code>int32</code> is: <code>2147483647</code>. So the above implementation will <em>overflow</em> and incorrectly give the negative min value as the absolute of the negative min.</p>\n\n<p>The test function that lists cases for each possible branches plus includes <code>0</code> and the corner cases, with descriptions:</p>\n\n<pre><code>func TestAbs(t *testing.T) {\n    cases := []struct {\n        desc string // Description of the test case\n        x    int32  // Input value\n        exp  int32  // Expected output value\n    }{\n        {\n            desc: \"Abs of positive numbers is the same\",\n            x:    1,\n            exp:  1,\n        },\n        {\n            desc: \"Abs of 0 is 0\",\n            x:    0,\n            exp:  0,\n        },\n        {\n            desc: \"Abs of negative numbers is -x\",\n            x:    -1,\n            exp:  1,\n        },\n        {\n            desc: \"Corner case testing MaxInt32\",\n            x:    math.MaxInt32,\n            exp:  math.MaxInt32,\n        },\n        {\n            desc: \"Corner case testing MinInt32, which overflows\",\n            x:    math.MinInt32,\n            exp:  math.MinInt32,\n        },\n    }\n\n    for _, c := range cases {\n        got := Abs(c.x)\n        if got != c.exp {\n            t.Errorf(\"Expected: %d, got: %d, test case: %s\", c.exp, got, c.desc)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": false, "score": 0, "last_activity_date": 1519135770, "creation_date": 1519135770, "answer_id": 48887154, "question_id": 48882966, "link": "https://stackoverflow.com/questions/48882966/how-to-implement-bdd-practices-with-standard-go-testing-package/48887154#48887154", "title": "How to implement BDD practices with standard Go testing package?", "body": "<p>If you want a test suite with descriptive texts and contexts (like rspec for ruby) you should check out ginko: <a href=\"https://onsi.github.io/ginkgo/\" rel=\"nofollow noreferrer\">https://onsi.github.io/ginkgo/</a></p>\n"}], "owner": {"reputation": 42794, "user_id": 135829, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/zfWZK.jpg?s=128&g=1", "display_name": "Sergei Basharov", "link": "https://stackoverflow.com/users/135829/sergei-basharov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 48884579, "answer_count": 3, "score": 0, "last_activity_date": 1519313428, "creation_date": 1519122169, "question_id": 48882966, "link": "https://stackoverflow.com/questions/48882966/how-to-implement-bdd-practices-with-standard-go-testing-package", "title": "How to implement BDD practices with standard Go testing package?", "body": "<p>I want to write tests first, then write code that makes the tests pass.</p>\n\n<p>I can write tests functions like this:</p>\n\n<pre><code>func TestCheckPassword(t *testing.T) {\n    isCorrect := CheckPasswordHash(\"test\", \"$2a$14$rz.gZgh9CHhXQEfLfuSeRuRrR5uraTqLChRW7/Il62KNOQI9vjO2S\")\n\n    if isCorrect != true {\n        t.Errorf(\"Password is wrong\")\n    }\n}\n</code></pre>\n\n<p>But I'd like to have more descriptive information for each test function.</p>\n\n<p>For example, I am thinking about creating auth module for my app.\nNow, in plain English, I can easily describe my requirements for this module:</p>\n\n<ol>\n<li>It should accept a non-empty string as input.</li>\n<li>String must be from 6 to 48 characters long.</li>\n<li>Function should return true if password string fits provided hash string and false if not.</li>\n</ol>\n\n<p>What's the way to put this information that is understandable by a non-tech business person into tests besides putting them into comments?</p>\n"}, {"tags": ["testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 2788, "user_id": 989991, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/x05ME.png?s=128&g=1", "display_name": "joakim", "link": "https://stackoverflow.com/users/989991/joakim"}, "edited": false, "score": 4, "creation_date": 1524587217, "post_id": 48882892, "comment_id": 87029724, "body": "It&#39;s still useful in case you&#39;re testing against a moving dependency e.g. a database where you setup / teardown the dependency but not your code. Looks like OP was testing against a non stubbed API which is what prompted their question."}, {"owner": {"reputation": 320, "user_id": 3861793, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01fcd0919cffeb8ae35ba423fe082440?s=128&d=identicon&r=PG", "display_name": "nickcamillo", "link": "https://stackoverflow.com/users/3861793/nickcamillo"}, "edited": false, "score": 0, "creation_date": 1547759653, "post_id": 48882892, "comment_id": 95313280, "body": "is it possible to clean the cache for specific tests only?"}, {"owner": {"reputation": 2113, "user_id": 1896328, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/7OqqP.jpg?s=128&g=1", "display_name": "voutasaurus", "link": "https://stackoverflow.com/users/1896328/voutasaurus"}, "edited": false, "score": 4, "creation_date": 1554227100, "post_id": 48882892, "comment_id": 97671397, "body": "Note that <code>go clean -testcache .&#47;...</code> works too (at the top of a monorepo)"}, {"owner": {"reputation": 441, "user_id": 1698727, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Y2TR5.jpg?s=128&g=1", "display_name": "wesm", "link": "https://stackoverflow.com/users/1698727/wesm"}, "edited": false, "score": 0, "creation_date": 1589397653, "post_id": 48882892, "comment_id": 109281763, "body": "I&#39;ve opened an issue to make this better as well: <a href=\"https://github.com/golang/go/issues/39056?ts=4\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/39056?ts=4</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1613131682, "post_id": 48882892, "comment_id": 116988023, "body": "great answer, I was needing this because i ran ttwice the test suite with a different set of env vars. This is required to trigger the test of different implementation that must pass the same series of tests. This helped to prevent code duplication."}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 201, "last_activity_date": 1519121952, "creation_date": 1519121952, "answer_id": 48882892, "question_id": 48882691, "link": "https://stackoverflow.com/questions/48882691/force-retesting-or-disable-test-caching/48882892#48882892", "title": "Force retesting or disable test caching", "body": "<p>There are a few options as described in the <a href=\"https://golang.org/cmd/go/#hdr-Testing_flags\" rel=\"noreferrer\">testing flags docs</a>:</p>\n\n<ul>\n<li><code>go clean -testcache</code>: expires all test results</li>\n<li>use non-cacheable flags on your test run. The idiomatic way is to use <code>-count=1</code></li>\n</ul>\n\n<p>That said, changes in your code or test code will invalidate the cached test results (there's extended logic when using local files or environment variables as well), so you should not need to invalidate the test cache manually.</p>\n"}, {"comments": [{"owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 6, "creation_date": 1546794237, "post_id": 50344194, "comment_id": 94960850, "body": "For <code>go 1.11</code> and having go modules feature on using <code>GOCACHE=off</code> gives an error <code>go: cannot use modules with build cache disabled</code>. The better is to use suggested <code>-count 1</code>."}, {"owner": {"reputation": 1300, "user_id": 606583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6uooE.png?s=128&g=1", "display_name": "soltysh", "link": "https://stackoverflow.com/users/606583/soltysh"}, "reply_to_user": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "edited": false, "score": 1, "creation_date": 1546863883, "post_id": 50344194, "comment_id": 94981532, "body": "You&#39;re right, according to <a href=\"https://github.com/golang/go/issues/26809#issuecomment-410477084\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/26809#issuecomment-410477084</a> <code>GOCACHE</code> will be slowly phased out in go 1.12 so using <code>go test -count=1 ...</code> is safer choice now."}, {"owner": {"reputation": 22099, "user_id": 828366, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/V8V1N.jpg?s=128&g=1", "display_name": "Francesco Casula", "link": "https://stackoverflow.com/users/828366/francesco-casula"}, "edited": false, "score": 0, "creation_date": 1588147220, "post_id": 50344194, "comment_id": 108784729, "body": "<code>build cache is disabled by GOCACHE=off, but required as of Go 1.12</code>"}], "tags": [], "owner": {"reputation": 1300, "user_id": 606583, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6uooE.png?s=128&g=1", "display_name": "soltysh", "link": "https://stackoverflow.com/users/606583/soltysh"}, "is_accepted": false, "score": 19, "last_activity_date": 1526368031, "creation_date": 1526368031, "answer_id": 50344194, "question_id": 48882691, "link": "https://stackoverflow.com/questions/48882691/force-retesting-or-disable-test-caching/50344194#50344194", "title": "Force retesting or disable test caching", "body": "<p>There's also <code>GOCACHE=off</code> mentioned <a href=\"https://github.com/golang/go/issues/22758#issuecomment-344921828\" rel=\"noreferrer\">here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 2648, "user_id": 1673772, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pyqck.jpg?s=128&g=1", "display_name": "Armand Grillet", "link": "https://stackoverflow.com/users/1673772/armand-grillet"}, "edited": false, "score": 5, "creation_date": 1573116005, "post_id": 53161889, "comment_id": 103778642, "body": "Build cache is required as of Go 1.12 thus setting <code>GOCACHE</code> will not work with recent versions of Go. A solution for VS Code is to set <code>&quot;go.testFlags&quot;: [&quot;-count=1&quot;]</code> in the settings."}], "tags": [], "owner": {"reputation": 198, "user_id": 617122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4301f34f9b322cdcc901e680c0cd81e4?s=128&d=identicon&r=PG", "display_name": "distortedsignal", "link": "https://stackoverflow.com/users/617122/distortedsignal"}, "is_accepted": false, "score": 7, "last_activity_date": 1544815596, "last_edit_date": 1544815596, "creation_date": 1541450472, "answer_id": 53161889, "question_id": 48882691, "link": "https://stackoverflow.com/questions/48882691/force-retesting-or-disable-test-caching/53161889#53161889", "title": "Force retesting or disable test caching", "body": "<p>The way that I fixed this (I'm using Visual Studio Code on macOS):</p>\n\n<p>Code > Preferences > Settings</p>\n\n<p>Click <code>...</code> on the right hand side of the settings page</p>\n\n<p>Click <code>Open settings.json</code></p>\n\n<p>Either:</p>\n\n<ol>\n<li><p>Add the following snippet to your settings.json file</p>\n\n<pre><code>\"go.testEnvVars\": {\n    \"GOCACHE\": \"off\"\n}\n</code></pre></li>\n<li>Change the value of <code>go.testEnvVars</code> to include the following: <code>\"GOCACHE\": \"off\"</code></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 14451, "user_id": 1334561, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LhV7w.jpg?s=128&g=1", "display_name": "Muhammad Soliman", "link": "https://stackoverflow.com/users/1334561/muhammad-soliman"}, "is_accepted": false, "score": 33, "last_activity_date": 1554415930, "creation_date": 1554415930, "answer_id": 55525661, "question_id": 48882691, "link": "https://stackoverflow.com/questions/48882691/force-retesting-or-disable-test-caching/55525661#55525661", "title": "Force retesting or disable test caching", "body": "<p>In Go11, I couldn't disable cache using <code>GOCACHE</code> with modules, I used <code>-count=1</code> instead: </p>\n\n<pre><code>go test -count=1\n</code></pre>\n\n<p>Prior to Go11: </p>\n\n<pre><code>GOCACHE=off go test\n</code></pre>\n\n<p>Or, clean test cache and run test again: </p>\n\n<pre><code>go clean -testcache &amp;&amp; go test \n</code></pre>\n"}], "owner": {"reputation": 1322, "user_id": 7533177, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YtNtF.jpg?s=128&g=1", "display_name": "Simon Frey", "link": "https://stackoverflow.com/users/7533177/simon-frey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60916, "favorite_count": 17, "accepted_answer_id": 48882892, "answer_count": 4, "score": 131, "last_activity_date": 1554415930, "creation_date": 1519121453, "last_edit_date": 1519121637, "question_id": 48882691, "link": "https://stackoverflow.com/questions/48882691/force-retesting-or-disable-test-caching", "title": "Force retesting or disable test caching", "body": "<p><strong>Problem:</strong></p>\n\n<p>When I run the same go test twice the second run is not done at all. The results are the cached ones from the first run.</p>\n\n<pre><code>PASS    \nok      tester/apitests    (cached)\n</code></pre>\n\n<p><strong>Links</strong></p>\n\n<p>I already checked <a href=\"https://golang.org/cmd/go/#hdr-Testing_flags\" rel=\"noreferrer\">https://golang.org/cmd/go/#hdr-Testing_flags</a> but there is no cli flag for that purpose.</p>\n\n<p><strong>Question:</strong></p>\n\n<p><strong>Is there a possibility to force go test to always run test and not to cache test results.</strong></p>\n"}, {"tags": ["go", "resources"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1519115526, "post_id": 48880737, "comment_id": 84765622, "body": "This is a bit too broad for a precise answer. If your program only crashes or gets killed, then you could skip closing them. However, you&#39;ll need to test your program which will need proper shutdown. <code>main</code> should call helpers, and those helpers should have a proper <code>Close</code> method that handles most of the shutdown."}, {"owner": {"reputation": 7679, "user_id": 370073, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/3a08086180419f07762db20ba8cc0904?s=128&d=identicon&r=PG", "display_name": "2hamed", "link": "https://stackoverflow.com/users/370073/2hamed"}, "reply_to_user": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1519115767, "post_id": 48880737, "comment_id": 84765757, "body": "@Marc wouldn&#39;t just killing the process take care of that?"}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 0, "creation_date": 1519115825, "post_id": 48880737, "comment_id": 84765797, "body": "Killing the process does not close things gracefully, it just dies. And tests don&#39;t kill the process, they need to shut it down and proceed to other tests."}], "answers": [{"tags": [], "owner": {"reputation": 104, "user_id": 9384701, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vTWibx0fC3o/AAAAAAAAAAI/AAAAAAAAFX4/busRlfuEfAU/photo.jpg?sz=128", "display_name": "Axel Wagner", "link": "https://stackoverflow.com/users/9384701/axel-wagner"}, "is_accepted": false, "score": 1, "last_activity_date": 1519122184, "creation_date": 1519122184, "answer_id": 48882970, "question_id": 48880737, "link": "https://stackoverflow.com/questions/48880737/when-to-release-resources-in-a-long-running-go-program/48882970#48882970", "title": "When to release resources in a long running Go program?", "body": "<p>One thing I tend to do is this:</p>\n\n<pre><code>func main() {\n    if err := run(); err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc run() error {\n    // Do stuff here\n}\n</code></pre>\n\n<p>In <code>run</code> you can then <code>defer</code> as you are used to. However, in a long-running program like a server, IMO it's fine to just exit: The OS will clean up all resources taken up by the process automatically and whatever database or backend you have a connection to, has to be able to handle the process dying unexpectedly <em>anyway</em>. This is called \"crash-only software\".</p>\n\n<p>For tests, you should build your code in a way that it doesn't depend on global state - e.g. have a struct that has fields for the database connections etc. Make the business logic a method on that struct (or a function taking it). You can then in your <code>main</code> populate such a struct and call its methods. And for testing, you can populate a struct, call its methods for whatever tests you want to do and then tear down the connections at the end of your test.</p>\n"}], "owner": {"reputation": 7679, "user_id": 370073, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/3a08086180419f07762db20ba8cc0904?s=128&d=identicon&r=PG", "display_name": "2hamed", "link": "https://stackoverflow.com/users/370073/2hamed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1519122184, "creation_date": 1519115277, "question_id": 48880737, "link": "https://stackoverflow.com/questions/48880737/when-to-release-resources-in-a-long-running-go-program", "title": "When to release resources in a long running Go program?", "body": "<p>I'm building a chat server using <a href=\"https://github.com/googollee/go-socket.io\" rel=\"nofollow noreferrer\">Go and Socket.io</a> hence the server would be running indefinitely. There are multiple resources which I need allocated upon the start of the program such as the database connection, redis connection, etc.</p>\n\n<p>Now I'm wondering when all these connections should be released (closed)? Can I use <code>defer</code> in the <code>main</code> function? Does that close them when <code>main</code> reaches its end? Or should I just leave 'em open since the program will not exit on its own accord?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 27, "user_id": 9383609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "kittu", "link": "https://stackoverflow.com/users/9383609/kittu"}, "edited": false, "score": 0, "creation_date": 1519174586, "post_id": 48877740, "comment_id": 84798924, "body": "Thanks you. This worked! :) But how do I convert any signal to byte array and write it to websocket?"}, {"owner": {"reputation": 27, "user_id": 9383609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "kittu", "link": "https://stackoverflow.com/users/9383609/kittu"}, "edited": false, "score": 0, "creation_date": 1519174698, "post_id": 48877740, "comment_id": 84798951, "body": "I mean, I specified manually to notify for ctrl+c by doing signal.Notify(d, os.Interrupt) , but I want to capture all of them and write it&#39;s byte equivalent to websocket instead of capturing specific signals. Thanks in advance!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1519246948, "last_edit_date": 1519246948, "creation_date": 1519100029, "answer_id": 48877740, "question_id": 48877342, "link": "https://stackoverflow.com/questions/48877342/how-to-capture-os-signals-like-ctrlc-and-send-them-through-gorilla-websocket-in/48877740#48877740", "title": "How to capture os signals like ctrl+c and send them through gorilla websocket in go", "body": "<p>Send a CTRL-C with </p>\n\n<pre><code>err = c.ws.WriteMessage(websocket.TextMessage, []byte{'\\003'})\nif err != nil {\n    // handle error\n}\n</code></pre>\n\n<p>Other useful info:  </p>\n\n<ul>\n<li><p>The printf mentions UTF-8 characters, but there's no guarantee that the byte is a valid UTF-8 character.  Consider using websocket.BinaryMessage instead.</p></li>\n<li><p>Use a mutex to prevent concurrent writes to the websocket connection.</p></li>\n<li><p>An alternative approach is to send the signal out of band to the peer and signal the remote process.</p></li>\n</ul>\n"}], "owner": {"reputation": 27, "user_id": 9383609, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "kittu", "link": "https://stackoverflow.com/users/9383609/kittu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 0, "accepted_answer_id": 48877740, "answer_count": 1, "score": 1, "last_activity_date": 1519246948, "creation_date": 1519096711, "question_id": 48877342, "link": "https://stackoverflow.com/questions/48877342/how-to-capture-os-signals-like-ctrlc-and-send-them-through-gorilla-websocket-in", "title": "How to capture os signals like ctrl+c and send them through gorilla websocket in go", "body": "<p>I am a newbie for go and websockets. I am trying to take input character by character and writing them to websocket. I even want to take ctrl+c as input and write it to websocket. </p>\n\n<pre><code>func (c *poc) writePump() {\n\n    var err error\n\n    exec.Command(\"stty\", \"-F\", \"/dev/tty\", \"cbreak\", \"min\", \"1\").Run()\n    exec.Command(\"stty\", \"-F\", \"/dev/tty\", \"-echo\").Run()\n    defer exec.Command(\"stty\", \"-F\", \"/dev/tty\", \"echo\").Run()\n\n    var b = make([]byte, 1)\n    d := make(chan os.Signal, 1)\n    signal.Notify(d, os.Interrupt)\n\n    for {\n        os.Stdin.Read(b)\n        err = c.ws.WriteMessage(websocket.TextMessage, b)\n        if err != nil {\n            log.Printf(\"Failed to send UTF8 char: %s\", err)\n        }\n\n        go func() {\n            for sig := range d {\n                // ????\n            }\n        }()\n    }\n}\n</code></pre>\n\n<p>This code is capturing the signal but not sure how to write to websocket.</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1519096673, "post_id": 48877299, "comment_id": 84758698, "body": "@Anuruddha sorry that was a typo fixed."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1519118323, "post_id": 48877299, "comment_id": 84767317, "body": "Because it&#39;s not exported."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1519118342, "post_id": 48877299, "comment_id": 84767335, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/11126793/json-and-dealing-with-unexported-fields\">JSON and dealing with unexported fields</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": true, "score": 3, "last_activity_date": 1519096761, "creation_date": 1519096761, "answer_id": 48877352, "question_id": 48877299, "link": "https://stackoverflow.com/questions/48877299/my-struct-is-not-encoding-correctly-and-is-missing-a-property/48877352#48877352", "title": "My struct is not encoding correctly and is missing a property", "body": "<p><code>authToken</code> filed is an unexported field. Json library does not have the power to view fields using reflect unless they are exported. A package can only view the unexported fields of types within its own package.</p>\n\n<p>You can export the filed to get this working</p>\n\n<pre><code>type NewSessionResponse struct {\n    ApiResponse     `json:\"apiResponse\"`\n    AuthToken   string `json:\"authToken\"`\n}\n</code></pre>\n\n<p>FYI: Exported identifiers <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Exported_identifiers</a></p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 48877352, "answer_count": 1, "score": -4, "last_activity_date": 1519103201, "creation_date": 1519096357, "last_edit_date": 1519103201, "question_id": 48877299, "link": "https://stackoverflow.com/questions/48877299/my-struct-is-not-encoding-correctly-and-is-missing-a-property", "title": "My struct is not encoding correctly and is missing a property", "body": "<pre><code>type ApiResponse struct {\n    Success bool     `json:\"success\"`\n    Errors  []string `json:\"errors\"`\n}\n\ntype NewSessionResponse struct {\n    ApiResponse     `json:\"apiResponse\"`\n    authToken   string `json:\"authToken\"`\n}\n</code></pre>\n\n<p>In my handler I am doing this:</p>\n\n<pre><code>resp := NewSessionResponse{ApiResponse{true, []string{}}, \"auth123\"}\n\njson.NewEncoder(w).Encode(resp)\n</code></pre>\n\n<p>The response I am seeing is this:</p>\n\n<pre><code>{\n    apiResponse: {\n        success: true,\n        errors: [ ]\n    }\n}\n</code></pre>\n\n<p>Why isn't my authToken property in the JSON result?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "answers": [{"tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": false, "score": 0, "last_activity_date": 1519095714, "creation_date": 1519095714, "answer_id": 48877216, "question_id": 48876891, "link": "https://stackoverflow.com/questions/48876891/panic-error-when-creating-presigned-url/48877216#48877216", "title": "Panic error when creating Presigned url", "body": "<p>You are passing a <code>nil</code> session while initialising s3 service <code>svc := s3.New(nil)</code>, that why you get the nil pointer error.</p>\n\n<p>You can pass the session using following code,</p>\n\n<p>new <code>import \"github.com/aws/aws-sdk-go/aws/session\"</code></p>\n\n<pre><code>awsSession = session.Must(session.NewSessionWithOptions(session.Options{\n    SharedConfigState: session.SharedConfigEnable,\n}))\n// Create S3 service client\nserviceS3 = s3.New(awsSession)\n</code></pre>\n\n<p>You might need to change the session configurations based on how you plan to use the credentials. You can read more about credential configurations here <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/</a></p>\n"}], "owner": {"reputation": 309, "user_id": 8452565, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7a63bbab43d9c73ae8b9f8a006ec1679?s=128&d=identicon&r=PG&f=1", "display_name": "FXux", "link": "https://stackoverflow.com/users/8452565/fxux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1519095714, "creation_date": 1519092759, "question_id": 48876891, "link": "https://stackoverflow.com/questions/48876891/panic-error-when-creating-presigned-url", "title": "Panic error when creating Presigned url", "body": "<p>I'm trying to create a presigned url using the aws-sdk-go, but it it's failing with the following output:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x138d40a]\n\ngoroutine 1 [running]:\ngithub.com/aws/aws-sdk-go/service/s3.New(0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /Users/me/go/src/github.com/aws/aws-sdk-go/service/s3/service.go:47 +0x3a\nmain.main()\n    /Users/me/go/src/Test/main.go:22 +0xa0\nexit status 2\n</code></pre>\n\n<p>I'm not seeing where I'm making a mistake, perhaps someone more experience in go could point out to me:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n\n    // \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n    \"github.com/kelseyhightower/envconfig\"\n)\n\n\nfunc main() {\n  var configuration s3.PutObjectInput\n  err := envconfig.Process(\"configuration\", &amp;configuration)\n\n  if err != nil {\n    log.Fatal(err.Error())\n  }\n\n  svc := s3.New(nil)\n  req, _ := svc.PutObjectRequest(&amp;configuration)\n  url, err := req.Presign(15 * time.Minute)\n  fmt.Println(\"The url is \", url)\n}\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 551, "user_id": 1527312, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/93809b4067e0edf75b22b8b1b4d315ab?s=128&d=identicon&r=PG", "display_name": "user1527312", "link": "https://stackoverflow.com/users/1527312/user1527312"}, "edited": false, "score": 0, "creation_date": 1519093324, "post_id": 48876760, "comment_id": 84757960, "body": "awesome, thank you. In my case I&#39;m using webpack which creates a new js file like <code>&#47;static&#47;js&#47;app.3df99dd891ed2460b6bc.js</code> after every build, so I don&#39;t think the etag piece is needed for me, but good to know"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 551, "user_id": 1527312, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/93809b4067e0edf75b22b8b1b4d315ab?s=128&d=identicon&r=PG", "display_name": "user1527312", "link": "https://stackoverflow.com/users/1527312/user1527312"}, "edited": false, "score": 0, "creation_date": 1519093635, "post_id": 48876760, "comment_id": 84758028, "body": "@user1527312 As long as the name of the js file changes you should be ok without it. Don&#39;t forget to accept the answer if you think it it the correct one."}, {"owner": {"reputation": 2219, "user_id": 8608146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3B2gl.jpg?s=128&g=1", "display_name": "Phani Rithvij", "link": "https://stackoverflow.com/users/8608146/phani-rithvij"}, "edited": false, "score": 1, "creation_date": 1606971892, "post_id": 48876760, "comment_id": 115126834, "body": "it should be if err <code>==</code> nil instead of <b>!=</b>"}], "tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": true, "score": 9, "last_activity_date": 1607035430, "last_edit_date": 1607035430, "creation_date": 1519091595, "answer_id": 48876760, "question_id": 48876324, "link": "https://stackoverflow.com/questions/48876324/gorilla-mux-golang-cache-static-files/48876760#48876760", "title": "gorilla/mux golang cache static files", "body": "<p>To tell the browser to cache your files, you need to tell it for how long, if not the user would never see newer versions of the file.</p>\n<p>To do this just set the <code>Cache-Control</code> header inside your handler function:</p>\n<pre><code>w.Header().Set(&quot;Cache-Control&quot;, &quot;max-age=3600&quot;)\n</code></pre>\n<p>It's also a good idea to use the Etag header to let the browsers know when there is a new version of the file. That way you can cache the files for a really long time, and still serve the new content to the users as soon as it's available:</p>\n<pre><code>etag := &quot;some unique value&quot;\nw.Header().Set(&quot;Etag&quot;, etag)\n</code></pre>\n<p>You need to use a different etag value every time the file changes. The browser stores it and only reloads the file when the etag is different to the stored value. You can use something like the file name + modified date for the etag:</p>\n<pre><code>var modTime time.Time\nfi, err := fh.Stat()\nif err == nil {\n    modTime = fi.ModTime()\n} else {\n    modTime = time.Now()\n}\netag := &quot;\\&quot;&quot; + file + modTime.String() + &quot;\\&quot;&quot;\nw.Header().Set(&quot;Etag&quot;, etag)\n</code></pre>\n<p>You can read the mozilla docs for the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Cache-Control\" rel=\"nofollow noreferrer\">Cache-Control</a> and <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag\" rel=\"nofollow noreferrer\">Etag</a> heders.</p>\n<p>If you want to avoid writing your own handler function for static files and instead keep using <code>http.FileServer</code>, you will need to wrap it in a handler that sets the headers before writing the response. <a href=\"https://medium.com/@matryer/the-http-handler-wrapper-technique-in-golang-updated-bc7fbcffa702\" rel=\"nofollow noreferrer\">Here</a> is a blog post on wrapping web handlers.</p>\n"}], "owner": {"reputation": 551, "user_id": 1527312, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/93809b4067e0edf75b22b8b1b4d315ab?s=128&d=identicon&r=PG", "display_name": "user1527312", "link": "https://stackoverflow.com/users/1527312/user1527312"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3026, "favorite_count": 0, "accepted_answer_id": 48876760, "answer_count": 1, "score": 5, "last_activity_date": 1607035430, "creation_date": 1519087569, "last_edit_date": 1519095376, "question_id": 48876324, "link": "https://stackoverflow.com/questions/48876324/gorilla-mux-golang-cache-static-files", "title": "gorilla/mux golang cache static files", "body": "<p>I have a go web app which serves static HTML/JS/CSS files plus has some API endpoints. I noticed that my HTML/JS/CSS are not being cached on the browser. E.g., every time I reload a page, they are fully re-downloaded.</p>\n\n<p>Is this a server side configuration change that I need to set? How can I accomplish this with Go and Gorilla Mux?</p>\n\n<p>I'm using Google App Engine, so Nginx is not a possibility.</p>\n\n<p>Here's my main.go code:</p>\n\n<pre><code>package main\n\nimport (\n    \"associations\"\n    \"html/template\"\n    \"net/http\"\n    \"log\"\n    \"io/ioutil\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/rs/cors\"\n    \"google.golang.org/appengine\"\n    \"google.golang.org/appengine/mail\"\n)\n\nvar index = template.Must(template.ParseFiles(\n    \"dist/index.html\",\n))\n\nfunc init() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", homeHandler)  \n    r.HandleFunc(\"/api/{tenant}/certificates\", associations.GetCertificate).Methods(\"GET\")\n    r.HandleFunc(\"/api/{tenant}/requests\", associations.PostRequest).Methods(\"POST\")\n\n    // handle static files\n    r.PathPrefix(\"/static/\").Handler(\n        http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"dist/static/\"))))\n\n    r.NotFoundHandler = http.HandlerFunc(homeHandler) // work around for SPA serving index.html\n\n    handler := cors.Default().Handler(r)\n    http.Handle(\"/\", handler)\n}\n</code></pre>\n\n<p>EDIT: Here's the solution with @Topo's suggestion:</p>\n\n<pre><code>   // handle static files\n        r.PathPrefix(\"/static/\").Handler(http.StripPrefix(\"/static/\", \nCacheControlWrapper(http.FileServer(http.Dir(\"dist/static/\")))))\n\n    ....\n\nfunc CacheControlWrapper(h http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Cache-Control\", \"max-age=2592000\") // 30 days\n        h.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "answers": [{"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": false, "score": 0, "last_activity_date": 1519091035, "creation_date": 1519091035, "answer_id": 48876709, "question_id": 48876290, "link": "https://stackoverflow.com/questions/48876290/how-to-create-presigned-put-url-and-use-environment-variable-to-set-bucket-and-k/48876709#48876709", "title": "How to create Presigned put url and use environment variable to set Bucket and Key", "body": "<p>If I understand your question correctly you need to retrieve the bucket and key name from env variables. This is pretty easy to do in go. The <code>os</code> package has a <code>GetEnv</code> function for that.</p>\n\n<p>Assuming your env variables are called <code>AWS_BUCKET</code> and <code>AWS_KEY</code> this is the way to get the values:</p>\n\n<pre><code>bucketName := Getenv(\"AWS_BUCKET\")\nkey := Getenv(\"AWS_KEY\")\n</code></pre>\n\n<p>You can check the package docs <a href=\"https://golang.org/pkg/os/#Getenv\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 309, "user_id": 8452565, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7a63bbab43d9c73ae8b9f8a006ec1679?s=128&d=identicon&r=PG&f=1", "display_name": "FXux", "link": "https://stackoverflow.com/users/8452565/fxux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1519091035, "creation_date": 1519087202, "question_id": 48876290, "link": "https://stackoverflow.com/questions/48876290/how-to-create-presigned-put-url-and-use-environment-variable-to-set-bucket-and-k", "title": "How to create Presigned put url and use environment variable to set Bucket and Key", "body": "<p>I'm using the following code to create a presigned put url:</p>\n\n<pre><code>svc := s3.New(nil)\nreq, _ := svc.PutObjectRequest(&amp;s3.PutObjectInput{\n    Bucket: aws.String(\"myBucket\"),\n    Key:    aws.String(\"myKey\"),\n})\nstr, err := req.Presign(15 * time.Minute)\n\nlog.Println(\"The URL is:\", str, \" err:\", err)\n</code></pre>\n\n<p>But I would like to get the configuration from a environment variable:</p>\n\n<pre><code>CONFIGURATIONS={ \"Bucket\": \"myBucket\", \"Key\": \"myKey\" }\n</code></pre>\n\n<p>I have just two weeks of Golang, and I have mainly a background in Node.js, so, I'm sorry if this question is very basic.</p>\n\n<p>To better illustrate, I'm trying to do this... but in Go:</p>\n\n<pre><code>const CONFIGURATIONS = JSON.parse(process.env.CONFIGURATIONS)\n\nconst S3 = new AWS.S3()\nS3.generatePresignedUrl('putObject', CONFIGURATIONS, callback...)\n</code></pre>\n\n<p>Thank you very much!</p>\n"}, {"tags": ["go", "optimization", "apache-kafka", "profiling", "sarama"], "comments": [{"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "edited": false, "score": 0, "creation_date": 1519106295, "post_id": 48875654, "comment_id": 84761433, "body": "Possible to share the diagram?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1519114299, "post_id": 48875654, "comment_id": 84764957, "body": "Read <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">blog.golang.org/profiling-go-programs</a>. Tip: <i>Always</i> consult golang.org first as you&#39;ll find the answer there."}, {"owner": {"reputation": 1342, "user_id": 1216838, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c29171dbea109a0147226a1962a4d3c8?s=128&d=identicon&r=PG", "display_name": "Pita", "link": "https://stackoverflow.com/users/1216838/pita"}, "edited": false, "score": 1, "creation_date": 1519263908, "post_id": 48875654, "comment_id": 84843087, "body": "thanks, I found that link after i posted the question, that post also doesnt go into detail about how block profiller works. I will add more context to the question"}], "owner": {"reputation": 1342, "user_id": 1216838, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c29171dbea109a0147226a1962a4d3c8?s=128&d=identicon&r=PG", "display_name": "Pita", "link": "https://stackoverflow.com/users/1216838/pita"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 944, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1519264734, "creation_date": 1519082550, "last_edit_date": 1519264734, "question_id": 48875654, "link": "https://stackoverflow.com/questions/48875654/understanding-golang-profiling-output", "title": "Understanding GoLang Profiling output", "body": "<p>Some context:</p>\n\n<p>I'm trying to debug a GoGRPC server, a specific API call seems to take a lot of time. This call does a number of reads to Kafka(lets say 10-20) so I expected it to take some time, just not quite as much.</p>\n\n<p>1 API call takes roughly 1-3 seconds to complete, but if i make 40 api calls in a script, it takes almost 30 seconds to complete all of them. but it doesnt complete them 'concurrently' as I expect, which is taking 5 seconds for the first one, and spit out 1 every second or so for later ones.</p>\n\n<p>It takes 29 seconds and responds to all 40 requests at once. Which causes the API caller to timeout when the requests take too long.</p>\n\n<p>I'm trying to profile the CPU to see where I'm spending the time. But I'm new to this and the outputs for the go profiler is not making a lot of sense.</p>\n\n<p>I've generated diagrams with <code>go tool pprof</code>, but having some trouble interpreting the output.</p>\n\n<p>CPU call graph</p>\n\n<ol>\n<li>theres a box describing the time, type, buildID etc. the <code>Duration</code> in this box, is that describing the total time the CPU ran for? not including wiat time</li>\n<li>there are 2 types of edges, solid lines, and dotted lines. what is the difference? and what does the time marked on the edges mean?   </li>\n<li>does the direction of the arrows mean calling direction? e.g. function A calls B, on the graph it will be A -> B?</li>\n<li>each vertex have a time at the bottom e.g. 0.01s(0.93%) out of 0.49s(45.79%), what does this time mean?</li>\n</ol>\n\n<p>block profile</p>\n\n<ol>\n<li>same as #4 above, there is time on edges, and vertex. what does this mean?</li>\n</ol>\n\n<p>EDIT:</p>\n\n<p>I what my server does is retrieve some data from kafka streams. I've identified what was being slow, and I've wrote a script that only has the kafka calling functions. here's the script and block profiling diagram.</p>\n\n<p>every consume to kafka takes about 50-100ms, but because most of the time is spent in doing IO, i expect the throughput of the API to be actually quite high, which is not the case. if i make 100 calls, it takes about 3 seconds, if i make 400 it takes about 10s. trying to see how i can speed out the throughput of the API</p>\n\n<pre><code>func main() {\n\n    f, _ := os.Create(\"cpu.prof\")\n    pprof.StartCPUProfile(f)\n    defer pprof.StopCPUProfile()\n\n    block, _ := os.Create(\"block.prof\")\n    runtime.SetBlockProfileRate(1)\n    p := pprof.Lookup(\"block\")\n    defer p.WriteTo(block, 0)\n\n    var wg sync.WaitGroup\n    wg.Add(messageCount)\n    for i := 0; i &lt; messageCount; i++ {\n        go func() {\n            // consume()\n            withConsumer()\n            wg.Done()\n        }()\n\n    }\n\n    wg.Wait()\n}\n\nvar servers = []string{\"kafka-1\", \"kafka-2\", \"kafka-3\"}\n\nvar count = 0\nvar partition = int32(0)\n\nfunc consume() {\n\n    index := count\n    t := time.Now()\n    count++\n    fmt.Println(\"starting consume\", index)\n    defer func() {\n        fmt.Println(\"consume \", index, \"took\", time.Since(t).String())\n    }()\n\n    consumer, err := sarama.NewConsumer(servers, nil)\n    if err != nil {\n        panic(err)\n    }\n    var max, min int64\n    max = 1431401\n    min = 2\n\n    defer func() {\n        consumer.Close()\n    }()\n\n    pc, err := consumer.ConsumePartition(\"source-topic\", partition, rand.Int63n(max-min)+min)\n    if err != nil {\n        panic(err)\n    }\n\n    defer func() {\n        pc.Close()\n    }()\n\n    signals := make(chan os.Signal, 1)\n    signal.Notify(signals, os.Interrupt)\n\n    select {\n    case msg := &lt;-pc.Messages():\n        fmt.Println(\"msg: \", len(msg.Value))\n    case &lt;-signals:\n        return\n    }\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/zPhFh.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zPhFh.png\" alt=\"enter image description here\"></a>\nThanks,</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1519083086, "post_id": 48874891, "comment_id": 84755398, "body": "For Viper I thought you called <code>viper.ReadInConfig()</code>, not unmarshal - but I could be wrong"}, {"owner": {"reputation": 3670, "user_id": 868044, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/tQcbU.jpg?s=128&g=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/868044/dan"}, "edited": false, "score": 0, "creation_date": 1519083172, "post_id": 48874891, "comment_id": 84755432, "body": "Check out <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">go-yaml</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519118464, "post_id": 48874891, "comment_id": 84767421, "body": "I don&#39;t think you mean &quot;keys to structs&quot; -- Keys are usually concrete types, like a string or integer."}], "answers": [{"tags": [], "owner": {"reputation": 750, "user_id": 2947756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qpCxL.png?s=128&g=1", "display_name": "xReprisal", "link": "https://stackoverflow.com/users/2947756/xreprisal"}, "is_accepted": false, "score": 0, "last_activity_date": 1519121719, "creation_date": 1519121719, "answer_id": 48882803, "question_id": 48874891, "link": "https://stackoverflow.com/questions/48874891/how-to-map-yaml-keys-to-structs-in-golang/48882803#48882803", "title": "How to map yaml keys to structs in golang?", "body": "<p>You should iterate over your uppermost yml keys [\"Dog\", \"Cat\"] and then put it into the struct. If you put this in your config it outputs the name of the animal:</p>\n\n<pre><code>name: \"Dog\"\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 3330601, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/83d6836ee4a553228230113387e2b810?s=128&d=identicon&r=PG&f=1", "display_name": "popopanda", "link": "https://stackoverflow.com/users/3330601/popopanda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 792, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1519121719, "creation_date": 1519077858, "question_id": 48874891, "link": "https://stackoverflow.com/questions/48874891/how-to-map-yaml-keys-to-structs-in-golang", "title": "How to map yaml keys to structs in golang?", "body": "<p>I'm looking to write a go script that can parse through a yaml file.  I created a test yaml file with the following:</p>\n\n<pre><code>    Dog:\n      - name: \"Dog\"\n      - secrets:\n          username: \"Shiba\"\n          password: \"inu\"\n          color: \"yellow\"\n    Cat:\n      - name: \"Cat\"\n      - secrets:\n          words: \"meow\"\n          color: \"black\"\n</code></pre>\n\n<p>What would the mapping to a struct look like in go?</p>\n\n<p>I've tried along the lines of:</p>\n\n<pre><code>            package main\n\n            import (\n                \"fmt\"\n                \"log\"\n\n                \"github.com/spf13/viper\"\n            )\n\n            type Animal struct {\n                Animal  []string\n                Name    string\n                Secrets []map[string]string\n            }\n\n            func main() {\n                viper.SetConfigName(\"demo\")\n                viper.AddConfigPath(\".\")\n                viper.SetConfigType(\"yaml\")\n\n                err := viper.ReadInConfig()\n\n                if err != nil {\n                    log.Fatal(err)\n                }\n\n                var animal Animal\n                err = viper.Unmarshal(&amp;animal)\n                if err != nil {\n                    log.Fatal(err)\n                }\n\n                fmt.Println(animal.Name)\n            }\n</code></pre>\n\n<p>But nothing is returned</p>\n\n<p>Any help would be much appreciated</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "passwords"], "comments": [{"owner": {"reputation": 1105, "user_id": 888404, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b812cfdff8a450c15f94079fae46362c?s=128&d=identicon&r=PG", "display_name": "misterManager", "link": "https://stackoverflow.com/users/888404/mistermanager"}, "edited": false, "score": 2, "creation_date": 1519077474, "post_id": 48873733, "comment_id": 84753491, "body": "you probably don&#39;t want to include your API key in a post on stack overflow.... I would invalidate my key and generate a new one"}, {"owner": {"reputation": 1105, "user_id": 888404, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b812cfdff8a450c15f94079fae46362c?s=128&d=identicon&r=PG", "display_name": "misterManager", "link": "https://stackoverflow.com/users/888404/mistermanager"}, "edited": false, "score": 1, "creation_date": 1519077588, "post_id": 48873733, "comment_id": 84753539, "body": "and if you can boil down the issue to something very simple.... here is the data I can&#39;t unmarshal, here is where the code crashes etc.... just try and isolate the part of your code that is broken, don&#39;t include the API key, and THEN post a play.golang link AND include the details we will find at that link"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1519078346, "post_id": 48873733, "comment_id": 84753851, "body": "Export the struct fields."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519078467, "post_id": 48873733, "comment_id": 84753890, "body": "Not only are your fields not exported, but <code>GetWordsResponse</code> does not match the structure of the json in the response."}], "answers": [{"tags": [], "owner": {"reputation": 171, "user_id": 1503465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560dfce511baa205d006d43a57bea1f0?s=128&d=identicon&r=PG", "display_name": "Michael Ernst", "link": "https://stackoverflow.com/users/1503465/michael-ernst"}, "is_accepted": false, "score": 0, "last_activity_date": 1519087763, "last_edit_date": 1519087763, "creation_date": 1519087334, "answer_id": 48876301, "question_id": 48873733, "link": "https://stackoverflow.com/questions/48873733/golang-json-array/48876301#48876301", "title": "Golang JSON Array", "body": "<p>As pointed out in the comments you need to export the fields so they can be unmarshaled</p>\n\n<p>The encoding/json package relies on reflection and since it is in another package, it cannot access unexported fields.  ( in go, fields, methods or functions that start with a small letter are unexported whereas with capital letters they are exported ) </p>\n\n<p>Then your example json does not contain the WordList at all, so what you want is unmarshaling directly into the array of Words. Also a words object only consists of Id and Word and not of arrays themselves.</p>\n\n<pre><code>type Words struct {\n    Id   int64\n    Word string\n}\n\nfunc main() {\n    .... \n    var words []Words\n    // you don't need to read the whole body first, you can decode in the same turn like this\n    err := json.NewDecoder(req.Body).Decode(&amp;words)\n    if nil != err {\n       log.Fatal(err)\n    }\n   ...\n}\n</code></pre>\n\n<p>Another very important thing is that you should not ignore errors. This would have helped you to debug the issue. ( What I mean is _ = json.Unmarshal)</p>\n\n<p>As for beginning with go, you could implement a simple test to see if your code works as intended. </p>\n\n<p><a href=\"https://play.golang.org/p/nuz9uXdka5S\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nuz9uXdka5S</a> &lt; check this working example for reference. </p>\n"}], "owner": {"reputation": 30, "user_id": 4338580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c22eeff3c010929cfe42a8c292e09fbb?s=128&d=identicon&r=PG&f=1", "display_name": "Jude Austin", "link": "https://stackoverflow.com/users/4338580/jude-austin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 660, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1522578001, "creation_date": 1519072331, "last_edit_date": 1522578001, "question_id": 48873733, "link": "https://stackoverflow.com/questions/48873733/golang-json-array", "title": "Golang JSON Array", "body": "<p>I am trying to use WordNik () to get random words for the dictionary for this script: <a href=\"https://github.com/jmagrippis/password\" rel=\"nofollow noreferrer\">https://github.com/jmagrippis/password</a></p>\n\n<p>WordNik is outputting:</p>\n\n<pre><code>[{\"id\":7936915,\"word\":\"Tanganyikan\"},{\"id\":27180,\"word\":\"cartographic\"},{\"id\":48094,\"word\":\"deterministic\"},{\"id\":1485119,\"word\":\"higher-risk\"},{\"id\":120986,\"word\":\"juristic\"},{\"id\":1830806,\"word\":\"magnetorheological\"},{\"id\":320495,\"word\":\"quelled\"},{\"id\":324610,\"word\":\"remoter\"},{\"id\":215158,\"word\":\"telemetric\"},{\"id\":225207,\"word\":\"uninquisitive\"}]\n</code></pre>\n\n<p>Here is my code: </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/jmagrippis/password\"\n)\n\ntype Words struct {\n    id   []int64\n    word []string\n}\n\ntype GetWordsResponse struct {\n    WordList []Words\n}\n\nfunc getWords(speech string) (*GetWordsResponse, error) {\n\n    url := fmt.Sprintf(\"http://api.wordnik.com/v4/words.json/randomWords?hasDictionaryDef=false&amp;includePartOfSpeech=%s&amp;minCorpusCount=0&amp;maxCorpusCount=-1&amp;minDictionaryCount=1&amp;maxDictionaryCount=-1&amp;minLength=5&amp;maxLength=-1&amp;limit=10&amp;api_key=api_key\", speech)\n\n    res, err := http.Get(url)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    body, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    var s = new(GetWordsResponse)\n    var arr []string\n    _ = json.Unmarshal([]byte(body), &amp;arr)\n    log.Printf(\"Unmarshaled: %v\", arr)\n    return s, err\n}\n\nfunc main() {\n\n    dictionary := &amp;password.Dictionary{\n        Adjectives: []string{\"beautiful\", \"homely\", \"magical\", \"posh\", \"excellent\"},\n        Subjects:   []string{\"mermaids\", \"unicorns\", \"lions\", \"piranhas\"},\n        Verbs:      []string{\"love\", \"fancy\", \"eat\", \"bring\", \"fear\", \"aggravate\"},\n        Adverbs:    []string{\"cuddling\", \"slapping\", \"shouting\", \"jumping\"},\n        Objects:    []string{\"teddy-bears\", \"diamonds\", \"buckets\", \"boxes\"},\n    }\n\n    generator := password.NewGenerator(dictionary, time.Now().UnixNano())\n    pass := generator.Generate()\n\n    fmt.Printf(\"%s\", pass)\n\n    getWords(\"Verb\")\n}\n</code></pre>\n\n<p>As you can see, what I am trying to do is use WordNik API to request Adverbs, nouns, etc and then make a dictionary based off those words to generate a password. I am horrible with arrays and handling data.</p>\n"}, {"tags": ["postgresql", "go", "gorp"], "comments": [{"owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 0, "creation_date": 1519073604, "post_id": 48872843, "comment_id": 84751839, "body": "you want to end transaction, not close a declared cursor"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1519075363, "post_id": 48872843, "comment_id": 84752595, "body": "remember to check rows.Error <a href=\"http://go-database-sql.org/errors.html\" rel=\"nofollow noreferrer\">see Handling Errors</a>"}], "answers": [{"comments": [{"owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "edited": false, "score": 0, "creation_date": 1519124148, "post_id": 48874022, "comment_id": 84771499, "body": "Thanks for the clarification. If I <code>commit</code> the transaction, should I still close the declared cursor and <code>rows.Close()</code>?"}, {"owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "reply_to_user": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "edited": false, "score": 2, "creation_date": 1519124472, "post_id": 48874022, "comment_id": 84771735, "body": "<a href=\"https://www.postgresql.org/docs/current/static/sql-declare.html\" rel=\"nofollow noreferrer\">postgresql.org/docs/current/static/sql-declare.html</a> <code>WITHOUT HOLD</code> is default, so If you did not explicitly define otherwise - cursor will be lost on commit, yes"}], "tags": [], "owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "is_accepted": true, "score": 2, "last_activity_date": 1519074287, "last_edit_date": 1519074287, "creation_date": 1519073683, "answer_id": 48874022, "question_id": 48872843, "link": "https://stackoverflow.com/questions/48872843/transaction-stays-in-pg-stat-activity-state-after-execution/48874022#48874022", "title": "Transaction stays in pg_stat_activity state after execution", "body": "<p>you want to end transaction, not close a declared cursor. <code>commit</code> does it.\n<a href=\"https://www.postgresql.org/docs/current/static/tutorial-transactions.html\" rel=\"nofollow noreferrer\">you can run multiple queries in one transaction</a> - this is why you see the result without committing.</p>\n\n<p>the <code>pg_stat_activity.state</code> values are: <code>active</code> when you run the statement (eg, <code>begin transaction;</code> or <code>fetch cursos</code>), <code>idle in transaction</code> when you don't currently run statements, but the transaction remains begun and lastly <code>idle</code>, after you run <code>end</code> or <code>commit</code>, so the transaction is over. After you disconnect the session ends and there's no row in <code>pg_stat_activity</code> at all...</p>\n"}], "owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 445, "favorite_count": 0, "accepted_answer_id": 48874022, "answer_count": 1, "score": 0, "last_activity_date": 1519074287, "creation_date": 1519068074, "question_id": 48872843, "link": "https://stackoverflow.com/questions/48872843/transaction-stays-in-pg-stat-activity-state-after-execution", "title": "Transaction stays in pg_stat_activity state after execution", "body": "<p>I'm quite new to both PostgreSQL and golang. Mainly, I am trying to understand the following:</p>\n\n<ul>\n<li>Why did I need the Commit statement to close the connection and the other two <code>Close</code> calls didn't do the trick?</li>\n<li>Would also appreciate pointers regarding the right/wrong way in which I'm going about working with cursors.</li>\n</ul>\n\n<hr>\n\n<p>In the following function, I'm using <code>gorp</code> to make a CURSOR, query my Postgres DB row by row and write each row to a writer function:</p>\n\n<pre><code>func(txn *gorp.Transaction, \n     q string,\n     params []interface{}, \n     myWriter func([]byte, error)) {\n\n    cursor := \"DECLARE GRABDATA NO SCROLL CURSOR FOR \" + q\n    _, err := txn.Exec(cursor, params...)\n    if err != nil {\n        myWriter(nil, err)\n        return\n    }\n\n    rows, err := txn.Query(\"FETCH ALL in GRABDATA\")\n    if err != nil {\n        myWriter(nil, err)\n        return\n    }\n\n    defer func() {\n        if _, err := txn.Exec(\"CLOSE GRABDATA\"); err != nil {\n            fmt.Println(\"Error while closing cursor:\", err)\n        }\n        if err = rows.Close(); err != nil {\n            fmt.Println(\"Error while closing rows:\", err)\n        } else {\n            fmt.Println(\"\\n\\n\\n Closed rows without error\", \"\\n\\n\\n\")\n        }\n        if err = txn.Commit(); err != nil {\n            fmt.Println(\"Error on commit:\", err)\n        }\n    }()\n\n    pointers := make([]interface{}, len(cols))\n    container := make([]sql.NullString, len(cols))\n    values := make([]string, len(cols))\n    for i := range pointers {\n        pointers[i] = &amp;container[i]\n    }\n\n    for rows.Next() {\n        if err = rows.Scan(pointers...); err != nil {\n            myWriter(nil, err)\n            return\n        }\n\n        stringLine := strings.Join(values, \",\") + \"\\n\"\n        myWriter([]byte(stringLine), nil)\n    }\n}\n</code></pre>\n\n<p>In the <code>defer</code> section, I would initially, only <code>Close</code> the <code>rows</code>, but then I saw that <code>pg_stat_activity</code> stay open in <code>idle in transaction</code> state, with the <code>FETCH ALL in GRABDATA</code> query.</p>\n\n<p>Calling <code>txn.Exec(\"CLOSE &lt;cursor_name&gt;\")</code> didn't help. After that, I had a <code>CLOSE GRABDATA</code> query in <code>idle in transaction</code> state...</p>\n\n<p>Only when I started calling <code>Commit()</code> did the connection actually close. I thought that maybe I need to call Commit to execute anything on the transation, but if that's the case - how come I got the result of my queries without calling it?</p>\n"}, {"tags": ["go", "mqtt", "mosquitto", "paho"], "comments": [{"owner": {"reputation": 40434, "user_id": 504554, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/006ffde9ed3fac6396222405fc5e9bf0?s=128&d=identicon&r=PG", "display_name": "hardillb", "link": "https://stackoverflow.com/users/504554/hardillb"}, "edited": false, "score": 0, "creation_date": 1519071968, "post_id": 48872360, "comment_id": 84751160, "body": "Asking for tutorials it&#39;s off topic for Stack Overflow, show us what you&#39;ve already tried and somebody will help you fix it"}, {"owner": {"reputation": 385, "user_id": 1030072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e79eb38b422a63d60c8bf8f309b558?s=128&d=identicon&r=PG", "display_name": "Phillip Neal", "link": "https://stackoverflow.com/users/1030072/phillip-neal"}, "reply_to_user": {"reputation": 40434, "user_id": 504554, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/006ffde9ed3fac6396222405fc5e9bf0?s=128&d=identicon&r=PG", "display_name": "hardillb", "link": "https://stackoverflow.com/users/504554/hardillb"}, "edited": false, "score": 0, "creation_date": 1519162092, "post_id": 48872360, "comment_id": 84794830, "body": "Ok. Thanks for the feedback. I found a solution... I think. I added the solution code to the question. It runs in a test environment. Now I have to try it in a real environment."}], "answers": [{"comments": [{"owner": {"reputation": 385, "user_id": 1030072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e79eb38b422a63d60c8bf8f309b558?s=128&d=identicon&r=PG", "display_name": "Phillip Neal", "link": "https://stackoverflow.com/users/1030072/phillip-neal"}, "edited": false, "score": 0, "creation_date": 1519216936, "post_id": 48906204, "comment_id": 84818049, "body": "I edited my question and moved my answer into the answer section."}, {"owner": {"reputation": 1154, "user_id": 303623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a7be2787417fe82e9677e541fb096cb?s=128&d=identicon&r=PG", "display_name": "Rick O&#39;Shea", "link": "https://stackoverflow.com/users/303623/rick-oshea"}, "edited": false, "score": 0, "creation_date": 1592406947, "post_id": 48906204, "comment_id": 110415658, "body": "&gt; MQTT &quot;github.com/eclipse/paho.mqtt.golang&quot;  What is the rationale for the override? If there is one, why not this: &gt; FMT &quot;fmt&quot;"}], "tags": [], "owner": {"reputation": 385, "user_id": 1030072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e79eb38b422a63d60c8bf8f309b558?s=128&d=identicon&r=PG", "display_name": "Phillip Neal", "link": "https://stackoverflow.com/users/1030072/phillip-neal"}, "is_accepted": true, "score": 17, "last_activity_date": 1519216834, "creation_date": 1519216834, "answer_id": 48906204, "question_id": 48872360, "link": "https://stackoverflow.com/questions/48872360/golang-mqtt-publish-and-subscribe/48906204#48906204", "title": "golang mqtt publish and subscribe", "body": "<p>I looked through the GoDocs for some hint as to how to keep the connections open but nothing seems pertinent. I can certainly do an infinite loop over the 'subscribe' but that seems inefficient.</p>\n\n<p>Ok. Found a solution at . <a href=\"https://github.com/eclipse/paho.mqtt.golang/blob/master/cmd/stdoutsub/main.go\" rel=\"noreferrer\">https://github.com/eclipse/paho.mqtt.golang/blob/master/cmd/stdoutsub/main.go</a>.\nEssentially, I had to open up a channel for the subscribe.\nHere is the new code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    MQTT \"github.com/eclipse/paho.mqtt.golang\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n)\n\nvar knt int\nvar f MQTT.MessageHandler = func(client MQTT.Client, msg MQTT.Message) {\n    fmt.Printf(\"MSG: %s\\n\", msg.Payload())\n    text := fmt.Sprintf(\"this is result msg #%d!\", knt)\n    knt++\n    token := client.Publish(\"nn/result\", 0, false, text)\n    token.Wait()\n}\n\nfunc main() {\n    knt = 0\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt, syscall.SIGTERM)\n\n    opts := MQTT.NewClientOptions().AddBroker(\"tcp://localhost:1883\")\n    opts.SetClientID(\"mac-go\")\n    opts.SetDefaultPublishHandler(f)\n    topic := \"nn/sensors\"\n\n    opts.OnConnect = func(c MQTT.Client) {\n            if token := c.Subscribe(topic, 0, f); token.Wait() &amp;&amp; token.Error() != nil {\n                    panic(token.Error())\n            }\n    }\n    client := MQTT.NewClient(opts)\n    if token := client.Connect(); token.Wait() &amp;&amp; token.Error() != nil {\n            panic(token.Error())\n    } else {\n            fmt.Printf(\"Connected to server\\n\")\n    }\n    &lt;-c\n}\n</code></pre>\n"}], "owner": {"reputation": 385, "user_id": 1030072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66e79eb38b422a63d60c8bf8f309b558?s=128&d=identicon&r=PG", "display_name": "Phillip Neal", "link": "https://stackoverflow.com/users/1030072/phillip-neal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15975, "favorite_count": 4, "accepted_answer_id": 48906204, "answer_count": 1, "score": 11, "last_activity_date": 1519216834, "creation_date": 1519065820, "last_edit_date": 1519216666, "question_id": 48872360, "link": "https://stackoverflow.com/questions/48872360/golang-mqtt-publish-and-subscribe", "title": "golang mqtt publish and subscribe", "body": "<p>Does anybody know where I can get some example MQTT client Go (golang) code that does both publish and subscribe in an infinite loop ?</p>\n\n<p>I am messaging with a Mosquitto broker running on MacOs.</p>\n\n<p>In more detail... </p>\n\n<ol>\n<li>Get a message from the network (a topic)</li>\n<li>Compute something based on that message</li>\n<li>Send the result of the computation back to the network (topic)</li>\n</ol>\n\n<p>Here is the code I am using:</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n MQTT \"github.com/eclipse/paho.mqtt.golang\"\n\"os\"\n\"time\"\n)\n\nvar knt int\n\nvar f MQTT.MessageHandler = func(client MQTT.Client, msg MQTT.Message) \n{ \n   fmt.Printf(\"MSG: %s\\n\", msg.Payload())\n   text:= fmt.Sprintf(\"this is result msg #%d!\", knt)\n   knt++\n   token := client.Publish(\"nn/result\", 0, false, text)\n   token.Wait()\n}\n\nfunc main() {\n   knt = 0\n\n   opts := MQTT.NewClientOptions().AddBroker(\"tcp://localhost:1883\")\n   opts.SetClientID(\"mac-go\")\n   opts.SetDefaultPublishHandler(f)\n\n   c := MQTT.NewClient(opts)\n   if token := c.Connect(); token.Wait() &amp;&amp; token.Error() != nil {\n        panic(token.Error())\n   }\n\n  if token := c.Subscribe(\"nn/sensors\", 0, nil); token.Wait() &amp;&amp; \n     token.Error() != nil {\n     fmt.Println(token.Error())\n     os.Exit(1)\n  }\n\n  time.Sleep(3 * time.Second)\n} //end of main\n</code></pre>\n\n<p>I looked through the GoDocs for some hint as to how to keep the connections open but nothing seems pertinent. I can certainly do an infinite loop \nover the 'subscribe' but that seems inefficient. </p>\n"}, {"tags": ["sockets", "go", "reverse-engineering"], "comments": [{"owner": {"reputation": 5508, "user_id": 794749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pfE2l.jpg?s=128&g=1", "display_name": "gre_gor", "link": "https://stackoverflow.com/users/794749/gre-gor"}, "edited": false, "score": 0, "creation_date": 1519067248, "post_id": 48872144, "comment_id": 84749123, "body": "What has this to do with WebSockets?"}, {"owner": {"reputation": 111, "user_id": 3847552, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/pM2nm.png?s=128&g=1", "display_name": "Tayyebi", "link": "https://stackoverflow.com/users/3847552/tayyebi"}, "reply_to_user": {"reputation": 5508, "user_id": 794749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pfE2l.jpg?s=128&g=1", "display_name": "gre_gor", "link": "https://stackoverflow.com/users/794749/gre-gor"}, "edited": false, "score": 0, "creation_date": 1519068811, "post_id": 48872144, "comment_id": 84749793, "body": "@gre_gor That was a fault with tags; edited. But anyway. I want this to be done: 1- Device (not important what really it is, but its a GPRS) sends a login packet to our server which is listening on port (e.g 1234). 2- My syntax in Golang is waiting for their request and it will handle it using function above. <b>3- (<i>This step should be done</i>) I will write my custom response.</b> 4- Conn will be closed with my response in step 3."}], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 3847552, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/pM2nm.png?s=128&g=1", "display_name": "Tayyebi", "link": "https://stackoverflow.com/users/3847552/tayyebi"}, "edited": false, "score": 0, "creation_date": 1519113282, "post_id": 48880075, "comment_id": 84764496, "body": "Hi there, it does not work. <code>conn</code> will not wait for user input. In my opinion, user input and <code>conn</code> are running on different threads, same as C# | Java &#39;s <code>async | AsyncTask</code> maybe. So because they seems to be parallel, and <code>conn</code> should be a fast response, they will not work at all."}, {"owner": {"reputation": 111, "user_id": 3847552, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/pM2nm.png?s=128&g=1", "display_name": "Tayyebi", "link": "https://stackoverflow.com/users/3847552/tayyebi"}, "edited": false, "score": 0, "creation_date": 1519113341, "post_id": 48880075, "comment_id": 84764523, "body": "Hi there, it does not work. <code>conn</code> will not wait for user input. In my opinion, user input and <code>conn</code> are running on different threads, same as C# | Java &#39;s <code>async | AsyncTask</code> maybe. So because they seems to be parallel, and <code>conn</code> should be a fast response, they will not work at all."}, {"owner": {"reputation": 111, "user_id": 3847552, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/pM2nm.png?s=128&g=1", "display_name": "Tayyebi", "link": "https://stackoverflow.com/users/3847552/tayyebi"}, "edited": false, "score": 0, "creation_date": 1519113843, "post_id": 48880075, "comment_id": 84764744, "body": "Do you have any idea if we can solve it using <code>defer</code>? Maybe: <code>defer func() { &#47;* Logic here *&#47; } ()</code>"}, {"owner": {"reputation": 111, "user_id": 3847552, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/pM2nm.png?s=128&g=1", "display_name": "Tayyebi", "link": "https://stackoverflow.com/users/3847552/tayyebi"}, "edited": false, "score": 0, "creation_date": 1519114275, "post_id": 48880075, "comment_id": 84764945, "body": "I&#39;m using <code>Packet Sender</code> to test this Socket."}, {"owner": {"reputation": 111, "user_id": 3847552, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/pM2nm.png?s=128&g=1", "display_name": "Tayyebi", "link": "https://stackoverflow.com/users/3847552/tayyebi"}, "edited": false, "score": 0, "creation_date": 1519116085, "post_id": 48880075, "comment_id": 84765948, "body": "Answer fully works after edit. I will accept it as the final solution when we are sure that there isn&#39;t any alternative available. Thank you very much."}], "tags": [], "owner": {"reputation": 48, "user_id": 6225833, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ruylrUqeeYY/AAAAAAAAAAI/AAAAAAAAAFs/Yd0n__8LLuk/photo.jpg?sz=128", "display_name": "Saleh", "link": "https://stackoverflow.com/users/6225833/saleh"}, "is_accepted": true, "score": 2, "last_activity_date": 1519115432, "last_edit_date": 1519115432, "creation_date": 1519112613, "answer_id": 48880075, "question_id": 48872144, "link": "https://stackoverflow.com/questions/48872144/socket-debugger-in-golang/48880075#48880075", "title": "Socket debugger in Golang", "body": "<p>you can use this function</p>\n\n<pre><code>func handleReq(conn net.Conn) {\n    buf := make([]byte, 1024)\n    reqLen, err := conn.Read(buf)\n    if err != nil {\n        fmt.Println(\"Error reading:\", err.Error(), reqLen)\n    }\n    fmt.Println(\"\\r\\nRECVD: \" + string(buf))\n\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Printf(\"RESP: \")\n    text, _ := reader.ReadString('\\n')\n    fmt.Println(\"SENT: \", text)\n    conn.Write([]byte(\"RESP: \" + text))\n    conn.Close()\n}\n</code></pre>\n\n<p>and you must wait for response on other side(persistent TCP).</p>\n"}], "owner": {"reputation": 111, "user_id": 3847552, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/pM2nm.png?s=128&g=1", "display_name": "Tayyebi", "link": "https://stackoverflow.com/users/3847552/tayyebi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 882, "favorite_count": 0, "accepted_answer_id": 48880075, "answer_count": 1, "score": 1, "last_activity_date": 1519219355, "creation_date": 1519064887, "last_edit_date": 1519219355, "question_id": 48872144, "link": "https://stackoverflow.com/questions/48872144/socket-debugger-in-golang", "title": "Socket debugger in Golang", "body": "<p>Refer to the source code available in <a href=\"https://coderwall.com/p/wohavg/creating-a-simple-tcp-server-in-go\" rel=\"nofollow noreferrer\">this link</a>, I have to create a socket server which is communicating some GPRS devices. There is different models of that devices and not enough documentation for their handshake protocol.</p>\n\n<p>Challenge: I need to be able to send custom responses to their requests and check their reaction.</p>\n\n<p>My scenario: I edited this function -></p>\n\n<pre><code>// Make a buffer to hold incoming data.\nbuf := make([]byte, 1024)\n// Read the incoming connection into the buffer.\nreqLen, err := conn.Read(buf)\nif err != nil {\n    fmt.Println(\"Error reading:\", err.Error(), reqLen)\n}\n// Print to output\nfmt.Println(\"\\r\\nRECVD: \" + string(buf));\n\ntext := \"done!\";\n// Send a response back to person contacting us.\nconn.Write([]byte(\"RESP: \" + text))\n// Close the connection when you're done with it.\nconn.Close()\n</code></pre>\n\n<p>To this -></p>\n\n<pre><code>// Make a buffer to hold incoming data.\nbuf := make([]byte, 1024)\n// Read the incoming connection into the buffer.\nreqLen, err := conn.Read(buf)\nif err != nil {\n    fmt.Println(\"Error reading:\", err.Error(), reqLen)\n}\n// Print to output\nfmt.Println(\"\\r\\nRECVD: \" + string(buf));\n\n// Get response from user\nfmt.Printf(\"RESP: \");\n\nscanner := bufio.NewScanner(os.Stdin)\nif scanner.Scan() {\n    text := scanner.Text()\n    fmt.Println(\"SENT: \", text)\n    // Send a response back to person contacting us.\n    conn.Write([]byte(\"RESP: \" + text))\n    // Close the connection when you're done with it.\n    conn.Close()\n}\n</code></pre>\n\n<p>I though that it should wait for my input to reply to the device. But my theory was really far from the reality.</p>\n"}, {"tags": ["go", "dependencies", "lib", "godeps"], "comments": [{"owner": {"reputation": 378, "user_id": 3585078, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/602470386/picture?type=large", "display_name": "Pubudu", "link": "https://stackoverflow.com/users/3585078/pubudu"}, "reply_to_user": {"reputation": 6633, "user_id": 392025, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ac8fa292707d21768f9ebe17de4b523?s=128&d=identicon&r=PG", "display_name": "Aurel B&#237;l&#253;", "link": "https://stackoverflow.com/users/392025/aurel-b%c3%adl%c3%bd"}, "edited": false, "score": 0, "creation_date": 1519062889, "post_id": 48871460, "comment_id": 84746999, "body": "Getting the same error."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6633, "user_id": 392025, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ac8fa292707d21768f9ebe17de4b523?s=128&d=identicon&r=PG", "display_name": "Aurel B&#237;l&#253;", "link": "https://stackoverflow.com/users/392025/aurel-b%c3%adl%c3%bd"}, "edited": false, "score": 1, "creation_date": 1519064856, "post_id": 48871460, "comment_id": 84748028, "body": "@AurelB&#237;l&#253;: Th go tool uses <code>...</code> as a path wildcard"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519073817, "post_id": 48871460, "comment_id": 84751935, "body": "@Pubudu: Is you source properly located in GOPATH? Can you build your package by its import path?"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 7672532, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-V9Q9GleeV9g/AAAAAAAAAAI/AAAAAAAAAnY/mMewGfzR0xU/photo.jpg?sz=128", "display_name": "EJIRO EDWIN", "link": "https://stackoverflow.com/users/7672532/ejiro-edwin"}, "is_accepted": false, "score": 0, "last_activity_date": 1582283791, "last_edit_date": 1582283791, "creation_date": 1582283726, "answer_id": 60337523, "question_id": 48871460, "link": "https://stackoverflow.com/questions/48871460/godep-save-gives-an-error-godep-unable-to-find-srcroot-for-package/60337523#60337523", "title": "godep save ./... gives an error - godep: Unable to find SrcRoot for package", "body": "<p>Filesystem location matters a lot in Go. You\u2019re expected to be running things from a designated \u2018gopath\u2019, but don\u2019t confuse gopath with the location of go (don\u2019t just set it to where go is installed).</p>\n\n<p>Your gopath should be a location that you\u2019re happy to put your go source code for the foreseeable future. I\u2019ve set mine to /Users/ejiro/go.</p>\n\n<pre><code>cat &lt;&lt;END &gt;&gt; ~/.bashrc\n\nexport GOPATH=/Users/ejiro/go\n\nEND\n</code></pre>\n"}], "owner": {"reputation": 378, "user_id": 3585078, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/602470386/picture?type=large", "display_name": "Pubudu", "link": "https://stackoverflow.com/users/3585078/pubudu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 979, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1582283791, "creation_date": 1519062035, "last_edit_date": 1519118552, "question_id": 48871460, "link": "https://stackoverflow.com/questions/48871460/godep-save-gives-an-error-godep-unable-to-find-srcroot-for-package", "title": "godep save ./... gives an error - godep: Unable to find SrcRoot for package", "body": "<p>When I run <code>godep save ./...</code> from the root directory of the project I'm getting the following error. Any clues what might I have to fix?</p>\n\n<blockquote>\n  <p>godep: Unable to find SrcRoot for package .</p>\n</blockquote>\n"}, {"tags": ["rest", "http", "post", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1519056503, "post_id": 48868980, "comment_id": 84743626, "body": "What is the actual question? It&#39;s not clear whether you&#39;re seeking advice on implementing the logic for dealing with these intermittent failures <i>on the client</i> or debugging them <i>on the server.</i>"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1519056877, "post_id": 48868980, "comment_id": 84743843, "body": "Oh, and that &quot;magic&quot; number of 1k requests looks suspiciously familiar: by default, on a OS based on Linux, you will have the total number of simultaneously open files for a single process capped at 1024. On a Unix-like system, sockets are treated as files in this regard, so once you have 1024 active connections in your server process, you won&#39;t be able to accept the 1025th one. Research <a href=\"https://stackoverflow.com/search?tab=active&amp;q=%5bgo%5d%20too%20many%20open%20files\">this</a> for more pointers, and ask for further information if that&#39;s indeed looks like your case."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1519142907, "post_id": 48868980, "comment_id": 84784046, "body": "As @kostix suggests, I would <b>strongly</b> recommend looking into your open file descriptor limit."}, {"owner": {"reputation": 1053, "user_id": 1870444, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5ebd5fcaa14dec84af11037ffdaa68bc?s=128&d=identicon&r=PG", "display_name": "SamTech", "link": "https://stackoverflow.com/users/1870444/samtech"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1519144702, "post_id": 48868980, "comment_id": 84785250, "body": "@kostix i am trying to find cause for those intermittent failures, so it can be fixed. Regarding open file descripters limit, i had already set it to 65536, hard and soft both."}], "answers": [{"comments": [{"owner": {"reputation": 1053, "user_id": 1870444, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5ebd5fcaa14dec84af11037ffdaa68bc?s=128&d=identicon&r=PG", "display_name": "SamTech", "link": "https://stackoverflow.com/users/1870444/samtech"}, "edited": false, "score": 0, "creation_date": 1519054352, "post_id": 48869220, "comment_id": 84742334, "body": "service is running becuase issue is intermittent and port is reachable, IP address is also fixed. regarging retries logic, can you please provide me link to any guide / standard pattern for it ?"}, {"owner": {"reputation": 171, "user_id": 1503465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560dfce511baa205d006d43a57bea1f0?s=128&d=identicon&r=PG", "display_name": "Michael Ernst", "link": "https://stackoverflow.com/users/1503465/michael-ernst"}, "reply_to_user": {"reputation": 1053, "user_id": 1870444, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5ebd5fcaa14dec84af11037ffdaa68bc?s=128&d=identicon&r=PG", "display_name": "SamTech", "link": "https://stackoverflow.com/users/1870444/samtech"}, "edited": false, "score": 0, "creation_date": 1519055265, "post_id": 48869220, "comment_id": 84742890, "body": "@SamTech I updated my answer so it includes an example of how you could implement retries on the client side"}], "tags": [], "owner": {"reputation": 171, "user_id": 1503465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560dfce511baa205d006d43a57bea1f0?s=128&d=identicon&r=PG", "display_name": "Michael Ernst", "link": "https://stackoverflow.com/users/1503465/michael-ernst"}, "is_accepted": false, "score": 0, "last_activity_date": 1519055228, "last_edit_date": 1519055228, "creation_date": 1519053804, "answer_id": 48869220, "question_id": 48868980, "link": "https://stackoverflow.com/questions/48868980/intermittent-error-getsockopt-connection-refused-error-on-http-post/48869220#48869220", "title": "Intermittent error getsockopt: connection refused error on Http Post", "body": "<p>To make your code more resilient you should add some retries with back-offs, so even when the connection was refused it is still working.</p>\n\n<p>Connection refused means that the port is not opened. Is there any firewall or proxies in between? The authentication part shouldn't matter here because it doesn't even get to this point. </p>\n\n<p>Some things that you can check: </p>\n\n<ul>\n<li>Make sure the service is running  </li>\n<li>Check for firewall configuration</li>\n<li>Implement retries for resilience</li>\n<li>Is the IP-Address fixed? Is Dynamic DNS used and maybe not updated?</li>\n</ul>\n\n<p><strong>Package for back-off retrying</strong></p>\n\n<p>As for implementing the back-off you might try this package: </p>\n\n<p><a href=\"https://github.com/cenkalti/backoff\" rel=\"nofollow noreferrer\">https://github.com/cenkalti/backoff</a> </p>\n\n<p>It is listing examples on how to use it and it's pretty much exactly what you need:</p>\n\n<pre><code>// An operation that may fail.\noperation := func() error {\n    // do the request here and check the response code (or check the response body depending on your need) . e.g. above 500 should retry, above 400 and below 500, it should be a client side error and retrying might not help much\n    return nil // or an error\n}\n\nerr := Retry(operation, NewExponentialBackOff())\nif err != nil {\n    // Handle error.\n    return\n}\n\n// Operation is successful.\n</code></pre>\n"}], "owner": {"reputation": 1053, "user_id": 1870444, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5ebd5fcaa14dec84af11037ffdaa68bc?s=128&d=identicon&r=PG", "display_name": "SamTech", "link": "https://stackoverflow.com/users/1870444/samtech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 702, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1519059029, "creation_date": 1519052993, "last_edit_date": 1519059029, "question_id": 48868980, "link": "https://stackoverflow.com/questions/48868980/intermittent-error-getsockopt-connection-refused-error-on-http-post", "title": "Intermittent error getsockopt: connection refused error on Http Post", "body": "<p>There are two go apps, one is <em>stapi</em> listening on port 8050 and providing RESTful APIs, another is <em>client</em> to consume those APIs.</p>\n\n<p>Both are running on different servers, <em>client</em> is often getting error when calling APIs with HTTP POST method. Below are few lines from <em>client</em> log (real IP replaced with imaginary one)</p>\n\n<pre><code>2018/02/17 11:42:58 ERROR: [DoLogin] API Error: [Post https://123.123.123.123:8050/v1/st/verifyuser: dial tcp 123.123.123.123:8050: getsockopt: connection refused]\n2018/02/17 11:47:14 ERROR: [CreateAttempt] Error: [Post https://123.123.123.123:8050/v1/userattempts/createattempt: dial tcp 123.123.123.123:8050: getsockopt: connection refused]\n</code></pre>\n\n<p>It is intermittent and making the app unreliable, out of approx 1k request i got such error for approx 50+ request.</p>\n\n<p>Initially <em>stapi</em> was listening on all IPs</p>\n\n<pre><code>httpSrv := http.Server{\n    Addr:         \":8050\",\n    Handler:      router, // &lt; gin router\n    ...\n}\n</code></pre>\n\n<p>But after reading the workaroung in <a href=\"https://stackoverflow.com/questions/28376472/golang-http-post-error-connection-refused\">Golang HTTP Post error: connection refused</a> i modified the <em>stapi</em> app and make it listening on different IPs, as shown below</p>\n\n<pre><code>$ sudo lsof -i -P -n | grep LISTEN\nstapi     4775  samtech   10u  IPv4 2388179      0t0  TCP 123.123.123.123:8050 (LISTEN)\nstapi     4775  samtech   11u  IPv6 2388181      0t0  TCP [::1]:8050 (LISTEN)\nstapi     4775  samtech   12u  IPv4 2388183      0t0  TCP 127.0.0.1:8050 (LISTEN)\n</code></pre>\n\n<p>But still the issue is same, what else i should check and fix ? Please suggest.</p>\n\n<p>API is protected with JWT, here is how <em>client</em> is making POST requests</p>\n\n<pre><code>func (w *OST) DoLogin(c *gin.Context) {\n    ...\n    ud := stapimodels.UserLogin{}\n    err := c.BindJSON(&amp;ud)\n    ...\n    //call api to save user response\n    url := config.AppConfig.APIBaseURL + \"st/verifyuser\"\n    res, err := api.JwtApi.APIPost(url, &amp;ud)\n    if err != nil {\n            g.Logger.Errorm(\"DoLogin\", \"Error: %v\", err)\n            t.Error(\"Error\", err.Error())\n            return\n    }\n    ...\n}\n\n//APIPost - call given apiurl with POST method and pass data\nfunc (j *JwtAPI) APIPost(apiurl string, postdata interface{}) (*APIResult, error) {\n        if postdata == nil {\n                return nil, fmt.Errorf(\"postdata is nil\")\n        }\n        jsondata, err := toJSON(postdata)\n        if err != nil {\n                return nil, err\n        }\n\n        resp, err := j.makeRequest(http.MethodPost, apiurl, jsondata)\n        if err != nil {\n                return nil, err\n        }\n\n        defer resp.Body.Close()\n        res := APIResult{}\n        json.NewDecoder(resp.Body).Decode(&amp;res)\n        return &amp;res, nil\n}\n\n//makeRequest makes http request for given url with given method\n// also inject Authorization Header\nfunc (j *JwtAPI) makeRequest(method, apiurl string, body io.Reader) (*http.Response, error) {\n        retry := 0\n        //Create []byte buffer from body - so it can be passed in further retries\n        var buf []byte\n        if body != nil {\n                buf, _ = ioutil.ReadAll(body)\n        }\n\n        r, err := http.NewRequest(method, apiurl, bytes.NewReader(buf))\n        if err != nil {\n                return nil, err\n        }\n        r.Header.Set(\"Authorization\", \"bearer \"+j.token.AccessToken)\n        r.Header.Set(\"Content-Type\", \"application/json\")\n\n        client := j.getClient()\n        resp, err := client.Do(r)\n        if err != nil {\n                return nil, err\n        }\n        return resp, nil\n}\n\nfunc (j *JwtAPI) getClient() *http.Client {\n        // default timeout (if not set by client)\n        timeoutInSec := 10\n        if j.Timeout.Seconds() &gt; 0 {\n                // client sets timeout, so use it\n                timeoutInSec = int(j.Timeout.Seconds())\n        }\n\n        client := &amp;http.Client{\n                Timeout: time.Second * time.Duration(timeoutInSec),\n        }\n        return client\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6574, "user_id": 504596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/FCfk4.jpg?s=128&g=1", "display_name": "fedepaol", "link": "https://stackoverflow.com/users/504596/fedepaol"}, "edited": false, "score": 0, "creation_date": 1519053535, "post_id": 48868567, "comment_id": 84741833, "body": "I think you are appending several times a pointer to the same location (history on the stack), which gets changed every iteration. Guess you need to have a history variable inside the loop scope"}, {"owner": {"reputation": 33, "user_id": 8653981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb5c8b90070bb24dd57115e82a38927?s=128&d=identicon&r=PG&f=1", "display_name": "Ilaroz", "link": "https://stackoverflow.com/users/8653981/ilaroz"}, "reply_to_user": {"reputation": 6574, "user_id": 504596, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/FCfk4.jpg?s=128&g=1", "display_name": "fedepaol", "link": "https://stackoverflow.com/users/504596/fedepaol"}, "edited": false, "score": 0, "creation_date": 1519055955, "post_id": 48868567, "comment_id": 84743314, "body": "@fedepaol can you write me an example what you mean?"}], "owner": {"reputation": 33, "user_id": 8653981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb5c8b90070bb24dd57115e82a38927?s=128&d=identicon&r=PG&f=1", "display_name": "Ilaroz", "link": "https://stackoverflow.com/users/8653981/ilaroz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1519076677, "creation_date": 1519051502, "last_edit_date": 1519052747, "question_id": 48868567, "link": "https://stackoverflow.com/questions/48868567/how-to-read-a-slice-to-append-to-it", "title": "How to read a slice to append to it?", "body": "<p>I want to read a slice and append new data to it. I had a webapi in json format to read the statistics. So I want to grab the statistic, give it to a function, write a new slice with the existing stats from the json before.</p>\n\n<p>Then I want to append new data at the end of it. And give the \"new\" Slice (Struct) with the old statistics from the json and the new together.</p>\n\n<p>I tried so much, that's it.</p>\n\n<p>This is the json looks like </p>\n\n<pre><code>{\"24hreward\":0,\"currentHashrate\":0,\"hashrate\":0,\"history\":[{\"currenthashrate\":6024360000,\"online\":0,\"offline\":0,\"timestamp\":0}],\"pageSize\":30,\"payments\":null,\"paymentsTotal\":0,\"rewards\":[{\"blockheight\":223115,\"timestamp\":1518179084,\"blockhash\":\"0x*************ee03802ee52f411102159a7c9268fec4e46571daa07e84\",\"reward\":6024360000,\"percent\":1,\"immature\":false}],\"roundShares\":3674,\"stats\":{\"balance\":6024360000,\"blocksFound\":1,\"immature\":0,\"lastShare\":1518208862},\"sumrewards\":[{\"inverval\":3600,\"reward\":0,\"name\":\"Last 60 minutes\",\"offset\":0},{\"inverval\":43200,\"reward\":0,\"name\":\"Last 12 hours\",\"offset\":0},{\"inverval\":86400,\"reward\":0,\"name\":\"Last 24 hours\",\"offset\":0},{\"inverval\":604800,\"reward\":0,\"name\":\"Last 7 days\",\"offset\":0},{\"inverval\":2592000,\"reward\":6024360000,\"name\":\"Last 30 days\",\"offset\":0}],\"workers\":{},\"workersOffline\":0,\"workersOnline\":0,\"workersTotal\":0}\n</code></pre>\n\n<p>That's the struct</p>\n\n<pre><code>type HistoryData struct {\n    CurrentHashrate     int64    `json:\"currenthashrate\"`\n    Online              int64    `json:\"online\"`\n    Offline             int64    `json:\"offline\"`\n    Timestamp           int64    `json:\"timestamp\"`\n}\n</code></pre>\n\n<p>There you can see \"history\". I want to read the history and give it to my function here</p>\n\n<pre><code>cmds, err := tx.Exec(func() error {\n    tx.ZRemRangeByScore(r.formatKey(\"hashrate\", login), \"-inf\", fmt.Sprint(\"(\", now-largeWindow))\n    tx.ZRangeWithScores(r.formatKey(\"hashrate\", login), 0, -1)\n    tx.LRange(r.formatKey(\"lastshares\"), 0, 4999)\n    tx.ZRevRangeWithScores(r.formatKey(\"rewards\", login), 0, 39)\n    tx.ZRevRangeWithScores(r.formatKey(\"rewards\", login), 0, -1)\n    tx.ZRevRangeWithScores(r.formatKey(\"history\", login), 0, 64)\n    return nil\n})\n\nstats[\"history\"] = convertHistoryResults(currentHashrate, online, offline, now, cmds[5].(*redis.ZSliceCmd))\n</code></pre>\n\n<p>There I want to give in convertHistoryResults \"currentHashrate, online, offline, now\" and <strong>cmds[5] from top but there is nothing. The json shows data but he cannot read i think :/ Thats my Problem</strong>\nAnd here the function <code>convertHistoryResults</code> to build the list for the \"history\" in the json</p>\n\n<pre><code>var count = 0;\nfunc convertHistoryResults(currenthashrate int64, online int64, offline int64, now int64, rows ...*redis.ZSliceCmd) []*HistoryData {\n    var result []*HistoryData\n    log.Println(\"run1\")\n    log.Println(count)\n    log.Println(rows)\n    history := HistoryData{}\n    for _, row := range rows {\n        for _, v := range row.Val() {\n                log.Println(\"run3\")\n                fields := strings.Split(v.Member.(string), \":\")\n                history.CurrentHashrate, _ = strconv.ParseInt(fields[0], 10, 64)\n                history.Online, _ = strconv.ParseInt(fields[1], 10, 64)\n                history.Offline, _ = strconv.ParseInt(fields[2], 10, 64)\n                history.Timestamp, _ = strconv.ParseInt(fields[3], 10, 64)\n                result = append(result, &amp;history)\n        }\n    }\n    if(count &gt; 0) { // Count = 40 ~4-6min\n        history.CurrentHashrate = currenthashrate\n\n\n    history.Online = online\n    history.Offline = offline\n    history.Timestamp = now\n    result = append(result, &amp;history)\n    log.Println(\"run2\")\n    //if len(result) &gt; 300 {\n    //    result = result[1:]\n    //}\n    count = 0;\n} else {\n    log.Println(\"run4\")\n    count++\n}\nreturn result\n}\n</code></pre>\n\n<p>Here I build new HistoryData and want to read the \"old\" rows and append them to the HistoryData, than i want to give the new Data into it with count, cause i dont want this all seconds.</p>\n\n<p>But my Problem is I cannot read the old \"history\" from the json but I don't know why.\nWith \"rewards\" its working. Its a code from <a href=\"https://github.com/sammy007/open-ethereum-pool\" rel=\"nofollow noreferrer\">https://github.com/sammy007/open-ethereum-pool</a></p>\n\n<p>What i tried is, to read the \"history\" and give them to convertHistoryResults to build new History to append that to \"history\".</p>\n\n<p>Hope someone can help me to get the old \"history\" and rebuild to new \"history\"</p>\n\n<p>This script is running from much different users, so I must rebuild the \"history\" for each one running it.</p>\n\n<p>That is the print in log</p>\n\n<pre><code>[ZREVRANGE miner:history:0x******************** 0 64 WITHSCORES: []]\n</code></pre>\n\n<p>You see, WITHSCORES is []</p>\n\n<p>I also tried in for Rewards, thats like that</p>\n\n<pre><code>[ZREVRANGE miner:rewards:0x******************** 0 64 WITHSCORES: [{1.518179084e+09 6024360000:1.000000000:0:0x**********************159a7c9268fec4e46571daa07e84:223115:1518179084}]]\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 37822, "user_id": 1231450, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b9c98b4ce12bf9fd925d8c35c8861bb2?s=128&d=identicon&r=PG", "display_name": "Jan", "link": "https://stackoverflow.com/users/1231450/jan"}, "edited": false, "score": 1, "creation_date": 1519050325, "post_id": 48868108, "comment_id": 84739899, "body": "Why can&#39;t you just split on <code>%%%</code> ? Alternatively, use <code>.*?</code> (the lazy quantifier)."}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 37822, "user_id": 1231450, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b9c98b4ce12bf9fd925d8c35c8861bb2?s=128&d=identicon&r=PG", "display_name": "Jan", "link": "https://stackoverflow.com/users/1231450/jan"}, "edited": false, "score": 0, "creation_date": 1519051157, "post_id": 48868108, "comment_id": 84740349, "body": "@Jan It&#39;s a capturing group. Each %%% comes in a pair."}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "edited": false, "score": 0, "creation_date": 1519051331, "post_id": 48868108, "comment_id": 84740469, "body": "maybe sth like <a href=\"https://regex101.com/r/gZGIyS/1\" rel=\"nofollow noreferrer\">that</a> <code>https:&#47;&#47;regex101.com&#47;r&#47;gZGIyS&#47;1&#47;</code> ?"}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 1, "last_activity_date": 1519052146, "creation_date": 1519052146, "answer_id": 48868738, "question_id": 48868108, "link": "https://stackoverflow.com/questions/48868108/how-do-i-make-a-repeating-capture-group/48868738#48868738", "title": "How do I make a repeating capture group?", "body": "<p>Don't use regexp, use split</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    example := `%%% First %%% part 1 %%% Second %%% part2`\n\n    other := strings.Split(example, \"%%%\")\n\n    fmt.Println(other)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "edited": false, "score": 0, "creation_date": 1519073801, "post_id": 48868997, "comment_id": 84751923, "body": "wrong way to do it as &quot;part 1&quot;, &quot;part 2&quot; is the text and will be anything."}], "tags": [], "owner": {"reputation": 1290, "user_id": 2483507, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eIUqf.jpg?s=128&g=1", "display_name": "Joffutt4", "link": "https://stackoverflow.com/users/2483507/joffutt4"}, "is_accepted": true, "score": 3, "last_activity_date": 1519074690, "last_edit_date": 1519074690, "creation_date": 1519053069, "answer_id": 48868997, "question_id": 48868108, "link": "https://stackoverflow.com/questions/48868108/how-do-i-make-a-repeating-capture-group/48868997#48868997", "title": "How do I make a repeating capture group?", "body": "<p>This makes the assumption that the pieces you are trying to capture follow the format of <code>%%% Descriptor String %%% part</code> where it will only print the part segment. This is expecting this pattern to repeat.</p>\n\n<p>Also I added in the closing %%% that was missing from the given string.</p>\n\n<p>With this pattern, it doesn't matter on having the closing %%%, but they don't harm either.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    reg := regexp.MustCompile(`%%%[^%]*%%%(?P&lt;part&gt;[^%]*)`)\n    match := reg.FindAllStringSubmatch(`%%% First %%% part 1 %%% Second %%% part2 %%% Third %%% wobble wobble %%%`, -1)\n    if len(match) == 0 {\n        fmt.Println(\"not found\")\n    }\n\n    for i, _ := range match {\n        fmt.Println(\"part:\", match[i][1])\n    }\n}\n</code></pre>\n\n<p>This will print out:</p>\n\n<p><code>part: part 1\npart: part2\npart: wobble wobble</code></p>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 1, "accepted_answer_id": 48868997, "answer_count": 2, "score": 1, "last_activity_date": 1519074690, "creation_date": 1519049781, "question_id": 48868108, "link": "https://stackoverflow.com/questions/48868108/how-do-i-make-a-repeating-capture-group", "title": "How do I make a repeating capture group?", "body": "<p>I am trying to parse the following string:</p>\n\n<pre><code>`%%% First %%% part 1 %%% Second %%% part2`\n</code></pre>\n\n<p>This goes on and on into an unknown number of parts...e.g. Third, Fourth, Another, Car, Airplane, etc... all are separated by \"%%% Something %%%\" </p>\n\n<p>I have:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    reg:= regexp.MustCompile(`(?P&lt;part&gt;%%% .* %%%)+`)\n    match := reg.FindStringSubmatch(`%%% First %%% part 1 %%% Second %%% part2`)\n    if len(match) == 0 {\n        fmt.Println(\"not found\")\n    }\n\n    for i, g := range reg.SubexpNames() {\n        if i == 0 || g == \"\" {\n            continue\n        }\n\n        switch g {\n        case \"part\":\n            fmt.Println(\"part:\", match[i])\n        default:\n            fmt.Printf(\"what group %q\", g)\n        }\n    }\n\n}\n</code></pre>\n\n<p>Gives:</p>\n\n<pre><code>part: %%% First %%% part 1 %%% Second %%%\n</code></pre>\n\n<p>How do I get output so that it prints like the following where part 1 and part 2 are separate matching groups? I would like to ignore \"First\" entirely and just focus on \"Second\":</p>\n\n<pre><code>part 2\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/wLFwnk02dIJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wLFwnk02dIJ</a></p>\n"}, {"tags": ["pointers", "go", "dereference"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1519047355, "post_id": 48867312, "comment_id": 84737968, "body": "You can directly convert them, but the odd thing here is <i>why</i> are you making the type <code>B</code> in the first place? It&#39;s not &quot;wrapping&quot; <code>foo.A</code>, it&#39;s removing the method set."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519047448, "post_id": 48867312, "comment_id": 84738030, "body": "I am trying to write a mock for the underlying database for unit testing."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1519047780, "post_id": 48867312, "comment_id": 84738244, "body": "Not sure how that&#39;s going to mock anything, since it still requires the original type. You&#39;re probably better off composing the type you want in your own data structure."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519049591, "post_id": 48867312, "comment_id": 84739469, "body": "Check out my updated explanation of how I will use this. If you can suggest a better way, I&#39;m interested in hearing about it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519054465, "post_id": 48867312, "comment_id": 84742403, "body": "Normally you use embedding (ie composition) for this, so you don\u2019t need to stub out every method call."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519054546, "post_id": 48867312, "comment_id": 84742450, "body": "Yes, but in this specific case, with <code>CreateBucketIfNotExists</code>, how would that work? What type would <code>CreateBucketIfNotExists</code> return?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1519058630, "post_id": 48867312, "comment_id": 84744850, "body": "I&#39;m not sure what you mean, you can still fulfill your interfaces with composed types. The fundamental issue here is that declaring a new type based on a struct from another package does nothing to decouple you from that package, still requires you to stub out all the exiting methods, and you need and tread very carefully around the copying values. For example (warning, just typed this out without verifying anything): <a href=\"https://play.golang.org/p/LBVcXkm31gi\" rel=\"nofollow noreferrer\">play.golang.org/p/LBVcXkm31gi</a>"}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1519235884, "post_id": 48867312, "comment_id": 84831329, "body": "I understand now what you meant. I&#39;ve reworked my code using the BoltDB types inside structs and it is better. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1519047340, "post_id": 48867388, "comment_id": 84737955, "body": "That is what I was looking for. I tried several combinations, but none compiled. Thanks."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1519048431, "last_edit_date": 1592644375, "creation_date": 1519047257, "answer_id": 48867388, "question_id": 48867312, "link": "https://stackoverflow.com/questions/48867312/wrapping-a-pointer-in-go/48867388#48867388", "title": "Wrapping a pointer in Go", "body": "<p>You can simply / directly convert a value of type <code>*A</code> to a value of type <code>*B</code>, you just have to parenthesize <code>*B</code>:</p>\n<pre><code>a := foo.Fn()   // a is a *A\nb := (*B)(a)\nreturn b\n</code></pre>\n<p>You can even convert the return value of the function call:</p>\n<pre><code>return (*B)(foo.Fn())\n</code></pre>\n<p>Try it on the <a href=\"https://play.golang.org/p/-FsplkpYfKy\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n<p>This is possible, because <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">Spec: Conversions:</a></p>\n<blockquote>\n<p>A non-constant value <code>x</code> can be converted to type <code>T</code> in any of these cases:</p>\n<ul>\n<li><p><code>x</code> is <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assignable</a> to <code>T</code>.</p>\n</li>\n<li><p>...</p>\n</li>\n</ul>\n</blockquote>\n<p>And <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">Spec: Assignability:</a></p>\n<blockquote>\n<p>A value <code>x</code> is assignable to a <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">variable</a> of type <code>T</code> (&quot;<code>x</code> is assignable to <code>T</code>&quot;) if one of the following conditions applies:</p>\n<ul>\n<li><p>...</p>\n</li>\n<li><p><code>x</code>'s type <code>V</code> and <code>T</code> have identical <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">underlying types</a> and at least one of <code>V</code> or <code>T</code> is not a <a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"nofollow noreferrer\">defined</a> type.</p>\n</li>\n</ul>\n</blockquote>\n<p>Both <code>*B</code> and <code>*A</code> types are not defined, and the underlying type of <code>*B</code> is the same as the underlying type of <code>*A</code> (which is the pointer to the underlying type of whatever type there is in the type declaration of <code>A</code>).</p>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 517, "favorite_count": 1, "accepted_answer_id": 48867388, "answer_count": 1, "score": 2, "last_activity_date": 1519051794, "creation_date": 1519047003, "last_edit_date": 1519051794, "question_id": 48867312, "link": "https://stackoverflow.com/questions/48867312/wrapping-a-pointer-in-go", "title": "Wrapping a pointer in Go", "body": "<p>A library <code>foo</code> exposes a type <code>A</code> and a function <code>Fn</code> in that library returns a <code>*A</code>.</p>\n\n<p>I have defined a \"wrapper\" for <code>A</code> called <code>B</code>:</p>\n\n<pre><code>type B foo.A\n</code></pre>\n\n<p>Can I convert the <code>*A</code> to a <code>*B</code> without dereferencing the <code>A</code>?</p>\n\n<p>In other words, if I have</p>\n\n<pre><code>a := foo.Fn()   // a is a *A\nb := B(*a)\nreturn &amp;b\n</code></pre>\n\n<p>How can I convert the <code>*a</code> to a <code>*b</code> without using <code>*a</code>?</p>\n\n<p>The reason that I ask is that in the library that I am using, <code>github.com/coreos/bbolt</code>, the <code>*DB</code> value returned from the <code>Open</code> function includes a <code>sync.Mutex</code> and so the compiler complains when I try to make a copy of the <code>Mutex</code>.</p>\n\n<p><strong>UPDATE TO EXPLAIN HOW I'LL USE THIS</strong></p>\n\n<p>I have a</p>\n\n<pre><code>type Datastore struct {\n    *bolt.DB\n}\n</code></pre>\n\n<p>I also have a function (one of many) like this:</p>\n\n<pre><code>func (ds *Datastore) ReadOne(bucket, id string, data interface{}) error {\n    return ds.View(func(tx *bolt.Tx) error {\n        b, err := tx.CreateBucketIfNotExists([]byte(bucket))\n        if err != nil {\n            return fmt.Errorf(\"opening bucket %s: %v\", bucket, err)\n        }\n\n        bytes := b.Get([]byte(id))\n        if bytes == nil {\n            return fmt.Errorf(\"id %s not found\", id)\n        }\n\n        if err := json.Unmarshal(bytes, data); err != nil {\n            return fmt.Errorf(\"unmarshalling item: %v\", err)\n        }\n\n        return nil\n    })\n}\n</code></pre>\n\n<p>I would like to mock the underlying BoltDB database using a hash map. I ran into a problem mocking this because of the <code>View</code> expecting a function that takes <code>bolt.Tx</code>. That <code>tx</code> is then used to create a new bucket in <code>CreateBucketIfNotExists</code>. I cannot replace that anonymous function argument with one that calls my hash map mock version of <code>CreateBucketIfNotExists</code>.</p>\n\n<p>I came up with this:</p>\n\n<pre><code>package boltdb\n\nimport (\n    \"github.com/coreos/bbolt\"\n)\n\ntype (\n    bucket bolt.Bucket\n\n    // Bucket is a wrapper for bolt.Bucket to facilitate mocking.\n    Bucket interface {\n        ForEach(fn func([]byte, []byte) error) error\n        Get(key []byte) []byte\n        NextSequence() (uint64, error)\n        Put(key, value []byte) error\n    }\n\n    db bolt.DB\n\n    // DB is a wrapper for bolt.DB to facilitate mocking.\n    DB interface {\n        Close() error\n        Update(fn func(*Tx) error) error\n        View(fn func(*Tx) error) error\n    }\n\n    transaction bolt.Tx\n\n    // Tx is a wrapper for bolt.Tx to facilitate mocking.\n    Tx interface {\n        CreateBucketIfNotExists(name []byte) (Bucket, error)\n    }\n)\n\n// ForEach executes a function for each key/value pair in a bucket.\nfunc (b *bucket) ForEach(fn func([]byte, []byte) error) error {\n    return ((*bolt.Bucket)(b)).ForEach(fn)\n}\n\n// Get retrieves the value for a key in the bucket.\nfunc (b *bucket) Get(key []byte) []byte {\n    return ((*bolt.Bucket)(b)).Get(key)\n}\n\n// NextSequence returns an autoincrementing integer for the bucket.\nfunc (b *bucket) NextSequence() (uint64, error) {\n    return ((*bolt.Bucket)(b)).NextSequence()\n}\n\n// Put sets the value for a key in the bucket.\nfunc (b *bucket) Put(key, value []byte) error {\n    return ((*bolt.Bucket)(b)).Put(key, value)\n}\n\n// Close releases all database resources.\nfunc (db *db) Close() error {\n    return ((*bolt.DB)(db)).Close()\n}\n\n// Update executes a function within the context of a read-write managed transaction.\nfunc (db *db) Update(fn func(Tx) error) error {\n    return ((*bolt.DB)(db)).Update(func(tx *bolt.Tx) error {\n        t := transaction(*tx)\n        return fn(&amp;t)\n    })\n}\n\n// View executes a function within the context of a managed read-only transaction.\nfunc (db *db) View(fn func(Tx) error) error {\n    return ((*bolt.DB)(db)).View(func(tx *bolt.Tx) error {\n        t := transaction(*tx)\n        return fn(&amp;t)\n    })\n}\n\n// CreateBucketIfNotExists creates a new bucket if it doesn't already exist.\nfunc (tx *transaction) CreateBucketIfNotExists(name []byte) (Bucket, error) {\n    b, err := ((*bolt.Tx)(tx)).CreateBucketIfNotExists(name)\n    if err != nil {\n        return nil, err\n    }\n    w := bucket(*b)\n    return &amp;w, nil\n}\n</code></pre>\n\n<p>So far, in my code, I am only using the functions shown above. I can add more if new code requires.</p>\n\n<p>I will replace each <code>bolt.DB</code> with <code>DB</code>, <code>bolt.Tx</code> with <code>Tx</code>, and <code>bolt.Bucket</code> with <code>Bucket</code> in the real code. The mocker will use replacements for all three types that use the underlying hash map instead of storing to disk. I can then test all of my code, right down to the database calls.</p>\n"}, {"tags": ["go", "go-gorm"], "owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 322, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1519046291, "creation_date": 1519045452, "last_edit_date": 1519046291, "question_id": 48866871, "link": "https://stackoverflow.com/questions/48866871/how-to-prevent-gorm-from-failing-to-save-associations-when-unique-constraint-is", "title": "How to prevent gorm from failing to save associations when UNIQUE constraint is violated?", "body": "<p>I have the following <code>struct</code></p>\n\n<pre><code>type Category struct {\n  gorm.Model\n  Name string `gorm:\"type:varchar(128);not null;unique\"`\n}\n</code></pre>\n\n<p>which is associated to <code>Item</code> <code>struct</code>:</p>\n\n<pre><code>// Item is a type representing a job listing on stackoverflow jobs\ntype Item struct {\n  GUID   string `gorm:\"primary_key\"`\n  Link   string\n\n  Categories []Category `gorm:\"many2many:item_categories\"`\n}\n</code></pre>\n\n<p>I'd like to save <code>Item</code>s in db using <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">gorm</a> together with associations in table <code>item_categories</code></p>\n\n<p>The problem arises when I <code>INSERT</code> an <code>Item</code> which has at least on <code>Category</code> that is already in the DB (because of the <code>UNIQUE</code> constraint on <code>Category.Name</code>) then I get an error while doing:</p>\n\n<pre><code>var item Item\n// fill item...\ndb.Create(&amp;item)\n</code></pre>\n\n<p>and it propagates so that all <code>INSERT</code>s (of <code>Item</code>, <code>Category</code> and <code>Item_Categories</code>) are not performed.</p>\n\n<p>I've tried using <code>BeforeCreate</code>/<code>AfterCreate</code> but the result is the same</p>\n\n<pre><code>func (c *Category) BeforeCreate(scope *gorm.Scope) (err error) {\n  if err = scope.DB().Where(&amp;Category{Name: c.Name}).First(c).Error; err == nil {\n    return fmt.Errorf(\"Category %s already found in DB\", c.Name)\n  }\n  return nil\n}\n</code></pre>\n\n<p>What can I do to make it insert <code>Item</code>s (and related <strong>new</strong> categories) with categories that are already in the DB?</p>\n\n<p>Example of log I receive when adding a category (inside an <code>Item</code>) that already exists in the DB:</p>\n\n<pre><code>(/home/USER/.gvm/pkgsets/go1.9.4/global/src/github.com/USER/project/model.go:33)\n[2018-02-19 13:42:46]  [0.17ms]  SELECT * FROM \"categories\"  WHERE \"categories\".\"deleted_at\" IS NULL AND ((\"categories\".\"name\" = 'go')) ORDER BY \"categories\".\"id\" ASC LIMIT 1\n[1 rows affected or returned ]\nBeforeCreate First\nCategory &amp;{{4 2018-02-19 13:42:46.164188984 +0100 +0100 2018-02-19 13:42:46.164188984 +0100 +0100 &lt;nil&gt;} go}\n\n(/home/USER/.gvm/pkgsets/go1.9.4/global/src/github.com/USER/project/storage.go:20)\n[2018-02-19 13:42:46]  Category go already found in DB\n\n(/home/USER/.gvm/pkgsets/go1.9.4/global/src/github.com/USER/project/storage.go:20)\n[2018-02-19 13:42:46]  Category go already found in DB\n\n(&lt;autogenerated&gt;:1)\n[2018-02-19 13:42:46]  [0.12ms]  INSERT INTO \"item_categories\" (\"item_guid\",\"category_id\") SELECT '157652','4'  WHERE NOT EXISTS (SELECT * FROM \"item_categories\" WHERE \"item_guid\" = '157652' AND \"category_id\" = '4')\n[1 rows affected or returned ]\n\n(/home/USER/.gvm/pkgsets/go1.9.4/global/src/github.com/USER/project/storage.go:20)\n[2018-02-19 13:42:46]  Category go already found in DB\n\n(/home/USER/.gvm/pkgsets/go1.9.4/global/src/github.com/USER/project/storage.go:20)\n[2018-02-19 13:42:46]  Category go already found in DB\n2018/02/19 13:42:46 Couldn't save job listing 157652 in db: Category go already found in DB\n</code></pre>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1519041056, "post_id": 48865561, "comment_id": 84734188, "body": "you can go through this <a href=\"https://stackoverflow.com/questions/44487887/go-lang-multiplexing-all-goroutines-are-asleep-deadlock\">question</a>"}, {"owner": {"reputation": 1609, "user_id": 9335240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/374b57f721280fb0c39d46f6d3d3955d?s=128&d=identicon&r=PG", "display_name": "user9335240", "link": "https://stackoverflow.com/users/9335240/user9335240"}, "edited": false, "score": 1, "creation_date": 1519041456, "post_id": 48865561, "comment_id": 84734396, "body": "Your problem is that you &quot;post&quot; integers in the channel, then you are trying to read them from the main thread. Then the stream of integers stops, when the goroutines end. (when both <code>producer</code>s end, no more integers are posted into the channel) and you still wait on the main thread for anymore integer to be posted, which will never happen. Try closing the channels using <code>close(ch)</code> after they are no more used."}, {"owner": {"reputation": 571, "user_id": 5176243, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/dfaab6709adec9bddb0d8805aea1cc5f?s=128&d=identicon&r=PG&f=1", "display_name": "Jake Muller", "link": "https://stackoverflow.com/users/5176243/jake-muller"}, "edited": false, "score": 0, "creation_date": 1519042070, "post_id": 48865561, "comment_id": 84734758, "body": "I did the <code>close(ch)</code>"}, {"owner": {"reputation": 1609, "user_id": 9335240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/374b57f721280fb0c39d46f6d3d3955d?s=128&d=identicon&r=PG", "display_name": "user9335240", "link": "https://stackoverflow.com/users/9335240/user9335240"}, "edited": false, "score": 1, "creation_date": 1519042431, "post_id": 48865561, "comment_id": 84734972, "body": "You closed it <b>after</b> the place that makes a deadlock. You &quot;in the infinite for loop&quot;, are keeping polling the channel, waiting for any integer posted to it.   After the both producers end, you are still waiting for more, while nothing is produced.  The <code>close(ch)</code> must be in the end of the producer (but in your case, it will be difficult because you have 2 producers)."}, {"owner": {"reputation": 1609, "user_id": 9335240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/374b57f721280fb0c39d46f6d3d3955d?s=128&d=identicon&r=PG", "display_name": "user9335240", "link": "https://stackoverflow.com/users/9335240/user9335240"}, "edited": false, "score": 1, "creation_date": 1519042547, "post_id": 48865561, "comment_id": 84735028, "body": "Try at first, to delete one producer, then run the code, the same crash will happen. Then try to move <code>close(ch)</code> to the end of the producer routine, will succeed.  But in the 2 producers case, you may need another channel or something, you need a better design."}], "answers": [{"comments": [{"owner": {"reputation": 571, "user_id": 5176243, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/dfaab6709adec9bddb0d8805aea1cc5f?s=128&d=identicon&r=PG&f=1", "display_name": "Jake Muller", "link": "https://stackoverflow.com/users/5176243/jake-muller"}, "edited": false, "score": 0, "creation_date": 1519063220, "post_id": 48866621, "comment_id": 84747142, "body": "I prefer the <code>merge</code> function. The blog you provided is exactly explaining about <code>fan-in</code> and <code>fan-out</code> and how to handle multiple goroutines. Thanks btw."}], "tags": [], "owner": {"reputation": 3095, "user_id": 178597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13148e76e55c7429e663480dc900bf77?s=128&d=identicon&r=PG", "display_name": "Christian", "link": "https://stackoverflow.com/users/178597/christian"}, "is_accepted": false, "score": 3, "last_activity_date": 1519046547, "last_edit_date": 1519046547, "creation_date": 1519044577, "answer_id": 48866621, "question_id": 48865561, "link": "https://stackoverflow.com/questions/48865561/solving-goroutines-deadlock/48866621#48866621", "title": "Solving goroutines deadlock", "body": "<p>The problem is that <code>&lt;-ch</code> is blocking, so if you don't add any new values to the channel it will block forever. One way is to replace it with a switch select which is also blocking but allows to listen on multiple channels. You would also have to add an exit channel. In your example, as soon as the exit channel received two values we can break. The break statement needs a label because we wanna exit from the switch and the for loop.</p>\n\n<p><a href=\"https://play.golang.org/p/wGdCulZDnrx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wGdCulZDnrx</a></p>\n\n<p>Another way is to have multiple input channels and close them as soon as they are finished sending. For this, each goroutine needs it's own channel, otherwise we will exit when the first goroutine is finished.</p>\n\n<p>A third option is to create a merge function which merges multiple channels into one. This allows for moving the creation of the channels into the producers, so they are created, filled and closed in one location. The merge function is relatively complex but it's removed from the business logic code and can separately be understood and tested. the main code is then reduced to just:</p>\n\n<pre><code>ch1 := producer(100*time.Millisecond, 2)\nch2 := producer(200*time.Millisecond, 5)\n\nfor i := range merge(ch1, ch2) {\n    fmt.Println(i)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/2mv8ILhJPIB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2mv8ILhJPIB</a></p>\n\n<p>merge func is from <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1519061338, "last_edit_date": 1519061338, "creation_date": 1519045228, "answer_id": 48866810, "question_id": 48865561, "link": "https://stackoverflow.com/questions/48865561/solving-goroutines-deadlock/48866810#48866810", "title": "Solving goroutines deadlock", "body": "<p>You have producers which are \"short-lived\", they only send values on the channel for a finite amount of time, and you have an endless <code>for</code> loop which receives values from the channel endlessly, without a termination condition, and the channel is only closed after this endless loop. Once the producers stop sending values, it's a deadlock.</p>\n\n<p>Channels must be closed by the producer(s), signalling that no more values will be sent on it. Since you have multiple producers without synchronization (producers are not synchronized with each other), in general you can't tell which one will finish first, so you can't designate one to close the channel (and a channel can only be closed once, see <a href=\"https://stackoverflow.com/questions/43753470/why-gos-channel-can-close-twice/43753647#43753647\">Why Go&#39;s channel can close twice?</a>; and <a href=\"https://stackoverflow.com/questions/34283255/closing-channel-of-unknown-length/34283635#34283635\">Closing channel of unknown length</a>).</p>\n\n<p>You have to \"coordinate\" the producers, and when all have finished their jobs, the coordinator should close the channel.</p>\n\n<p>And the consumer should use a <code>for range</code> on the channel, as the <code>for range</code> construct receives all values from the channel that were sent on it before it was closed, then it terminates automatically.</p>\n\n<p>For the coordination it is recommended to use <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a>. Whether you use a global one in this case or a local one and you pass it to producers is up to you. Using a local will make the solution more general and easier to extend. One thing to note is that you must pass a pointer to <code>sync.WaitGroup</code>. Whenever you spin up a new producer, increment the waitgroup using <a href=\"https://golang.org/pkg/sync/#WaitGroup.Add\" rel=\"nofollow noreferrer\"><code>WaitGroup.Add()</code></a>. When a producer is done, it can signal this using <a href=\"https://golang.org/pkg/sync/#WaitGroup.Done\" rel=\"nofollow noreferrer\"><code>WaitGroup.Done()</code></a>, preferably using <code>defer</code> (so it runs no matter what, mitigating the deadlock in case of abnormal circumstances). And the controller can wait for all producers to finish using <a href=\"https://golang.org/pkg/sync/#WaitGroup.Wait\" rel=\"nofollow noreferrer\"><code>WaitGroup.Wait()</code></a>.</p>\n\n<p>Here's a complete solution:</p>\n\n<pre><code>func producer(ch chan int, d time.Duration, num int, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    for i := 0; i &lt; num; i++ {\n        ch &lt;- i\n        time.Sleep(d)\n    }\n}\n\nfunc main() {\n    wg := &amp;sync.WaitGroup{}\n    ch := make(chan int)\n\n    wg.Add(1)\n    go producer(ch, 100*time.Millisecond, 2, wg)\n    wg.Add(1)\n    go producer(ch, 200*time.Millisecond, 5, wg)\n\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n\n    for v := range ch {\n        fmt.Println(v)\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/9ZyqTsWNfyF\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0\n0\n1\n1\n2\n3\n4\n</code></pre>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/42752705/prevent-the-main-function-from-terminating-before-goroutines-finish-in-golang/42753005#42753005\">Prevent the main() function from terminating before goroutines finish in Golang</a></p>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 5, "last_activity_date": 1519045293, "creation_date": 1519045293, "answer_id": 48866824, "question_id": 48865561, "link": "https://stackoverflow.com/questions/48865561/solving-goroutines-deadlock/48866824#48866824", "title": "Solving goroutines deadlock", "body": "<p>This problem can be solved in an elegant way using two wait groups. By closing channel <code>ch</code> we signal to the consumers that there is no more data.</p>\n\n<p>The solutions scales well with more consumers.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc producer(ch chan&lt;- int, d time.Duration, num int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for i := 0; i &lt; num; i++ {\n        ch &lt;- i\n        time.Sleep(d)\n    }\n}\n\nfunc consumer(ch &lt;-chan int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for x := range ch {\n        fmt.Println(x)\n    }\n}\n\nfunc main() {\n    ch := make(chan int)\n    producers := &amp;sync.WaitGroup{}\n    consumers := &amp;sync.WaitGroup{}\n\n    producers.Add(2)\n    go producer(ch, 100*time.Millisecond, 2, producers)\n    go producer(ch, 200*time.Millisecond, 5, producers)\n\n    consumers.Add(1)\n    go consumer(ch, consumers)\n\n    producers.Wait()\n    close(ch)\n    consumers.Wait()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1519051855, "post_id": 48867406, "comment_id": 84740803, "body": "What happens if the producer that isn&#39;t the &quot;closer&quot; is still running when the closer closes the channel? This is not a very stable design."}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1519052154, "post_id": 48867406, "comment_id": 84740981, "body": "Of course! I gave this answer because the asker is stuck on code and this is the simplest way to get unstuck. Design comes later."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1519052218, "post_id": 48867406, "comment_id": 84741018, "body": "They&#39;ll be almost immediately re-stuck, though. I&#39;m all for &quot;one problem at a time&quot; but solving a problem by creating a different problem seems counter-productive, especially when <code>sync.WaitGroup</code> exists to handle exactly this situation."}, {"owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1519052604, "post_id": 48867406, "comment_id": 84741248, "body": "Yeah, maybe. Sometimes introducing a different design is too much to grasp. Anyway, I edited my answer to clarify the goal."}], "tags": [], "owner": {"reputation": 3180, "user_id": 6716781, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpIoT.jpg?s=128&g=1", "display_name": "Jonah Benton", "link": "https://stackoverflow.com/users/6716781/jonah-benton"}, "is_accepted": false, "score": 0, "last_activity_date": 1519052524, "last_edit_date": 1519052524, "creation_date": 1519047319, "answer_id": 48867406, "question_id": 48865561, "link": "https://stackoverflow.com/questions/48865561/solving-goroutines-deadlock/48867406#48867406", "title": "Solving goroutines deadlock", "body": "<p>Simpler answer- one of the producers needs to close the channel, and the consumer can just range over the channel.  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc producer(ch chan int, d time.Duration, num int, closer bool) {\n\n    for i:=0; i&lt;num; i++ {\n        ch &lt;- i\n        time.Sleep(d)   \n    }\n    if closer {\n        close(ch)\n    }\n}\n\nfunc main() {\n    ch := make(chan int)\n\n    go producer(ch, 100*time.Millisecond, 2, false)\n    go producer(ch, 200*time.Millisecond, 5, true)\n\n    for i := range ch {\n        fmt.Println(i)\n    }\n\n}\n</code></pre>\n\n<p>Of course, unless you have a situation where you know which producer will always finish last, you would not want to do this in real code. Better designs are in the WaitGroup-based patterns in the other answers. But this is the simplest way for this code to avoid deadlock.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1519127858, "post_id": 48879420, "comment_id": 84774022, "body": "Isn&#39;t this &quot;exactly&quot; the same as my solution (apart from you calling <code>wg.Add()</code> only once, and &quot;misplacing&quot; the <code>defer wg.Done()</code>)?"}, {"owner": {"reputation": 1496, "user_id": 4374970, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/mVn41.jpg?s=128&g=1", "display_name": "mfathirirhas", "link": "https://stackoverflow.com/users/4374970/mfathirirhas"}, "edited": false, "score": 0, "creation_date": 1519186230, "post_id": 48879420, "comment_id": 84801540, "body": "I&#39;m surprised that we have same solution. I ever read about the sync.waitgroup somewhere. Actually I&#39;ve ever written a little different solution than this, but I change it to match the op question. I&#39;ll change to my own."}], "tags": [], "owner": {"reputation": 1496, "user_id": 4374970, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/mVn41.jpg?s=128&g=1", "display_name": "mfathirirhas", "link": "https://stackoverflow.com/users/4374970/mfathirirhas"}, "is_accepted": true, "score": 2, "last_activity_date": 1519187112, "last_edit_date": 1519187112, "creation_date": 1519109450, "answer_id": 48879420, "question_id": 48865561, "link": "https://stackoverflow.com/questions/48865561/solving-goroutines-deadlock/48879420#48879420", "title": "Solving goroutines deadlock", "body": "<p>You need to synchronize all the asynchronous process in your goroutines. Your main thread and the goroutine threads are not synchronous process. Your main thread will never knew when to stop invoking channel from goroutines. Since your main thread loop over the channel, it always invoke the value from channel, and when the goroutines finished and the channel stop sending value, your main thread cannot get anymore value from the channel, hence the condition become deadlock. To avoid this use <code>sync.WaitGroup</code> to synchronize the asynchronous process.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"sync\"\n)\n\nfunc producer(ch chan int, d time.Duration, num int, wg *sync.WaitGroup) {\n    for i:=0; i&lt;num; i++ {\n        ch &lt;- i;\n        time.Sleep(d);\n    }\n    defer wg.Done();\n}\n\nfunc main() {\n    wg  := &amp;sync.WaitGroup{}\n    ch  := make(chan int);\n\n    wg.Add(2);\n    go producer(ch, 100*time.Millisecond, 2, wg);\n    go producer(ch, 200*time.Millisecond, 5, wg);\n\n    go func() {   \n    wg.Wait()\n    close(ch)\n    }()\n\n    // print the outputs\n    for i:= range ch {\n        fmt.Println(i);\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/euMTGTIs83g\" rel=\"nofollow noreferrer\">https://play.golang.org/p/euMTGTIs83g</a></p>\n\n<p>Hope it helps.</p>\n\n<p>Since my solution looks a little similar to already answered, I change it to my original answer before modification to suit OP question.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"sync\"\n)\n\n// producer produce values tobe sent to consumer\nfunc producer(ch chan int, d time.Duration, num int, wg *sync.WaitGroup) {\n    defer wg.Done();\n    for i:=0; i&lt;num; i++ {\n        ch &lt;- i;\n        time.Sleep(d);\n    }\n}\n\n// consumer consume all values from producers\nfunc consumer(ch chan int, out chan int, wg *sync.WaitGroup) {\n    defer wg.Done();\n    for i:= range ch {\n        out &lt;- i\n    }\n}\n\n// synchronizer synchronize all goroutines to avoid deadlocks\nfunc synchronizer(ch chan int, out chan int, wgp *sync.WaitGroup, wgc *sync.WaitGroup) {\n    wgp.Wait()\n    close(ch)\n    wgc.Wait()\n    close(out)\n}\n\nfunc main() {\n    wgp  := &amp;sync.WaitGroup{}\n    wgc  := &amp;sync.WaitGroup{}\n    ch  := make(chan int);\n    out := make(chan int);\n\n    wgp.Add(2);\n    go producer(ch, 100*time.Millisecond, 2, wgp);\n    go producer(ch, 200*time.Millisecond, 5, wgp);\n\n    wgc.Add(1);\n    go consumer(ch, out, wgc)\n\n    go synchronizer(ch, out, wgp, wgc)\n\n    // print the outputs\n    for i:= range out {\n        fmt.Println(i);\n    }\n}\n</code></pre>\n\n<p>Using <code>consumer</code> goroutine to <code>fan-in</code> all input from multiple goroutines and read all values from the <code>consumer</code> goroutine.</p>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 571, "user_id": 5176243, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/dfaab6709adec9bddb0d8805aea1cc5f?s=128&d=identicon&r=PG&f=1", "display_name": "Jake Muller", "link": "https://stackoverflow.com/users/5176243/jake-muller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2400, "favorite_count": 2, "accepted_answer_id": 48879420, "answer_count": 5, "score": 2, "last_activity_date": 1519187112, "creation_date": 1519040893, "last_edit_date": 1519044354, "question_id": 48865561, "link": "https://stackoverflow.com/questions/48865561/solving-goroutines-deadlock", "title": "Solving goroutines deadlock", "body": "<p>I've been trying to solve this simple problem I encountered in Golang concurrency. I've been searching all possible solutions, but found nothing specific to my problem(or I might be missed one). Here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc producer(ch chan int, d time.Duration, num int) {\n\n    for i:=0; i&lt;num; i++ {\n        ch &lt;- i\n        time.Sleep(d)\n    }\n}\n\nfunc main() {\n    ch := make(chan int)\n\n    go producer(ch, 100*time.Millisecond, 2)\n    go producer(ch, 200*time.Millisecond, 5)\n\n    for {\n        fmt.Println(&lt;-ch)    \n    }\n\n    close(ch)\n}\n</code></pre>\n\n<p>It prints error:</p>\n\n<blockquote>\n  <p>fatal error: all goroutines are asleep - deadlock!</p>\n  \n  <p>goroutine 1 [chan receive]:\n  main.main()\n          D:/Code/go/src/testconcurrency/main.go:23 +0xca\n  exit status 2</p>\n</blockquote>\n\n<p>What is the efficient way to avoid this error?, Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1519038831, "post_id": 48864836, "comment_id": 84732883, "body": "Please go through - How do I ask a good <a href=\"https://stackoverflow.com/help/how-to-ask\">question</a> ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1519038997, "post_id": 48864836, "comment_id": 84732974, "body": "You shouldn&#39;t have handlers that parse templates. See: <a href=\"https://stackoverflow.com/questions/28451675/it-takes-too-much-time-when-using-template-package-to-generate-a-dynamic-web-p/28453523#28453523\">It takes too much time when using \u201ctemplate\u201d package to generate a dynamic web page to client in golang</a>. Once you move the template parsing out of the handler, it also becomes much easier to test."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1519039288, "post_id": 48864836, "comment_id": 84733149, "body": "A good unit test tests all meaningful input values, and that they produce all meaningful output values. Input includes global state, such as global variables, databases, or the filesystem. Output includes side effects (such as modifying global variables, changing database entries, or writing to the filesystem). Given that: What are the meaningful inputs for this function? And given those inputs, what should the outputs be? Write tests that cover these cases."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1519041792, "creation_date": 1519041792, "answer_id": 48865828, "question_id": 48864836, "link": "https://stackoverflow.com/questions/48864836/what-should-as-a-unit-test-case-one-should-write-for-a-function-like-this-code/48865828#48865828", "title": "what should as a unit test case one should write for a function like this. code snippet would be helpful", "body": "<blockquote>\n<pre><code>func Home(w http.ResponseWriter, r *staticAuth.AuthenticatedRequest) {\n    t, err := template.ParseFiles(\"index.html\") //parse the html file homepage.html\n    if err != nil {                             // if there is an error\n        log.Print(\"template parsing error: \", err) // log it\n    }\n    err = t.Execute(w, nil) //execute the template and pass it the HomePageVars struct to fill in the gaps\n    if err != nil {         // if there is an error\n        log.Print(\"template executing error: \", err) //log it\n    }\n}\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>In your code, you check for and log errors, then you keep going and ignore the errors.</p>\n"}], "owner": {"reputation": 29, "user_id": 5850478, "user_type": "registered", "profile_image": "https://graph.facebook.com/1020135718045455/picture?type=large", "display_name": "Sourav Choudhary", "link": "https://stackoverflow.com/users/5850478/sourav-choudhary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 1, "answer_count": 1, "score": -3, "last_activity_date": 1519041792, "creation_date": 1519038589, "last_edit_date": 1519039228, "question_id": 48864836, "link": "https://stackoverflow.com/questions/48864836/what-should-as-a-unit-test-case-one-should-write-for-a-function-like-this-code", "title": "what should as a unit test case one should write for a function like this. code snippet would be helpful", "body": "<pre><code>func Home(w http.ResponseWriter, r *staticAuth.AuthenticatedRequest) {\n    t, err := template.ParseFiles(\"index.html\") //parse the html file homepage.html\n    if err != nil {                             // if there is an error\n        log.Print(\"template parsing error: \", err) // log it\n    }\n    err = t.Execute(w, nil) //execute the template and pass it the HomePageVars struct to fill in the gaps\n    if err != nil {         // if there is an error\n        log.Print(\"template executing error: \", err) //log it\n    }\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "daemon", "systemd", "archlinux"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1519038918, "post_id": 48863670, "comment_id": 84732934, "body": "Do you get any errors in the journal?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1519039461, "post_id": 48863670, "comment_id": 84733240, "body": "If you need a service to have access to your X server, you can&#39;t run it in systemd, you need to run it from within X. The best way to do this probably depends on which DE/window manager you&#39;re using. But this is probably best asked on Super User, as it&#39;s really about how to start a service in X, rather than about programming, per se."}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 5559226, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/2db6ec22bed47d6ba22da0fd9df3c75d?s=128&d=identicon&r=PG&f=1", "display_name": "David Kane", "link": "https://stackoverflow.com/users/5559226/david-kane"}, "is_accepted": false, "score": 1, "last_activity_date": 1519040401, "creation_date": 1519040401, "answer_id": 48865415, "question_id": 48863670, "link": "https://stackoverflow.com/questions/48863670/trying-to-run-service-that-access-to-x-server-under-systemd/48865415#48865415", "title": "Trying to run service that access to X server under systemd", "body": "<p>Following Flimzy's comment to my question I figured it out. As he stated you can't run stuff that relies on X from systemd, so instead I run it automatically from my .i3/config file (I use I3 window manager). Thanks again to Flimzy for helping me with that.</p>\n"}], "owner": {"reputation": 81, "user_id": 5559226, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/2db6ec22bed47d6ba22da0fd9df3c75d?s=128&d=identicon&r=PG&f=1", "display_name": "David Kane", "link": "https://stackoverflow.com/users/5559226/david-kane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1542939012, "creation_date": 1519034753, "last_edit_date": 1542939012, "question_id": 48863670, "link": "https://stackoverflow.com/questions/48863670/trying-to-run-service-that-access-to-x-server-under-systemd", "title": "Trying to run service that access to X server under systemd", "body": "<p>I'm using manjaro linux (arch based) with systemd. I want to make a daemon service that runs in the background and takes screenshots of my screen at random intervals, up to 10 minutes apart.</p>\n\n<p>I'm using Go, and I have a program that works just fine if I build it and run it from the command line (see below). I've made a .service file (see below) for the service and I've started it with <code>systemctl start screenshot</code> and confirmed it's running with <code>systemctl is-active screenshot</code>. However, it doesn't work. No screenshots are being saved like if I run it from the command line.</p>\n\n<p>Out of interest I tried running it with <code>nohup ./screenshot &amp;</code> and it suffers from the same problem as my daemon attempt.</p>\n\n<p>Is there some sort of problem with using the date package in the background? Or could it perhaps be the screenshot library?</p>\n\n<p><code>screenshot.go</code> </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"image/png\"\n    \"math/rand\"\n    \"os\"\n    \"time\"\n\n    \"github.com/coreos/go-systemd/daemon\"\n    \"github.com/vova616/screenshot\"\n)\n\nfunc main() {\n    daemon.SdNotify(false, \"READY=1\")\n    i := 0\n    for {\n        r := rand.Intn(10)\n        time.Sleep(time.Duration(r) * time.Minute)\n        t := time.Now()\n        year, month, day := t.Date()\n        date := fmt.Sprintf(\"%d-%s-%d\", year, month.String(), day)\n        img, err := screenshot.CaptureScreen()\n        if err != nil {\n            fmt.Println(err)\n            continue\n        }\n        hour, min, sec := t.Clock()\n        stamp := fmt.Sprintf(\"%d:%d:%d\", hour, min, sec)\n        fmt.Printf(\"Taking screenshot %s\\n\", stamp)\n        f, err := os.Create(fmt.Sprintf(\"/home/dave/screenshot/%s/%s.png\", date, stamp))\n        if err != nil {\n            fmt.Println(err)\n            continue\n        }\n        err = png.Encode(f, img)\n        if err != nil {\n            fmt.Println(err)\n            continue\n        }\n        err = f.Close()\n        if err != nil {\n            fmt.Println(err)\n            continue\n        }\n        i++\n        daemon.SdNotify(false, \"WATCHDOG=1\")\n    }\n}\n</code></pre>\n\n<p>and here is the service file</p>\n\n<pre><code>[Unit]\nDescription=Random Screenshot Service\n\n[Service]\nType=notify\nExecStart=/home/dave/screenshot/screenshot\nWatchdogSec=30s\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n"}, {"tags": ["dictionary", "go", "concurrency", "synchronization", "locking"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1519034850, "last_edit_date": 1519034850, "creation_date": 1519031628, "answer_id": 48862702, "question_id": 48862457, "link": "https://stackoverflow.com/questions/48862457/ensure-only-one-goroutine-is-running-using-sync-map/48862702#48862702", "title": "Ensure only one goroutine is running using sync.Map", "body": "<p>The problem is that you do your work (<code>doWork()</code>) in a new goroutine. If param is not yet locked, the handler locks it, and launches a goroutine to do the work. But the goroutine serving the request does not wait for the work to complete, it unlocks the param immediately.</p>\n\n<p>Instead do the work in the handler, so unlocking the param will only happen once <code>doWork()</code> returns:</p>\n\n<pre><code>doWork(c.param) // Note no 'go' keyword\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 572, "user_id": 1911889, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9d4e9f32328a5f2431aaa747e4ba958d?s=128&d=identicon&r=PG", "display_name": "tselvan", "link": "https://stackoverflow.com/users/1911889/tselvan"}, "edited": false, "score": 0, "creation_date": 1519064741, "post_id": 48862716, "comment_id": 84747965, "body": "Because doWork() takes a long time and I don&#39;t want the request to wait. It is more of an async task."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 572, "user_id": 1911889, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9d4e9f32328a5f2431aaa747e4ba958d?s=128&d=identicon&r=PG", "display_name": "tselvan", "link": "https://stackoverflow.com/users/1911889/tselvan"}, "edited": false, "score": 0, "creation_date": 1519117786, "post_id": 48862716, "comment_id": 84766962, "body": "Then you need to move your lock management into that goroutine, as well."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1519031665, "creation_date": 1519031665, "answer_id": 48862716, "question_id": 48862457, "link": "https://stackoverflow.com/questions/48862457/ensure-only-one-goroutine-is-running-using-sync-map/48862716#48862716", "title": "Ensure only one goroutine is running using sync.Map", "body": "<p>You're starting a goroutine to do the work, then immediately deleting the key, before the work has a chance to complete.  So the chance of lock contention is infinitesimally low.</p>\n\n<p>Why are you using <code>go doWork()</code> instead of just <code>doWork()</code>?</p>\n"}], "owner": {"reputation": 572, "user_id": 1911889, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9d4e9f32328a5f2431aaa747e4ba958d?s=128&d=identicon&r=PG", "display_name": "tselvan", "link": "https://stackoverflow.com/users/1911889/tselvan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 48862716, "answer_count": 2, "score": -3, "last_activity_date": 1519057200, "creation_date": 1519030662, "last_edit_date": 1519057200, "question_id": 48862457, "link": "https://stackoverflow.com/questions/48862457/ensure-only-one-goroutine-is-running-using-sync-map", "title": "Ensure only one goroutine is running using sync.Map", "body": "<p>I have a HTTP handler which receives a parameter from query. I don't want to run this handler concurrently for the same query parameter i.e. only one goroutine should be running at a point in time.</p>\n\n<p>This was my idea:</p>\n\n<pre><code>import \"sync\"\nimport \"fmt\"\n\nvar safeMap = sync.Map{}\n\nfunc handler(c) {\n\n    _, loaded := safeMap.LoadOrStore(c.param, 1) // loaded is true if value was loaded and false if stored \n    fmt.Println(loaded)\n\n    if loaded {\n        c.JSON(http.StatusLocked, \"locked\")\n        return\n    }\n\n    go doWork(c.param)\n\n    safeMap.Delete(c.param)\n\n    c.JSON(http.StatusOK, \"done\")\n}\n</code></pre>\n\n<p>But, whenever I send two concurrent requests <code>loaded</code> is false for both and both requests are processed. Why?</p>\n"}, {"tags": ["go", "gitlab"], "answers": [{"comments": [{"owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1519031061, "post_id": 48862463, "comment_id": 84728119, "body": "Thanks! Yes, I saw this while researching the issue, but as far as I understood, that flag made sure to recursively download dependencies for the tests of the dependencies (i.e. allowing you to test your deps as well as your own code). I&#39;ll try again, though!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1519031225, "post_id": 48862463, "comment_id": 84728204, "body": "@HelgeTalvikS&#246;derstr&#246;m: Yes, it does that, too."}, {"owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1519032001, "post_id": 48862463, "comment_id": 84728670, "body": "I added the flag, changing <code>go get</code> to <code>go get -t</code>. Unfortunately, the same issue remains."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1519032272, "post_id": 48862463, "comment_id": 84728854, "body": "@HelgeTalvikS&#246;derstr&#246;m: <code>go get -t .&#47;...</code> is probably what you need, if you have recursive deps, too."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 7, "last_activity_date": 1519030681, "creation_date": 1519030681, "answer_id": 48862463, "question_id": 48862402, "link": "https://stackoverflow.com/questions/48862402/test-dependency-not-retrieved-by-go-get/48862463#48862463", "title": "Test dependency not retrieved by `go get`", "body": "<p>From the <a href=\"https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"noreferrer\">docs</a> (also available via <code>go get --help</code>):</p>\n\n<blockquote>\n  <p>The -t flag instructs get to also download the packages required to build the tests for the specified packages.                                                                                                                                            </p>\n</blockquote>\n\n<p>So you need to run <code>go get -t</code> to download test dependencies.</p>\n"}], "owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3068, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519030681, "creation_date": 1519030403, "last_edit_date": 1519030639, "question_id": 48862402, "link": "https://stackoverflow.com/questions/48862402/test-dependency-not-retrieved-by-go-get", "title": "Test dependency not retrieved by `go get`", "body": "<p>I'm using Golang (1.9 at this time), and using GitLab CI to test and build binaries and Docker containers.</p>\n\n<p>For some projects, I run into this issue (GitLab CI output):</p>\n\n<pre><code>$ go get\n$ go get -u github.com/golang/lint/golint\n$ go tool vet -composites=false -shadow=true *.go\n$ golint ./...\n$ go test --race $(go list ./... | grep -v /vendor/)\n# gitlab.my.site/core/proj/mypkg mypkg/mypkg_test.go:18:2: cannot find package \n\"gitlab.my.site/core/otherproj/otherpkg\" in any of:\n/usr/local/go/src/gitlab.my.site/core/otherproj/otherpkg (from $GOROOT)\n    /go/src/gitlab.my.site/core/otherproj/otherpkg (from $GOPATH)\nFAIL    gitlab.my.site/core/proj/mypkg [setup failed]\n</code></pre>\n\n<p>The <code>core/otherproj</code> project is private, but clonable through SSH, which is my current workaround.</p>\n\n<p>My main problem is that private projects in dependencies most often work, but sometimes, <code>go get</code>ting them consistently fails.</p>\n\n<p>Worth noting is that the <code>otherproj/otherpkg</code> is only a dependency in the test for <code>proj/mypkg</code>; not its primary functionality.</p>\n\n<p><strong>My question is</strong>; why does this specific dependency not download from <code>go get</code>, and how do I make it download?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["pointers", "go", "methods", "interface", "kubernetes"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1519030690, "last_edit_date": 1592644375, "creation_date": 1519027006, "answer_id": 48861656, "question_id": 48861383, "link": "https://stackoverflow.com/questions/48861383/how-can-deployment-satisfy-type-runtime-object-in-kubernetes-code/48861656#48861656", "title": "How can &amp;deployment satisfy type runtime.Object in kubernetes code?", "body": "<p><code>deployment</code> is a local variable, its declaration:</p>\n<pre><code>deployment := extensionsv1beta1.Deployment{\n    // ...\n}\n</code></pre>\n<p>Where <code>extensionsv1beta1</code> from the imports:</p>\n<pre><code>import (\n    // ...\n    extensionsv1beta1 &quot;k8s.io/api/extensions/v1beta1&quot;\n    // ...\n)\n</code></pre>\n<p>Doc of <a href=\"https://godoc.org/k8s.io/api/extensions/v1beta1#Deployment\" rel=\"nofollow noreferrer\"><code>extensionsv1beta1.Deployment</code></a>. Its definition is:</p>\n<pre><code>type Deployment struct {\n    metav1.TypeMeta `json:&quot;,inline&quot;`\n    // ...other fields...\n}\n</code></pre>\n<p>It embeds <a href=\"https://godoc.org/k8s.io/apimachinery/pkg/apis/meta/v1#TypeMeta\" rel=\"nofollow noreferrer\"><code>metav1.TypeMeta</code></a>, which has a method <a href=\"https://godoc.org/k8s.io/apimachinery/pkg/apis/meta/v1#TypeMeta.GetObjectKind\" rel=\"nofollow noreferrer\"><code>GetObjectKind()</code></a> method with pointer receiver. This means a pointer to <code>Deployment</code> also has this method, because <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Spec: Struct types:</a></p>\n<blockquote>\n<p>Given a struct type <code>S</code> and a defined type <code>T</code>, promoted methods are included in the method set of the struct as follows:</p>\n<ul>\n<li>If <code>S</code> contains an embedded field <code>T</code>, the method sets of <code>S</code> and <code>*S</code> both include promoted methods with receiver <code>T</code>. <strong>The method set of <code>*S</code> also includes promoted methods with receiver <code>*T</code>.</strong></li>\n</ul>\n</blockquote>\n<p>And <code>Deployment</code> has a &quot;direct&quot; <a href=\"https://godoc.org/k8s.io/api/extensions/v1beta1#Deployment.DeepCopyObject\" rel=\"nofollow noreferrer\"><code>DeepCopyObject()</code></a> method, again with pointer receiver. So the <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> of <code>*Deployment</code> contains this method.</p>\n<p>And last quoting <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">Spec: Interface types:</a></p>\n<blockquote>\n<p>An interface type specifies a <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> called its <em>interface</em>. <strong>A variable of interface type can store a value of any type with a method set that is any superset of the interface.</strong> Such a type is said to <em>implement the interface</em>.</p>\n</blockquote>\n<p>So this means the method set of <code>*Deployment</code> has all the methods defined by <code>Object</code>, or in other words: the method set of <code>*Deployment</code> is a superset of the method set of <code>Object</code>, so <code>*Deployment</code> implements <code>Object</code>.</p>\n<p><code>deployment</code> is of type <code>extensionsv1beta1.Deployment</code>, which means <code>&amp;deployment</code> is of type <code>*extensionsv1beta1.Deployment</code>, which we showed above that it implements <code>Object</code>; so the value <code>&amp;deployment</code> can be assigned to or be stored in a variable of type <code>Object</code>.</p>\n"}], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2145, "favorite_count": 2, "accepted_answer_id": 48861656, "answer_count": 1, "score": 4, "last_activity_date": 1519096074, "creation_date": 1519025642, "last_edit_date": 1519096074, "question_id": 48861383, "link": "https://stackoverflow.com/questions/48861383/how-can-deployment-satisfy-type-runtime-object-in-kubernetes-code", "title": "How can &amp;deployment satisfy type runtime.Object in kubernetes code?", "body": "<p>In <a href=\"https://github.com/kubernetes/kubernetes/blob/master/pkg/kubectl/run.go#L59\" rel=\"nofollow noreferrer\"><code>kubectl/run.go</code></a> in Kubernetes code, the <code>Generate</code> function has a result list of these two types:</p>\n\n<pre><code>runtime.Object, error\n</code></pre>\n\n<p>The last line of the function is:</p>\n\n<pre><code>return &amp;deployment, nil\n</code></pre>\n\n<p><code>runtime</code> is imported:</p>\n\n<pre><code>k8s.io/apimachinery/pkg/runtime\n</code></pre>\n\n<p>I got <code>runtime</code> by running <code>go get</code> on that import statement, and Object is defined in <code>interfaces.go</code>:</p>\n\n<pre><code>type Object interface {\n    GetObjectKind() schema.ObjectKind\n    DeepCopyObject() Object\n}\n</code></pre>\n\n<p>(And I found the same code on the web <a href=\"https://github.com/kubernetes/kubernetes/blob/master/staging/src/k8s.io/apimachinery/pkg/runtime/interfaces.go\" rel=\"nofollow noreferrer\">here</a>.)</p>\n\n<p>The address operator creates a pointer... more specifically, the Go spec states:</p>\n\n<blockquote>\n  <p>For an operand x of type T, the address operation &amp;x generates a pointer of type *T to x.</p>\n</blockquote>\n\n<p>and pointers <a href=\"https://golang.org/ref/spec#Pointer_types\" rel=\"nofollow noreferrer\">have a type distinct from their base type</a>:</p>\n\n<blockquote>\n  <p>A pointer type denotes the set of all pointers to variables of a given type, called the base type of the pointer.</p>\n</blockquote>\n\n<p>How does <code>&amp;deployment</code> satisfy the <code>runtime.Object</code> type?</p>\n\n<p>My best guess so far is that <code>deployment</code> implements the <code>runtime.Object</code> interface, and mapping <code>&amp;deployment</code> to <code>runtime.Object</code> satisfies <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">this rule of assignability</a>:</p>\n\n<blockquote>\n  <p>T is an interface type and x implements T.</p>\n</blockquote>\n\n<p>and that a return statement statement mapping to a result list type is equivalent to assignment in this respect.  Is this correct?  If not, is there another part of the specification or documentation that explains it?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "edited": false, "score": 1, "creation_date": 1550630782, "post_id": 48861083, "comment_id": 96335427, "body": "&quot;If a goroutine holds an RWMutex for reading and another goroutine might call Lock, no goroutine should expect to be able to acquire a read lock until the initial read lock is released. In particular, this prohibits recursive read locking. This is to ensure that the lock eventually becomes available; a blocked Lock call excludes new readers from acquiring the lock.&quot; -These lines from the docs... Can you please elaborate on these?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "edited": false, "score": 1, "creation_date": 1550653869, "post_id": 48861083, "comment_id": 96343687, "body": "@Hardy, essentially it means that it&#39;s not okay to &quot;nest&quot; RLock/RUnlock calls. RLock is not guaranteed to be able to proceed immediately, if there is at least one other goroutine that may call Lock (which is pretty much always true, else you wouldn&#39;t need the mutex). Demo: <a href=\"https://play.golang.org/p/wdI4kX--GHA\" rel=\"nofollow noreferrer\">play.golang.org/p/wdI4kX--GHA</a>"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 33, "last_activity_date": 1609227051, "last_edit_date": 1609227051, "creation_date": 1519024093, "answer_id": 48861083, "question_id": 48861029, "link": "https://stackoverflow.com/questions/48861029/what-is-the-benefit-of-using-rwmutex-instead-of-mutex/48861083#48861083", "title": "What is the benefit of using RWMutex instead of Mutex?", "body": "<p>From <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\">the docs</a> (emphasize mine):</p>\n<blockquote>\n<p>A RWMutex is a reader/writer mutual exclusion lock. <em>The lock can be held by an arbitrary number of readers or a single writer.</em> The zero value for a RWMutex is an unlocked mutex.</p>\n</blockquote>\n<p>In other words, readers don't have to wait for each other. They only have to wait for writers holding the lock.</p>\n<p>A sync.RWMutex is thus preferable for data that is mostly read, and the resource that is saved compared to a sync.Mutex is time.</p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10030, "favorite_count": 3, "accepted_answer_id": 48861083, "answer_count": 1, "score": 29, "last_activity_date": 1609227051, "creation_date": 1519023859, "question_id": 48861029, "link": "https://stackoverflow.com/questions/48861029/what-is-the-benefit-of-using-rwmutex-instead-of-mutex", "title": "What is the benefit of using RWMutex instead of Mutex?", "body": "<p>I am not sure when to use RWMutex and when to use Mutex.</p>\n\n<p>Do you save resources if you use RWMutex instead of Mutex if you do more reads then writes?</p>\n\n<p>I see some people use Mutex all the time no matter what they do, and some use RWMutex and run these methods:</p>\n\n<pre><code>func (rw *RWMutex) Lock()\nfunc (rw *RWMutex) Unlock()\nfunc (rw *RWMutex) RLock()\nfunc (rw *RWMutex) RUnlock()\n</code></pre>\n\n<p>instead of just:</p>\n\n<pre><code>func (m *Mutex) Lock()\nfunc (m *Mutex) Unlock()\n</code></pre>\n\n<p>If you save resources, is it that much of a difference that you should use RWMutex if you do more reads then writes?</p>\n"}, {"tags": ["function", "go", "interface", "stdout"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1598318499, "post_id": 48859574, "comment_id": 112413190, "body": "It may be worth noting that APIs that take in a one-method <code>interface</code> could be re-written as taking a function type. See <a href=\"https://stackoverflow.com/a/63557675/12817546\">stackoverflow.com/a/63557675/12817546</a>."}], "answers": [{"tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": true, "score": 2, "last_activity_date": 1519014976, "creation_date": 1519014976, "answer_id": 48859586, "question_id": 48859574, "link": "https://stackoverflow.com/questions/48859574/understanding-interfaces-in-golang/48859586#48859586", "title": "Understanding interfaces in Golang", "body": "<p>You are not printing the result. Change the main to</p>\n\n<pre><code>func main() {\n    var Dog Animal = Animal{\n        Name:    \"Dog\",\n        Ability: \"Walk\",\n    }\n\n    fmt.Println(Dog.ShowAbility())\n}\n</code></pre>\n\n<p>FYI: fmt.Sprintf() returns a string and doesn't print it to standard output</p>\n\n<blockquote>\n  <p>// Sprintf formats according to a format specifier and returns the\n  resulting string.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 56, "user_id": 7988812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/183e4d385aa3c876088a92362ee5b6fd?s=128&d=identicon&r=PG&f=1", "display_name": "Moige", "link": "https://stackoverflow.com/users/7988812/moige"}, "edited": false, "score": 0, "creation_date": 1519016962, "post_id": 48859603, "comment_id": 84722991, "body": "This cause an &quot;too many arguments returns&quot; because <code>Printf</code> return an <code>(int, error)</code> and my function want only an <code>string</code>."}, {"owner": {"reputation": 4554, "user_id": 192221, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/38504ff52422b72b239a7b05ef0ccaae?s=128&d=identicon&r=PG", "display_name": "kristianp", "link": "https://stackoverflow.com/users/192221/kristianp"}, "reply_to_user": {"reputation": 56, "user_id": 7988812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/183e4d385aa3c876088a92362ee5b6fd?s=128&d=identicon&r=PG&f=1", "display_name": "Moige", "link": "https://stackoverflow.com/users/7988812/moige"}, "edited": false, "score": 0, "creation_date": 1519017772, "post_id": 48859603, "comment_id": 84723155, "body": "I removed the &#39;return&#39; statement (and the return type) from ShowAbility(), which is why that error doesn&#39;t occur in my code above."}], "tags": [], "owner": {"reputation": 4554, "user_id": 192221, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/38504ff52422b72b239a7b05ef0ccaae?s=128&d=identicon&r=PG", "display_name": "kristianp", "link": "https://stackoverflow.com/users/192221/kristianp"}, "is_accepted": false, "score": 0, "last_activity_date": 1519015088, "creation_date": 1519015088, "answer_id": 48859603, "question_id": 48859574, "link": "https://stackoverflow.com/questions/48859574/understanding-interfaces-in-golang/48859603#48859603", "title": "Understanding interfaces in Golang", "body": "<p>You are returning a string from the ShowAbility method, but not outputting it.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Animal struct {\n    Name    string\n    Ability string\n}\n\ntype AbilityShower interface {\n    ShowAbility() \n}\n\nfunc (a Animal) ShowAbility() {\n    fmt.Printf(\"%s can %s\", a.Name, a.Ability)\n}\n\nfunc main() {\n   var Dog Animal = Animal{\n       Name:    \"Dog\",\n       Ability: \"Walk\",\n   }\n\n   Dog.ShowAbility()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1519032125, "creation_date": 1519032125, "answer_id": 48862865, "question_id": 48859574, "link": "https://stackoverflow.com/questions/48859574/understanding-interfaces-in-golang/48862865#48862865", "title": "Understanding interfaces in Golang", "body": "<p>Here you are using <code>fmt.Sprintf</code> which actually works like <code>Scanf</code> returning value. You need to assign that value to a variable and print the output.</p>\n\n<pre><code>func main() {\n    var Dog Animal = Animal{\n        Name:    \"Dog\",\n        Ability: \"Walk\",\n    }\n\n    output := Dog.ShowAbility()\n    fmt.Println(output)\n}\n</code></pre>\n\n<p>If you wants to print when calling the function <code>ShowAbility()</code> you can use <code>Printf</code> function of <code>fmt</code> package.</p>\n\n<pre><code>func (a Animal) ShowAbility() {\n    fmt.Printf(\"%s can %s\", a.Name, a.Ability)\n}\n\nfunc main() {\n    var Dog Animal = Animal{\n        Name:    \"Dog\",\n        Ability: \"Walk\",\n    }\n\n    Dog.ShowAbility()\n}\n</code></pre>\n"}], "owner": {"reputation": 56, "user_id": 7988812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/183e4d385aa3c876088a92362ee5b6fd?s=128&d=identicon&r=PG&f=1", "display_name": "Moige", "link": "https://stackoverflow.com/users/7988812/moige"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 1, "accepted_answer_id": 48859586, "answer_count": 3, "score": 1, "last_activity_date": 1519033306, "creation_date": 1519014812, "last_edit_date": 1519033306, "question_id": 48859574, "link": "https://stackoverflow.com/questions/48859574/understanding-interfaces-in-golang", "title": "Understanding interfaces in Golang", "body": "<p>I'm trying to understand interfaces in Go. I wrote this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Animal struct {\n    Name    string\n    Ability string\n}\n\ntype AbilityShower interface {\n    ShowAbility() string\n}\n\nfunc (a Animal) ShowAbility() string {\n    return fmt.Sprintf(\"%s can %s\", a.Name, a.Ability)\n}\n\nfunc main() {\n    var Dog Animal = Animal{\n        Name:    \"Dog\",\n        Ability: \"Walk\",\n    }\n\n    Dog.ShowAbility()\n}\n</code></pre>\n\n<p>But when I run with <code>go run main.go</code> nothing appears in the console. What am I doing incorrectly?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 4, "creation_date": 1519011145, "post_id": 48858771, "comment_id": 84721742, "body": "&quot;What do the specs say?&quot; Read <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a>."}, {"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1519230225, "post_id": 48858771, "comment_id": 84827634, "body": "@peterSO, it&#39;s Google&#39;s fault, I googled , but didn&#39;t get the results"}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1519018000, "post_id": 48858812, "comment_id": 84723205, "body": "Worth noting here that <code>range</code> over /maps/ is intentionally nondeterministically ordered."}], "tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 5, "last_activity_date": 1519007355, "creation_date": 1519007355, "answer_id": 48858812, "question_id": 48858771, "link": "https://stackoverflow.com/questions/48858771/does-the-range-operator-guarantees-order/48858812#48858812", "title": "does the range operator guarantees order?", "body": "<p>For a slice it is guaranteed by the spec</p>\n\n<blockquote>\n  <p>For an array, pointer to array, or slice value a, the index iteration values are produced in increasing order, starting at element index 0. If at most one iteration variable is present, the range loop produces iteration values from 0 up to len(a)-1 and does not index into the array or slice itself. For a nil slice, the number of iterations is 0.</p>\n</blockquote>\n\n<p>Reference:</p>\n\n<ul>\n<li><a href=\"https://golang.org/ref/spec#For_range\" rel=\"noreferrer\">https://golang.org/ref/spec#For_range</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 1550609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UrxOq.jpg?s=128&g=1", "display_name": "rubynaut", "link": "https://stackoverflow.com/users/1550609/rubynaut"}, "is_accepted": false, "score": 0, "last_activity_date": 1519123774, "creation_date": 1519123774, "answer_id": 48883511, "question_id": 48858771, "link": "https://stackoverflow.com/questions/48858771/does-the-range-operator-guarantees-order/48883511#48883511", "title": "does the range operator guarantees order?", "body": "<p>You do not \"concatenate into an array with an append()\" \u2013 you append() to slices ([3]S vs. []S). </p>\n\n<blockquote>\n  <p>If the capacity of slice is not large enough to fit the additional values,\n  append allocates a new, sufficiently large underlying array that fits\n  both the existing slice elements and the additional values. Otherwise,\n  append re-uses the underlying array.</p>\n</blockquote>\n\n<p>The originating array may thus not contain all elements appended.</p>\n"}], "owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1142, "favorite_count": 0, "accepted_answer_id": 48858812, "answer_count": 2, "score": -4, "last_activity_date": 1519123774, "creation_date": 1519006924, "question_id": 48858771, "link": "https://stackoverflow.com/questions/48858771/does-the-range-operator-guarantees-order", "title": "does the range operator guarantees order?", "body": "<p>Let's say , I am concatenating structs into an array with an <code>append()</code> call. Will the <strong>range</strong> operator during the read process guarantee the same order as elements were added to the array? </p>\n\n<pre><code>var array_of_structs []*some_struct_t\nbuild_array(&amp;array_of_structs)\nfor i,value := range array_of_structs {\n    ..whatever, but I need `i` to be i=0,1,2... N in an ordered way\n}\n</code></pre>\n\n<p>What do the specs say? I am going to calculate money, so I need to be sure it is ordered.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1519001132, "post_id": 48858151, "comment_id": 84719848, "body": "<code>switch</code> accepts an arbitrary value. It does not care what expression evaluates to that value."}, {"owner": {"reputation": 11, "user_id": 9277357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5e0ee9f81c6ee483239e92544fc46?s=128&d=identicon&r=PG&f=1", "display_name": "h3llflee7", "link": "https://stackoverflow.com/users/9277357/h3llflee7"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1519002368, "post_id": 48858151, "comment_id": 84720047, "body": "for example <code>switch post_data.Action() </code> causes this <code>cannot call non-function post_data.Action (type string)</code>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1519002489, "post_id": 48858151, "comment_id": 84720068, "body": "that&#39;s because <code>post_data.Action</code> is not a function. <a href=\"https://tour.golang.org/flowcontrol/9\" rel=\"nofollow noreferrer\">tour.golang.org/flowcontrol/9</a>"}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 1, "creation_date": 1519025386, "post_id": 48858151, "comment_id": 84725555, "body": "Why do you put parentheses after <code>Action</code>? That&#39;s just a field, not a method. So use <code>switch post_data.Action {</code>"}, {"owner": {"reputation": 92, "user_id": 2131647, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/HcC92.jpg?s=128&g=1", "display_name": "TheROX", "link": "https://stackoverflow.com/users/2131647/therox"}, "edited": false, "score": 0, "creation_date": 1519055936, "post_id": 48858151, "comment_id": 84743297, "body": "Unmarshal json to map, not struct, and switch through keys or values."}], "answers": [{"tags": [], "owner": {"reputation": 330, "user_id": 2785084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86f8856e60ee8e027677ce584772077d?s=128&d=identicon&r=PG&f=1", "display_name": "autlunatic", "link": "https://stackoverflow.com/users/2785084/autlunatic"}, "is_accepted": false, "score": 0, "last_activity_date": 1519065822, "last_edit_date": 1519065822, "creation_date": 1519019657, "answer_id": 48860230, "question_id": 48858151, "link": "https://stackoverflow.com/questions/48858151/how-to-use-switch-in-go-with-json-keys/48860230#48860230", "title": "How to use switch in GO with json keys?", "body": "<p>I am not sure what you want to switch, but i think that you just need to erase the () so Action is not a function call anymore</p>\n\n<p>Be careful maybe your error is that u mixed up the strings \nin JSON: \"do_something\"\nin case: \"some_thing\"</p>\n\n<p>You can copy following code to playground</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strings\"\n)\n\ntype some_json struct {\n    Action string `json:\"action\"`\n    Id     string `json:\"id\"`\n}\n\nfunc jsonparse() {\n    r := strings.NewReader(\"{\\\"action\\\":\\\"do_something\\\",\\\"id\\\":\\\"001\\\"}\")\n    decoder := json.NewDecoder(r)\n\n    var post_data some_json\n    err := decoder.Decode(&amp;post_data)\n\n    if err != nil {\n        panic(err)\n    }\n\n    switch post_data.Action {\n    default:\n        fmt.Println( \"WRONG PARAM\")\n    case \"do_something\":\n        fmt.Println( post_data.Id+\"\\n\\n\")\n    }\n}\n\nfunc main() {\n    jsonparse()\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 9277357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56e5e0ee9f81c6ee483239e92544fc46?s=128&d=identicon&r=PG&f=1", "display_name": "h3llflee7", "link": "https://stackoverflow.com/users/9277357/h3llflee7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1519065822, "creation_date": 1519000269, "question_id": 48858151, "link": "https://stackoverflow.com/questions/48858151/how-to-use-switch-in-go-with-json-keys", "title": "How to use switch in GO with json keys?", "body": "<p>Here is an example of POST request body:</p>\n\n<pre><code>{\"action\":\"do_something\",\"id\":\"001\"}\n</code></pre>\n\n<p>I took an example of simple json parser </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n)\n\ntype some_json struct {\n    Action string `json:\"action\"`\n    Id string `json:\"id\"`\n\n}\n\nfunc jsonparse(rw http.ResponseWriter, request *http.Request) {\n    decoder := json.NewDecoder(request.Body)\n\n    var post_data some_json\n    err := decoder.Decode(&amp;post_data)\n\n    if err != nil {\n        panic(err)\n    }\n\n\n    switch ***WHAT_SHOULD_BE_HERE???*** {\n    default :\n      fmt.Fprintf(w,\"WRONG PARAM\")\n    case \"some_thing\":\n      fmt.Fprintf(w,post_data.Id + \"\\n\\n\")\n            }\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", jsonparse)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>I already know how to switch cases from form values, but\nhow to switch cases of json key values?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 1, "creation_date": 1518994374, "post_id": 48857366, "comment_id": 84718488, "body": "One way to do it is to merge the channels into one and range over it. See the <code>fan-in</code> example <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">here</a>"}], "answers": [{"tags": [], "owner": {"reputation": 750, "user_id": 2947756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qpCxL.png?s=128&g=1", "display_name": "xReprisal", "link": "https://stackoverflow.com/users/2947756/xreprisal"}, "is_accepted": false, "score": 1, "last_activity_date": 1518994333, "creation_date": 1518994333, "answer_id": 48857467, "question_id": 48857366, "link": "https://stackoverflow.com/questions/48857366/select-all-values-from-multiple-channels-when-channel-ready/48857467#48857467", "title": "Select all values from multiple channels when channel ready", "body": "<p>Select does not wait for go routines. To achieve that you should wrap it in <code>for</code> statement. In this way <code>select</code> will be running until one of the cases returns and breaks out of <code>for</code> statement.</p>\n\n<pre><code>for {\n   select {\n      ...\n</code></pre>\n\n<p>You can also use buffered channels which are non-blocking and wait groups. Like this:</p>\n\n<pre><code>arr1 := []int8{1,2,3,4,5}\narr2 := []int8{6,7,8,9,10}\n\nc1 := make(chan int8, len(arr1))\nc2 := make(chan int8, len(arr2))\n\nvar wg sync.WaitGroup\n\nwg.Add(1) // First wait group\ngo func() {\n    for _, val := range arr1 {\n        time.Sleep(time.Duration(rand.Intn(100)) * time.Millisecond)\n        c1 &lt;- val\n    }\n    wg.Done()\n}()\n\nwg.Add(1) // Second wait group\ngo func() {\n    for _, val := range arr2 {\n        time.Sleep(time.Duration(rand.Intn(100)) * time.Millisecond)\n        c2 &lt;- val\n    }\n    wg.Done()\n}()\n\n// executed after wg.Done() is called 2 times since we have 2 wait groups\nwg.Wait() \n\n// We are not writing to channels anymore so we can close them.\nclose(c1)\nclose(c2)\n\nfor value := range c1 {\n    fmt.Println(value)\n}\n\nfor value := range c2 {\n    fmt.Println(value)\n}\n\n\nfmt.Println(\"Hello, test\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7927, "user_id": 5214807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aq31b.jpg?s=128&g=1", "display_name": "Saleem", "link": "https://stackoverflow.com/users/5214807/saleem"}, "is_accepted": true, "score": 4, "last_activity_date": 1519036788, "last_edit_date": 1519036788, "creation_date": 1518999429, "answer_id": 48858051, "question_id": 48857366, "link": "https://stackoverflow.com/questions/48857366/select-all-values-from-multiple-channels-when-channel-ready/48858051#48858051", "title": "Select all values from multiple channels when channel ready", "body": "<p>You have to do couple of things. </p>\n\n<p>1) Make sure you close channels once you are done with source.\n2) Iterate over channels until it's closed.</p>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    arr1 := []int8{1, 2, 3, 4, 5}\n    arr2 := []int8{6, 7, 8, 9, 10}\n\n    c1 := make(chan int8)\n    c2 := make(chan int8)\n\n    go func() {\n        for _, val := range arr1 {\n            time.Sleep(time.Duration(rand.Intn(100)) * time.Millisecond)\n            c1 &lt;- val\n        }\n        close(c1)\n    }()\n    go func() {\n        for _, val := range arr2 {\n            time.Sleep(time.Duration(rand.Intn(100)) * time.Millisecond)\n            c2 &lt;- val\n        }\n        close(c2)\n    }()\n\n    _c1 := true\n    _c2 := true\n    var res1, res2 int8\n\n    for _c1 == true || _c2 == true {\n        select {\n        case res1, _c1 = &lt;-c1:\n            if _c1 == true {\n                fmt.Println(res1)\n            }\n        case res2, _c2 = &lt;-c2:\n            if _c2 == true {\n                fmt.Println(res2)\n            }\n        }\n    }\n\n    fmt.Println(\"Hello, test\")\n}\n</code></pre>\n\n<p>On execution, I got following output on screen.</p>\n\n<pre><code>6\n1\n7\n2\n3\n4\n8\n5\n9\n10\nHello, test\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1496, "user_id": 4374970, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/mVn41.jpg?s=128&g=1", "display_name": "mfathirirhas", "link": "https://stackoverflow.com/users/4374970/mfathirirhas"}, "is_accepted": false, "score": 2, "last_activity_date": 1519108235, "creation_date": 1519108235, "answer_id": 48879183, "question_id": 48857366, "link": "https://stackoverflow.com/questions/48857366/select-all-values-from-multiple-channels-when-channel-ready/48879183#48879183", "title": "Select all values from multiple channels when channel ready", "body": "<p>You don't have to use 2 channels. Just use 1 channel and store values into it from multiple goroutines. Channel is lightweight thread connector that is fast and can be instantiated multiple times to store values from multiple goroutines. </p>\n\n<p>The problem with your code is that it has no loop to loop over values from goroutines channel. You only print it once using select. <code>select</code> makes other goroutines wait until it executes one of possible cases it has. If all of the cases are possible, then it selects randomly to executes. </p>\n\n<p>The reason you only got one value from your channel is because when your goroutines are working, they store values from the array to channel sequentially. while this happen, you call <code>select</code> statement in your main thread with the cases to get the values from the channel in your goroutines. Since you don't loop over the channels, you'll only get one value from the channel which is the value it firstly received. In this case, you loop array sequentially into channel in your goroutines, hence you'll get the first index of the array since it's the value that will be firstly sent to select statement in main thread. All of your select cases are possible to be executed, hence it will execute one of the case randomly and you'll get first index in one of those arrays.</p>\n\n<p>To fix this, you need to loop over the channel to get the values stored in it one by one. Beside, you also need to synchronize all the threads in order to avoid deadlock conditions, which is happened when your main thread doesn't know when to stop invoking channel from goroutines since they work asynchronously. Your channel is ready to spit the value right after it gets its value inside goroutines and invoked into main thread in loop. Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"math/rand\"\n    \"sync\"\n)\n\n// writer set numbers from array to channel\nfunc writer(ch chan int, arr []int ,wgwrite *sync.WaitGroup) {\n    defer wgwrite.Done()\n    for _, val := range arr {\n        time.Sleep(time.Duration(rand.Intn(100)) * time.Millisecond)\n        ch &lt;- val\n    }\n}\n\n// reader receive input from writer channels and print them all \nfunc reader(ch chan int, wgread *sync.WaitGroup) {\n  defer wgread.Done()\n  for i:= range ch {\n    fmt.Println(i)\n  }\n  fmt.Println(\"Hello, test\")\n}\n\nfunc main() {\n    arr1 := []int{1,2,3,4,5}\n    arr2 := []int{6,7,8,9,10}\n    ch := make(chan int)\n    wgwrite := &amp;sync.WaitGroup{}\n    wgread  := &amp;sync.WaitGroup{}\n\n    wgwrite.Add(2)\n    go writer(ch, arr1, wgwrite)\n    go writer(ch, arr2, wgwrite)\n\n    wgread.Add(1)\n    go reader(ch, wgread)\n\n    wgwrite.Wait()\n    close(ch)\n    wgread.Wait()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/32Fgetq_Zu7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/32Fgetq_Zu7</a></p>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 878, "favorite_count": 0, "accepted_answer_id": 48858051, "answer_count": 3, "score": 0, "last_activity_date": 1519108235, "creation_date": 1518993495, "question_id": 48857366, "link": "https://stackoverflow.com/questions/48857366/select-all-values-from-multiple-channels-when-channel-ready", "title": "Select all values from multiple channels when channel ready", "body": "<p>I'm new in <code>golang</code> and I faced with the problem.</p>\n\n<p>I have several <code>channel</code>s. </p>\n\n<p>Some payload gets to this channels in different time. </p>\n\n<p>How I can get all values one by one from channels in the time when channel ready to spit it. </p>\n\n<p>For example I wrote this code:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"time\"\n    \"math/rand\"\n)\n\nfunc main() {\n    arr1 := []int8{1,2,3,4,5}\n    arr2 := []int8{6,7,8,9,10}\n\n    c1 := make(chan int8)\n    c2 := make(chan int8)\n\n    go func() {\n        for _, val := range arr1 {\n            time.Sleep(time.Duration(rand.Intn(100)) * time.Millisecond)\n            c1 &lt;- val\n        }\n    }()\n    go func() {\n        for _, val := range arr2 {\n            time.Sleep(time.Duration(rand.Intn(100)) * time.Millisecond)\n            c2 &lt;- val\n        }\n    }()\n\n    select {\n        case res1 := &lt;- c1:\n            fmt.Println(res1)\n        case res2 := &lt;- c2:\n            fmt.Println(res2)\n    }\n\n    fmt.Println(\"Hello, test\")\n}\n</code></pre>\n\n<p>But in this case, I get only first value, from one of the channels.</p>\n\n<p>Please, give me advise how to solve my issue.</p>\n\n<p>Link to go-play <a href=\"https://play.golang.org/p/FOmkP57YCyR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/FOmkP57YCyR</a></p>\n"}, {"tags": ["go", "zip"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1518989919, "post_id": 48856749, "comment_id": 84717258, "body": "Thanks, I&#39;ve check it and I get the same structure as before i.e. the <code>ui</code> folder is still exist when checking the zip&#39;s , do you have another idea?"}, {"owner": {"reputation": 1837, "user_id": 381849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d44bcf5700e4fcb934221db2dab496?s=128&d=identicon&r=PG", "display_name": "KAdot", "link": "https://stackoverflow.com/users/381849/kadot"}, "edited": false, "score": 0, "creation_date": 1518990500, "post_id": 48856749, "comment_id": 84717417, "body": "@Ninawatcher hm, are you sure about that? Just checked on my computer and the zip didn&#39;t have directories (I checked using <code>unzip -l</code>)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "edited": false, "score": 0, "creation_date": 1519014499, "post_id": 48856749, "comment_id": 84722480, "body": "Can you please provide the all code that you use , maybe I miss something?"}], "tags": [], "owner": {"reputation": 1837, "user_id": 381849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d44bcf5700e4fcb934221db2dab496?s=128&d=identicon&r=PG", "display_name": "KAdot", "link": "https://stackoverflow.com/users/381849/kadot"}, "is_accepted": true, "score": 0, "last_activity_date": 1518989088, "creation_date": 1518989088, "answer_id": 48856749, "question_id": 48856557, "link": "https://stackoverflow.com/questions/48856557/create-zip-file-without-headers/48856749#48856749", "title": "Create zip file without headers", "body": "<p>It looks like you need to skip adding directories to the zip file header, every time you see a directory in the <code>filepath.Walk</code> callback just skip it:\n</p>\n\n<pre><code>filepath.Walk(params[0], func(path string, info os.FileInfo, err error) error {\n    if err != nil {\n        return err\n    }\n\n    // I moved this check to the beginning of the callback.\n    if info.IsDir() {\n        return nil\n    }\n\n    header, err := zip.FileInfoHeader(info)\n    if err != nil {\n        return err\n    }\n\n    if baseDir != \"\" {\n        header.Name = filepath.Join(strings.TrimPrefix(path, params[0]))\n    }\n\n    header.Method = zip.Deflate\n\n    writer, err := archive.CreateHeader(header)\n    if err != nil {\n        return err\n    }\n\n    file, err := os.Open(path)\n    if err != nil {\n        return err\n    }\n    defer file.Close()\n    _, err = io.Copy(writer, file)\n    return err\n})\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 521, "favorite_count": 0, "accepted_answer_id": 48856749, "answer_count": 1, "score": 0, "last_activity_date": 1519014568, "creation_date": 1518987939, "last_edit_date": 1519014568, "question_id": 48856557, "link": "https://stackoverflow.com/questions/48856557/create-zip-file-without-headers", "title": "Create zip file without headers", "body": "<p>I\u2019ve two zip\u2019s ,and I use a zip command to check the difference between the two zip,<code>\n    diff -y (unzip -l old.zip | psub) (unzip -l new.zip | psub)</code>\nI need them to be exactly the same</p>\n\n<p>First created in <strong>old tool</strong> which look like this and it\u2019s OK</p>\n\n<pre><code> Length      Date    Time    Name                \n---------  ---------- -----   ----              \n      158         02-18-2018 12:26   META/MANI.MF        \n      153         02-18-2018 12:26   META/mt.yaml        \n  3956032         02-18-2018 12:26   ui/data.zip                    \n---------                     -------       ---------                    \n  3956343                     3 files                       \n</code></pre>\n\n<p>This is the zip with the <strong>new tool</strong> which look different</p>\n\n<pre><code>  Length      Date    Time    Name              \n---------  ---------- -----   ----               \n|           0  02-18-2018 20:37           ./\n|           0  02-18-2018 20:37           META/\n|         150  02-18-2018 20:37           META/MANI.MF\n&gt;         178  02-18-2018 20:37           META/mt.yaml\n&gt;           0  02-18-2018 20:37           ui/\n&gt;     3980703  02-18-2018 20:37           ui/data.zip\n</code></pre>\n\n<p>if we look at the ui folder (zip of the new tool) you see that in the new there is two entries </p>\n\n<blockquote>\n<pre><code>  ui/\n  ui/data.zip\n</code></pre>\n</blockquote>\n\n<p>And I need only the second as in the old tool, the file structure should be identical </p>\n\n<p>The logic to build it is like this</p>\n\n<blockquote>\n  <ol>\n  <li>during the program process I\u2019ve folder which is called `ui\u2019</li>\n  <li>I zip it with the function Zipit(see code below) on the level so I\u2019ve it like this\n      root\n        - ui\n        - ui.zip</li>\n  <li>then I remove the <code>ui</code> becouse I need just the zip and it contain a lot of files that not needed after the zip process</li>\n  <li>create new empty folder <code>ui</code>  os.MkdirAll(path, os.ModePerm)</li>\n  <li>Mmove the zip inside the new <code>ui</code> folder - os.Rename(path+\".zip\", path+\"/\"+\"data.zip\")</li>\n  </ol>\n</blockquote>\n\n<p>What am I doing wrong here ? I need the new structue will be inside the zip exactly the same </p>\n\n<pre><code>func Zipit(params ...string) error {\n\n\n    zipfile, err := os.Create(params[1])\n    if err != nil {\n        return err\n    }\n    defer zipfile.Close()\n\n    archive := zip.NewWriter(zipfile)\n    defer archive.Close()\n\n    info, err := os.Stat(params[0])\n    if err != nil {\n        return nil\n    }\n\n    var baseDir string\n    if info.IsDir(); len(params) &gt; 2 {\n        baseDir = params[2]\n    } else {\n        baseDir = filepath.Base(params[0])\n\n    }\n\n    filepath.Walk(params[0], func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n\n        header, err := zip.FileInfoHeader(info)\n        if err != nil {\n            return err\n        }\n\n        if baseDir != \"\" {\n            header.Name = filepath.Join(strings.TrimPrefix(path, params[0]))\n        }\n\n        if info.IsDir() {\n            header.Name += \"/\"\n        } else {\n            header.Method = zip.Deflate\n        }\n\n        writer, err := archive.CreateHeader(header)\n        if err != nil {\n            return err\n        }\n\n        if info.IsDir() {\n            return nil\n        }\n\n        file, err := os.Open(path)\n        if err != nil {\n            return err\n        }\n        defer file.Close()\n        _, err = io.Copy(writer, file)\n        return err\n    })\n\n    return err\n}\n\n\nto see the difference between the zip \n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1518988088, "post_id": 48856324, "comment_id": 84716685, "body": "I don&#39;t see anything obviously wrong with this. Are you sure the commands are producing output? Do you get any output at all?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519024871, "post_id": 48856324, "comment_id": 84725356, "body": "What is the actual output your program produces? Perhaps dropdb and createdb don&#39;t output anything on success (&quot;no news is good news&quot;)."}, {"owner": {"reputation": 1014, "user_id": 1049656, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/25dd8029a3c218350740ba595c00af09?s=128&d=identicon&r=PG", "display_name": "Matthieu", "link": "https://stackoverflow.com/users/1049656/matthieu"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1519052243, "post_id": 48856324, "comment_id": 84741035, "body": "@AndySchweig, I edited my question to provide output. My feeling is some race condition issue but tI have double check and the way I write my command it is expected the result of the command before proceeding to next lines."}, {"owner": {"reputation": 1014, "user_id": 1049656, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/25dd8029a3c218350740ba595c00af09?s=128&d=identicon&r=PG", "display_name": "Matthieu", "link": "https://stackoverflow.com/users/1049656/matthieu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519052295, "post_id": 48856324, "comment_id": 84741066, "body": "@Peter question edited with outputs (since when I only can mention one perosn on stackoverflow ? weird)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1519054717, "post_id": 48856324, "comment_id": 84742557, "body": "And what makes you think that this output is wrong? Does the database exist after you run your program? What output do you expect?"}, {"owner": {"reputation": 1014, "user_id": 1049656, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/25dd8029a3c218350740ba595c00af09?s=128&d=identicon&r=PG", "display_name": "Matthieu", "link": "https://stackoverflow.com/users/1049656/matthieu"}, "edited": false, "score": 0, "creation_date": 1519056270, "post_id": 48856324, "comment_id": 84743483, "body": "I am feeling really stupid right know.  I think I was so focused on being wrong, missing something with those new Pointers concept (for me) I didn&#39;t even see the obvious : it works. So it does output anything. The dropdb ou createdb tools does not output anything in case of success."}, {"owner": {"reputation": 1014, "user_id": 1049656, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/25dd8029a3c218350740ba595c00af09?s=128&d=identicon&r=PG", "display_name": "Matthieu", "link": "https://stackoverflow.com/users/1049656/matthieu"}, "edited": false, "score": 0, "creation_date": 1519056287, "post_id": 48856324, "comment_id": 84743489, "body": "Really sorry for the waste of time"}, {"owner": {"reputation": 1014, "user_id": 1049656, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/25dd8029a3c218350740ba595c00af09?s=128&d=identicon&r=PG", "display_name": "Matthieu", "link": "https://stackoverflow.com/users/1049656/matthieu"}, "edited": false, "score": 0, "creation_date": 1519056351, "post_id": 48856324, "comment_id": 84743541, "body": "I guess I&#39;ll have to recreate a stackoverflow account with an other name and avatar"}], "owner": {"reputation": 1014, "user_id": 1049656, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/25dd8029a3c218350740ba595c00af09?s=128&d=identicon&r=PG", "display_name": "Matthieu", "link": "https://stackoverflow.com/users/1049656/matthieu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1519052410, "creation_date": 1518986249, "last_edit_date": 1519052410, "question_id": 48856324, "link": "https://stackoverflow.com/questions/48856324/erratic-results-from-go-exec-cmd", "title": "erratic results from go exec cmd", "body": "<p>I am making my first steps in Go. I have a cli command that, for the time being, just drop and recreate a DB with go and Postgres dropdb + createdb tools.</p>\n\n<p>The following code produce inconsistent results. The checkout function print or do not print the \"out\" bytes variable. </p>\n\n<p>I am suspecting some race condition and that I should use pointers somewhere instead of passing values to the same function.</p>\n\n<p>Is this code that bad ?</p>\n\n<pre><code>func ensurepath(command string) string {\n    ensuredcommand, LookErr := exec.LookPath(command)\n    if LookErr != nil {\n        log.Fatalf(\"%v is not found\", command)\n    }\n    log.Printf(\"ensure path for command '%v' : %v\", command, ensuredcommand)\n    return command\n}\n\n// warning : cmd error message is also a \"out\" value, it is not in err\nfunc checkout(err error, out []byte) {\n    if err != nil {\n        log.Printf(\"command error %v : %s\", err, out)\n    } else {\n        log.Printf(\"command result %T : %s\", out, out)\n    }\n}\n\nvar restore = cli.Command{\n    Name:    \"restore\",\n    Aliases: []string{\"r\"},\n    Usage:   \"restore backup\",\n    Action: func(c *cli.Context) error {\n        cmdArgs := \"devdb\"\n        dropDB := ensurepath(\"dropdb\")\n        createDB := ensurepath(\"createdb\")\n\n        outErrDrop, err := exec.Command(dropDB, cmdArgs).CombinedOutput()\n        checkout(err, outErrDrop)\n\n        outErrCreate, createErr := exec.Command(createDB, cmdArgs).CombinedOutput()\n        checkout(createErr, outErrCreate)\n\n        return nil\n    },\n}\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>Example of weird output</p>\n\n<p>If I comment the lines corresponding to the \"createDB\" part, meaning I only drop the db I have a consistent and expected output.</p>\n\n<pre><code>var restore = cli.Command{\n    Name:    \"restore\",\n    Aliases: []string{\"r\"},\n    Usage:   \"restore backup\",\n    Action: func(c *cli.Context) error {\n        cmdArgs := \"devdb\"\n        dropDB := ensurepath(\"dropdb\")\n        //createDB := ensurepath(\"createdb\")\n\n        outErrDrop, err := exec.Command(dropDB, cmdArgs).CombinedOutput()\n        checkout(err, outErrDrop)\n\n        //outErrCreate, createErr := exec.Command(createDB, cmdArgs).CombinedOutput()\n        //checkout(createErr, outErrCreate)\n\n        return nil\n    },\n} \n//output\n2018/02/19 15:49:44 ensure path for command 'dropdb' : /usr/local/bin/dropdb\n2018/02/19 15:49:44 command error exit status 1 : dropdb: database removal failed: ERROR:  database \"devdb\" does not exist\n</code></pre>\n\n<p>But if introduce back the lines corresponding to the createdb part (exactly as my first code block above) I have the following result :</p>\n\n<pre><code>2018/02/19 15:53:11 ensure path for command 'dropdb' : /usr/local/bin/dropdb\n2018/02/19 15:53:11 ensure path for command 'createdb' : /usr/local/bin/createdb\n2018/02/19 15:53:11 command result []uint8 :\n2018/02/19 15:53:11 command result []uint8 :\n</code></pre>\n"}, {"tags": ["html", "go", "go-echo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1518985898, "post_id": 48856151, "comment_id": 84715945, "body": "What&#39;s the error ?"}, {"owner": {"reputation": 422, "user_id": 6037581, "user_type": "registered", "profile_image": "https://graph.facebook.com/462162247307331/picture?type=large", "display_name": "arundeepak", "link": "https://stackoverflow.com/users/6037581/arundeepak"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1518986144, "post_id": 48856151, "comment_id": 84716009, "body": "app/controllers/controllers.go:733:91: cannot use body (type error) as type string in field value   ... This is the error I am getting. @CeriseLim&#243;n"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518986751, "post_id": 48856151, "comment_id": 84716205, "body": "You are looking at the wrong line. The error is in the emailJob assignment. What is c? Presumably c.Render returns an error, not the rendered template."}, {"owner": {"reputation": 422, "user_id": 6037581, "user_type": "registered", "profile_image": "https://graph.facebook.com/462162247307331/picture?type=large", "display_name": "arundeepak", "link": "https://stackoverflow.com/users/6037581/arundeepak"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1518986945, "post_id": 48856151, "comment_id": 84716278, "body": "C is c echo.Context . And Render func has been mentioned in the details. And yes, I think you&#39;re correct, @Peter. It perhaps, executes the template."}], "answers": [{"comments": [{"owner": {"reputation": 422, "user_id": 6037581, "user_type": "registered", "profile_image": "https://graph.facebook.com/462162247307331/picture?type=large", "display_name": "arundeepak", "link": "https://stackoverflow.com/users/6037581/arundeepak"}, "edited": false, "score": 0, "creation_date": 1518987883, "post_id": 48856391, "comment_id": 84716616, "body": "Hi @maksadbek, thanks for having a look into the problem. I want that template to be returned as a string value. instead I am getting an error value. This is the problem. And render is registered with echo."}], "tags": [], "owner": {"reputation": 1137, "user_id": 2660766, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/qiIdj.png?s=128&g=1", "display_name": "maksadbek", "link": "https://stackoverflow.com/users/2660766/maksadbek"}, "is_accepted": true, "score": 1, "last_activity_date": 1518986678, "creation_date": 1518986678, "answer_id": 48856391, "question_id": 48856151, "link": "https://stackoverflow.com/questions/48856151/storing-html-template-as-text-field-in-db-using-golang/48856391#48856391", "title": "Storing html template as text field in DB using golang", "body": "<p>You are using <code>context.Render</code> method incorrectly.</p>\n\n<p><a href=\"https://github.com/labstack/echo/blob/master/context.go#L111\" rel=\"nofollow noreferrer\">https://github.com/labstack/echo/blob/master/context.go#L111</a></p>\n\n<pre><code>// Render renders a template with data and sends a text/html response with status\n// code. Renderer must be registered using `Echo.Renderer`.\nRender(code int, name string, data interface{}) error\n</code></pre>\n\n<p>The Render methods renders the template and sends it as a response.\nThis method returns an error value, if something unexpected happens, this error value is a description of it. Otherwise, it is equal to <code>nil</code>.\nSee: <a href=\"https://golang.org/pkg/errors/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/errors/</a></p>\n\n<p>In order to use Renderer, you must register it and you can use that <strong>registered renderer</strong> to get rendered template text and save it in DB.</p>\n\n<p>You can see example renderer in unit tests of Echo framework: <a href=\"https://github.com/labstack/echo/blob/master/context_test.go#L23\" rel=\"nofollow noreferrer\">https://github.com/labstack/echo/blob/master/context_test.go#L23</a></p>\n\n<p>Hope this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 422, "user_id": 6037581, "user_type": "registered", "profile_image": "https://graph.facebook.com/462162247307331/picture?type=large", "display_name": "arundeepak", "link": "https://stackoverflow.com/users/6037581/arundeepak"}, "is_accepted": false, "score": 1, "last_activity_date": 1519147327, "creation_date": 1519147327, "answer_id": 48890882, "question_id": 48856151, "link": "https://stackoverflow.com/questions/48856151/storing-html-template-as-text-field-in-db-using-golang/48890882#48890882", "title": "Storing html template as text field in DB using golang", "body": "<p>After doing a few things and understanding template in golang. \nI came up with a solution like this. </p>\n\n<pre><code>t, err := template.ParseFiles(\"templates/email/user_notify_email.html\")\n        if err != nil {\n            fmt.Println(\"Error happend\")\n            fmt.Println(err)\n            return c.JSON(http.StatusOK, data)\n        }\n        buf := new(bytes.Buffer)\n        if err = t.Execute(buf, visitingDetails); err != nil {\n            fmt.Println(err)\n        }\n        body := buf.String()\n</code></pre>\n\n<p>And now this body can be stored. Body has rendered template that I required. \nMuch credit goes to this article <a href=\"https://medium.com/@dhanushgopinath/sending-html-emails-using-templates-in-golang-9e953ca32f3d\" rel=\"nofollow noreferrer\">https://medium.com/@dhanushgopinath/sending-html-emails-using-templates-in-golang-9e953ca32f3d</a></p>\n"}], "owner": {"reputation": 422, "user_id": 6037581, "user_type": "registered", "profile_image": "https://graph.facebook.com/462162247307331/picture?type=large", "display_name": "arundeepak", "link": "https://stackoverflow.com/users/6037581/arundeepak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 909, "favorite_count": 0, "accepted_answer_id": 48856391, "answer_count": 2, "score": 0, "last_activity_date": 1521027135, "creation_date": 1518985203, "last_edit_date": 1521027135, "question_id": 48856151, "link": "https://stackoverflow.com/questions/48856151/storing-html-template-as-text-field-in-db-using-golang", "title": "Storing html template as text field in DB using golang", "body": "<p>I'm a beginner in Go and Echo. \nI am required to store a html template(email template) , which will also have some details passed as context. So that it can be stored into body column (text in MySQL) and will be triggered later. </p>\n\n<pre><code>if user.Email !=\"\"{\n            visitingDetails := H{\"user_name\"      : user.Fname,\n                                 \"location\"       : location.Name,\n                                 \"visitor_company\": visitor.Company,\n                                 \"visitor_name\"   : visitor.Fname +\" \"+visitor.Lname,\n                                 \"visitor_phone\"  : visitor.Phone,\n                                 \"visitor_email\"  : visitor.Email,\n                                 \"visitor_fname\"  : visitor.Fname,\n                                 \"visitor_image\"  : visitor.ProfilePicture,\n                              }\n            subject := visitor.Fname +\" has come to visit you at the reception\"\n            body := c.Render(http.StatusOK,\"email/user_notify_email.html\",visitingDetails)\n            emailJob := models.EmailJob{Recipients: visitor.Email , Subject: subject, Body: body}\n            db.Create(&amp;emailJob)\n            if db.NewRecord(emailJob){\n                fmt.Println(\"Unable to send email\")\n            }\n        }\n</code></pre>\n\n<p>The EmailJob</p>\n\n<pre><code>type EmailJob struct {\n    Id              int       \n    Recipients      string    \n    Subject         string   \n    Body            string          \n    Sent            int        \n    Error           string \n}\n\nfunc (t *Template) Render(w io.Writer, name string, data interface{}, c echo.Context) error {\n    return t.templates.ExecuteTemplate(w, name, data)\n}\n</code></pre>\n\n<p>body := c.Render(http.StatusOK,\"email/user_notify_email.html\",visitingDetails)</p>\n\n<p>this line gives error as it returns an error for render.\nI am not sure how I will I do it? I hope I made it clear. A little help will be much appreciated.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 1, "creation_date": 1518985837, "post_id": 48855520, "comment_id": 84715918, "body": "What does your go code report when run?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1518987054, "post_id": 48855520, "comment_id": 84716318, "body": "Are you sure that serverNEW.key is also the key for the client certificate? That seems odd. Servers would usually never disclose their key."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6039450, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/10207345164361709/picture?type=large", "display_name": "Miha Zoubek", "link": "https://stackoverflow.com/users/6039450/miha-zoubek"}, "edited": false, "score": 0, "creation_date": 1519027515, "post_id": 48857924, "comment_id": 84726456, "body": "I set <code>InsecureSkipVerify: fals</code> but it is stil the same. The client does not send certificate in response to request which requests client certificate for auth. <code>tlsConfig := &amp;tls.Config{ \t\tCertificates:       []tls.Certificate{cert}, \t\tRootCAs:            caCertPool, \t\tInsecureSkipVerify: false, \t} </code>"}], "tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": false, "score": 0, "last_activity_date": 1518999116, "last_edit_date": 1518999116, "creation_date": 1518998199, "answer_id": 48857924, "question_id": 48855520, "link": "https://stackoverflow.com/questions/48855520/issue-with-client-tls-authentication/48857924#48857924", "title": "Issue with client tls authentication", "body": "<p>You need to disable <code>InsecureSkipVerify</code> by setting <code>InsecureSkipVerify: false,</code></p>\n\n<p>It causes the chain arguments to be nil <a href=\"https://golang.org/pkg/crypto/tls/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/tls/</a></p>\n\n<blockquote>\n<pre><code>  // If normal verification is disabled by\n    // setting InsecureSkipVerify, or (for a server) when ClientAuth is\n    // RequestClientCert or RequireAnyClientCert, then this callback will\n    // be considered but the verifiedChains argument will always be nil.\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 43, "user_id": 6039450, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/10207345164361709/picture?type=large", "display_name": "Miha Zoubek", "link": "https://stackoverflow.com/users/6039450/miha-zoubek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 470, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1519003309, "creation_date": 1518980978, "last_edit_date": 1519003309, "question_id": 48855520, "link": "https://stackoverflow.com/questions/48855520/issue-with-client-tls-authentication", "title": "Issue with client tls authentication", "body": "<p>I have issue with client authentication via certificate in GoLang. From trace I see that server is requesting certificate but certificate is not send in client response.</p>\n\n<p><a href=\"https://i.stack.imgur.com/rcKas.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rcKas.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>Here is my Go code:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"bytes\"\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n\n    xml := `\n    &lt;Packet&gt;\n&lt;Header&gt;\n &lt;ID&gt;1231232132132354234&lt;/ID&gt;\n &lt;/Header&gt;\n &lt;Body&gt;\n &lt;Item&gt;\n &lt;Content&gt;SMS&lt;/Content&gt;\n &lt;Phone_no&gt;+123123213&lt;/Phone_no&gt;\n &lt;Content&gt;test&lt;/Content&gt;\n &lt;OriginAddress&gt;Posiljatelj&lt;/OriginAddress&gt;\n &lt;/Item&gt;\n &lt;/Body&gt;\n&lt;/Packet&gt;\n    `\n\n    // Load client cert\n    cert, err := tls.LoadX509KeyPair(\"../cert/certNEW.pem\", \"../cert/serverNEW.key\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Load CA cert\n    caCert, err := ioutil.ReadFile(\"../cert/cacerts.cer\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    caCertPool := x509.NewCertPool()\n    caCertPool.AppendCertsFromPEM(caCert)\n\n    // Setup HTTPS client\n    tlsConfig := &amp;tls.Config{\n        Certificates:       []tls.Certificate{cert},\n        RootCAs:            caCertPool,\n        InsecureSkipVerify: true,\n    }\n\n    tlsConfig.BuildNameToCertificate()\n    transport := &amp;http.Transport{TLSClientConfig: tlsConfig}\n    client := &amp;http.Client{Transport: transport}\n\n    resp, err := client.Post(\"https://api.url\", \"text/xml\", bytes.NewBuffer([]byte(xml)))\n\n    if err != nil {\n        fmt.Println(err)\n    }\n    contents, err := ioutil.ReadAll(resp.Body)\n    fmt.Printf(\"%s\\n\", string(contents))\n}\n</code></pre>\n\n<p>I got pfx certificate from client, what i did is that I extraceted public client certificate, private certificate and rootRA public part and I assrted in Go code.</p>\n"}, {"tags": ["authentication", "go", "keycloak"], "comments": [{"owner": {"reputation": 15334, "user_id": 3348604, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QybjW.jpg?s=128&g=1", "display_name": "Jan Garaj", "link": "https://stackoverflow.com/users/3348604/jan-garaj"}, "edited": false, "score": 2, "creation_date": 1519025377, "post_id": 48855122, "comment_id": 84725553, "body": "It seems to me that it&#39;s a question for project maintainers - how to use their projects. IMHO top project is <a href=\"https://github.com/gambol99/keycloak-proxy\" rel=\"nofollow noreferrer\">github.com/gambol99/keycloak-proxy</a> - it&#39;s not an adaptor, but it&#39;s an auth proxy. It&#39;s not keycloak only, but it&#39;s OIDC auth proxy (GitHub, Google, ...)."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1531997827, "post_id": 48855122, "comment_id": 89812601, "body": "I found <a href=\"http://lists.jboss.org/pipermail/keycloak-dev/2017-May/009294.html\" rel=\"nofollow noreferrer\">this</a> on the web while searching, it might help. From this mailing list, it is suggested that <a href=\"https://github.com/markbates/goth\" rel=\"nofollow noreferrer\">goth</a> can be used"}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1532064533, "post_id": 48855122, "comment_id": 89841191, "body": "<a href=\"https://github.com/coreos/go-oidc\" rel=\"nofollow noreferrer\">go-oidc</a> is also pretty good"}], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 5580311, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-clkYgyz3f0U/AAAAAAAAAAI/AAAAAAAAAEc/BrJiRQ6I-1s/photo.jpg?sz=128", "display_name": "Ramon Rambo", "link": "https://stackoverflow.com/users/5580311/ramon-rambo"}, "edited": false, "score": 1, "creation_date": 1562135973, "post_id": 51456282, "comment_id": 100277461, "body": "Thank you for your example, it helped me a lot! Maybe it is a bit misleading, because there are a lot of different tokens being used, but I struggled with the last step. I think the <code>TOKEN</code> variable should be filled with the value of the <code>rawIDToken</code> string, <i>not</i> with the <code>access_token</code> from the oauth2token. When I use the <code>rawIDToken</code> it does work, with the <code>access_token</code> it did not."}], "tags": [], "owner": {"reputation": 2427, "user_id": 3788261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d14c68ce6c53d9f94656f04bb750300?s=128&d=identicon&r=PG&f=1", "display_name": "ShrimpPhaser", "link": "https://stackoverflow.com/users/3788261/shrimpphaser"}, "is_accepted": true, "score": 38, "last_activity_date": 1572897180, "last_edit_date": 1572897180, "creation_date": 1532177578, "answer_id": 51456282, "question_id": 48855122, "link": "https://stackoverflow.com/questions/48855122/keycloak-adaptor-for-golang-application/51456282#51456282", "title": "Keycloak adaptor for golang application", "body": "<p>As you have pointed out, there is no official keycloak adapter for golang.\nBut it is pretty straight forward to implement it. Here is a little walk through.</p>\n\n<h2>Keycloak server</h2>\n\n<p>For this example, I will use the official keycloak docker image to start the server.\nThe version used is 4.1.0.Final. I think this will work with older KeyCloak versions too though.</p>\n\n<pre><code>docker run -d -p 8080:8080 -e KEYCLOAK_USER=keycloak -e KEYCLOAK_PASSWORD=k --name keycloak jboss/keycloak:4.1.0.Final\n</code></pre>\n\n<p>After the server is up and running, you can open <code>localhost:8080/auth</code> in your browser, navigate to the administration console and login with username <code>keycloak</code> and <code>k</code> as the corresponding password.</p>\n\n<p>I will not go through the complete process of creating a realm/clients/users. You can look this up under \n<a href=\"https://www.keycloak.org/docs/latest/server_admin/index.html#admin-console\" rel=\"noreferrer\">https://www.keycloak.org/docs/latest/server_admin/index.html#admin-console</a></p>\n\n<p>Here is just an outline for what I did to reproduce this example:</p>\n\n<ol>\n<li>create a realm named <code>demo</code></li>\n<li>turn off the requirement of ssl for this realm (realmsettings -> login -> require ssl) </li>\n<li>create a client named <code>demo-client</code> (change the \"Access Type\" to confidential)</li>\n<li>create a user named demo with password demo (users -> add user). Make sure to activate and impersonate this user.</li>\n<li>configure the demo-client to be confidential and use <code>http://localhost:8181/demo/callback</code> as a valid redirect URI.</li>\n</ol>\n\n<p>The resulting keycloak.json (obtained from the installation tab) looks like this:</p>\n\n<pre><code>{\n    \"realm\": \"demo\",\n    \"auth-server-url\": \"http://localhost:8080/auth\",\n    \"ssl-required\": \"none\",\n    \"resource\": \"demo-client\",\n    \"credentials\": {\n        \"secret\": \"cbfd6e04-a51c-4982-a25b-7aaba4f30c81\"\n    },\n    \"confidential-port\": 0\n}\n</code></pre>\n\n<p>Beware that your secret will be different though. </p>\n\n<h2>The Go Server</h2>\n\n<p>Let's go over to the go server. I use the <code>github.com/coreos/go-oidc</code> package for the heavy lifting:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n\n    oidc \"github.com/coreos/go-oidc\"\n    \"golang.org/x/oauth2\"\n)\n\nfunc main() {\n    configURL := \"http://localhost:8080/auth/realms/demo\"\n    ctx := context.Background()\n    provider, err := oidc.NewProvider(ctx, configURL)\n    if err != nil {\n        panic(err)\n    }\n\n    clientID := \"demo-client\"\n    clientSecret := \"cbfd6e04-a51c-4982-a25b-7aaba4f30c81\"\n\n    redirectURL := \"http://localhost:8181/demo/callback\"\n    // Configure an OpenID Connect aware OAuth2 client.\n    oauth2Config := oauth2.Config{\n        ClientID:     clientID,\n        ClientSecret: clientSecret,\n        RedirectURL:  redirectURL,\n        // Discovery returns the OAuth2 endpoints.\n        Endpoint: provider.Endpoint(),\n        // \"openid\" is a required scope for OpenID Connect flows.\n        Scopes: []string{oidc.ScopeOpenID, \"profile\", \"email\"},\n    }\n    state := \"somestate\"\n\n    oidcConfig := &amp;oidc.Config{\n        ClientID: clientID,\n    }\n    verifier := provider.Verifier(oidcConfig)\n\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        rawAccessToken := r.Header.Get(\"Authorization\")\n        if rawAccessToken == \"\" {\n            http.Redirect(w, r, oauth2Config.AuthCodeURL(state), http.StatusFound)\n            return\n        }\n\n        parts := strings.Split(rawAccessToken, \" \")\n        if len(parts) != 2 {\n            w.WriteHeader(400)\n            return\n        }\n        _, err := verifier.Verify(ctx, parts[1])\n\n        if err != nil {\n            http.Redirect(w, r, oauth2Config.AuthCodeURL(state), http.StatusFound)\n            return\n        }\n\n        w.Write([]byte(\"hello world\"))\n    })\n\n    http.HandleFunc(\"/demo/callback\", func(w http.ResponseWriter, r *http.Request) {\n        if r.URL.Query().Get(\"state\") != state {\n            http.Error(w, \"state did not match\", http.StatusBadRequest)\n            return\n        }\n\n        oauth2Token, err := oauth2Config.Exchange(ctx, r.URL.Query().Get(\"code\"))\n        if err != nil {\n            http.Error(w, \"Failed to exchange token: \"+err.Error(), http.StatusInternalServerError)\n            return\n        }\n        rawIDToken, ok := oauth2Token.Extra(\"id_token\").(string)\n        if !ok {\n            http.Error(w, \"No id_token field in oauth2 token.\", http.StatusInternalServerError)\n            return\n        }\n        idToken, err := verifier.Verify(ctx, rawIDToken)\n        if err != nil {\n            http.Error(w, \"Failed to verify ID Token: \"+err.Error(), http.StatusInternalServerError)\n            return\n        }\n\n        resp := struct {\n            OAuth2Token   *oauth2.Token\n            IDTokenClaims *json.RawMessage // ID Token payload is just JSON.\n        }{oauth2Token, new(json.RawMessage)}\n\n        if err := idToken.Claims(&amp;resp.IDTokenClaims); err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n        data, err := json.MarshalIndent(resp, \"\", \"    \")\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n        w.Write(data)\n    })\n\n    log.Fatal(http.ListenAndServe(\"localhost:8181\", nil))\n}\n</code></pre>\n\n<p>This program starts a regular http server with two endpoints. The first one (\"/\") is your regular endpoint that handles\napplication logic. In this case, it only returns \"hello world\" to your client.</p>\n\n<p>The second endpoint (\"/demo/callback\") is used as a callback for keycloak. This endpoint needs to be registered on your\nkeycloak server. Keycloak will issue a redirect to this callback URL upon successful user authentication. The redirect contains some additional query parameters. These parameters contain a code that can be used to obtain access/id tokens.</p>\n\n<h2>Verify your setup</h2>\n\n<p>In order to test this setup you can open a webbrowser and navitage to <code>http://localhost:8181</code>. \nThe request should reach your go server, which tries to authenticate you. Since you did not send a token, the go server\nwill redirecty you to keycloak to authenticate. \nYou should see the login screen of keycloak. Login with the demo user you have created for this realm (demo/demo).\nIf you have configured your keycloak correctly, it will authenticate you and redirect you to your go server callback.</p>\n\n<p>The end result should be a json like this</p>\n\n<pre><code>{\n    \"OAuth2Token\": {\n        \"access_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJsc1hHR2VxSmx3UUZweWVYR0x6b2plZXBYSEhXUngtTHVJTVVLdDBmNmlnIn0.eyJqdGkiOiI5ZjAxNjM2OC1lYmEwLTRiZjMtYTU5Ni1kOGU1MzdmNTNlZGYiLCJleHAiOjE1MzIxNzM2NTIsIm5iZiI6MCwiaWF0IjoxNTMyMTczMzUyLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvYXV0aC9yZWFsbXMvZGVtbyIsImF1ZCI6ImRlbW8tY2xpZW50Iiwic3ViIjoiMzgzMzhjOGItYWQ3Zi00NjlmLTgzOTgtMTc5ODk1ODFiYTEyIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiZGVtby1jbGllbnQiLCJhdXRoX3RpbWUiOjE1MzIxNzMzNTIsInNlc3Npb25fc3RhdGUiOiJjZTg2NWFkZC02N2I4LTQ5MDUtOGYwMy05YzE2MDNjMWJhMGQiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIGVtYWlsIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsInByZWZlcnJlZF91c2VybmFtZSI6ImRlbW8iLCJlbWFpbCI6ImRlbW9AZGVtby5jb20ifQ.KERz8rBddxM9Qho3kgigX-fClWqbKY-3JcWT3JOQDoLa-prkorfa40BWlyf9ULVgjzT2d8FLJpqQIQYvucKU7Q7vFBVIjTGucUZaE7b6JGMea5H34A1i-MNm7L2CzDJ2GnBONhNwLKoftTSl0prbzwkzcVrps-JAZ6L2gssSa5hBBGJYBKAUfm1OIb57Jq0vzro3vLghZ4Ay7iNunwfcHUrxiFJfUjaU6PQwzrA5pnItOPuavJFUgso7-3JLtn3X9GQuyyZKrkDo6-gzU0JZmkQQzAXXgt43NxooryImuacwSB5xbIKY6qFkedldoOPehld1-oLv0Yy_FIwEad3uLw\",\n        \"token_type\": \"bearer\",\n        \"refresh_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJsc1hHR2VxSmx3UUZweWVYR0x6b2plZXBYSEhXUngtTHVJTVVLdDBmNmlnIn0.eyJqdGkiOiI0MjdmMTlhYy1jMTkzLTQ2YmQtYWFhNi0wY2Q1OTI5NmEwMGQiLCJleHAiOjE1MzIxNzUxNTIsIm5iZiI6MCwiaWF0IjoxNTMyMTczMzUyLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvYXV0aC9yZWFsbXMvZGVtbyIsImF1ZCI6ImRlbW8tY2xpZW50Iiwic3ViIjoiMzgzMzhjOGItYWQ3Zi00NjlmLTgzOTgtMTc5ODk1ODFiYTEyIiwidHlwIjoiUmVmcmVzaCIsImF6cCI6ImRlbW8tY2xpZW50IiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiY2U4NjVhZGQtNjdiOC00OTA1LThmMDMtOWMxNjAzYzFiYTBkIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIGVtYWlsIn0.FvvDW6ZSH8mlRR2zgaN1zesX14SmkCs9RrIVU4Jn1-SHVdKEA6YKur0-RUAFTObQDMLVhFFJ05AjGVGWpBrgVDcAwW2pI9saM-OHlyTJ3VfFoylgfzakVOIpbIDnHO12UaJrkOI9NWPAJdbBOzBHfsDhKbxhjg4ZX8SwlKr42rV4WWuSRcNu4_YDVO19SiXSCKXVldZ1_2S-qPvViq7VZfaoRLHuYyDvma_ByMsmib9JUkevJ8dxsYxVQ5FWaAfFanh1a1f8HxNRI-Cl180oPn1_Tqq_SYwxzBCw7Q_ENkMirwRS1a4cX9yMVEDW2uvKz2D-OiNAUK8d_ONuPEkTGQ\",\n        \"expiry\": \"2018-07-21T13:47:28.986686385+02:00\"\n    },\n    \"IDTokenClaims\": {\n        \"jti\": \"f4d56526-37d9-4d32-b99d-81090e92d3a7\",\n        \"exp\": 1532173652,\n        \"nbf\": 0,\n        \"iat\": 1532173352,\n        \"iss\": \"http://localhost:8080/auth/realms/demo\",\n        \"aud\": \"demo-client\",\n        \"sub\": \"38338c8b-ad7f-469f-8398-17989581ba12\",\n        \"typ\": \"ID\",\n        \"azp\": \"demo-client\",\n        \"auth_time\": 1532173352,\n        \"session_state\": \"ce865add-67b8-4905-8f03-9c1603c1ba0d\",\n        \"acr\": \"1\",\n        \"email_verified\": true,\n        \"preferred_username\": \"demo\",\n        \"email\": \"demo@demo.com\"\n    }\n}\n</code></pre>\n\n<p>You can copy your access token and use curl to verify if the server is able to accept your tokens:</p>\n\n<pre><code># use your complete access token here\nexport TOKEN=\"eyJhbG...\"\ncurl -H \"Authorization: Bearer $TOKEN\" localhost:8181\n# output hello world\n</code></pre>\n\n<p>You can try it again after the token has expired - or temper with the token. In case you do it, you should get a redirect to \nyour keycloak server again.</p>\n"}, {"comments": [{"owner": {"reputation": 2427, "user_id": 3788261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d14c68ce6c53d9f94656f04bb750300?s=128&d=identicon&r=PG&f=1", "display_name": "ShrimpPhaser", "link": "https://stackoverflow.com/users/3788261/shrimpphaser"}, "edited": false, "score": 1, "creation_date": 1550028129, "post_id": 54522988, "comment_id": 96115040, "body": "gocloak looks really nice. Thanks for pointing it out! One little nitpick though: You should add a short disclosure that you are the author."}, {"owner": {"reputation": 2616, "user_id": 4992212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cul0O.png?s=128&g=1", "display_name": "Tobias Theel", "link": "https://stackoverflow.com/users/4992212/tobias-theel"}, "reply_to_user": {"reputation": 2427, "user_id": 3788261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d14c68ce6c53d9f94656f04bb750300?s=128&d=identicon&r=PG&f=1", "display_name": "ShrimpPhaser", "link": "https://stackoverflow.com/users/3788261/shrimpphaser"}, "edited": false, "score": 0, "creation_date": 1550090613, "post_id": 54522988, "comment_id": 96147108, "body": "Thanks for the hint! I added a disclosure"}], "tags": [], "owner": {"reputation": 2616, "user_id": 4992212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cul0O.png?s=128&g=1", "display_name": "Tobias Theel", "link": "https://stackoverflow.com/users/4992212/tobias-theel"}, "is_accepted": false, "score": 10, "last_activity_date": 1579797518, "last_edit_date": 1579797518, "creation_date": 1549308262, "answer_id": 54522988, "question_id": 48855122, "link": "https://stackoverflow.com/questions/48855122/keycloak-adaptor-for-golang-application/54522988#54522988", "title": "Keycloak adaptor for golang application", "body": "<p>There is also the <a href=\"https://github.com/Nerzal/gocloak\" rel=\"nofollow noreferrer\">gocloak</a> library which provides lot's of functionality. The lib is in active development and allready in use in real world projects. So possible bugs &amp; feature requests are being handled.</p>\n\n<p>It provides administration features like \"CreateUser\",\"CreateGroup\" etc. and also provides functions for Login, Token validation, etc.</p>\n\n<p>For example creating a user is as easy as:</p>\n\n<pre><code>client := gocloak.NewClient(\"https://mycool.keycloak.instance\")\ntoken, err := client.LoginAdmin(\"user\", \"password\", \"realmName\")\nif err != nil {\n    panic(\"Something wrong with the credentials or url\")\n}\nuser := gocloak.User{\n    FirstName: \"Bob\",\n    LastName:  \"Uncle\",\n    EMail:     \"something@really.wrong\",\n    Enabled:   true,\n    Username:  \"CoolGuy\",\n}\nclient.CreateUser(token.AccessToken, \"realm\", user)\nif err != nil {\n    panic(\"Oh no!, failed to create user :(\")\n}\n</code></pre>\n\n<p>It does also supports <a href=\"https://www.keycloak.org/docs/latest/authorization_services/#_service_protection_token_introspection\" rel=\"nofollow noreferrer\">Introspecting a Requesting Party Token</a></p>\n\n<pre><code>client := gocloak.NewClient(hostname)\ntoken, err := client.LoginClient(clientid, clientSecret, realm)\nif err != nil {\n    panic(\"Login failed:\"+ err.Error())\n}\n\nrptResult, err := client.RetrospectToken(token.AccessToken, clientid, clientSecret, realm)\nif err != nil {\n    panic(\"Inspection failed:\"+ err.Error())\n}\n\nif !rptResult.Active {\n    panic(\"Token is not active\")\n}\n\npermissions := rptResult.Permissions\n//Do something with the permissions ;) \n</code></pre>\n\n<p>Also to handle easy authentication &amp; token refresh when using echo there is another lib based on gocloak called <a href=\"https://github.com/Nerzal/gocloak-echo\" rel=\"nofollow noreferrer\">gocloak-echo</a>. This lib provides handler &amp; middleware to help out, but is still in a more WIP state.</p>\n\n<p>The library also provides decoding of accessTokens into custom claims</p>\n\n<p>Disclosure: I am the (main) author of gocloak, so it's also a little advertising, but in general it answers the question. I had the same problem as the author and i decided to create my own lib (based on the lib of someone else, as stated in the readme on github).</p>\n"}], "owner": {"reputation": 334, "user_id": 4734545, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53bb2d9115bd7432d570df349d90c40f?s=128&d=identicon&r=PG&f=1", "display_name": "setiabb", "link": "https://stackoverflow.com/users/4734545/setiabb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12915, "favorite_count": 13, "accepted_answer_id": 51456282, "answer_count": 2, "score": 18, "last_activity_date": 1579797518, "creation_date": 1518978327, "last_edit_date": 1550105317, "question_id": 48855122, "link": "https://stackoverflow.com/questions/48855122/keycloak-adaptor-for-golang-application", "title": "Keycloak adaptor for golang application", "body": "<p>I am going to secure my golang application using keycloak, but keycloak itself does not support go language. </p>\n\n<p>There are some go adaptor as an open project in github that has implemented openId connect protocol as a provider service, but they do not provide an example or documentation on how to integrate libraries with an application. </p>\n\n<p>How can i interact with keycloak using golang?</p>\n"}, {"tags": ["apache", "go", "webdeploy", "virtual-hosts"], "comments": [{"owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1518968531, "post_id": 48853331, "comment_id": 84710287, "body": "Why are you using apache to host a Golang application?"}, {"owner": {"reputation": 358, "user_id": 3257051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/URqC6.jpg?s=128&g=1", "display_name": "Odd", "link": "https://stackoverflow.com/users/3257051/odd"}, "reply_to_user": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "edited": false, "score": 0, "creation_date": 1518983321, "post_id": 48853331, "comment_id": 84715178, "body": "Cheers Anuruddha, there are two reason, 1) the server already hosts a couple of PHP frameworks 2) I&#39;m only familiar with Apache (PHP). New suggestion are welcomed."}], "answers": [{"comments": [{"owner": {"reputation": 2634, "user_id": 7748072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf66595c2c53ae2454c8f398d2797156?s=128&d=identicon&r=PG", "display_name": "Eug&#232;ne Adell", "link": "https://stackoverflow.com/users/7748072/eug%c3%a8ne-adell"}, "edited": false, "score": 0, "creation_date": 1518975160, "post_id": 48854326, "comment_id": 84712515, "body": "You could give him the 2 ProxyPass/ProxyPassReverse lines, and a better command to identify if anything is listening on port 8080 (netstat -talpen for example ?)"}, {"owner": {"reputation": 171, "user_id": 1503465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560dfce511baa205d006d43a57bea1f0?s=128&d=identicon&r=PG", "display_name": "Michael Ernst", "link": "https://stackoverflow.com/users/1503465/michael-ernst"}, "reply_to_user": {"reputation": 2634, "user_id": 7748072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf66595c2c53ae2454c8f398d2797156?s=128&d=identicon&r=PG", "display_name": "Eug&#232;ne Adell", "link": "https://stackoverflow.com/users/7748072/eug%c3%a8ne-adell"}, "edited": false, "score": 0, "creation_date": 1518976688, "post_id": 48854326, "comment_id": 84713007, "body": "@Eug&#232;neAdell Thanks for the suggestion. I edited the answer to incorporate the suggested changes"}, {"owner": {"reputation": 2634, "user_id": 7748072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf66595c2c53ae2454c8f398d2797156?s=128&d=identicon&r=PG", "display_name": "Eug&#232;ne Adell", "link": "https://stackoverflow.com/users/7748072/eug%c3%a8ne-adell"}, "edited": false, "score": 0, "creation_date": 1518977281, "post_id": 48854326, "comment_id": 84713213, "body": "About the documentroot listing instead of executing, I suppose proxying to the application server will resolve it by the same time"}, {"owner": {"reputation": 358, "user_id": 3257051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/URqC6.jpg?s=128&g=1", "display_name": "Odd", "link": "https://stackoverflow.com/users/3257051/odd"}, "edited": false, "score": 0, "creation_date": 1519035147, "post_id": 48854326, "comment_id": 84730666, "body": "Cheers Michael Ernst, Eugene Adell, unfortunately I had no success yet. I&#39;ve edited my post and updated with the result of your suggestions."}, {"owner": {"reputation": 358, "user_id": 3257051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/URqC6.jpg?s=128&g=1", "display_name": "Odd", "link": "https://stackoverflow.com/users/3257051/odd"}, "edited": false, "score": 0, "creation_date": 1519036883, "post_id": 48854326, "comment_id": 84731756, "body": "Michael (es funktioniert) thanks! Having made your suggestions, all I had to do was restart the daemon. However, passing GET Vars like so <a href=\"http://gotest.domain2.com/testvar\" rel=\"nofollow noreferrer\">gotest.domain2.com/testvar</a> leads to 502 Proxy Error <code>Reason: DNS lookup failure for: localhost:8080test</code> any idea what the reason is?"}, {"owner": {"reputation": 358, "user_id": 3257051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/URqC6.jpg?s=128&g=1", "display_name": "Odd", "link": "https://stackoverflow.com/users/3257051/odd"}, "edited": false, "score": 0, "creation_date": 1519041562, "post_id": 48854326, "comment_id": 84734466, "body": "Adding a trailing <code>&#47;</code> to ProxyPass and ProxyPassReverse solved the &quot;502 Proxy Error&quot; <a href=\"http://localhost:8080/\" rel=\"nofollow noreferrer\">localhost:8080</a>"}, {"owner": {"reputation": 171, "user_id": 1503465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560dfce511baa205d006d43a57bea1f0?s=128&d=identicon&r=PG", "display_name": "Michael Ernst", "link": "https://stackoverflow.com/users/1503465/michael-ernst"}, "reply_to_user": {"reputation": 358, "user_id": 3257051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/URqC6.jpg?s=128&g=1", "display_name": "Odd", "link": "https://stackoverflow.com/users/3257051/odd"}, "edited": false, "score": 0, "creation_date": 1519048804, "post_id": 48854326, "comment_id": 84738969, "body": "@odd i am glad it works! i added the trailing / to my answer"}], "tags": [], "owner": {"reputation": 171, "user_id": 1503465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560dfce511baa205d006d43a57bea1f0?s=128&d=identicon&r=PG", "display_name": "Michael Ernst", "link": "https://stackoverflow.com/users/1503465/michael-ernst"}, "is_accepted": true, "score": 4, "last_activity_date": 1519048781, "last_edit_date": 1519048781, "creation_date": 1518973631, "answer_id": 48854326, "question_id": 48853331, "link": "https://stackoverflow.com/questions/48853331/golang-webapp-with-apache-multiple-virtualhosts/48854326#48854326", "title": "Golang webapp with Apache multiple VirtualHosts", "body": "<p><strong>As for configuring apache:</strong></p>\n\n<p>You need to start the go application and in the apache configuration reverse proxy the request to the port 8080 ( which the go daemon you wrote listens to ).\nThe go application needs to be always running so you might want to boot it at system start. Unlike php, which is called from apache, go should run as binary that is always there.</p>\n\n<p><strong>As for your port issue:</strong></p>\n\n<p>Make sure that your application is not yet started and that no other application is listening to port 8080. ( you can use <code>netstat -talpen</code> to see that )</p>\n\n<p>Edit: \nPort 8080 is often a http proxy. Is there are proxy or another application running on this point?</p>\n\n<p>Edit: \nYou can configure your apache like that:</p>\n\n<pre><code>&lt;VirtualHost *:80&gt; \n  ProxyPreserveHost On\n  ProxyRequests Off\n  ServerName www.example.com\n  ServerAlias example.com\n  ProxyPass / http://localhost:8080/\n  ProxyPassReverse / http://localhost:8080/\n&lt;/VirtualHost&gt;\n</code></pre>\n\n<p>You might also want to make the port of your go-application configurable so you don't need to re-compile the code in case you need to change the port. Also you can bind to the localhost interface so, in case you don't have a firewall configured, people can only access the go application over apache and not directly talk with the go application </p>\n\n<pre><code>// define the flag\nport := flags.Int(\"port\", 8080, \"port to listen on\")\n// parse the flags\nflags.Parse();\n// here you might want to add code to make sure the port is valid.\n// start webserver\nlog.Fatal(http.ListenAndServe(\"localhost:\"+strconv.Atoi(*port), nil))\n</code></pre>\n"}], "owner": {"reputation": 358, "user_id": 3257051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/URqC6.jpg?s=128&g=1", "display_name": "Odd", "link": "https://stackoverflow.com/users/3257051/odd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1479, "favorite_count": 0, "accepted_answer_id": 48854326, "answer_count": 1, "score": 0, "last_activity_date": 1519048781, "creation_date": 1518967860, "last_edit_date": 1519035025, "question_id": 48853331, "link": "https://stackoverflow.com/questions/48853331/golang-webapp-with-apache-multiple-virtualhosts", "title": "Golang webapp with Apache multiple VirtualHosts", "body": "<p>Unfortunately I've not been able to deploy a basic Golang WebApp on production server. After going through many documentation and tutorials I understood that I need to run Golang WebApp as a Daemon.</p>\n\n<p>First things first: the production server is a single IP running Ubuntu 16.04 with Apache based multiple VirtualHosts <code>/etc/apache2/sites-enabled/</code>.</p>\n\n<p>Golang environment vars</p>\n\n<pre><code># set golang environment vars\nexport GOROOT=/usr/local/go\n\n# set multiple gopaths seperated by \":\"\nexport GOPATH=/var/www/go_projects/gotest.domain2.com\n\nexport PATH=$GOPATH/bin:$GOROOT/bin:$PATH\n\n# set PATH so it includes user's private bin directories\nPATH=\"$HOME/bin:$HOME/.local/bin:$PATH\"\n</code></pre>\n\n<p>Systemd Daemon file</p>\n\n<pre><code>[Unit]\nDescription=GoTest Webserver\n\n[Service]\nType=simple\nWorkingDirectory=/var/www/go_projects/gotest.domain2.com\nExecStart=/var/www/go_projects/gotest.domain2.com/main #binary file\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n\n<p>VirtualHost Conf</p>\n\n<pre><code>&lt;VirtualHost *:80&gt;\n    ServerName gotest.domain.com\n    DocumentRoot /var/www/go_projects/gotest.domain2.com\n\n    &lt;Directory /var/www/go_projects/gotest.domain2.com&gt;\n                Options Indexes FollowSymLinks MultiViews\n                AllowOverride All\n                Order allow,deny\n                allow from all\n    &lt;/Directory&gt;\n</code></pre>\n\n<p></p>\n\n<p>Go file </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello World %s!\", r.URL.Path[1:])\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>The program on <a href=\"http://gotest.domain2.com\" rel=\"nofollow noreferrer\">http://gotest.domain2.com</a> unfortunately is not executed. It rather lists the content of <code>DocumentRoot</code> </p>\n\n<p>Manual run returns</p>\n\n<pre><code>admin@xyz:/var/www/go_projects/gotest.domain2.com$ ./main \n2018/02/18 15:52:58 listen tcp :8080: bind: address already in use\n</code></pre>\n\n<p>What am I missing or is my deployment approach principally wrong?\nCheers! </p>\n\n<p>EDIT:\nAs suggested from Michael Ernst, I tried altering the port/proxy settings and here is the result:</p>\n\n<pre><code>http://gotest.domain2.com leads to 503 Service Unavailable\n</code></pre>\n\n<p>Following is the outcome of <code>sudo netstat -talpen</code></p>\n\n<pre><code>Active Internet connections (servers and established)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       User       Inode       PID/Program name\ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      0          16367       1250/sshd       \ntcp        0      0 0.0.0.0:25              0.0.0.0:*               LISTEN      0          473536      26340/master    \ntcp        0      0 0.0.0.0:143             0.0.0.0:*               LISTEN      0          16604       1417/dovecot    \ntcp        0      0 0.0.0.0:2000            0.0.0.0:*               LISTEN      5001       17289       1652/asterisk   \ntcp        0     xx.xx.xx.xx:22       xx.xx.xx.xx:6126      ESTABLISHED 0          615988      13025/sshd: admin [\ntcp6       0      0 :::22                   :::*                    LISTEN      0          16369       1250/sshd       \ntcp6       0      0 :::25                   :::*                    LISTEN      0          473537      26340/master    \ntcp6       0      0 :::3306                 :::*                    LISTEN      111        17564       1391/mysqld     \ntcp6       0      0 :::143                  :::*                    LISTEN      0          16605       1417/dovecot    \ntcp6       0      0 :::80                   :::*                    LISTEN      0          612412      12554/apache2   \ntcp6       0      0 xx.xx.xx.xx:80       xx.xx.xx.xx:6128      FIN_WAIT2   0          0           -               \ntcp6       0      0 xx.xx.xx.xx:80       xx.xx.xx.xx:6129      ESTABLISHED 33         615029      12561/apache2   \n</code></pre>\n\n<p>Any idea where the problem lies?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "is_accepted": true, "score": 0, "last_activity_date": 1518965724, "last_edit_date": 1518965724, "creation_date": 1518965325, "answer_id": 48852952, "question_id": 48852506, "link": "https://stackoverflow.com/questions/48852506/create-archive-exclude-base-dir/48852952#48852952", "title": "Create archive exclude base dir", "body": "<p><code>archiver</code> library always append the baseDir to the header names. Refer to line no: 111 of <a href=\"https://github.com/mholt/archiver/blob/master/zip.go\" rel=\"nofollow noreferrer\">zip.go</a>. I don't see an option here to use this library without modification to suite your needs.</p>\n\n<p>Internally this library is using <code>archive/zip</code>. I've modified the ziping code to suit your requirement. Hope the code is self explanatory.</p>\n\n<pre><code>package main\n\nimport (\n    \"archive/zip\"\n    \"fmt\"\n    \"os\"\n\n    \"path/filepath\"\n    \"strings\"\n    \"path\"\n    \"io\"\n)\n\nvar compressedFormats = map[string]struct{}{\n    \".7z\":   {},\n    \".avi\":  {},\n    \".bz2\":  {},\n    \".cab\":  {},\n    \".gif\":  {},\n    \".gz\":   {},\n    \".jar\":  {},\n    \".jpeg\": {},\n    \".jpg\":  {},\n    \".lz\":   {},\n    \".lzma\": {},\n    \".mov\":  {},\n    \".mp3\":  {},\n    \".mp4\":  {},\n    \".mpeg\": {},\n    \".mpg\":  {},\n    \".png\":  {},\n    \".rar\":  {},\n    \".tbz2\": {},\n    \".tgz\":  {},\n    \".txz\":  {},\n    \".xz\":   {},\n    \".zip\":  {},\n    \".zipx\": {},\n}\n\nfunc Zip(source, ou string) error {\n    out, err := os.Create(ou)\n    if err != nil {\n        return fmt.Errorf(\"error creating %s: %v\", ou, err)\n    }\n    defer out.Close()\n    // Create a new zip archive.\n    w := zip.NewWriter(out)\n    sourceInfo, err := os.Stat(source)\n    if err != nil {\n        return fmt.Errorf(\"%s: stat: %v\", source, err)\n    }\n    defer w.Close()\n    var baseDir string\n    if sourceInfo.IsDir() {\n        baseDir = filepath.Base(source)\n    }\n\n    return filepath.Walk(source, func(fpath string, info os.FileInfo, err error) error {\n        if baseDir == fpath {\n            //skip the base diectory\n            return nil\n        }\n        if err != nil {\n            return fmt.Errorf(\"walking to %s: %v\", fpath, err)\n        }\n\n        header, err := zip.FileInfoHeader(info)\n        if err != nil {\n            return fmt.Errorf(\"%s: getting header: %v\", fpath, err)\n        }\n\n        if baseDir != \"\" {\n            name, err := filepath.Rel(source, fpath)\n            if err != nil {\n                return err\n            }\n            header.Name = filepath.ToSlash(name)\n        }\n\n        if info.IsDir() {\n            header.Name += \"/\"\n            header.Method = zip.Store\n        } else {\n            ext := strings.ToLower(path.Ext(header.Name))\n            if _, ok := compressedFormats[ext]; ok {\n                header.Method = zip.Store\n            } else {\n                header.Method = zip.Deflate\n            }\n        }\n\n        writer, err := w.CreateHeader(header)\n        if err != nil {\n            return fmt.Errorf(\"%s: making header: %v\", fpath, err)\n        }\n\n        if info.IsDir() {\n            return nil\n        }\n\n        if header.Mode().IsRegular() {\n            file, err := os.Open(fpath)\n            if err != nil {\n                return fmt.Errorf(\"%s: opening: %v\", fpath, err)\n            }\n            defer file.Close()\n\n            _, err = io.CopyN(writer, file, info.Size())\n            if err != nil &amp;&amp; err != io.EOF {\n                return fmt.Errorf(\"%s: copying contents: %v\", fpath, err)\n            }\n        }\n        return nil\n    })\n}\n\nfunc main() {\n    err := Zip(\"caddy\", \"result.zip\")\n    if err != nil {\n        fmt.Println(err.Error())\n    }\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 48852952, "answer_count": 1, "score": 1, "last_activity_date": 1518970753, "creation_date": 1518962581, "last_edit_date": 1518970753, "question_id": 48852506, "link": "https://stackoverflow.com/questions/48852506/create-archive-exclude-base-dir", "title": "Create archive exclude base dir", "body": "<p>I\u2019ve directory with lots of files that I need to zip, I found this\n<a href=\"https://github.com/mholt/archiver\" rel=\"nofollow noreferrer\">https://github.com/mholt/archiver</a>  OS\nWhat I need is to <strong>exclude base dir</strong> while archiving and I didnt find this on the docs</p>\n\n<p>i.e zip only the files inside the folder without the parent folder</p>\n\n<p>The code I use is like following </p>\n\n<pre><code>err := archiver.Zip.Make(\u201cmydir.zip\", []string{path2Dir})\n</code></pre>\n\n<p>How Can I do it ?</p>\n\n<p>If there is other good solution in go please let me know</p>\n"}, {"tags": ["http", "go", "get", "bad-request"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518952576, "post_id": 48851015, "comment_id": 84705447, "body": "please post more code what your are doing to fetch the response. Or you are using debugger to check response."}, {"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518953127, "post_id": 48851015, "comment_id": 84705579, "body": "Thanks Himanshu, added in post -&gt; data, _ := ioutil.ReadAll(response.Body)"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518955052, "post_id": 48851015, "comment_id": 84706146, "body": "you should be more specific in your post. Your code is simple. And It is hard to analyze here what is going wrong. Nothing seems wrong in your posted code"}, {"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518955228, "post_id": 48851015, "comment_id": 84706205, "body": "Sorry Himanshu, problem is now resolved, I have posted self answer."}], "answers": [{"tags": [], "owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "is_accepted": false, "score": 1, "last_activity_date": 1518955204, "creation_date": 1518955204, "answer_id": 48851401, "question_id": 48851015, "link": "https://stackoverflow.com/questions/48851015/golang-http-get-400-bad-request/48851401#48851401", "title": "GoLang HTTP GET - 400 Bad Request", "body": "<p>Apologies, I found the answer. Earlier I use to create big getUrl by appending all parameters to it. After doing below, the problem was resolved.</p>\n\n<pre><code>q := req.URL.Query()\nq.Add(\"key\", \"value\")\nreq.URL.RawQuery = q.Encode()\n</code></pre>\n"}], "owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5173, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1518955204, "creation_date": 1518952452, "last_edit_date": 1518953101, "question_id": 48851015, "link": "https://stackoverflow.com/questions/48851015/golang-http-get-400-bad-request", "title": "GoLang HTTP GET - 400 Bad Request", "body": "<p>I am making HTTP GET call using below GoLang code:</p>\n\n<pre><code>client := &amp;http.Client{}\nreq, _ := http.NewRequest(\"GET\", getUrl, nil)\n//req.Header.Set(\"Accept-Encoding\", \"br\")\nresponse, _ := client.Do(req)\n</code></pre>\n\n<p>Receiving error response:</p>\n\n<pre><code>&lt;html&gt;\n     &lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;\n     &lt;body bgcolor=\"white\"&gt;\n          &lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;\n          &lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;\n     &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>To print above error response, I am using simple:</p>\n\n<pre><code>data, _ := ioutil.ReadAll(response.Body)\nlog.Println(string(data))\n</code></pre>\n\n<p>When I pick up getUrl and execute simply in Chrome browser, it returns success response:</p>\n\n<pre><code>{\"message\":\"SUCCESS\",\"errorcode\": \"0\" ,\"errormessage\":\"\"}\n</code></pre>\n\n<p>Chrome request header:</p>\n\n<pre><code>    Accept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\n    Accept-Encoding:gzip, deflate, br\n    Accept-Language:en-GB,en-US;q=0.9,en;q=0.8\n    Cache-Control:max-age=0\n    Connection:keep-alive\n    Host:api.pepipost.com\n    Upgrade-Insecure-Requests:1\n    User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.167 Safari/537.36\n</code></pre>\n\n<p>Chrome response headers:</p>\n\n<pre><code>Access-Control-Allow-Headers:accept, content-type\nAccess-Control-Allow-Origin:*\nConnection:keep-alive\nContent-Type:application/json\nDate:Sun, 18 Feb 2018 11:01:28 GMT\nServer:nginx\nTransfer-Encoding:chunked\nX-Content-Type-Options:nosniff\nX-Firefox-Spdy:3.1\nX-Frame-Options:SAMEORIGIN\nX-Server1:Region-US\nX-XSS-Protection:1; mode=block\n</code></pre>\n\n<p>Please help.</p>\n"}, {"tags": ["database", "mongodb", "go", "nosql", "mgo"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518945710, "post_id": 48850037, "comment_id": 84703806, "body": "As the error says you are trying to insert pointer to Transaction slice. Though <code>Collection.Insert()</code> takes <code>[]interface{}</code> not <code>*[]interface{}</code>"}, {"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518945793, "post_id": 48850037, "comment_id": 84703824, "body": "@Himanshu I tried removing the pointer and still the error"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518945945, "post_id": 48850037, "comment_id": 84703850, "body": "what is error after removing pointer to interface"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518953799, "post_id": 48850037, "comment_id": 84705763, "body": "There are no <code>bson:&quot;&quot;</code> tags for your transaction struct."}, {"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1519101858, "post_id": 48850037, "comment_id": 84760001, "body": "@Himanshu Strangely it works without <code>bson</code> tag"}], "answers": [{"comments": [{"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1519101799, "post_id": 48850105, "comment_id": 84759987, "body": "Thanks for this answer. Actually I wouldn&#39;t wanted to use <code>bulk</code> update as <code>insert</code> already supports multiple documents. Anyway I will refer this for bulk update"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 3, "last_activity_date": 1518972388, "last_edit_date": 1518972388, "creation_date": 1518945554, "answer_id": 48850105, "question_id": 48850037, "link": "https://stackoverflow.com/questions/48850037/dynamically-insert-multiple-documents-using-mgo-golang-mongodb/48850105#48850105", "title": "Dynamically insert multiple documents using mgo golang mongodb", "body": "<p>Create slice of interface for document structs by appending and then inserting data using Bulk insert which takes variable arguments. </p>\n\n<pre><code>type Bulk struct {\n    // contains filtered or unexported fields\n}\nfunc (b *Bulk) Insert(docs ...interface{})\n</code></pre>\n\n<p>For inserting documents in <a href=\"https://godoc.org/gopkg.in/mgo.v2#Bulk.Insert\" rel=\"nofollow noreferrer\">Bulk</a></p>\n\n<pre><code>const INSERT_COUNT int = 10000\n\ntype User struct {\n    Id    bson.ObjectId `bson:\"_id,omitempty\" json:\"_id\"`\n    Email string        `bson:\"email\" json:\"email\"`\n}\n\nfunc (self *User) Init() {\n    self.Id = bson.NewObjectId()\n}\n</code></pre>\n\n<p>Call <code>Bulk()</code> function on collection returned from db connection. <code>Bulk()</code> function returns pointer to <code>*Bulk</code>. </p>\n\n<pre><code>bulk := dbs.Clone().DB(\"\").C(\"users\").Bulk()\nbulk.Insert(users...)\n</code></pre>\n\n<p>Assign it to variable which will be used to call <code>Insert()</code> method using <code>Bulk</code> pointer receiver.</p>\n\n<pre><code>func main(){\n    // Database\n    dbs, err := mgo.Dial(\"mongodb://localhost/\")\n    if err != nil {\n        panic(err)\n    }\n    // Collections\n    uc := dbs.Clone().DB(\"\").C(\"users\")\n    defer dbs.Clone().DB(\"\").Session.Close()\n    for n := 0; n &lt; b.N; n++ {\n        count := INSERT_COUNT\n        users := make([]interface{}, count)\n        for i := 0; i &lt; count; i++ {\n            loop_user := User{}\n            loop_user.Init()\n            loop_user.Email = fmt.Sprintf(\"report-%d@example.com\", i)\n            users[i] = loop_user\n        }\n        bulk := uc.Bulk()\n        bulk.Unordered()\n        bulk.Insert(users...)\n        _, bulkErr := bulk.Run()\n        if bulkErr != nil {\n            panic(err)\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 2, "creation_date": 1519101664, "post_id": 48850136, "comment_id": 84759951, "body": "Thanks dude..It worked! I wish if there was no need for a <code>range</code>"}], "tags": [], "owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "is_accepted": true, "score": 8, "last_activity_date": 1518945817, "creation_date": 1518945817, "answer_id": 48850136, "question_id": 48850037, "link": "https://stackoverflow.com/questions/48850037/dynamically-insert-multiple-documents-using-mgo-golang-mongodb/48850136#48850136", "title": "Dynamically insert multiple documents using mgo golang mongodb", "body": "<p>You cannot pass <code>[]*Transaction</code> as <code>[]interface{}</code>. You need to convert each <code>Transaction</code> to <code>inferface{}</code> to change its memory layout.</p>\n\n<pre><code>var ui []interface{}\nfor _, t := range u{\n    ui = append(ui, t)\n}\n</code></pre>\n\n<p>Pass ui to <code>c.Insert</code> instead</p>\n"}], "owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9472, "favorite_count": 1, "accepted_answer_id": 48850136, "answer_count": 2, "score": 2, "last_activity_date": 1518972388, "creation_date": 1518945046, "last_edit_date": 1518949491, "question_id": 48850037, "link": "https://stackoverflow.com/questions/48850037/dynamically-insert-multiple-documents-using-mgo-golang-mongodb", "title": "Dynamically insert multiple documents using mgo golang mongodb", "body": "<p>How can I insert an array of documents into MongoDB with <a href=\"https://godoc.org/labix.org/v2/mgo\" rel=\"nofollow noreferrer\">mgo</a> library using only a <strong>single</strong> DB call as in <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.insert/#insert-multiple-documents\" rel=\"nofollow noreferrer\">db.collection.insert()</a>?</p>\n\n<p>I have the following <code>Transaction</code> structure:</p>\n\n<pre><code>    type Transaction struct {\n    Brand         string `json:\"brand\"`\n    Name          string `json:\"name\"`\n    Plu           string `json:\"plu\"`\n    Price         string `json:\"price\"`\n  }\n</code></pre>\n\n<p>From a <code>POST</code> request I will recieve an array of these structures. I want to insert them into MongoDB as <em>individual</em> documents but using a single DB call as explained in <a href=\"https://docs.mongodb.com/manual/reference/method/db.collection.insert/#insert-multiple-documents\" rel=\"nofollow noreferrer\">db.collection.insert()</a> </p>\n\n<p>I tried using <a href=\"https://godoc.org/labix.org/v2/mgo#Collection.Insert\" rel=\"nofollow noreferrer\"><code>c.Insert</code></a> of mgo </p>\n\n<p>The following is the code snippet:</p>\n\n<pre><code>  func insertTransaction(c *gin.Context) {\n    var transactions []Transaction\n    err := c.BindJSON(&amp;transactions)\n    if err != nil {\n        c.AbortWithStatusJSON(http.StatusBadRequest, map[string]string{\"error\":\"invalid JSON\"})\n        return\n    }\n    err = InsertTransactons(transactions)\n    if err != nil {\n        c.AbortWithStatusJSON(http.StatusInternalServerError, &amp;map[string](interface{}){\n            \"status\":  \"error\",\n            \"code\":    \"500\",\n            \"message\": \"Internal server error\",\n            \"error\": err,\n        })\n        return\n    }\n    c.JSON(http.StatusCreated, &amp;map[string](interface{}){\n        \"status\":  \"success\",\n        \"code\":    \"0\",\n        \"message\": \"created\",\n    })\n  }\n\n\n  func InsertTransactons(u []Transaction) error {\n    s := GetSession()\n    defer s.Close()\n    c := s.DB(DB).C(TransactionColl)\n    err := c.Insert(u...)\n    if err != nil {\n        return err\n    }\n    return nil\n  }\n</code></pre>\n\n<p>But as I compile and run the code, I get the following error:</p>\n\n<blockquote>\n  <p>go/database.go:34:17: cannot use u (type *[]Transaction) as type\n  []interface {} in argument to c.Insert</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518940985, "post_id": 48849625, "comment_id": 84702831, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/30725751/streaming-commands-output-progress/30726590#30726590\">Streaming commands output progress</a>. Also see related: <a href=\"https://stackoverflow.com/questions/37091316/how-to-get-the-realtime-output-for-a-shell-command-in-golang/37137583#37137583\">How to get the realtime output for a shell command in golang?</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518941618, "post_id": 48849625, "comment_id": 84702976, "body": "@icza - so I should use <code>oneByte := make([]byte, 1) for {     _, err := stdout.Read(oneByte)     if err != nil {         break     }     fmt.Printf(&quot;%c&quot;, oneByte[0]) }</code> for this case ? if so where ? it&#39;s a bit confusing ..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518941958, "post_id": 48849625, "comment_id": 84703043, "body": "Use the solution from the accepted answer of the suggested duplicate."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518942009, "post_id": 48849625, "comment_id": 84703057, "body": "@icza - do you mean -<code>scanner := bufio.NewScanner(stdout) scanner.Split(bufio.ScanRunes)</code> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518942155, "post_id": 48849625, "comment_id": 84703082, "body": "@icza - it will be great if you can provide example with my context, since I read the post and it&#39;s difference , I run several command and I use the <code>cmd.Output()</code> which I dont understand how to relate them..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518943258, "post_id": 48849625, "comment_id": 84703280, "body": "See my answer below. I haven&#39;t tested it, but hopefully it works right away."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1518945336, "post_id": 48849811, "comment_id": 84703725, "body": "Thanks 1+ , can you see my updates why the output is like this ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1518945488, "post_id": 48849811, "comment_id": 84703752, "body": "I think it&#39;s becouse of <code>count, err := stdout.Read(oneRune)</code> , any idea how to overcome this?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1518947113, "post_id": 48849811, "comment_id": 84704086, "body": "Thanks, I&#39;ve tried it and now I got even worse <code>2018&#47;02&#47;18 11:44:14 a 2018&#47;02&#47;18 11:44:14 d 2018&#47;02&#47;18 11:44:14 d 2018&#47;02&#47;18 11:44:14 e 2018&#47;02&#47;18 11:44:14 d 2018&#47;02&#47;18 11:44:14   2018&#47;02&#47;18 11:44:14 5</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1518947126, "post_id": 48849811, "comment_id": 84704088, "body": "each byte in a new line"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518947182, "post_id": 48849811, "comment_id": 84704102, "body": "@RaynD Do note when streaming the output I use <code>fmt.Printf()</code> and <b>not</b> <code>log.Printf()</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1518947296, "post_id": 48849811, "comment_id": 84704133, "body": "Ohh now I see, there is no way to use log? and why it works on fmt and not log?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518947349, "post_id": 48849811, "comment_id": 84704145, "body": "@RaynD If it works with <code>fmt</code>, can you also try the previous version with <code>oneRune := make([]byte, utf8.UTFMax)</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1518947372, "post_id": 48849811, "comment_id": 84704149, "body": "Sure not checking it"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518947390, "post_id": 48849811, "comment_id": 84704153, "body": "@RaynD And it works with <code>fmt</code> because <code>fmt.Printf()</code> does not append a newline to the end, while <code>log.Printf()</code> does append a newline."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1518947796, "post_id": 48849811, "comment_id": 84704254, "body": "Thanks a lot, I missed the <code>fmt</code> part , it works and Im closing the question , it will be great if you can provide additaionl info about this 3 lines ,`\t\t<code>scanner := bufio.NewScanner(stdout) \t\tscanner.Split(bufio.ScanRunes) \t\toneRune := make([]byte, utf8.UTFMax)</code> what is utf.UTFMax` etc"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "edited": false, "score": 0, "creation_date": 1518948789, "post_id": 48849811, "comment_id": 84704505, "body": "Thanks a lot sir, one last question , assume I need to execute a code when the all process has finished (all the loops is done) where is the best to do it ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518952408, "post_id": 48849811, "comment_id": 84705403, "body": "@RaynD Edited the answer to add more explanation. If you want to run a process once all the processes completed successfully, best would to be to also list that command in the slice of commands to execute (add that to <code>cmdParams</code>), and so the loop will also execute that as the last command."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518956127, "post_id": 48849811, "comment_id": 84706458, "body": "@RaynD I think I misunderstood, thought you have to run one last command if all other has completed. If you want to run Go code, just put it after the <code>for</code> loop, since if any previous command fails, it returns, and then the code after the loop would not be reached."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1518984884, "post_id": 48849811, "comment_id": 84715625, "body": "@RaynD Please see edited answer. I simplified it as it was overly complicated."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1518984813, "last_edit_date": 1518984813, "creation_date": 1518942949, "answer_id": 48849811, "question_id": 48849625, "link": "https://stackoverflow.com/questions/48849625/running-command-and-get-the-output-online/48849811#48849811", "title": "Running command and get the output online", "body": "<p>Using the solution presented in this answer: <a href=\"https://stackoverflow.com/questions/30725751/streaming-commands-output-progress/30726590#30726590\">Streaming commands output progress</a></p>\n\n<pre><code>cmdParams := [][]string{\n    {filepath.Join(dir, path), \"npm\", \"install\"},\n    {filepath.Join(pdir, n.path), \"gulp\"},\n}\nfor _, cp := range cmdParams {\n    log.Printf(\"Starting %s in folder %s...\", cp[1:], cp[0])\n    cmd := exec.Command(cp[1], cp[2:]...)\n    cmd.Dir = cp[0]\n\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        log.Printf(\"%s cmd.StdoutPipe() error: %v\\n\", cp[1:], err)\n        return\n    }\n    // Start command:\n    if err = cmd.Start(); err != nil {\n        log.Printf(\"%s start error: %v\\n\", cp[1:], err)\n        return\n    }\n\n    // Stream command output:\n    scanner := bufio.NewScanner(stdout)\n    scanner.Split(bufio.ScanRunes)\n    for scanner.Scan() {\n        fmt.Print(scanner.Text())\n    }\n    if scanner.Err() != nil {\n        log.Printf(\"Reading %s stdout error: %v\\n\", cp[1:], err)\n        return\n    }\n\n    // Get execution success or failure:\n    if err = cmd.Wait(); err != nil {\n        log.Printf(\"Error running %s: %v\\n\", cp[1:], err)\n        return\n    }\n    log.Printf(\"Finished %s\", cp[1:])\n}\n</code></pre>\n\n<p>Some explanation:</p>\n\n<p>This line:</p>\n\n<pre><code>scanner := bufio.NewScanner(stdout)\n</code></pre>\n\n<p>Creates a <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\"><code>bufio.Scanner</code></a> that will read from the pipe that supplies the output written by the process.</p>\n\n<p>This line:</p>\n\n<pre><code>scanner.Split(bufio.ScanRunes)\n</code></pre>\n\n<p>Instructs the scanner to read the input by <code>rune</code>s instead of the default by-lines.</p>\n\n<p>Note that the above example only streams the standard output of the process. If you also need its standard error stream, you could also read from <a href=\"https://golang.org/pkg/os/exec/#Cmd.StderrPipe\" rel=\"nofollow noreferrer\"><code>Command.StderrPipe()</code></a>.</p>\n\n<p>Also note that this won't work with some commands that don't write everything to their standard output or error. For details, see <a href=\"https://stackoverflow.com/questions/37091316/how-to-get-the-realtime-output-for-a-shell-command-in-golang/37137583#37137583\">How to get the realtime output for a shell command in golang?</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6124024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 2, "accepted_answer_id": 48849811, "answer_count": 1, "score": 2, "last_activity_date": 1518984813, "creation_date": 1518940831, "last_edit_date": 1518947053, "question_id": 48849625, "link": "https://stackoverflow.com/questions/48849625/running-command-and-get-the-output-online", "title": "Running command and get the output online", "body": "<p>I use the following code which works, The problem is that the output is printed just as the process finished to execute,\nI want to print to the screen the output live and not provide all the output when the process finishes, how can I achieve this?</p>\n\n<pre><code>cmdParams := [][]string{\n    {filepath.Join(dir,path), \"npm\", \"install\"},\n    {filepath.Join(pdir,n.path), \"gulp\"},\n}\n\nfor _, cp := range cmdParams {\n    log.Printf(\"Starting %s in folder %s...\", cp[1:], cp[0])\n    cmd := exec.Command(cp[1], cp[2:]...)\n    cmd.Dir = cp[0]\n    // Wait to finish, get output:\n    out, err := cmd.Output()\n    if err != nil {\n        log.Printf(\"Error running %s: %v\\n\", cp[1:], err)\n        return\n    }\n    log.Println(\"Finished %s, output: %s\", cp[1:], out)\n}\n</code></pre>\n\n<p><strong>update</strong> when trying the proposed solution I got the output like</p>\n\n<pre><code>2018/02/18 11:11:57  Starting [npm install] in folder ...\n2018/02/18 11:12:14 adde\n2018/02/18 11:12:14 d 56\n2018/02/18 11:12:14 3 pa\n2018/02/18 11:12:14 ckag\n2018/02/18 11:12:14 es i\n2018/02/18 11:12:14 n 15\n2018/02/18 11:12:14 .477\n2018/02/18 11:12:14 s\n2018/02/18 11:12:14 Finished %s [npm install]\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518940264, "post_id": 48849551, "comment_id": 84702694, "body": "you can use mock libraries. If you wants to create test cases without touching actual database"}, {"owner": {"reputation": 7927, "user_id": 5214807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aq31b.jpg?s=128&g=1", "display_name": "Saleem", "link": "https://stackoverflow.com/users/5214807/saleem"}, "edited": false, "score": 0, "creation_date": 1518954834, "post_id": 48849551, "comment_id": 84706048, "body": "You can make a copy of database but keep in mind, it&#39;s very expensive operation. see <a href=\"https://docs.mongodb.com/manual/reference/method/db.copyDatabase/\" rel=\"nofollow noreferrer\">docs.mongodb.com/manual/reference/method/db.copyDatabase</a>"}, {"owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "edited": false, "score": 0, "creation_date": 1518974125, "post_id": 48849551, "comment_id": 84712173, "body": "Take a look here: <a href=\"https://github.com/kubedb/cli/blob/master/docs/guides/mongodb/quickstart/quickstart.md\" rel=\"nofollow noreferrer\">github.com/kubedb/cli/blob/master/docs/guides/mongodb/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1518945144, "last_edit_date": 1518945144, "creation_date": 1518940388, "answer_id": 48849569, "question_id": 48849551, "link": "https://stackoverflow.com/questions/48849551/how-to-get-dump-of-mongodb-in-golang-and-restore-it/48849569#48849569", "title": "how to get dump of mongodb in golang and restore it", "body": "<p>There are mock libraries available which can be used to mock databases when creating test cases to check the database.No needs to dump database and run test cases on that. And then Restore to get your original data. Try this <a href=\"https://github.com/cfsalguero/test_mongo_mock\" rel=\"nofollow noreferrer\">library</a></p>\n\n<p>It is installing some packages for mongo db mock test cases</p>\n"}], "owner": {"reputation": 555, "user_id": 8337498, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8b22e7b8121ee9ea74b80f0783247a02?s=128&d=identicon&r=PG&f=1", "display_name": "taraf", "link": "https://stackoverflow.com/users/8337498/taraf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 858, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1552507839, "creation_date": 1518940205, "last_edit_date": 1552507839, "question_id": 48849551, "link": "https://stackoverflow.com/questions/48849551/how-to-get-dump-of-mongodb-in-golang-and-restore-it", "title": "how to get dump of mongodb in golang and restore it", "body": "<p>I am using MongoDB as database and mgo and mogo libraries in Go. I want to get a dump of my DB and restore it to write some utility methods to write unit test. my purpose is to dump the database then test my functions and after all restore it. Can you help me how can I do it using mogo or mgo?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1518965018, "post_id": 48849493, "comment_id": 84709168, "body": "The question displays absense of even a minimal research as skimming through any inctoructory material on Go should have covered it."}, {"owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1518972652, "post_id": 48849493, "comment_id": 84711655, "body": "&quot;inctoructory&quot; is&#39;t russian word?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1518972805, "post_id": 48849493, "comment_id": 84711715, "body": "It should have been introductory. I&#39;m pretty sure that were Putin&#39;s hackers controlling my fat fingers, as they usually do."}], "answers": [{"comments": [{"owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "edited": false, "score": 1, "creation_date": 1518941218, "post_id": 48849643, "comment_id": 84702890, "body": "yes, figure it out -&gt; <a href=\"https://golangbot.com/variadic-functions\" rel=\"nofollow noreferrer\">golangbot.com/variadic-functions</a> already thx."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 10, "last_activity_date": 1529424860, "last_edit_date": 1529424860, "creation_date": 1518940996, "answer_id": 48849643, "question_id": 48849493, "link": "https://stackoverflow.com/questions/48849493/go-variadic-function-argument-passing/48849643#48849643", "title": "Go variadic function argument passing", "body": "<p>According to <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">Golang language specification</a> </p>\n\n<blockquote>\n  <p>If f is variadic with a final parameter p of type ...T, then within f\n  the type of p is equivalent to type []T. If f is invoked with no\n  actual arguments for p, the value passed to p is nil. Otherwise, the\n  value passed is a new slice of type []T with a new underlying array\n  whose successive elements are the actual arguments, which all must be\n  assignable to T. The length and capacity of the slice is therefore the\n  number of arguments bound to p and may differ for each call site.</p>\n</blockquote>\n\n<p><code>variadic</code> functions are used to handle multiple trailing arguments. It can be used to pass slice arguments.</p>\n\n<pre><code>func main(){\n  capacities := []float64{1, 2, 3, 4}\n  generateReport(capacities...)\n}\n\nfunc generateReport(capacities ...float64) {\n    for i, cap := range capacities {\n        fmt.Printf(\"Plant %d capacity %.0f\\n\", i, cap)\n    }\n}\n</code></pre>\n\n<p>Variadic functions can also be called in usual way with individual arguments. It works like spread operator in java script which can take multiple arguments. For eg:-</p>\n\n<pre><code>func main(){\n  generateReport(1,2,3,4)\n}\n\nfunc generateReport(capacities ...float64) {\n    for i, cap := range capacities {\n        fmt.Printf(\"Plant %d capacity %.0f\\n\", i, cap)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 5237, "user_id": 2325924, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/XSXrT.jpg?s=128&g=1", "display_name": "7urkm3n", "link": "https://stackoverflow.com/users/2325924/7urkm3n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1058, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1538137605, "creation_date": 1518939610, "last_edit_date": 1518972648, "question_id": 48849493, "link": "https://stackoverflow.com/questions/48849493/go-variadic-function-argument-passing", "title": "Go variadic function argument passing", "body": "<p>I am trying to understand, What is difference between 1st and 2nd passing argument in function. In both case methods are functional and compiles. </p>\n\n<p>1)</p>\n\n<pre><code>generateReport(capacities...)\n\nfunc generateReport(capacities ...float64) {\n    for i, cap := range capacities {\n        fmt.Printf(\"Plant %d capacity %.0f\\n\", i, cap)\n    }\n}\n</code></pre>\n\n<p>2)</p>\n\n<pre><code>generateReport(plantCapacities)\n\nfunc generateReport(capacities []float64) {\n    for i, cap := range capacities {\n        fmt.Printf(\"Plant %d capacity %.0f\\n\", i, cap)\n    }\n}\n</code></pre>\n\n<p><strong>Have found few good samples</strong> </p>\n\n<p>1) <a href=\"https://golangbot.com/variadic-functions/\" rel=\"nofollow noreferrer\">GolangBot - Variadic Function</a></p>\n\n<p>2) <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">Golang.org - Passing arguments</a> as @Himanshu mentioned.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1519053587, "post_id": 48848067, "comment_id": 84741864, "body": "How would the compiler know what it does, or what it&#39;s supposed to do?"}], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 3, "last_activity_date": 1518924114, "creation_date": 1518924114, "answer_id": 48848129, "question_id": 48848067, "link": "https://stackoverflow.com/questions/48848067/which-guarantees-does-an-interface-provide/48848129#48848129", "title": "Which guarantees does an interface provide?", "body": "<p>Effectively, yes. A value implements a given interface as long as it has methods with the correct names and signatures. Whether or not those methods actually do the expected thing has to be ensured by humans.</p>\n"}], "owner": {"reputation": 113, "user_id": 8807932, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9858abf46f35cb7cb47666ab28c4feb4?s=128&d=identicon&r=PG&f=1", "display_name": "MadsRC", "link": "https://stackoverflow.com/users/8807932/madsrc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 48848129, "answer_count": 1, "score": -3, "last_activity_date": 1518987585, "creation_date": 1518923396, "last_edit_date": 1518987585, "question_id": 48848067, "link": "https://stackoverflow.com/questions/48848067/which-guarantees-does-an-interface-provide", "title": "Which guarantees does an interface provide?", "body": "<p>According to \u201cThe Go Programming Language\u201d an interface can be seen as a contract. A value that satisfies, say io.Writer, guarantees that there\u2019s a Write method with a specific signature.</p>\n\n<p>But am I right to assume that there is no guarantee as to what that method does? In the case of io.Writer, the Write method could just as well read from the p argument?</p>\n"}, {"tags": ["rest", "http", "go", "server", "grpc"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1518917807, "post_id": 48847633, "comment_id": 84699306, "body": "&quot;is that still possible?&quot; Of course, why wouldn&#39;t it?"}, {"owner": {"reputation": 333, "user_id": 6883735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653be59056c9284703a10d4d31aa76dd?s=128&d=identicon&r=PG&f=1", "display_name": "efxgamer", "link": "https://stackoverflow.com/users/6883735/efxgamer"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1518918012, "post_id": 48847633, "comment_id": 84699338, "body": "i&#39;m not super familiar with like server-side stuff so I was thinking that if it was a gRPC server, it wouldn&#39;t be able to make http calls to outside endpoints like (GET, POST)"}], "answers": [{"comments": [{"owner": {"reputation": 333, "user_id": 6883735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653be59056c9284703a10d4d31aa76dd?s=128&d=identicon&r=PG&f=1", "display_name": "efxgamer", "link": "https://stackoverflow.com/users/6883735/efxgamer"}, "edited": false, "score": 0, "creation_date": 1519084456, "post_id": 48851917, "comment_id": 84755791, "body": "this is only for if a user requests a rest call to my gRPC server is it not?"}, {"owner": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "reply_to_user": {"reputation": 333, "user_id": 6883735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653be59056c9284703a10d4d31aa76dd?s=128&d=identicon&r=PG&f=1", "display_name": "efxgamer", "link": "https://stackoverflow.com/users/6883735/efxgamer"}, "edited": false, "score": 0, "creation_date": 1519127724, "post_id": 48851917, "comment_id": 84773924, "body": "you can do any design with that as you have all building blocks here,  re your question yes it is: use your client to call gRCP server from REST"}], "tags": [], "owner": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "is_accepted": false, "score": 1, "last_activity_date": 1518961686, "last_edit_date": 1518961686, "creation_date": 1518958557, "answer_id": 48851917, "question_id": 48847633, "link": "https://stackoverflow.com/questions/48847633/how-can-a-grpc-server-make-calls-to-rest-endpoints/48851917#48851917", "title": "How can a gRPC server make calls to REST endpoints", "body": "<p>You would need to use <code>grcp-gateway</code> to generate proxy full code available on <a href=\"https://github.com/phuongdo/go-grpc-tutorial\" rel=\"nofollow noreferrer\">go-grpc-tutorial</a> thanks to <code>phuongdo</code><a href=\"https://i.stack.imgur.com/IJ5ov.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/IJ5ov.png\" alt=\"enter image description here\"></a></p>\n\n<ol>\n<li><p>install deps:</p>\n\n<pre><code>$sudo apt install libprotobuf-dev\n\ngo get google.golang.org/grpc\n\ngo get -u github.com/golang/protobuf/{proto,protoc-gen-go}\n\ngo get -u github.com/grpc-ecosystem/grpc-gateway/protoc-gen-grpc-gateway\n</code></pre></li>\n<li><p>define service, pb/service.proto:</p>\n\n<pre><code>syntax = \"proto3\";\n\noption go_package = \"echo\";\n\npackage echo;\n\nimport \"google/api/annotations.proto\";\n\n  //Message represents a simple message sent to the Echo service.\n\n message Message {\n\n string id = 1;\n\nstring msg = 2;\n}\n\n\n //Echo service responds to incoming echo requests.\n\nservice EchoService {\n\n  //Echo method receives a simple message and returns it.\n\n   //The message posted as the id parameter will also be returned.\n\nrpc Echo(Message) returns (Message) {\n\noption (google.api.http) = {\n\n    post: \"/v1/example/echo/{id}/{msg}\"\n};\n}\n}\n</code></pre></li>\n<li><p>generate stub for server and clinet</p>\n\n<pre><code>$ protoc -I/usr/local/include -I. \\\n-I$GOPATH/src \\\n-I$GOPATH/src/github.com/grpc-ecosystem/grpc-\n gateway/third_party/googleapis \\\n --go_out=google/api/annotations.proto=github.com/grpc-ecosystem/grpc-\n gateway/third_party/googleapis/google/api,plugins=grpc:. \\\n pb/service.proto\n</code></pre></li>\n<li><p>and <code>reverse proxy</code> for <code>REST API</code></p>\n\n<pre><code>$ protoc -I/usr/local/include -I. \\\n-I$GOPATH/src \\\n-I$GOPATH/src/github.com/grpc-ecosystem/grpc-\n gateway/third_party/googleapis \\\n--grpc-gateway_out=logtostderr=true:. \\\npb/service.proto\n</code></pre></li>\n<li><p>server/server.go:</p>\n\n<pre><code>package main\n\nimport (\n\"flag\"\n\n\"github.com/golang/glog\"\npb \"github.com/go-grpc-tutorial/pb\"\n\"golang.org/x/net/context\"\n\"google.golang.org/grpc\"\n\"net\"\n)\n\n// Implements of EchoServiceServer\n\ntype echoServer struct{}\n\nfunc newEchoServer() pb.EchoServiceServer {\nreturn new(echoServer)\n}\n\nfunc (s *echoServer) Echo(ctx context.Context, msg *pb.Message) \n (*pb.Message, error) {\nglog.Info(msg)\nreturn msg, nil\n}\n\nfunc Run() error {\nlisten, err := net.Listen(\"tcp\", \":50051\")\nif err != nil {\n    return err\n}\nserver := grpc.NewServer()\npb.RegisterEchoServiceServer(server, newEchoServer())\nserver.Serve(listen)\nreturn nil\n}\n\nfunc main() {\nflag.Parse()\ndefer glog.Flush()\n\nif err := Run(); err != nil {\n    glog.Fatal(err)\n}\n}\n</code></pre></li>\n<li><p>write rest api, server/server-rproxy.go:</p>\n\n<pre><code>package main\n\n import (\n\"flag\"\n\"net/http\"\n\"github.com/grpc-ecosystem/grpc-gateway/runtime\"\n\"github.com/golang/glog\"\npb \"github.com/go-grpc-tutorial/pb\"\n\"golang.org/x/net/context\"\n\"google.golang.org/grpc\"\n )\n\n var (\nechoEndpoint = flag.String(\"echo_endpoint\", \"localhost:50051\", \n\"endpoint of EchoService\")\n )\n\nfunc RunEndPoint(address string, opts ...runtime.ServeMuxOption) \n error {\nctx := context.Background()\nctx, cancel := context.WithCancel(ctx)\ndefer cancel()\n\nmux := runtime.NewServeMux(opts...)\ndialOpts := []grpc.DialOption{grpc.WithInsecure()}\nerr := pb.RegisterEchoServiceHandlerFromEndpoint(ctx, mux, *echoEndpoint, dialOpts)\nif err != nil {\n    return err\n}\n\nhttp.ListenAndServe(address, mux)\nreturn nil\n }\n\nfunc main() {\nflag.Parse()\ndefer glog.Flush()\n\nif err := RunEndPoint(\":8080\"); err != nil {\n    glog.Fatal(err)\n}\n }\n</code></pre></li>\n<li><p>build client server/client.go:</p>\n\n<pre><code> package main\n\nimport (\n\"log\"\n\"os\"\n\n\"golang.org/x/net/context\"\n\"google.golang.org/grpc\"\npb \"github.com/go-grpc-tutorial/pb\"\n)\n\n const (\naddress = \"localhost:50051\"\n defaultName = \"PhuongDV\"\n)\n\nfunc main() {\n// Set up a connection to the server.\nconn, err := grpc.Dial(address, grpc.WithInsecure())\nif err != nil {\n    log.Fatalf(\"did not connect: %v\", err)\n}\ndefer conn.Close()\nc := pb.NewEchoServiceClient(conn)\n\n// Contact the server and print out its response.\nname := defaultName\nif len(os.Args) &gt; 1 {\n    name = os.Args[1]\n}\nr, err := c.Echo(context.Background(), &amp;pb.Message{Id: \"1\", Msg: name})\nif err != nil {\n    log.Fatalf(\"could not greet: %v\", err)\n}\nlog.Printf(\"Greeting: %s\", r.Msg)\n}\n</code></pre></li>\n<li><p>finally run server, client, rest and call rest:</p>\n\n<pre><code>$ go run server/server.go\n\n$ go run client/client.go\n\n\n$go run server/server-rproxy.go\n\n $ curl -X POST \"http://localhost:8080/v1/example/echo/1/PhuongDV\"\n</code></pre>\n\n<p><a href=\"https://github.com/phuongdo/go-grpc-tutorial\" rel=\"nofollow noreferrer\">1</a>: <a href=\"https://github.com/phuongdo/go-grpc-tutorial\" rel=\"nofollow noreferrer\">https://github.com/phuongdo/go-grpc-tutorial</a>\n  <a href=\"https://i.stack.imgur.com/IJ5ov.png\" rel=\"nofollow noreferrer\">2</a>: <a href=\"https://i.stack.imgur.com/C4s7s.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/C4s7s.png</a></p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 333, "user_id": 6883735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653be59056c9284703a10d4d31aa76dd?s=128&d=identicon&r=PG&f=1", "display_name": "efxgamer", "link": "https://stackoverflow.com/users/6883735/efxgamer"}, "edited": false, "score": 0, "creation_date": 1519084422, "post_id": 48855080, "comment_id": 84755777, "body": "so the gateway on the answer below is only necessary if I want to allow a client to make a REST request to a gRPC server"}], "tags": [], "owner": {"reputation": 1276, "user_id": 539923, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/052ca1aa8363b84b1789af72c25f8b3a?s=128&d=identicon&r=PG", "display_name": "Ulas Keles", "link": "https://stackoverflow.com/users/539923/ulas-keles"}, "is_accepted": true, "score": 2, "last_activity_date": 1518978075, "creation_date": 1518978075, "answer_id": 48855080, "question_id": 48847633, "link": "https://stackoverflow.com/questions/48847633/how-can-a-grpc-server-make-calls-to-rest-endpoints/48855080#48855080", "title": "How can a gRPC server make calls to REST endpoints", "body": "<p>Yes, it is possible. You can make calls to other APIs and services from your own gRPC service code. </p>\n\n<p>Just let your client make a call to your gRPC service. Then, your service makes a REST call to external API (possibly using arguments from client request to your gRPC service) and processes it. Return the result to your client however your gRPC service responds.</p>\n"}], "owner": {"reputation": 333, "user_id": 6883735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/653be59056c9284703a10d4d31aa76dd?s=128&d=identicon&r=PG&f=1", "display_name": "efxgamer", "link": "https://stackoverflow.com/users/6883735/efxgamer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3618, "favorite_count": 1, "accepted_answer_id": 48855080, "answer_count": 2, "score": 1, "last_activity_date": 1518978075, "creation_date": 1518917691, "question_id": 48847633, "link": "https://stackoverflow.com/questions/48847633/how-can-a-grpc-server-make-calls-to-rest-endpoints", "title": "How can a gRPC server make calls to REST endpoints", "body": "<p>I'm currently new to gRPC technology and have been reading up on it.</p>\n\n<p>My current understanding is that <code>gRPC</code> is just another protocol just like how <code>REST</code> is one. Now lets say I spin up a gRPC server that I want clients to consume, but in that gRPC server I'd like to be able to get information from outside consumer RESTful Apis, (for example <a href=\"https://developer.riotgames.com/api-methods/\" rel=\"nofollow noreferrer\">https://developer.riotgames.com/api-methods/</a>) is that still possible? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 1, "creation_date": 1518900689, "post_id": 48845760, "comment_id": 84695685, "body": "Error message is exact. Just remove indirection in function signature func writeSomething(writer io.Writer) you need not it any case"}, {"owner": {"reputation": 11, "user_id": 9374748, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-stJiHk4LhP0/AAAAAAAAAAI/AAAAAAAAAcI/yThbk29-Pw8/photo.jpg?sz=128", "display_name": "Robi", "link": "https://stackoverflow.com/users/9374748/robi"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1518901697, "post_id": 48845760, "comment_id": 84695957, "body": "Ok thanks, that works. But I would still be interested why the first version works even though it does the sam thing"}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1518905863, "post_id": 48845760, "comment_id": 84697025, "body": "In <code>main</code> you convert <code>file</code> to interface <code>io.Writer</code> and then pass <code>writeSomething</code> a pointer to the interface which is just what <code>writeSomething</code> expects."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1518906029, "post_id": 48845760, "comment_id": 84697060, "body": "In <code>main2</code> you have a pointer to <code>os.File</code> and then pass a pointer to that pointer to <code>writeSomething</code>. Go cannot convert that to a pointer to interface <code>io.Writer</code>."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 9374748, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-stJiHk4LhP0/AAAAAAAAAAI/AAAAAAAAAcI/yThbk29-Pw8/photo.jpg?sz=128", "display_name": "Robi", "link": "https://stackoverflow.com/users/9374748/robi"}, "edited": false, "score": 0, "creation_date": 1518958913, "post_id": 48851397, "comment_id": 84707241, "body": "Ok, thank you for the explanation. I obviously have not yet fully understood how interfaces in go work. Coming from C++ and Java something of type io.Writer does look a lot like an object and I didn&#39;t want to pass it around by value."}], "tags": [], "owner": {"reputation": 1477, "user_id": 8279560, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af2d53514074e4972b6049a3b35729ec?s=128&d=identicon&r=PG", "display_name": "Pavlo Strokov", "link": "https://stackoverflow.com/users/8279560/pavlo-strokov"}, "is_accepted": true, "score": 2, "last_activity_date": 1518955186, "creation_date": 1518955186, "answer_id": 48851397, "question_id": 48845760, "link": "https://stackoverflow.com/questions/48845760/go-pointer-to-type-is-incompatible-with-interface/48851397#48851397", "title": "Go: Pointer to type is incompatible with interface", "body": "<p>You shouldn't use pointers to interfaces, it is a bad practice in Go.<br>\nAnd about code that doesn't compile - when you create an intermediate variable <code>logWriter</code> you allocate an interface variable, that has its own allocated memory to describe what it stores (actual type) and a reference to the actual structure.<br>\nThat is why <code>&amp;logWriter</code> and <code>&amp;file</code> have different types.<br>\nBut as I sad previously, you should not use pointers to interfaces, just use interface type and do not get address of interface type variable.</p>\n"}], "owner": {"reputation": 11, "user_id": 9374748, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-stJiHk4LhP0/AAAAAAAAAAI/AAAAAAAAAcI/yThbk29-Pw8/photo.jpg?sz=128", "display_name": "Robi", "link": "https://stackoverflow.com/users/9374748/robi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "accepted_answer_id": 48851397, "answer_count": 1, "score": 0, "last_activity_date": 1518955186, "creation_date": 1518900131, "question_id": 48845760, "link": "https://stackoverflow.com/questions/48845760/go-pointer-to-type-is-incompatible-with-interface", "title": "Go: Pointer to type is incompatible with interface", "body": "<p>I'm not sure how to formulate the question properly. I have 2 go code snippets that should do the exact same thing but apparently they don't, since one works and the other doesn't (doesn't compile)</p>\n\n<pre><code>func writeSomething(writer *io.Writer) {\n}\n\nfunc main() {\n    file, _ := os.Create(\"error.log\")\n    var logWriter io.Writer = file\n    writeSomething(&amp;logWriter)\n\n}\n\nfunc main2() {\n    file, _ := os.Create(\"error.log\")\n    writeSomething(&amp;file)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/dro4jowWZcw\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>main() works and main2() doesn't.</p>\n\n<blockquote>\n  <p>prog.go:20:17: cannot use &amp;file (type **os.File) as type *io.Writer in argument to writeSomething:\n      *io.Writer is pointer to interface, not interface</p>\n</blockquote>\n\n<p>The only difference is that I used an intermediate variable but I'm not doing any pointer referencing or dereferencing.</p>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["go", "dll", "cgo"], "comments": [{"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1518909720, "post_id": 48845724, "comment_id": 84697870, "body": "What do you write on the command line when you compile the Go program?"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1518914783, "post_id": 48845724, "comment_id": 84698827, "body": "Compilation (linking, specifically) works when the dll is in lib dir because lib dir is specified explicitly as a path to search, in LDFLAGS. At runtime, the os looks for the dll file in conventional locations, one of those happens to be the binary&#39;s current dir, so putting the dll in the same dir works."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 2, "creation_date": 1518914869, "post_id": 48845724, "comment_id": 84698843, "body": "For static linking, try #cgo LDFLAGS: /path/to/library/file.a"}, {"owner": {"reputation": 37, "user_id": 5161302, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-hnP-d2Mwchk/AAAAAAAAAAI/AAAAAAAAAKc/c0D5pQSOfmg/photo.jpg?sz=128", "display_name": "Nikhil Varma", "link": "https://stackoverflow.com/users/5161302/nikhil-varma"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1518935758, "post_id": 48845724, "comment_id": 84701908, "body": "@Mark Thanks for the help, is there a way to dynamically route to the link library other than copying the .dll ?"}, {"owner": {"reputation": 37, "user_id": 5161302, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-hnP-d2Mwchk/AAAAAAAAAAI/AAAAAAAAAKc/c0D5pQSOfmg/photo.jpg?sz=128", "display_name": "Nikhil Varma", "link": "https://stackoverflow.com/users/5161302/nikhil-varma"}, "reply_to_user": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1518935881, "post_id": 48845724, "comment_id": 84701924, "body": "@md2perpe I simply run <b>go build hello.go</b>"}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1518942034, "post_id": 48845724, "comment_id": 84703064, "body": "There&#39;s a flag <code>-linkshared</code> with description &quot;link against shared libraries previously created with -buildmode=shared&quot;. Have you tried to add that?"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 2, "creation_date": 1518949797, "post_id": 48845724, "comment_id": 84704733, "body": "@NikhilVarma the various ways to find shared libraries depends on the operating system. <a href=\"https://stackoverflow.com/questions/2463243/dll-search-on-windows\">This may help</a>."}], "owner": {"reputation": 37, "user_id": 5161302, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-hnP-d2Mwchk/AAAAAAAAAAI/AAAAAAAAAKc/c0D5pQSOfmg/photo.jpg?sz=128", "display_name": "Nikhil Varma", "link": "https://stackoverflow.com/users/5161302/nikhil-varma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 715, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1518906791, "creation_date": 1518899918, "last_edit_date": 1518906791, "question_id": 48845724, "link": "https://stackoverflow.com/questions/48845724/go-program-runs-only-when-dynamic-library-dll-is-in-same-location-as-the-go", "title": "Go program runs only when dynamic library(.dll) is in same location as the .go/.exe file", "body": "<p>I am trying to write a go program in <strong>windows</strong> by importing a dynamic link library that I built. In order to build the go program using these custom .dll files, I am using cgo's CFLAGS and LDFLAGS in go source file. The code looks like this:</p>\n\n<pre><code>/*\n#cgo CFLAGS: -I${SRCDIR}/lib\n#cgo LDFLAGS: -L${SRCDIR}/lib -lkeyboard\n#include &lt;keyboard.h&gt;\n*/\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"Hello word\\n\")\n    C.InitKeyboard()\n\n    fmt.Printf(\"\\nEnter: \")\n\n    for {\n        r := C.GetCharacter()\n\n        fmt.Printf(\"%c\", r)\n\n        if r == 'q' {\n            break\n        }\n    }\n\n    C.Closeboard()\n}\n</code></pre>\n\n<p>My directory structure:</p>\n\n<pre><code>src\n|_hello.go\n|_lib\n----|_keyboard.h\n----|_keyboard.c\n----|_libkeyboard.dll\n</code></pre>\n\n<p>The header (.h) and dynamic link library (.dll) are kept in a folder called 'lib' which is present in the same level as .go program file, this code compiles/builds but when I run the built .exe file it throws an error 'libkeyboard.dll not found', but works when I place the libkeyboard.dll is the same location as the compiled .exe file.\nI want to understand why is it able to fetch the library file from the mentioned path (./lib) during compile time but failing to do the same during runtime.\nI know creating <strong>PATH</strong> variable will help it to locate but why does it not work without setting <strong>PATH</strong> when I've already given the library files location CFLAGS and LDFLAGS.</p>\n\n<p>And how do I make it work for static library file 'libkeyboard.a' because as I observe the built .exe file searches for libkeyboard.dll file and does not accept the libkeyboard.a file.</p>\n"}, {"tags": ["go", "native", "gnu-make", "glide-golang"], "comments": [{"owner": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 2, "creation_date": 1518896426, "post_id": 48845138, "comment_id": 84694616, "body": "You might want to start looking into using containers. That way you determine the full installation and avoid these conflicts."}, {"owner": {"reputation": 13, "user_id": 6506291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c52bdb484f2310c3223313a1c42e31de?s=128&d=identicon&r=PG&f=1", "display_name": "Al Star", "link": "https://stackoverflow.com/users/6506291/al-star"}, "reply_to_user": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 0, "creation_date": 1518900592, "post_id": 48845138, "comment_id": 84695664, "body": "That&#39;s a good point, I&#39;m doing this for services, but in this case using docker container is not desirable - this is a wide purpose utility that might be run on &quot;old fashioned&quot; non-containerized environments. Though this is a good illustration how use of containers can simplify development and deployment."}, {"owner": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 0, "creation_date": 1518910131, "post_id": 48845138, "comment_id": 84697931, "body": "Then you have two possible other solutions to prevent issues: 1) Document which lib to use and only guarantee that lib, or 2) compile on the users system (Not a 100% guarantee with go with the way they use C bindings, but should catch most situations)"}, {"owner": {"reputation": 13, "user_id": 6506291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c52bdb484f2310c3223313a1c42e31de?s=128&d=identicon&r=PG&f=1", "display_name": "Al Star", "link": "https://stackoverflow.com/users/6506291/al-star"}, "reply_to_user": {"reputation": 5548, "user_id": 4625526, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6378aa788195a771461c5043057e2ed5?s=128&d=identicon&r=PG&f=1", "display_name": "Norbert van Nobelen", "link": "https://stackoverflow.com/users/4625526/norbert-van-nobelen"}, "edited": false, "score": 0, "creation_date": 1518912321, "post_id": 48845138, "comment_id": 84698351, "body": "That&#39;s a good point. 1 might be actually easier to provide for libs like sqlplus which provide version API. Checking against specific version should suffice."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1518957355, "post_id": 48845138, "comment_id": 84706819, "body": "Option 3: Compile it using docker by bind-mounting your source directory into the container <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow noreferrer\">as described in Go&#39;s official docker repo description</a>"}], "owner": {"reputation": 13, "user_id": 6506291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c52bdb484f2310c3223313a1c42e31de?s=128&d=identicon&r=PG&f=1", "display_name": "Al Star", "link": "https://stackoverflow.com/users/6506291/al-star"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1518896037, "creation_date": 1518896037, "question_id": 48845138, "link": "https://stackoverflow.com/questions/48845138/link-specific-version-of-c-library-to-golang-program", "title": "Link specific version of C library to golang program", "body": "<p>I develop a utility in Go that requires recent version of sqlite. I'm interested only in targeting specific architecture, to be specific: x64 linux. I'm developing that utility on Mac OS X. I'm using <a href=\"https://github.com/mattn/go-sqlite3\" rel=\"nofollow noreferrer\">go-sqlite3 driver</a>. I use GNU Make + Glide to build my utility. In order to cross compile on my Mac I pass specific arch flags to make.</p>\n\n<p>Repos on Linux platforms that I'm targeting usually have quite old versions of sqlite that don't have features that I need in my utility.</p>\n\n<p>I can manually compile and install required version of sqlite on all the platforms that I need, but it is quite cumbersome. I wonder if there is a good way to either statically link a specific version of sqlite or somehow bundle a utility with specific version of sqlite dynamic library.</p>\n\n<p>Even though I mention sqlite a lot, this question can be generalized to other libraries: how to bundle a golang app with a specific version of C library an outdated version of which may be installed on the target platform.</p>\n\n<p>Also: how to better organize development of that utility so that other devs won't need to manually compile and install specific version of the library - the preference is to use Makefile that would build all the binaries for required target platform. I see that I can just copy code of specific version of library (e.g. sqlite) to my utility's repo though I wonder if there is a better option - maybe I can somehow use glide dependencies for that purpose and build library that I need as part of my other dependencies.</p>\n"}, {"tags": ["go", "ibm-cloud", "ibm-cloud-infrastructure"], "answers": [{"comments": [{"owner": {"reputation": 708, "user_id": 3160958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/001ae56ecc1a0ecddf4d0a67be62b6e0?s=128&d=identicon&r=PG", "display_name": "renier", "link": "https://stackoverflow.com/users/3160958/renier"}, "edited": false, "score": 0, "creation_date": 1519075854, "post_id": 48873731, "comment_id": 84752784, "body": "The call is to the account service, so according to the article you linked, why should it go against SoftLayer_Hardware_ServerObjectMask? From the article: &quot;For instance, an object mask for the SoftLayer_Account API service has the name SoftLayer_AccountObjectMask and the SoftLayer_Hardware_Server service&#39;s corresponding object mask class name is SoftLayer_Hardware_ServerObjectMask.&quot;"}, {"owner": {"reputation": 1119, "user_id": 7703646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NBDP3.png?s=128&g=1", "display_name": "Albert Camacho", "link": "https://stackoverflow.com/users/7703646/albert-camacho"}, "reply_to_user": {"reputation": 708, "user_id": 3160958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/001ae56ecc1a0ecddf4d0a67be62b6e0?s=128&d=identicon&r=PG", "display_name": "renier", "link": "https://stackoverflow.com/users/3160958/renier"}, "edited": false, "score": 0, "creation_date": 1519084073, "post_id": 48873731, "comment_id": 84755687, "body": "@renier is right. The ObjectMask should reference to the same service.  I updated this post in order to provide an alternative solution and avoid any confusion."}, {"owner": {"reputation": 55, "user_id": 9374028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48cc1fa17a2085fafa79664488347f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Cohen", "link": "https://stackoverflow.com/users/9374028/aaron-cohen"}, "edited": false, "score": 0, "creation_date": 1519089848, "post_id": 48873731, "comment_id": 84757213, "body": "Thank you for the answer. How do I submit a defect against the API?"}, {"owner": {"reputation": 1119, "user_id": 7703646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NBDP3.png?s=128&g=1", "display_name": "Albert Camacho", "link": "https://stackoverflow.com/users/7703646/albert-camacho"}, "edited": false, "score": 0, "creation_date": 1519142822, "post_id": 48873731, "comment_id": 84783993, "body": "You can submit a ticket in SoftLayer, but keep in mind that Legacy-Object-Mask is an old version and it could take a while to fix it since the new version of ObjectMasks called Extended-Object-Mask is currently the most supported and it is available since several years ago. <a href=\"https://sldn.softlayer.com/article/object-Masks\" rel=\"nofollow noreferrer\">sldn.softlayer.com/article/object-Masks</a>"}], "tags": [], "owner": {"reputation": 1119, "user_id": 7703646, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NBDP3.png?s=128&g=1", "display_name": "Albert Camacho", "link": "https://stackoverflow.com/users/7703646/albert-camacho"}, "is_accepted": true, "score": 0, "last_activity_date": 1519084166, "last_edit_date": 1519084166, "creation_date": 1519072321, "answer_id": 48873731, "question_id": 48843367, "link": "https://stackoverflow.com/questions/48843367/mask-and-filter-are-not-working-when-using-the-softlayer-api/48873731#48873731", "title": "Mask and filter are not working when using the SoftLayer API", "body": "<p>The code you posted works when using the default endpoint or any other REST endpoint. It seems an issue from API, I recommend to switch to the default endpoint or use:</p>\n\n<p><code>https://api.softlayer.com/rest/v3.1</code></p>\n"}], "owner": {"reputation": 55, "user_id": 9374028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48cc1fa17a2085fafa79664488347f2a?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Cohen", "link": "https://stackoverflow.com/users/9374028/aaron-cohen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 48873731, "answer_count": 1, "score": 2, "last_activity_date": 1519084166, "creation_date": 1518884709, "question_id": 48843367, "link": "https://stackoverflow.com/questions/48843367/mask-and-filter-are-not-working-when-using-the-softlayer-api", "title": "Mask and filter are not working when using the SoftLayer API", "body": "<p>When I add billingItemFlag to my mask and filter it is missing in the results. I am using the <a href=\"https://github.com/softlayer/softlayer-go\" rel=\"nofollow noreferrer\">SoftLayer-go</a> api from the <a href=\"https://github.com/softlayer/softlayer-go\" rel=\"nofollow noreferrer\">SoftLayer GitHub</a> account. Is my filter or mask wrong? </p>\n\n<p>Please consider the following code:</p>\n\n<pre><code>const mask string = \"id;hostname;domain;billingItemFlag;billingItem\"\nvar filters = filter.Build(\n    filter.Path(\"billingItemFlag\").NotNull(),\n    filter.Path(\"billingItem\").NotNull(),\n)\naccountService := services.GetAccountService(softlayerSession)\nhardware, err := accountService.Filter(filters).Mask(mask).Limit(1).GetHardware()\nif err != nil {\n    panic(err)\n}\nprintln(hardware[0].BillingItemFlag)\n</code></pre>\n\n<p>The result of this code is \"0x0\" which is an invalid memory address.</p>\n\n<p>When I enable debugging I can see the fields are not being returned but domain, hostname, and others are. </p>\n\n<pre><code>2018/02/17 11:08:08 -&gt;&gt;&gt;Request:\n2018/02/17 11:08:08 POST /xmlrpc/v3.1/SoftLayer_Account HTTP/1.1\nHost: api.softlayer.com\nUser-Agent: Go-http-client/1.1\nContent-Length: 1875\nContent-Type: text/xml\nAccept-Encoding: gzip\n\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;methodCall&gt;&lt;methodName&gt;getHardware&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;headers&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;User-Agent&lt;/name&gt;&lt;value&gt;&lt;string&gt;softlayer-go/v0.1.0-alpha (go1.9.2;amd64;darwin)&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;authenticate&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;username&lt;/name&gt;&lt;value&gt;&lt;string&gt;REMOVED&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;apiKey&lt;/name&gt;&lt;value&gt;&lt;string&gt;REMOVED&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;SoftLayer_AccountObjectMask&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;mask&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;hostname&lt;/name&gt;&lt;value&gt;&lt;array&gt;&lt;data&gt;&lt;/data&gt;&lt;/array&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;domain&lt;/name&gt;&lt;value&gt;&lt;array&gt;&lt;data&gt;&lt;/data&gt;&lt;/array&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;billingItemFlag&lt;/name&gt;&lt;value&gt;&lt;array&gt;&lt;data&gt;&lt;/data&gt;&lt;/array&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;billingItem&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;recurringFee&lt;/name&gt;&lt;value&gt;&lt;array&gt;&lt;data&gt;&lt;/data&gt;&lt;/array&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;id&lt;/name&gt;&lt;value&gt;&lt;array&gt;&lt;data&gt;&lt;/data&gt;&lt;/array&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;SoftLayer_AccountObjectFilter&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;billingItem&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;operation&lt;/name&gt;&lt;value&gt;&lt;string&gt;not null&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;billingItemFlag&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;operation&lt;/name&gt;&lt;value&gt;&lt;string&gt;not null&lt;/string&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;resultLimit&lt;/name&gt;&lt;value&gt;&lt;struct&gt;&lt;member&gt;&lt;name&gt;limit&lt;/name&gt;&lt;value&gt;&lt;int&gt;1&lt;/int&gt;&lt;/value&gt;&lt;/member&gt;&lt;member&gt;&lt;name&gt;offset&lt;/name&gt;&lt;value&gt;&lt;int&gt;0&lt;/int&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/member&gt;&lt;/struct&gt;&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt;\n2018/02/17 11:08:09 \n\n&lt;&lt;&lt;-Response:\n2018/02/17 11:08:09 HTTP/1.1 200 OK\nConnection: close\nCache-Control: private\nContent-Type: text/xml\nDate: Sat, 17 Feb 2018 16:08:08 GMT\nNtcoent-Length: 3031\nServer: Apache\nSoftlayer-Total-Items: 402\nVary: Accept-Encoding\nX-Frame-Options: SAMEORIGIN\n\n&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;params&gt;\n&lt;param&gt;\n &lt;value&gt;\n  &lt;struct&gt;\n   &lt;member&gt;\n    &lt;name&gt;accountId&lt;/name&gt;\n    &lt;value&gt;\n     &lt;int&gt;REMOVED&lt;/int&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;bareMetalInstanceFlag&lt;/name&gt;\n    &lt;value&gt;\n     &lt;int&gt;0&lt;/int&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;domain&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt;REMOVED&lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;fullyQualifiedDomainName&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt;REMOVED&lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;hardwareStatusId&lt;/name&gt;\n    &lt;value&gt;\n     &lt;int&gt;5&lt;/int&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;hostname&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt;REMOVED&lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;id&lt;/name&gt;\n    &lt;value&gt;\n     &lt;int&gt;REMOVED&lt;/int&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;manufacturerSerialNumber&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt;REMOVED&lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;notes&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string/&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;provisionDate&lt;/name&gt;\n    &lt;value&gt;\n     &lt;stringREMOVED&lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;serialNumber&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt; REMOVED&lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;serviceProviderId&lt;/name&gt;\n    &lt;value&gt;\n     &lt;int&gt;1&lt;/int&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;serviceProviderResourceId&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string/&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;globalIdentifier&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt; REMOVED &lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;networkManagementIpAddress&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt;1 REMOVED 0&lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;primaryBackendIpAddress&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt; REMOVED 4&lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;primaryIpAddress&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt; REMOVED &lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;privateIpAddress&lt;/name&gt;\n    &lt;value&gt;\n     &lt;string&gt; REMOVED&lt;/string&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;hardwareFunction&lt;/name&gt;\n    &lt;value&gt;\n     &lt;struct&gt;\n      &lt;member&gt;\n       &lt;name&gt;code&lt;/name&gt;\n       &lt;value&gt;\n        &lt;string&gt;WEBSVR&lt;/string&gt;\n       &lt;/value&gt;\n      &lt;/member&gt;\n      &lt;member&gt;\n       &lt;name&gt;description&lt;/name&gt;\n       &lt;value&gt;\n        &lt;string&gt;Web Server&lt;/string&gt;\n       &lt;/value&gt;\n      &lt;/member&gt;\n      &lt;member&gt;\n       &lt;name&gt;id&lt;/name&gt;\n       &lt;value&gt;\n        &lt;int&gt;3&lt;/int&gt;\n       &lt;/value&gt;\n      &lt;/member&gt;\n     &lt;/struct&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n   &lt;member&gt;\n    &lt;name&gt;hardwareStatus&lt;/name&gt;\n    &lt;value&gt;\n     &lt;struct&gt;\n      &lt;member&gt;\n       &lt;name&gt;id&lt;/name&gt;\n       &lt;value&gt;\n        &lt;int&gt;5&lt;/int&gt;\n       &lt;/value&gt;\n      &lt;/member&gt;\n      &lt;member&gt;\n       &lt;name&gt;status&lt;/name&gt;\n       &lt;value&gt;\n        &lt;string&gt;ACTIVE&lt;/string&gt;\n       &lt;/value&gt;\n      &lt;/member&gt;\n     &lt;/struct&gt;\n    &lt;/value&gt;\n   &lt;/member&gt;\n  &lt;/struct&gt;\n &lt;/value&gt;\n&lt;/param&gt;\n&lt;/params&gt;\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1518886336, "post_id": 48843358, "comment_id": 84691509, "body": "seems to work fine. But you will get an empty string when you hit enter without anything written. If you don&#39;t want that, check for empty string and increment the count only when string is not empty"}, {"owner": {"reputation": 23, "user_id": 2780227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0ff9a159dd308a471aed63c8dae874?s=128&d=identicon&r=PG&f=1", "display_name": "paumanok", "link": "https://stackoverflow.com/users/2780227/paumanok"}, "reply_to_user": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1518888433, "post_id": 48843358, "comment_id": 84692227, "body": "I may have forgotten to mention, but its an automated input without any actual keyboard intervention. ie ./learntris &lt; input.txt. So in this input there are no empty lines until the end"}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1518888824, "post_id": 48843358, "comment_id": 84692355, "body": "I made a sample file with some data and it worked. Sure i&#39;m not missing anything ?"}, {"owner": {"reputation": 23, "user_id": 2780227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0ff9a159dd308a471aed63c8dae874?s=128&d=identicon&r=PG&f=1", "display_name": "paumanok", "link": "https://stackoverflow.com/users/2780227/paumanok"}, "reply_to_user": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1518910405, "post_id": 48843358, "comment_id": 84697976, "body": "I updated with my more complete implentation and the example input. It will work copy and pasted as a single block into the stdin of the running program, but not when piped from a text file."}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1518935751, "post_id": 48843358, "comment_id": 84701906, "body": "<a href=\"https://play.golang.org/p/pR8zeUexa1j\" rel=\"nofollow noreferrer\">play.golang.org/p/pR8zeUexa1j</a> The following program gave me this output. <a href=\"https://play.golang.org/p/nTvjKgzUFyf\" rel=\"nofollow noreferrer\">play.golang.org/p/nTvjKgzUFyf</a>"}], "owner": {"reputation": 23, "user_id": 2780227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e0ff9a159dd308a471aed63c8dae874?s=128&d=identicon&r=PG&f=1", "display_name": "paumanok", "link": "https://stackoverflow.com/users/2780227/paumanok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 123, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518912218, "creation_date": 1518884650, "last_edit_date": 1518912218, "question_id": 48843358, "link": "https://stackoverflow.com/questions/48843358/reading-stdin-with-scanner-without-oef", "title": "Reading stdin with scanner without OEF", "body": "<p>I'm learning Go and as an initial project, I'm trying the Learntris challenge. </p>\n\n<p>Here you must take input separated by a newline from stdin. I've been reading about readers vs scanners and how scanners are the appropriate level of abstraction for most things. </p>\n\n<p>Here I'm using a scanner to check for single character commands and on the command 'g' I need to read 22 lines separated by '\\n'. I think the way I'm treating the scanner might be wrong as I keep receiving empty arrays. my code can be seen here:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"bufio\"\n    \"os\"\n    \"learntris/internal/pkg/matrix\"\n)\n\nfunc main() {\n    board := matrix.Create_mat()\n    scanner := bufio.NewScanner(os.Stdin)\n\n    for scanner.Scan() {\n\n        text := scanner.Text()\n        char := text[0]\n        switch {\n        case char == 'q':\n            //quit\n            os.Exit(3)\n        case char == 'p':\n            //print the state of the matrix\n            matrix.Print_mat(board)\n\n        case char == 'g':\n            given(&amp;board)\n            matrix.Print_mat(board)\n        default:\n            //still quit\n            fmt.Println(\"case not hit\")\n            os.Exit(3)\n        }\n    }\n}\n\nfunc given(board *([][]rune)) {\n    scanner := bufio.NewScanner(os.Stdin)\n\n    i := 0\n    for scanner.Scan() {\n        if i == 21 { break} //only read 22 lines\n        fmt.Println(scanner.Text())\n        //will modify board here once scanner is sorted out \n        i++\n    }\n}\n</code></pre>\n\n<p>updated given function:</p>\n\n<pre><code>func given(board *([][]rune)) {\n    //fmt.Println(\"got to given\")\n    //expecting 22 lines of 10 items separated by spaces\n    scanner := bufio.NewScanner(os.Stdin)\n\n    i := 0 //my iterator for num lines(rows)\n    for scanner.Scan() {\n        //fmt.Println(\"scanning\")\n        text := scanner.Text()\n        if len(text) &gt;= 10{\n            //fmt.Println(text)\n            //need to split and throw away spaces\n            split_line := strings.Split(text, \" \")\n            for j, j_str := range(split_line){\n                (*board)[i][j] = rune(j_str[0])\n            }\n            i++\n\n        }\n\n        if i == 22 {break} //stop at 22 lines\n    }\n\n}\n</code></pre>\n\n<p>This can take an input like this: </p>\n\n<pre><code>g\n. . . . . . . . . .\n. . . . . . . . . .\n. . . . . . . . . .\n. . . . . . . . . .\nm m m m m m m m m m\nb b b b b b b b b b\nc c c c c c c c c c\ng g g g g g g g g g\ny y y y y y y y y y\no o o o o o o o o o\nr r r r r r r r r r\n. . . . . . . . . .\n. . . . . . . . . .\n. . . . . . . . . .\n. . . . . . . . . .\nc . . . . . . . . .\nc . . . . . . . . .\nc . . . . g . . . .\nc . . o . g g . . .\n. . . o . b g . . .\n. m r r o o b y y .\nm m m r r b b y y .\np\nq\n</code></pre>\n\n<p>passed via standard in. When copy and pasted into the programs input manually, it works fine but when the same text is given via ./learntris &lt; input.txt, it will land in the default in the switch case and never take in the matrix via given.</p>\n\n<p>I think the issue lies in the difference between manual input and streaming over stdin but I'm not sure what I should change.</p>\n\n<p>Final edit:</p>\n\n<pre><code>func given(board *([][]rune), scanner *bufio.Scanner) {\n    //expecting 22 lines of 10 items separated by spaces\n    i := 0 //my iterator for num lines(rows)\n    for scanner.Scan() {\n        text := scanner.Text()\n        if len(text) &gt;= 10{\n            //fmt.Println(text)\n            //need to split and throw away spaces\n            split_line := strings.Split(text, \" \")\n            for j, j_str := range(split_line){\n                (*board)[i][j] = rune(j_str[0])\n            }\n            i++\n\n        }\n\n        if i == 22 {break} //stop at 22 lines\n    }\n    if scanner.Err() != nil{\n        fmt.Println(scanner.Err())\n    }\n\n}\n</code></pre>\n\n<p>by passing the scanner into the function, the scanner no longer lost its intended place and didn't try to consume the matrix as the next command.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1518884662, "post_id": 48843267, "comment_id": 84690904, "body": "Maybe just don/t wait for first series, second waitGroup.Wait() statement only looks enough for me"}, {"owner": {"reputation": 97, "user_id": 8226424, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2bcc00cc849529549ab8bdb8490e4091?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Kirwan", "link": "https://stackoverflow.com/users/8226424/alex-kirwan"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1518885483, "post_id": 48843267, "comment_id": 84691187, "body": "@Uvelichitel thanks for the reply. Yes, maybe I have just added the second wait as an experiment."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1518887498, "post_id": 48843267, "comment_id": 84691921, "body": "I mean - leave the second wait and remove the first"}], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 1, "last_activity_date": 1519449024, "last_edit_date": 1519449024, "creation_date": 1519448485, "answer_id": 48959546, "question_id": 48843267, "link": "https://stackoverflow.com/questions/48843267/go-routines-and-depending-functions/48959546#48959546", "title": "Go routines and depending functions", "body": "<p>If you want to wait for all of the first series to complete, then you can just pass in a pointer to your waitgroup, wait after calling all the first series functions (which will call <code>Done()</code> on the waitgroup), and then start the second series.  Here's a runnable annotated code example that does that:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc first(wg *sync.WaitGroup) {\n    defer wg.Done()\n    fmt.Println(\"Starting a first\")\n    // do some stuff... here's a sleep to make some time pass\n    time.Sleep(250 * time.Millisecond)\n    fmt.Println(\"Done with a first\")\n}\n\nfunc second(wg *sync.WaitGroup) {\n    defer wg.Done()\n    fmt.Println(\"Starting a second\")\n    // do some followup stuff\n    time.Sleep(50 * time.Millisecond)\n    fmt.Println(\"Done with a second\")\n}\n\nfunc main() {\n    wg := new(sync.WaitGroup) // you'll need a pointer to avoid a copy when passing as parameter to goroutine function\n\n    // let's start 5 firsts and then wait for them to finish\n    wg.Add(5)\n    go first(wg)\n    go first(wg)\n    go first(wg)\n    go first(wg)\n    go first(wg)\n    wg.Wait()\n\n    // now that we're done with all the firsts, let's do the seconds\n    // how about two of these\n    wg.Add(2)\n    go second(wg)\n    go second(wg)\n    wg.Wait()\n\n    fmt.Println(\"All done\")\n}\n</code></pre>\n\n<p>It outputs:</p>\n\n<pre><code>Starting a first\nStarting a first\nStarting a first\nStarting a first\nStarting a first\nDone with a first\nDone with a first\nDone with a first\nDone with a first\nDone with a first\nStarting a second\nStarting a second\nDone with a second\nDone with a second\nAll done\n</code></pre>\n\n<p>But if you want a \"second\" to start as soon as a \"first\" has finished, just have the seconds executing blocking receive operators on the channel while the firsts are running:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"math/rand\"\n    \"sync\"\n    \"time\"\n)\n\nfunc first(res chan int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    fmt.Println(\"Starting a first\")\n    // do some stuff... here's a sleep to make some time pass\n    time.Sleep(250 * time.Millisecond)\n    fmt.Println(\"Done with a first\")\n    res &lt;- rand.Int() // this will block until a second is ready\n}\n\nfunc second(res chan int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    fmt.Println(\"Wait for a value from first\")\n    val := &lt;-res // this will block until a first is ready\n    fmt.Printf(\"Starting a second with val %d\\n\", val)\n    // do some followup stuff\n    time.Sleep(50 * time.Millisecond)\n    fmt.Println(\"Done with a second\")\n}\n\nfunc main() {\n    wg := new(sync.WaitGroup) // you'll need a pointer to avoid a copy when passing as parameter to goroutine function\n    ch := make(chan int)\n\n    // lets run first twice, and second once for each first result, for a total of four workers:\n    wg.Add(4)\n    go first(ch, wg)\n    go first(ch, wg)\n    // don't wait before starting the seconds\n    go second(ch, wg)\n    go second(ch, wg)\n    wg.Wait()\n\n    fmt.Println(\"All done\")\n}\n</code></pre>\n\n<p>Which outputs:</p>\n\n<pre><code>Wait for a value from first\nStarting a first\nStarting a first\nWait for a value from first\nDone with a first\nStarting a second with val 5577006791947779410\nDone with a first\nStarting a second with val 8674665223082153551\nDone with a second\nDone with a second\nAll done\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 8226424, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2bcc00cc849529549ab8bdb8490e4091?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Kirwan", "link": "https://stackoverflow.com/users/8226424/alex-kirwan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 48959546, "answer_count": 1, "score": 1, "last_activity_date": 1519449024, "creation_date": 1518883901, "question_id": 48843267, "link": "https://stackoverflow.com/questions/48843267/go-routines-and-depending-functions", "title": "Go routines and depending functions", "body": "<p>there I am having some fun with GO and am just very curious about something I am trying to achieve. I have a package here that just gets a feed from Reddit noting special. When I receive the parent JSON file I would then like to retrieve child data. If you see the code below I launch a series of goroutines which I then block, waiting for them to finish using the <code>sync</code> package. What I would like is once the first series of goroutines finish the second series of goroutines using the previous results. There are a few was I was thinking such as for loop and switch statement. But what is the best and most efficient way to do this </p>\n\n<pre><code>func (m redditMatcher) retrieve(dataPoint *collect.DataPoint) (*redditCommentsDocument, error) {\n    if dataPoint.URI == \"\" {\n        return nil, errors.New(\"No datapoint uri provided\")\n    }\n\n    // Get options data -&gt; returns empty struct\n    // if no options are present\n    options := m.options(dataPoint.Options)\n    if len(options.subreddit) &lt;= 0 {\n        return nil, fmt.Errorf(\"Matcher fail: Reddit - Subreddit option manditory\\n\")\n    }\n\n    // Create an buffered channel to receive match results to display.\n    results := make(chan *redditCommentsDocument, len(options.subreddit))\n\n    // Generte requests for each subreddit produced using\n    // goroutines concurency model\n    for _, s := range options.subreddit {\n        // Set the number of goroutines we need to wait for while\n        // they process the individual subreddit.\n        waitGroup.Add(1)\n        go retrieveComment(s.(string), dataPoint.URI, results)\n    }\n\n    // Launch a goroutine to monitor when all the work is done.\n    waitGroup.Wait()\n\n    // HERE I WOULD TO CALL ANOTHER SERIES OFF GOROUTINES\n    for commentFeed := range results {\n        // HERE I WOULD LIKE TO CALL GO ROUTINES USING THE RESULTS\n        // PROVIDED FROM THE PREVIOUS FUNCTIONS\n        waitGroup.Add(1)\n        log.Printf(\"%s\\n\\n\", commentFeed.Kind)\n    }\n\n    waitGroup.Wait()\n    close(results)\n\n    return nil, nil\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 4025, "user_id": 763799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4nZd.jpg?s=128&g=1", "display_name": "basgys", "link": "https://stackoverflow.com/users/763799/basgys"}, "edited": false, "score": 0, "creation_date": 1518884897, "post_id": 48843150, "comment_id": 84690976, "body": "Can you show some key parts of your code? Normally download speed should be adjusted based on how fast you read the response body buffer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518889301, "post_id": 48843150, "comment_id": 84692498, "body": "The speed of a download depends entirely on how fast you consume it. It doesn\u2019t make sense to say that the problem is that the download is faster than you can procede, since that is the optimal situation."}, {"owner": {"reputation": 53, "user_id": 8290736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/554c380f3ea71f0b5e1326869fa36b70?s=128&d=identicon&r=PG&f=1", "display_name": "mind_religion", "link": "https://stackoverflow.com/users/8290736/mind-religion"}, "edited": false, "score": 0, "creation_date": 1518895283, "post_id": 48843150, "comment_id": 84694298, "body": "I&#39;m not asking to change speed. It&#39;s obvious that i ask to be able to controll downloading by pause/resume it"}, {"owner": {"reputation": 6967, "user_id": 7803650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WH7uu.png?s=128&g=1", "display_name": "Oswin Noetzelmann", "link": "https://stackoverflow.com/users/7803650/oswin-noetzelmann"}, "edited": false, "score": 1, "creation_date": 1518897843, "post_id": 48843150, "comment_id": 84695003, "body": "You have to implement your own reader and stop reading at whatever time you want to. See <a href=\"https://stackoverflow.com/questions/28174970/implementing-reader-interface\" title=\"implementing reader interface\">stackoverflow.com/questions/28174970/&hellip;</a>"}, {"owner": {"reputation": 53, "user_id": 8290736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/554c380f3ea71f0b5e1326869fa36b70?s=128&d=identicon&r=PG&f=1", "display_name": "mind_religion", "link": "https://stackoverflow.com/users/8290736/mind-religion"}, "edited": false, "score": 0, "creation_date": 1520004507, "post_id": 48843150, "comment_id": 85149974, "body": "Yeah but problem is Download writes to aws.WriteAtBuffer alocating memory for whole file  until downloading is done with uncontrolled speed."}], "owner": {"reputation": 53, "user_id": 8290736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/554c380f3ea71f0b5e1326869fa36b70?s=128&d=identicon&r=PG&f=1", "display_name": "mind_religion", "link": "https://stackoverflow.com/users/8290736/mind-religion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 372, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1518964431, "creation_date": 1518883199, "last_edit_date": 1518892036, "question_id": 48843150, "link": "https://stackoverflow.com/questions/48843150/is-there-some-way-to-stop-resume-file-downloading-amazon-s3", "title": "Is there some way to stop/resume file downloading amazon S3", "body": "<p>I'm downloading csv file from amazon S3 to buffer using aws-go-sdk. I want to parse and proceed it's content simultaniously with downloading. But downloading goes much faster then i can proceed file content, it results in alocating too much  memory. Is there some way to pause/resume downloading process?</p>\n\n<pre><code>buff := &amp;aws.WriteAtBuffer{}\ns3dl := s3manager.NewDownloader(awsSession)\nn, err := s3dl.Download(buff, &amp;s3.GetObjectInput{\n    Bucket: aws.String(bucket),\n    Key:    aws.String(key),\n})\nr := io.Reader(buff.Bytes())\n</code></pre>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518881557, "post_id": 48842834, "comment_id": 84689879, "body": "you can create <code>var resp int32</code> to assign int32 value to <code>resp</code> variable"}, {"owner": {"reputation": 1971, "user_id": 7765396, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8nQ1S.png?s=128&g=1", "display_name": "Hana Alaydrus", "link": "https://stackoverflow.com/users/7765396/hana-alaydrus"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1518881743, "post_id": 48842834, "comment_id": 84689929, "body": "@Himanshu OMG thankyou! I just found this answer on another question too."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1518881758, "creation_date": 1518881758, "answer_id": 48842941, "question_id": 48842834, "link": "https://stackoverflow.com/questions/48842834/cant-assign-int32-protobuf-to-int-in-go-lang/48842941#48842941", "title": "Can&#39;t assign int32 protobuf to int in Go lang", "body": "<p>Create <code>resp</code> variable of int32 type and assign <code>helloReply.Response</code> to resp variable. Like this</p>\n\n<pre><code>var resp int32\nresp = helloReply.Response\n</code></pre>\n"}], "owner": {"reputation": 1971, "user_id": 7765396, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8nQ1S.png?s=128&g=1", "display_name": "Hana Alaydrus", "link": "https://stackoverflow.com/users/7765396/hana-alaydrus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1590, "favorite_count": 0, "closed_date": 1518886166, "accepted_answer_id": 48842941, "answer_count": 1, "score": 2, "last_activity_date": 1518881758, "creation_date": 1518881055, "question_id": 48842834, "link": "https://stackoverflow.com/questions/48842834/cant-assign-int32-protobuf-to-int-in-go-lang", "closed_reason": "Duplicate", "title": "Can&#39;t assign int32 protobuf to int in Go lang", "body": "<p>So in my protobuf I have a message object</p>\n\n<pre><code>message HelloReply {\n    int32 response = 1;\n}\n</code></pre>\n\n<p>And I try to assign the response to a variable</p>\n\n<pre><code>var resp = 0\nresp = helloReply.Response\n</code></pre>\n\n<p>I got an error saying</p>\n\n<pre><code>cannot use helloReply.Response (type int32) as type int in assignment\n</code></pre>\n\n<p>P.S I'm really new to Go and Protobuf. I'm sorry if this is too basic. I already search for the solution but I think I can't find the right keyword. So I really need your help guys :(</p>\n"}, {"tags": ["go", "heroku"], "comments": [{"owner": {"reputation": 21, "user_id": 9267882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05a0828af4c948376bd38f491a91a0e5?s=128&d=identicon&r=PG&f=1", "display_name": "Igor", "link": "https://stackoverflow.com/users/9267882/igor"}, "edited": false, "score": 0, "creation_date": 1518873797, "post_id": 48841627, "comment_id": 84687451, "body": "If i build it and run the app locally, it works. <code>go build</code> <code>heroku local web</code> gives <code>[WARN] No ENV file found 16:18:32 web.1   |  Hello world! 16:18:32 web.1   Exited Successfully</code>"}, {"owner": {"reputation": 788, "user_id": 8121797, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vpBrp.jpg?s=128&g=1", "display_name": "Ostap Bregin", "link": "https://stackoverflow.com/users/8121797/ostap-bregin"}, "edited": false, "score": 0, "creation_date": 1618764978, "post_id": 48841627, "comment_id": 118695678, "body": "If you want to generate dependencies for an existing project: <code>go mod tidy</code>"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9267882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05a0828af4c948376bd38f491a91a0e5?s=128&d=identicon&r=PG&f=1", "display_name": "Igor", "link": "https://stackoverflow.com/users/9267882/igor"}, "edited": false, "score": 1, "creation_date": 1518907004, "post_id": 48845342, "comment_id": 84697275, "body": "I tried to specify that build pack <code>heroku create testheeroku7777 -b https:&#47;&#47;github.com&#47;heroku&#47;heroku-buildpack-go.git</code> but push gives the same error. Why do I need to use a vendoring tool and how can I do it?"}, {"owner": {"reputation": 2503, "user_id": 22277, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/0e1Lr.jpg?s=128&g=1", "display_name": "apg", "link": "https://stackoverflow.com/users/22277/apg"}, "reply_to_user": {"reputation": 21, "user_id": 9267882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05a0828af4c948376bd38f491a91a0e5?s=128&d=identicon&r=PG&f=1", "display_name": "Igor", "link": "https://stackoverflow.com/users/9267882/igor"}, "edited": false, "score": 0, "creation_date": 1518932027, "post_id": 48845342, "comment_id": 84701307, "body": "There are a bunch if different supported tools I use govendor, which is <a href=\"https://devcenter.heroku.com/articles/go-dependencies-via-govendor\" rel=\"nofollow noreferrer\">supported</a>. I\u2019m actually not sure why there is a hard vendoring requirement, but my guess would be that it solves the GOPATH problem in a reasonable way, without forcing you to create a src/ lib/ /bin directory structure (mimicking what GOPATH would expect)."}, {"owner": {"reputation": 1240, "user_id": 1788496, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7efebd4721a49a49058e243f01d1dd9a?s=128&d=identicon&r=PG", "display_name": "mgrenier", "link": "https://stackoverflow.com/users/1788496/mgrenier"}, "edited": false, "score": 0, "creation_date": 1549739610, "post_id": 48845342, "comment_id": 96014280, "body": "I have exactly the same issue, did you ever get it resolved?"}], "tags": [], "owner": {"reputation": 2503, "user_id": 22277, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/0e1Lr.jpg?s=128&g=1", "display_name": "apg", "link": "https://stackoverflow.com/users/22277/apg"}, "is_accepted": false, "score": 0, "last_activity_date": 1518897403, "creation_date": 1518897403, "answer_id": 48845342, "question_id": 48841627, "link": "https://stackoverflow.com/questions/48841627/cant-push-simple-golang-project-to-heroku/48845342#48845342", "title": "Can&#39;t push simple golang project to heroku", "body": "<p>Heroku doesn't have the Go runtime installed in the base image, and therefore requires that you utilize the <a href=\"https://github.com/heroku/heroku-buildpack-go\" rel=\"nofollow noreferrer\">go buildpack</a> to build your app. However, this also requires that you use a vendoring tool such as dep, or govendor, which means this very basic app, by itself, unfortunately won't work.</p>\n"}, {"tags": [], "owner": {"reputation": 775, "user_id": 5709144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/G98w2.jpg?s=128&g=1", "display_name": "amunnelly", "link": "https://stackoverflow.com/users/5709144/amunnelly"}, "is_accepted": false, "score": 2, "last_activity_date": 1577802806, "creation_date": 1577802806, "answer_id": 59545384, "question_id": 48841627, "link": "https://stackoverflow.com/questions/48841627/cant-push-simple-golang-project-to-heroku/59545384#59545384", "title": "Can&#39;t push simple golang project to heroku", "body": "<p>This issue has to do with Go\u2019s new dependency management system. Heroku is looking for a dependency management system in your project, and can\u2019t find one. That\u2019s why it\u2019s throwing an error. Even though yours is a simple project, Heroku must have a dependency-management system that it can recognise.</p>\n\n<p>Using Go modules is the <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">officially-sanctioned method</a> of dependency-management. But \u2013 and it\u2019s a big but \u2013 a surprising quirk of Go modules is that Go modules don\u2019t work for projects that are within the <code>GOPATH</code>.</p>\n\n<p>When Go started, the developers made a big thing of having all projects in one place, the <code>GOPATH</code>. All the documentation was explicit on this \u2013 this is where your go code has to stored, it won\u2019t run from anywhere else. But now, if you\u2019re writing code that needs Go modules \u2013 and any code that\u2019s going on heroku needs Go modules \u2013 the directories for that code must be outside <code>GOPATH</code>. I don\u2019t know why they don\u2019t make that more explicit, but that seems to be the way it is.</p>\n\n<p>So, to get your code working, what you need to do is:</p>\n\n<ol>\n<li><p>Move your project to somewhere outside <code>GOPATH</code> \u2013 the desktop, say,\nin the name of originality.</p></li>\n<li><p>Create a remote git repository with the same name as your current\nproject.</p></li>\n<li><p>Then create a go module file by typing, at the terminal command\nprompt in your local directory, <code>go mod init\ngithub.com/myGithubUserName/myProjectName</code></p></li>\n<li><p>Next, create a local git repository by typing <code>git init</code> in the terminal.</p></li>\n<li><p>Identify the remote repository you created earlier by typing <code>git\nremote add origin\nhttp//www.github.com/myGithubUserName/myProjectName.git</code> in the\nterminal.</p></li>\n<li><p>Write some excellent code.</p></li>\n<li><p>Type <code>git add . &amp;&amp; git commit -m \u201cfirst commit\u201d</code> at the prompt to\ncommit your code.</p></li>\n<li><p>Type <code>git push -u origin master</code> to update the remote repository.</p></li>\n</ol>\n\n<p>After all that, and only after all that, are you ready to type <code>git push heroku master</code>. The only consolation is that all should run smoothly now.</p>\n\n<p>There are earlier dependency-management systems as mentioned by other posters, like <code>govendor</code> and <code>dep</code>, but Go modules are the officially-sanctioned method and I guess we\u2019re all as well to adapt to it now as later. The most popular tutorial about Go modules seems to be this one: <a href=\"https://roberto.selbach.ca/intro-to-go-modules/\" rel=\"nofollow noreferrer\">https://roberto.selbach.ca/intro-to-go-modules/</a>. A search will find a few others too.</p>\n"}], "owner": {"reputation": 21, "user_id": 9267882, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05a0828af4c948376bd38f491a91a0e5?s=128&d=identicon&r=PG&f=1", "display_name": "Igor", "link": "https://stackoverflow.com/users/9267882/igor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1293, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1577802806, "creation_date": 1518872841, "last_edit_date": 1518873578, "question_id": 48841627, "link": "https://stackoverflow.com/questions/48841627/cant-push-simple-golang-project-to-heroku", "title": "Can&#39;t push simple golang project to heroku", "body": "<p>My project \"testheeroku7777\" consist of two files.\nmain.go:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\nfmt.Println(\"Hello world!\")\n\n}\n</code></pre>\n\n<p>Procfile:</p>\n\n<pre><code>web: testheeroku7777\n</code></pre>\n\n<p>When I push:</p>\n\n<pre><code>testheeroku7777&gt; git push heroku master\n</code></pre>\n\n<p>It gives an error:</p>\n\n<pre><code>Counting objects: 8, done.\nDelta compression using up to 8 threads.\nCompressing objects: 100% (7/7), done.\nWriting objects: 100% (8/8), 645.21 KiB | 5.92 MiB/s, done.\nTotal 8 (delta 1), reused 0 (delta 0)\nremote: Compressing source files... done.\nremote: Building source:\nremote:\nremote: -----&gt; App not compatible with buildpack: https://codon-buildpacks.s3.amazonaws.com/buildpacks/heroku/go.tgz\nremote:        More info:     https://devcenter.heroku.com/articles/buildpacks#detection-failure\nremote:\nremote:  !     Push failed\nremote: Verifying deploy...\nremote:\nremote: !       Push rejected to testheeroku7777.\nremote: To https://git.heroku.com/testheeroku7777.git\n! [remote rejected] master -&gt; master (pre-receive hook declined) \nerror: failed to push some refs to 'https://git.heroku.com/testheeroku7777.git'\n</code></pre>\n\n<p>I've read provided links but I have no idea about this error.</p>\n"}, {"tags": ["go", "concurrency", "pass-by-reference", "pass-by-value"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1518877955, "post_id": 48840879, "comment_id": 84688819, "body": "Note that this programming error is caught by the vet tool."}], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1518869464, "creation_date": 1518869464, "answer_id": 48841125, "question_id": 48840879, "link": "https://stackoverflow.com/questions/48840879/sync-waitgroup-deadlock-caused-by-pass-by-value/48841125#48841125", "title": "sync.WaitGroup deadlock caused by pass by value?", "body": "<p>WaitGroup under the hood is just a struct containing a counter guarded by mutex. Go provide arguments to functions copy_by_value way. So recurse( depth, wg) function receive only a copy of counter when passed by value. Like this:</p>\n\n<pre><code>counter := 5\nfunc(counter){\n    counter--\n    fmt.Println(counter) //will print \"4\"\n}(counter)\nfmt.Println(counter) //will be \"5\" again\n</code></pre>\n"}], "owner": {"reputation": 834, "user_id": 3456737, "user_type": "registered", "accept_rate": 24, "profile_image": "https://i.stack.imgur.com/9VsY8.jpg?s=128&g=1", "display_name": "igbgotiz", "link": "https://stackoverflow.com/users/3456737/igbgotiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 359, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1518869464, "creation_date": 1518867740, "question_id": 48840879, "link": "https://stackoverflow.com/questions/48840879/sync-waitgroup-deadlock-caused-by-pass-by-value", "title": "sync.WaitGroup deadlock caused by pass by value?", "body": "<p>There's 2 ways to write the repro:</p>\n\n<p>The 1st way, the program exits clean.</p>\n\n<pre><code>func recurse(depth int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    if depth == 0 {\n        return\n    }\n    wg.Add(1)\n    go recurse(depth - 1, wg)\n}\n\nfunc main() {\n    wg := sync.WaitGroup{}\n    wg.Add(1)\n    go recurse(3, &amp;wg)\n    wg.Wait()\n}\n</code></pre>\n\n<p>The 2nd way, the program gives \"fatal error: all goroutines are asleep - deadlock!\"</p>\n\n<pre><code>func recurse(depth int, wg sync.WaitGroup) {\n    defer wg.Done()\n    if depth == 0 {\n        return\n    }\n    wg.Add(1)\n    go recurse(depth - 1, wg)\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(1)\n    go recurse(3, wg)\n    wg.Wait()\n}\n</code></pre>\n\n<p>Would anyone kindly explain the intricate way in which the 2nd way differs from the 1st way so as to cause \"Deadlock\"?</p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1518944503, "post_id": 48839519, "comment_id": 84703543, "body": "I think this is not the purpose of ssh. it secure the connection, not suppose to  do something itself. For example you can connect to a remote bash via ssh and then use the remote bash securely.  <a href=\"https://serverfault.com/questions/167416/how-can-i-automatically-change-directory-on-ssh-login\" title=\"how can i automatically change directory on ssh login\">serverfault.com/questions/167416/&hellip;</a>"}, {"owner": {"reputation": 41, "user_id": 7821299, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdDzz.png?s=128&g=1", "display_name": "totofgo", "link": "https://stackoverflow.com/users/7821299/totofgo"}, "reply_to_user": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1518957464, "post_id": 48839519, "comment_id": 84706851, "body": "Right ssh is a way to transport a flow. But then my question would be how to listen adequately to the end of hat tunnel.  ( i have some code but i am not able to paste it)"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6924309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e1b2ca49b4283d3f0037e39d29ede0f?s=128&d=identicon&r=PG&f=1", "display_name": "Ilya T", "link": "https://stackoverflow.com/users/6924309/ilya-t"}, "is_accepted": false, "score": 1, "last_activity_date": 1542014085, "creation_date": 1542014085, "answer_id": 53258995, "question_id": 48839519, "link": "https://stackoverflow.com/questions/48839519/ssh-server-in-golang/53258995#53258995", "title": "ssh server in golang", "body": "<p>If question is still actual, you shoud use for{} cycle inside handler, and always read input. BTW, it's more suitable to use \"golang.org/x/crypto/ssh/terminal\" package.</p>\n\n<p>Here's little example:</p>\n\n<pre><code>func (s *Server) handler(sess ssh.Session) {\n...\n    term := terminal.NewTerminal(sess, \"&gt; \")\n        for {\n            line, err := term.ReadLine()\n            if err != nil {\n                break\n            }\n            response := router(line)\n            log.Println(line)\n            if response != \"\" {\n                term.Write(append([]byte(response), '\\n'))\n            }\n        }\n        log.Println(\"terminal closed\")\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 7821299, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zdDzz.png?s=128&g=1", "display_name": "totofgo", "link": "https://stackoverflow.com/users/7821299/totofgo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1907, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1542014085, "creation_date": 1518857098, "last_edit_date": 1518861058, "question_id": 48839519, "link": "https://stackoverflow.com/questions/48839519/ssh-server-in-golang", "title": "ssh server in golang", "body": "<p>I am trying the <strong>github.com/gliderlabs/ssh</strong> package in order to build a ssh server.\nThe example are working fine.\nThe code below listen and reply some text when I connect, then close the connection.</p>\n\n<p>I would like to keep it open, listening to user input (lines) and echoing \"you say : \"... but I have no idea of what to do and it seems this is too simple to be explained somewhere.</p>\n\n<p>Can someone give me an indication of what to do ?</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n\n    \"github.com/gliderlabs/ssh\"\n)\n\nfunc main() {\n    ssh.Handle(func(s ssh.Session) {\n\n        io.WriteString(s, fmt.Sprintf(\"Hello %s\\n\", s.User()))\n        io.WriteString(s, fmt.Sprintf(\"Hello 2%s\\n\", s.User()))\n        io.WriteString(s, fmt.Sprintf(\"Hello 3%s\\n\", s.User()))     \n\n        text,err:= bufio.NewReader(s).ReadString('\\n')\n        if err != nil  {\n            panic(\"GetLines: \" + err.Error())\n        }\n\n        io.WriteString(s, fmt.Sprintf(\"ton texte %s\\n\", text))   \n    })\n\n    log.Println(\"starting ssh server on port 2223...\")\n    log.Fatal(ssh.ListenAndServe(\":2223\", nil))\n}\n</code></pre>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8575780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec3da30d73e9c8092604fcb8388c526d?s=128&d=identicon&r=PG&f=1", "display_name": "ralph joseph", "link": "https://stackoverflow.com/users/8575780/ralph-joseph"}, "edited": false, "score": 0, "creation_date": 1518888698, "post_id": 48839432, "comment_id": 84692318, "body": "I want to use or. The example I provided covers only one case, I would like to add many search and replace patterns, and I was thinking to form the regexes dynamically and now I am realizing that it may not be in the scope of regex."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1518856305, "creation_date": 1518856305, "answer_id": 48839432, "question_id": 48838813, "link": "https://stackoverflow.com/questions/48838813/include-multiple-patterns-in-regex-word-break/48839432#48839432", "title": "Include multiple patterns in regex word break", "body": "<p>Why not use an \"or\":</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n\n    re := regexp.MustCompile(`(?i)^(.*)(?:Inc\\.|Incorp\\.|Incorporation\\.|Incorpa\\.)(.*)$`)\n\n    fmt.Println(re.ReplaceAllString(\"ABC Inc.\", \"${1}Inc${2}\"))\n    fmt.Println(re.ReplaceAllString(\"ABC Incorp.\", \"${1}Inc${2}\"))\n    fmt.Println(re.ReplaceAllString(\"ABC InCorporation.\", \"${1}Inc${2}\"))\n    fmt.Println(re.ReplaceAllString(\"ABC InCorpa.\", \"${1}Inc${2}\"))\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0H6fQVbwP-F\" rel=\"nofollow noreferrer\">See Playground</a>:</p>\n\n<pre><code>ABC Inc\nABC Inc\nABC Inc\nABC Inc\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 8575780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec3da30d73e9c8092604fcb8388c526d?s=128&d=identicon&r=PG&f=1", "display_name": "ralph joseph", "link": "https://stackoverflow.com/users/8575780/ralph-joseph"}, "edited": false, "score": 0, "creation_date": 1518882477, "post_id": 48839435, "comment_id": 84690166, "body": "I very much would have preferred this approach. But the pattern can be made up of multiple words which has spaces. E.g. &quot;Corp Inc&quot;"}], "tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 0, "last_activity_date": 1518856337, "creation_date": 1518856337, "answer_id": 48839435, "question_id": 48838813, "link": "https://stackoverflow.com/questions/48838813/include-multiple-patterns-in-regex-word-break/48839435#48839435", "title": "Include multiple patterns in regex word break", "body": "<p>If all you 'search &amp; replace' are done on whole words, you can simply turn your <code>string</code> into a slice of words and construct a new <code>string</code> which replaces each word present in your <code>map</code> with its counterpart:</p>\n\n<pre><code>var buffer bytes.Buffer\nfor _, word := range words {\n    if val, ok := patterns[word]; ok {\n        word = val\n    }\n    buffer.WriteString(word)\n    buffer.WriteString(\" \")\n} \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 5237517, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153254284054565/picture?type=large", "display_name": "Raymond Doran", "link": "https://stackoverflow.com/users/5237517/raymond-doran"}, "is_accepted": false, "score": 1, "last_activity_date": 1518859814, "last_edit_date": 1518859814, "creation_date": 1518857990, "answer_id": 48839633, "question_id": 48838813, "link": "https://stackoverflow.com/questions/48838813/include-multiple-patterns-in-regex-word-break/48839633#48839633", "title": "Include multiple patterns in regex word break", "body": "<p>I am not a GO developer, but a single Regular Expression pattern for what you have shown would be:</p>\n\n<hr>\n\n<pre><code>(In(c|C)(\\.|orp(\\.|a\\.|oration)))$\n</code></pre>\n\n<p>UPDATE:  Found the GO way. </p>\n\n<hr>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n\n    re := regexp.MustCompile(`(?i)^(.*)(?:Inc(?:\\.|orp(?:\\.|a|oration)??\\.))(.*)$`)\n\n    fmt.Println(re.ReplaceAllString(\"ABC Inc.\", \"${1}Inc${2}\"))\n    fmt.Println(re.ReplaceAllString(\"ABC Incorp.\", \"${1}Inc${2}\"))\n    fmt.Println(re.ReplaceAllString(\"ABC InCorporation.\", \"${1}Inc${2}\"))\n    fmt.Println(re.ReplaceAllString(\"ABC InCorpa.\", \"${1}Inc${2}\"))\n\n}\n</code></pre>\n\n<hr>\n\n<pre><code>ABC Inc\nABC Inc\nABC Inc\nABC Inc\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8575780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec3da30d73e9c8092604fcb8388c526d?s=128&d=identicon&r=PG&f=1", "display_name": "ralph joseph", "link": "https://stackoverflow.com/users/8575780/ralph-joseph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1518979494, "creation_date": 1518850488, "last_edit_date": 1518979494, "question_id": 48838813, "link": "https://stackoverflow.com/questions/48838813/include-multiple-patterns-in-regex-word-break", "title": "Include multiple patterns in regex word break", "body": "<p>I have the following program which uses regex to search for a pattern and replaces it a key word.</p>\n\n<p>Sample as shown below will replace names like \"Incorp\",\"Inc.\",\"Inc corp\" with \"Inc\".</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc replaceWholeWord(input string, patterns map[string]string) string {\n    for searchPattern, replacePattern := range patterns {\n        re, _ := regexp.Compile(`(?i)(^|\\s)` + regexp.QuoteMeta(searchPattern) + `(\\s|$)`)\n        input = re.ReplaceAllString(input, \"${1}\"+replacePattern+\"${2}\")\n    }\n    return input\n}\n\nfunc main() {\n\n    patterns := map[string]string{\"Inc.\": \"Inc\", \"Incorp.\": \"Inc\", \"Incorporation\": \"Inc\", \", Incorpa.\": \"Inc\"}\n    fmt.Println(replaceWholeWord(\"ABC Inc.\", patterns))\n    fmt.Println(replaceWholeWord(\"ABC Incorp.\", patterns))\n    fmt.Println(replaceWholeWord(\"ABC InCorp.\", patterns))\n    fmt.Println(replaceWholeWord(\"ABC InCorporation\", patterns))\n    fmt.Println(replaceWholeWord(\"ABC , InCorpa.\", patterns))\n}\n</code></pre>\n\n<p>As you can see this performance intensive as the number of patterns increase. I want to build regular expression only once and do the search and replace operation. I am facing tough time to add the those multiple\npatterns in a single regex without breaking the functionality.</p>\n\n<p>Edit:\nI modified my program to avoid building the regexes  only if the word has the pattern, this way I have avoided to the performance hit. \nPlease feel free to close the question.</p>\n"}, {"tags": ["javascript", "firebase", "google-app-engine", "go", "firebase-authentication"], "comments": [{"owner": {"reputation": 21, "user_id": 8509973, "user_type": "registered", "profile_image": "https://graph.facebook.com/2016239138401906/picture?type=large", "display_name": "tsukukobaan", "link": "https://stackoverflow.com/users/8509973/tsukukobaan"}, "edited": false, "score": 0, "creation_date": 1518844933, "post_id": 48837930, "comment_id": 84680872, "body": "Maybe a bug of the library here? <a href=\"https://github.com/firebase/firebase-admin-go/issues/52\" rel=\"nofollow noreferrer\">github.com/firebase/firebase-admin-go/issues/52</a>"}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 8509973, "user_type": "registered", "profile_image": "https://graph.facebook.com/2016239138401906/picture?type=large", "display_name": "tsukukobaan", "link": "https://stackoverflow.com/users/8509973/tsukukobaan"}, "is_accepted": false, "score": 1, "last_activity_date": 1518940663, "creation_date": 1518940663, "answer_id": 48849598, "question_id": 48837930, "link": "https://stackoverflow.com/questions/48837930/firebase-admin-sdk-go-verifyidtoken-returns-not-an-app-engine-context-error/48849598#48849598", "title": "Firebase Admin SDK GO VerifyIDToken returns not an App Engine context error", "body": "<p>It seems that in appengine Standard enviroment I had to use </p>\n\n<pre><code>ctx := appengine.NewContext(r)\n</code></pre>\n\n<p>rather than the</p>\n\n<pre><code>ctx := context.Background()\n</code></pre>\n\n<p>In an appengine request context, more complex things have to be handled since they are the API request context. On the other hand the general <code>context.Background()</code> is for general uses and therefore is not associated with incoming Http requests.</p>\n\n<p>So my solution here was to pass the <code>appengine.NewContext(r)</code> in the init.go like below.</p>\n\n<pre><code>r.POST(\"/users\", func(c *gin.Context) { up.CreateUser(c, appengine.NewContext(c.Request)) })\n</code></pre>\n\n<p>pass around this appengine context to the verify token.</p>\n\n<pre><code>func (c authClient) VerifyToken(ctx context.Context, token string) (IDToken, error) {\n    opt := option.WithCredentialsFile(\"firebasecredential.json\")\n    app, err := firebase.NewApp(ctx, nil, opt)\n    if err != nil {\n        return nil, err\n    }\n    client, err := app.Auth(ctx)\n    if err != nil {\n        return nil, err\n    }\n\n    t, err := client.VerifyIDToken(ctx, token)\n    if err != nil {\n        return nil, err\n    }\n    return idToken{t}, nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1453, "user_id": 8831875, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7b9bb7786f4f3ac167a75ed2911b2d3?s=128&d=identicon&r=PG&f=1", "display_name": "A.Queue", "link": "https://stackoverflow.com/users/8831875/a-queue"}, "is_accepted": false, "score": 0, "last_activity_date": 1519286422, "creation_date": 1519286422, "answer_id": 48922287, "question_id": 48837930, "link": "https://stackoverflow.com/questions/48837930/firebase-admin-sdk-go-verifyidtoken-returns-not-an-app-engine-context-error/48922287#48922287", "title": "Firebase Admin SDK GO VerifyIDToken returns not an App Engine context error", "body": "<p><code>VerifyIDToken</code> doesn't support context, check <a href=\"https://godoc.org/firebase.google.com/go/auth#Client.VerifyIDToken\" rel=\"nofollow noreferrer\">documentation</a>\nas of now:</p>\n\n<pre><code>func (c *Client) VerifyIDToken(idToken string) (*Token, error)\n</code></pre>\n\n<p>The <a href=\"https://github.com/firebase/firebase-admin-go/issues/52\" rel=\"nofollow noreferrer\">link</a> in your comment points to the Future Request (FR), which means it's yet to be implemented, so it is not a bug.</p>\n\n<p>You can use <a href=\"https://github.com/firebase/firebase-admin-go/tree/master/auth/auth.go#L257\" rel=\"nofollow noreferrer\"><code>VerifyIDTokenAndCheckRevoked</code></a> does:</p>\n\n<pre><code>func (c *Client) VerifyIDTokenAndCheckRevoked(ctx context.Context, idToken string) (*Token, error)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8509973, "user_type": "registered", "profile_image": "https://graph.facebook.com/2016239138401906/picture?type=large", "display_name": "tsukukobaan", "link": "https://stackoverflow.com/users/8509973/tsukukobaan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 789, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1519286422, "creation_date": 1518842588, "question_id": 48837930, "link": "https://stackoverflow.com/questions/48837930/firebase-admin-sdk-go-verifyidtoken-returns-not-an-app-engine-context-error", "title": "Firebase Admin SDK GO VerifyIDToken returns not an App Engine context error", "body": "<p>I have a user authenticated with Firebase and what I want to do is to authenticate this user on the backend(Google cloud platform / Go) as well. I followed along with the document on <a href=\"https://firebase.google.com/docs/auth/admin/verify-id-tokens\" rel=\"nofollow noreferrer\">Firebase</a></p>\n\n<p>I get the idToken on the front end and send the token on the header to the server running on my localhost with the following code.</p>\n\n<pre><code>idToken = firebase.auth().currentUser.getIdToken()\naxios({\n    method: 'POST',\n    url: 'https://localhost:8080/users',\n    headers: {\n      'Authentication-Token': idToken\n    },\n    data: {\n        name: 'My name',\n        user_name: 'my_user_name',\n        email: 'example@example.com'\n    }\n})\n</code></pre>\n\n<p>On the backend I want to verify the idToken. I first create the auth client with the following code.</p>\n\n<pre><code>opt := option.WithCredentialsFile(\"firebase_credential.json\")\napp, err := firebase.NewApp(context.Background(), nil, opt)\nclient, err := app.Auth(context.Background())\n</code></pre>\n\n<p>With the client and the idToken from the frontend I tried the code below.</p>\n\n<pre><code>t, err := client.VerifyIDToken(context.Background(), idToken)\n</code></pre>\n\n<p>How ever this throws an error of </p>\n\n<pre><code>{\"message\":\"Get https://www.googleapis.com/robot/v1/metadata/x509/securetoken@system.gserviceaccount.com: oauth2: cannot fetch token: Post https://accounts.google.com/o/oauth2/token: not an App Engine context\"}\n</code></pre>\n\n<p>I also tried to <code>curl</code> the same request to the sever but the same error came out.</p>\n\n<pre><code>curl -X POST -H \"Authentication-Token:hogehogemytoken\" -d '{\"name\":\"My name\",\"user_name\":\"my user name\",\"email\":\"example@example.com\"}' http://localhost:8080/users\n</code></pre>\n\n<p>I am quite sure that I'm sending the right token.\nAny ideas?</p>\n"}, {"tags": ["go", "function-pointers", "generic-programming"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1518890455, "post_id": 48837797, "comment_id": 84692866, "body": "While the answer is correct, this tool (by me) helps with writing generic code in a similar way and it&#39;s not usage specific <a href=\"https://github.com/dc0d/goreuse\" rel=\"nofollow noreferrer\">github.com/dc0d/goreuse</a>"}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1518858039, "post_id": 48839433, "comment_id": 84683374, "body": "In Go, <code>[]string</code> is a slice type, not an array type. Therefore, <code>StringArrayReader</code> should be <code>StringSliceReader</code>. <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a>: <a href=\"https://golang.org/ref/spec#Array_types\" rel=\"nofollow noreferrer\">Array types</a> and <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">Slice types</a>."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1518893322, "post_id": 48839433, "comment_id": 84693737, "body": "@peterSO Right, thanks for the reminder, still pretty new to Go over here."}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 2, "last_activity_date": 1518893175, "last_edit_date": 1518893175, "creation_date": 1518856320, "answer_id": 48839433, "question_id": 48837797, "link": "https://stackoverflow.com/questions/48837797/golang-function-generalization-for-different-packages/48839433#48839433", "title": "Golang function generalization for different packages", "body": "<p>The only apparent difference is:</p>\n\n<pre><code>reader := csv.NewReader(r)\n</code></pre>\n\n<p>versus:</p>\n\n<pre><code>reader := fw.NewReader(r)\n</code></pre>\n\n<p>I'm not sure what <code>fw</code> is but presumably both readers implement a common interface:</p>\n\n<pre><code>type StringSliceReader interface {\n    Read() ([]string, error)\n}\n</code></pre>\n\n<p>So you could pass the openers (<code>csv.NewReader</code> and <code>fw.NewReader</code>) as function arguments:</p>\n\n<pre><code>func getDataFromFiles(files []string, func(r io.Reader) StringArrayReader) (error, Data) {\n    //...\n}\n</code></pre>\n\n<p>but you'd need to wrap them in little functions to get around the return types:</p>\n\n<pre><code>func newCSVReader(r io.Reader) StringSliceReader {\n    return csv.NewReader(r)\n}\n\nfunc newFWReader(r io.Reader) StringSliceReader {\n    return fw.NewReader(r)\n}\n</code></pre>\n\n<p>Also, <code>defer</code> queues up things to execute when the <em>function</em> exits, not on the next iteration of a loop. So if you do this:</p>\n\n<pre><code>for _, file := range files {\n    f, err := os.Open(file)\n    if err != nil {\n        panic(err)\n        return err, data\n    }\n    defer f.Close()\n    //...\n}\n</code></pre>\n\n<p>and <code>files</code> has a hundred entries then you'll have a hundred open files before any of them are closed. You probably want to move that loop body to a separate function so that you only have one file open at a time.</p>\n\n<p>Furthermore, <code>error</code> is usually the last return value from a function so you should <code>return data, err</code> to be more idiomatic.</p>\n\n<p>The result could look something like this:</p>\n\n<pre><code>type StringSliceReader interface {\n    Read() ([]string, error)\n}\n\ntype NewReader func(r io.Reader) StringSliceReader\n\nfunc newCSVReader(r io.Reader) StringSliceReader {\n    return csv.NewReader(r)\n}\n\nfunc newFWReader(r io.Reader) StringSliceReader {\n    return fw.NewReader(r)\n}\n\nfunc getDataFrom(file string, data *Data, newReader NewReader) error {\n    f, err := os.Open(file)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n\n    r := charmap.ISO8859_1.NewDecoder().Reader(f)\n    reader := newReader(r)\n    for i := 1; ; i++ {\n        rec, err := reader.Read()\n        if i == 1 {\n            continue\n        }\n        if err != nil {\n            if err == io.EOF {\n                break\n            }\n            log.Fatal(err)\n        }\n        addWorkbook(rec, data)\n    }\n    return nil\n}\n\nfunc getDataFromFiles(files []string, newReader NewReader) (Data, error) {\n    data := Data{}\n    for _, file := range files {\n        err := getDataFrom(file, newReader, &amp;data)\n        if err != nil {\n            panic(err)\n            return data, err\n        }\n    }\n    return data, nil\n}\n</code></pre>\n\n<p>and you could say <code>getDataFromFiles(files, newCSVReader)</code> to read CSVs or <code>getDataFromFiles(files, newFWReader)</code> to read FW files. If you want to read from something else, you'd just need a <code>NewReader</code> function and something that implements the <code>StringSliceReader</code> interface.</p>\n\n<p>You might want to bury/hide the <code>charmap.ISO8859_1.NewDecoder().Reader(f)</code> stuff inside the <code>NewReader</code> functions to make it easier to read non-Latin-1 encoded files. You could also replace <code>newReader NewReader</code> with a <code>map[string]NewReader</code> in <code>getDataFromFiles</code> and choose the <code>NewReader</code> to use based on the file's extension or other format identifier.</p>\n"}], "owner": {"reputation": 941, "user_id": 2034733, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a86fc0fe696bda77e18a049f26909450?s=128&d=identicon&r=PG", "display_name": "fatih tekin", "link": "https://stackoverflow.com/users/2034733/fatih-tekin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 48839433, "answer_count": 1, "score": 0, "last_activity_date": 1518893175, "creation_date": 1518840603, "question_id": 48837797, "link": "https://stackoverflow.com/questions/48837797/golang-function-generalization-for-different-packages", "title": "Golang function generalization for different packages", "body": "<p>Imagine these functions needs to be used how can I make this calls generic so that I don't repeat almost the same code.</p>\n\n<p>with \"encoding/csv\"</p>\n\n<pre><code>func getDataFromCSVFiles(files []string) (error, Data) {\n        data := Data{}\n        for _, file := range files {\n            f, err := os.Open(file)\n            if err != nil {\n                panic(err)\n                return err, data\n            }\n            defer f.Close()\n            r := charmap.ISO8859_1.NewDecoder().Reader(f)\n            reader := csv.NewReader(r)\n            for i := 1;;i++ {\n                rec, err := reader.Read()\n                if i == 1 {\n                    //Skipping header\n                    continue\n                }\n                if err != nil {\n                    if err == io.EOF {\n                        break\n                    }\n                    //TODO log error line and csv filename\n                    log.Fatal(err)\n                }\n                addWorkbook(rec, &amp;data)\n            }\n        }\n        return nil, data\n    }\n</code></pre>\n\n<p>and with\n    import fw \"github.com/hduplooy/gofixedwidth\" which is almost the same except calling fw.NewReader</p>\n\n<pre><code>func getDataFromPRNFiles(files []string) (error, Data) {\n    data := Data{}\n    for _, file := range files {\n        f, err := os.Open(file)\n        if err != nil {\n            panic(err)\n            return err, data\n        }\n        defer f.Close()\n        r := charmap.ISO8859_1.NewDecoder().Reader(f)\n        reader := fw.NewReader(r)\n        for i := 1;;i++ {\n            rec, err := reader.Read()\n            if i == 1 {\n                //Skipping header\n                continue\n            }\n            if err != nil {\n                if err == io.EOF {\n                    break\n                }\n                //TODO log error line and csv filename\n                log.Fatal(err)\n            }\n            addWorkbook(rec, &amp;data)\n        }\n    }\n    return nil, data\n}\n</code></pre>\n"}]