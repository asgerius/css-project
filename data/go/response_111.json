[{"tags": ["go", "encoding"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1487808248, "last_edit_date": 1487808248, "creation_date": 1487807811, "answer_id": 42404578, "question_id": 42404484, "link": "https://stackoverflow.com/questions/42404484/trouble-unmarshaling-text-into-struct/42404578#42404578", "title": "Trouble unmarshaling text into struct", "body": "<p>Your structs have a different structure from the json you're providing. Marshalling the structs in your example would result in json that looks like:</p>\n\n<pre><code>{\n  \"AllAreas\": [\n    {\n      \"Area\": \"Area1\",\n      \"CmdList\": {\n        \"ListOfCommands\": [\n          {\n            \"Command\": \"cmd1\",\n            \"Description\": \"cmd1 desc\"\n          },\n          {\n            \"Command\": \"cmd2\",\n            \"Description\": \"cmd2 desc\"\n          }\n        ]\n      }\n    }\n  ]\n}\n</code></pre>\n\n<p>The json in your example can be unmarshaled directly into a <code>map[string][]CmdUnit{}</code> with the minor change of <code>CmdUnit.Description</code> to <code>CmdUnit.Desc</code>.</p>\n\n<pre><code>cmds := map[string][]CmdUnit{}\nif err := json.Unmarshal(jsonTxt, &amp;cmds); err != nil {\n    log.Fatal(\"Failed to unmarshal:\", err)\n}\nfmt.Printf(\"%+v\\n\", cmds)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/DFLYAfNLES\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DFLYAfNLES</a></p>\n"}], "owner": {"reputation": 1010, "user_id": 3326103, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06afeeee747f8c3245b1dc74f634db88?s=128&d=identicon&r=PG&f=1", "display_name": "linuxfan", "link": "https://stackoverflow.com/users/3326103/linuxfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 1, "accepted_answer_id": 42404578, "answer_count": 1, "score": 0, "last_activity_date": 1487808248, "creation_date": 1487807280, "question_id": 42404484, "link": "https://stackoverflow.com/questions/42404484/trouble-unmarshaling-text-into-struct", "title": "Trouble unmarshaling text into struct", "body": "<p>Trying to unmarshal a json text into my own struct. My struct definitions seem correct but <code>json.Unmarshal</code> doesn't return anything.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype CmdUnit struct {\n    Command     string\n    Description string\n}\n\ntype CmdList struct {\n    ListOfCommands []CmdUnit\n}\n\ntype OneCmdList struct {\n    Area    string\n    CmdList CmdList\n}\n\ntype AllCommands struct {\n    AllAreas []OneCmdList\n}\n\nfunc main() {\n    jsonTxt := `\n    {\n        \"Area1\": [{\n                \"Command\": \"cmd1\",\n                \"Desc\": \"cmd1 desc\"\n        }, {\n                \"Command\": \"cmd2\",\n                \"Desc\": \"cmd2 desc\"\n        }],\n        \"Area2\": [{\n                \"Command\": \"cmd1\",\n                \"Desc\": \"cmd1 desc\"\n        }]\n\n}\n`\n    cmds := AllCommands{}\n    if err := json.Unmarshal([]byte(jsonTxt), &amp;cmds); err != nil {\n        fmt.Println(\"Failed to unmarshal:\", err)\n    } else {\n        fmt.Printf(\"%+v\\n\", cmds)\n    }\n}\n\n\n$ go run j.go\n{AllAreas:[]}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3563, "user_id": 685540, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/4447ba1ad70d4b35cd418817d30dae9f?s=128&d=identicon&r=PG", "display_name": "atilkan", "link": "https://stackoverflow.com/users/685540/atilkan"}, "edited": false, "score": 0, "creation_date": 1487807130, "post_id": 42404058, "comment_id": 71955735, "body": "That pattern is not regular. Is this the complete output.  <code>a ab ac ad abc abd b bc bcd, c, cd</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1487832909, "post_id": 42404058, "comment_id": 71964205, "body": "See Knuth, TAOCP &#167;7.2"}], "answers": [{"comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1487911595, "post_id": 42406004, "comment_id": 72006992, "body": "To complement that answer here is a great link that gives examples on how to manipulate slices <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SliceTricks</a>"}], "tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": true, "score": 2, "last_activity_date": 1487817327, "creation_date": 1487817327, "answer_id": 42406004, "question_id": 42404058, "link": "https://stackoverflow.com/questions/42404058/how-to-list-combination-possibility-in-golang/42406004#42406004", "title": "How to list combination possibility in golang", "body": "<p>You are looking for Powerset:</p>\n\n<p>One approach is:</p>\n\n<p>Start with a <code>slice</code> with one empty element, let's call it result:</p>\n\n<p><code>[[]]</code></p>\n\n<p>Keep the previous slice, and create a new slice with first element <code>a</code> of you data structure added to you to every element in you original slice.</p>\n\n<p><code>[[]]</code> &lt;--old; <code>[[a]]</code> &lt;--new</p>\n\n<p>merge them</p>\n\n<p><code>[[], [a]]</code></p>\n\n<p>Do the same thing for second element <code>b</code>:</p>\n\n<p><code>[[], [a]]</code> &lt;--old; <code>[[b], [ab]]</code> &lt;--new</p>\n\n<p>=> <code>[[], [a], [b], [ab]]</code></p>\n\n<p>for <code>c</code>:</p>\n\n<p><code>[[], [a], [b], [ab]]</code> &lt;--old; <code>[[c], [ac], [bc], [abc]]</code> &lt;--new</p>\n\n<p>=> <code>[[], [a], [b], [ab], [c], [ac], [bc], [abc]]</code></p>\n\n<p>and so on..</p>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 709, "favorite_count": 0, "accepted_answer_id": 42406004, "answer_count": 1, "score": -1, "last_activity_date": 1487817327, "creation_date": 1487805109, "question_id": 42404058, "link": "https://stackoverflow.com/questions/42404058/how-to-list-combination-possibility-in-golang", "title": "How to list combination possibility in golang", "body": "<p>Any idea to make the best code for combination : </p>\n\n<p>with this :</p>\n\n<pre><code>letters := []string{\"a\", \"b\", \"c\", \"d\"}\n</code></pre>\n\n<p>to have : <code>a ab ac ad abc abd b bc bcd</code> etc ...</p>\n\n<p>regards and thanks</p>\n"}, {"tags": ["go", "beego"], "answers": [{"comments": [{"owner": {"reputation": 1245, "user_id": 975478, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/057a2e4b28f0ee27db450f0dece3fa6a?s=128&d=identicon&r=PG", "display_name": "xXPhenom22Xx", "link": "https://stackoverflow.com/users/975478/xxphenom22xx"}, "edited": false, "score": 0, "creation_date": 1487862768, "post_id": 42406103, "comment_id": 71984409, "body": "Can you show how I would iterate over my maps object above with multiple results?"}, {"owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "reply_to_user": {"reputation": 1245, "user_id": 975478, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/057a2e4b28f0ee27db450f0dece3fa6a?s=128&d=identicon&r=PG", "display_name": "xXPhenom22Xx", "link": "https://stackoverflow.com/users/975478/xxphenom22xx"}, "edited": false, "score": 0, "creation_date": 1487882373, "post_id": 42406103, "comment_id": 71996838, "body": "I updated the example above to handle a json array with multiple results. Basically you just need to create a slice of your structs and unmarshal into that instead."}], "tags": [], "owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "is_accepted": true, "score": 1, "last_activity_date": 1487882339, "last_edit_date": 1487882339, "creation_date": 1487818144, "answer_id": 42406103, "question_id": 42403742, "link": "https://stackoverflow.com/questions/42403742/beego-golang-query-values-to-struct/42406103#42406103", "title": "Beego/Golang - Query Values to Struct", "body": "<p>You want to use json annotations on your struct, then use <code>json.Unmarshal</code> to put the data into your struct.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    // The struct you want to store the data in\n    // Note the json tags that show which json field corresponds to which struct field\n    type Data struct {\n        FirstName string `json:\"Operator__FirstName\"`\n        LastName  string `json:\"Operator__LastName\"`\n    }\n    // Create a slice of these structs since our json is an array of results\n    var structData []Data\n\n    // The json you want to dump into the structs\n    jsonData := []byte(`[{\"Operator__FirstName\": \"Bob\", \"Operator__LastName\": \"Smith\"},{\"Operator__FirstName\": \"John\", \"Operator__LastName\": \"Adams\"}]`)\n\n    _ = json.Unmarshal(jsonData, &amp;structData)\n\n    fmt.Printf(\"%+v\", structData)\n}\n</code></pre>\n\n<p>And here it is in Go Playground: <a href=\"https://play.golang.org/p/Z2P7oUVT9i\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Z2P7oUVT9i</a></p>\n"}], "owner": {"reputation": 1245, "user_id": 975478, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/057a2e4b28f0ee27db450f0dece3fa6a?s=128&d=identicon&r=PG", "display_name": "xXPhenom22Xx", "link": "https://stackoverflow.com/users/975478/xxphenom22xx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 830, "favorite_count": 0, "accepted_answer_id": 42406103, "answer_count": 1, "score": 0, "last_activity_date": 1487882339, "creation_date": 1487803606, "question_id": 42403742, "link": "https://stackoverflow.com/questions/42403742/beego-golang-query-values-to-struct", "title": "Beego/Golang - Query Values to Struct", "body": "<p>I have an API built in Golang using the Beego framework and I have a single query that has multiple joins and then returns a JSON result.</p>\n\n<p>I was hoping there is a way for me to cast each row into a struct which has nicer key names, IE rather than \"Stage__Description\" just \"Stage\", etc... So I built a ResultMap struct with the key names I want, should I be creating a Map instead?</p>\n\n<p>Query:</p>\n\n<pre><code>type ResultMap struct {\n    Id        int\n    DateAdded time.Time\n    FirstName string\n    LastName  string\n    Username  string\n    Stage     string\n    station   string\n    status    string\n}\n\n//var maps []ResultMap\nvar maps []orm.Params\nnum, err := o.QueryTable(\"test_result_detail\").\n    Filter(\"Result__Serial\", \"121994-0001\").\n    Values(&amp;maps, \"id\", \"date_added\", \"stage__description\", \"station__station\", \"status__status\", \"operator__username\", \"operator__first_name\", \"operator__last_name\" )\n</code></pre>\n\n<p><strong>JSON RESULT</strong></p>\n\n<pre><code>[\n  {\n    \"DateAdded\": \"2016-10-20T00:00:00-05:00\",\n    \"Id\": 8306105,\n    \"Operator__FirstName\": \"Jose\",\n    \"Operator__LastName\": \"Mendez\",\n    \"Operator__Username\": \"3362\",\n    \"Stage__Description\": \"VR1 Test\",\n    \"Station__Station\": \"TS0653\",\n    \"Status__Status\": \"PASS\"\n  },\n  {\n    \"DateAdded\": \"2016-10-20T00:00:00-05:00\",\n    \"Id\": 8306465,\n    \"Operator__FirstName\": \"Jose\",\n    \"Operator__LastName\": \"Mendez\",\n    \"Operator__Username\": \"3362\",\n    \"Stage__Description\": \"QA Lab X-Ray Inspection\",\n    \"Station__Station\": \"LABEQP-0004\",\n    \"Status__Status\": \"PASS\"\n  },\n  {\n    \"DateAdded\": \"2016-10-28T00:00:00-05:00\",\n    \"Id\": 8547267,\n    \"Operator__FirstName\": \"Jose\",\n    \"Operator__LastName\": \"Mendez\",\n    \"Operator__Username\": \"3362\",\n    \"Stage__Description\": \"Capture Customer SN\",\n    \"Station__Station\": \"N/A\",\n    \"Status__Status\": \"PASS\"\n  },\n  {\n    \"DateAdded\": \"2016-10-28T00:00:00-05:00\",\n    \"Id\": 8547851,\n    \"Operator__FirstName\": \"Jose\",\n    \"Operator__LastName\": \"Mendez\",\n    \"Operator__Username\": \"3362\",\n    \"Stage__Description\": \"Final Test\",\n    \"Station__Station\": \"TS0653\",\n    \"Status__Status\": \"PASS\"\n  },\n  {\n    \"DateAdded\": \"2017-02-14T00:00:00-06:00\",\n    \"Id\": 10993864,\n    \"Operator__FirstName\": \"Jose\",\n    \"Operator__LastName\": \"Mendez\",\n    \"Operator__Username\": \"3362\",\n    \"Stage__Description\": \"QA Mechanical Final Inspection\",\n    \"Station__Station\": \"VISUAL INSPECTION\",\n    \"Status__Status\": \"PASS\"\n  }\n]\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 7607000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2186edf43a242412297dce72ccd3e4f?s=128&d=identicon&r=PG&f=1", "display_name": "avlisetan", "link": "https://stackoverflow.com/users/7607000/avlisetan"}, "edited": false, "score": 0, "creation_date": 1487886858, "post_id": 42403852, "comment_id": 71999292, "body": "Nice! this works pretty well. Using an interface type assertion is great for removing the dep. There is one case this falls apart though. Let&#39;s say at any point in the middleware chain I do a <code>context.WithValue</code>. From that point on in the chain, my <code>LoggerCtx</code> is wrapped and I can no longer access it. So if for instance I wanted another layer down the chain to supply some other data to the logger, I&#39;d have to make sure I am not using <code>contxt.WithValue</code> anywhere before that point."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "reply_to_user": {"reputation": 31, "user_id": 7607000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2186edf43a242412297dce72ccd3e4f?s=128&d=identicon&r=PG&f=1", "display_name": "avlisetan", "link": "https://stackoverflow.com/users/7607000/avlisetan"}, "edited": false, "score": 0, "creation_date": 1487891361, "post_id": 42403852, "comment_id": 72001293, "body": "Correct, that is quite the foot gun. You could keep the interface Idea and just store the logger using <code>WithValue</code> but now your package has to know about the key as well as the interface. The approach I take is to have my middleware packages supply connivence functions to access values stored on the context but that does nothing to decouple the packages."}], "tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": false, "score": 1, "last_activity_date": 1487804091, "creation_date": 1487804091, "answer_id": 42403852, "question_id": 42401197, "link": "https://stackoverflow.com/questions/42401197/way-to-pass-data-up-to-parent-middleware/42403852#42403852", "title": "Way to pass data up to parent middleware?", "body": "<p>Context itself is an interface, so you could create a new logger context in the logger middleware that has the methods you would need to get the behavior you are after.</p>\n\n<p>Something like this:</p>\n\n<pre><code>type Logger struct{}\n\nfunc (l *Logger) SetLogField(key string, value interface{}) {// set log field }\nfunc (l *Logger) Log(){// log request}\n\ntype LoggerCtx struct {\n    context.Context\n    *Logger\n}\n\nfunc newAccessLog() *Logger {\n    return &amp;Logger{}\n}\n\nfunc accessLogHandler(fn http.HandlerFunc) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        // create new logger context\n        ctx := &amp;LoggerCtx{}\n        ctx.Context = r.Context()\n        ctx.Logger = newAccessLog()\n\n        fn.ServeHTTP(w, r.WithContext(ctx))\n\n        // Logs the http access, ommit user info if not set\n        ctx.Log()\n    }\n}\n\n// pull some junk off the request/cookies/whatever and check if somebody is logged in\nfunc authHandler(fn http.HandlerFunc) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        //Do some authorization\n        user, err := auth(r)\n        if err != nil {\n            //No userId, don't set anything on the accesslogger\n            w.WriteHeader(http.StatusForbiddend)\n            return\n        }\n\n        //Success a user is logged in, let's make sure the access logger knows\n        ctx := r.Context()\n\n        // this could be moved - here for clarity\n        type setLog interface {\n            SetLogField(string, interface{})\n        }\n\n        if lctx, ok := ctx.(setLog); ok {\n            lctx.SetLogField(\"userID\", user.ID)\n        }\n\n        fn.ServeHTTP(w, r.WithContext(ctx))\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 7607000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2186edf43a242412297dce72ccd3e4f?s=128&d=identicon&r=PG&f=1", "display_name": "avlisetan", "link": "https://stackoverflow.com/users/7607000/avlisetan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 948, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1487830217, "creation_date": 1487793890, "question_id": 42401197, "link": "https://stackoverflow.com/questions/42401197/way-to-pass-data-up-to-parent-middleware", "title": "Way to pass data up to parent middleware?", "body": "<p>I've got a pretty solid grip on how to pass data from a handler to the handler it wraps, but is there a go idiomatic way to get something back from the wrapped handler? Here's a motivating example: I have an <code>accessLogHandler</code> and an <code>authHandler</code>. <code>accessLogHandler</code> logs every http request, with timings and other request info such as the currently logged in user's ID (if there is one). <code>authHandler</code> is for routes that need a logged in user, it 403's when a user isn't logged in. I want to wrap some (but perhaps not all) of my routes with the <code>authHandler</code>, and wrap all of my routes with the <code>accessLogHandler</code>. If a user is logged in, I would like my <code>accessLogHandler</code> to log the user info along with the access log.</p>\n\n<p>Now, I have a solution I've come up with that I don't like. I'll add the code and then explain some of my issues with it.</p>\n\n<pre><code>// Log the timings of each request optionally including user data\n// if there is a logged in user\nfunc accessLogHandler(fn http.HandlerFunc) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        accessLog := newAccessLog()\n        ctx := context.WithValue(r.Context(), accessLogKey, accessLog)\n        fn.ServeHTTP(w, r.WithContext(ctx))\n\n        // Logs the http access, ommit user info if not set\n        accessLog.Log()\n    }\n}\n\n// pull some junk off the request/cookies/whatever and check if somebody is logged in\nfunc authHandler(fn http.HandlerFunc) http.HandlerFunc {\n    return func (w http.ResponseWriter, r *http.Request) {\n        //Do some authorization\n        user, err := auth(r)\n        if err != nil{\n            //No userId, don't set anything on the accesslogger\n            w.WriteHeader(http.StatusForbiddend)\n            return\n        }\n        //Success a user is logged in, let's make sure the access logger knows\n        acessLog := r.Context().Value(accessLogKey).(*AccessLog)\n        accessLog.Set(\"userID\", user.ID)\n        fn.ServeHTTP(w, r)\n    }\n}\n</code></pre>\n\n<p>Basically, what I'm doing here is attaching an <code>accessLog</code> struct to my context inside the <code>accessLogHandler</code> and inside the <code>authHandler</code> I'm reading <code>accessLog</code> from the context and calling <code>accessLog.Set</code> to inform the logger that a userID is present.</p>\n\n<p>Some things I don't like about this approach:</p>\n\n<ol>\n<li>context is immutable, but I'm sticking a mutable struct on it and mutating said struct elsewhere downstream. Feels like a hack.</li>\n<li>My <code>authHandler</code> now has a package level dependency on the <code>accessLog</code> package, since I'm type asserting to <code>*AccessLog</code>.</li>\n<li>Ideally my <code>authHandler</code> would have some way of informing <em>any part of the request stack</em> about user data without tightly coupling itself to said parts.</li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487796763, "post_id": 42401006, "comment_id": 71950971, "body": "Where are you running <code>go test</code> from? Does it work when you run it with the full package name? Have you inadvertently vendored part of the stdlib?"}, {"owner": {"reputation": 19, "user_id": 2170524, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j4BVD.png?s=128&g=1", "display_name": "dzyanis", "link": "https://stackoverflow.com/users/2170524/dzyanis"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487850142, "post_id": 42401006, "comment_id": 71974837, "body": "@JimB It&#39;s inside the folder <a href=\"https://github.com/dzyanis/olyalya/tree/master/client\" rel=\"nofollow noreferrer\">dzyanis/olyalya/client</a> and it&#39;s reproduced in both situation <code>go test</code> and <code>go test client_test.go</code>"}, {"owner": {"reputation": 2180, "user_id": 1341399, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/K6sAy.jpg?s=128&g=1", "display_name": "Oskar Szura", "link": "https://stackoverflow.com/users/1341399/oskar-szura"}, "edited": false, "score": 0, "creation_date": 1495482496, "post_id": 42401006, "comment_id": 75261312, "body": "any luck with it? I&#39;m facing the same issue"}, {"owner": {"reputation": 19, "user_id": 2170524, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j4BVD.png?s=128&g=1", "display_name": "dzyanis", "link": "https://stackoverflow.com/users/2170524/dzyanis"}, "reply_to_user": {"reputation": 2180, "user_id": 1341399, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/K6sAy.jpg?s=128&g=1", "display_name": "Oskar Szura", "link": "https://stackoverflow.com/users/1341399/oskar-szura"}, "edited": false, "score": 1, "creation_date": 1495483888, "post_id": 42401006, "comment_id": 75262004, "body": "@OskarSzura unfortunately, I just reinstalled Go and everything works well."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 1037660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/036850285498721589e1663341aa276e?s=128&d=identicon&r=PG", "display_name": "Waclz", "link": "https://stackoverflow.com/users/1037660/waclz"}, "is_accepted": false, "score": 0, "last_activity_date": 1508209939, "creation_date": 1508209939, "answer_id": 46781902, "question_id": 42401006, "link": "https://stackoverflow.com/questions/42401006/cannot-find-package-testing-internal-testdeps/46781902#46781902", "title": "Cannot find package &quot;testing/internal/testdeps&quot;", "body": "<p>I fixed it by set:</p>\n\n<p>export $GOROOT=</p>\n"}], "owner": {"reputation": 19, "user_id": 2170524, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j4BVD.png?s=128&g=1", "display_name": "dzyanis", "link": "https://stackoverflow.com/users/2170524/dzyanis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 966, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1508209939, "creation_date": 1487793240, "last_edit_date": 1488022579, "question_id": 42401006, "link": "https://stackoverflow.com/questions/42401006/cannot-find-package-testing-internal-testdeps", "title": "Cannot find package &quot;testing/internal/testdeps&quot;", "body": "<p>When I try to run <code>go test</code> I've got that message:\n<code>\npackage testmain\n        imports testing/internal/testdeps: cannot find package \"testing/internal/testdeps\" in any of:\n        /usr/local/go/src/testing/internal/testdeps (from $GOROOT)\n        /Users/myname/go/src/testing/internal/testdeps (from $GOPATH)\nFAIL    github.com/dzyanis/olyalya/cmd [setup failed]\n</code>\nI think it is happened after I've installed a package manager Glide, but I'm not sure. Does anyone know how to fix that?</p>\n\n<p>UPDATE: I've reinstalled Go and everything works well. That's it.</p>\n"}, {"tags": ["generics", "go", "struct", "slice"], "answers": [{"tags": [], "owner": {"reputation": 4611, "user_id": 7511971, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Byz18.jpg?s=128&g=1", "display_name": "Ricardo Branco", "link": "https://stackoverflow.com/users/7511971/ricardo-branco"}, "is_accepted": false, "score": 0, "last_activity_date": 1487792915, "creation_date": 1487792915, "answer_id": 42400913, "question_id": 42400723, "link": "https://stackoverflow.com/questions/42400723/call-method-on-any-array-of-structs-that-have-underlying-field/42400913#42400913", "title": "Call method on any array of structs that have underlying field", "body": "<p>Generic methods require the use of interfaces and reflection.</p>\n"}, {"tags": [], "owner": {"reputation": 10538, "user_id": 547291, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/f8103125d18da197ca654c5eed34bfcf?s=128&d=identicon&r=PG", "display_name": "Bjorn Roche", "link": "https://stackoverflow.com/users/547291/bjorn-roche"}, "is_accepted": false, "score": 2, "last_activity_date": 1487793942, "creation_date": 1487793942, "answer_id": 42401217, "question_id": 42400723, "link": "https://stackoverflow.com/questions/42400723/call-method-on-any-array-of-structs-that-have-underlying-field/42401217#42401217", "title": "Call method on any array of structs that have underlying field", "body": "<p>As far as I know, there is no easy way.</p>\n\n<p>You might be tempted to use <a href=\"http://www.hydrogen18.com/blog/golang-embedding.html\" rel=\"nofollow noreferrer\">embedding</a>, but I'm not sure there's any way to make this particular task any easier. Embedding feels like subclassing but it doesn't give you the power of polymorphism.</p>\n\n<p>Polymorphism in Go is limited to methods and interfaces, not fields, so you can't access a given field by name across multiple classes.</p>\n\n<p>You could use <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflection</a> to find and access the field you are interested in by name (or tag), but there are performance penalties for that and it will make your code complex and hard to follow. Reflection is not really intended to be a substitute for Polymorphism or generics.</p>\n\n<p>I think your best solution is to use the polymorphism that Go does give you, and create an interface:</p>\n\n<pre><code>type IDable interface {\n    GetId() int64\n}\n</code></pre>\n\n<p>and make a GetId method for each of your classes. <a href=\"https://play.golang.org/p/AFii-MTKf2\" rel=\"nofollow noreferrer\">Full example</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1487840415, "last_edit_date": 1487840415, "creation_date": 1487801711, "answer_id": 42403310, "question_id": 42400723, "link": "https://stackoverflow.com/questions/42400723/call-method-on-any-array-of-structs-that-have-underlying-field/42403310#42403310", "title": "Call method on any array of structs that have underlying field", "body": "<h2>With general method on the slice itself</h2>\n\n<p>You can make it a little simpler if you define a general interface to access the ID of the <code>i</code><sup>th</sup> element of a slice:</p>\n\n<pre><code>type HasIDs interface {\n    GetID(i int) int64\n}\n</code></pre>\n\n<p>And you provide implementation for these:</p>\n\n<pre><code>func (x AList) GetID(i int) int64 { return x[i].ID }\nfunc (x BList) GetID(i int) int64 { return x[i].ID }\nfunc (x CList) GetID(i int) int64 { return x[i].ID }\n</code></pre>\n\n<p>And then one <code>GetID()</code> function is enough:</p>\n\n<pre><code>func GetIDs(s HasIDs) (ids []int64) {\n    ids = make([]int64, reflect.ValueOf(s).Len())\n    for i := range ids {\n        ids[i] = s.GetID(i)\n    }\n    return\n}\n</code></pre>\n\n<p>Note: the length of the slice may be a parameter to <code>GetIDs()</code>, or it may be part of the <code>HasIDs</code> interface. Both are more complex than the tiny reflection call to get the length of the slice, so bear with me on this.</p>\n\n<p>Using it:</p>\n\n<pre><code>as := AList{A{1}, A{2}}\nfmt.Println(GetIDs(as))\n\nbs := BList{B{3}, B{4}}\nfmt.Println(GetIDs(bs))\n\ncs := []C{C{5}, C{6}}\nfmt.Println(GetIDs(CList(cs)))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/IJxs40XZKt\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[1 2]\n[3 4]\n[5 6]\n</code></pre>\n\n<p>Note that we were able to use slices of type <code>AList</code>, <code>BList</code> etc, we did not need to use <code>interface{}</code> or <code>[]SomeIface</code>. Also note that we could also use e.g. a <code>[]C</code>, and when passing it to <code>GetIDs()</code>, we used a simple type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a>.</p>\n\n<p>This is as simple as it can get. If you want to eliminate even the <code>GetID()</code> methods of the slices, then you really need to dig deeper into reflection (<a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\"><code>reflect</code></a> package), and it will be slower. The presented solution above performs roughly the same as the \"hard-coded\" version.</p>\n\n<h2>With reflection completely</h2>\n\n<p>If you want it to be completely \"generic\", you may do it using reflection, and then you need absolutely no extra methods on anything.</p>\n\n<p>Without checking for errors, here's the solution:</p>\n\n<pre><code>func GetIDs(s interface{}) (ids []int64) {\n    v := reflect.ValueOf(s)\n    ids = make([]int64, v.Len())\n    for i := range ids {\n        ids[i] = v.Index(i).FieldByName(\"ID\").Int()\n    }\n    return\n}\n</code></pre>\n\n<p>Testing and output is (almost) the same. Note that since here parameter type of <code>GetIDs()</code> is <code>interface{}</code>, you don't need to convert to <code>CList</code> to pass a value of type <code>[]C</code>. Try it on the <a href=\"https://play.golang.org/p/k-N2NJFnMt\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h2>With embedding and reflection</h2>\n\n<p>Getting a field by specifying its name as a <code>string</code> is quite fragile (think of rename / refactoring for example). We can improve maintainability, safety, and somewhat the reflection's performance if we \"outsource\" the <code>ID</code> field and an accessor method to a separate <code>struct</code>, which we'll embed, and we capture the accessor by an interface:</p>\n\n<pre><code>type IDWrapper struct {\n    ID int64\n}\n\nfunc (i IDWrapper) GetID() int64 { return i.ID }\n\ntype HasID interface {\n    GetID() int64\n}\n</code></pre>\n\n<p>And the types all embed <code>IDWrapper</code>:</p>\n\n<pre><code>type A struct {\n    IDWrapper\n}\n\ntype B struct {\n    IDWrapper\n}\n\ntype C struct {\n    IDWrapper\n}\n</code></pre>\n\n<p>By embedding, all the embedder types (<code>A</code>, <code>B</code>, <code>C</code>) will have the <code>GetID()</code> method promoted and thus they all automatically implement <code>HasID</code>. We can take advantage of this in the <code>GetIDs()</code> function:</p>\n\n<pre><code>func GetIDs(s interface{}) (ids []int64) {\n    v := reflect.ValueOf(s)\n    ids = make([]int64, v.Len())\n    for i := range ids {\n        ids[i] = v.Index(i).Interface().(HasID).GetID()\n    }\n    return\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>as := AList{A{IDWrapper{1}}, A{IDWrapper{2}}}\nfmt.Println(GetIDs(as))\n\nbs := BList{B{IDWrapper{3}}, B{IDWrapper{4}}}\nfmt.Println(GetIDs(bs))\n\ncs := []C{C{IDWrapper{5}}, C{IDWrapper{6}}}\nfmt.Println(GetIDs(cs))\n</code></pre>\n\n<p>Output is the same. Try it on the <a href=\"https://play.golang.org/p/IQdVbKoJd2\" rel=\"nofollow noreferrer\">Go Playground</a>. Note that in this case the only method is <code>IDWrapper.GetID()</code>, no other methods needed to be defined.</p>\n"}], "owner": {"reputation": 473, "user_id": 1843013, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/306b59b1ac6f07b59f074f25da587654?s=128&d=identicon&r=PG&f=1", "display_name": "Say.My.Name.", "link": "https://stackoverflow.com/users/1843013/say-my-name"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 42403310, "answer_count": 3, "score": 1, "last_activity_date": 1487840415, "creation_date": 1487792262, "last_edit_date": 1487803479, "question_id": 42400723, "link": "https://stackoverflow.com/questions/42400723/call-method-on-any-array-of-structs-that-have-underlying-field", "title": "Call method on any array of structs that have underlying field", "body": "<p>Let's say I have a bunch of structs (around 10).</p>\n\n<pre><code>type A struct {\n    ID int64\n    ... other A-specific fields\n}\n\ntype B struct {\n    ID int64\n    ... other B-specific fields\n}\n\ntype C struct {\n    ID int64\n    ... other C-specific fields\n}\n</code></pre>\n\n<p>If I have an array of these structs at any given time (either <code>[]A</code>, <code>[]B</code>, or <code>[]C</code>), how can I write a single function that pulls the IDs from the array of structs without writing 3 (or in my case, 10) separate functions like this:</p>\n\n<pre><code>type AList []A\ntype BList []B\ntype CList []C\n\nfunc (list *AList) GetIDs() []int64 { ... }\nfunc (list *BList) GetIDs() []int64 { ... }\nfunc (list *CList) GetIDs() []int64 { ... }\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 1917, "user_id": 3158028, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea4a357ca24f6f6b54ee9bc5061aef40?s=128&d=identicon&r=PG&f=1", "display_name": "Soubriquet", "link": "https://stackoverflow.com/users/3158028/soubriquet"}, "reply_to_user": {"reputation": 6770, "user_id": 3658660, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5b40f4e2bead9eca6951da110a3c84e7?s=128&d=identicon&r=PG&f=1", "display_name": "hlscalon", "link": "https://stackoverflow.com/users/3658660/hlscalon"}, "edited": false, "score": 0, "creation_date": 1487792254, "post_id": 42400066, "comment_id": 71948425, "body": "@old_mountain That works. Sorry for the dumb question. I assumed that all objects must be JSON to be inserted into MongoDB. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 6770, "user_id": 3658660, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5b40f4e2bead9eca6951da110a3c84e7?s=128&d=identicon&r=PG&f=1", "display_name": "hlscalon", "link": "https://stackoverflow.com/users/3658660/hlscalon"}, "is_accepted": true, "score": 2, "last_activity_date": 1487792450, "creation_date": 1487792450, "answer_id": 42400775, "question_id": 42400066, "link": "https://stackoverflow.com/questions/42400066/golang-mongodb-extra/42400775#42400775", "title": "Golang Mongodb %!(EXTRA", "body": "<p><code>Insert</code> expects a pointer to a struct, not a <code>json</code> string. So, in this case, just use:</p>\n\n<pre><code>err = collection.Insert(&amp;file)\n</code></pre>\n"}], "owner": {"reputation": 1917, "user_id": 3158028, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea4a357ca24f6f6b54ee9bc5061aef40?s=128&d=identicon&r=PG&f=1", "display_name": "Soubriquet", "link": "https://stackoverflow.com/users/3158028/soubriquet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 42400775, "answer_count": 1, "score": 0, "last_activity_date": 1487792450, "creation_date": 1487790041, "question_id": 42400066, "link": "https://stackoverflow.com/questions/42400066/golang-mongodb-extra", "title": "Golang Mongodb %!(EXTRA", "body": "<p>I'm trying to marshal a struct into JSON and then insert it into my Mongo database, but keep on getting this error: <code>%!(EXTRA main.Test={575590180 Me})</code>. What am I doing wrong? I took this code exactly from another project I worked on which could insert documents without any problems.</p>\n\n<pre><code>package main\n\nimport (\n    \"utils\"\n    \"hash/fnv\"\n    \"log\"\n    \"gopkg.in/mgo.v2\"\n    \"encoding/json\"\n)\n\ntype Test struct {\n    Id   uint32\n    Name string\n}\n\nfunc ConnectDB() *mgo.Session {\n    session, err := mgo.Dial(\"localhost:27017\")\n    if err != nil {\n        panic(err)\n    }\n    return session\n}\n\nfunc SaveMgoDoc(dbName string, collectionName string, file Test) bool {\n    session, err := mgo.Dial(\"localhost:27017\")\n\n    if err != nil {\n        panic(err)\n    }\n\n    defer session.Close()\n\n    fileJson, err := json.Marshal(file)\n\n    if err != nil {\n        log.Printf(\"failed to marshal struct to json...\\n\", file)\n        return false\n    }\n\n    collection := session.DB(dbName).C(collectionName)\n    err         = collection.Insert(&amp;fileJson)\n\n    if err != nil {\n        log.Printf(\"failed to insert doc into database...\\n\", file)\n        return false\n    }\n\n    return true\n}\n\nfunc hash(s string) uint32 {\n        h := fnv.New32a()\n        h.Write([]byte(s))\n        return h.Sum32()\n}\n\nfunc main() {\n    utils.SaveMgoDoc(\"mydb\", \"mydoc\", Test{hash(\"Me\"), \"Me\"})\n}\n</code></pre>\n"}, {"tags": ["dictionary", "go", "struct"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1487787762, "post_id": 42399248, "comment_id": 71945794, "body": "You should include the definition of dialogCommands and whatever is stored in it, not just describe it to us. Best of all is a complete Go program that will run in the Go playground at <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1487787967, "post_id": 42399248, "comment_id": 71945940, "body": "@ZanLynx I updated with better information, do you think it&#39;s enough?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1487795652, "post_id": 42399248, "comment_id": 71950320, "body": "Well it isn&#39;t enough to make me interested in poking at it. I&#39;d have to write all kinds of support code and I already have a job. Maybe you&#39;ll have luck with someone else."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "edited": false, "score": 0, "creation_date": 1487820770, "post_id": 42404946, "comment_id": 71959757, "body": "Thanks, it prints in the place of &#39;struct&#39;. But how is this possible if when printed, it says it&#39;s a map?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "edited": false, "score": 0, "creation_date": 1487821308, "post_id": 42404946, "comment_id": 71959891, "body": "I mean, it prints &#39;interface&#39; as the kind, opposed to &#39;struct&#39; of before"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1487858975, "post_id": 42404946, "comment_id": 71981373, "body": "See the updated answer. What is the type of <code>dialogCommands</code>?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1487859245, "last_edit_date": 1487859245, "creation_date": 1487810085, "answer_id": 42404946, "question_id": 42399248, "link": "https://stackoverflow.com/questions/42399248/reflecting-an-slice-of-maps-each-map-is-of-type-struct/42404946#42404946", "title": "Reflecting an slice of maps, each map is of type struct?", "body": "<p>The expression <code>reflect.TypeOf(v).Kind()</code> returns the kind of <code>v</code>, not of the underlying value in <code>v</code>. The variable v has type <a href=\"https://godoc.org/reflect#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a>. This is a struct type.</p>\n\n<p>The following print statements will print what you expect assuming that <code>dialogCommands</code> is a slice of maps:</p>\n\n<pre><code>    fmt.Println(v.Kind())  // prints the kind of v's underlying value\n    fmt.Println(v)         // prints v's underlying value\n</code></pre>\n\n<p>Based on your comment on this question, it looks like <code>dialogCommands</code> is a slice of interfaces. If so, then you will want to work with the interface's element:</p>\n\n<pre><code>    if v.Kind() == reflect.Interface {\n        v = v.Elem()\n    }\n    fmt.Println(v.Kind())  \n    fmt.Println(v)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1487859245, "creation_date": 1487787268, "last_edit_date": 1487787940, "question_id": 42399248, "link": "https://stackoverflow.com/questions/42399248/reflecting-an-slice-of-maps-each-map-is-of-type-struct", "title": "Reflecting an slice of maps, each map is of type struct?", "body": "<p>I'm trying to iterate through the <code>interface</code> <code>dialogCommands</code> that is a <code>slice</code>. I can iterate through it normally, and the <code>Println</code> into each <code>Index</code> gives me a <code>map</code>. However, this <code>map</code> is being printed as having type <code>struct</code></p>\n\n<pre><code>    if reflect.TypeOf(dialogCommands).Kind() == reflect.Slice {\n    commands := reflect.ValueOf(dialogCommands)\n\n    for i:=0; i&lt;commands.Len(); i++ {\n        v := commands.Index(i)\n        fmt.Println(reflect.TypeOf(v).Kind())\n        fmt.Println(v)\n    }\n</code></pre>\n\n<p>The output from this is</p>\n\n<pre><code>struct\nmap[options:[a b c]]\nstruct\nmap[startDialogs:[dialog1]]\n</code></pre>\n\n<p>As you can see, the type is a <code>struct</code> but the output is a <code>map</code>. How to iterate through the <code>keys</code> of <code>v</code>? I cannot just treat this a map because it's of type <code>reflect.Value</code>, so I need a way to iterate through it, but as you see, the <code>kind</code> is <code>struct</code> while the <code>Println</code> says it's a <code>map</code></p>\n\n<p>Update:</p>\n\n<p>Here's the <code>Dialog</code> structure</p>\n\n<pre><code>type Dialog struct {\n    Dialog bson.Raw `json:\"dialog\" bson:\"dialog\"`\n}\n</code></pre>\n\n<p>and remember that <code>dialogCommands</code> gets unmarshaled into <code>interface{}</code></p>\n\n<pre><code>[map[options:[a b c]] map[startDialogs:[dialog1]]]\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1487787371, "post_id": 42399242, "comment_id": 71945532, "body": "Any required packages are built as needed, you don&#39;t need to do anything. You only need to build main, as <code>go build</code> on a non-main package doesn&#39;t produce any artifacts."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1487793171, "post_id": 42399242, "comment_id": 71948954, "body": "I frequently need to do this so my autocomplete works in SublimeText."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487804565, "post_id": 42399242, "comment_id": 71954738, "body": "@JimB This is incorrect. Building non-main packages builds source and places it in <code>go&#47;pkg</code>. Anything (e.g. IDE) that relies on the <code>go&#47;pkg</code> folder will benefit from being properly up to date. See my answer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1487804971, "post_id": 42399242, "comment_id": 71954880, "body": "@RayfenWindspear: no, it&#39;s correct. From the <a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"nofollow noreferrer\"><code>go build</code> docs</a>: <code>When compiling multiple packages or a single non-main package, build compiles the packages but discards the resulting object, serving only as a check that the packages can be built.</code> If you want to save the build artifacts, you can use <code>go install</code> or <code>go build -i</code>."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487805235, "post_id": 42399242, "comment_id": 71954970, "body": "@JimB Interesting... perhaps <code>margo</code> from GoSublime intercepts the results for the purpose of updating the autocompletion then? Either way, simply building my package after adding a new function (etc) updates my autocompletion."}], "answers": [{"comments": [{"owner": {"reputation": 3127, "user_id": 842860, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/oOCwG.png?s=128&g=1", "display_name": "stackoverflower", "link": "https://stackoverflow.com/users/842860/stackoverflower"}, "edited": false, "score": 1, "creation_date": 1487845677, "post_id": 42400924, "comment_id": 71971859, "body": "I tried this, but it doesn&#39;t seem to work well with <code>vendor</code>, as it tries to build things in it too and fails with dependencies not found.  Do you know how to solve this?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 3127, "user_id": 842860, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/oOCwG.png?s=128&g=1", "display_name": "stackoverflower", "link": "https://stackoverflow.com/users/842860/stackoverflower"}, "edited": false, "score": 0, "creation_date": 1487867222, "post_id": 42400924, "comment_id": 71987742, "body": "Is it giving you &quot;can&#39;t find import....&quot;? If that&#39;s the case, you need to <code>go get</code> each individual import it lists."}, {"owner": {"reputation": 167, "user_id": 1011289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8de227f341e1125c3baff291e857e461?s=128&d=identicon&r=PG", "display_name": "kmac.mcfarlane", "link": "https://stackoverflow.com/users/1011289/kmac-mcfarlane"}, "edited": false, "score": 1, "creation_date": 1610055293, "post_id": 42400924, "comment_id": 116019395, "body": "My solution to the vendor issue is simply to put my mains in ./cmd in different directories for each entrypoint. Then you can <code>go build .&#47;cmd&#47;...</code>"}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 35, "last_activity_date": 1487804402, "last_edit_date": 1487804402, "creation_date": 1487792943, "answer_id": 42400924, "question_id": 42399242, "link": "https://stackoverflow.com/questions/42399242/go-build-multiple-nested-packages/42400924#42400924", "title": "Go build multiple/nested packages?", "body": "<p>After you <code>cd</code> to the base directory, use <code>go build ./...</code> Note that there are 3 periods as it is an ellipsis. This will recursively build all subdirectories. Of course you can always do <code>go build path/to/my/base/...</code> from wherever without needing to <code>cd</code> to the directory.</p>\n\n<p>This is very useful for those who use an IDE that relies on the <code>go/pkg</code> directory, such as SublimeText3 with <a href=\"https://packagecontrol.io/packages/GoSublime\" rel=\"noreferrer\">GoSublime</a>. Making changes to a dependency package won't update the autocompletes until you build the package, which places it in the <code>go/pkg</code> directory. </p>\n\n<p>My own projects are broken into a multiple package structure, so I frequently have to <code>go build ./...</code> to update my autocompletion.</p>\n"}], "owner": {"reputation": 3127, "user_id": 842860, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/oOCwG.png?s=128&g=1", "display_name": "stackoverflower", "link": "https://stackoverflow.com/users/842860/stackoverflower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16907, "favorite_count": 6, "accepted_answer_id": 42400924, "answer_count": 1, "score": 21, "last_activity_date": 1487804402, "creation_date": 1487787246, "last_edit_date": 1487788162, "question_id": 42399242, "link": "https://stackoverflow.com/questions/42399242/go-build-multiple-nested-packages", "title": "Go build multiple/nested packages?", "body": "<p>I just started writing Go today (so 0 experience), and wonder if Go supports any form of \"building all source files\" like what <code>mvn install</code> does.</p>\n\n<p>My project structure is</p>\n\n<pre><code>src\n  `-github.com\n          `-myproject\n               |- package1\n               |     `- main.go\n               `- package2\n                     |- lib1_used_by_main.go\n                     `- lib2_used_by_main.go\n</code></pre>\n\n<p>When I do </p>\n\n<pre><code>cd src/github.com/myproject\ngo build\n</code></pre>\n\n<p>this fails with <code>no buildable Go source files in src/github.com/myproject</code>, which is kind of right, because all source files are in subpackages.</p>\n\n<p>Is there a command to build all subpackages, <em>without listing each of them explicitly</em>?</p>\n"}, {"tags": ["arrays", "mongodb", "go", "ionic-framework"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1487786411, "post_id": 42398942, "comment_id": 71944969, "body": "Update the question to show the definition of <code>results</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487786980, "post_id": 42398942, "comment_id": 71945299, "body": "Is there an error?"}, {"owner": {"reputation": 45, "user_id": 7158434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/924069c15816b3725efced6b4b8a09c4?s=128&d=identicon&r=PG&f=1", "display_name": "Racket", "link": "https://stackoverflow.com/users/7158434/racket"}, "edited": false, "score": 0, "creation_date": 1487787126, "post_id": 42398942, "comment_id": 71945386, "body": "No error. Its meant to be giving back the array not an empty array"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 7158434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/924069c15816b3725efced6b4b8a09c4?s=128&d=identicon&r=PG&f=1", "display_name": "Racket", "link": "https://stackoverflow.com/users/7158434/racket"}, "edited": false, "score": 0, "creation_date": 1487793543, "post_id": 42400803, "comment_id": 71949158, "body": "Thank you so much."}], "tags": [], "owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "is_accepted": true, "score": 1, "last_activity_date": 1487792555, "creation_date": 1487792555, "answer_id": 42400803, "question_id": 42398942, "link": "https://stackoverflow.com/questions/42398942/empty-array-being-returned/42400803#42400803", "title": "Empty Array being returned", "body": "<p>In your data the <code>Requests</code> field has a capital <code>R</code>. The <code>bson</code> library that converts the mongo document to your struct type has this to say</p>\n\n<p><a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Unmarshal\" rel=\"nofollow noreferrer\">https://godoc.org/gopkg.in/mgo.v2/bson#Unmarshal</a></p>\n\n<blockquote>\n  <p>The lowercased field name is used as the key for each exported field, but this behavior may be changed using the respective field tag.</p>\n</blockquote>\n\n<p>So your options are to either add a tag to your <code>Requests</code> field or change your data to use lowercase <code>requests</code>. If you choose the tag option it would be like</p>\n\n<pre><code>Requests []string `bson:\"Requests\"`\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 7158434, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/924069c15816b3725efced6b4b8a09c4?s=128&d=identicon&r=PG&f=1", "display_name": "Racket", "link": "https://stackoverflow.com/users/7158434/racket"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 42400803, "answer_count": 1, "score": 1, "last_activity_date": 1487792555, "creation_date": 1487786225, "last_edit_date": 1487786623, "question_id": 42398942, "link": "https://stackoverflow.com/questions/42398942/empty-array-being-returned", "title": "Empty Array being returned", "body": "<p>I have created an ionic app and I am currently stuck trying to retrieve an array back from MongoDB through Go. This is what the data in MongoDB looks like. </p>\n\n<pre><code>{\n\"_id\": {\n    \"$oid\": \"58a86fc7ad0457629d64f569\"\n},\n\"name\": \"ewds\",\n\"username\": \"affe@dsg.com\",\n\"password\": \"vdseaff\",\n\"email\": \"fawfef\",\n\"usertype\": \"Coaches\",\n\"Requests\": [\n    \"test@t.com\"\n]\n}\n</code></pre>\n\n<p>I am currently trying to get back the Requests field one of the ways I tried was trying to receive the whole document using the following code.</p>\n\n<pre><code>//this is the struct being used.\ntype (\nUser struct {\n    Name     string\n    Username string\n    Password string\n    Email    string\n    UserType string\n    Requests  []string\n}\n) \nresults := User{}\nerr = u.Find(bson.M{\"username\": Cname}).One(&amp;results)\n</code></pre>\n\n<p>This only returns the following with an empty array. </p>\n\n<pre><code>{ewds affe@dsg.com vdseaff fawfef Coaches []}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1487785050, "post_id": 42398498, "comment_id": 71944047, "body": "How about adding <code>&#47;static&#47;css&#47;</code> and <code>&#47;static&#47;js&#47;</code> instead of <code>&#47;static&#47;</code>? The same way you\u2019re doing it now, just twice and with different paths."}, {"owner": {"reputation": 109, "user_id": 6303169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ef5f622f9906108bbc136d53da0b14e1?s=128&d=identicon&r=PG&f=1", "display_name": "V. Korovin", "link": "https://stackoverflow.com/users/6303169/v-korovin"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1487785277, "post_id": 42398498, "comment_id": 71944202, "body": "@ryan this is solution, but not flexible.. some day i will use <code>&#47;css_minified&#47;</code>, and also maybe add <code>&#47;fonts&#47;</code> and <code>&#47;images&#47;</code> or some other folders. This is solution, but not elegant way."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1487785527, "post_id": 42398498, "comment_id": 71944366, "body": "Mixing your templates and static files is the thing that\u2019s considered inelegant in $current_year =) If you\u2019re able to nest <code>css</code> and <code>js</code> in another <code>assets</code> directory and place your templates in <code>templates</code> (that part\u2019s optional), that works too."}, {"owner": {"reputation": 109, "user_id": 6303169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ef5f622f9906108bbc136d53da0b14e1?s=128&d=identicon&r=PG&f=1", "display_name": "V. Korovin", "link": "https://stackoverflow.com/users/6303169/v-korovin"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1487788229, "post_id": 42398498, "comment_id": 71946094, "body": "@Ryan this is also good idea to put <code>css</code> and <code>js</code> folders into <code>&#47;assets&#47;</code>. Maybe even better then write own handler for files."}], "answers": [{"comments": [{"owner": {"reputation": 109, "user_id": 6303169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ef5f622f9906108bbc136d53da0b14e1?s=128&d=identicon&r=PG&f=1", "display_name": "V. Korovin", "link": "https://stackoverflow.com/users/6303169/v-korovin"}, "edited": false, "score": 0, "creation_date": 1487787754, "post_id": 42398889, "comment_id": 71945786, "body": "Yeah, thats what i need. Thanks. Can you please explain me, is there is possibility to turn off redirect from <code>&#47;static&#47;index.html</code> to <code>&#47;static&#47;</code>. I dont know why this happens, but it is, and only index.html, but footer.html is ok. Is there are any ways to solve this inside your func?"}, {"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "reply_to_user": {"reputation": 109, "user_id": 6303169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ef5f622f9906108bbc136d53da0b14e1?s=128&d=identicon&r=PG&f=1", "display_name": "V. Korovin", "link": "https://stackoverflow.com/users/6303169/v-korovin"}, "edited": false, "score": 0, "creation_date": 1487793041, "post_id": 42398889, "comment_id": 71948890, "body": "You would have to wrap the handler returned by <code>http.FileServer</code> and catch it there. This is not handled via <code>http.FileSystem</code> but <code>http.serveFile</code>. In any case, why would you care? The redirect leads to a 404 after following it."}], "tags": [], "owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "is_accepted": true, "score": 0, "last_activity_date": 1487786074, "creation_date": 1487786074, "answer_id": 42398889, "question_id": 42398498, "link": "https://stackoverflow.com/questions/42398498/how-to-avoid-serving-template-files-by-go/42398889#42398889", "title": "How to avoid serving template files by Go", "body": "<p>Easy way is to implement your own <code>http.FileSystem</code>:</p>\n\n<pre><code>type fileSystem struct {\n    http.FileSystem\n}\n\nfunc (fs fileSystem) Open(name string) (http.File, error) {\n    f, err := fs.FileSystem.Open(name)\n    if err != nil {\n        return nil, err\n    }\n\n    stat, err := f.Stat()\n    if err != nil {\n        return nil, err\n    }\n\n    // This denies access to the directory listing\n    if stat.IsDir() {\n        return nil, os.ErrNotExist\n    }\n\n    // This denies access to anything but &lt;prefix&gt;/css/...\n    if !strings.HasPrefix(name, \"/css/\") {\n        return nil, os.ErrNotExist\n    }\n\n    return f, nil\n}\n</code></pre>\n\n<p>Now you can use it in your main like so:</p>\n\n<pre><code>fs := http.FileServer(fileSystem{http.Dir(\"themes/\"+config.Theme+\"/\")})    \nhttp.Handle(\"/static/\", http.StripPrefix(\"/static/\", fs))\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 6303169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ef5f622f9906108bbc136d53da0b14e1?s=128&d=identicon&r=PG&f=1", "display_name": "V. Korovin", "link": "https://stackoverflow.com/users/6303169/v-korovin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 42398889, "answer_count": 1, "score": 0, "last_activity_date": 1487786074, "creation_date": 1487784868, "last_edit_date": 1487785398, "question_id": 42398498, "link": "https://stackoverflow.com/questions/42398498/how-to-avoid-serving-template-files-by-go", "title": "How to avoid serving template files by Go", "body": "<p>I'm writting small website on Go, and i found some problems, that i dont know how to solve. So...\nThe basic idea is to have one single folder for themes, called <code>/themes/</code> where we will put all our themes, f.e. <code>classic</code>, <code>modern</code>, etc.\nThe directory tree will looks like:</p>\n\n<pre><code>/themes/\n    classic/\n        index.html\n        header.html\n        footer.html\n        css/\n            style.css\n        js/\n            lib.js\n    modern/\n        index.html\n        header.html\n        footer.html\n        css/\n            style.css\n        js/\n            lib.js\n</code></pre>\n\n<p>So, my http handlers: </p>\n\n<pre><code>func main() {\n    reloadConfig()\n\n    http.HandleFunc(\"/\", homeHandler)\n\n    http.HandleFunc(\"/reloadConfigHandler/\", reloadConfigHandler)\n\n    // TODO: Theme loads html files also\n    http.Handle(\"/static/\", http.StripPrefix(\"/static/\", http.FileServer(http.Dir(\"themes/\"+config.Theme+\"/\"))))\n    http.ListenAndServe(\":80\", nil)\n}\n</code></pre>\n\n<p><strong>The Problem</strong></p>\n\n<p>The problem is that my templates files can be opened from the outside, if i open path <code>http://localhost/static/index.html</code>, so i need solution to:</p>\n\n<ol>\n<li>Deny <code>/static/</code>, show 404.</li>\n<li>Deny <code>/static/*.html</code>, show 404.</li>\n<li>Allow <code>/static/{folder_name}/{file_name}</code>  so in future i can add <code>img</code> folder or <code>fonts</code> folder, and content inside of them will be served by server to client.</li>\n</ol>\n\n<p>Thanks in advice.</p>\n"}, {"tags": ["go", "gmail-api", "recycle-bin"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1487783899, "post_id": 42398112, "comment_id": 71943283, "body": "Does it differ from the behavior of the web UI? Is it even possible to trash an email that starts a thread without trashing the whole thread?"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1487784013, "post_id": 42398112, "comment_id": 71943366, "body": "@9000  Just tested. Clicking on the first message and choosing &#39;Delete this message&#39; does indeed, just remove that message and leaves the rest of the thread in place"}], "answers": [{"comments": [{"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1487839962, "post_id": 42410651, "comment_id": 71967965, "body": "Ok. Is there a way to start a new thread and make sure an email won&#39;t end up in an existing thread even if subject, sender etc is the same?"}], "tags": [], "owner": {"reputation": 12076, "user_id": 5832311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t6jqn.jpg?s=128&g=1", "display_name": "abielita", "link": "https://stackoverflow.com/users/5832311/abielita"}, "is_accepted": false, "score": 0, "last_activity_date": 1487838988, "last_edit_date": 1495541354, "creation_date": 1487838988, "answer_id": 42410651, "question_id": 42398112, "link": "https://stackoverflow.com/questions/42398112/gmail-api-trashing-first-email-seems-to-remove-entire-thread/42410651#42410651", "title": "GMail API: Trashing first email seems to remove entire thread", "body": "<p>You may refer with this <a href=\"https://stackoverflow.com/questions/28103227/gmail-api-how-to-get-the-reply-without-the-original-message\">post</a> although the issue here is to retrieve the specific email within a thread. It stated that it is not currently possible because it is part of the email's body content and you're specifying the <strong>ID of the message</strong> to trash. You can only trash other messages within a thread, but not the primary message since the <code>messageId</code> and the <code>threadId</code> of the first email is the same. Yes, using the Gmail App it's working, but I think it is not yet supported using the API. You can file a <a href=\"https://code.google.com/a/google.com/p/apps-api-issues/issues/entry?template=Feature%20request&amp;labels=Type-Enhancement,API-Gmail\" rel=\"nofollow noreferrer\">feature request</a> for this.</p>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1487838988, "creation_date": 1487783689, "last_edit_date": 1487783825, "question_id": 42398112, "link": "https://stackoverflow.com/questions/42398112/gmail-api-trashing-first-email-seems-to-remove-entire-thread", "title": "GMail API: Trashing first email seems to remove entire thread", "body": "<p>I'm using the GMail API in Go(lang). After each email arrives I am 'inserting' (not sending an email onto the same thread (with stats about how many times you have communicated with this person etc etc... </p>\n\n<p>What I want to end up with is the original incoming email trashed, and the inserted email first in the thread. The content of the original email is appended to the inserted email.</p>\n\n<p>All works, except that when I trash the email with the ID of the original email, the entire thread disappears.</p>\n\n<p>Is this because the appended email is inserted and not 'sent' to the thread? I wouldn't have thought so because it gets given a real messageID, so is it because I am trashing the first email in a thread, and that therefore trashes the whole thread?</p>\n\n<p>I thought trashing should just trash the message, regardless of its 'ownership' of the thread.\nThanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1487783809, "post_id": 42398126, "comment_id": 71943216, "body": "... or use <a href=\"https://godoc.org/html#UnescapeString\" rel=\"nofollow noreferrer\">godoc.org/html#UnescapeString</a> from the standard library."}, {"owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 0, "creation_date": 1487784239, "post_id": 42398126, "comment_id": 71943515, "body": "I still have the \\ plague : &lt;iframe src=&quot;https:\\/\\/www.disnei.com\\/embed\\/44bc40f3bc04f65b7a35&quot;"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "edited": false, "score": 1, "creation_date": 1487786615, "post_id": 42398126, "comment_id": 71945094, "body": "@user462794 The &quot;\\&quot; are part of the original string. It&#39;s not an HTML issue.  What generated the string shown in the question? Perhaps the generator can be modified to avoid adding &quot;\\&quot;."}, {"owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1487786777, "post_id": 42398126, "comment_id": 71945185, "body": "@CeriseLim&#243;n I will make a simple string replace but i would like to know if there was something to do it &quot;more simply&quot; thanks btw"}], "tags": [], "owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1487784114, "last_edit_date": 1487784114, "creation_date": 1487783755, "answer_id": 42398126, "question_id": 42397980, "link": "https://stackoverflow.com/questions/42397980/render-a-html-string-as-a-normal-string-in-golang/42398126#42398126", "title": "render a html string as a normal string in golang", "body": "<p>you can use <code>UnescapeString</code> from the go html lib:\n<a href=\"https://godoc.org/html#UnescapeString\" rel=\"nofollow noreferrer\">https://godoc.org/html#UnescapeString</a></p>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1192, "favorite_count": 0, "accepted_answer_id": 42398126, "answer_count": 1, "score": 1, "last_activity_date": 1487784583, "creation_date": 1487783332, "last_edit_date": 1487784583, "question_id": 42397980, "link": "https://stackoverflow.com/questions/42397980/render-a-html-string-as-a-normal-string-in-golang", "title": "render a html string as a normal string in golang", "body": "<p>here is my string :</p>\n\n<pre><code>test1 = `&amp;lt;iframe src=&amp;quot;https:\\/\\/www.disnei.com\\/embed\\/44bc40f3bc04f65b7a35&amp;quot; frameborder=&amp;quot;0&amp;quot; width=&amp;quot;560&amp;quot; height=&amp;quot;340&amp;quot; scrolling=&amp;quot;no&amp;quot; allowfullscreen&amp;gt;&amp;lt;\\/iframe&amp;gt;`\n</code></pre>\n\n<p>and i would like to have the 'normal' string as :</p>\n\n<pre><code>&lt;iframe src=\"https://www.disnei.com/embed/44bc40f3bc04f65b7a35\"\n</code></pre>\n\n<p>etc ...</p>\n\n<p>is there a simple way to do it in golang ?</p>\n\n<p>Edit : \nHere are some of my tests : <a href=\"https://play.golang.org/p/OuzNrTXYRB\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OuzNrTXYRB</a>\nI still have a blackslash plague</p>\n\n<p>thanks and regards</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1487780589, "post_id": 42396853, "comment_id": 71940985, "body": "Any particular reason not to use <code>strings.Split</code>?"}, {"owner": {"reputation": 7606, "user_id": 180253, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/df46030788b7cc95cadb9778a2b9e7dd?s=128&d=identicon&r=PG", "display_name": "TheJediCowboy", "link": "https://stackoverflow.com/users/180253/thejedicowboy"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1487780645, "post_id": 42396853, "comment_id": 71941022, "body": "@Ainar-G I know how to do it using a split, but I want to know how to do it parsing out with a regex. Any advantage to using a split versus a regex?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487780941, "post_id": 42396853, "comment_id": 71941245, "body": "@TheJediCowboy: why do you want a more complicated solution for splitting a string? While something like <code>&quot;:[^&#47;]+&#47;(.*)&quot;</code> is pretty simple, <code>string.Index</code> or <code>strings.Split</code> is downright obvious to the person reading the code."}], "answers": [{"tags": [], "owner": {"reputation": 35106, "user_id": 2953344, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/0Be9p.jpg?s=128&g=1", "display_name": "Sabuj Hassan", "link": "https://stackoverflow.com/users/2953344/sabuj-hassan"}, "is_accepted": true, "score": 1, "last_activity_date": 1487780940, "creation_date": 1487780940, "answer_id": 42397087, "question_id": 42396853, "link": "https://stackoverflow.com/questions/42396853/golang-regex-to-parse-out-repo-name-from-git-url/42397087#42397087", "title": "Golang regex to parse out repo name from git url", "body": "<p>I am not that much familiar with golang till days. May be you can go with replace instead of split. For example using the following pseudocode.</p>\n\n<p>Make a regex <code>.*/</code> and then replace it with your string.</p>\n\n<pre><code>reg.ReplaceAllString(url, \"\")\n</code></pre>\n\n<p>This will replace anything before the last <code>/</code> and you'll have the <code>repo.git</code></p>\n"}, {"tags": [], "owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "is_accepted": false, "score": 3, "last_activity_date": 1487782674, "creation_date": 1487782674, "answer_id": 42397735, "question_id": 42396853, "link": "https://stackoverflow.com/questions/42396853/golang-regex-to-parse-out-repo-name-from-git-url/42397735#42397735", "title": "Golang regex to parse out repo name from git url", "body": "<p>Save yourself the trouble of using a regex where you don't need one and just use:</p>\n\n<pre><code>name := url[strings.LastIndex(url, \"/\")+1:]\n</code></pre>\n\n<p>Or if you are not sure that the url is a valid github url:</p>\n\n<pre><code>i := strings.LastIndex(url, \"/\")\nif i != -1 {\n    // Do some error handling here\n}\nname := url[i+1:]\n</code></pre>\n"}], "owner": {"reputation": 7606, "user_id": 180253, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/df46030788b7cc95cadb9778a2b9e7dd?s=128&d=identicon&r=PG", "display_name": "TheJediCowboy", "link": "https://stackoverflow.com/users/180253/thejedicowboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 968, "favorite_count": 0, "accepted_answer_id": 42397087, "answer_count": 2, "score": 0, "last_activity_date": 1487782674, "creation_date": 1487780319, "question_id": 42396853, "link": "https://stackoverflow.com/questions/42396853/golang-regex-to-parse-out-repo-name-from-git-url", "title": "Golang regex to parse out repo name from git url", "body": "<p>I need a way of parsing out the repo name from a git repo url WITHOUT using a split function.</p>\n\n<p>For example I want to be able to do the following</p>\n\n<pre><code>url := \"git@github.com:myorg/repo.git\"\nrepoName := parseRepoName(url)\nlog.Println(repoName)  //prints \"repo.git\"\n</code></pre>\n"}, {"tags": ["testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 3650, "user_id": 5387794, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c76efa31a04b23c99d0b964a474491c?s=128&d=identicon&r=PG&f=1", "display_name": "kovac", "link": "https://stackoverflow.com/users/5387794/kovac"}, "edited": false, "score": 0, "creation_date": 1550984986, "post_id": 42395998, "comment_id": 96470226, "body": "If we do this, does the <code>DbInstance</code> get exported as part of the package?"}, {"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "reply_to_user": {"reputation": 3650, "user_id": 5387794, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c76efa31a04b23c99d0b964a474491c?s=128&d=identicon&r=PG&f=1", "display_name": "kovac", "link": "https://stackoverflow.com/users/5387794/kovac"}, "edited": false, "score": 0, "creation_date": 1551091823, "post_id": 42395998, "comment_id": 96499496, "body": "Yes, if you care about variable export, you have to change the variable name to dbInstance."}], "tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": false, "score": 8, "last_activity_date": 1487778508, "last_edit_date": 1487778508, "creation_date": 1487778117, "answer_id": 42395998, "question_id": 42395897, "link": "https://stackoverflow.com/questions/42395897/golang-testmain-function-sets-variable-that-cant-be-accessed-by-tests/42395998#42395998", "title": "golang TestMain() function sets variable that can&#39;t be accessed by tests", "body": "<p><code>dbInstance</code> is a local variable of <code>TestMain</code> and it doesn't exist in the lifecycle of <code>TestSomeFeature</code> function. and for this reason the test suite says to you that <code>dbInstance</code> is undefined.<br>\nDefine the variable as global variable outside TestMain and then instantiate the variable in the TestMain </p>\n\n<pre><code>var DbInstance MyVariableRepoType\n\nfunc TestMain(m *testing.M) {\n  db := \"[working_db_connection]\"\n  DbInstance, _ = InitializeRepo(db, 2)\n  runTests := m.Run()\n  os.Exit(runTests)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 4, "last_activity_date": 1487778310, "creation_date": 1487778310, "answer_id": 42396070, "question_id": 42395897, "link": "https://stackoverflow.com/questions/42395897/golang-testmain-function-sets-variable-that-cant-be-accessed-by-tests/42396070#42396070", "title": "golang TestMain() function sets variable that can&#39;t be accessed by tests", "body": "<p>You should have your variable defined outside of any function.</p>\n\n<pre><code>var dbInstance DbType\n</code></pre>\n"}], "owner": {"reputation": 317, "user_id": 7221826, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/a4abec0a80b101095bc8f9b8959a026f?s=128&d=identicon&r=PG&f=1", "display_name": "jj1111", "link": "https://stackoverflow.com/users/7221826/jj1111"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5796, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1487778508, "creation_date": 1487777885, "question_id": 42395897, "link": "https://stackoverflow.com/questions/42395897/golang-testmain-function-sets-variable-that-cant-be-accessed-by-tests", "title": "golang TestMain() function sets variable that can&#39;t be accessed by tests", "body": "<p>I've got the following TestMain function:</p>\n\n<pre><code>func TestMain(m *testing.M) {\n  db := \"[working_db_connection]\"\n  dbInstance, _ := InitializeRepo(db, 2)\n  runTests := m.Run()\n  os.Exit(runTests)\n}\n</code></pre>\n\n<p>and the following sample test</p>\n\n<pre><code>func TestSomeFeature(t *testing.T) {\n  fmt.Println(dbInstance)\n}\n</code></pre>\n\n<p>The function TestSomeFeature does run, but says dbInstance is undefined. Why would this not have access to the variable? From examples I'm seeing variables et in TestMain are accessed with this syntax.</p>\n"}, {"tags": ["go", "docker"], "comments": [{"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 1, "creation_date": 1487772328, "post_id": 42392130, "comment_id": 71934793, "body": "Where are all of these functions/types defined, like <code>app.Client</code>, what libraries are you using? A <a href=\"http://stackoverflow.com/help/mcve\">mcve</a> may be needed."}, {"owner": {"reputation": 3966, "user_id": 1262525, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57ec504eb8c3bbbb2a7151ed7a383276?s=128&d=identicon&r=PG", "display_name": "shalakhin", "link": "https://stackoverflow.com/users/1262525/shalakhin"}, "reply_to_user": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1487775133, "post_id": 42392130, "comment_id": 71936850, "body": "I use docker source code. I have App struct that holds docker Client, app name (we can say image name) etc."}, {"owner": {"reputation": 3016, "user_id": 476917, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/09e7f8896d4a5104c2058128a03a30b0?s=128&d=identicon&r=PG", "display_name": "Agung Pratama", "link": "https://stackoverflow.com/users/476917/agung-pratama"}, "edited": false, "score": 0, "creation_date": 1564720800, "post_id": 42392130, "comment_id": 101130790, "body": "@shalakhin have you solved this? also may i know the docker source code you&#39;re using (github link)?"}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 4884201, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uhG5M.jpg?s=128&g=1", "display_name": "tugba", "link": "https://stackoverflow.com/users/4884201/tugba"}, "is_accepted": false, "score": 0, "last_activity_date": 1549343617, "last_edit_date": 1549343617, "creation_date": 1487925313, "answer_id": 42434061, "question_id": 42392130, "link": "https://stackoverflow.com/questions/42392130/how-to-pull-image-from-custom-docker-registry-with-golang/42434061#42434061", "title": "How to pull image from custom docker registry with golang?", "body": "<p>Did you check identity token? That might cause an authentication problem.</p>\n\n<p>A suggestion:<br>\n<a href=\"https://github.com/fsouza/go-dockerclient/\" rel=\"nofollow noreferrer\">Docker client</a></p>\n\n<p>This works fine, as I can see you did not specify the <strong>endpoint</strong>. I think you should add this info. </p>\n"}], "owner": {"reputation": 3966, "user_id": 1262525, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/57ec504eb8c3bbbb2a7151ed7a383276?s=128&d=identicon&r=PG", "display_name": "shalakhin", "link": "https://stackoverflow.com/users/1262525/shalakhin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1799, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1549343617, "creation_date": 1487768146, "question_id": 42392130, "link": "https://stackoverflow.com/questions/42392130/how-to-pull-image-from-custom-docker-registry-with-golang", "title": "How to pull image from custom docker registry with golang?", "body": "<p>Using docker sources how to pull image from custom registry? As a result of using such code</p>\n\n<pre><code>// Prepare auth registry for usage\nfunc (app *App) PrepareRegistry() error {\n    app.AuthConfig = types.AuthConfig{\n        Username:      Username,\n        Password:      Password,\n        ServerAddress: DefaultServer,\n    }\n\n    resp, err := app.Client.RegistryLogin(context.Background(), app.AuthConfig)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(resp.Status)\n    if resp.IdentityToken != \"\" {\n        app.AuthConfig.IdentityToken = resp.IdentityToken\n    }\n\n    app.AuthConfigEncoded, err = command.EncodeAuthToBase64(app.AuthConfig)\n    return err\n}\n\nfunc (app *App) ImagePull() error {\n\n    opts := types.ImagePullOptions{\n        All:            true,\n        RegistryAuth: app.AuthConfigEncoded,\n        PrivilegeFunc: registryAuthentication(app.Name),\n    }\n    responseBody, err := app.Client.ImagePull(context.Background(), app.Name, opts)\n    defer responseBody.Close()\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>I am still getting the error</p>\n\n<pre><code>Login Succeeded\npanic: Error response from daemon: Get https://registry-1.docker.io/v2/shalakhin/blender/tags/list: unauthorized: incorrect username or password\n</code></pre>\n\n<p>While ServerAddress is registry.gitlab.com, not registry-1.docker.io</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1487769173, "post_id": 42391898, "comment_id": 71932365, "body": "Also, make sure you actually want a pointer to <code>bytes.Buffer</code>. That struct has some &quot;scratch space&quot; internally, which is used to avoid unneeded allocations for small buffers."}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 13, "last_activity_date": 1487767792, "creation_date": 1487767792, "answer_id": 42391981, "question_id": 42391898, "link": "https://stackoverflow.com/questions/42391898/golang-with-compile-error-undefined-bytes-in-bytes-buffer/42391981#42391981", "title": "golang with compile error: undefined: bytes in bytes.Buffer", "body": "<p>You forgot about import statement.</p>\n\n<pre><code>import \"bytes\"\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 7555555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1e023569dfd453e9af49804b615ffac?s=128&d=identicon&r=PG&f=1", "display_name": "PemanZ", "link": "https://stackoverflow.com/users/7555555/pemanz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4268, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1487767849, "creation_date": 1487767560, "last_edit_date": 1487767849, "question_id": 42391898, "link": "https://stackoverflow.com/questions/42391898/golang-with-compile-error-undefined-bytes-in-bytes-buffer", "title": "golang with compile error: undefined: bytes in bytes.Buffer", "body": "<p>I defined a struct as below, but always get the build error: \u201cundefined: bytes in bytes.Buffer\u201d</p>\n\n<pre><code>type test struct {\n    id       int64\n    Content    []byte\n    Buffer     *bytes.Buffer\n}\n</code></pre>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1487768234, "post_id": 42391869, "comment_id": 71931653, "body": "This is a <i>hard</i> problem as days have different durations: Not just leap seconds, but daylight saving. If your day is 24h: Fine. Problem becomes more obvious if you think about displaying time deltas in month or year units."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1487770664, "post_id": 42391869, "comment_id": 71933498, "body": "Currently I mainly want to know how much a process took, not doing any date calculations regarding the dates."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1487789376, "post_id": 42391869, "comment_id": 71946734, "body": "Related: <a href=\"http://stackoverflow.com/questions/36530251/golang-time-since-with-months-and-years/36531443#36531443\">golang time.Since() with months and years</a>."}], "answers": [{"tags": [], "owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "is_accepted": false, "score": 0, "last_activity_date": 1487774009, "creation_date": 1487774009, "answer_id": 42394396, "question_id": 42391869, "link": "https://stackoverflow.com/questions/42391869/time-since-in-days-hours-minutes-seconds-format/42394396#42394396", "title": "time since in days, hours, minutes, seconds format", "body": "<p>A na\u00efve implementation might be: <a href=\"https://play.golang.org/p/VsVeIhoLGi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VsVeIhoLGi</a></p>\n\n<p>(Note the assumption on the day duration constant).</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": -1, "last_activity_date": 1487786393, "last_edit_date": 1487786393, "creation_date": 1487782352, "answer_id": 42397606, "question_id": 42391869, "link": "https://stackoverflow.com/questions/42391869/time-since-in-days-hours-minutes-seconds-format/42397606#42397606", "title": "time since in days, hours, minutes, seconds format", "body": "<p>To answer your exact question:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc FormatSince(t time.Time) string {\n    const (\n        Decisecond = 100 * time.Millisecond\n        Day        = 24 * time.Hour\n    )\n    ts := time.Since(t)\n    sign := time.Duration(1)\n    if ts &lt; 0 {\n        sign = -1\n        ts = -ts\n    }\n    ts += +Decisecond / 2\n    d := sign * (ts / Day)\n    ts = ts % Day\n    h := ts / time.Hour\n    ts = ts % time.Hour\n    m := ts / time.Minute\n    ts = ts % time.Minute\n    s := ts / time.Second\n    ts = ts % time.Second\n    f := ts / Decisecond\n    return fmt.Sprintf(\"%dd%dh%dm%d.%ds\", d, h, m, s, f)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>diff = 21136h26m58.574146433s\ndiff = 880d16h26m58.6s\n</code></pre>\n\n<p>For Go 1.8 and earlier, this gives you the difference in absolute (UTC) time. It may not match the difference in wall clock time which can be affected by daylight saving time. It may also be affected by adjustments to the system wall (real-time) clock.</p>\n\n<p>From Go 1.9 onward, the difference will be computed using a monotonic clock which is not affected by changes to the system wall clock time or daylight savings time.</p>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2119, "favorite_count": 1, "accepted_answer_id": 42397606, "answer_count": 2, "score": 2, "last_activity_date": 1487786393, "creation_date": 1487767476, "question_id": 42391869, "link": "https://stackoverflow.com/questions/42391869/time-since-in-days-hours-minutes-seconds-format", "title": "time since in days, hours, minutes, seconds format", "body": "<p>Is there a way to format the output of <a href=\"https://golang.org/pkg/time/#Since\" rel=\"nofollow noreferrer\">time.Since()</a> to add days when aplicable, something like:</p>\n\n<pre><code>[days]d[hours]h[minutes]m[seconds]s\n</code></pre>\n\n<p>The current format seems to use only hours as the maximum unit:</p>\n\n<pre><code>start := time.Unix(1411691219, 0)\ndiff := time.Since(start)\n\n21132h9m41.714117301s\n</code></pre>\n\n<p>But I would like to use days instead of hours, in order to obtain something like:</p>\n\n<pre><code>880d12h9m41.7s\n</code></pre>\n\n<p>I am currently using the following <code>TimeDiff</code> function to produce the desired output, but wondering if there is an easy/better/native way of achieving this.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"math\"\n    \"time\"\n)\n\nfunc main() {\n    start := time.Unix(1411691219, 0)\n    diff := time.Since(start)\n    fmt.Printf(\"diff = %s\\n\", diff)\n    fmt.Printf(\"diff = %s\\n\", TimeDiff(start))\n}\n\nfunc TimeDiff(t time.Time) string {\n    diff := time.Since(t)\n    days := diff / (24 * time.Hour)\n    hours := diff % (24 * time.Hour)\n    minutes := hours % time.Hour\n    seconds := math.Mod(minutes.Seconds(), 60)\n    var buffer bytes.Buffer\n    if days &gt; 0 {\n        buffer.WriteString(fmt.Sprintf(\"%dd\", days))\n    }\n    if hours/time.Hour &gt; 0 {\n        buffer.WriteString(fmt.Sprintf(\"%dh\", hours/time.Hour))\n    }\n    if minutes/time.Minute &gt; 0 {\n        buffer.WriteString(fmt.Sprintf(\"%dm\", minutes/time.Minute))\n    }\n    if seconds &gt; 0 {\n        buffer.WriteString(fmt.Sprintf(\"%.1fs\", seconds))\n    }\n    return buffer.String()\n}\n</code></pre>\n"}, {"tags": ["validation", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 7372, "user_id": 412689, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/73160611f90c8c1e1cdc79f43702bda1?s=128&d=identicon&r=PG", "display_name": "Alex Nichol", "link": "https://stackoverflow.com/users/412689/alex-nichol"}, "is_accepted": true, "score": 1, "last_activity_date": 1487771584, "creation_date": 1487771584, "answer_id": 42393420, "question_id": 42390574, "link": "https://stackoverflow.com/questions/42390574/golang-validator-multifield-dependency/42393420#42393420", "title": "Golang validator multifield dependency", "body": "<p>You probably want to use reflection to iterate over the fields of the struct, get the <code>validate</code> tag for each field, and check the field. This means you'll have to do validation on a struct level. Otherwise, if you pass something like <code>myInstance.OwnerID</code> to a function, you'll lose the tag associated with it.</p>\n\n<p>This code loops through the fields of a struct and gets the <code>validate</code> tag for each:</p>\n\n<pre><code>func checkStruct(v interface{}) error {\n    val := reflect.ValueOf(v)\n\n    // Iterate through fields\n    for i := 0; i &lt; val.NumField(); i++ {\n        // Lookup the validate tag\n        field := val.Type().Field(i)\n        tags := field.Tag\n        validate, ok := tags.Lookup(\"validate\")\n        if !ok {\n            // No validate tag.\n            continue\n        }\n\n        // Get the value of the field.\n        fieldValue := val.Field(i)\n\n        // Validation logic here.\n        fmt.Println(\"field\", field.Name, \"has validate tag\", validate, \"and value\",\n            fieldValue.Interface())\n    }\n    return nil\n}\n</code></pre>\n\n<p>For example, we could pass it the following <code>CarModel</code>:</p>\n\n<pre><code>checkStruct(CarModel{\n    OwnerID: 2,\n    Type:    \"B\",\n    A:       \"http://google.com\",\n    B:       \"192.168.1.1\",\n})\n</code></pre>\n\n<p>and it would print out the following:</p>\n\n<pre><code>field OwnerID has validate tag nonzero and value 2\nfield Type has validate tag regexp=(?)(A|B) and value B\nfield A has validate tag isurl and value http://google.com\nfield B has validate tag isip and value 192.168.1.1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 125, "user_id": 963379, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f2aecf2754c0d53774f7c56523334d37?s=128&d=identicon&r=PG", "display_name": "RussellLuo", "link": "https://stackoverflow.com/users/963379/russellluo"}, "is_accepted": false, "score": 0, "last_activity_date": 1503098248, "last_edit_date": 1503098248, "creation_date": 1503073023, "answer_id": 45760996, "question_id": 42390574, "link": "https://stackoverflow.com/questions/42390574/golang-validator-multifield-dependency/45760996#45760996", "title": "Golang validator multifield dependency", "body": "<p>Seems like your validation rules are very complicated, but you can give <a href=\"https://github.com/RussellLuo/validating\" rel=\"nofollow noreferrer\">validating</a> a try.</p>\n\n<p>Suppose we already have two customized validators <code>IsURL</code> and <code>IsIP</code>, then your validation rules can be implemented as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"regexp\"\n\n    v \"github.com/RussellLuo/validating\"\n)\n\n// Customized validators\nvar (\n    MatchRegexp = func(pattern string) v.Validator {\n        return v.FromFunc(func(field v.Field) v.Errors {\n            switch t := field.ValuePtr.(type) {\n            case *string:\n                if matched, _ := regexp.MatchString(pattern, *t); !matched {\n                    return v.NewErrors(field.Name, v.ErrInvalid, \"does not match\")\n                }\n                return nil\n            default:\n                return v.NewErrors(field.Name, v.ErrUnsupported, \"is unsupported\")\n            }\n        })\n    }\n    // IsURL and IsIP are omitted\n)\n\ntype CarModel struct {\n    gorm.Model\n    OwnerID    int    `json:\"ownerid\"`\n    Type       string `json:\"type\"`\n    A          string `json:\"url\"`\n    B          string `json:\"ip\"`\n}\n\nfunc main() {\n    car := CarModel{}\n    errs := v.Validate(v.Schema{\n        v.F(\"ownerid\", &amp;car.OwnerID): v.Nonzero(),\n        v.F(\"type\", &amp;car.Type):       MatchRegexp(\"(A|B)\"),\n        v.F(\"a\", &amp;car.A): v.Lazy(func() v.Validator {\n            if car.Type == \"A\" {\n                return v.All(v.Nonzero(), IsURL())\n            }\n            return v.Not(v.Nonzero())\n        }),\n        v.F(\"b\", &amp;car.B): v.Lazy(func() v.Validator {\n            if car.Type == \"B\" {\n                return v.All(v.Nonzero(), IsIP())\n            }\n            return v.Not(v.Nonzero())\n        }),\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 2346396, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a566df0c4da3b6640afdc2b14cacaf80?s=128&d=identicon&r=PG", "display_name": "St&#233;phane MERLE", "link": "https://stackoverflow.com/users/2346396/st%c3%a9phane-merle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 941, "favorite_count": 0, "accepted_answer_id": 42393420, "answer_count": 2, "score": 0, "last_activity_date": 1503098248, "creation_date": 1487764217, "last_edit_date": 1487779802, "question_id": 42390574, "link": "https://stackoverflow.com/questions/42390574/golang-validator-multifield-dependency", "title": "Golang validator multifield dependency", "body": "<p>I'd like to validate the following structure : </p>\n\n<blockquote>\n<pre><code>type CarModel struct {\n  gorm.Model\n  OwnerID    int    `json:\"ownerid\" validate:\"nonzero\"`\n  Type       string `json:\"type\" validate:\"regexp=(?)(A|B)\"`\n  A        string `json:\"url\" validate:\"isurl\"`\n  B         string `json:\"ip\" validate:\"isip\"`\n}\n</code></pre>\n</blockquote>\n\n<p>I would like to validate A and B depending on Type, \nif type = A then A must exist and must be a URL BUT B must not exist\nif type = B then A must not exist and B must be an IP</p>\n\n<p>is this possible with validator ?</p>\n\n<p>I did try custom validation but I cannot find a way to see type value : </p>\n\n<pre><code>func checkB(v interface{}, param string) error {\n    theB := reflect.ValueOf(v)\n    if theB.Kind() != reflect.String {\n        return validator.ErrUnsupported\n    }\n    //check if B is an IP\n    ipcool := net.ParseIP(theB.String())\n    if ipcool == nil {\n        return errors.New(\"B : ip incorrecte \" + theB.String())\n    }\n    return nil\n}\n</code></pre>\n\n<hr>\n\n<p>Upon the answer of Alex Nichol, I would like first to thank you for your help.</p>\n\n<p>If I understood correctly, I would have to iterate through all the \"validate\" fields, to keep a trace of the value of TYPE, A and B and then to check them depending on TYPE ...</p>\n\n<p>I did this : </p>\n\n<pre><code>func checkMonitor(v interface{}) error {\n    var mytype string\n    var myA string\n    var myB string\n\n    val := reflect.ValueOf(v)\n    // Iterate through fields\n    for i := 0; i &lt; val.NumField(); i++ {\n        // Lookup the validate tag\n        field := val.Type().Field(i)\n        tags := field.Tag\n        _, ok := tags.Lookup(\"validate\")\n        if !ok {\n            // No validate tag.\n            continue\n        }\n\n        // Get the value of the field.\n        fieldValue := val.Field(i)\n\n        switch field.Name {\n        case \"Type\":\n            mytype = fieldValue.Interface()\n        case \"A\":\n            myA = fieldValue.Interface()\n        case \"B\":\n            myB = fieldValue.Interface()\n        }\n        // Validation logic here.\n        //fmt.Println(\"field\", field.Name, \"has validate tag\", validate, \"and value\", fieldValue.Interface())\n    }\n    if mytype == \"A\" {\n        if myA == \"\" {\n            return errors.New(\"A vide et type A\")\n        }\n        ipcool := net.ParseIP(myA)\n        if ipcool == nil {\n            return errors.New(\"A incorrecte \" + myA)\n        }\n    } else if mytype == \"HTML\" {\n        if myB == \"\" {\n            return errors.New(\"B vide et type B\")\n        }\n        _, urlpascool := url.ParseRequestURI(myB)\n        if urlpascool != nil {\n            return errors.New(\"B incorrecte \" + myB)\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>but got an error on the mytype, myA and myB in the switch case : </p>\n\n<p>cannot use fieldValue.Interface() (type interface {}) as type string in assignment: need type assertion</p>\n\n<p>EDIT : \njust needed to use my brain :</p>\n\n<pre><code>switch field.Name {\ncase \"Type\":\n   mytype = fieldValue.String()\ncase \"A\":\n   myA = fieldValue.String()\ncase \"B\":\n   myB = fieldValue.Interface()\n}\n</code></pre>\n"}, {"tags": ["string", "go", "indentation"], "answers": [{"comments": [{"owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "edited": false, "score": 0, "creation_date": 1487765426, "post_id": 42390774, "comment_id": 71929591, "body": "After reading this I was pondering the aesthetics of using <code>strings.Replace</code> in the initial assignment (with the <code>, &quot;\\n        &quot;, &quot;\\n&quot;, -1)</code> dangling at the end. But your note about initial/trailing newlines suggests writing a function for this might best meet my objective. Thanks."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "edited": false, "score": 0, "creation_date": 1487765759, "post_id": 42390774, "comment_id": 71929822, "body": "@RedGrittyBrick Yeah, good idea. Included an example implementation."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1487773112, "last_edit_date": 1487773112, "creation_date": 1487764685, "answer_id": 42390774, "question_id": 42390549, "link": "https://stackoverflow.com/questions/42390549/unindent-a-multiline-string-value/42390774#42390774", "title": "Unindent a multiline string value", "body": "<p>That's a simple <a href=\"https://golang.org/pkg/strings/#Replace\" rel=\"nofollow noreferrer\"><code>strings.Replace()</code></a> call:</p>\n\n<pre><code>text = strings.Replace(text, \"\\n        \", \"\\n\", -1)\n</code></pre>\n\n<p>Output before and after the replace (try it on the <a href=\"https://play.golang.org/p/9969WsvPbL\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>           Lorem ipsum dolor sit amet, consectetur adipiscing elit,\n        sed do eiusmod tempor incididunt ut labore et dolore magna\n        aliqua. \n           Ut enim ad minim veniam, quis nostrud exercitation \n        ullamco laboris nisi ut aliquip ex ea commodo consequat.\n\n\n   Lorem ipsum dolor sit amet, consectetur adipiscing elit,\nsed do eiusmod tempor incididunt ut labore et dolore magna\naliqua. \n   Ut enim ad minim veniam, quis nostrud exercitation \nullamco laboris nisi ut aliquip ex ea commodo consequat.\n</code></pre>\n\n<p>Note that this will still leave newline character at the beginning and at the end of your text. If you also want to get rid of them, you may use <a href=\"https://golang.org/pkg/strings/#Trim\" rel=\"nofollow noreferrer\"><code>strings.Trim()</code></a>:</p>\n\n<pre><code>text = strings.Replace(text, \"\\n        \", \"\\n\", -1)\ntext = strings.Trim(text, \"\\n\")\n</code></pre>\n\n<p>Note: <a href=\"https://golang.org/pkg/strings/#TrimSpace\" rel=\"nofollow noreferrer\"><code>strings.TrimSpace()</code></a> would come first to mind, but it's not a good choice as that would also remove the indentation from the first line (<code>\"   Lorem\"</code>) which is unwanted. We really just want to get rid of extra prefix and postfix newlines.</p>\n\n<p>To verify the difference:</p>\n\n<pre><code>text = strings.Replace(text, \"\\n        \", \"\\n\", -1)\nfmt.Printf(\"%q\\n\", text)\ntext = strings.Trim(text, \"\\n\")\nfmt.Printf(\"%q\\n\", text)\n</code></pre>\n\n<p>Output:</p>\n\n<p><code>\"\\n   Lorem ipsum dolor sit amet, consectetur adipiscing elit,\\nsed do eiusmod tempor incididunt ut labore et dolore magna\\naliqua. \\n   Ut enim ad minim veniam, quis nostrud exercitation \\nullamco laboris nisi ut aliquip ex ea commodo consequat.\\n\"\n\"   Lorem ipsum dolor sit amet, consectetur adipiscing elit,\\nsed do eiusmod tempor incididunt ut labore et dolore magna\\naliqua. \\n   Ut enim ad minim veniam, quis nostrud exercitation \\nullamco laboris nisi ut aliquip ex ea commodo consequat.\"</code></p>\n\n<p><strong>To wrap it in a helper function:</strong></p>\n\n<pre><code>func unindent(s string, spaces int) string {\n    old := \"\\n\" + strings.Repeat(\" \", spaces)\n    s = strings.Replace(s, old, \"\\n\", -1)\n    return strings.Trim(s, \"\\n\")\n}\n</code></pre>\n\n<p>And using it:</p>\n\n<pre><code>text = unindent(text, 8)\n</code></pre>\n\n<p>An alternative way to create the <code>old</code> replaceable string:</p>\n\n<pre><code>func unindent(s string, spaces int) string {\n    old := fmt.Sprintf(\"%*c\", -spaces-1, '\\n')\n    s = strings.Replace(s, old, \"\\n\", -1)\n    return strings.Trim(s, \"\\n\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 99, "user_id": 7600168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/118b29ac3165aaa70061eba066c4f5b3?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Kumar", "link": "https://stackoverflow.com/users/7600168/abhishek-kumar"}, "is_accepted": false, "score": 1, "last_activity_date": 1487764872, "creation_date": 1487764872, "answer_id": 42390868, "question_id": 42390549, "link": "https://stackoverflow.com/questions/42390549/unindent-a-multiline-string-value/42390868#42390868", "title": "Unindent a multiline string value", "body": "<p>You can try this not a good but easy method.</p>\n\n<pre><code>func main() {\n    text := \"Lorem ipsum dolor sit amet, consectetur adipiscing elit,\\n\" +\n            \"sed do eiusmod tempor incididunt ut labore et dolore magna\\n\" +\n            \"aliqua.\\n\" +\n            \"Ut enim ad minim veniam, quis nostrud exercitation\\n\" +\n            \"ullamco laboris nisi ut aliquip ex ea commodo consequat.\"\n    fmt.Println(text)\n\n\n}\n</code></pre>\n"}], "owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 42390774, "answer_count": 2, "score": 0, "last_activity_date": 1487773112, "creation_date": 1487764137, "last_edit_date": 1487765014, "question_id": 42390549, "link": "https://stackoverflow.com/questions/42390549/unindent-a-multiline-string-value", "title": "Unindent a multiline string value", "body": "<p>I don't like the Go convention for multiline strings:</p>\n\n<pre><code>function main() {\n  for {\n    if something {\n      text := `   Lorem ipsum dolor sit amet, consectetur adipiscing elit,\nsed do eiusmod tempor incididunt ut labore et dolore magna \naliqua. \n   Ut enim ad minim veniam, quis nostrud exercitation \nullamco laboris nisi ut aliquip ex ea commodo consequat.\n      `\n    }\n  }\n}\n</code></pre>\n\n<p>I prefer:</p>\n\n<pre><code>function main() {\n  for {\n    if something {\n      text := `\n           Lorem ipsum dolor sit amet, consectetur adipiscing elit,\n        sed do eiusmod tempor incididunt ut labore et dolore magna\n        aliqua. \n           Ut enim ad minim veniam, quis nostrud exercitation \n        ullamco laboris nisi ut aliquip ex ea commodo consequat.\n      `\n      // text = unindent(text, 8) ?\n    }\n  }\n}\n</code></pre>\n\n<p>Efficiency isn't a concern.</p>\n\n<p>How do I remove a fixed number of spaces from the start of each line in my string value?</p>\n"}, {"tags": ["google-app-engine", "go", "google-bigquery", "google-cloud-storage"], "answers": [{"comments": [{"owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "edited": false, "score": 0, "creation_date": 1487767852, "post_id": 42390473, "comment_id": 71931343, "body": "Seems a bit weird that you cannot access the temporary table created by the Query result and store (/export) that to the GCS. Is it reasonable to do this instead of parsing and uploading the data myself regarding performance?"}, {"owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "edited": false, "score": 0, "creation_date": 1487769240, "post_id": 42390473, "comment_id": 71932416, "body": "My result queries are between 1-5 mb"}, {"owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "reply_to_user": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "edited": false, "score": 0, "creation_date": 1487799891, "post_id": 42390473, "comment_id": 71952748, "body": "Weird or not, that&#39;s how it is I&#39;m afraid. To export to GCS, you first need to write to a permanent table, then kick off an export job to GCS."}, {"owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "edited": false, "score": 0, "creation_date": 1521720620, "post_id": 42390473, "comment_id": 85857689, "body": "For future reference they have now (since Dec 2017) added the feature to access it directly: <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go/issues/547\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/google-cloud-go/issues/547</a>"}], "tags": [], "owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "is_accepted": true, "score": 1, "last_activity_date": 1487763981, "last_edit_date": 1495540816, "creation_date": 1487763981, "answer_id": 42390473, "question_id": 42388804, "link": "https://stackoverflow.com/questions/42388804/extracting-result-from-google-bigquery-to-cloud-storage-golang/42390473#42390473", "title": "Extracting result from Google BigQuery to cloud storage golang", "body": "<blockquote>\n  <p>How do I extract the result of my BigQuery to GCS</p>\n</blockquote>\n\n<p>You cannot directly write the results of a query to GCS. You first need to run the query, save the results to a permanent table, and then kick off an export job to GCS. </p>\n\n<p><a href=\"https://cloud.google.com/bigquery/docs/exporting-data\" rel=\"nofollow noreferrer\">https://cloud.google.com/bigquery/docs/exporting-data</a></p>\n\n<blockquote>\n  <p>How do I get access to the temporary table when using Go Lang instead of command line.</p>\n</blockquote>\n\n<p>You call use the jobs API, or look in the query history if using the web UI. See <a href=\"https://stackoverflow.com/questions/36190055/in-bigquery-if-every-query-creates-a-temporary-table-is-it-possible-to-find-out\">here</a> and <a href=\"https://cloud.google.com/bigquery/docs/reference/rest/v2/jobs/get\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p><a href=\"https://cloud.google.com/bigquery/querying-data#temporary_and_permanent_tables\" rel=\"nofollow noreferrer\">https://cloud.google.com/bigquery/querying-data#temporary_and_permanent_tables</a></p>\n"}], "owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1275, "favorite_count": 0, "accepted_answer_id": 42390473, "answer_count": 1, "score": 0, "last_activity_date": 1521720777, "creation_date": 1487759831, "last_edit_date": 1521720777, "question_id": 42388804, "link": "https://stackoverflow.com/questions/42388804/extracting-result-from-google-bigquery-to-cloud-storage-golang", "title": "Extracting result from Google BigQuery to cloud storage golang", "body": "<p>I am using the following GoLang package: <a href=\"https://godoc.org/cloud.google.com/go/bigquery\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/bigquery</a></p>\n\n<p>My app runs in Google App Engine</p>\n\n<p>If I have understood the documentation correctly it should be possible to extract the result of a job/query to Google Cloud Storage using a job. I don't think the documentation is very clear and was wondering if anyone has an example code or other help.</p>\n\n<p><strong>TL:DR</strong> </p>\n\n<ol>\n<li><p>How do I get access to the temporary table when using Go Lang instead of command line.</p></li>\n<li><p>How do I extract the result of my Bigquery to GCS </p></li>\n</ol>\n\n<p>** EDIT **</p>\n\n<p><strong>Solution i used</strong></p>\n\n<p>I created a temporary table and set it as the <em>Dst</em> (Destination) for the Query result and created an export job with it.</p>\n\n<pre><code>dataset_result.Table(table_name).Create(ctx, bigquery.TableExpiration(time.Now().Add(1*time.Hour)))\n</code></pre>\n\n<p>Update 2018:</p>\n\n<p><a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go/issues/547\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/google-cloud-go/issues/547</a></p>\n\n<p>To get the table name:</p>\n\n<pre><code>q := client.Query(...)\njob, err := q.Run(ctx)\n// handle err\nconfig, err := job.Config()\n// handle err\ntempTable := config.(*QueryConfig).Dst\n</code></pre>\n"}, {"tags": ["unit-testing", "testing", "go", "mocking"], "comments": [{"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 1, "creation_date": 1487763256, "post_id": 42388439, "comment_id": 71927949, "body": "Post some cod otherwise it&#39;s quite difficult know what you are trying to do"}], "answers": [{"comments": [{"owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "edited": false, "score": 0, "creation_date": 1487807617, "post_id": 42400285, "comment_id": 71955922, "body": "thanks for the simple example...in this case the function I want to test MUST take the Mailer interface as input....correct?"}, {"owner": {"reputation": 515, "user_id": 927588, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117c87ac418e42aa9145f86c3ab93b8c?s=128&d=identicon&r=PG", "display_name": "Sasan Rose", "link": "https://stackoverflow.com/users/927588/sasan-rose"}, "reply_to_user": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "edited": false, "score": 0, "creation_date": 1487807780, "post_id": 42400285, "comment_id": 71955981, "body": "@deltaskelta Also, to mock the API call you can use net/http/httptest"}], "tags": [], "owner": {"reputation": 1181, "user_id": 818341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60f45a2e41581efd75e909a55943eb91?s=128&d=identicon&r=PG&f=1", "display_name": "Arash", "link": "https://stackoverflow.com/users/818341/arash"}, "is_accepted": true, "score": 4, "last_activity_date": 1492453297, "last_edit_date": 1492453297, "creation_date": 1487790766, "answer_id": 42400285, "question_id": 42388439, "link": "https://stackoverflow.com/questions/42388439/mocking-in-go-is-there-an-easy-way/42400285#42400285", "title": "mocking in go. Is there an easy way?", "body": "<p>You can do it by using an interface. For example let's say you have an interface called Mailer:</p>\n\n<pre><code>type Mailer interface {\n    Send() error\n}\n</code></pre>\n\n<p>Now you can embed a Mailer object into the function that calls the <code>Send</code> method.</p>\n\n<pre><code>type Processor struct {\n    Mailer\n}\n\nfunc (p *Processor) Process() {\n    _ = p.Mailer.Send()\n}\n</code></pre>\n\n<p>Now in your test you can create a mock Mailer.</p>\n\n<pre><code>type mockMailer struct{}\n//implement the Send on the mockMailer as you wish\n\np := &amp;Processor{\n    Mailer: mockMailer,\n}\n\np.Process()\n</code></pre>\n\n<p>when <code>p.Process</code> reaches the <code>Send</code> method it calls your mocked <code>Send</code> method.</p>\n"}], "owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 261, "favorite_count": 0, "accepted_answer_id": 42400285, "answer_count": 1, "score": 0, "last_activity_date": 1492453297, "creation_date": 1487757955, "last_edit_date": 1487763239, "question_id": 42388439, "link": "https://stackoverflow.com/questions/42388439/mocking-in-go-is-there-an-easy-way", "title": "mocking in go. Is there an easy way?", "body": "<p>I come from python and I have been looking for a way to write yests in go. I have come across a few things on SO but they all seem very cumbersome and verbose for something that shpuld be needed all the time.</p>\n\n<p>I am typing on mobile now, will add code later if needed...but for example...</p>\n\n<p>say i have a function that calls <code>smtp.Send</code> somewhere in the middle. how can I easily test this function?</p>\n\n<p>Say i have another one that hits some outside api (needs mocking) and then takes the response and calls something like <code>ioutil.Readall()</code>...how could i make my way through this test function and mock the call to the api and then pass some fake response data when <code>Readall</code> is called?</p>\n"}, {"tags": ["go", "plugins"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1487757969, "post_id": 42388090, "comment_id": 71924951, "body": "Which system are you using? Plugins are currently just supported on Linux. <a href=\"https://golang.org/doc/go1.8#plugin\" rel=\"nofollow noreferrer\">golang.org/doc/go1.8#plugin</a>"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 7603818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb3ba6a925a3d93bcaa7925bed34a291?s=128&d=identicon&r=PG&f=1", "display_name": "Zhang Xu", "link": "https://stackoverflow.com/users/7603818/zhang-xu"}, "edited": false, "score": 0, "creation_date": 1487814670, "post_id": 42389345, "comment_id": 71958092, "body": "Thanks very much for your answer, but it&#39;s not  solve the problem, because I described the reasons for unclear. Now i was edit this problem, in fact my solution is like your solution 1."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 21, "user_id": 7603818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb3ba6a925a3d93bcaa7925bed34a291?s=128&d=identicon&r=PG&f=1", "display_name": "Zhang Xu", "link": "https://stackoverflow.com/users/7603818/zhang-xu"}, "edited": false, "score": 0, "creation_date": 1487863756, "post_id": 42389345, "comment_id": 71985110, "body": "@ZhangXu I don&#39;t see any <code>filter</code> package where you claim there is: <a href=\"https://github.com/fagongzi/gateway/tree/master/pkg\" rel=\"nofollow noreferrer\">github.com/fagongzi/gateway/tree/master/pkg</a>. You are somehow mixing the imports / package paths."}, {"owner": {"reputation": 21, "user_id": 7603818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb3ba6a925a3d93bcaa7925bed34a291?s=128&d=identicon&r=PG&f=1", "display_name": "Zhang Xu", "link": "https://stackoverflow.com/users/7603818/zhang-xu"}, "edited": false, "score": 0, "creation_date": 1487985294, "post_id": 42389345, "comment_id": 72045411, "body": "Hi, i&#39;m sorry, it&#39;s in the <a href=\"https://github.com/fagongzi/gateway/tree/go18-plugin-support\" rel=\"nofollow noreferrer\">github.com/fagongzi/gateway/tree/go18-plugin-support</a> branch. i also open a issue to golang(<a href=\"https://github.com/golang/go/issues/19233\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/19233</a>), and it&#39;s may be a vendor package problem.I will  to verify it when i free"}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1573299424, "post_id": 42389345, "comment_id": 103842291, "body": "The plugin code is defined in package main and the plugin is loaded in main. Would this still work if the plugin was loaded from another package than main ? In other words, do the plugin package name need to match the package name where it is loaded (main in the example you gave) ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1573479715, "post_id": 42389345, "comment_id": 103884953, "body": "@chmike The plugin must have package <code>main</code>, and it can be loaded from anywhere. But a runnable app must also have a package <code>main</code>, the <code>main()</code> function of package <code>main</code> is the entry point of the app. The plugin&#39;s <code>main</code> and the app&#39;s <code>main</code> are 2 different, distinct packages."}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1573578443, "post_id": 42389345, "comment_id": 103923739, "body": "@icza I had one last question. In a reddit comment, it was reported that the plugin and main program must be compiled with a same version of go compiler and the same version of imported libraries. Is this really required ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "edited": false, "score": 0, "creation_date": 1573578844, "post_id": 42389345, "comment_id": 103923933, "body": "@chmike Yes, that&#39;s right. Else you&#39;ll get an error when opening the plugin."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 9, "last_activity_date": 1487788820, "last_edit_date": 1495541871, "creation_date": 1487761192, "answer_id": 42389345, "question_id": 42388090, "link": "https://stackoverflow.com/questions/42388090/go-1-8-plugin-use-custom-interface/42389345#42389345", "title": "go 1.8 plugin use custom interface", "body": "<p>Custom interfaces work just fine.</p>\n\n<p>But one important thing: you can only <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"noreferrer\">type assert</a> types from values looked up from plugins that are defined <strong>outside</strong> of the plugin (you can't refer types defined in plugins). This also applies to each component of \"composite types\", for example you can only type assert a function type whose parameter and result types are also defined outside of the plugin.</p>\n\n<h2>1. With a common package outside of the plugin</h2>\n\n<p>One solution is to define the interface in a package outside of the plugin, and both the plugin and your app can import it and refer to it.</p>\n\n<p>Define it in package <code>filter</code>:</p>\n\n<pre><code>package filter\n\ntype Filter interface {\n    Name() string\n    Age() int\n}\n</code></pre>\n\n<p>The plugin is in package <code>pq</code> and imports package <code>filter</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"filter\"\n)\n\ntype plgFilter struct{}\n\nfunc (plgFilter) Name() string { return \"Bob\" }\nfunc (plgFilter) Age() int     { return 23 }\n\nfunc GetFilter() (f filter.Filter, err error) {\n    f = plgFilter{}\n    fmt.Printf(\"[plugin GetFilter] Returning filter: %T %v\\n\", f, f)\n    return\n}\n</code></pre>\n\n<p>And the main app that also imports (the same) package <code>filter</code>, loads the plugin, looks up <code>GetFilter()</code>, calls it and also uses the returned <code>Filter</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"filter\"\n    \"plugin\"\n)\n\nfunc main() {\n    p, err := plugin.Open(\"pg/pg.so\")\n    if err != nil {\n        panic(err)\n    }\n\n    GetFilter, err := p.Lookup(\"GetFilter\")\n    if err != nil {\n        panic(err)\n    }\n    filter, err := GetFilter.(func() (filter.Filter, error))()\n    fmt.Printf(\"GetFilter result: %T %v %v\\n\", filter, filter, err)\n    fmt.Println(\"\\tName:\", filter.Name())\n    fmt.Println(\"\\tAge:\", filter.Age())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[plugin GetFilter] Returning filter: main.plgFilter {}\nGetFilter result: main.plgFilter {} &lt;nil&gt;\n        Name: Bob\n        Age: 23\n</code></pre>\n\n<h2>2. With plugin returning <code>interface{}</code>, and interface defined in main app</h2>\n\n<p>Another solution is to have the plugin function return a value of type <code>interface{}</code>. Your main app can define the interface it expects, and it can use type assertion on the <code>interface{}</code> value returned by the plugin.</p>\n\n<p>No <code>filter</code> package this time.</p>\n\n<p>The plugin is in package <code>pq</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype plgFilter struct{}\n\nfunc (plgFilter) Name() string { return \"Bob\" }\nfunc (plgFilter) Age() int     { return 23 }\n\nfunc GetFilterIface() (f interface{}, err error) {\n    f = plgFilter{}\n    fmt.Printf(\"[plugin GetFilterIface] Returning filter: %T %v\\n\", f, f)\n    return\n}\n</code></pre>\n\n<p>And the main app:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"plugin\"\n)\n\nfunc main() {\n    p, err := plugin.Open(\"pg/pg.so\")\n    if err != nil {\n        panic(err)\n    }\n\n    GetFilterIface, err := p.Lookup(\"GetFilterIface\")\n    if err != nil {\n        panic(err)\n    }\n    filterIface, err := GetFilterIface.(func() (interface{}, error))()\n    fmt.Printf(\"GetFilterIface result: %T %v %v\\n\", filterIface, filterIface, err)\n    myfilter := filterIface.(MyFilter)\n    fmt.Println(\"\\tName:\", myfilter.Name())\n    fmt.Println(\"\\tAge:\", myfilter.Age())\n}\n\ntype MyFilter interface {\n    Name() string\n    Age() int\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[plugin GetFilterIface] Returning filter: main.plgFilter {}\nGetFilterIface result: main.plgFilter {} &lt;nil&gt;\n        Name: Bob\n        Age: 23\n</code></pre>\n\n<p>Also see related question: <a href=\"https://stackoverflow.com/questions/42218472/how-do-go-plugin-dependencies-work/42220856#42220856\">How do Go plugin dependencies work?</a></p>\n"}], "owner": {"reputation": 21, "user_id": 7603818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb3ba6a925a3d93bcaa7925bed34a291?s=128&d=identicon&r=PG&f=1", "display_name": "Zhang Xu", "link": "https://stackoverflow.com/users/7603818/zhang-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2371, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1487816931, "creation_date": 1487757069, "last_edit_date": 1487816931, "question_id": 42388090, "link": "https://stackoverflow.com/questions/42388090/go-1-8-plugin-use-custom-interface", "title": "go 1.8 plugin use custom interface", "body": "<p>I want to use custom interface based on go plugin, but I found it's not support. </p>\n\n<h3>Definition of filter.Filter</h3>\n\n<pre><code>package filter\n\nimport (\n    \"net/http\"\n\n    \"github.com/valyala/fasthttp\"\n)\n\n// Context filter context\ntype Context interface {\n    SetStartAt(startAt int64)\n    SetEndAt(endAt int64)\n    GetStartAt() int64\n    GetEndAt() int64\n\n    GetProxyServerAddr() string\n    GetProxyOuterRequest() *fasthttp.Request\n    GetProxyResponse() *fasthttp.Response\n    NeedMerge() bool\n\n    GetOriginRequestCtx() *fasthttp.RequestCtx\n\n    GetMaxQPS() int\n\n    ValidateProxyOuterRequest() bool\n\n    InBlacklist(ip string) bool\n    InWhitelist(ip string) bool\n\n    IsCircuitOpen() bool\n    IsCircuitHalf() bool\n\n    GetOpenToCloseFailureRate() int\n    GetHalfTrafficRate() int\n    GetHalfToOpenSucceedRate() int\n    GetOpenToCloseCollectSeconds() int\n\n    ChangeCircuitStatusToClose()\n    ChangeCircuitStatusToOpen()\n\n    RecordMetricsForRequest()\n    RecordMetricsForResponse()\n    RecordMetricsForFailure()\n    RecordMetricsForReject()\n\n    GetRecentlyRequestSuccessedCount(sec int) int\n    GetRecentlyRequestCount(sec int) int\n    GetRecentlyRequestFailureCount(sec int) int\n}\n\n// Filter filter interface\ntype Filter interface {\n    Name() string\n\n    Pre(c Context) (statusCode int, err error)\n    Post(c Context) (statusCode int, err error)\n    PostErr(c Context)\n}\n\n// BaseFilter base filter support default implemention\ntype BaseFilter struct{}\n\n// Pre execute before proxy\nfunc (f BaseFilter) Pre(c Context) (statusCode int, err error) {\n    return http.StatusOK, nil\n}\n\n// Post execute after proxy\nfunc (f BaseFilter) Post(c Context) (statusCode int, err error) {\n    return http.StatusOK, nil\n}\n\n// PostErr execute proxy has errors\nfunc (f BaseFilter) PostErr(c Context) {\n\n}\n</code></pre>\n\n<p>This pkg is in my go app project.</p>\n\n<h3>load plugin file</h3>\n\n<pre><code>package proxy\n\nimport (\n    \"errors\"\n    \"plugin\"\n    \"strings\"\n\n    \"github.com/fagongzi/gateway/pkg/conf\"\n    \"github.com/fagongzi/gateway/pkg/filter\"\n)\n\nvar (\n    // ErrKnownFilter known filter error\n    ErrKnownFilter = errors.New(\"unknow filter\")\n)\n\nconst (\n    // FilterHTTPAccess access log filter\n    FilterHTTPAccess = \"HTTP-ACCESS\"\n    // FilterHeader header filter\n    FilterHeader = \"HEAD\" // process header fiter\n    // FilterXForward xforward fiter\n    FilterXForward = \"XFORWARD\"\n    // FilterBlackList blacklist filter\n    FilterBlackList = \"BLACKLIST\"\n    // FilterWhiteList whitelist filter\n    FilterWhiteList = \"WHITELIST\"\n    // FilterAnalysis analysis filter\n    FilterAnalysis = \"ANALYSIS\"\n    // FilterRateLimiting limit filter\n    FilterRateLimiting = \"RATE-LIMITING\"\n    // FilterCircuitBreake circuit breake filter\n    FilterCircuitBreake = \"CIRCUIT-BREAKE\"\n    // FilterValidation validation request filter\n    FilterValidation = \"VALIDATION\"\n)\n\nfunc newFilter(filterSpec *conf.FilterSpec) (filter.Filter, error) {\n    if filterSpec.External {\n        return newExternalFilter(filterSpec)\n    }\n\n    input := strings.ToUpper(filterSpec.Name)\n\n    switch input {\n    case FilterHTTPAccess:\n        return newAccessFilter(), nil\n    case FilterHeader:\n        return newHeadersFilter(), nil\n    case FilterXForward:\n        return newXForwardForFilter(), nil\n    case FilterAnalysis:\n        return newAnalysisFilter(), nil\n    case FilterBlackList:\n        return newBlackListFilter(), nil\n    case FilterWhiteList:\n        return newWhiteListFilter(), nil\n    case FilterRateLimiting:\n        return newRateLimitingFilter(), nil\n    case FilterCircuitBreake:\n        return newCircuitBreakeFilter(), nil\n    case FilterValidation:\n        return newValidationFilter(), nil\n    default:\n        return nil, ErrKnownFilter\n    }\n}\n\nfunc newExternalFilter(filterSpec *conf.FilterSpec) (filter.Filter, error) {\n    p, err := plugin.Open(filterSpec.ExternalPluginFile)\n    if err != nil {\n        return nil, err\n    }\n\n    s, err := p.Lookup(\"NewExternalFilter\")\n    if err != nil {\n        return nil, err\n    }\n\n    sf := s.(func() (filter.Filter, error))\n    return sf()\n}\n</code></pre>\n\n<p>This is the code of load plugin in my go app project</p>\n\n<pre><code>package main\n\nimport (\n    \"C\"\n    \"strings\"\n    \"time\"\n\n    \"github.com/CodisLabs/codis/pkg/utils/log\"\n    \"github.com/fagongzi/gateway/pkg/filter\"\n    \"github.com/valyala/fasthttp\"\n)\n\n// AccessFilter record the http access log\n// log format: $remoteip \"$method $path\" $code \"$agent\" $svr $cost\ntype AccessFilter struct {\n}\n\n// NewExternalFilter create a External filter\nfunc NewExternalFilter() (filter.Filter, error) {\n    return &amp;AccessFilter{}, nil\n}\n\n// Name return name of this filter\nfunc (f *AccessFilter) Name() string {\n    return \"HTTP-ACCESS\"\n}\n\n// Pre pre process\nfunc (f *AccessFilter) Pre(c filter.Context) (statusCode int, err error) {\n    return 200, nil\n}\n\n// Post execute after proxy\nfunc (f *AccessFilter) Post(c filter.Context) (statusCode int, err error) {\n    cost := (c.GetStartAt() - c.GetEndAt())\n\n    log.Infof(\"%s %s \\\"%s\\\" %d \\\"%s\\\" %s %s\",\n        GetRealClientIP(c.GetOriginRequestCtx()),\n        c.GetOriginRequestCtx().Method(),\n        c.GetProxyOuterRequest().RequestURI(),\n        c.GetProxyResponse().StatusCode(),\n        c.GetOriginRequestCtx().UserAgent(),\n        c.GetProxyServerAddr(),\n        time.Duration(cost))\n\n    return 200, nil\n}\n\n// PostErr post error process\nfunc (f *AccessFilter) PostErr(c filter.Context) {\n\n}\n\n// GetRealClientIP get read client ip\nfunc GetRealClientIP(ctx *fasthttp.RequestCtx) string {\n    xforward := ctx.Request.Header.Peek(\"X-Forwarded-For\")\n    if nil == xforward {\n        return strings.SplitN(ctx.RemoteAddr().String(), \":\", 2)[0]\n    }\n\n    return strings.SplitN(string(xforward), \",\", 2)[0]\n}\n</code></pre>\n\n<p>This is the definition of plugin, it's in my plugin project. The plugin project and go app project are different projects.</p>\n\n<h3>I found errors:</h3>\n\n<pre><code>panic: interface conversion: plugin.Symbol is func() (filter.Filter, error), not func() (filter.Filter, error)\n</code></pre>\n\n<p>You can find code in this project https://github.com/fagongzi/gateway/tree/go18-plugin-support.</p>\n\n<ol>\n<li><code>filter.Filter</code> is in pkg/filter package.</li>\n<li><code>load plugin file</code> in proxy/factory.go</li>\n<li><code>plugin go file</code> is in another project.</li>\n</ol>\n"}, {"tags": ["excel", "go", "xlsx"], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 7488949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9720750bb2e8c636021112c3d4b74cd7?s=128&d=identicon&r=PG&f=1", "display_name": "maxwell", "link": "https://stackoverflow.com/users/7488949/maxwell"}, "is_accepted": true, "score": 1, "last_activity_date": 1488265529, "creation_date": 1488265529, "answer_id": 42502263, "question_id": 42388059, "link": "https://stackoverflow.com/questions/42388059/in-golang-how-can-i-output-a-newline-within-a-cell-in-xlsx/42502263#42502263", "title": "In golang, How can I output a newline within a cell in xlsx", "body": "<p>\"Github.com / tealeg / xlsx\"<br>\nThere is an Alignment type in the field of the Style type,<br>\nI found WrapText in an Alignment type field.<br>\nIf set to true, I could \"Wrap Text\".</p>\n"}], "owner": {"reputation": 23, "user_id": 7488949, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9720750bb2e8c636021112c3d4b74cd7?s=128&d=identicon&r=PG&f=1", "display_name": "maxwell", "link": "https://stackoverflow.com/users/7488949/maxwell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 890, "favorite_count": 0, "accepted_answer_id": 42502263, "answer_count": 1, "score": 0, "last_activity_date": 1488265529, "creation_date": 1487756966, "question_id": 42388059, "link": "https://stackoverflow.com/questions/42388059/in-golang-how-can-i-output-a-newline-within-a-cell-in-xlsx", "title": "In golang, How can I output a newline within a cell in xlsx", "body": "<p>I am developing in Go language, echo framework.</p>\n\n<p>I am using package \"github.com/tealeg/xlsx\" and \"github.com/Luxurioust/excelize\" to create and output xlsx.</p>\n\n<p>After writing \\n in the cell and outputting it, if I set \"Wrap text\", a newline will be displayed.</p>\n\n<p>But they cannot set \"Wrap text\" to xlsx in the program.</p>\n\n<p>How can I do in order to see newline when I output it? Or is there a package to solve that problem?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1487756590, "last_edit_date": 1487756590, "creation_date": 1487755326, "answer_id": 42387374, "question_id": 42387123, "link": "https://stackoverflow.com/questions/42387123/only-proceed-if-struct-is-not-empty/42387374#42387374", "title": "Only proceed if []struct is not empty", "body": "<p>You may simply use the <code>{{with}}</code> action. Quoting from the package doc of <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\"><code>text/template</code></a>:</p>\n\n<pre><code>{{with pipeline}} T1 {{end}}\n    If the value of the pipeline is empty, no output is generated;\n    otherwise, dot is set to the value of the pipeline and T1 is\n    executed.\n</code></pre>\n\n<p>Since <code>{{with}}</code> also sets the pipeline, modify your <code>{{range}}</code> to this:</p>\n\n<pre><code>{{ range $anl := . }}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>{{ with $jb.Anleitung }}\n     &lt;div class=\"btn-group\"&gt;\n        &lt;button type=\"button\" class=\"btn btn-info dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n              &lt;span class=\"badge\"&gt;4&lt;/span&gt; Anleitungen &lt;span class=\"caret\"&gt;&lt;/span&gt;\n        &lt;/button&gt;\n        &lt;ul class=\"dropdown-menu\"&gt;\n            {{ range $anl := . }}\n                 &lt;li&gt;&lt;a href=\"{{ $anl.Link }}?ref=jbguide\"&gt;{{ $anl.Name }}&lt;/a&gt;&lt;/li&gt;\n             {{ end }}\n         &lt;/ul&gt;\n      &lt;/div&gt;\n{{ end }}\n</code></pre>\n\n<p>Going further, you can simplify the <code>{{range}}</code> as we don't need the <code>$anl</code> variable, <code>{{range}}</code> also sets the pipeline:</p>\n\n<pre><code>{{ range . }}\n    &lt;li&gt;&lt;a href=\"{{.Link}}?ref=jbguide\"&gt;{{.Name}}&lt;/a&gt;&lt;/li&gt;\n{{ end }}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>t := template.Must(template.New(\"\").Parse(templ))\nm := map[string]interface{}{}\nfmt.Println(\"First, no params:\")\nif err := t.Execute(os.Stdout, m); err != nil {\n    fmt.Println(err)\n}\n\nfmt.Println(\"Next, 2 values:\")\nm = map[string]interface{}{\n    \"Anleitung\": []struct {\n        Name string `json:\"blog\"`\n        Link string `json:\"link\"`\n    }{\n        {\"Bob\", \"http://google.com\"},\n        {\"Alice\", \"http://amazon.com\"},\n    },\n}\nif err := t.Execute(os.Stdout, m); err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/OCk9WCdbqD\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>First, no params:\n\nNext, 2 values:\n\n\n     &lt;div class=\"btn-group\"&gt;\n        &lt;button type=\"button\" class=\"btn btn-info dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n              &lt;span class=\"badge\"&gt;4&lt;/span&gt; Anleitungen &lt;span class=\"caret\"&gt;&lt;/span&gt;\n        &lt;/button&gt;\n        &lt;ul class=\"dropdown-menu\"&gt;\n\n                 &lt;li&gt;&lt;a href=\"http://google.com?ref=jbguide\"&gt;Bob&lt;/a&gt;&lt;/li&gt;\n\n                 &lt;li&gt;&lt;a href=\"http://amazon.com?ref=jbguide\"&gt;Alice&lt;/a&gt;&lt;/li&gt;\n\n         &lt;/ul&gt;\n      &lt;/div&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1487755597, "post_id": 42387424, "comment_id": 71923098, "body": "@icza: Oh indeed."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1487755560, "last_edit_date": 1487755560, "creation_date": 1487755438, "answer_id": 42387424, "question_id": 42387123, "link": "https://stackoverflow.com/questions/42387123/only-proceed-if-struct-is-not-empty/42387424#42387424", "title": "Only proceed if []struct is not empty", "body": "<p>Two things:</p>\n\n<ol>\n<li>Your <code>ne</code> syntax is wrong. It needs to begin with <code>if</code>, then your <code>{{ end }}</code> will no longer be a syntax error.</li>\n<li>Your struct is never going to equal <code>\"\"</code>, because it's not a string. If you want to know if the slice is empty, you must check its length. The way to do this in a template is, <a href=\"https://golang.org/pkg/text/template/#hdr-Actions\" rel=\"nofollow noreferrer\">as documented</a>, with <code>pipeline</code>. This will, in effect, render #1 obsolete.</li>\n</ol>\n"}], "owner": {"reputation": 541, "user_id": 7100836, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cdc87122e512082b4b53e9f74fc804ad?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian", "link": "https://stackoverflow.com/users/7100836/fabian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1487756590, "creation_date": 1487754728, "question_id": 42387123, "link": "https://stackoverflow.com/questions/42387123/only-proceed-if-struct-is-not-empty", "title": "Only proceed if []struct is not empty", "body": "<p>I have an []struct that can have no content but also it is possible that it has content:</p>\n\n<pre><code>Anleitung  []struct {\n    Name string `json:\"blog\"`\n    Link string `json:\"link\"`\n} `json:\"anleitung\"`\n</code></pre>\n\n<p>In my template I try to check if Anleitung contains something, and only then proceed: </p>\n\n<pre><code>{{ ne $jb.Anleitung \"\" }}\n     &lt;div class=\"btn-group\"&gt;\n        &lt;button type=\"button\" class=\"btn btn-info dropdown-toggle\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\"&gt;\n              &lt;span class=\"badge\"&gt;4&lt;/span&gt; Anleitungen &lt;span class=\"caret\"&gt;&lt;/span&gt;\n        &lt;/button&gt;\n        &lt;ul class=\"dropdown-menu\"&gt;\n            {{ range $anl := $jb.Anleitung }}\n                 &lt;li&gt;&lt;a href=\"{{ $anl.Link }}?ref=jbguide\"&gt;{{ $anl.Name }}&lt;/a&gt;&lt;/li&gt;\n             {{ end }}\n         &lt;/ul&gt;\n      &lt;/div&gt;\n{{ end }}\n</code></pre>\n\n<p>compiling the whole thing gives me the following error:</p>\n\n<blockquote>\n  <p>Error rendering <code>index</code> template: template: index.tmpl:131: unexpected {{end}} </p>\n</blockquote>\n\n<p>Row no 131 is the last row in the template file.</p>\n\n<p>Is there a way to check if the []struct contains any data? </p>\n"}, {"tags": ["linux", "ubuntu", "go", "rhel", "oracle-osm"], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 4202694, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45aebe888d67a525019c97bf0a8995ca?s=128&d=identicon&r=PG&f=1", "display_name": "avishkar", "link": "https://stackoverflow.com/users/4202694/avishkar"}, "edited": false, "score": 0, "creation_date": 1487760073, "post_id": 42387003, "comment_id": 71925711, "body": "lsb_release will do. Thanks. Actually, I was looking if there is go specific functionality."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 39, "user_id": 4202694, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45aebe888d67a525019c97bf0a8995ca?s=128&d=identicon&r=PG&f=1", "display_name": "avishkar", "link": "https://stackoverflow.com/users/4202694/avishkar"}, "edited": false, "score": 0, "creation_date": 1487826778, "post_id": 42387003, "comment_id": 71961613, "body": "The go binary is built with <code>GOARCH</code> and <code>GOOS</code> as input. The would be no other information available to it about the distribution that it is running on."}, {"owner": {"reputation": 39, "user_id": 4202694, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45aebe888d67a525019c97bf0a8995ca?s=128&d=identicon&r=PG&f=1", "display_name": "avishkar", "link": "https://stackoverflow.com/users/4202694/avishkar"}, "edited": false, "score": 0, "creation_date": 1487831245, "post_id": 42387003, "comment_id": 71963474, "body": "Thanks, I end up using lsb_release."}, {"owner": {"reputation": 455, "user_id": 3151187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r3v0p.png?s=128&g=1", "display_name": "maxadamo", "link": "https://stackoverflow.com/users/3151187/maxadamo"}, "edited": false, "score": 0, "creation_date": 1606068940, "post_id": 42387003, "comment_id": 114841474, "body": "lsb_release is not always installed"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 3, "last_activity_date": 1487754342, "creation_date": 1487754342, "answer_id": 42387003, "question_id": 42386788, "link": "https://stackoverflow.com/questions/42386788/how-can-i-detect-linux-distribution-within-golang-program/42387003#42387003", "title": "How can I detect linux distribution within GOlang program?", "body": "<p>You can use <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"nofollow noreferrer\">exec.Cmd</a> to run <code>lsb_release -a</code> or <code>uname -a</code> and parse the output to find out the distribution.</p>\n\n<p><a href=\"https://www.cyberciti.biz/faq/find-linux-distribution-name-version-number/\" rel=\"nofollow noreferrer\">Reference</a></p>\n"}, {"tags": [], "owner": {"reputation": 455, "user_id": 3151187, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r3v0p.png?s=128&g=1", "display_name": "maxadamo", "link": "https://stackoverflow.com/users/3151187/maxadamo"}, "is_accepted": false, "score": 0, "last_activity_date": 1619080402, "last_edit_date": 1619080402, "creation_date": 1606081738, "answer_id": 64959957, "question_id": 42386788, "link": "https://stackoverflow.com/questions/42386788/how-can-i-detect-linux-distribution-within-golang-program/64959957#64959957", "title": "How can I detect linux distribution within GOlang program?", "body": "<p>The package containing the executable <code>lsb_release</code> may or may not be installed on the system.</p>\n<p>You could use the file <code>/etc/os-release</code>, which can be easily parsed with the library go-ini. See example:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    &quot;fmt&quot;\n    &quot;github.com/go-ini/ini&quot;\n)\n\nfunc ReadOSRelease(configfile string) map[string]string {\n    cfg, err := ini.Load(configfile)\n    if err != nil {\n        log.Fatal(&quot;Fail to read file: &quot;, err)\n    }\n\n    ConfigParams := make(map[string]string)\n    ConfigParams[&quot;ID&quot;] = cfg.Section(&quot;&quot;).Key(&quot;ID&quot;).String()\n\n    return ConfigParams\n}\n\nOSInfo := ReadOSRelease(&quot;/etc/os-release&quot;)\nOSRelease := OSInfo[&quot;ID&quot;]\n\nfmt.Print(OSRelease)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3192, "user_id": 1195276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/497dec1748b2912be9b7272c4a6ea496?s=128&d=identicon&r=PG", "display_name": "FelicianoTech", "link": "https://stackoverflow.com/users/1195276/felicianotech"}, "is_accepted": false, "score": 1, "last_activity_date": 1607464961, "creation_date": 1607464961, "answer_id": 65207574, "question_id": 42386788, "link": "https://stackoverflow.com/questions/42386788/how-can-i-detect-linux-distribution-within-golang-program/65207574#65207574", "title": "How can I detect linux distribution within GOlang program?", "body": "<p>If you wanted to use a Go module, there's <a href=\"https://github.com/zcalusic/sysinfo\" rel=\"nofollow noreferrer\">Sysinfo</a>.</p>\n<p>It collects all of the system info (without any dependencies) and gives you JSON which includes what you're looking for. Here's a snippet of that data:</p>\n<pre><code>&quot;os&quot;: {\n    &quot;name&quot;: &quot;CentOS Linux 7 (Core)&quot;,\n    &quot;vendor&quot;: &quot;centos&quot;,\n    &quot;version&quot;: &quot;7&quot;,\n    &quot;release&quot;: &quot;7.2.1511&quot;,\n    &quot;architecture&quot;: &quot;amd64&quot;\n  },\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 4202694, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45aebe888d67a525019c97bf0a8995ca?s=128&d=identicon&r=PG&f=1", "display_name": "avishkar", "link": "https://stackoverflow.com/users/4202694/avishkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1955, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1619080402, "creation_date": 1487753808, "question_id": 42386788, "link": "https://stackoverflow.com/questions/42386788/how-can-i-detect-linux-distribution-within-golang-program", "title": "How can I detect linux distribution within GOlang program?", "body": "<p>I want to write linux distribution independant Golang code. I need detect which linux distribution and need to run distribution specific commands within program. Like dpkg in case of Ubuntu and rpm -q in case of RHEL. </p>\n"}, {"tags": ["json", "go", "structure", "unmarshalling"], "comments": [{"owner": {"reputation": 1188, "user_id": 1308927, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e6c692ca1e6b1ad945b14b3a2f7e0850?s=128&d=identicon&r=PG", "display_name": "RdB", "link": "https://stackoverflow.com/users/1308927/rdb"}, "edited": false, "score": 0, "creation_date": 1488293693, "post_id": 42385936, "comment_id": 72161006, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/15452004/my-structures-are-not-marshalling-into-json\">My structures are not marshalling into json</a>"}], "answers": [{"tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": true, "score": 1, "last_activity_date": 1487752040, "creation_date": 1487752040, "answer_id": 42386231, "question_id": 42385936, "link": "https://stackoverflow.com/questions/42385936/golang-structure-fields-name-and-unmarshalling-into-this-structure/42386231#42386231", "title": "Golang structure field&#39;s name and unmarshalling into this structure", "body": "<p><code>json.Unmarshal</code> sets only the export fields in a struct and for exporting a field the first letter must be capital.<br>\nFor more information I highly suggest you to take a look to the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">documentation</a></p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1487754091, "creation_date": 1487754091, "answer_id": 42386894, "question_id": 42385936, "link": "https://stackoverflow.com/questions/42385936/golang-structure-fields-name-and-unmarshalling-into-this-structure/42386894#42386894", "title": "Golang structure field&#39;s name and unmarshalling into this structure", "body": "<p>From <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">the documentation</a> (emphasis added):</p>\n\n<blockquote>\n  <p>Unmarshal will only set <strong>exported fields of the struct</strong>.</p>\n</blockquote>\n\n<p>Fields which begin with a lowercase letter are, of course, not exported. So there's no way for the JSON marshaler (or indeed anything at all outside of your package) to affect them.</p>\n"}], "owner": {"reputation": 1188, "user_id": 1308927, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e6c692ca1e6b1ad945b14b3a2f7e0850?s=128&d=identicon&r=PG", "display_name": "RdB", "link": "https://stackoverflow.com/users/1308927/rdb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 42386231, "answer_count": 2, "score": -2, "last_activity_date": 1487754091, "creation_date": 1487751077, "last_edit_date": 1487753973, "question_id": 42385936, "link": "https://stackoverflow.com/questions/42385936/golang-structure-fields-name-and-unmarshalling-into-this-structure", "title": "Golang structure field&#39;s name and unmarshalling into this structure", "body": "<p>I wrote an example program to illustrate my question, and it can be viewed here:\n<a href=\"https://play.golang.org/p/6776lYcbBR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6776lYcbBR</a></p>\n\n<p>So my question is:</p>\n\n<p>when a structure (<strong><em>GameOne</em></strong>) field's name starts with a capital letter, <strong><em>json.Unmarshal</em></strong> works as expected;\nwhen it starts with a lower-case letter (<strong><em>GameTwo</em></strong>), the field value is set to its default.</p>\n\n<p>Why is this so? Has it something to do with scope/visibility rules?</p>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["json", "mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "edited": false, "score": 0, "creation_date": 1487752828, "post_id": 42386423, "comment_id": 71921092, "body": "I actually perceived that I didn&#39;t want to have a json, I just wanted to be able to deal with the data in some way. Now I&#39;ve found the Unmarshal function and Unmarshaled it into a map. However, while doing it, I&#39;m ignoring the Raw.kind field, I&#39;m extracting the Raw.Data directly. Could you look at my update2? Is this the best way to deal with generic data returned from a MongoDB query?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1487752931, "post_id": 42386423, "comment_id": 71921169, "body": "@GuerlandoOCs No, it&#39;s not. The <code>Kind</code> field is to tell how to interpret the <code>Data</code> field. Ignoring it will cause you troubles. Also, let the <code>mgo</code> package handle that for you. Also unmarshaling into a map will also give you errors if the value is an array. To cover all cases, unmarshal into a value of type <code>interface{}</code>, like I did in my answer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "edited": false, "score": 0, "creation_date": 1487753314, "post_id": 42386423, "comment_id": 71921430, "body": "You&#39;re right, I did it and it worked. However, in order to access its members, I have to admit it&#39;s a map and cast to it. Is it bad to do like this? Because how did I know that it&#39;d unmarshal into a map?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1487753384, "post_id": 42386423, "comment_id": 71921473, "body": "@GuerlandoOCs If you know it&#39;s a map, yes, you can use a map. Going even further, if you know all its fields prior, just create a <code>struct</code> modeling it exactly, and unmarshal into a value of that type. You can also use <code>json.Marshal()</code> on your custom types."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1487754682, "last_edit_date": 1487754682, "creation_date": 1487752664, "answer_id": 42386423, "question_id": 42385436, "link": "https://stackoverflow.com/questions/42385436/mongodb-return-entire-json-from-query-using-bson-raw/42386423#42386423", "title": "MongoDB Return entire JSON from query using bson.Raw", "body": "<p>JSON is not a type, so you can't unmarshal into a value of type JSON. <a href=\"http://www.json.org/\" rel=\"nofollow noreferrer\">JSON</a> is a textual representation of some structured data.</p>\n\n<p><a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Raw\" rel=\"nofollow noreferrer\"><code>bson.Raw</code></a> is also not equal to JSON representation, so some kind of transformation is inevitable.</p>\n\n<p>What you may do is unmarshal into a value of type <code>interface{}</code>, and then use <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal()</code></a> to \"render\" the JSON representation.</p>\n\n<p>If you want this to be \"automatic\", you may create a new type called <code>JSONStr</code>, and you may implement the <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Setter\" rel=\"nofollow noreferrer\"><code>bson.Setter</code></a> and <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Getter\" rel=\"nofollow noreferrer\"><code>bson.Getter</code></a> interfaces by it.</p>\n\n<p>This is how it could look like:</p>\n\n<pre><code>type JSONStr string\n\nfunc (j *JSONStr) SetBSON(raw bson.Raw) (err error) {\n    var i interface{}\n    if err = raw.Unmarshal(&amp;i); err != nil {\n        return\n    }\n    data, err := json.Marshal(i)\n    if err != nil {\n        return\n    }\n    *j = JSONStr(data)\n    return\n}\n\nfunc (j *JSONStr) GetBSON() (interface{}, error) {\n    var i interface{}\n    if err := json.Unmarshal([]byte(*j), &amp;i); err != nil {\n        return nil, err\n    }\n    return i, nil\n}\n</code></pre>\n\n<p>And using this <code>JSONStr</code> type:</p>\n\n<pre><code>type Dialog struct {\n    Dialog JSONStr `bson:\"dialog\"`\n}\n</code></pre>\n\n<p><strong>Update:</strong></p>\n\n<p>If you don't really want a JSON text representation, just use type <code>interface{}</code>:</p>\n\n<pre><code>type Dialog struct {\n    Dialog interface{} `bson:\"dialog\"`\n}\n</code></pre>\n\n<p>And obtain the JSON text like this:</p>\n\n<pre><code>var dialog Dialog\n// load a dialog\ndata, err := json.Marshal(dialog.Dialog)\nif err != nil {\n    // handle error\n}\nfmt.Println(string(data))\n</code></pre>\n\n<p>(Basically this is what the <code>JSONStr.SetBSON()</code> method did exactly.)</p>\n\n<p>Note that <code>interface{}</code> will \"cover\" all data structures. If you know it's an object, you may use a map. If you know it's an array, you may use a slice, etc. You may also use any concrete type.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1843, "favorite_count": 0, "accepted_answer_id": 42386423, "answer_count": 1, "score": 1, "last_activity_date": 1487754682, "creation_date": 1487749347, "last_edit_date": 1487753619, "question_id": 42385436, "link": "https://stackoverflow.com/questions/42385436/mongodb-return-entire-json-from-query-using-bson-raw", "title": "MongoDB Return entire JSON from query using bson.Raw", "body": "<p>I'm trying to search for this document:</p>\n\n<pre><code>\"meta\": {\n    \"pageId\": \"...\",\n    \"userId\": \"...\",\n    \"ver\": \"0\",\n},\n\"dialog\": {\n ...\n\n }\n</code></pre>\n\n<p>and get the entire <code>\"dialog\"</code> as a JSON, so I created this struct:</p>\n\n<pre><code>type Dialog struct {\n    Dialog bson.Raw `json:\"dialog\" bson:\"dialog\"`\n}\n</code></pre>\n\n<p>So I query the document like this:</p>\n\n<pre><code>dialog := Dialog{}\nquery := c.Find(locate).One(&amp;dialog)\n</code></pre>\n\n<p>and when I print <code>dialog</code>, I get a bunch of numbers, which I believe are the raw bytes from the query. </p>\n\n<p>The question is: how to unmarshal it into a JSON object? </p>\n\n<p>The only thing I've found about this are <a href=\"https://stackoverflow.com/questions/25276884/marshal-into-a-bson-raw\">Marshal into a bson.Raw</a> (which doesn't explain how to unmarshal into a json) </p>\n\n<p><strong>Update</strong></p>\n\n<p>Following <a href=\"https://stackoverflow.com/questions/39785289/how-to-marshal-json-string-to-bson-document-in-golang-for-writing-to-mongodb\">How to marshal json string to bson document in golang for writing to MongoDB?</a>, I did:</p>\n\n<pre><code>fmt.Println(bson.UnmarshalJSON(dialog.Dialog.Data, &amp;a))\n</code></pre>\n\n<p>which gets me: </p>\n\n<pre><code>json: unknown constant \"l\"\n</code></pre>\n\n<p>As you can see I had to extract the <code>Data</code> from the <a href=\"https://godoc.org/labix.org/v2/mgo/bson#Raw\" rel=\"nofollow noreferrer\">Raw type</a>, I don't think this is the best way to do it since there's the <code>Kind</code> field which is not being used. Also, what's this 'l'?</p>\n\n<p><strong>Update 2</strong></p>\n\n<p>I thought I had to Unmarshal into a JSON type in order to work with it but I've found that's better to Unmarshal to a map directly, so here it is:</p>\n\n<pre><code>var a bson.M\nfmt.Println(bson.Unmarshal(dialog.Dialog.Data, &amp;a))\nfmt.Println(a)\n</code></pre>\n\n<p>It worked for me :)</p>\n\n<p>However, I'm still ignoring the <code>Kind</code> field of the <code>Raw</code> type. Is there a better way to do it?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 976473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45ccbfec8f8e2c7a0788b52304b72fa1?s=128&d=identicon&r=PG", "display_name": "PARUS", "link": "https://stackoverflow.com/users/976473/parus"}, "edited": false, "score": 0, "creation_date": 1487800996, "post_id": 42384595, "comment_id": 71953291, "body": "Yes, I did this was. Not do close fine right after creation and use same fileDescriptior inside of the each goroutine to write in files. Yes - in this case it will works ever without WaitGroup. But why it does not work in initial example - files creates and close before ever any channel or goroutine start. And I open/close files inside of each goroutine. But files are still empty. Why ?"}, {"owner": {"reputation": 27181, "user_id": 1070354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56ca246e6d24b9a09114ff4542bcc2b1?s=128&d=identicon&r=PG", "display_name": "favoretti", "link": "https://stackoverflow.com/users/1070354/favoretti"}, "reply_to_user": {"reputation": 73, "user_id": 976473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45ccbfec8f8e2c7a0788b52304b72fa1?s=128&d=identicon&r=PG", "display_name": "PARUS", "link": "https://stackoverflow.com/users/976473/parus"}, "edited": false, "score": 0, "creation_date": 1487837239, "post_id": 42384595, "comment_id": 71966458, "body": "Buffered channels are non-blocking. Your main() exits faster."}], "tags": [], "owner": {"reputation": 27181, "user_id": 1070354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56ca246e6d24b9a09114ff4542bcc2b1?s=128&d=identicon&r=PG", "display_name": "favoretti", "link": "https://stackoverflow.com/users/1070354/favoretti"}, "is_accepted": false, "score": 1, "last_activity_date": 1487746901, "last_edit_date": 1495540810, "creation_date": 1487746450, "answer_id": 42384595, "question_id": 42384336, "link": "https://stackoverflow.com/questions/42384336/golang-why-following-code-snippet-do-not-write-to-file/42384595#42384595", "title": "Golang: why following code snippet do not write to file?", "body": "<p>For one, you need to wait for your channel to empty. In this case you don't need a buffered channel either. Use a <code>WaitGroup</code></p>\n\n<p>Secondly, opening and closing the file in every goroutine while ignoring the error is the actual issue. You don't need to open and close the file every time. Open once, sync after writes.</p>\n\n<p>This works:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"os\"\n    \"runtime\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(4)\n\n    f, _ := os.Create(\"./log.txt\")\n    defer f.Close()\n\n    logCh := make(chan string)\n    var wg sync.WaitGroup\n\n    for i := 1; i &lt; 10; i++ {\n        for j := 1; j &lt; 10; j++ {\n            wg.Add(1)\n            go func(i, j int) {\n                defer wg.Done()\n                msg := fmt.Sprintf(\"%d + %d = %d\\n\", i, j, i+j)\n                logCh &lt;- msg\n                fmt.Print(msg)\n\n            }(i, j)\n        }\n    }\n\n    go func() {\n        for {\n            msg, ok := &lt;-logCh\n            if ok {\n                logTime := time.Now().Format(time.RFC3339)\n\n                f.WriteString(logTime + \" - \" + msg)\n                f.Sync()\n\n            } else {\n                break\n            }\n        }\n    }()\n\n    wg.Wait()\n\n    //fmt.Scanln()\n}\n</code></pre>\n\n<p>There's also some extra info in <a href=\"https://stackoverflow.com/questions/39776481/how-to-wait-until-buffered-channel-semaphore-is-empty\">this question</a></p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 976473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45ccbfec8f8e2c7a0788b52304b72fa1?s=128&d=identicon&r=PG", "display_name": "PARUS", "link": "https://stackoverflow.com/users/976473/parus"}, "edited": false, "score": 0, "creation_date": 1487798750, "post_id": 42384653, "comment_id": 71952147, "body": "But the file created and closed inside of main routine before any other goroutine starts and I open and close files inside of the each main routine, but files steel empty."}, {"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "reply_to_user": {"reputation": 73, "user_id": 976473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45ccbfec8f8e2c7a0788b52304b72fa1?s=128&d=identicon&r=PG", "display_name": "PARUS", "link": "https://stackoverflow.com/users/976473/parus"}, "edited": false, "score": 0, "creation_date": 1487815810, "post_id": 42384653, "comment_id": 71958392, "body": "@PARUS what do you mean &quot;I open and close files inside of the each main routine&quot;?   <code>WriteString</code> will only execute if  <code>logCh</code> receive message. but before that, the main function has run over."}, {"owner": {"reputation": 73, "user_id": 976473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45ccbfec8f8e2c7a0788b52304b72fa1?s=128&d=identicon&r=PG", "display_name": "PARUS", "link": "https://stackoverflow.com/users/976473/parus"}, "edited": false, "score": 0, "creation_date": 1487828595, "post_id": 42384653, "comment_id": 71962406, "body": "&gt;&gt; if logCh receive message. but before that, the main function has run over. Sorry, in code above you need to uncomment following //fmt.Scanln() and main function still run."}, {"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "reply_to_user": {"reputation": 73, "user_id": 976473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45ccbfec8f8e2c7a0788b52304b72fa1?s=128&d=identicon&r=PG", "display_name": "PARUS", "link": "https://stackoverflow.com/users/976473/parus"}, "edited": false, "score": 0, "creation_date": 1487831244, "post_id": 42384653, "comment_id": 71963473, "body": "open file for writing, <code>os.O_WRONLY|os.O_APPEND</code>"}, {"owner": {"reputation": 73, "user_id": 976473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45ccbfec8f8e2c7a0788b52304b72fa1?s=128&d=identicon&r=PG", "display_name": "PARUS", "link": "https://stackoverflow.com/users/976473/parus"}, "edited": false, "score": 0, "creation_date": 1487883726, "post_id": 42384653, "comment_id": 71997657, "body": "Thank you - came to the same solution yesterday."}], "tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": false, "score": 2, "last_activity_date": 1487746646, "creation_date": 1487746646, "answer_id": 42384653, "question_id": 42384336, "link": "https://stackoverflow.com/questions/42384336/golang-why-following-code-snippet-do-not-write-to-file/42384653#42384653", "title": "Golang: why following code snippet do not write to file?", "body": "<p>two obvious faults:</p>\n\n<ol>\n<li><p>the main routine do not wait for other goroutines, when main routine return, the program terminate, that's why log.txt is empty. <code>sync.WaitGroup</code> maybe helpful.</p></li>\n<li><p><code>msg, ok := &lt;- logCh</code>, <code>ok</code> is only <code>false</code> when <code>logCh</code> is closed and empty. And you are not calling <code>close(logCh)</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 73, "user_id": 976473, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/45ccbfec8f8e2c7a0788b52304b72fa1?s=128&d=identicon&r=PG", "display_name": "PARUS", "link": "https://stackoverflow.com/users/976473/parus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 319, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1487746901, "creation_date": 1487745417, "last_edit_date": 1487745603, "question_id": 42384336, "link": "https://stackoverflow.com/questions/42384336/golang-why-following-code-snippet-do-not-write-to-file", "title": "Golang: why following code snippet do not write to file?", "body": "<p>I have following part of code which do not write any data to file log.txt. I don't understand why ? It should not be sync problem, because I close file before start any go routine and open/close file inside of each routine.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(4)\n\n    f, _ := os.Create(\"./log.txt\")\n    f.Close()\n\n    logCh := make(chan string, 50)\n\n    go func() {\n        for {\n            msg, ok := &lt;- logCh\n            if ok {\n                logTime := time.Now().Format(time.RFC3339)\n\n                f, _ := os.OpenFile(\"./log.txt\", os.O_APPEND, os.ModeAppend)\n\n                f.WriteString(logTime + \" - \" + msg)\n\n                f.Close()\n\n            } else {\n                break\n            }\n        }\n    }()\n\n\n    for i:=1; i &lt; 10;i++ {\n        for j:=1; j&lt;10;j++ {\n            go func(i, j int) {\n                msg := fmt.Sprintf(\"%d + %d = %d\\n\", i, j, i+j)\n                logCh &lt;- msg\n                fmt.Print(msg)\n            }(i, j)\n        }\n    }\n\n\n    //fmt.Scanln()\n}\n</code></pre>\n"}, {"tags": ["go", "elm"], "answers": [{"tags": [], "owner": {"reputation": 108, "user_id": 2002136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L21tR.jpg?s=128&g=1", "display_name": "Hugo Bessa", "link": "https://stackoverflow.com/users/2002136/hugo-bessa"}, "is_accepted": true, "score": 6, "last_activity_date": 1487790291, "creation_date": 1487790291, "answer_id": 42400142, "question_id": 42384326, "link": "https://stackoverflow.com/questions/42384326/correct-way-to-integrate-elm-with-existing-web-app-service/42400142#42400142", "title": "Correct way to integrate Elm with existing web-app service", "body": "<p>Use <a href=\"http://package.elm-lang.org/packages/elm-lang/html/2.0.0/Html#programWithFlags\" rel=\"noreferrer\">Html.programWithFlags</a> (supposing your main module is named <code>App</code>):</p>\n\n<pre><code>&lt;div id=\"grid\"&gt;&lt;/div&gt;\n&lt;script&gt;\n  var rows = {/* rows */};\n  var cols = [/* columns */];\n  var node = document.getElementById('grid');\n  Elm.App.embed(node, { rows: rows, cols: cols });\n&lt;/script&gt;\n</code></pre>\n\n<p>This is the way you can initialize your Elm app with available data just like you are initializing <code>GridBuilder</code>.</p>\n\n<p>To be able to read those values, you should create a <code>Flags</code> type alias and your <code>init</code> function will receive it.</p>\n\n<pre><code>type alias Flags =\n    { rows : [ ... ]\n    , cols : [ ... ]\n    }\n\ninit : Flags -&gt; ( Model, Cmd Msg )\ninit flags =\n    ...\n</code></pre>\n\n<p>Your <code>main</code> function will look like this:</p>\n\n<pre><code>main =\n    Html.programWithFlags\n        { init = init, ... }\n</code></pre>\n\n<p>I highly recommend that you read the <a href=\"https://guide.elm-lang.org/interop/javascript.html\" rel=\"noreferrer\">JavaScript Interop</a> section of the <a href=\"https://guide.elm-lang.org\" rel=\"noreferrer\">Elm Guide</a>. It explains the <code>programWithFlags</code> and other approaches to receive/send data from/to JavaScript.</p>\n"}], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 1, "accepted_answer_id": 42400142, "answer_count": 1, "score": 2, "last_activity_date": 1487790291, "creation_date": 1487745375, "last_edit_date": 1487746167, "question_id": 42384326, "link": "https://stackoverflow.com/questions/42384326/correct-way-to-integrate-elm-with-existing-web-app-service", "title": "Correct way to integrate Elm with existing web-app service", "body": "<p>i have a backend service that I wrote in <code>Golang</code>, something like this:</p>\n\n<pre><code>func PageA_RequestHandler(ctx *W.Context) {\n  // init things\n  if is_ajax {\n    // handle the API request, render the JSON\n    return\n  }\n  // query the initial rows\n  values := M.SX{\n    `rows`: model1.GetRows(10),\n    `columns`: model1.GetColumns(),\n  }\n  // render the html\n  ctx.Render(`page_a_template`,values)\n}\n</code></pre>\n\n<p>then the <a href=\"http://gitlab.com/kokizzu/gokil\" rel=\"nofollow noreferrer\">template</a> file <code>page_a_template.html</code> (that loaded and cached at the first time it rendered), is a html file, with content something like this:</p>\n\n<pre><code>&lt;div id=\"grid\"&gt;&lt;/div&gt;\n&lt;script&gt;\n  var rows = {/* rows */};\n  var cols = [/* columns */]\n  new GridBuilder('grid',cols,rows);\n&lt;/script&gt;\n</code></pre>\n\n<p>Where's:</p>\n\n<p><code>{/* rows */}</code> and <code>[/* columns */]</code> are my javascript-friendly template syntax, there are some other syntax like: <code>/*! bar */</code> or <code>#{yay}</code></p>\n\n<p><code>new GridBuilder</code> is my custom javascript component that creates something like <code>datatables.net</code> or <code>editablegrid.net</code></p>\n\n<p>The question is, if I use <code>Elm</code>, what's the correct way to inject the <code>{/* rows */}</code> into the compiled html?</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "edited": false, "score": 0, "creation_date": 1487744526, "post_id": 42384012, "comment_id": 71916690, "body": "Your code is missing a <code>print(err)</code> at the end, which will tell you more about the error."}, {"owner": {"reputation": 78, "user_id": 7602874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e2f198eac20f70a8648e0b1f5ef90a?s=128&d=identicon&r=PG&f=1", "display_name": "Jarri Abidi", "link": "https://stackoverflow.com/users/7602874/jarri-abidi"}, "reply_to_user": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "edited": false, "score": 0, "creation_date": 1487744600, "post_id": 42384012, "comment_id": 71916725, "body": "didn&#39;t include it here but there&#39;s no err. It parses successfully but the struct remains empty."}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1487747586, "post_id": 42384012, "comment_id": 71918225, "body": "Adding  go play ground would be great"}, {"owner": {"reputation": 78, "user_id": 7602874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e2f198eac20f70a8648e0b1f5ef90a?s=128&d=identicon&r=PG&f=1", "display_name": "Jarri Abidi", "link": "https://stackoverflow.com/users/7602874/jarri-abidi"}, "reply_to_user": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1487747911, "post_id": 42384012, "comment_id": 71918392, "body": "@SarathSadasivanPillai done"}], "answers": [{"comments": [{"owner": {"reputation": 78, "user_id": 7602874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e2f198eac20f70a8648e0b1f5ef90a?s=128&d=identicon&r=PG&f=1", "display_name": "Jarri Abidi", "link": "https://stackoverflow.com/users/7602874/jarri-abidi"}, "edited": false, "score": 0, "creation_date": 1487756296, "post_id": 42387285, "comment_id": 71923689, "body": "Thanks a lot! I had given up and had to resort to converting the xml to json to make it work. :D Really appreciate it."}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "reply_to_user": {"reputation": 78, "user_id": 7602874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e2f198eac20f70a8648e0b1f5ef90a?s=128&d=identicon&r=PG&f=1", "display_name": "Jarri Abidi", "link": "https://stackoverflow.com/users/7602874/jarri-abidi"}, "edited": false, "score": 0, "creation_date": 1487756331, "post_id": 42387285, "comment_id": 71923709, "body": "@JarriAbidi happy to help"}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 2, "last_activity_date": 1487756163, "last_edit_date": 1487756163, "creation_date": 1487755127, "answer_id": 42387285, "question_id": 42384012, "link": "https://stackoverflow.com/questions/42384012/trouble-parsing-xml-using-go/42387285#42387285", "title": "Trouble Parsing XML using Go", "body": "<p>CDATA can not be unmarshalled to a struct. </p>\n\n<blockquote>\n  <ul>\n  <li>If the XML element contains character data, that data is accumulated in the first struct field that has tag \",chardata\".    The\n  struct field may have type []byte or string.    If there is no such\n  field, the character data is discarded.</li>\n  </ul>\n</blockquote>\n\n<p>An attempt to unmarshal CDATA to struct will fail with following error</p>\n\n<pre><code>cannot unmarshal into struct \n</code></pre>\n\n<p>This playground <a href=\"https://play.golang.org/p/i9RPl3QB50\" rel=\"nofollow noreferrer\">link</a> explains the above mentioned problem.</p>\n\n<p>There were some other issues with the struct.Go currently does not support <code>XML namespace prefixes</code> .Here is an open issue regarding the same <a href=\"https://github.com/golang/go/issues/9519\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/9519</a>.</p>\n\n<p>Here is code re-written  </p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\nconst data = `&lt;soapenv:Envelope&gt;\n    &lt;soapenv:Body&gt;\n        &lt;req:ResponseMsg&gt;\n        &lt;name&gt;blah&lt;/name&gt;\n            &lt;![CDATA[&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;Response&gt;&lt;ResponseCode&gt;14&lt;/ResponseCode&gt;&lt;ConversationID&gt;AG_20170222_00006f8794f700eff099&lt;/ConversationID&gt;&lt;ResponseDesc&gt;The caller information is invalid.&lt;/ResponseDesc&gt;&lt;OriginatorConversationID&gt;S_X2013012921001&lt;/OriginatorConversationID&gt;&lt;ServiceStatus&gt;2&lt;/ServiceStatus&gt;&lt;/Response&gt;]]&gt;\n        &lt;/req:ResponseMsg&gt;\n    &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;`\n\ntype Envelop struct {\n    XMLName     xml.Name `xml:\"Envelope\"`\n    ResponseMsg struct {\n        CDATA []byte `xml:\",cdata\"`\n    } `xml:\"Body&gt;ResponseMsg\"`\n}\n\ntype Response struct {\n    XMLName                  xml.Name `xml:\"Response\"`\n    ResponseCode             string   `xml:\"ResponseCode\"`\n    ConversationID           string   `xml:\"ConversationID\"`\n    ResponseDesc             string   `xml:\"ResponseDesc\"`\n    OriginatorConversationID string   `xml:\"OriginatorConversationID\"`\n    ServiceStatus            string   `xml:\"ServiceStatus\"`\n}\n\nfunc main() {\n    var unit Envelop\n    if err := xml.Unmarshal([]byte(data), &amp;unit); err != nil {\n        fmt.Println(err)\n        return\n    }\n    responseBytes := unit.ResponseMsg.CDATA\n    var response Response\n    if err := xml.Unmarshal([]byte(responseBytes), &amp;response); err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(\"Response : \", response)\n\n}\n</code></pre>\n\n<p>Here is the play link : <a href=\"https://play.golang.org/p/sCREQKN3BV\" rel=\"nofollow noreferrer\">play.golang</a></p>\n"}], "owner": {"reputation": 78, "user_id": 7602874, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e2f198eac20f70a8648e0b1f5ef90a?s=128&d=identicon&r=PG&f=1", "display_name": "Jarri Abidi", "link": "https://stackoverflow.com/users/7602874/jarri-abidi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 887, "favorite_count": 0, "accepted_answer_id": 42387285, "answer_count": 1, "score": 0, "last_activity_date": 1487756163, "creation_date": 1487744167, "last_edit_date": 1487747872, "question_id": 42384012, "link": "https://stackoverflow.com/questions/42384012/trouble-parsing-xml-using-go", "title": "Trouble Parsing XML using Go", "body": "<p>I've been trying to parse an xml in Go by defining structs and using xml.Unmarshal like this:</p>\n\n<pre><code>type InitiateResponse struct {\n    SoapenvEnvelope struct {\n        SoapenvBody struct {\n            ReqResponseMsg struct {\n                CData struct {\n                    Response struct {\n                        ResponseCode string `xml:\"ResponseCode\"`\n                        ConversationID string `xml:\"ConversationID\"`\n                        ResponseDesc string `xml:\"ResponseDesc\"`\n                        OriginatorConversationID string `xml:\"OriginatorConversationID\"`\n                        ServiceStatus string `xml:\"ServiceStatus\"`\n                    } `xml:\"req:Response\"`\n                } `xml: ![CDATA[`\n            } `xml:\"req:ResponseMsg\"`\n        } `xml:\"soapenv:Body\"`\n    } `xml:\"soapenv:Envelope\"`\n}   \n\nvar unit InitiateResponse\nif err := xml.Unmarshal([]byte(data), &amp;unit); err != nil {\n    fmt.Println(err)\n    return\n}\n</code></pre>\n\n<p>There's no error thrown but the struct is always empty at the end. Can't understand why.</p>\n\n<p>This is the xml:</p>\n\n<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;&lt;soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\" xmlns:req=\"http://cps.huawei.com/cpsinterface/request\"&gt;\n   &lt;soapenv:Header /&gt;\n   &lt;soapenv:Body&gt;\n      &lt;req:ResponseMsg&gt;&lt;![CDATA[&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;Response&gt;&lt;ResponseCode&gt;14&lt;/ResponseCode&gt;&lt;ConversationID&gt;AG_20170222_000040cdc5cecf730e39&lt;/ConversationID&gt;&lt;ResponseDesc&gt;The caller information is invalid.&lt;/ResponseDesc&gt;&lt;OriginatorConversationID&gt;S_X2013012921001&lt;/OriginatorConversationID&gt;&lt;ServiceStatus&gt;2&lt;/ServiceStatus&gt;&lt;/Response&gt;]]&gt;&lt;/req:ResponseMsg&gt;\n   &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n</code></pre>\n\n<p>Check it out:\n<a href=\"https://play.golang.org/p/Irmy8AsUKa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Irmy8AsUKa</a></p>\n"}, {"tags": ["go", "struct", "go-gorm"], "comments": [{"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1487735349, "post_id": 42382107, "comment_id": 71913532, "body": "why don&#39;t you create that struct in your <code>b</code> package?"}, {"owner": {"reputation": 51, "user_id": 5001551, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f21c93540d39407230a4af8419d3328a?s=128&d=identicon&r=PG&f=1", "display_name": "Marwan Sulaiman", "link": "https://stackoverflow.com/users/5001551/marwan-sulaiman"}, "reply_to_user": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1487735504, "post_id": 42382107, "comment_id": 71913578, "body": "@GujaratSantana - because it&#39;s a third party library that comes with its own tags and struct methods."}, {"owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "edited": false, "score": 0, "creation_date": 1487736690, "post_id": 42382107, "comment_id": 71913879, "body": "Have you tried adding the property and shadowing the embedded one? ``` type User struct {   a.UserProps   FirstName <code>json:&quot;first_name&quot;,sql:&quot;unique_index&quot;</code>  } ```"}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 1, "creation_date": 1487736742, "post_id": 42382107, "comment_id": 71913893, "body": "You&#39;re attempting to do something like subclassing, treating the JSON marshaling as if it&#39;s an abstract method to be mixed in, but go doesn&#39;t really let you express such things. If you really don&#39;t want to follow Gujarat&#39;s suggestion, you can try to solve this with <code>go generate</code> or you could implement a <code>MarshalJSON</code> method for your <code>User</code> type that uses reflection to replicate the standard behavior of <code>json.Marshal</code> in a way that handles your scenario."}], "owner": {"reputation": 51, "user_id": 5001551, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f21c93540d39407230a4af8419d3328a?s=128&d=identicon&r=PG&f=1", "display_name": "Marwan Sulaiman", "link": "https://stackoverflow.com/users/5001551/marwan-sulaiman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 196, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1527757124, "creation_date": 1487733821, "last_edit_date": 1527757124, "question_id": 42382107, "link": "https://stackoverflow.com/questions/42382107/extend-tag-of-a-composed-go-struct", "title": "Extend tag of a composed Go Struct", "body": "<p>I have two structs: </p>\n\n<pre><code>// package a -- third party library\ntype UserProps struct {\n  FirstName `json:\"first_name\"`\n  LastName `json:\"last_name\"`\n}\n\n// package b -- my own package\ntype User struct {\n  a.UserProps\n}\n</code></pre>\n\n<p>The problem is that UserProps is inherited from a 3rd party library, so I can't change its source code. </p>\n\n<p>My question is can I extend the <code>FirstName</code> tag from within the <code>User</code> struct in package b so that the tag would eventually be as such <code>json:\"first_name\",sql:\"unique_index\"</code> ? </p>\n\n<p>Also, note that I only want to extend the tag of only one field, FirstName.</p>\n"}, {"tags": ["email", "go", "push-notification", "goroutine"], "comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1487744159, "post_id": 42382005, "comment_id": 71916520, "body": "You could try using Websockets."}, {"owner": {"reputation": 7372, "user_id": 412689, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/73160611f90c8c1e1cdc79f43702bda1?s=128&d=identicon&r=PG", "display_name": "Alex Nichol", "link": "https://stackoverflow.com/users/412689/alex-nichol"}, "edited": false, "score": 0, "creation_date": 1487771787, "post_id": 42382005, "comment_id": 71934370, "body": "WebSockets or long-polling are the two most common ways for a server to push live information to clients."}], "owner": {"reputation": 232, "user_id": 7590816, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8e7262f8d0422f90bb77ac563ca9ad15?s=128&d=identicon&r=PG&f=1", "display_name": "Rajesh kumar", "link": "https://stackoverflow.com/users/7590816/rajesh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487733104, "creation_date": 1487733104, "question_id": 42382005, "link": "https://stackoverflow.com/questions/42382005/send-notification-after-sending-http-response", "title": "Send Notification after sending HTTP Response", "body": "<p>I am new to programming.I am using golang in the backend and reactjs in the front end of the leave Web application that i m creating.</p>\n\n<p>When an employee apply leave i must send email to the in-charge of the employee and employee who applied the leave.Since the email send is taking long time i want to run the email function in go routine.If that the case the  http response is send before the status of the email function is returned(Example: Email Send Success or Email Send Failure).</p>\n\n<p>So i would like to push the result of the email function in notification to the front end from the server.But  i don't know how to do it as the server already given the http  response to the front end before the completion of the email function.</p>\n\n<p>Is there any other better idea to implement this please let me know.Appreciate any help.Thanks</p>\n"}, {"tags": ["linux", "go"], "comments": [{"owner": {"reputation": 48960, "user_id": 2522554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83cebe27d4fdd15bb1fb77bab95ff493?s=128&d=identicon&r=PG", "display_name": "bansi", "link": "https://stackoverflow.com/users/2522554/bansi"}, "edited": false, "score": 1, "creation_date": 1487732421, "post_id": 42381875, "comment_id": 71912732, "body": "<a href=\"https://www.freebsd.org/cgi/man.cgi?query=lsof&amp;sektion=8&amp;manpath=freebsd-release-ports\" rel=\"nofollow noreferrer\">lsof</a>"}, {"owner": {"reputation": 129, "user_id": 1225294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b5303a3ee4f37add39a53b34a7e4822?s=128&d=identicon&r=PG", "display_name": "tacy_lee", "link": "https://stackoverflow.com/users/1225294/tacy-lee"}, "reply_to_user": {"reputation": 48960, "user_id": 2522554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83cebe27d4fdd15bb1fb77bab95ff493?s=128&d=identicon&r=PG", "display_name": "bansi", "link": "https://stackoverflow.com/users/2522554/bansi"}, "edited": false, "score": 2, "creation_date": 1487732470, "post_id": 42381875, "comment_id": 71912744, "body": "by parse &quot;/proc&quot;, I can get all opening file. I want to know whether there is a better way"}, {"owner": {"reputation": 48960, "user_id": 2522554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83cebe27d4fdd15bb1fb77bab95ff493?s=128&d=identicon&r=PG", "display_name": "bansi", "link": "https://stackoverflow.com/users/2522554/bansi"}, "edited": false, "score": 0, "creation_date": 1487732509, "post_id": 42381875, "comment_id": 71912752, "body": "just check my first comment and here is <a href=\"http://www.thegeekstuff.com/2012/08/lsof-command-examples\" rel=\"nofollow noreferrer\">some examples</a> and btw, you can use <a href=\"https://www.freebsd.org/cgi/man.cgi?query=logrotate&amp;apropos=0&amp;sektion=8&amp;manpath=FreeBSD+11.0-RELEASE+and+Ports&amp;arch=default&amp;format=html\" rel=\"nofollow noreferrer\">logrotate</a> to compress and archive the logs automatically, then delete it later (may be with a script)"}, {"owner": {"reputation": 129, "user_id": 1225294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b5303a3ee4f37add39a53b34a7e4822?s=128&d=identicon&r=PG", "display_name": "tacy_lee", "link": "https://stackoverflow.com/users/1225294/tacy-lee"}, "reply_to_user": {"reputation": 48960, "user_id": 2522554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83cebe27d4fdd15bb1fb77bab95ff493?s=128&d=identicon&r=PG", "display_name": "bansi", "link": "https://stackoverflow.com/users/2522554/bansi"}, "edited": false, "score": 0, "creation_date": 1487733168, "post_id": 42381875, "comment_id": 71912918, "body": "Thanks bansi, I want to implement a agent that it will running on docker container environment, it cant&#39;t have too much process, also crontab"}, {"owner": {"reputation": 48960, "user_id": 2522554, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83cebe27d4fdd15bb1fb77bab95ff493?s=128&d=identicon&r=PG", "display_name": "bansi", "link": "https://stackoverflow.com/users/2522554/bansi"}, "edited": false, "score": 0, "creation_date": 1487733899, "post_id": 42381875, "comment_id": 71913123, "body": "another option is you can safely remove lines from the top of the log file even if it is open, if your environment has <code>sed</code> or <code>tail</code>"}], "answers": [{"tags": [], "owner": {"reputation": 129, "user_id": 4430099, "user_type": "registered", "profile_image": "https://graph.facebook.com/1508802802/picture?type=large", "display_name": "Mitchell Gouzenko", "link": "https://stackoverflow.com/users/4430099/mitchell-gouzenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1487742183, "creation_date": 1487742183, "answer_id": 42383559, "question_id": 42381875, "link": "https://stackoverflow.com/questions/42381875/golanglinux-how-to-get-all-open-files-by-current-user/42383559#42383559", "title": "[Golang][Linux] - How to get all open files by current user", "body": "<p>If you're bash scripting, <code>lsof</code> might fit your need. If you're interested in the user with username X, <code>lsof -uX</code> should do the trick.</p>\n"}, {"tags": [], "owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "is_accepted": true, "score": 1, "last_activity_date": 1487742935, "creation_date": 1487742935, "answer_id": 42383732, "question_id": 42381875, "link": "https://stackoverflow.com/questions/42381875/golanglinux-how-to-get-all-open-files-by-current-user/42383732#42383732", "title": "[Golang][Linux] - How to get all open files by current user", "body": "<p>Parsing /proc (see <a href=\"http://man7.org/linux/man-pages/man5/proc.5.html\" rel=\"nofollow noreferrer\">proc(5)</a>...) is probably the most efficient way and is what <code>lsof</code> would do.</p>\n\n<p>You could first scan all (numeric) directories to find processes running by your users, than in all such directories use the <code>/proc/</code>pid<code>/fd</code> directory.</p>\n\n<p>BTW, you might not care and just remove these log files. The kernel will behave appropriately if it was opened.</p>\n\n<p>But perhaps you should ask your sysadmin to setup <a href=\"https://en.wikipedia.org/wiki/Disk_quota\" rel=\"nofollow noreferrer\">disk quotas</a>. See <a href=\"http://man7.org/linux/man-pages/man1/quota.1.html\" rel=\"nofollow noreferrer\">quota(1)</a> &amp; <a href=\"http://man7.org/linux/man-pages/man8/quotaon.8.html\" rel=\"nofollow noreferrer\">quotaon(8)</a>.</p>\n\n<p>Perhaps using &amp; configuring <a href=\"https://linux.die.net/man/8/logrotate\" rel=\"nofollow noreferrer\">logrotate</a> should be enough.</p>\n"}, {"tags": [], "owner": {"reputation": 129, "user_id": 1225294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b5303a3ee4f37add39a53b34a7e4822?s=128&d=identicon&r=PG", "display_name": "tacy_lee", "link": "https://stackoverflow.com/users/1225294/tacy-lee"}, "is_accepted": false, "score": -1, "last_activity_date": 1487746907, "creation_date": 1487746907, "answer_id": 42384729, "question_id": 42381875, "link": "https://stackoverflow.com/questions/42381875/golanglinux-how-to-get-all-open-files-by-current-user/42384729#42384729", "title": "[Golang][Linux] - How to get all open files by current user", "body": "<p>by parse \"/proc\" get all open file:</p>\n\n<pre><code>func getOpenfiles() (openfiles map[string]bool) {\n    files, _ := ioutil.ReadDir(\"/proc\")\n    openfiles = make(map[string]bool)\n    for _, f := range files {\n        m, _ := filepath.Match(\"[0-9]*\", f.Name())\n        if f.IsDir() &amp;&amp; m {\n            fdpath := filepath.Join(\"/proc\", f.Name(), \"fd\")\n            ffiles, _ := ioutil.ReadDir(fdpath)\n            for _, f := range ffiles {\n                fpath, err := os.Readlink(filepath.Join(fdpath, f.Name()))\n                if err != nil {\n                    continue\n                }\n                openfiles[fpath] = true\n            }\n        }\n    }\n    return openfiles\n}\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 1225294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b5303a3ee4f37add39a53b34a7e4822?s=128&d=identicon&r=PG", "display_name": "tacy_lee", "link": "https://stackoverflow.com/users/1225294/tacy-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1877, "favorite_count": 0, "accepted_answer_id": 42383732, "answer_count": 3, "score": -1, "last_activity_date": 1487746907, "creation_date": 1487732254, "question_id": 42381875, "link": "https://stackoverflow.com/questions/42381875/golanglinux-how-to-get-all-open-files-by-current-user", "title": "[Golang][Linux] - How to get all open files by current user", "body": "<p>I want to delete some logs when logs size exceed quota, But I need to check if the log is opening before delete it.</p>\n\n<p>How to get all open files by current user?</p>\n"}, {"tags": ["http", "logging", "go"], "answers": [{"comments": [{"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1487732140, "post_id": 42381827, "comment_id": 71912653, "body": "Thanks, I knew it would be something straight forward but I was finding it rather difficult to google search an answer for this."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 2, "last_activity_date": 1487732011, "creation_date": 1487732011, "answer_id": 42381827, "question_id": 42381744, "link": "https://stackoverflow.com/questions/42381744/standard-library-http-package-logs-to-stdout-by-default-can-i-disable-this/42381827#42381827", "title": "Standard Library http package logs to stdout by default, can I disable this?", "body": "<p>It doesn't log to stdout, it logs to the http server's <code>ErrorLog</code> if it's set, and to the standard logger (the one used by the non-method functions in <a href=\"https://golang.org/pkg/log/\" rel=\"nofollow noreferrer\">log</a>) otherwise. If you have a logger already, construct a <code>http.Server</code> with that logger as its <code>ErrorLog</code> and call <code>ListenAndServe</code> on that. Otherwise use <code>log.SetOutput</code> to change the destination of the standard log.</p>\n"}], "owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 1, "accepted_answer_id": 42381827, "answer_count": 1, "score": 1, "last_activity_date": 1487732011, "creation_date": 1487731449, "question_id": 42381744, "link": "https://stackoverflow.com/questions/42381744/standard-library-http-package-logs-to-stdout-by-default-can-i-disable-this", "title": "Standard Library http package logs to stdout by default, can I disable this?", "body": "<p>When using the built-in http module in Go, I notice that <code>http.ListenAndServe()</code> will make logging calls to <code>stdout</code> by default.  The main thing showing up in my terminal is:</p>\n\n<pre><code>http: TLS handshake error from x.x.x.x:x: tls: client offered an unsupported, maximum protocol version of 301.\n</code></pre>\n\n<p>Now I understand what this error is and what causes it, but the fact of the matter is, <em>I don't particularly care</em>.</p>\n\n<p>How can I stop the http package (or <code>ListenAndServe()</code>, whatever) from logging to stdout by default?  It's clogging up my pretty console.  I'm 95% certain that I'm not the one logging the messages as all of the logs I have setup have \"INFO\", \"WARNING\" etc prefixes on them.</p>\n"}, {"tags": ["go", "web-crawler", "goroutine"], "comments": [{"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1487750747, "post_id": 42381426, "comment_id": 71919915, "body": "I suggest you taking a look at an <a href=\"https://github.com/adonovan/gopl.io/blob/master/ch8/crawl3/findlinks.go\" rel=\"nofollow noreferrer\">example</a> of a concurrent web crawler from the famous book."}], "answers": [{"comments": [{"owner": {"reputation": 285, "user_id": 3373877, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/532526780ffab7d05fae3a14045c3f8d?s=128&d=identicon&r=PG&f=1", "display_name": "user3373877", "link": "https://stackoverflow.com/users/3373877/user3373877"}, "edited": false, "score": 0, "creation_date": 1487895055, "post_id": 42391685, "comment_id": 72002597, "body": "It is not what i want. because the <code>BrokenLinks</code> need to be searched, but not  the known result. @Maniankara"}, {"owner": {"reputation": 452, "user_id": 3123516, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fIji3.jpg?s=128&g=1", "display_name": "Maniankara", "link": "https://stackoverflow.com/users/3123516/maniankara"}, "reply_to_user": {"reputation": 285, "user_id": 3373877, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/532526780ffab7d05fae3a14045c3f8d?s=128&d=identicon&r=PG&f=1", "display_name": "user3373877", "link": "https://stackoverflow.com/users/3373877/user3373877"}, "edited": false, "score": 0, "creation_date": 1487931353, "post_id": 42391685, "comment_id": 72016168, "body": "@user3373877, can you explain a bit more? From the above link, you can see that I have tested also broken link: <a href=\"https://github.com/maniankara/stackoverflow/blob/master/golang-web-crawler-with-goroutines/crawl.go#L210\" rel=\"nofollow noreferrer\">github.com/maniankara/stackoverflow/blob/master/&hellip;</a>. Also, I havent modified the functionality from here: <a href=\"http://leantricks.com/code/how-to-crawl-a-website-in-golang/\" rel=\"nofollow noreferrer\">leantricks.com/code/how-to-crawl-a-website-in-golang</a>"}, {"owner": {"reputation": 285, "user_id": 3373877, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/532526780ffab7d05fae3a14045c3f8d?s=128&d=identicon&r=PG&f=1", "display_name": "user3373877", "link": "https://stackoverflow.com/users/3373877/user3373877"}, "edited": false, "score": 0, "creation_date": 1488075544, "post_id": 42391685, "comment_id": 72069957, "body": "<a href=\"https://github.com/megaserg/validation-crawler/blob/master/crawler.go\" rel=\"nofollow noreferrer\">github.com/megaserg/validation-crawler/blob/master/crawler.g&zwnj;&#8203;o</a> is what i want.   the goroutine and the channel is used by it."}], "tags": [], "owner": {"reputation": 452, "user_id": 3123516, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fIji3.jpg?s=128&g=1", "display_name": "Maniankara", "link": "https://stackoverflow.com/users/3123516/maniankara"}, "is_accepted": false, "score": 1, "last_activity_date": 1487766974, "creation_date": 1487766974, "answer_id": 42391685, "question_id": 42381426, "link": "https://stackoverflow.com/questions/42381426/change-the-sample-by-using-goroutine/42391685#42391685", "title": "Change the sample by using goroutine?", "body": "<p>You could invoke the crawlPage() concurrently and handle <code>alreadyCrawledList</code>, <code>pending</code> and <code>brokenLinks</code> variables with mutexes (not so performant though). On the other hand, the code needs to be modified a lot to get it more performant.</p>\n\n<p>I did a quick check with 4 links and seems to half the duration. I did a sample code with a simple http server and its <a href=\"https://github.com/maniankara/stackoverflow/tree/master/golang-web-crawler-with-goroutines\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Thanks,\n - Anoop</p>\n"}], "owner": {"reputation": 285, "user_id": 3373877, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/532526780ffab7d05fae3a14045c3f8d?s=128&d=identicon&r=PG&f=1", "display_name": "user3373877", "link": "https://stackoverflow.com/users/3373877/user3373877"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1487766974, "creation_date": 1487729233, "last_edit_date": 1487745801, "question_id": 42381426, "link": "https://stackoverflow.com/questions/42381426/change-the-sample-by-using-goroutine", "title": "Change the sample by using goroutine?", "body": "<p>I found a good web invalid links checker. But how to change it for a complete sample by using goroutine? The web page is: <a href=\"http://leantricks.com/code/how-to-crawl-a-website-in-golang/\" rel=\"nofollow noreferrer\">How To Crawl A Website In Golang</a>. The codes dynamically add the url that will be searched to the <code>pending</code> slice. but I have some difficulties to use goroutine to do it. </p>\n\n<pre><code>package main\nimport (\n    \"crypto/tls\"\n    \"errors\"\n    \"fmt\"\n    \"golang.org/x/net/html\"\n    \"io\"\n    \"net/http\"\n    \"net/url\"\n    \"strings\"\n    \"time\"\n)\nvar alreadyCrawledList []string\nvar pending []string\nvar brokenLinks []string\nconst localHostWithPort = \"localhost:8080\"\nfunc IsLinkInPendingQueue(link string) bool {\n    for _, x := range pending {\n        if x == link {\n            return true\n        }\n    }\n    return false\n}\nfunc IsLinkAlreadyCrawled(link string) bool {\n    for _, x := range alreadyCrawledList {\n        if x == link {\n            return true\n        }\n    }\n    return false\n}\nfunc AddLinkInAlreadyCrawledList(link string) {\n    alreadyCrawledList = append(alreadyCrawledList, link)\n}\nfunc AddLinkInPendingQueue(link string) {\n    pending = append(pending, link)\n}\nfunc AddLinkInBrokenLinksQueue(link string) {\n    brokenLinks = append(brokenLinks, link)\n}\nfunc main() {\n    start := time.Now()\n    AddLinkInPendingQueue(\"http://\" + localHostWithPort)\n    for count := 0; len(pending) &gt; 0; count++ {\n        x := pending[0]\n        pending = pending[1:]  //it dynamicly change the search url\n        if err := crawlPage(x); err != nil {  //how to use it by using goroutine?\n            t.Errorf(err.Error())\n        }\n    }\n    duration := time.Since(start)\n    fmt.Println(\"________________\")\n    count = 0\n    for _, l := range brokenLinks {\n        count++\n        fmt.Println(count, \"Broken. | \", l)\n    }\n    fmt.Println(\"Time taken:\", duration)\n}\nfunc crawlPage(uri string) error {\n    if IsLinkAlreadyCrawled(uri) {\n        fmt.Println(\"Already visited: Ignoring uri | \", uri)\n        return nil\n    }\n    transport := &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{\n            InsecureSkipVerify: true,\n        },\n    }\n    client := http.Client{Transport: transport}\n    resp, err := client.Get(uri)\n    if err != nil {\n        fmt.Println(\"Got error: \", err.Error())\n        return err\n    }\n    if resp.StatusCode != http.StatusOK {\n        AddLinkInBrokenLinksQueue(uri)\n        return errors.New(fmt.Sprintf(\"Got %v instead of 200\", resp.StatusCode))\n    }\n    defer resp.Body.Close()\n    links := ParseLinks(resp.Body)\n    links = ConvertLinksToLocalHost(links)\n    for _, link := range links {\n        if !InOurDomain(link) {\n            continue\n        }\n        absolute := FixURL(link, uri)\n        if !IsLinkAlreadyCrawled(absolute) &amp;&amp; !IsLinkInPendingQueue(absolute) &amp;&amp; absolute != uri { // Don't enqueue a page twice!\n            AddLinkInPendingQueue(absolute)\n        }\n    }\n    AddLinkInAlreadyCrawledList(uri)\n    return nil\n}\nfunc InOurDomain(link string) bool {\n    uri, err := url.Parse(link)\n    if err != nil {\n        return false\n    }\n    if uri.Scheme == \"http\" || uri.Scheme == \"https\" {\n        if uri.Host == localHostWithPort {\n            return true\n        }\n        return false\n    }\n    return true\n}\nfunc ConvertLinksToLocalHost(links []string) []string {\n    var convertedLinks []string\n    for _, link := range links {\n        convertedLinks = append(convertedLinks, strings.Replace(link, \"leantricks.com\", localHostWithPort, 1))\n    }\n    return convertedLinks\n}\nfunc FixURL(href, base string) string {\n    uri, err := url.Parse(href)\n    if err != nil {\n        return \"\"\n    }\n    baseURL, err := url.Parse(base)\n    if err != nil {\n        return \"\"\n    }\n    uri = baseURL.ResolveReference(uri)\n    return uri.String()\n}\nfunc ParseLinks(httpBody io.Reader) []string {\n    var links []string\n    page := html.NewTokenizer(httpBody)\n    for {\n        tokenType := page.Next()\n        if tokenType == html.ErrorToken {\n            return links\n        }\n\n        token := page.Token()\n        switch tokenType {\n        case html.StartTagToken:\n            fallthrough\n        case html.SelfClosingTagToken:\n            switch token.DataAtom.String() {\n            case \"a\":\n                fallthrough\n            case \"link\":\n                fallthrough\n            case \"script\":\n                for _, attr := range token.Attr {\n                    if attr.Key == \"href\" {\n                        links = append(links, attr.Val)\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "garbage-collection"], "answers": [{"comments": [{"owner": {"reputation": 1137, "user_id": 2660766, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/qiIdj.png?s=128&g=1", "display_name": "maksadbek", "link": "https://stackoverflow.com/users/2660766/maksadbek"}, "edited": false, "score": 0, "creation_date": 1557323932, "post_id": 42381585, "comment_id": 98726972, "body": "A bit confused with heap size at GC start, at GC end, and live heap numbers. There was 11039MB heap size, including garbage, before the GC start, and how it is possible to have 13278MB heap size after the GC end ? I suppose that heap size at GC doest not include garbage size. Because of GC phase remove the garbage from heap, it must be decreased. The next number - live heap, how did we get 6876 MB of live heap ? Live heap is a heap size w/o garbage ?"}], "tags": [], "owner": {"reputation": 2445, "user_id": 1505341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9XpLu.jpg?s=128&g=1", "display_name": "Kerem", "link": "https://stackoverflow.com/users/1505341/kerem"}, "is_accepted": true, "score": 2, "last_activity_date": 1487730314, "creation_date": 1487730314, "answer_id": 42381585, "question_id": 42380784, "link": "https://stackoverflow.com/questions/42380784/reading-go-gctrace-output/42381585#42381585", "title": "Reading Go gctrace output", "body": "<p>In your case, they look like assist and termination times;</p>\n\n<pre><code>// CPU time\n0.18    : **STW** Sweep termination.\n7720ms  : Mark/Scan - Assist Time (GC performed in line with allocation).\n21356ms : Mark/Scan - Background GC time.\n3615ms  : Mark/Scan - Idle GC time.\n0.65ms  : **STW** Mark termination.\n</code></pre>\n\n<p>I think it changes (or it may) over various Go versions and you can find more detailed info at <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">runtime package docs</a>.</p>\n\n<pre><code>Currently, it is:\n    gc # @#s #%: #+#+# ms clock, #+#/#/#+# ms cpu, #-&gt;#-&gt;# MB, # MB goal, # P\nwhere the fields are as follows:\n    gc #        the GC number, incremented at each GC\n    @#s         time in seconds since program start\n    #%          percentage of time spent in GC since program start\n    #+...+#     wall-clock/CPU times for the phases of the GC\n    #-&gt;#-&gt;# MB  heap size at GC start, at GC end, and live heap\n    # MB goal   goal heap size\n    # P         number of processors used\n</code></pre>\n\n<p>Example <a href=\"https://github.com/ardanlabs/gotraining/tree/master/topics/profiling/godebug/gctrace#running-a-godebug-gc-trace\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>See also <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/J-Lh4WQgd6I\" rel=\"nofollow noreferrer\">Interpreting GC trace output</a></p>\n\n<pre><code>gc 6 @48.155s 15%: 0.093+12360+0.32 ms clock,\n0.18+7720/21356/3615+0.65 ms cpu, 11039-&gt;13278-&gt;6876 MB, 14183 MB goal, 8 P\n</code></pre>\n\n<ul>\n<li><strong>gc 6</strong> </li>\n<li><strong>@48.155s</strong> since program start</li>\n<li><strong>15%:</strong> of time spent in GC since program start</li>\n<li><strong>0.093+12360+0.32 ms clock</strong> stop-the-world (STW) sweep termination + concurrent\nmark and scan + and STW mark termination</li>\n<li><strong>0.18+7720/21356/3615+0.65 ms cpu</strong> (GC performed in\nline with allocation), background GC time, and idle GC time</li>\n<li><strong>11039->13278->6876 MB</strong> heap size at GC start, at GC end, and live heap</li>\n<li><strong>8 P</strong> number of processors used</li>\n</ul>\n"}], "owner": {"reputation": 35, "user_id": 7590149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cada805c7c4bed9ae60075ca7756022e?s=128&d=identicon&r=PG&f=1", "display_name": "ns52", "link": "https://stackoverflow.com/users/7590149/ns52"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 761, "favorite_count": 0, "accepted_answer_id": 42381585, "answer_count": 1, "score": 1, "last_activity_date": 1487730314, "creation_date": 1487724778, "question_id": 42380784, "link": "https://stackoverflow.com/questions/42380784/reading-go-gctrace-output", "title": "Reading Go gctrace output", "body": "<p>I have gctrace output that looks like this:</p>\n\n<pre><code>gc 6 @48.155s 15%: 0.093+12360+0.32 ms clock, 0.18+7720/21356/3615+0.65 ms cpu, 11039-&gt;13278-&gt;6876 MB, 14183 MB goal, 8 P\n</code></pre>\n\n<p>I am not sure how to read the CPU times in particular. I understand that it is broken down into three phases (STW sweep termination, concurrent mark/scan, and STW mark termination), but I'm not sure what the + signs mean (i.e. <code>0.18+7720</code> and <code>3615+0.65</code>). What do these + signs signify?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 3, "user_id": 7600908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeb6ec80419dbb381f6dd1b95626e8c4?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Lugovyi", "link": "https://stackoverflow.com/users/7600908/igor-lugovyi"}, "edited": false, "score": 1, "creation_date": 1487716764, "post_id": 42379326, "comment_id": 71907942, "body": "Output : {  &quot;Veggies&quot;: {   &quot;Carrots&quot;: 21  } }"}], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 0, "last_activity_date": 1487718001, "creation_date": 1487718001, "answer_id": 42379625, "question_id": 42379326, "link": "https://stackoverflow.com/questions/42379326/golang-create-json-array/42379625#42379625", "title": "Golang create json array", "body": "<p>To use an Unmarshaller, the struct data members need to be exported. That is, they need to be capitalized, or the unmarshaller does not have access. Capitalize <code>Array</code> in your <code>Data</code> struct. <code>Veggies</code> is the only one unmarshaled because it's capitalized and therefore exported.</p>\n"}, {"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 0, "last_activity_date": 1487719683, "last_edit_date": 1487719683, "creation_date": 1487718375, "answer_id": 42379704, "question_id": 42379326, "link": "https://stackoverflow.com/questions/42379326/golang-create-json-array/42379704#42379704", "title": "Golang create json array", "body": "<p>The code above doesn't compile, but also has a few problems with the types. I'd avoid names like Array which could be confused for language keywords, and forgo the custom types. Maybe something simpler like this?</p>\n\n<p><a href=\"https://play.golang.org/p/OBw4gI2Zkm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OBw4gI2Zkm</a></p>\n\n<pre><code>type Data struct {\n    Veggies map[string]int\n    Ints    []int\n}\n...\nj, err := json.MarshalIndent(d, \"\", \" \")\n</code></pre>\n\n<p>The docs for the json package are good, you need to read them. </p>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#Marshal</a></p>\n\n<p>For Go, this book is also great as an introduction to the language:</p>\n\n<p><a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">http://www.gopl.io/</a></p>\n"}], "owner": {"reputation": 3, "user_id": 7600908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eeb6ec80419dbb381f6dd1b95626e8c4?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Lugovyi", "link": "https://stackoverflow.com/users/7600908/igor-lugovyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1697, "favorite_count": 0, "accepted_answer_id": 42379704, "answer_count": 2, "score": -3, "last_activity_date": 1487719683, "creation_date": 1487716674, "question_id": 42379326, "link": "https://stackoverflow.com/questions/42379326/golang-create-json-array", "title": "Golang create json array", "body": "<p>I try to create json array</p>\n\n<pre><code>type Data struct {\nVeggies Vegetables\narray   array } type array map[string] []int\nfunc main(){\nvegetables := Vegetables{}\nvegetables[\"Carrots\"] = 21\nn:= array{}\nn  [\"array\"]= [] int {1, 1 ,1}\nd := Data{ vegetables,n}\n\njson.MarshalIndent(d, \"\", \" \")}\n</code></pre>\n\n<p>please explain why not see the array?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1487714816, "post_id": 42378878, "comment_id": 71907082, "body": "In the json <code>&quot;anleitung&quot;</code> is an array, you can&#39;t unmarshal that into a map."}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 1, "creation_date": 1487726465, "post_id": 42378878, "comment_id": 71911123, "body": "anleitung property in JSON is an array not an object. It is not compatible to unmarshal."}], "answers": [{"tags": [], "owner": {"reputation": 2445, "user_id": 1505341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9XpLu.jpg?s=128&g=1", "display_name": "Kerem", "link": "https://stackoverflow.com/users/1505341/kerem"}, "is_accepted": false, "score": -1, "last_activity_date": 1487716237, "last_edit_date": 1487716237, "creation_date": 1487715779, "answer_id": 42379118, "question_id": 42378878, "link": "https://stackoverflow.com/questions/42378878/mapstring-struct-inside-struct/42379118#42379118", "title": "map[string] struct inside struct", "body": "<p>Use <code>omitempty</code> flag for when your \"anleitung\" is empty in JSON to be consumed. Beware though, when that is the case, your <code>Jailbreak</code> struct won't have an \"anleitung\" field.</p>\n\n<p>Change your map's json flag to to;</p>\n\n<pre><code>Anleitung   map[string]struct {\n    Name string `json:\"blog\"`\n    Link string `json:\"link\"`\n} `json:\"anleitung,omitempty\"`\n</code></pre>\n\n<p>Option 2;</p>\n\n<p>I guess you could also use <code>Anleitung   map[string]interface{}</code> but that is better for \"holding a map of strings to arbitrary data types\". In your case the data is not arbitrary but rather, empty I guess. And looks like that is just temporary. </p>\n\n<p>I'd go for option 1, then I'd check if my struct contains any <code>Anleitung</code> data or not before accessing it.</p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1487743481, "creation_date": 1487743481, "answer_id": 42383863, "question_id": 42378878, "link": "https://stackoverflow.com/questions/42378878/mapstring-struct-inside-struct/42383863#42383863", "title": "map[string] struct inside struct", "body": "<p>The json provided is not valid (as the array does not have a closing <code>]</code> and the top level json object lacks another closing <code>}</code>) so let's assume it's like:</p>\n\n<pre><code>{\n  \"jailbreaks\": [\n    {\n      \"jailbroken\": false,\n      \"name\": \"\",\n      \"version\": \"\",\n      \"url\": \"\",\n      \"anleitung\": [],\n      \"ios\": {\n        \"start\": \"10.2.1\",\n        \"end\": \"\"\n      },\n      \"platforms\": [],\n      \"caveats\": \"\"\n    },\n    {\n      \"jailbroken\": true,\n      \"name\": \"Yalu102\",\n      \"version\": \"beta 6\",\n      \"url\": \"https://domain-dl.tld\",\n      \"anleitung\": [\n        {\n          \"blog\": \"title\",\n          \"link\": \"http://domain.tld/\"\n        },\n        {\n          \"blog\": \"Test\",\n          \"link\": \"http://google.at\"\n        }\n      ],\n      \"ios\": {\n        \"start\": \"10.2\",\n        \"end\": \"\"\n      },\n      \"platforms\": [\n        \"Windows\",\n        \"OS X\",\n        \"Linux\"\n      ],\n      \"caveats\": \"some text here\"\n    }\n  ]\n}\n</code></pre>\n\n<p>The data structure <code>Jailbreaks</code> (first one), marshals-to/unmarshals-from this json properly:</p>\n\n<pre><code>type Jailbreaks struct {\n    List []Jailbreak `json:\"jailbreaks\"`\n}\n\ntype Jailbreak struct {\n    Jailbroken bool   `json:\"jailbroken\"`\n    Name       string `json:\"name\"`\n    Version    string `json:\"version\"`\n    URL        string `json:\"url\"`\n    Anleitung  []struct {\n        Name string `json:\"blog\"`\n        Link string `json:\"link\"`\n    } `json:\"anleitung\"`\n\n    Firmwares struct {\n        Start string `json:\"start\"`\n        End   string `json:\"end\"`\n    } `json:\"ios\"`\n\n    Platforms []string `json:\"platforms\"`\n    Caveats   string   `json:\"caveats\"`\n}\n</code></pre>\n\n<p>As you see <code>Anleitung</code> is declared as a slice (not a map).</p>\n"}], "owner": {"reputation": 541, "user_id": 7100836, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cdc87122e512082b4b53e9f74fc804ad?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian", "link": "https://stackoverflow.com/users/7100836/fabian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1487743481, "creation_date": 1487714638, "last_edit_date": 1487742721, "question_id": 42378878, "link": "https://stackoverflow.com/questions/42378878/mapstring-struct-inside-struct", "title": "map[string] struct inside struct", "body": "<p>I have a JSON file that looks like this:</p>\n\n<pre><code>{\n  \"jailbreaks\": [\n    {\n      \"jailbroken\": false,\n      \"name\": \"\",\n      \"version\": \"\",\n      \"url\": \"\",\n      \"anleitung\": [],\n      \"ios\": {\n        \"start\": \"10.2.1\"\n      },\n      \"caveats\": \"\",\n      \"platforms\": []\n    },\n    {\n      \"jailbroken\": true,\n      \"name\": \"Yalu102\",\n      \"version\": \"beta 6\",\n      \"url\": \"https://domain-dl.tld\",\n      \"anleitung\": [\n        { \"blog\": \"title\", \"link\": \"http://domain.tld/\" },\n        { \"blog\": \"Test\", \"link\": \"http://google.at\" }\n      ],\n      \"ios\": {\n        \"start\": \"10.2\"\n      },\n      \"caveats\": \"some text here\",\n      \"platforms\": [\n        \"Windows\",\n        \"OS X\",\n        \"Linux\"\n      ]\n    },\n</code></pre>\n\n<p>And I create the object to work with like this:</p>\n\n<pre><code>type Jailbreak struct {\n    Jailbroken bool   `json:\"jailbroken\"`\n    Name       string `json:\"name\"`\n    Version    string `json:\"version\"`\n    URL        string `json:\"url\"`\n    Anleitung  map[string]struct {\n        Name string `json:\"blog\"`\n        Link string `json:\"link\"`\n    } `json:\"anleitung\"`\n\n    Firmwares struct {\n        Start string `json:\"start\"`\n        End   string `json:\"end\"`\n    } `json:\"ios\"`\n\n    Platforms []string `json:\"platforms\"`\n    Caveats   string   `json:\"caveats\"`\n}\n</code></pre>\n\n<p>When I want to build my go program I get an error, that the JSON file cannot be read. But as soon as I delete the <code>map[string]struct</code> I can compile and run the program without any error and everything works fine. \nAm I messing around with something or is there an error in my JSON file?</p>\n"}, {"tags": ["arrays", "json", "go", "struct"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1487711850, "post_id": 42377989, "comment_id": 71905369, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/25326644/how-to-unmarshal-a-json-array-with-different-type-of-value-in-it\">How to unmarshal a json array with different type of value in it</a>"}, {"owner": {"reputation": 215, "user_id": 1531021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd96d72657a9eef64a43d31abfbed715?s=128&d=identicon&r=PG", "display_name": "chrisdo", "link": "https://stackoverflow.com/users/1531021/chrisdo"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1487712314, "post_id": 42377989, "comment_id": 71905647, "body": "thanks, replacing Points <code>[]Point `json:&quot;points&quot;`</code> with <code>Points interface{}</code> at least parses the data, which makes sense to me.  But how can i get a typed value instead of the empty interface?"}, {"owner": {"reputation": 1017, "user_id": 2576956, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/98TKO.jpg?s=128&g=1", "display_name": "bvpx", "link": "https://stackoverflow.com/users/2576956/bvpx"}, "edited": false, "score": 0, "creation_date": 1487713323, "post_id": 42377989, "comment_id": 71906241, "body": "By using type assertion: <a href=\"http://stackoverflow.com/questions/20934909/golang-type-assertion\" title=\"golang type assertion\">stackoverflow.com/questions/20934909/golang-type-assertion</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1487713866, "post_id": 42377989, "comment_id": 71906539, "body": "You want it to be of type <code>[][]interface{}</code> Then you can index the individual values."}, {"owner": {"reputation": 27181, "user_id": 1070354, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56ca246e6d24b9a09114ff4542bcc2b1?s=128&d=identicon&r=PG", "display_name": "favoretti", "link": "https://stackoverflow.com/users/1070354/favoretti"}, "edited": false, "score": 0, "creation_date": 1487714105, "post_id": 42377989, "comment_id": 71906692, "body": "Hrm, nevermind my previous comments, went to play and what I thought would work isn&#39;t working.."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1487715890, "post_id": 42378906, "comment_id": 71907574, "body": "Just a note. Only an Unmarshaller for the array itself needs to be written. The array will unmarshal into a <code>[][]interface{}</code> of points. That is the portion that will need to be handled manually."}, {"owner": {"reputation": 215, "user_id": 1531021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd96d72657a9eef64a43d31abfbed715?s=128&d=identicon&r=PG", "display_name": "chrisdo", "link": "https://stackoverflow.com/users/1531021/chrisdo"}, "edited": false, "score": 0, "creation_date": 1487717432, "post_id": 42378906, "comment_id": 71908227, "body": "Thanks a lot, i will play with this. I managed to use type assertion to get the values from the Points, but using a custom unmarshaller for the array sounds cleaner to me. I will update Post as soon as I got it right."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1487753894, "post_id": 42378906, "comment_id": 71921839, "body": "@RayfenWindspear: I think the proper approach is to unmarshal the pointer data to <code>[]interface{}</code>. The standard JSON marshaler will already handle the <code>[]Point</code> part."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1487714768, "creation_date": 1487714768, "answer_id": 42378906, "question_id": 42377989, "link": "https://stackoverflow.com/questions/42377989/unmarshal-json-array-of-arrays-in-go/42378906#42378906", "title": "Unmarshal JSON Array of arrays in Go", "body": "<blockquote>\n  <p>Do I need to implement my own Unmarshaller for this?</p>\n</blockquote>\n\n<p>Yes.</p>\n\n<p>You're trying to unmarshal an array into a struct (<code>Point</code>), which means you need to tell the JSON unmarshaler how the array values map to the struct values.</p>\n\n<p>Also note that your tags are incorrect in your <code>Point</code> definition. json tags refer to the key names, but arrays don't have keys (in JavaScript they can be accessed as if they do, but this isn't JavaScript).  In other words, <code>json:\"0\"</code> will only work if your JSON looks like <code>{\"0\":123}</code>. If you implement your own unmarshaler, you can just get rid of those json tags.</p>\n"}, {"comments": [{"owner": {"reputation": 1111, "user_id": 1131607, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/xLKUc.jpg?s=128&g=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/1131607/arun"}, "edited": false, "score": 0, "creation_date": 1601551280, "post_id": 62455205, "comment_id": 113446060, "body": "Your example is really helpful !!"}, {"owner": {"reputation": 9199, "user_id": 1215344, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nuA7S.jpg?s=128&g=1", "display_name": "jamescampbell", "link": "https://stackoverflow.com/users/1215344/jamescampbell"}, "edited": false, "score": 0, "creation_date": 1617383058, "post_id": 62455205, "comment_id": 118296017, "body": "I keep forgetting I can do a slice of structs! Thanks!"}], "tags": [], "owner": {"reputation": 11307, "user_id": 2056484, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Jielp.jpg?s=128&g=1", "display_name": "Lucas Bustamante", "link": "https://stackoverflow.com/users/2056484/lucas-bustamante"}, "is_accepted": false, "score": 5, "last_activity_date": 1592498978, "creation_date": 1592498978, "answer_id": 62455205, "question_id": 42377989, "link": "https://stackoverflow.com/questions/42377989/unmarshal-json-array-of-arrays-in-go/62455205#62455205", "title": "Unmarshal JSON Array of arrays in Go", "body": "<p>The JSON:</p>\n\n<pre><code>[\n  {\n    \"type\": \"Car\",\n    \"wheels\": 4\n  },\n  {\n    \"type\": \"Motorcycle\",\n    \"wheels\": 2\n  }\n]\n</code></pre>\n\n<p>The Struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Vehicle struct {\n  Type   string\n  Wheels int\n}\n</code></pre>\n\n<p>The Unmarshaller:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestVehicleUnmarshal(t *testing.T) {\n    response := `[{\"type\": \"Car\",\"wheels\": 4},{\"type\": \"Motorcycle\",\"wheels\": 2}]`\n\n    var vehicles []Vehicle\n    json.Unmarshal([]byte(response), &amp;vehicles)\n\n    assert.IsType(t, Vehicle{}, vehicles[0])\n    assert.EqualValues(t, \"Car\", vehicles[0].Type)\n    assert.EqualValues(t, 4, vehicles[0].Wheels)\n    assert.EqualValues(t, \"Motorcycle\", vehicles[1].Type)\n    assert.EqualValues(t, 2, vehicles[1].Wheels)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/5SfDH-XZt9J\" rel=\"noreferrer\">https://play.golang.org/p/5SfDH-XZt9J</a></p>\n"}], "owner": {"reputation": 215, "user_id": 1531021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd96d72657a9eef64a43d31abfbed715?s=128&d=identicon&r=PG", "display_name": "chrisdo", "link": "https://stackoverflow.com/users/1531021/chrisdo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13973, "favorite_count": 4, "accepted_answer_id": 42378906, "answer_count": 2, "score": 11, "last_activity_date": 1592498978, "creation_date": 1487711191, "last_edit_date": 1488149422, "question_id": 42377989, "link": "https://stackoverflow.com/questions/42377989/unmarshal-json-array-of-arrays-in-go", "title": "Unmarshal JSON Array of arrays in Go", "body": "<p>I want to parse some json data in go. The data looks like this:</p>\n\n<blockquote>\n  <p>{\"id\":\"someId\",\"key_1\":\"value_1\",\"key_2\":\"value_2\",\"key_3\":\"value_3\",\"points\":[[1487100466412,\"50.032178\",\"8.526018\",300,0.0,26,0],[1487100471563,\"50.030869\",\"8.525949\",300,0.0,38,0],[1487100475722,\"50.028514\",\"8.525959\",225,0.0,69,-900],[1487100480834,\"50.025827\",\"8.525793\",275,0.0,92,-262],...]}</p>\n</blockquote>\n\n<p>I built a go struct:</p>\n\n<pre><code>type SomeStruct struct {\n   ID   string `json:\"id\"`\n   Key1 string `json:\"key_1\"`\n   Key2 string `json:\"key_2\"`\n   Key3 string `json:\"key_3\"`\n   Points []Point `json:\"points\"`\n}\n\ntype Point struct {\n   Timestamp int64 `json:\"0\"`\n   Latitude float64 `json:\"1,string\"`\n   Longitude float64 `json:\"2,string\"`\n   Altitude int `json:\"3\"` \n   Value1 float64 `json:\"4\"`\n   Value2 int `json:\"5\"`\n   Value3 int `json:\"6\"`      \n}\n</code></pre>\n\n<p>I unmarshal the json data</p>\n\n<pre><code>var track SomeStruct\nerror := json.Unmarshal(data,&amp;track)\nif(error != nil){\n    fmt.Printf(\"Error while parsing data: %s\", error)\n}\n</code></pre>\n\n<blockquote>\n  <p>json: cannot unmarshal array into Go value of type Point{someId value_1 value_2 value_3 [{0 0 0 0 0 0 0} {0 0 0 0 0 0 0} {0 0 0 0 0 0 0}...]}</p>\n</blockquote>\n\n<p>So the first json keys are parsed correctly, but I cannot figure out how to get the point data, which is an array of arrays.</p>\n\n<p>The generate struct is also the suggest one from here, except I don't use a nested struct but a separate type. Using the suggested nested struct does not make a difference:\n<a href=\"https://mholt.github.io/json-to-go/\" rel=\"noreferrer\">JSON-to-Go</a></p>\n\n<p>Do I need to implement my own Unmarshaller for this?</p>\n\n<p>======= UPDATE SOLUTION ============</p>\n\n<p>It is enough to implement the UnmarshalJSON interface for the Point struct.\nThe example below does not contain proper error handling but it show the direction.</p>\n\n<p><a href=\"https://play.golang.org/p/O9-JlEAKcq\" rel=\"noreferrer\">Playground example</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strconv\"\n)\n\ntype SomeStruct struct {\n    ID     string  `json:\"id\"`\n    Key1   string  `json:\"key_1\"`\n    Key2   string  `json:\"key_2\"`\n    Key3   string  `json:\"key_3\"`\n    Points []Point `json:\"points\"`\n}\n\ntype Point struct {\n    Timestamp int64\n    Latitude  float64\n    Longitude float64\n    Altitude  int\n    Value1    float64\n    Value2    int16\n    Value3    int16\n}\n\nfunc (tp *Point) UnmarshalJSON(data []byte) error {\n    var v []interface{}\n    if err := json.Unmarshal(data, &amp;v); err != nil {\n        fmt.Printf(\"Error whilde decoding %v\\n\", err)\n        return err\n    }\n    tp.Timestamp = int64(v[0].(float64))\n    tp.Latitude, _ = strconv.ParseFloat(v[1].(string), 64)\n    tp.Longitude, _ = strconv.ParseFloat(v[2].(string), 64)\n    tp.Altitude = int(v[3].(float64))\n    tp.Value1 = v[4].(float64)\n    tp.Value2 = int16(v[5].(float64))\n    tp.Value3 = int16(v[6].(float64))\n\n    return nil\n}\n\nfunc main() {\n\n    const data =    `{\"id\":\"someId\",\"key_1\":\"value_1\",\"key_2\":\"value_2\",\"key_3\":\"value_3\",\"points\":[[1487100466412,\"50.032178\",\"8.526018\",300,0.0,26,0],[1487100471563,\"50.030869\",\"8.525949\",300,0.0,38,0],[1487100475722,\"50.028514\",\"8.525959\",225,0.0,69,-900],[1487100480834,\"50.025827\",\"8.525793\",275,0.0,92,-262]]}`\n\nvar something SomeStruct\njson.Unmarshal([]byte(data), &amp;something)\n\nfmt.Printf(\"%v\", something)\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 1362, "user_id": 1638814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/79045cf2a5e6cd8d939d0e6d39327133?s=128&d=identicon&r=PG", "display_name": "nvartolomei", "link": "https://stackoverflow.com/users/1638814/nvartolomei"}, "edited": false, "score": 1, "creation_date": 1487709737, "post_id": 42377346, "comment_id": 71904063, "body": "actually you have one hidden mutex behind <code>ch</code> channel"}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "reply_to_user": {"reputation": 1362, "user_id": 1638814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/79045cf2a5e6cd8d939d0e6d39327133?s=128&d=identicon&r=PG", "display_name": "nvartolomei", "link": "https://stackoverflow.com/users/1638814/nvartolomei"}, "edited": false, "score": 0, "creation_date": 1487710706, "post_id": 42377346, "comment_id": 71904690, "body": "Yes, thanks! But the mutex is used only <code>nw</code> times, which is usually a low number when compared to the data to be processed, and the channel is used very late in the whole computation process. I don&#39;t know if that is the issue, but even if it was, my question remains: how do I know that it is because of that mutex that my code is not using more CPUs?"}, {"owner": {"reputation": 1362, "user_id": 1638814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/79045cf2a5e6cd8d939d0e6d39327133?s=128&d=identicon&r=PG", "display_name": "nvartolomei", "link": "https://stackoverflow.com/users/1638814/nvartolomei"}, "edited": false, "score": 0, "creation_date": 1487710933, "post_id": 42377346, "comment_id": 71904810, "body": "You are right. I just tried a sample similar to yours and it uses all available cores. I think full code example will be more useful."}, {"owner": {"reputation": 1362, "user_id": 1638814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/79045cf2a5e6cd8d939d0e6d39327133?s=128&d=identicon&r=PG", "display_name": "nvartolomei", "link": "https://stackoverflow.com/users/1638814/nvartolomei"}, "edited": false, "score": 1, "creation_date": 1487711107, "post_id": 42377346, "comment_id": 71904923, "body": "Speaking of locks, you can use go test -mutexprofile flag in order to profile lock contentions."}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "reply_to_user": {"reputation": 1362, "user_id": 1638814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/79045cf2a5e6cd8d939d0e6d39327133?s=128&d=identicon&r=PG", "display_name": "nvartolomei", "link": "https://stackoverflow.com/users/1638814/nvartolomei"}, "edited": false, "score": 0, "creation_date": 1487716161, "post_id": 42377346, "comment_id": 71907687, "body": "Oh, that&#39;s interesting! But apparently it&#39;s a 1.8 feature, I&#39;m using 1.7 right now. I guess that I&#39;ll try that if I cannot come up with a better solution."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1487717434, "post_id": 42377346, "comment_id": 71908229, "body": "<code>pprof</code> still had a blocking profile which shows time spent blocking on synchronization primitives in general. If you&#39;re creating too much garbage, it&#39;s possible you&#39;re limited by the garbage collector. You can see the GC activity using <code>GODEBUG=gctrace=1</code>, but I suggest you start by reading up on profiling Go programs."}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487719498, "post_id": 42377346, "comment_id": 71909011, "body": "@JimB thanks. I&#39;ll give pprof an in-depth look because I didn&#39;t know about this feature and I used cpu profiling only to check how much time was used by each routine. I don&#39;t think it&#39;s a GC issue, as the code pre-allocates most of the memory it uses, but I&#39;ll give it a check anyway. Thanks again EDIT btw, I tried GOGC=off and no performance improvement. Also, GC didn&#39;t show up in pprof top10."}], "answers": [{"tags": [], "owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "is_accepted": true, "score": 1, "last_activity_date": 1487777436, "creation_date": 1487777436, "answer_id": 42395736, "question_id": 42377346, "link": "https://stackoverflow.com/questions/42377346/how-to-detect-what-is-preventing-multiple-cores-being-used-in-golang/42395736#42395736", "title": "How to detect what is preventing multiple cores being used in golang?", "body": "<p>Sorry, but in the end I got the measurement wrong. @JimB was right, and I had a minor leak, but not so much to justify a slowdown of this magnitude. </p>\n\n<p>My expectations were too high: the function I was making concurrent was called only at the beginning of the program, therefore the performance improvement was just minor.</p>\n\n<p>After applying the pattern to other sections of the program, I got the expected results. My mistake in evaluation which section was the most important.</p>\n\n<p>Anyway, I learned a lot of interesting things meanwhile, so thanks a lot to all the people trying to help! </p>\n"}], "owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 1, "accepted_answer_id": 42395736, "answer_count": 1, "score": 1, "last_activity_date": 1487777436, "creation_date": 1487709011, "question_id": 42377346, "link": "https://stackoverflow.com/questions/42377346/how-to-detect-what-is-preventing-multiple-cores-being-used-in-golang", "title": "How to detect what is preventing multiple cores being used in golang?", "body": "<p>So, I have a piece of code that is concurrent and it's meant to be run onto each CPU/core.</p>\n\n<p>There are two large vectors with input/output values</p>\n\n<pre><code>var (\n    input = make([]float64, rowCount)\n    output = make([]float64, rowCount)\n)\n</code></pre>\n\n<p>these are filled and I want to compute the distance (error) between each input-output pair. Being the pairs independent, a possible concurrent version is the following:</p>\n\n<pre><code>var d float64 // Error to be computed\n// Setup a worker \"for each CPU\"\nch := make(chan float64)\nnw := runtime.NumCPU()\nfor w := 0; w &lt; nw; w++ {\n    go func(id int) {\n         var wd float64\n         // eg nw = 4\n         // worker0, i = 0, 4, 8, 12...\n         // worker1, i = 1, 5, 9, 13...\n         // worker2, i = 2, 6, 10, 14...\n         // worker3, i = 3, 7, 11, 15...\n         for i := id; i &lt; rowCount; i += nw {\n             res := compute(input[i])\n             wd += distance(res, output[i])\n         }\n         ch &lt;- wd\n    }(w)\n}\n// Compute total distance\nfor w := 0; w &lt; nw; w++ {\n    d += &lt;-ch\n}\n</code></pre>\n\n<p>The idea is to have a single worker for each CPU/core, and each worker processes a subset of the rows.</p>\n\n<p>The problem I'm having is that this code is no faster than the serial code.</p>\n\n<p>Now, I'm using Go 1.7 so <code>runtime.GOMAXPROCS</code> should be already set to <code>runtime.NumCPU()</code>, but even setting it explicitly does not improves performances.</p>\n\n<ul>\n<li>distance is just <code>(a-b)*(a-b)</code>;</li>\n<li>compute is a bit more complex, but should be reentrant and use global data <strong>only for reading</strong> (and uses <code>math.Pow</code> and <code>math.Sqrt</code> functions);</li>\n<li>no other goroutine is running.</li>\n</ul>\n\n<p>So, besides accessing the global data (input/output) for reading, there are no locks/mutexes that I am aware of (not using <code>math/rand</code>, for example).</p>\n\n<p>I also compiled with <code>-race</code> and nothing emerged.</p>\n\n<p>My host has 4 virtual cores, but when I run this code I get (using htop) CPU usage to 102%, but I expected something around 380%, as it happened in the past with other go code that used all the cores.</p>\n\n<p>I would like to investigate, but I don't know how the runtime allocates threads and schedule goroutines.</p>\n\n<p>How can I debug this kind of issues? Can <code>pprof</code> help me in this case? What about the <code>runtime</code> package?</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["go", "cloud-foundry", "prometheus"], "answers": [{"tags": [], "owner": {"reputation": 2555, "user_id": 3669613, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/054dcbe4dc6996000b0673791cd85465?s=128&d=identicon&r=PG&f=1", "display_name": "wastl", "link": "https://stackoverflow.com/users/3669613/wastl"}, "is_accepted": false, "score": 0, "last_activity_date": 1487780191, "creation_date": 1487780191, "answer_id": 42396801, "question_id": 42377057, "link": "https://stackoverflow.com/questions/42377057/deploy-prometheus-to-cloud-foundry/42396801#42396801", "title": "Deploy Prometheus to Cloud Foundry", "body": "<p>Ok, after digging around a bit I got the whole thing working as follows</p>\n\n<p><strong>manifest.yml</strong></p>\n\n<pre><code>---\napplications:\n- name: prometheus\n  instances: 1\n  buildpack: https://github.com/cloudfoundry/go-buildpack.git\n  command: prometheus\n  env:\n    GOPACKAGENAME: github.com/prometheus/prometheus\n    GO_INSTALL_PACKAGE_SPEC: github.com/prometheus/prometheus/cmd/prometheus\n  memory: 1000M\n</code></pre>\n\n<p>BUT in order to listen on the right port, the only solution I could find is adding the following to the <code>cmd/prometheus/config.go</code> file to the beginning of the <code>init()</code> function</p>\n\n<pre><code>port := \":9090\"\nif s := os.Getenv(\"PORT\"); s != \"\" {\n    port = \":\"+s\n}\n</code></pre>\n\n<p>and then changing the following part (also in the <code>init()</code> function)</p>\n\n<pre><code>cfg.fs.StringVar(\n    &amp;cfg.web.ListenAddress, \"web.listen-address\", \":9090\",\n    \"Address to listen on for the web interface, API, and telemetry.\",\n)\n</code></pre>\n\n<p>to</p>\n\n<pre><code>cfg.fs.StringVar(\n    &amp;cfg.web.ListenAddress, \"web.listen-address\", port,\n    \"Address to listen on for the web interface, API, and telemetry.\",\n)\n</code></pre>\n\n<p>After that you can simply deploy the application with <code>cf push</code> and everything should work as a charm</p>\n"}, {"comments": [{"owner": {"reputation": 28015, "user_id": 63550, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/RIZKi.png?s=128&g=1", "display_name": "Peter Mortensen", "link": "https://stackoverflow.com/users/63550/peter-mortensen"}, "edited": false, "score": 1, "creation_date": 1490433273, "post_id": 42416871, "comment_id": 73117962, "body": "Are those rhetorical questions? If not, they belong in comments to the question - <a href=\"http://meta.stackexchange.com/a/92115\">Stack Overflow is not a forum</a>. It is a <a href=\"http://meta.stackoverflow.com/a/325681\">think tank</a>. Otherwise, it works better to state them as facts."}], "tags": [], "owner": {"reputation": 1244, "user_id": 3423520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed5d8c6310ef9387471a4463da987fe0?s=128&d=identicon&r=PG&f=1", "display_name": "K.AJ", "link": "https://stackoverflow.com/users/3423520/k-aj"}, "is_accepted": false, "score": 1, "last_activity_date": 1490433188, "last_edit_date": 1490433188, "creation_date": 1487855849, "answer_id": 42416871, "question_id": 42377057, "link": "https://stackoverflow.com/questions/42377057/deploy-prometheus-to-cloud-foundry/42416871#42416871", "title": "Deploy Prometheus to Cloud Foundry", "body": "<p>Prometheus is a TSDB. And it is intended to consume gigabytes and gigabytes of data.</p>\n\n<p>On a Cloud Foundry platform, you are limited by available resources. \nSo, why deploy Prometheus to Cloud Foundry?</p>\n\n<p>Why not spin up a standalone <code>bosh director</code> and deploy Prometheus through the director as a Bosh deployment, and a standalone. Then inject it as a CUPS into Cloud Foundry?</p>\n\n<p>I am just curious and trying to understand the use case.</p>\n"}, {"tags": [], "owner": {"reputation": 3086, "user_id": 307795, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/V4rE4.png?s=128&g=1", "display_name": "DaShaun", "link": "https://stackoverflow.com/users/307795/dashaun"}, "is_accepted": false, "score": 1, "last_activity_date": 1528392748, "creation_date": 1528392748, "answer_id": 50747099, "question_id": 42377057, "link": "https://stackoverflow.com/questions/42377057/deploy-prometheus-to-cloud-foundry/50747099#50747099", "title": "Deploy Prometheus to Cloud Foundry", "body": "<p>I had the same question, but (just today) came up with a slightly different solution, that seemed easier to me.</p>\n\n<p>I used the prometheus-2.2.1-linux-amd64 binary build.</p>\n\n<p>I modified the <strong>prometheus.yml</strong> to use the default port 8080 as a target (last line):</p>\n\n<pre><code>    # my global config\nglobal:\n  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.\n  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.\n  # scrape_timeout is set to the global default (10s).\n\n# Alertmanager configuration\nalerting:\n  alertmanagers:\n  - static_configs:\n    - targets:\n      # - alertmanager:9093\n\n# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.\nrule_files:\n  # - \"first_rules.yml\"\n  # - \"second_rules.yml\"\n\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it's Prometheus itself.\nscrape_configs:\n  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.\n  - job_name: 'prometheus'\n\n    # metrics_path defaults to '/metrics'\n    # scheme defaults to 'http'.\n\n    static_configs:\n      - targets: ['localhost:8080'] ###### Only changed this line\n</code></pre>\n\n<p>Then I added a <strong>manifest.yml</strong></p>\n\n<pre><code>---\napplications:\n- name: prometheus\n  instances: 1\n  buildpack: https://github.com/cloudfoundry/binary-buildpack.git\n  command: ./prometheus --config.file=prometheus.yml --web.listen-address=:8080 --web.enable-admin-api\n  memory: 1024M\n  random-route: true\n</code></pre>\n\n<p>That is using the binary-buildpack, and tells prometheus to startup the server listening on port 8080.</p>\n\n<p>2 files changes and this:</p>\n\n<pre><code>cf push\n</code></pre>\n\n<p>Now I have prometheus running in my space on Pivotal Web Services.</p>\n"}], "owner": {"reputation": 2555, "user_id": 3669613, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/054dcbe4dc6996000b0673791cd85465?s=128&d=identicon&r=PG&f=1", "display_name": "wastl", "link": "https://stackoverflow.com/users/3669613/wastl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1513, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1559903696, "creation_date": 1487708030, "question_id": 42377057, "link": "https://stackoverflow.com/questions/42377057/deploy-prometheus-to-cloud-foundry", "title": "Deploy Prometheus to Cloud Foundry", "body": "<p>I want to deploy Prometheus to Cloud Foundry without using Docker container. When I try to deploy it with the standard Cloud Foundry Go Buildpack I get the following error:</p>\n\n<pre><code>can't load package: package prometheus: no buildable Go source files in /tmp/tmp.vv4iyDzMvE/.go/src/prometheus\n</code></pre>\n\n<p>Which somehow makes sense, because there are actually no sources in the  root directory and the project is compiled with the Prometheus utility tool.</p>\n\n<p>Is there any way to deploy Prometheus to Cloud Foundry, like using another Buildpack or something?</p>\n"}, {"tags": ["templates", "go", "nested", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1487709327, "creation_date": 1487709327, "answer_id": 42377440, "question_id": 42375121, "link": "https://stackoverflow.com/questions/42375121/range-through-an-arbitrary-number-of-nested-slices-of-structs-in-an-html-templat/42377440#42377440", "title": "Range through an arbitrary number of nested slices of structs in an HTML template in Go", "body": "<p>To recurse down a hierarchy, use a named template that executes itself.  In the following example, the template \"replies\" executes \"replies\" to display sub-replies: </p>\n\n<pre><code>{{define \"main\"}}\n&lt;div id=\"post\"&gt;                                              \n  {{.Title}}  \n  {{.Body}}\n  {{template \"replies\" .Replies}}\n&lt;/div&gt;\n{{end}}\n\n{{define \"replies\"}}\n   {{if .}}\n      &lt;ul&gt;\n      {{range . }}                                  \n         &lt;li class=\"post\"&gt;                                         \n           &lt;div class=\"postHead\"&gt;                                  \n             &lt;div class=\"postTitle\"&gt;&lt;b&gt;{{.Title}}&lt;/b&gt;&lt;/div&gt;   \n           &lt;/div&gt;\n           &lt;div class=\"postBody\"&gt;{{.Body}}&lt;/div&gt;\n           {{template \"replies\" .Replies}}\n         &lt;/li&gt;\n      {{end}}\n      &lt;/ul&gt;\n   {{end}}\n{{end}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/TjkaJO-aXW\" rel=\"noreferrer\">Playground Example</a></p>\n"}, {"tags": [], "owner": {"reputation": 1362, "user_id": 1638814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/79045cf2a5e6cd8d939d0e6d39327133?s=128&d=identicon&r=PG", "display_name": "nvartolomei", "link": "https://stackoverflow.com/users/1638814/nvartolomei"}, "is_accepted": false, "score": 4, "last_activity_date": 1487709354, "creation_date": 1487709354, "answer_id": 42377447, "question_id": 42375121, "link": "https://stackoverflow.com/questions/42375121/range-through-an-arbitrary-number-of-nested-slices-of-structs-in-an-html-templat/42377447#42377447", "title": "Range through an arbitrary number of nested slices of structs in an HTML template in Go", "body": "<p>You just have defined a recursive data type. You can render it by defining a recursive template:</p>\n\n<pre><code>{{define \"replies\"}}\n  &lt;ul&gt;\n    {{ range $key, $value := . }}\n      &lt;li class=\"post\"&gt;\n        &lt;div class=\"postHead\"&gt;\n          &lt;div class=\"postTitle\"&gt;&lt;b&gt;{{ $value.ID }}&lt;/b&gt;&lt;/div&gt;\n        &lt;/div&gt;\n        &lt;div class=\"postBody\"&gt;{{ $value.PostNum }}&lt;/div&gt;\n      &lt;/li&gt;\n\n      {{template \"replies\" .Replies}}\n    {{end}}\n  &lt;/ul&gt;\n{{end}}\n\n&lt;div id=\"posts\"&gt;\n  {{ .Title  }}\n  {{ .Body  }}\n\n  {{ template \"replies\" .Replies }}\n&lt;/div&gt;\n</code></pre>\n"}], "owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 659, "favorite_count": 1, "accepted_answer_id": 42377440, "answer_count": 2, "score": 3, "last_activity_date": 1487709607, "creation_date": 1487701536, "last_edit_date": 1487709607, "question_id": 42375121, "link": "https://stackoverflow.com/questions/42375121/range-through-an-arbitrary-number-of-nested-slices-of-structs-in-an-html-templat", "title": "Range through an arbitrary number of nested slices of structs in an HTML template in Go", "body": "<p>I'm trying to build a web forum kind of like Reddit. There are top level posts with replies and the replies can have replies and so on.</p>\n\n<p>A board looks like this:</p>\n\n<pre><code>var board map[string]*Post\n</code></pre>\n\n<p>and a <code>Post</code>:</p>\n\n<pre><code>type Post struct {\n  Title string\n  Body string\n  ID string\n  PostNum int\n  Replies []*Post\n}\n</code></pre>\n\n<p>How would I use a template to range through the nested <code>Replies</code> slices (keeping in mind that each <code>*Post</code> contains a <code>Replies</code> slice that contains <code>*Posts</code> that contains <code>Replies</code> and so on)?</p>\n\n<p>What I have so far:</p>\n\n<pre><code>&lt;div id=\"posts\"&gt;                                              \n  {{ .Title  }}  \n  {{ .Body  }}    \n\n  &lt;ul&gt;                                                        \n  {{ range $key, $value := .Replies }}                        \n    &lt;li class=\"post\"&gt;                                         \n      &lt;div class=\"postHead\"&gt;                                  \n        &lt;div class=\"postTitle\"&gt;&lt;b&gt;{{ $value.ID }}&lt;/b&gt;&lt;/div&gt;   \n      &lt;/div&gt;                                                  \n      &lt;div class=\"postBody\"&gt;{{ $value.PostNum }}&lt;/div&gt;        \n    &lt;/li&gt;          \n\n  &lt;ul&gt;                                   \n  {{ range $key, $value := $value.Replies }}                  \n    &lt;li class=\"post\"&gt;                                         \n      &lt;div class=\"postHead\"&gt;                                  \n        &lt;div class=\"postTitle\"&gt;&lt;b&gt;{{ $value.ID }}&lt;/b&gt;&lt;/div&gt;   \n      &lt;/div&gt;                                                  \n      &lt;div class=\"postBody\"&gt;{{ $value.PostNum }}&lt;/div&gt;        \n    &lt;/li&gt;                                                     \n  {{ end }}                                                   \n  &lt;/ul&gt;                                                       \n\n  {{ end }}                                                   \n  &lt;/ul&gt;                                                       \n&lt;/div&gt;                                                        \n</code></pre>\n\n<p>This only allows me to range through two levels of replies (and as you can see uses duplicate code), I need to be able to range through an arbitrary number of levels of <code>Replies</code>.</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1487701676, "post_id": 42373423, "comment_id": 71899497, "body": "Another approach you could take: only include a function in a specific API version if it is brand new or its behaviour changed from a previous version."}], "answers": [{"comments": [{"owner": {"reputation": 307, "user_id": 4607988, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nl7c4.jpg?s=128&g=1", "display_name": "Berti92", "link": "https://stackoverflow.com/users/4607988/berti92"}, "edited": false, "score": 2, "creation_date": 1487759654, "post_id": 42378645, "comment_id": 71925459, "body": "Thank you very much - that&#39;s a really nice solution!"}], "tags": [], "owner": {"reputation": 3055, "user_id": 3528562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356446110eb2675dfd9190c0e8e69ace?s=128&d=identicon&r=PG&f=1", "display_name": "Zoyd", "link": "https://stackoverflow.com/users/3528562/zoyd"}, "is_accepted": true, "score": 8, "last_activity_date": 1487713701, "creation_date": 1487713701, "answer_id": 42378645, "question_id": 42373423, "link": "https://stackoverflow.com/questions/42373423/how-to-add-multiple-groups-to-gin-routing-for-api-version-inheritance/42378645#42378645", "title": "How to add multiple groups to gin routing for api version inheritance?", "body": "<p>I don\u2019t think Gin provides this, but it looks easy to write.</p>\n\n<pre><code>type GroupGroup struct {\n    groups []*gin.RouterGroup\n}\n\nfunc NewGroupGroup(groups []*gin.RouterGroup) GroupGroup {\n    return GroupGroup {\n        groups,\n    }\n}\n\nfunc (g *GroupGroup) handle(method string, path string, handler gin.HandlerFunc) {\n    for _, group := range g.groups {\n        group.Handle(method, path, handler)\n    }\n}\n</code></pre>\n\n<p>Then, you can use it like so :</p>\n\n<pre><code>v1 := router.Group(\"/v1\")\nv2 := router.Group(\"/v2\")\n\ng := NewGroupGroup([]*gin.RouterGroup { v1, v2 })\n\ng.handle(http.MethodGet, \"hello\", sayHello)\ng.handle(http.MethodPost, \"goodbye\", sayGoodbye)\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 4607988, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nl7c4.jpg?s=128&g=1", "display_name": "Berti92", "link": "https://stackoverflow.com/users/4607988/berti92"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7852, "favorite_count": 0, "accepted_answer_id": 42378645, "answer_count": 1, "score": 4, "last_activity_date": 1487713701, "creation_date": 1487696194, "question_id": 42373423, "link": "https://stackoverflow.com/questions/42373423/how-to-add-multiple-groups-to-gin-routing-for-api-version-inheritance", "title": "How to add multiple groups to gin routing for api version inheritance?", "body": "<p>I'm currently working on a API with Go + Gin.</p>\n\n<p>The API should include a version string, for example the string v1</p>\n\n<pre><code>http://127.0.0.1:3000/v1/user/get_username\n</code></pre>\n\n<p>That is no problem, because I can create a group with Gin</p>\n\n<pre><code>v1 := router.Group(\"/v1\")\nv1.GET(\"/user/get_username\", modules.UserGetUsername)\n</code></pre>\n\n<p>But... if I start a new API-Version \"v2\" and the code within the function  UserGetUsername didn't changed I must do the following</p>\n\n<pre><code>v1 := router.Group(\"/v1\")\nv1.GET(\"/user/get_username\", modules.UserGetUsername)\nv2 := router.Group(\"/v2\")\nv2.GET(\"/user/get_username\", modules.UserGetUsername)\n</code></pre>\n\n<p>Is there a nicer solution for that - maybe something like that:</p>\n\n<pre><code>v1_v2 := router.Group(\"/v1\").AnotherGroup(\"/v2\")\nv1_v2.GET(\"/user/get_username\", modules.UserGetUsername)\n</code></pre>\n\n<p>Thank you for your suggestions.</p>\n"}, {"tags": ["go", "socket.io"], "answers": [{"comments": [{"owner": {"reputation": 360, "user_id": 3368499, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b423054f8db73de88e1c7643354f96b?s=128&d=identicon&r=PG&f=1", "display_name": "sten", "link": "https://stackoverflow.com/users/3368499/sten"}, "edited": false, "score": 0, "creation_date": 1489160833, "post_id": 42375284, "comment_id": 72564540, "body": "I was trying to do this using the base net library. And gorilla. I&#39;ll try this when I get home. Thanks."}], "tags": [], "owner": {"reputation": 2574, "user_id": 2223706, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/ksG4X.jpg?s=128&g=1", "display_name": "Garrett", "link": "https://stackoverflow.com/users/2223706/garrett"}, "is_accepted": false, "score": 2, "last_activity_date": 1487703346, "last_edit_date": 1487703346, "creation_date": 1487702143, "answer_id": 42375284, "question_id": 42373320, "link": "https://stackoverflow.com/questions/42373320/example-of-simple-websocket-connection-from-client/42375284#42375284", "title": "Example of simple websocket connection from client", "body": "<p>Ok, got it working.  There was a different URL I had to use.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/graarh/golang-socketio\"\n    \"github.com/graarh/golang-socketio/transport\"\n    \"log\"\n)\n\nfunc main() {\n    transport := transport.GetDefaultWebsocketTransport()\n    ws_url := \"ws://botws.generals.io/socket.io/?EIO=3&amp;transport=websocket\"\n    client, err := gosocketio.Dial(ws_url, transport)\n    if err != nil {\n        log.Fatal(err)\n    }\n    client.On(gosocketio.OnConnection, func(c *gosocketio.Channel, args interface{}) {\n        log.Println(\"Connected!\")\n    })\n\n    // Block to give client time to connect \n    select {}\n\n    client.Close()\n}\n</code></pre>\n"}], "owner": {"reputation": 2574, "user_id": 2223706, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/ksG4X.jpg?s=128&g=1", "display_name": "Garrett", "link": "https://stackoverflow.com/users/2223706/garrett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 804, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1487703346, "creation_date": 1487695910, "last_edit_date": 1487700463, "question_id": 42373320, "link": "https://stackoverflow.com/questions/42373320/example-of-simple-websocket-connection-from-client", "title": "Example of simple websocket connection from client", "body": "<p>I would like to rewrite this JavaScript (run in Node) into Go.</p>\n\n<pre><code>let io = require('socket.io-client');\nlet socket = io('http://botws.generals.io');\n\nsocket.on('connect', function() {\n    console.log('Connected to server.');\n});\n</code></pre>\n\n<p>(<em>I've tried <a href=\"https://github.com/graarh/golang-socketio\" rel=\"nofollow noreferrer\">this library</a> unsuccessfully; I can elaborate on my noob attempts if that helps</em>)</p>\n"}, {"tags": ["go", "react-native", "android-ndk", "gomobile"], "comments": [{"owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "edited": false, "score": 0, "creation_date": 1488250359, "post_id": 42371997, "comment_id": 72137498, "body": "What is the err from os.Create?  Have you tried saving using an absolute path - something like &quot;/sdcard/myfile&quot;?"}, {"owner": {"reputation": 18158, "user_id": 3293914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fPAnb.jpg?s=128&g=1", "display_name": "Dan Field", "link": "https://stackoverflow.com/users/3293914/dan-field"}, "edited": false, "score": 0, "creation_date": 1510235412, "post_id": 42371997, "comment_id": 81355544, "body": "are you able to open the file in Java/ObjC/Swift?"}], "answers": [{"tags": [], "owner": {"reputation": 18158, "user_id": 3293914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fPAnb.jpg?s=128&g=1", "display_name": "Dan Field", "link": "https://stackoverflow.com/users/3293914/dan-field"}, "is_accepted": false, "score": 0, "last_activity_date": 1510415762, "last_edit_date": 1510415762, "creation_date": 1510410518, "answer_id": 47238976, "question_id": 42371997, "link": "https://stackoverflow.com/questions/42371997/os-create-and-os-open-not-working-with-gomobile-and-react-native/47238976#47238976", "title": "os.Create and os.Open not working with gomobile and react native", "body": "<p>So you should have some success if you pass this in as a parameter - something like the following is working for me:</p>\n\n<p>go:</p>\n\n<pre><code>func Component(folderPath string) string {\n    f, err := os.Open(path.Join(folderPath, fname)) \n    ...\n</code></pre>\n\n<p>Java:</p>\n\n<pre><code>Component.Component(getApplicationContext().getFilesDir().getAbsolutePath())\n</code></pre>\n\n<p>Alternatively, you could use something like <code>getExternalStorageDirectory().getAbsolutePath()</code>.  They key is that you need to get somewhere storagewise that is writable by your process/user.</p>\n"}], "owner": {"reputation": 975, "user_id": 865779, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/sgNMc.png?s=128&g=1", "display_name": "Minty", "link": "https://stackoverflow.com/users/865779/minty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 421, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1510415762, "creation_date": 1487692399, "last_edit_date": 1487696659, "question_id": 42371997, "link": "https://stackoverflow.com/questions/42371997/os-create-and-os-open-not-working-with-gomobile-and-react-native", "title": "os.Create and os.Open not working with gomobile and react native", "body": "<pre><code>package component\n\nimport (\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"os\"\n)\n\n\ntype LastComponent struct {\n    Name string\n}\n\nconst fname = \"componentfiles\"\n\n\nfunc Persist(comp string) string {\n    lcomp := LastComponent{Name: comp}\n    b, err := json.Marshal(lcomp)\n    if err != nil {\n        return \"err-MARSHAL\"\n    }\n    file, err := os.Create(fname)\n    if err != nil {\n        return \"err-CREATE-FILE\"\n    }\n    defer file.Close()\n    _, err = file.Write(b)\n    if err != nil {\n        return \"err-FILE-WRITE-PROB\"\n    }\n    return \"\"\n}\n\nfunc Component() string {\n    f, err := os.Open(fname)\n    if err != nil {\n        return \"err-FILE-NOT-OPEN\"\n    }\n    defer f.Close()\n    b, err := ioutil.ReadAll(f)\n    if err != nil {\n        return \"\"\n    }\n    var v LastComponent\n    json.Unmarshal(b, v)\n    return v.Name\n}\n\n\n}\n</code></pre>\n\n<p>The code above works fine and so does the javascript side of code. I keep receiving <code>err-CREATE-FILE</code> inside my javascript. So <code>os.Create</code> and <code>os.Open</code> are not working as expected.</p>\n\n<p>Although it is an internal storage, permissions are not required, but I also turned on the permissions in manifest file, but with no avail.</p>\n\n<p>What could be the correct way to <code>Open</code> and <code>Create</code> files in android using gomobile when using along side React Native?</p>\n\n<p><strong>Update:</strong> </p>\n\n<p>In <code>adb logcat</code>, I keep getting this all over the place</p>\n\n<p><code>E/Vold    (  276): Failed to find mounted volume for /storage/sdcard1/Android/data/com.gotest/cache/</code></p>\n"}, {"tags": ["sockets", "ssl", "encryption", "go", "tls1.2"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1487692510, "post_id": 42371961, "comment_id": 71893638, "body": "What problem are you having exactly? Yes a TLS record is limited to 2^14 bytes, but you&#39;re not dealing directly with TLS records, you&#39;re reading and writing a stream."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487692599, "post_id": 42371961, "comment_id": 71893707, "body": "@JimB In this case I misunderstood something, on the clientside I just getting the half of the response when I am using the TLS."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1487692766, "post_id": 42371961, "comment_id": 71893845, "body": "<code>Read</code> returns the data that is available, so you need to Read again until you reach EOF, the correct data size, some message delimiter, etc."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487693261, "post_id": 42371961, "comment_id": 71894224, "body": "Ah, ye I got it. I tryed to use this <code>message, _ := bufio.NewReader(conn).ReadString(&#39;\\n&#39;)</code> and I got all. Now I understand, I just misunderstood how this TLS limit is working."}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 408, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487692315, "creation_date": 1487692315, "question_id": 42371961, "link": "https://stackoverflow.com/questions/42371961/golang-tls-size-too-small-in-tcp-communication", "title": "Golang TLS size too small in TCP communication", "body": "<p>I'm trying to setup a tcp socket system with TLS and I have big amount of data in response. I know that the TLS only support 2^14 bytes data, but most of the time I will have more than this, for example there is some part of the code which is return back 170.000 user. I wondering how can I solve this issue with TLS. Of course I want some kind of encryption between the client and server. My current code is basic implementation of the tls.   </p>\n\n<pre><code>func Handle() {\n    conf := TLS()\n    listener, err = tls.Listen(\"tcp\", \"0.0.0.0:7777\", &amp;conf)\n    checkError(err)\n    defer listener.Close()\n\n    for {\n        conn, err := listener.Accept()\n        checkError(err)\n        go handleRequest(conn, db)\n\n    }\n}\n\nfunc TLS() tls.Config {\n    cert, err := tls.LoadX509KeyPair(\"certs/publickey.cer\", \"certs/private.key\")\n    checkError(err)\n    tlsConfig := tls.Config{Certificates: []tls.Certificate{cert}}\n    tlsConfig.Time = func() time.Time { return time.Now() }\n    tlsConfig.Rand = rand.Reader\n    return tlsConfig\n}\n</code></pre>\n\n<p>On client side:</p>\n\n<pre><code>func withTls() {\n    conn, err := tls.Dial(\n        \"tcp\",\n        \"127.0.0.1:7777\",\n        &amp;tls.Config{\n            InsecureSkipVerify: true,\n            ServerName:         \"127.0.0.1\",\n        })\n    checkError(err)\n    conn.Write([]byte(text))\n\n    var buf [16000]byte\n    n, err := conn.Read(buf[0:])\n    checkError(err)\n    conn.Close()\n}\n</code></pre>\n\n<p>What is your offer to use for encryption? Without the TLS on the clientside I got the whole response of the server. The encryption is important because there is communication between servers. </p>\n\n<p>The current speed avarage 15ms/req, I want to keep this speed, which is depend on the data size, but it isn't related to TLS. </p>\n"}, {"tags": ["go", "protocol-buffers", "swagger"], "comments": [{"owner": {"reputation": 886, "user_id": 959953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f8f51e1aa14cdd87cffeaa26bb0ce13?s=128&d=identicon&r=PG", "display_name": "eddiezane", "link": "https://stackoverflow.com/users/959953/eddiezane"}, "edited": false, "score": 0, "creation_date": 1508947252, "post_id": 42368221, "comment_id": 80821325, "body": "Did you ever find a solution to this? I&#39;m looking to do something similar. Leaning towards writing a plugin that with my own options that can filter out the fields that are &quot;Create only&quot; or &quot;internal&quot;."}, {"owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "reply_to_user": {"reputation": 886, "user_id": 959953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f8f51e1aa14cdd87cffeaa26bb0ce13?s=128&d=identicon&r=PG", "display_name": "eddiezane", "link": "https://stackoverflow.com/users/959953/eddiezane"}, "edited": false, "score": 0, "creation_date": 1509102107, "post_id": 42368221, "comment_id": 80894316, "body": "Unfortunately no. I eventually gave up and resigned myself to a manual intervention."}], "answers": [{"comments": [{"owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1563822129, "post_id": 52654286, "comment_id": 100819578, "body": "where do you import that from?"}, {"owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1563829905, "post_id": 52654286, "comment_id": 100822704, "body": "I&#39;ve tried several different imports but I cannot get access to those options in my own protos"}, {"owner": {"reputation": 71, "user_id": 10458507, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-h8BGnjN61Lg/AAAAAAAAAAI/AAAAAAAAB2w/ohNY00Ckld0/photo.jpg?sz=128", "display_name": "Jodie Putrino", "link": "https://stackoverflow.com/users/10458507/jodie-putrino"}, "reply_to_user": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 1, "creation_date": 1564160213, "post_id": 52654286, "comment_id": 100952898, "body": "You need to add this import:  <code>import &quot;protoc-gen-swagger&#47;options&#47;annotations.proto&quot;;</code>  <a href=\"https://github.com/grpc-ecosystem/grpc-gateway/tree/master/protoc-gen-swagger\" rel=\"nofollow noreferrer\">github.com/grpc-ecosystem/grpc-gateway/tree/master/&hellip;</a>"}], "tags": [], "owner": {"reputation": 71, "user_id": 10458507, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-h8BGnjN61Lg/AAAAAAAAAAI/AAAAAAAAB2w/ohNY00Ckld0/photo.jpg?sz=128", "display_name": "Jodie Putrino", "link": "https://stackoverflow.com/users/10458507/jodie-putrino"}, "is_accepted": false, "score": 7, "last_activity_date": 1538774759, "last_edit_date": 1538774759, "creation_date": 1538683152, "answer_id": 52654286, "question_id": 42368221, "link": "https://stackoverflow.com/questions/42368221/confusion-creating-swagger-json-file-from-proto-file/52654286#52654286", "title": "Confusion creating swagger.json file from proto file", "body": "<p>Posting here for anyone else who comes across this question looking for the same information.</p>\n\n<hr>\n\n<p><strong>UPDATE</strong> \nThis is where the code defines how definitions are created. </p>\n\n<p><a href=\"https://github.com/grpc-ecosystem/grpc-gateway/blob/master/protoc-gen-swagger/genswagger/template.go#L859\" rel=\"noreferrer\">https://github.com/grpc-ecosystem/grpc-gateway/blob/master/protoc-gen-swagger/genswagger/template.go#L859</a></p>\n\n<hr>\n\n<p>This is how you can denote fields as required -- add a custom option to your message definition:</p>\n\n<pre><code>message MyMessage {\n    option (grpc.gateway.protoc_gen_swagger.options.openapiv2_schema) = {\n        json_schema: {\n            title: \"MyMessage\"\n            description: \"Does something neat\"\n            required: [\"MyString\"]\n        }\n    };\n\n    string MyString = 1;\n    int64 MyInt = 2;\n}\n</code></pre>\n"}], "owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4395, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1538774759, "creation_date": 1487682516, "question_id": 42368221, "link": "https://stackoverflow.com/questions/42368221/confusion-creating-swagger-json-file-from-proto-file", "title": "Confusion creating swagger.json file from proto file", "body": "<p>I've created a proto file with all the necessary messages and rpc functions for a REST webservice I intend to generate. Using the protoc-gen-swagger plugin I've managed to compile that proto file into a swagger.json file and all seems well, except for two things, which I can't seem to work out.</p>\n\n<ol>\n<li><p>All the definitions in the swagger.json file has the name of my proto file's package prefixed onto them. Is there a way to get rid of this?</p></li>\n<li><p>All of the fields of my messages are \"optional\". They're not specified explicitly as such but they're not specified to be \"required\" which, by definition, makes them optional. Proto3 no longer supports required/optional/repeating but even if I use Proto2 and add those keywords, it doesn't seem to affect the swagger.json ouput. How do I specifiy in my proto file that a field is required such that protoc-gen-swagger will add the required section to the json output?</p></li>\n</ol>\n\n<p>Here is a sample of a very basic proto file:</p>\n\n<p><strong>webservice.proto</strong></p>\n\n<pre><code>syntax = \"proto3\";\npackage mypackage;\nimport \"google/api/annotations.proto\";\n\nservice MyAPIWebService {\n    rpc MyFunc (MyMessage) returns (MyResponse) {\n        option (google.api.http) = {\n            post: \"/message\"\n            body: \"*\"\n        };\n    }\n}\n\nmessage MyMessage {\n    string MyString = 1;\n    int64 MyInt = 2;\n}\n\nmessage MyResponse {\n    string MyString = 1;\n}\n</code></pre>\n\n<p>This is then compiled into a swagger.json file with the following command:</p>\n\n<blockquote>\n  <p>protoc -I. -I\"%GOPATH%/src/github.com/grpc-ecosystem/grpc-gateway/third_party/googleapis\" --swagger_out=logtostderr=true:. webservice.proto</p>\n</blockquote>\n\n<p>which yields the following output:\n<strong>webservice.swagger.json</strong></p>\n\n<pre><code>{\n  \"swagger\": \"2.0\",\n  \"info\": {\n    \"title\": \"webservice.proto\",\n    \"version\": \"version not set\"\n  },\n  \"schemes\": [\n    \"http\",\n    \"https\"\n  ],\n  \"consumes\": [\n    \"application/json\"\n  ],\n  \"produces\": [\n    \"application/json\"\n  ],\n  \"paths\": {\n    \"/message\": {\n      \"post\": {\n        \"operationId\": \"MyFunc\",\n        \"responses\": {\n          \"200\": {\n            \"description\": \"\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/mypackageMyResponse\"\n            }\n          }\n        },\n        \"parameters\": [\n          {\n            \"name\": \"body\",\n            \"in\": \"body\",\n            \"required\": true,\n            \"schema\": {\n              \"$ref\": \"#/definitions/mypackageMyMessage\"\n            }\n          }\n        ],\n        \"tags\": [\n          \"MyAPIWebService\"\n        ]\n      }\n    }\n  },\n  \"definitions\": {\n    \"mypackageMyMessage\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"MyString\": {\n          \"type\": \"string\"\n        },\n        \"MyInt\": {\n          \"type\": \"string\",\n          \"format\": \"int64\"\n        }\n      }\n    },\n    \"mypackageMyResponse\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"MyString\": {\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}\n</code></pre>\n\n<ol>\n<li><p>Notice how <code>MyMessage</code> and <code>MyResponse</code> in the proto file translates to <code>mypackageMyMessage</code> and <code>mypackageMyResponse</code> in the json file.</p></li>\n<li><p>If I wanted, for instance, MyMessage:MyString to be required, I'd have to add a section to the \"mypackageMyMessage\" section in \"definitions\" that looks like this:</p>\n\n<p>\"required\":[\n    \"MyString\"\n]</p></li>\n</ol>\n\n<p>I would definitely prefer if there was a way I could specify that in the proto file already so that I don't have to manually edit the json file every time I compile it.</p>\n"}, {"tags": ["file", "go", "io", "gob"], "answers": [{"comments": [{"owner": {"reputation": 352, "user_id": 5244594, "user_type": "registered", "accept_rate": 92, "profile_image": "https://lh3.googleusercontent.com/-xUvQO-9qjpQ/AAAAAAAAAAI/AAAAAAAAGc8/RbYhxAnK-VQ/photo.jpg?sz=128", "display_name": "\u041f\u0430\u0432\u0435\u043b \u0412\u0430\u0439\u0441\u0431\u0435\u0440\u0433", "link": "https://stackoverflow.com/users/5244594/%d0%9f%d0%b0%d0%b2%d0%b5%d0%bb-%d0%92%d0%b0%d0%b9%d1%81%d0%b1%d0%b5%d1%80%d0%b3"}, "edited": false, "score": 0, "creation_date": 1487684394, "post_id": 42368226, "comment_id": 71887375, "body": "Sorry for wasting your time: I&#39;m totally new to Go and it&#39;s &#39;infrastructure&#39;. Thank you very much for detailed explanation, your answer is rather perfect."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1487708966, "last_edit_date": 1487708966, "creation_date": 1487682548, "answer_id": 42368226, "question_id": 42368063, "link": "https://stackoverflow.com/questions/42368063/go-writing-byte-to-file-results-in-zero-byte-file/42368226#42368226", "title": "Go. Writing []byte to file results in zero byte file", "body": "<p><a href=\"https://golang.org/pkg/bufio/#Writer\" rel=\"nofollow noreferrer\"><code>bufio.Writer</code></a> (as the package name hints) uses a buffer to cache writes. If you ever use it, you must call <a href=\"https://golang.org/pkg/bufio/#Writer.Flush\" rel=\"nofollow noreferrer\"><code>Writer.Flush()</code></a> when you're done writing to it to ensure the buffered data gets written to the underlying <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a>.</p>\n\n<p>Also note that you can directly write to an <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>os.File</code></a>, no need to create a buffered writer \"around\" it. (<code>*os.File</code> implements <code>io.Writer</code>).</p>\n\n<p>Also note that you can create the <a href=\"https://golang.org/pkg/encoding/gob/#Encoder\" rel=\"nofollow noreferrer\"><code>gob.Encoder</code></a> directly directed to the <code>os.File</code>, so even the <a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"nofollow noreferrer\"><code>bytes.Buffer</code></a> is unnecessary.</p>\n\n<p>Also <a href=\"https://golang.org/pkg/os/#MkdirAll\" rel=\"nofollow noreferrer\"><code>os.MkdirAll()</code></a> may fail, check its return value.</p>\n\n<p>Also it's better to \"concatenate\" parts of a file path using <a href=\"https://golang.org/pkg/path/filepath/#Join\" rel=\"nofollow noreferrer\"><code>filepath.Join()</code></a> which takes care of extra / missing slashes at the end of folder names.</p>\n\n<p>And last, it would be better to signal the failure of <code>Serialize()</code>, e.g. with an <code>error</code> return value, so the caller party has the chance to examine if the operation succeeded, and act accordingly.</p>\n\n<p>So <code>Order.Serialize()</code> should look like this:</p>\n\n<pre><code>func (order Order) Serialize(folder string) error {\n    if err := os.MkdirAll(folder, 0777); err != nil {\n        return err\n    }\n\n    file, err := os.Create(filepath.Join(folder, order.Id))\n    if err != nil {\n        return err\n    }\n    defer file.Close()\n\n    if err := gob.NewEncoder(file).Encode(order); err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 352, "user_id": 5244594, "user_type": "registered", "accept_rate": 92, "profile_image": "https://lh3.googleusercontent.com/-xUvQO-9qjpQ/AAAAAAAAAAI/AAAAAAAAGc8/RbYhxAnK-VQ/photo.jpg?sz=128", "display_name": "\u041f\u0430\u0432\u0435\u043b \u0412\u0430\u0439\u0441\u0431\u0435\u0440\u0433", "link": "https://stackoverflow.com/users/5244594/%d0%9f%d0%b0%d0%b2%d0%b5%d0%bb-%d0%92%d0%b0%d0%b9%d1%81%d0%b1%d0%b5%d1%80%d0%b3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1355, "favorite_count": 0, "accepted_answer_id": 42368226, "answer_count": 1, "score": 3, "last_activity_date": 1487708966, "creation_date": 1487682083, "last_edit_date": 1487684899, "question_id": 42368063, "link": "https://stackoverflow.com/questions/42368063/go-writing-byte-to-file-results-in-zero-byte-file", "title": "Go. Writing []byte to file results in zero byte file", "body": "<p>I try to serialize a structured data to file. I looked through some examples and made such construction:</p>\n\n<pre><code>func (order Order) Serialize(folder string) {\n    b := bytes.Buffer{}\n    e := gob.NewEncoder(&amp;b)\n    err := e.Encode(order)\n    if err != nil { panic(err) }\n\n    os.MkdirAll(folder, 0777)\n    file, err := os.Create(folder + order.Id)\n    if err != nil {  panic(err) }\n    defer file.Close()\n\n\n    writer := bufio.NewWriter(file)\n    n, err := writer.Write(b.Bytes())\n\n    fmt.Println(n)\n\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p><code>Serialize</code> is a method serializing its object to file called by it's <em>id</em> property. I looked through debugger - byte buffer contains data before writing. I mean object is fully initialized. Even <code>n</code> variable representing quantity of written bytes is more than a thousand - the file shouldn't be empty at all. The file is created but it is totally empty. What's wrong?</p>\n"}, {"tags": ["linux", "bash", "ubuntu", "go"], "comments": [{"owner": {"reputation": 61700, "user_id": 5291015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZFijZ.jpg?s=128&g=1", "display_name": "Inian", "link": "https://stackoverflow.com/users/5291015/inian"}, "edited": false, "score": 0, "creation_date": 1487678424, "post_id": 42366677, "comment_id": 71883173, "body": "You want to kill the process you started as <code>.&#47;myprogram &amp;</code>?"}, {"owner": {"reputation": 2183, "user_id": 5257738, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1481932215459032/picture?type=large", "display_name": "Rustam Ibragimov", "link": "https://stackoverflow.com/users/5257738/rustam-ibragimov"}, "reply_to_user": {"reputation": 61700, "user_id": 5291015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZFijZ.jpg?s=128&g=1", "display_name": "Inian", "link": "https://stackoverflow.com/users/5291015/inian"}, "edited": false, "score": 0, "creation_date": 1487678489, "post_id": 42366677, "comment_id": 71883226, "body": "@Inian, yes, this is one of solutions"}], "answers": [{"comments": [{"owner": {"reputation": 2183, "user_id": 5257738, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1481932215459032/picture?type=large", "display_name": "Rustam Ibragimov", "link": "https://stackoverflow.com/users/5257738/rustam-ibragimov"}, "edited": false, "score": 0, "creation_date": 1487679045, "post_id": 42366812, "comment_id": 71883633, "body": "Thankgs that what i wanted"}], "tags": [], "owner": {"reputation": 61700, "user_id": 5291015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZFijZ.jpg?s=128&g=1", "display_name": "Inian", "link": "https://stackoverflow.com/users/5291015/inian"}, "is_accepted": true, "score": 1, "last_activity_date": 1487678558, "creation_date": 1487678558, "answer_id": 42366812, "question_id": 42366677, "link": "https://stackoverflow.com/questions/42366677/bash-script-to-update-go-project-on-ubuntu-16-04/42366812#42366812", "title": "Bash script to update GO project on Ubuntu 16.04", "body": "<p><code>bash</code> has a special variable <code>$!</code> that you can use to store the process id of the most recently started background process</p>\n\n<pre><code>./myprogram &amp;\nmyprogram_PID=$!\n\nkill \"$myprogram_PID\"\n</code></pre>\n"}], "owner": {"reputation": 2183, "user_id": 5257738, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1481932215459032/picture?type=large", "display_name": "Rustam Ibragimov", "link": "https://stackoverflow.com/users/5257738/rustam-ibragimov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "closed_date": 1487679741, "accepted_answer_id": 42366812, "answer_count": 1, "score": 0, "last_activity_date": 1487678558, "creation_date": 1487678270, "question_id": 42366677, "link": "https://stackoverflow.com/questions/42366677/bash-script-to-update-go-project-on-ubuntu-16-04", "closed_reason": "Duplicate", "title": "Bash script to update GO project on Ubuntu 16.04", "body": "<p>guys.\nI am new to bash scripting and deploying Go on ubuntu. \nI run my Go program like this</p>\n\n<pre><code>go build -o myprogram main.go\n./myprogram &amp;\n</code></pre>\n\n<p>But now, instead of uploading files with sftp and manually change everything I wanted to write simple bash script. </p>\n\n<p>The problem is that I firstly need to kill existing process and I don't know how to get PID and kill it. </p>\n\n<p>Maybe I can run my program using something different so I don't have to find PID. </p>\n\n<p>I tried using ps ax | grep myprogram and then kill it, but no luck</p>\n"}, {"tags": ["json", "go", "unicode", "escaping"], "answers": [{"comments": [{"owner": {"reputation": 729, "user_id": 4331612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90b8fdf1a8acd545964d5601b32a6ca?s=128&d=identicon&r=PG", "display_name": "elonzh", "link": "https://stackoverflow.com/users/4331612/elonzh"}, "edited": false, "score": 0, "creation_date": 1487677743, "post_id": 42366249, "comment_id": 71882714, "body": "Thanks for your answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1487679564, "last_edit_date": 1495542718, "creation_date": 1487677070, "answer_id": 42366249, "question_id": 42365902, "link": "https://stackoverflow.com/questions/42365902/how-do-i-make-raw-unicode-encoded-content-readable/42366249#42366249", "title": "How do I make raw unicode encoded content readable?", "body": "<p>That is just the standard way to escape any Unicode character.</p>\n\n<p>Unmarshal it to see the unquoted text (the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>json</code></a> package will unquote it):</p>\n\n<pre><code>func main() {\n    var i interface{}\n    err := json.Unmarshal([]byte(src), &amp;i)\n    fmt.Println(err, i)\n}\n\nconst src = `{\"forum\":{\"id\":\"3251718\",\"name\":\"\\u5408\\u80a5\\u5de5\\u4e1a\\u5927\\u5b66\\u5ba3\\u57ce\\u6821\\u533a\",\"first_class\":\"\\u9ad8\\u7b49\\u9662\\u6821\",\"second_class\":\"\\u5b89\\u5fbd\\u9662\\u6821\",\"is_like\":\"0\",\"user_level\":\"1\",\"level_id\":\"1\",\"level_name\":\"\\u7d20\\u672a\\u8c0b\\u9762\",\"cur_score\":\"0\",\"levelup_score\":\"5\",\"member_num\":\"80329\",\"is_exists\":\"1\",\"thread_num\":\"108762\",\"post_num\":\"3445881\",\"good_classify\":[{\"class_id\":\"0\",\"class_name\":\"\\u5168\\u90e8\"},{\"class_id\":\"1\",\"class_name\":\"\\u516c\\u544a\\u7c7b\"},{\"class_id\":\"2\",\"class_name\":\"\\u5427\\u53cb\\u4e13\\u533a\"},{\"class_id\":\"4\",\"class_name\":\"\\u6d3b\\u52a8\\u4e13\\u533a\"},{\"class_id\":\"6\",\"class_name\":\"\\u793e\\u56e2\\u73ed\\u7ea7\"},{\"class_id\":\"5\",\"class_name\":\"\\u8d44\\u6e90\\u5171\\u4eab\"},{\"class_id\":\"8\",\"class_name\":\"\\u6e29\\u99a8\\u751f\\u6d3b\\u7c7b\"},{\"class_id\":\"7\",\"class_name\":\"\\u54a8\\u8be2\\u65b0\\u95fb\\u7c7b\"},{\"class_id\":\"3\",\"class_name\":\"\\u98ce\\u91c7\\u5c55\\u793a\\u533a\"}]}}`\n</code></pre>\n\n<p>Output (trimmed) (try it on the <a href=\"https://play.golang.org/p/37VeXdzBhy\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<p><code>&lt;nil&gt; map[forum:map[levelup_score:5 is_exists:1 post_num:3445881 good_classify:[map[class_id:0 class_name:\u5168\u90e8] map[class_id:1 class_name:\u516c\u544a\u7c7b] map[class_id:2 class_name:\u5427\u53cb\u4e13\u533a] map[class_id:4 class_name:\u6d3b\u52a8\u4e13\u533a] map[class_id:6 class_name:\u793e\u56e2\u73ed\u7ea7] map[class_id:5 class_name:\u8d44\u6e90\u5171\u4eab] map[class_id:8 class_name:\u6e29\u99a8\u751f\u6d3b\u7c7b] map[class_name:\u54a8\u8be2\u65b0\u95fb\u7c7b class_id:7] map[class_id:3 class_name:\u98ce\u91c7\u5c55\u793a\u533a]] id:3251718 is_like:0 cur_score:0\n</code></p>\n\n<p>If you just want to unquote a fragment, you may use <a href=\"https://golang.org/pkg/strconv/#Unquote\" rel=\"nofollow noreferrer\"><code>strconv.Unquote()</code></a>:</p>\n\n<pre><code>fmt.Println(strconv.Unquote(`\"\\u7d20\\u672a\\u8c0b\"`))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/I47UyunWZt\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>\u7d20\u672a\u8c0b &lt;nil&gt;\n</code></pre>\n\n<p>Note that <code>strconv.Unquote()</code> expects a <code>string</code> that is in quotes, that's why I used a raw string literal, so I could add quotes, and also so that the compiler itself will not interpret / unquote the Unicode escapes.</p>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/36528575/how-to-convert-escape-characters-in-html-tags/36529158#36529158\">How to convert escape characters in HTML tags?</a></p>\n"}], "owner": {"reputation": 729, "user_id": 4331612, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c90b8fdf1a8acd545964d5601b32a6ca?s=128&d=identicon&r=PG", "display_name": "elonzh", "link": "https://stackoverflow.com/users/4331612/elonzh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1487679564, "creation_date": 1487676103, "last_edit_date": 1487677568, "question_id": 42365902, "link": "https://stackoverflow.com/questions/42365902/how-do-i-make-raw-unicode-encoded-content-readable", "title": "How do I make raw unicode encoded content readable?", "body": "<p>I used <code>net/http</code> request a web API and the server returned a JSON response. When I print the response body, it displayed as raw ASCII content. I tried using <code>bufio.ScanRunes</code> to parse the content but failed.</p>\n\n<p>I also tried write a simple server and return a unicode string and it worked well.</p>\n\n<p>Here is the core code:</p>\n\n<pre><code>func (c ClientInfo) Request(method string, url string, form url.Values) string {\n    req, _ := http.NewRequest(method, url, strings.NewReader(c.Encode(form)))\n    req.Header = c.Header\n    req.AddCookie(&amp;c.Cookie)\n    resp, err := http.DefaultClient.Do(req)\n    defer resp.Body.Close()\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    scanner := bufio.NewScanner(resp.Body)\n    scanner.Split(bufio.ScanRunes)\n\n    var buf bytes.Buffer\n    for scanner.Scan() {\n        buf.WriteString(scanner.Text())\n    }\n    rv := buf.String()\n    fmt.Println(rv)\n    return rv\n}\n</code></pre>\n\n<p>Here is the example output:</p>\n\n<blockquote>\n  <p>{\"forum\":{\"id\":\"3251718\",\"name\":\"\\u5408\\u80a5\\u5de5\\u4e1a\\u5927\\u5b66\\u5ba3\\u57ce\\u6821\\u533a\",\"first_class\":\"\\u9ad8\\u7b49\\u9662\\u6821\",\"second_class\":\"\\u5b89\\u5fbd\\u9662\\u6821\",\"is_like\":\"0\",\"user_level\":\"1\",\"level_id\":\"1\",\"level_name\":\"\\u7d20\\u672a\\u8c0b\\u9762\",\"cur_score\":\"0\",\"levelup_score\":\"5\",\"member_num\":\"80329\",\"is_exists\":\"1\",\"thread_num\":\"108762\",\"post_num\":\"3445881\",\"good_classify\":[{\"class_id\":\"0\",\"class_name\":\"\\u5168\\u90e8\"},{\"class_id\":\"1\",\"class_name\":\"\\u516c\\u544a\\u7c7b\"},{\"class_id\":\"2\",\"class_name\":\"\\u5427\\u53cb\\u4e13\\u533a\"},{\"class_id\":\"4\",\"class_name\":\"\\u6d3b\\u52a8\\u4e13\\u533a\"},{\"class_id\":\"6\",\"class_name\":\"\\u793e\\u56e2\\u73ed\\u7ea7\"},{\"class_id\":\"5\",\"class_name\":\"\\u8d44\\u6e90\\u5171\\u4eab\"},{\"class_id\":\"8\",\"class_name\":\"\\u6e29\\u99a8\\u751f\\u6d3b\\u7c7b\"},{\"class_id\":\"7\",\"class_name\":\"\\u54a8\\u8be2\\u65b0\\u95fb\\u7c7b\"},{\"class_id\":\"3\",\"class_name\":\"\\u98ce\\u91c7\\u5c55\\u793a\\u533a\"}],\"managers\":[{\"id\":\"793092593\",\"name\":\"yi\\u62b9\\u660e\\u5a9a\\u7684\\u5fe7\\u4f24\"},</p>\n  \n  <p>...</p>\n</blockquote>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 518, "user_id": 3150716, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100002399317187/picture?type=large", "display_name": "Chirag", "link": "https://stackoverflow.com/users/3150716/chirag"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1487708747, "post_id": 42365671, "comment_id": 71903495, "body": "Problem solved. Didn&#39;t know to use pipe.&lt;redisFunctions&gt; . Got it now. Thanks for your time anyhow."}, {"owner": {"reputation": 377, "user_id": 3284965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f9c9a1902f72e0e858107351d95ea8?s=128&d=identicon&r=PG&f=1", "display_name": "manpatha", "link": "https://stackoverflow.com/users/3284965/manpatha"}, "edited": false, "score": 0, "creation_date": 1618450147, "post_id": 42365671, "comment_id": 118607241, "body": "I still confused what is difference between pipeline, pipelined, txpipeline and txpipelined. Doc is so minimal."}], "answers": [{"tags": [], "owner": {"reputation": 648, "user_id": 9323388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cef802072695bf44b64d63a6805c7901?s=128&d=identicon&r=PG&f=1", "display_name": "Margach Chris", "link": "https://stackoverflow.com/users/9323388/margach-chris"}, "is_accepted": false, "score": 0, "last_activity_date": 1615273174, "creation_date": 1615273174, "answer_id": 66542201, "question_id": 42365671, "link": "https://stackoverflow.com/questions/42365671/whatre-pipeline-and-txpipeline-redis-functions-in-gloang/66542201#66542201", "title": "what&#39;re Pipeline and TxPipeline redis functions in gloang", "body": "<p>Code from one of the examples from the library on how to use transaction.</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;time&quot;\n\n    &quot;github.com/go-redis/redis&quot;\n)\n\nvar redisdb *redis.Client\n\nfunc main() {\n    var incr *redis.IntCmd\n    _, err := redisdb.Pipelined(func(pipe redis.Pipeliner) error {\n        incr = pipe.Incr(&quot;pipelined_counter&quot;)\n        pipe.Expire(&quot;pipelined_counter&quot;, time.Hour)\n        return nil\n    })\n    fmt.Println(incr.Val(), err)\n}\n</code></pre>\n"}], "owner": {"reputation": 518, "user_id": 3150716, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100002399317187/picture?type=large", "display_name": "Chirag", "link": "https://stackoverflow.com/users/3150716/chirag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 831, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1615273174, "creation_date": 1487675353, "question_id": 42365671, "link": "https://stackoverflow.com/questions/42365671/whatre-pipeline-and-txpipeline-redis-functions-in-gloang", "title": "what&#39;re Pipeline and TxPipeline redis functions in gloang", "body": "<p>I want to perform an atomic transaction in redis using golang. How to do that ? What is the difference b/w Pileline and TxPieline and how to solve the problem using them. \nI have visited the following link:\n<a href=\"https://godoc.org/gopkg.in/redis.v5#example-Client-TxPipeline\" rel=\"nofollow noreferrer\">https://godoc.org/gopkg.in/redis.v5#example-Client-TxPipeline</a></p>\n\n<p>But explanation is not elaborate.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 2045, "user_id": 56688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee1220e0ff47d2ad071d6c377ada7965?s=128&d=identicon&r=PG", "display_name": "pritaeas", "link": "https://stackoverflow.com/users/56688/pritaeas"}, "edited": false, "score": 3, "creation_date": 1487663969, "post_id": 42361595, "comment_id": 71873424, "body": "<code>user</code> is a reserved word, escape it with backticks."}, {"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "reply_to_user": {"reputation": 2045, "user_id": 56688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee1220e0ff47d2ad071d6c377ada7965?s=128&d=identicon&r=PG", "display_name": "pritaeas", "link": "https://stackoverflow.com/users/56688/pritaeas"}, "edited": false, "score": 0, "creation_date": 1487664189, "post_id": 42361595, "comment_id": 71873540, "body": "I used backticks to wrap my query, so I can not use it to wrap <i>user</i>"}, {"owner": {"reputation": 2045, "user_id": 56688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee1220e0ff47d2ad071d6c377ada7965?s=128&d=identicon&r=PG", "display_name": "pritaeas", "link": "https://stackoverflow.com/users/56688/pritaeas"}, "edited": false, "score": 1, "creation_date": 1487664386, "post_id": 42361595, "comment_id": 71873651, "body": "<a href=\"http://stackoverflow.com/questions/21198980/golang-how-to-escape-back-ticks\" title=\"golang how to escape back ticks\">stackoverflow.com/questions/21198980/&hellip;</a> (ugly unfortunately)"}, {"owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "reply_to_user": {"reputation": 2045, "user_id": 56688, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee1220e0ff47d2ad071d6c377ada7965?s=128&d=identicon&r=PG", "display_name": "pritaeas", "link": "https://stackoverflow.com/users/56688/pritaeas"}, "edited": false, "score": 1, "creation_date": 1487664502, "post_id": 42361595, "comment_id": 71873704, "body": "yup, you right, thanks"}], "owner": {"reputation": 1246, "user_id": 4516106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37134b731235c61f94701c9e5d6882cf?s=128&d=identicon&r=PG", "display_name": "khue bui", "link": "https://stackoverflow.com/users/4516106/khue-bui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 468, "favorite_count": 0, "closed_date": 1487667245, "answer_count": 0, "score": 1, "last_activity_date": 1487663758, "creation_date": 1487663758, "question_id": 42361595, "link": "https://stackoverflow.com/questions/42361595/sql-syntax-error-golang", "closed_reason": "Duplicate", "title": "Sql syntax error Golang", "body": "<p>I've just started learning Golang.</p>\n\n<p>I followed the example_test in Golang source <a href=\"https://github.com/golang/go/blob/master/src/database/sql/example_test.go#L48\" rel=\"nofollow noreferrer\">ExampleDB_Query_multipleResultSets</a></p>\n\n<p>then I modified my query likely:</p>\n\n<pre><code>`\ncreate table uid (id bigint);\n\nselect id from user where age &lt; ?;\n\nSELECT user.id, user.name FROM user JOIN uid ON user.id = uid.id;\n\nselect ur.user, ur.role from user_roles as ur join uid on uid.id = ur.user;\n`\n</code></pre>\n\n<p>table user:</p>\n\n<pre><code>+-------+--------------+------+-----+---------+----------------+\n| Field | Type         | Null | Key | Default | Extra          |\n+-------+--------------+------+-----+---------+----------------+\n| name  | varchar(255) | YES  |     | NULL    |                |\n| age   | int(11)      | YES  |     | NULL    |                |\n| id    | int(11)      | NO   | PRI | NULL    | auto_increment |\n+-------+--------------+------+-----+---------+----------------+\n</code></pre>\n\n<p>and uid:</p>\n\n<pre><code>+-------+------------+------+-----+---------+-------+\n| Field | Type       | Null | Key | Default | Extra |\n+-------+------------+------+-----+---------+-------+\n| id    | bigint(20) | YES  |     | NULL    |       |\n+-------+------------+------+-----+---------+-------+\n</code></pre>\n\n<p>I recieved the error from log:</p>\n\n<pre><code>2017/02/21 14:44:08 Error 1064: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'select id from user where age &lt; ?;\n\nSELECT user.id, user.name FROM user JOIN uid' at line 3\nexit status 1\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 0, "creation_date": 1487665982, "post_id": 42361418, "comment_id": 71874573, "body": "<code>Db.Exec(&#39;UPDATE instruction.file SET &quot;details&quot; = (jsonb_set(&quot;details&quot;,&#39;{&quot;UploadBy&quot;}&#39;,$1::jsonb, true)) WHERE id=$2&#39;, uname, &quot;820&quot;)</code> you tried of course and the error is the same?.."}, {"owner": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "reply_to_user": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 0, "creation_date": 1487667969, "post_id": 42361418, "comment_id": 71875734, "body": "yes. Iam getting the same error (invalid input syntax for type json). Any idea how to resolve this?"}, {"owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 0, "creation_date": 1487668487, "post_id": 42361418, "comment_id": 71876092, "body": "not really... seems go wants to convert smth to json?.."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1487677712, "post_id": 42361418, "comment_id": 71882696, "body": "Just a tip: string literals containing quotes are best delimited by backticks (<code>`</code>). It avoids common syntax errors and at the very least makes your code easier to read"}], "answers": [{"tags": [], "owner": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "is_accepted": false, "score": 0, "last_activity_date": 1487673186, "last_edit_date": 1487673186, "creation_date": 1487671511, "answer_id": 42364285, "question_id": 42361418, "link": "https://stackoverflow.com/questions/42361418/updating-jsonb-column-in-golang/42364285#42364285", "title": "Updating Jsonb column in golang", "body": "<p>I managed to remove the error:</p>\n\n<p>\"uname\" was of the type string, when created like:</p>\n\n<pre><code>uname := \"test@test.com\"\n</code></pre>\n\n<p>It should be a json variable. Must be created like:</p>\n\n<pre><code>uname := `\"test@test.com\"`\n</code></pre>\n\n<p>I don't know whether it is the right answer. But it works.</p>\n"}, {"comments": [{"owner": {"reputation": 12503, "user_id": 2668545, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qjh4R.jpg?s=128&g=1", "display_name": "ThinkBonobo", "link": "https://stackoverflow.com/users/2668545/thinkbonobo"}, "edited": false, "score": 0, "creation_date": 1572640006, "post_id": 42376625, "comment_id": 103634114, "body": "you sir, are a godsend!"}], "tags": [], "owner": {"reputation": 97819, "user_id": 131874, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b3600796ab1d9e78c7545c91468c2e51?s=128&d=identicon&r=PG", "display_name": "Clodoaldo Neto", "link": "https://stackoverflow.com/users/131874/clodoaldo-neto"}, "is_accepted": true, "score": 6, "last_activity_date": 1487706597, "creation_date": 1487706597, "answer_id": 42376625, "question_id": 42361418, "link": "https://stackoverflow.com/questions/42361418/updating-jsonb-column-in-golang/42376625#42376625", "title": "Updating Jsonb column in golang", "body": "<p>Use <a href=\"https://www.postgresql.org/docs/current/static/functions-json.html#FUNCTIONS-JSON-CREATION-TABLE\" rel=\"noreferrer\"><code>to_jsonb</code></a>:</p>\n\n<pre><code>Db.Exec(`\n    UPDATE instruction.file\n    SET details = jsonb_set(\"details\", '{\"UploadBy\"}', to_jsonb($1::text), true)\n    WHERE id = $2\n    `, uname, \"820\"\n)\n</code></pre>\n"}], "owner": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2543, "favorite_count": 1, "accepted_answer_id": 42376625, "answer_count": 2, "score": 4, "last_activity_date": 1487706597, "creation_date": 1487663136, "last_edit_date": 1487666403, "question_id": 42361418, "link": "https://stackoverflow.com/questions/42361418/updating-jsonb-column-in-golang", "title": "Updating Jsonb column in golang", "body": "<p>I am trying to update a Jsonb column value for a particular row.\nI ran the query </p>\n\n<pre><code>UPDATE instruction.file SET \"details\" = (jsonb_set(\"details\",'{\"UploadBy\"}','\"test@test.com\"'::jsonb, true)) WHERE id=820;\n</code></pre>\n\n<p>this works fine in the pgAdmin3.</p>\n\n<p>When I tried to do the same in my Go code. Iam getting the error:\"pq: invalid input syntax for type json\"</p>\n\n<p>My Go code:</p>\n\n<pre><code>func main() {\n    uname := \"test@test.com\"\n\n    err := Init() //Db init\n    if err != nil {\n        fmt.Println(\"Error\", err)\n        return\n    }\n\n    result, err1 := Db.Exec(\"UPDATE instruction.file SET \\\"details\\\" = (jsonb_set(\\\"details\\\",'{\\\"UploadBy\\\"}',$1::jsonb, true)) WHERE id=$2\", uname, \"820\")\n    if err1 != nil {\n        fmt.Println(\"Error\", err1)\n        return\n    }\n    n, err1 := result.RowsAffected()\n    if err1 != nil {\n        fmt.Println(\"Error\", err1)\n        return\n    }\n\n    if n != 1 {\n        err1 = errors.New(\"Unable to update instruction.file\")\n        fmt.Println(\"Error\", err1)\n        return\n    }\n\n    fmt.Println(\"Success\")\n    return\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2362, "user_id": 6610070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/920b021f5001a5fb1630bdde3b425c43?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas Damam", "link": "https://stackoverflow.com/users/6610070/srinivas-damam"}, "edited": false, "score": 0, "creation_date": 1487663731, "post_id": 42361506, "comment_id": 71873307, "body": "In simple words deference returns a variable, so that we could access and assign values? @Tinwor"}, {"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "reply_to_user": {"reputation": 2362, "user_id": 6610070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/920b021f5001a5fb1630bdde3b425c43?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas Damam", "link": "https://stackoverflow.com/users/6610070/srinivas-damam"}, "edited": false, "score": 0, "creation_date": 1487664478, "post_id": 42361506, "comment_id": 71873692, "body": "In simple words the indirection operator returns the value of the variable while reference operator return the address of a variable. In Go you can also use the new built-in function to get the pointer. @SrinivasDamam"}, {"owner": {"reputation": 158, "user_id": 5899931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3f86822fa2897a15ee9d7328b46bc17?s=128&d=identicon&r=PG&f=1", "display_name": "JakeStrang", "link": "https://stackoverflow.com/users/5899931/jakestrang"}, "edited": false, "score": 0, "creation_date": 1607014859, "post_id": 42361506, "comment_id": 115145603, "body": "Just like any dereference, this will cause a nil pointer dereference panic if the pointer is nil, so make sure to check first."}], "tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": true, "score": 2, "last_activity_date": 1487663915, "last_edit_date": 1487663915, "creation_date": 1487663455, "answer_id": 42361506, "question_id": 42361324, "link": "https://stackoverflow.com/questions/42361324/assign-value-to-a-string-dereference-operator/42361506#42361506", "title": "Assign value to a string dereference operator", "body": "<p><code>*</code> (also know as indirection operator) is used to \u201cdereference\u201d pointer variables, dereferencing a pointer gives us access to the value the pointer points to.<br>\nIn this case: <code>*course = \"Docker Extended\"</code> basically you are saying to the compiler: store the <code>string</code> \"Docker Extended\" in the memory location <code>course</code> refers to.</p>\n"}], "owner": {"reputation": 2362, "user_id": 6610070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/920b021f5001a5fb1630bdde3b425c43?s=128&d=identicon&r=PG&f=1", "display_name": "Srinivas Damam", "link": "https://stackoverflow.com/users/6610070/srinivas-damam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 42361506, "answer_count": 1, "score": 1, "last_activity_date": 1489474665, "creation_date": 1487662853, "last_edit_date": 1489474665, "question_id": 42361324, "link": "https://stackoverflow.com/questions/42361324/assign-value-to-a-string-dereference-operator", "title": "Assign value to a string dereference operator", "body": "<p>I'm new to go, pardon me if this is a regular question, How does the assignment to a string dereference operator works below?    </p>\n\n<pre><code>package main    \n\nimport \"fmt\"\n\nfunc main() {\n    course := \"Docker Deep Dive\"\n    changeCourse(&amp;course)\n}\n\nfunc changeCourse(course *string) {\n    fmt.Println(course) // prints the memory address of course since it is a pointer\n    fmt.Println(*course) // prints the value since * is dereferenceing the pointer\n\n   // Issue\n    *course = \"Docker Extended\" // *course is a string, how does the assignment works here.\n    fmt.Println(*course) // prints \"Docker Extended\"\n}\n</code></pre>\n"}, {"tags": ["github", "go", "command-line", "git-bash"], "answers": [{"comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1487658469, "post_id": 42359676, "comment_id": 71870545, "body": "if you are using go 1.8 with no GOPATH it will be <code>$HOME&#47;go&#47;bin&#47;primitive</code>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1487697958, "last_edit_date": 1487697958, "creation_date": 1487656336, "answer_id": 42359676, "question_id": 42359622, "link": "https://stackoverflow.com/questions/42359622/go-command-line-problems-after-a-go-get/42359676#42359676", "title": "GO command line problems after a &quot;go get&quot;", "body": "<p>The README assumes that <code>$GOPATH/bin</code> is on your path.  Try running <code>$GOPATH/bin/primitive</code> or <code>$HOME/go/bin/primitive</code> if you did not set GOPATH.</p>\n"}], "owner": {"reputation": 1, "user_id": 7596456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b53b71ff0c57abf84958e9b7b826f26?s=128&d=identicon&r=PG&f=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/7596456/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1487697958, "creation_date": 1487656068, "question_id": 42359622, "link": "https://stackoverflow.com/questions/42359622/go-command-line-problems-after-a-go-get", "title": "GO command line problems after a &quot;go get&quot;", "body": "<p>So i just installed GO for the use of Primitive (here's the README.md) <a href=\"https://github.com/fogleman/primitive\" rel=\"nofollow noreferrer\">https://github.com/fogleman/primitive</a>. What essentially is supposed to happen is that you give in an image and it recreates it using polygons. Here is an example of an image reconverted using Primitive <a href=\"https://codepen.io/DavQ/pen/wgVWzo\" rel=\"nofollow noreferrer\">https://codepen.io/DavQ/pen/wgVWzo</a></p>\n\n<p>As it states </p>\n\n<blockquote>\n  <p>Command-line Usage</p>\n</blockquote>\n\n<pre><code>go get -u github.com/fogleman/primitive\n\nprimitive -i input.png -o output.png -n 100\n</code></pre>\n\n<p>The first command runs fine and I checked if i had it with \"go list ./...\"\nI am now within a test folder with just one image within the folder called \"recursion.jpg\" and run the command the docs provide </p>\n\n<pre><code>primitive -i recursion.jpg -o recursion.svg -n 100\n</code></pre>\n\n<p>The problem is with the command, I get the returned </p>\n\n<pre><code>-bash: primitive: command not found\n</code></pre>\n\n<p>obviously primitive is not a command the terminal recognizes, but as I just installed GO today for the sole use of Primitive, I am wondering what I might be missing?</p>\n"}, {"tags": ["go", "timer", "transactions"], "comments": [{"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 2, "creation_date": 1487654883, "post_id": 42359053, "comment_id": 71869069, "body": "As of 1.8 <a href=\"https://golang.org/pkg/database/sql/#DB.BeginTx0Z\" rel=\"nofollow noreferrer\"><code>database&#47;sql</code></a> supports the use of a context. I imagine this could simplify your decision."}], "answers": [{"comments": [{"owner": {"reputation": 16626, "user_id": 2694184, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/ebdf34f5c572d4a25df713ac80228328?s=128&d=identicon&r=PG&f=1", "display_name": "Gibbs", "link": "https://stackoverflow.com/users/2694184/gibbs"}, "edited": false, "score": 0, "creation_date": 1605026318, "post_id": 42362135, "comment_id": 114524330, "body": "I am trying to understand which one should be used for my use-case. I am coming across most of your good posts. Would you please explain <code>to signal cancelation to arbitrary number of goroutines and places</code> ? In what scenario, an application will have many Goroutines? any simple example?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 16626, "user_id": 2694184, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/ebdf34f5c572d4a25df713ac80228328?s=128&d=identicon&r=PG&f=1", "display_name": "Gibbs", "link": "https://stackoverflow.com/users/2694184/gibbs"}, "edited": false, "score": 1, "creation_date": 1605027748, "post_id": 42362135, "comment_id": 114525012, "body": "@Gibbs A simple example: you have an HTTP handler which does its work in its goroutine. It may perform logging to database, and it may do so concurrently in a separate goroutine. That separate goroutine may use / monitor the request&#39;s context if it needs to abort its work."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 11, "last_activity_date": 1550668455, "last_edit_date": 1550668455, "creation_date": 1487665593, "answer_id": 42362135, "question_id": 42359053, "link": "https://stackoverflow.com/questions/42359053/how-to-decide-between-a-context-withdeadline-or-a-simple-timer/42362135#42362135", "title": "How to decide between a context.WithDeadline or a simple timer?", "body": "<p>The answer lies in how the <a href=\"https://golang.org/pkg/context/#Context\" rel=\"noreferrer\"><code>context.Context</code></a> and the <a href=\"https://golang.org/pkg/time/#Timer\" rel=\"noreferrer\"><code>time.Timer</code></a> deliver the (cancel) signal.</p>\n\n<p><code>context.Context</code> gives you access to a channel via the <code>Context.Done()</code> method <strong>which will be closed</strong> when the goroutines using it should terminate.</p>\n\n<p><code>time.Timer</code> gives you access to a channel in the <code>Timer.C</code> struct field <strong>on which a value will be sent</strong> after the given time period (that value will be the current time, but not important here).</p>\n\n<p>There, the key points are highlighted. The channel close may be observed by any number of goroutines, and infinite number of times. <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"noreferrer\">Spec: Receive operator:</a></p>\n\n<blockquote>\n  <p>A receive operation on a <a href=\"https://golang.org/ref/spec#Close\" rel=\"noreferrer\">closed</a> channel can always proceed immediately, yielding the element type's <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero value</a> after any previously sent values have been received.</p>\n</blockquote>\n\n<p>So a <code>Context</code> may be used to signal cancelation to arbitrary number of goroutines and places. A <code>Timer</code> can only be used to signal one target, the one who receives the value from its channel. If multiple clients are listening or trying to receive from its channel, only one will be lucky to receive it.</p>\n\n<p>Also if you're using / working with code that already supports / expects <code>context.Context</code>, then it ins't a question which one to use. Go 1.8 also added <a href=\"https://golang.org/doc/go1.8#more_context\" rel=\"noreferrer\">more context support</a>. There have been <a href=\"https://golang.org/doc/go1.8#database_sql\" rel=\"noreferrer\">significant additions</a> to the <a href=\"https://golang.org/pkg/database/sql/\" rel=\"noreferrer\"><code>database/sql</code></a> package with context support; including <a href=\"https://golang.org/pkg/database/sql/#DB.BeginTx\" rel=\"noreferrer\"><code>DB.BeginTx()</code></a>:</p>\n\n<blockquote>\n  <p>The provided context is used until the transaction is committed or rolled back. If the context is canceled, the sql package will roll back the transaction. Tx.Commit will return an error if the context provided to BeginTx is canceled.</p>\n</blockquote>\n\n<p>This is the primary use of <code>context.Context</code>: to carry a deadline and signal cancelation across API boundaries, and it's done in a concurrent-safe manner (as <code>Context</code> values are immutable, and channels are also safe for concurrent use, data races cannot occur, by design; more on this: <a href=\"https://stackoverflow.com/questions/34039229/if-i-am-using-channels-properly-should-i-need-to-use-mutexes/34039377#34039377\">If I am using channels properly should I need to use mutexes?</a>).</p>\n\n<p>Related blog posts:</p>\n\n<p><a href=\"https://blog.golang.org/context\" rel=\"noreferrer\">The Go Blog: Go Concurrency Patterns: Context</a></p>\n\n<p><a href=\"https://www.calhoun.io/pitfalls-of-context-values-and-how-to-avoid-or-mitigate-them/\" rel=\"noreferrer\">Pitfalls of context values and how to avoid or mitigate them in Go</a></p>\n\n<p><a href=\"https://dave.cheney.net/2017/01/26/context-is-for-cancelation\" rel=\"noreferrer\">Dave Cheney: Context is for cancelation</a></p>\n"}], "owner": {"reputation": 1993, "user_id": 2044035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IKkGD.png?s=128&g=1", "display_name": "Matheus Felipe", "link": "https://stackoverflow.com/users/2044035/matheus-felipe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1664, "favorite_count": 3, "accepted_answer_id": 42362135, "answer_count": 1, "score": 11, "last_activity_date": 1550668455, "creation_date": 1487653147, "last_edit_date": 1530012076, "question_id": 42359053, "link": "https://stackoverflow.com/questions/42359053/how-to-decide-between-a-context-withdeadline-or-a-simple-timer", "title": "How to decide between a context.WithDeadline or a simple timer?", "body": "<p>In Golang, I am fairly new to the <em>intentions</em> of passing <code>contexts</code> downstream to other methods and functions. I understand how a <code>context</code> works, how it is used, how it holds its values, how it's related to the parent <code>context</code> and their behaviors -- I just don't understand <em>why</em> to use a context in the first place.</p>\n\n<p>In a more specific example, which is the actual reason of this question, in the company I work for, we have identified some very long-running queries that happen every so often due to an edge case.</p>\n\n<p>An obvious solution we decided to take, given our constraints until we invest time to fix the root cause, is to kill the queries that take more than 5 minutes.</p>\n\n<p>The method that runs our transactions accepts a <code>context</code> which is originally initiated in the API call. This <code>context</code> is passed down all the way to the transaction function. At that moment I found 2 solutions to kill that query:</p>\n\n<p>1) Using a new context:</p>\n\n<ul>\n<li><p>Initiate a new <code>context.WithTimeout(ctx, time.Duration( 5 * time.Minute) )</code></p></li>\n<li><p>Watch the <code>Done</code> channel in a <code>go routine</code> and kill the transaction when there's a signal there</p></li>\n<li>If the transaction finished successfully in a timely manner, just <code>cancel</code> the context and commit the transaction as expected.</li>\n</ul>\n\n<p>2) Using a <code>Timer</code>:</p>\n\n<ul>\n<li>Create a <code>Timer</code> with 5 minutes duration</li>\n<li>If the time is over, kill the transaction</li>\n<li>Else, commit the transaction.</li>\n</ul>\n\n<p>Logically speaking, they are the same solution, however, when and how to decide whether to use a <code>context</code> with a set Deadline or a good old <code>Timer</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 2, "creation_date": 1487648354, "post_id": 42358000, "comment_id": 71867113, "body": "have you read <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/2</a> ?"}, {"owner": {"reputation": 3315, "user_id": 1664109, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/JAlH9.jpg?s=128&g=1", "display_name": "RockOnGom", "link": "https://stackoverflow.com/users/1664109/rockongom"}, "edited": false, "score": 0, "creation_date": 1487657620, "post_id": 42358000, "comment_id": 71870193, "body": "What is c variable that you passed to l function, before you fix the problem you should learn naming conventions."}, {"owner": {"reputation": 203, "user_id": 7572938, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cfc24822ee199aa06fc0a6ee43159579?s=128&d=identicon&r=PG&f=1", "display_name": "fisafoer", "link": "https://stackoverflow.com/users/7572938/fisafoer"}, "edited": false, "score": 0, "creation_date": 1487743896, "post_id": 42358000, "comment_id": 71916409, "body": "Thank you good reminder, i really should use a good naming conventions.c just is a unbuffered channel"}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 3, "last_activity_date": 1487648417, "creation_date": 1487648417, "answer_id": 42358224, "question_id": 42358000, "link": "https://stackoverflow.com/questions/42358000/why-sending-data-to-no-buffered-chan-will-block-the-go-routine/42358224#42358224", "title": "Why sending data to no buffered chan will block the go routine", "body": "<p>You don't show the creation of the channel so I'm assuming it's unbuffered. An unbuffered channel can't hold onto any items, so the sender blocks until the item is received. If you create a buffered channel with a buffer size of <em>n</em>, a send operation won't block unless there are <em>n</em> items in the channel that haven't been received yet. To create a buffered channel, pass the buffer size to <code>make</code> as follows:</p>\n\n<pre><code>c := make(chan int, 10)\n</code></pre>\n\n<p>See <a href=\"https://golang.org/doc/effective_go.html#channels\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#channels</a> for more information.</p>\n"}], "owner": {"reputation": 203, "user_id": 7572938, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/cfc24822ee199aa06fc0a6ee43159579?s=128&d=identicon&r=PG&f=1", "display_name": "fisafoer", "link": "https://stackoverflow.com/users/7572938/fisafoer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 42358224, "answer_count": 1, "score": -2, "last_activity_date": 1487744584, "creation_date": 1487647015, "last_edit_date": 1487744584, "question_id": 42358000, "link": "https://stackoverflow.com/questions/42358000/why-sending-data-to-no-buffered-chan-will-block-the-go-routine", "title": "Why sending data to no buffered chan will block the go routine", "body": "<p>when you run follow code:</p>\n\n<pre><code>func l(ch chan int)  {\n    println(\"l being\")\n    ch&lt;-1\n\n    println(\"l after write\")\n    time.Sleep(time.Second*1)\n    println(\"l goroutine down\")\n}\n\nfunc main() {\n    c := make(chan int)\n    go l(c)\n    println(\"main\")\n\n    time.Sleep(time.Second*9)\n   println(\"main down\")\n}\n</code></pre>\n\n<p>you will get follow result </p>\n\n<pre><code>main\nl being\nmain down\n</code></pre>\n\n<p>It mean's that sending data to chan will block the current go routine, i am surprised of this behaviour. i know read data from chan will block go routine, and it is easy understand. but sending data to chan block go routine, i don't think it is good enough, any guys can tell me why Go-Lang have this design to help me understand? thank you so much:)</p>\n"}, {"tags": ["windows", "go", "system-calls"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1487651120, "last_edit_date": 1487651120, "creation_date": 1487650810, "answer_id": 42358627, "question_id": 42357652, "link": "https://stackoverflow.com/questions/42357652/syscall-how-to-use-lpwstr-in-go/42358627#42358627", "title": "syscall - How to use LPWSTR in Go?", "body": "<p>The first thing to do is read the documentation for the Windows function.</p>\n\n<blockquote>\n  <p><a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd371407(v=vs.85).aspx\" rel=\"nofollow noreferrer\">IMMDevice::GetId\n  method</a>,</p>\n\n<pre><code>HRESULT GetId(\n    [out] LPWSTR *ppstrId\n);\n</code></pre>\n  \n  <p>Parameters</p>\n  \n  <p><code>ppstrId</code> [out]</p>\n  \n  <p>Pointer to a pointer variable into which the method writes the address\n  of a null-terminated, wide-character string containing the endpoint\n  device ID. The method allocates the storage for the string. The caller\n  is responsible for freeing the storage, when it is no longer needed,\n  by calling the CoTaskMemFree function. If the GetId call fails,\n  *ppstrId is NULL. For information about CoTaskMemFree, see the Windows SDK documentation.</p>\n  \n  <p>Return value</p>\n  \n  <p>If the method succeeds, it returns S_OK. If it fails, possible return\n  codes include, but are not limited to, the values shown in the\n  following table.</p>\n</blockquote>\n\n<p>In particular, \"ppstrId [out] Pointer to a pointer variable ...\" You have <code>strId *uint16</code> or <code>*pstrId</code> when I would expect you to have <code>strId **uint16</code> or <code>*ppstrId</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 4364857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50f214ff42cf3c1b39d2d60ab77cbcd5?s=128&d=identicon&r=PG", "display_name": "moutend", "link": "https://stackoverflow.com/users/4364857/moutend"}, "edited": false, "score": 0, "creation_date": 1487807643, "post_id": 42358642, "comment_id": 71955939, "body": "The cause of confusion was my misunderstanding about a pointer value. Thank you for helpful answer."}], "tags": [], "owner": {"reputation": 82917, "user_id": 3501, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/1fd5f5cc203c393634379a3b3b7e7a87?s=128&d=identicon&r=PG", "display_name": "Anders", "link": "https://stackoverflow.com/users/3501/anders"}, "is_accepted": true, "score": 1, "last_activity_date": 1487650880, "creation_date": 1487650880, "answer_id": 42358642, "question_id": 42357652, "link": "https://stackoverflow.com/questions/42357652/syscall-how-to-use-lpwstr-in-go/42358642#42358642", "title": "syscall - How to use LPWSTR in Go?", "body": "<p>It is a pointer to a pointer. The LPWSTR type is a <code>wchar_t*</code> and therefor the parameter in that method is a <code>wchar_t**</code>.</p>\n\n<p>You are not passing in a string buffer for the method to fill. The method will allocate memory with <code>CoTaskMemAlloc</code> and return this memory address back to you after it has been filled. You are responsible for freeing this memory with <code>CoTaskMemAlloc</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 4364857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50f214ff42cf3c1b39d2d60ab77cbcd5?s=128&d=identicon&r=PG", "display_name": "moutend", "link": "https://stackoverflow.com/users/4364857/moutend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 458, "favorite_count": 1, "accepted_answer_id": 42358642, "answer_count": 2, "score": 0, "last_activity_date": 1487651120, "creation_date": 1487644363, "question_id": 42357652, "link": "https://stackoverflow.com/questions/42357652/syscall-how-to-use-lpwstr-in-go", "title": "syscall - How to use LPWSTR in Go?", "body": "<p>I'm trying to create a thin wrapper of Windows MMDevice API for Go, and I faced the problem about Windows data types for strings.\nAccording to the documentation of <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/dd371407(v=vs.85).aspx\" rel=\"nofollow noreferrer\">IMMDevice::GetId method</a>, it takes the parameter below:</p>\n\n<pre><code>HRESULT GetId(\n    [out] LPWSTR *ppstrId\n);\n</code></pre>\n\n<p>And here is my Go code that corresponds to the method above. (<a href=\"https://github.com/moutend/ywca\" rel=\"nofollow noreferrer\">github.com/moutend/ywca/immdevice_windows.go:13</a>)</p>\n\n<pre><code>func getId(mmd *IMMDevice, strId *uint16) (err error) {\n    hr, _, _ := syscall.Syscall(\n        mmd.VTable().GetId,\n        2,\n        uintptr(unsafe.Pointer(mmd)),\n        uintptr(unsafe.Pointer(strId)),\n        0)\n    // ...\n}\n</code></pre>\n\n<p>My understand is that the LPWSTR is the pointer to the array of uint16 values, but it causes invalid pointer error.\nWhat type should I use in this case? Thanks.</p>\n"}, {"tags": ["go", "hugo"], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1487683864, "post_id": 42365070, "comment_id": 71887004, "body": "Ahh, so that&#39;s what they meant with those sections, I thought it was related to something completely different.. thanks a lot! I think those sections would become a lot more clear/easier to understand if it was better highlighted that it was related to changing the content of specific .md files/content folders"}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1487686284, "post_id": 42365070, "comment_id": 71888734, "body": "Hmm, maybe I&#39;m misunderstanding.. but is it not possible to use this method with list.html? I tried creating the blog-folder-2 inside the layouts folder and placed a list.html file.. but it seems like it&#39;s being ignored?"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1487687352, "post_id": 42365070, "comment_id": 71889523, "body": "It is to do that you need to range like that: ` {{ range $i, $p := (.Paginate (where .Data.Pages &quot;Section&quot; &quot;!=&quot; &quot;blog-folder-2&quot;)).Pages  }}"}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1487688851, "post_id": 42365070, "comment_id": 71890732, "body": "Hmm, feel quite confused.. if I want all the content folders (x.com/, x.com/blog-folder-1/, and x.com/blog-folder-2/) to have their unique list.html file, then all the rules should be defined inside the layouts/_default/list.html file? or should I also create list.html files in the layouts/blog-folder-1/list.html and layouts/blog-folder-2/list.html folders?"}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1487688933, "post_id": 42365070, "comment_id": 71890803, "body": "For instance, in _defaults/list.html I have {{ range $index, $page := first 50 (where .Site.Pages.ByPublishDate &quot;.Params.displayHomepage&quot; &quot;true&quot;) }}, in blog-folder-1/list.html I have {{ range $index, $page := first 50 (where .Site.Pages.ByPublishDate &quot;.Params.displayBlog1&quot; &quot;true&quot;) }}, etc..? To me this makes sense, but it doesn&#39;t seem to be working.. so I&#39;m thinking everything need to be written inside the _defaults/list.html file which makes it really complicated.."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1487694299, "post_id": 42365070, "comment_id": 71894946, "body": "Okay, I figured it out.. it seems that instead of creating the file: layouts/blog-folder-1/list.html then instead I should create the file layouts/section/blog-folder-1.html... a little confused why they choose to do it that way but it works.. thanks again for everything :)"}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 1, "last_activity_date": 1487687461, "last_edit_date": 1487687461, "creation_date": 1487673732, "answer_id": 42365070, "question_id": 42357204, "link": "https://stackoverflow.com/questions/42357204/hugo-go-static-site-generator-list-for-specific-urls/42365070#42365070", "title": "Hugo (go static site generator) list for specific URLs", "body": "<p>At this point the documentation is a little bit hard to order. I am going to link the important topics to the hugo documentation so that you are able to read more details. After looking to your <a href=\"http://gohugo.io/content/organization/\" rel=\"nofollow noreferrer\">Content Organisation</a> there are two <a href=\"http://gohugo.io/content/sections/\" rel=\"nofollow noreferrer\">Sections</a>:</p>\n\n<ul>\n<li>blog-folder-1</li>\n<li>blog-folder-2</li>\n</ul>\n\n<p>So inside your theme you are able to <a href=\"http://gohugo.io/templates/content/\" rel=\"nofollow noreferrer\">define one template for each section</a>. If there is no template provided hugo uses the default.</p>\n\n<p>So inside your layouts folder there is that logic: <code>/layouts/SECTION/LAYOUT.html</code></p>\n\n<p>For your case you can define a default layout. When for example blog-folder-2 needs another template your structure would look like this:</p>\n\n<pre><code>layouts/\n  \u25be _default/\n      single.html\n  \u25be blog-folder-2/\n      single.html\n</code></pre>\n\n<p>If you want to filter out one section inside a list, you need to use the <a href=\"http://gohugo.io/templates/variables/\" rel=\"nofollow noreferrer\">page variables</a>. </p>\n\n<p>At that points where you are ranging over the sites you can add a where clause:</p>\n\n<pre><code> {{ range $i, $p := (.Paginate (where .Data.Pages \"Section\" \"!=\" \"blog-folder-2\")).Pages }}\n</code></pre>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 568, "favorite_count": 0, "accepted_answer_id": 42365070, "answer_count": 1, "score": 0, "last_activity_date": 1487687461, "creation_date": 1487641194, "question_id": 42357204, "link": "https://stackoverflow.com/questions/42357204/hugo-go-static-site-generator-list-for-specific-urls", "title": "Hugo (go static site generator) list for specific URLs", "body": "<p>let's say I have the following structure</p>\n\n<pre><code>content\n- blog-folder-1\n-- blog-article-1-1.md\n-- blog-article-1-2.md\n- blog-folder-2\n-- blog-article-2-1.md\n-- blog-article-2-2.md\n</code></pre>\n\n<p>Then I also have the <code>layouts/_default/list.html</code> file which will be called every time I visit the URLs <code>example.com/</code>, <code>example.com/blog-topic-1/</code>, and <code>example.com/blod-topic-2/</code></p>\n\n<p>So the problem I have is that I don't want the <code>layouts/_default/list.html</code> file to generate the same content for these different paths..</p>\n\n<p>I overcame the problem of only displaying certain articles in the homepage by adding <code>++ displayHomepage = \"true\" ++</code>  to the .md files and <code>{{ range $index, $page := first 50 (where .Site.Pages.ByPublishDate \".Params.displayHomepage\" \"true\") }}</code> to the <code>list.html</code> file, but I can't figure out what to do if I don't want to display <code>blog-article-2-1.md</code> when visiting <code>example.com/blog-folder-1/</code></p>\n\n<p>Any help would be greatly appreciated &lt;3</p>\n"}, {"tags": ["generics", "go", "struct"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 3, "creation_date": 1487641882, "post_id": 42357132, "comment_id": 71865371, "body": "<code>struct{}</code> is just an empty struct. Maybe the closest thing what you want is  <code>interface{}</code>. However, you cannot cast <code>[]Request</code> to <code>[]interface{}</code>. <a href=\"http://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go/12754757\" title=\"type converting slices of interfaces in go\">stackoverflow.com/questions/12753805/&hellip;</a>"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1487642555, "post_id": 42357132, "comment_id": 71865558, "body": "However, in general, using something like <code>func(interface{}) interface{}</code> is not a good idea since you can pass anything, which means it would  not be type safe."}, {"owner": {"reputation": 27, "user_id": 4962807, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TGyeLAHUxKo/AAAAAAAAAAI/AAAAAAAAAXM/Zl6jC3qxNyY/photo.jpg?sz=128", "display_name": "Elliot Laurendeau", "link": "https://stackoverflow.com/users/4962807/elliot-laurendeau"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1487649131, "post_id": 42357132, "comment_id": 71867304, "body": "So how would you suggest proceeding? Create some kind of abstract structure that everything inherit from and keep some kind of type constant in it? I feel like strict typing of channels is reducing the possibilities. I come from a Scala akka actor background and i might not be using the channels the way i should be."}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1487649644, "post_id": 42357132, "comment_id": 71867421, "body": "You can define interface, and make those structures implement that interface. Using golang as dynamic type language would be a pain job."}], "owner": {"reputation": 27, "user_id": 4962807, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-TGyeLAHUxKo/AAAAAAAAAAI/AAAAAAAAAXM/Zl6jC3qxNyY/photo.jpg?sz=128", "display_name": "Elliot Laurendeau", "link": "https://stackoverflow.com/users/4962807/elliot-laurendeau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3328, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1487679899, "creation_date": 1487640586, "last_edit_date": 1487679899, "question_id": 42357132, "link": "https://stackoverflow.com/questions/42357132/cannot-use-literal-type-as-type-struct-in-append", "title": "cannot use **** literal (type ****) as type struct {} in append", "body": "<p>I'm trying to build a system using the fan-out / fan-in design to call multiple rest API.</p>\n\n<p>My fan out would receive a list of users.\nForeach user, execute an other time the fan-out to create multiple http get and then aggregate the data in that user.</p>\n\n<p>This is my fan out method.</p>\n\n<p><strong>in &lt;- chan struct{}</strong> is my channel with the user information</p>\n\n<p><strong>f func(struct{}) struct{}</strong> is the method that will take a user as a parameter, call an other instance of my fan out, merge the data in the user and then return the aggregated user</p>\n\n<p><strong>&lt;- chan struct{}</strong> is the new channel with the result</p>\n\n<pre><code>func split(in &lt;- chan struct{}, f func(struct{}) struct{}) &lt;- chan struct{} {\n    out := make(chan struct{})\n\n    go func() {\n        for data := range in {\n            out &lt;- f(data)\n        }\n\n        close(out)\n    }()\n\n    return out\n}\n</code></pre>\n\n<p>The merge method is used to take multiple channel and merge them to a single channel</p>\n\n<pre><code>func merge(in  ...&lt;- chan struct{}) &lt;- chan struct{} {\n    out := make(chan struct{})\n    var wg sync.WaitGroup\n\n    output := func(channel &lt;- chan struct{}) () {\n        for data := range channel {\n            out &lt;- data\n        }\n\n        wg.Done()\n    }\n\n    for _, channel := range in {\n        go output(channel)\n    }\n\n    go func() {\n        wg.Wait()\n        close(out)\n    }()\n\n    wg.Add(len(in))\n\n    return out\n}\n</code></pre>\n\n<p>Process method used to create a fan-out / fan-in system</p>\n\n<pre><code>func Process(dataSlice []struct{}, f func(struct{}) struct{}) &lt;-chan struct{} {\n\n    in := groupData(dataSlice) // this method is simply taking a slice of struct and returning a channel of struct with the values inside\n\n    out1 := split(in, f)\n    out2 := split(in, f)\n    out3 := split(in, f)\n\n    return merge(out1, out2, out3)\n}\n</code></pre>\n\n<p>Finally the method calling this thing out</p>\n\n<pre><code>type Request struct {\n    Name string\n}\n\ntype Response struct {\n    Name string\n    Age int\n}\n\nfunc main() {\n\n    users := make([]Request, 0)\n\n    users = append(users, Request{Name: \"A\"})\n    users = append(users, Request{Name: \"B\"})\n    users = append(users, Request{Name: \"C\"})\n    users = append(users, Request{Name: \"D\"})\n\n    for data := range parallel.Process(users, apply) {\n        fmt.Println(data)\n    }\n\n}\n\nfunc apply(request Request) Response {\n    return Response{request.Name, 1}\n}\n</code></pre>\n\n<p>So my apply method is really small here. In reality i am calling the process method again to split my rest api call in multiple channels and retrieve all of the information for that request. My response struct would depend on the api i called.</p>\n\n<p>I'm getting the following errors.</p>\n\n<ul>\n<li>cannot use users (type []Request) as type []struct {} in argument to\nparallel.Process</li>\n<li>cannot use apply (type func(Request) struct {}) as type\nparallel.ProcessData in argument to parallel.Process</li>\n<li>cannot use Response literal (type Response) as type struct {} in\nreturn argument</li>\n</ul>\n\n<p>So basically i can't make a method that accepts any struct or some sort of interface of a request.</p>\n\n<p>Thanks :)</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Using interface{} and the reflect lib i managed to get this piece of code working.</p>\n\n<pre><code>func apply(request interface{}) interface{} {\n\n    if(reflect.TypeOf(request).Name() != reflect.TypeOf(Request{}).Name()) {\n        panic(\"invalid request type\")\n    }\n\n    value := reflect.ValueOf(request)\n    typedRequest := value.Interface().(Request)\n\n\n    return Response{Name: typedRequest.Name, Age: rand.Intn(100)}\n}\n</code></pre>\n\n<p>This feels wrong.</p>\n\n<p>Since there is no generic type, are we supposed to re implement the same method multiple time for each type we want to use? \nWhat would be the suggested approach to solve in a proper way?</p>\n"}, {"tags": ["pdf", "go", "gzip", "zlib"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1487668840, "post_id": 42355485, "comment_id": 71876329, "body": "Are you sure vim displayed you and copied the correct bytes? You should take the data from a hex editor (e.g. check <a href=\"https://github.com/evanmiller/hecate\" rel=\"nofollow noreferrer\">hecate</a>)."}, {"owner": {"reputation": 3894, "user_id": 191347, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7226597774ed3751d939858a9affbd68?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/191347/justin"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1487702193, "post_id": 42355485, "comment_id": 71899788, "body": "@icza - If you wanna post that as an answer, I&#39;ll give you the credit =)"}], "answers": [{"tags": [], "owner": {"reputation": 3894, "user_id": 191347, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7226597774ed3751d939858a9affbd68?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/191347/justin"}, "is_accepted": false, "score": 1, "last_activity_date": 1487702082, "creation_date": 1487702082, "answer_id": 42375272, "question_id": 42355485, "link": "https://stackoverflow.com/questions/42355485/how-to-decompress-deflate-pdf-stream/42375272#42375272", "title": "How to decompress/deflate PDF Stream", "body": "<p>Okay, confession time...</p>\n\n<p>I was so caught up in trying to understand deflate that I completely overlooked the fact that Vim wasn't saving the stream contents correctly into new files. So I spent quite a bit of time reading the RFC's, and digging through the internals of the Go <code>compress/...</code> packages, assuming the problem was with my code.</p>\n\n<p>Shortly after I posted my question I tried reading the PDF as a whole, finding the <code>stream</code>/<code>endstream</code> locations, and pushing that through deflate. As soon as I saw the content scroll through the screen I realized my dumb mistake.</p>\n\n<p>+1 @icza, that was exactly my issue.</p>\n\n<p><em>It was good in then end, as I have a much better understanding of the whole process than if it would have just worked the first go around.</em></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1487738529, "last_edit_date": 1487738529, "creation_date": 1487708629, "answer_id": 42377224, "question_id": 42355485, "link": "https://stackoverflow.com/questions/42355485/how-to-decompress-deflate-pdf-stream/42377224#42377224", "title": "How to decompress/deflate PDF Stream", "body": "<p>Binary data should <em>never</em> be copied out of / saved from text editors. There might be cases when this succeeds, and it just adds oil to the flame.</p>\n\n<p>Your data that you eventually \"mined out\" from the PDF is most likely not identical to the actual data that <em>is</em> in the PDF. You should take the data from a hex editor (e.g. try <a href=\"https://github.com/evanmiller/hecate\" rel=\"nofollow noreferrer\">hecate</a> for something new), or write a simple app that saves it (which strictly handles the file as binary).</p>\n\n<p>Hint #1:</p>\n\n<p>The binary data displayed spread across multiple lines. Binary data does not contain carriage returns, that's a textual control. If it does, that means the editor <em>did</em> interpret it as text, and so some codes / characters where \"consumed\" to start a new line. Multiple sequences may be interpreted as the same newline (e.g. <code>\\n</code>, <code>\\r\\n</code>). By excluding them, you're already at data loss, by including them, you might already have a different sequence. And if the data was  interpreted and displayed as text, more problems may arise as there are more control characters, and some characters may not appear when displayed.</p>\n\n<p>Hint #2:</p>\n\n<p>When <code>flateReaderFn</code> is used, decoding the 2nd example succeeds (completes without an error). This means \"you were barking up the right tree\", but the success depends on what the actual data is and to what extent was it \"distorted\" by the text editor.</p>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 5564371, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-TvpjJBB2yGs/AAAAAAAAAAI/AAAAAAAABHw/t5i4BLD_bGk/photo.jpg?sz=128", "display_name": "Gunnsteinn Hall", "link": "https://stackoverflow.com/users/5564371/gunnsteinn-hall"}, "is_accepted": false, "score": 0, "last_activity_date": 1618776247, "last_edit_date": 1618776247, "creation_date": 1618675871, "answer_id": 67140252, "question_id": 42355485, "link": "https://stackoverflow.com/questions/42355485/how-to-decompress-deflate-pdf-stream/67140252#67140252", "title": "How to decompress/deflate PDF Stream", "body": "<p>Extracting objects from PDF can be tricky depending on the filters used. The filter can also have additional options which need to be handled correctly.</p>\n<p>For someone interested in extracting an object without taking care of the low-level details of the process.</p>\n<p>To get a single object from a PDF and decode it can be done as follows:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;os&quot;\n    &quot;strconv&quot;\n\n    &quot;github.com/unidoc/unipdf/v3/core&quot;\n    &quot;github.com/unidoc/unipdf/v3/model&quot;\n)\n\n\nfunc main() {\n    objNum := 149 // Get object 149\n    err := inspectPdfObject(&quot;input.pdf&quot;, objNum)\n    if err != nil {\n        fmt.Printf(&quot;Error: %v\\n&quot;, err)\n        os.Exit(1)\n    }\n}\n\nfunc inspectPdfObject(inputPath string, objNum int) error {\n    f, err := os.Open(inputPath)\n    if err != nil {\n        return err\n    }\n\n    defer f.Close()\n\n    pdfReader, err := model.NewPdfReader(f)\n    if err != nil {\n        return err\n    }\n\n    isEncrypted, err := pdfReader.IsEncrypted()\n    if err != nil {\n        return err\n    }\n\n    if isEncrypted {\n        // If encrypted, try decrypting with an empty one.\n        // Can also specify a user/owner password here by modifying the line below.\n        auth, err := pdfReader.Decrypt([]byte(&quot;&quot;))\n        if err != nil {\n            fmt.Printf(&quot;Decryption error: %v\\n&quot;, err)\n            return err\n        }\n        if !auth {\n            fmt.Println(&quot; This file is encrypted with opening password. Modify the code to specify the password.&quot;)\n            return nil\n        }\n    }\n\n    obj, err := pdfReader.GetIndirectObjectByNumber(objNum)\n    if err != nil {\n        return err\n    }\n\n    fmt.Printf(&quot;Object %d: %s\\n&quot;, objNum, obj.String())\n\n    if stream, is := obj.(*core.PdfObjectStream); is {\n        decoded, err := core.DecodeStream(stream)\n        if err != nil {\n            return err\n        }\n        fmt.Printf(&quot;Decoded:\\n%s&quot;, decoded)\n    } else if indObj, is := obj.(*core.PdfIndirectObject); is {\n        fmt.Printf(&quot;%T\\n&quot;, indObj.PdfObject)\n        fmt.Printf(&quot;%s\\n&quot;, indObj.PdfObject.String())\n    }\n\n    return nil\n}\n</code></pre>\n<p>A full example: <a href=\"https://github.com/unidoc/unipdf-examples/blob/master/analysis/pdf_get_object.go\" rel=\"nofollow noreferrer\">pdf_get_object.go</a></p>\n<p><strong>Disclosure</strong>: I am the original developer of UniPDF.</p>\n"}], "owner": {"reputation": 3894, "user_id": 191347, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7226597774ed3751d939858a9affbd68?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/191347/justin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6726, "favorite_count": 3, "accepted_answer_id": 42377224, "answer_count": 3, "score": 4, "last_activity_date": 1618776247, "creation_date": 1487630272, "question_id": 42355485, "link": "https://stackoverflow.com/questions/42355485/how-to-decompress-deflate-pdf-stream", "title": "How to decompress/deflate PDF Stream", "body": "<p>Working with the <code>2016-W4 pdf</code>, which has 2 large streams <em>(page 1 &amp; 2)</em>, along with a bunch of other objects and smaller streams. I'm trying to deflate the stream(s), to work with the source data, but am struggling. I'm only able to get corrupt inputs and invalid checksums errors.  </p>\n\n<p>I've written a test script to help debug, and have pulled out smaller streams from the file to test with.</p>\n\n<p>Here are 2 streams from the original pdf, along with their length objects:</p>\n\n<p><strong>stream 1</strong>:</p>\n\n<pre><code>149 0 obj\n&lt;&lt; /Length 150 0 R /Filter /FlateDecode /Type /XObject /Subtype /Form /FormType\n1 /BBox [0 0 8 8] /Resources 151 0 R &gt;&gt;\nstream\nx+TT(T0B\u000b ,JUW\u00c8S0\u00d037\u00b1402V(NFJS\u00fe\u00b6\n\u00ab\nendstream\nendobj\n150 0 obj\n42\nendobj\n</code></pre>\n\n<p><strong><em>stream 2</em></strong></p>\n\n<pre><code>142 0 obj\n&lt;&lt; /Length 143 0 R /Filter /FlateDecode /Type /XObject /Subtype /Form /FormType\n1 /BBox [0 0 0 0] /Resources 144 0 R &gt;&gt;\nstream\nx+T\u00e7\u00e3\nendstream\nendobj\n143 0 obj\n11\nendobj\n</code></pre>\n\n<p>I copied just the <code>stream</code> contents into new files within Vim <em>(excluding the carriage returns after <code>stream</code> and before <code>endstream</code>)</em>.</p>\n\n<p>I've tried both:</p>\n\n<ul>\n<li><code>compress/flate</code> <em>(<a href=\"https://tools.ietf.org/html/rfc1951\" rel=\"nofollow noreferrer\">rfc-1951</a>) \u2013 (removing the first 2 bytes (<code>CMF</code>, <code>FLG</code>))</em></li>\n<li><code>compress/zlib</code> <em>(<a href=\"https://tools.ietf.org/html/rfc1950\" rel=\"nofollow noreferrer\">rfc-1950</a>)</em></li>\n</ul>\n\n<p>I've converted the streams to <code>[]byte</code> for the below:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"compress/flate\"\n    \"compress/gzip\"\n    \"compress/zlib\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nvar (\n    flateReaderFn = func(r io.Reader) (io.ReadCloser, error) { return flate.NewReader(r), nil }\n    zlibReaderFn  = func(r io.Reader) (io.ReadCloser, error) { return zlib.NewReader(r) }\n)\n\nfunc deflate(b []byte, skip, length int, newReader func(io.Reader) (io.ReadCloser, error)) {\n    // rfc-1950\n    // --------\n    //   First 2 bytes\n    //   [120, 1] - CMF, FLG\n    //\n    //   CMF: 120\n    //     0111 1000\n    //     \u2191    \u2191\n    //     |    CM(8) = deflate compression method\n    //     CINFO(7)   = 32k LZ77 window size\n    //\n    //   FLG: 1\n    //     0001 \u2190 FCHECK\n    //            (CMF*256 + FLG) % 31 == 0\n    //             120 * 256 + 1 = 30721\n    //                             30721 % 31 == 0\n\n    stream := bytes.NewReader(b[skip:length])\n    r, err := newReader(stream)\n    if err != nil {\n        fmt.Println(\"\\nfailed to create reader,\", err)\n        return\n    }\n\n    n, err := io.Copy(os.Stdout, r)\n    if err != nil {\n        if n &gt; 0 {\n            fmt.Print(\"\\n\")\n        }\n        fmt.Println(\"\\nfailed to write contents from reader,\", err)\n        return\n    }\n    fmt.Printf(\"%d bytes written\\n\", n)\n    r.Close()\n}\n\nfunc main() {\n    //readerFn, skip := flateReaderFn, 2 // compress/flate RFC-1951, ignore first 2 bytes\n    readerFn, skip := zlibReaderFn, 0 // compress/zlib RFC-1950, ignore nothing\n\n    //                                                                                                \u2939 This is where the error occurs: `flate: corrupt input before offset 19`.\n    stream1 := []byte{120, 1, 43, 84, 8, 84, 40, 84, 48, 0, 66, 11, 32, 44, 74, 85, 8, 87, 195, 136, 83, 48, 195, 144, 51, 55, 194, 177, 52, 48, 50, 86, 40, 78, 70, 194, 150, 74, 83, 8, 4, 0, 195, 190, 194, 182, 10, 194, 171, 10}\n    stream2 := []byte{120, 1, 43, 84, 8, 4, 0, 1, 195, 167, 0, 195, 163, 10}\n\n    fmt.Println(\"----------------------------------------\\nStream 1:\")\n    deflate(stream1, skip, 42, readerFn) // flate: corrupt input before offset 19\n\n    fmt.Println(\"----------------------------------------\\nStream 2:\")\n    deflate(stream2, skip, 11, readerFn) // invalid checksum\n}\n</code></pre>\n\n<p>I'm sure I'm doing something wrong somewhere, I just can't quite see it.</p>\n\n<p><em>(The pdf does open in a viewer)</em></p>\n"}, {"tags": ["unit-testing", "testing", "memory", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1487625193, "post_id": 42353883, "comment_id": 71859331, "body": "Use -benchmem flag (and have some benchmarks). Something like &quot;free memory&quot; is not a suitable metric in Go so you won&#39;t be able to do the exact same."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1487634251, "last_edit_date": 1487634251, "creation_date": 1487626148, "answer_id": 42354548, "question_id": 42353883, "link": "https://stackoverflow.com/questions/42353883/how-can-i-limit-gate-memory-usage-in-go-unit-test/42354548#42354548", "title": "How can i limit/gate memory usage in go unit test", "body": "<p>Use Go benchmarks to analyze memory usage. For example:</p>\n\n<p><code>mem.go</code>:</p>\n\n<pre><code>package mem\n\nfunc memUse() {\n    var stack [1024]byte\n    heap := make([]byte, 64*1024)\n    _, _ = stack, heap\n}\n</code></pre>\n\n<p><code>mem_test.go</code>:</p>\n\n<pre><code>package mem\n\nimport \"testing\"\n\nfunc BenchmarkMemUse(b *testing.B) {\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        memUse()\n    }\n    b.StopTimer()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -bench=.\ngoos: linux\ngoarch: amd64\npkg: mem\nBenchmarkMemUse-4     200000      8188 ns/op       65536 B/op       1 allocs/op\nPASS\nok      mem 1.745s\n</code></pre>\n\n<p>The <code>memUse</code> function makes one heap allocation of 65536 (64*1024) bytes. Stack allocations are cheap and local to a function so we don't count them.</p>\n\n<p>Instead of the <code>ReportAllocs</code> method you could use the <code>-benchmem</code> flag. For example,</p>\n\n<pre><code>go test -bench=. -benchmem\n</code></pre>\n\n<p>References:</p>\n\n<p><a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">Go: Package testing: Benchmarks</a></p>\n\n<p><a href=\"https://golang.org/cmd/go/#hdr-Description_of_testing_functions\" rel=\"nofollow noreferrer\">Command go: Description of testing functions</a></p>\n\n<p><a href=\"https://golang.org/cmd/go/#hdr-Description_of_testing_flags\" rel=\"nofollow noreferrer\">Command go: Description of testing flags</a></p>\n\n<hr>\n\n<p>If you really must apply a memory limit during a Go <code>testing</code> package Test function, try using <a href=\"https://golang.org/pkg/runtime/#MemStats\" rel=\"nofollow noreferrer\"><code>runtime.MemStats</code></a>. For example,</p>\n\n<pre><code>func TestMemUse(t *testing.T) {\n    defer runtime.GOMAXPROCS(runtime.GOMAXPROCS(1))\n    var start, end runtime.MemStats\n    runtime.GC()\n    runtime.ReadMemStats(&amp;start)\n    memUse()\n    runtime.ReadMemStats(&amp;end)\n    alloc := end.TotalAlloc - start.TotalAlloc\n    limit := uint64(64 * 1000)\n    if alloc &gt; limit {\n        t.Error(\"memUse:\", \"allocated\", alloc, \"limit\", limit)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test\n--- FAIL: TestMemUse (0.00s)\n    mem_test.go:18: memUse: allocated 65536 limit 64000\nFAIL\nexit status 1\nFAIL    mem 0.003s\n</code></pre>\n"}], "owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1034, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1487634251, "creation_date": 1487623515, "question_id": 42353883, "link": "https://stackoverflow.com/questions/42353883/how-can-i-limit-gate-memory-usage-in-go-unit-test", "title": "How can i limit/gate memory usage in go unit test", "body": "<p>Is there a way to limit the amount of memory usage/growth during a unit test in golang?</p>\n\n<p>For example, in java, we can do:</p>\n\n<pre><code>long before = Runtime.getRuntime().freeMemory()\n\n// allocate a bunch of memory\nlong after = Runtime.getRuntime().freeMemory()\n\nAssert.AssertTrue(before-after &lt; 100)\n</code></pre>\n\n<p>(roughly) to assert that we didn't use more than 100 bytes.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 806, "user_id": 304957, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wYo2j.jpg?s=128&g=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/304957/rob"}, "is_accepted": false, "score": 1, "last_activity_date": 1487663457, "last_edit_date": 1487663457, "creation_date": 1487661989, "answer_id": 42361085, "question_id": 42353270, "link": "https://stackoverflow.com/questions/42353270/using-local-packages-with-gb/42361085#42361085", "title": "Using local packages with gb", "body": "<p>Thanks to an answer from lukehoban here <a href=\"https://github.com/Microsoft/vscode-go/issues/249\" rel=\"nofollow noreferrer\">https://github.com/Microsoft/vscode-go/issues/249</a> I was able to get my environment working.</p>\n\n<p>I simply created a settings.json file under the .vscode directory (which will now have to be checked in) into which I've configured:</p>\n\n<pre><code>{\n    \"go.gopath\": \"${workspaceRoot}\"\n}\n</code></pre>\n\n<p>This makes me feel unclean and it <strong>still doesn't provide a way to reference both 3rd party dependencies and local packages together...</strong></p>\n"}, {"comments": [{"owner": {"reputation": 806, "user_id": 304957, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wYo2j.jpg?s=128&g=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/304957/rob"}, "edited": false, "score": 0, "creation_date": 1488113731, "post_id": 42468392, "comment_id": 72078387, "body": "GB treats each project as its own GOPATH, so it&#39;s not something I&#39;d normally do!  I ended up implementing govendor, which is working nicely.  I&#39;m hanging on for dep too, something official will be a nice change to the plethora of solutions available at the moment..."}], "tags": [], "owner": {"reputation": 205, "user_id": 2715936, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/13vut.jpg?s=128&g=1", "display_name": "Johannes Kohnen", "link": "https://stackoverflow.com/users/2715936/johannes-kohnen"}, "is_accepted": false, "score": 0, "last_activity_date": 1488111529, "creation_date": 1488111529, "answer_id": 42468392, "question_id": 42353270, "link": "https://stackoverflow.com/questions/42353270/using-local-packages-with-gb/42468392#42468392", "title": "Using local packages with gb", "body": "<p>Do not try to work against Go, work with Go. </p>\n\n<p>First of all give all your packages fully qualified import paths. Go is designed around global import paths, do not try to force Go into using flat hierarchies or even relative paths. </p>\n\n<p>You can point to your import path repository endpoints either directly or by using Go's <a href=\"https://golang.org/cmd/go/#hdr-Remote_import_paths\" rel=\"nofollow noreferrer\">remote import path</a> mechanism. BTW, if you happen to run a self-hosted GitLab instance, it supports remote import path meta tags out of the box.</p>\n\n<p>I prefer <a href=\"https://github.com/Masterminds/glide\" rel=\"nofollow noreferrer\">glide</a>, but maybe the following is possible with gb, too. Certainly something simililar will be possible with the upcoming <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">go dep</a>:  You can point to ssh+git endpoints and others using glide's <a href=\"https://glide.readthedocs.io/en/latest/glide.yaml/\" rel=\"nofollow noreferrer\">repo stanza</a>. Frankly I have no idea if gb supports an equivalent mechanism, but if it doesn't this is a good reason to reconsider. </p>\n"}], "owner": {"reputation": 806, "user_id": 304957, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/wYo2j.jpg?s=128&g=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/304957/rob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1488111529, "creation_date": 1487620875, "question_id": 42353270, "link": "https://stackoverflow.com/questions/42353270/using-local-packages-with-gb", "title": "Using local packages with gb", "body": "<p>I'm starting a new project and considering <code>gb</code> as my build tool but it doesn't appear to be integrating very well with <code>vscode</code>...</p>\n\n<p>I've referenced 3rd party dependencies no problem using <code>gb vendor fetch</code> but as for creating local packages, this is proving a little trickier!  Am I missing something obvious?</p>\n\n<p>Here's my local src directory:</p>\n\n<pre><code>src\n    /cmd\n        /model\n            calc.go\n        /server\n            server.go\n</code></pre>\n\n<p>The following code compiles and creates a <code>bin\\server.exe</code> file successfully but the import path isn't picked up, nor does <code>gocode</code> recognise it</p>\n\n<p>Here's the server code:</p>\n\n<pre><code>package main\n\nimport (\n    \"cmd/model\" // not a happy reference...\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(model.Add(1, 2))\n}\n</code></pre>\n\n<p>Here's the model code:</p>\n\n<pre><code>package model\n\nfunc Add(a int, b int) int {\n    return a + b\n}\n</code></pre>\n\n<p>I've found what appears to be a similar issue on Github (<a href=\"https://github.com/joefitzgerald/go-plus/issues/325\" rel=\"nofollow noreferrer\">https://github.com/joefitzgerald/go-plus/issues/325</a>) and while nsf's solution sorts out auto-complete (post import), the import statement itself still claims to be searching in the GOROOT and GOPATHs.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 3, "creation_date": 1487619595, "post_id": 42352873, "comment_id": 71856604, "body": "If there is some commonality between the types that you would want to use in your <code>Do</code> function, you can encapsulate that in an interface and define <code>Do</code> on that interface. If you provide some more information about your types and function, I or someone else can give you a concrete example."}], "answers": [{"comments": [{"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1487699238, "post_id": 42353030, "comment_id": 71898131, "body": "thnx, but I don&#39;t like to look for shared fields. These structs of type 1 and type 2 are not created by myself, pretty long and complex. I would rather repeat code ;)"}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 3, "last_activity_date": 1487707692, "last_edit_date": 1487707692, "creation_date": 1487619900, "answer_id": 42353030, "question_id": 42352873, "link": "https://stackoverflow.com/questions/42352873/how-to-apply-same-method-to-different-types-in-go/42353030#42353030", "title": "How to apply same method to different types in Go?", "body": "<p>It's not clear how the logic goes here, but one common pattern in Go is encapsulating the shared functionality in another struct type and then embed it in your type:</p>\n\n<pre><code>type sharedFunctionality struct{}\n\nfunc (*sharedFunctionality) Do() {}\n\ntype type1 struct{ sharedFunctionality }\ntype type2 struct{ sharedFunctionality }\n</code></pre>\n\n<p>Now you can call <code>Do()</code> on <code>type1</code> and <code>type2</code> instances or in any other type that you need this functionality.</p>\n\n<p><strong>Edit:</strong> based on your comment, you can just redefine some equivalent types such as <code>t1</code> and <code>t2</code> that follow the desired protocol (having a <code>Do()</code> method) like this:</p>\n\n<pre><code>func main() {\n    var j job\n\n    j = new(t1)\n    j.Do()\n\n    j = new(t2)\n    j.Do()\n}\n\ntype job interface {\n    Do()\n}\n\ntype t1 another.Type1\n\nfunc (*t1) Do() {}\n\ntype t2 yetanother.Type2\n\nfunc (*t2) Do() {}\n</code></pre>\n\n<p>Here the types <code>another.Type1</code> and <code>yetanother.Type2</code> are not defined by you, but rather some other package designer. But you can do whatever the logic demands with <code>t1</code> and <code>t2</code> - as far as public members go or if you are willing to mess with that reflection thing :)</p>\n"}, {"comments": [{"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1487699053, "post_id": 42353039, "comment_id": 71898028, "body": "I will definitely try this one asap, looks like closet to what I want and maybe I will be fine with access only to the fields of Type1"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1487619932, "creation_date": 1487619932, "answer_id": 42353039, "question_id": 42352873, "link": "https://stackoverflow.com/questions/42352873/how-to-apply-same-method-to-different-types-in-go/42353039#42353039", "title": "How to apply same method to different types in Go?", "body": "<p>The closest you can get in Go is to have one type embed another.</p>\n\n<pre><code>type Type1 struct {}\n\nfunc (t *Type1) Do() {\n   // ...\n}\n\ntype Type2 struct {\n    *Type1\n}\n</code></pre>\n\n<p>The only limitation with this is that your <code>Do()</code> function will only have access to the fields of Type1.</p>\n"}, {"comments": [{"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1487698838, "post_id": 42360898, "comment_id": 71897900, "body": "Thnx, I tried it too, but it still doesn&#39;t fix repeating the code because in fact &quot;Do type 1&quot; is the same as &quot;Do type 2&quot;"}], "tags": [], "owner": {"reputation": 92, "user_id": 2131647, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/HcC92.jpg?s=128&g=1", "display_name": "TheROX", "link": "https://stackoverflow.com/users/2131647/therox"}, "is_accepted": false, "score": 1, "last_activity_date": 1487661357, "creation_date": 1487661357, "answer_id": 42360898, "question_id": 42352873, "link": "https://stackoverflow.com/questions/42352873/how-to-apply-same-method-to-different-types-in-go/42360898#42360898", "title": "How to apply same method to different types in Go?", "body": "<p>I think, you can use interface here. Example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype testInterface interface {\n    Do()\n}\n\ntype type1 struct{}\ntype type2 struct{}\n\nfunc (t type1) Do() {\n    fmt.Println(\"Do type 1\")\n}\n\nfunc (t type2) Do() {\n    fmt.Println(\"Do type 2\")\n}\n\nfunc TestFunc(t testInterface) {\n    t.Do()\n}\n\nfunc main() {\n    var a type1\n    var b type2\n\n    TestFunc(a)\n    TestFunc(b)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1487707692, "creation_date": 1487619261, "question_id": 42352873, "link": "https://stackoverflow.com/questions/42352873/how-to-apply-same-method-to-different-types-in-go", "title": "How to apply same method to different types in Go?", "body": "<p>How to apply same method to different types without repeating code in Go ? I have type1 and type2 and want to apply method Do()  </p>\n\n<pre><code>type type1 struct {  }\ntype type2 struct {  }\n</code></pre>\n\n<p>I have to repeat code , see below. Go has static typing, so type has to be determined during compile time.</p>\n\n<pre><code>func (p type1) Do() {   }\nfunc (p type2) Do() {   }\n</code></pre>\n\n<p>This works fine ..but I don't like repeating code</p>\n\n<pre><code>type1.Do()\ntype2.Do()\n</code></pre>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1487617866, "post_id": 42352467, "comment_id": 71855749, "body": "Specifically, a <code>slice</code> is a structure with 3 fields: a pointer to an underlying array, a capacity, and a length.  Since you&#39;re updating the items of the slice by index, you&#39;re altering the underlying array.  Since you&#39;re appending the same slice twice, both refer to the same underlying array, so altering the values in the second loop iteration alters what the first slice has as values as well."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 1, "last_activity_date": 1487617867, "last_edit_date": 1487617867, "creation_date": 1487617671, "answer_id": 42352467, "question_id": 42352362, "link": "https://stackoverflow.com/questions/42352362/golang-slice-append-built-in-function-returning-value/42352467#42352467", "title": "Golang slice append built-in function returning value", "body": "<p>When you range over the slice, it is not giving you the VALUES of the slice, it is giving you the indexes. This for loop is equivalent to <code>for i:=0; i &lt; len(slice); i++ {}</code>. So by the time it gets through iteration, both values are in <code>slice</code> are 1, and you have appended it to <code>slice2</code> twice.</p>\n\n<p>If you wanted the values of the slice, you would need to do <code>for i, v := range slice {}</code> which would give you both the indexes and the values. You could use <code>_</code> in place of <code>i</code> if you didn't want the index.</p>\n\n<p>Also note that appending <code>slice</code> twice like this appends the same exact slice because slices are allocated as pointers on the heap and it is therefore a pointer to the slice. Thus <code>slice2[0] == slice2[1]</code> because it is the same exact slice.</p>\n"}, {"comments": [{"owner": {"reputation": 189, "user_id": 7594725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-VueKLju_9sQ/AAAAAAAAAAI/AAAAAAAAQTI/XbLYnbemcLQ/photo.jpg?sz=128", "display_name": "Ramses Aldama", "link": "https://stackoverflow.com/users/7594725/ramses-aldama"}, "edited": false, "score": 0, "creation_date": 1487621707, "post_id": 42352549, "comment_id": 71857583, "body": "Thanks for your explanation. Now everything make sense."}], "tags": [], "owner": {"reputation": 8433, "user_id": 2667536, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/UfmAF.png?s=128&g=1", "display_name": "Derlin", "link": "https://stackoverflow.com/users/2667536/derlin"}, "is_accepted": false, "score": 0, "last_activity_date": 1487618010, "creation_date": 1487618010, "answer_id": 42352549, "question_id": 42352362, "link": "https://stackoverflow.com/questions/42352362/golang-slice-append-built-in-function-returning-value/42352549#42352549", "title": "Golang slice append built-in function returning value", "body": "<p>The problem is that what you append to <code>slice2</code> is <strong>a reference</strong> to <code>slice</code>, not the values contained in <code>slice</code> at the time of the call.</p>\n\n<p>This means that at the end, <code>slice2</code> contains two pointers to the same slice. Any changes to the <code>slice</code> variable will be reflected to <code>slice2</code> and vice-versa: they point to the same location in memory.</p>\n\n<p>As a proof, just do:</p>\n\n<pre><code>slice2[0][1] = 2\nfmt.Println(slice2)\nfmt.Println(slice)\n</code></pre>\n\n<p>You will get:</p>\n\n<pre><code>[[1 2] [1 2]]\n[1 2] \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": true, "score": 1, "last_activity_date": 1487619392, "creation_date": 1487619392, "answer_id": 42352909, "question_id": 42352362, "link": "https://stackoverflow.com/questions/42352362/golang-slice-append-built-in-function-returning-value/42352909#42352909", "title": "Golang slice append built-in function returning value", "body": "<blockquote>\n  <p><a href=\"https://blog.golang.org/go-slices-usage-and-internals#TOC_4.\" rel=\"nofollow noreferrer\">A slice is a descriptor of an array segment. It consists of a pointer to the array, the length of the segment, and its capacity (the maximum length of the segment).</a></p>\n</blockquote>\n\n<p>In your case your are appending a slice(pointer) not the slice's values. To get the desired result you have to declare a new slice in each iteration and append the new slice to slice2.</p>\n\n<pre><code>func main() {\n    slice := []int{0, 0}\n    slice2 := [][]int{}\n\n    for i := range slice {\n        ns := []int{0, 0}\n        ns[0] = i\n        ns[1] = i\n        slice2 = append(slice2, ns)\n    }\n    fmt.Println(slice2) // Outputs: [[0 0] [1 1]]\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/oogUDjj452\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 189, "user_id": 7594725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-VueKLju_9sQ/AAAAAAAAAAI/AAAAAAAAQTI/XbLYnbemcLQ/photo.jpg?sz=128", "display_name": "Ramses Aldama", "link": "https://stackoverflow.com/users/7594725/ramses-aldama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 997, "favorite_count": 0, "accepted_answer_id": 42352909, "answer_count": 3, "score": 1, "last_activity_date": 1487619392, "creation_date": 1487617217, "question_id": 42352362, "link": "https://stackoverflow.com/questions/42352362/golang-slice-append-built-in-function-returning-value", "title": "Golang slice append built-in function returning value", "body": "<p>The return value of slice2 of this code is [[1 1][1 1]].<br>\nAnd that got me confuse because I was expecting [[0 0][1 1]].<br>\nI can't figure it out why is returning [[1 1][1 1]] and not [[0 0][1 1]].<br>\nI would appreciate if someone can explain that. Thanks.</p>\n\n<pre><code>slice := []int{0, 0}\nslice2 := [][]int{}\n\nfor i := range slice {\n    slice[0] = i\n    slice[1] = i\n    slice2 = append(slice2, slice)\n}\nfmt.Println(slice2)\n</code></pre>\n\n<p>You can check the code in this link\n<a href=\"https://play.golang.org/p/6wX4CO5d_o\" rel=\"nofollow noreferrer\">play.golang.org</a></p>\n"}, {"tags": ["go", "video-streaming", "v4l2", "video-watermarking"], "owner": {"reputation": 11, "user_id": 7594034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ff44f07bd052f842d61b8aff1c8a56f?s=128&d=identicon&r=PG&f=1", "display_name": "icuhadar", "link": "https://stackoverflow.com/users/7594034/icuhadar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 625, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1487609982, "creation_date": 1487609982, "last_edit_date": 1495542299, "question_id": 42350276, "link": "https://stackoverflow.com/questions/42350276/watermarking-the-video-streaming-written-in-go-language-with-github-com-blackja", "title": "Watermarking the video streaming written in go language with &quot;github.com/blackjack/webcam&quot; library", "body": "<p>I want to watermark \"the video streaming over http\" which is written in GO language by using <a href=\"http://github.com/blackjack/webcam\" rel=\"nofollow noreferrer\">blackjack</a> library. And for this, I found a code <a href=\"https://stackoverflow.com/questions/16100023/manipulating-watermark-images-with-go\">watermarking with png</a>. But I could not manage to transform the variables jpeg &lt;-> byte[].</p>\n\n<p>Here is the code part which gets the frame from cam and writes to \"JpegImage\" variable.  </p>\n\n<pre><code>var jpegImage []byte   \nframe, err := cam.ReadFrame()\nif len(frame) != 0 {\n    mutex.Lock()\n    jpegImage = frame\n    mutex.Unlock()\n} \nelse if err != nil {\n    panic(err.Error())\n}\n</code></pre>\n\n<p>And here is the watermarking code with \"image.jpg\" variable.</p>\n\n<pre><code>imgb, _ := os.Open(\"image.jpg\")\nimg, _ := jpeg.Decode(imgb)\ndefer imgb.Close()\n\nwmb, _ := os.Open(\"watermark.png\")\nwatermark, _ := png.Decode(wmb)\ndefer wmb.Close()\n\noffset := image.Pt(200, 200)\nb := img.Bounds()\nm := image.NewRGBA(b)\ndraw.Draw(m, b, img, image.ZP, draw.Src)\ndraw.Draw(m, watermark.Bounds().Add(offset), watermark, image.ZP, draw.Over)\n\nimgw, _ := os.Create(\"watermarked.jpg\")\njpeg.Encode(imgw, m, &amp;jpeg.Options{jpeg.DefaultQuality})\ndefer imgw.Close()\n</code></pre>\n\n<p>In the end, I need to combine this two code parts. After getting the frame from cam; firstly transform it to jpg, secondly watermark with png, thirdly transform it to []byte and lastly assign it to \"JpegImage\" variable.</p>\n\n<p>I hope you can help me please.</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1487608595, "post_id": 42349678, "comment_id": 71850568, "body": "If the file isn&#39;t saved, how is go lint supposed to run against it?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1487609146, "post_id": 42349678, "comment_id": 71850900, "body": "Configure your editor to save on all keystrokes?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 90, "user_id": 9998212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dOnSm.jpg?s=128&g=1", "display_name": "Dmitry Gashko", "link": "https://stackoverflow.com/users/9998212/dmitry-gashko"}, "edited": false, "score": 0, "creation_date": 1599637069, "post_id": 42349678, "comment_id": 112830873, "body": "@DmitryGashko: I have no idea if, or how, other languages do it. But the Go tool chain works on files on disk."}], "answers": [{"comments": [{"owner": {"reputation": 6547, "user_id": 148824, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/7CmFa.jpg?s=128&g=1", "display_name": "Tom", "link": "https://stackoverflow.com/users/148824/tom"}, "edited": false, "score": 0, "creation_date": 1548598962, "post_id": 42374893, "comment_id": 95590112, "body": "I believe the lintOnSave config now only accepts a string of either: &quot;file&quot;, &quot;workspace&quot;, &quot;package&quot;, or &quot;off&quot;."}], "tags": [], "owner": {"reputation": 18043, "user_id": 405013, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?s=128&d=identicon&r=PG", "display_name": "caarlos0", "link": "https://stackoverflow.com/users/405013/caarlos0"}, "is_accepted": true, "score": 3, "last_activity_date": 1487700815, "creation_date": 1487700815, "answer_id": 42374893, "question_id": 42349678, "link": "https://stackoverflow.com/questions/42349678/how-can-i-make-golint-run-on-vs-code-on-type-instead-of-on-save/42374893#42374893", "title": "How can I make golint run on VS Code on type instead of on save?", "body": "<p>It seems like it's not possible at all.</p>\n\n<p>The only available configs regarding golint are:</p>\n\n<pre><code>  // Run Lint tool on save.\n  \"go.lintOnSave\": true,\n\n  // Specifies Lint tool name.\n  \"go.lintTool\": \"golint\",\n\n  // Flags to pass to Lint tool (e.g. [\"-min_confidence=.8\"])\n  \"go.lintFlags\": [],\n</code></pre>\n\n<p>Maybe you can hack this by changing these options though:</p>\n\n<pre><code>  // Controls auto save of dirty files. Accepted values:  \"off\", \"afterDelay\", \"onFocusChange\" (editor loses focus), \"onWindowChange\" (window loses focus). If set to \"afterDelay\", you can configure the delay in \"files.autoSaveDelay\".\n  \"files.autoSave\": \"off\",\n\n  // Controls the delay in ms after which a dirty file is saved automatically. Only applies when \"files.autoSave\" is set to \"afterDelay\"\n  \"files.autoSaveDelay\": 1000,\n</code></pre>\n\n<p>You could set <code>files.autoSave</code> to <code>afterDelay</code> and a lower <code>files.autoSaveDelay</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1038, "user_id": 1847868, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/XWSNn.jpg?s=128&g=1", "display_name": "mandarin", "link": "https://stackoverflow.com/users/1847868/mandarin"}, "edited": false, "score": 0, "creation_date": 1610532030, "post_id": 63803354, "comment_id": 116161131, "body": "Seems to work great out of the box. This should be the accepted answer."}], "tags": [], "owner": {"reputation": 90, "user_id": 9998212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dOnSm.jpg?s=128&g=1", "display_name": "Dmitry Gashko", "link": "https://stackoverflow.com/users/9998212/dmitry-gashko"}, "is_accepted": false, "score": 4, "last_activity_date": 1599613861, "last_edit_date": 1599613861, "creation_date": 1599613118, "answer_id": 63803354, "question_id": 42349678, "link": "https://stackoverflow.com/questions/42349678/how-can-i-make-golint-run-on-vs-code-on-type-instead-of-on-save/63803354#63803354", "title": "How can I make golint run on VS Code on type instead of on save?", "body": "<p>This side of Go makes me crazy...</p>\n<p>So, I've found an option called &quot;go.useLanguageServer&quot; (most likely I had found it some-when earlier, but for some reason it's not so easy to find that option anyway).</p>\n<pre class=\"lang-json prettyprint-override\"><code>&quot;go.useLanguageServer&quot;: true,\n</code></pre>\n<p>Also, there're these options:</p>\n<pre class=\"lang-json prettyprint-override\"><code>&quot;go.languageServerExperimentalFeatures&quot;: {\n    &quot;diagnostics&quot;: true,\n    &quot;documentLink&quot;: true\n},\n&quot;go.liveErrors&quot;: {\n    &quot;enabled&quot;: true,\n    &quot;delay&quot;: 500,\n},\n</code></pre>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8251, "favorite_count": 0, "accepted_answer_id": 42374893, "answer_count": 2, "score": 6, "last_activity_date": 1599613861, "creation_date": 1487608250, "question_id": 42349678, "link": "https://stackoverflow.com/questions/42349678/how-can-i-make-golint-run-on-vs-code-on-type-instead-of-on-save", "title": "How can I make golint run on VS Code on type instead of on save?", "body": "<p>I am using VS Code and the Go extension from lukehoban:</p>\n\n<p><a href=\"https://github.com/Microsoft/vscode-go\" rel=\"noreferrer\">https://github.com/Microsoft/vscode-go</a></p>\n\n<p>It seems like the golint is run when you save the file, is there a way for me to make golint run when I start typing? Usually linting happens when we type on other extensions and languages such as jslint, and tslint on VS Code. It would be nice to have the option to also be able to do this with golint.</p>\n\n<p>What could I do to achieve this?</p>\n"}, {"tags": ["go", "memory-leaks", "garbage-collection"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1487596082, "post_id": 42345060, "comment_id": 71841999, "body": "&quot;is it a good way to empty the memory what the goroutines are using&quot;. Answer: No. Stay away from such hacks, especially as these are not helpful."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1487596316, "post_id": 42345060, "comment_id": 71842155, "body": "@Volker First, why I got a down vote? Second, what is the good way then?"}], "answers": [{"comments": [{"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1487595823, "post_id": 42345264, "comment_id": 71841819, "body": "Yes, I read that, this is why I started to use this package, but I got doubts because of the main package name, that is it the good way?"}, {"owner": {"reputation": 31, "user_id": 5308961, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207862496908790/picture?type=large", "display_name": "Manuel Luis Garrido Guti&#233;rrez", "link": "https://stackoverflow.com/users/5308961/manuel-luis-garrido-guti%c3%a9rrez"}, "reply_to_user": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1487596700, "post_id": 42345264, "comment_id": 71842420, "body": "Is the good way if you need the memory immediately, but force drop memory is dangerous in all programming languages."}], "tags": [], "owner": {"reputation": 31, "user_id": 5308961, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207862496908790/picture?type=large", "display_name": "Manuel Luis Garrido Guti&#233;rrez", "link": "https://stackoverflow.com/users/5308961/manuel-luis-garrido-guti%c3%a9rrez"}, "is_accepted": false, "score": 3, "last_activity_date": 1487595603, "last_edit_date": 1495541811, "creation_date": 1487595603, "answer_id": 42345264, "question_id": 42345060, "link": "https://stackoverflow.com/questions/42345060/freeosmemory-in-production/42345264#42345264", "title": "FreeOSMemory() in production", "body": "<p>GO lang clean all memory that is not in use, but is not inmediate. You can read the other question: </p>\n\n<p><a href=\"https://stackoverflow.com/questions/37382600/golang-cannot-free-memory-once-occupied-by-bytes-buffer\">Golang - Cannot free memory once occupied by bytes.Buffer</a></p>\n"}, {"comments": [{"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1487596921, "post_id": 42345554, "comment_id": 71842588, "body": "Thank you, the service stable without the FreeOSMemory, I just don&#39;t know is it a good way or not. Now I hace clue for that."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1487603171, "last_edit_date": 1495540820, "creation_date": 1487596492, "answer_id": 42345554, "question_id": 42345060, "link": "https://stackoverflow.com/questions/42345060/freeosmemory-in-production/42345554#42345554", "title": "FreeOSMemory() in production", "body": "<p>The Go runtime does not release free memory back to the OS \"immediately\", it would be inefficient. Read more about it here: <a href=\"https://stackoverflow.com/questions/37382600/golang-cannot-free-memory-once-occupied-by-bytes-buffer/37383604#37383604\">Golang - Cannot free memory once occupied by bytes.Buffer</a>.</p>\n\n<p>You should let the Go runtime handle this. If your app is unstable without calling <a href=\"https://golang.org/pkg/runtime/debug/#FreeOSMemory\" rel=\"nofollow noreferrer\"><code>debug.FreeOsMemory()</code></a>, there are bigger problems which you shouldn't cover up with this even if it \"seemingly\" helps. It may even make things worse, as if serving a request does require a large amount of memory (which is properly freed by the GC when done with the request), calling <code>FreeOsMemory()</code> will just return it to the OS which the runtime will have to ask for / allocate again when serving another request. Should you have not handed it back to the OS, it would be available for the next request...</p>\n\n<p>Try to decrease the memory requirement of the request handler. If it is not possible (questionable), then limit the number of requests requiring large memory that may be served concurrently.</p>\n\n<p>See this question+answer how to do that: <a href=\"https://stackoverflow.com/questions/37529511/process-management-for-the-go-webserver/37531953#37531953\">Process Management for the Go Webserver</a></p>\n\n<p>Also: <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a></p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 12211383, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6e9r0boIj-0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfiUbU9XkY93mzSE5ixZAGv45osmQ/photo.jpg?sz=128", "display_name": "mg87", "link": "https://stackoverflow.com/users/12211383/mg87"}, "is_accepted": false, "score": 4, "last_activity_date": 1571017332, "last_edit_date": 1571017332, "creation_date": 1571006838, "answer_id": 58368360, "question_id": 42345060, "link": "https://stackoverflow.com/questions/42345060/freeosmemory-in-production/58368360#58368360", "title": "FreeOSMemory() in production", "body": "<p>As an alternative to occasionally invoking <code>debug.FreeOsMemory()</code>, you can control the aggressiveness of the garbage collector with the <code>GOGC</code> environment variable or with the <code>debug.SetGCPercent()</code> method. </p>\n\n<p>Empirically, I've seen that with a value as low as 10, it does its job.</p>\n\n<p>See <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">Package runtime</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7532322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4082ee2e64faa52362794e28c198c45d?s=128&d=identicon&r=PG&f=1", "display_name": "Hiter Adolf", "link": "https://stackoverflow.com/users/7532322/hiter-adolf"}, "is_accepted": false, "score": 0, "last_activity_date": 1594717573, "creation_date": 1594717573, "answer_id": 62891638, "question_id": 42345060, "link": "https://stackoverflow.com/questions/42345060/freeosmemory-in-production/62891638#62891638", "title": "FreeOSMemory() in production", "body": "<p>That is crazy, I think is a bug for golang,My code include:</p>\n<pre><code>go func() {\n    for {\n        debug.FreeOSMemory()\n        log4sys.Warn(&quot;NumGoroutine:&quot;,runtime.NumGoroutine())\n        time.Sleep(1 * time.Minute)\n    }\n}()\n</code></pre>\n<p>to solution this question</p>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5496, "favorite_count": 2, "accepted_answer_id": 42345554, "answer_count": 4, "score": 10, "last_activity_date": 1594717573, "creation_date": 1487595044, "last_edit_date": 1495540820, "question_id": 42345060, "link": "https://stackoverflow.com/questions/42345060/freeosmemory-in-production", "title": "FreeOSMemory() in production", "body": "<p>I am using goroutines in a package where there is a tcp server. The response most of the time is very heavy, but when the routines end it is not cleared from the memory. </p>\n\n<pre><code>func Handle() {\n    service := \":7777\"\n    tcpAddr, err := net.ResolveTCPAddr(\"tcp4\", service)\n    checkError(err)\n    listener, err := net.ListenTCP(\"tcp\", tcpAddr)\n    checkError(err)\n    defer listener.Close()\n\n    for {\n        conn, err := listener.Accept()\n        checkError(err)\n        go handleRequest(conn, db)\n\n    }\n}\n\nfunc handleRequest(conn net.Conn, db *sql.DB) {\n    message := make([]byte, 0, 4096)\n    tmp := make([]byte, 256)\n    n, err := conn.Read(tmp)\n    if err != nil {\n        if err != io.EOF {\n            fmt.Println(\"read error:\", err)\n        }\n    }\n    message = append(message, tmp[:n]...)\n    fmt.Println(\"Message Received:\", string(message))\n    // do something to get resp\n    conn.Write(append(resp, []byte(\"\\n\")...))\n    conn.Close()\n    debug.FreeOSMemory()\n    return\n}\n</code></pre>\n\n<p>So in this case the response is big, and a goroutine using 10% of the memory, thats okay, because I'm getting 170.000 users from the database and parse the result to JSON. But when the handleRequest and it is still in the memory, if I'm not using <code>debug.FreeOsMemory()</code>. I have doubts it is a good way to do it because it is in the debug pacakge so my question <strong>is it a good way to empty the memory what the goroutines are using</strong>? I tested it so it is not affected to the system and working very well. If not, what is the good way? I can't wait the GC for clear it up?! I read <a href=\"https://stackoverflow.com/questions/37382600/golang-cannot-free-memory-once-occupied-by-bytes-buffer\">this</a> and this is why I started to use it, in the first answer there is the last suggestion.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1487595607, "post_id": 42343810, "comment_id": 71841683, "body": "so If we didn&#39;t implement <code>bson.Getter</code> and <code>bson.Setter</code> we can simply return the <code>clienConfigData</code> right? but in this case we better not. Is this correct?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 1, "creation_date": 1487595973, "post_id": 42343810, "comment_id": 71841924, "body": "Your question doesn&#39;t really make sense, as adding <code>GetBSON()</code> and <code>SetBSON()</code> <b>is</b> implementing <code>Getter</code> and <code>Setter</code> (<code>Getter</code> and <code>Setter</code> are interfaces defining <code>GetBSON()</code> and <code>SetBSON()</code>). If you don&#39;t add those methods, there isn&#39;t something to return from."}, {"owner": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1487658817, "post_id": 42343810, "comment_id": 71870723, "body": "Thanks a lot @icza"}, {"owner": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1487658999, "post_id": 42343810, "comment_id": 71870836, "body": "@icza I have just one question, how to do the error handling for the error returning from <code>SetBSON</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "edited": false, "score": 0, "creation_date": 1487666392, "post_id": 42343810, "comment_id": 71874783, "body": "@SyedQasimRizvi You don&#39;t handle it as you are not the one calling <code>SetBSON()</code>. It&#39;s the <code>mgo</code> package that \u2013when loading values from MongoDB\u2013 checks if the value implements <code>Setter</code>, and if so, it calls its <code>SetBSON()</code> to do the unmarshaling. It&#39;s the <code>mgo</code> package that needs to handle the <code>error</code> returned by it, which may be wrapped, logged or returned by the outer function that you called (e.g. <code>Find().All()</code> or <code>Find().One()</code>)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1487593228, "last_edit_date": 1495540400, "creation_date": 1487591431, "answer_id": 42343810, "question_id": 42342943, "link": "https://stackoverflow.com/questions/42342943/accessing-mongodb-from-go/42343810#42343810", "title": "Accessing MongoDB from Go", "body": "<p>If you want to change a value or do a type conversion when marshaling / unmarshaling your values from / to MongoDB, you may do it by implementing a custom marshaling / unmarshaling logic.</p>\n\n<p>You can do this by implementing the <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Getter\" rel=\"nofollow noreferrer\"><code>bson.Getter</code></a> and <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Setter\" rel=\"nofollow noreferrer\"><code>bson.Setter</code></a> interfaces. Inside these methods, you may do whatever you want to with the values being marshaled / unmarshaled.</p>\n\n<p>Easiest is to extend your <code>clientConfigData</code> type with an additional field, one that will be of type <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a>, the value you need:</p>\n\n<pre><code>type clientConfigData struct {\n    SMTPAssoc  int       `bson:\"smtp_assoc\"`\n    PlanType   string    `bson:\"plan_type\"`\n    EndDateStr string    `bson:\"end_date\"`\n    EndDate    time.Time `bson:\"-\"`\n}\n</code></pre>\n\n<p>It has tag value <code>bson:\"-\"</code>, because we don't want this to appear in MongoDB.</p>\n\n<p>And now the custom marshaling / unmarhsaling logic:</p>\n\n<pre><code>const endDateLayout = \"2006-01-02 15:04:05\" // Use your layout here\n\nfunc (c *clientConfigData) SetBSON(raw bson.Raw) (err error) {\n    type my clientConfigData\n    if err = raw.Unmarshal((*my)(c)); err != nil {\n        return\n    }\n    c.EndDate, err = time.Parse(endDateLayout, c.EndDateStr)\n    return\n}\n\nfunc (c *clientConfigData) GetBSON() (interface{}, error) {\n    c.EndDateStr = c.EndDate.Format(endDateLayout)\n    type my *clientConfigData\n    return my(c), nil\n}\n</code></pre>\n\n<p>What happens here is that <code>SetBSON()</code> is responsible to \"populate\" your struct value with the raw value coming from MongoDB, and <code>GetBSON()</code> is responsible to provide a value you want to be saved (marshaled).</p>\n\n<p>When loading: <code>SetBSON()</code> first unmarshals the value as-is, then properly sets the <code>EndDate</code> field (which is of type <code>time.Time</code>) from the <code>string</code> date value that came from the DB (<code>EndDateStr</code>).</p>\n\n<p>When saving: <code>GetBSON()</code> first fills the <code>EndDateStr</code> field (the one that is saved) from the <code>EndDate</code> field, and then simply returns, signaling that it is ok to save.</p>\n\n<p>One thing to note: both <code>SetBSON()</code> and <code>GetBSON()</code> create a new <code>my</code> type inside them. The reason for this is to avoid stack overflow. Simply returning a value of type <code>clientConfigData</code> is bad, because we implemented <code>bson.Getter</code> and <code>bson.Setter</code>, so <code>SetBSON()</code> and <code>GetBSON()</code> would get called endlessly. The new <code>my</code> type does not have these methods, so endless \"recursion\" does not happen (the <code>type</code> keyword creates a new type, and it does not \"inherit\" methods of the underlying type).</p>\n\n<p>Also see related / similar question: <a href=\"https://stackoverflow.com/questions/41907619/set-default-date-when-inserting-document-with-time-time-field/42344267#42344267\">Set default date when inserting document with time.Time field</a></p>\n"}], "owner": {"reputation": 53, "user_id": 5803537, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LRsM8Rrho5g/AAAAAAAAAAI/AAAAAAAAADw/nGkxwlGVlV8/photo.jpg?sz=128", "display_name": "Syed Qasim Rizvi", "link": "https://stackoverflow.com/users/5803537/syed-qasim-rizvi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 439, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1533436758, "creation_date": 1487588884, "last_edit_date": 1533436758, "question_id": 42342943, "link": "https://stackoverflow.com/questions/42342943/accessing-mongodb-from-go", "title": "Accessing MongoDB from Go", "body": "<p>I am accessing MongoDB using Go as follows:</p>\n\n<pre><code>var configRes *clientConfigData\nerr := clientDB.\n    C(clientConfigCollection).\n    Find(bson.M{}).\n    One(&amp;configRes)\nif err != nil {\n    return nil, errors.Wrap(err, \"finding config collection\")\n}\n</code></pre>\n\n<p>Where </p>\n\n<pre><code>type clientConfigData struct {\n    SMTPAssoc      int       `bson:\"smtp_assoc\"`\n    PlanType       string    `bson:\"plan_type\"`\n    EndDate        string    `bson:\"end_date\"`\n}\n</code></pre>\n\n<p>Now since <code>EndDate</code> in MongoDB is stored as <code>string</code> so I declared <code>EndDate</code> as <code>string</code>. But I need to access this date as Go <code>Time</code> in <code>clientConfigData</code>.</p>\n"}, {"tags": ["sockets", "go", "timeout", "grpc"], "comments": [{"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 0, "creation_date": 1487577845, "post_id": 42337156, "comment_id": 71830690, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/23330024/does-rpc-have-a-timeout-mechanism\">Does RPC have a timeout mechanism?</a>"}, {"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1487578916, "post_id": 42337156, "comment_id": 71831228, "body": "Have you tried go-cron library: <a href=\"https://github.com/jasonlvhit/gocron\" rel=\"nofollow noreferrer\">github.com/jasonlvhit/gocron</a> ? Itis not about a timeouts, yes, but maybe you can make a shedule like reading.."}], "answers": [{"comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "reply_to_user": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "edited": false, "score": 0, "creation_date": 1487668179, "post_id": 42348282, "comment_id": 71875883, "body": "You are welcome. If that answer helped you, I would be glad to get an upvote."}, {"owner": {"reputation": 847, "user_id": 3172290, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MIH9i.jpg?s=128&g=1", "display_name": "aniztar", "link": "https://stackoverflow.com/users/3172290/aniztar"}, "edited": false, "score": 1, "creation_date": 1600426446, "post_id": 42348282, "comment_id": 113091659, "body": "Say I made a successful Dial and am using the same connection object for making all subsequent grpc calls. Does even the grpc call timeout with this config or more config is required?"}], "tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": true, "score": 4, "last_activity_date": 1487604191, "creation_date": 1487604191, "answer_id": 42348282, "question_id": 42337156, "link": "https://stackoverflow.com/questions/42337156/how-to-set-so-timeout-for-go-grpc/42348282#42348282", "title": "How to set SO_TIMEOUT for Go gRPC", "body": "<p>With no example code I can just give you a simple answer without a concrete example.</p>\n\n<p>If you want to set a timeout you should use a context. The context interface provides a timeout which you can set inside the context: <a href=\"https://godoc.org/golang.org/x/net/context#Context\" rel=\"nofollow noreferrer\">godoc: Context</a></p>\n\n<p>Inside the gRPC package you have the method for dial with a context: <a href=\"https://godoc.org/google.golang.org/grpc#DialContext\" rel=\"nofollow noreferrer\">godoc: DialContext</a></p>\n\n<p>So just set the timeout inside your context and use the context when you dial.</p>\n"}], "owner": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2457, "favorite_count": 0, "accepted_answer_id": 42348282, "answer_count": 1, "score": 3, "last_activity_date": 1487604191, "creation_date": 1487568791, "question_id": 42337156, "link": "https://stackoverflow.com/questions/42337156/how-to-set-so-timeout-for-go-grpc", "title": "How to set SO_TIMEOUT for Go gRPC", "body": "<p>I'm using gRPC with Go and needing to set the socket read timeout on the client connection (since the function available are all synchronous). Cannot seem to find anyway that I can set in the DialOption. Is there a way that I can set the timeout?</p>\n\n<p>Also is there anyway that I can cancel a request?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["multithreading", "go", "channel"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 1, "creation_date": 1487564482, "post_id": 42336399, "comment_id": 71825344, "body": "you are sending message to channel five times, but consuming channel only once. the producer2 goroutine will be blocked until rest of the four message will be consumed."}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1487564806, "post_id": 42336399, "comment_id": 71825438, "body": "and also, your usage of <code>sync.WaitGroup</code> is wrong since it calls <code>Add(5)</code> but calls  <code>Done()</code> only once."}, {"owner": {"reputation": 21, "user_id": 7586237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90f30dab05e9c0ed7ba38606e2736c19?s=128&d=identicon&r=PG&f=1", "display_name": "Go Langer", "link": "https://stackoverflow.com/users/7586237/go-langer"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1487565578, "post_id": 42336399, "comment_id": 71825626, "body": "@ymonad I added my understanding. Can you please correct me where I am going wrong ?  Reg.  Add(5) - I am expecting Done() to be called 5 times when consumer executes 5 times"}, {"owner": {"reputation": 611, "user_id": 4281077, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-3oOg40JdTy4/AAAAAAAAAAI/AAAAAAAAHNQ/jB3IczOZSFE/photo.jpg?sz=128", "display_name": "Karthik Nayak", "link": "https://stackoverflow.com/users/4281077/karthik-nayak"}, "edited": false, "score": 0, "creation_date": 1487570719, "post_id": 42336399, "comment_id": 71827262, "body": "In step 3, you mention that that step 2 would repeat again, but that&#39;s not true, the consumer in your code, only consumes once."}], "answers": [{"tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 3, "last_activity_date": 1487569307, "creation_date": 1487569307, "answer_id": 42337254, "question_id": 42336399, "link": "https://stackoverflow.com/questions/42336399/why-following-code-generates-deadlock/42337254#42337254", "title": "Why following code generates deadlock", "body": "<p>Your original deadlock is caused by <code>wg2.Add(5)</code>, you were waiting for 5 goroutines to finish, but only one did; you called <code>wg2.Done()</code> once. Change this to <code>wg2.Add(1)</code>, and your program will run without error.</p>\n\n<p>However, I suspect that you intended to consume all the values in the channel not just one as you do. If you change consumer function to:</p>\n\n<pre><code>func consumer2(c &lt;-chan int) {\n    defer wg2.Done()\n    for i := range c {\n        fmt.Printf(\"Consumer Got value %d\\n\", i)\n    }\n}\n</code></pre>\n\n<p>You will get another deadlock because the channel is not closed in producer function, and consumer is waiting for more values that never arrive. Adding <code>close(c)</code> to the producer function will fix it.</p>\n"}, {"tags": [], "owner": {"reputation": 9643, "user_id": 1925083, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/C3khW.jpg?s=128&g=1", "display_name": "cizixs", "link": "https://stackoverflow.com/users/1925083/cizixs"}, "is_accepted": false, "score": 1, "last_activity_date": 1487583216, "creation_date": 1487583216, "answer_id": 42340892, "question_id": 42336399, "link": "https://stackoverflow.com/questions/42336399/why-following-code-generates-deadlock/42340892#42340892", "title": "Why following code generates deadlock", "body": "<h2>Why it error?</h2>\n\n<p>Running your code gets the following error:</p>\n\n<pre><code>\u279c  gochannel go run dl.go\nStarting .... 1\nStarting .... 2\nProducer Writing to chan 0\nConsumer Got value 0\nProducer Writing to chan 1\nfatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>Here is why:</p>\n\n<p>There are three goroutines in your code: <code>main</code>,<code>producer2</code> and <code>consumer2</code>. When it runs, </p>\n\n<ul>\n<li><code>producer2</code> sends a number <code>0</code> to the channel</li>\n<li><code>consumer2</code> recives <code>0</code> from the channel, and <strong>exits</strong></li>\n<li><code>producer2</code> sends <code>1</code> to the channel, but <strong>no one is consuming</strong>, since <code>consumer2</code> already exits</li>\n<li><code>producer2</code> is <strong>waiting</strong></li>\n<li><code>main</code> executes <code>wg2.Wait()</code>, but not all waitgroup are closed. So <strong>main is waiting</strong></li>\n</ul>\n\n<p>Two goroutines are waiting here, does nothing, and nothing will be done no matter how long you wait. <strong>It is a deadlock!</strong> Golang detects it and panic.</p>\n\n<p>There are two concepts you are confused here:</p>\n\n<ol>\n<li>how waitgourp works</li>\n<li>how to receive all values from a channel</li>\n</ol>\n\n<p>I'll explain them here briefly, there are alreay many articles out there on the internet.</p>\n\n<h3>how waitgroup works</h3>\n\n<p><code>WaitGroup</code> if a way to wait for all groutine to finish. When running goroutines in the background, it's important to know when all of them quits, then certain action can be conducted.</p>\n\n<p>In your case, we run two goroutines, so at the beginning we should set <code>wg2.Add(2)</code>, and each goroutine should add <code>wg2.Done()</code> to notify it is done.</p>\n\n<h3>Receive data from a channel</h3>\n\n<p>When receiving data from a channel. If you know exactly how many data it will send, use <code>for</code> loop this way:</p>\n\n<pre><code>for i:=0; i&lt;N; i++ {\n    data = &lt;-c\n    process(data)\n}\n</code></pre>\n\n<p>Otherwise use it this way:</p>\n\n<pre><code>for data := range c {\n    process(data)\n}\n</code></pre>\n\n<p>Also, <strong>Don't forget to close channel when there is no more data to send.</strong></p>\n\n<h2>How to fix it?</h2>\n\n<p>With the above explanation, the code can be fixed as:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar wg2 sync.WaitGroup\n\nfunc producer2(c chan&lt;- int) {\n    defer wg2.Done()\n    for i := 0; i &lt; 5; i++ {\n        time.Sleep(time.Second * 1)\n        fmt.Printf(\"Producer Writing to chan %d\\n\", i)\n        c &lt;- i\n    }\n    close(c)\n}\n\nfunc consumer2(c &lt;-chan int) {\n    defer wg2.Done()\n    for i := range c {\n        fmt.Printf(\"Consumer Got value %d\\n\", i)\n    }\n\n}\n\nfunc main() {\n    c := make(chan int)\n    wg2.Add(2)\n    fmt.Println(\"Starting .... 1\")\n    go producer2(c)\n    go consumer2(c)\n    fmt.Println(\"Starting .... 2\")\n\n    wg2.Wait()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/CtEIeX6rKi\" rel=\"nofollow noreferrer\">Here</a> is another possible way to fix it.</p>\n\n<h2>The expected output</h2>\n\n<p>Fixed code gives the following output:</p>\n\n<pre><code>\u279c  gochannel go run dl.go\nStarting .... 1\nStarting .... 2\nProducer Writing to chan 0\nConsumer Got value 0\nProducer Writing to chan 1\nConsumer Got value 1\nProducer Writing to chan 2\nConsumer Got value 2\nProducer Writing to chan 3\nConsumer Got value 3\nProducer Writing to chan 4\nConsumer Got value 4\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 7586237, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90f30dab05e9c0ed7ba38606e2736c19?s=128&d=identicon&r=PG&f=1", "display_name": "Go Langer", "link": "https://stackoverflow.com/users/7586237/go-langer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1487583216, "creation_date": 1487564188, "last_edit_date": 1487572547, "question_id": 42336399, "link": "https://stackoverflow.com/questions/42336399/why-following-code-generates-deadlock", "title": "Why following code generates deadlock", "body": "<p>Golang newbie here. Can somebody explain why the following code generates a deadlock?</p>\n\n<p>I am aware of sending true to boolean &lt;- done channel but I don't want to use it. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar wg2 sync.WaitGroup\n\nfunc producer2(c chan&lt;- int) {\n    for i := 0; i &lt; 5; i++ {\n        time.Sleep(time.Second * 10)\n        fmt.Println(\"Producer Writing to chan %d\", i)\n        c &lt;- i\n    }\n}\n\nfunc consumer2(c &lt;-chan int) {\n    defer wg2.Done()\n    fmt.Println(\"Consumer Got value %d\", &lt;-c)\n\n}\n\nfunc main() {\n    c := make(chan int)\n    wg2.Add(5)\n    fmt.Println(\"Starting .... 1\")\n    go producer2(c)\n    go consumer2(c)\n    fmt.Println(\"Starting .... 2\")\n\n    wg2.Wait()\n}\n</code></pre>\n\n<p>Following is my understanding and I know that it is wrong:</p>\n\n<ol>\n<li>The channel will be blocked the moment 0 is written to it within the\nloop of producer function </li>\n<li>So I expect channel to be emptied by the\nconsumer afterwards. </li>\n<li>As the channel is emptied in the step 2,\nproducer function can again put in another value and then get\nblocked and steps 2 repeats again.</li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1487569352, "post_id": 42335756, "comment_id": 71826703, "body": "@Volker can you give the reason ? since <code>*io.PipeWriter</code> implements the <code>Writer</code> interface, it seems to be legitimate to use <code>*io.PipeWriter</code> instead of <code>io.PipeWriter</code>: <a href=\"https://golang.org/pkg/io/#PipeWriter\" rel=\"nofollow noreferrer\">golang.org/pkg/io/#PipeWriter</a>"}, {"owner": {"reputation": 3430, "user_id": 1553655, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C7zHe.png?s=128&g=1", "display_name": "Vishnu", "link": "https://stackoverflow.com/users/1553655/vishnu"}, "edited": false, "score": 0, "creation_date": 1487569536, "post_id": 42335756, "comment_id": 71826774, "body": "why the downvote?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1487582731, "post_id": 42335756, "comment_id": 71833423, "body": "A, sorry, you are correct, PipeWriter is not an interface. Forget it."}], "answers": [{"tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 5, "last_activity_date": 1487561004, "last_edit_date": 1495535377, "creation_date": 1487560549, "answer_id": 42335899, "question_id": 42335756, "link": "https://stackoverflow.com/questions/42335756/passing-io-pipewriter-to-io-multiwriter/42335899#42335899", "title": "Passing []*io.PipeWriter to io.MultiWriter", "body": "<p>Unfortunately, Golang's type system does not allow casting <code>[]*io.PipeWriter</code> to <code>[]io.Writer</code> even when <code>*io.PipeWriter</code> implements <code>io.Writer</code> since it requires O(n) operation <a href=\"https://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go/12754757#12754757\">(reference)</a>.</p>\n\n<p>The best you can do is create another <code>[]io.Writer</code> and copy the pipe writers into it</p>\n\n<pre><code>ws := make([]io.Writer, len(writers))\nfor i, w := range writers {\n    ws[i] = w\n}\nmw := io.MultiWriter(ws...)\n</code></pre>\n\n<p>And reason why you nead <code>...</code>, read <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">the document</a></p>\n"}], "owner": {"reputation": 3430, "user_id": 1553655, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/C7zHe.png?s=128&g=1", "display_name": "Vishnu", "link": "https://stackoverflow.com/users/1553655/vishnu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 466, "favorite_count": 0, "accepted_answer_id": 42335899, "answer_count": 1, "score": 0, "last_activity_date": 1487561004, "creation_date": 1487559409, "question_id": 42335756, "link": "https://stackoverflow.com/questions/42335756/passing-io-pipewriter-to-io-multiwriter", "title": "Passing []*io.PipeWriter to io.MultiWriter", "body": "<p>I have a bunch of <code>*io.PipeWriter</code> created and would like to make a multiwriter based on all those pipewriters in a function. So I call a function something like </p>\n\n<pre><code>func copyToWriters(reader *bufio.Reader, errs chan error, writers []*io.PipeWriter) {\n  for _, writer := range writers {\n    defer writer.Close()\n  }\n  mw := io.MultiWriter(writers)\n  _, err := io.Copy(mw, reader)\n  if err != nil {\n    errs &lt;- err\n  }\n}\n</code></pre>\n\n<p>I call the method with arguments <code>copyToWriters(reader, errs, []*io.PipeWriter{w1, w2})</code></p>\n\n<p>But it says \n<code>cannot use writers (type []*io.PipeWriter) as type []io.Writer in argument to io.MultiWriter</code>. But\nif I change <code>io.MultiWriter(writers)</code> to <code>io.MultiWriter(writers[0],writers[1])</code> it works. How can I make the existing function work by not having to pass writers separately. </p>\n"}, {"tags": ["json", "go", "reflection", "struct"], "comments": [{"owner": {"reputation": 7372, "user_id": 412689, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/73160611f90c8c1e1cdc79f43702bda1?s=128&d=identicon&r=PG", "display_name": "Alex Nichol", "link": "https://stackoverflow.com/users/412689/alex-nichol"}, "edited": false, "score": 0, "creation_date": 1487557712, "post_id": 42335433, "comment_id": 71823611, "body": "You should not be using a struct for Item; instead, use a map[string]string. That way, the fields are dynamic (just like they are in JavaScript)."}, {"owner": {"reputation": 7372, "user_id": 412689, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/73160611f90c8c1e1cdc79f43702bda1?s=128&d=identicon&r=PG", "display_name": "Alex Nichol", "link": "https://stackoverflow.com/users/412689/alex-nichol"}, "edited": false, "score": 0, "creation_date": 1487557766, "post_id": 42335433, "comment_id": 71823625, "body": "By the way, it is not possible to add tags at runtime in Go. That&#39;s because, as I said, you should use maps for cases like this."}, {"owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "reply_to_user": {"reputation": 7372, "user_id": 412689, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/73160611f90c8c1e1cdc79f43702bda1?s=128&d=identicon&r=PG", "display_name": "Alex Nichol", "link": "https://stackoverflow.com/users/412689/alex-nichol"}, "edited": false, "score": 0, "creation_date": 1487644540, "post_id": 42335433, "comment_id": 71866133, "body": "thanks u for recommend"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1487642936, "post_id": 42335589, "comment_id": 71865681, "body": "I think i will try to do on your recommend using import github.com/fatih/gomodifytags. The work follow is: use vim to import Item struct into github.com/fatih/gomodifytags, then import github.com/fatih/gomodifytags into my file code.go. Can it will work?"}], "tags": [], "owner": {"reputation": 491, "user_id": 4699030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PtpXlAvuawc/AAAAAAAAAAI/AAAAAAAABgA/eeoUql28GSs/photo.jpg?sz=128", "display_name": "Juan Carlos Garcia", "link": "https://stackoverflow.com/users/4699030/juan-carlos-garcia"}, "is_accepted": false, "score": 2, "last_activity_date": 1487558158, "creation_date": 1487558158, "answer_id": 42335589, "question_id": 42335433, "link": "https://stackoverflow.com/questions/42335433/how-to-add-tags-to-struct-by-function-in-golang/42335589#42335589", "title": "How to add Tags to Struct by function in golang", "body": "<p>As Alex mentions, it is not possible to add tags at runtime. However, Fatih (creator of  the vim extension for go, vim-go) has a cli-tool to modify the tags of a struct. <a href=\"https://github.com/fatih/gomodifytags/blob/master/README.md\" rel=\"nofollow noreferrer\">Here is the repo</a>, maybe it could help you.</p>\n"}], "owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1598, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1487638273, "creation_date": 1487556791, "last_edit_date": 1487638273, "question_id": 42335433, "link": "https://stackoverflow.com/questions/42335433/how-to-add-tags-to-struct-by-function-in-golang", "title": "How to add Tags to Struct by function in golang", "body": "<p>I receive data from REST.body -> encoding data with json.Unmashal to Struct like below then create data to file.txt. Then i can search when file.txt created.\nMy problem: keys in struct too many from 1 - 50 like below. I don't know how to solve it. Some recommend is use map[string]string but i dont wanna change Struct to map.</p>\n\n<pre><code>type Items []Item\n\ntype Item struct {\n    Id        string `json:\"id\"        required:\"true\"`\n    CompCd    string `json:\"compCd\"    required:\"true\"`\n    OrgCd     string `json:\"orgCd\"`\n    QstnId    string `json:\"qstnId\"    required:\"true\"`\n    QstnIdSeq string `json:\"qstnIdSeq\" required:\"true\"`\n    CustId    string `json:\"custId\"`\n    AnsDts    string `json:\"ansDts\"    required:\"true\"`\n    AnsRout   string `json:\"ansRout\"   required:\"true\"`\n    QCd01     string `json:\"qCd01\"`\n    QKey01    string `json:\"qKey01\"`\n    QStc01    string `json:\"qStc01\"`\n    QCat01    string `json:\"qCat01\"`\n    Pont01    string `json:\"pont01\"`\n    PCat01    string `json:\"pCat01\"`\n    Comt01    string `json:\"comt01\"`\n    QCd02     string `json:\"qCd02\"`\n    QKey02    string `json:\"qKey02\"`\n    QStc02    string `json:\"qStc02\"`\n    QCat02    string `json:\"qCat02\"`\n    Pont02    string `json:\"pont02\"`\n    PCat02    string `json:\"pCat02\"`\n    Comt02    string `json:\"comt02\"`\n    .\n    .\n    .\n    QCd50  string `json:\"qCd50\"`\n    QKey50 string `json:\"qKey50\"`\n    QStc50 string `json:\"qStc50\"`\n    QCat50 string `json:\"qCat50\"`\n    Pont50 string `json:\"pont50\"`\n    PCat50 string `json:\"pCat50\"`\n    Comt50 string `json:\"comt50\"`\n}  \n</code></pre>\n"}, {"tags": ["go", "google-cloud-storage", "google-cloud-platform"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1487616286, "post_id": 42335136, "comment_id": 71854994, "body": "As far as the direct question, I don&#39;t think any Go functions allow uploading with the metadata prefix. If you are always expecting a png, just remove the prefix. If you are allowing any type, you will want to parse the prefix, then save it with the correct extension."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1487617086, "post_id": 42335136, "comment_id": 71855376, "body": "It is also important to be aware of the potential sizes of inputs when dealing with files/images. You need to place some upper bound on the sizes of images you allow. If someone decides to rename a 4.7gb iso to png and send it to your endpoint, you don&#39;t want anything to do with it."}, {"owner": {"reputation": 127, "user_id": 6338687, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5fa4cef633e50c700f9ff8df10365491?s=128&d=identicon&r=PG", "display_name": "Victor", "link": "https://stackoverflow.com/users/6338687/victor"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1487830053, "post_id": 42335136, "comment_id": 71963009, "body": "Thanks @RayfenWindspear !!! You are totally write, I&#39;m going to parse the string to use the correct type. In this particular case I&#39;m only receiving pngs, but I will do the write way anyway. Thanks!!"}], "owner": {"reputation": 127, "user_id": 6338687, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5fa4cef633e50c700f9ff8df10365491?s=128&d=identicon&r=PG", "display_name": "Victor", "link": "https://stackoverflow.com/users/6338687/victor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1715, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1487554384, "creation_date": 1487554384, "question_id": 42335136, "link": "https://stackoverflow.com/questions/42335136/google-cloud-storage-image-upload", "title": "Google Cloud Storage Image Upload", "body": "<p>I'm having some minor problems uploading a base64 image to Google Cloud Storage in Golang. I can upload, and it works, but the client must send the image without any extra data, like the example below:</p>\n\n<p><strong><em>Don't work</em></strong>\n<code>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAYAAADgzO9IAAAABGdBTUEAALGPC/xhBQAAAClJREFUCB1jnD59+n8GLIAFJObo6IgitX//fgYmFBEkDukSYDtAZqIDAAh8CBGQqUSHAAAAAElFTkSuQmCC</code></p>\n\n<p><strong><em>Works</em></strong>\n<code>iVBORw0KGgoAAAANSUhEUgAAAAYAAAAGCAYAAADgzO9IAAAABGdBTUEAALGPC/xhBQAAAClJREFUCB1jnD59+n8GLIAFJObo6IgitX//fgYmFBEkDukSYDtAZqIDAAh8CBGQqUSHAAAAAElFTkSuQmCC</code></p>\n\n<p>Is there a way to upload the whole base64 string, including the metadata? Or should I always remove the beginning of the string?</p>\n\n<p>Code below:</p>\n\n<pre><code>func UploadProduct(ctx context.Context, product *Product) error {\n    reader := base64.NewDecoder(base64.StdEncoding, strings.NewReader(product.PhotoURL))\n\n    bucketName, err := file.DefaultBucketName(ctx)\n    if err != nil {\n        return err\n    }\n    client, err := storage.NewClient(ctx)\n    if err != nil {\n        return err\n    }\n    defer client.Close()\n\n    bucket := client.Bucket(bucketName)\n\n    name := product.Name + strconv.Itoa(int(product.Volume)) + \".png\"\n\n    w := bucket.Object(\"products/\" + name).NewWriter(ctx)\n\n    w.ACL = []storage.ACLRule{{Entity: storage.AllUsers, Role: storage.RoleReader}}\n    w.CacheControl = \"public, max-age=86400\"\n\n    if _, err := io.Copy(w, reader); err != nil {\n        return err\n    }\n    if err := w.Close(); err != nil {\n        return err\n    }\n\n    url := \"https://storage.googleapis.com/\" + bucketName + \"/products/\" + name\n    product.PhotoURL = url\n\n    return nil\n}\n</code></pre>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1487581158, "post_id": 42333999, "comment_id": 71832453, "body": "If you don&#39;t want the player to get disconnected, maybe you shouldn&#39;t close the connection."}, {"owner": {"reputation": 640, "user_id": 4663956, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/134cbebab691b3b46e96161ad525ca0d?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime Roussin-B&#233;langer", "link": "https://stackoverflow.com/users/4663956/maxime-roussin-b%c3%a9langer"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1487637169, "post_id": 42333999, "comment_id": 71864066, "body": "If the player leave, I need to close the connection. That&#39;s what it needs to happen."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1487656683, "post_id": 42333999, "comment_id": 71869801, "body": "Don&#39;t use a defer statement to handle the clean up. Defer statements are run at the end of a function call. Which is what is happening in your case.  Your client is connecting, running really quick logic, you think that its waiting  but you spin up a go routine in both your if and else statement, which means there is nothing for your code to wait for and it goes right to the end of your function afterwards, calling the defer statement.  Go routines that aren&#39;t in forever loops or wait groups don&#39;t stop execution. So either, remove the defer, use a channel to trigger that a player has left..ect"}], "owner": {"reputation": 640, "user_id": 4663956, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/134cbebab691b3b46e96161ad525ca0d?s=128&d=identicon&r=PG&f=1", "display_name": "Maxime Roussin-B&#233;langer", "link": "https://stackoverflow.com/users/4663956/maxime-roussin-b%c3%a9langer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487545510, "creation_date": 1487545510, "question_id": 42333999, "link": "https://stackoverflow.com/questions/42333999/keeping-channel-open-waiting-for-another-player", "title": "Keeping channel open, waiting for another player", "body": "<p>I have a TCP server, and I need to keep the connection open until a another player connects. I'm creating a ticker so that I can send a message to the player so that he knows the server is waiting on another player to connect. </p>\n\n<p>The problem is that the player that connects get instant disconnect because of the defer func(). How can I make it that the player waiting isn't getting instant disconnect?</p>\n\n<pre><code>func handleConnection(c net.Conn, msgchan chan&lt;- string, addchan chan&lt;- Client, rmchan chan&lt;- Client) {\n    bufc := bufio.NewReader(c)\n    defer c.Close()\n    client := Client{\n        conn:     c,\n        nickname: promptNick(c, bufc),\n        ch:       make(chan string),\n        game:     nil,\n    }\n    // Register user\n    addchan &lt;- client\n\n    defer func() {\n        msgchan &lt;- fmt.Sprintf(\"User %s left the game room.\\n\", client.nickname)\n        log.Printf(\"Connection from %v closed.\\n\", c.RemoteAddr())\n        rmchan &lt;- client\n    }()\n    io.WriteString(c, fmt.Sprintf(\"Welcome, %s!\\n\\n\", client.nickname))\n    msgchan &lt;- fmt.Sprintf(\"New user %s has joined the game room.\\n\", client.nickname)\n\n// Here the magic I'm trying to make work\n\n    quit := make(chan struct{})\n\nif len(clients) != 0 &amp;&amp; len(clients)%2 == 0 {\n    close(quit)\n    var black *Client\n    var white *Client\n\n    for _, player := range clients {\n        if player.game == nil &amp;&amp; black == nil {\n            black = player\n        } else if player.game == nil &amp;&amp; white == nil {\n            white = player\n        }\n\n        if black != nil &amp;&amp; white != nil {\n            black.ch &lt;- \"New game started, you are matched with \" + white.nickname\n            white.ch &lt;- \"New game started, you are matched with \" + black.nickname\n            newGame(black, white)\n            break\n        }\n    }\n    go client.ReadMove(msgchan)\n    client.WriteLinesFrom(client.ch)\n} else {\n    ticker := time.NewTicker(5 * time.Second)\n    go func() {\n        for {\n            select {\n            case &lt;-ticker.C:\n                client.ch &lt;- \"Waiting for another player to connect...\\n\"\n            case &lt;-quit:\n                ticker.Stop()\n                return\n            }\n        }\n    }()\n}\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 3, "creation_date": 1487542772, "post_id": 42333488, "comment_id": 71819549, "body": "Of course it&#39;s not a <i>coincidence</i>, they are both named that for a good reason."}], "answers": [{"comments": [{"owner": {"reputation": 1275, "user_id": 1621584, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8b6a478246788ac00b9d365390af5ec5?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/1621584/jeff"}, "edited": false, "score": 2, "creation_date": 1528221120, "post_id": 42333700, "comment_id": 88421412, "body": "But what of func main() in files which are in some package other than main?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1275, "user_id": 1621584, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8b6a478246788ac00b9d365390af5ec5?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/1621584/jeff"}, "edited": false, "score": 0, "creation_date": 1528222284, "post_id": 42333700, "comment_id": 88422000, "body": "@Jeff If the package is not <code>main</code>, then the function is not the application entry point.  It&#39;s just a function named <code>main</code>."}, {"owner": {"reputation": 1275, "user_id": 1621584, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8b6a478246788ac00b9d365390af5ec5?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/1621584/jeff"}, "edited": false, "score": 1, "creation_date": 1528223123, "post_id": 42333700, "comment_id": 88422429, "body": "Okay, is naming a function main() outside of the main package unusual practice or does it signify intent? Afaict, in the case I am seeing, the code somehow gets built into something that can be invoked from the command line."}, {"owner": {"reputation": 1041, "user_id": 5419599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/SbCyV.png?s=128&g=1", "display_name": "Wildcard", "link": "https://stackoverflow.com/users/5419599/wildcard"}, "edited": false, "score": 0, "creation_date": 1547596180, "post_id": 42333700, "comment_id": 95243525, "body": "It seems this was asked separately (<a href=\"https://stackoverflow.com/q/50706238/5419599\">stackoverflow.com/q/50706238/5419599</a>) but still isn&#39;t clear as to whether it&#39;s a bad idea, an antipattern, or something that no one cares about."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 32, "last_activity_date": 1547597131, "last_edit_date": 1547597131, "creation_date": 1487543362, "answer_id": 42333700, "question_id": 42333488, "link": "https://stackoverflow.com/questions/42333488/package-main-and-func-main/42333700#42333700", "title": "Package &quot;main&quot; and func &quot;main&quot;", "body": "<p>The entry point for the application is the <code>main</code> function in the <code>main</code> package   <a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"noreferrer\">as described in the specification</a>:</p>\n\n<blockquote>\n  <p>A complete program is created by linking a single, unimported package called the <em>main package</em> with all the packages it imports, transitively. The main package must have package name <code>main</code> and declare a function <code>main</code> that takes no arguments and returns no value.</p>\n\n<pre><code>func main() { \u2026 }\n</code></pre>\n  \n  <p>Program execution begins by initializing the main package and then invoking the function <code>main</code>. When that function invocation returns, the program exits. It does not wait for other (non-main) goroutines to complete.</p>\n</blockquote>\n\n<p>The language specification does not give special meaning to the name <code>main</code> outside of this context. The name <code>main</code> is not a reserved name. </p>\n\n<p>It's OK to declare a <code>main</code> function in non-main packages. In such cases, it's just a function named <code>main</code>.</p>\n"}], "owner": {"reputation": 608, "user_id": 1368561, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fHj5Q.png?s=128&g=1", "display_name": "mnemotronic", "link": "https://stackoverflow.com/users/1368561/mnemotronic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15306, "favorite_count": 5, "accepted_answer_id": 42333700, "answer_count": 1, "score": 27, "last_activity_date": 1547597131, "creation_date": 1487542083, "last_edit_date": 1487599080, "question_id": 42333488, "link": "https://stackoverflow.com/questions/42333488/package-main-and-func-main", "title": "Package &quot;main&quot; and func &quot;main&quot;", "body": "<p>The intro/sample go progs I've seen and experimented with start with</p>\n\n<pre><code>package main\n</code></pre>\n\n<p>and have</p>\n\n<pre><code>func main()\n</code></pre>\n\n<p>Is there any relationship between the \"main\" in the package line and the \"main\" in the func line?  I'm guessing not. C/C++ uses the same \"main\" entry point.  Just want to make sure though.  I haven't seen any docs that say the use of \"main\" is just a coincidence.</p>\n"}, {"tags": ["testing", "go", "mocking", "gomock"], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 2, "last_activity_date": 1531845357, "creation_date": 1531845357, "answer_id": 51386381, "question_id": 42333303, "link": "https://stackoverflow.com/questions/42333303/which-directory-to-put-mocks/51386381#51386381", "title": "Which directory to put mocks?", "body": "<p>I tend to follow this article also by Ben Johnson</p>\n\n<p><a href=\"https://medium.com/@benbjohnson/standard-package-layout-7cdbc8391fc1\" rel=\"nofollow noreferrer\">Link to article</a></p>\n\n<p>In general this approach of having a package for your shared mocks is a good one. One thing worth pointing out here is that if you don't define your models outside of the <code>gateways</code> package you could get an import cycle.</p>\n\n<ol>\n<li><code>gateways</code> defines models </li>\n<li><code>mocks</code> imports <code>gateways.Model</code></li>\n<li><code>gateways</code> imports <code>mocks</code> for tests</li>\n</ol>\n\n<p>There are 2 ways to fix this; the first is just to move your models into <code>domain</code>, a root package outside <code>gateways</code> (see article for examples). Or only test the public interface of your <code>gateways</code> package by using <code>gateways_test</code> as the package in your test files.</p>\n"}], "owner": {"reputation": 16096, "user_id": 2014591, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7d6cff955bb3f1865a419650bfe1372c?s=128&d=identicon&r=PG", "display_name": "hlin117", "link": "https://stackoverflow.com/users/2014591/hlin117"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2030, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1531845357, "creation_date": 1487540819, "last_edit_date": 1487599099, "question_id": 42333303, "link": "https://stackoverflow.com/questions/42333303/which-directory-to-put-mocks", "title": "Which directory to put mocks?", "body": "<p>I've been most recently experimenting with <a href=\"https://github.com/golang/mock\" rel=\"nofollow noreferrer\"><code>GoMock</code></a>, the test mocking framework supported by the official creators of the Go language. I was wondering where is the most reasonable place to put these mocked files.</p>\n\n<p>My current directory structure is as follows. Is this how Go projects should be structured?</p>\n\n<pre><code>appname\n|-- gateways\n    |-- gateway1.go\n    |-- gateway1_test.go\n    |-- gateway2.go\n    |-- gateway2_test.go\n    |-- mocks\n        |-- gateway1.go\n        |-- gateway2.go\n</code></pre>\n\n<p>This is slightly influenced by Ben Johnson's talk <a href=\"https://go-talks.appspot.com/github.com/benbjohnson/structuring-applications-for-growth/main.slide#1\" rel=\"nofollow noreferrer\">here</a>. </p>\n"}, {"tags": ["go", "hashmap", "object-pooling"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 3, "last_activity_date": 1487577393, "last_edit_date": 1487577393, "creation_date": 1487538655, "answer_id": 42332923, "question_id": 42332883, "link": "https://stackoverflow.com/questions/42332883/pooling-maps-in-golang/42332923#42332923", "title": "Pooling Maps in Golang", "body": "<p>If your maps change (a lot) in size by deleting or adding entries this will cause new allocations and there will be no benefit of pooling them.</p>\n\n<p>If your maps will not change in size but only the values of the keys will change then pooling will be a successful optimization.</p>\n\n<p>This will work well when you read table-like structures, for instance CSV files or database tables. Each row will contain exactly the same columns, so you don't need to clear any entry. </p>\n\n<p>The benchmark below shows no allocation when run with <code>go test -benchmem -bench .</code> to</p>\n\n<pre><code>package mappool\n\nimport \"testing\"\n\nconst SIZE = 1000000\n\nfunc BenchmarkMap(b *testing.B) {\n    m := make(map[int]int)\n\n    for i := 0; i &lt; SIZE; i++ {\n        m[i] = i\n    }\n\n    b.ResetTimer()\n\n    for i := 0; i &lt; b.N; i++ {\n        for i := 0; i &lt; SIZE; i++ {\n            m[i] = m[i] + 1\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7372, "user_id": 412689, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/73160611f90c8c1e1cdc79f43702bda1?s=128&d=identicon&r=PG", "display_name": "Alex Nichol", "link": "https://stackoverflow.com/users/412689/alex-nichol"}, "is_accepted": false, "score": 2, "last_activity_date": 1487539316, "creation_date": 1487539316, "answer_id": 42333034, "question_id": 42332883, "link": "https://stackoverflow.com/questions/42332883/pooling-maps-in-golang/42333034#42333034", "title": "Pooling Maps in Golang", "body": "<p>Like @Grzegorz \u017bur says, if your maps don't change in size very much, then pooling is helpful. To test this, I made a benchmark where pooling wins out. The output on my machine is:</p>\n\n<pre><code>Pool time: 115.977\u00b5s\nNo-pool time: 160.828\u00b5s\n</code></pre>\n\n<p>Benchmark code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nconst BenchIters = 1000\n\nfunc main() {\n    pool := map[int]int{}\n    poolTime := benchmark(func() {\n        useMapForSomething(pool)\n\n        // Return to pool by clearing the map.\n        for key := range pool {\n            delete(pool, key)\n        }\n    })\n\n    nopoolTime := benchmark(func() {\n        useMapForSomething(map[int]int{})\n    })\n\n    fmt.Println(\"Pool time:\", poolTime)\n    fmt.Println(\"No-pool time:\", nopoolTime)\n}\n\nfunc useMapForSomething(m map[int]int) {\n    for i := 0; i &lt; 1000; i++ {\n        m[rand.Intn(300)] += 5\n    }\n}\n\n// benchmark measures how long f takes, on average.\nfunc benchmark(f func()) time.Duration {\n    start := time.Now().UnixNano()\n    for i := 0; i &lt; BenchIters; i++ {\n        f()\n    }\n    return time.Nanosecond * time.Duration((time.Now().UnixNano()-start)/BenchIters)\n}\n</code></pre>\n"}], "owner": {"reputation": 1155, "user_id": 4641854, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ebe283afcbdb0e4a9d1f20e26e969de1?s=128&d=identicon&r=PG", "display_name": "jeromefroe", "link": "https://stackoverflow.com/users/4641854/jeromefroe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1339, "favorite_count": 2, "accepted_answer_id": 42332923, "answer_count": 2, "score": 2, "last_activity_date": 1487577393, "creation_date": 1487538441, "last_edit_date": 1495540398, "question_id": 42332883, "link": "https://stackoverflow.com/questions/42332883/pooling-maps-in-golang", "title": "Pooling Maps in Golang", "body": "<p>I was curious if anyone has tried to <a href=\"https://golang.org/pkg/sync/#example_Pool\" rel=\"nofollow noreferrer\">pool</a> maps in Go before? I've read about <a href=\"https://elithrar.github.io/article/using-buffer-pools-with-go/\" rel=\"nofollow noreferrer\">pooling buffers</a> previously, and I was wondering if by similar reasoning it could make sense to pool maps if one has to create and destroy them frequently or if there was any reason why, a priori, it might not be efficient. When a map is returned to the pool, one would have to iterate through it and delete all elements, but it seems a popular recommendation is to <a href=\"https://stackoverflow.com/questions/13812121/how-to-clear-a-map-in-go\">create a new map instead of deleting the entries in a map which has already been allocated and reusing it</a> which makes me think that pooling maps may not be as beneficial. </p>\n"}, {"tags": ["google-app-engine", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 48, "user_id": 4266494, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-CrRyS4Bt_qc/AAAAAAAAAAI/AAAAAAAACE0/nYRCJFzoEPw/photo.jpg?sz=128", "display_name": "zadkiel", "link": "https://stackoverflow.com/users/4266494/zadkiel"}, "is_accepted": false, "score": 0, "last_activity_date": 1487627031, "last_edit_date": 1495535377, "creation_date": 1487627031, "answer_id": 42354755, "question_id": 42332800, "link": "https://stackoverflow.com/questions/42332800/gorm-cloud-sql-connection-on-app-engine-using-go/42354755#42354755", "title": "GORM Cloud SQL Connection on App Engine Using Go", "body": "<p>This is due to the call to log.New in this file: <a href=\"https://github.com/jinzhu/gorm/blob/master/logger.go#L15\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/blob/master/logger.go#L15</a></p>\n\n<p>This anwser explain why dev_appserver.py gets it: <a href=\"https://stackoverflow.com/a/24112953/4266494\">https://stackoverflow.com/a/24112953/4266494</a></p>\n\n<p>To disable this, you can either disable all GORM logging:</p>\n\n<pre><code>db.LogMode(false)\n</code></pre>\n\n<p>Or use an adapter the logger output: <a href=\"https://github.com/benguild/GAEBridge/blob/master/log/debugLevel.go\" rel=\"nofollow noreferrer\">https://github.com/benguild/GAEBridge/blob/master/log/debugLevel.go</a></p>\n\n<pre><code>db.SetLogger(NewDebugLogger(nil)) // on application scope\ndb.SetLogger(NewDebugLogger(appengine.NewContext(req))) // on request scope\n</code></pre>\n\n<p>I'm setting a new logger with the real context \nThis is the only workaround I found to avoid crashes while keeping some logs, it could be awesome if one of you had a real one.</p>\n"}], "owner": {"reputation": 1037, "user_id": 1236977, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/19c58e7617b0549886e7a1c081998ea9?s=128&d=identicon&r=PG", "display_name": "scriptdiddy", "link": "https://stackoverflow.com/users/1236977/scriptdiddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 687, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1527757112, "creation_date": 1487537958, "last_edit_date": 1527757112, "question_id": 42332800, "link": "https://stackoverflow.com/questions/42332800/gorm-cloud-sql-connection-on-app-engine-using-go", "title": "GORM Cloud SQL Connection on App Engine Using Go", "body": "<p>I'm trying to connect to a Cloud SQL database using GORM in golang. </p>\n\n<pre><code>db, _ = gorm.Open(\"mysql\", \"user:pass@cloudsql(connection:name:example)/\")\nif err != nil {\n        log.Println(err)\n        //panic(err)\n    }\n</code></pre>\n\n<p>When I attempt to serve the app</p>\n\n<pre><code>goapp serve appengine/\n</code></pre>\n\n<p>I get a runtime error</p>\n\n<pre><code>ERROR    2017-02-19 20:48:05,436 http_runtime.py:396] bad runtime process port ['\\r\\n']\n</code></pre>\n\n<p>Which I found was related to the database migration</p>\n\n<pre><code>db.AutoMigrate(&amp;models.Event{})\n</code></pre>\n\n<p>If I remove the AutoMigrate, the runtime process port error goes away. However whenever I access a route (ie /events) that does a database query, the connection gets dropped, a 404 page is thrown, and an error message is logged <code>sql: database is closed</code></p>\n\n<p>When I run the app locally by building the package <code>go build &amp;&amp; ./appname</code> and using a local MySQL server, it works fine.</p>\n\n<p>Can someone please tell me how to connect to a Cloud SQL database using Go's GORM framework and App Engine?</p>\n"}, {"tags": ["go", "goland"], "answers": [{"tags": [], "owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "is_accepted": false, "score": 2, "last_activity_date": 1487530861, "creation_date": 1487530861, "answer_id": 42331500, "question_id": 42331452, "link": "https://stackoverflow.com/questions/42331452/how-to-configure-gopath/42331500#42331500", "title": "How to configure GOPATH?", "body": "<p>You need to set the <code>GOPATH</code> environment variable. How you do this varies depending on your operating system.</p>\n\n<p>Here are examples of <a href=\"https://www.java.com/en/download/help/path.xml\" rel=\"nofollow noreferrer\">how to set the PATH environment variable</a>, just modify the instructions to set <code>GOPATH</code> instead.</p>\n\n<p>Also see <a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"nofollow noreferrer\">How to Write Go Code</a> for more details on setting up your workspace and setting <code>GOPATH</code>.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1529891"}, "is_accepted": false, "score": 4, "last_activity_date": 1487531135, "creation_date": 1487531135, "answer_id": 42331547, "question_id": 42331452, "link": "https://stackoverflow.com/questions/42331452/how-to-configure-gopath/42331547#42331547", "title": "How to configure GOPATH?", "body": "<p><a href=\"https://beta.golang.org/doc/go1.8#gopath\" rel=\"nofollow noreferrer\">You actually do not need to set the <code>GOPATH</code> environment variable; in Go 1.8 it's <code>~/go</code> by default.</a></p>\n\n<p>I suggest that you just update to latest stable Go (1.8) and use that convention; otherwise you'll need to set the <code>GOPATH</code> variable in your environment.</p>\n"}, {"tags": [], "owner": {"reputation": 4902, "user_id": 6683139, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/EOrQR.jpg?s=128&g=1", "display_name": "Ege Kuzubasioglu", "link": "https://stackoverflow.com/users/6683139/ege-kuzubasioglu"}, "is_accepted": true, "score": 1, "last_activity_date": 1487532610, "creation_date": 1487532610, "answer_id": 42331836, "question_id": 42331452, "link": "https://stackoverflow.com/questions/42331452/how-to-configure-gopath/42331836#42331836", "title": "How to configure GOPATH?", "body": "<pre><code>export GOROOT=\"\"   \n</code></pre>\n\n<p>solved the issue for some reason.</p>\n"}], "owner": {"reputation": 4902, "user_id": 6683139, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/EOrQR.jpg?s=128&g=1", "display_name": "Ege Kuzubasioglu", "link": "https://stackoverflow.com/users/6683139/ege-kuzubasioglu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1730, "favorite_count": 0, "accepted_answer_id": 42331836, "answer_count": 3, "score": 1, "last_activity_date": 1509821816, "creation_date": 1487530668, "last_edit_date": 1509821816, "question_id": 42331452, "link": "https://stackoverflow.com/questions/42331452/how-to-configure-gopath", "title": "How to configure GOPATH?", "body": "<p>I installed Goland as a Go IDE and it wants me to configure GOPATH. I'm new in this language so I don't know what to do. Here is the error message:</p>\n\n<blockquote>\n  <p>GOPATH was detected\n              We've detected some libraries from your GOPATH.\n              You may want to add extra libraries in GOPATH configuration.</p>\n</blockquote>\n\n<p>Edit: Not a duplicate question, <code>export GOROOT=\"\"</code>solved my problem. Thanks anyway.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1487599302, "post_id": 42331272, "comment_id": 71844377, "body": "Structs defined within functions <i>cannot</i> be shared with other functions. They must be defined at the package level. But your code doesn&#39;t show you doing either of those things. So I really have no idea what you&#39;re asking."}], "answers": [{"tags": [], "owner": {"reputation": 666, "user_id": 4061068, "user_type": "registered", "accept_rate": 31, "profile_image": "https://graph.facebook.com/1342754480/picture?type=large", "display_name": "Andrius Solopovas", "link": "https://stackoverflow.com/users/4061068/andrius-solopovas"}, "is_accepted": false, "score": 0, "last_activity_date": 1487530830, "creation_date": 1487530830, "answer_id": 42331494, "question_id": 42331272, "link": "https://stackoverflow.com/questions/42331272/create-struct-in-one-function-to-be-used-in-another/42331494#42331494", "title": "Create struct in one function to be used in another", "body": "<p>Ok, I think I figured it out. The problem wash that I had to use First Capital letters to be able to access this return struct in another function. </p>\n\n<p>File 1 main.go </p>\n\n<pre><code>func main { \n   fl := GetFlags()\n   fmt.Pringln(fl.User)\n}\n</code></pre>\n\n<p>File 2 flags.go</p>\n\n<pre><code>type Flags struct {\n    User     string\n}\n\nfunc GetFlags() Flags {\n    var userFlag string\n    flag.StringVar(&amp;userFlag, \"u\", \"\", \"\")\n    flag.StringVar(&amp;userFlag, \"user\", \"\", \"\")\n    flag.Parse()\n\n    fl := Flags{\n       User: userFlag,\n    }\n\n    fmt.Println(fl.user) // works as expected\n\n    return fl\n\n}\n</code></pre>\n"}], "owner": {"reputation": 666, "user_id": 4061068, "user_type": "registered", "accept_rate": 31, "profile_image": "https://graph.facebook.com/1342754480/picture?type=large", "display_name": "Andrius Solopovas", "link": "https://stackoverflow.com/users/4061068/andrius-solopovas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1487530950, "creation_date": 1487529685, "last_edit_date": 1487530950, "question_id": 42331272, "link": "https://stackoverflow.com/questions/42331272/create-struct-in-one-function-to-be-used-in-another", "title": "Create struct in one function to be used in another", "body": "<p>I am new to Golang and still trying to get my head around structs. I can't seem to figure out how to and create it in one function and use it in another. </p>\n\n<p>Here is my code. </p>\n\n<p>File 1 main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/asolopovas/docker_valet/modules\"\n    \"fmt\"\n)\nfunc main { \n   fl := dockervalet.GetFlags()\n   fmt.Pringln(fl.user) // returns fl.user undefined \n}\n</code></pre>\n\n<p>File 2 flags.go</p>\n\n<pre><code>package dockervalet\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\ntype Flags struct {\n    user     string\n}\n\nfunc GetFlags() Flags {\n    var userFlag string\n    flag.StringVar(&amp;userFlag, \"u\", \"\", \"\")\n    flag.StringVar(&amp;userFlag, \"user\", \"\", \"\")\n    flag.Parse()\n\n    fl := Flags{\n       user: userFlag,\n    }\n\n    fmt.Println(fl.user) // works as expected\n\n    return fl\n\n}\n</code></pre>\n\n<p>Thanks in advance. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11, "user_id": 2336388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0SAAY.png?s=128&g=1", "display_name": "Diogo Ribeiro", "link": "https://stackoverflow.com/users/2336388/diogo-ribeiro"}, "edited": false, "score": 0, "creation_date": 1487641361, "post_id": 42331078, "comment_id": 71865245, "body": "I couldn&#39;t find any error. Besides it works if I run it on go playground <a href=\"https://play.golang.org/p/udPQ_TayXG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/udPQ_TayXG</a>"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 2336388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0SAAY.png?s=128&g=1", "display_name": "Diogo Ribeiro", "link": "https://stackoverflow.com/users/2336388/diogo-ribeiro"}, "is_accepted": false, "score": 0, "last_activity_date": 1488560556, "creation_date": 1488560556, "answer_id": 42584631, "question_id": 42331078, "link": "https://stackoverflow.com/questions/42331078/unexpected-end-of-json-input-while-unmarshal-to-struct/42584631#42584631", "title": "unexpected end of JSON input while unmarshal to struct", "body": "<p>I found some help on golang-nuts group. You can check the answer here <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/SZXBcXgUoo0\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/golang-nuts/SZXBcXgUoo0</a>. To make a long story short, the problem was with my structures, I've built structures only for a small piece of the whole json, so I fixed it building structures for the whole json response.</p>\n"}], "owner": {"reputation": 11, "user_id": 2336388, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0SAAY.png?s=128&g=1", "display_name": "Diogo Ribeiro", "link": "https://stackoverflow.com/users/2336388/diogo-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1982, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488560556, "creation_date": 1487528631, "question_id": 42331078, "link": "https://stackoverflow.com/questions/42331078/unexpected-end-of-json-input-while-unmarshal-to-struct", "title": "unexpected end of JSON input while unmarshal to struct", "body": "<p>Could you help me to understand why I'm always getting the error <code>unexpected end of JSON input</code> while trying to unmarshal the following json to the <code>LimitOrder</code> struct?</p>\n\n<p>P.S.: if I use <code>map[string]json.RawMessage</code> instead of <code>LimitOrder</code> struct I'm able to execute the unmarshal.</p>\n\n<pre><code>{\n  \"response_data\": {\n    \"order\": {\n      \"order_id\": 3,\n      \"coin_pair\": \"BRLBTC\",\n      \"order_type\": 1,\n      \"status\": 4,\n      \"has_fills\": true,\n      \"quantity\": \"1.00000000\",\n      \"limit_price\": \"900.00000\",\n      \"executed_quantity\": \"1.00000000\",\n      \"executed_price_avg\": \"900.00000\",\n      \"fee\": \"0.00300000\",\n      \"created_timestamp\": \"1453835329\",\n      \"updated_timestamp\": \"1453835329\",\n      \"operations\": [\n        {\n          \"operation_id\": 1,\n          \"quantity\": \"1.00000000\",\n          \"price\": \"900.00000\",\n          \"fee_rate\": \"0.30\",\n          \"executed_timestamp\": \"1453835329\"\n        }\n      ]\n    }\n  },\n  \"status_code\": 100,\n  \"server_unix_timestamp\": \"1453835329\"\n}\n</code></pre>\n\n<p><strong>LimitOrder struct</strong></p>\n\n<pre><code>type LimitOrder struct {\n  OrderId int `json:\"order_id\"`\n  CoinPair string `json:\"coin_pair\"`\n  OrderType int `json:\"order_type\"`\n  Status int `json:\"status\"`\n  HasFills bool `json:\"has_fills\"`\n  Quantity float64 `json:\"quantity,string\"`\n  LimitPrice float64 `json:\"limit_price,string\"`\n  ExecutedQuantity float64 `json:\"executed_quantity,string\"`\n  ExecutedPriceAvg float64 `json:\"executed_price_avg,string\"`\n  Fee float64 `json:\"fee,string\"`\n  Operations []*Operation `json:\"operations\"`\n  CreatedTimestamp string `json:\"created_timestamp\"`\n  UpdatedTimestamp string `json:\"updated_timestamp\"`\n}\n</code></pre>\n\n<p>and this is how I'm trying to unmarshal it</p>\n\n<pre><code>func (limitOrder *LimitOrder) UnmarshalJSON(buf []byte) error {\n\n  tmp := make(map[string]json.RawMessage)\n  if err := json.Unmarshal(buf, &amp;tmp); err != nil {\n    return err\n  }\n\n  tmp2 := make(map[string]json.RawMessage)\n\n  if err := json.Unmarshal(tmp[\"response_data\"], &amp;tmp2); err != nil {\n    return err\n  }\n\n  if err := json.Unmarshal(tmp2[\"order\"], limitOrder); err != nil {\n    return err\n  }\n\n  return nil\n}\n</code></pre>\n"}, {"tags": ["go", "biginteger"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 3, "last_activity_date": 1487523064, "last_edit_date": 1487523064, "creation_date": 1487522509, "answer_id": 42329909, "question_id": 42328905, "link": "https://stackoverflow.com/questions/42328905/golang-weird-big-int-behavior-for-small-number-of-bits/42329909#42329909", "title": "Golang weird big.Int behavior for small number of bits", "body": "<p>big.Int is a struct containing <a href=\"https://golang.org/src/math/big/nat.go\" rel=\"nofollow noreferrer\">nat</a>, which is defined as <code>type nat []Word</code>\nso, while you are indeed copying the big.Int, the slice inside it is effectively a shallow copy (underlying storage for slice is same)</p>\n\n<p>For why the bigger bit widths don't exhibit the problem, not sure.  </p>\n\n<p>Possibly it requires a reallocation somewhere and that creates a new <code>[]Word</code> thereby leaving the original in tact.</p>\n\n<p>This is also probably why the stdlib generally returns *big.Int, since a value isn't really copyable</p>\n\n<p>here's a version <a href=\"https://play.golang.org/p/xZtt_AiYEl\" rel=\"nofollow noreferrer\">on play</a> that properly copies the big.Int values.\nThe key difference being:</p>\n\n<pre><code>a := new(big.Int).Set(x)\nb := new(big.Int).Set(y)\n</code></pre>\n\n<p>(and using pointers in general as values aren't particularly useful)</p>\n"}], "owner": {"reputation": 1, "user_id": 5538304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f7b82598e4879e647e08f1d5d574a52?s=128&d=identicon&r=PG&f=1", "display_name": "TheWallA07", "link": "https://stackoverflow.com/users/5538304/thewalla07"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 42329909, "answer_count": 1, "score": -1, "last_activity_date": 1487523064, "creation_date": 1487517280, "question_id": 42328905, "link": "https://stackoverflow.com/questions/42328905/golang-weird-big-int-behavior-for-small-number-of-bits", "title": "Golang weird big.Int behavior for small number of bits", "body": "<p>I am trying to calculate the GCD of two numbers via the Euclidean method, and noticed weird behavior. Although I am passing the value of the number to the function, the numbers are modified by the function for numbers with low number of bits (usually less than 64). Could anyone clarify if this is a mistake on my behalf or is it expected behavior? You can check the code in the playground here: <a href=\"https://play.golang.org/p/BIoZO1QWpV\" rel=\"nofollow noreferrer\">Golang playground example</a></p>\n\n<p>I thought the expected behavior is that no values should be changed by passing them to my functions. Thanks for any help, I couldn't find any other occurrences like this in the last day of searching.</p>\n"}, {"tags": ["iis", "go"], "comments": [{"owner": {"reputation": 405, "user_id": 1044198, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9319264a4bf0800afa0c428ed30a4620?s=128&d=identicon&r=PG", "display_name": "miloshavlicek", "link": "https://stackoverflow.com/users/1044198/miloshavlicek"}, "edited": false, "score": 0, "creation_date": 1487528061, "post_id": 42327117, "comment_id": 71814401, "body": "Issue seems to be caused by quotation marks in /site.name argument (&quot;My website&quot;). See <a href=\"http://www.josephspurrier.com/prevent-escaping-exec-command-arguments-in-go/\" rel=\"nofollow noreferrer\">josephspurrier.com/&hellip;</a> and issue on Github <a href=\"https://github.com/golang/go/issues/15566\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/15566</a>"}], "answers": [{"tags": [], "owner": {"reputation": 405, "user_id": 1044198, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9319264a4bf0800afa0c428ed30a4620?s=128&d=identicon&r=PG", "display_name": "miloshavlicek", "link": "https://stackoverflow.com/users/1044198/miloshavlicek"}, "is_accepted": true, "score": 0, "last_activity_date": 1487531531, "last_edit_date": 1495539970, "creation_date": 1487531531, "answer_id": 42331634, "question_id": 42327117, "link": "https://stackoverflow.com/questions/42327117/iis-appcmd-called-via-go-app-invalid-xml-input/42331634#42331634", "title": "IIS appcmd called via Go app - Invalid XML input", "body": "<p>It seems to be a bug in golang library - related to <a href=\"https://github.com/golang/go/issues/15566\" rel=\"nofollow noreferrer\">a Golang Github issue #15566</a>.</p>\n\n<p>Issue is caused by quotation marks in /site.name argument (\"My website\") which are escaped, but should not be.</p>\n\n<p>Solution for this time is this:</p>\n\n<pre><code>import \"os/exec\"\nimport \"syscall\"\n...\ncmd := exec.Command(`cmd`)\ncmd.SysProcAttr = &amp;syscall.SysProcAttr{\n  CmdLine: `/C %windir%\\system32\\inetsrv\\appcmd list APP /site.name:\"My website\" /text:[path='/'].physicalPath`,\n}\nout, err := cmd.Output()\n</code></pre>\n\n<p>For more information see: <a href=\"http://www.josephspurrier.com/prevent-escaping-exec-command-arguments-in-go/\" rel=\"nofollow noreferrer\">http://www.josephspurrier.com/prevent-escaping-exec-command-arguments-in-go/</a> and <a href=\"https://stackoverflow.com/questions/28954729/exec-with-double-quoted-argument\">exec with double quoted argument</a></p>\n"}, {"comments": [{"owner": {"reputation": 1617, "user_id": 8769328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/893c61079c7f944dbb51d3e3f211441c?s=128&d=identicon&r=PG&f=1", "display_name": "Jeremy Walters", "link": "https://stackoverflow.com/users/8769328/jeremy-walters"}, "edited": false, "score": 0, "creation_date": 1547827170, "post_id": 54257138, "comment_id": 95339038, "body": "Thank you for the answer, please provide the changes in code <a href=\"https://meta.stackexchange.com/questions/22186/how-do-i-format-my-code-blocks\">block</a> so the people could see more clearly what you have changed. Thank you"}], "tags": [], "owner": {"reputation": 1, "user_id": 10934260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/87a4fe095cf95f4fbdc863504bb65815?s=128&d=identicon&r=PG&f=1", "display_name": "Mayur Gogia", "link": "https://stackoverflow.com/users/10934260/mayur-gogia"}, "is_accepted": false, "score": -1, "last_activity_date": 1547825988, "creation_date": 1547825988, "answer_id": 54257138, "question_id": 42327117, "link": "https://stackoverflow.com/questions/42327117/iis-appcmd-called-via-go-app-invalid-xml-input/54257138#54257138", "title": "IIS appcmd called via Go app - Invalid XML input", "body": "<p>I just deleted all carriage returns in xml </p>\n\n<p>and removed Tag \n. </p>\n\n<p>And </p>\n\n<p>appcmd add apppool /in &lt; C:\\Installs\\AppPool.xml</p>\n\n<p>worked for me.</p>\n"}], "owner": {"reputation": 405, "user_id": 1044198, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9319264a4bf0800afa0c428ed30a4620?s=128&d=identicon&r=PG", "display_name": "miloshavlicek", "link": "https://stackoverflow.com/users/1044198/miloshavlicek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1446, "favorite_count": 0, "accepted_answer_id": 42331634, "answer_count": 2, "score": 0, "last_activity_date": 1547825988, "creation_date": 1487506659, "last_edit_date": 1487520073, "question_id": 42327117, "link": "https://stackoverflow.com/questions/42327117/iis-appcmd-called-via-go-app-invalid-xml-input", "title": "IIS appcmd called via Go app - Invalid XML input", "body": "<p>I have this command, which works when running in command line directly.</p>\n\n<pre><code>import \"os/exec\"\n...\nout, err := exec.Command(\"cmd\", \"/C\", `%windir%\\system32\\inetsrv\\appcmd list APP /site.name:\"My website\" /text:[path='/'].physicalPath`).Output()\n</code></pre>\n\n<p>When I run it via Go app, it throws <b>exit status 3222072890</b> with this error message:</p>\n\n<pre><code>Failed to process input: Invalid XML input - please make sure that your XML is well-formed and follows the required format (HRESULT=c00cee3a).\n</code></pre>\n\n<p>I've already tried to change slashes, use various quotation marks, but still does not work.</p>\n\n<p>I use <b>IIS 8.5</b> on Windows Server 2012 R2.</p>\n\n<p>It seems that command is corrupted before execution. Is there any way how to see the output command?</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 4, "last_activity_date": 1487504601, "creation_date": 1487504601, "answer_id": 42326810, "question_id": 42326753, "link": "https://stackoverflow.com/questions/42326753/runtime-error-invalid-memory-address-or-nil-pointer-dereference-in-public-point/42326810#42326810", "title": "runtime error: invalid memory address or nil pointer dereference in public pointer", "body": "<pre><code>Config := &amp;Configuration{conn}\n</code></pre>\n\n<p>This line creates a new <strong>local</strong> variable <code>Config</code> so the global <code>Config</code> is never set to anything. Drop the <code>:</code> to not create a new variable and use the global <code>Config</code> instead.</p>\n"}, {"tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": false, "score": 1, "last_activity_date": 1487506116, "last_edit_date": 1495540821, "creation_date": 1487506116, "answer_id": 42327033, "question_id": 42326753, "link": "https://stackoverflow.com/questions/42326753/runtime-error-invalid-memory-address-or-nil-pointer-dereference-in-public-point/42327033#42327033", "title": "runtime error: invalid memory address or nil pointer dereference in public pointer", "body": "<p>You're getting this problem because your <code>Config</code> global variable is not set or still hold nil value. as the error said : </p>\n\n<blockquote>\n  <p>runtime error: invalid memory address or nil pointer dereference</p>\n</blockquote>\n\n<p>Make sure you called \n<code>func Configure()</code> before the handler called in your <code>main</code> function</p>\n\n<p>and as <a href=\"https://stackoverflow.com/a/42326810/2652524\">tkausl</a> answer remove the <code>:</code> when you assign the <code>conn</code> redis  to global variable to be like this in your <strong>configure.go</strong> file: </p>\n\n<pre><code>Config = &amp;Configuration{conn}\n</code></pre>\n"}], "owner": {"reputation": 1509, "user_id": 1093694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/4hdHu.jpg?s=128&g=1", "display_name": "Lupus", "link": "https://stackoverflow.com/users/1093694/lupus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3136, "favorite_count": 3, "accepted_answer_id": 42326810, "answer_count": 2, "score": 2, "last_activity_date": 1487506116, "creation_date": 1487504220, "question_id": 42326753, "link": "https://stackoverflow.com/questions/42326753/runtime-error-invalid-memory-address-or-nil-pointer-dereference-in-public-point", "title": "runtime error: invalid memory address or nil pointer dereference in public pointer", "body": "<p>I'm a nodejs developer and I generally use a structure for my apps which holds a configuration package/object that holds references to my often used libs and configuration options. Generally this configuration object holds my database connections as well and it's reachable trough my application.</p>\n\n<p>I tried to build similar to this in go and failed horribly. </p>\n\n<p>My plan was to build a public variable which holds a reference for my config struct. But when I try to call my <code>Config.Database</code> I get this panic:</p>\n\n<pre><code>2017/02/19 14:05:44 http: panic serving 127.0.0.1:53554: runtime error: invalid memory address or nil pointer dereference\n    goroutine 50 [running]:\n    net/http.(*conn).serve.func1(0xc42027c000)\n        /usr/local/go/src/net/http/server.go:1491 +0x12a\n    panic(0x9f45c0, 0xc42000c100)\n        /usr/local/go/src/runtime/panic.go:458 +0x243\n    main.SignUp(0xc4202780e0)\n        /home/attila/dev/gopath/src/github.com/attilasatan/helloiris/handlers.go:31 +0x258\n    github.com/kataras/iris.HandlerFunc.Serve(0xafaf00, 0xc4202780e0)\n        /home/attila/dev/gopath/src/github.com/kataras/iris/http.go:211 +0x30\n    github.com/kataras/iris.(*Context).Do(0xc4202780e0)\n        /home/attila/dev/gopath/src/github.com/kataras/iris/context.go:152 +0x4d\n    github.com/kataras/iris.(*serveMux).BuildHandler.func1(0xc4202780e0)\n        /home/attila/dev/gopath/src/github.com/kataras/iris/http.go:1059 +0x6ea\n    github.com/kataras/iris.(*Framework).Build.func1.1(0xd87e20, 0xc4202701a0, 0xc420284000)\n        /home/attila/dev/gopath/src/github.com/kataras/iris/iris.go:411 +0x72\n    net/http.HandlerFunc.ServeHTTP(0xc420235080, 0xd87e20, 0xc4202701a0, 0xc420284000)\n        /usr/local/go/src/net/http/server.go:1726 +0x44\n    net/http.serverHandler.ServeHTTP(0xc420089f80, 0xd87e20, 0xc4202701a0, 0xc420284000)\n        /usr/local/go/src/net/http/server.go:2202 +0x7d\n    net/http.(*conn).serve(0xc42027c000, 0xd88820, 0xc42015c200)\n        /usr/local/go/src/net/http/server.go:1579 +0x4b7\n    created by net/http.(*Server).Serve\n        /usr/local/go/src/net/http/server.go:2293 +0x44d\n    2017/02/19 14:05:44 http: panic serving 127.0.0.1:53560: runtime error: invalid memory address or nil pointer dereference\n    goroutine 51 [running]:\n    net/http.(*conn).serve.func1(0xc42027c180)\n        /usr/local/go/src/net/http/server.go:1491 +0x12a\n    panic(0x9f45c0, 0xc42000c100)\n        /usr/local/go/src/runtime/panic.go:458 +0x243\n    main.SignUp(0xc4202ac070)\n        /home/attila/dev/gopath/src/github.com/attilasatan/helloiris/handlers.go:31 +0x258\n    github.com/kataras/iris.HandlerFunc.Serve(0xafaf00, 0xc4202ac070)\n        /home/attila/dev/gopath/src/github.com/kataras/iris/http.go:211 +0x30\n    github.com/kataras/iris.(*Context).Do(0xc4202ac070)\n        /home/attila/dev/gopath/src/github.com/kataras/iris/context.go:152 +0x4d\n    github.com/kataras/iris.(*serveMux).BuildHandler.func1(0xc4202ac070)\n        /home/attila/dev/gopath/src/github.com/kataras/iris/http.go:1059 +0x6ea\n    github.com/kataras/iris.(*Framework).Build.func1.1(0xd87e20, 0xc4202a60d0, 0xc4202840f0)\n        /home/attila/dev/gopath/src/github.com/kataras/iris/iris.go:411 +0x72\n    net/http.HandlerFunc.ServeHTTP(0xc420235080, 0xd87e20, 0xc4202a60d0, 0xc4202840f0)\n        /usr/local/go/src/net/http/server.go:1726 +0x44\n    net/http.serverHandler.ServeHTTP(0xc420089f80, 0xd87e20, 0xc4202a60d0, 0xc4202840f0)\n        /usr/local/go/src/net/http/server.go:2202 +0x7d\n    net/http.(*conn).serve(0xc42027c180, 0xd88820, 0xc42015c480)\n        /usr/local/go/src/net/http/server.go:1579 +0x4b7\n    created by net/http.(*Server).Serve\n</code></pre>\n\n<p>Here is my configure file. As you can see I'm using <code>tideland/golib/redis</code> for redis connection.</p>\n\n<p><strong>configure.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"time\"\n\n    \"github.com/tideland/golib/redis\"\n)\n\n/*Configuration is the main type of app configuration */\ntype Configuration struct {\n    Database *redis.Connection\n}\n\n/*Config is app configuration holder */\nvar Config *Configuration\n\n/*Configure handles database connection */\nfunc Configure() (*Configuration, error) {\n\n    db, err := redis.Open(redis.TcpConnection(\"127.0.0.1:6379\", 30*time.Second))\n\n    if err != nil {\n        fmt.Printf(\"Database connection error\")\n        return nil, err\n    }\n    conn, err := db.Connection()\n\n    n, _ := conn.DoInt(\"INCR\", \"IDIDID\")\n\n    fmt.Printf(strconv.Itoa(n))\n\n    if err != nil {\n        fmt.Printf(\"Database connection error\")\n        return nil, err\n    }\n\n    /*Config is the main configuration object*/\n\n    Config := &amp;Configuration{conn}\n\n    return Config, err\n}\n</code></pre>\n\n<p>And here is where I use <code>Config.Database</code>. </p>\n\n<p><strong>handlers.go</strong></p>\n\n<pre><code>func SignUp(ctx *iris.Context) {\n    mail := ctx.FormValue(\"email\")\n    password := ctx.FormValue(\"password\")\n    passwordConfirm := ctx.FormValue(\"password-confirm\")\n\n    if password != passwordConfirm {\n        ctx.RenderWithStatus(iris.StatusBadRequest, \"400.html\", ErrorPageData{\"passwords dont match\"})\n    } else {\n\n        user := User{mail, password, 0}\n        db := Config.Database\n\n        userID, err := db.DoInt(\"INCR\", \"HELLOIRIS:ID\")\n\n        if err != nil {\n            ctx.RenderWithStatus(iris.StatusBadRequest, \"400.html\", ErrorPageData{\"passwords dont match\"})\n        } else {\n\n            user.ID = userID\n\n            fmt.Printf(\"SAVED\")\n\n            ctx.Render(\"signup-success.html\", nil)\n        }\n        ctx.JSON(200, user)\n    }\n}\n</code></pre>\n\n<p>After this fail I changed <code>Configure</code> function like this:</p>\n\n<p><strong>configure.go</strong></p>\n\n<pre><code>func Configure() (Config *Configuration, err error) {\n\n    if Config != nil {\n    return\n    }\n}\n</code></pre>\n\n<p>and I changed the usage at handler  </p>\n\n<p><strong>handlers.go</strong></p>\n\n<pre><code>config, err := Configure()\n\nif err != nil {\n    ctx.RenderWithStatus(iris.StatusBadRequest, \"400.html\", ErrorPageData{\"try again later\"})\n    return\n}\n\nuser := User{mail, password, 0}\ndb := config.Database\n</code></pre>\n\n<p>... and everything start to work perfectly.</p>\n\n<p>My problem is I simply don't understand why... Why did I get this panic when I use a public pointer and why didn't I get when I returned the same pointer from a function?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 6124, "user_id": 461887, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/73a86b3136bfdda99045ba5de86dd9ec?s=128&d=identicon&r=PG", "display_name": "sayth", "link": "https://stackoverflow.com/users/461887/sayth"}, "edited": false, "score": 0, "creation_date": 1487493177, "post_id": 42325120, "comment_id": 71803395, "body": "So should i put it in main or creatd a function for file reading based on the docs code?"}], "tags": [], "owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "is_accepted": false, "score": 0, "last_activity_date": 1487492867, "creation_date": 1487492867, "answer_id": 42325120, "question_id": 42325046, "link": "https://stackoverflow.com/questions/42325046/go-os-file-read-sample-from-docs-not-working-declaration/42325120#42325120", "title": "Go OS file read sample from docs not working - declaration", "body": "<p>The error you're getting tells you exactly what is wrong. Your code is outside a function body. Only declarations can be outside of function bodies. You'll need to move the code into main() or another function that main calls.</p>\n"}], "owner": {"reputation": 6124, "user_id": 461887, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/73a86b3136bfdda99045ba5de86dd9ec?s=128&d=identicon&r=PG", "display_name": "sayth", "link": "https://stackoverflow.com/users/461887/sayth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 41, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1487492867, "creation_date": 1487492128, "question_id": 42325046, "link": "https://stackoverflow.com/questions/42325046/go-os-file-read-sample-from-docs-not-working-declaration", "title": "Go OS file read sample from docs not working - declaration", "body": "<p>I am reading the GO OS docs here <a href=\"https://golang.org/pkg/os/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/</a></p>\n\n<p>The docs give this code</p>\n\n<pre><code>file, err := os.Open(\"file.go\") // For read access.\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>and then this</p>\n\n<pre><code>data := make([]byte, 100)\ncount, err := file.Read(data)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>However when I use it in this example I get the non-declaration outside function body.</p>\n\n<p>How should I be using the documentation code in this example?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"log\"\n  \"os\"\n)\n\ntype doc struct {\n    Meeting meeting `xml:\"meeting\"`\n}\n\ntype meeting struct {\n    Race race `xml:\"race\"`\n}\n\ntype race struct {\n    ID       int          `xml:\"id,attr\"`\n    Name     string       `xml:\"name,attr\"`\n    Distance int          `xml:\"distance,attr\"`\n    Noms     []nomination `xml:\"nomination\"`\n}\n\ntype nomination struct {\n    Number int    `xml:\"number,attr\"`\n    ID     int    `xml:\"id,attr\"`\n    Horse  string `xml:\"horse,attr\"`\n    Weight int    `xml:\"weight,attr\"`\n    Rating int    `xml:\"rating,attr\"`\n}\n\nfunc main() {\n    d := doc{}\n    err := xml.Unmarshal(file, &amp;d)\n    if err != nil {\n        log.Fatalf(\"Unable to unmarshal XML: %s\\n\", err)\n    }\n    fmt.Printf(\"%#v\\n\", d)\n}\n\nfile, err := os.Open(\"file.go\") // For read access.\nif err != nil {\n    log.Fatal(err)\n}\ndata := make([]byte, 100)\ncount, err := file.Read(data)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}, {"tags": ["html", "xml", "go"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 7587450, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-WiMDdbVmLBM/AAAAAAAAAAI/AAAAAAAAAAs/8-ZBCqLYixQ/photo.jpg?sz=128", "display_name": "Nicole Tusek", "link": "https://stackoverflow.com/users/7587450/nicole-tusek"}, "edited": false, "score": 0, "creation_date": 1487525872, "post_id": 42326275, "comment_id": 71813597, "body": "I&#39;ll try this and tell you how it goes!"}, {"owner": {"reputation": 23, "user_id": 7587450, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-WiMDdbVmLBM/AAAAAAAAAAI/AAAAAAAAAAs/8-ZBCqLYixQ/photo.jpg?sz=128", "display_name": "Nicole Tusek", "link": "https://stackoverflow.com/users/7587450/nicole-tusek"}, "edited": false, "score": 0, "creation_date": 1487528165, "post_id": 42326275, "comment_id": 71814444, "body": "I&#39;m now housing an issue where the writing of the file is doing things incorrectly but I think this is the correct way of doing this, thank you!"}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": true, "score": 2, "last_activity_date": 1487501058, "creation_date": 1487501058, "answer_id": 42326275, "question_id": 42324166, "link": "https://stackoverflow.com/questions/42324166/how-do-i-modify-elements-of-an-html-file-with-go/42326275#42326275", "title": "How do I modify elements of an HTML file with Go?", "body": "<p>You should definitely save the edited document.</p>\n\n<p>First, open the file for read/write and truncate:</p>\n\n<pre><code>file, err := os.OpenFile(\"sample.html\", os.O_RDWR | os.O_TRUNC, 0644)\n</code></pre>\n\n<p>And after you finish processing, override the original file:</p>\n\n<pre><code>html.Render(file, doc)\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7587450, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-WiMDdbVmLBM/AAAAAAAAAAI/AAAAAAAAAAs/8-ZBCqLYixQ/photo.jpg?sz=128", "display_name": "Nicole Tusek", "link": "https://stackoverflow.com/users/7587450/nicole-tusek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1008, "favorite_count": 1, "accepted_answer_id": 42326275, "answer_count": 1, "score": 2, "last_activity_date": 1487501058, "creation_date": 1487484025, "question_id": 42324166, "link": "https://stackoverflow.com/questions/42324166/how-do-i-modify-elements-of-an-html-file-with-go", "title": "How do I modify elements of an HTML file with Go?", "body": "<p>I've been trying to figure this out for a few days and I've kind of exhausted even the most effective of google searching. What I've been trying to do is to open a file of the type HTML and with Go's library (<a href=\"http://golang.org/x/net/html\" rel=\"nofollow noreferrer\">http://golang.org/x/net/html</a>) modify the img tags and their source to a known directory and set of files. So far I've been able to find the elements using this,</p>\n\n<pre><code>//Open the file and return a variable called file.\nfile, _ = os.Open(file.Name())\n//Create the doc\ndoc, err := html.Parse(file)\n//Check for err when generating the doc\ncheck(err)\n//Look for tags with img using an anonymous function.\nvar f func(*html.Node)\nf = func(n *html.Node) {\n    if n.Type == html.ElementNode &amp;&amp; n.Data == \"img\" {\n        for _, img := range n.Attr {\n            if img.Key == \"src\" {\n                str := breakdownURL(img.Val) //Gets the ../../resource/(thing.h23.jpg) &lt;-- That\n                //Creating a static address to add to the dynamic one\n                address := filepath.Join(filepath.Join(\"Resources\", getFileNotExt(file)), str)\n                img.Val = address\n                break\n            }\n        }\n    }\n\n    for at := n.FirstChild; at != nil; at = at.NextSibling {\n        f(at)\n    }\n}\n\nf(doc)\n</code></pre>\n\n<p>That's been able to find the elements and append the correct directory but it's only modifying this doc file. I have no clue how to append it to the actual file. The only thought that I have is opening the doc as some kind of writing way and copying the new data from the doc to the file. Any help is greatly appreciated! Thank you so much for taking your time :).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1487492139, "post_id": 42323567, "comment_id": 71803179, "body": "Reading an line from input is somewhat non-intuitive in Go, it seems that lot of beginners stumble on that one. See this question for an example how to do it: <a href=\"http://stackoverflow.com/q/20895552/723693\">stackoverflow.com/q/20895552/723693</a>"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1487606324, "post_id": 42323567, "comment_id": 71849217, "body": "Interesting that entering <code>data type</code> and <code>&quot;data type&quot;</code> has one carriage return less than or more than necessary! :\\"}], "answers": [{"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 1, "last_activity_date": 1487657977, "creation_date": 1487657977, "answer_id": 42360030, "question_id": 42323567, "link": "https://stackoverflow.com/questions/42323567/read-space-seperated-strings-in-golang-1-8/42360030#42360030", "title": "Read Space Seperated Strings in Golang 1.8", "body": "<p>Perhaps something like this..</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n)\n\ntype details struct {\n    DataType string\n    Table    string\n}\n\nfunc main() {\n    dt := details{}\n    cin := bufio.NewReader(os.Stdin)\n    for {\n        fmt.Println(\"Enter the DataType\")\n        text, err := cin.ReadString('\\n') // reads entire string up until the /n which is the newline deliminator\n        if strings.TrimSpace(text) == \"\" { // check to see if the input is empty\n            continue\n        }\n        if err == nil { // if the input is not empty then the control got this far and now we just have to check for error, assign the data, and break out of the loop .. repeat for the second input. If this is going to be something you do alot refactor the input section.\n            dt.DataType = text\n            break\n        } else {\n            fmt.Printf(\"An error as occured: %s\\n\", err.Error())\n        }\n    }\n    for {\n        fmt.Println(\"Enter the Table\")\n        text, err := cin.ReadString('\\n')\n        if strings.TrimSpace(text) == \"\" {\n            continue\n        }\n        if err == nil {\n            dt.Table = text\n            break\n        } else {\n            fmt.Printf(\"An error as occured: %s\\n\", err.Error())\n        }\n    }\n    fmt.Printf(\"%+v\\n\", dt)\n    return\n}\n</code></pre>\n\n<p>Example of refactored code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n)\n\ntype details struct {\n    DataType string\n    Table    string\n}\n\nfunc getInput(message string, reader bufio.Reader) (input string) {\n    for {\n        fmt.Println(message)\n        input, err := reader.ReadString('\\n')\n        if strings.TrimSpace(input) == \"\" {\n            continue\n        }\n        if err == nil {\n            break\n        } else {\n            fmt.Printf(\"An error as occured: %s\\n\", err.Error())\n        }\n    }\n    return\n}\n\nfunc main() {\n    dt := details{}\n    cin := bufio.NewReader(os.Stdin)\n    t := getInput(\"Enter the DataType\", *cin)\n    dt.DataType = t\n    t = getInput(\"Enter the Table\", *cin)\n    dt.Table = t\n    fmt.Printf(\"Seeing what my data looks like  %+v\\n\", dt)\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 383, "user_id": 4634669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh5.googleusercontent.com/-RCOr91QgPvQ/AAAAAAAAAAI/AAAAAAAAAIk/X1Aka8XIDgw/photo.jpg?sz=128", "display_name": "athavan kanapuli", "link": "https://stackoverflow.com/users/4634669/athavan-kanapuli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 909, "favorite_count": 0, "accepted_answer_id": 42360030, "answer_count": 1, "score": 1, "last_activity_date": 1487657977, "creation_date": 1487477735, "question_id": 42323567, "link": "https://stackoverflow.com/questions/42323567/read-space-seperated-strings-in-golang-1-8", "title": "Read Space Seperated Strings in Golang 1.8", "body": "<p>Hi I have two problems in the following Go Program .<br>\n1. I couldn't read the space seperated string using Scanf or Scanln.<br>\nSo I have added a formatted string \"%q\"  to read space seperated string using double quotes.\nIs there an alternative to read string with spaces ?</p>\n\n<pre><code>package main\nimport\n(\n    \"fmt\"\n    \"strings\"\n)\n\ntype details struct{\n    DataType string\n    Table string\n\n}\nfunc main(){\n    dt := details{}\n    fmt.Println(\"Enter the DataType\")\n    fmt.Scanf(\"%q\" ,&amp;dt.DataType )\n    for strings.TrimSpace(dt.DataType) == \"\" {\n        fmt.Println(\"Enter the DataType\")\n        fmt.Scanln(&amp;dt.DataType)\n    }\n    //fmt.Println(dt.DataType)\n    fmt.Println(\"Enter the Table\")\n    fmt.Scanln(&amp;dt.Table)\n    for strings.TrimSpace(dt.Table) == \"\" {\n        fmt.Println(\"Enter a valid Table name \")\n        fmt.Scanln(&amp;dt.Table)\n    }\n}\n</code></pre>\n\n<p>The Console output is as follows ,</p>\n\n<pre><code>VenKats-MacBook-Air:ColumnCreator venkat$ go run test.go\nEnter the DataType\n\"rid bigint not null\"\nEnter the Table\nEnter a valid Table name \n</code></pre>\n\n<ol start=\"2\">\n<li>The Second problem is why does the control flow went to the second for loop without waiting for the user input .  Does the Scanf with \"%q\" returned a carraige return .\nAny help would be greatly appreciated</li>\n</ol>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 100534, "user_id": 7108653, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LH2EI.png?s=128&g=1", "display_name": "Tanaike", "link": "https://stackoverflow.com/users/7108653/tanaike"}, "edited": false, "score": 0, "creation_date": 1487481155, "post_id": 42323374, "comment_id": 71800858, "body": "Do you have to use &quot;github.com/parnurzeal/gorequest&quot;? Is Request of &quot;net/http&quot; no good?"}], "answers": [{"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": -1, "last_activity_date": 1487494238, "creation_date": 1487494238, "answer_id": 42325287, "question_id": 42323374, "link": "https://stackoverflow.com/questions/42323374/how-to-make-a-post-request-with-gorequest/42325287#42325287", "title": "How to make a POST request with gorequest", "body": "<p>I have been using <a href=\"https://paw.cloud/\" rel=\"nofollow noreferrer\">paw</a> client, mainly because I can test/debug my request and once I am done, I can obtain <code>curl</code> or <code>go</code> code for doing so,  besides other options, for example this is an output for doing a generic post request:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc sendGetRepos() {\n    // Create client\n    client := &amp;http.Client{}\n\n    // Create request\n    req, err := http.NewRequest(\"POST\", \"https://api.endpoint.tld\", nil)\n\n    // Headers\n    req.Header.Add(\"Authorization\", \"Bearer ***** Hidden credentials *****\")\n\n    // Fetch Request\n    resp, err := client.Do(req)\n\n    if err != nil {\n        fmt.Println(\"Failure : \", err)\n    }\n\n    // Read Response Body\n    respBody, _ := ioutil.ReadAll(resp.Body)\n\n    // Display Results\n    fmt.Println(\"response Status : \", resp.Status)\n    fmt.Println(\"response Headers : \", resp.Header)\n    fmt.Println(\"response Body : \", string(respBody))\n}\n</code></pre>\n"}], "owner": {"reputation": 7898, "user_id": 1382297, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/fVj5O.jpg?s=128&g=1", "display_name": "avi", "link": "https://stackoverflow.com/users/1382297/avi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1297, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1487494238, "creation_date": 1487475500, "question_id": 42323374, "link": "https://stackoverflow.com/questions/42323374/how-to-make-a-post-request-with-gorequest", "title": "How to make a POST request with gorequest", "body": "<p>Reddit has an API endpoint for Oauth2  where I need to do POST with proper headers and data to get the access token. Here is my code: </p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/parnurzeal/gorequest\"\n    \"fmt\"\n)\n\nfunc main() {\n    app_key := \"K...A\"\n    app_secret := \"3...M\"\n    ua_string := \"script:bast:0.1 (by /u/a...h)\"\n    username := \"a...h\"\n    password := \"...\"\n    r := gorequest.New().SetBasicAuth(app_key, app_secret).Set(\"User-Agent\", ua_string)\n    resp, body, errs := r.Post(\"https://www.reddit.com/api/v1/access_token\").Send(\n        map[string]string{\n            \"grant_type\": \"password\",\n            \"username\": username,\n            \"password\": password,\n        },\n    ).End()\n    if errs != nil {\n        fmt.Println(errs)\n    }\n    fmt.Println(resp)\n    fmt.Println(resp.StatusCode)\n    fmt.Println(body)\n}\n</code></pre>\n\n<p>However it's not working and I am getting: <code>{\"message\": \"Too Many Requests\", \"error\": 429}</code></p>\n\n<p>I am not making too many requests at all and I am following the API rules too.</p>\n\n<p>Here is my equivalent python code which works:</p>\n\n<pre><code>import requests\nimport requests.auth\n\napp_key = \"K...A\"\napp_secret = \"3...M\"\nua_string = \"script:bast:0.1 (by /u/a...h)\"\nusername = \"a...h\"\npassword = \"...\"\n\nclient_auth = requests.auth.HTTPBasicAuth(app_key, app_secret)\npost_data = {\"grant_type\": \"password\", \"username\": username,\n             \"password\": password}\nheaders = {\"User-Agent\": ua_string}\nresponse = requests.post(\"https://www.reddit.com/api/v1/access_token\",\n                         auth=client_auth, data=post_data, headers=headers)\nprint(response.json())\n</code></pre>\n\n<p>So whats wrong with my Go code? Is there any mistake I am doing?</p>\n"}, {"tags": ["api", "go", "polymer"], "answers": [{"comments": [{"owner": {"reputation": 1201, "user_id": 5097493, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/95b290a191545edb4077adfaab317f1a?s=128&d=identicon&r=PG&f=1", "display_name": "RuNpiXelruN", "link": "https://stackoverflow.com/users/5097493/runpixelrun"}, "edited": false, "score": 0, "creation_date": 1487493994, "post_id": 42325218, "comment_id": 71803574, "body": "Thanks @nbari for taking the time to do this! That&#39;s a great answer :)"}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": true, "score": 5, "last_activity_date": 1487493607, "creation_date": 1487493607, "answer_id": 42325218, "question_id": 42322870, "link": "https://stackoverflow.com/questions/42322870/go-as-backend-api-polymer-frontend/42325218#42325218", "title": "Go as backend API, Polymer frontend", "body": "<p>Probably you want to create a <a href=\"https://msdn.microsoft.com/en-us/magazine/dn463786.aspx\" rel=\"noreferrer\">single-page application</a> (img taken from this link):</p>\n\n<ul>\n<li>Go - backend (API)</li>\n<li>HTML/javascript (polymer) - frontend (static content)</li>\n</ul>\n\n<p><a href=\"https://msdn.microsoft.com/en-us/magazine/dn463786.aspx\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/7nqGu.png\" alt=\"enter image description here\"></a></p>\n\n<p>In this scenario you don't need to use go <a href=\"https://golang.org/pkg/html/template/\" rel=\"noreferrer\">html/template</a>, basically you just create an API that in most cases will be returning <a href=\"https://en.wikipedia.org/wiki/JSON\" rel=\"noreferrer\">json</a>.</p>\n\n<p>Your main concern by following this approach could be about how to secure your backend endpoints rather than need to deal with parsing templates, there are some options for this, <a href=\"https://jwt.io/introduction/\" rel=\"noreferrer\">json tokens</a> is one of them.</p>\n"}], "owner": {"reputation": 1201, "user_id": 5097493, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/95b290a191545edb4077adfaab317f1a?s=128&d=identicon&r=PG&f=1", "display_name": "RuNpiXelruN", "link": "https://stackoverflow.com/users/5097493/runpixelrun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 777, "favorite_count": 0, "accepted_answer_id": 42325218, "answer_count": 1, "score": 1, "last_activity_date": 1487493607, "creation_date": 1487469849, "last_edit_date": 1487470616, "question_id": 42322870, "link": "https://stackoverflow.com/questions/42322870/go-as-backend-api-polymer-frontend", "title": "Go as backend API, Polymer frontend", "body": "<p>I'm trying to work out the best way of getting Polymer to talk to my go app end points? I'm using Go and Postgres as the backend, but would like to use Polymer as the front-end instead of the Go html/template package. Has anyone got a good suggestion on how is set this up? Sorry, struggling to get the penny dropping on this part. I've watched Francesc Campoy's polymer-gopher video but it looks like he has the app setup already? </p>\n\n<p>Also, would you recommend having go handle the routing also, or just be the data end point for this type of setup?</p>\n\n<p>Thanks guys and gals :) </p>\n"}, {"tags": ["go", "ghost-blog", "blog-engine", "journey"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1487462188, "post_id": 42321996, "comment_id": 71797390, "body": "You should post the error here, and a minimal example of what you&#39;ve attempted. Else, I&#39;d suggest raising an issue on the project itself. the blog engine appears to have a bug or error. Are you running the latest version?"}, {"owner": {"reputation": 41, "user_id": 7340716, "user_type": "registered", "profile_image": "https://graph.facebook.com/1808651060/picture?type=large", "display_name": "Tahirllari Aldo", "link": "https://stackoverflow.com/users/7340716/tahirllari-aldo"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1487462477, "post_id": 42321996, "comment_id": 71797465, "body": "Nothing more than changing the default theme...after that I am getting the crash and the error in log file! yes I am running the latest version!"}], "owner": {"reputation": 41, "user_id": 7340716, "user_type": "registered", "profile_image": "https://graph.facebook.com/1808651060/picture?type=large", "display_name": "Tahirllari Aldo", "link": "https://stackoverflow.com/users/7340716/tahirllari-aldo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487461665, "creation_date": 1487461665, "question_id": 42321996, "link": "https://stackoverflow.com/questions/42321996/journey-blog-engine-written-in-go-content-themes-theme-error", "title": "Journey blog engine written in Go (content/themes/[theme] #Error)", "body": "<p><em>After a lot of attempts I am still getting a crash on journey blog engine (journey-windows-386)... I tried different themes supported by this platform.\nThe only one that works is the default one [promenade]!</em> </p>\n\n<p><strong>Check the log files as reference :</strong> <a href=\"http://txt.do/d129y\" rel=\"nofollow noreferrer\">http://txt.do/d129y</a></p>\n"}, {"tags": ["go", "basic-authentication", "router", "gorilla", "mux"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1487460434, "post_id": 42321789, "comment_id": 71796952, "body": "The application wraps the /v2 handler only.   Wrap each handler."}, {"owner": {"reputation": 1877, "user_id": 382700, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2752422e98586f8451b6bf22c3af4a18?s=128&d=identicon&r=PG", "display_name": "Gurjeet Singh", "link": "https://stackoverflow.com/users/382700/gurjeet-singh"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1487464096, "post_id": 42321789, "comment_id": 71797830, "body": "The <code>goji&#47;httpauth</code> packages claims to protect all routes with just one wrapper around the root handler. See their example at <a href=\"https://github.com/goji/httpauth#gorillamux\" rel=\"nofollow noreferrer\">github.com/goji/httpauth#gorillamux</a> I tried using that package to protect <code>&#47;v2</code>, too, but without any success."}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1487466181, "post_id": 42321789, "comment_id": 71798281, "body": "maybe you need something like middleware to do that kind of job: <a href=\"https://github.com/urfave/negroni\" rel=\"nofollow noreferrer\">github.com/urfave/negroni</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1487468687, "post_id": 42321789, "comment_id": 71798823, "body": "he goji/httpauth example wraps the Gorilla mux and therefore protects all paths. The code in the question wraps a single handler (and that handler does nothing)."}, {"owner": {"reputation": 1877, "user_id": 382700, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2752422e98586f8451b6bf22c3af4a18?s=128&d=identicon&r=PG", "display_name": "Gurjeet Singh", "link": "https://stackoverflow.com/users/382700/gurjeet-singh"}, "edited": false, "score": 0, "creation_date": 1487483357, "post_id": 42321789, "comment_id": 71801248, "body": "If you are referring to the <code>noopHandler</code>, that is intentional. I expected that call to <code>BasicAuth()</code> to stop the processing of the rest of the routes under <code>&#47;v2</code> if username:password pair is not provided."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1487534395, "post_id": 42321789, "comment_id": 71816732, "body": "Wrapping the noopHandler with basic auth does not cause the other handlers to also be wrapped with basic auth. The mux dispatches a request to a single handler."}], "answers": [{"tags": [], "owner": {"reputation": 1877, "user_id": 382700, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2752422e98586f8451b6bf22c3af4a18?s=128&d=identicon&r=PG", "display_name": "Gurjeet Singh", "link": "https://stackoverflow.com/users/382700/gurjeet-singh"}, "is_accepted": true, "score": 0, "last_activity_date": 1487546324, "creation_date": 1487546324, "answer_id": 42334108, "question_id": 42321789, "link": "https://stackoverflow.com/questions/42321789/unable-to-protect-gorilla-mux-subroute-with-basic-auth/42334108#42334108", "title": "Unable to protect gorilla/mux Subroute with basic auth", "body": "<p>I achieved the expected behavior by using <code>negroni</code>. If the <code>BasicAuth()</code> call fails, none of the route handlers under <code>/v2</code> are invoked.</p>\n\n<p>The working code is in a Gist (with revisions, for those interested) here: <a href=\"https://gist.github.com/gurjeet/13b2f69af6ac80c0357ab20ee24fa575\" rel=\"nofollow noreferrer\">https://gist.github.com/gurjeet/13b2f69af6ac80c0357ab20ee24fa575</a></p>\n\n<p>Per SO convention, though, here's the complete code:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/subtle\"\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/urfave/negroni\"\n)\n\nfunc endAPICall(w http.ResponseWriter, httpStatus int, anyStruct interface{}) {\n\n    result, err := json.MarshalIndent(anyStruct, \"\", \"  \")\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    w.WriteHeader(httpStatus)\n    w.Write(result)\n}\n\nfunc BasicAuth(w http.ResponseWriter, r *http.Request, username, password, realm string) bool {\n\n    user, pass, ok := r.BasicAuth()\n\n    if !ok || subtle.ConstantTimeCompare([]byte(user), []byte(username)) != 1 || subtle.ConstantTimeCompare([]byte(pass), []byte(password)) != 1 {\n        w.Header().Set(\"WWW-Authenticate\", `Basic realm=\"`+realm+`\"`)\n        w.WriteHeader(401)\n        w.Write([]byte(\"Unauthorised.\\n\"))\n        return false\n    }\n\n    return true\n}\n\nfunc routers() *mux.Router {\n    username := \"apiuser\"\n    password := \"apipass\"\n\n    v2Path := \"/v2\"\n    healthPath := \"/health\"\n\n    topRouter := mux.NewRouter().StrictSlash(true)\n    healthRouter := mux.NewRouter().PathPrefix(healthPath).Subrouter().StrictSlash(true)\n    v2Router := mux.NewRouter().PathPrefix(v2Path).Subrouter().StrictSlash(true)\n\n    healthRouter.HandleFunc(\"/ping\", func(w http.ResponseWriter, r *http.Request) {\n        endAPICall(w, 200, \"PONG\")\n    })\n\n    v2Router.HandleFunc(\"/smallcat\", func(w http.ResponseWriter, r *http.Request) {\n        endAPICall(w, 200, \"Small Meow\")\n    })\n\n    bigMeowFn := func(w http.ResponseWriter, r *http.Request) {\n        endAPICall(w, 200, \"Big MEOW\")\n    }\n\n    v2Router.HandleFunc(\"/bigcat\", bigMeowFn)\n\n    topRouter.PathPrefix(healthPath).Handler(negroni.New(\n        /* Health-check routes are unprotected */\n        negroni.Wrap(healthRouter),\n    ))\n\n    topRouter.PathPrefix(v2Path).Handler(negroni.New(\n        negroni.HandlerFunc(func(w http.ResponseWriter, r *http.Request, next http.HandlerFunc) {\n            if BasicAuth(w, r, username, password, \"Provide user name and password\") {\n                /* Call the next handler iff Basic-Auth succeeded */\n                next(w, r)\n            }\n        }),\n        negroni.Wrap(v2Router),\n    ))\n\n    return topRouter\n}\n\nfunc main() {\n    if r := routers(); r != nil {\n        log.Fatal(\"Server exited:\", http.ListenAndServe(\":3000\", r))\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1877, "user_id": 382700, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2752422e98586f8451b6bf22c3af4a18?s=128&d=identicon&r=PG", "display_name": "Gurjeet Singh", "link": "https://stackoverflow.com/users/382700/gurjeet-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1666, "favorite_count": 0, "accepted_answer_id": 42334108, "answer_count": 1, "score": 0, "last_activity_date": 1487546324, "creation_date": 1487459923, "question_id": 42321789, "link": "https://stackoverflow.com/questions/42321789/unable-to-protect-gorilla-mux-subroute-with-basic-auth", "title": "Unable to protect gorilla/mux Subroute with basic auth", "body": "<p>I am trying to create routes using <code>gorilla/mux</code>, some of which should be protected by basic auth and others shouldn't. Specifically, every route under <code>/v2</code> should require basic auth, but the routes under <code>/health</code> should be publicly accessible.</p>\n\n<p>As you can see below, I can wrap each of my <code>/v2</code> route handlers with <code>BasicAuth()</code>, but that's against the DRY principle, and also error prone, not to mention the security implications of forgetting to wrap one of those handlers.</p>\n\n<p>I have the following output from <code>curl</code>. All but the last one is as I expect. One should not be able to <code>GET</code> <code>/smallcat</code> without authentication.</p>\n\n<pre><code>$ curl localhost:3000/health/ping\n\"PONG\"\n$ curl localhost:3000/health/ping/\n404 page not found\n$ curl localhost:3000/v2/bigcat\nUnauthorised.\n$ curl apiuser:apipass@localhost:3000/v2/bigcat\n\"Big MEOW\"\n$ curl localhost:3000/v2/smallcat\n\"Small Meow\"\n</code></pre>\n\n<p>Here's the complete code. I believe I need to fix the <code>v2Router</code> definition somehow, but fail to see how.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/subtle\"\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc endAPICall(w http.ResponseWriter, httpStatus int, anyStruct interface{}) {\n\n    result, err := json.MarshalIndent(anyStruct, \"\", \"  \")\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    w.WriteHeader(httpStatus)\n\n    w.Write(result)\n}\n\nfunc BasicAuth(handler http.HandlerFunc, username, password, realm string) http.HandlerFunc {\n\n    return func(w http.ResponseWriter, r *http.Request) {\n\n        user, pass, ok := r.BasicAuth()\n\n        if !ok || subtle.ConstantTimeCompare([]byte(user), []byte(username)) != 1 || subtle.ConstantTimeCompare([]byte(pass), []byte(password)) != 1 {\n            w.Header().Set(\"WWW-Authenticate\", `Basic realm=\"`+realm+`\"`)\n            w.WriteHeader(401)\n            w.Write([]byte(\"Unauthorised.\\n\"))\n            return\n        }\n\n        handler(w, r)\n    }\n}\n\nfunc routers() *mux.Router {\n    username := \"apiuser\"\n    password := \"apipass\"\n\n    noopHandler := func(http.ResponseWriter, *http.Request) {}\n\n    topRouter := mux.NewRouter().StrictSlash(false)\n    healthRouter := topRouter.PathPrefix(\"/health/\").Subrouter()\n    v2Router := topRouter.PathPrefix(\"/v2\").HandlerFunc(BasicAuth(noopHandler, username, password, \"Provide username and password\")).Subrouter()\n\n    healthRouter.HandleFunc(\"/ping\", func(w http.ResponseWriter, r *http.Request) {\n        endAPICall(w, 200, \"PONG\")\n    })\n\n    v2Router.HandleFunc(\"/smallcat\", func(w http.ResponseWriter, r *http.Request) {\n        endAPICall(w, 200, \"Small Meow\")\n    })\n\n    bigMeowFn := func(w http.ResponseWriter, r *http.Request) {\n        endAPICall(w, 200, \"Big MEOW\")\n    }\n\n    v2Router.HandleFunc(\"/bigcat\", BasicAuth(bigMeowFn, username, password, \"Provide username and password\"))\n\n    return topRouter\n}\n\nfunc main() {\n    if r := routers(); r != nil {\n        log.Fatal(\"Server exited:\", http.ListenAndServe(\":3000\", r))\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "thread-safety", "channel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1487456744, "post_id": 42321309, "comment_id": 71795905, "body": "Yes, but it&#39;s usually not useful since the value may change immediately after you read it"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1487463136, "post_id": 42321309, "comment_id": 71797613, "body": "Related: <a href=\"http://stackoverflow.com/questions/38430186/selecting-between-time-interval-and-length-of-channel\">Selecting between time interval and length of channel</a>."}], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 4, "last_activity_date": 1487456782, "creation_date": 1487456782, "answer_id": 42321398, "question_id": 42321309, "link": "https://stackoverflow.com/questions/42321309/is-lenchannel-in-go-thread-safe/42321398#42321398", "title": "is len(channel) in Go thread-safe?", "body": "<p>It kind of depends on your use case</p>\n\n<p>it is indeed safe to call, but the result cannot be trusted when other goroutines are sending / taking from that channel</p>\n"}], "owner": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1181, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1487456782, "creation_date": 1487456160, "question_id": 42321309, "link": "https://stackoverflow.com/questions/42321309/is-lenchannel-in-go-thread-safe", "title": "is len(channel) in Go thread-safe?", "body": "<p>A channel can potentially be used by multiple Go routines. Is getting the length of the channel by using len(channel) from some of the Go routines thread-safe?</p>\n"}, {"tags": ["node.js", "templates", "go", "environment-variables"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 4, "last_activity_date": 1487457185, "creation_date": 1487457185, "answer_id": 42321449, "question_id": 42321201, "link": "https://stackoverflow.com/questions/42321201/what-is-the-golang-equivalent-of-nodes-node-env/42321449#42321449", "title": "What is the Golang equivalent of Node&#39;s NODE_ENV", "body": "<p>Yes, it is a logical approach.  In fact it's a somewhat standard practice when deploying servers.</p>\n\n<p>There is no standard in the go world, so do whatever.   </p>\n\n<p>Just try to keep it obvious, ie: <code>APP_ENV=dev</code></p>\n"}, {"tags": [], "owner": {"reputation": 456, "user_id": 3338418, "user_type": "registered", "accept_rate": 10, "profile_image": "https://i.stack.imgur.com/uoCMC.jpg?s=128&g=1", "display_name": "Adi Sivasankaran", "link": "https://stackoverflow.com/users/3338418/adi-sivasankaran"}, "is_accepted": false, "score": 1, "last_activity_date": 1499908105, "creation_date": 1499908105, "answer_id": 45069859, "question_id": 42321201, "link": "https://stackoverflow.com/questions/42321201/what-is-the-golang-equivalent-of-nodes-node-env/45069859#45069859", "title": "What is the Golang equivalent of Node&#39;s NODE_ENV", "body": "<p>There doesn't appear to an equivalent of <code>NODE_ENV</code> in the Go world. You can set an environment variable <code>APP_ENV</code> in your IDE locally (and in production).</p>\n\n<pre><code>env := os.Getenv(\"APP_ENV\")\nif env == \"production\" {\n  /* production-version of the code */\n} else {\n  /* development-version of the code */\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 67, "user_id": 6207084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d7acae9ad5508a1884f3c4515da7764?s=128&d=identicon&r=PG", "display_name": "flynn", "link": "https://stackoverflow.com/users/6207084/flynn"}, "is_accepted": false, "score": -1, "last_activity_date": 1556520400, "creation_date": 1556520400, "answer_id": 55898230, "question_id": 42321201, "link": "https://stackoverflow.com/questions/42321201/what-is-the-golang-equivalent-of-nodes-node-env/55898230#55898230", "title": "What is the Golang equivalent of Node&#39;s NODE_ENV", "body": "<p>you can still using \"NODE_ENV\"\uff0c it's just a name, then use os.Getenv(\"NODE_ENV\")get it.</p>\n"}], "owner": {"reputation": 10432, "user_id": 3973137, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/7HdsS.jpg?s=128&g=1", "display_name": "Anthony", "link": "https://stackoverflow.com/users/3973137/anthony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 985, "favorite_count": 0, "accepted_answer_id": 42321449, "answer_count": 3, "score": 2, "last_activity_date": 1556520400, "creation_date": 1487455432, "last_edit_date": 1499973304, "question_id": 42321201, "link": "https://stackoverflow.com/questions/42321201/what-is-the-golang-equivalent-of-nodes-node-env", "title": "What is the Golang equivalent of Node&#39;s NODE_ENV", "body": "<p>I'm trying to set up templating whereby based on an environment variable to indicate whether we are in a development, staging or production environment, the HTML that is rendered is pointed towards different servers.</p>\n\n<p>To do this I would like to use something like Node does in the NODE_ENV environment variable, and then conditionally set the path based on that in my code.</p>\n\n<pre><code>if(process.env.NODE_ENV === 'development') {\n  /* development code */\n} else {\n  /* production code */\n}\n</code></pre>\n\n<p>Is there a standard for defining an environment in Golang? Does this seem like a logical approach? </p>\n"}, {"tags": ["go", "openshift"], "comments": [{"owner": {"reputation": 15006, "user_id": 520567, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6cb1b2c58abc2116f910ec9253ee387f?s=128&d=identicon&r=PG", "display_name": "akostadinov", "link": "https://stackoverflow.com/users/520567/akostadinov"}, "edited": false, "score": 0, "creation_date": 1487690327, "post_id": 42320981, "comment_id": 71891876, "body": "What openshift version?"}, {"owner": {"reputation": 15006, "user_id": 520567, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6cb1b2c58abc2116f910ec9253ee387f?s=128&d=identicon&r=PG", "display_name": "akostadinov", "link": "https://stackoverflow.com/users/520567/akostadinov"}, "edited": false, "score": 0, "creation_date": 1487690397, "post_id": 42320981, "comment_id": 71891940, "body": "You can check this doc for openshift version 2 but this product is EOL, I hope you know. <a href=\"https://developers.openshift.com/faq/troubleshooting.html#_how_do_i_redirect_traffic_to_https\" rel=\"nofollow noreferrer\">developers.openshift.com/faq/&hellip;</a>"}, {"owner": {"reputation": 1704, "user_id": 2912740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4730dc939ce11655d239d1f54a9cd399?s=128&d=identicon&r=PG&f=1", "display_name": "Edwinner", "link": "https://stackoverflow.com/users/2912740/edwinner"}, "reply_to_user": {"reputation": 15006, "user_id": 520567, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6cb1b2c58abc2116f910ec9253ee387f?s=128&d=identicon&r=PG", "display_name": "akostadinov", "link": "https://stackoverflow.com/users/520567/akostadinov"}, "edited": false, "score": 0, "creation_date": 1487698813, "post_id": 42320981, "comment_id": 71897884, "body": "@akostadinov , i am aware of the .htaccess  and i use it for python and it works very well. I don&#39;t however think it works in Golang. I am also not sure on how to check openshift versions or i don&#39;t see any command to do it. I am using  latest openshift-go-cart."}, {"owner": {"reputation": 15006, "user_id": 520567, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6cb1b2c58abc2116f910ec9253ee387f?s=128&d=identicon&r=PG", "display_name": "akostadinov", "link": "https://stackoverflow.com/users/520567/akostadinov"}, "edited": false, "score": 0, "creation_date": 1487800548, "post_id": 42320981, "comment_id": 71953063, "body": "not an answer but v2 is EOL. Spending time deploying on it would be soon lost. Better look at <a href=\"https://www.openshift.com/devpreview/\" rel=\"nofollow noreferrer\">openshift.com/devpreview</a> . Not yet production supported but should become at some point. Not sure what deployment timeframe you&#39;re looking at. You can also run it on your hardware (where you can get official support if you wish) until public supported version becomes available."}], "owner": {"reputation": 1704, "user_id": 2912740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4730dc939ce11655d239d1f54a9cd399?s=128&d=identicon&r=PG&f=1", "display_name": "Edwinner", "link": "https://stackoverflow.com/users/2912740/edwinner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 107, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1487540701, "creation_date": 1487453999, "last_edit_date": 1495542296, "question_id": 42320981, "link": "https://stackoverflow.com/questions/42320981/openshift-golang-force-https", "title": "Openshift Golang force https", "body": "<p>I have a Golang application using <code>haproxy</code> on <code>openshift</code>. What is the correct way to force all traffic to https? </p>\n\n<p>There was a similar question asked <a href=\"https://stackoverflow.com/questions/41428408/how-to-redirect-http-to-https-on-an-openshift-golang-app\">here</a> but the answer doesn't seem to work.</p>\n\n<p>I have tried to do local redirects but the I get <code>\"too many redirects error\"</code> consistently.</p>\n"}, {"tags": ["go", "compiler-errors"], "comments": [{"owner": {"reputation": 1169, "user_id": 230825, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/274ee5a62543653734586319874daf57?s=128&d=identicon&r=PG", "display_name": "david", "link": "https://stackoverflow.com/users/230825/david"}, "edited": false, "score": 1, "creation_date": 1509841886, "post_id": 42320962, "comment_id": 81184069, "body": "Did you try <code>CGO_ENABLED=1 GOOS=linux GOARCH=386 go build littlewm.go</code> ?"}], "answers": [{"tags": [], "owner": {"reputation": 1649, "user_id": 884502, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1f4a1119fab3984edda7b7809dc1e639?s=128&d=identicon&r=PG", "display_name": "M_M", "link": "https://stackoverflow.com/users/884502/m-m"}, "is_accepted": true, "score": 1, "last_activity_date": 1592493939, "creation_date": 1592493939, "answer_id": 62453535, "question_id": 42320962, "link": "https://stackoverflow.com/questions/42320962/golang-compiler-error-cant-load-package-package-main-no-buildable-go-source/62453535#62453535", "title": "golang compiler error: can&#39;t load package: package main: no buildable Go source files in /home/ubuntu/workspace/Go", "body": "<p>I encountered a similar problem when trying to build my own go program.\nI had just added GCO to interface with some native C code in a library.\nIt built for me for the native platform (the machine I was coding on), but not when I tried to target another platform (using <code>GOOS</code> and <code>GOARCH</code> as you're doing).</p>\n\n<p>Setting CGO_ENABLED to 1 (as mentioned in david's comment) fixed the problem for me:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>CGO_ENABLED=1 GOOS=linux GOARCH=386 go build littlewm.go\n</code></pre>\n\n<p>I was using a makefile to build for multiple platforms using multiple rules, so for me, I put</p>\n\n<pre><code>export CGO_ENABLED = 1\n</code></pre>\n\n<p>near the top of my makefile so that I didn't need to specify it for each platform.</p>\n"}], "owner": {"reputation": 135, "user_id": 5892013, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-BpIz_wZA__Y/AAAAAAAAAAI/AAAAAAAAAHI/7F3QzbvKQCA/photo.jpg?sz=128", "display_name": "SYZYGY-DEV 333", "link": "https://stackoverflow.com/users/5892013/syzygy-dev-333"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1879, "favorite_count": 0, "accepted_answer_id": 62453535, "answer_count": 1, "score": 2, "last_activity_date": 1592493939, "creation_date": 1487453827, "question_id": 42320962, "link": "https://stackoverflow.com/questions/42320962/golang-compiler-error-cant-load-package-package-main-no-buildable-go-source", "title": "golang compiler error: can&#39;t load package: package main: no buildable Go source files in /home/ubuntu/workspace/Go", "body": "<p>I am attempting to compile a go program. The code is a small x11 window manager, found <a href=\"https://raw.githubusercontent.com/SYZYGY-DEV333/littlewm/master/littlewm.go\" rel=\"nofollow noreferrer\"><strong>HERE</strong>.</a> (The code is 98 lines, too long to post here)</p>\n\n<p>Here is the command I run, on x86-64 Ubuntu:</p>\n\n<p><code>GOOS=linux GOARCH=386 go build littlewm.go</code></p>\n\n<p>This command works fine on other files in the same directory. However, when I try to compile this one, I get the following error:</p>\n\n<p><code>can't load package: package main: no buildable Go source files in /home/ubuntu/workspace/Go</code></p>\n\n<p>This does not involve the <code>gopath</code> variable, as I have successfully compiled other programs in the same directory. I have a suspicion it involves the code itself or some option I am lacking. As such, this is not really a duplicate of an existing question and is quite possibly unique, since I am not getting the answer I want from other similar questions. Any help is appreciated greatly.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["web", "go", "ldap"], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": false, "score": 0, "last_activity_date": 1487444855, "creation_date": 1487444855, "answer_id": 42319478, "question_id": 42319145, "link": "https://stackoverflow.com/questions/42319145/whats-the-easy-way-to-add-ldap-support-for-a-simple-golang-web-app/42319478#42319478", "title": "What&#39;s the easy way to add ldap support for a simple golang web app?", "body": "<p>The first part of this is the UX - if you go with HTTP basic authentication, you can probably avoid writing any code, assuming there's a webserver in front of your app most will have authentication support. If you want to stick to go, <code>http.Request</code> makes handling basic <a href=\"https://golang.org/pkg/net/http/#Request.BasicAuth\" rel=\"nofollow noreferrer\">pretty easy</a>, and there are many ways of composing <code>net/http</code> based handlers together, so bikeshed away.</p>\n\n<p>If you require an integrated login form, then of course you'll have to write that logic, but you can take a micro service style approach, and implement that logic by calling to an HTTP basic auth based service internally. I think this approach makes sense if you prefer to use a generic LDAP authentication (e.g. nginx/apache module or something like that), but not if you want to talk to the LDAP server yourself.</p>\n\n<p>As for the actual credentials, if you do need to do that manually, there are multiple LDAP implementations in go. I've had success with <a href=\"https://github.com/go-ldap/ldap\" rel=\"nofollow noreferrer\">go-ldap</a> for both binding and legacy password validation by fetching fields as an admin user.</p>\n"}], "owner": {"reputation": 1, "user_id": 7477018, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mg1eAK1xmK4/AAAAAAAAAAI/AAAAAAAAGx8/tfg3gTqQgUk/photo.jpg?sz=128", "display_name": "AgentPenguin", "link": "https://stackoverflow.com/users/7477018/agentpenguin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 399, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1487444855, "creation_date": 1487443040, "question_id": 42319145, "link": "https://stackoverflow.com/questions/42319145/whats-the-easy-way-to-add-ldap-support-for-a-simple-golang-web-app", "title": "What&#39;s the easy way to add ldap support for a simple golang web app?", "body": "<p>I have an internal tool written in golang, with a simple web interface which is just a single web page. </p>\n\n<p>Now I need to add a \"login with ldap\" feature but don't know much about the web stuff, is there something like a \"middleware\" which I could simply plug into my application without introducing a whole \"web framework\"?</p>\n"}, {"tags": ["video", "go", "server", "stream"], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": false, "score": 2, "last_activity_date": 1487477393, "last_edit_date": 1487477393, "creation_date": 1487445803, "answer_id": 42319663, "question_id": 42318795, "link": "https://stackoverflow.com/questions/42318795/efficiently-stream-large-file-video-from-go-server/42319663#42319663", "title": "efficiently stream large file (video) from go server", "body": "<p>I'm not sure what you mean by \"efficient\" so I will assume you mean that large files are streamed and not buffered.</p>\n\n<p>The standard <code>http.FileServer</code> eventually writes data using <a href=\"https://golang.org/src/net/http/fs.go#L148\" rel=\"nofollow noreferrer\">the <code>serveContent</code> function</a>, which requires an <code>io.ReadSeeker</code> as the contents (fortunately files are just that).</p>\n\n<p>The contents is then copied using <code>io.Copy</code>, which in the general case (though probably not your common case, see below) means <a href=\"https://golang.org/src/io/io.go#L374\" rel=\"nofollow noreferrer\"><code>copyBuffer</code></a>. will use a 32KB buffer.</p>\n\n<p>Therefore, assuming the implementation of <code>http.ResponseWriter</code> does not buffer its input (<a href=\"https://golang.org/src/net/http/server.go#L394\" rel=\"nofollow noreferrer\">it doesn't</a>, see also <a href=\"https://golang.org/src/net/http/internal/chunked.go\" rel=\"nofollow noreferrer\">chunked writer</a>), memory utilization should be constant.</p>\n\n<p>However when the writer supports a <code>ReadFrom</code> method, <a href=\"https://golang.org/src/io/io.go#L382\" rel=\"nofollow noreferrer\"><code>io.Copy</code> will use that instead</a>. Because <code>http.response</code> (the standard  implementation of <code>ResponseWriter</code> interface) <a href=\"https://golang.org/src/net/http/server.go#L545\" rel=\"nofollow noreferrer\">implements the ReadFrom method</a>, it'll be used instead of <code>copyBuffer</code>. This implementation in turn will try use the <code>sendfile</code> system call when possible (as is the case for <code>os.File</code>), which is a stronger meaning of efficient (the data doesn't have to go through the process memory space at all, so about as good as it gets).</p>\n\n<p>In other words, I think it's reasonable to say that the built in <code>net/http</code> package already supports efficient streaming of large files.</p>\n"}], "owner": {"reputation": 375, "user_id": 7586020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7579bdcac485b4049acfbd184604219?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7586020/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1506, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1487477393, "creation_date": 1487441169, "question_id": 42318795, "link": "https://stackoverflow.com/questions/42318795/efficiently-stream-large-file-video-from-go-server", "title": "efficiently stream large file (video) from go server", "body": "<p>I am implementing video stream server in Go.\nI am currently using standard <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\">fileserver</a> but I am unsure if it is efficient with large files (4GB+).</p>\n\n<p>Is there a way to efficiently serve large file in Go?</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1487440722, "post_id": 42318448, "comment_id": 71790713, "body": "If they&#39;re all strings, why not use a map?"}, {"owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1487481321, "post_id": 42318448, "comment_id": 71800886, "body": "thanks bro, but if i use map, what it will become?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1487658173, "post_id": 42318448, "comment_id": 71870413, "body": "myMap := make(map[string]string) Checkout <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">blog.golang.org/go-maps-in-action</a> and <a href=\"https://gobyexample.com/maps\" rel=\"nofollow noreferrer\">gobyexample.com/maps</a>"}, {"owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1487666039, "post_id": 42318448, "comment_id": 71874610, "body": "how to convert json string into map[string]string? myMap := make(map[string]string) myMap[&quot;Id&quot;]=\u2018json:&quot;id&quot; required:&quot;true&quot;\u2018 myMap[&quot;compCd&quot;]=\u2018json:&quot;compCd&quot; required:&quot;true&quot;\u2018 strJson := []byte(<code>{&quot;items&quot;:{&quot;id&quot;:&quot;01&quot;,&quot;comCd&quot;:&quot;0001&quot;}</code>) if err := json.Unmarshal(strJson, &amp;myMap); err != nil { \t\tfmt.Println(&quot;ERROR&quot;) } fmt.Println(myMap) // ERROR  Can this code will work? i tried but it&#39;s cant work."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1488005615, "post_id": 42448436, "comment_id": 72049317, "body": "thanks you for answer, but if i wanna check validate <code>json:&quot;id&quot;        required:&quot;true&quot;</code>, how can i check it?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1488054171, "post_id": 42448436, "comment_id": 72064526, "body": "Anything that is required, you would just have check manually if it exists in the map. I updated my playground link with such a check."}, {"owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1488188714, "post_id": 42448436, "comment_id": 72104437, "body": "i change myMap with many &quot;items&quot;. When i use json.Unmashal(strJson, data), why data became map[]. I wanna loop by &quot;items&quot; key then json.Mashal(data) to write file. Playground:<a href=\"https://play.golang.org/p/1hglmTXxBZ\" rel=\"nofollow noreferrer\">play.golang.org/p/1hglmTXxBZ</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1488218367, "post_id": 42448436, "comment_id": 72124514, "body": "@HoangTan I modified the playground link to take account for the fact that &quot;items&quot; can have more than one <code>item</code>. I should have known, but none of your examples actually had more than one <code>item</code>, so I just spaced it."}, {"owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1488261561, "post_id": 42448436, "comment_id": 72140797, "body": "I understood. Thanks you very much.  When i search created data, i received map didn&#39;t sort, not like the same input data. I knew map[string]string didn&#39;t sort. If it is map[string]int or map[int]string i can sort it, but it&#39;s map[string]string. How can i sort map[string]string to become the same inputdata?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1488556257, "post_id": 42448436, "comment_id": 72298752, "body": "Build a slice of key value pairs using <code>for key, value := range mp { ... }</code> then sort by the key using a sorting library. If it is JSON, why does it need to be sorted?"}, {"owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1488770903, "post_id": 42448436, "comment_id": 72362992, "body": "I create files with the format data,  when i search and read it from created file, i want output data have the same format. Because exist data bring that format then i want it the same.  If i use a slice to sort map, the format will be changed."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "edited": false, "score": 0, "creation_date": 1488843436, "post_id": 42448436, "comment_id": 72402866, "body": "You are trying to do something that isn&#39;t part of the JSON specification. JSON objects have no specific order and are actually related to dictionaries or maps in the spec. JSON arrays are ordered, so your array of <code>items</code> will be in order, but the objects in the array carry no such guarantee. If you want to enforce ordering, you will need to do it manually. Even different languages will often order JSON objects differently. The same JSON string input is not guaranteed to == string output. See the portion just after the first paragraph here: <a href=\"http://www.json.org/\" rel=\"nofollow noreferrer\">json.org</a>"}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 0, "last_activity_date": 1488218327, "last_edit_date": 1488218327, "creation_date": 1487971047, "answer_id": 42448436, "question_id": 42318448, "link": "https://stackoverflow.com/questions/42318448/how-to-compact-json-in-struct-golang/42448436#42448436", "title": "how to compact Json in Struct Golang", "body": "<p>I copied and pasted the code in your comment. It was missing the ending <code>}</code> to finish the json string. Also, you need a struct to tie the <code>items</code> map to. Here is a working playground link.</p>\n\n<p>EDIT: I didn't realize there would be more than one \"items\", which I should have assumed given the plural name. Here is an updated playground link that takes care of that.</p>\n\n<p><a href=\"https://play.golang.org/p/5T2C6KrVOD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5T2C6KrVOD</a></p>\n"}], "owner": {"reputation": 11, "user_id": 7523843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--j_DJOwhiVQ/AAAAAAAAAAI/AAAAAAAAAFE/tVgoLW6HE3k/photo.jpg?sz=128", "display_name": "Hoang Tan", "link": "https://stackoverflow.com/users/7523843/hoang-tan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 987, "favorite_count": 1, "accepted_answer_id": 42448436, "answer_count": 1, "score": 0, "last_activity_date": 1488218327, "creation_date": 1487439364, "question_id": 42318448, "link": "https://stackoverflow.com/questions/42318448/how-to-compact-json-in-struct-golang", "title": "how to compact Json in Struct Golang", "body": "<pre><code>package questionnaire\n\nimport (\n    \"encoding/json\"\n)\n\ntype Items []Item\n\ntype CreateData struct {\n    Items []Item\n}\n\ntype Item struct {\n    Id        enter code herestring `json:\"id\"        required:\"true\"`\n    CompCd    string `json:\"compCd\"    required:\"true\"`\n    OrgCd     string `json:\"orgCd\"`\n    QstnId    string `json:\"qstnId\"    required:\"true\"`\n    QstnIdSeq string `json:\"qstnIdSeq\" required:\"true\"`\n    CustId    string `json:\"custId\"`\n    AnsDts    string `json:\"ansDts\"    required:\"true\"`\n    AnsRout   string `json:\"ansRout\"   required:\"true\"`\n    QCd01     string `json:\"qCd01\"`\n    QKey01    string `json:\"qKey01\"`\n    QStc01    string `json:\"qStc01\"`\n    QCat01    string `json:\"qCat01\"`\n    Pont01    string `json:\"pont01\"`\n    PCat01    string `json:\"pCat01\"`\n    Comt01    string `json:\"comt01\"`\n    QCd02     string `json:\"qCd02\"`\n    QKey02    string `json:\"qKey02\"`\n    QStc02    string `json:\"qStc02\"`\n    QCat02    string `json:\"qCat02\"`\n    Pont02    string `json:\"pont02\"`\n    PCat02    string `json:\"pCat02\"`\n    Comt02    string `json:\"comt02\"`\n    .\n    .\n    .\n    QCd50     string `json:\"qCd50\"`\n    QKey50    string `json:\"qKey50\"`\n    QStc50    string `json:\"qStc50\"`\n    QCat50    string `json:\"qCat50\"`\n    Pont50    string `json:\"pont50\"`\n    PCat50    string `json:\"pCat50\"`\n    Comt50    string `json:\"comt50\"\n}\n</code></pre>\n\n<p>I'm newbie. I just learn go language a few day before..\nMy problem: How to compact this Item struct block. If i write from QCd01 to QCd50 this code can run but so bad!\n    Sorry I'm not good at English. </p>\n"}]