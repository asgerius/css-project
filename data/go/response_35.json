[{"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1441824645, "post_id": 32487032, "comment_id": 52834941, "body": "I don&#39;t see what functionality you want that isn&#39;t provided by <a href=\"http://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\"><code>http.ServeMux</code></a>. <code>ServeMux</code> is just a type of handler that can dispatch to other handlers based on the request. There&#39;s also a plethora of http router packages for Go with various features if <code>ServeMux</code> doesn&#39;t suit your needs."}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441825090, "post_id": 32487032, "comment_id": 52835122, "body": "For reasons that aren&#39;t relevant to the question,  I can&#39;t use DefaultServeMux (I&#39;ll update the OP to mention that), so I have to either create a new ServeMux or do what I did in the OP. Either way, I would like to figure out how to keep a reference to the database with the handler"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441825143, "post_id": 32487032, "comment_id": 52835147, "body": "So don&#39;t use DefaultServeMux, and create a new instance of ServeMux."}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441825474, "post_id": 32487032, "comment_id": 52835320, "body": "@JimB I guess my question isn&#39;t clear. that&#39;s what I want to do, but I don&#39;t know how to integrate it with the handler that has the reference to the database. that&#39;s the whole point of the question. Sorry if it wasn&#39;t clear."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441826013, "post_id": 32487032, "comment_id": 52835576, "body": "DefaultServeMux <i>is</i> a ServeMux, and you use it the exact same way. The only difference is you have to choose to use your new ServeMux, by giving it to ListenAndServe or your instance of http.Server. Try <a href=\"http://golang.org/src/net/http/server.go?#L1938\" rel=\"nofollow noreferrer\">looking at the source</a> for the http convenience methods methods if you&#39;re not sure what they do."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1441826499, "post_id": 32487032, "comment_id": 52835813, "body": "You seem to be asking the exact same question you asked here: <a href=\"http://stackoverflow.com/questions/32330744/how-to-implement-handlerfunc-without-using-defaultservemux\" title=\"how to implement handlerfunc without using defaultservemux\">stackoverflow.com/questions/32330744/&hellip;</a>"}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441827412, "post_id": 32487032, "comment_id": 52836261, "body": "same topic area, but not the same question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441827802, "post_id": 32487032, "comment_id": 52836444, "body": "It&#39;s not the same question (which is why I didn&#39;t mark it as an exact duplicate), but the answer is nearly the same. It shows how to create and use a ServeMux to route requests to different handlers. Otherwise you need to tell us what ServeMux doesn&#39;t provide that you&#39;re missing."}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441828368, "post_id": 32487032, "comment_id": 52836707, "body": "ok, looking at the answer that was provided. Assume that code was in main.go of <code>package main</code> (and main.go was the only file in that package) but your project was composed of several packages (i.e. not just that package main), and the <code>type auth struct</code> was part of one of the other packages. How to compose the reference to the NewServeMux into the auth struct so you can handle routing in the other packages of your project I.e I don&#39;t want every route of my project defined in the main function of main.go That&#39;s what I&#39;m asking in this op but with more context. Thanks for helping if it&#39;s clear"}, {"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441828439, "post_id": 32487032, "comment_id": 52836745, "body": "i.e. the goal is to avoid handling routing in <code>func main</code> of package main, but instead to have a reference to the mux in a struct in one of the other packages in the project."}], "answers": [{"comments": [{"owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 0, "creation_date": 1441833253, "post_id": 32488787, "comment_id": 52839136, "body": "I appreciate your time and effort but the point of the question was how to use the NewServeMux outside of the main function of <code>package main</code>  (say, for example, by making it part of a type Handler struct from one of th eother packages) and those are the only examples you provided. I&#39;ll give you an upvote but I can&#39;t accept the answer because it doesn&#39;t respond to the question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 1, "creation_date": 1441833627, "post_id": 32488787, "comment_id": 52839304, "body": "@BrainLikeADullPencil: I&#39;m really failing to see what you&#39;re missing. This shows exactly that; there&#39;s no reason you can&#39;t define the <code>sub</code> <code>ServeMux</code> in a separate package and choose how to rout it in main, or as I mentioned, you could provide a registration pattern for <code>sub</code>&#39;s package to register routes itself ( for example, <code>net&#47;http&#47;pprof</code> self-registers routes in the <code>DefaultServeMux</code>)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "edited": false, "score": 0, "creation_date": 1441834569, "post_id": 32488787, "comment_id": 52839671, "body": "@BrainLikeADullPencil: I changed the example to do the exact same thing, except import the ServeMux from another package."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1441834502, "last_edit_date": 1441834502, "creation_date": 1441831245, "answer_id": 32488787, "question_id": 32487032, "link": "https://stackoverflow.com/questions/32487032/how-to-compose-a-new-servemux-into-a-larger-struct/32488787#32488787", "title": "How to compose a new ServeMux into a larger struct?", "body": "<p>Your custom handler struct, a ServeMux, a HandlerFunc, and 3rd party routers are <em>all</em> of type <code>http.Handler</code>. You can compose and layer them as needed. </p>\n\n<p>Since a ServeMux is a Handler, you can assign it to a path just like any other handler, and register separate paths for various handlers. Here's an example of using multiple <code>http.ServeMux</code> (which could be defined in separate packages if you choose). This has 3 separate handlers (defined via a <code>HandlerFunc</code>), routed over 2 <code>ServeMux</code>.</p>\n\n<p>Here we have a ServeMux create in a package \"router\"</p>\n\n<pre><code>var Sub = http.NewServeMux()\n\nfunc subHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"handled / in /sub\")\n    w.Write([]byte(\"/sub/\\n\"))\n}    \n\nfunc init() {\n    Sub.HandleFunc(\"/\", subHandler)\n}\n</code></pre>\n\n<p>Now we can import the ServeMux from \"router\", and use it in our top level Handler, along with some others:</p>\n\n<pre><code>import \"router\"\n\nfunc rootHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"handled /\")\n    w.Write([]byte(\"/\\n\"))\n}\n\nfunc topHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"handled /top\")\n    w.Write([]byte(\"/top/\\n\"))\n}\nfunc main() {\n\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\", rootHandler)\n    mux.HandleFunc(\"/top/\", topHandler)\n\n    // now insert the Sub routes under \"/top/sub/\"\n    mux.Handle(\"/top/sub/\", http.StripPrefix(\"/top\", router.Sub))\n\n    server := &amp;http.Server{Addr: \":9999\", Handler: mux}\n    log.Fatal(server.ListenAndServe())\n}\n</code></pre>\n\n<p>How you choose to register these is up to you, either via importing and routing them like this in the <code>main</code> package, or via some other registration pattern (like e.g the <code>database/sql</code> drivers).</p>\n\n<p>There's also no shortage of 3rd party routing packages to make this easier, higher performance, or provide more advanced methods of pattern matching.</p>\n"}], "owner": {"reputation": 10253, "user_id": 1647484, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/W7T7D.png?s=128&g=1", "display_name": "BrainLikeADullPencil", "link": "https://stackoverflow.com/users/1647484/brainlikeadullpencil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 845, "favorite_count": 0, "accepted_answer_id": 32488787, "answer_count": 1, "score": -2, "last_activity_date": 1441834502, "creation_date": 1441824258, "last_edit_date": 1441825114, "question_id": 32487032, "link": "https://stackoverflow.com/questions/32487032/how-to-compose-a-new-servemux-into-a-larger-struct", "title": "How to compose a new ServeMux into a larger struct?", "body": "<p>In previous golang applications I've made that use the DefaultServeMux, if I had a route like this <code>\"/users/\"</code> route that was handled by <code>func user(name string)</code>, for example, and I sent a request to <code>/users/jim</code>, the request would still be handled by the <code>\"/users/\"</code> route. In the current application I'm making, I'm not using <code>DefaultServeMux</code> but merely passing a handler that implements ServeHTTP and then switching on the request url. However, now, if I send a request to a route that doesn't exactly match, the handler function doesn't get called. For example, if I send a post request to <code>\"/api/jim\"</code>, I get a 404 error even though <code>\"/api\"</code> is handled.</p>\n\n<p>I want to keep my application the way it is (with a reference to the DB in the handler) but also be able to handle routes that don't match exactly. </p>\n\n<p>Question: Assuming I could create a new ServeMux to handle routes that don't exactly match, but how can I compose that with my type Handler Struct that has the reference to the database connection?</p>\n\n<pre><code>type Handler struct{\n  DB *DB\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n\n    db, err := sql.Open(\"postgres\", dbinfo)\n    defer db.Close()\n\n    h := &amp;Handler{\n      DB: db,\n    }\n\n    log.Fatal(http.ListenAndServe(\":8888\", h))\n}\n\nfunc (h *Handler)ServeHTTP(w http.ResponseWriter, r *http.Request){\n\n    switch r.URL.Path{\n        case \"/\":\n        h.serveRoot(w, r)\n        case \"/api/\":\n        h.apiRouter(w, r)\n    }\n}\n\nfunc (h *Handler)serveRoot(w http.ResponseWriter, r *http.Request){\n        h.DB.DoSomethingWithDB()\n}\n\nfunc (h *Handler)apiRouter(w http.ResponseWriter, r *http.Request){\n\n       switch r.URL.Path{\n\n           case \"/\":\n               h.serveRoot(w, r)\n           case \"/api/\":\n               h.apiRouter(w, r)\n\n       }\n}\n</code></pre>\n\n<p><strong>Update</strong>\nFor reasons that aren't relevant to the question, I can't use DefaultServeMux  </p>\n"}, {"tags": ["go", "coding-style"], "comments": [{"owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "edited": false, "score": 0, "creation_date": 1441828068, "post_id": 32486466, "comment_id": 52836568, "body": "can you paste a bit of the run code? the &quot;go way&quot; is to use small interfaces when possible, but with the given information is impossible to tell if that&#39;s an alternative."}, {"owner": {"reputation": 5435, "user_id": 1837431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lgWi1.jpg?s=128&g=1", "display_name": "Tim Allclair", "link": "https://stackoverflow.com/users/1837431/tim-allclair"}, "reply_to_user": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "edited": false, "score": 0, "creation_date": 1441830264, "post_id": 32486466, "comment_id": 52837613, "body": "@PabloFernandez <a href=\"https://gist.github.com/timstclair/a4582cd48bc567c8576a\" rel=\"nofollow noreferrer\">Here</a> is full method. Please note this is part of a larger unfinished change, and I&#39;m not sure whether it compiles yet. The same question applies to doProbe as well, which is just separated for clarity."}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1441822762, "creation_date": 1441822762, "answer_id": 32486645, "question_id": 32486466, "link": "https://stackoverflow.com/questions/32486466/go-best-practices-function-vs-method-with-ambiguous-receiver/32486645#32486645", "title": "Go best practices: function vs method with ambiguous receiver?", "body": "<p>They are all actually equivalent. The receiver is passed into the method like every other argument. Since you need both types on hand no matter what (to call the method) it doesn't really matter on which it's defined. Personally, based on that, I would use the last of your three options. It makes more sense to me because in the other cases you're associating the method with one of those two types when really it requires both. That's just a matter of how you would like to organize your code though. There is no benefit from one to the other regarding performance or application behavior, they're all the same.</p>\n\n<p>EDIT: One last point. None of those would be exported so it's a 'private' or rather a method used as a helper internal to the package. More reason to not have a receiving type for it.</p>\n"}, {"comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1441905770, "post_id": 32491877, "comment_id": 52875188, "body": "Good point I didn&#39;t think of but his methods are not exported so I don&#39;t think they can implement an interface? Not a topic I&#39;m sure about but it just wouldn&#39;t make any sense to fulfill an interface with methods that aren&#39;t exposed outside of a scope where the interface isn&#39;t necessary."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1441920406, "post_id": 32491877, "comment_id": 52882784, "body": "The coding style described in the last paragraph is also often called a <i>decorator</i> pattern. AO and monkey patching often imply there is, in addition, some clever under-the-hood foo, maybe at the bytecode level. This isn&#39;t the case in Go, which is a simple straightforward no-fuss model, so the <i>decorator</i> term is more appropriate."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 3, "last_activity_date": 1441850382, "creation_date": 1441850382, "answer_id": 32491877, "question_id": 32486466, "link": "https://stackoverflow.com/questions/32486466/go-best-practices-function-vs-method-with-ambiguous-receiver/32491877#32491877", "title": "Go best practices: function vs method with ambiguous receiver?", "body": "<p>Using methods allows you to define interfaces. Suppose you have:</p>\n\n<pre><code>func (m *ProbeManager) Run(w *ProbeWorker) {} \n</code></pre>\n\n<p>You can create an interface:</p>\n\n<pre><code>type Manager interface {\n    Run(w *ProbeWorker)\n}\n</code></pre>\n\n<p>And now anything that took the <code>*ProbeManager</code> can take a <code>Manager</code> instead. This decouples <code>Run</code> from the details of its implementation. There are many reasons why this is useful:</p>\n\n<ul>\n<li>It makes code easier to reason about and easier to safely change because it hides unnecessary details (<a href=\"https://en.wikipedia.org/wiki/Information_hiding\" rel=\"nofollow\">information hiding</a>)</li>\n<li><p>It makes code easier to test as you can mock out an interface and test a small segment of your code in isolation:</p>\n\n<pre><code>type mockManager struct {\n    run func(w *ProbeWorker)\n}\n\nfunc (m mockManager) Run(w *ProbeWorker) {\n    m.run(w)\n}\n\nfunc Test(t *testing.T) {\n    wasCalled := false\n    m := mockManager{\n        run: func(w *ProbeWorker) {\n            wasCalled = true\n        },\n    }\n    // pass m to something that takes a Manager\n}\n</code></pre></li>\n<li><p>Interfaces also give you the ability to implement <a href=\"https://en.wikipedia.org/wiki/Inversion_of_control\" rel=\"nofollow\">dependency injection</a>. There are many approaches, but one very simple one is to provide a <code>Default</code> implementation:</p>\n\n<pre><code>var DefaultManager Manager = &amp;ProbeManager{}\n</code></pre>\n\n<p>Or a string-based registry:</p>\n\n<pre><code>var managerLookup = map[string]Manager{}\n\nfunc RegisterManager(nm string, m Manager) {\n    managerLookup[nm] = m\n}\n\nfunc GetManager(nm string) Manager {\n    return managerLookup[nm]\n}\n</code></pre>\n\n<p>This is very powerful because it allows you modify the behavior of existing packages without having to change their code. (For example imagine you had a file downloader and you implemented <code>http</code> support. Someone else could provide <code>ftp</code> support, and the code needed to parse URLs wouldn't need to change by using this registry approach)</p></li>\n<li><p>Interfaces allow you to implement similar approaches to problems that you will find in other programming languages. They give you a kind of generic polymorphism (see the <code>sort</code> package), you can implement Aspect Oriented Programming or Monkey Patching by implementing an interface which invokes the same interface (consider a <code>gzip.Reader</code> which invokes an underlying <code>File</code>. Anything that takes an <code>io.Reader</code> can also take a <code>gzip.Reader</code>, allowing you to substitute behavior without having to change the rest of your code)</p></li>\n</ul>\n\n<p>I could keep going...</p>\n"}], "owner": {"reputation": 5435, "user_id": 1837431, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lgWi1.jpg?s=128&g=1", "display_name": "Tim Allclair", "link": "https://stackoverflow.com/users/1837431/tim-allclair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1218, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1495004686, "creation_date": 1441822088, "question_id": 32486466, "link": "https://stackoverflow.com/questions/32486466/go-best-practices-function-vs-method-with-ambiguous-receiver", "title": "Go best practices: function vs method with ambiguous receiver?", "body": "<p>What are the best practices around when to use methods vs. functions in Go? </p>\n\n<p>Specifically, I have 2 structs: <code>probeManager</code> and <code>probeWorker</code>, and I'm writing a function <code>run</code> which needs to access members of both structs. This could be interpreted as telling the manager to run the worker, or as calling run on the worker and passing the manager for access, or I could just create a run function which takes both as arguments:</p>\n\n<pre><code>func (m *ProbeManager) run(w *ProbeWorker) { ... }\nfunc (w *ProbeWorker) run(m *ProbeManager) { ... }\nfunc run(m *ProbeManager, w *ProbeWorker) { ... }\n</code></pre>\n\n<p>Since all 3 approaches are semantically valid, are there any advantages to one approach over another, or does this just come down to personal preference?</p>\n"}, {"tags": ["google-app-engine", "go", "rsa"], "answers": [{"comments": [{"owner": {"reputation": 698, "user_id": 1745000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/010ba737c6864d2960c85a8dfc2ecf61?s=128&d=identicon&r=PG", "display_name": "Kugutsumen", "link": "https://stackoverflow.com/users/1745000/kugutsumen"}, "edited": false, "score": 0, "creation_date": 1446547546, "post_id": 32491810, "comment_id": 54777926, "body": "great! I&#39;ll send you a pull request so you can specify which app signed.. You can pull the certs of an app using these ... (I don&#39;t remember how I found out and can&#39;t find any documentation. It&#39;s been working for a few years though)  <a href=\"https://www.googleapis.com/service_accounts/v1/metadata/x509/APPID@appspot.gserviceaccount.com\" rel=\"nofollow noreferrer\">googleapis.com/service_accounts/v1/metadata/x509/&hellip;</a>  <a href=\"https://www.googleapis.com/service_accounts/v1/metadata/raw/APPID@appspot.gserviceaccount.com\" rel=\"nofollow noreferrer\">googleapis.com/service_accounts/v1/metadata/raw/&hellip;</a>"}], "tags": [], "owner": {"reputation": 9371, "user_id": 196964, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/df6zG.jpg?s=128&g=1", "display_name": "Doug Richardson", "link": "https://stackoverflow.com/users/196964/doug-richardson"}, "is_accepted": true, "score": 4, "last_activity_date": 1442502393, "last_edit_date": 1592644375, "creation_date": 1441849921, "answer_id": 32491810, "question_id": 32486427, "link": "https://stackoverflow.com/questions/32486427/how-do-you-verify-the-signature-returned-by-appengine-signbytes/32491810#32491810", "title": "How do you verify the signature returned by appengine.SignBytes?", "body": "<h1>VerifyPKCS1v15 using SHA256</h1>\n<p>I discovered this by trying all combinations of verification scheme and hash type; I did not find documentation guaranteeing this is the signature scheme that will be used.</p>\n<p>But for the intrepid, below is a code sample that signs data and verifies the signature.</p>\n<pre><code>package yourpackage\n\nimport (\n    &quot;crypto&quot;\n    &quot;crypto/rsa&quot;\n    &quot;crypto/x509&quot;\n    &quot;encoding/pem&quot;\n    &quot;errors&quot;\n    &quot;google.golang.org/appengine&quot;\n    &quot;net/http&quot;\n)\n\nfunc signAndVerify(request *http.Request) error {\n    c := appengine.NewContext(request)\n    data := []byte(&quot;test data to sign&quot;)\n    _, sig, err := appengine.SignBytes(c, data)\n    if err != nil {\n        return err\n    }\n\n    certs, err := appengine.PublicCertificates(c)\n    if err != nil {\n        return err\n    }\n\n    lastErr := errors.New(&quot;ErrNoPublicCertificates&quot;)\n\n    for _, cert := range certs {\n        block, _ := pem.Decode(cert.Data)\n        if block == nil {\n            lastErr = errors.New(&quot;ErrPemDecodeFailure&quot;)\n            continue\n        }\n        x509Cert, err := x509.ParseCertificate(block.Bytes)\n        if err != nil {\n            lastErr = err\n            continue\n        }\n        pubkey, ok := x509Cert.PublicKey.(*rsa.PublicKey)\n        if !ok {\n            lastErr = errors.New(&quot;ErrNotRSAPublicKey&quot;)\n            continue\n        }\n\n        signBytesHash := crypto.SHA256\n        h := signBytesHash.New()\n        h.Write(data)\n        hashed := h.Sum(nil)\n        err = rsa.VerifyPKCS1v15(pubkey, signBytesHash, hashed, sig)\n        if err != nil {\n            lastErr = err\n            continue\n        }\n\n        return nil\n    }\n\n    return lastErr\n}\n</code></pre>\n<p>I've also published the the verify step in a <a href=\"https://godoc.org/github.com/drichardson/appengine/signature\" rel=\"nofollow noreferrer\">package</a> on github.</p>\n<h1>Update</h1>\n<p>Google provides some <a href=\"https://sites.google.com/site/oauthgoog/authenticate-google-app-engine-app\" rel=\"nofollow noreferrer\">sample code</a> that verifies SignBytes. In it, there is a file <code>app-identity-samples-read-only/python/app_identity_test.py</code> has a method named <code>buildjwt</code> that creates a JWT signed by SignBytes, and the JWT alg is RS256, which is defined in <a href=\"https://tools.ietf.org/html/rfc7518\" rel=\"nofollow noreferrer\">RFC 7518</a> to be RSASSA-PKCS1-v1_5 using SHA-256.</p>\n<p><em>Note: I'm using <a href=\"https://github.com/golang/appengine\" rel=\"nofollow noreferrer\">Go App Engine for Managed VMs</a> (see &quot;google.golang.org/appengine&quot; import) rather than the classic Go App Engine runtime, though there isn't really much different for the purposes of SignBytes.</em></p>\n"}], "owner": {"reputation": 9371, "user_id": 196964, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/df6zG.jpg?s=128&g=1", "display_name": "Doug Richardson", "link": "https://stackoverflow.com/users/196964/doug-richardson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 548, "favorite_count": 2, "accepted_answer_id": 32491810, "answer_count": 1, "score": 3, "last_activity_date": 1442502393, "creation_date": 1441821918, "question_id": 32486427, "link": "https://stackoverflow.com/questions/32486427/how-do-you-verify-the-signature-returned-by-appengine-signbytes", "title": "How do you verify the signature returned by appengine.SignBytes?", "body": "<p>Google App Engine's Go runtime has a <a href=\"https://cloud.google.com/appengine/docs/go/reference#SignBytes\" rel=\"nofollow\">SignBytes</a> function, a <a href=\"https://cloud.google.com/appengine/docs/go/reference#PublicCertificates\" rel=\"nofollow\">PublicCertificates</a> function, and a <a href=\"https://cloud.google.com/appengine/docs/go/reference#Certificate\" rel=\"nofollow\">Certificate</a> structure.</p>\n\n<blockquote>\n  <h1>func SignBytes</h1>\n\n<pre><code>func SignBytes(c Context, bytes []byte) (keyName string, signature []byte, err error) \n</code></pre>\n  \n  <p>SignBytes signs bytes using a private key unique to your application.</p>\n  \n  <h1>func PublicCertificates</h1>\n\n<pre><code>func PublicCertificates(c Context) ([]Certificate, error) \n</code></pre>\n  \n  <p>PublicCertificates retrieves the public certificates for the app. They\n  can be used to verify a signature returned by SignBytes.</p>\n  \n  <h1>type Certificate</h1>\n\n<pre><code>type Certificate struct {\n    KeyName string\n    Data    []byte // PEM-encoded X.509 certificate\n}\n</code></pre>\n  \n  <p>Certificate represents a public certificate for the app.</p>\n</blockquote>\n\n<p>It's clear that the application is expected to iterate through the public certificates to verify the signature. But it is not clear how the signature is generate or verified. Go's <a href=\"https://golang.org/pkg/crypto/rsa/\" rel=\"nofollow\">rsa package</a> has two functions to verify signatures, <a href=\"https://golang.org/pkg/crypto/rsa/#VerifyPKCS1v15\" rel=\"nofollow\">VerifyPKCS1v15</a> and <a href=\"https://golang.org/pkg/crypto/rsa/#VerifyPSS\" rel=\"nofollow\">VerifyPSS</a>, and each of those functions takes a <a href=\"https://golang.org/pkg/crypto/#Hash\" rel=\"nofollow\">crypto.Hash</a> identifier as a parameter. Currently, there are 15 different hash identifiers (e.g., crypto.MD5, crypto.SHA256) giving 2x15=30 combinations of verification function and hash identifier.</p>\n\n<p>How is the signature produced by SignBytes verified?</p>\n"}, {"tags": ["linux", "go", "liteide"], "answers": [{"tags": [], "owner": {"reputation": 3227, "user_id": 1923095, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/66893a32ed3f0cf5f0628c504b844701?s=128&d=identicon&r=PG", "display_name": "Zamicol", "link": "https://stackoverflow.com/users/1923095/zamicol"}, "is_accepted": false, "score": 2, "last_activity_date": 1460247125, "last_edit_date": 1460247125, "creation_date": 1441821270, "answer_id": 32486253, "question_id": 32486252, "link": "https://stackoverflow.com/questions/32486252/liteide-with-gvm-build-run-and-fmt-wont-work-environment-issues/32486253#32486253", "title": "LiteIDE with gvm. Build, run, and fmt won&#39;t work. Environment issues?", "body": "<p>The GOROOT is not set correctly in LiteIDE.  </p>\n\n<p>In a terminal enter <code>which go</code> to know where gvm installed go.  Example:</p>\n\n<pre><code>/home/username/.gvm/gos/go1.6/bin/go\n</code></pre>\n\n<p>In LiteIDE, click on the grey box \"edit current environment\" right of the environment drop down menu.</p>\n\n<p><a href=\"https://i.stack.imgur.com/vdvtQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vdvtQ.png\" alt=\"LiteIDE drop down menu\"></a></p>\n\n<p>Uncomment the GOROOT line in the system.env file and enter the correct path that you got from <code>which go</code>.  You omit \"/bin/go\".</p>\n\n<pre><code>GOROOT=/home/username/.gvm/gos/go1.6\n</code></pre>\n\n<p>Save the file.  If saving is greyed out, you might need to change the permission of LiteIDE's <code>liteenv</code> directory.  I installed mine to <code>/opt/liteide/share/liteide/liteenv</code>.</p>\n\n<p>When the settings are configured correctly, this is what you should see in LiteIDE's Build Output window:</p>\n\n<p><code>/home/username/.gvm/gos/go1.6/bin/go build -i [/home/username/go/src/project]\nSuccess: process exited with code 0.\n/home/username/go/src/bad/bad  [/home/username/go/src/project]\nHello World!\nSuccess: process exited with code 0.\n</code></p>\n\n<p>Instead of using the system environment config (the default in the drop down menu) I'm personally using the linux64-local.env file. My LiteIDE config file looks like this:</p>\n\n<pre><code># native compiler linux amd64\n\nGOROOT=/home/username/.gvm/gos/go1.6\n#GOBIN=\nGOARCH=amd64\nGOOS=linux\nCGO_ENABLED=1\n\nPATH=$GOROOT/bin:$PATH\n\nLITEIDE_GDB=gdb\nLITEIDE_MAKE=make\nLITEIDE_TERM=/usr/bin/gnome-terminal\nLITEIDE_TERMARGS=\nLITEIDE_EXEC=/usr/bin/xterm\nLITEIDE_EXECOPT=-e\n\nLITEIDE_SHELL=gnome-terminal;lxterminal;kconsole;xfce4-terminal;xterm\n</code></pre>\n"}], "owner": {"reputation": 3227, "user_id": 1923095, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/66893a32ed3f0cf5f0628c504b844701?s=128&d=identicon&r=PG", "display_name": "Zamicol", "link": "https://stackoverflow.com/users/1923095/zamicol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1460247125, "creation_date": 1441821270, "last_edit_date": 1442259225, "question_id": 32486252, "link": "https://stackoverflow.com/questions/32486252/liteide-with-gvm-build-run-and-fmt-wont-work-environment-issues", "title": "LiteIDE with gvm. Build, run, and fmt won&#39;t work. Environment issues?", "body": "<p>I've set up go (golang) on my Linux Mint (Ubuntu) box using gvm (Go Version Manager).</p>\n\n<p>I've started a project, but I can't get it to build from within LiteIDE. </p>\n\n<pre><code>go build -i [/home/username/go/src/projectname]\nError: process failed to start.\n</code></pre>\n\n<p>If I open a terminal and cd to the project's location and do a <code>go build</code> it works just fine.  My go env seems to work just fine outside of liteide.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1441894379, "last_edit_date": 1441894379, "creation_date": 1441822919, "answer_id": 32486680, "question_id": 32485021, "link": "https://stackoverflow.com/questions/32485021/simplifying-repetitive-error-handling-with-julienschmidt-httprouter/32486680#32486680", "title": "Simplifying repetitive error handling with julienschmidt httprouter", "body": "<p>Use closures:</p>\n\n<pre><code>type Handle func(http.ResponseWriter, *http.Request, Params)\n\ntype ErrHandle func(http.ResponseWriter, *http.Request, Params) error\n\nfunc (eh ErrHandle) ToHandle() Handle {\n    return func(w http.ResponseWriter, r *http.Request, p Params) {\n        if err := eh(w, r, p); err != nil {\n            http.Error(w, err.Error(), 500)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 771, "favorite_count": 1, "accepted_answer_id": 32486680, "answer_count": 1, "score": 5, "last_activity_date": 1441894379, "creation_date": 1441816709, "question_id": 32485021, "link": "https://stackoverflow.com/questions/32485021/simplifying-repetitive-error-handling-with-julienschmidt-httprouter", "title": "Simplifying repetitive error handling with julienschmidt httprouter", "body": "<p>Golang.org has a blogpost about how to do this:\n<a href=\"http://blog.golang.org/error-handling-and-go\" rel=\"noreferrer\">http://blog.golang.org/error-handling-and-go</a></p>\n\n<p>They basically make a new type</p>\n\n<pre><code>type appHandler func(http.ResponseWriter, *http.Request) error\n</code></pre>\n\n<p>Which implements the http.Handler interface like so</p>\n\n<pre><code>func (fn appHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    if err := fn(w, r); err != nil {\n        http.Error(w, err.Error(), 500)\n    }\n}\n</code></pre>\n\n<p>And with this you are able to return errors on your handleFunc which is great.</p>\n\n<p>But I am using the julienschmidt httprouter and that uses a function rather than an interface that implements http.Handler. I like to use this router because it supports named parameters. </p>\n\n<p>How can I wrap \"something\" around the httprouter.Handler function so that I can return errors and return other stuff aswel?</p>\n\n<p>Is there a way to do this to prevent repetitive error handling? I could not find a way.</p>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1441815832, "post_id": 32484676, "comment_id": 52830460, "body": "How about including the import for your db package? Pretty much required to ask this question."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1441815907, "post_id": 32484676, "comment_id": 52830497, "body": "What do you mean by import?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1441815984, "post_id": 32484676, "comment_id": 52830544, "body": "You probably have <code>import &quot;gopkg.in&#47;mgo.v2&quot;</code> at the top of your file but how should I know that? Maybe you&#39;re using <code>FictionalMongoDriver</code> instead. Hard to provide a decent answer when I&#39;m speculating about what library it is you&#39;re calling."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1441816040, "post_id": 32484676, "comment_id": 52830574, "body": "I was hoping the mgo tag at the bottom might help?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1441816732, "post_id": 32484676, "comment_id": 52830952, "body": "I didn&#39;t realize that tag as specifically for the Go mgo driver... I still think it would be smart to include in your question. It&#39;s pretty simple to preface your code snippet with relevant imports."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1441816789, "post_id": 32484676, "comment_id": 52830979, "body": "No worries - but any help with the actual question would be much appreciated"}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1441818142, "creation_date": 1441818142, "answer_id": 32485450, "question_id": 32484676, "link": "https://stackoverflow.com/questions/32484676/updating-certain-user-fields/32485450#32485450", "title": "Updating certain user fields", "body": "<p>I believe you should be able to accomplish this with just</p>\n\n<pre><code>err := collection(\"users\").Update(bson.M{\"id\" : user.Id},bson.M{\"$set\": &amp;user})\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 32485450, "answer_count": 1, "score": 0, "last_activity_date": 1441818142, "creation_date": 1441815597, "last_edit_date": 1441816330, "question_id": 32484676, "link": "https://stackoverflow.com/questions/32484676/updating-certain-user-fields", "title": "Updating certain user fields", "body": "<p>Requests to my API contain an ID (required) and optional others fields such as name, email and username.</p>\n\n<pre><code>{\n    \"id\" : \"12345\",\n    \"name\" : \"Bob\",\n    \"email\" : \"test@example.com\"\n}\n</code></pre>\n\n<p>After binding the request to a struct <code>user</code> if there isn't a user with the ID in my database I add them to it using:</p>\n\n<pre><code>user.App_id = appId\nuser.Created_at = (*tools.Timestamp)(&amp;now)\nuser.Updated_at = (*tools.Timestamp)(&amp;now)\n_ = C.Database.C(\"users\").Insert(&amp;user);\n</code></pre>\n\n<p>but if there is a user I only want to update the fields that the request object includes but I'm not sure how to write the query.</p>\n\n<p>My <code>user</code> struct uses pointers so that I can check for <code>nil</code> values</p>\n\n<pre><code>type user struct {\n    Id      *string    `bson:\"id\" json:\"id\"`\n    Name    *string    `bson:\"name\" json:\"name\"`\n    ...\n}\n</code></pre>\n\n<p>An update query that i've used elsewhere in my app looks like this:</p>\n\n<pre><code>err := collection(\"users\").Update(bson.M{\"id\" : \"user.Id\"},bson.M{\"$set\": bson.M{\"???\":\"???\"}})\n</code></pre>\n\n<p>but I'm not sure how to construct the latter part of the query under these circumstances.</p>\n\n<p><strong>Note: I'm not using MongoDB's _id</strong></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1441853681, "post_id": 32484258, "comment_id": 52844846, "body": "You can still use <code>r.FormValue(&quot;key&quot;)</code> after calling ParseForm as <code>r.FormValue</code> and <code>r.PostFormValue</code> implicitly call <code>r.ParseForm</code>  as per the docs: <a href=\"http://golang.org/pkg/net/http/#Request.PostFormValue\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Request.PostFormValue</a>"}], "tags": [], "owner": {"reputation": 15599, "user_id": 73831, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4813b578ef6e0ca5ba25a77f57fdb5f1?s=128&d=identicon&r=PG", "display_name": "Sudhir Jonathan", "link": "https://stackoverflow.com/users/73831/sudhir-jonathan"}, "is_accepted": true, "score": 8, "last_activity_date": 1441814266, "creation_date": 1441814266, "answer_id": 32484258, "question_id": 32484028, "link": "https://stackoverflow.com/questions/32484028/when-should-you-use-parseform-and-when-should-you-use-formvalue-and-postformvalu/32484258#32484258", "title": "When should you use ParseForm and when should you use FormValue and PostFormValue?", "body": "<p>As a rule of thumb, just use <code>r.PostFormValue(\"username\")</code> when you know the key you want to read. This method always works without any other preparation. Just remember that this won't read query parameters, though, even if the method was a POST. </p>\n\n<p>If you need to check what data was sent, though, you'll have to first parse the data using <code>r.ParseForm()</code> and then read the values using <code>r.Form[\"username\"][0]</code>. The same goes for cases where you expect multiple values on the same key. </p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3522, "favorite_count": 0, "accepted_answer_id": 32484258, "answer_count": 1, "score": 4, "last_activity_date": 1441814266, "creation_date": 1441813607, "question_id": 32484028, "link": "https://stackoverflow.com/questions/32484028/when-should-you-use-parseform-and-when-should-you-use-formvalue-and-postformvalu", "title": "When should you use ParseForm and when should you use FormValue and PostFormValue?", "body": "<p>I am simply trying to get to form data and I don't quite understand which method to use.</p>\n\n<p>In this article: <a href=\"http://astaxie.gitbooks.io/build-web-application-with-golang/content/en/04.1.html\" rel=\"nofollow noreferrer\">http://astaxie.gitbooks.io/build-web-application-with-golang/content/en/04.1.html</a></p>\n\n<p>They use <code>r.ParseForm()</code> and get post values by doing <code>r.Form[\"username\"]</code>.</p>\n\n<p>But when I tried this in my own code it did not work, I instead got a slice of strings, so I had to do <code>r.Form[\"username\"][0]</code> to get the string value.</p>\n\n<p>Why is that different from the one shown in the article? Why do I get a slice of strings?</p>\n\n<p>Also there is another method which can be used like this <code>r.FormValue(\"username\")</code>.</p>\n\n<p>And then there is a <code>r.PostFormValue(\"username\")</code>, another one!</p>\n\n<p>Which one should you use in different situations?</p>\n"}, {"tags": ["go", "string-formatting"], "comments": [{"owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 2, "creation_date": 1441814257, "post_id": 32483553, "comment_id": 52829350, "body": "whatever you do, if the user-supplied format string is really used to build a filename, please also make sure to check for directory traversal attacks."}, {"owner": {"reputation": 26843, "user_id": 208997, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/250e219125d8bff1f03e6faea950f218?s=128&d=identicon&r=PG", "display_name": "Simon", "link": "https://stackoverflow.com/users/208997/simon"}, "edited": false, "score": 0, "creation_date": 1441814851, "post_id": 32483553, "comment_id": 52829769, "body": "I would say #2 and it&#39;s probably not that much work with regexps."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1441820023, "post_id": 32483553, "comment_id": 52832652, "body": "(This would be overkill, but you can copy the code that actually parses <code>Printf</code> format strings: <a href=\"http://golang.org/src/fmt/print.go#L1082\" rel=\"nofollow noreferrer\">golang.org/src/fmt/print.go#L1082</a> )"}], "owner": {"reputation": 175, "user_id": 4219537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89bcc75841a5c4da353fc4edbe24b4b5?s=128&d=identicon&r=PG&f=1", "display_name": "mansfield", "link": "https://stackoverflow.com/users/4219537/mansfield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 302, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1441812249, "creation_date": 1441812249, "question_id": 32483553, "link": "https://stackoverflow.com/questions/32483553/how-to-check-for-dynamic-string-formatting-errors-in-go", "title": "How to check for dynamic string formatting errors in Go?", "body": "<p>I have a Go program which accepts and uses format strings supplied by the user at runtime. The specification for these would be something like \"a format string which accepts three ints\", etc.</p>\n\n<p>If the user gives me a string which doesn't meet my specification, I would like to return/output an error. I don't believe there is a simple way to do this with the <code>fmt</code> library: is this correct? How should I do this?</p>\n\n<p>I can think of three potential approaches, but I have problems with all of them:</p>\n\n<ol>\n<li><p>Call <code>fmt.Sprintf(inputFmt, args...)</code> and search it for the <code>\"!%\"</code> substrings that are produced when the formatter encounters a problem. This doesn't work if the user actually wants a string with <code>\"!%\"</code> somewhere in it. I think the likelihood of this is small for my application, but I'd really prefer not to make this restriction if I didn't have to.</p></li>\n<li><p>Write code that inspects the input string prior to formatting to see if it complies with my specification. For the example above, I'd check if there were exactly three valid integer verbs (complete with checking all the flags that those verbs could take). Looking at <code>doPrintf()</code> in <code>fmt/print.go</code>, this seems like a lot of work.</p></li>\n<li><p>Don't explicitly check that formatting succeeded, but report an error later when the misformatted string is unsuccessfully used. (E.g. <code>the file %!s(int=1).dat%!(EXTRA int=2, int=3) does not exist or is misformatted</code>). I think this type of error message might be confusing to non Go programmers who use my program and will also not work in all cases where a format string is needed.</p></li>\n</ol>\n"}, {"tags": ["go", "udp"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 5317638, "user_type": "registered", "profile_image": "https://graph.facebook.com/1039775202700299/picture?type=large", "display_name": "wildcard", "link": "https://stackoverflow.com/users/5317638/wildcard"}, "edited": false, "score": 0, "creation_date": 1441813309, "post_id": 32483391, "comment_id": 52828633, "body": "Okey, i changed the code to: <a href=\"http://play.golang.org/p/FkxyS7asTA\" rel=\"nofollow noreferrer\">play.golang.org/p/FkxyS7asTA</a> , but the result stays the same: i can only receive if the source port of the response matches the destination port of the request. I don&#39;t see the point why the source port of the response has importance!?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1441814813, "last_edit_date": 1441814813, "creation_date": 1441811745, "answer_id": 32483391, "question_id": 32483075, "link": "https://stackoverflow.com/questions/32483075/golang-readfromudp-behavior-when-source-port-differs-in-reponse-from-dial/32483391#32483391", "title": "Golang: ReadFromUDP behavior when source port differs in reponse from dial", "body": "<p>When you use <code>DialUDP</code>, you're creating a \"connected\" UDP socket, which only listens for datagrams from the given remote address. The underlying syscall is the same as <code>connect</code>, which states in the man page:</p>\n\n<blockquote>\n  <p>If the socket sockfd is of type SOCK_DGRAM then addr is the address to which datagrams are sent by default, and the only address from which datagrams are received.</p>\n</blockquote>\n\n<p>If you want to listen for <em>any</em> datagrams received on a particular UDP port, create the connection with <a href=\"http://golang.org/pkg/net/#ListenUDP\" rel=\"nofollow\"><code>ListenUDP</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5317638, "user_type": "registered", "profile_image": "https://graph.facebook.com/1039775202700299/picture?type=large", "display_name": "wildcard", "link": "https://stackoverflow.com/users/5317638/wildcard"}, "is_accepted": false, "score": -1, "last_activity_date": 1441814732, "creation_date": 1441814732, "answer_id": 32484399, "question_id": 32483075, "link": "https://stackoverflow.com/questions/32483075/golang-readfromudp-behavior-when-source-port-differs-in-reponse-from-dial/32484399#32484399", "title": "Golang: ReadFromUDP behavior when source port differs in reponse from dial", "body": "<p>okey, i figured it out. first i have to apologize for not saying that i use windows(10)! This behaivor comes from the windows firewall. When it is turned off i can receive packets with different SOURCE ports in the reply.</p>\n"}], "owner": {"reputation": 1, "user_id": 5317638, "user_type": "registered", "profile_image": "https://graph.facebook.com/1039775202700299/picture?type=large", "display_name": "wildcard", "link": "https://stackoverflow.com/users/5317638/wildcard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 804, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1441814813, "creation_date": 1441810866, "question_id": 32483075, "link": "https://stackoverflow.com/questions/32483075/golang-readfromudp-behavior-when-source-port-differs-in-reponse-from-dial", "title": "Golang: ReadFromUDP behavior when source port differs in reponse from dial", "body": "<p>i have written the following simple udp server/client in golang. The app sends the current time to a specified ipv6 link-local addrress. The receiver sends back a little reply. This works ONLY if the sender port of the reply is the same as the destination port of the request. </p>\n\n<p>Wireshark Comparison: <a href=\"https://www.dropbox.com/s/ypaepz62sa4xtnh/go_simple_udp3.png?dl=0\" rel=\"nofollow\">https://www.dropbox.com/s/ypaepz62sa4xtnh/go_simple_udp3.png?dl=0</a></p>\n\n<p><strong>Why is this the case?</strong></p>\n\n<pre><code>package main\n\nimport (\n\"net\"\n\"log\"\n\"fmt\"\n\"time\"\n)\n\nfunc main() {\n\n//Remote Addr\nBoxAddr, err := net.ResolveUDPAddr(\"udp6\", \"[fe80:0000:0000:0000:0211:7d00:0030:8e3f]:5684\")\nif(err != nil) {\n    log.Fatal(err)\n    return\n}\n\n/*\nLocalAddr, err := net.ResolveUDPAddr(\"udp6\", \"[fe80::299f:4146:2e32:72fd%4]:50361\")\nif(err != nil) {\n    log.Fatal(err)\n    return\n}\n*/\nc, err := net.DialUDP(\"udp6\", nil, BoxAddr)\nif(err != nil) {\n    log.Fatal(err)\n    return\n}\n\ndefer c.Close()\n\nfmt.Print(c.LocalAddr())\n\n//read loop\ngo func(c *net.UDPConn) {\n\n    for {\n        rxMsg := make([]byte, 100);\n        n,_, err := c.ReadFromUDP(rxMsg)\n        if(err != nil) {\n            log.Fatal(err)\n            return\n        } else {\n            fmt.Print(\"Got from remote: \",n, \" bytes\\r\\n\")\n        }\n    }\n}(c)\n\n//write every second current time\nfor {\n    b := []byte(time.Now().String())\n    n, err := c.Write(b)\n\n    if(err != nil) {\n        log.Fatal(err)\n        return\n    } else {\n        fmt.Print(\"Wrote to destination socket: \",n, \" bytes\\r\\n\")\n    }\n\n    time.Sleep(1000 * time.Millisecond)\n}\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 1, "creation_date": 1450145327, "post_id": 32482941, "comment_id": 56301682, "body": "u might need <code>if err != nil || file == nil {             return nil &#47;&#47; Ignore errors         }</code> as well?"}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 36, "last_activity_date": 1541769490, "last_edit_date": 1541769490, "creation_date": 1441810544, "answer_id": 32482941, "question_id": 32482673, "link": "https://stackoverflow.com/questions/32482673/how-to-get-directory-total-size/32482941#32482941", "title": "How to get directory total size?", "body": "<p>Using a global like that at best is bad practice.\nIt's also a race if <code>DirSizeMB</code> is called concurrently.</p>\n\n<p>The simple solution is to use a closure, e.g.:</p>\n\n<pre><code>func DirSize(path string) (int64, error) {\n    var size int64\n    err := filepath.Walk(path, func(_ string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n        if !info.IsDir() {\n            size += info.Size()\n        }\n        return err\n    })\n    return size, err\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ftjXyse7AXO\" rel=\"noreferrer\"><kbd>Playground</kbd></a></p>\n\n<p>You could assign the closure to a variable if you think that looks better.</p>\n"}, {"tags": [], "owner": {"reputation": 505, "user_id": 644592, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/20e5dfdc04c8ef51cf4e48505c8646bc?s=128&d=identicon&r=PG", "display_name": "ventayol", "link": "https://stackoverflow.com/users/644592/ventayol"}, "is_accepted": false, "score": 0, "last_activity_date": 1441810774, "creation_date": 1441810774, "answer_id": 32483042, "question_id": 32482673, "link": "https://stackoverflow.com/questions/32482673/how-to-get-directory-total-size/32483042#32483042", "title": "How to get directory total size?", "body": "<p>If you want to use a variable, you can do this:</p>\n\n<pre><code>func DirSizeMB(path string) float64 {\n    var dirSize int64 = 0\n\n    readSize := func(path string, file os.FileInfo, err error) error {\n        if !file.IsDir() {\n            dirSize += file.Size()\n        }\n\n        return nil\n    }\n\n    filepath.Walk(path, readSize)    \n\n    sizeMB := float64(dirSize) / 1024.0 / 1024.0\n\n    return sizeMB\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1441812353, "post_id": 32483204, "comment_id": 52827987, "body": "A variation on this would be if you wanted to do something expensive or time consuming with each but using N parallel workers. You&#39;d start N goroutines reading from a channel and the function passed to walk would just feed the file info into one of the works via the single channel."}], "tags": [], "owner": {"reputation": 1889, "user_id": 1036501, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/z8PwP.png?s=128&g=1", "display_name": "zstewart", "link": "https://stackoverflow.com/users/1036501/zstewart"}, "is_accepted": false, "score": -2, "last_activity_date": 1441811198, "creation_date": 1441811198, "answer_id": 32483204, "question_id": 32482673, "link": "https://stackoverflow.com/questions/32482673/how-to-get-directory-total-size/32483204#32483204", "title": "How to get directory total size?", "body": "<p>One thing you could do would be to define a channel inside of <code>DirSizeMB</code>, and define <code>readSize</code> inside of that function so it gets the channel as a closure. Then send all of the sizes out the channel and sum them as you receive them.</p>\n\n<pre><code>func DirSizeMB(path string) float64 {\n    sizes := make(chan int64)\n    readSize := func(path string, file os.FileInfo, err error) error {\n        if err != nil || file == nil {\n            return nil // Ignore errors\n        }\n        if !file.IsDir() {\n            sizes &lt;- file.Size()\n        }\n        return nil\n    }\n\n    go func() {\n        filepath.Walk(path, readSize)\n        close(sizes)\n    }()\n\n    size := int64(0)\n    for s := range sizes {\n        size += s\n    }\n\n    sizeMB := float64(size) / 1024.0 / 1024.0\n\n    sizeMB = Round(sizeMB, 0.5, 2)\n\n    return sizeMB\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/zzKZu0cm9n\" rel=\"nofollow\">http://play.golang.org/p/zzKZu0cm9n</a></p>\n\n<h2>Why use a channel?</h2>\n\n<p>Unless you've read the underlying code, you don't actually know how <code>filepath.Walk</code> invokes your readSize function. While it probably calls it sequentially over all of the files on the given path, the implementation could theoretically invoke several of these calls simultaneously on separate goroutines (the docs would probably mention this if it did). In any case, in a language designed for concurrency, it's good practice to make sure that your code is safe.</p>\n\n<p>The answer that @DaveC gives shows how to do this by using a closure over a local variable solves the problem of having a global variable, so multiple simultaneous calls to DirSize would be safe. The Docs for Walk explicitly state that the walk function runs over files in a deterministic order, so his solution is sufficient for this problem, but I'll leave this as an example of how to make it safe to run the inner function concurrently.</p>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9143, "favorite_count": 5, "accepted_answer_id": 32482941, "answer_count": 3, "score": 15, "last_activity_date": 1580827111, "creation_date": 1441809818, "last_edit_date": 1580827111, "question_id": 32482673, "link": "https://stackoverflow.com/questions/32482673/how-to-get-directory-total-size", "title": "How to get directory total size?", "body": "<p>So I am trying to get total size of a directory using Go. So far I have this:</p>\n\n<pre><code>var dirSize int64 = 0\n\nfunc readSize(path string, file os.FileInfo, err error) error {\n    if !file.IsDir() {\n        dirSize += file.Size()\n    }\n    return nil\n} \n\nfunc DirSizeMB(path string) float64 {\n    dirSize = 0\n    filepath.Walk(path, readSize)\n    sizeMB := float64(dirSize) / 1024.0 / 1024.0\n    sizeMB = Round(sizeMB, .5, 2)\n    return sizeMB\n}\n</code></pre>\n\n<p>The question is whether the <code>dirSize</code> global variable is going to cause problems and if it does, how do I move it to the scope of the <code>DirSizeMB</code> function?</p>\n"}, {"tags": ["ubuntu", "go", "goclipse"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441808336, "post_id": 32482031, "comment_id": 52824862, "body": "Update to a recent version of go (currently 1.5.1) following the <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">official installation instructions</a> , and don&#39;t set GOROOT."}, {"owner": {"reputation": 163, "user_id": 3852950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/badf1c0e3b1df00555e58de82e0c5120?s=128&d=identicon&r=PG&f=1", "display_name": "mloudon", "link": "https://stackoverflow.com/users/3852950/mloudon"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441810516, "post_id": 32482031, "comment_id": 52826664, "body": "this method seems a lot less confusing to goclipse, thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 163, "user_id": 3852950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/badf1c0e3b1df00555e58de82e0c5120?s=128&d=identicon&r=PG&f=1", "display_name": "mloudon", "link": "https://stackoverflow.com/users/3852950/mloudon"}, "is_accepted": false, "score": 0, "last_activity_date": 1441896835, "creation_date": 1441896835, "answer_id": 32505244, "question_id": 32482031, "link": "https://stackoverflow.com/questions/32482031/goclipse-go-binary-location-on-ubuntu/32505244#32505244", "title": "goclipse go binary location on ubuntu", "body": "<p>per comment from @JimB, worked when using go install files from the official site, not the package manager version which is out of date and puts things in places goclipse doesn't expext</p>\n"}], "owner": {"reputation": 163, "user_id": 3852950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/badf1c0e3b1df00555e58de82e0c5120?s=128&d=identicon&r=PG&f=1", "display_name": "mloudon", "link": "https://stackoverflow.com/users/3852950/mloudon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 347, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1441896835, "creation_date": 1441808200, "question_id": 32482031, "link": "https://stackoverflow.com/questions/32482031/goclipse-go-binary-location-on-ubuntu", "title": "goclipse go binary location on ubuntu", "body": "<p>I'm using Go 1.2.1 on Ubuntu 14.04, installed through the package manager. Output of go env</p>\n\n<pre><code>GOARCH=\"386\"\nGOBIN=\"\"\nGOCHAR=\"8\"\nGOEXE=\"\"\nGOHOSTARCH=\"386\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/mel/go\"\nGORACE=\"\"\nGOROOT=\"/usr/lib/go\"\nGOTOOLDIR=\"/usr/lib/go/pkg/tool/linux_386\"\nTERM=\"dumb\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-g -O2 -fPIC -m32 -pthread\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>I can compile and run the hello world example from the command line, but GoClipse, with GOROOT set to /usr/lib/go gives me the following error:</p>\n\n<pre><code>GOROOT: `/usr/lib/go/bin/go` executable not found.\n</code></pre>\n\n<p>The go binary is in /usr/bin/go, not $GOPATH/bin/go. How can I tell GoClipse this?</p>\n\n<p>thank you!</p>\n"}, {"tags": ["macos", "cocoa", "go", "filesystems"], "comments": [{"owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1441938980, "post_id": 32480539, "comment_id": 52887822, "body": "I haven&#39;t tested this so this is a comment, but you could probably do this with cgo and Core Foundation: <a href=\"https://developer.apple.com/library/mac/documentation/CoreFoundation/Reference/CFURLEnumeratorRef/index.html#//apple_ref/c/func/CFURLEnumeratorCreateForMountedVolumes\" rel=\"nofollow noreferrer\">developer.apple.com/library/mac/documentation/CoreFoundation&zwnj;&#8203;/&hellip;</a> <a href=\"https://developer.apple.com/library/mac/documentation/CoreFoundation/Reference/CFURLRef/index.html#//apple_ref/c/func/CFURLCopyResourcePropertyForKey\" rel=\"nofollow noreferrer\">developer.apple.com/library/mac/documentation/CoreFoundation&zwnj;&#8203;/&hellip;</a> <a href=\"https://developer.apple.com/library/mac/documentation/CoreFoundation/Reference/CFURLRef/index.html#//apple_ref/doc/constant_group/Volume_Property_Keys\" rel=\"nofollow noreferrer\">developer.apple.com/library/mac/documentation/CoreFoundation&zwnj;&#8203;/&hellip;</a>"}, {"owner": {"reputation": 3861, "user_id": 1505451, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Kk60E.jpg?s=128&g=1", "display_name": "jacobsa", "link": "https://stackoverflow.com/users/1505451/jacobsa"}, "reply_to_user": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1441968113, "post_id": 32480539, "comment_id": 52900548, "body": "Thanks, I&#39;ll try writing a small C program to extract <code>kCFURLVolumeNameKey</code>, run it through <code>dtruss</code>, and see what syscalls it&#39;s making."}, {"owner": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1441998289, "post_id": 32480539, "comment_id": 52919008, "body": "Why not use cgo and just use the CF APIs directly? :S"}, {"owner": {"reputation": 3861, "user_id": 1505451, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Kk60E.jpg?s=128&g=1", "display_name": "jacobsa", "link": "https://stackoverflow.com/users/1505451/jacobsa"}, "reply_to_user": {"reputation": 10424, "user_id": 3408572, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0f3a08b145553b98749d3d0572d01265?s=128&d=identicon&r=PG&f=1", "display_name": "andlabs", "link": "https://stackoverflow.com/users/3408572/andlabs"}, "edited": false, "score": 0, "creation_date": 1442316232, "post_id": 32480539, "comment_id": 53023120, "body": "cgo causes slower build times, issues with dynamic linking, etc. Better to not use it if possible, but of course it&#39;s an option."}], "owner": {"reputation": 3861, "user_id": 1505451, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/Kk60E.jpg?s=128&g=1", "display_name": "jacobsa", "link": "https://stackoverflow.com/users/1505451/jacobsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 535, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1441895029, "creation_date": 1441804346, "last_edit_date": 1441895029, "question_id": 32480539, "link": "https://stackoverflow.com/questions/32480539/how-do-i-programmatically-find-the-os-x-volume-name-for-a-mount-point", "title": "How do I programmatically find the OS X volume name for a mount point?", "body": "<p>I'm writing a fuse file system, and using the <a href=\"https://github.com/osxfuse/osxfuse/wiki/Mount-options#volname\" rel=\"nofollow\"><code>volname</code> mount option</a> supported by osxfuse to set the volume name. This works\u2014I can see the correct name in the Finder when I view the folder containing the mount point.</p>\n\n<p>However, I would like to write a test for the functionality to make sure I don't screw it up at some point in the future. How can I get the volume name for the mount programmatically in my test? I tried <code>statfs(2)</code>, but <code>statfs::f_mntfromname</code> contains the distinct \"file system name\", as displayed in the output of <code>mount</code>.</p>\n\n<p>I'm writing this in Go, so am looking for a specific syscall that I can call, not e.g. a Cocoa library function. But if you know how to do it in Cocoa that would still be a useful lead.</p>\n"}, {"tags": ["go", "sqlite"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1441802557, "post_id": 32479071, "comment_id": 52820495, "body": "You will have to provide more informations, especially code which demonstrates your problem."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1441802780, "post_id": 32479071, "comment_id": 52820661, "body": "Are you sure <a href=\"http://stackoverflow.com/questions/151026/how-do-i-unlock-a-sqlite-database\">something else is not locking your DB</a>?"}, {"owner": {"reputation": 101, "user_id": 4903521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38337cdd6185a5479abe1bcf076dfce7?s=128&d=identicon&r=PG&f=1", "display_name": "superuser123", "link": "https://stackoverflow.com/users/4903521/superuser123"}, "edited": false, "score": 0, "creation_date": 1441805048, "post_id": 32479071, "comment_id": 52822391, "body": "No database file handle before my program runs, but 2 handles after my program runs. So I think just my program itself lock the database file."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1441808229, "post_id": 32479071, "comment_id": 52824777, "body": "You begin a transaction in <code>getDatabaseHandle</code> but I can&#39;t see <code>tx.Commit</code> or <code>tx.Rollback</code> anywhere. Could this be the issue?"}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 4903521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38337cdd6185a5479abe1bcf076dfce7?s=128&d=identicon&r=PG&f=1", "display_name": "superuser123", "link": "https://stackoverflow.com/users/4903521/superuser123"}, "edited": false, "score": 0, "creation_date": 1441853358, "post_id": 32483180, "comment_id": 52844760, "body": "You hit the point. I solved my problem by closing all &quot;rows&quot; in my code. Although your answer is not the exact solution to my problem, but I will check your answer. Thank you for answering."}, {"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 3, "creation_date": 1497384840, "post_id": 32483180, "comment_id": 76053098, "body": "Excellent! Thank you so much! I wasn&#39;t even aware that you ought to close down rows besides the database handler; I thought that this would be &#39;automatic&#39;, but clearly it isn&#39;t. Also, the same issue happens with <i>statements</i>; I&#39;m using <a href=\"https://godoc.org/github.com/mattn/go-sqlite3\" rel=\"nofollow noreferrer\">godoc.org/github.com/mattn/go-sqlite3</a> and there is a func to close statements as well, after they&#39;re used. Once I did that, the dreadful &#39;database is locked&#39; error disappeared, after giving me a headache for days!"}], "tags": [], "owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "is_accepted": true, "score": 18, "last_activity_date": 1441811138, "creation_date": 1441811138, "answer_id": 32483180, "question_id": 32479071, "link": "https://stackoverflow.com/questions/32479071/sqlite3-error-database-is-locked-in-golang/32483180#32483180", "title": "Sqlite3 error: database is locked in golang", "body": "<p>Try defering the <code>rows.Close()</code>:</p>\n\n<pre><code>if err != nil {\n    return err\n}\ndefer rows.Close()\nif rows.Next() {\n    ...\n}\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 4903521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38337cdd6185a5479abe1bcf076dfce7?s=128&d=identicon&r=PG&f=1", "display_name": "superuser123", "link": "https://stackoverflow.com/users/4903521/superuser123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10847, "favorite_count": 2, "accepted_answer_id": 32483180, "answer_count": 1, "score": 9, "last_activity_date": 1604040920, "creation_date": 1441800150, "last_edit_date": 1604040920, "question_id": 32479071, "link": "https://stackoverflow.com/questions/32479071/sqlite3-error-database-is-locked-in-golang", "title": "Sqlite3 error: database is locked in golang", "body": "<p>I'm using sqlite3 database in golang and I got the error: &quot;database is locked.&quot;</p>\n<p>I know there can't be multiple threads using same database file.</p>\n<p>Although I get only one connection in my program I close all query results, but it always creates 2 or 3 handles of the database file.</p>\n<p>I could check this out by using the Opendfileview program.</p>\n<p>Can anybody help me with this problem, thanks in advance.</p>\n<p>The following code creates two database file handles.</p>\n<pre><code>func main() {\n    database, tx, err := getDatabaseHandle()\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer database.Close()\n    dosomething(database, tx)\n}\nfunc dosomething(database *sql.DB, tx *sql.Tx) error {\n    rows, err := database.Query(&quot;select * from sometable where name=?&quot;,&quot;some&quot;)\n    if err != nil {\n        return err\n    }\n    if rows.Next() {\n        ...\n    }\n    rows.Close()\n    //some insert queries\n    tx.Commit()\n}\nfunc getDatabaseHandle() (*sql.DB, *sql.Tx, error) {\n    database, err := sql.Open(&quot;sqlite3&quot;, dbPath)\n    if err != nil {\n        fmt.Println(&quot;Failed to create the handle&quot;)\n        return nil, nil, err\n    }\n    if err2 := database.Ping(); err2 != nil {\n        fmt.Println(&quot;Failed to keep connection alive&quot;)\n        return nil, nil, err\n    }\n    tx, err := database.Begin()\n    if err != nil {\n        return nil, nil, err\n    }\n    return database, tx, nil\n}\n</code></pre>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1441796857, "post_id": 32477797, "comment_id": 52816439, "body": "Nope. In other question they doing &quot;foreach&quot; from json."}, {"owner": {"reputation": 1447, "user_id": 3570747, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/RKIuH.png?s=128&g=1", "display_name": "vastlysuperiorman", "link": "https://stackoverflow.com/users/3570747/vastlysuperiorman"}, "edited": false, "score": 1, "creation_date": 1441808225, "post_id": 32477797, "comment_id": 52824771, "body": "The other questions are somewhat different, yes, but the same rules apply in your case. Use <code>[]interface{}</code> to unmarshal results generally and make assertions later. If you know for sure that the data structure is consistent, you can write your own unmarshaller by implementing func (*RawMessage) UnmarshalJSON: <a href=\"http://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#RawMessage</a>. Then you can decode the raw message into different structs as needed. Just be aware that doing this can get very messy if the incoming json isn&#39;t consistent (e.g. always a number followed by an object)."}], "owner": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "closed_date": 1441799586, "answer_count": 0, "score": 0, "last_activity_date": 1441798868, "creation_date": 1441796542, "last_edit_date": 1441798868, "question_id": 32477797, "link": "https://stackoverflow.com/questions/32477797/parse-json-with-null-fields", "closed_reason": "Duplicate", "title": "Parse json with null fields", "body": "<p>How parse data from json without field? Omitempty not working.</p>\n\n<p>Need to get int 1234 and other data (id, owner)</p>\n\n<pre><code>{\"response\":[1234,{\"id\":1,\"owner\":3},{\"id\":3,\"owner\":5}]}\n</code></pre>\n\n<p>Code</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype SectionDB_Exam_Add struct {\n    id          int         `json:\"id\"`\n    Owner           int         `json:\"owner\"`\n}\n\ntype CreateExamType struct {\n    Response []SectionDB_Exam_Add\n}\n\nvar tests = `{\"response\":[{\"id\":1,\"owner\":3},{\"id\":3,\"owner\":5}]}`\nvar how_parse_this = `{\"response\":[1234,{\"id\":1,\"owner\":3},{\"id\":3,\"owner\":5}]}`\n\nfunc main() {\n\n    var var_CreateExamType = &amp;CreateExamType{}\n\n    var b_Data = []byte(tests)\n    //var b_Data = []byte(how_parse_this)       // How parse 1234 and other data?\n\n    json.Unmarshal(b_Data, var_CreateExamType)\n\n    for _, mt := range var_CreateExamType.Response {\n              fmt.Println(mt.Owner)\n        }\n\n}\n</code></pre>\n\n<p>Playground:\n<a href=\"http://play.golang.org/p/NwGrrbTh-e\" rel=\"nofollow\">http://play.golang.org/p/NwGrrbTh-e</a></p>\n"}, {"tags": ["session", "go", "martini"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1441795054, "post_id": 32476956, "comment_id": 52815240, "body": "Can you post more of your code: the full handler for both the set &amp; get operations, and the setup code for the cookie store, including any options (Secure, HttpOnly) you&#39;re setting."}, {"owner": {"reputation": 521, "user_id": 5142896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a6bbe0b8d0b678f1fb3b95493d42e8?s=128&d=identicon&r=PG&f=1", "display_name": "Conor", "link": "https://stackoverflow.com/users/5142896/conor"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441806207, "post_id": 32476956, "comment_id": 52823274, "body": "@elithrar this is quite difficult because my functions are large. I have noticed that when going through path /modules in the URL, there is a second cookie/session produced. I can see it on the dev tools on google chrome. I&#39;m guessing these separate sessions are the reason my variables aren&#39;t shared. Do you know why it would produce a second session? Is this heard of before? I don&#39;t do anything differently for this /modules route with respect to handlers/sessions, its the same as the others, but for some random reason it creates a new session."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1441806308, "post_id": 32476956, "comment_id": 52823344, "body": "Are you setting the path of the cookie? If not, it will default to the current path - e.g. <code>&#47;modules</code>. If the other route is at the same level or above the cookie won&#39;t apply. You&#39;ll need to set <code>session.Options.Path</code> to a path that covers both - the easy choice is to set it to <code>&#47;</code>."}, {"owner": {"reputation": 521, "user_id": 5142896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a6bbe0b8d0b678f1fb3b95493d42e8?s=128&d=identicon&r=PG&f=1", "display_name": "Conor", "link": "https://stackoverflow.com/users/5142896/conor"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441808935, "post_id": 32476956, "comment_id": 52825346, "body": "@elithrar You are a life saver, marry me"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441853587, "post_id": 32476956, "comment_id": 52844827, "body": "Sadly (for both of us) I&#39;m taken! I&#39;ve added this as answer now that I&#39;m at a desktop machine for posterity/other Gophers."}], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 1, "last_activity_date": 1441853483, "creation_date": 1441853483, "answer_id": 32492317, "question_id": 32476956, "link": "https://stackoverflow.com/questions/32476956/golang-martini-session-set-not-setting-any-value/32492317#32492317", "title": "golang martini session.Set not setting any value", "body": "<p>Just to extend on my comment/help others in the future:</p>\n\n<ul>\n<li>When you set a cookie without an explicit <code>Path</code> value, the cookie takes on the current path.</li>\n<li><p>Cookies are only sent for that path and paths below - not above - e.g.</p>\n\n<ol>\n<li>Cookie set for <code>/modules</code> when you implicitly set it for the first time via <code>session.Set(val, key)</code></li>\n<li>Cookie <em>is</em> sent for <code>/modules</code>, <code>/modules/all</code> and <code>/modules/detail/12</code></li>\n<li>Cookie is <em>NOT</em> sent for <code>/about</code> or <code>/</code> </li>\n</ol></li>\n</ul>\n\n<p>This can be fixed by explicitly setting the path:</p>\n\n<pre><code>var store = sessions.NewCookieStore([]byte(\"secret123\"))\n\nfunc main() {\n    store.Options.Path = \"/\"\n    ...\n}\n</code></pre>\n\n<p>Be aware that you may not want to send a cookie for all routes (which is what <code>/</code> will do) - so use judgement.</p>\n"}], "owner": {"reputation": 521, "user_id": 5142896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a6bbe0b8d0b678f1fb3b95493d42e8?s=128&d=identicon&r=PG&f=1", "display_name": "Conor", "link": "https://stackoverflow.com/users/5142896/conor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "accepted_answer_id": 32492317, "answer_count": 1, "score": 0, "last_activity_date": 1441968295, "creation_date": 1441794034, "question_id": 32476956, "link": "https://stackoverflow.com/questions/32476956/golang-martini-session-set-not-setting-any-value", "title": "golang martini session.Set not setting any value", "body": "<p>There isn't much context with this because it really is a situation where something should work, but it just doesn't.</p>\n\n<p>I am using the martini framework. In one handler I'm using this: </p>\n\n<pre><code>session.Set(\"deployed\", \"true\")\nr.Redirect(\"/myOtherURL\", http.StatusSeeOther)\n</code></pre>\n\n<p>Whereby 'session' is the sessions.Session object passed through to the handler.\nIn the handler that loads myOtherURL, I'm using session.Get but nothing is being returned. I printed out all of the session content and the 'deployed' is not present. </p>\n\n<p>What could be causing this problem? What could I possibly be missing out? I would give more context if I could but it really is as simple as this. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 0, "creation_date": 1441796622, "post_id": 32476756, "comment_id": 52816262, "body": "Maybe it&#39;s a good example why &quot;sub-package&quot; is a bad idea in #golang."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 0, "creation_date": 1441806994, "post_id": 32476756, "comment_id": 52823845, "body": "@mission.liao: what is a &quot;sub-package&quot; and why is it a bad idea in Go? You mean git submodules? (which can be confusing at times, but have nothing to do with Go). Go imports are just directories, it really couldn&#39;t be simpler."}, {"owner": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "edited": false, "score": 0, "creation_date": 1441820633, "post_id": 32476756, "comment_id": 52832936, "body": "take &quot;machinery&quot; as example, there are &quot;broker&quot;, &quot;backend&quot;, &quot;config&quot;, &quot;signatures&quot; ... sub package under parent package &quot;machinery&quot;. All of them are imported by absolute path. And once someone else want to contribute such project, he/she would face the problem I met."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 5, "last_activity_date": 1441793473, "creation_date": 1441793473, "answer_id": 32476756, "question_id": 32475656, "link": "https://stackoverflow.com/questions/32475656/contribute-to-a-project-with-multiple-packages/32476756#32476756", "title": "contribute to a project with multiple packages", "body": "<p>Just add another remote to the original git repository. Something like:</p>\n\n<pre><code>cd $GOPATH/src/github.com/RichardKnop/machinery\ngit remote add myfork git@github.com:missionliao/machinery.git\ngit checkout -b master myfork/master\n</code></pre>\n\n<p>Go is just looking for source code in folders so the folder and its actual git location don't have to match.</p>\n"}], "owner": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 32476756, "answer_count": 1, "score": 0, "last_activity_date": 1441793473, "creation_date": 1441790288, "question_id": 32475656, "link": "https://stackoverflow.com/questions/32475656/contribute-to-a-project-with-multiple-packages", "title": "contribute to a project with multiple packages", "body": "<p>I'm trying to add a fake broker/backend for testing purpose to <a href=\"https://github.com/RichardKnop/machinery\" rel=\"nofollow\">machinery</a>, which is a task queue library in #golang.</p>\n\n<p>All import paths are absolute in that project, </p>\n\n<pre><code>import \"github.com/RichardKnop/machinery/v1/...\"\n</code></pre>\n\n<p>However, to include my changes, I have to</p>\n\n<ul>\n<li>manually modify those import paths to my fork\n\n<ul>\n<li><em>(replace \"RichardKnop\" with my username),</em></li>\n</ul></li>\n<li>test my changes, and</li>\n<li>revert those import paths to owner's fork before making a pull<br>\nrequest.</li>\n</ul>\n\n<p>Is there any suggestion on how to contribute others' forks without manually modifying import paths?</p>\n"}, {"tags": ["go", "signals"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441788648, "post_id": 32473923, "comment_id": 52810852, "body": "I downloaded your code and it worked here.<code>go run src&#47;tcpclient.go localhost:1234 10s wait ctrl-c  ^Cclose on ctrl-c Error remote reading:  read tcp 127.0.0.1:47766-&gt;127.0.0.1:1234: use of closed network connection</code>"}, {"owner": {"reputation": 199, "user_id": 1166461, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/cd31a5d3f1923a938d1287f57e78a5c9?s=128&d=identicon&r=PG", "display_name": "Programus", "link": "https://stackoverflow.com/users/1166461/programus"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441791610, "post_id": 32473923, "comment_id": 52812906, "body": "Are you also running it under Windows 7 command line?"}], "answers": [{"comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441866290, "post_id": 32493634, "comment_id": 52848945, "body": "this <code>simple program</code> not print <code>sig</code> sometimes, because the <code>go func()</code> may not invoked before <code>func main()</code> finish and program exit. the program in you question not same at this point."}, {"owner": {"reputation": 199, "user_id": 1166461, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/cd31a5d3f1923a938d1287f57e78a5c9?s=128&d=identicon&r=PG", "display_name": "Programus", "link": "https://stackoverflow.com/users/1166461/programus"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441876790, "post_id": 32493634, "comment_id": 52855386, "body": "You are right. The previous simple program also has the same problem because the time duration it slept was too short sometime. I worked out a channel sync solution and it works perfect here and I updated the answer."}], "tags": [], "owner": {"reputation": 199, "user_id": 1166461, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/cd31a5d3f1923a938d1287f57e78a5c9?s=128&d=identicon&r=PG", "display_name": "Programus", "link": "https://stackoverflow.com/users/1166461/programus"}, "is_accepted": true, "score": 0, "last_activity_date": 1441875591, "last_edit_date": 1441875591, "creation_date": 1441862007, "answer_id": 32493634, "question_id": 32473923, "link": "https://stackoverflow.com/questions/32473923/why-signal-handler-not-work-when-i-added-another-blocking-thread-in-go/32493634#32493634", "title": "Why signal handler not work when I added another blocking thread in go?", "body": "<p>I did some more investigation and I found that the key point of the problem is not the threads but whether there is enough time for signal handler running. </p>\n\n<p>I made a simple program to re-produce the problem under Windows 7 as well as the solution. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"os/signal\"\n)\n\nfunc main() {\n    c := make(chan os.Signal, 1)\n    //q := make(chan bool, 1)\n    signal.Notify(c, os.Interrupt, os.Kill)\n\n    go func() {\n        sig := &lt;- c\n        fmt.Println(sig)\n        //close(q)\n    }()\n\n    count, err := io.Copy(os.Stdout, os.Stdin)\n    fmt.Println(count, err)\n    //select {\n    //case &lt;- q:\n    //}\n}\n</code></pre>\n\n<p>You will find the signal might not be printed out sometime. But after I uncommented the <code>q</code> channel related code. It always works. </p>\n\n<p>So I think it would because the program quit too quickly to let the signal handler run. </p>\n\n<p>Hope this Q&amp;A could help others who has the same problem. </p>\n\n<p>Also, I worked out a solution for the simple tcp server/client and updated the gist. </p>\n\n<p><a href=\"https://gist.github.com/programus/52591a97def30df9dc81\" rel=\"nofollow\">https://gist.github.com/programus/52591a97def30df9dc81</a></p>\n"}], "owner": {"reputation": 199, "user_id": 1166461, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/cd31a5d3f1923a938d1287f57e78a5c9?s=128&d=identicon&r=PG", "display_name": "Programus", "link": "https://stackoverflow.com/users/1166461/programus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "accepted_answer_id": 32493634, "answer_count": 1, "score": 0, "last_activity_date": 1441875591, "creation_date": 1441785200, "last_edit_date": 1441785677, "question_id": 32473923, "link": "https://stackoverflow.com/questions/32473923/why-signal-handler-not-work-when-i-added-another-blocking-thread-in-go", "title": "Why signal handler not work when I added another blocking thread in go?", "body": "<p>I am trying to build a very simple tcp server/client. And I want the program could close the connection when it is interrupted by ctrl-c. </p>\n\n<p>If I only send message or only receive message in the main thread, everything works just fine. </p>\n\n<p>Here is the code for the client side. </p>\n\n<pre><code>package main \n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"net\"\n    \"bufio\"\n    \"io\"\n    \"time\"\n)\n\nconst (\n    TIMEOUT = 10\n)\n\nfunc main() {\n    if len(os.Args) &lt; 2 {\n        fmt.Println(usage(os.Args[0]))\n        return\n    }\n\n    var timeout time.Duration\n    if len(os.Args) &gt; 2 {\n        timeout, _ = time.ParseDuration(os.Args[2])\n    }\n    if timeout == 0 {\n        timeout = time.Duration(TIMEOUT * time.Second)\n    }\n\n    conn, err := net.DialTimeout(\"tcp\", os.Args[1], timeout)\n\n    if err != nil {\n        fmt.Println(\"Error connecting: \", err.Error())\n        return\n    }\n\n    defer conn.Close()\n\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, syscall.SIGINT, syscall.SIGTERM)\n\n    go func() {\n        fmt.Println(\"wait ctrl-c\")\n        for _ = range c {\n            fmt.Println(\"close on ctrl-c\")\n            conn.Close()\n        }\n    }()\n\n    for {\n        message, err := bufio.NewReader(os.Stdin).ReadString('\\n')\n        if err == io.EOF {\n            fmt.Fprint(conn, message)\n            break\n        } else if err != nil {\n            fmt.Println(\"Error reading: \", err.Error())\n            break\n        } else {\n            fmt.Fprintf(conn, message)\n        }\n    }\n}\n\nfunc usage(filename string) string {\n    return fmt.Sprintf(\"Usage: %s &lt;address (ex. localhost:8016, google.com:http, [2001:db8::1]:http, etc.)&gt; [timeout (ex. 10s, 300ms, etc.)]\", filename)\n}\n</code></pre>\n\n<p>But after I added the code that just print what it received and run it in another thread, the ctrl-c handler does not work. </p>\n\n<p>This is the code: </p>\n\n<pre><code>package main \n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"net\"\n    \"bufio\"\n    \"io\"\n    \"time\"\n)\n\nconst (\n    TIMEOUT = 10\n)\n\nfunc main() {\n    if len(os.Args) &lt; 2 {\n        fmt.Println(usage(os.Args[0]))\n        return\n    }\n\n    var timeout time.Duration\n    if len(os.Args) &gt; 2 {\n        timeout, _ = time.ParseDuration(os.Args[2])\n    }\n    if timeout == 0 {\n        timeout = time.Duration(TIMEOUT * time.Second)\n    }\n\n    conn, err := net.DialTimeout(\"tcp\", os.Args[1], timeout)\n\n    if err != nil {\n        fmt.Println(\"Error connecting: \", err.Error())\n        return\n    }\n\n    defer conn.Close()\n\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, syscall.SIGINT, syscall.SIGTERM)\n\n    go func() {\n        fmt.Println(\"wait ctrl-c\")\n        for _ = range c {\n            fmt.Println(\"close on ctrl-c\")\n            conn.Close()\n        }\n    }()\n    // code added.\n    go func() {\n        for {\n            message, err := bufio.NewReader(conn).ReadString('\\n')\n            if err == io.EOF {\n                fmt.Print(message)\n                break\n            } else if err != nil {\n                fmt.Println(\"Error remote reading: \", err.Error())\n                break\n            } else {\n                fmt.Print(message)\n            }\n        }\n\n        conn.Close()\n\n        os.Exit(0)\n    }()\n\n    for {\n        message, err := bufio.NewReader(os.Stdin).ReadString('\\n')\n        if err == io.EOF {\n            fmt.Fprint(conn, message)\n            break\n        } else if err != nil {\n            fmt.Println(\"Error reading: \", err.Error())\n            break\n        } else {\n            fmt.Fprintf(conn, message)\n        }\n    }\n}\n\nfunc usage(filename string) string {\n    return fmt.Sprintf(\"Usage: %s &lt;address (ex. localhost:8016, google.com:http, [2001:db8::1]:http, etc.)&gt; [timeout (ex. 10s, 300ms, etc.)]\", filename)\n}\n</code></pre>\n\n<p>I am working on Windows 7 now. \nWhat is the problem and how can I solve it? </p>\n\n<p>You can find both server side and client side code here:\n<a href=\"https://gist.github.com/programus/52591a97def30df9dc81\" rel=\"nofollow\">https://gist.github.com/programus/52591a97def30df9dc81</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1441776318, "post_id": 32471489, "comment_id": 52804409, "body": "Please show us your code (the embedder struct)."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1441776339, "post_id": 32471489, "comment_id": 52804416, "body": "You should be able to modify the <code>*http.Request</code> directly, the fields are exported."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441782192, "post_id": 32471489, "comment_id": 52806962, "body": "which line and error message please."}], "answers": [{"tags": [], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "is_accepted": false, "score": 2, "last_activity_date": 1441784267, "last_edit_date": 1441784267, "creation_date": 1441777602, "answer_id": 32471759, "question_id": 32471489, "link": "https://stackoverflow.com/questions/32471489/how-to-modify-golang-request-object/32471759#32471759", "title": "How to modify golang request object?", "body": "<p>That isn't how <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\"><code>type assertion</code></a> works. </p>\n\n<blockquote>\n  <p>For an expression x of interface type and a type T, the primary\n  expression</p>\n  \n  <p>x.(T) asserts that x is not nil and that the value stored in x is of\n  type T. The notation x.(T) is called a type assertion.</p>\n</blockquote>\n\n<p>You type assert interfaces to their underlying type.</p>\n\n<p>You can't type assert one type to another, that would be <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow\"><code>type conversion</code></a>, but in this case you can't convert between the two. You can only convert two types that are convertible according to the description in the spec above. </p>\n\n<p>If you want to modify the <code>*http.Request</code> just do it directly, the fields are exported. If you want the request to hold extra data just write it in the request body as JSON or in the url.</p>\n\n<p>EDIT: For passing data around you can also <a href=\"https://blog.golang.org/context\" rel=\"nofollow\">use a context</a>, but I am not sure of what you're doing. There is also <a href=\"http://www.gorillatoolkit.org/pkg/context\" rel=\"nofollow\">github.com/gorilla/context</a></p>\n"}], "owner": {"reputation": 3964, "user_id": 5288071, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/hdcFK.png?s=128&g=1", "display_name": "zola", "link": "https://stackoverflow.com/users/5288071/zola"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2003, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1441784267, "creation_date": 1441776241, "last_edit_date": 1441777274, "question_id": 32471489, "link": "https://stackoverflow.com/questions/32471489/how-to-modify-golang-request-object", "title": "How to modify golang request object?", "body": "<p>So I've been trying to modify the request structure in golang using middleware, i tried creating a custom structure and embedding the request object and some more data but i can't type assert it to *http.Request, can anybody please help, thanks in advance.</p>\n\n<p>Edit: so here is what my structure looks like</p>\n\n<pre><code>type CustomRequest struct {\n    *http.Request\n    *profile.User // This is the data i want to embed into the request\n}\n\n// then my middlware will be something like\n\nfunc Middleware(next http.HandlerFunc) http.HandlerFunc {\n    return http.HandleFunc(func (w http.ResponseWriter, r *http.Request)) {\n        user := &amp;User{\n        // User Details Are Here\n        }\n\n        customRequest := &amp;CustomRequest{\n            r,\n            &amp;user,\n        }\n\n        req := customRequest.(*http.Request)\n\n        next.ServeHttp(w, req)\n}\n</code></pre>\n"}, {"tags": ["go", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1441775636, "last_edit_date": 1495542269, "creation_date": 1441775636, "answer_id": 32471385, "question_id": 32470792, "link": "https://stackoverflow.com/questions/32470792/is-there-anyway-to-close-client-request-in-golang-gin/32471385#32471385", "title": "Is there anyway to close client request in golang/gin?", "body": "<p>Yes, you can do that. By simply returning from the handler. And the background job you want to do, you should put that on a new goroutine.</p>\n\n<p>Note that the connection and/or request may be put back into a pool, but that is irrelevant, the client will see that serving the request ended. You achieve what you want.</p>\n\n<p>Something like this:</p>\n\n<pre><code>func Test(c *gin.Context) {\n    c.String(200, \"ok\")\n    // By returning from this function, response will be sent to the client\n    // and the connection to the client will be closed\n\n    // Started goroutine will live on, of course:\n    go func() {\n       // This function will continue to execute... \n    }()\n}\n</code></pre>\n\n<p>Also see: <a href=\"https://stackoverflow.com/questions/31116870/goroutine-execution-inside-an-http-handler\">Goroutine execution inside an http handler</a></p>\n"}], "owner": {"reputation": 15493, "user_id": 380774, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3772ea86cd39ce7e63280ecfffb6512c?s=128&d=identicon&r=PG", "display_name": "fannheyward", "link": "https://stackoverflow.com/users/380774/fannheyward"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1967, "favorite_count": 0, "accepted_answer_id": 32471385, "answer_count": 1, "score": 1, "last_activity_date": 1441775636, "creation_date": 1441771947, "question_id": 32470792, "link": "https://stackoverflow.com/questions/32470792/is-there-anyway-to-close-client-request-in-golang-gin", "title": "Is there anyway to close client request in golang/gin?", "body": "<p>Using <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow\">gin</a> framework.</p>\n\n<p>Is there anyway to notify client to close request connection, then server handler can do any back-ground jobs without letting the clients to wait on the connection?</p>\n\n<pre><code>func Test(c *gin.Context) {\n        c.String(200, \"ok\")\n        // close client request, then do some jobs, for example sync data with remote server.\n        //\n}\n</code></pre>\n"}, {"tags": ["recursion", "go", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 4, "last_activity_date": 1441755772, "creation_date": 1441755772, "answer_id": 32468849, "question_id": 32468762, "link": "https://stackoverflow.com/questions/32468762/how-to-find-out-nothing-is-being-received-in-an-unbuffered-channel-without-closi/32468849#32468849", "title": "How to find out nothing is being received in an unbuffered channel without closing it?", "body": "<p>There is no such things as \"queued in an unbuffered channel.\" If the channel is unbuffered, it is by definition always empty. If it is buffered, then it may have some number of elements in it up to its size. But trying to read how many elements are in it is always going to cause race conditions, so don't design that way (it's also impossible in Go).</p>\n\n<p>Ideally, avoid designs that need to know when children are complete, but when you must, send them a channel to respond to you on. When they respond, then you know they're complete.</p>\n\n<p>The kind of problem you're describing is well covered in the Go blogs and talks:</p>\n\n<ul>\n<li><a href=\"http://blog.golang.org/pipelines\" rel=\"nofollow\">Go Concurrency Patterns: Pipelines and cancellation</a></li>\n<li><a href=\"http://blog.golang.org/context\" rel=\"nofollow\">Go Concurrency Patterns: Context</a></li>\n<li><a href=\"http://blog.golang.org/concurrency-is-not-parallelism\" rel=\"nofollow\">Concurrency is not paralellism</a></li>\n<li><a href=\"http://talks.golang.org/2012/concurrency.slide#1\" rel=\"nofollow\">Go Concurrency Patterns</a></li>\n<li><a href=\"http://talks.golang.org/2013/advconc.slide#1\" rel=\"nofollow\">Advanced Go Concurrency Patterns</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 0, "last_activity_date": 1441759383, "creation_date": 1441759383, "answer_id": 32469253, "question_id": 32468762, "link": "https://stackoverflow.com/questions/32468762/how-to-find-out-nothing-is-being-received-in-an-unbuffered-channel-without-closi/32469253#32469253", "title": "How to find out nothing is being received in an unbuffered channel without closing it?", "body": "<p>You can determine whether or not a goroutine is blocked on the other end of a channel by using <code>default</code> in a <code>select</code> statement. For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar c = make(chan int)\n\nfunc produce(i int) {\n    c &lt;- i\n}\n\nfunc consume() {\n    for {\n        select {\n        case i := &lt;-c:\n            fmt.Println(i)\n        default:\n            return\n        }\n    }\n}\n\nfunc main() {\n    for i := 0; i &lt; 10; i++ {\n        go produce(i)\n    }\n    time.Sleep(time.Millisecond)\n    consume()\n}\n</code></pre>\n\n<p>Keep in mind that this isn't a queue though. If you were to have 1 producing goroutine that looped and produced multiple values between the time it took to send one value and get back around the loop again the <code>default</code> case would happen and your consumer would move on.</p>\n\n<p>You could use a timeout:</p>\n\n<pre><code>case &lt;-time.After(time.Second):\n</code></pre>\n\n<p>Which would give your producer a second to produce another value, but you're probably better off using a terminal value. Wrap whatever you're sending in a struct:</p>\n\n<pre><code>type message struct {\n    err error\n    data theOriginalType\n}\n</code></pre>\n\n<p>And send that thing instead. Then use <code>io.EOF</code> or a custom error <code>var Done = errors.New(\"DONE\")</code> to signal completion.</p>\n\n<p>Since you have a recursive problem why not use a <a href=\"http://godoc.org/sync#WaitGroup\" rel=\"nofollow\"><code>WaitGroup</code></a>? Each time you start a new task increment the wait group, and each time a task completes, decrement it. Then have an outer task waiting on completion. For example here's a really inefficient way of calculating a fibonacci number:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar wg sync.WaitGroup\n\nfunc fib(c chan int, n int) {\n    defer wg.Done()\n    if n &lt; 2 {\n        c &lt;- n\n    } else {\n        wg.Add(2)\n        go fib(c, n - 1)\n        go fib(c, n - 2)\n    }\n}\n\nfunc main() {\n    wg.Add(1)\n    c := make(chan int)\n    go fib(c, 18)\n    go func() {\n        wg.Wait()\n        close(c)\n    }()\n    sum := 0\n    for i := range c {\n        sum += i\n    }\n    fmt.Println(sum)\n}\n</code></pre>\n"}], "owner": {"reputation": 421, "user_id": 2873262, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f8b8419c1469cda8acef2c3a8546d4e?s=128&d=identicon&r=PG&f=1", "display_name": "Sunil", "link": "https://stackoverflow.com/users/2873262/sunil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 32469253, "answer_count": 2, "score": 0, "last_activity_date": 1441759383, "creation_date": 1441754984, "last_edit_date": 1441756005, "question_id": 32468762, "link": "https://stackoverflow.com/questions/32468762/how-to-find-out-nothing-is-being-received-in-an-unbuffered-channel-without-closi", "title": "How to find out nothing is being received in an unbuffered channel without closing it?", "body": "<p>Is there a way to know if all the values in channel has been consumed? I'm making a crawler which recursively fetches sites from seed site. I'm not closing the channel because it consumes from the server and should crawl every time new site is sent. For a given seed site, I can't find a better way to know completion of a subtask other than timing out. If there was a way to know that there is no value in channel(left to be consumed), my program could get out of the sub task and continue listening to the server.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 207, "user_id": 682847, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/620b456c7ccfb905c81a4320d1652ffb?s=128&d=identicon&r=PG", "display_name": "xorpaul", "link": "https://stackoverflow.com/users/682847/xorpaul"}, "edited": false, "score": 3, "creation_date": 1445876190, "post_id": 32468331, "comment_id": 54496435, "body": "example with date for adding a buildtime variable <code>go build -ldflags &quot;-X &#39;main.buildtime=$(date -u &#39;+%Y-%m-%d %H:%M:%S&#39;)&#39;&quot;</code>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 12, "last_activity_date": 1441802585, "last_edit_date": 1441802585, "creation_date": 1441751759, "answer_id": 32468331, "question_id": 32468283, "link": "https://stackoverflow.com/questions/32468283/how-to-contain-space-in-value-string-of-link-flag-when-using-go-build/32468331#32468331", "title": "How to contain space in value string of link flag when using go build", "body": "<p>From the <a href=\"http://golang.org/cmd/link/\" rel=\"noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>Note that before Go 1.5 this option took two separate arguments.<br>\n  Now it takes one argument split on the first = sign.</p>\n</blockquote>\n\n<p>Enclose the entire argument in quotes:</p>\n\n<pre><code>go build -o m -ldflags '-X \"main.version=abc 123\"' m.go\n</code></pre>\n"}], "owner": {"reputation": 2040, "user_id": 1076339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09c4b8e584561c8709df7789a04126f0?s=128&d=identicon&r=PG", "display_name": "PasteBT", "link": "https://stackoverflow.com/users/1076339/pastebt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2146, "favorite_count": 0, "accepted_answer_id": 32468331, "answer_count": 1, "score": 5, "last_activity_date": 1441802585, "creation_date": 1441751446, "question_id": 32468283, "link": "https://stackoverflow.com/questions/32468283/how-to-contain-space-in-value-string-of-link-flag-when-using-go-build", "title": "How to contain space in value string of link flag when using go build", "body": "<p>Here is test code m.go:</p>\n\n<pre><code>package main\n\nvar version string\n\nfunc main() {\n    println(\"ver = \", version)\n}\n</code></pre>\n\n<p>If I compile and link with go 1.5:</p>\n\n<pre><code>go tool compile m.go\ngo tool link -o m -X main.version=\"abc 123\" m.o\n</code></pre>\n\n<p>Works fine.</p>\n\n<p>But if I use build command with go 1.5:</p>\n\n<pre><code>go build -o m -ldflags '-X main.version=\"abc 123\"' m.go\n</code></pre>\n\n<p>It will show help message, which means something wrong</p>\n\n<p>If I change to 1.4 syntax:</p>\n\n<pre><code>go build -o m -ldflags '-X main.version \"abc 123\"' m.go\n</code></pre>\n\n<p>It works except a warning message:</p>\n\n<pre><code>link: warning: option -X main.version abc 123 may not work in future releases; use -X main.version=abc 123\n</code></pre>\n\n<p>If it has no space in parameter value, works fine:</p>\n\n<pre><code>go build -o m -ldflags '-X main.version=abc123' m.go\n</code></pre>\n\n<p>Because compile and link works fine, So I think it is not link part issue.\nI compared go1.4 and go 1.5 source code of build, for ldflags part, looks nothing changed. Of cause I can use some spacial char to replace space then in program to change it back, but why? Is there something I missed? What is the right syntax to use -ldflags ? Thanks</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "edited": false, "score": 1, "creation_date": 1441745643, "post_id": 32467002, "comment_id": 52796113, "body": "Are you sure that it actually hits that? Do a <code>fmt.Printf(&quot;%#v\\n&quot;, appId)</code> right before <code>c.Next()</code>"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "edited": false, "score": 0, "creation_date": 1441745751, "post_id": 32467002, "comment_id": 52796161, "body": "In the response there is the JSON in the question and more JSON from the actual route that the request was for!"}], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441746188, "post_id": 32467154, "comment_id": 52796382, "body": "Good spot - didn&#39;t see that"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 1, "creation_date": 1441790823, "post_id": 32467154, "comment_id": 52812359, "body": "Unfortunately, after further testing I still have the same issues. Code beyond <code>c.Abort()</code> is still being executed for some reason?"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441808995, "post_id": 32467154, "comment_id": 52825393, "body": "I required <code>c.Abort()</code> and <code>return</code> as it happens"}, {"owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441817375, "post_id": 32467154, "comment_id": 52831305, "body": "@tommyd456 whoops, sorry. Meant for the return to still be included. My mistake."}], "tags": [], "owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "is_accepted": false, "score": 4, "last_activity_date": 1441817361, "last_edit_date": 1441817361, "creation_date": 1441746039, "answer_id": 32467154, "question_id": 32467002, "link": "https://stackoverflow.com/questions/32467002/failed-to-abort-context-gin/32467154#32467154", "title": "Failed to Abort() context - gin", "body": "<p>Looking at the Gin API docs, you'll need to call <a href=\"http://godoc.org/github.com/gin-gonic/gin#Context.Abort\" rel=\"nofollow\">context.Abort()</a> instead of returning from your method.</p>\n\n<blockquote>\n  <p>Abort stops the system to continue calling the pending handlers in the chain. Let's say you have an authorization middleware that validates if the request is authorized if the authorization fails (the password does not match). This method (Abort()) should be called in order to stop the execution of the actual handler.</p>\n</blockquote>\n\n<p>So in your specific case</p>\n\n<pre><code>if appId == \"\" {\n    c.JSON(http.StatusOK, gin.H{\"code\": \"MISSING_APP_ID\", \"message\": \"Your request is missing an application id\"})\n    c.Abort()\n    return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441807076, "post_id": 32480953, "comment_id": 52823907, "body": "Sorry if I&#39;ve misunderstood but how do I then stop code being executed beyond the first <code>c.Abort()</code> - I don&#39;t want to query the database if the <code>appId</code> hasn&#39;t been provided. I can see my code ending up with many nested conditionals bearing in mind that the code above is a &quot;trimmed&quot; version of what I really have."}, {"owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441808427, "post_id": 32480953, "comment_id": 52824947, "body": "I guess adding a return statement after every <code>c.Abort()</code> and <code>c.Next()</code> unless its the last one."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441808970, "post_id": 32480953, "comment_id": 52825373, "body": "Right - so a combination of both was what was needed - appreciate the help and explanation"}, {"owner": {"reputation": 15271, "user_id": 133747, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6703c5e8fecd2b0d0d3e137bcff7c61e?s=128&d=identicon&r=PG", "display_name": "huggie", "link": "https://stackoverflow.com/users/133747/huggie"}, "edited": false, "score": 0, "creation_date": 1587106620, "post_id": 32480953, "comment_id": 108382698, "body": "Why is it that not calling c.Next() is not enough?"}], "tags": [], "owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "is_accepted": false, "score": 3, "last_activity_date": 1441805386, "creation_date": 1441805386, "answer_id": 32480953, "question_id": 32467002, "link": "https://stackoverflow.com/questions/32467002/failed-to-abort-context-gin/32480953#32480953", "title": "Failed to Abort() context - gin", "body": "<p><strong>TL;DR</strong></p>\n\n<p>You need to do:</p>\n\n<pre><code>if condition {\n  c.Abort()\n} else {\n  c.Next()\n}\n</code></pre>\n\n<p><strong>Explanation</strong></p>\n\n<p>(Note: this builds on @Landers answer)</p>\n\n<p><code>c.Abort()</code> just sets some internal flags that mark the context in a certain way that indicates abnormal termination. It makes sense, it's a parameterless method that returns nothing, so you're only calling it for its side-effects.</p>\n\n<p>Same thing with <code>c.Next()</code></p>\n\n<p>Because of go's control flow (no exceptions or jumps) its clear that these two methods don't take any immediate action but \"set up the stage\" for the next phase, imagine Gins code that calls your <code>CheckAppId</code> func:</p>\n\n<pre><code>// gin code\ndoStuff()\nctx := getContext()\n\n// this is your CheckAppId\nnextAction := FindAction()\nnextAction(&amp;ctx)\n\n// here the context is evaluated to see if you either abort or continue.\ncheckContextStatus(&amp;ctx)\n</code></pre>\n\n<p>So, if you're calling <code>c.Abort()</code> and then <code>c.Next()</code> you're overriding the abort indications. </p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3229, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1489505019, "creation_date": 1441745383, "last_edit_date": 1489505019, "question_id": 32467002, "link": "https://stackoverflow.com/questions/32467002/failed-to-abort-context-gin", "title": "Failed to Abort() context - gin", "body": "<p>I have the following Gin middleware:</p>\n\n<pre><code>func CheckAppId(appC *core.Context) gin.HandlerFunc {\n    return func(c *gin.Context) {\n        //get Basic Auth credentials\n        appId, token, _ := c.Request.BasicAuth()\n\n        if appId == \"\" {\n            c.JSON(http.StatusOK, gin.H{\"code\": \"MISSING_APP_ID\", \"message\": \"Your request is missing an application id\"})\n            return //this is being ignored???\n        }\n\n        c.Next() //this still gets hit\n    }\n}\n</code></pre>\n\n<p>but if the <code>appId == \"\"</code> the JSON gets returned and <code>c.Next()</code> gets executed too. Is this expected behaviour?</p>\n\n<p><strong>EDIT</strong>\nI thought the problem had been sold but the same thing appears to be happening. I now have:</p>\n\n<pre><code>func CheckAppId(appC *core.Context) gin.HandlerFunc {\n    return func(c *gin.Context) {\n        //get Basic Auth credentials\n        appId, token, _ := c.Request.BasicAuth()\n\n        if appId == \"\" {\n            //I'm getting this JSON in the response\n            c.JSON(http.StatusOK, gin.H{\"code\": \"MISSING_APP_ID\", \"message\": \"Your request is missing an application id\"})\n            c.Abort()\n        }\n\n        //find app_id in database\n        app := core.App{}\n        err := appC.Database.C(\"apps\").Find(bson.M{\"id\" : appId}).One(&amp;app)\n        if err != nil { //no app found\n            //and I'm getting this JSON in the response\n            c.JSON(http.StatusOK, gin.H{\"code\": \"INVALID_APP_ID\", \"message\": \"The application id provided could not be found\"})\n            c.Abort()\n        }\n\n        c.Next()\n    }\n}\n</code></pre>\n\n<p>In a call to the API I receive both \"MISSING_APP_ID\" Json and \"INVALID_APP_ID\" Json</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1441740174, "post_id": 32465526, "comment_id": 52793239, "body": "Still doesn&#39;t explain how this <a href=\"https://github.com/lib/pq/blob/b269bd035a727d6c1081f76e7a239a1b00674c40/conn.go\" rel=\"nofollow noreferrer\">lib/pq init()</a> works. It only calls <code>sql.Register(&quot;postgres&quot;, &amp;drv{})</code>. How does all the other codes effect?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 2, "creation_date": 1441740847, "post_id": 32465526, "comment_id": 52793581, "body": "@Entei yes it does... Firstly, I explained what an import side effect is, not the side effect of that specific import. If you&#39;d like to know the specific side effect of that then look at the docs for <code>sql.Register</code> <a href=\"http://golang.org/pkg/database/sql/#Register\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#Register</a> ... if you call that method again in some other scope it will panic. That effects all the code."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1441740899, "post_id": 32465526, "comment_id": 52793600, "body": "&quot;It only calls sql.Register(&quot;postgres&quot;, &amp;drv{})&quot; <b>is</b> the desired side effect: The packages registers itself to be known in package sql."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1441740989, "post_id": 32465526, "comment_id": 52793644, "body": "@evanmcdonnal, don&#39;t forget, in addition to <code>init</code> a package can do something like <code>var foo = someOtherFunction()</code> as a package variable which will call the function (and have side effects) before <code>init</code> even runs. E.g. <code>var _ = os.Remove(&quot;somefile&quot;)</code>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1441741149, "post_id": 32465526, "comment_id": 52793725, "body": "@DaveC yeah, I suppose that should be included in the answer though reading the 1 paragraph blurb on <code>init</code> explains the order in which things happen."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1441741676, "post_id": 32465526, "comment_id": 52794006, "body": "@Volker Am I missing something? The &quot;desired side effect&quot; is only one function with empty drv{}. How does all the other code get executed with this side effect since there is no connection between them as I could observe."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1441742690, "post_id": 32465526, "comment_id": 52794626, "body": "@Entei do you think the author wrote that single, very explicit, line of code by accident? I don&#39;t get what you&#39;re questioning. It is the intended side effect of the packages author. You haven&#39;t stated how it interacts with your project but it sounds like it&#39;s a problem which probably means you should look for a different package. Are you familiar with the implementation of <code>Register</code> and what it does? I personally am not but that is the code that executes, follow it&#39;s source if you want to know all that happens. Everything is explicit, there isn&#39;t any other code running."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1441744074, "post_id": 32465526, "comment_id": 52795313, "body": "@evanmcdonnal are you saying importing a 5k line project&#39;s all effect is simply one function? I am questioning the effect we are seeing by importing lib/pq. Is the effect just init function or are there other effects which I can not see?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1441746413, "post_id": 32465526, "comment_id": 52796503, "body": "@Entei the init function is the main thing that happens. A few others do too, like these statements are evaluated; <a href=\"https://github.com/lib/pq/blob/b269bd035a727d6c1081f76e7a239a1b00674c40/conn.go#L30\" rel=\"nofollow noreferrer\">github.com/lib/pq/blob/b269bd035a727d6c1081f76e7a239a1b00674&zwnj;&#8203;c40/&hellip;</a> but I don&#39;t see that having any noticeable &#39;side effect&#39; since they&#39;re in the packages scope. Is that the only effect of importing the package? No. It&#39;s the only side effect. You import the package to make use of it&#39;s types and/or methods. This is a side effect of importing it and it is the only one who&#39;s effect isn&#39;t encapsulated."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1441746453, "post_id": 32465526, "comment_id": 52796522, "body": "@Entei Yes you are completely missing how important registering the pq driver with package sql is. It simply would not work if it wouldn&#39;t be registered. Take a look at how package image and e.g. image/png interact. It is the same mechanism. And no: No other code is directly executed by the import statement alone. This happens afterwards."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1441747302, "post_id": 32465526, "comment_id": 52796875, "body": "@Volker besides init(), does heap variables count as side effect? Does heap const and interfaces also count as side effect? The OP only specified init() function as side effect nothing else."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1441771716, "post_id": 32465526, "comment_id": 52803143, "body": "What are &quot;heap variables&quot; in Go? Some things are place on the heap, some not; this decision even depends on the compiler version used. Even stranger: what are &quot;heap consts&quot;? And what do you mean when you say &quot;Do[...] interfaces also count as side effect?&quot; Interfaces are types... May I ask why you are so interested in side effects of imported packages?"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 15, "last_activity_date": 1441741412, "last_edit_date": 1441741412, "creation_date": 1441739698, "answer_id": 32465526, "question_id": 32465453, "link": "https://stackoverflow.com/questions/32465453/golang-what-is-import-side-effect/32465526#32465526", "title": "golang what is import side effect", "body": "<p>When they say 'import side effects' they are essentially referring to code/features that are used statically. Meaning just the import of the package will cause some code to execute on app start putting my system in a state different than it would be without having imported that package (like code in an <code>init()</code> which in their example registers handlers, it could also lay down config files, modify resource on disc, ect). The effective go tutorial is explaining this simply to illustrate reasons why a developer might want to do a blank import ie; <code>import _ \"somepackageImNotUsingReally\"</code></p>\n\n<p>EDIT: to add additional context when I said <code>init()</code> I was referring to this method; <a href=\"https://golang.org/doc/effective_go.html#init\" rel=\"noreferrer\">https://golang.org/doc/effective_go.html#init</a> - any imported packages will have their init methods called prior to main being called. Whatever is in the <code>init()</code> is a side effect. I don't think there can be any others because things like constants will be at the package scope, not the global scope so it wouldn't redefine constants or anything like that.</p>\n\n<p>EDIT2: as pointed out in comments and explained in the init link above \" is called after all the variable declarations in the package have evaluated their initializers\" meaning code like <code>PackageScopeVar := unexportedInitializerThatWritesToDisc()</code> will run and could have side effects.</p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4893, "favorite_count": 1, "accepted_answer_id": 32465526, "answer_count": 1, "score": 12, "last_activity_date": 1607892168, "creation_date": 1441739388, "last_edit_date": 1441741839, "question_id": 32465453, "link": "https://stackoverflow.com/questions/32465453/golang-what-is-import-side-effect", "title": "golang what is import side effect", "body": "<pre><code>import (\n    _ \"github.com/lib/pq\"\n    _ \"image/png\"\n    ...\n)\n</code></pre>\n\n<p>In <a href=\"https://golang.org/doc/effective_go.html#blank_import\" rel=\"noreferrer\">effective go</a> it says that these kinds of imports mean side effect. I've read several SO answers but none explain what is an <code>import side effect</code>. Could someone elaborate the term <code>import side effect</code>?</p>\n"}, {"tags": ["sockets", "tcp", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1441739338, "post_id": 32465396, "comment_id": 52792815, "body": "Can you give an example of what you&#39;re trying to do? The question doesn&#39;t really make sense as it is."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1441739387, "post_id": 32465396, "comment_id": 52792847, "body": "I don&#39;t quite understand your question but generally speaking you the body is represented with an <code>io.Reader</code> and you can just read off it until it&#39;s end... In the case of a chunked response you are completely abstracted from the individual chunks, you see it as a stream of text data... The same as a body that was served all at once. Hope that helps."}, {"owner": {"reputation": 99, "user_id": 2637522, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1810c5e4b326854c64d804af00ad3a?s=128&d=identicon&r=PG", "display_name": "sintanial", "link": "https://stackoverflow.com/users/2637522/sintanial"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441740314, "post_id": 32465396, "comment_id": 52793304, "body": "@JimB Browser (aka client), connect to my server, and proxy https site. For proxy over https, browser send CONNECT request, listen 200 OK response, and then send encrypted data to me, separated by chunks, for example chunk1 - 167 bytes, chunk2 - 312 bytes, chunk3 - 72 bytes Then browser stops, and waiting response, after receive response browser again send chunks.  I need to collect chunk1, chunk2, chunk3 in one chunk, but i don&#39;t know when browser stopped to send chunks, and switch to wait state.  I hope it is now clear :)?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441741461, "post_id": 32465396, "comment_id": 52793887, "body": "@sintanial: If you&#39;re proxying opaque data, you have no way of knowing when the client is done with a &quot;message&quot;. You don&#39;t need to collate anything, just send the data to the server."}, {"owner": {"reputation": 99, "user_id": 2637522, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1810c5e4b326854c64d804af00ad3a?s=128&d=identicon&r=PG", "display_name": "sintanial", "link": "https://stackoverflow.com/users/2637522/sintanial"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441741749, "post_id": 32465396, "comment_id": 52794037, "body": "@JimB -&gt;You don&#39;t need to collate anything, just send the data to the server. -- I know it, but i need to collect chunks (business logic)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1441742638, "post_id": 32465396, "comment_id": 52794597, "body": "If you can&#39;t interpret the underlying data and it&#39;s protocol (you said it&#39;s encrypted), you have no way to know how many chunks to expect. What you&#39;re essentially asking is &quot;how do I read N bytes from a stream, without knowing N?&quot;."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 2, "creation_date": 1441743161, "post_id": 32465396, "comment_id": 52794889, "body": "An HTTPS proxy can only copy bytes. The data is encrypted. You can&#39;t see inside. The chunks are meaningless to you and they are also meaningless to both peers. Your requirement to &#39;collect chunks&#39; is also meaningless, and there is no &#39;business logic&#39; you can implement on encrypted data. Just copy the bytes."}], "answers": [{"tags": [], "owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "is_accepted": false, "score": 2, "last_activity_date": 1441747321, "creation_date": 1441747321, "answer_id": 32467458, "question_id": 32465396, "link": "https://stackoverflow.com/questions/32465396/how-to-read-data-from-socket-until-client-stopped-send/32467458#32467458", "title": "How to read data from socket, until client stopped send?", "body": "<p>Based on the information in your comments, you're doing this wrong. The correct way to write an HTTPS proxy is to read the CONNECT line, make the upstream connection, send the appropriate response back o the client, and then if successful start copying bytes in both directions simultaneously. You're not in the least concerned with packets or read sizes, and you should certainly not make any attempt to 'collect' packets before retransmission, as that will just add latency to the system.</p>\n\n<p>You can accomplish this either by starting two threads per connection, one in each direction, or via non-blocking sockets and <code>select()/poll()/epoll()</code>, or whatever that looks like in Go.</p>\n\n<p><strong>BUT</strong> I have no idea why you're doing this at all. There are plenty of open-source HTTP proxies already in existence, and as you're dealing with HTTPS there is no value you can possibly add to them. Your claim about 'business logic' is meaningless, or at least unimplementable.</p>\n"}], "owner": {"reputation": 99, "user_id": 2637522, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f1810c5e4b326854c64d804af00ad3a?s=128&d=identicon&r=PG", "display_name": "sintanial", "link": "https://stackoverflow.com/users/2637522/sintanial"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 0, "closed_date": 1441809348, "answer_count": 1, "score": 0, "last_activity_date": 1441747321, "creation_date": 1441739131, "question_id": 32465396, "link": "https://stackoverflow.com/questions/32465396/how-to-read-data-from-socket-until-client-stopped-send", "closed_reason": "Needs details or clarity", "title": "How to read data from socket, until client stopped send?", "body": "<p>I have some problem.\nI have client and server. Client connect with server over TCP. \nThen, client send some data (separated by chunks), I don't know what is the length of data (TLS handshake). But I know that client send some data with fixed length, and then stop, until not received some response, then he send data with fixed length again.</p>\n\n<p>I need read all chunks, until client stopped send (because so many chunks). How to do that ?</p>\n\n<p>I have only one idea, it's timeout. Read data in loop and set timeout between iterate. If timeout is ended, then data complete collected.</p>\n\n<p>Perhaps there is a more elegant solution?</p>\n"}, {"tags": ["json", "xml", "go"], "answers": [{"comments": [{"owner": {"reputation": 779, "user_id": 1903988, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/744248792bd5933197bc41f042e929db?s=128&d=identicon&r=PG&f=1", "display_name": "mugzi", "link": "https://stackoverflow.com/users/1903988/mugzi"}, "edited": false, "score": 0, "creation_date": 1441778275, "post_id": 32464412, "comment_id": 52805117, "body": "There was an issue when using this (xml: unsupported type: map[string]interface {})"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 779, "user_id": 1903988, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/744248792bd5933197bc41f042e929db?s=128&d=identicon&r=PG&f=1", "display_name": "mugzi", "link": "https://stackoverflow.com/users/1903988/mugzi"}, "edited": false, "score": 0, "creation_date": 1441782390, "post_id": 32464412, "comment_id": 52807079, "body": "@Himal ah yeah, it doesn&#39;t know how to marshal <code>map[string]interface{}</code> into valid xml, which isn&#39;t surprising considering how rigid xml is. You gotta use it with a more concrete type. Do you have use <code>map[string]interface{}</code>?"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 3, "last_activity_date": 1441735474, "creation_date": 1441735474, "answer_id": 32464412, "question_id": 32464262, "link": "https://stackoverflow.com/questions/32464262/how-to-convert-json-string-to-xml-in-golang/32464412#32464412", "title": "How to convert Json string to xml in Golang?", "body": "<p>There's an xml package that is equivalent to the json one under encoding. Just import it and then marshal the result of your <code>json.Unmarshal</code></p>\n\n<pre><code>import \"encoding/xml\"\nxml.Marshal(&amp;f)\n</code></pre>\n"}], "owner": {"reputation": 779, "user_id": 1903988, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/744248792bd5933197bc41f042e929db?s=128&d=identicon&r=PG&f=1", "display_name": "mugzi", "link": "https://stackoverflow.com/users/1903988/mugzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4599, "favorite_count": 0, "accepted_answer_id": 32464412, "answer_count": 1, "score": 0, "last_activity_date": 1442251614, "creation_date": 1441734920, "last_edit_date": 1442251614, "question_id": 32464262, "link": "https://stackoverflow.com/questions/32464262/how-to-convert-json-string-to-xml-in-golang", "title": "How to convert Json string to xml in Golang?", "body": "<p>I'm trying to convert json string in to xml format using Golang. My whole object is to convert json in to map string interface and then convert interface in to xml file. (There is no predefined structs). Please help me to solve this issue? </p>\n\n<pre><code>var f interface{}\nerr := json.Unmarshal(b, &amp;f)\n</code></pre>\n"}, {"tags": ["go", "basic-authentication", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "is_accepted": true, "score": 2, "last_activity_date": 1441735827, "creation_date": 1441735827, "answer_id": 32464508, "question_id": 32463626, "link": "https://stackoverflow.com/questions/32463626/get-basicauth-creds-in-gin/32464508#32464508", "title": "Get BasicAuth creds in Gin", "body": "<p>The gin context contains the <code>http.Request</code> object in the <a href=\"http://godoc.org/github.com/gin-gonic/gin#Context\" rel=\"nofollow\"><code>Request</code> field.</a></p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1731, "favorite_count": 1, "accepted_answer_id": 32464508, "answer_count": 1, "score": 1, "last_activity_date": 1489506659, "creation_date": 1441732607, "last_edit_date": 1489506659, "question_id": 32463626, "link": "https://stackoverflow.com/questions/32463626/get-basicauth-creds-in-gin", "title": "Get BasicAuth creds in Gin", "body": "<p>I have made a switch to Gin to try it out. Before the move I accessed the BasicAuth credentials (app_id and token) using the request object like this:</p>\n\n<pre><code>appId, token, _ := r.BasicAuth()\n</code></pre>\n\n<p>The <code>app_id</code> needs to be found in my database on every call so I'm using Gin middleware for this:</p>\n\n<pre><code>func CheckAppId() gin.HandlerFunc {\n    return func(c *gin.Context) {\n        //how do I access the BasicAuth creds here?\n    }\n}\n</code></pre>\n\n<p>but I'm not sure how to access the BasicAuth creds without the request object.</p>\n"}, {"tags": ["android", "ios", "go", "react-native"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1441770461, "post_id": 32463184, "comment_id": 52802857, "body": "my pratice: <a href=\"https://github.com/jan4984/UnsEduOralevaldemo\" rel=\"nofollow noreferrer\">github.com/jan4984/UnsEduOralevaldemo</a>. to do a http server with go(easy), to do a pure web application(like in browser-easy). pass data between view and background server with standard http ajax."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1441792306, "post_id": 32463184, "comment_id": 52813398, "body": "As long as you get Gomob and ReactNative to work separately, you wouldn&#39;t have a problem attaching them if you speak http between them."}, {"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1441807677, "post_id": 32463184, "comment_id": 52824346, "body": "So it seems there&#39;s a misunderstanding.  Go&#39;s mobile lib <i>is not</i> server side it would compile with react-native on the mobile client side. As in the go mobile side makes requests to the server then I want to send that response data to react-native to template into a view.  With that in mind, why would I want to talk http between the two?"}, {"owner": {"reputation": 841, "user_id": 180154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/962007abcd509b54e2de3a6fbd61aec2?s=128&d=identicon&r=PG", "display_name": "Gedw99", "link": "https://stackoverflow.com/users/180154/gedw99"}, "edited": false, "score": 0, "creation_date": 1446723693, "post_id": 32463184, "comment_id": 54867103, "body": "I think they are assuming that the go lib is on the phone, and it exposes a http interface to the react native lib ? Just my reading."}, {"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1446735635, "post_id": 32463184, "comment_id": 54875303, "body": "I&#39;m not too sure, but that&#39;s even more odd of a solution in that case haha."}], "answers": [{"tags": [], "owner": {"reputation": 10246, "user_id": 1559386, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/52ebc97578e2a9226fd3794b6d683036?s=128&d=identicon&r=PG", "display_name": "Daniel Schmidt", "link": "https://stackoverflow.com/users/1559386/daniel-schmidt"}, "is_accepted": true, "score": 3, "last_activity_date": 1465674689, "creation_date": 1465674689, "answer_id": 37767957, "question_id": 32463184, "link": "https://stackoverflow.com/questions/32463184/can-golang-mobile-be-used-with-react-native/37767957#37767957", "title": "Can Golang mobile be used with React-Native?", "body": "<p>Yes, you can do that. You may include the generated code in your react native project and write some \"glue code\" (an objective-c and java class) that requires your go library and uses the <a href=\"https://facebook.github.io/react-native/docs/native-modules-ios.html\" rel=\"nofollow\">Native Module extension</a> by React Native to get access to the provided functionality.</p>\n"}, {"tags": [], "owner": {"reputation": 17, "user_id": 4940844, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-T6CquowI6uI/AAAAAAAAAAI/AAAAAAAAAbY/StFQnJDRA9I/photo.jpg?sz=128", "display_name": "Keith Lashley", "link": "https://stackoverflow.com/users/4940844/keith-lashley"}, "is_accepted": false, "score": 0, "last_activity_date": 1530774035, "creation_date": 1530774035, "answer_id": 51185119, "question_id": 32463184, "link": "https://stackoverflow.com/questions/32463184/can-golang-mobile-be-used-with-react-native/51185119#51185119", "title": "Can Golang mobile be used with React-Native?", "body": "<p>I believe that React Native can be used to make mobile apps with any language that can run on the web.  Currently I am learning how to make  React app with a Golang backend. Later I will build this in React Native and start building other apps with Golang to see how far this goes. There is a course on udemy that teaches golang and react and it isn't that long.</p>\n"}], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3287, "favorite_count": 4, "accepted_answer_id": 37767957, "answer_count": 2, "score": 6, "last_activity_date": 1530774035, "creation_date": 1441731055, "last_edit_date": 1442607962, "question_id": 32463184, "link": "https://stackoverflow.com/questions/32463184/can-golang-mobile-be-used-with-react-native", "title": "Can Golang mobile be used with React-Native?", "body": "<p>I'm considering writing a mobile app using both Go's mobile lib <a href=\"https://godoc.org/golang.org/x/mobile\" rel=\"noreferrer\">https://godoc.org/golang.org/x/mobile</a> (I know it's experimental, so this is more of a wait and see situation) for a data layer and a polyfill for the android view and use React-native <a href=\"http://facebook.github.io/react-native/\" rel=\"noreferrer\">http://facebook.github.io/react-native/</a> for the iOS view and hopefully the android view once that is supported (if it is/will be supported).  </p>\n\n<p>How much conflict would I have in doing this, if any? I assume I could pass data between the two libraries from each respective native (as in obj-c and java, I know this all compiles to a native app) languages.</p>\n\n<p><strong>To Clarify</strong></p>\n\n<p>Go's mobile lib and react-native would both be compiled into the mobile client.  The go lib makes requests to a server and is not the server.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>So React Native came out for Android, so now I'm just wondering how go mobile and react native and communicate between each other within the same app executable.</p>\n"}, {"tags": ["heroku", "go", "http-status-code-503"], "comments": [{"owner": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "edited": false, "score": 0, "creation_date": 1441798545, "post_id": 32463004, "comment_id": 52817581, "body": "Is it possible your app is binding the right port, but only on the local connection loop and not on all of them (which would make the platform not detect the port as bound, and crash the app)."}, {"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "reply_to_user": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "edited": false, "score": 0, "creation_date": 1441815511, "post_id": 32463004, "comment_id": 52830246, "body": "@DamienMATHIEU Sorry, I&#39;m not sure of what you are saying. What does &quot;on the local connection loop and not on all of them&quot; mean?"}, {"owner": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "edited": false, "score": 0, "creation_date": 1441819114, "post_id": 32463004, "comment_id": 52832198, "body": "If your app is only listening on <code>localhost</code>, the process watcher cannot detect the port being bound. You need to bind on all available network connections. See <a href=\"https://github.com/heroku/go-getting-started/blob/master/cmd/go-getting-started/main.go#L27\" rel=\"nofollow noreferrer\">github.com/heroku/go-getting-started/blob/master/cmd/&hellip;</a>"}, {"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "reply_to_user": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "edited": false, "score": 1, "creation_date": 1441897608, "post_id": 32463004, "comment_id": 52870248, "body": "@DamienMATHIEU That was exactly the case. Code had <code>http.ListenAndServe(&quot;127.0.0.1:&quot;+port, nil)</code> where it must be <code>http.ListenAndServe(&quot;:&quot;+port, nil)</code> please submit this as an answer."}, {"owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "reply_to_user": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "edited": false, "score": 1, "creation_date": 1443737550, "post_id": 32463004, "comment_id": 53624437, "body": "Funny how you get a down vote because when asking a beginner&#39;s question. I don&#39;t want to judge why people down vote well formatted questions like this regardless of it being stupid for their level. At least leave a comment with the reason for the down vote or edit the question."}, {"owner": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "edited": false, "score": 0, "creation_date": 1443771796, "post_id": 32463004, "comment_id": 53633659, "body": "I upvoted you to compensate :)"}], "answers": [{"tags": [], "owner": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "is_accepted": true, "score": 7, "last_activity_date": 1441899064, "creation_date": 1441899064, "answer_id": 32506028, "question_id": 32463004, "link": "https://stackoverflow.com/questions/32463004/heroku-go-app-crashing/32506028#32506028", "title": "Heroku Go app crashing", "body": "<p>Your app needs to listen to all network connections. If it only listens on localhost, heroku's process watcher will not be able to detect that you bound the port, nor send requests to your app.</p>\n\n<p>That means instead of:</p>\n\n<pre><code>http.ListenAndServe(\"127.0.0.1:\"+port, nil)\n</code></pre>\n\n<p>You need to call:</p>\n\n<pre><code>http.ListenAndServe(\":\"+port, nil)\n</code></pre>\n\n<p>See also the heroku getting started with Go app: <a href=\"https://github.com/heroku/go-getting-started/blob/master/cmd/go-getting-started/main.go#L27\" rel=\"noreferrer\">https://github.com/heroku/go-getting-started/blob/master/cmd/go-getting-started/main.go#L27</a></p>\n"}, {"tags": [], "owner": {"reputation": 1825, "user_id": 1523874, "user_type": "registered", "accept_rate": 9, "profile_image": "https://i.stack.imgur.com/K5KA4.jpg?s=128&g=1", "display_name": "Celik", "link": "https://stackoverflow.com/users/1523874/celik"}, "is_accepted": false, "score": 9, "last_activity_date": 1531612041, "creation_date": 1531612041, "answer_id": 51344239, "question_id": 32463004, "link": "https://stackoverflow.com/questions/32463004/heroku-go-app-crashing/51344239#51344239", "title": "Heroku Go app crashing", "body": "<p>When you deploy an app through <strong>heroku</strong>, it does <strong>not allow</strong> you to specify the <strong>port number</strong>.<br>\nIn other words, you can not specify your web service's <strong>port</strong> number as <strong>8000</strong> or something else, heroku decides the port number in runtime.<br>\nso, you can not use the following code:</p>\n\n<pre><code>    log.Fatal(http.ListenAndServe(\":8000\", router))\n</code></pre>\n\n<p>What you can do is, getting the runtime port of heroku.<br>\nIn short, <strong>just use the following code</strong>:</p>\n\n<pre><code>    log.Fatal(http.ListenAndServe(\":\" + os.Getenv(\"PORT\"), router))\n</code></pre>\n"}], "owner": {"reputation": 4382, "user_id": 2251437, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/9a594b33bf5eb20ec4e69b63f787e5c4?s=128&d=identicon&r=PG", "display_name": "sargas", "link": "https://stackoverflow.com/users/2251437/sargas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3243, "favorite_count": 0, "accepted_answer_id": 32506028, "answer_count": 2, "score": 6, "last_activity_date": 1531612041, "creation_date": 1441730398, "question_id": 32463004, "link": "https://stackoverflow.com/questions/32463004/heroku-go-app-crashing", "title": "Heroku Go app crashing", "body": "<p>Following <a href=\"http://codegangsta.gitbooks.io/building-web-apps-with-go/content/deployment/index.html\" rel=\"noreferrer\">this tutorial</a>, everything works locally. After I deploy my app to Heroku and visit the app on the browser I get a <em>503 Error</em> and the message:</p>\n\n<blockquote>\n  <p>Application Error\n  An error occurred in the application and your page could not be served. Please try again in a few moments.\n  If you are the application owner, check your logs for details.</p>\n</blockquote>\n\n<p>The logs say:</p>\n\n<pre><code>2015-09-08T16:31:53.976824+00:00 heroku[web.1]: State changed from crashed to starting\n2015-09-08T16:31:56.174376+00:00 heroku[web.1]: Starting process with command `mywebsite`\n2015-09-08T16:31:59.312461+00:00 app[web.1]: Listening on port: 39461\n2015-09-08T16:32:56.471550+00:00 heroku[web.1]: Error R10 (Boot timeout) -&gt; Web process failed to bind to $PORT within 60 seconds of launch\n2015-09-08T16:32:56.471550+00:00 heroku[web.1]: Stopping process with SIGKILL\n2015-09-08T16:32:57.390752+00:00 heroku[web.1]: Process exited with status 137\n2015-09-08T16:32:57.404208+00:00 heroku[web.1]: State changed from starting to crashed\n2015-09-08T16:32:57.645135+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET path=\"/\" host=boiling-eyrie-6897.herokuapp.com request_id=ec26... fwd=\"xx.xxx.xxx.xxx\" dyno= connect= service= status=503 bytes=\n2015-09-08T16:32:58.233774+00:00 heroku[router]: at=error code=H10 desc=\"App crashed\" method=GET path=\"/favicon.ico\" host=boiling-eyrie-6897.herokuapp.com request_id=ef40...fwd=\"xx.xxx.xxx.xxx\" dyno= connect= service= status=503 bytes=\n</code></pre>\n\n<p>I understand what the errors are, but how can such a tiny tutorial app be causing a boot timeout (R10)?</p>\n\n<p>How can I debug this better and fix the app so it runs?</p>\n"}, {"tags": ["unit-testing", "go", "tdd"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1441734794, "post_id": 32462023, "comment_id": 52790398, "body": "Unit tests <i>should</i> be deterministic, which is why the <code>-parallel</code> is an option you can use when needed explicitly. If a unit test is going to fail, it should fail every single time. You should definitely test for incorrect behavior when running parts of your code in parallel or in any order, just like you would any other error condition, but that doesn&#39;t belong in most people definition of unit tests."}, {"owner": {"reputation": 4513, "user_id": 605022, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/CRrSr.jpg?s=128&g=1", "display_name": "mdwhatcott", "link": "https://stackoverflow.com/users/605022/mdwhatcott"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441740089, "post_id": 32462023, "comment_id": 52793194, "body": "I agree, and I&#39;m hoping that I&#39;m not overlooking any obvious conflicting cases."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441805407, "post_id": 32462023, "comment_id": 52822646, "body": "Obvious conflicting cases of what exactly? You either write unit tests that can run in parallel, or you don&#39;t. It&#39;s completely up to you if you want to run your tests in parallel, but most people don&#39;t want that as a default, because unit tests should execute exactly the same every time."}], "answers": [{"comments": [{"owner": {"reputation": 4513, "user_id": 605022, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/CRrSr.jpg?s=128&g=1", "display_name": "mdwhatcott", "link": "https://stackoverflow.com/users/605022/mdwhatcott"}, "edited": false, "score": 0, "creation_date": 1441819041, "post_id": 32484077, "comment_id": 52832160, "body": "Ginkgo allows randomization. GoConvey almost had this feature too."}, {"owner": {"reputation": 4513, "user_id": 605022, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/CRrSr.jpg?s=128&g=1", "display_name": "mdwhatcott", "link": "https://stackoverflow.com/users/605022/mdwhatcott"}, "edited": false, "score": 0, "creation_date": 1441819077, "post_id": 32484077, "comment_id": 52832176, "body": "Randomized execution is still different than parallel execution."}], "tags": [], "owner": {"reputation": 15599, "user_id": 73831, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4813b578ef6e0ca5ba25a77f57fdb5f1?s=128&d=identicon&r=PG", "display_name": "Sudhir Jonathan", "link": "https://stackoverflow.com/users/73831/sudhir-jonathan"}, "is_accepted": false, "score": 1, "last_activity_date": 1441813744, "creation_date": 1441813744, "answer_id": 32484077, "question_id": 32462023, "link": "https://stackoverflow.com/questions/32462023/can-true-unit-tests-always-be-run-in-parallel/32484077#32484077", "title": "Can true unit tests always be run in parallel?", "body": "<p>The <code>parallel</code> flag is actually a way to test the tests themselves (besides speeding them up). Finding a test breaks randomly when run in non deterministic order indicates a bad test as often as it does bad code. </p>\n\n<p>Ruby's test runners do something interesting (both Rspec and Minitest) - they randomize the test order on each run, but print an integer seed that was used for the run. This allows the error to be reproduced while still making sure that no tests depend on implicit ordering. I don't know of any Go test runner doing this, but that would be quite useful.</p>\n"}], "owner": {"reputation": 4513, "user_id": 605022, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/CRrSr.jpg?s=128&g=1", "display_name": "mdwhatcott", "link": "https://stackoverflow.com/users/605022/mdwhatcott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1441813744, "creation_date": 1441727096, "question_id": 32462023, "link": "https://stackoverflow.com/questions/32462023/can-true-unit-tests-always-be-run-in-parallel", "title": "Can true unit tests always be run in parallel?", "body": "<h2>Background:</h2>\n\n<p>I'm writing a lot of go code, using the <code>go test</code> tool and the provided <code>\"testing\"</code> package for, well, testing. Most of the testing that I do is unit testing, within the TDD discipline. These \"units\" under test are never permitted to depend on stateful externalities like persistent storage, a network hop, etc., but receive fake, in-memory implementations of those externalities usually in \"constructor/builder\" functions (yes, I know they aren't constructors in the traditional sense).</p>\n\n<h2>The Problem:</h2>\n\n<p>It has long bothered me that the <code>go test</code> tool always runs test functions in the same deterministic order. This has, in a few cases, allowed race conditions to hide in the code. One way to find these bugs is by setting the <code>-race</code> flag. Another might be to always run unit tests in parallel...</p>\n\n<h2>The Question:</h2>\n\n<p>Is there <em>ever</em> a situation in which <em>isolated</em> unit tests could not or should not <em>always</em> be run in parallel (using the <code>-parallel</code> flag)?</p>\n"}, {"tags": ["tcp", "go", "connection"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1441726695, "creation_date": 1441726695, "answer_id": 32461877, "question_id": 32460618, "link": "https://stackoverflow.com/questions/32460618/golang-1-5-io-copy-blocked-with-two-tcpconn/32461877#32461877", "title": "Golang 1.5 io.Copy blocked with two TCPConn", "body": "<p>Previously, you were getting lucky when the timing of the syscalls would cause a write error in your second <code>io.Copy</code> [line 41]. (Ignoring errors tends to hide bugs)</p>\n\n<p>This was purely by accident (and may even be incorrect). Since the source connection of that copy (<code>conn2</code>) is never closed, the <code>io.Copy</code> never receives an <code>io.EOF</code> and doesn't return. You need to close the opposing connection in each of the copy goroutines to unblock the other's call to <code>io.Copy</code>. </p>\n\n<pre><code>wg.Add(1)\ngo func() {\n    io.Copy(conn1, conn2)\n    // conn2 has returned EOF or an error, so we need to shut down the\n    // other half of the duplex copy.\n    conn1.Close()\n    wg.Done()\n}()\n\nwg.Add(1)\ngo func() {\n    io.Copy(conn2, conn1)\n    conn2.Close()\n    wg.Done()\n}()\n</code></pre>\n"}], "owner": {"reputation": 445, "user_id": 4265763, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_XuweyYACIs/AAAAAAAAAAI/AAAAAAAAAEI/OvebLDs1Rlo/photo.jpg?sz=128", "display_name": "Sirui Zhuang", "link": "https://stackoverflow.com/users/4265763/sirui-zhuang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1539, "favorite_count": 0, "accepted_answer_id": 32461877, "answer_count": 1, "score": 1, "last_activity_date": 1441726695, "creation_date": 1441723084, "question_id": 32460618, "link": "https://stackoverflow.com/questions/32460618/golang-1-5-io-copy-blocked-with-two-tcpconn", "title": "Golang 1.5 io.Copy blocked with two TCPConn", "body": "<p><a href=\"http://play.golang.org/p/gZo5RqgY4F\" rel=\"nofollow\">http://play.golang.org/p/gZo5RqgY4F</a></p>\n\n<p>I have a question with <code>io.Copy</code> method. The link above will block in line 44 under Go 1.5. But will pass in 1.4.2. I have no idea with this issue.</p>\n\n<p>Here is my go version: <code>go version go 1.5 darwin/amd64</code>.</p>\n\n<p>When did the <code>io.Copy</code> return in go 1.5?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1449055207, "last_edit_date": 1495541617, "creation_date": 1441720980, "answer_id": 32459898, "question_id": 32457629, "link": "https://stackoverflow.com/questions/32457629/how-do-i-remove-a-field-from-a-model-in-google-app-engine-with-go/32459898#32459898", "title": "How do I remove a field from a model in Google App Engine with Go?", "body": "<p>In order to remove a property from a saved entity, you have to load it first, and save it again with the same key but without the property you want to remove. If you want to remove a property from all saved entities (of a kind), you have to load and save each one-by-one. (Of course you may use other means like <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference?#Query\" rel=\"nofollow noreferrer\"><code>Query</code></a>'s and <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference?#PutMulti\" rel=\"nofollow noreferrer\"><code>datastore.PutMulti()</code></a> to query and save multiple entities.)</p>\n\n<p>You can remove a property from a saved entity in basically 2 ways:</p>\n\n<h3>Using 2 structs:</h3>\n\n<p>You can use 2 structs: your <em>old</em> model and the <em>new</em> model (without the property you want to remove):</p>\n\n<pre><code>type Old struct {\n    Name     string `datastore:\"name\"`\n    Removeme string `datastore:\"removeme\"`\n}\n\ntype New struct {\n    Name     string `datastore:\"name\"`\n}\n</code></pre>\n\n<p>And load the entity and re-save it (with the same key):</p>\n\n<pre><code>c := appengine.NewContext(r)\n// Constructing the key, for example:\nk := datastore.NewKey(c, \"Entity\", \"stringID\", 0, nil)\n\ne := new(Old)\nif err = datastore.Get(c, key, e); err != nil {\n    // Datastore error.\n    return\n}\n\ne2 := New{e.Name}\nif _, err = datastore.Put(c, k, &amp;e2); err != nil {\n    // Datastore error\n}\n</code></pre>\n\n<h3>Using <code>PropertyList</code></h3>\n\n<p>Or you can use the <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference?#PropertyList\" rel=\"nofollow noreferrer\"><code>datastore.PropertyList</code></a> to load any entity into it.</p>\n\n<p>It's basically just a slice of <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference?#Property\" rel=\"nofollow noreferrer\"><code>Property</code></a>'s:</p>\n\n<pre><code>type PropertyList []Property\n</code></pre>\n\n<p>Remove the property (or properties) you want to delete from this slice, and re-save it with the same key.</p>\n\n<p>Basically the steps are the same: load an entity with a key, remove unwanted properties, and resave it (with the same key).</p>\n\n<p><strong>Remove an element from a slice:</strong></p>\n\n<p>To delete the element from slice <code>a</code> at index <code>i</code>:</p>\n\n<pre><code>a = append(a[:i], a[i+1:]...)\n// or\na = a[:i+copy(a[i:], a[i+1:])]\n</code></pre>\n\n<p>So basically it looks something like this:</p>\n\n<pre><code>c := appengine.NewContext(r)\n// Constructing the key, for example:\nk := datastore.NewKey(c, \"Entity\", \"stringID\", 0, nil)\n\ne := datastore.PropertyList{}\nif err = datastore.Get(c, key, &amp;e); err != nil {\n    // Datastore error.\n    return\n}\n\n// Loop over the properties to find the one we want to remove:\nfor i, v := range e {\n    if v.Name == \"removeme\" {\n        // Found it!\n        e = append(e[:i], e[i+1:]...)\n        break\n    }\n}\n\nif _, err = datastore.Put(c, k, &amp;e); err != nil {\n    // Datastore error\n}\n</code></pre>\n\n<p><strong>Note:</strong> Be careful when removing multiple elements from a slice using <code>for range</code>. Result might be unexpected as when you remove an element, all subsequent elements are shifted and you may skip an element. For details see <a href=\"https://stackoverflow.com/a/28699587/1705598\">this answer</a>.</p>\n"}], "owner": {"reputation": 538, "user_id": 989227, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e564869f8fdf3ef2c3920cc113423b?s=128&d=identicon&r=PG", "display_name": "santiaago", "link": "https://stackoverflow.com/users/989227/santiaago"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 0, "accepted_answer_id": 32459898, "answer_count": 1, "score": 2, "last_activity_date": 1471402039, "creation_date": 1441714651, "last_edit_date": 1471402039, "question_id": 32457629, "link": "https://stackoverflow.com/questions/32457629/how-do-i-remove-a-field-from-a-model-in-google-app-engine-with-go", "title": "How do I remove a field from a model in Google App Engine with Go?", "body": "<p>What is the Go equivalent of Python <code>delattr</code> or Java: <code>Entity.removeProperty</code>?</p>\n\n<p>I am trying to remove a property from the datastore as described here:\n<a href=\"https://cloud.google.com/appengine/articles/update_schema#removing-deleted-properties-from-the-datastore\" rel=\"nofollow\">removing deleted properties from the datastore</a></p>\n"}, {"tags": ["http", "go", "request", "response"], "answers": [{"comments": [{"owner": {"reputation": 1685, "user_id": 1291512, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QFnuz.jpg?s=128&g=1", "display_name": "WhiteAngel", "link": "https://stackoverflow.com/users/1291512/whiteangel"}, "edited": false, "score": 0, "creation_date": 1441707279, "post_id": 32454800, "comment_id": 52772201, "body": "Great! Thank you, Elwinar. It looks correct, I will give it a try and let you know."}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1441708654, "post_id": 32454800, "comment_id": 52773117, "body": "Actually <code>switch v := in.(type)</code> is correct (it&#39;s in the documentation <a href=\"https://golang.org/doc/effective_go.html#type_switch\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#type_switch</a>)."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 1, "creation_date": 1441709041, "post_id": 32454800, "comment_id": 52773369, "body": "My bad. Note that the root cause and the answer are still the same\u2026 but the syntaxic suger is quite useful (and more readable)."}], "tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": false, "score": 0, "last_activity_date": 1441709102, "last_edit_date": 1441709102, "creation_date": 1441706447, "answer_id": 32454800, "question_id": 32454490, "link": "https://stackoverflow.com/questions/32454490/convert-interface-parameter-into-http-request-or-http-response-in-go/32454800#32454800", "title": "Convert interface{} parameter into *http.Request or *http.Response in Go", "body": "<p>What you are trying to do is more something like that:</p>\n\n<pre><code>switch in.(type) {\n    case *http.Request:\n        body = v.(*http.Request).Body\n    case *http.Response:\n        body = v.(*http.Response).Body\n    default:\n        log.Fatal(...)\n}\n</code></pre>\n\n<p>EDIT: I removed the wrong part of my answer, see HectorJ's answer for the more syntaxic please way of doing this.</p>\n"}, {"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": false, "score": 4, "last_activity_date": 1441728244, "last_edit_date": 1441728244, "creation_date": 1441708183, "answer_id": 32455382, "question_id": 32454490, "link": "https://stackoverflow.com/questions/32454490/convert-interface-parameter-into-http-request-or-http-response-in-go/32455382#32455382", "title": "Convert interface{} parameter into *http.Request or *http.Response in Go", "body": "<p>It is because of the double <code>case</code>.</p>\n\n<p><code>v</code> is still an <code>interface{}</code> because it could be either an <code>*http.Request</code> or an <code>*http.Response</code></p>\n\n<pre><code>switch v := in.(type) {\n    case *http.Request\n        body = v.Body\n        statusCode = v.StatusCode\n    case *http.Response:\n        body = v.Body\n        statusCode = v.StatusCode\n    default:\n        log.Fatal(\"Only http.Request and http.Response parameters can be accepted to parse body\")\n}\n</code></pre>\n\n<p>This should work</p>\n"}, {"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1441739964, "last_edit_date": 1441739964, "creation_date": 1441739648, "answer_id": 32465511, "question_id": 32454490, "link": "https://stackoverflow.com/questions/32454490/convert-interface-parameter-into-http-request-or-http-response-in-go/32465511#32465511", "title": "Convert interface{} parameter into *http.Request or *http.Response in Go", "body": "<p>In addition to the other answers which directly address the issue with your type switch, I'd like to point out an alternative solution.\nNote, the <code>interface{}</code> solution is perfectly fine and may easily be considered preferable to this. This is presented for edification.</p>\n\n<p>First, as a slight aside, if the thing you were interested in was a common method (e.g.\u00a0<code>Write</code> or <code>Cookies</code>) rather than a common field (<code>Body</code>), it would be easy and better to access it via a custom interface.</p>\n\n<p>Either by defining a type:</p>\n\n<pre><code>type cookier interface { // Should probably use a better name\n    Cookies() []*http.Cookie\n}  \nfunc ShowCookies1(r cookier) {\n    log.Println(\"Got cookies:\", r.Cookies())\n}\n</code></pre>\n\n<p>Or by using an anonymous type in the function definition:</p>\n\n<pre><code>func ShowCookies2(r interface {\n    Cookies() []*http.Cookie\n}) {\n    log.Println(\"Got cookies:\", r.Cookies())\n}\n</code></pre>\n\n<p>These functions can accept anything that has a <code>Cookies</code> method, this includes <code>*http.Request</code> and <code>*http.Response</code>.</p>\n\n<p>Unfortunately, in your particular case you wish to access a common field rather than a common method so you can't directly just use a matching interface.</p>\n\n<p>You could make a small wrapper type that adds a <code>GetBody</code> method (one could argue such a function should have been defined in the standard package).</p>\n\n<pre><code>type reqbody struct{ *http.Request }\ntype respbody struct{ *http.Response }\ntype getbody interface {\n    GetBody() io.ReadCloser\n}\n\nfunc (r reqbody) GetBody() io.ReadCloser  { return r.Body }\nfunc (r respbody) GetBody() io.ReadCloser { return r.Body }\n\nfunc GetBody2(r getbody) ([]byte, error) {\n    body := r.GetBody()\n    defer body.Close()\n    return ioutil.ReadAll(body)\n}\n</code></pre>\n\n<p>The caller knows what type they have and does one of:</p>\n\n<pre><code>    buf, err = GetBody2(reqbody{req})\n    buf, err = GetBody2(respbody{resp})\n</code></pre>\n\n<p>In some sense this is uglier than just using <code>interface{}</code>.\nBut it has the benefit that instead of having a function that takes absolutely any type and panics/errors <strong>at run-time</strong> if a programmer mistakenly calls it with something not of the appropriate type,\nthis instead forces the caller to safely pass something you known is of the correct type <strong>at compile time</strong>.</p>\n\n<p>Looking at this further, you're just reading everything from an <code>io.ReadCloser</code> and then closing it so it could further be simplified to the following\n(which probably <em>is</em> better than your <code>interface{}</code> solution):</p>\n\n<pre><code>func GetReqBody(r *http.Request) io.ReadCloser   { return r.Body }\n// Could add checking r.StatusCode to the following one as well:\nfunc GetRespBody(r *http.Response) io.ReadCloser { return r.Body }\nfunc ReadAndClose(rc io.ReadCloser) ([]byte, error) {\n    defer rc.Close()\n    return ioutil.ReadAll(rc)\n}\n</code></pre>\n\n<p>Again, the caller knows what type they have and does one of:</p>\n\n<pre><code>    buf, err = ReadAndClose(GetReqBody(req))\n    buf, err = ReadAndClose(GetRespBody(resp))\n</code></pre>\n\n<p>Or just:</p>\n\n<pre><code>    buf, err = ReadAndClose(req.Body)\n    buf, err = ReadAndClose(resp.Body)\n</code></pre>\n\n<p>You can see an example of all these options on the <a href=\"https://play.golang.org/p/IvYcBzyxBW\" rel=\"nofollow\">Go Playground</a>.</p>\n\n<p>Finally, be careful using <code>ioutil.ReadAll</code>.\nOften it is better to avoid pre-reading an entire file or network steam into a buffer and instead process it as a stream as it is being read.\nIn particular, it's trivial to make an HTTP request with an arbitrary large body as a denial of service attack or to waste server resources\n(<a href=\"https://golang.org/pkg/net/http/#MaxBytesReader\" rel=\"nofollow\"><code>http.MaxBytesReader</code></a> can also help).</p>\n"}], "owner": {"reputation": 1685, "user_id": 1291512, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QFnuz.jpg?s=128&g=1", "display_name": "WhiteAngel", "link": "https://stackoverflow.com/users/1291512/whiteangel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1138, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1441739964, "creation_date": 1441705618, "question_id": 32454490, "link": "https://stackoverflow.com/questions/32454490/convert-interface-parameter-into-http-request-or-http-response-in-go", "title": "Convert interface{} parameter into *http.Request or *http.Response in Go", "body": "<p>I'm tying to create an util function that will read body of the Request/Response and return it.<br>\nHere's what I've done for the moment:</p>\n\n<pre><code>func GetBody(in interface{}) []byte {\n    var body io.Reader\n    var statusCode int\n\n    switch v := in.(type) {\n        case *http.Request, *http.Response:\n            body = v.Body\n            statusCode = v.StatusCode\n        default:\n            log.Fatal(\"Only http.Request and http.Response parameters can be accepted to parse body\")\n    }\n\n    if statusCode != 200 {\n        log.Fatalf(\"Received status code [%d] instead of [200]\", statusCode)\n    }\n\n    body, err := ioutil.ReadAll(body)\n    if err != nil {\n        log.Fatal(err)\n    }\n    return body\n}\n</code></pre>\n\n<p>But I'm receiving an error of compiler: <code>v.Body undefined (type interface {} is interface with no methods)</code><br>\nAm I missing something or it's impossible to make a generic function that will server both for <code>*http.Request</code> and <code>*http.Response</code></p>\n"}, {"tags": ["http", "curl", "go", "header"], "answers": [{"tags": [], "owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "is_accepted": true, "score": 6, "last_activity_date": 1441705171, "creation_date": 1441705171, "answer_id": 32454302, "question_id": 32454079, "link": "https://stackoverflow.com/questions/32454079/golang-why-does-response-getheaderkey-not-return-a-value-in-this-code/32454302#32454302", "title": "Golang: Why does response.Get(&quot;headerkey&quot;) not return a value in this code?", "body": "<p>This line:</p>\n\n<pre><code>        r.Header.Set(\"Authorization\", \"responseAuthVal\")\n</code></pre>\n\n<p>set the value of <code>r *http.Request</code>, that is the incomming request, while you want to set the value of <code>w http.ResponseWriter</code>, the response that you will receive.</p>\n\n<p>The said line should be</p>\n\n<pre><code>        w.Header().Set(\"Authorization\", \"responseAuthVal\")\n</code></pre>\n\n<p>See <a href=\"http://play.golang.org/p/yuX50FEilG\">this</a> playgroud.</p>\n"}], "owner": {"reputation": 1973, "user_id": 2056426, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/Ge8I5.png?s=128&g=1", "display_name": "delos", "link": "https://stackoverflow.com/users/2056426/delos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 0, "accepted_answer_id": 32454302, "answer_count": 1, "score": 0, "last_activity_date": 1441705171, "creation_date": 1441704512, "question_id": 32454079, "link": "https://stackoverflow.com/questions/32454079/golang-why-does-response-getheaderkey-not-return-a-value-in-this-code", "title": "Golang: Why does response.Get(&quot;headerkey&quot;) not return a value in this code?", "body": "<p>This has been bothering me for the past couple hours, I'm trying to get a response header value. Simple stuff. If I <code>curl</code> a request to this running server, I see the header set, with curl's <code>-v</code> flag, but when I try to retrieve the header using Go's <code>response.Header.Get()</code>, it shows a blank string <code>\"\"</code>, with the header's length being 0.</p>\n\n<p>What frustrates me even more, is that the header value is actually set within the response when I print out the body (as demonstrated below).</p>\n\n<p>Any and all help with this is appreciated, thanks in advance.</p>\n\n<p>I have this code here:\n<a href=\"http://play.golang.org/p/JaYTfVoDsq\" rel=\"nofollow\">http://play.golang.org/p/JaYTfVoDsq</a></p>\n\n<p>Which contains the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"net/http/httptest\"\n)\n\nfunc main() {\n    mux := http.NewServeMux()\n    server := httptest.NewServer(mux)\n    defer server.Close()\n\n    mux.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        r.Header.Set(\"Authorization\", \"responseAuthVal\")\n        fmt.Fprintln(w, r.Header)\n    })\n\n    req, _ := http.NewRequest(\"GET\", server.URL, nil)\n    res, _:= http.DefaultClient.Do(req)\n\n    headerVal := res.Header.Get(\"Authorization\")\n\n    fmt.Printf(\"auth header=%s, with length=%d\\n\", headerVal, len(headerVal))\n    content, _ := ioutil.ReadAll(res.Body)\n\n    fmt.Printf(\"res.Body=%s\", content)\n    res.Body.Close()\n}\n</code></pre>\n\n<p>The output to this running code is:</p>\n\n<pre><code>auth header=, with length=0\nres.Body=map[Authorization:[responseAuthVal] User-Agent:[Go-http-client/1.1] Accept-Encoding:[gzip]]\n</code></pre>\n"}, {"tags": ["json", "string", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 14632, "user_id": 428260, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/Jr7uO.png?s=128&g=1", "display_name": "iltempo", "link": "https://stackoverflow.com/users/428260/iltempo"}, "edited": false, "score": 0, "creation_date": 1446735601, "post_id": 32453410, "comment_id": 54875282, "body": "I had a similar issue noticing afterwards that my document was encoded using UTF-16."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 3378485, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc8c9cfc487a444c5215f8af2fb2fd5d?s=128&d=identicon&r=PG&f=1", "display_name": "bikbah", "link": "https://stackoverflow.com/users/3378485/bikbah"}, "is_accepted": false, "score": 0, "last_activity_date": 1441704215, "creation_date": 1441704215, "answer_id": 32453965, "question_id": 32453410, "link": "https://stackoverflow.com/questions/32453410/go-json-unmarshal-key-with-u0000-x00/32453965#32453965", "title": "Go json.Unmarshal key with \\u0000 \\x00", "body": "<p>You cannot do in such way due to: <a href=\"http://golang.org/ref/spec#Struct_types\" rel=\"nofollow\">http://golang.org/ref/spec#Struct_types</a></p>\n\n<p>But You can unmarshal to <code>map[string]interface{}</code> then check field names of that object through <a href=\"http://godoc.org/regexp\" rel=\"nofollow\">regexp</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 0, "last_activity_date": 1441704514, "creation_date": 1441704514, "answer_id": 32454083, "question_id": 32453410, "link": "https://stackoverflow.com/questions/32453410/go-json-unmarshal-key-with-u0000-x00/32454083#32454083", "title": "Go json.Unmarshal key with \\u0000 \\x00", "body": "<p>I don't think this is possible with struct tags. The best thing you can do is unmarshal it into <code>map[string]interface{}</code> and then get the values manually:</p>\n\n<pre><code>var b = []byte(`{\"\\u0000abc\":42}`)\nvar m map[string]interface{}\nerr := json.Unmarshal(b, &amp;m)\nif err != nil {\n    panic(err)\n}\nfmt.Println(m, m[\"\\x00abc\"])\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/RtS7Nst0d7\" rel=\"nofollow\">http://play.golang.org/p/RtS7Nst0d7</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 4, "creation_date": 1441721724, "post_id": 32457688, "comment_id": 52782316, "body": "Brilliant investigation!"}, {"owner": {"reputation": 436, "user_id": 478309, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0e42cd135cba45a460dbad590bf110a8?s=128&d=identicon&r=PG", "display_name": "Lei Cao", "link": "https://stackoverflow.com/users/478309/lei-cao"}, "edited": false, "score": 0, "creation_date": 1441766968, "post_id": 32457688, "comment_id": 52802075, "body": "Now I am just filtering out the key and fighting against the ugly keys as you said. Thank you very much :D"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1475355461, "last_edit_date": 1495535266, "creation_date": 1441714807, "answer_id": 32457688, "question_id": 32453410, "link": "https://stackoverflow.com/questions/32453410/go-json-unmarshal-key-with-u0000-x00/32457688#32457688", "title": "Go json.Unmarshal key with \\u0000 \\x00", "body": "<p><strong>Short answer:</strong> With the current <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>json</code></a> implementation it is not possible using only <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">struct tags</a>.</p>\n\n<p><strong>Note:</strong> It's an <em>implementation</em> restriction, not a <em>specification</em> restriction. (It's the restriction of the <code>json</code> package implementation, not the restriction of the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">struct tags specification</a>.)</p>\n\n<hr>\n\n<p>Some background: you specified your tags with a <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">raw string literal</a>:</p>\n\n<blockquote>\n  <p>The value of a raw string literal is the string composed of the uninterpreted (implicitly UTF-8-encoded) characters between the quotes...</p>\n</blockquote>\n\n<p>So no unescaping or unquoting happens in the content of the raw string literal <em>by the compiler</em>.</p>\n\n<p>The convention for struct tag values quoted from <a href=\"http://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow noreferrer\"><code>reflect.StructTag</code></a>:</p>\n\n<blockquote>\n  <p>By convention, tag strings are a concatenation of optionally space-separated key:\"value\" pairs. Each key is a non-empty string consisting of non-control characters other than space (U+0020 ' '), quote (U+0022 '\"'), and colon (U+003A ':'). Each value is quoted using U+0022 '\"' characters and Go string literal syntax.</p>\n</blockquote>\n\n<p>What this means is that by convention tag values are a list of (key:\"value\") pairs separated by spaces. There are quite a few restrictions for keys, but values may be anything, and values (should) use \"Go string literal syntax\", this means that these <strong>values will be unquoted at runtime from code</strong> (by a call to <a href=\"https://golang.org/pkg/strconv/#Unquote\" rel=\"nofollow noreferrer\"><code>strconv.Unquote()</code></a>, called <a href=\"https://golang.org/pkg/reflect/#StructTag.Get\" rel=\"nofollow noreferrer\"><code>from StructTag.Get()</code></a>, in source file <a href=\"https://golang.org/src/reflect/type.go\" rel=\"nofollow noreferrer\"><code>reflect/type.go</code></a>, currently line #809).</p>\n\n<p>So no need for double quoting. See your simplified example:</p>\n\n<pre><code>type Response1 struct {\n    Page   int\n    Fruits []string\n    Msg    interface{} `json:\"\\u0000_abc\"`\n}\n</code></pre>\n\n<p>Now the following code:</p>\n\n<pre><code>t := reflect.TypeOf(Response1{})\nfmt.Printf(\"%#v\\n\", t.Field(2).Tag)\nfmt.Printf(\"%#v\\n\", t.Field(2).Tag.Get(\"json\"))\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>\"json:\\\"\\\\u0000_abc\\\"\"\n\"\\x00_abc\"\n</code></pre>\n\n<p>As you can see, the value part for the <code>json</code> key is <code>\"\\x00_abc\"</code> so it properly contains the zero character.</p>\n\n<p><strong>But how will the <code>json</code> package use this?</strong></p>\n\n<p>The <code>json</code> package uses the value returned by <a href=\"https://golang.org/pkg/reflect/#StructTag.Get\" rel=\"nofollow noreferrer\"><code>StructTag.Get()</code></a> (from the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\"><code>reflect</code></a> package), exactly what we did. You can see it in the <a href=\"http://golang.org/src/encoding/json/encode.go\" rel=\"nofollow noreferrer\"><code>json/encode.go</code></a> source file, <code>typeFields()</code> function, currently line #1032. So far so good.</p>\n\n<p>Then it calls the unexported <code>json.parseTag()</code> function, in <a href=\"http://golang.org/src/encoding/json/tags.go\" rel=\"nofollow noreferrer\"><code>json/tags.go</code></a> source file, currently line #17. This cuts the part after the comma (which becomes the \"tag options\").</p>\n\n<p>And finally <code>json.isValidTag()</code> function is called with the previous value, in source file <a href=\"http://golang.org/src/encoding/json/encode.go\" rel=\"nofollow noreferrer\"><code>json/encode.go</code></a>, currently line #731. This function checks the runes of the passed <code>string</code>, and (besides a set of pre-defined allowed characters <code>\"!#$%&amp;()*+-./:&lt;=&gt;?@[]^_{|}~ \"</code>) rejects everything that is not a unicode letter or digit (as defined by <a href=\"https://golang.org/pkg/unicode/#IsLetter\" rel=\"nofollow noreferrer\"><code>unicode.IsLetter()</code></a> and <a href=\"https://golang.org/pkg/unicode/#IsDigit\" rel=\"nofollow noreferrer\"><code>unicode.IsDigit()</code></a>):</p>\n\n<pre><code>if !unicode.IsLetter(c) &amp;&amp; !unicode.IsDigit(c) {\n    return false\n} \n</code></pre>\n\n<p><code>'\\u0000'</code> is not part of the pre-defined allowed characters, and as you can guess now, it is neither a letter nor a digit:</p>\n\n<pre><code>// Following code prints \"INVALID\":\nc := '\\u0000'\nif !unicode.IsLetter(c) &amp;&amp; !unicode.IsDigit(c) {\n    fmt.Println(\"INVALID\")\n}\n</code></pre>\n\n<p>And since <code>isValidTag()</code> returns <code>false</code>, the <code>name</code> (which is the value for the <code>json</code> key, without the \"tag options\" part) will be discarded (<code>name = \"\"</code>) and not used. So no match will be found for the struct field containing a unicode zero.</p>\n\n<p>For an alternative solution use a <code>map</code>, or a custom <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unmarshaler</code></a> or use <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\"><code>json.RawMessage</code></a>.</p>\n\n<p>But I would highly discourage using such ugly json keys. I understand likely you are just trying to parse such json response and it may be out of your reach, but you should fight against using these keys as they will just cause more problems later on (e.g. if stored in db, by inspecting records it will be very hard to spot that there are <code>'\\u0000'</code> characters in them as they may be displayed as nothing).</p>\n"}], "owner": {"reputation": 436, "user_id": 478309, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0e42cd135cba45a460dbad590bf110a8?s=128&d=identicon&r=PG", "display_name": "Lei Cao", "link": "https://stackoverflow.com/users/478309/lei-cao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2714, "favorite_count": 0, "accepted_answer_id": 32457688, "answer_count": 3, "score": 5, "last_activity_date": 1475355484, "creation_date": 1441702599, "last_edit_date": 1475355484, "question_id": 32453410, "link": "https://stackoverflow.com/questions/32453410/go-json-unmarshal-key-with-u0000-x00", "title": "Go json.Unmarshal key with \\u0000 \\x00", "body": "<p>Here is the Go <a href=\"http://play.golang.org/p/l37vSRjIhn\" rel=\"nofollow\">playground</a> link.</p>\n\n<p>Basically there are some special characters (<code>'\\u0000'</code>) in my JSON string key:</p>\n\n<pre><code>var j = []byte(`{\"Page\":1,\"Fruits\":[\"5\",\"6\"],\"\\u0000*\\u0000_errorMessages\":{\"x\":\"123\"},\"*_successMessages\":{\"ok\":\"hi\"}}`)\n</code></pre>\n\n<p>I want to Unmarshal it into a struct:</p>\n\n<pre><code>type Response1 struct {\n    Page   int\n    Fruits []string\n    Msg    interface{} `json:\"*_errorMessages\"`\n    Msg1   interface{} `json:\"\\\\u0000*\\\\u0000_errorMessages\"`\n    Msg2   interface{} `json:\"\\u0000*\\u0000_errorMessages\"`\n    Msg3   interface{} `json:\"\\0*\\0_errorMessages\"`\n    Msg4   interface{} `json:\"\\\\0*\\\\0_errorMessages\"`\n    Msg5   interface{} `json:\"\\x00*\\x00_errorMessages\"`\n    Msg6   interface{} `json:\"\\\\x00*\\\\x00_errorMessages\"`\n    SMsg   interface{} `json:\"*_successMessages\"`\n}\n</code></pre>\n\n<p>I tried a lot but it's not working. \nThis link might help <a href=\"https://golang.org/src/encoding/json/encode_test.go\" rel=\"nofollow\">golang.org/src/encoding/json/encode_test.go</a>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 1, "creation_date": 1441700640, "post_id": 32452610, "comment_id": 52767943, "body": "I think you misunderstand how the golang scheduler works (and are confused about blocking and non-blocking calls). <a href=\"https://morsmachine.dk/go-scheduler\" rel=\"nofollow noreferrer\">This article</a> is a bit old (especially since go1.5), but it explain the basics of the scheduler quite clearly."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1441701362, "post_id": 32452610, "comment_id": 52768427, "body": "Go does let you control the threads a bit through the <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\"><code>runtime</code></a> package"}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1441701743, "post_id": 32452610, "comment_id": 52768638, "body": "@Elwinar, you misunderstand my point. Note that I refer to block device io and cpu sensitive task. The user-space scheduling relies on the fact that the tasks are non-blocking, e.g. socket and multiplexing via OS specific mechanism, e.g. epoll. That is, the schedule switch between goroutines only happens at the EAGAIN/EWOULDBLOCK syscall return or goroutine explicit yield. But it could not break the blocking syscall. However, the OS kernel could do it, for example, when you copy 1GB file, the linux kernel would invoke cond_resched() at each PAGE-size write iteration to give up the CPU."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1441701972, "post_id": 32452610, "comment_id": 52768794, "body": "From what I know, routines that do filesystem operation are handled by the scheduler and waked when their operation is ready, much like routines that do network operations."}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1441702400, "post_id": 32452610, "comment_id": 52769036, "body": "@Elwinar, when the syscall enters, e.g. write() 1GB buffer into file, you have no way to break it until it returns, and that&#39;s what I means &quot;blocking&quot;. For example, the write() consumes 60s to complete, and during that 60s period, the OS thread chosen by golang (one of the threads specified by GOMAXPROCS) could not do scheduling. However, in socket case, if you write() 1GB buffer to the peer, if the buffer is not enough, or the peer is slow receiving, or the network is in congestion, the write() would returns with EWOULDBLOCK error, then the scheduler would run next ready goroutine."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1441702594, "post_id": 32452610, "comment_id": 52769160, "body": "Whitout being an expert on the matter, I think the same process is (somewhat) happening with the block devices. That&#39;s why there is so many caches between CPU and HDD, and why doing benchmarks that involve writing to files is a hassle."}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1441702979, "post_id": 32452610, "comment_id": 52769384, "body": "@Elwinar, besides the hardware caches, the linux page cache layer also boost the block deivce io, but I&#39;m worrying about the high-load cases, where the caches could not help. And don&#39;t forget the CPU-bound tasks, e.g. file compression, ssl handshake, etc. For those pure CPU consuming tasks, the OS threading is the only way to enable scheduling among the tasks, because only the OS kernel could interleave the time slots between the tasks."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 1, "creation_date": 1441703720, "post_id": 32452610, "comment_id": 52769850, "body": "For this kind of tasks, there is a <a href=\"https://golang.org/pkg/runtime/#Gosched\" rel=\"nofollow noreferrer\">runtime.Gosched()</a> function that seems to be used to yield manually to the scheduler."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 1, "creation_date": 1441703956, "post_id": 32452610, "comment_id": 52769999, "body": "Additionnally, starting from go1.2, there is a <a href=\"http://golang.org/doc/go1.2#preemption\" rel=\"nofollow noreferrer\">random pre-emption</a> on function call. That is, each call to a function may yield to the scheduler."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441703968, "post_id": 32452610, "comment_id": 52770008, "body": "why you say goroutine is  <code>synchronous</code>? multiple goroutines may be running at sametime."}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1441704593, "post_id": 32452610, "comment_id": 52770361, "body": "@Elwinar, Gosched() is what I means &quot;yield&quot;, of course I know that function. See my post content, I said manual scheduling by splitting the task could help, but I also doubt it&#39;s not convenient and precise. And the random preemption is related to looping only, but I concern about time-consuming and not-interrupted syscall invocation."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441704832, "post_id": 32452610, "comment_id": 52770504, "body": "good discusses about this here: <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/Luje-okL4jI\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/Luje-okL4jI</a>"}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441704970, "post_id": 32452610, "comment_id": 52770596, "body": "@JiangYD, &quot;synchronous&quot; means the opposite to asynchronous callback way, like nodejs. Of course I know goroutine is concurrent and even parallel in multiple CPU-core machines."}, {"owner": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1441705492, "post_id": 32452610, "comment_id": 52770950, "body": "From what I know, there is no way to &quot;split&quot; a syscall. You could try to use the <a href=\"https://golang.org/pkg/runtime/#LockOSThread\" rel=\"nofollow noreferrer\">runtime.LockOSThread</a> function so the routine is alone on its thread and the OS scheduler can do its job."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441705773, "post_id": 32452610, "comment_id": 52771140, "body": "@kingluo <code>asynchronous callback way</code> is saying a way to get function return value, but goroutine can not return a value in function level. so I think we can not say goroutine is synchronous."}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 7802, "user_id": 3472656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Sg0vU.jpg?s=128&g=1", "display_name": "Elwinar", "link": "https://stackoverflow.com/users/3472656/elwinar"}, "edited": false, "score": 0, "creation_date": 1441706063, "post_id": 32452610, "comment_id": 52771343, "body": "@Elwinar, so that&#39;s why I mention OS threading, only the OS kernel could split the syscall or long CPU consumption in proper unit and do it in good timing. The runtime.LockOSThread() has noting to do with here. It only bind the goroutine to current thread, but what I mention is when your goroutine enters the syscall, e.g. write(), how to avoid long occupation of the thread which is supposed to switch other ready goroutine to run, especially when the GOMAXPROCS configured to the exact number of the CPU. Of course, increase GOMAXPROCS is an alternative solution."}, {"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441706225, "post_id": 32452610, "comment_id": 52771458, "body": "@JiangYD, so you think the goroutine is asynchronous? ok, whatever, as long as it could clarify the facts the goroutine is sequential processing unit and concurrent to each other."}], "answers": [{"comments": [{"owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "edited": false, "score": 1, "creation_date": 1441775197, "post_id": 32460630, "comment_id": 52804082, "body": "Thanks. The document said &quot;There is no limit to the number of threads that can be blocked in system calls on behalf of Go code&quot; (and I also check the source codes roughly), so it&#39;s possible that if there is many long running blocking syscalls, then the number of blocking threads would grow until it exceeds the system limit and crashes?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "edited": false, "score": 1, "creation_date": 1441803041, "post_id": 32460630, "comment_id": 52820872, "body": "@kingluo: theoretically yes, but if you&#39;re trying to e.g. read from millions of files simultaneously, you&#39;re probably doing something wrong (not to mention you would likely hit other limits in the meantime).  The exception is for calls to the native host resolver, where there a limit places for in-flight requests to limit the number of threads that could be used."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1468847507, "last_edit_date": 1468847507, "creation_date": 1441723130, "answer_id": 32460630, "question_id": 32452610, "link": "https://stackoverflow.com/questions/32452610/golang-how-to-handle-blocking-tasks-optimally/32460630#32460630", "title": "golang: how to handle blocking tasks optimally?", "body": "<p>Go has specifically chosen to not directly expose OS threads to the user, and instead chose an M:N threading model. Your unit of execution in Go is the goroutine, which will be multiplexed on N number of OS threads.</p>\n\n<p>In the <em>rare</em> case you have a CPU intensive calculation that contains no preemption points and insufficient OS threads to continue running other goroutines, you have 2 choices; increase GOMAXPROCS, or insert <code>runtime.Gosched()</code> calls to yield to other goroutines. </p>\n\n<p>In the case of blocking syscalls, the Go scheduler will automatically dispatch a new OS thread (the time limit to consider a syscall \"blocking\" has been 20us), and since non-network IO is a series of blocking syscalls, it will almost always be assigned to a dedicated OS thread. Since Go already uses an M:N threading model, the user is usually unaware of the underlying scheduler choices, and can write the program the same as if the runtime used asynchronous IO.</p>\n\n<p>There is an <a href=\"https://golang.org/issue/6817\" rel=\"nofollow\">open issue</a> to consider using asynchronous file IO, but there are many issues to overcome, like shortcomings in the Linux aio api, cross-platform compatibility, and interactions with all the various filesystems and devices with which you can do IO.</p>\n"}], "owner": {"reputation": 1309, "user_id": 5055251, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f45f990533303b61a6b335198be63a1b?s=128&d=identicon&r=PG&f=1", "display_name": "kingluo", "link": "https://stackoverflow.com/users/5055251/kingluo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1827, "favorite_count": 0, "accepted_answer_id": 32460630, "answer_count": 1, "score": 2, "last_activity_date": 1468847507, "creation_date": 1441700191, "last_edit_date": 1441701936, "question_id": 32452610, "link": "https://stackoverflow.com/questions/32452610/golang-how-to-handle-blocking-tasks-optimally", "title": "golang: how to handle blocking tasks optimally?", "body": "<p>As known, the goroutine is synchronous but non-blocking processing unit.\nThe golang scheduler handles the non-blocking task, e.g. socket, timer, signal or other events from char devices very well.</p>\n\n<p>But how about <strong>block device io or CPU sensitive task</strong>? They couldn't be interrupted until finish, and not multiplexed. The OS thread which runs the goroutine would freeze until the goroutine returns or yields. In that case, the scheduling granularity becomes bad.</p>\n\n<p>Of course, you could split the tasks into smaller sub-tasks in your codes, for example, do not copy 1GB file at one time, instead, copy first 10MB, yield, and copy another 10MB, etc, so that the other goroutines within the same OS thread get chance to run. Another example for CPU-bound task: zip a file part by part and merge them finally.</p>\n\n<p>But that breaks the convenience of sequential programming, and the manual scheduling is hard to estimate evenly, compared to the OS scheduling upon the OS threads.</p>\n\n<p>The nginx has similar issue, it's multi-worker-processes program, one process for one CPU core, similar to the best practice of the GOMAXPROCS. It brings in the thread pool to handle the blocking tasks. Maybe it's good for golang too.\nI am curious why golang has no OS threading API, which should be good supplement to goroutine for blocking tasks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1441691601, "post_id": 32450094, "comment_id": 52762942, "body": "Maybe this can help you <a href=\"http://stackoverflow.com/questions/21080642/memory-leak-in-go-http-standard-library\" title=\"memory leak in go http standard library\">stackoverflow.com/questions/21080642/&hellip;</a>  Try <code>go prof</code>"}, {"owner": {"reputation": 3624, "user_id": 197017, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/59bbbf963f8a584e895b5d860235faa7?s=128&d=identicon&r=PG", "display_name": "Marc", "link": "https://stackoverflow.com/users/197017/marc"}, "reply_to_user": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 0, "creation_date": 1441691903, "post_id": 32450094, "comment_id": 52763047, "body": "Hmm that&#39;s interesting, thanks for linking, but I don&#39;t think that&#39;s it. This is a sudden and dramatic increase (from 6mb starting state to 400mb in a couple seconds, sending those 500 requests against it). I feel like there&#39;s something I&#39;m missing."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1441691958, "post_id": 32450094, "comment_id": 52763071, "body": "Confused about what you&#39;re trying to do here. Of course <code>defer resp.Body.Close()</code> has no effect, you&#39;re making it a <code>ioutil.NopCloser</code>. Read it, close it before making <code>Close()</code> a no-op, and then set it, what happens?"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 2, "creation_date": 1441692037, "post_id": 32450094, "comment_id": 52763114, "body": "Maybe you need to <code>resp.Body.Close()</code> after <code>bodyBytes, err := ioutil.ReadAll(resp.Body)</code>?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1441696850, "post_id": 32450094, "comment_id": 52765695, "body": "First: You say it results in a &quot;huge increases in memory usage&quot;: How do you measure this memory usage? Second: Why does this memoryusage bother you? (Maybe it&#39;s &#39;unproblematic&#39; memory, e.g. large but allocated in one step, containing no pointers.) Third: In your gist: Why do you read the body at all in your RoundTrip? Is the &quot;manipulation&quot;-part missing? Are you sure the memory consumption is not triggered in your manipulation code (e.g. <code>cachedBody := string(bodyBytes)</code> probably makes a copy? Maybe a io.TeeReader could help reading the body for manipulation while re-sending it."}, {"owner": {"reputation": 3624, "user_id": 197017, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/59bbbf963f8a584e895b5d860235faa7?s=128&d=identicon&r=PG", "display_name": "Marc", "link": "https://stackoverflow.com/users/197017/marc"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1441725788, "post_id": 32450094, "comment_id": 52785171, "body": "@volker I&#39;m simply looking at the process in activity monitor. Unscientific, I know, but it jumps from 1mb -&gt; 400mb. It bothers me because I don&#39;t quite understand what&#39;s happening here, and if I increase the # of requests sent against it to say, 2000, memory goes up to ~700mb. The memory issues are present in the code linked in the gist, so it has nothing to do with my manipulation code (unfortunately, would be easier for me to find and fix). The manipulation code isn&#39;t included because it&#39;s noise, and complicates the example."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1441727287, "post_id": 32450094, "comment_id": 52786147, "body": "I understand. Which type of memory &quot;goes up&quot;? Most probably it just does not matter at all because this is virtual memory. Maybe you could measure allocations via <code>go test -benchmem</code> and an appropriate benchmark to see if you allocate and do a real memory profile. &quot;Memory&quot; as shown by top et al. goes up and is not released and this is no problem."}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 3, "last_activity_date": 1441692142, "creation_date": 1441692142, "answer_id": 32450287, "question_id": 32450094, "link": "https://stackoverflow.com/questions/32450094/http-response-body-copying-leads-to-large-memory-usage-increase/32450287#32450287", "title": "http.Response.Body copying leads to large memory usage increase", "body": "<p>The Body must be closed after use. Refer to <a href=\"http://golang.org/pkg/net/http/#Response\" rel=\"nofollow\">this</a></p>\n\n<p>Notice that the <code>defer resp.Body.Close()</code> is invoked after you reassign the <code>resp.Body</code> with new value.</p>\n"}, {"comments": [{"owner": {"reputation": 3624, "user_id": 197017, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/59bbbf963f8a584e895b5d860235faa7?s=128&d=identicon&r=PG", "display_name": "Marc", "link": "https://stackoverflow.com/users/197017/marc"}, "edited": false, "score": 0, "creation_date": 1441693671, "post_id": 32450307, "comment_id": 52763928, "body": "I isolated everything to the gist linked in my edit. I&#39;m calling close, but still seeing memory jump from ~1mb to 400mb in just a couple of seconds. If you have time time, let me know if you see the same result on your machine. Thanks!"}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 3624, "user_id": 197017, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/59bbbf963f8a584e895b5d860235faa7?s=128&d=identicon&r=PG", "display_name": "Marc", "link": "https://stackoverflow.com/users/197017/marc"}, "edited": false, "score": 0, "creation_date": 1441695761, "post_id": 32450307, "comment_id": 52765051, "body": "If your error isn&#39;t <code>nil</code> you&#39;re not closing. Are you sure your error is <code>nil</code>? You&#39;re also not doing anything with the first <code>err</code>. You have to actually do something with errors.."}, {"owner": {"reputation": 3624, "user_id": 197017, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/59bbbf963f8a584e895b5d860235faa7?s=128&d=identicon&r=PG", "display_name": "Marc", "link": "https://stackoverflow.com/users/197017/marc"}, "edited": false, "score": 0, "creation_date": 1441725855, "post_id": 32450307, "comment_id": 52785213, "body": "Yes I forgot to handle the err, but it&#39;s not getting triggered. I just re-ran on my computer with a print statement in there to check."}], "tags": [], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "is_accepted": false, "score": 2, "last_activity_date": 1441692890, "last_edit_date": 1441692890, "creation_date": 1441692235, "answer_id": 32450307, "question_id": 32450094, "link": "https://stackoverflow.com/questions/32450094/http-response-body-copying-leads-to-large-memory-usage-increase/32450307#32450307", "title": "http.Response.Body copying leads to large memory usage increase", "body": "<p><a href=\"https://golang.org/pkg/io/ioutil/#NopCloser\" rel=\"nofollow\"><code>ioutil.NopCloser</code></a> makes <code>Close()</code> do nothing. You're never actually closing it if you defer the close. Close right after reading instead.</p>\n\n<pre><code>bodyBytes, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    // err\n} \nresp.Body.Close()\ncachedBody := string(bodyBytes)\n// Close() does nothing after this\nresp.Body = ioutil.NopCloser(bytes.NewBuffer(bodyBytes))\n</code></pre>\n\n<p>Also in Go you're typically able to ignore that <code>else</code> because you should probably be returning the error or handling it in the <code>if</code> above it.</p>\n\n<p>Things like this are times when it would be nice to have a <a href=\"https://golang.org/pkg/sync/#Pool\" rel=\"nofollow\"><code>sync.Pool</code></a> as well, since you keep recycling huge buffers, check how it is used in the <code>net/http</code> package for an example.</p>\n"}], "owner": {"reputation": 3624, "user_id": 197017, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/59bbbf963f8a584e895b5d860235faa7?s=128&d=identicon&r=PG", "display_name": "Marc", "link": "https://stackoverflow.com/users/197017/marc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 923, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1441693616, "creation_date": 1441691253, "last_edit_date": 1441693616, "question_id": 32450094, "link": "https://stackoverflow.com/questions/32450094/http-response-body-copying-leads-to-large-memory-usage-increase", "title": "http.Response.Body copying leads to large memory usage increase", "body": "<p>So I'm trying to get the response body out of http.Response, to do some manipulation, and then set it back. This is my first attempt at getting it out without draining the http.Response:</p>\n\n<pre><code>bodyBytes, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    // err\n} else {\n    cachedBody := string(bodyBytes)\n\n    // Restore the io.ReadCloser to its original state\n    // This is causing huge increases in memory usage.\n    resp.Body = ioutil.NopCloser(bytes.NewBuffer(bodyBytes))\n}\n</code></pre>\n\n<p>If I send 500 requests through, with a 1mb response size (a large piece of JSON, but it could be any format, not only JSON), the server memory usage goes up to ~400mb, and doesn't come back down. Is this normal? Is there something wrong with the above code? Am I missing something to release the memory?</p>\n\n<p>defer resp.Body.Close() has no effect.</p>\n\n<p>Thanks!</p>\n\n<hr>\n\n<p>Edit 1</p>\n\n<p>Here's a gist with a simple version of the proxy, including the suggested close call. If the server at localhost:3000 (where it's proxying to) returns a large response, memory usage will quickly increase. In my case, I'm returning a 1mb json file, and sending 500 requests through the go proxy increases memory usage to around 400mb.</p>\n\n<p>The go proxy:<br>\n<a href=\"https://gist.github.com/marbemac/300c4c376171cbd27cc3\" rel=\"nofollow\">https://gist.github.com/marbemac/300c4c376171cbd27cc3</a></p>\n\n<p>A simple node server that returns a file in the same directory called large_response.json.<br>\n<a href=\"https://gist.github.com/marbemac/55aaa78f5858484d33f6\" rel=\"nofollow\">https://gist.github.com/marbemac/55aaa78f5858484d33f6</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1441690385, "post_id": 32448699, "comment_id": 52762466, "body": "Have you looked at <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">sqlx</a>? I went the route of writing my own custom way of doing this with <code>reflect</code> as well, but it ended up making more sense to just use sqlx."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1441691161, "post_id": 32448699, "comment_id": 52762754, "body": "Your panic makes sense: <a href=\"https://golang.org/pkg/reflect/#Value.Pointer\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#Value.Pointer</a> The reflect package is a little meta and takes a lot of practice to work with efficiently."}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 0, "last_activity_date": 1441693552, "creation_date": 1441693552, "answer_id": 32450642, "question_id": 32448699, "link": "https://stackoverflow.com/questions/32448699/how-can-pass-a-list-of-references-to-struct-properties-in-an-sql-scan-function-t/32450642#32450642", "title": "How can pass a list of references to struct properties in an sql Scan function to automate the process?", "body": "<p>My suggestion, to use a ORM package.</p>\n\n<p>For your panic, refer to golang <a href=\"https://golang.org/pkg/reflect/#Value.Pointer\" rel=\"nofollow\">document</a>:</p>\n\n<blockquote>\n  <p>It panics if v's Kind is not Chan, Func, Map, Ptr, Slice, or UnsafePointer.</p>\n</blockquote>\n\n<p>Here is a properties copier example using reflection.</p>\n\n<pre><code>func CopyField(dst interface{}, src interface{}) {\ndstVal := reflect.ValueOf(dst).Elem()\nsrcVal := reflect.ValueOf(src).Elem()\n\nfor i := 0; i &lt; srcVal.NumField(); i++ {\n    n := srcVal.Type().Field(i).Name\n    dstField := dstVal.FieldByName(n)\n    if dstField.IsValid() {\n        dstField.Set(srcVal.Field(i))\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1441693552, "creation_date": 1441681845, "last_edit_date": 1441683636, "question_id": 32448699, "link": "https://stackoverflow.com/questions/32448699/how-can-pass-a-list-of-references-to-struct-properties-in-an-sql-scan-function-t", "title": "How can pass a list of references to struct properties in an sql Scan function to automate the process?", "body": "<p>I have a struct of this form which I add methods too.</p>\n\n<pre><code>type User struct {\n    Id           int64\n    Email        string\n    Username     string\n    GeonameId    int64\n    Birthdate    string\n    Hash         string\n    ActiveImage  string\n    About        string\n    Verified     bool\n    Notification bool\n    Joined       int64\n    LastActivity int64\n    Ipv4         int64\n    Deleted      bool\n}\n</code></pre>\n\n<p>But everytime I do a query I am manually assigning the results of that query to these properties which is not very DRY. Every time I add a new column in the database I have to change alot of lines of code manually, which is not very desireable.</p>\n\n<p>The kind of methods I have:</p>\n\n<pre><code>func ByEmail(email string) (*User, error) {\n\n    query := `\n        SELECT *\n        FROM user\n        WHERE\n            email = ? AND\n            deleted = 0\n        LIMIT 1;\n    `\n\n    user := &amp;User{}\n    err := sql.DB.QueryRow(query, email).Scan(\n        &amp;user.Id,\n        &amp;user.Email,\n        &amp;user.Username,\n        &amp;user.GeonameId,\n        &amp;user.Birthdate,\n        &amp;user.Hash,\n        &amp;user.ActiveImage,\n        &amp;user.About,\n        &amp;user.Verified,\n        &amp;user.Notification,\n        &amp;user.Joined,\n        &amp;user.LastActivity,\n        &amp;user.Ipv4,\n        &amp;user.Deleted,\n    )\n    if err != nil {\n        return nil, err\n    }\n\n    return user, nil\n}\n</code></pre>\n\n<p>When creating a new row in the database:</p>\n\n<pre><code>func (u *User) Create() error {\n\n    if u.Id != 0 {\n        return fmt.Errorf(\"User.Create: Struct already has an Id.\")\n    }\n\n    query := `\n        INSERT INTO user\n        SET\n            email = ?,\n            username = ?,\n            geonameid = ?,\n            birthdate = ?,\n            hash = ?,\n            active_image = ?,\n            about = ?,\n            verified = ?,\n            notification = ?,           \n            joined = ?,\n            lastactivity = ?,\n            ipv4 = ?,\n            deleted = ?;\n    `\n\n    stmt, err := sql.DB.Prepare(query)\n    if err != nil {\n        return err\n    }\n\n    res, err := stmt.Exec(\n        u.Email,\n        u.Username,\n        u.GeonameId,\n        u.Birthdate,\n        u.Hash,\n        u.ActiveImage,\n        u.About,\n        u.Verified,\n        u.Notification,\n        u.Joined,\n        u.LastActivity,\n        u.Ipv4,\n        u.Deleted,\n    )\n    if err != nil {\n        return err\n    }\n\n    lastId, err := res.LastInsertId()\n    if err != nil {\n        return err\n    }\n\n    u.Id = lastId\n\n    return nil\n}\n</code></pre>\n\n<p>I have looked at some examples of reflection usage but I still don't quite grasp it. And I don't know how to do it in a simple way. </p>\n\n<p>How can I automate the process of this by sending in a slice of pointers of reference to the struct properties or something similar in the Scan() and Exec() functions below to automate this process?</p>\n\n<p>EDIT:</p>\n\n<p>I tried to get reference to the structs properties by doing this:</p>\n\n<pre><code>user, _ := user.ById(1)\nval := reflect.ValueOf(user).Elem()\n\nfmt.Println(&amp;user.Id)\nfmt.Println(val.Field(0).Pointer())\n</code></pre>\n\n<p>But it panicced and gave me this error:</p>\n\n<pre><code>panic: reflect: call of reflect.Value.Pointer on int64 Value\n</code></pre>\n"}, {"tags": ["unit-testing", "testing", "go", "tdd"], "comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 1, "creation_date": 1441690776, "post_id": 32448559, "comment_id": 52762605, "body": "Did you try just using <code>PingHandler(nil, nil)</code>? That should cause an error I assume? I don&#39;t have all of your code so I can&#39;t run it and test"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1441696457, "post_id": 32448559, "comment_id": 52765461, "body": "Can you add the content of <code>writeDefaultHeaders</code>? The straightforward (testable) approach is to write your own type that embeds <code>http.ResponseWriter</code> and just override the method(s) you want to test."}, {"owner": {"reputation": 4272, "user_id": 564761, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1005cfd76e1ccfc8ecade26226602b46?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/564761/john"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441696630, "post_id": 32448559, "comment_id": 52765551, "body": "@elithrar Added it to the question."}, {"owner": {"reputation": 4272, "user_id": 564761, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1005cfd76e1ccfc8ecade26226602b46?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/564761/john"}, "reply_to_user": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1441697466, "post_id": 32448559, "comment_id": 52766054, "body": "@user3591723 nil, nil doesn&#39;t work from because then I don&#39;t my writer recorder to compare the status code and body. I&#39;ve added my broken test for clarification."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1441697572, "post_id": 32448559, "comment_id": 52766118, "body": "Yea and it causes a panic, not an error. I must be missing something though, if you want <code>writeDefaultHeaders</code> to return an error you can&#39;t hardcode <code>&quot;text&quot;</code> into <code>contentType</code>. Just make <code>contentType</code> come from the request and make a bad request--something that doesn&#39;t have the content types you&#39;re expecting."}], "answers": [{"comments": [{"owner": {"reputation": 4272, "user_id": 564761, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1005cfd76e1ccfc8ecade26226602b46?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/564761/john"}, "edited": false, "score": 0, "creation_date": 1441698406, "post_id": 32451889, "comment_id": 52766590, "body": "Thank you for the answer, but it&#39;s not quite what I&#39;m hoping for. You&#39;re right that I could use the Content Type in the request or the Accept to follow the http spec, but I don&#39;t want the response type to be user controlled.  I&#39;m coming for Ruby where I&#39;m hoping to mock the function call to writeDefaultHeaders to have the bad input param or something similar."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 4272, "user_id": 564761, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1005cfd76e1ccfc8ecade26226602b46?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/564761/john"}, "edited": false, "score": 0, "creation_date": 1441698511, "post_id": 32451889, "comment_id": 52766650, "body": "Then you need some sort of logic to figure out the <code>contentType</code>. This is just an example using the &quot;Content-Type&quot; header because I had to come up with something. If you have the correct case hard coded you don&#39;t ever get a failure, it is as simple as that..."}], "tags": [], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "is_accepted": false, "score": 1, "last_activity_date": 1441698356, "last_edit_date": 1441698356, "creation_date": 1441697872, "answer_id": 32451889, "question_id": 32448559, "link": "https://stackoverflow.com/questions/32448559/go-simple-http-handler-testing-all-paths/32451889#32451889", "title": "Go simple http handler testing all paths", "body": "<p>Unless I am missing something the way to get an error is to remove the hardcoded <code>\"text\"</code> and have whatever you're passing as <code>contentType</code> be something in the request. Parse it out of the request and then pass it on to writeDefaultHeaders. Passing case is either <code>\"text\"</code> or <code>\"json\"</code>, everything else should give you your error, assuming <code>handleException</code> works as expected (you haven't shown it)</p>\n\n<p>Example (of course you don't want the \"Content-Type\" header to look like this)</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"net/http/httptest\"\n    \"testing\"\n)\n\nfunc Test200PingHandler(t *testing.T) {\n    req, _ := http.NewRequest(\"GET\", \"/ping\", nil)\n    req.Header().Set(\"Content-Type\", \"text\")\n    //req.Header().Set(\"Content-Type\", \"json\")\n    w := httptest.NewRecorder()\n\n    PingHandler(w, req)\n\n    if w.Code != http.StatusOK {\n        t.Errorf(\"Ping Handler Status Code is NOT 200; got %v\", w.Code)\n    }\n\n    if w.Body.String() != \"Pong\" {\n        t.Errorf(\"Ping Handler Response Body is NOT Pong; got %v\", w.Body.String())\n    }\n}\n\n// This fails as it is the same setup as the passing success case\nfunc Test500PingHandler(t *testing.T) {\n    req, _ := http.NewRequest(\"GET\", \"/ping\", nil)\n    req.Header().Set(\"Content-Type\", \"fail\")\n    w := httptest.NewRecorder()\n\n    PingHandler(w, req)\n\n    if w.Code != http.StatusInternalServerError {\n        t.Errorf(\"Ping Handler Status Code is NOT 500; got %v\", w.Code)\n    }\n\n    if w.Body.String() != \"Internal Server Error\" {\n        t.Errorf(\"Ping Handler Response Body is NOT Internal Server Error; got %v\", w.Body.String())\n    }\n}\n</code></pre>\n\n<p>main</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc PingHandler(w http.ResponseWriter, r *http.Request) {\n    err := writeDefaultHeaders(w, req.Header().Get(\"Content-Type\"))\n    if err != nil {\n        handleException(w, err)\n        return\n    }\n\n    fmt.Fprintf(w, \"Pong\")\n}\n\nfunc writeDefaultHeaders(w http.ResponseWriter, contentType string) error {\n    w.Header().Set(\"X-Frame-Options\", \"DENY\")\n    w.Header().Set(\"X-Content-Type-Options\", \"nosniff\")\n    w.Header().Set(\"X-XSS-Protection\", \"1;mode=block\")\n\n    switch contentType {\n    case \"text\":\n        w.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n        return nil\n    case \"json\":\n        w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n        return nil\n    default:\n        return errors.New(\"Attempting to render an unknown content type\")\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1442867557, "creation_date": 1442867557, "answer_id": 32704070, "question_id": 32448559, "link": "https://stackoverflow.com/questions/32448559/go-simple-http-handler-testing-all-paths/32704070#32704070", "title": "Go simple http handler testing all paths", "body": "<p>As you have written it, this code will never be reached in PingHandler:</p>\n\n<pre><code>if err != nil {\n    handleException(w, err)\n    return\n}\n</code></pre>\n\n<p>because the only place you return error is when writeDefaultHeaders is passed something other than text or json, and in PingHandler you hard-code \"text\", so ping handler will never call handleException, and the error handling is redundant. There is no other place you might return error in writeDefaultHeaders.</p>\n\n<p>If you wish to test handleException, to see it returns a 500 error correctly (which is what you are asserting/testing in Test500PingHandler), just construct a PingHandlerFail function in the test file which sets an incorrect responseType and use that - there is no other way to trigger your error code.  </p>\n\n<pre><code>func PingHandlerFail(w http.ResponseWriter, r *http.Request) {\n    err := writeDefaultHeaders(w, \"foo\")\n    if err != nil {\n        handleException(w, err)\n        return\n    }\n    fmt.Fprintf(w, \"Pong\")\n}\n</code></pre>\n\n<p>Alternatively, change PingHandler to set contentType based on some request criteria like whether the request ends in .json or not (which you will presumably need to do in order to serve either json or text) so that you can trigger an error somehow - at present since PingHandler never serves anything but text, the error code is redundant and the result untestable. </p>\n"}, {"comments": [{"owner": {"reputation": 4272, "user_id": 564761, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1005cfd76e1ccfc8ecade26226602b46?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/564761/john"}, "edited": false, "score": 0, "creation_date": 1442904453, "post_id": 32707508, "comment_id": 53263004, "body": "This is basically what I was looking for. Thanks. Can you give an example on how the interface approach would work? For example, I&#39;ve made an edit to my post with a stdlib call that may return an error that causes an error conditional block to be triggered."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 3, "last_activity_date": 1442921418, "last_edit_date": 1442921418, "creation_date": 1442889393, "answer_id": 32707508, "question_id": 32448559, "link": "https://stackoverflow.com/questions/32448559/go-simple-http-handler-testing-all-paths/32707508#32707508", "title": "Go simple http handler testing all paths", "body": "<blockquote>\n  <p>What is the idiomatic way to mock this call / hit this error branch in the code?</p>\n</blockquote>\n\n<p>Usually for testing you want to use a public interface and either supply an implementation to your code (<code>NewMyThing(hw HeaderWriter)</code>) or use some other mechanism (like a <code>DefaultHeaderWriter</code> which you can swap out in your test).</p>\n\n<p>Since this code is private you can just use a variable though:</p>\n\n<pre><code>var writeDefaultHeaders = func(w http.ResponseWriter, contentType string) error {\n    w.Header().Set(\"X-Frame-Options\", \"DENY\")\n    w.Header().Set(\"X-Content-Type-Options\", \"nosniff\")\n    w.Header().Set(\"X-XSS-Protection\", \"1;mode=block\")\n\n    switch contentType {\n    case \"text\":\n        w.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n        return nil\n    case \"json\":\n        w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n        return nil\n    default:\n        return errors.New(\"Attempting to render an unknown content type\")\n    }\n}\n\nfunc PingHandler(w http.ResponseWriter, r *http.Request) {\n    err := writeDefaultHeaders(w, \"text\")\n    if err != nil {\n        handleException(w, err)\n        return\n    }\n\n    fmt.Fprintf(w, \"Pong\")\n}\n</code></pre>\n\n<p>And then swap it out in your test:</p>\n\n<pre><code>func Test500PingHandler(t *testing.T) {\n    writeDefaultHeaders = headerWriterFunc(func(w http.ResponseWriter, contentType string) error {\n        return fmt.Errorf(\"ERROR\")\n    })\n    // ...\n}\n</code></pre>\n\n<p>You probably want to set it back when you're done.</p>\n\n<p>In my opinion swapping out a single function like this is not good testing practice. Tests should be against the public API so you can tinker with your code without having to rewrite your tests every time you make a single change.</p>\n\n<p>Interface example:</p>\n\n<pre><code>type Marshaler interface {\n    Marshal(v interface{}) ([]byte, error)\n}\n\ntype jsonMarshaler struct{}\n\nfunc (_ *jsonMarshaler) Marshal(v interface{}) ([]byte, error) {\n    return json.Marshal(v)\n}\n\nvar marshaler Marshaler = (*jsonMarshaler)(nil)\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>json_response, err := marshaler.Marshal(response)\n</code></pre>\n"}], "owner": {"reputation": 4272, "user_id": 564761, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1005cfd76e1ccfc8ecade26226602b46?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/564761/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 987, "favorite_count": 0, "accepted_answer_id": 32707508, "answer_count": 3, "score": 1, "last_activity_date": 1442921418, "creation_date": 1441680977, "last_edit_date": 1442904325, "question_id": 32448559, "link": "https://stackoverflow.com/questions/32448559/go-simple-http-handler-testing-all-paths", "title": "Go simple http handler testing all paths", "body": "<p>I'm trying to get a 100% code coverage on this simple http handler file. </p>\n\n<p>The file writes the default response headers if successful and then returns 200 with \"Pong\" which I've tested below. However, there is also a possibility that writing the default headers will generate an error in which case a 500 response with Internal Error body is expected. </p>\n\n<p>I'm struggling to figure out how to trigger the 500 response case in a test. The case would fail if for some reason the writeDefaultHeaders function call's 2nd parameter was changed to \"html\" for example as html is not a supported response content type in my service. </p>\n\n<p>What is the idiomatic way to mock this call / hit this error branch in the code?</p>\n\n<p>Thanks.</p>\n\n<p><strong>ping_handler_test.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"net/http/httptest\"\n    \"testing\"\n)\n\nfunc Test200PingHandler(t *testing.T) {\n    req, _ := http.NewRequest(\"GET\", \"/ping\", nil)\n    w := httptest.NewRecorder()\n\n    PingHandler(w, req)\n\n    if w.Code != http.StatusOK {\n        t.Errorf(\"Ping Handler Status Code is NOT 200; got %v\", w.Code)\n    }\n\n    if w.Body.String() != \"Pong\" {\n        t.Errorf(\"Ping Handler Response Body is NOT Pong; got %v\", w.Body.String())\n    }\n}\n\n// This fails as it is the same setup as the passing success case\nfunc Test500PingHandler(t *testing.T) {\n    req, _ := http.NewRequest(\"GET\", \"/ping\", nil)\n    w := httptest.NewRecorder()\n\n    PingHandler(w, req)\n\n    if w.Code != http.StatusInternalServerError {\n        t.Errorf(\"Ping Handler Status Code is NOT 500; got %v\", w.Code)\n    }\n\n    if w.Body.String() != \"Internal Server Error\" {\n        t.Errorf(\"Ping Handler Response Body is NOT Internal Server Error; got %v\", w.Body.String())\n    }\n}\n\nfunc BenchmarkPingHandler(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        req, _ := http.NewRequest(\"GET\", \"/ping\", nil)\n        w := httptest.NewRecorder()\n\n        PingHandler(w, req)\n    }\n}\n</code></pre>\n\n<p><strong>ping_handler.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc PingHandler(w http.ResponseWriter, r *http.Request) {\n    err := writeDefaultHeaders(w, \"text\")\n    if err != nil {\n        handleException(w, err)\n        return\n    }\n\n    fmt.Fprintf(w, \"Pong\")\n}\n\nfunc writeDefaultHeaders(w http.ResponseWriter, contentType string) error {\n    w.Header().Set(\"X-Frame-Options\", \"DENY\")\n    w.Header().Set(\"X-Content-Type-Options\", \"nosniff\")\n    w.Header().Set(\"X-XSS-Protection\", \"1;mode=block\")\n\n    switch contentType {\n    case \"text\":\n        w.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n        return nil\n    case \"json\":\n        w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n        return nil\n    default:\n        return errors.New(\"Attempting to render an unknown content type\")\n    }\n}\n</code></pre>\n\n<p><strong>Edit</strong>\nAnother Example:</p>\n\n<pre><code>json_response, err := json.Marshal(response)\nif err != nil {\n    handleException(w, err)\n    return\n}\n</code></pre>\n\n<p>In this case, how do I test json.Marshal returning an error?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1441733403, "post_id": 32447929, "comment_id": 52789572, "body": "@Alex, use <a href=\"https://github.com/golang/go/blob/release-branch.go1.5/src/database/sql/sql.go#L1024-L1030\" rel=\"nofollow noreferrer\">the source</a> (also see <a href=\"https://github.com/golang/go/blob/release-branch.go1.5/src/database/sql/sql.go#L1728-L1773\" rel=\"nofollow noreferrer\"><code>Row.Scan</code></a>)."}], "tags": [], "owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "is_accepted": true, "score": 3, "last_activity_date": 1441675376, "creation_date": 1441675376, "answer_id": 32447929, "question_id": 32447756, "link": "https://stackoverflow.com/questions/32447756/is-there-any-significant-performance-difference-between-query-and-queryrow-in-th/32447929#32447929", "title": "Is there any significant performance difference between Query and QueryRow in the sql package?", "body": "<p>The difference is the overhead of a function call (i.e., almost nothing, compared to sending a query to your database). QueryRow calls Query, and then wraps the results in an sql.Row.</p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 876, "favorite_count": 0, "accepted_answer_id": 32447929, "answer_count": 1, "score": 2, "last_activity_date": 1441675376, "creation_date": 1441673823, "question_id": 32447756, "link": "https://stackoverflow.com/questions/32447756/is-there-any-significant-performance-difference-between-query-and-queryrow-in-th", "title": "Is there any significant performance difference between Query and QueryRow in the sql package?", "body": "<p>Is there any significant performance difference between the </p>\n\n<pre><code>func (db *DB) Query(query string, args ...interface{}) (*Rows, error)\n</code></pre>\n\n<p>and the</p>\n\n<pre><code>func (db *DB) QueryRow(query string, args ...interface{}) *Row\n</code></pre>\n\n<p>in the <code>\"database/sql\"</code> package even if you have <code>LIMIT 1;</code> at the end of your query?</p>\n"}, {"tags": ["html", "go", "document"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441660528, "post_id": 32446033, "comment_id": 52755721, "body": "The <code>Content-Length</code> header on the response."}, {"owner": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441660924, "post_id": 32446033, "comment_id": 52755824, "body": "response.ContentLength is return -1, which means unknown length -("}], "answers": [{"comments": [{"owner": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "edited": false, "score": 0, "creation_date": 1441661687, "post_id": 32446168, "comment_id": 52756068, "body": "len() function doesn&#39;t work on res.Body, which is io.Reader. I need the HTML document size in kb."}, {"owner": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "edited": false, "score": 0, "creation_date": 1441666433, "post_id": 32446168, "comment_id": 52757166, "body": "Thanks, this is the closest we have in golang for returned HTML document size in kb: <code>float32(len(body) &#47; 1024)</code>   However, this value still doesn&#39;t match with the Page Info value of Firefox -("}, {"owner": {"reputation": 2358, "user_id": 2109067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dd1b5635a40eecb4a9f17135e8119bc?s=128&d=identicon&r=PG", "display_name": "ankhzet", "link": "https://stackoverflow.com/users/2109067/ankhzet"}, "reply_to_user": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "edited": false, "score": 0, "creation_date": 1441667063, "post_id": 32446168, "comment_id": 52757283, "body": "@ShahIsmail, <code>this value still doesn&#39;t match with the Page Info value of Firefox</code> - and why it should? That value in Firefox is size in bytes of <i>all response</i>, including HTTP headers, not only size of returned html code. If you need whole transferred bytes count, examine <code>res.Headers</code> property and add total size of each header to resulting length"}, {"owner": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "edited": false, "score": 0, "creation_date": 1441692342, "post_id": 32446168, "comment_id": 52763249, "body": "The value returned by this script is ~80kb while Firefox returns ~35kb. So the firefox isn&#39;t counting the header etc. As I mentioned, I need the size of HTML document (without assets).   --&gt;Little correction: <code>float32(len(body)) &#47; float32(1024)</code> The thing is, if somebody needs to verify the correctness of my solution then how would he go about it?"}, {"owner": {"reputation": 7376, "user_id": 2171928, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a2dc8a6d4e15c61451d70f695ac18ae9?s=128&d=identicon&r=PG", "display_name": "Kishore Vaishnav", "link": "https://stackoverflow.com/users/2171928/kishore-vaishnav"}, "reply_to_user": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "edited": false, "score": 1, "creation_date": 1441692973, "post_id": 32446168, "comment_id": 52763585, "body": "@ShahIsmail, are you trying to check a static page or a dynamic page? Is it a public URL or a user session based URL? Did you verified the contents whether both the HTML are same as compared with Firefox &amp; <code>http.Get(url)</code>."}, {"owner": {"reputation": 2358, "user_id": 2109067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dd1b5635a40eecb4a9f17135e8119bc?s=128&d=identicon&r=PG", "display_name": "ankhzet", "link": "https://stackoverflow.com/users/2109067/ankhzet"}, "reply_to_user": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "edited": false, "score": 0, "creation_date": 1441693133, "post_id": 32446168, "comment_id": 52763664, "body": "@ShahIsmail, create minimal reproducable example at <a href=\"http://play.golang.org/\" rel=\"nofollow noreferrer\">golang playground</a> so we can test it, please"}, {"owner": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "edited": false, "score": 0, "creation_date": 1441715781, "post_id": 32446168, "comment_id": 52777934, "body": "<a href=\"http://play.golang.org/p/zhmZ1pw-1D\" rel=\"nofollow noreferrer\">play.golang.org/p/zhmZ1pw-1D</a>   It doesn&#39;t run on playgroud and complain about &quot;Get http://.... dial tcp: protocol not available&quot;   But you can run it on your local machines. Basically, it&#39;s a jsp page but the server only requires cookies enabled."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "edited": false, "score": 1, "creation_date": 1441720274, "post_id": 32446168, "comment_id": 52781262, "body": "@ShahIsmail there&#39;s a chance that firefox is displaying the gzip&#39;ed size."}, {"owner": {"reputation": 2358, "user_id": 2109067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dd1b5635a40eecb4a9f17135e8119bc?s=128&d=identicon&r=PG", "display_name": "ankhzet", "link": "https://stackoverflow.com/users/2109067/ankhzet"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1441727112, "post_id": 32446168, "comment_id": 52786021, "body": "@OneOfOne, confirming, Firefox <i>actually</i> shows transferred bytes (which is less for gzipped content), not html content size."}], "tags": [], "owner": {"reputation": 2358, "user_id": 2109067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8dd1b5635a40eecb4a9f17135e8119bc?s=128&d=identicon&r=PG", "display_name": "ankhzet", "link": "https://stackoverflow.com/users/2109067/ankhzet"}, "is_accepted": true, "score": 3, "last_activity_date": 1441692603, "last_edit_date": 1441692603, "creation_date": 1441660731, "answer_id": 32446168, "question_id": 32446033, "link": "https://stackoverflow.com/questions/32446033/how-to-retrieve-html-document-size-from-url-in-golang/32446168#32446168", "title": "How to retrieve html document size from url in golang", "body": "<p>Get the document via:</p>\n\n<pre><code>res, err := http.Get(url)\nif err != nil {\n    // handle error\n}\ndefer res.Body.Close()\n</code></pre>\n\n<p>Now you can:</p>\n\n<pre><code>body, err := ioutil.ReadAll(res.Body)\nif err != nil {\n    // handle error\n}\nl := len(body)\n</code></pre>\n\n<p>To use with GoQuery:</p>\n\n<pre><code>utfBody, err := iconv.NewReader(res.Body, charset, \"utf-8\")\nif err != nil {\n    // handler error\n}\n\ndoc, err := goquery.NewDocumentFromReader(utfBody)\nif err != nil {\n    // handler error\n}\n</code></pre>\n\n<p>More datail about GoQuery and readers is <a href=\"https://github.com/PuerkitoBio/goquery/wiki/Tips-and-tricks\" rel=\"nofollow\">here</a>.</p>\n"}], "owner": {"reputation": 620, "user_id": 347641, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/fi6dx.jpg?s=128&g=1", "display_name": "Shah-G", "link": "https://stackoverflow.com/users/347641/shah-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1120, "favorite_count": 0, "accepted_answer_id": 32446168, "answer_count": 1, "score": -1, "last_activity_date": 1441692603, "creation_date": 1441659956, "question_id": 32446033, "link": "https://stackoverflow.com/questions/32446033/how-to-retrieve-html-document-size-from-url-in-golang", "title": "How to retrieve html document size from url in golang", "body": "<p>I used GoQuery to retrieve some value within an HTML document. <em>Now I need to get the size of HTML document (without assets)</em>.<br>\nIn Firefox, it's as simple as Tools --> Page Info (General) tab show the Size of the HTML document.<br>\nI tried <code>net/html</code> package as well but I can't find the size of the returned HTML given a URL. Any clues?</p>\n"}, {"tags": ["javascript", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441660636, "post_id": 32444993, "comment_id": 52755748, "body": "Use the full path to your static dir, not a relative path - e.g. not <code>..&#47;static</code>"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1441676411, "post_id": 32444993, "comment_id": 52759247, "body": "use relative path in your html for javascript."}], "answers": [{"tags": [], "owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "is_accepted": true, "score": 1, "last_activity_date": 1450703626, "creation_date": 1450703626, "answer_id": 34396554, "question_id": 32444993, "link": "https://stackoverflow.com/questions/32444993/cannot-locate-static-scripts-with-golang-server/34396554#34396554", "title": "Cannot locate static scripts with golang server", "body": "<p>Try the following:</p>\n\n<pre><code>// Create new router.\ngorillaMux := mux.NewRouter()\n\n// Match /res/ prefix to local /res/ folder.\ngorillaMux.PathPrefix(\"/res/\").Handler(http.StripPrefix(\"/res/\", http.FileServer(http.Dir(\"./res/\"))))\n</code></pre>\n\n<p>This will make <code>http://example.com/res/js/script.js</code> look for <code>./res/js/script.js</code></p>\n\n<p>So, you have to fully qualify you resources in your HTML: <code>src= \"/static/scripts/test.js\"</code></p>\n"}], "owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "accepted_answer_id": 34396554, "answer_count": 1, "score": 2, "last_activity_date": 1450703626, "creation_date": 1441654170, "last_edit_date": 1441658043, "question_id": 32444993, "link": "https://stackoverflow.com/questions/32444993/cannot-locate-static-scripts-with-golang-server", "title": "Cannot locate static scripts with golang server", "body": "<p>I wrote a golang webserver and I was serving static resources before, but after changing my project structure, that no longer works. </p>\n\n<p>This is my project structure</p>\n\n<pre><code>ProjectFolder/\n    node_modules/\n    scripts/\n       test.es6.js\n    server/\n       handlers.go\n       main.go\n       routes.go\n    static/\n       scripts/\n          test.js\n          test.js.map\n    Gruntfile.js\n    index.html\n    package.json\n</code></pre>\n\n<p>This is my index.html</p>\n\n<pre><code>&lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\"&gt;&lt;/script&gt;\n&lt;script type=\"text/javacript\" src=\"//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.2.1/backbone-min.js\"&gt;&lt;/script&gt;\n&lt;script type=\"text/javascript\" src=\"//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js\"&gt;&lt;/script&gt;\n&lt;script type=\"text/javascript\" src=\"https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js\"&gt;&lt;/script&gt;\n&lt;script type=\"text/javascript\" src=\"/static/scripts/test.js\"&lt;/script&gt;\n&lt;body&gt;\n    &lt;div id=\"chart\"&gt;&lt;/div&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>This is my routes.go</p>\n\n<pre><code>func NewRouter() *mux.Router {\n\n    router := mux.NewRouter().StrictSlash(true)\n    for _, route := range routes {\n        router.\n            Methods(route.Method).\n            Path(route.Pattern).\n            Name(route.Name).\n            Handler(route.HandlerFunc)\n    }\n\n    for pathName, pathValue := range staticPaths {\n        pathPrefix := \"/\" + pathName + \"/\"\n        fmt.Println(pathPrefix)\n        fmt.Println(pathValue)\n        router.PathPrefix(pathPrefix).Handler(http.StripPrefix(pathPrefix, http.FileServer(http.Dir(pathValue))))\n    }\n\n\n    // router.PathPrefix(\"/static/scripts\").Handler(http.FileServer(http.Dir(\"./static/scripts/\")))\n    return router\n}\n\nvar staticDirectory = \"/static\"\n\nvar staticPaths = map[string]string{\n    \"scripts\": staticDirectory + \"/scripts/\",\n}\n\nvar routes = Routes{\n    Route{\n        \"Index\",\n        \"GET\",\n        \"/\",\n        Index,\n    },\n}\n</code></pre>\n\n<p>When I hit localhost:8200, I get a 404 when loading test.js, but index.html is getting hit. </p>\n\n<p>Before, this was an issue with not using http.FileServer to serve static resources, but I am using it now. </p>\n\n<p>I've tried other variations of the path in index.html</p>\n\n<pre><code>src= \"static/scripts/test.js\"\nsrc= \"../static/scripts/test.js\"\n</code></pre>\n\n<p>What is going on? </p>\n\n<p>EDIT-</p>\n\n<p>I've simplified everything and tried to do this </p>\n\n<p>router.Handle(\"../static/scripts\", http.StripPrefix(\"../static/scripts\", http.FileServer(http.Dir(\".\"))))</p>\n\n<p>But that still isn't working. </p>\n"}, {"tags": ["go", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441650348, "post_id": 32444263, "comment_id": 52752007, "body": "Yes I&#39;ve seen that but how do I make the gin context available?"}, {"owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441651497, "post_id": 32444263, "comment_id": 52752429, "body": "Have you seen NoRoute signature? It receives a Handler, which is then passed the Context. Is that what you mean?"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441651876, "post_id": 32444263, "comment_id": 52752573, "body": "Could you provide an example of what you mean using/passing the context"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1441652035, "post_id": 32444263, "comment_id": 52752626, "body": "Oh i see - that&#39;s straight forward. Thanks"}, {"owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 1, "creation_date": 1441652160, "post_id": 32444263, "comment_id": 52752667, "body": "No problem. If it worked don&#39;t forget to accept the answer so it doesn&#39;t show up as &quot;unanswered&quot;."}], "tags": [], "owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "is_accepted": true, "score": 44, "last_activity_date": 1441651964, "last_edit_date": 1441651964, "creation_date": 1441650285, "answer_id": 32444263, "question_id": 32443738, "link": "https://stackoverflow.com/questions/32443738/setting-up-route-not-found-in-gin/32444263#32444263", "title": "Setting up Route Not Found in Gin", "body": "<p>What you're looking for is the <a href=\"http://godoc.org/github.com/gin-gonic/gin#Engine.NoRoute\"><code>NoRoute</code></a> handler.</p>\n\n<p>More precisely:</p>\n\n<pre><code>r := gin.Default()\n\nr.NoRoute(func(c *gin.Context) {\n    c.JSON(404, gin.H{\"code\": \"PAGE_NOT_FOUND\", \"message\": \"Page not found\"})\n})\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13965, "favorite_count": 1, "accepted_answer_id": 32444263, "answer_count": 1, "score": 20, "last_activity_date": 1489510373, "creation_date": 1441647668, "last_edit_date": 1489510373, "question_id": 32443738, "link": "https://stackoverflow.com/questions/32443738/setting-up-route-not-found-in-gin", "title": "Setting up Route Not Found in Gin", "body": "<p>I've setup a default router and some routes in Gin:</p>\n\n<pre><code>router := gin.Default()\nrouter.POST(\"/users\", save)\nrouter.GET(\"/users\",getAll)\n</code></pre>\n\n<p>but how do I handle 404 Route Not Found in Gin?</p>\n\n<p>Originally, I was using httprouter which I understand Gin uses so this was what I originally had...</p>\n\n<pre><code>router.NotFound = http.HandlerFunc(customNotFound)\n</code></pre>\n\n<p>and the function:</p>\n\n<pre><code>func customNotFound(w http.ResponseWriter, r *http.Request) {\n    //return JSON\n    return\n}\n</code></pre>\n\n<p>but this won't work with Gin.</p>\n\n<p>I need to be able to return JSON using the <code>c *gin.Context</code> so that I can use:</p>\n\n<pre><code>c.JSON(404, gin.H{\"code\": \"PAGE_NOT_FOUND\", \"message\": \"Page not found\"})\n</code></pre>\n"}, {"tags": [".net", "go"], "comments": [{"owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "edited": false, "score": 0, "creation_date": 1441637915, "post_id": 32441517, "comment_id": 52746798, "body": "One for you perhaps @EricLippert"}, {"owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "edited": false, "score": 2, "creation_date": 1441640542, "post_id": 32441517, "comment_id": 52748151, "body": "Go doesn&#39;t use an event loop, but a custom scheduler, just like the scheduler your OS uses for native threads (goroutines are often called &#39;lightweight&#39; or &#39;green&#39; threads), but which is implemented inside the Go runtime and compiled into any Go binary."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1441652118, "post_id": 32441517, "comment_id": 52752654, "body": "I&#39;m not an expert on .NET, but <code>async</code>/<code>await</code> appear to <a href=\"https://msdn.microsoft.com/en-us/library/hh191443.aspx\" rel=\"nofollow noreferrer\">make it convenient to do some work asynchronously without spawning new OS threads</a>. I doubt .NET will ever go whole hog for Go-like user-mode threading (like <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms682661(v=vs.85).aspx\" rel=\"nofollow noreferrer\">fibers</a>); just too big a change. BUT! I wouldn&#39;t sweat that. If what you know is .NET write straightforward .NET code, profile/get production metrics on the result, and selectively async-ify if/where it seems potentially useful."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1441656000, "post_id": 32441517, "comment_id": 52754106, "body": "<a href=\"http://blogs.msdn.com/b/larryosterman/archive/2005/01/05/347314.aspx\" rel=\"nofollow noreferrer\">A while back ago, Larry Osterman wrote</a> a good bit on why user-mode scheduling is less important than it was when win32 fibers were introduced. The code to switch threads itself has become much cheaper partly just thanks to faster CPUs, while other costs haven&#39;t dropped as much (like the cache misses from the other thread working with different data/code). Just as I advise Gophers to write idiomatic Go, I&#39;d say write regular threaded .NET unless/until the related overheads come to be a problem."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 2, "creation_date": 1441909641, "post_id": 32441517, "comment_id": 52877273, "body": "The Canterbury team who produced JCSP for Java have a CCSP runtime (with a C API) which is [one of] the fastest context-switching scheduler available. It would be interesting to marry that with .Net. It uses the techniques of the Transputer from decades earlier."}], "answers": [{"comments": [{"owner": {"reputation": 1066, "user_id": 1708941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc1bcf0dc04ab41dd2b10ed73ae5b3c?s=128&d=identicon&r=PG", "display_name": "Kenogu Labz", "link": "https://stackoverflow.com/users/1708941/kenogu-labz"}, "edited": false, "score": 0, "creation_date": 1558556922, "post_id": 32446992, "comment_id": 99145436, "body": "This is an astonishing level of &#39;Not Invented Here&#39;.  Just because Go uses CSP does not mean it is not something that may be a useful alternative to what C# provides. CSP is far more than the mere low-level implementation of it."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 1066, "user_id": 1708941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc1bcf0dc04ab41dd2b10ed73ae5b3c?s=128&d=identicon&r=PG", "display_name": "Kenogu Labz", "link": "https://stackoverflow.com/users/1708941/kenogu-labz"}, "edited": false, "score": 2, "creation_date": 1558559541, "post_id": 32446992, "comment_id": 99146503, "body": "@KenoguLabz I think my response read different to you than I meant! The question as asked is explicitly <i>not</i> about the CSP <i>model</i> (&quot;I&#39;m not just talking about a...similar programming...model using the existing thread primitives&quot;), but changing the &quot;VM and compiler&quot; to work more how Go&#39;s does. So my answer focused on the implementation details and their tradeoffs, and I concluded that C#&#39;s OS-thread-centric model works well pretty often. You can always write a competing answer if you think that would help people!"}, {"owner": {"reputation": 1066, "user_id": 1708941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bc1bcf0dc04ab41dd2b10ed73ae5b3c?s=128&d=identicon&r=PG", "display_name": "Kenogu Labz", "link": "https://stackoverflow.com/users/1708941/kenogu-labz"}, "edited": false, "score": 2, "creation_date": 1558646616, "post_id": 32446992, "comment_id": 99180192, "body": "That&#39;s fair, and you&#39;re right, that is a better reading of the question at hand, I think. The only quibble I have is on it being idiomatic Go... but even there I think I see what you&#39;re saying, with regards to that not being the first tool you&#39;d reach for in .NET in most situations.  Thanks for the clarification. :)"}], "tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 4, "last_activity_date": 1463435266, "last_edit_date": 1495541339, "creation_date": 1441666779, "answer_id": 32446992, "question_id": 32441517, "link": "https://stackoverflow.com/questions/32441517/communicating-sequential-processes-in-net/32446992#32446992", "title": "Communicating Sequential Processes in .NET", "body": "<p>Writing this from the perspective of someone more familiar with Go than .NET or Microsoft ecosystems generally, but trying to use sources more embedded in that world.</p>\n\n<p>The Windows ecosystem does include some forms of user-mode task switching similar to what Go's scheduler does: <a href=\"http://blogs.msdn.com/b/larryosterman/archive/2005/01/05/347314.aspx\" rel=\"nofollow noreferrer\">fibers go back to Windows NT 3.51 it seems</a>, and as a slightly more developer-friendly option, <a href=\"https://msdn.microsoft.com/en-us/library/dd627187(v=vs.85).aspx\" rel=\"nofollow noreferrer\">user-mode scheduling</a>, can be used to schedule OS threads from your own code. Neither is exposed to .NET as far as I can find (<a href=\"https://social.msdn.microsoft.com/Forums/en-US/ec504d64-596f-4de9-8d7c-70a8fbf7f69b/incorporating-user-mode-scheduling-ums-into-the-clr-threadpool?forum=async\" rel=\"nofollow noreferrer\">1</a>, <a href=\"https://stackoverflow.com/questions/1949051/is-there-a-fiber-api-in-net\">2</a>).</p>\n\n<p>In the post about fibers linked above, Larry Osterman explains some reasons they were no longer heavily used by 2005. Some reasons are specific quirks of fibers in the Windows API, but others apply to user-mode scheduling more generally. Executing a context switch takes microseconds these days; it just isn't a problem unless you're expecting to do hundreds of thousands of switches per second. And because of cache misses, switching to different code operating on different data might <em>already</em> cause delays of microseconds, even if done entirely in user mode. The gains from user threads are nice to have, but there's no reason to assume they're make-or-break.</p>\n\n<p>You do have asynchronous programming tools in .NET that don't create OS-managed threads, though that's a different thing from user-managed threads. <a href=\"https://msdn.microsoft.com/en-us/library/hh191443.aspx\" rel=\"nofollow noreferrer\"><code>async</code>/<code>await</code></a> make it more convenient to have an I/O operation running in the background while you do other stuff, which is similar to some uses of goroutines for asynchronous network stuff (<a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">1</a>, <a href=\"https://medium.com/medium-eng/running-concurrent-queries-in-gosocial-28e5841b05b5\" rel=\"nofollow noreferrer\">2</a>). In .NET, <a href=\"https://stackoverflow.com/questions/22852251/async-await-as-a-replacement-of-coroutines\">people have tried to build coroutines on <code>yield</code> or <code>async</code>/<code>await</code></a>, but that does not mean it's a good idea.</p>\n\n<p>I like Go plenty, but just as I advise folks to write idiomatic Go in Go, I'd say write idiomatic C#, etc. in .NET. In both cases, it's probably gonna be fine.</p>\n\n<p>If you <em>do</em> find yourself with a problem you think might involve threads, you can always <a href=\"https://stackoverflow.com/questions/12607795/counting-context-switches-for-specific-process-in-windows\">check on context switch stats</a> to see if you really are doing enough switches to matter, then if so go back to your code to figure out how you might get things back under control. Worrying later often beats worrying too early, when you don't have working code and it's all theoretical!</p>\n"}], "owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 746, "favorite_count": 1, "closed_date": 1441809663, "accepted_answer_id": 32446992, "answer_count": 1, "score": 7, "last_activity_date": 1483433436, "creation_date": 1441637867, "last_edit_date": 1483433436, "question_id": 32441517, "link": "https://stackoverflow.com/questions/32441517/communicating-sequential-processes-in-net", "closed_reason": "Needs more focus", "title": "Communicating Sequential Processes in .NET", "body": "<p>I have been working with Go recently and it occurred to me that perhaps the same CSP model could be built into a future version of .NET.  I'm not simply talking about a new library that provides a channel type and a similar programming experience/model using the existing thread primitives under the hood; I mean implementing the model throughout the VM and compiler to produce executable code that is comparable to Go (I believe Go produces code that executes on an event-loop)</p>\n\n<p>Is this feasible? Has it been talked about before?...or have I been 'drinking too much kool-aid'.  I'm definitely way out of my depth on this one in terms of fully understanding how this might be implemented.</p>\n"}, {"tags": ["pointers", "go", "concurrency", "scope"], "comments": [{"owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "edited": false, "score": 1, "creation_date": 1441637345, "post_id": 32438981, "comment_id": 52746499, "body": "Try logging :  <code>log.Printf(&quot;Controller starting with context at address %v&quot;, originContext)</code> at the beginning of your <code>NewController</code> function. You should see twice the same address."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1441644992, "last_edit_date": 1441644992, "creation_date": 1441632827, "answer_id": 32439998, "question_id": 32438981, "link": "https://stackoverflow.com/questions/32438981/how-did-i-confuse-scopes-of-variables-and-pointers-in-goroutines-here/32439998#32439998", "title": "How did I confuse scopes of variables and pointers in goroutines here?", "body": "<p>The problem is on these lines:</p>\n\n<pre><code>    for _, ctx := range contexts {\n            log.Printf(\"Starting Controller %s.\", ctx.Origin)\n            _ = NewController(&amp;ctx)\n    }\n</code></pre>\n\n<p>The variable <code>ctx</code> is reused on every iteration of the loop <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow\">as described in the language specification</a>. <code>NewController</code> is passed address of this single variable on every iteration of loop. The program prints the last values stored in this variable (although that's not guaranteed, there's a race on the variable).</p>\n\n<p><kbd><a href=\"http://play.golang.org/p/8IxrXjeU3U\" rel=\"nofollow\">run example that prints &amp;ctx</a></kbd></p>\n\n<p>There are a few ways to fix this. One way is to change the code to:</p>\n\n<pre><code>for i := range contexts {\n        log.Printf(\"Starting Controller %s.\", context[i].Origin)\n        _ = NewController(&amp;context[i])\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/Y_7lU4bWPk\" rel=\"nofollow\">run it on the playground</a></kbd></p>\n\n<p>With this change, NewController is passed a pointer to the slice element instead of a pointer to variable in the function.</p>\n\n<p>Another option is to declare a new variable inside the body of the loop:</p>\n\n<pre><code>    for _, ctx := range contexts {\n            ctx := ctx // &lt;-- add this line\n            log.Printf(\"Starting Controller %s.\", ctx.Origin)\n            _ = NewController(&amp;ctx)\n    }\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/SmoUefDQCA\" rel=\"nofollow\">run it on the playground</a></kbd></p>\n\n<p>This option allocates a ctx on every iteration through the loop while the first option does not.</p>\n"}], "owner": {"reputation": 205, "user_id": 2715936, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/13vut.jpg?s=128&g=1", "display_name": "Johannes Kohnen", "link": "https://stackoverflow.com/users/2715936/johannes-kohnen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "accepted_answer_id": 32439998, "answer_count": 1, "score": 2, "last_activity_date": 1465464264, "creation_date": 1441629523, "last_edit_date": 1465464264, "question_id": 32438981, "link": "https://stackoverflow.com/questions/32438981/how-did-i-confuse-scopes-of-variables-and-pointers-in-goroutines-here", "title": "How did I confuse scopes of variables and pointers in goroutines here?", "body": "<p>I am learning Go by writing a simple program that concurrently downloads sensor data files from a few http servers. The sensor data files on the servers are refreshed at regular intervals (30 seconds or 2 minutes, depends on the 'origin'). Downloading the data can take from 100ms to 10 seconds. So I read some configurations for each server (OriginContext). Then I start a controller for each OriginContext. Each controller continuously fires a goroutine that does the download etc. </p>\n\n<p>I stripped my code down to a minimal example that somehow/hopefully still shows my intentions. When I run it, there will be two controllers, but somehow when they fire the doStuffThatMayTakeLongTime() methods they all refer to the identical configuration. </p>\n\n<p>So, how did I confuse scopes of variables and pointers in goroutines here? </p>\n\n<p>I am very new to Go and also this is the first time I try to use a language that uses pointers. Well, my shy C/C++ attempts are more than a decade ago... so I assume my confusion is with reference/value/dereference, but I can't see it. </p>\n\n<p>This is the code:</p>\n\n<pre><code>package main\n\nimport (\n        \"log\"\n        \"time\"\n)\n\ntype OriginContext struct {\n        Origin   string\n        Offset   time.Duration\n        Interval time.Duration\n}\n\ntype Controller struct {\n        originContext *OriginContext\n}\n\nfunc NewController(originContext *OriginContext) (w *Controller) {\n        log.Printf(\"Controller starting loop for origin %s.\", originContext.Origin)\n        w = &amp;Controller{originContext}\n        w.start()\n        return w\n}\n\nfunc (w *Controller) start() {\n        log.Println(\"start() of\", w.originContext.Origin)\n        go func() {\n                time.Sleep(w.originContext.Offset)\n                ticker := time.NewTicker(w.originContext.Interval)\n                go w.doStuffThatMayTakeLongTime() // iteration zero\n                for {\n                        select {\n                        case &lt;-ticker.C:\n                                go w.doStuffThatMayTakeLongTime()\n                        }\n                }\n        }()\n}\n\nfunc (w *Controller) doStuffThatMayTakeLongTime() {\n        log.Printf(\"%s doing stuff\", w.originContext.Origin)\n}\n\nfunc main() {\n        contexts := []OriginContext{\n                {\n                        Origin:   \"alpha\",\n                        Offset:   0 * time.Second,\n                        Interval: 5 * time.Second,\n                },\n                {\n                        Origin:   \"bravo\",\n                        Offset:   5 * time.Second,\n                        Interval: 10 * time.Second,\n                },\n        }\n        for _, ctx := range contexts {\n                log.Printf(\"Starting Controller %s.\", ctx.Origin)\n                _ = NewController(&amp;ctx)\n        }\n        select {}\n}\n</code></pre>\n\n<p>And this is some output:</p>\n\n<pre><code>2015/09/07 14:30:11 Starting Controller alpha.\n2015/09/07 14:30:11 Controller starting loop for origin alpha.\n2015/09/07 14:30:11 start() of alpha\n2015/09/07 14:30:11 Starting Controller bravo.\n2015/09/07 14:30:11 Controller starting loop for origin bravo.\n2015/09/07 14:30:11 start() of bravo\n2015/09/07 14:30:16 bravo doing stuff\n2015/09/07 14:30:16 bravo doing stuff\n2015/09/07 14:30:26 bravo doing stuff\n2015/09/07 14:30:26 bravo doing stuff\n</code></pre>\n\n<p>There should be alpha and bravo <em>doing stuff</em>, but there is just bravo. </p>\n"}, {"tags": ["json", "struct", "go"], "answers": [{"comments": [{"owner": {"reputation": 2108, "user_id": 5093039, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1JPIi.jpg?s=128&g=1", "display_name": "hurb", "link": "https://stackoverflow.com/users/5093039/hurb"}, "edited": false, "score": 0, "creation_date": 1441628381, "post_id": 32438490, "comment_id": 52741349, "body": "Thanks a lot. I didn&#39;t even know that public/private is set by upper case/lower case. Sorry for that dumb question. It&#39;s my first day with Go."}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 2108, "user_id": 5093039, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1JPIi.jpg?s=128&g=1", "display_name": "hurb", "link": "https://stackoverflow.com/users/5093039/hurb"}, "edited": false, "score": 1, "creation_date": 1441628523, "post_id": 32438490, "comment_id": 52741447, "body": "You are welcome! Go is very interesting language, but it has some unusual things for the people who came from other languages. So keep <b>go</b>ing!"}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": true, "score": 4, "last_activity_date": 1442917462, "last_edit_date": 1442917462, "creation_date": 1441627998, "answer_id": 32438490, "question_id": 32438306, "link": "https://stackoverflow.com/questions/32438306/unmarshal-json-object-to-struct-in-go-result-is-empty/32438490#32438490", "title": "Unmarshal JSON Object to struct in Go - Result is empty", "body": "<p>Fields of struct you want to Marshal or Unmarshal <strong>must</strong> be exported.<br>\nCheck it out: <a href=\"http://blog.golang.org/json-and-go\" rel=\"nofollow\">http://blog.golang.org/json-and-go</a></p>\n\n<blockquote>\n  <p>The json package only accesses the exported fields of struct types\n  (those that begin with an uppercase letter). Therefore only the the\n  exported fields of a struct will be present in the JSON output.</p>\n</blockquote>\n\n<p>Working sample: <kbd><a href=\"http://play.golang.org/p/EyP1wx6GwR\" rel=\"nofollow\">Go playground</a></kbd></p>\n"}], "owner": {"reputation": 2108, "user_id": 5093039, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1JPIi.jpg?s=128&g=1", "display_name": "hurb", "link": "https://stackoverflow.com/users/5093039/hurb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1467, "favorite_count": 0, "closed_date": 1441629894, "accepted_answer_id": 32438490, "answer_count": 1, "score": 0, "last_activity_date": 1442917462, "creation_date": 1441627466, "last_edit_date": 1495540309, "question_id": 32438306, "link": "https://stackoverflow.com/questions/32438306/unmarshal-json-object-to-struct-in-go-result-is-empty", "closed_reason": "Duplicate", "title": "Unmarshal JSON Object to struct in Go - Result is empty", "body": "<p>I'm trying to unmarshal a json object to struct in Go. I tried to stick to <a href=\"http://play.golang.org/p/KRrJ-zsKot\" rel=\"nofollow noreferrer\">this example</a> but I can't get it to work. The result stays empty.</p>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype MyObject struct {\n    id     string\n    pubKey string\n}\n\nfunc main() {\n    x := `{\"id\":\"abc\",\"pubKey\":\"QIDAQAB\"}`\n    fmt.Println(\"Input: \", x)\n\n    var myObject MyObject\n    json.Unmarshal([]byte(x), &amp;myObject)\n\n    fmt.Println(\"Output: \", myObject)\n}\n</code></pre>\n\n<p><strong>Output:</strong></p>\n\n<pre><code>Input:  {\"id\":\"abc\",\"pubKey\":\"QIDAQAB\"}\nOutput:  { }\n</code></pre>\n\n<p><strong><a href=\"http://play.golang.org/p/O22HCcHzgk\" rel=\"nofollow noreferrer\">Playground</a></strong></p>\n\n<p>I found a <a href=\"https://stackoverflow.com/questions/22528820/unmarshal-json-array-to-struct\">lot</a> <a href=\"https://stackoverflow.com/questions/26511417/unmarshal-json-data-in-a-specific-struct-in-golang\">of</a> <a href=\"https://stackoverflow.com/questions/23798283/golang-unmarshal-json\">similar</a> questions but I can't even see a difference between the working example and my non-working code. What am I missing?</p>\n"}, {"tags": ["windows", "go", "desktop-shortcut"], "comments": [{"owner": {"reputation": 116, "user_id": 567512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b4319173ff1a5fb56ea2cfbd6781414?s=128&d=identicon&r=PG", "display_name": "reedobrien", "link": "https://stackoverflow.com/users/567512/reedobrien"}, "edited": false, "score": 0, "creation_date": 1441640111, "post_id": 32438204, "comment_id": 52747951, "body": "I don&#39;t know windows and don&#39;t have access to it to test. However, AFAIU lnk is the equivalent of a symlink on *nix. So I would try <a href=\"https://golang.org/pkg/os/#Symlink\" rel=\"nofollow noreferrer\">os.Symlink</a> as I would expect that to work cross platform unless otherwise documented. <i>(I may be conflating symlinks and shortcuts)</i>."}], "answers": [{"comments": [{"owner": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "edited": false, "score": 0, "creation_date": 1441720183, "post_id": 32444011, "comment_id": 52781201, "body": "Thanks ! I will try it and (obviously) post it on Github if I succeed ! c:"}, {"owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "reply_to_user": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "edited": false, "score": 0, "creation_date": 1441726029, "post_id": 32444011, "comment_id": 52785337, "body": "@AlexisPaques Do let me know, when you do that."}, {"owner": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "edited": false, "score": 0, "creation_date": 1441726488, "post_id": 32444011, "comment_id": 52785631, "body": "First I will just use the external solution, then, maybe, will try to do it in golang"}], "tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": false, "score": 1, "last_activity_date": 1441649007, "creation_date": 1441649007, "answer_id": 32444011, "question_id": 32438204, "link": "https://stackoverflow.com/questions/32438204/create-a-windows-shortcut-lnk-in-go/32444011#32444011", "title": "Create a Windows Shortcut (.lnk) in Go", "body": "<p><strong>No, there isn't any pretty method for creating .lnk file, in golang.</strong></p>\n\n<p>Primary reason is that, .lnk files are windows specific.</p>\n\n<p>In Windows, even a native program need to use OLE (Object linking and embedding) and COM (component object model) to create a shortcut file, as described in <a href=\"https://stackoverflow.com/a/3907013/316240\">this answer</a>. </p>\n\n<p>In my opinion, One way to approach this problem in golang is to use <a href=\"https://github.com/luisiturrios/gowin\" rel=\"nofollow\">gowin</a>, and try to communicate with OLE COM. </p>\n\n<p>OR</p>\n\n<p>Write a native windows component that does actual work of creating .lnk file, and just spawn its process through your go program.</p>\n"}, {"tags": [], "owner": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "is_accepted": false, "score": 1, "last_activity_date": 1441721568, "last_edit_date": 1490005104, "creation_date": 1441721568, "answer_id": 32460099, "question_id": 32438204, "link": "https://stackoverflow.com/questions/32438204/create-a-windows-shortcut-lnk-in-go/32460099#32460099", "title": "Create a Windows Shortcut (.lnk) in Go", "body": "<p>Solution via external program from <a href=\"https://superuser.com/questions/392061/how-to-make-a-shortcut-from-cmd\">this subject</a>: </p>\n\n<p>Shortcut executable from <a href=\"http://nircmd.nirsoft.net/shortcut.html\" rel=\"nofollow noreferrer\">NirSoft</a></p>\n\n<pre><code>shortcut \"f:\\winnt\\system32\\calc.exe\" \"~$folder.desktop$\" \"Windows Calculator\" \nshortcut \"f:\\winnt\\system32\\calc.exe\" \"~$folder.programs$\\Calculators\" \"Windows Calculator\" \nshortcut \"f:\\Program Files\\KaZaA\\Kazaa.exe\" \"c:\\temp\\MyShortcuts\" \"Kazaa\" \nshortcut \"f:\\Program Files\" \"c:\\temp\\MyShortcuts\" \"Program Files Folder\" \"\" \"f:\\winnt\\system32\\shell32.dll\" 45 \nshortcut \"f:\\Program Files\" \"c:\\temp\\MyShortcuts\" \"Program Files Folder\" \"\" \"\" \"\" \"max\"\n</code></pre>\n\n<p>Shortcut executable from <a href=\"http://optimumx.com/download/Shortcut.zip\" rel=\"nofollow noreferrer\">Optimumx</a></p>\n\n<pre><code>Shortcut.exe /f:\"%USERPROFILE%\\Desktop\\sc.lnk\" /a:c  /t:%USERPROFILE%\\Desktop\\scrum.pdf\n</code></pre>\n\n<p>.vbs </p>\n\n<pre><code>Set oWS = WScript.CreateObject(\"WScript.Shell\")\nsLinkFile = \"C:\\MyShortcut.LNK\"\nSet oLink = oWS.CreateShortcut(sLinkFile)\n    oLink.TargetPath = \"C:\\Program Files\\MyApp\\MyProgram.EXE\"\n '  oLink.Arguments = \"\"\n '  oLink.Description = \"MyProgram\"   \n '  oLink.HotKey = \"ALT+CTRL+F\"\n '  oLink.IconLocation = \"C:\\Program Files\\MyApp\\MyProgram.EXE, 2\"\n '  oLink.WindowStyle = \"1\"   \n '  oLink.WorkingDirectory = \"C:\\Program Files\\MyApp\"\noLink.Save\n</code></pre>\n\n<p>Powershell script</p>\n\n<pre><code>set TARGET='D:\\Temp'\nset SHORTCUT='C:\\Temp\\test.lnk'\nset PWS=powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile\n\n%PWS% -Command \"$ws = New-Object -ComObject WScript.Shell; $s = $ws.CreateShortcut(%SHORTCUT%); $S.TargetPath = %TARGET%; $S.Save()\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1441767163, "post_id": 32467891, "comment_id": 52802110, "body": "You could use back-quoted Go string literals to avoid needing to escape quotes (\\&quot;). You can also use those to make readable multi-line string literals to decrease the number of <code>WriteString</code> calls you make. You could also use something like <code>text&#47;template</code> with the template in a single string literal to make it much more readable (and still easily put the contents of your variables into the script)."}, {"owner": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1441791533, "post_id": 32467891, "comment_id": 52812850, "body": "What about the performances ? I used the concatenation (+=) with a simple string, it was readable then I read this : <a href=\"http://stackoverflow.com/a/23857998/3540247\">Stackoverflow</a> and it was 4 thousand times faster with the buffer (copy is 3 times faster than the buffer but less readable I think)"}, {"owner": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1441792468, "post_id": 32467891, "comment_id": 52813534, "body": "After looking at text/template, it is exactly what I need ! :o"}], "tags": [], "owner": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "is_accepted": true, "score": 1, "last_activity_date": 1441750943, "last_edit_date": 1441750943, "creation_date": 1441749402, "answer_id": 32467891, "question_id": 32438204, "link": "https://stackoverflow.com/questions/32438204/create-a-windows-shortcut-lnk-in-go/32467891#32467891", "title": "Create a Windows Shortcut (.lnk) in Go", "body": "<p>The <strong>AWFUL</strong> <em>Working</em> golang solution using VBS;</p>\n\n<pre><code>package main\n\nimport(\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc createShortcut(linkName string, target string, arguments string, directory string, description string, destination string) {\n    var scriptTxt bytes.Buffer\n    scriptTxt.WriteString(\"option explicit\\n\\n\")\n    scriptTxt.WriteString(\"sub CreateShortCut()\\n\")\n    scriptTxt.WriteString(\"dim objShell, strDesktopPath, objLink\\n\")\n    scriptTxt.WriteString(\"set objShell = CreateObject(\\\"WScript.Shell\\\")\\n\")\n    scriptTxt.WriteString(\"strDesktopPath = objShell.SpecialFolders(\\\"\")\n    scriptTxt.WriteString(destination)\n    scriptTxt.WriteString(\"\\\")\\n\")\n    scriptTxt.WriteString(\"set objLink = objShell.CreateShortcut(strDesktopPath &amp; \\\"\\\\\")\n    scriptTxt.WriteString(linkName)\n    scriptTxt.WriteString(\".lnk\\\")\\n\")\n    scriptTxt.WriteString(\"objLink.Arguments = \\\"\")\n    scriptTxt.WriteString(arguments)\n    scriptTxt.WriteString(\"\\\"\\n\")\n    scriptTxt.WriteString(\"objLink.Description = \\\"\")\n    scriptTxt.WriteString(description)\n    scriptTxt.WriteString(\"\\\"\\n\")\n    scriptTxt.WriteString(\"objLink.TargetPath = \\\"\")\n    scriptTxt.WriteString(target)\n    scriptTxt.WriteString(\"\\\"\\n\")\n    scriptTxt.WriteString(\"objLink.WindowStyle = 1\\n\")\n    scriptTxt.WriteString(\"objLink.WorkingDirectory = \\\"\")\n    scriptTxt.WriteString(directory)\n    scriptTxt.WriteString(\"\\\"\\n\")\n    scriptTxt.WriteString(\"objLink.Save\\nend sub\\n\\n\")\n    scriptTxt.WriteString(\"call CreateShortCut()\")\n    fmt.Print(scriptTxt.String())\n\n    filename := fmt.Sprintf(\"lnkTo%s.vbs\", destination)\n    ioutil.WriteFile(filename, scriptTxt.Bytes(), 0777)\n    cmd := exec.Command(\"wscript\", filename)\n    err := cmd.Run()\n    if err != nil {\n        fmt.Println(err)\n    }\n    cmd.Wait()\n    os.Remove(filename)\n    return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "edited": false, "score": 0, "creation_date": 1485504236, "post_id": 41886180, "comment_id": 70960720, "body": "One year later, I finally have a true solution! Thanks :D"}, {"owner": {"reputation": 1765, "user_id": 332798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d47656e20ff5e42f125fc5ea0fd636c6?s=128&d=identicon&r=PG", "display_name": "tmm1", "link": "https://stackoverflow.com/users/332798/tmm1"}, "reply_to_user": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "edited": false, "score": 2, "creation_date": 1508875931, "post_id": 41886180, "comment_id": 80785830, "body": "After running this in production for many months, I&#39;ve noticed some rare failures with the message &quot;CoInitialize has not been called.&quot;. To fix this you need to ensure that runtime.LockOSThread() is called, or use the comshim library as outlined in <a href=\"https://github.com/go-ole/go-ole/issues/124\" rel=\"nofollow noreferrer\">github.com/go-ole/go-ole/issues/124</a>"}, {"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1603719576, "post_id": 41886180, "comment_id": 114116713, "body": "Adding here that <code>dst</code> and <code>src</code> should be of type <code>string</code>. This is automatically made into an appropriate UTF16 encoding under the hood as needed."}], "tags": [], "owner": {"reputation": 1765, "user_id": 332798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d47656e20ff5e42f125fc5ea0fd636c6?s=128&d=identicon&r=PG", "display_name": "tmm1", "link": "https://stackoverflow.com/users/332798/tmm1"}, "is_accepted": false, "score": 6, "last_activity_date": 1534157943, "last_edit_date": 1534157943, "creation_date": 1485483734, "answer_id": 41886180, "question_id": 32438204, "link": "https://stackoverflow.com/questions/32438204/create-a-windows-shortcut-lnk-in-go/41886180#41886180", "title": "Create a Windows Shortcut (.lnk) in Go", "body": "<p>Using <a href=\"https://github.com/go-ole/go-ole\" rel=\"nofollow noreferrer\">https://github.com/go-ole/go-ole</a>:</p>\n\n<pre><code>ole.CoInitializeEx(0, ole.COINIT_APARTMENTTHREADED|ole.COINIT_SPEED_OVER_MEMORY)\noleShellObject, err := oleutil.CreateObject(\"WScript.Shell\")\nif err != nil {\n    return err\n}\ndefer oleShellObject.Release()\nwshell, err := oleShellObject.QueryInterface(ole.IID_IDispatch)\nif err != nil {\n    return err\n}\ndefer wshell.Release()\ncs, err := oleutil.CallMethod(wshell, \"CreateShortcut\", dst)\nif err != nil {\n    return err\n}\nidispatch := cs.ToIDispatch()\noleutil.PutProperty(idispatch, \"TargetPath\", src)\noleutil.CallMethod(idispatch, \"Save\")\n</code></pre>\n"}], "owner": {"reputation": 1486, "user_id": 3540247, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ea801bfd8e27fe6783d2660a6ba87d10?s=128&d=identicon&r=PG", "display_name": "Alexis Paques", "link": "https://stackoverflow.com/users/3540247/alexis-paques"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3017, "favorite_count": 1, "accepted_answer_id": 32467891, "answer_count": 4, "score": 1, "last_activity_date": 1534157943, "creation_date": 1441627180, "question_id": 32438204, "link": "https://stackoverflow.com/questions/32438204/create-a-windows-shortcut-lnk-in-go", "title": "Create a Windows Shortcut (.lnk) in Go", "body": "<p>I would like to create a Windows Shortcut (.lnk) to the desktop and the startmenu in Golang.</p>\n\n<p>I actually got the Desktop &amp; Startmenu folders via the <a href=\"https://github.com/luisiturrios/gowin\" rel=\"nofollow\">gowin</a> module and I would like to create a shortcut to thoses locations.</p>\n\n<p>I searched but I did not find any golang project for it. Should I create it ? Is there an other pretty method ?</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 974, "user_id": 1454877, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5e931c7352cde70c76c1eb25a8a8f749?s=128&d=identicon&r=PG", "display_name": "Engineer81", "link": "https://stackoverflow.com/users/1454877/engineer81"}, "edited": false, "score": 0, "creation_date": 1441628950, "post_id": 32438476, "comment_id": 52741728, "body": "Thanks @matt-joiner, of course I&#39;d returned... I had previously got one go routine per message and they were returning when done. When I moved it to just running 10 I forgot to change <code>return</code> to <code>continue</code>."}, {"owner": {"reputation": 974, "user_id": 1454877, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5e931c7352cde70c76c1eb25a8a8f749?s=128&d=identicon&r=PG", "display_name": "Engineer81", "link": "https://stackoverflow.com/users/1454877/engineer81"}, "edited": false, "score": 0, "creation_date": 1441630443, "post_id": 32438476, "comment_id": 52742595, "body": "OK, I&#39;ve finished processing your response now I&#39;ve fixed the <code>return</code>/<code>continue</code> issue. Thanks for the suggestion about semaphores; I shall read up on the subject. I don&#39;t need these workers to return, no. They should just process the message which contains a callback URI, so they just call that and then wait for the next message. Appreciate the pointers on <code>sync.WaitGroup</code> and the 2-tuple return channel receive expression however. Thanks again for your help"}], "tags": [], "owner": {"reputation": 99684, "user_id": 149482, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cb6a2b464b7190c48e4f148a0e51d13a?s=128&d=identicon&r=PG", "display_name": "Matt Joiner", "link": "https://stackoverflow.com/users/149482/matt-joiner"}, "is_accepted": true, "score": 3, "last_activity_date": 1441627945, "creation_date": 1441627945, "answer_id": 32438476, "question_id": 32437881, "link": "https://stackoverflow.com/questions/32437881/how-to-perform-concurrent-downloads-in-go/32438476#32438476", "title": "How to perform concurrent downloads in Go", "body": "<p>That looks fine. A few notes:</p>\n\n<ol>\n<li><p>You can limit the work parallelism by means other than limiting the number of worker routines you spawn. For example you can create a goroutine for every message received, and then have the spawned goroutine wait for a semaphore that limits the parallelism. Of course there are tradeoffs, but you aren't limited to just the way you've described.</p>\n\n<pre><code>sem := make(chan struct{}, n)\nwork := func(m sqs.Message) {\n    sem &lt;- struct{}{} // When there's room we can proceed\n    // do the work\n    &lt;-sem // Free room in the channel\n}()\nfor _, m := range queue.ReceiveMessage(MAX_SQS_MESSAGES) {\n    for _, m0 := range m {\n        go work(m0)\n    }\n}\n</code></pre></li>\n<li><p>The limit of only 10 messages being processed is being caused elsewhere in your stack. Possibly you're seeing a race where the first 10 fill the channel, and then the work isn't completing, or perhaps you're accidentally returning from the worker routines. If your workers are persistent per the model you've described, you'll want to be certain that they don't return.</p></li>\n<li><p>It's not clear if you want the process to return after you've processed some number of messages. If you do want this process to exit, you'll need to wait for all the workers to finish their current tasks, and probably signal them to return afterwards. Take a look at <code>sync.WaitGroup</code> for synchronizing their completion, and having another channel to signal that there's no more work, or close <code>msgChannel</code>, and handle that in your workers. (Take a look at the 2-tuple return channel receive expression.) </p></li>\n</ol>\n"}], "owner": {"reputation": 974, "user_id": 1454877, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5e931c7352cde70c76c1eb25a8a8f749?s=128&d=identicon&r=PG", "display_name": "Engineer81", "link": "https://stackoverflow.com/users/1454877/engineer81"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 759, "favorite_count": 2, "accepted_answer_id": 32438476, "answer_count": 1, "score": 5, "last_activity_date": 1441627945, "creation_date": 1441626222, "last_edit_date": 1441626625, "question_id": 32437881, "link": "https://stackoverflow.com/questions/32437881/how-to-perform-concurrent-downloads-in-go", "title": "How to perform concurrent downloads in Go", "body": "<p>We have a process whereby users request files that we need to get from our source. This source isn't the most reliable so we implemented a queue using Amazon SQS. We put the download URL into the queue and then we poll it with a small app that we wrote in Go. This app simply retrieves the messages, downloads the file and then pushes it to S3 where we store it. Once all of this is complete it calls back a service which will email the user to let them know that the file is ready.</p>\n\n<p>Originally I wrote this to create <em>n</em> channels and then attached 1 go-routine to each and had the go-routine in an infinite loop. This way I could ensure that I was only ever processing a fixed number of downloads at a time.</p>\n\n<p>I realised that this isn't the way that channels are supposed to be used and, if I'm understanding correctly now, there should actually be one channel with <em>n</em> go-routines receiving on that channel. Each go-routine is in an infinite loop, waiting on a message and when it receives it will process the data, do everything that it's supposed to and when it's done it will wait on the next message. This allows me to ensure that I'm only ever processing <em>n</em> files at a time. I think this is the right way to do it. I believe this is <em>fan-out</em>, right?</p>\n\n<p>What I <em>don't</em> need to do, is to merge these processes back together. Once the download is done it is calling back a remote service so that handles the remainder of the process. There is nothing else that the app needs to do.</p>\n\n<p>OK, so some code:</p>\n\n<pre><code>func main() {\n    queue, err := ConnectToQueue() // This works fine...\n    if err != nil {\n        log.Fatalf(\"Could not connect to queue: %s\\n\", err)\n    }\n\n    msgChannel := make(chan sqs.Message, 10)\n\n    for i := 0; i &lt; MAX_CONCURRENT_ROUTINES; i++ {\n        go processMessage(msgChannel, queue)\n    }\n\n    for {\n        response, _ := queue.ReceiveMessage(MAX_SQS_MESSAGES)\n\n        for _, m := range response.Messages {\n            msgChannel &lt;- m\n        }\n    }\n}\n\nfunc processMessage(ch &lt;-chan sqs.Message, queue *sqs.Queue) {\n    for {\n        m := &lt;-ch\n        // Do something with message m\n\n        // Delete message from queue when we're done\n        queue.DeleteMessage(&amp;m)\n    }\n}\n</code></pre>\n\n<p>Am I anywhere close here? I have <em>n</em> running go-routines (where <code>MAX_CONCURRENT_ROUTINES</code> = <em>n</em>) and in the loop we will keep passing messages in to the single channel. Is this the right way to do it? Do I need to close anything or can I just leave this running indefinitely?</p>\n\n<p>One thing that I'm noticing is that SQS is returning messages but once I've had 10 messages passed into <code>processMessage()</code> (10 being the size of the channel buffer) that no further messages are actually processed.</p>\n\n<p>Thanks all</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 9, "last_activity_date": 1441623688, "last_edit_date": 1441623688, "creation_date": 1441623307, "answer_id": 32436949, "question_id": 32436885, "link": "https://stackoverflow.com/questions/32436885/how-to-marshal-xml-in-go-but-ignore-empty-fields/32436949#32436949", "title": "How to marshal xml in Go but ignore empty fields", "body": "<p>Use <code>omitempty</code> flag on <code>street</code> field.</p>\n\n<p>From <a href=\"http://golang.org/pkg/encoding/xml/#Marshal\" rel=\"noreferrer\">Go XML package</a>:</p>\n\n<blockquote>\n  <ul>\n  <li>a field with a tag including the \"omitempty\" option is omitted\n  if the field value is empty. The empty values are false, 0, any\n  nil pointer or interface value, and any array, slice, map, or\n  string of length zero.</li>\n  </ul>\n</blockquote>\n\n<p>In case of your example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\ntype MyThing struct {\n    XMLName xml.Name `xml:\"body\"`\n    Name    string   `xml:\"name,attr\"`\n    Street  string   `xml:\"street,attr,omitempty\"`\n}\n\nfunc main() {\n    var thing *MyThing = &amp;MyThing{Name: \"Canister\"}\n    result, _ := xml.Marshal(thing)\n    fmt.Println(string(result))\n}\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/43fOHP0geJ\" rel=\"noreferrer\">Playground</a></kbd></p>\n"}], "owner": {"reputation": 1603, "user_id": 703636, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4982f461770c62eea10e1966ea6388d0?s=128&d=identicon&r=PG", "display_name": "Sekm", "link": "https://stackoverflow.com/users/703636/sekm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2979, "favorite_count": 0, "accepted_answer_id": 32436949, "answer_count": 1, "score": 7, "last_activity_date": 1441623688, "creation_date": 1441623086, "last_edit_date": 1441623459, "question_id": 32436885, "link": "https://stackoverflow.com/questions/32436885/how-to-marshal-xml-in-go-but-ignore-empty-fields", "title": "How to marshal xml in Go but ignore empty fields", "body": "<p>If I have a struct which I want to be able to Marhsal/Unmarshal things in and out of xml with (using encoding/xml) - how can I <strong>not</strong> print attributes which are empty?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\ntype MyThing struct {\n    XMLName xml.Name `xml:\"body\"`\n    Name    string   `xml:\"name,attr\"`\n    Street  string   `xml:\"street,attr\"`\n}\n\nfunc main() {\n    var thing *MyThing = &amp;MyThing{Name: \"Canister\"}\n    result, _ := xml.Marshal(thing)\n    fmt.Println(string(result))\n}\n</code></pre>\n\n<p>For example see <a href=\"http://play.golang.org/p/K9zFsuL1Cw\" rel=\"noreferrer\">http://play.golang.org/p/K9zFsuL1Cw</a></p>\n\n<p>In the above playground I'd not want to write out my empty <em>street</em> attribute; how could I do that?</p>\n"}, {"tags": ["rest", "go", "controller", "resources", "revel"], "comments": [{"owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "edited": false, "score": 3, "creation_date": 1441623340, "post_id": 32436827, "comment_id": 52738224, "body": "Is this what you are trying to do? <a href=\"http://stackoverflow.com/questions/23030884/is-there-a-way-to-create-an-instance-of-a-struct-from-a-string\" title=\"is there a way to create an instance of a struct from a string\">stackoverflow.com/questions/23030884/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15778, "user_id": 3706693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c23cb4348804fbc993d70df4cab71fc?s=128&d=identicon&r=PG", "display_name": "num8er", "link": "https://stackoverflow.com/users/3706693/num8er"}, "edited": false, "score": 0, "creation_date": 1441623912, "post_id": 32437105, "comment_id": 52738550, "body": "this is how my code looks like now: <a href=\"http://joxi.ru/0KAgEEehM0QWml\" rel=\"nofollow noreferrer\">joxi.ru/0KAgEEehM0QWml</a>  and the error: <a href=\"http://joxi.ru/9E2pMMKFz0lZAY\" rel=\"nofollow noreferrer\">joxi.ru/9E2pMMKFz0lZAY</a>"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 15778, "user_id": 3706693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c23cb4348804fbc993d70df4cab71fc?s=128&d=identicon&r=PG", "display_name": "num8er", "link": "https://stackoverflow.com/users/3706693/num8er"}, "edited": false, "score": 1, "creation_date": 1441624191, "post_id": 32437105, "comment_id": 52738700, "body": "That still won&#39;t work because you can&#39;t call methods on <code>interface{}</code>, (because it has no methods). You&#39;d still need to <a href=\"http://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assert</a> it to do it that way, and if you will, there is no point to try and instantiate a type from a string. This is something that would work well in a dynamic language, not in Go."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 3, "last_activity_date": 1441623813, "creation_date": 1441623813, "answer_id": 32437105, "question_id": 32436827, "link": "https://stackoverflow.com/questions/32436827/trying-to-convert-string-to-instance-variable/32437105#32437105", "title": "Trying to convert string to instance variable", "body": "<p>Your problem is here:</p>\n\n<pre><code>model := reflect.New(resource)\n</code></pre>\n\n<p>You can't instantiate a type from a string that way. You need to either use a switch there and do stuff depending on the model:</p>\n\n<pre><code>switch resource {\ncase \"users\":\n    model := &amp;Users{}\n    fmt.Println(model.All())\ncase \"posts\":\n    // ...\n}\n</code></pre>\n\n<p>Or use <code>reflect</code> correctly. Something like:</p>\n\n<pre><code>var types = map[string]reflect.Type{\n    \"users\": reflect.TypeOf(Users{}) // Or &amp;Users{}.\n}\n\n// ...\n\nmodel := reflect.New(types[resource])\nres := model.MethodByName(\"All\").Call(nil)\nfmt.Println(res)\n</code></pre>\n"}], "owner": {"reputation": 15778, "user_id": 3706693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c23cb4348804fbc993d70df4cab71fc?s=128&d=identicon&r=PG", "display_name": "num8er", "link": "https://stackoverflow.com/users/3706693/num8er"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 1, "accepted_answer_id": 32437105, "answer_count": 1, "score": 1, "last_activity_date": 1587590471, "creation_date": 1441622906, "last_edit_date": 1587590471, "question_id": 32436827, "link": "https://stackoverflow.com/questions/32436827/trying-to-convert-string-to-instance-variable", "title": "Trying to convert string to instance variable", "body": "<p>I'm new to GO language.\nTrying to learn GO by building real web application.\nI'm using revel framework.</p>\n\n<p>And here is my resource routes:</p>\n\n<pre><code>GET     /resource/:resource                     Resource.ReadAll\nGET     /resource/:resource/:id                 Resource.Read\nPOST    /resource/:resource                     Resource.Create\nPUT     /resource/:resource/:id                 Resource.Update\nDELETE  /resource/:resource/:id                 Resource.Delete\n</code></pre>\n\n<p>for example:</p>\n\n<p><code>GET /resource/users</code> calls <code>Resource.ReadAll(\"users\")</code></p>\n\n<p>And this is my Resource controller (it's just a dummy actions for now):</p>\n\n<pre><code>type Resource struct {\n    *revel.Controller\n}\n\ntype User struct {\n    Id int\n    Username string\n    Password string\n}\n\ntype Users struct {}\n\nfunc (u Users) All() string {\n        return \"All\"\n}\n\nfunc (c Resource) ReadAll(resource string) revel.Result {\n    fmt.Printf(\"GET %s\", resource)\n    model := reflect.New(resource)\n    fmt.Println(model.All())\n    return nil\n}\n</code></pre>\n\n<p>I'm trying get instance of Users struct by converting <strong>resource string</strong> to object to call <strong>All</strong> function.<br/></p>\n\n<p>and the error:</p>\n\n<blockquote>\n  <p>cannot use resource (type string) as type reflect.Type in argument to\n  reflect.New:  string does not implement reflect.Type (missing Align\n  method)</p>\n</blockquote>\n\n<p>I'm new to GO please don't judge me :)</p>\n"}, {"tags": ["http", "go", "listener"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1441623536, "post_id": 32436288, "comment_id": 52738329, "body": "Most connections transition to <code>StateIdle</code>, not <code>StateClosed</code>"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1441624479, "post_id": 32436288, "comment_id": 52738859, "body": "As JimB say. And you can change default behaviour with server.SetKeepAlivesEnabled(false)"}, {"owner": {"reputation": 43, "user_id": 4574985, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d3c9f18b22f0567a84265111054e2b7?s=128&d=identicon&r=PG&f=1", "display_name": "nattawitc", "link": "https://stackoverflow.com/users/4574985/nattawitc"}, "edited": false, "score": 0, "creation_date": 1441682886, "post_id": 32436288, "comment_id": 52760611, "body": "Thank you, that fixed my problem."}], "owner": {"reputation": 43, "user_id": 4574985, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d3c9f18b22f0567a84265111054e2b7?s=128&d=identicon&r=PG&f=1", "display_name": "nattawitc", "link": "https://stackoverflow.com/users/4574985/nattawitc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 185, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1441621118, "creation_date": 1441621118, "question_id": 32436288, "link": "https://stackoverflow.com/questions/32436288/http-server-does-not-stop-when-i-call-listener-close", "title": "http server does not stop when I call listener.Close()", "body": "<p>I'm trying to write a http server which when received terminate signal, it will wait until all requests has been responsed then close with code below</p>\n\n<pre><code>// start server\nvar wg sync.WaitGroup\nserver := &amp;http.Server{\n    ConnState: func(conn net.Conn, state http.ConnState) {\n        switch state {\n        case http.StateNew:\n            wg.Add(1)\n        case http.StateClosed:\n            wg.Done()\n        }\n    },\n}\n\ngo func(server *http.Server, listener net.Listener, terminate chan&lt;- int) {\n    var status int\n    if err := server.Serve(listener); err != nil {\n        if !strings.Contains(err.Error(), \"use of closed network connection\") {\n            log.Println(err)\n            status = 1\n        } else {\n            status = 0\n        }\n    } else {\n        status = 0\n    }\n\n    log.Printf(\"performing graceful close on all clients\\n\")\n    wg.Wait()\n\n    terminate &lt;- status\n}(server, listener, terminate)\n</code></pre>\n\n<p>but when I call <code>listener.Close()</code> it stuck at <code>wg.Wait()</code> even though all request has already been response. And while it wait, if I send another request, it still give a response correctly.</p>\n"}, {"tags": ["c++", "boost", "go", "stl", "raii"], "comments": [{"owner": {"reputation": 32386, "user_id": 4706785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fdee2789e9bac57bfdd97abc4e533a4d?s=128&d=identicon&r=PG&f=1", "display_name": "Peter", "link": "https://stackoverflow.com/users/4706785/peter"}, "edited": false, "score": 1, "creation_date": 1441608683, "post_id": 32432450, "comment_id": 52730002, "body": "The STL does not.   But both those links give small samples (a few lines) of C++11 code to achieve the behaviour your seek, so you would probably spend more time trying to find a library to provide the capability than to roll your own."}], "answers": [{"comments": [{"owner": {"reputation": 326119, "user_id": 85371, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/6d52c235ec6dd15f30bab444103e7af2?s=128&d=identicon&r=PG", "display_name": "sehe", "link": "https://stackoverflow.com/users/85371/sehe"}, "edited": false, "score": 2, "creation_date": 1441613867, "post_id": 32433012, "comment_id": 52732793, "body": "And there&#39;s of course <code>unique_ptr</code> which already does 90% of the same things; Further more there&#39;s Boost <a href=\"http://www.boost.org/doc/libs/1_59_0/libs/scope_exit/doc/html/index.html\" rel=\"nofollow noreferrer\">ScopeExit</a>. Can you tell I&#39;m too lazy to actually write the answer :)"}, {"owner": {"reputation": 5049, "user_id": 658298, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/61e78572f508988c4a1713fc4db495b9?s=128&d=identicon&r=PG", "display_name": "Adrian Ratnapala", "link": "https://stackoverflow.com/users/658298/adrian-ratnapala"}, "edited": false, "score": 0, "creation_date": 1464078633, "post_id": 32433012, "comment_id": 62323479, "body": "I was tempted to use unique_ptr as well, but then it would have a dummy pointer which I would want to fill out using a NULL.  But if I did that, would it call the deleter?"}, {"owner": {"reputation": 374839, "user_id": 734069, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a356923f858fbe363dad1dc566837fc6?s=128&d=identicon&r=PG", "display_name": "Nicol Bolas", "link": "https://stackoverflow.com/users/734069/nicol-bolas"}, "edited": false, "score": 0, "creation_date": 1468090722, "post_id": 32433012, "comment_id": 63989049, "body": "@Jens: Bad news; <a href=\"http://stackoverflow.com/a/38285263/734069\">it looks like scope_exit et. al won&#39;t make C++17</a>."}, {"owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "reply_to_user": {"reputation": 374839, "user_id": 734069, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a356923f858fbe363dad1dc566837fc6?s=128&d=identicon&r=PG", "display_name": "Nicol Bolas", "link": "https://stackoverflow.com/users/734069/nicol-bolas"}, "edited": false, "score": 0, "creation_date": 1468139575, "post_id": 32433012, "comment_id": 63997932, "body": "@NicolBolas Yeah, I think I am not the only one who is a little disappointed by the next standard. No concepts, no modules, but at least a bunch of library extensions. I wonder if it would be better to split the library into its own standard. Language tend to evolve slowly, but libraries should evolve faster than a three-year cycle."}, {"owner": {"reputation": 13376, "user_id": 873025, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/d8rRW.jpg?s=128&g=1", "display_name": "Snps", "link": "https://stackoverflow.com/users/873025/snps"}, "reply_to_user": {"reputation": 5049, "user_id": 658298, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/61e78572f508988c4a1713fc4db495b9?s=128&d=identicon&r=PG", "display_name": "Adrian Ratnapala", "link": "https://stackoverflow.com/users/658298/adrian-ratnapala"}, "edited": false, "score": 2, "creation_date": 1493310140, "post_id": 32433012, "comment_id": 74373147, "body": "@AdrianRatnapala The deleter will <i>not</i> get called when the internal pointer is <code>nullptr</code>."}], "tags": [], "owner": {"reputation": 8075, "user_id": 2169853, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/68b89009f4066d3e1adbe72d4329c8d3?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/2169853/jens"}, "is_accepted": true, "score": 10, "last_activity_date": 1515104024, "last_edit_date": 1515104024, "creation_date": 1441609808, "answer_id": 32433012, "question_id": 32432450, "link": "https://stackoverflow.com/questions/32432450/what-is-standard-defer-finalizer-implementation-in-c/32433012#32433012", "title": "What is standard defer/finalizer implementation in C++?", "body": "<p>There is a <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4189.pdf\" rel=\"nofollow noreferrer\">proposal for <code>std::unique_resource_t</code></a> which will enable code like</p>\n\n<pre><code>auto file=make_unique_resource(::fopen(filename.c_str(),\"w\"),&amp;::fclose);\n</code></pre>\n\n<p>for resources, and it defines a general <code>scope_exit</code>, which should be the same as <code>defer</code>:</p>\n\n<pre><code>// Always say goodbye before returning,\nauto goodbye = make_scope_exit([&amp;out]() -&gt;void\n{\nout &lt;&lt; \"Goodbye world...\" &lt;&lt; std::endl;\n});\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/30405269/will-there-be-standardization-of-scope-guard-scope-exit-idioms\">It will be considered for likely adoption in the Post-C++17 standard.</a></p>\n"}, {"comments": [{"owner": {"reputation": 1734, "user_id": 1565238, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cd5ac413e588dd1a030e00f1dea143ee?s=128&d=identicon&r=PG", "display_name": "Aleksander Alekseev", "link": "https://stackoverflow.com/users/1565238/aleksander-alekseev"}, "edited": false, "score": 1, "creation_date": 1441692954, "post_id": 32435143, "comment_id": 52763570, "body": "Excuse me, but shouldn&#39;t ScopeGuard be bound to any variable in this example?"}, {"owner": {"reputation": 19199, "user_id": 1424877, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/8a14e5bb44bbb4c2721ac711bd8a7bcf?s=128&d=identicon&r=PG", "display_name": "Quuxplusone", "link": "https://stackoverflow.com/users/1424877/quuxplusone"}, "edited": false, "score": 0, "creation_date": 1470594970, "post_id": 32435143, "comment_id": 65001579, "body": "Sadly, the use of <code>std::function</code> here will kill your codegen; you really don&#39;t want to do it. See <a href=\"https://www.youtube.com/watch?v=lKG1m2NkANM\" rel=\"nofollow noreferrer\">this presentation</a> starting at 10m58s."}], "tags": [], "owner": {"reputation": 7042, "user_id": 1671032, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FfJD4.jpg?s=128&g=1", "display_name": "PSIAlt", "link": "https://stackoverflow.com/users/1671032/psialt"}, "is_accepted": false, "score": 0, "last_activity_date": 1441699571, "last_edit_date": 1441699571, "creation_date": 1441617619, "answer_id": 32435143, "question_id": 32432450, "link": "https://stackoverflow.com/questions/32432450/what-is-standard-defer-finalizer-implementation-in-c/32435143#32435143", "title": "What is standard defer/finalizer implementation in C++?", "body": "<p>Before new standard comes, I use simple RAII class for this:</p>\n\n<pre><code>struct ScopeGuard {\n    typedef std::function&lt; void() &gt; func_type;\n    explicit ScopeGuard(func_type _func) : func(_func), isReleased(false) {}\n    ~ScopeGuard() {\n        if( !isReleased &amp;&amp; func ) try {\n            func();\n        }catch(...) {};\n    }\n    void Forget() { isReleased=true; }\n\n    //noncopyable\n    ScopeGuard(const ScopeGuard&amp;) = delete;\n    ScopeGuard&amp; operator=(const ScopeGuard&amp;) = delete;\n\nprivate:\n    func_type func;\n    bool isReleased;\n};\n</code></pre>\n\n<p>Later it can be used for any things, for example:</p>\n\n<pre><code>FILE *fp = fopen(filename.c_str(),\"w\");\nif(fp==NULL) throw invalid_argument();\nScopeGuard _fp_guard([&amp;fp]() {\n    fclose(fp);\n});\n</code></pre>\n\n<p>Also, you can use Boost.ScopeExit and similar implementations.</p>\n"}, {"tags": [], "owner": {"reputation": 147, "user_id": 1852315, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kWH1R.png?s=128&g=1", "display_name": "austere", "link": "https://stackoverflow.com/users/1852315/austere"}, "is_accepted": false, "score": 2, "last_activity_date": 1450045171, "creation_date": 1450045171, "answer_id": 34257065, "question_id": 32432450, "link": "https://stackoverflow.com/questions/32432450/what-is-standard-defer-finalizer-implementation-in-c/34257065#34257065", "title": "What is standard defer/finalizer implementation in C++?", "body": "<p>Here's my solution, which is similar to the type you'd encounter in swift, but I don't handle any exceptions (easy enough to add if required, just use a try/catch block like in PSIAlt's solution):</p>\n\n<pre><code>class Defer {\n    using F = std::function&lt;void(void)&gt;;\n    std::vector&lt;F&gt; funcs;\n    void add(F f) {\n        funcs.push_back(f);\n    }\npublic:\n    Defer(F f) { add(f); }\n    Defer() {}\n    Defer(const Defer&amp; ) = delete;\n    Defer&amp; operator= (const Defer&amp; ) = delete;\n\n    void operator() (F f) { add(f); }\n    ~Defer() {\n        for(;!funcs.empty();) {\n            funcs.back()();\n            funcs.pop_back();\n        }\n    }\n};\n</code></pre>\n\n<p>It may seem clunky due to its use of vector, but it retains the behavior of swift's defer where the functions are called in reverse order:</p>\n\n<pre><code>Defer defer([]{std::cout &lt;&lt; \"fourth\" &lt;&lt; std::endl;});\nstd::cout &lt;&lt; \"first\" &lt;&lt; std::endl;\nauto s = \"third\";\ndefer([&amp;s]{std::cout &lt;&lt; s &lt;&lt; std::endl;});\nstd::cout &lt;&lt; \"second\" &lt;&lt; std::endl;\n</code></pre>\n\n<p>But it's a bit more powerful than defer in that you can add deferred calls at any scope lower than your own. You just have to be careful that the lambda captured doesn't go out of scope when you use this (a bit of a flaw but not a serious one if you're careful).</p>\n\n<p>I normally wouldn't use this, unless it's going to be a one-off statement. Ideally you'd wrap any resource around a new class that deallocates it when it goes out of scope, but if its top-level code with lots of resources and error handling, defer does make more sense from a code readability standpoint. You don't have to remember a bunch of new classes that really all do the same thing.</p>\n"}, {"comments": [{"owner": {"reputation": 19199, "user_id": 1424877, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/8a14e5bb44bbb4c2721ac711bd8a7bcf?s=128&d=identicon&r=PG", "display_name": "Quuxplusone", "link": "https://stackoverflow.com/users/1424877/quuxplusone"}, "edited": false, "score": 0, "creation_date": 1468131077, "post_id": 34914385, "comment_id": 63996338, "body": "Sadly, the use of <code>std::function</code> here will kill your codegen; you really don&#39;t want to do it. See <a href=\"https://www.youtube.com/watch?v=lKG1m2NkANM\" rel=\"nofollow noreferrer\">this presentation</a> starting at 10m58s."}], "tags": [], "owner": {"reputation": 11, "user_id": 3221811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/alKQE.jpg?s=128&g=1", "display_name": "Bert Young", "link": "https://stackoverflow.com/users/3221811/bert-young"}, "is_accepted": false, "score": -1, "last_activity_date": 1453343399, "creation_date": 1453343399, "answer_id": 34914385, "question_id": 32432450, "link": "https://stackoverflow.com/questions/32432450/what-is-standard-defer-finalizer-implementation-in-c/34914385#34914385", "title": "What is standard defer/finalizer implementation in C++?", "body": "<p>used like this:</p>\n\n<pre><code>int main()   {\n    int  age = 20;\n    DEFER { std::cout &lt;&lt; \"age = \" &lt;&lt; age &lt;&lt; std::endl; };\n    DEFER { std::cout &lt;&lt; \"I'll be first\\n\"; };\n}\n</code></pre>\n\n<p>My implementation( please add header files yourself):</p>\n\n<pre><code> class ScopeExit\n    {\n    public:\n    ScopeExit() = default;\n\n    template &lt;typename F, typename... Args&gt;\n    ScopeExit(F&amp;&amp; f, Args&amp;&amp;... args)\n    {\n        // Bind all args, make args list empty\n        auto temp = std::bind(std::forward&lt;F&gt;(f), std::forward&lt;Args&gt;(args)...);\n\n        // Discard return type, make return type = void, conform to func_ type\n        func_ = [temp]() { (void)temp(); };\n    }\n\n    ScopeExit(ScopeExit&amp;&amp; r)\n    {\n        func_ = std::move(r.func_);\n    }\n\n    // Destructor and execute defered function\n    ~ScopeExit()\n    {\n        if (func_)\n            func_();\n    }\n\n    private:\n        std::function&lt; void ()&gt; func_;\n    };\n\n    // Ugly macro, help\n    #define CONCAT(a, b) a##b\n\n    #define DEFER  _MAKE_DEFER_HELPER_(__LINE__)\n    #define _MAKE_DEFER_HELPER_(line)   ScopeExit    CONCAT(_defer, line) = [&amp;] () \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19199, "user_id": 1424877, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/8a14e5bb44bbb4c2721ac711bd8a7bcf?s=128&d=identicon&r=PG", "display_name": "Quuxplusone", "link": "https://stackoverflow.com/users/1424877/quuxplusone"}, "is_accepted": false, "score": 6, "last_activity_date": 1470594864, "last_edit_date": 1495542720, "creation_date": 1468130917, "answer_id": 38289141, "question_id": 32432450, "link": "https://stackoverflow.com/questions/32432450/what-is-standard-defer-finalizer-implementation-in-c/38289141#38289141", "title": "What is standard defer/finalizer implementation in C++?", "body": "<p>I presented a header-only implementation of Go-style <code>defer</code> at CppCon 2014 (<a href=\"https://www.youtube.com/watch?v=lKG1m2NkANM\" rel=\"nofollow noreferrer\">YouTube link</a>); I called it <code>Auto</code>. IMHO this is still far and away the best alternative out there in terms of teachability, efficiency, and absolute fool-proofness. In use, it looks like this:</p>\n\n<pre><code>#include \"auto.h\"\n\nint main(int argc, char **argv)\n{\n    Auto(std::cout &lt;&lt; \"Goodbye world\" &lt;&lt; std::endl);  // defer a single statement...\n    int x[4], *p = x;\n    Auto(\n        if (p != x) {  // ...or a whole block's worth of control flow\n            delete p;\n        }\n    );\n    if (argc &gt; 4) { p = new int[argc]; }\n}\n</code></pre>\n\n<p><a href=\"http://www.club.cc.cmu.edu/~ajo/disseminate/auto.h\" rel=\"nofollow noreferrer\">The implementation</a> looks like this:</p>\n\n<pre><code>#pragma once\n\ntemplate &lt;class Lambda&gt; class AtScopeExit {\n  Lambda&amp; m_lambda;\npublic:\n  AtScopeExit(Lambda&amp; action) : m_lambda(action) {}\n  ~AtScopeExit() { m_lambda(); }\n};\n\n#define Auto_INTERNAL2(lname, aname, ...) \\\n    auto lname = [&amp;]() { __VA_ARGS__; }; \\\n    AtScopeExit&lt;decltype(lname)&gt; aname(lname);\n\n#define Auto_TOKENPASTE(x, y) Auto_ ## x ## y\n\n#define Auto_INTERNAL1(ctr, ...) \\\n    Auto_INTERNAL2(Auto_TOKENPASTE(func_, ctr), \\\n                   Auto_TOKENPASTE(instance_, ctr), __VA_ARGS__)\n\n#define Auto(...) Auto_INTERNAL1(__COUNTER__, __VA_ARGS__)\n</code></pre>\n\n<p>Yes, that's the entire file: just 15 lines of code! It requires C++11 or newer, and requires your compiler to support <a href=\"https://stackoverflow.com/questions/652815/has-anyone-ever-had-a-use-for-the-counter-pre-processor-macro\"><code>__COUNTER__</code></a> (although you can use <code>__LINE__</code> as a poor man's <code>__COUNTER__</code> if you need portability to some compiler that doesn't support it). As for efficiency, I've never seen GCC or Clang generate anything other than perfect code for any use of <code>Auto</code> at <code>-O2</code> or higher \u2014 it's one of those fabled \"zero-cost abstractions.\"</p>\n\n<p><a href=\"http://www.club.cc.cmu.edu/~ajo/disseminate/auto.h\" rel=\"nofollow noreferrer\">The original source</a> also has a C89 version that works on GCC by exploiting some <em>very</em> GCC-specific attributes.</p>\n"}, {"comments": [{"owner": {"reputation": 5881, "user_id": 3590849, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oUHc5.png?s=128&g=1", "display_name": "tamas.kenez", "link": "https://stackoverflow.com/users/3590849/tamas-kenez"}, "edited": false, "score": 0, "creation_date": 1509221893, "post_id": 42060129, "comment_id": 80934553, "body": "What&#39;s the benefit of having it templated (class F)? It&#39;s always <code>function&lt;void()&gt;</code>."}, {"owner": {"reputation": 468, "user_id": 3185819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93fbff56452a585cbeb55e189c2bbcac?s=128&d=identicon&r=PG&f=1", "display_name": "pmttavara", "link": "https://stackoverflow.com/users/3185819/pmttavara"}, "reply_to_user": {"reputation": 5881, "user_id": 3590849, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oUHc5.png?s=128&g=1", "display_name": "tamas.kenez", "link": "https://stackoverflow.com/users/3590849/tamas-kenez"}, "edited": false, "score": 2, "creation_date": 1509338267, "post_id": 42060129, "comment_id": 80962994, "body": "The deferred block <b>takes</b> no parameters, but <b>captures</b> the entire scope by reference. Lambdas with captures can&#39;t implicitly convert to, say, <code>void(*)()</code>, since the capture necessitates storage. Using <code>std::function&lt;void()&gt;</code> works, but risks heap allocation given large capture lists. By keeping the capture on the stack, this answer lets the compiler inline the entire block yielding a zero-overhead deferral."}, {"owner": {"reputation": 5881, "user_id": 3590849, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oUHc5.png?s=128&g=1", "display_name": "tamas.kenez", "link": "https://stackoverflow.com/users/3590849/tamas-kenez"}, "edited": false, "score": 1, "creation_date": 1509359866, "post_id": 42060129, "comment_id": 80972643, "body": "Tested on godbolt and you&#39;re right. I don&#39;t think anything would go to the heap but otherwise using std::function does leave a whole lot of boilerplate there while using template&lt;F&gt; results in zero-overhead. I&#39;m still a bit surprised that C++ has two distinct lambda constructs, std::function and a native, magic one of unspecified type. Would be nice if they were identical."}, {"owner": {"reputation": 468, "user_id": 3185819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93fbff56452a585cbeb55e189c2bbcac?s=128&d=identicon&r=PG&f=1", "display_name": "pmttavara", "link": "https://stackoverflow.com/users/3185819/pmttavara"}, "reply_to_user": {"reputation": 5881, "user_id": 3590849, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oUHc5.png?s=128&g=1", "display_name": "tamas.kenez", "link": "https://stackoverflow.com/users/3590849/tamas-kenez"}, "edited": false, "score": 1, "creation_date": 1509473078, "post_id": 42060129, "comment_id": 81030648, "body": "<a href=\"http://the-witness.net/news/2012/11/scopeexit-in-c11/#comment-84111\" rel=\"nofollow noreferrer\">This post</a> points out why <code>std::function</code> would incur heap allocation. And it&#39;s not that C++ has two lambda constructs, it&#39;s that lambdas couldn&#39;t possibly all have the same type, so the designed-by-committee standard library has a highly inefficient type-erasure construct to generalize function objects."}, {"owner": {"reputation": 5881, "user_id": 3590849, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/oUHc5.png?s=128&g=1", "display_name": "tamas.kenez", "link": "https://stackoverflow.com/users/3590849/tamas-kenez"}, "edited": false, "score": 0, "creation_date": 1509486586, "post_id": 42060129, "comment_id": 81037432, "body": "Yes, <code>std::function</code> heap-allocates, after some reading now it seems trivial, thanks."}, {"owner": {"reputation": 2090, "user_id": 255635, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/24d52b83dac86c506ba50cc27ed06d24?s=128&d=identicon&r=PG", "display_name": "Robert", "link": "https://stackoverflow.com/users/255635/robert"}, "edited": false, "score": 0, "creation_date": 1511637615, "post_id": 42060129, "comment_id": 81934445, "body": "I don&#39;t know why this isn&#39;t regarded as the correct answer? It is delicious, and as close to go as possible."}], "tags": [], "owner": {"reputation": 468, "user_id": 3185819, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93fbff56452a585cbeb55e189c2bbcac?s=128&d=identicon&r=PG&f=1", "display_name": "pmttavara", "link": "https://stackoverflow.com/users/3185819/pmttavara"}, "is_accepted": false, "score": 13, "last_activity_date": 1520496118, "last_edit_date": 1520496118, "creation_date": 1486353524, "answer_id": 42060129, "question_id": 32432450, "link": "https://stackoverflow.com/questions/32432450/what-is-standard-defer-finalizer-implementation-in-c/42060129#42060129", "title": "What is standard defer/finalizer implementation in C++?", "body": "<p>This implementation is zero-overhead unlike some other answers, as well as syntactically nicer and easier to use. It also has zero dependencies, reducing compile times.</p>\n\n<p>You can paste this snippet anywhere in your codebase and it will just work.</p>\n\n<pre><code>#ifndef defer\nstruct defer_dummy {};\ntemplate &lt;class F&gt; struct deferrer { F f; ~deferrer() { f(); } };\ntemplate &lt;class F&gt; deferrer&lt;F&gt; operator*(defer_dummy, F f) { return {f}; }\n#define DEFER_(LINE) zz_defer##LINE\n#define DEFER(LINE) DEFER_(LINE)\n#define defer auto DEFER(__LINE__) = defer_dummy{} *[&amp;]()\n#endif // defer\n</code></pre>\n\n<p>Usage: <code>defer { statements; };</code></p>\n\n<p>Example:</p>\n\n<pre><code>#include &lt;cstdint&gt;\n#include &lt;cstdio&gt;\n#include &lt;cstdlib&gt;\n\n#ifndef defer\nstruct defer_dummy {};\ntemplate &lt;class F&gt; struct deferrer { F f; ~deferrer() { f(); } };\ntemplate &lt;class F&gt; deferrer&lt;F&gt; operator*(defer_dummy, F f) { return {f}; }\n#define DEFER_(LINE) zz_defer##LINE\n#define DEFER(LINE) DEFER_(LINE)\n#define defer auto DEFER(__LINE__) = defer_dummy{} *[&amp;]()\n#endif // defer\n\nbool read_entire_file(char *filename, std::uint8_t *&amp;data_out,\n                      std::size_t *size_out = nullptr) {\n    if (!filename)\n        return false;\n\n    auto file = std::fopen(filename, \"rb\");\n    if (!file)\n        return false;\n\n    defer { std::fclose(file); }; // don't need to write an RAII file wrapper.\n\n    if (std::fseek(file, 0, SEEK_END) != 0)\n        return false;\n\n    auto filesize = std::fpos_t{};\n    if (std::fgetpos(file, &amp;filesize) != 0 || filesize &lt; 0)\n        return false;\n\n    auto checked_filesize = static_cast&lt;std::uintmax_t&gt;(filesize);\n    if (checked_filesize &gt; SIZE_MAX)\n        return false;\n\n    auto usable_filesize = static_cast&lt;std::size_t&gt;(checked_filesize);\n    // Even if allocation or read fails, this info is useful.\n    if (size_out)\n        *size_out = usable_filesize;\n\n    auto memory_block = new std::uint8_t[usable_filesize];\n    data_out = memory_block;\n    if (memory_block == nullptr)\n        return false;\n\n    std::rewind(file);\n    if (std::fread(memory_block, 1, usable_filesize, file) != usable_filesize)\n        return false; // Allocation succeeded, but read failed.\n\n    return true;\n}\n\nint main(int argc, char **argv) {\n    if (argc &lt; 2)\n        return -1;\n\n    std::uint8_t *file_data = nullptr;\n    std::size_t file_size = 0;\n\n    auto read_success = read_entire_file(argv[1], file_data, &amp;file_size);\n\n    defer { delete[] file_data; }; // don't need to write an RAII string wrapper.\n\n    if (read_success) {\n        for (std::size_t i = 0; i &lt; file_size; i += 1)\n            std::printf(\"%c\", static_cast&lt;char&gt;(file_data[i]));\n        return 0;\n    } else {\n        return -1;\n    }\n}\n</code></pre>\n\n<p>P.S.: The local deferrer object starts with <code>zz_</code> and not <code>_</code> so it doesn't clutter the Locals window in your debugger, and also because user identifiers technically shouldn't start with underscores.</p>\n"}, {"tags": [], "owner": {"reputation": 66, "user_id": 9147174, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Tx2ewZWG1Lc/AAAAAAAAAAI/AAAAAAAAAFg/ERnTGKyZmR8/photo.jpg?sz=128", "display_name": "phonzia", "link": "https://stackoverflow.com/users/9147174/phonzia"}, "is_accepted": false, "score": 0, "last_activity_date": 1519706079, "last_edit_date": 1519706079, "creation_date": 1519028719, "answer_id": 48862014, "question_id": 32432450, "link": "https://stackoverflow.com/questions/32432450/what-is-standard-defer-finalizer-implementation-in-c/48862014#48862014", "title": "What is standard defer/finalizer implementation in C++?", "body": "<p>Here is my defer implementation, but without noexcept guarantee, I still don't think it is very good implementation.</p>\n\n<p>Used like this:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include \"defer.hpp\"\n\nusing namespace std;\n\nint main() {\n    defer []{cout &lt;&lt; \"defered\" &lt;&lt; endl;};\n}\n</code></pre>\n\n<p>Implementation:</p>\n\n<pre><code>#define DEFER_CONCAT_IMPL(x, y) x##y\n#define DEFER_CONCAT(x, y) DEFER_CONCAT_IMPL(x, y)\n#define AUTO_DEFER_VAR DEFER_CONCAT(__defer, __LINE__)\n#define defer ::__defer AUTO_DEFER_VAR; AUTO_DEFER_VAR-\n\nclass __defer {\n    public:\n        template&lt;typename Callable&gt;\n            void operator- (Callable&amp;&amp; callable) {\n                defer_ = std::forward&lt;Callable&gt;(callable);\n            }\n\n        ~__defer() {\n            defer_();\n        }\n    private:\n        std::function&lt;void(void)&gt; defer_;\n};\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 301, "user_id": 9456786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46f04b80a588e3d707a0138782230649?s=128&d=identicon&r=PG", "display_name": "kirr", "link": "https://stackoverflow.com/users/9456786/kirr"}, "is_accepted": false, "score": 1, "last_activity_date": 1574877127, "creation_date": 1574877127, "answer_id": 59075897, "question_id": 32432450, "link": "https://stackoverflow.com/questions/32432450/what-is-standard-defer-finalizer-implementation-in-c/59075897#59075897", "title": "What is standard defer/finalizer implementation in C++?", "body": "<p><a href=\"https://lab.nexedi.com/kirr/pygolang/blob/master/golang/libgolang.h\" rel=\"nofollow noreferrer\">libgolang</a> provides <em>defer</em> implementation (<a href=\"https://lab.nexedi.com/kirr/pygolang/commit/1d153a45\" rel=\"nofollow noreferrer\">commit 1</a>, <a href=\"https://lab.nexedi.com/kirr/pygolang/commit/14a249cb\" rel=\"nofollow noreferrer\">2</a>, <a href=\"https://lab.nexedi.com/kirr/pygolang/commit/39f40159\" rel=\"nofollow noreferrer\">3</a>). Usage is like:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>void myfunc() {\n      defer([]() {\n          printf(\"leaving...\\n\");\n      });\n\n      ...\n}\n</code></pre>\n\n<p><code>defer</code> itself is implemented as:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>// defer(f) mimics `defer f()` from golang.\n// NOTE contrary to Go f is called at end of current scope, not function.\n#define defer(f) golang::_deferred _defer_(__COUNTER__) (f)\n#define _defer_(counter)    _defer_2(counter)\n#define _defer_2(counter)   _defer_##counter\nstruct _deferred {\n    typedef func&lt;void()&gt; F;\n    F f;\n    _deferred(F f) : f(f) {}\n    ~_deferred() { f(); }\nprivate:\n    _deferred(const _deferred&amp;);    // don't copy\n    _deferred(_deferred&amp;&amp;);         // don't move\n};\n</code></pre>\n"}], "owner": {"reputation": 1734, "user_id": 1565238, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cd5ac413e588dd1a030e00f1dea143ee?s=128&d=identicon&r=PG", "display_name": "Aleksander Alekseev", "link": "https://stackoverflow.com/users/1565238/aleksander-alekseev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3615, "favorite_count": 6, "accepted_answer_id": 32433012, "answer_count": 8, "score": 11, "last_activity_date": 1589822458, "creation_date": 1441607725, "last_edit_date": 1470215465, "question_id": 32432450, "link": "https://stackoverflow.com/questions/32432450/what-is-standard-defer-finalizer-implementation-in-c", "title": "What is standard defer/finalizer implementation in C++?", "body": "<p>General idea of Golang-style <code>defer</code> is explained <a href=\"https://marcoarena.wordpress.com/2012/08/27/mix-raii-and-lambdas-for-deferred-execution/\" rel=\"noreferrer\">here</a> and <a href=\"http://kri.gs/2013/01/20/defer-cpp/\" rel=\"noreferrer\">here</a>.</p>\n\n<p>I wonder, does STL (of C++11, C++14, ...) or maybe Boost or maybe some other library contain implementation of such a class? So I could just use it without reimplementing it in every new project.</p>\n"}, {"tags": ["mysql", "parsing", "time", "go"], "comments": [{"owner": {"reputation": 170455, "user_id": 149341, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/omfTQ.png?s=128&g=1", "display_name": "duskwuff -inactive-", "link": "https://stackoverflow.com/users/149341/duskwuff-inactive"}, "edited": false, "score": 2, "creation_date": 1441608442, "post_id": 32431751, "comment_id": 52729895, "body": "As an aside: Newer versions of MySQL will reject the date <code>0000-00-00</code> when SQL strict mode is enabled."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1441638042, "post_id": 32431798, "comment_id": 52746871, "body": "Actually this is not the case. Year <code>0</code> is parsable by Go&#39;s <code>time</code> package (as shown in my answer). The problem is the month <code>0</code>."}], "tags": [], "owner": {"reputation": 53754, "user_id": 198536, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9edaf4c1c1b89b5d39c40528d0017509?s=128&d=identicon&r=PG", "display_name": "wallyk", "link": "https://stackoverflow.com/users/198536/wallyk"}, "is_accepted": true, "score": 5, "last_activity_date": 1441604626, "creation_date": 1441604626, "answer_id": 32431798, "question_id": 32431751, "link": "https://stackoverflow.com/questions/32431751/how-to-parse-0000-00-00-000000/32431798#32431798", "title": "How to parse 0000-00-00 00:00:00?", "body": "<p>That does not parse because there was no year zero.  After 1 B.C. is 1 A.D.</p>\n\n<p>With most contexts, it probably makes sense to make a special check for year zero and store a NULL value in its place.</p>\n\n<hr>\n\n<p>From a practical viewpoint, any dates given as being in a year between 1 AD and around 600 A.D. are poorly documented and likely wrong.  Somewhere in there are a few missed years.  Academics aren't sure how many, but they mostly agree that at least 4 years are missing and maybe as many as 8 or 10.  That is, the year 2015 actually should be 2019 to 2029.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1441650442, "post_id": 32431850, "comment_id": 52752038, "body": "Zero value of <code>time.Time</code> being year 1 does not imply that year cannot be 0. There is time before year 1. Year <code>0</code> is parsable by the <code>time</code> package. It&#39;s month <code>0</code> that cannot be parsed (because it&#39;s invalid)."}], "tags": [], "owner": {"reputation": 116, "user_id": 567512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b4319173ff1a5fb56ea2cfbd6781414?s=128&d=identicon&r=PG", "display_name": "reedobrien", "link": "https://stackoverflow.com/users/567512/reedobrien"}, "is_accepted": false, "score": 1, "last_activity_date": 1441650954, "last_edit_date": 1441650954, "creation_date": 1441604954, "answer_id": 32431850, "question_id": 32431751, "link": "https://stackoverflow.com/questions/32431751/how-to-parse-0000-00-00-000000/32431850#32431850", "title": "How to parse 0000-00-00 00:00:00?", "body": "<p>The zero value of type Time is <a href=\"https://golang.org/src/time/time.go\" rel=\"nofollow\">January 1, year 1, 00:00:00.000000000 UTC</a>. So there is no month 0 in Go. </p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1503391073, "last_edit_date": 1503391073, "creation_date": 1441606838, "answer_id": 32432249, "question_id": 32431751, "link": "https://stackoverflow.com/questions/32431751/how-to-parse-0000-00-00-000000/32432249#32432249", "title": "How to parse 0000-00-00 00:00:00?", "body": "<p>First a comile time error in your code: there is no <code>log.Errorf()</code> function (that is if you're using the standard <a href=\"https://golang.org/pkg/log/\" rel=\"nofollow noreferrer\"><code>log</code></a> package). Instead use for example <a href=\"https://golang.org/pkg/log/#Printf\" rel=\"nofollow noreferrer\"><code>log.Printf()</code></a>.</p>\n\n<p>Second, as your error states: <code>month out of range</code>. Month is in range if <code>1..12</code>. A month value of <code>0</code> or <code>00</code> is invalid. See <a href=\"https://golang.org/pkg/time/#Month\" rel=\"nofollow noreferrer\">valid months here</a>.</p>\n\n<p>The zero time (or the more precise term: the <a href=\"http://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> of the type <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a>) is as printed by:</p>\n\n<pre><code>log.Println(\"Zero time is:\", time.Time{}.Format(\"2006-01-02 15:04:05\"))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2009/11/10 23:00:00 Zero time is: 0001-01-01 00:00:00\n</code></pre>\n\n<p>Note that year, month and day are all <code>1</code>.</p>\n\n<p>Also note that even though days start from <code>1</code>, day <code>0</code> is also accepted and is interpreted as <code>-1</code> day from the first day of month specified by the year and month parts.</p>\n\n<p>So while <code>\"0000-01-01 00:00:00\"</code> can be parsed and properly gives <code>\"0000-01-01 00:00:00 +0000 UTC\"</code>, the time <code>\"0000-01-00 00:00:00\"</code> will give <code>\"-0001-12-31 00:00:00 +0000 UTC\"</code>.</p>\n\n<p>The exact date <code>\"0000-00-00 00:00:00\"</code> represents the zero date from your source (MySql db?), and so in Go when this date is detected I would return the zero value for the Go <code>time.Time</code> so you can check it from Go with the <a href=\"https://golang.org/pkg/time/#Time.IsZero\" rel=\"nofollow noreferrer\"><code>Time.IsZero()</code></a> method. Use this simple helper function to parse your times:</p>\n\n<pre><code>func parseTime(s string) (time.Time, err) {\n    if s == \"0000-00-00 00:00:00\" {\n        return time.Time{}, nil\n    }\n    return time.Parse(\"2006-01-02 15:04:05\", s)\n}\n</code></pre>\n\n<p>See the examples in action on the <a href=\"http://play.golang.org/p/--HgEx-Cnr\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2422, "favorite_count": 0, "accepted_answer_id": 32431798, "answer_count": 3, "score": 6, "last_activity_date": 1503391073, "creation_date": 1441604356, "last_edit_date": 1441612489, "question_id": 32431751, "link": "https://stackoverflow.com/questions/32431751/how-to-parse-0000-00-00-000000", "title": "How to parse 0000-00-00 00:00:00?", "body": "<p>I'm parsing some time values from a mysql database and some of them are zero. Why does Go fail to parse this and how can I fix it?</p>\n\n<pre><code>checkTime := \"0000-00-00 00:00:00\"\nt, err := time.Parse(\"2006-01-02 15:04:05\", checkTime)\nif err !=nil{\n    log.Errorf(\"err %v, checkTime %v, ID %v\", err, checkTime, bk.ID)\n}\n</code></pre>\n\n<p>I get:</p>\n\n<pre><code>err parsing time \"0000-00-00 00:00:00\": month out of range, checkin 0000-00-00 00:00:00\n</code></pre>\n"}, {"tags": ["templates", "go", "range"], "comments": [{"owner": {"reputation": 13, "user_id": 5307180, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SfKS0oBqqD4/AAAAAAAAAAI/AAAAAAAAdXo/2H1_xN_1JAw/photo.jpg?sz=128", "display_name": "sed", "link": "https://stackoverflow.com/users/5307180/sed"}, "edited": false, "score": 0, "creation_date": 1441589746, "post_id": 32429992, "comment_id": 52725222, "body": "Perhaps I don&#39;t need to pass in the entire themes structure here since it is just a container of themes?  It was only needed because of the structure of the incoming xml."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 5307180, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SfKS0oBqqD4/AAAAAAAAAAI/AAAAAAAAdXo/2H1_xN_1JAw/photo.jpg?sz=128", "display_name": "sed", "link": "https://stackoverflow.com/users/5307180/sed"}, "edited": false, "score": 0, "creation_date": 1441655354, "post_id": 32430251, "comment_id": 52753866, "body": "Thank you!  What I also discovered is that I can pass only the underlying []Theme collection.  I see you did the same thing by basically using the .Themes in the range indicator."}, {"owner": {"reputation": 13, "user_id": 5307180, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SfKS0oBqqD4/AAAAAAAAAAI/AAAAAAAAdXo/2H1_xN_1JAw/photo.jpg?sz=128", "display_name": "sed", "link": "https://stackoverflow.com/users/5307180/sed"}, "edited": false, "score": 0, "creation_date": 1441718419, "post_id": 32430251, "comment_id": 52779882, "body": "why would you use a pointer here vs just the copy variable?  I am sure you know a good reason, but I am just starting out here and want to understand better."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1441591982, "creation_date": 1441591982, "answer_id": 32430251, "question_id": 32429992, "link": "https://stackoverflow.com/questions/32429992/iterating-nested-structs-in-golang-on-a-template/32430251#32430251", "title": "Iterating nested structs in golang on a template", "body": "<p>Use the following template:</p>\n\n<pre><code>&lt;ul&gt;{{range .Themes}}\n  &lt;li&gt;{{.Name}} {{.Tag}}{{end}}\n&lt;/ul&gt;\n</code></pre>\n\n<p>and execute it with the data argument as a <code>*ThemeList</code>.</p>\n\n<p><a href=\"http://play.golang.org/p/TUC2rJCoPm\" rel=\"nofollow\">Playground Example</a></p>\n"}], "owner": {"reputation": 13, "user_id": 5307180, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-SfKS0oBqqD4/AAAAAAAAAAI/AAAAAAAAdXo/2H1_xN_1JAw/photo.jpg?sz=128", "display_name": "sed", "link": "https://stackoverflow.com/users/5307180/sed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1687, "favorite_count": 0, "accepted_answer_id": 32430251, "answer_count": 1, "score": 1, "last_activity_date": 1441591982, "creation_date": 1441589354, "question_id": 32429992, "link": "https://stackoverflow.com/questions/32429992/iterating-nested-structs-in-golang-on-a-template", "title": "Iterating nested structs in golang on a template", "body": "<p>I have the following code and would like to iterate though the themes in a template, but for the life of me I can't seem to get past the fact it is a nested container.</p>\n\n<pre><code>type ThemeList struct {\n    XMLName xml.Name `xml:\"Themes\"`\n    Themes []Theme `xml:\"Theme\"`\n}\n\ntype Theme struct {\n    XMLName xml.Name `xml:\"Theme\"`\n    Name string `xml:\"Name,attr\"`\n    Page string `xml:\"Page,attr\"`\n    Tag string `xml:\"Tag,attr\"`\n    Day string `xml:\"Day,attr\"`\n}\n\n// Fetch the current XML document and return the Themelist[]\nfunc openXML(filename string) ThemeList {\n\n    xmlFile, _ := os.Open(filename)\n    defer xmlFile.Close()\n    XMLdata, _ := ioutil.ReadAll(xmlFile)\n\n    var t ThemeList\n    xml.Unmarshal(XMLdata, &amp;t)\n\n    return t\n}\n</code></pre>\n\n<p>How would one output these in a {{range}} where each theme is part of an individual list items?  The output would use .Name .Tag and so on in the template as I look though them.</p>\n"}, {"tags": ["go", "marshalling", "rpc", "json-rpc"], "comments": [{"owner": {"reputation": 267, "user_id": 565480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NItVk.jpg?s=128&g=1", "display_name": "17Twenty", "link": "https://stackoverflow.com/users/565480/17twenty"}, "edited": false, "score": 0, "creation_date": 1441588192, "post_id": 32428797, "comment_id": 52724868, "body": "Not sure why this would work differently depending on calling but wondering if it&#39;s due to the fact that fakeFoo has an internalValue that stops the marshalling working?"}], "answers": [{"comments": [{"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 1, "creation_date": 1567673493, "post_id": 32430429, "comment_id": 102035456, "body": "Use <code>json.RawMessage</code> instead of <code>RawString</code> custom type. Here, you&#39;re doing unnecessary allocations when you convert to/from <code>[]byte</code>."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": true, "score": 7, "last_activity_date": 1453086000, "last_edit_date": 1495535243, "creation_date": 1441594097, "answer_id": 32430429, "question_id": 32428797, "link": "https://stackoverflow.com/questions/32428797/unmarshal-to-a-interface-type/32430429#32430429", "title": "Unmarshal to a interface type", "body": "<p>All marshaling/unmarshaling has this problem.</p>\n\n<p>You can marshal from an interface type variable, because the object exists locally, so the reflector knows the underlying type.</p>\n\n<p>You cannot unmarshal to an interface type, because the reflector does not know which concrete type to give to a new instance to receive the marshaled data.</p>\n\n<p>In some marshal/unmarshal frameworks we need additional information to help the reflector. For example, in Java Json(<a href=\"https://github.com/FasterXML/jackson\" rel=\"nofollow noreferrer\">jackson</a>), we use the <code>JsonTypeInfo</code> annotation to specify the class type, refer to <a href=\"https://www.thomaskeller.biz/blog/2013/09/10/custom-polymorphic-type-handling-with-jackson/\" rel=\"nofollow noreferrer\">this</a>.</p>\n\n<p>For golang, you can implement the <a href=\"http://godoc.org/encoding/json#Unmarshaler\" rel=\"nofollow noreferrer\">Unmarshaler</a> interface for your own type yourself. Refer to <a href=\"https://stackoverflow.com/questions/23798283/golang-unmarshal-json\">How do I Unmarshal JSON?</a></p>\n\n<pre><code>// RawString is a raw encoded JSON object.\n// It implements Marshaler and Unmarshaler and can\n// be used to delay JSON decoding or precompute a JSON encoding.\ntype RawString string\n\n// MarshalJSON returns *m as the JSON encoding of m.\nfunc (m *RawString) MarshalJSON() ([]byte, error) {\n    return []byte(*m), nil\n}\n\n// UnmarshalJSON sets *m to a copy of data.\nfunc (m *RawString) UnmarshalJSON(data []byte) error {\n    if m == nil {\n        return errors.New(\"RawString: UnmarshalJSON on nil pointer\")\n    }\n    *m += RawString(data)\n    return nil\n}\n\nconst data = `{\"i\":3, \"S\":{\"phone\": {\"sales\": \"2223334444\"}}}`\n\ntype A struct {\n    I int64\n    S RawString `sql:\"type:json\"`\n}\n\nfunc main() {\n    a := A{}\n    err := json.Unmarshal([]byte(data), &amp;a)\n    if err != nil {\n        log.Fatal(\"Unmarshal failed\", err)\n    }\n    fmt.Println(\"Done\", a)\n}\n</code></pre>\n"}], "owner": {"reputation": 267, "user_id": 565480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NItVk.jpg?s=128&g=1", "display_name": "17Twenty", "link": "https://stackoverflow.com/users/565480/17twenty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1804, "favorite_count": 3, "accepted_answer_id": 32430429, "answer_count": 1, "score": 4, "last_activity_date": 1474659238, "creation_date": 1441577493, "last_edit_date": 1474659238, "question_id": 32428797, "link": "https://stackoverflow.com/questions/32428797/unmarshal-to-a-interface-type", "title": "Unmarshal to a interface type", "body": "<p>I have some code I've been dumped with and am actually stumped - I've worked with RPC and the JSON side of things before but I can't seem to get it to work over RPC when it works fine locally.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net\"\n    \"net/rpc\"\n    \"net/rpc/jsonrpc\"\n    \"reflect\"\n)\n\ntype Foo interface {\n    SayHello() error\n}\n\ntype fakeFoo struct {\n    internalValue string\n}\n\nfunc NewFakeFoo() *fakeFoo {\n    f := &amp;fakeFoo{}\n    f.internalValue = \"123456789012347\"\n    return f\n}\n\nfunc (m *fakeFoo) SayHello() error {\n    return nil\n}\n\ntype FooManager struct {\n    availableFoos []Foo\n}\n\nfunc NewFooManager() *FooManager {\n    p := new(FooManager)\n    p.availableFoos = make([]Foo, 0)\n    return p\n}\n\nfunc AddFoo(mm *FooManager, m Foo) {\n    mm.availableFoos = append(mm.availableFoos, m)\n    log.Println(\"Added type \", reflect.TypeOf(m))\n}\n\nfunc (mm *FooManager) GetAvailableFoos(in []Foo, out *[]Foo) error {\n\n    log.Println(\"availableFoos:\", reflect.TypeOf(mm.availableFoos))\n    log.Println(\"*out is\", reflect.TypeOf(*out))\n\n    *out = append(in, mm.availableFoos...)\n\n    log.Println(\"Out is:\", reflect.TypeOf(*out))\n\n    return nil\n}\n\nfunc startServer(mm *FooManager) {\n    server := rpc.NewServer()\n    server.Register(mm)\n\n    l, e := net.Listen(\"tcp\", \":8222\")\n    if e != nil {\n        log.Fatal(\"listen error:\", e)\n    }\n\n    for {\n        conn, err := l.Accept()\n        log.Println(\"Incoming!\")\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        go server.ServeCodec(jsonrpc.NewServerCodec(conn))\n    }\n}\n\nfunc main() {\n    fake1 := NewFakeFoo()\n\n    fooHolder := NewFooManager()\n    AddFoo(fooHolder, fake1)\n    go startServer(fooHolder)\n\n    log.Println(\"Using standard function call\")\n    var foos []Foo\n    fooHolder.GetAvailableFoos(foos, &amp;foos)\n    log.Println(foos)\n\n    log.Println(\"Using RPC call\")\n    conn, err := net.Dial(\"tcp\", \"localhost:8222\")\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer conn.Close()\n    c := jsonrpc.NewClient(conn)\n\n    err = c.Call(\"FooManager.GetAvailableFoos\", foos, &amp;foos)\n    if err != nil {\n        log.Println(foos)\n        log.Fatal(\"GetAvailableFoos error:\", err)\n    }\n    log.Println(\"Success: \", foos)\n}\n</code></pre>\n\n<p>(also here but no tcp available urgh! <a href=\"http://play.golang.org/p/HmK-K09D2J\" rel=\"nofollow\">http://play.golang.org/p/HmK-K09D2J</a> )</p>\n\n<p>The output is pretty surprising as it indicates something going wrong with the marshalling rather than with the actual data - Running it in wireshark I can see the data being sent in the correct form (I had success using a similar technique in another question) but can't for the life of me get this to stop throwing marshalling bugs.</p>\n\n<p>The output from running this is as follows:</p>\n\n<pre><code>2015/09/07 10:04:35 Added type  *main.fakeFoo\n2015/09/07 10:04:35 Using standard function call\n2015/09/07 10:04:35 availableFoos: []main.Foo\n2015/09/07 10:04:35 *out is []main.Foo\n2015/09/07 10:04:35 Out is: []main.Foo\n2015/09/07 10:04:35 [0x1870a540]\n2015/09/07 10:04:35 Using RPC call\n2015/09/07 10:04:35 Incoming!\n2015/09/07 10:04:35 [0x1870a540]\n2015/09/07 10:04:35 GetAvailableFoos error:json: cannot unmarshal object into Go value of type main.Foo\nexit status 1\n</code></pre>\n\n<p>Am I missing an interface/type trick or is this a bug in Go's marshalling?</p>\n"}, {"tags": ["c++", "c", "gcc", "go", "integer-overflow"], "comments": [{"owner": {"reputation": 35670, "user_id": 420683, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/68b74cb21e360e5601ce6c812f59a136?s=128&d=identicon&r=PG", "display_name": "dyp", "link": "https://stackoverflow.com/users/420683/dyp"}, "edited": false, "score": 1, "creation_date": 1442067471, "post_id": 32427787, "comment_id": 52936811, "body": "Related std-discussion mailing: <a href=\"https://groups.google.com/a/isocpp.org/d/topic/std-discussion/pdaoWRp8ZYg/discussion\" rel=\"nofollow noreferrer\">groups.google.com/a/isocpp.org/d/topic/std-discussion/&hellip;</a> You can find many related questions on StackOverflow by searching for &quot;signed integer overflow undefined behaviour&quot;. See also the <a href=\"https://gcc.gnu.org/onlinedocs/gcc/Code-Gen-Options.html#Code-Gen-Options\" rel=\"nofollow noreferrer\"><code>-fwrapv</code> gcc option</a>"}, {"owner": {"reputation": 35670, "user_id": 420683, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/68b74cb21e360e5601ce6c812f59a136?s=128&d=identicon&r=PG", "display_name": "dyp", "link": "https://stackoverflow.com/users/420683/dyp"}, "edited": false, "score": 1, "creation_date": 1442067776, "post_id": 32427787, "comment_id": 52936908, "body": "Very related: <a href=\"http://stackoverflow.com/q/19842215/\">stackoverflow.com/q/19842215</a>"}, {"owner": {"reputation": 126541, "user_id": 153285, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/1UiET.jpg?s=128&g=1", "display_name": "Potatoswatter", "link": "https://stackoverflow.com/users/153285/potatoswatter"}, "edited": false, "score": 1, "creation_date": 1442075966, "post_id": 32427787, "comment_id": 52939495, "body": "Note that 8-bit operands to <code>+</code> are promoted to <code>int</code> which is at least 16 bits. @&#216;yvind, Please, if you don&#39;t mind, please describe what are the inputs and outputs of the snippet. &quot;<code>Cnt2 is 35 if &gt;  0 above</code>&quot; doesn&#39;t make any sense so it&#39;s hard to tell what you&#39;re looking for."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1442162162, "post_id": 32427787, "comment_id": 52959798, "body": "I don&#39;t think the <a href=\"https://stackoverflow.com/questions/tagged/go\">go</a> tag should have been added. Everything about this question is C/C++ related and although it might be worth noting in the question that other languages like Go have different behaviour I don&#39;t see anything here that would warrant putting this up for all followers/searchers of the Go tag."}, {"owner": {"reputation": 111, "user_id": 4041462, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-twN9vEnkMuY/AAAAAAAAAAI/AAAAAAAAANM/Miz3besBfao/photo.jpg?sz=128", "display_name": "&#216;yvind Teig", "link": "https://stackoverflow.com/users/4041462/%c3%98yvind-teig"}, "edited": false, "score": 0, "creation_date": 1442173739, "post_id": 32427787, "comment_id": 52963626, "body": "(A)(B) Thanks for the refs to other discussions. I will study them. I actually did do some searches in advance  (A) -fwrapv did not help on the EDA Playground: <a href=\"http://www.edaplayground.com/x/LSL\" rel=\"nofollow noreferrer\">edaplayground.com/x/LSL</a>, for the 8 bit signed case (which is my case)   (C) I thought it too long to supply three snippets, but please compile and run with &#39;&gt;&#39;, &quot;&gt;=&quot; and &quot;==&quot; below &quot;##&quot;, and print Cnt2.  (D) I agree not to bring in side cases, however the C/C++ and Go people won&#39;t hurt seeing how matters are solved by one other side. That&#39;s why I supplied a Go Playground code when I added the Go tag, so it could be verified"}], "owner": {"reputation": 111, "user_id": 4041462, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-twN9vEnkMuY/AAAAAAAAAAI/AAAAAAAAANM/Miz3besBfao/photo.jpg?sz=128", "display_name": "&#216;yvind Teig", "link": "https://stackoverflow.com/users/4041462/%c3%98yvind-teig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 200, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1442068042, "creation_date": 1441570118, "last_edit_date": 1442068042, "question_id": 32427787, "link": "https://stackoverflow.com/questions/32427787/signed-char-overflow-handling-with-gcc", "title": "signed char overflow handling with GCC", "body": "<p>The below example does not work as I expected (using \">\" in the conditional) with GCC on an 8 bit machine, and neither on Linux 64 bit. If I make Timer_Secs and FutureTimeout_1Minute f.ex. 16 bits wide (int in those cases is 16 bits) it works as it should (using \">\" in the conditional).</p>\n\n<p>So, to get this to work for 8 bits with sign I seem to have to use \"==\" in the conditional.</p>\n\n<pre><code>{\n    // Example with 8-bit only as tested with GCC 3.2 on AVR ATmega 128\n    unsigned int  Cnt1 = 0; // 16 bits (kind of system clock)\n    unsigned int  Cnt2 = 0; // 16 bits (observer, see what happens)\n    signed   char Timer_Secs = 0; // 8 bits with sign\n    signed   char FutureTimeout_1Minute = 60; // 8 bits with sign\n\n    while (Cnt1 &lt; 602) \n    { //                                         ## \n        if ((Timer_Secs - FutureTimeout_1Minute) == 0)\n        {\n            FutureTimeout_1Minute += 60; // Overflow/underflow allowed, \n                                         // so wraps and changes sign \n            Cnt2++; \n        } else {} // No code\n        Timer_Secs++; \n        Cnt1++;\n    } \n    //                 ## \n    // Cnt2 is 35 if &gt;  0 above   #define AFTER_F(a,b)    ((a-b)&gt;0)\n    // Cnt2 is 35 if &gt;= 0 above   #define AFTER_EQ_F(a,b) ((a-b)&gt;=0)\n    // Cnt2 is 10 if == 0 above   #define AFTER_ON_F(a,b) ((a-b)==0) **EXPECTED!**\n}\n</code></pre>\n\n<p>The compare seems to involve some kind of sign conversion. I have not studied the assembly code for the different cases, since I thought this could be solved at code level. </p>\n\n<ul>\n<li>Why is this so?</li>\n<li>To me this looks plain wrong?</li>\n<li>Still I assume it's compiled like this by design?</li>\n<li>Is there some kind of type transfer or type decoration I could have done?</li>\n</ul>\n\n<hr/>\n\n<p>The context here is a blog note called \"Know your timer's type\" at: [blog]: <a href=\"http://www.teigfam.net/oyvind/home/technology/109-know-your-timers-type/\" rel=\"nofollow\">http://www.teigfam.net/oyvind/home/technology/109-know-your-timers-type/</a></p>\n\n<p><strong>Disclaimer</strong>: this is a private blog with no money, ads, free things for me or etc. involved. Neither I nor anybody get anything from clicking on this url nor any of the urls in any of my blog notes.</p>\n\n<p><strong>It works as expected in Go</strong>, see blog note or <a href=\"http://play.golang.org/p/lH2SzZQEHG\" rel=\"nofollow\">http://play.golang.org/p/lH2SzZQEHG</a></p>\n\n<p>It does not seem to work as expected in C++ either.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 4, "creation_date": 1441566041, "post_id": 32427126, "comment_id": 52719612, "body": "Why? How long do you think it should take? Probabilistic primality tests like Miller-Rabin have to perform many bignumber modular exponentiations. It is very expensive, and the distribution of primes means that sometimes it will quickly find a prime and sometimes it takes much longer."}], "answers": [{"tags": [], "owner": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "is_accepted": false, "score": 1, "last_activity_date": 1441577667, "last_edit_date": 1441577667, "creation_date": 1441576185, "answer_id": 32428639, "question_id": 32427126, "link": "https://stackoverflow.com/questions/32427126/rand-primerand-reader-3072-takes-a-long-time-to-execute/32428639#32428639", "title": "rand.Prime(rand.Reader, 3072) takes a long time to execute", "body": "<p>Besides the computational cost of doing primality testing, according to the <a href=\"https://golang.org/pkg/crypto/rand/\" rel=\"nofollow\"><code>crypto/rand</code></a> documentation, the numbers are sourced from a \"cryptographically secure pseudorandom number generator\".  Such sources of randomness <a href=\"http://drsnyder.us/2014/04/16/linux-dev-urandom-and-concurrency.html\" rel=\"nofollow\">might be slow</a>, depending on your environment.</p>\n\n<p>That's probably why <code>crypto/prime</code> consumes an <code>io.Reader</code>, so that we can feed it another source of randomness.  <a href=\"http://play.golang.org/p/a_LTLFz35m\" rel=\"nofollow\">e.g.</a>:</p>\n\n<pre><code>package main\n\nimport (\n    cRand \"crypto/rand\"\n    \"fmt\"\n    mRand \"math/rand\"\n)\n\n// Adapted from http://stackoverflow.com/questions/12771930/\ntype randReader struct {\n    src mRand.Source\n}\n\nfunc newRandReader() *randReader {\n    // FIXME: source the seed from crypto/rand instead.\n    return &amp;randReader{mRand.NewSource(42)}\n}\n\nfunc (r *randReader) Read(p []byte) (n int, err error) {\n    for i := range p {\n        p[i] = byte(r.src.Int63() &amp; 0xff)\n    }\n    return len(p), nil\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    r := newRandReader()\n    p, _ := cRand.Prime(r, 300)\n    fmt.Println(p)\n}\n</code></pre>\n\n<p>Even with this, trying to generate 3000-bit primes does appear to be inherently slow (takes several seconds on my machine too) due to the cost of primality testing, as James K Polk suggests.</p>\n"}], "owner": {"reputation": 14004, "user_id": 41241, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/10e7a4afa4bebca010d372055bcb694f?s=128&d=identicon&r=PG", "display_name": "Nathaniel Flath", "link": "https://stackoverflow.com/users/41241/nathaniel-flath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 254, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1441577667, "creation_date": 1441565786, "question_id": 32427126, "link": "https://stackoverflow.com/questions/32427126/rand-primerand-reader-3072-takes-a-long-time-to-execute", "title": "rand.Prime(rand.Reader, 3072) takes a long time to execute", "body": "<p>I implemented RSA as an example.  Several weeks ago, it seemed to work fine.  </p>\n\n<p>Now, however, the generation of keys takes a long time (>10 seconds).  I've narrowed it down to the line:</p>\n\n<pre><code>import \"crypto/rand\"\n\np, _ := rand.Prime(rand.Reader, 3072)\n</code></pre>\n\n<p>Why would this take a significant amount of time?</p>\n"}, {"tags": ["c++11", "go"], "comments": [{"owner": {"reputation": 26541, "user_id": 1532460, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/dc5b338bf194a9e117af20bd9b2e4edb?s=128&d=identicon&r=PG", "display_name": "awesoon", "link": "https://stackoverflow.com/users/1532460/awesoon"}, "edited": false, "score": 3, "creation_date": 1441565681, "post_id": 32427023, "comment_id": 52719477, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/10962290/find-position-of-element-in-c11-range-based-for-loop\">Find position of element in C++11 range-based for loop?</a>"}, {"owner": {"reputation": 2025, "user_id": 1196279, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/693c7f7293bc656bfd35e420c0c2bef4?s=128&d=identicon&r=PG", "display_name": "Brad", "link": "https://stackoverflow.com/users/1196279/brad"}, "edited": false, "score": 1, "creation_date": 1441565708, "post_id": 32427023, "comment_id": 52719484, "body": "That, or <a href=\"http://stackoverflow.com/questions/6953128/need-iterator-when-using-ranged-based-for-loops\" title=\"need iterator when using ranged based for loops\">stackoverflow.com/questions/6953128/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1441565872, "post_id": 32427023, "comment_id": 52719549, "body": "no, the question - is there an equivalent in Go to range-for from C++11 ."}, {"owner": {"reputation": 1328, "user_id": 1020591, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/02ee2872e754aab93b82624ae58fe4d7?s=128&d=identicon&r=PG", "display_name": "RippeR", "link": "https://stackoverflow.com/users/1020591/ripper"}, "edited": false, "score": 0, "creation_date": 1441577914, "post_id": 32427023, "comment_id": 52722808, "body": "You could take a look at range-v3 at github, maybe there will be something interesting."}], "owner": {"reputation": 53, "user_id": 700784, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46b132798198b717b0f681e72b33a5cd?s=128&d=identicon&r=PG", "display_name": "Sudeep", "link": "https://stackoverflow.com/users/700784/sudeep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1441565404, "creation_date": 1441565116, "last_edit_date": 1441565404, "question_id": 32427023, "link": "https://stackoverflow.com/questions/32427023/get-index-in-range-based-for-loop-for-sequential-containers-in-c11", "title": "Get index in range-based for loop for sequential containers in c++11", "body": "<p>I have seen following snippet in Go.\nGetting index while doing range based for loop.</p>\n\n<pre><code>var pow = []int{1, 2, 4, 8, 16, 32, 64, 128}\n\nfor i, v := range pow {\n    fmt.Printf(\"2**%d = %d\\n\", i, v)\n}\n</code></pre>\n\n<p>Is there any such provision in c++11 in range-based for loop? I know having a variable and incrementing is an option, but this is more powerful.</p>\n"}, {"tags": ["go", "revel", "go-gorm"], "comments": [{"owner": {"reputation": 1395, "user_id": 88392, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/da05d7fad9811c553b747c2d7861d18d?s=128&d=identicon&r=PG", "display_name": "Fusspawn", "link": "https://stackoverflow.com/users/88392/fusspawn"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1441561470, "post_id": 32426216, "comment_id": 52718151, "body": "sorry took me a moment to battle the formatting"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1441565030, "post_id": 32426216, "comment_id": 52719243, "body": "Have you tried to create a <a href=\"http://stackoverflow.com/help/mcve\">minimal, complete, and verifiable example</a>? Not only is that <i>much</i> easier for potential answerers than looking at a whole GitHub repo (which won&#39;t be the same in the future, rendering this post fairly useless) but the act of making an mcve can help the questioner understand their own problem better."}], "answers": [{"comments": [{"owner": {"reputation": 1395, "user_id": 88392, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/da05d7fad9811c553b747c2d7861d18d?s=128&d=identicon&r=PG", "display_name": "Fusspawn", "link": "https://stackoverflow.com/users/88392/fusspawn"}, "edited": false, "score": 0, "creation_date": 1441582578, "post_id": 32428439, "comment_id": 52723730, "body": "That was it. changing the EventStream docs to embed a GormController and not *GormController stopped the panic. Makes total sense when I think about it.   Not quite sure how it ended up as *GormController in the first place."}], "tags": [], "owner": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "is_accepted": true, "score": 2, "last_activity_date": 1441575157, "last_edit_date": 1441575157, "creation_date": 1441574596, "answer_id": 32428439, "question_id": 32426216, "link": "https://stackoverflow.com/questions/32426216/go-panics-on-when-having-functions-declared-in-code-but-not-called/32428439#32428439", "title": "Go panics on when having functions declared in code but not called", "body": "<p>According to the Revel docs, the system looks for Controllers in debug mode by <a href=\"https://revel.github.io/tutorial/requestflow.html#hot-reload\" rel=\"nofollow\">scanning your source directory</a> for anything that does an anonymous embedding of a <code>*Revel.Controller</code>.  The error your're seeing is due to Revel doing dynamic reflection and screwing up during this controller-scanning initialization.  So now the question is: why is it having trouble scanning for controllers?</p>\n\n<p>Your code appears to try to extend a controller in <a href=\"https://github.com/fusspawn/tserver/blob/2588ef1ee1c0a200576b37ce3548749191d8809c/app/controllers/eventstream.go#L10\" rel=\"nofollow\">EventStream</a>, which the Revel debug controller-discovery code will try to read as a Controller.  However, the code as it stands is currently violating expectations of the framework by embedding a <code>*GormController</code> instead of a <code>GormController</code>; see the last part of the <a href=\"https://revel.github.io/quickstart/controllers.html#extending-the-controller\" rel=\"nofollow\">Controllers documentation</a>.</p>\n\n<p>I think the controller-discovery logic is simply choking because of this.  Fix the <code>EventStream</code> structure definition.</p>\n\n<p>If this does correct the issue for you, you should probably send a bug report to the Revel folks, because the error message you're getting back is pretty bad and non-local, because it doesn't mention the name of the thing it's trying to register as a controller when it fails.</p>\n"}], "owner": {"reputation": 1395, "user_id": 88392, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/da05d7fad9811c553b747c2d7861d18d?s=128&d=identicon&r=PG", "display_name": "Fusspawn", "link": "https://stackoverflow.com/users/88392/fusspawn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 32428439, "answer_count": 1, "score": 1, "last_activity_date": 1459965127, "creation_date": 1441559940, "last_edit_date": 1459965127, "question_id": 32426216, "link": "https://stackoverflow.com/questions/32426216/go-panics-on-when-having-functions-declared-in-code-but-not-called", "title": "Go panics on when having functions declared in code but not called", "body": "<p>Context: \n    <a href=\"https://github.com/fusspawn/tserver/blob/master/app/controllers/gorp.go\" rel=\"nofollow\">https://github.com/fusspawn/tserver/blob/master/app/controllers/gorp.go</a></p>\n\n<p>As part of trying to get gorm setup I tried to convert the standard revel/gorp examples.</p>\n\n<p>However. even having the Begin(),Commit(),Rollback() methods defined is enough to cause go to panic.</p>\n\n<pre><code>   TRACE 2015/09/06 17:37:47 harness.go:126: Rebuild                                                                                                  \n   INFO  2015/09/06 17:37:47 build.go:172: Cleaning dir tmp                                                                                           \n   INFO  2015/09/06 17:37:47 build.go:172: Cleaning dir routes                                                                                        \n   INFO  2015/09/06 17:37:47 build.go:172: Cleaning dir tmp                                                                                           \n   INFO  2015/09/06 17:37:47 build.go:172: Cleaning dir routes                                                                                        \n   TRACE 2015/09/06 17:37:47 build.go:151: Exec: [/usr/bin/git --git-   dir=/home/fusspawn/go/src/github.com/fusspawn/tserver/.git describe --always --   dirty]                                                                                                                                               \n   TRACE 2015/09/06 17:37:47 build.go:94: Exec: [/usr/bin/go build -ldflags    -X github.com/fusspawn/tserver/app.APP_VERSION \"git-2588ef1\" -tags  -o /ho\n  me/fusspawn/go/bin/revel.d/github.com/fusspawn/tserver/tserver   github.com/fusspawn/tserver/app/tmp]                                                \n   TRACE 2015/09/06 17:39:14 app.go:56: Exec app:   /home/fusspawn/go/bin/revel.d/github.com/fusspawn/tserver/tserver    [/home/fusspawn/go/bin/revel.d/git\n   hub.com/fusspawn/tserver/tserver -port=46276 -  importPath=github.com/fusspawn/tserver -runMode=dev]                                                 \n   INFO  2015/09/06 17:39:14 revel.go:329: Loaded module static                                                                                       \n   INFO  2015/09/06 17:39:14 revel.go:329: Loaded module testrunner                                                                                   \n   INFO  2015/09/06 17:39:14 revel.go:206: Initialized Revel v0.12.0 (2015-03-25) for &gt;= go1.3                                                        \n   INFO  2015/09/06 17:39:14 main.go:30: Running revel server                                                                                         \n   TRACE 2015/09/06 17:39:14 controller.go:402: Registered controller: App                                                                            \n   panic: reflect: call of reflect.Value.Type on zero Value                                                                                           \n\n   goroutine 1 [running]:                                                                                                                             \n   runtime.panic(0x88cec0, 0xc21011b7a0)                                                                                                              \n    /usr/lib/go/src/pkg/runtime/panic.c:266 +0xb6                                                                                              \n   reflect.Value.Type(0x0, 0x0, 0x0, 0x0, 0x0)                                                                                                        \n    /usr/lib/go/src/pkg/reflect/value.go:1698 +0x79                                                                                            \n    github.com/revel/revel.findControllers(0x7f365698bea8, 0x9186e0, 0x0, 0x0, 0x0)                                                                    \n    /home/fusspawn/go/src/github.com/revel/revel/controller.go:321 +0x25a                                                                      \n    github.com/revel/revel.RegisterController(0x9172a0, 0x0, 0xc2100c4bf0,    0x2, 0x2)                                                                   \n     /home/fusspawn/go/src/github.com/revel/revel/controller.go:400 +0x1f3                                                                      \n    main.main()                                                                                                                                        \n     /home/fusspawn/go/src/github.com/fusspawn/tserver/app/tmp/main.go:150  +0x141b                                                              \n     TRACE 2015/09/06 17:39:14 controller.go:402: Registered controller:     GormController                                                                 \n     TRACE 2015/09/06 17:39:14 controller.go:402: Registered controller: Static                                                                         \n     TRACE 2015/09/06 17:39:14 controller.go:402: Registered controller:  TestRunner             \n</code></pre>\n\n<p>Commenting out the method definitions will stop the panic.  I cant seem to understand how not calling these methods (note the revel.InterceptMethod calls are commented out) can make the panic happen :/ </p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1441558149, "post_id": 32425866, "comment_id": 52717073, "body": "may  load data in map[string]interface{}, and then compare with the known fields?"}, {"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1441559365, "post_id": 32425866, "comment_id": 52717514, "body": "That sounds quite laborious isn&#39;t it? I mean if you have nested fields and many types to unmarshall."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1441559993, "post_id": 32425866, "comment_id": 52717693, "body": "I don&#39;t know. This is the only solution that I can offer."}, {"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 1, "creation_date": 1441560780, "post_id": 32425866, "comment_id": 52717933, "body": "What do you need the unknown part for? <a href=\"https://godoc.org/encoding/json#RawMessage\" rel=\"nofollow noreferrer\"><code>RawMessage</code></a> might be of help to you."}, {"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1441567978, "post_id": 32425866, "comment_id": 52720181, "body": "I&#39;m not sure I understand the question. The point is that I should store the &quot;unknown&quot; fields in a blob or something so that i can audit them later and change the types accordingly. Does it make sense?"}], "answers": [{"tags": [], "owner": {"reputation": 116, "user_id": 567512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b4319173ff1a5fb56ea2cfbd6781414?s=128&d=identicon&r=PG", "display_name": "reedobrien", "link": "https://stackoverflow.com/users/567512/reedobrien"}, "is_accepted": false, "score": 0, "last_activity_date": 1441566558, "creation_date": 1441566558, "answer_id": 32427234, "question_id": 32425866, "link": "https://stackoverflow.com/questions/32425866/how-to-unmarshall-store-unknown-json-fields/32427234#32427234", "title": "How to unmarshall / store unknown json fields?", "body": "<p>You could use RawMessage as inf suggested. Here's an example using <a href=\"https://github.com/sharktanklabs/j2n\" rel=\"nofollow\">sharktanklabs j2n package</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n\n    \"github.com/sharktanklabs/j2n\"\n)\n\ntype TweetData struct {\n    User_id  int\n    Message  string\n    Overflow map[string]*json.RawMessage `json:\"-\"`\n}\n\ntype Tweet struct {\n    TweetData\n}\n\nfunc (c *Tweet) UnmarshalJSON(data []byte) error {\n    return j2n.UnmarshalJSON(data, &amp;c.TweetData)\n}\n\nfunc (c Tweet) MarshalJSON() ([]byte, error) {\n    return j2n.MarshalJSON(c.TweetData)\n}\n\nfunc main() {\n    // Define an empty interface\n    var t Tweet\n\n    // Convert JSON string into bytes\n    b := []byte(`{\"user_id\": 1, \"message\": \"Hello world\", \"Date\": \"somerandom date\"}`)\n\n    // Decode bytes b into interface i\n    json.Unmarshal(b, &amp;t)\n    fmt.Printf(\"%#v\\n\", t)\n}\n// Formatted output: \n//     main.Tweet{TweetData:main.TweetData{\n//         User_id:1, \n//         Message:\"Hello world\",     \n//         Overflow:map[string]*json.RawMessage{\n//             \"user_id\":(*json.RawMessage)(0xc82000e340), \n//             \"message\":(*json.RawMessage)(0xc82000e3c0), \n//             \"Date\":(*json.RawMessage)(0xc82000e440)}}}\n</code></pre>\n"}], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1441566558, "creation_date": 1441557590, "question_id": 32425866, "link": "https://stackoverflow.com/questions/32425866/how-to-unmarshall-store-unknown-json-fields", "title": "How to unmarshall / store unknown json fields?", "body": "<p>I need to Unmarshal json from a 3rd party API. Although I know the response type I need to make sure I don't loose any field that the API may introduce (the api has no documentation) so I'm wondering how can I do that. Ideally I would like to store the unknown fields in an interface{} value and perhaps encode it for later audit. Here is what i've tried so far but it doesn't work(<code>Data</code> field which is \"unknown\" at compile time is lost during unmarshalling).</p>\n\n<p><a href=\"http://play.golang.org/p/PqFATdMpiS\" rel=\"nofollow\">Play</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Tweet struct {\n    User_id int\n    Message string\n    Unknown\n}\ntype Unknown map[interface{}]interface{}\n\nfunc main() {\n    // Define an empty interface\n    var t Tweet\n\n    // Convert JSON string into bytes\n    b := []byte(`{\"user_id\": 1, \"message\": \"Hello world\", \"Date\": \"somerandom date\"}`)\n\n    // Decode bytes b into interface i\n    json.Unmarshal(b, &amp;t)\n    fmt.Println(t)\n}\n</code></pre>\n"}, {"tags": ["go", "mocking", "stubbing"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1267177"}, "edited": false, "score": 1, "creation_date": 1517279052, "post_id": 32426652, "comment_id": 84020680, "body": "If this is used inside go routines, or your function will be called in a go routine, it&#39;ll have data race condition. Just saying so it might help someone else."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 11, "last_activity_date": 1441790946, "last_edit_date": 1441790946, "creation_date": 1441562739, "answer_id": 32426652, "question_id": 32425558, "link": "https://stackoverflow.com/questions/32425558/how-to-verify-if-a-specific-function-is-called/32426652#32426652", "title": "How to verify if a specific function is called", "body": "<p>You can fake the whole deal with interfaces, but you could also use fakeable functions. In the code:</p>\n\n<pre><code>var cmdStart = (*exec.Cmd).Start\nfunc (f *Feature) Start() error {\n    cmd := exec.Command(f.Cmd)\n    return cmdStart(cmd)\n}\n</code></pre>\n\n<p>In the tests:</p>\n\n<pre><code>called := false\ncmdStart = func(*exec.Cmd) error { called = true; return nil }\nf.Start()\nif !called {\n    t.Errorf(\"command didn't start\")\n}\n</code></pre>\n\n<p>See also: Andrew Gerrand's <a href=\"http://www.youtube.com/watch?v=ndmB0bj7eyw\" rel=\"noreferrer\">Testing Techniques talk</a>.</p>\n"}], "owner": {"reputation": 329, "user_id": 4255617, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-TlZ_zzZY14I/AAAAAAAAAAI/AAAAAAAAAEA/nDZqovmltJk/photo.jpg?sz=128", "display_name": "Patrick", "link": "https://stackoverflow.com/users/4255617/patrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14407, "favorite_count": 4, "accepted_answer_id": 32426652, "answer_count": 1, "score": 13, "last_activity_date": 1613510385, "creation_date": 1441555706, "last_edit_date": 1613510385, "question_id": 32425558, "link": "https://stackoverflow.com/questions/32425558/how-to-verify-if-a-specific-function-is-called", "title": "How to verify if a specific function is called", "body": "<p>I'm trying my hand at writing TDD in Go. I am however stuck at the following.</p>\n<p>The test to write:</p>\n<pre><code>func TestFeatureStart(t *testing.T) {}\n</code></pre>\n<p>Implementation to test:</p>\n<pre><code>func (f *Feature) Start() error {\n  cmd := exec.Command(f.Cmd)\n  cmd.Start()\n}\n</code></pre>\n<p>How would one test this simple bit? I figured I only wanted to verify that the exec library is spoken to correctly. That's the way I would do it in Java using Mockito. Can anyone help me write this test? From what I've read the usage of interfaces is suggested.</p>\n<p>The Feature-struct only contains a string Cmd.</p>\n"}, {"tags": ["go", "docker", "vagrant"], "owner": {"reputation": 117, "user_id": 5293751, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3f64678fcaee742970a008c58d857b64?s=128&d=identicon&r=PG&f=1", "display_name": "Pavlo I.", "link": "https://stackoverflow.com/users/5293751/pavlo-i"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1441645803, "creation_date": 1441554611, "last_edit_date": 1441645803, "question_id": 32425355, "link": "https://stackoverflow.com/questions/32425355/deploy-go-app-to-docker-in-vagrant", "title": "Deploy go app to docker in vagrant", "body": "<p>Now i'm working on RESTfull API on go, using Windows and goclipse. \nTesting environemnt consists of few VMs managed by Vagrant. These machines contain nginx, PostgreSQL etc. The app should be deployed into Docker on the separated VM. </p>\n\n<p>There is no problem to deploy app on first time using guide like here: <a href=\"https://blog.golang.org/docker\" rel=\"nofollow\">https://blog.golang.org/docker</a>. I've read a lot of information and guides but still totally confused how to automate deploying process and update go app in docker after some changes in code done. On the current stage changes in code done very often, so deploying should be fast.</p>\n\n<p>Could you please advise me with correct way to setup some kind of local CI for such case? What approach will be better?\nThanks a lot.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 36371, "user_id": 1180785, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/UjU0z.png?s=128&g=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/1180785/dave"}, "is_accepted": true, "score": 8, "last_activity_date": 1441548433, "last_edit_date": 1441548433, "creation_date": 1441547389, "answer_id": 32424271, "question_id": 32424242, "link": "https://stackoverflow.com/questions/32424242/how-to-pass-a-flag-to-a-command-in-go-lang/32424271#32424271", "title": "How to pass a flag to a command in go lang?", "body": "<p>You pass arguments to the program by passing more arguments to the function - it's variadic:</p>\n\n<pre><code>out,err := exec.Command(\"ls\",\"-ltr\").Output()\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/os/exec/#Command\">https://golang.org/pkg/os/exec/#Command</a></p>\n\n<p>This is a pretty common convention with exec-style functions which you will see in most languages. The other common pattern is builders.</p>\n\n<hr>\n\n<p>Sometimes the layout of arguments you need to pass won't be known at compile-time (though it's not a good idea to send arbitrary commands to the system - stay safe!). If you want to pass an unknown number of arguments, you can use an array with some special syntax:</p>\n\n<pre><code>// Populate myArguments however you like\nmyArguments := []string{\"bar\",\"baz\"}\n\n// Pass myArguments with \"...\" to use variadic behaviour\nout,err := exec.Command(\"foo\", myArguments...).Output()\n</code></pre>\n"}], "owner": {"reputation": 2203, "user_id": 773079, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/f494bf18ea8fc96190a398ecee6deedc?s=128&d=identicon&r=PG", "display_name": "Pensu", "link": "https://stackoverflow.com/users/773079/pensu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2486, "favorite_count": 0, "accepted_answer_id": 32424271, "answer_count": 1, "score": 2, "last_activity_date": 1441548433, "creation_date": 1441547157, "question_id": 32424242, "link": "https://stackoverflow.com/questions/32424242/how-to-pass-a-flag-to-a-command-in-go-lang", "title": "How to pass a flag to a command in go lang?", "body": "<p>I have been trying to run a command and parse the output in golang. Here is a sample of what I am trying to do:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n        \"fmt\"\n    \"os/exec\"\n)\n\nfunc main() {\n    out,err := exec.Command(\"ls -ltr\").Output()\n        if err != nil {\n                fmt.Println(\"Error: %s\", err)\n        }\n    fmt.Printf(\"%s\",out)\n}\n</code></pre>\n\n<p>Now, when I am trying to run \"ls -ltr\", I get this error:</p>\n\n<pre><code>Error: %s exec: \"ls -ltr\": executable file not found in $PATH\n</code></pre>\n\n<p>So, basically go is looking for whole \"ls -ltr\" in PATH. And it's not there obviously. Is there any way I can pass a flag to any argument?TIA.</p>\n"}, {"tags": ["string", "text", "go", "slice"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 5, "creation_date": 1441529193, "post_id": 32421649, "comment_id": 52708900, "body": "perhaps a diff library? <a href=\"https://github.com/sergi/go-diff\" rel=\"nofollow noreferrer\">github.com/sergi/go-diff</a>"}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1441550767, "post_id": 32422387, "comment_id": 52714810, "body": "You could also use a buffered reader to read chunks of a file (say, 4K blocks), hash them and compare. This avoids having to hash large files, improves speed (you bail out early) and should avoid collisions. SHA-2 should be suitable."}, {"owner": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "edited": false, "score": 0, "creation_date": 1542753949, "post_id": 32422387, "comment_id": 93680738, "body": "Also Rolling Hash functions are a thing, and so if you are going for maximum performance that&#39;s the way to go. I&#39;d be surprised if the core algorithms haven&#39;t been implemented in Go yet.  <a href=\"https://en.wikipedia.org/wiki/Rolling_hash\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Rolling_hash</a>"}], "tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": true, "score": 5, "last_activity_date": 1441551642, "last_edit_date": 1441551642, "creation_date": 1441534329, "answer_id": 32422387, "question_id": 32421649, "link": "https://stackoverflow.com/questions/32421649/golang-comparing-two-txt-files/32422387#32422387", "title": "golang -Comparing two txt files", "body": "<p>Instead of looping use standard third-party library, with small optimisation.</p>\n\n<p>One of the library that I've used in past is <a href=\"https://github.com/sergi/go-diff\" rel=\"nofollow\" title=\"go-diff\">Go port of google-diff-match-patch</a> (same library that @Not_a_golfer suggested in the comment.).</p>\n\n<p>You can optimise this by first calculating <code>sha2</code> hash of two files, and if they are not the same, you can assume that they are changed, otherwise (probably) they are same, and skip the diff operation. </p>\n\n<p>One drawback of this optimisation is that, because of pigeon-hole principle, it is possible theoretically to have same hash value, for different contents. But, the probability of happening that is quite small.</p>\n\n<p><strong>EDIT (based on @elithrar's comment):</strong>\nSince calculation of hash for very large file, can be time consuming. You can calculate <code>sha2</code> in chunks (size depends on particular hash algorithm from <code>sha2</code> family). This enables you to bail out early, and improves speed.</p>\n"}], "owner": {"reputation": 343, "user_id": 4319593, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nox3N.jpg?s=128&g=1", "display_name": "Gamoonbi", "link": "https://stackoverflow.com/users/4319593/gamoonbi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2836, "favorite_count": 0, "accepted_answer_id": 32422387, "answer_count": 1, "score": 2, "last_activity_date": 1441551642, "creation_date": 1441528859, "question_id": 32421649, "link": "https://stackoverflow.com/questions/32421649/golang-comparing-two-txt-files", "title": "golang -Comparing two txt files", "body": "<p>I want to know the contents when file changed</p>\n\n<p>there is a simeple txt file </p>\n\n<pre><code>textOne 1,2,3,4,5,6,7,8,9,10\n</code></pre>\n\n<p>and i change it to</p>\n\n<pre><code>textTwo 1,2,3,4,7,7,7,8,9,10\n</code></pre>\n\n<p>so 'One' and '5,6' changed to 'two', '7,7'</p>\n\n<p>I can find things which changed by loop. but I wonder if there was some better way to check </p>\n"}, {"tags": ["go", "sublimetext2", "sublimetext3"], "answers": [{"comments": [{"owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "edited": false, "score": 1, "creation_date": 1441536330, "post_id": 32421076, "comment_id": 52710682, "body": "Thanks Lebowski! You can keep your Johnson."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "edited": false, "score": 0, "creation_date": 1441538921, "post_id": 32421076, "comment_id": 52711423, "body": "@Aiden mein name ist Karl Ich bin expert"}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 3, "last_activity_date": 1441524470, "creation_date": 1441524470, "answer_id": 32421076, "question_id": 32421033, "link": "https://stackoverflow.com/questions/32421033/how-can-i-disable-func-init-autocomplete-in-gosublime/32421076#32421076", "title": "How can I disable func init() autocomplete in GoSublime?", "body": "<p>In your GoSublime package settings (copy the default to user if you haven't already), there's a line that goes:</p>\n\n<pre><code>{\"text\": \"init\", \"title\": \"func init()\", \"value\": \"func init() {\\n\\t$1\\n}\"},\n</code></pre>\n\n<p>Delete it and I think you'll be fine</p>\n"}], "owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 32421076, "answer_count": 1, "score": 3, "last_activity_date": 1441524470, "creation_date": 1441524023, "question_id": 32421033, "link": "https://stackoverflow.com/questions/32421033/how-can-i-disable-func-init-autocomplete-in-gosublime", "title": "How can I disable func init() autocomplete in GoSublime?", "body": "<p>Every time I enter the keyword <code>int</code> which is quite often.. I get a suggestion for autocompletion on</p>\n\n<pre><code>func init() {\n\n}\n</code></pre>\n\n<p>So every time I write <code>int</code> and press enter I end up with this function, and then I have to manually remove it and then rewrite <code>int</code> again and click left and right arrow a couple of times until the autocompletion disappears.</p>\n\n<p>This is a horrible experience when you have to do it so many times in 1 hour.. How can I solve it?</p>\n"}, {"tags": ["node.js", "web-services", "rest", "go", "oauth-2.0"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1441523860, "post_id": 32420713, "comment_id": 52707663, "body": "Are you talking about normal user access or the oauth access scenario?"}, {"owner": {"reputation": 10247, "user_id": 386188, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/IX45D.jpg?s=128&g=1", "display_name": "Toan Nguyen", "link": "https://stackoverflow.com/users/386188/toan-nguyen"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1441524330, "post_id": 32420713, "comment_id": 52707752, "body": "HI inf, I&#39;m talking about both of them. The service must authenticate and authorize normal users. Potentially support mobile applications developed by third-party companies. In .Net space there is an OAUTH2 implementation <a href=\"https://github.com/identityserver/IdentityServer3\" rel=\"nofollow noreferrer\">github.com/identityserver/IdentityServer3</a>"}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441544744, "post_id": 32420745, "comment_id": 52713082, "body": "OAuth2 is only as secure as the implementation: HTTPS only, correct validating and expiring tokens, etc."}], "tags": [], "owner": {"reputation": 796, "user_id": 2372903, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/wIXue.jpg?s=128&g=1", "display_name": "Andrew Mata", "link": "https://stackoverflow.com/users/2372903/andrew-mata"}, "is_accepted": false, "score": 0, "last_activity_date": 1441521252, "creation_date": 1441521252, "answer_id": 32420745, "question_id": 32420713, "link": "https://stackoverflow.com/questions/32420713/how-can-i-protect-my-go-rest-services-in-product-environment/32420745#32420745", "title": "How can I protect my GO REST services in product environment?", "body": "<p>Though Oauth2 is very secure and a great implementation.</p>\n\n<p>A common procedure used to secure web applications is as follows.</p>\n\n<p>User registers to application and sends registration data to backend.\nServer handles registration information.\nStore hashed user password for future token requests and other such requests\nCreate access token to be passed back to user(usually 32-64 bit)\nhash access token and store it in database for authentication of restful requests\nSend user back any data required as well as access token.\nStore access token on client machine(Possibly using localstorage.set() )\nFuture requests will have the access token attached to them for authentication.</p>\n\n<p>Always check that the access token is still access and that it's hash matches the hashed value in the database.</p>\n\n<p>Other implementations involve JWT's and so on.</p>\n"}, {"tags": [], "owner": {"reputation": 1121, "user_id": 316240, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6c08551eff0f8316d41c104a25be60a?s=128&d=identicon&r=PG", "display_name": "Parth Desai", "link": "https://stackoverflow.com/users/316240/parth-desai"}, "is_accepted": false, "score": 0, "last_activity_date": 1441550460, "creation_date": 1441550460, "answer_id": 32424709, "question_id": 32420713, "link": "https://stackoverflow.com/questions/32420713/how-can-i-protect-my-go-rest-services-in-product-environment/32424709#32424709", "title": "How can I protect my GO REST services in product environment?", "body": "<p>If you do not have enough expertise in reviewing OAuth 2.0 library, then I would recommend to use reliable third party Oauth-as-a-service provider.</p>\n\n<p>One example I know is Microsoft Azure ACS, which you can integrate with your golang application, and they will handle OAuth process as well as authentication and authorisation for you.</p>\n\n<p>You can read about how it works <a href=\"https://msdn.microsoft.com/en-us/library/azure/dn645542.aspx\" rel=\"nofollow\" title=\"Oauth flow\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 10247, "user_id": 386188, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/IX45D.jpg?s=128&g=1", "display_name": "Toan Nguyen", "link": "https://stackoverflow.com/users/386188/toan-nguyen"}, "is_accepted": true, "score": 1, "last_activity_date": 1442033664, "creation_date": 1442033664, "answer_id": 32535296, "question_id": 32420713, "link": "https://stackoverflow.com/questions/32420713/how-can-i-protect-my-go-rest-services-in-product-environment/32535296#32535296", "title": "How can I protect my GO REST services in product environment?", "body": "<p>Right after I asked the question, CoreOS released \"dex\" as an open source OpenID provider at <a href=\"https://github.com/coreos/dex\" rel=\"nofollow\">https://github.com/coreos/dex</a></p>\n"}], "owner": {"reputation": 10247, "user_id": 386188, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/IX45D.jpg?s=128&g=1", "display_name": "Toan Nguyen", "link": "https://stackoverflow.com/users/386188/toan-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 32535296, "answer_count": 3, "score": 0, "last_activity_date": 1442033664, "creation_date": 1441520905, "last_edit_date": 1441524390, "question_id": 32420713, "link": "https://stackoverflow.com/questions/32420713/how-can-i-protect-my-go-rest-services-in-product-environment", "title": "How can I protect my GO REST services in product environment?", "body": "<p>I'm recently dealing with Go REST services, but I don't know if there any production-ready OAUTH2 server available?</p>\n\n<p>As my services will be consumed by a single-paged web app as well as mobile clients, and users should be able to register their accounts, so I'm thinking about an OAUTH2 server. </p>\n\n<p>I've been searching around and found that the standard package contains only the client side code <a href=\"https://github.com/golang/oauth2/blob/master/oauth2.go\" rel=\"nofollow\">https://github.com/golang/oauth2/blob/master/oauth2.go</a>.</p>\n\n<p>There is an OAUTH2 server built in Go (<a href=\"https://github.com/RangelReale/osin\" rel=\"nofollow\">https://github.com/RangelReale/osin</a>), but I don't have much expertise to review it.</p>\n\n<p>Therefore, what are the options available for production applications? Should I use an OAUTH server implemented in another technology like nodejs because of their maturity?</p>\n\n<p>EDIT: In .Net space there is a server implementation at <a href=\"https://github.com/identityserver/IdentityServer3\" rel=\"nofollow\">https://github.com/identityserver/IdentityServer3</a></p>\n\n<p>However, I would prefer something in GO.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1441523947, "post_id": 32420339, "comment_id": 52707675, "body": "You should not use any syntax until you <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">read the documentation for it</a>. Seriously, read the spec and take the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Go Tour</a> before asking basic syntax questions. The <a href=\"http://stackoverflow.com/tags/go/info\">Go tag</a> also a has a list of many other resources."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1441517944, "last_edit_date": 1441517944, "creation_date": 1441517619, "answer_id": 32420385, "question_id": 32420339, "link": "https://stackoverflow.com/questions/32420339/what-does-wrapping-a-type-in-do-and-when-should-i-use-it-golang/32420385#32420385", "title": "What does wrapping a type in () do and when should I use it? Golang", "body": "<p>It's a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">type assertion</a>. Type assertions are used to extract the value in an interface type as some other type.</p>\n\n<p>The expression <code>blah.(*int)</code> asserts that the type of the value in <code>blah</code> is <code>*int</code>.  If the assertion holds, then the value of the expression is the value stored in <code>blah</code> as a <code>*int</code>. If the assertion does not hold, then the expression panics.</p>\n\n<p>A special form of a type assertion can be used in an assignment to test the assertion:</p>\n\n<pre><code> ip, ok := blah.(*int)\n</code></pre>\n\n<p>If the value in blah is of <code>*int</code>, then the value is stored in <code>ip</code> and <code>ok</code> is set to true. Otherwise, <code>ip</code> is set to the zero value and <code>ok</code> is false.</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "closed_date": 1441526843, "accepted_answer_id": 32420385, "answer_count": 1, "score": -2, "last_activity_date": 1441517944, "creation_date": 1441517057, "question_id": 32420339, "link": "https://stackoverflow.com/questions/32420339/what-does-wrapping-a-type-in-do-and-when-should-i-use-it-golang", "closed_reason": "Duplicate", "title": "What does wrapping a type in () do and when should I use it? Golang", "body": "<p>What exactly does wrapping a type in () do exactly and when should I use it? E.g. <code>blah.(*int)</code></p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1441487088, "post_id": 32417541, "comment_id": 52701670, "body": "Perhaps it&#39;s an issue with the type not being an exported one? I haven&#39;t worked with gob in ages so I&#39;m rusty about how it works."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1441491017, "post_id": 32417541, "comment_id": 52702515, "body": "I&#39;d second Not_a_Golfer&#39;s suspicion: From the documentation of encoding/gib: &quot;Structs encode and decode only exported fields.&quot;. As this probably has <i>nothing</i> to do with appengine, HTTP requests or the datastore: Could you produce an example runnable in the playground?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1441493075, "post_id": 32417541, "comment_id": 52702952, "body": "The gob package encodes unexported types just fine. <a href=\"http://play.golang.org/p/-lu435K4Zt\" rel=\"nofollow noreferrer\">Example</a>.  OP, please check that you are starting the server after making the changes."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1441498268, "post_id": 32417541, "comment_id": 52703822, "body": "Call <code>gob.Register()</code> <i>once</i> in your programs <code>init()</code> function."}, {"owner": {"reputation": 69, "user_id": 5141761, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/85a27906920ee18441dde2016b3c5062?s=128&d=identicon&r=PG&f=1", "display_name": "borring", "link": "https://stackoverflow.com/users/5141761/borring"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1441510743, "post_id": 32417541, "comment_id": 52705526, "body": "@BravadaZadada The datastore entries were already saved from the previous runs. That was verified by going to the admin console in the appengine sdk local development server."}, {"owner": {"reputation": 69, "user_id": 5141761, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/85a27906920ee18441dde2016b3c5062?s=128&d=identicon&r=PG&f=1", "display_name": "borring", "link": "https://stackoverflow.com/users/5141761/borring"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441510816, "post_id": 32417541, "comment_id": 52705543, "body": "@elithrar I already experimented with that. I took the calls out of <code>load()</code> and <code>save()</code> and put them in the beginning of <code>init()</code> with the same result. Same behavior."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441510931, "post_id": 32417541, "comment_id": 52705567, "body": "Can you also post/add the type definition for <code>*b</code> (which I assume is global and not inside a function)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1441514024, "post_id": 32417541, "comment_id": 52706069, "body": "It looks like type <code>strand</code> was registered with the package name <code>main27155</code>.  Is that a package in your application?  If <code>main27155</code> is an AppEngine generated package name, then use gob.RegisterName(&quot;main.srand&quot;, srand) to force a fixed name. Clear any existing saved data to eliminate confusion with possible bad names in the data.  Call gob.Register() once in init() as stated earlier."}, {"owner": {"reputation": 69, "user_id": 5141761, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/85a27906920ee18441dde2016b3c5062?s=128&d=identicon&r=PG&f=1", "display_name": "borring", "link": "https://stackoverflow.com/users/5141761/borring"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441520413, "post_id": 32417541, "comment_id": 52707028, "body": "@elithrar Just added the information"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 5141761, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/85a27906920ee18441dde2016b3c5062?s=128&d=identicon&r=PG&f=1", "display_name": "borring", "link": "https://stackoverflow.com/users/5141761/borring"}, "edited": false, "score": 0, "creation_date": 1441550762, "post_id": 32424561, "comment_id": 52714807, "body": "You were right about <code>RegisterName()</code> I don&#39;t know why it didn&#39;t work before. Thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1441549407, "creation_date": 1441549407, "answer_id": 32424561, "question_id": 32417541, "link": "https://stackoverflow.com/questions/32417541/gob-interface-is-only-registered-on-encode-but-not-on-decode/32424561#32424561", "title": "gob: interface is only registered on Encode but not on Decode", "body": "<p>Register all types an in init() functions using <a href=\"http://godoc.org/encoding/gob#RegisterName\" rel=\"nofollow\">RegisterName()</a>.  Delete all existing data from the store and you should be good to go. </p>\n\n<p>App Engine generates a mangled name for the main package every time the application is built. The name generated by <a href=\"http://godoc.org/encoding/gob#Register\" rel=\"nofollow\">Register()</a> includes this mangled package name. Any gobs encoded with the mangled name will only be readable using the same build of the app. If you cause the application to be rebuilt by modifying the code, then the app will not be able to decode gobs stored previously.</p>\n"}], "owner": {"reputation": 69, "user_id": 5141761, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/85a27906920ee18441dde2016b3c5062?s=128&d=identicon&r=PG&f=1", "display_name": "borring", "link": "https://stackoverflow.com/users/5141761/borring"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 544, "favorite_count": 0, "accepted_answer_id": 32424561, "answer_count": 1, "score": 0, "last_activity_date": 1441549407, "creation_date": 1441486164, "last_edit_date": 1441520298, "question_id": 32417541, "link": "https://stackoverflow.com/questions/32417541/gob-interface-is-only-registered-on-encode-but-not-on-decode", "title": "gob: interface is only registered on Encode but not on Decode", "body": "<p>I'm working on an appengine app using the datastore. I'm attempting to gob\nencode an interface and store it into the datastore. But when I try to load from\nthe datastore, I get the error:</p>\n\n<pre><code>gob: name not registered for interface: \"main27155.strand\"\n</code></pre>\n\n<p>The peculiar thing is that the <code>load()</code> method starts working after having\ncalled the <code>save()</code> method. It no longer returns an error, and everything saved\nin the datastore is loaded as expected. But when I restart the intance, the\n<code>load()</code> method stops working again.</p>\n\n<p>The load and save methods I mention refer to the methods defined by the\n<code>datastore.PropertyLoadSaver</code> interface</p>\n\n<p>From the looks of it, it seems like a problem with registering the\ntype/interfaces with gob, but I have exactly the same <code>gob.Register()</code> calls in\nboth the <code>load()</code> and <code>save()</code> methods.</p>\n\n<p>I even tried removing the <code>gob.Register()</code> calls from both load and save methods\nand adding it to <code>init()</code>. The exact same behavior was observed.</p>\n\n<p>How can I load my datastore on a cold start?</p>\n\n<pre><code>type bio struct {\u00ac                          \n    Id       string\u00ac                        \n    Hp       int\u00ac                           \n    godie    chan bool //should be buffered\u00ac\n    dam      chan int\u00ac                      \n    Genetics dna\u00ac                           \n}\u00ac                                          \n\ntype dna interface {\n    decode() mRNA\n    Get(int) trait\n    Set(int, trait)\n    Duplicate() dna\n    Len() int\n}\ntype trait interface {\n    mutate() trait\n}\n\n// implements dna{}\ntype strand []trait\n\n// implements trait{}\ntype tdecoration string\ntype color struct {\n    None bool // If true, colors are not shown in theme\n    Bg   bool // If true, color is a background color\n    R    int  // 0-255\n    G    int\n    B    int\n}\n</code></pre>\n\n<p>.</p>\n\n<pre><code>func start(w http.ResponseWriter, r *http.Request) error {\n    c := appengine.NewContext(r)\n\n    var bs []bio\n    if _, err := datastore.NewQuery(\"bio\").GetAll(c, &amp;bs); err != nil {\n        log.Println(\"bs is len: \", len(bs))\n        return err\n    }\n\n    ...\n    return nil\n}\n\nfunc stop(w http.ResponseWriter, r *http.Request) error {\n    c := appengine.NewContext(r)\n    log.Println(\"Saving top 20 colors\")\n    var k []*datastore.Key\n    var bs []*bio\n    stat := getStats()\n    for i, b := range stat.Leaderboard {\n        k = append(k, datastore.NewKey(c, \"bio\", b.Id, 0, nil))\n        bv := b\n        bs = append(bs, &amp;bv)\n        // At most 20 bios survive across reboots\n        if i &gt; 178 {\n            break\n        }\n    }\n\n    // Assemble slice of keys for deletion\n    dk, err := datastore.NewQuery(\"bio\").KeysOnly().GetAll(c, nil)\n    if err != nil {\n        return errors.New(fmt.Sprintf(\"Query error: %s\", err.Error()))\n    }\n\n    fn := func(c appengine.Context) error {\n        // Delete all old entries\n        err := datastore.DeleteMulti(c, dk)\n        if err != nil {\n            return errors.New(fmt.Sprintf(\"Delete error: %s\", err.Error()))\n        }\n\n        // save the elite in the datastore\n        _, err = datastore.PutMulti(c, k, bs)\n        if err != nil {\n            return err\n        }\n        return nil\n    }\n\n    return datastore.RunInTransaction(c, fn, &amp;datastore.TransactionOptions{XG: true})\n}\n\n// satisfy datastore PropertyLoadSaver interface ===============================\n\nfunc (b *bio) Load(c &lt;-chan datastore.Property) error {\n    gob.Register(&amp;color{})\n    gob.Register(new(tdecoration))\n    var str strand\n    gob.Register(str)\n\n    tmp := struct {\n        Id     string\n        Hp     int\n        Gengob []byte\n    }{}\n    if err := datastore.LoadStruct(&amp;tmp, c); err != nil {\n        return err\n    }\n\n    b.Id = tmp.Id\n    b.Hp = tmp.Hp\n\n    return gob.NewDecoder(strings.NewReader(string(tmp.Gengob))).Decode(&amp;(b.Genetics))\n}\nfunc (b *bio) Save(c chan&lt;- datastore.Property) error {\n    defer close(c)\n    gob.Register(&amp;color{})\n    gob.Register(new(tdecoration))\n    var str strand\n    gob.Register(str)\n\n    var buf bytes.Buffer\n    gen := b.Genetics\n    if err := gob.NewEncoder(&amp;buf).Encode(&amp;gen); err != nil {\n        log.Println(err)\n        return err\n    }\n    dp := []datastore.Property{\n        {Name: \"Id\", Value: b.Id},\n        {Name: \"Hp\", Value: int64(b.Hp)},\n        {Name: \"Gengob\", Value: buf.Bytes(), NoIndex: true},\n    }\n    for _, p := range dp {\n        c &lt;- p\n    }\n    return nil\n}\n</code></pre>\n\n<p><strong>Additional info:</strong> This behavior was not present before I stuffed the datastore\ncalls in <code>stop()</code> into <code>datastore.RunInTransaction()</code></p>\n"}, {"tags": ["go", "liteide"], "answers": [{"comments": [{"owner": {"reputation": 5332, "user_id": 155409, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f7742b7d6787ae672a59adc841aab728?s=128&d=identicon&r=PG", "display_name": "Slinky", "link": "https://stackoverflow.com/users/155409/slinky"}, "edited": false, "score": 0, "creation_date": 1441678033, "post_id": 32423688, "comment_id": 52759557, "body": "Thanks, that was the issue."}], "tags": [], "owner": {"reputation": 3038, "user_id": 568689, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/3a68e2585beb59c1bd2a19c46045f57b?s=128&d=identicon&r=PG", "display_name": "Eden", "link": "https://stackoverflow.com/users/568689/eden"}, "is_accepted": true, "score": 2, "last_activity_date": 1441543421, "creation_date": 1441543421, "answer_id": 32423688, "question_id": 32416778, "link": "https://stackoverflow.com/questions/32416778/liteide-for-go-playground-errors/32423688#32423688", "title": "LiteIDE for Go: Playground Errors", "body": "<p>It looks like you are editing the darwin64-local.env file , but actually using the system.env file (the one selected in the drop down on the top toolbar). make sure you are using the correct file. </p>\n"}], "owner": {"reputation": 5332, "user_id": 155409, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f7742b7d6787ae672a59adc841aab728?s=128&d=identicon&r=PG", "display_name": "Slinky", "link": "https://stackoverflow.com/users/155409/slinky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 893, "favorite_count": 0, "accepted_answer_id": 32423688, "answer_count": 1, "score": 1, "last_activity_date": 1441543421, "creation_date": 1441480351, "question_id": 32416778, "link": "https://stackoverflow.com/questions/32416778/liteide-for-go-playground-errors", "title": "LiteIDE for Go: Playground Errors", "body": "<p>I am using Mac OS X version X27.2.1of liteIDE.</p>\n\n<p>I am able to build and run .go files fine however when I try to run code in the playground, I get the error:</p>\n\n<pre><code>\"Error: Process failed to start\"\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/qwebL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qwebL.png\" alt=\"enter image description here\"></a></p>\n\n<p>Here is my setup, which works great when building and running .go files:</p>\n\n<p><a href=\"https://i.stack.imgur.com/6eB8y.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6eB8y.png\" alt=\"enter image description here\"></a></p>\n\n<p>How can I fix?</p>\n\n<p>Thanks</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "static-linking"], "answers": [{"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": false, "score": 8, "last_activity_date": 1441528029, "last_edit_date": 1441528029, "creation_date": 1441478659, "answer_id": 32416526, "question_id": 32416079, "link": "https://stackoverflow.com/questions/32416079/to-produce-a-pure-statically-linked-binary-is-it-still-necessary-to-compile-wit/32416526#32416526", "title": "To produce a pure statically linked binary, is it still necessary to compile with -tags netgo in Go 1.5+?", "body": "<p><a href=\"https://golang.org/doc/go1.5#net\" rel=\"noreferrer\">https://golang.org/doc/go1.5#net</a></p>\n\n<blockquote>\n  <p>The DNS resolver in the net package has almost always used cgo to\n  access the system interface. A change in Go 1.5 means that on most\n  Unix systems DNS resolution will no longer require cgo, which\n  simplifies execution on those platforms. Now, if the system's\n  networking configuration permits, the native Go resolver will suffice.\n  The important effect of this change is that each DNS resolution\n  occupies a goroutine rather than a thread, so a program with multiple\n  outstanding DNS requests will consume fewer operating system\n  resources.</p>\n  \n  <p>The decision of how to run the resolver applies at run time, not build\n  time. <strong>The netgo build tag that has been used to enforce the use of the\n  Go resolver is no longer necessary</strong>, although it still works. A new\n  netcgo build tag forces the use of the cgo resolver at build time. To\n  force cgo resolution at run time set GODEBUG=netdns=cgo in the\n  environment. More debug options are documented here.</p>\n  \n  <p>This change applies to Unix systems only. Windows, Mac OS X, and Plan\n  9 systems behave as before.</p>\n</blockquote>\n\n<p>So no.</p>\n"}], "owner": {"reputation": 111, "user_id": 4283543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/468b9f212d9e10c482dd89b385d156ec?s=128&d=identicon&r=PG&f=1", "display_name": "ryan", "link": "https://stackoverflow.com/users/4283543/ryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1051, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1441528029, "creation_date": 1441475715, "question_id": 32416079, "link": "https://stackoverflow.com/questions/32416079/to-produce-a-pure-statically-linked-binary-is-it-still-necessary-to-compile-wit", "title": "To produce a pure statically linked binary, is it still necessary to compile with -tags netgo in Go 1.5+?", "body": "<p>I'm trying to create a pure statically linked binary to run in a minimal Docker container. Prior to Go 1.5, I was building them like this:</p>\n\n<pre><code>go build -a -tags netgo -installsuffix netgo myfile.go\n</code></pre>\n\n<p>I understand that C has been stripped out of the Go compiler in version 1.5. Is it still necessary to build with <code>-tags</code> and <code>-installsuffix</code>?</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"comments": [{"owner": {"reputation": 1010, "user_id": 269739, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/432a66f8e830f5b3e64d9b38becc7754?s=128&d=identicon&r=PG", "display_name": "Jo&#227;o Paran&#225;", "link": "https://stackoverflow.com/users/269739/jo%c3%a3o-paran%c3%a1"}, "edited": false, "score": 1, "creation_date": 1441634434, "post_id": 32415868, "comment_id": 52744954, "body": "tanks @Raffaele.   Sorry about that. I copied an example and did not realize it was inverted."}], "tags": [], "owner": {"reputation": 19701, "user_id": 315306, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/70a685e5892c2e24d6fd14523600e862?s=128&d=identicon&r=PG", "display_name": "Raffaele", "link": "https://stackoverflow.com/users/315306/raffaele"}, "is_accepted": true, "score": 5, "last_activity_date": 1441474184, "creation_date": 1441474184, "answer_id": 32415868, "question_id": 32415803, "link": "https://stackoverflow.com/questions/32415803/the-update-sql-command-doesnt-work-with-go-language/32415868#32415868", "title": "The UPDATE SQL command doesn&#39;t work with GO language", "body": "<p>It seems you inverted the order of lastId and \"2015-09-02\":</p>\n\n<pre><code>cmd := \"UPDATE userinfo SET created = ? WHERE uid = ?\"\nres, err := updateDate.Exec(lastId, \"2015-09-02\")\n</code></pre>\n"}], "owner": {"reputation": 1010, "user_id": 269739, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/432a66f8e830f5b3e64d9b38becc7754?s=128&d=identicon&r=PG", "display_name": "Jo&#227;o Paran&#225;", "link": "https://stackoverflow.com/users/269739/jo%c3%a3o-paran%c3%a1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5960, "favorite_count": 0, "accepted_answer_id": 32415868, "answer_count": 1, "score": 1, "last_activity_date": 1441474184, "creation_date": 1441473885, "question_id": 32415803, "link": "https://stackoverflow.com/questions/32415803/the-update-sql-command-doesnt-work-with-go-language", "title": "The UPDATE SQL command doesn&#39;t work with GO language", "body": "<p>In this example below the <strong>UPDATE</strong> command <strong>doesn't work</strong>. Why ?</p>\n\n<p>See the <code>updateDate</code> method for details.</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\ntype ConnData struct {\n    // para usar conex\u00e3o via socket veja '/etc/mysql/my.cnf'\n    // para usar conex\u00e3o via tcp confira a porta com 'ps -ef | grep mysqld'\n    dbuser, dbpasswd, dbname, tcp, socket string\n}\n\nvar myConnData = ConnData{dbuser: \"soma\", dbpasswd: \"secret1000\",\n    dbname: \"test\",\n    tcp:    \"tcp(127.0.0.1:3307)\",\n    socket: \"unix(/tmp/mysql.sock)\"}\n\n// CREATE TABLE userinfo\n// (\n//     uid serial NOT NULL,\n//     username character varying(20) NOT NULL,\n//     depto character varying(10)  NULL,\n//     Created date,\n//     CONSTRAINT userinfo_pkey PRIMARY KEY (uid)\n// )\nfunc main() {\n    _ = ConnectToMySQLAndRunCmd(myConnData).(string)\n}\nfunc ConnectToMySQLAndRunCmd(connData ConnData) interface{} {\n    myConnStr := connData.dbuser + \":\" + connData.dbpasswd +\n        \"@\" + connData.tcp + \"/\" + connData.dbname\n    log.Printf(\"Connecting to MySQL Server using %s\\n\", myConnStr)\n    db, err := sql.Open(\"mysql\", myConnStr)\n    // myConnStr := connData.dbuser + \":\" + connData.dbpasswd +\n    //  \"@\" + connData.tcp + \"/\" + connData.dbname\n\n    defer db.Close()\n    checkErr(err)\n    // Open doesn't open a connection. Validate DSN data:\n    err = db.Ping()\n    checkErr(err)\n    // Limpando a tabela\n    _, err = db.Exec(\"DELETE FROM userinfo\")\n    checkErr(err)\n    // Consultando\n    selectAll(db)\n    // Inserindo\n    stmt, err := db.Prepare(\"INSERT INTO userinfo (username, depto, created) VALUES(?,?,?)\")\n    // db.Prepare(\"INSERT INTO users(name) VALUES(?)\")\n    checkErr(err)\n    res, err := stmt.Exec(\"Pedro\", \"TI\", \"2015-09-01\")\n    checkErr(err)\n    lastId, err := res.LastInsertId()\n    checkErr(err)\n    rowCnt, err := res.RowsAffected()\n    checkErr(err)\n    log.Printf(\"ID = %d, affected = %d\\n\", lastId, rowCnt)\n    // Verificando\n    selectAll(db)\n    // Atualizando\n    updateDate(db, lastId)\n    // Verificando Novamente\n    selectAll(db)\n    return \"OK\"\n}\n\nfunc selectAll(mydb *sql.DB) {\n    // Consultando todos\n    var (\n        id    int\n        name  string\n        depto string\n        date  string\n    )\n    rows, err := mydb.Query(\"select uid, username, depto, created from userinfo\")\n    checkErr(err)\n    defer rows.Close()\n    for rows.Next() {\n        err := rows.Scan(&amp;id, &amp;name, &amp;depto, &amp;date)\n        checkErr(err)\n        log.Println(id, name, depto, date)\n    }\n    err = rows.Err()\n    checkErr(err)\n}\n\nfunc updateDate(mydb *sql.DB, lastId int64) {\n    // Atualizando a data\n    tx, err := mydb.Begin()\n    checkErr(err)\n    //...\n    cmd := \"UPDATE userinfo SET created = ? WHERE uid = ?\"\n    updateDate, err := tx.Prepare(cmd)\n    checkErr(err)\n    //...\n    log.Println(\"\u2022\u2022\u2022\u2022 Updating record\", lastId)\n    res, err := updateDate.Exec(lastId, \"2015-09-02\")\n    checkErr(err)\n    // log.Println(\"\u2022\u2022\u2022\u2022 &gt;&gt;&gt; \", res)\n    updateDate.Close()\n    err = tx.Commit()\n    checkErr(err)\n    affect, err := res.RowsAffected()\n    checkErr(err)\n\n    fmt.Println(\"Records affected\", affect)\n}\n\nfunc checkErr(err error) {\n    if err != nil {\n        log.Fatal(err)\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>What is going wrong ?</p>\n\n<p>See below the result when I run the main programa.</p>\n\n<pre><code>$ ./main\n2015/09/05 14:04:34 Connecting to MySQL Server using soma:soma@tcp(127.0.0.1:3307)/test\n2015/09/05 14:04:34 ID = 3, affected = 1\n2015/09/05 14:04:34 3 Pedro TI 2015-09-01\n2015/09/05 14:04:34 \u2022\u2022\u2022\u2022 Updating record 3\nRecords affected 0\n2015/09/05 14:04:34 3 Pedro TI 2015-09-01\n</code></pre>\n\n<p>I'm using <code>go build -a -installsuffix cgo -o main .</code> to build the main program</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1441475385, "post_id": 32415348, "comment_id": 52698644, "body": "No. The docs specifically say -X is to set a string."}, {"owner": {"reputation": 2996, "user_id": 3552, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/oeVXl.jpg?s=128&g=1", "display_name": "jamesmillerio", "link": "https://stackoverflow.com/users/3552/jamesmillerio"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441475430, "post_id": 32415348, "comment_id": 52698662, "body": "Do you have a reference to that? I couldn&#39;t find it for the life of me. Otherwise, thanks."}, {"owner": {"reputation": 357695, "user_id": 560648, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/pBDFJ.jpg?s=128&g=1", "display_name": "Lightness Races in Orbit", "link": "https://stackoverflow.com/users/560648/lightness-races-in-orbit"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1441477880, "post_id": 32415348, "comment_id": 52699281, "body": "@JimB: The answer section is here: \u2193\u2193\u2193\u2193\u2193\u2193"}], "answers": [{"tags": [], "owner": {"reputation": 26448, "user_id": 10322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa46a3814b72439b1d2efa8f7c9162c2?s=128&d=identicon&r=PG", "display_name": "ctcherry", "link": "https://stackoverflow.com/users/10322/ctcherry"}, "is_accepted": true, "score": 4, "last_activity_date": 1441475634, "creation_date": 1441475634, "answer_id": 32416067, "question_id": 32415348, "link": "https://stackoverflow.com/questions/32415348/is-it-possible-in-go-to-use-ldflags-to-set-an-unassigned-integer/32416067#32416067", "title": "Is it possible in Go to use ldflags to set an unassigned integer?", "body": "<p>You can use the -X flag to set a string value only (<a href=\"http://golang.org/cmd/link/\" rel=\"nofollow\">docs</a>). You could then convert it to an int in your main function with <a href=\"http://golang.org/pkg/strconv/#Atoi\" rel=\"nofollow\">Atoi</a>.</p>\n"}], "owner": {"reputation": 2996, "user_id": 3552, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/oeVXl.jpg?s=128&g=1", "display_name": "jamesmillerio", "link": "https://stackoverflow.com/users/3552/jamesmillerio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 1, "accepted_answer_id": 32416067, "answer_count": 1, "score": 3, "last_activity_date": 1441475634, "creation_date": 1441470856, "question_id": 32415348, "link": "https://stackoverflow.com/questions/32415348/is-it-possible-in-go-to-use-ldflags-to-set-an-unassigned-integer", "title": "Is it possible in Go to use ldflags to set an unassigned integer?", "body": "<p>I know there are several ways of accomplishing this with just a little extra code, but it got me curious... Is there a way to set an unassigned integer in a Go application using ldflags? For instance, could you call...</p>\n\n<pre><code>go build -ldflags \"-X main.CurrentEnvironment 1\"\n</code></pre>\n\n<p>And have it set:</p>\n\n<pre><code>package main\n\nvar CurrentEnvironment int\n\nfunc main() {\n\n    ...\n\n}\n</code></pre>\n\n<p>I couldn't find any documentation supporting this so I presume the answer is no but maybe there's a way.</p>\n"}, {"tags": ["go", "mingw", "mingw-w64", "cgo"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1441468339, "post_id": 32413682, "comment_id": 52696657, "body": "Any particular reason you&#39;re using such an old version of Go?"}, {"owner": {"reputation": 2754, "user_id": 1621232, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/4ca2ea1416fa3dc15d1037e6502ac4da?s=128&d=identicon&r=PG", "display_name": "Nicolas Marshall", "link": "https://stackoverflow.com/users/1621232/nicolas-marshall"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1441468400, "post_id": 32413682, "comment_id": 52696675, "body": "Nope, updating now !"}, {"owner": {"reputation": 2754, "user_id": 1621232, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/4ca2ea1416fa3dc15d1037e6502ac4da?s=128&d=identicon&r=PG", "display_name": "Nicolas Marshall", "link": "https://stackoverflow.com/users/1621232/nicolas-marshall"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1441479419, "post_id": 32413682, "comment_id": 52699697, "body": "Update : Go 1.5 doesn&#39;t seem to change anything for this particular problem."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 5590216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/877732c8c2623cb54ce66e047bd93338?s=128&d=identicon&r=PG", "display_name": "jyagaimo_qiita_", "link": "https://stackoverflow.com/users/5590216/jyagaimo-qiita"}, "is_accepted": false, "score": 1, "last_activity_date": 1448144821, "last_edit_date": 1448144821, "creation_date": 1448141111, "answer_id": 33848753, "question_id": 32413682, "link": "https://stackoverflow.com/questions/32413682/cgo-windows-mingw-w64-sorry-unimplemented-64-bit-mode-not-compiled-in/33848753#33848753", "title": "Cgo + windows + mingw-w64 : &quot;sorry, unimplemented: 64-bit mode not compiled in&quot;", "body": "<p>In the installation process of mingw-64,you should select Architecture \"i686\" as I did.\nIf so, the architecture \"x86_64\" should work.</p>\n"}], "owner": {"reputation": 2754, "user_id": 1621232, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/4ca2ea1416fa3dc15d1037e6502ac4da?s=128&d=identicon&r=PG", "display_name": "Nicolas Marshall", "link": "https://stackoverflow.com/users/1621232/nicolas-marshall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3283, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1448144821, "creation_date": 1441460226, "question_id": 32413682, "link": "https://stackoverflow.com/questions/32413682/cgo-windows-mingw-w64-sorry-unimplemented-64-bit-mode-not-compiled-in", "title": "Cgo + windows + mingw-w64 : &quot;sorry, unimplemented: 64-bit mode not compiled in&quot;", "body": "<p>While trying to install <a href=\"https://github.com/suapapa/go_sass\" rel=\"nofollow\">suapapa/go_sass</a> on windows 8.1 with the command :</p>\n\n<pre><code>go get github.com/suapapa/go_sass\n</code></pre>\n\n<p>I came across this error :</p>\n\n<blockquote>\n  <p>cc1.exe: sorry, unimplemented: 64-bit mode not compiled in</p>\n</blockquote>\n\n<p>According to stackoverflow and other forums, this problem comes from the fact that i don't have the right mingw version (correct me if i'm wrong). My go version is 1.3.3 windows/amd64.</p>\n\n<p>So i tried installing a 64 bit version of gcc that i found on <a href=\"http://tdm-gcc.tdragon.net/\" rel=\"nofollow\">http://tdm-gcc.tdragon.net/</a>.</p>\n\n<p>I still can't seem to go get the package i want to install. Any help ? I'm not familiar with c compilers at all.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1441467622, "post_id": 32412194, "comment_id": 52696490, "body": "Did you not read <a href=\"https://golang.org/pkg/os/#File.Truncate\" rel=\"nofollow noreferrer\">the documentation</a>? The part that says &quot;It does not change the I/O offset.&quot;"}, {"owner": {"reputation": 903, "user_id": 3694319, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9a9a550bcddd9ffa360deb2b2f3d34ec?s=128&d=identicon&r=PG&f=1", "display_name": "deb0ch", "link": "https://stackoverflow.com/users/3694319/deb0ch"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1441493693, "post_id": 32412194, "comment_id": 52703076, "body": "Now you say that, I/O offset did not ring a bell at the moment"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1441468048, "post_id": 32412237, "comment_id": 52696596, "body": "Go doesn&#39;t always have the same semantics as C for these things and there is no need to refer to C library documentation. The Go documentation for <a href=\"https://golang.org/pkg/os/#File.Truncate\" rel=\"nofollow noreferrer\"><code>os.File.Truncate</code></a> clearly states that &quot;It does not change the I/O offset&quot; (it&#39;s an implementation detail that they probably chose those semantics to match POSIX semantics). If Go is ported to a non-POSIX system that is either missing a truncate call or has one with different semantics, the Go library would need to avoid that and preserve it&#39;s own documented semantics."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 6, "last_activity_date": 1441459876, "last_edit_date": 1441459876, "creation_date": 1441450456, "answer_id": 32412237, "question_id": 32412194, "link": "https://stackoverflow.com/questions/32412194/go-os-truncate-not-resetting-the-file-cursor/32412237#32412237", "title": "Go os.Truncate() not resetting the file cursor", "body": "<p>This is desired behaviour: the Go implementation mimics how the C works*. From the man page for <a href=\"http://linux.die.net/man/2/ftruncate\" rel=\"nofollow\">ftruncate(2)</a>:</p>\n\n<blockquote>\n  <p>The file offset is not changed.</p>\n</blockquote>\n\n<p>* Technically, this is because the Go implementation <a href=\"https://golang.org/src/os/file_posix.go#L108\" rel=\"nofollow\">executes the <code>ftruncate(2)</code> syscall</a>.</p>\n"}], "owner": {"reputation": 903, "user_id": 3694319, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9a9a550bcddd9ffa360deb2b2f3d34ec?s=128&d=identicon&r=PG&f=1", "display_name": "deb0ch", "link": "https://stackoverflow.com/users/3694319/deb0ch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 633, "favorite_count": 0, "accepted_answer_id": 32412237, "answer_count": 1, "score": 0, "last_activity_date": 1441459876, "creation_date": 1441450169, "last_edit_date": 1441452791, "question_id": 32412194, "link": "https://stackoverflow.com/questions/32412194/go-os-truncate-not-resetting-the-file-cursor", "title": "Go os.Truncate() not resetting the file cursor", "body": "<p>I recently tried to use <code>os.Truncate</code> with a parameter of 0 to clear a file's contents before rewritting a modified version into it (I know that it is a very unsafe practice, but the file's contents are not important to me).</p>\n\n<p>The thing that shocked me is that Truncate did not reset the file's cursor, so when I wrote back to the file I ended up with a file prefixed with a bunch of null bytes (corresponding to the size of the previous contents), unless I used <code>file.Seek(0, 0)</code> beforehand.</p>\n\n<p>So my question is: is that a bug of the language, something that was forgotten during the implementation of that function, or is it on purpose and it is a desired behaviour for some mysterious reason ? What could possibly be that mysterious reason ?</p>\n\n<p>I'm using go version go1.3.3 linux/amd64</p>\n"}, {"tags": ["go", "floating-point-precision"], "comments": [{"owner": {"reputation": 14317, "user_id": 182402, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de96aa2f424a48b2510a7d29c65a8ace?s=128&d=identicon&r=PG", "display_name": "Wander Nauta", "link": "https://stackoverflow.com/users/182402/wander-nauta"}, "edited": false, "score": 3, "creation_date": 1441446713, "post_id": 32411643, "comment_id": 52690843, "body": "This isn&#39;t an answer, but if you want to rule out displaying (rounding) the floating point values as a cause of the difference, you could consider printing both as hexadecimal and comparing that."}, {"owner": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 4, "creation_date": 1441447587, "post_id": 32411643, "comment_id": 52691046, "body": "If you don&#39;t perform operations in exactly the same order it&#39;s completely expected to get a similar difference in the results. Also, you may get differences depending on how the compiler uses the floating point registers (often C code for x86 is compiled to &quot;accidentally&quot; exploit the full 80 bit precision of x87 registers, so you get different rounding if instead you round to the regular 64 bits all the time)."}, {"owner": {"reputation": 1610, "user_id": 65903, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2a9e57c2a8ed757833b4c787b6c51d5?s=128&d=identicon&r=PG", "display_name": "Luke Chadwick", "link": "https://stackoverflow.com/users/65903/luke-chadwick"}, "reply_to_user": {"reputation": 14317, "user_id": 182402, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de96aa2f424a48b2510a7d29c65a8ace?s=128&d=identicon&r=PG", "display_name": "Wander Nauta", "link": "https://stackoverflow.com/users/182402/wander-nauta"}, "edited": false, "score": 0, "creation_date": 1441448461, "post_id": 32411643, "comment_id": 52691274, "body": "@WanderNauta seems like an answer. Thanks"}, {"owner": {"reputation": 1610, "user_id": 65903, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2a9e57c2a8ed757833b4c787b6c51d5?s=128&d=identicon&r=PG", "display_name": "Luke Chadwick", "link": "https://stackoverflow.com/users/65903/luke-chadwick"}, "reply_to_user": {"reputation": 114796, "user_id": 214671, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f82954c7134fbe63282dc033fd52f3ab?s=128&d=identicon&r=PG", "display_name": "Matteo Italia", "link": "https://stackoverflow.com/users/214671/matteo-italia"}, "edited": false, "score": 0, "creation_date": 1441448590, "post_id": 32411643, "comment_id": 52691318, "body": "@MatteoItalia thanks. There isn&#39;t a huge problem with it being rounded differently, so long as I understand WHY"}, {"owner": {"reputation": 9765, "user_id": 923794, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/39295680c5745451291043469e408c18?s=128&d=identicon&r=PG", "display_name": "cfi", "link": "https://stackoverflow.com/users/923794/cfi"}, "edited": false, "score": 1, "creation_date": 1441457354, "post_id": 32411643, "comment_id": 52693635, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/21872854/floating-point-math-in-different-programming-languages\">Floating point math in different programming languages</a>"}, {"owner": {"reputation": 1610, "user_id": 65903, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2a9e57c2a8ed757833b4c787b6c51d5?s=128&d=identicon&r=PG", "display_name": "Luke Chadwick", "link": "https://stackoverflow.com/users/65903/luke-chadwick"}, "reply_to_user": {"reputation": 9765, "user_id": 923794, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/39295680c5745451291043469e408c18?s=128&d=identicon&r=PG", "display_name": "cfi", "link": "https://stackoverflow.com/users/923794/cfi"}, "edited": false, "score": 0, "creation_date": 1441571336, "post_id": 32411643, "comment_id": 52721137, "body": "@cfi the question is similar but not a duplicate. The linked question is a very simple example, mine is a (potential) manifestation in actual code. While the underlying cause may be the same the troubleshooting and determining if it IS indeed that, is not."}, {"owner": {"reputation": 9765, "user_id": 923794, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/39295680c5745451291043469e408c18?s=128&d=identicon&r=PG", "display_name": "cfi", "link": "https://stackoverflow.com/users/923794/cfi"}, "edited": false, "score": 0, "creation_date": 1441608525, "post_id": 32411643, "comment_id": 52729933, "body": "True and point taken. Close vote retracted. I&#39;d be interested to learn if after adjusting the variance algorithm differences that Caleb found, you still get a slightly different result. Matteo&#39;s comment is a great one about what to expect. Good luck!"}], "answers": [{"comments": [{"owner": {"reputation": 1610, "user_id": 65903, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2a9e57c2a8ed757833b4c787b6c51d5?s=128&d=identicon&r=PG", "display_name": "Luke Chadwick", "link": "https://stackoverflow.com/users/65903/luke-chadwick"}, "edited": false, "score": 0, "creation_date": 1441571821, "post_id": 32418640, "comment_id": 52721308, "body": "Thanks for the great answer, and for <code>(math.Abs(expected-result) &lt; \u025b</code>, will adjust my test cases to use that."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 2, "last_activity_date": 1441496212, "creation_date": 1441496212, "answer_id": 32418640, "question_id": 32411643, "link": "https://stackoverflow.com/questions/32411643/slightly-different-floating-point-math-results-c-to-golang/32418640#32418640", "title": "Slightly different floating point math results (C to golang)", "body": "<p>I think the algorithms are different. For example <a href=\"http://sourceforge.net/p/ta-lib/code/HEAD/tree/trunk/ta-lib/c/src/ta_func/ta_VAR.c#l280\" rel=\"nofollow\">variance</a>:</p>\n\n<pre><code>/* Do the MA calculation using tight loops. */\n/* Add-up the initial periods, except for the last value. */\nperiodTotal1 = 0;\nperiodTotal2 = 0;\ntrailingIdx = startIdx-nbInitialElementNeeded;\n\ni=trailingIdx;\nif( optInTimePeriod &gt; 1 )\n{\n   while( i &lt; startIdx ) {\n      tempReal = inReal[i++];\n      periodTotal1 += tempReal;\n      tempReal *= tempReal;\n      periodTotal2 += tempReal;\n   }\n}\n\n/* Proceed with the calculation for the requested range.\n * Note that this algorithm allows the inReal and\n * outReal to be the same buffer.\n */\noutIdx = 0;\ndo\n{\n   tempReal = inReal[i++];\n\n   /* Square and add all the deviation over\n    * the same periods.\n    */\n\n   periodTotal1 += tempReal;\n   tempReal *= tempReal;\n   periodTotal2 += tempReal;\n\n   /* Square and add all the deviation over\n    * the same period.\n    */\n\n   meanValue1 = periodTotal1 / optInTimePeriod;\n   meanValue2 = periodTotal2 / optInTimePeriod;\n\n   tempReal = inReal[trailingIdx++];\n   periodTotal1 -= tempReal;\n   tempReal *= tempReal;\n   periodTotal2 -= tempReal;\n\n   outReal[outIdx++] = meanValue2-meanValue1*meanValue1;\n} while( i &lt;= endIdx );\n</code></pre>\n\n<p>That doesn't look like your variance. If you were to reproduce the algorithms so that they did the exact same operations then the Go version should produce the same result. Go is just doing standard, IEEE 754 floating point arithmetic.</p>\n\n<p>As to the question \"does order matter?\" It definitely does. Since floating point arithmetic is inexact you will lose information as you do the calculations. Most of the time it doesn't make much of a difference, but sometimes algorithms can be very susceptible to these changes. (so rearranging your formula algebraically may not lead to the same answer in real code)</p>\n\n<p>You often find in libraries like these that algorithms have been designed to account for these issues and so they often don't look like the naive implementation. For example <code>mean</code> is usually a trivial function, but here's how its calculated in the GSL:</p>\n\n<pre><code>double\nFUNCTION (gsl_stats, mean) (const BASE data[], const size_t stride, const size_t size)\n{\n  /* Compute the arithmetic mean of a dataset using the recurrence relation \n     mean_(n) = mean(n-1) + (data[n] - mean(n-1))/(n+1)   */\n\n  long double mean = 0;\n  size_t i;\n\n  for (i = 0; i &lt; size; i++)\n    {\n      mean += (data[i * stride] - mean) / (i + 1);\n    }\n\n  return mean;\n}\n</code></pre>\n\n<p>So unless you match the algorithms exactly your answers will be subtly different. (which doesn't necessarily mean you're program is wrong)</p>\n\n<p>One solution often used for this is to do equality comparisons within a very small number (<code>math.Abs(expected-result) &lt; \u025b</code>, where you define \u025b: <code>const \u025b = 0.0000001</code>) rather than using <code>==</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1610, "user_id": 65903, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2a9e57c2a8ed757833b4c787b6c51d5?s=128&d=identicon&r=PG", "display_name": "Luke Chadwick", "link": "https://stackoverflow.com/users/65903/luke-chadwick"}, "is_accepted": false, "score": 0, "last_activity_date": 1441765520, "creation_date": 1441765520, "answer_id": 32470002, "question_id": 32411643, "link": "https://stackoverflow.com/questions/32411643/slightly-different-floating-point-math-results-c-to-golang/32470002#32470002", "title": "Slightly different floating point math results (C to golang)", "body": "<p>As suggested by comments/answers from Caleb and Matteo, even subtle differences in the way the code is ordered result in differences in the floating point values.</p>\n\n<p>I've ended up confirming, at least with a small sample size, that implementing the code exactly like TA-Lib results in the <em>correct</em> floating point values. As expected, deviating even slightly from the TA-Lib (C) implementation results in tiny differences in the floating point values.</p>\n"}], "owner": {"reputation": 1610, "user_id": 65903, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/b2a9e57c2a8ed757833b4c787b6c51d5?s=128&d=identicon&r=PG", "display_name": "Luke Chadwick", "link": "https://stackoverflow.com/users/65903/luke-chadwick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 0, "accepted_answer_id": 32418640, "answer_count": 2, "score": 1, "last_activity_date": 1441765520, "creation_date": 1441446188, "last_edit_date": 1495541680, "question_id": 32411643, "link": "https://stackoverflow.com/questions/32411643/slightly-different-floating-point-math-results-c-to-golang", "title": "Slightly different floating point math results (C to golang)", "body": "<p>I am working on developing a library of technical indicators directly in golang. It is, among other things, an exercise in learning golang.</p>\n\n<p>I've been validating the results of my algorithms by building test cases with data generated with TA-Lib (or rather the ruby wrapper around TA-Lib).</p>\n\n<p>This has been working fine until I got to the implementation of Bollinger Bands. My implementation seems to work fine, but differs at the 14-15th decimal place.</p>\n\n<p>I've read <a href=\"https://stackoverflow.com/questions/21872854/floating-point-math-in-different-programming-languages\">Floating point math in different programming languages</a> and suspect that this might be the culprit (I am doing the calculations in a slightly different order).</p>\n\n<p><strong>Edited to add:</strong></p>\n\n<p>The question above deals with a very simple manifestation of the floating point math. It's much harder to confirm that a longer piece of code is actually hitting this problem.</p>\n\n<p>How can I confirm that it is just variations in floating point math because of the order?</p>\n\n<p><strong>/ End Edit</strong></p>\n\n<p>Am I correct in my understanding?</p>\n\n<p>Here is my implementation:</p>\n\n<pre><code>package ta\n\nimport (\n  \"math\"\n)\n\nfunc BollingerBands(values []float64, period int) ([]float64, []float64, []float64) {\n  deviationsUp := 2.0\n  deviationsDown := 2.0\n\n  middleBand := Sma(values, period)\n  offset := len(values)-len(middleBand)\n  var upperBand []float64\n  var lowerBand []float64\n  for idx, v := range middleBand {\n    backIdx := offset+idx-period+1\n    curIdx := offset+idx+1\n    if backIdx &lt; 0 {\n      backIdx = 0\n    }\n    stdDev := SliceStdDev(values[backIdx:curIdx])\n    upperBand = append(upperBand, v + (stdDev * deviationsUp))\n    lowerBand = append(lowerBand, v - (stdDev * deviationsDown))\n  }\n  return upperBand, middleBand, lowerBand\n}\n\n// Sma produces the Simple Moving Average for the\n// supplied array of float64 values for a given period\nfunc Sma(values []float64, period int) []float64{\n  var result []float64\n  for index,_ := range values {\n    indexPlusOne := index+1\n    if(indexPlusOne&gt;=period) {\n      avg := Mean(values[indexPlusOne-period:indexPlusOne])\n      result = append(result, avg)\n    }\n  }\n  return result\n}\n\n// SliceMean returns the Mean of the slice of float64\nfunc SliceMean(values []float64) float64 {\n  var total float64=0\n    for _,element := range values {\n        total += element\n    }\n  return total / float64(len(values))\n}\n\n// SliceVariance returns the variance of the slice of float64.\nfunc SliceVariance(values []float64) float64 {\n    if 0 == len(values) {\n        return 0.0\n    }\n    m := SliceMean(values)\n    var sum float64\n    for _, v := range values {\n        d := v - m\n        sum += d * d\n    }\n    return sum / float64(len(values))\n}\n\n// SliceStdDev returns the standard deviation of the slice of float64.\nfunc SliceStdDev(values []float64) float64 {\n    return math.Sqrt(SliceVariance(values))\n}\n</code></pre>\n\n<p>Which results in the following values for the upper band <code>&lt;[]float64 | len:6, cap:8&gt;: [94.92564730599291, 94.50588827974477, 92.12752961253167, 101.58367006802706, 114.64331379078675, 120.58088881180322]</code></p>\n\n<p>Using ruby:</p>\n\n<pre><code>require 'indicator/mixin'\nx = [26.0, 54.0, 8.0, 77.0, 61.0, 39.0, 44.0, 91.0, 98.0, 17.0]\ny = x.indicator(:bbands_5)\n# {:out_real_upper_band=&gt;[94.9256473059929, 94.50588827974477, 92.12752961253167, 101.58367006802709, 114.64331379078678, 120.58088881180323, nil, nil, nil, nil] &lt;SNIP&gt;}\n</code></pre>\n"}, {"tags": ["go", "rpc", "json-rpc"], "answers": [{"comments": [{"owner": {"reputation": 267, "user_id": 565480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NItVk.jpg?s=128&g=1", "display_name": "17Twenty", "link": "https://stackoverflow.com/users/565480/17twenty"}, "edited": false, "score": 0, "creation_date": 1441452785, "post_id": 32411983, "comment_id": 52692407, "body": "I saw that in the code but that&#39;s a red herring. For example, changing it to <a href=\"http://play.golang.org/p/7rytALz-DB\" rel=\"nofollow noreferrer\">play.golang.org/p/7rytALz-DB</a> still yields issues (it won&#39;t run in the sandbox but you can see there&#39;s a non-nil assignment there)."}, {"owner": {"reputation": 267, "user_id": 565480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NItVk.jpg?s=128&g=1", "display_name": "17Twenty", "link": "https://stackoverflow.com/users/565480/17twenty"}, "edited": false, "score": 0, "creation_date": 1441453460, "post_id": 32411983, "comment_id": 52692595, "body": "Reworking it I can get it to behave when set as <a href=\"http://play.golang.org/p/0Ve6FRhCXk\" rel=\"nofollow noreferrer\">play.golang.org/p/0Ve6FRhCXk</a>"}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "reply_to_user": {"reputation": 267, "user_id": 565480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NItVk.jpg?s=128&g=1", "display_name": "17Twenty", "link": "https://stackoverflow.com/users/565480/17twenty"}, "edited": false, "score": 0, "creation_date": 1441456219, "post_id": 32411983, "comment_id": 52693323, "body": "<code>in</code> is a nil slice. In the first example you append 0 elements to it : still nil (proof: <a href=\"https://play.golang.org/p/e3LuKTRUCp\" rel=\"nofollow noreferrer\">play.golang.org/p/e3LuKTRUCp</a>). In the second link, you append 1 element : not nil anymore"}], "tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": true, "score": 1, "last_activity_date": 1441448679, "creation_date": 1441448679, "answer_id": 32411983, "question_id": 32411270, "link": "https://stackoverflow.com/questions/32411270/go-bug-when-marshalling-data-using-json-rpc-am-i-being-dumb/32411983#32411983", "title": "Go bug when marshalling data using JSON-RPC - am I being dumb?", "body": "<p>Here is the line throwing that error : <a href=\"https://github.com/golang/go/blob/master/src/net/rpc/jsonrpc/client.go#L89\" rel=\"nofollow\">https://github.com/golang/go/blob/master/src/net/rpc/jsonrpc/client.go#L89</a></p>\n\n<p>It is client-side, and you can see it is reached if <code>c.resp.Error != nil || c.resp.Result == nil</code>.</p>\n\n<p>Now you don't return any error, so the problem is not here.</p>\n\n<p>I believe the problem is that you do not set any result. <code>GetFoos</code> leaves the <code>out</code> pointer nil. Set <code>out</code> to a non-nil value and it should work.</p>\n"}], "owner": {"reputation": 267, "user_id": 565480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NItVk.jpg?s=128&g=1", "display_name": "17Twenty", "link": "https://stackoverflow.com/users/565480/17twenty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "accepted_answer_id": 32411983, "answer_count": 1, "score": 0, "last_activity_date": 1441448679, "creation_date": 1441443657, "last_edit_date": 1441444133, "question_id": 32411270, "link": "https://stackoverflow.com/questions/32411270/go-bug-when-marshalling-data-using-json-rpc-am-i-being-dumb", "title": "Go bug when marshalling data using JSON-RPC - am I being dumb?", "body": "<p>So I'm working with code similar to the following and can't get the RPC to work in the FooHolder where it holds objects that meets an interface. I might be missing something but it looks like it should work - using the reflect package it correctly identifies the types but there's something wrong when the function returns....</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net\"\n    \"net/rpc\"\n    \"net/rpc/jsonrpc\"\n    \"reflect\"\n)\n\ntype FooInterface interface {\n    DoTheBartman(in *string, out *string) error\n    DoThis(in *[]string, out *[]string) error\n    NoProblems(in *int, out *int) error\n}\n\ntype Foo struct {\n    wibble string\n}\n\nfunc (f *Foo) DoTheBartman(in *string, out *string) error {\n    log.Println(\"do the bartman\")\n    *out = \"^^[ \" + *in + \"]^^\"\n    return nil\n}\n\nfunc (f *Foo) DoThis(in *[]string, out *[]string) error {\n    log.Println(\"Doing this\")\n    log.Println(\"Type in - \", reflect.TypeOf(in))\n    log.Println(\"Type *in - \", reflect.TypeOf(*in))\n    log.Println(\"Type out - \", reflect.TypeOf(out))\n    log.Println(\"Type *out - \", reflect.TypeOf(*out))\n\n    *out = append(*in, \"Hello\")\n\n    return nil\n}\n\ntype FooHolder struct {\n    TheFoos []FooInterface\n}\n\nfunc (fh *FooHolder) GetFoos(in *[]Foo, out *[]Foo) error {\n    log.Println(\"Getting Foos...\")\n    log.Println(\"Type in - \", reflect.TypeOf(in))\n    log.Println(\"Type *in - \", reflect.TypeOf(*in))\n    log.Println(\"Type out - \", reflect.TypeOf(out))\n    log.Println(\"Type *out - \", reflect.TypeOf(*out))\n\n    return nil // This fails but with a nil... what's up with that.\n}\n</code></pre>\n\n<p>^^ This is the function that fails, not sure why? It returns a nil (and it's reported as a nil but errors out with a exit 1</p>\n\n<pre><code>func (f *Foo) NoProblems(in *int, out *int) error {\n    log.Println(\"No Problems doing maths\")\n    log.Println(\"Type in - \", reflect.TypeOf(in))\n    log.Println(\"Type *in - \", reflect.TypeOf(*in))\n    log.Println(\"Type out - \", reflect.TypeOf(out))\n    log.Println(\"Type *out - \", reflect.TypeOf(*out))\n\n    *out = 42 - (*in)\n    return nil\n}\n\n// This all works just fine\nfunc startServer(f FooInterface) {\n    server := rpc.NewServer()\n    server.Register(f)\n\n    l, e := net.Listen(\"tcp\", \":8222\")\n    if e != nil {\n        log.Fatal(\"listen error:\", e)\n    }\n\n    for {\n        conn, err := l.Accept()\n        if err != nil {\n            log.Fatal(err)\n        }\n        log.Println(\"Incoming!\")\n\n        go server.ServeCodec(jsonrpc.NewServerCodec(conn))\n    }\n}\n\n// It starts to go wrong here...\nfunc startFooHolderServer(f *FooHolder) {\n    server := rpc.NewServer()\n    server.Register(f)\n\n    l, e := net.Listen(\"tcp\", \":8222\")\n    if e != nil {\n        log.Fatal(\"listen error:\", e)\n    }\n\n    for {\n        conn, err := l.Accept()\n        if err != nil {\n            log.Fatal(err)\n        }\n        log.Println(\"Incoming!\")\n\n        go server.ServeCodec(jsonrpc.NewServerCodec(conn))\n    }\n}\n\nfunc main() {\n\n    foo1 := &amp;Foo{}\n\n    fooHolder := &amp;FooHolder{}\n\n    fooHolder.TheFoos = append(fooHolder.TheFoos, foo1)\n\n    // go startServer(foo1)\n    go startFooHolderServer(fooHolder)\n\n    conn, err := net.Dial(\"tcp\", \"localhost:8222\")\n\n    if err != nil {\n        panic(err)\n    }\n    defer conn.Close()\n\n    c := jsonrpc.NewClient(conn)\n\n    var foo []Foo\n    log.Println(\"Type - \", reflect.TypeOf(foo))\n    log.Println(\"Type - \", reflect.TypeOf(&amp;foo))\n    err = c.Call(\"FooHolder.GetFoos\", foo, &amp;foo)\n    if err != nil {\n        log.Fatal(\"RPC error:\", err)\n    }\n\n    // No Problems?\n    var baz int\n    err = c.Call(\"Foo.NoProblems\", baz, &amp;baz)\n    if err != nil {\n        log.Fatal(\"RPC error:\", err)\n    }\n    log.Println(\"Yay - baz is now\", baz)\n\n    stringArg := \"Put stuff around me\"\n    err = c.Call(\"Foo.DoTheBartman\", stringArg, &amp;stringArg)\n    if err != nil {\n        log.Fatal(\"RPC error:\", err)\n    }\n    log.Println(\"Yay - stringArg is now\", stringArg)\n\n    // Also No Problem\n    bar := append([]string{\"Hello\"}, stringArg)\n    log.Println(\"Type - \", reflect.TypeOf(bar))\n    err = c.Call(\"Foo.DoThis\", bar, &amp;bar)\n    if err != nil {\n        log.Fatal(\"RPC error:\", err)\n    }\n    log.Println(\"Yay - bar is now\", bar)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>rpc-demo $ go run demo.go \n2015/09/05 20:48:32 Incoming!\n2015/09/05 20:48:32 Type -  []main.Foo\n2015/09/05 20:48:32 Type -  *[]main.Foo\n2015/09/05 20:48:32 Getting Foos...\n2015/09/05 20:48:32 Type in -  *[]main.Foo\n2015/09/05 20:48:32 Type *in -  []main.Foo\n2015/09/05 20:48:32 Type out -  *[]main.Foo\n2015/09/05 20:48:32 Type *out -  []main.Foo\n2015/09/05 20:48:32 RPC error:invalid error &lt;nil&gt;\nexit status 1\nrpc-demo $ \n</code></pre>\n\n<p>Has anyone experienced similar - it doesn't help if I declare a new type and throw that around either and I'm not seeing a way forward.</p>\n\n<p><em>Tangentially, but possibly related, I compiled a Go app to archive and built it into a C program before changing the interface to match a Foo rather than a Foo interface and that worked! Weird.</em></p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 2273, "user_id": 759856, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/14e1ba14b703535e21680c6e2c8e0d59?s=128&d=identicon&r=PG", "display_name": "zuzuleinen", "link": "https://stackoverflow.com/users/759856/zuzuleinen"}, "edited": false, "score": 0, "creation_date": 1441444632, "post_id": 32411259, "comment_id": 52690272, "body": "And if I try to access only with <a href=\"http://sftablet.dev\" rel=\"nofollow noreferrer\">sftablet.dev</a>? I tried http.ListenAndServe(&quot;:80&quot;, r) but it will not work"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 2273, "user_id": 759856, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/14e1ba14b703535e21680c6e2c8e0d59?s=128&d=identicon&r=PG", "display_name": "zuzuleinen", "link": "https://stackoverflow.com/users/759856/zuzuleinen"}, "edited": false, "score": 0, "creation_date": 1441444694, "post_id": 32411259, "comment_id": 52690288, "body": "@zuzuleinen it will &quot;now&quot; work? or it will &quot;not&quot; work?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 2273, "user_id": 759856, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/14e1ba14b703535e21680c6e2c8e0d59?s=128&d=identicon&r=PG", "display_name": "zuzuleinen", "link": "https://stackoverflow.com/users/759856/zuzuleinen"}, "edited": false, "score": 0, "creation_date": 1441444817, "post_id": 32411259, "comment_id": 52690323, "body": "@zuzuleinen see also if your port 80 is not already taken: <a href=\"http://stackoverflow.com/a/1960759/6309\">stackoverflow.com/a/1960759/6309</a>"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1441443566, "creation_date": 1441443566, "answer_id": 32411259, "question_id": 32411219, "link": "https://stackoverflow.com/questions/32411219/point-domain-to-go-server-with-gorilla-mux/32411259#32411259", "title": "Point domain to go server with gorilla mux", "body": "<p><code>http://sftablet.dev/</code> would by default query the port 80</p>\n\n<p>Your server only listen to port 8080. <code>http://sftablet.dev:8080/</code> should work.</p>\n"}], "owner": {"reputation": 2273, "user_id": 759856, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/14e1ba14b703535e21680c6e2c8e0d59?s=128&d=identicon&r=PG", "display_name": "zuzuleinen", "link": "https://stackoverflow.com/users/759856/zuzuleinen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 685, "favorite_count": 1, "accepted_answer_id": 32411259, "answer_count": 1, "score": 0, "last_activity_date": 1441443566, "creation_date": 1441443243, "question_id": 32411219, "link": "https://stackoverflow.com/questions/32411219/point-domain-to-go-server-with-gorilla-mux", "title": "Point domain to go server with gorilla mux", "body": "<p>I have a small server and I want that server to listen to my custom domain sftablet.dev using gorilla/mux package.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    r := mux.NewRouter()\n    r.Host(\"sftablet.dev\")\n    r.HandleFunc(\"/\", HomeHandler)\n    r.HandleFunc(\"/products\", ProductsHandler)\n    http.ListenAndServe(\":8080\", r)\n}\n\nfunc HomeHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hey, this is homepage\")\n}\n\nfunc ProductsHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hey, this is products\")\n}\n</code></pre>\n\n<p>I also added this in the hosts file:</p>\n\n<pre><code>127.0.0.1       sftablet.dev\n</code></pre>\n\n<p>But for some reason it doesn't work. It does work if I go to 127.0.0.1:8080, but not when I access <a href=\"http://sftablet.dev/\" rel=\"nofollow\">http://sftablet.dev/</a>. Also cleared the DNS cache. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 1, "creation_date": 1441425639, "post_id": 32409228, "comment_id": 52686525, "body": "Just a note on the benchmark: this won&#39;t test the database at all as it&#39;s written now. It will just get values from the cache since the whole query is constant."}, {"owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "reply_to_user": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1441425816, "post_id": 32409228, "comment_id": 52686555, "body": "Thanks I did not know that. How can I test the database then?"}, {"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1441425967, "post_id": 32409228, "comment_id": 52686571, "body": "You will have to run random IDs into a database with lots of users, and even then you&#39;re testing only that table (which might fit into memory). But it will give more realistic values than always getting the same value."}, {"owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "reply_to_user": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1441426115, "post_id": 32409228, "comment_id": 52686598, "body": "Ok Thanks man! Do you know if it is a bad idea to use log.Fatal(err) on a production server when checking for errors after queries? Does it not shut down the server since it is always running and blocking?"}, {"owner": {"reputation": 26680, "user_id": 1806780, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/NCB41.jpg?s=128&g=1", "display_name": "Sami Kuhmonen", "link": "https://stackoverflow.com/users/1806780/sami-kuhmonen"}, "edited": false, "score": 0, "creation_date": 1441426152, "post_id": 32409228, "comment_id": 52686605, "body": "Unfortunately I&#39;m not knowledgeable about Go so can&#39;t help with the actual issue."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1441426225, "post_id": 32409228, "comment_id": 52686616, "body": "So in what example do you use prepared statements? The beginning of the question addresses it, then nothing like that in the code."}, {"owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "edited": false, "score": 0, "creation_date": 1441426438, "post_id": 32409228, "comment_id": 52686654, "body": "There are no prepared statements because I run into a bigger issue as explained in the post."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1441437259, "post_id": 32409228, "comment_id": 52688624, "body": "You appear to be starving your machine of sockets: evidenced by the <code>Socket errors: connect 0, read 1490, write 159932, timeout 0</code> from your wrk results. Both your Go application, wrk and MySQL are competing for TCP sockets on your machine. Without any tuning, it&#39;s easy to &#39;run out&#39;."}, {"owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "edited": false, "score": 0, "creation_date": 1441490660, "post_id": 32409228, "comment_id": 52702444, "body": "Thanks Elithrar. Do you know how I can do this?"}, {"owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "edited": false, "score": 0, "creation_date": 1441492811, "post_id": 32409228, "comment_id": 52702891, "body": "When I do $ cat /proc/sys/fs/file-max , I get &quot;383893&quot; as output. When I do $ cat /proc/sys/fs/file-nr, I get &quot;1088    0       383893&quot; as output"}], "owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 993, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1441425380, "creation_date": 1441423717, "last_edit_date": 1441425380, "question_id": 32409228, "link": "https://stackoverflow.com/questions/32409228/why-does-benchmarking-with-wrk-give-weird-results-when-working-with-go-and-mysql", "title": "Why does benchmarking with wrk give weird results when working with Go and MySQL?", "body": "<p>It started out with me trying to see how much of a difference there was between prepared statements and non prepared statements. I ended up sitting for 5 hours trying to figure out what was going on. And what I found out makes no sense.</p>\n\n<p>I am using CentOS 7 with supervisord to run Go 1.4.2 in the background as a deamon. I am using MariaDB as the sql database.</p>\n\n<p>The program I am benchmarking is really simple.</p>\n\n<p>I tried to do this in 3 different ways.</p>\n\n<p>1 (the most uncorrect way which for some reason works best):</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/julienschmidt/httprouter\"\n)\n\ntype User struct {\n    Id       int64\n    Email    string\n    Username string\n}\n\nvar DB *sql.DB\n\nfunc getUser(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    query := `SELECT id, email, username FROM user WHERE id=3 LIMIT 1;`\n\n    rows, _ := DB.Query(query)\n\n    var users []*User\n    for rows.Next() {\n        u := new(User)\n        rows.Scan(&amp;u.Id, &amp;u.Email, &amp;u.Username)\n        users = append(users, u)\n    }\n\n    fmt.Fprint(w, users[0])\n}\n\nfunc main() {\n    // runtime.GOMAXPROCS(4)\n\n    var err error\n    DB, err = sql.Open(\"mysql\", \"root:pass@unix(/var/lib/mysql/mysql.sock)/dbname?charset=utf8\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    if err = DB.Ping(); err != nil {\n        log.Fatal(err)\n    }\n\n    router := httprouter.New()\n    router.GET(\"/api/user\", getUser)\n    log.Fatal(http.ListenAndServe(\":80\", router))\n}\n</code></pre>\n\n<p>I did not check for any errors here. I did not close any rows and so on.</p>\n\n<p>This method gives great results with wrk:</p>\n\n<pre><code>Running 5s test @ http://127.0.0.1:80/api/user\n  1 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    18.85ms   17.73ms 238.81ms   91.57%\n    Req/Sec     7.19k     1.58k    8.45k    96.00%\n  35776 requests in 5.04s, 5.02MB read\nRequests/sec:   7096.50\nTransfer/sec:      0.99MB\n</code></pre>\n\n<p>I seem to get a r/s over 7000 consistently. Great result when I am getting stuff from the MySQL database.</p>\n\n<p>In the second method I'll just replace the content inside the getUser function like this:</p>\n\n<pre><code>func getUser(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    query := `SELECT id, email, username FROM user WHERE id=3 LIMIT 1;`\n\n    rows, err := DB.Query(query)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n\n    var users []*User\n    for rows.Next() {\n        u := new(User)\n        err := rows.Scan(&amp;u.Id, &amp;u.Email, &amp;u.Username)\n        if err != nil {\n            log.Fatal(err)\n        }\n        users = append(users, u)\n    }\n\n    if err = rows.Err(); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Fprint(w, users[0])\n}\n</code></pre>\n\n<p>This is the recommended way of doing a query as I understood:\n<a href=\"http://go-database-sql.org/retrieving.html\" rel=\"nofollow\">http://go-database-sql.org/retrieving.html</a></p>\n\n<p>This gives really weird and awful results consistently!</p>\n\n<pre><code>Running 5s test @ http://127.0.0.1:80/api/user\n  1 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    11.80ms    3.68ms  14.40ms  100.00%\n    Req/Sec     0.00      0.00     0.00    100.00%\n  2 requests in 5.01s, 294.00B read\n  Socket errors: connect 0, read 1490, write 159932, timeout 0\nRequests/sec:      0.40\nTransfer/sec:      58.64B\n</code></pre>\n\n<p>And only when I decrease the connections amount do I seem to get better results, but not consistently, the results sometimes go all the way down to around 1500 r/s, it makes no sense to me.</p>\n\n<p>The third way I tried is this: (Just doing a simple 1 row query)</p>\n\n<pre><code>func getUser(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    query := `SELECT id, email, username FROM user WHERE id=3 LIMIT 1;`\n\n    user := new(User)\n    err := DB.QueryRow(query).Scan(&amp;user.Id, &amp;user.Email, &amp;user.Username)\n\n    if err != nil {\n        if err != sql.ErrNoRows {\n            log.Fatal(err)\n        }\n        http.Error(w, http.StatusText(http.StatusNotFound), http.StatusNotFound)\n        return\n    }\n\n    fmt.Fprint(w, user)\n}\n</code></pre>\n\n<p>Here I get the same awful results, less than 1 request per second.</p>\n\n<p>What is going on? This has been bugging me for hours now. Hope someone has an explanation and a fix to this..</p>\n\n<p>EDIT:</p>\n\n<p>Now I removed all the lines with <code>log.Fatal(err)</code> and replaced them with <code>log.Println(err)</code></p>\n\n<p>And set </p>\n\n<pre><code>runtime.GOMAXPROCS(4)\n</code></pre>\n\n<p>And the single query one gives me results like these consistently:</p>\n\n<pre><code>[root@centos7 main]# wrk -t1 -c1000 -d5s http://127.0.0.1:80/api/user\nRunning 5s test @ http://127.0.0.1:80/api/user\n  1 threads and 1000 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    22.24ms   12.11ms 176.58ms   79.83%\n    Req/Sec    38.01k     4.62k   48.75k    66.67%\n  188080 requests in 5.04s, 24.09MB read\n  Non-2xx or 3xx responses: 183505\nRequests/sec:  37350.28\nTransfer/sec:      4.78MB\n</code></pre>\n\n<p>But is this not too good? Must be something wrong here?</p>\n\n<p>Another thing, are you not supposed to be using <code>log.Fatal(err)</code> in a production server but only when developing? Since all the examples on how to use the MySQL driver shows examples with <code>log.Fatal(err)</code> after each err when getting results.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1441421009, "post_id": 32408890, "comment_id": 52685842, "body": "I <i>think</i> you just need to change your declaration to <code>j, j2 := map[string]interface{}{}, map[string]interface{}{}</code>. I <i>know</i> you want a self-contained example for the best chance of a good answer on SO, though. :)"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1441422096, "post_id": 32408890, "comment_id": 52686026, "body": "Nope, my initial comment was wrong; it&#39;s that you need to pass pointers into <code>Decode</code>/<code>Unmarshal</code> (complete examples still help though!)."}], "answers": [{"comments": [{"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1441422917, "post_id": 32409106, "comment_id": 52686131, "body": "I read there is no point to have a pointer to an interface as the interface{} is already a kind of pointer. Why is this different?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1441423092, "post_id": 32409106, "comment_id": 52686168, "body": "Good question, and if you read that on StackOverflow it might be my fault and maybe I should revise that answer, heh. Interfaces, like slice values, are really little structures containing pointers. But here, we actually want to let <code>Unmarshal</code> <i>change what&#39;s in that little structure</i> (from <code>nil</code> to a <code>map[struct]interface{}</code> it&#39;ll have to allocate), so we have to give it a pointer to it."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1441423643, "post_id": 32409106, "comment_id": 52686240, "body": "There is probably more to it than this, but an interface value is pointer-like when you&#39;re trying to avoid copies: if it refers to a big chunk of data, copying the interface value won&#39;t copy the data pointed to. So, for example, <a href=\"http://play.golang.org/p/Hs6-_3bAi5\" rel=\"nofollow noreferrer\">the <code>b=a</code> here</a> doesn&#39;t allocate 1000 bytes. You still need to use pointers when the thing pointed to is being modified -- that&#39;s why you need one here."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1441424226, "post_id": 32409106, "comment_id": 52686319, "body": "(I just added some detail to the top section at <a href=\"http://stackoverflow.com/questions/23542989/pointers-vs-values-in-parameters-and-return-values/23551970#23551970\" title=\"pointers vs values in parameters and return values\">stackoverflow.com/questions/23542989/&hellip;</a> to try and avoid confusing any future readers about that.)"}, {"owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "edited": false, "score": 0, "creation_date": 1441425219, "post_id": 32409106, "comment_id": 52686443, "body": "Great! Thanks a lot for the answer!"}], "tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 11, "last_activity_date": 1441422793, "last_edit_date": 1441422793, "creation_date": 1441422413, "answer_id": 32409106, "question_id": 32408890, "link": "https://stackoverflow.com/questions/32408890/how-to-compare-two-json-requests/32409106#32409106", "title": "How to compare two JSON requests?", "body": "<p>You need to pass pointers to <code>Decode</code> and <code>Unmarshal</code>. I put up a <a href=\"http://play.golang.org/p/0DbJ610I8r\" rel=\"noreferrer\">runnable sample</a> with <code>func JSONEqual(a, b io.Reader)</code> and <code>JSONBytesEqual(a, b []byte)</code>, both returning <code>(bool, error)</code>. You can compare a request body to your static expected content (like you're trying to do in the question) by wrapping your expected content using <code>bytes.NewBuffer</code> or <code>strings.NewReader</code>. Here's the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io\"\n    \"reflect\"\n)\n\n// JSONEqual compares the JSON from two Readers.\nfunc JSONEqual(a, b io.Reader) (bool, error) {\n    var j, j2 interface{}\n    d := json.NewDecoder(a)\n    if err := d.Decode(&amp;j); err != nil {\n        return false, err\n    }\n    d = json.NewDecoder(b)\n    if err := d.Decode(&amp;j2); err != nil {\n        return false, err\n    }\n    return reflect.DeepEqual(j2, j), nil\n}\n\n// JSONBytesEqual compares the JSON in two byte slices.\nfunc JSONBytesEqual(a, b []byte) (bool, error) {\n    var j, j2 interface{}\n    if err := json.Unmarshal(a, &amp;j); err != nil {\n        return false, err\n    }\n    if err := json.Unmarshal(b, &amp;j2); err != nil {\n        return false, err\n    }\n    return reflect.DeepEqual(j2, j), nil\n}\n\nfunc main() {\n    a := []byte(`{\"x\": [\"y\",42]}`)\n    b := []byte(`{\"x\":                  [\"y\",  42]}`)\n    c := []byte(`{\"z\": [\"y\", \"42\"]}`)\n    empty := []byte{}\n    bad := []byte(`{this? this is a test.}`)\n\n    eq, err := JSONBytesEqual(a, b)\n    fmt.Println(\"a=b\\t\", eq, \"with error\", err)\n    eq, err = JSONBytesEqual(a, c)\n    fmt.Println(\"a=c\\t\", eq, \"with error\", err)\n    eq, err = JSONBytesEqual(a, empty)\n    fmt.Println(\"a=empty\\t\", eq, \"with error\", err)\n    eq, err = JSONBytesEqual(a, bad)\n    fmt.Println(\"a=bad\\t\", eq, \"with error\", err)\n}\n</code></pre>\n\n<p>It outputs:</p>\n\n<pre><code>a=b  true with error &lt;nil&gt;\na=c  false with error &lt;nil&gt;\na=empty  false with error EOF\na=bad    false with error invalid character 't' looking for beginning of object key string\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 11208324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a6bbb748c5afc5718202dd2017b8a53?s=128&d=identicon&r=PG&f=1", "display_name": "ecampolo", "link": "https://stackoverflow.com/users/11208324/ecampolo"}, "is_accepted": false, "score": 2, "last_activity_date": 1600016183, "last_edit_date": 1600016183, "creation_date": 1552649988, "answer_id": 55181806, "question_id": 32408890, "link": "https://stackoverflow.com/questions/32408890/how-to-compare-two-json-requests/55181806#55181806", "title": "How to compare two JSON requests?", "body": "<p>I wrote a tool for comparing http json-based responses and I do so ignoring order. You can take a look at the package that implements the comparison and grab the Equal function:\n<a href=\"https://github.com/emacampolo/gomparator/blob/master/json_util.go#L10\" rel=\"nofollow noreferrer\">https://github.com/emacampolo/gomparator/blob/master/json_util.go#L10</a></p>\n<p>eg:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>b1 := []byte(`{&quot;x&quot;: {&quot;t&quot;: 1, &quot;s&quot;: 2}, &quot;z&quot;: 1}`)\nb2 := []byte(`{&quot;z&quot;: 1, &quot;x&quot;: {&quot;s&quot;: 2, &quot;t&quot;: 1}}`)\n\nj1, _ := Unmarshal(b1)\nj2, _ := Unmarshal(b2)\nassert.True(t, Equal(j1, j2))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1803, "user_id": 167408, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/slHOv.png?s=128&g=1", "display_name": "Highstead", "link": "https://stackoverflow.com/users/167408/highstead"}, "is_accepted": false, "score": 9, "last_activity_date": 1579207166, "last_edit_date": 1579207166, "creation_date": 1579206716, "answer_id": 59777391, "question_id": 32408890, "link": "https://stackoverflow.com/questions/32408890/how-to-compare-two-json-requests/59777391#59777391", "title": "How to compare two JSON requests?", "body": "<p>Super late to the party here.  </p>\n\n<p>There is a popular testing package in golang called require <code>github.com/stretchr/testify/require</code> and it will do this for you.</p>\n\n<pre><code>func TestJsonEquality(t *testing.t) { \n  expected := `{\"a\": 1, \"b\": 2} `\n  actual := ` {\"b\":   2, \"a\":   1}`\n  require.JSONEq(t, expected, actual)\n}\n</code></pre>\n\n<p>GoDocs: <a href=\"https://godoc.org/github.com/stretchr/testify/require#JSONEqf\" rel=\"noreferrer\">https://godoc.org/github.com/stretchr/testify/require#JSONEqf</a></p>\n"}], "owner": {"reputation": 1172, "user_id": 4063955, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4e673d7ec4fee43318e34d690606ca7c?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Hunt", "link": "https://stackoverflow.com/users/4063955/anthony-hunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12173, "favorite_count": 0, "accepted_answer_id": 32409106, "answer_count": 3, "score": 12, "last_activity_date": 1600016183, "creation_date": 1441419359, "question_id": 32408890, "link": "https://stackoverflow.com/questions/32408890/how-to-compare-two-json-requests", "title": "How to compare two JSON requests?", "body": "<p>Short Story: How can I compare two chunks of JSON? The code below errors out.</p>\n\n<pre><code>var j, j2 interface{}\nb := []byte(srv.req)\nif err := json.Unmarshal(b, j); err !=nil{\n    t.Errorf(\"err %v, req %s\", err, b)\n    return\n}\nd := json.NewDecoder(r.Body)\nif err := d.Decode(j2); err !=nil{\n    t.Error(err)\n    return\n}\nif !reflect.DeepEqual(j2, j){\n    t.Errorf(\"j %v, j2 %v\", j, j2)\n    return\n}\n</code></pre>\n\n<p>Long Story:\n I'm doing some E2E testings and part of this I need to compare the requested JSON body with the received JSON. To do this I've tried to unmarshal the expected and received json to an empty interface (to avoid any type mistakes) but I get an error:\n<code>json: Unmarshal(nil)</code>. I guess encoding/json doesn't like the empty interface so the question is how can I compare two chunks of JSON? A string comparison would be error prone so I'm trying to avoid that.</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 4, "last_activity_date": 1441412451, "creation_date": 1441412451, "answer_id": 32408265, "question_id": 32408249, "link": "https://stackoverflow.com/questions/32408249/anonymous-fields-in-json/32408265#32408265", "title": "anonymous fields in JSON", "body": "<p>Just decode the data into a map (<code>map[string]int</code>):</p>\n\n<pre><code>jsonData := []byte(\"{\\\"1\\\":123,\\\"2\\\":234,\\\"3\\\":345}\")\n\nvar decoded map[string]int\nerr := json.Unmarshal(jsonData, &amp;decoded)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>You'll then be able to iterate over and access the elements by the user ID key:</p>\n\n<pre><code>for userID, _ := range decoded {\n    fmt.Printf(\"User ID: %s\\n\", userID)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/SJkpahGzJY\">https://play.golang.org/p/SJkpahGzJY</a></p>\n"}], "owner": {"reputation": 19, "user_id": 4111329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/274a29827081f7116df487f04b8e7349?s=128&d=identicon&r=PG&f=1", "display_name": "scratch3", "link": "https://stackoverflow.com/users/4111329/scratch3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 450, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1441412451, "creation_date": 1441412297, "question_id": 32408249, "link": "https://stackoverflow.com/questions/32408249/anonymous-fields-in-json", "title": "anonymous fields in JSON", "body": "<p>I'm reverse engineering some JSON that seems to be using anonymous field names.  For example:</p>\n\n<pre><code>{\n   \"1\": 123,\n   \"2\": 234,\n   \"3\": 345\n}\n</code></pre>\n\n<p>BTW - it's not simply using \"1\" and \"2\" and \"3\" because they represent userids that are at a minimum int32's.</p>\n\n<p>Is there some way such as using tags to properly Unmarshal the JSON?  </p>\n\n<p>I've tried:</p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/json\"\n        \"fmt\"\n)\n\ntype MyStruct struct {\n        string `json:\",string\"`\n}\n\nfunc main() {\n        jsonData := []byte(\"{\\\"1\\\":123,\\\"2\\\":234,\\\"3\\\":345}\")\n\n        var decoded MyStruct\n        err := json.Unmarshal(jsonData, &amp;decoded)\n        if err != nil {\n                panic(err)\n        }\n        fmt.Printf(\"decoded=%+v\\n\", decoded)\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 3904, "user_id": 1598603, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/a58efb2416199d31f1ef808b607c2fcf?s=128&d=identicon&r=PG", "display_name": "CargoMeister", "link": "https://stackoverflow.com/users/1598603/cargomeister"}, "edited": false, "score": 0, "creation_date": 1441397349, "post_id": 32405742, "comment_id": 52679936, "body": "They may have it configured correctly for within the cluster, but are the security groups and permissions within mongo set up to allow access from elsewhere? They probably have everything locked down, as they should."}, {"owner": {"reputation": 4395, "user_id": 1169863, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/05663d4e7f36f900ecd98ed1cbe76553?s=128&d=identicon&r=PG", "display_name": "syazdani", "link": "https://stackoverflow.com/users/1169863/syazdani"}, "reply_to_user": {"reputation": 3904, "user_id": 1598603, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/a58efb2416199d31f1ef808b607c2fcf?s=128&d=identicon&r=PG", "display_name": "CargoMeister", "link": "https://stackoverflow.com/users/1598603/cargomeister"}, "edited": false, "score": 0, "creation_date": 1441397799, "post_id": 32405742, "comment_id": 52680118, "body": "Certainly I can make a connection to the cluster from the mongo cli client. And again, the first request to Mongo is answered successfully, its subsequent ones that timeout."}], "answers": [{"tags": [], "owner": {"reputation": 4395, "user_id": 1169863, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/05663d4e7f36f900ecd98ed1cbe76553?s=128&d=identicon&r=PG", "display_name": "syazdani", "link": "https://stackoverflow.com/users/1169863/syazdani"}, "is_accepted": true, "score": 1, "last_activity_date": 1556592646, "creation_date": 1556592646, "answer_id": 55913339, "question_id": 32405742, "link": "https://stackoverflow.com/questions/32405742/mongodb-i-o-timeout-when-using-clustered-mongo-instances/55913339#55913339", "title": "mongodb i/o timeout when using clustered mongo instances", "body": "<p>In a rather long and grueling process, we finally tracked down where this issue and similar ones like it came from in our program. It ended up being a session leak in the v1 version of the upper.io/db library. The bug and fix are <a href=\"https://github.com/upper/db/pull/212\" rel=\"nofollow noreferrer\">outlined here</a>, but the v1 version of this library is horribly outdated at this point and the later versions do not exhibit this issue.</p>\n\n<p>I doubt this answer will be useful for anybody so late in the game (especially since we ourselves solved it like.. 3 years ago at this point), but just wanted to leave the answer here for completeness.</p>\n"}], "owner": {"reputation": 4395, "user_id": 1169863, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/05663d4e7f36f900ecd98ed1cbe76553?s=128&d=identicon&r=PG", "display_name": "syazdani", "link": "https://stackoverflow.com/users/1169863/syazdani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 655, "favorite_count": 0, "accepted_answer_id": 55913339, "answer_count": 1, "score": 1, "last_activity_date": 1556592646, "creation_date": 1441396880, "question_id": 32405742, "link": "https://stackoverflow.com/questions/32405742/mongodb-i-o-timeout-when-using-clustered-mongo-instances", "title": "mongodb i/o timeout when using clustered mongo instances", "body": "<p>I have an application that is using the <code>upper.io/db</code> package for communication with a Mongo database server (which is a fairly simple wrapper around <code>gopkg.in/mgo.v2</code>). The way the application works is that it creates a session in the main thread on start-up, and then each individual go routine that needs to make requests to the mongo server calls <code>Clone</code> on the session and does a <code>defer session.Close</code> on the resulting value. As far as I can tell, this is all standard operating procedure.</p>\n\n<p>This setup works without any errors in our development environments where we are either using a locally run MongoDB <em>or</em> a sandbox instance on MongoLab. Recently we promoted the application up to our staging environment where we have the application talking to a Shared Cluster instance of MongoDB on MongoLab (the cheapest 15$ option). This is where the weirdness starts happening. The /first/ request that goes through (from the first go-routine that gets invoked) comes back with the expected response, but the subsequent ones all return</p>\n\n<pre><code> read tcp &lt;ip address&gt;:47112: i/o timeout\n</code></pre>\n\n<p>This happens both from our local development machines pointed at the cluster or from the AWS host for the staging environment. Since the Mongo cluster is from Mongolabs I am going to assume that they've configured everything correctly on their end.</p>\n\n<p>The code is somewhat boring TBH: It literally just opens the session in the main function and maintains a reference to it, and then there are multiple goroutines with this basic structure:</p>\n\n<pre><code>   sess := session.Clone()\n   defer sess.Close()\n\n   // make requests to Mongo\n</code></pre>\n\n<p>During testing, I even restricted it to run only one thing at once (i.e. only one goroutine is active at any given time), and it still fails in the same fashion.</p>\n\n<p>Has anybody run into this before? Do I need to configure upper.io/db in a specific fashion? Maybe use mgo directly? I am at my wits end with this :(</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1441396152, "post_id": 32405499, "comment_id": 52679381, "body": "In Go a <code>string</code> can&#39;t be <code>nil</code> (<i>not</i> <code>null</code>). Would <code>Titles []*string</code> work for you? (It would be a bit harder to initialize via a literal)."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1441396227, "post_id": 32405499, "comment_id": 52679416, "body": "You can&#39;t use <code>null</code> because the value in Go is <code>nil</code> and you can&#39;t use if for a string, it would have to be a string pointer."}, {"owner": {"reputation": 14145, "user_id": 1255956, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a6a3498ebb173fb2373fded6f46d65fd?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1255956/chris"}, "edited": false, "score": 0, "creation_date": 1441396306, "post_id": 32405499, "comment_id": 52679455, "body": "I changed the title. Im sorry for my ignorance -- no disrespect to the Go community! Can you show an example of how to initialize this?"}], "answers": [{"comments": [{"owner": {"reputation": 14145, "user_id": 1255956, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a6a3498ebb173fb2373fded6f46d65fd?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1255956/chris"}, "edited": false, "score": 0, "creation_date": 1441397209, "post_id": 32405611, "comment_id": 52679870, "body": "Thank you for your time and help, this makes sense!"}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 2, "last_activity_date": 1441396367, "creation_date": 1441396367, "answer_id": 32405611, "question_id": 32405499, "link": "https://stackoverflow.com/questions/32405499/go-send-null-in-json/32405611#32405611", "title": "Go send null in json", "body": "<p>You will have to use <code>*string</code> instead, and create a helper function to make it easier, something along the lines of:</p>\n\n<pre><code>func main() {\n    chiefTitles := []*string{sP(\"CEO\"), sP(\"CFO\"), nil, sP(\"CMO\")}\n\n    b, _ := json.Marshal(JobTitles{chiefTitles})\n\n    fmt.Println(string(b))\n}\n\ntype JobTitles struct {\n    Titles []*string `json:\"titles\"`\n}\n\nfunc sP(s string) *string {\n    return &amp;s\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/8mE2Hug8Zb\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}, {"comments": [{"owner": {"reputation": 14145, "user_id": 1255956, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a6a3498ebb173fb2373fded6f46d65fd?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1255956/chris"}, "edited": false, "score": 0, "creation_date": 1441397191, "post_id": 32405619, "comment_id": 52679862, "body": "Thank you for your comment and answer @evanmcdonnal"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 3, "last_activity_date": 1441396396, "creation_date": 1441396396, "answer_id": 32405619, "question_id": 32405499, "link": "https://stackoverflow.com/questions/32405499/go-send-null-in-json/32405619#32405619", "title": "Go send null in json", "body": "<p>In order to represent that type with the value 'null' it would have to be a pointer. The problem isn't that you can't use null but rather that a string can't have that value. Here is a quick example I made in the playground; <a href=\"https://play.golang.org/p/SXO5sBl2mR\" rel=\"nofollow\">https://play.golang.org/p/SXO5sBl2mR</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"encoding/json\"\n\ntype Test struct {\n    A *string\n    B *string\n}\n\nfunc main() {\n        s := \"Something\"\n        t := Test{A:&amp;s, B:nil}\n        b, err := json.Marshal(t)\n        if err != nil {\n            fmt.Println(err)\n        }\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>As DaveC mentioned using pointers makers the initilization a bit more cumbersome but you can use the same type of constructs I have above; declare a string, use the <code>&amp;</code> that string in the composite literal.</p>\n"}], "owner": {"reputation": 14145, "user_id": 1255956, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a6a3498ebb173fb2373fded6f46d65fd?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1255956/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1326, "favorite_count": 0, "accepted_answer_id": 32405619, "answer_count": 2, "score": 3, "last_activity_date": 1441396520, "creation_date": 1441395945, "last_edit_date": 1441396183, "question_id": 32405499, "link": "https://stackoverflow.com/questions/32405499/go-send-null-in-json", "title": "Go send null in json", "body": "<pre><code>type JobTitles struct {\n    Titles []string `json:\"titles\"`\n}\n\nchiefTitles := []string{\"CEO\", \"CFO\", null, \"CMO\"}\n\njsonOut := JobTitles{chiefTitles}\n</code></pre>\n\n<p>In the code above, I would like to be able to send <em>null</em> as one of the values in my json string array. However, the above will not compile and if I add double quotes to <em>null</em> it becomes a string not the value null.</p>\n\n<p>How can I send <em>null</em> in my json response in GO? </p>\n\n<p><a href=\"http://dennissuratna.com/marshalling-nullable-string-db-value-to-json-in-go/\" rel=\"nofollow\">This</a> article seems to help, but looks to be the inverse of my question..</p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1441394693, "post_id": 32405165, "comment_id": 52678698, "body": "Just to double check: the <code>type1</code> and <code>type2</code> are dynamic, correct? Also, what are you trying to achieve?"}, {"owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1441394815, "post_id": 32405165, "comment_id": 52678759, "body": "Actually, they are types defined in go code."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1441394867, "post_id": 32405165, "comment_id": 52678781, "body": "Are you not able to use a type switch then?"}, {"owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1441394934, "post_id": 32405165, "comment_id": 52678813, "body": "How would I use type switch on the type Value (which reflection gives me)?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1441395042, "post_id": 32405165, "comment_id": 52678855, "body": "From your question, I don&#39;t know why <code>reflect.Value</code> is needed, but if that&#39;s all you have, you can do: <code>switch value.Interface().(type) { ...</code>"}, {"owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1441395739, "post_id": 32405165, "comment_id": 52679179, "body": "That makes sense. But made me realize I asked the wrong question. I am iterating over fields of a struct, and want to do different things based on the type of each field. Any ideas? Post it as an answer and I&#39;ll accept it."}], "answers": [{"comments": [{"owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "edited": false, "score": 0, "creation_date": 1441396682, "post_id": 32405535, "comment_id": 52679625, "body": "This will work - but not if the fields are nil. Is there a way to go by the types of the fields directly?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "edited": false, "score": 0, "creation_date": 1441396860, "post_id": 32405535, "comment_id": 52679717, "body": "@Ziffusion: The type switch works on the field type, not the value. Example: <a href=\"https://play.golang.org/p/U82wLxOS98\" rel=\"nofollow noreferrer\">play.golang.org/p/U82wLxOS98</a>"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "edited": false, "score": 1, "creation_date": 1441396969, "post_id": 32405535, "comment_id": 52679769, "body": "@Ziffusion: The type switch works on the field type, not the value. See: <a href=\"https://play.golang.org/p/U82wLxOS98\" rel=\"nofollow noreferrer\">play.golang.org/p/U82wLxOS98</a>"}, {"owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "edited": false, "score": 0, "creation_date": 1441397235, "post_id": 32405535, "comment_id": 52679885, "body": "What I mean is that what you have works off the type of the value of the fields. And it does work. But it won&#39;t work if the field values are nil. You can try it by changing your example code to NOT initialize the struct (leave the fields nil)."}, {"owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "edited": false, "score": 0, "creation_date": 1441397789, "post_id": 32405535, "comment_id": 52680113, "body": "hmm .. that does work ... dunno what I am screwing up in my code"}, {"owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "edited": false, "score": 0, "creation_date": 1441399823, "post_id": 32405535, "comment_id": 52680976, "body": "Any idea why this does not work? And how to make it work for this case? <a href=\"https://play.golang.org/p/Pl4t-s4wEI\" rel=\"nofollow noreferrer\">play.golang.org/p/Pl4t-s4wEI</a>"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "reply_to_user": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "edited": false, "score": 1, "creation_date": 1441400252, "post_id": 32405535, "comment_id": 52681136, "body": "@Ziffusion: In order for <code>Interface()</code> to work, the field needs to be exported (i.e. its name needs to start with an uppercase letter): <a href=\"https://play.golang.org/p/v27UG0R7Nc\" rel=\"nofollow noreferrer\">play.golang.org/p/v27UG0R7Nc</a>"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1441396097, "creation_date": 1441396097, "answer_id": 32405535, "question_id": 32405165, "link": "https://stackoverflow.com/questions/32405165/is-it-possible-to-do-something-similar-to-a-type-switch-using-reflection/32405535#32405535", "title": "Is it possible to do something similar to a type switch using reflection?", "body": "<p>If you are iterating over fields of a struct, you can use a type switch to perform different actions based off of the field's type:</p>\n\n<pre><code>value := reflect.ValueOf(s)\nfor i := 0; i &lt; value.NumField(); i++ {\n    field := value.Field(i)\n    if !field.CanInterface() {\n        continue\n    }\n    switch v := field.Interface().(type) {\n    case int:\n        fmt.Printf(\"Int: %d\\n\", v)\n    case string:\n        fmt.Printf(\"String: %s\\n\", v)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-B3PWMqWTo\" rel=\"nofollow\">https://play.golang.org/p/-B3PWMqWTo</a></p>\n"}], "owner": {"reputation": 8069, "user_id": 296923, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cb7b3af2d2d967711454dc8d9c21798f?s=128&d=identicon&r=PG", "display_name": "Ziffusion", "link": "https://stackoverflow.com/users/296923/ziffusion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1053, "favorite_count": 0, "accepted_answer_id": 32405535, "answer_count": 1, "score": 0, "last_activity_date": 1441396910, "creation_date": 1441394394, "last_edit_date": 1441394701, "question_id": 32405165, "link": "https://stackoverflow.com/questions/32405165/is-it-possible-to-do-something-similar-to-a-type-switch-using-reflection", "title": "Is it possible to do something similar to a type switch using reflection?", "body": "<p>I need to do different things based on the type of the value being reflected.</p>\n\n<pre><code>value := reflect.ValueOf(someInterface)\n</code></pre>\n\n<p>I'd like to do something that has the following effect:</p>\n\n<pre><code>if &lt;type of value&gt; == &lt;type1&gt; {\n    do something\n} else if &lt;type of value&gt; == &lt;type2&gt; {\n    do something\n}\n</code></pre>\n\n<p>This is something similar to what a type switch does in go code.</p>\n"}, {"tags": ["go", "architecture", "channel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441388394, "post_id": 32403317, "comment_id": 52675742, "body": "There&#39;s no need to close channels like <code>close(cm)</code>, if there&#39;s never any more receive operations"}, {"owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441388642, "post_id": 32403317, "comment_id": 52675847, "body": "@JimB initially I didn&#39;t close it but as soon as a second request came in it got blocked."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441388909, "post_id": 32403317, "comment_id": 52675990, "body": "You must be doing something you&#39;re not showing here. You only ever receive one message on the channel, so there&#39;s no need to close."}, {"owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441389190, "post_id": 32403317, "comment_id": 52676110, "body": "@JimB I see, I tried a slightly different version of this example earlier which caused a problem when not closing it. Just tried the example given in the post and you&#39;re right, it works."}], "answers": [{"comments": [{"owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "edited": false, "score": 0, "creation_date": 1441388976, "post_id": 32403663, "comment_id": 52676017, "body": "Ah, great! I was wondering if a single channel would do and how this would work. Just to clarify, in this case the message queue could grow up to 100 \u2026 and if for some reason 150 end up in there, it blocks the handler but will stop blocking as soon as <code>send()</code> has worked it back down to 100 or less?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "edited": false, "score": 0, "creation_date": 1441389202, "post_id": 32403663, "comment_id": 52676112, "body": "correct, that&#39;s how buffered channels work. A send blocks until there&#39;s space n the buffer."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1441389313, "last_edit_date": 1441389313, "creation_date": 1441387960, "answer_id": 32403663, "question_id": 32403317, "link": "https://stackoverflow.com/questions/32403317/should-things-like-an-apps-mailer-system-run-in-a-separate-channel-as-shown-in/32403663#32403663", "title": "Should things like an app&#39;s mailer system run in a separate channel as shown in this example?", "body": "<p>You're not really doing anything in this example, but passing message over channels is always safe -- channels are one of the basic concurrency primitives in the language. You are leaving yourself open to the possibility of race conditions, depending on what <code>send</code> actually ends up doing. Another way to handle this is to have <code>send</code> receive from a single channel.</p>\n\n<pre><code>type Mailer struct{\n    Messages chan Message\n}\n\nfunc (m *Mailer) send() {\n    for message := range m.Messages {\n        fmt.Printf(\"Sending email to:`%s`\\nSubject: %s\\n%s\\n\\n\", message.To, message.Subject, message.Body)\n    }\n}\n\nvar mailer *Mailer\n\nfunc Index(w http.ResponseWriter, r *http.Request) {\n    m := Message{\"email@example.com\", fmt.Sprintf(\"visited `%s`\", r.URL.Path[1:]), \"Lorem ipsum\"}\n    mailer.Messages &lt;- m\n\n    fmt.Fprintf(w, \"Sent out email with subject line `%s`\\n\", m.Subject)\n}\n\n\nfunc main() {\n    mailer = &amp;Mailer{\n        // buffer up to 100 message to be sent before blocking\n        Messages: make(chan Message, 100),\n    }\n    // start the mailer send loop\n    go mailer.send()\n\n    ...\n</code></pre>\n"}], "owner": {"reputation": 1621, "user_id": 486998, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0f0a1ee2c9b6c87792a2637a95f272cf?s=128&d=identicon&r=PG", "display_name": "klotz", "link": "https://stackoverflow.com/users/486998/klotz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 32403663, "answer_count": 1, "score": 0, "last_activity_date": 1441389313, "creation_date": 1441386674, "question_id": 32403317, "link": "https://stackoverflow.com/questions/32403317/should-things-like-an-apps-mailer-system-run-in-a-separate-channel-as-shown-in", "title": "Should things like an app&#39;s mailer system run in a separate channel as shown in this example?", "body": "<p>Imagine a web service with a fair amount of different routes. Some of them trigger transactional emails being sent to the user. It seems weird to initialise a <em>mailer</em> instance, for instance something using <code>github.com/aws/aws-sdk-go/service/sns</code> every time a request wants to send something.</p>\n\n<p>Instead I'd assume there's one <em>mailer</em> instance and everything happens on a separate channel to which a <code>message</code> gets posted to. </p>\n\n<h2>Example</h2>\n\n<p>I created a simple example illustrating the problem. A global <code>Mailer</code> instance gets configured once, the <code>Index</code> handler asks for a channel and passes a <code>Message</code>. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n)\n\n// Message is the custom type used to pass the channel\ntype Message struct {\n    To      string\n    Subject string\n    Body    string\n}\n\n// Mailer is responsible to send out emails\ntype Mailer struct{}\n\n// send sends out the email\nfunc (m *Mailer) send(message Message) {\n    fmt.Printf(\"Sending email to:`%s`\\nSubject: %s\\n%s\\n\\n\", message.To, message.Subject, message.Body)\n}\n\n// Messages returns the channel to which messages can be passed\nfunc (m *Mailer) Messages() chan&lt;- Message {\n    cm := make(chan Message)\n\n    go func() {\n        msg := &lt;-cm\n        m.send(msg)\n\n        close(cm)\n    }()\n\n    return cm\n}\n\n// mailer is a global var in this example, would probably be part of some\n// sort of app context that's accessible from any handler.\n//\n// Note the mailer is NOT handler-scoped.\nvar mailer = Mailer{} // would this be thread-safe?\n\n// Index handler\nfunc Index(w http.ResponseWriter, r *http.Request) {\n    m := Message{\"email@example.com\", fmt.Sprintf(\"visited `%s`\", r.URL.Path[1:]), \"Lorem ipsum\"}\n    mailer.Messages() &lt;- m\n\n    fmt.Fprintf(w, \"Sent out email with subject line `%s`\\n\", m.Subject)\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", Index)\n\n    port := os.Getenv(\"PORT\")\n    if port == \"\" {\n        port = \"8080\"\n    }\n\n    if err := http.ListenAndServe(\":\"+port, nil); err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n\n<h3>Output</h3>\n\n<p>Visting <code>http://localhost:8080/hello-world</code> will render\u2026</p>\n\n<blockquote>\n  <p>Sent out email with subject line `visited `hello-world``</p>\n</blockquote>\n\n<p>\u2026 and log</p>\n\n<blockquote>\n  <p>sending email to `email@example.com`:<br>\n    visited `hello-world`<br>\n    Lorem ipsum</p>\n</blockquote>\n\n<h2>Questions</h2>\n\n<ol>\n<li>Is this the right approach?</li>\n<li>Is it thread-safe \u2013 if not how to get it thread-safe?</li>\n</ol>\n"}, {"tags": ["pointers", "go", "reference", "slice"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1441381724, "post_id": 32401933, "comment_id": 52672262, "body": "At the start of each loop iteration, <code>for</code>  is <b>copying</b> the current element of <code>l</code> into <code>i</code>."}, {"owner": {"reputation": 2706, "user_id": 907060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/639864af1118b200b9de3765c2daa651?s=128&d=identicon&r=PG", "display_name": "saul.shanabrook", "link": "https://stackoverflow.com/users/907060/saul-shanabrook"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1441381957, "post_id": 32401933, "comment_id": 52672393, "body": "So it reuses one <code>i</code> basically for the all the iterations?  I think that makes sense. How would I save a pointer to the actual object then, if I am in my loop?"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1441382388, "post_id": 32402163, "comment_id": 52672635, "body": "see here for the FAQ entry: <a href=\"http://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">golang.org/doc/faq#closures_and_goroutines</a>. The <code>i := i</code> idiom is probably the most common solution when you&#39;re not using a closure."}, {"owner": {"reputation": 2706, "user_id": 907060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/639864af1118b200b9de3765c2daa651?s=128&d=identicon&r=PG", "display_name": "saul.shanabrook", "link": "https://stackoverflow.com/users/907060/saul-shanabrook"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441382615, "post_id": 32402163, "comment_id": 52672745, "body": "@JimB Thanks, that is very relevant."}], "tags": [], "owner": {"reputation": 2706, "user_id": 907060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/639864af1118b200b9de3765c2daa651?s=128&d=identicon&r=PG", "display_name": "saul.shanabrook", "link": "https://stackoverflow.com/users/907060/saul-shanabrook"}, "is_accepted": false, "score": 1, "last_activity_date": 1441382330, "last_edit_date": 1495540328, "creation_date": 1441382330, "answer_id": 32402163, "question_id": 32401933, "link": "https://stackoverflow.com/questions/32401933/go-loop-pointer-changes/32402163#32402163", "title": "Go loop pointer changes", "body": "<p>Building off <a href=\"https://stackoverflow.com/questions/32401933/go-loop-pointer-changes#comment52672262_32401933\">Tim's comment</a>, it seems like you can copy the value on each loop, instead of the pointer, and dereference it after.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype t struct {\n    val int\n}\n\nfunc main() {\n    l := []t{{1}, {2}}\n    var p t\n    var i t\n    for _, i = range l {\n        fmt.Println(\"begin\", &amp;p)\n        p = i\n        fmt.Println(\"end\", &amp;p)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2706, "user_id": 907060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/639864af1118b200b9de3765c2daa651?s=128&d=identicon&r=PG", "display_name": "saul.shanabrook", "link": "https://stackoverflow.com/users/907060/saul-shanabrook"}, "is_accepted": false, "score": 1, "last_activity_date": 1441382566, "creation_date": 1441382566, "answer_id": 32402230, "question_id": 32401933, "link": "https://stackoverflow.com/questions/32401933/go-loop-pointer-changes/32402230#32402230", "title": "Go loop pointer changes", "body": "<p>Another option is to get the pointer to the current item by using the index:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype t struct {\n    val int\n}\n\nfunc main() {\n    l := []t{{1}, {2}}\n    var p *t\n\n    for index, _ := range l {\n        fmt.Println(\"begin\", p)\n        p = &amp;l[index]\n        fmt.Println(\"end\", p)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1441383749, "creation_date": 1441383749, "answer_id": 32402564, "question_id": 32401933, "link": "https://stackoverflow.com/questions/32401933/go-loop-pointer-changes/32402564#32402564", "title": "Go loop pointer changes", "body": "<p>The problem is that you're taking the address of the loop/range variable and not the address of the item in slice. However, you're just making a lot of unnecessary work for yourself. For one, why don't you use the <code>i, v := range</code> or better yet <code>i, _ :=</code> and then you can do <code>i-1</code> to get the previous item? Secondly, even if you want it saved in a pointer, still use this syntax and then assign <code>p = &amp;l[i]</code> so you have the address of the item in the slice rather than the address of the loop/range variable.</p>\n\n<p>People are way too eager to use for/each style constructs when it's obviously better to work with the index... If you want index-1 on every iteration, using the index should be your go to way of doing that.</p>\n"}], "owner": {"reputation": 2706, "user_id": 907060, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/639864af1118b200b9de3765c2daa651?s=128&d=identicon&r=PG", "display_name": "saul.shanabrook", "link": "https://stackoverflow.com/users/907060/saul-shanabrook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 0, "accepted_answer_id": 32402564, "answer_count": 3, "score": 0, "last_activity_date": 1441383749, "creation_date": 1441381450, "last_edit_date": 1441381872, "question_id": 32401933, "link": "https://stackoverflow.com/questions/32401933/go-loop-pointer-changes", "title": "Go loop pointer changes", "body": "<p>I am using a <code>for range</code> loop in Go to iterate through a slice of structs.</p>\n\n<p>In each loop, I a pointer to the current item to a variable.</p>\n\n<p>I am confused why the pointer changes value in the next loop.</p>\n\n<p>For example <a href=\"http://play.golang.org/p/7Ruqt0pRB9\" rel=\"nofollow\">this code</a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype t struct {\n    val int\n}\n\nfunc main() {\n    l := []t{{1}, {2}}\n    var p *t\n    for _, i := range l {\n        fmt.Println(\"begin\", p)\n        p = &amp;i\n        fmt.Println(\"end\", p)\n    }\n}\n</code></pre>\n\n<p>I would expect to produce:</p>\n\n<pre><code>begin &lt;nil&gt;\nend &amp;{1}\nbegin &amp;{1}\nend &amp;{2}\n</code></pre>\n\n<p>But actually does:</p>\n\n<pre><code>begin &lt;nil&gt;\nend &amp;{1}\nbegin &amp;{2}\nend &amp;{2}\n</code></pre>\n\n<p>For reference, in my actual code, I am checking for a condition during the loop, and returning the current item and previous one. So I am trying to save a pointer to it, so that in the next iteration it will have access to the previous as well.</p>\n"}, {"tags": ["json", "node.js", "tcp", "go", "buffer"], "answers": [{"comments": [{"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1441375760, "post_id": 32400134, "comment_id": 52668447, "body": "Well yeah, that is obvious.  I&#39;m asking to ensure the entire message arrives.  Sometimes the json will get cut off."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1441375983, "post_id": 32400134, "comment_id": 52668622, "body": "@ChristianGrabowski: TCP guarantees in-order delivery, and since you&#39;re sending json, the syntax provides a way to check if an object is complete. Do you want a way to ensure delivery without parsing the json? Do you want to include a signature to ensure the message is unaltered?"}, {"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1441376104, "post_id": 32400134, "comment_id": 52668696, "body": "I&#39;m saying that when the json data is sent, every few messages, it gets cut off and the remainder is then clumped to the next response.  Clearly it&#39;s cutting off at X paclets for some reason and then continuing."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 4, "creation_date": 1441376552, "post_id": 32400134, "comment_id": 52668976, "body": "@ChristianGrabowski: TCP doesn&#39;t have &quot;messages&quot;, it&#39;s a stream. The stream is broken up into packets, and depending on the timing of your reads, you may read any portion of those in a single operation, up to the size of your read buffer. It&#39;s not &quot;cutting off&quot; anything, you just need to read more from the stream. That said, you can use a length-prefixed message protocol to aid in reading the stream, or something like <code>json.Encoder&#47;Decoder</code> which will delimit multiple json objects with newlines. Maybe post an example of what you&#39;ve tried, and where things are going wrong."}, {"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1441376751, "post_id": 32400134, "comment_id": 52669120, "body": "Yes I know it is a stream. I&#39;m just asking of a way to ensure that when writing a specific json object to this stream, how do I ensure I get the same on the other end. I&#39;m not understanding what&#39;s unclear."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1441377384, "post_id": 32400134, "comment_id": 52669508, "body": "@ChristianGrabowski: Maybe you&#39;re just not wording things precisely, but your last comment indicates you&#39;re missing something. Your message is never &quot;cut off&quot; over TCP, unless you encounter a new message before the old one completed, or the connection is broken. Otherwise, it&#39;s a problem with how you&#39;re handling the stream."}, {"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 0, "creation_date": 1441377582, "post_id": 32400134, "comment_id": 52669645, "body": "Yes there is another message being sent.  My question is how to ensure the next message doesn&#39;t break the first message."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 1, "creation_date": 1441377670, "post_id": 32400134, "comment_id": 52669714, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/88808/discussion-between-jimb-and-christian-grabowski\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1441380253, "last_edit_date": 1441380253, "creation_date": 1441375603, "answer_id": 32400134, "question_id": 32399966, "link": "https://stackoverflow.com/questions/32399966/whats-a-good-way-to-ensure-delivery-of-an-entire-message-when-using-raw-tcp/32400134#32400134", "title": "What&#39;s a good way to ensure delivery of an entire message when using raw tcp?", "body": "<p>You don't need a heartbeat, or fixed size messages for delivery confirmation. If you need to ensure delivery, you need an application level acknowledgement. If you need to ensure delivery of the <em>correct</em> message, you'll need to include a unique message ID to acknowledge. If you need to ensure that the message is unaltered, you'll need to include a checksum or MAC.</p>\n\n<p>Here it sounds like you're having trouble with message framing. While there are many ways to frame your messages (simple length-prefix, <a href=\"https://en.wikipedia.org/wiki/Type-length-value\" rel=\"nofollow\">type-length-value</a>, HTTP/1.1, etc.), a simple solution is to use the built-in <code>json.Encoder</code> and <code>json.Decoder</code>.</p>\n\n<p>Example client, which sends a \"PING\" message every second:</p>\n\n<pre><code>type Message struct {\n    Payload string\n}\n\nfunc sendMessages(c net.Conn) {\n    message := Message{}\n\n    encoder := json.NewEncoder(c)\n\n    for i := 0; ; i++ {\n        message.Payload = fmt.Sprintf(\"PING %d\", i)\n        err := encoder.Encode(message)\n        if err != nil {\n            log.Fatal(err)\n        }\n        time.Sleep(time.Second)\n    }\n}\n</code></pre>\n\n<p>Example Server:</p>\n\n<pre><code>type Message struct {\n    Payload string\n}\n\nfunc receiveMessages(c net.Conn) {\n    m := Message{}\n\n    decoder := json.NewDecoder(c)\n    for {\n        err := decoder.Decode(&amp;m)\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Printf(\"Received: %#v\\n\", m)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 32400134, "answer_count": 1, "score": -1, "last_activity_date": 1441380253, "creation_date": 1441375104, "last_edit_date": 1441376833, "question_id": 32399966, "link": "https://stackoverflow.com/questions/32399966/whats-a-good-way-to-ensure-delivery-of-an-entire-message-when-using-raw-tcp", "title": "What&#39;s a good way to ensure delivery of an entire message when using raw tcp?", "body": "<p>Say I have an application that on the backend I want to use raw tcp so that I can have bi-directional communication between different services. In this application I want to send over a payload consisting of a json object, when the json data is sent, every few messages, it gets cut off and the remainder is then clumped to the next response.  I don't want to use something like say websockets due to the time used to upgrade from http.  What is a good (and hopefully best) way to ensure that that json object will go from one node and be read from another node as the <strong>whole</strong> json object?  </p>\n\n<p>I know sending and receiving buffers of a set size and a message for a heartbeet are the rule of thumb, but can I see an example? Preferably in Javascript (node's net stdlib) or Golang (it's net stdlib) because those are my most proficient languages, though I don't really care what language it is done in ultimately.</p>\n\n<p>(I know there's a few questions out there asking similar things regarding ensuring delivery of message with tcp, but none asked for an example that I found)</p>\n\n<p>I know tcp is a stream. I'm just asking of a way to ensure that when writing a specific json object to this stream, how do I ensure I get the same json object on the other end, as in \"send json object X from node a, ok node b received <em>that same object</em> X\"</p>\n"}, {"tags": ["struct", "go", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1441371299, "post_id": 32398263, "comment_id": 52665222, "body": "This cannot be done. Go is statically typed. Redesign your solution."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1441376845, "post_id": 32398263, "comment_id": 52669174, "body": "You can&#39;t convert any slice to <code>[]interface{}</code>. For explanation and solution see <a href=\"http://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go\">Type converting slices of interfaces in go</a>."}, {"owner": {"reputation": 1685, "user_id": 1291512, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QFnuz.jpg?s=128&g=1", "display_name": "WhiteAngel", "link": "https://stackoverflow.com/users/1291512/whiteangel"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1441377788, "post_id": 32398263, "comment_id": 52669789, "body": "@Volker, icza Thank you, guys."}, {"owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "edited": false, "score": 0, "creation_date": 1441380702, "post_id": 32398263, "comment_id": 52671643, "body": "@WhiteAngel the &quot;go way&quot; is using interfaces, I posted a solution that might help :)"}], "answers": [{"comments": [{"owner": {"reputation": 1685, "user_id": 1291512, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QFnuz.jpg?s=128&g=1", "display_name": "WhiteAngel", "link": "https://stackoverflow.com/users/1291512/whiteangel"}, "edited": false, "score": 1, "creation_date": 1441376106, "post_id": 32398704, "comment_id": 52668697, "body": "Thank you for your response. But this is what I was trying to avoid - <code>switch</code> statement and checking types. In this case I would have repeating blocks that will do absolutely the same things for each type. So, Go doesn&#39;t allow you to do this in a clean way? For me the problem is that I might have 10 different models and even more."}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 1685, "user_id": 1291512, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QFnuz.jpg?s=128&g=1", "display_name": "WhiteAngel", "link": "https://stackoverflow.com/users/1291512/whiteangel"}, "edited": false, "score": 0, "creation_date": 1441386282, "post_id": 32398704, "comment_id": 52674671, "body": "Maybe you can use interfaces for that?"}, {"owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "edited": false, "score": 0, "creation_date": 1441391913, "post_id": 32398704, "comment_id": 52677449, "body": "@RoninDev like in my answer?"}, {"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "reply_to_user": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "edited": false, "score": 0, "creation_date": 1441440185, "post_id": 32398704, "comment_id": 52689236, "body": "@PabloFernandez exactly"}], "tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": false, "score": 4, "last_activity_date": 1441372166, "last_edit_date": 1441372166, "creation_date": 1441371527, "answer_id": 32398704, "question_id": 32398263, "link": "https://stackoverflow.com/questions/32398263/how-to-create-an-array-of-struct-arrays-of-different-types/32398704#32398704", "title": "How to create an array of struct arrays of different types?", "body": "<p>You should use <code>[]interface{}</code> instead of <code>[][]interface{}</code><br>\nTry it on the <kbd><a href=\"https://play.golang.org/p/JNCeCIa0R7\">go playground</a></kbd></p>\n\n<p>If you want to iterate all structs in your inner arrays, you need to cast them to the proper type and then iterate, like this:  </p>\n\n<pre><code>for _, model := range models {\n    if u, ok := model.([]User); ok {\n        for _, innerUser := range u {\n            log.Printf(\"%#v\", innerUser)\n        }\n    }\n    if a, ok := model.([]Article); ok {\n        for _, innerArticle := range a {\n            log.Printf(\"%#v\", innerArticle)\n        }\n    }\n}\n</code></pre>\n\n<p>Try it on the <kbd><a href=\"https://play.golang.org/p/vTTFQbatKV\">go playground</a></kbd></p>\n"}, {"tags": [], "owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "is_accepted": false, "score": 0, "last_activity_date": 1441382213, "last_edit_date": 1441382213, "creation_date": 1441380662, "answer_id": 32401687, "question_id": 32398263, "link": "https://stackoverflow.com/questions/32398263/how-to-create-an-array-of-struct-arrays-of-different-types/32401687#32401687", "title": "How to create an array of struct arrays of different types?", "body": "<p>How about using interfaces to solve your problem? you can even use the default <code>fmt.Stringer</code> interface, used by <code>fmt.Prtinf</code> and other standard methods.</p>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport \"log\"\nimport \"fmt\"\n\ntype User struct {\n    Name string\n}\n\ntype Article struct {\n    Title string\n}\n\nfunc (art Article) String() string {\n    return art.Title\n}\n\nfunc (user User) String() string {\n    return user.Name\n}\n\nfunc main() {\n    models := []interface{}{User{\"user1\"}, User{\"user2\"}, Article{\"article1\"}, Article{\"article2\"}}\n    for _, model := range models {\n        printable := model.(fmt.Stringer)\n        log.Printf(\"%s\\n\", printable)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/W3qakrMfOd\" rel=\"nofollow\">https://play.golang.org/p/W3qakrMfOd</a></p>\n"}, {"tags": [], "owner": {"reputation": 109950, "user_id": 86989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd262de5d82a235eeb64f71e4058198?s=128&d=identicon&r=PG", "display_name": "newacct", "link": "https://stackoverflow.com/users/86989/newacct"}, "is_accepted": false, "score": 1, "last_activity_date": 1441425649, "creation_date": 1441425649, "answer_id": 32409395, "question_id": 32398263, "link": "https://stackoverflow.com/questions/32398263/how-to-create-an-array-of-struct-arrays-of-different-types/32409395#32409395", "title": "How to create an array of struct arrays of different types?", "body": "<p>Maybe I'm not getting your requirements, but what's wrong with just</p>\n\n<pre><code>models := []interface{} {users, articles}\nfor _, model := range models {\n    log.Printf(\"%#v\\n\", model)\n}\n</code></pre>\n"}], "owner": {"reputation": 1685, "user_id": 1291512, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/QFnuz.jpg?s=128&g=1", "display_name": "WhiteAngel", "link": "https://stackoverflow.com/users/1291512/whiteangel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2057, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1441425649, "creation_date": 1441370210, "last_edit_date": 1441377237, "question_id": 32398263, "link": "https://stackoverflow.com/questions/32398263/how-to-create-an-array-of-struct-arrays-of-different-types", "title": "How to create an array of struct arrays of different types?", "body": "<p>In my program I got 2 models:</p>\n\n<pre><code>type User struct {\n    Name string\n}\n\ntype Article struct {\n    Title string\n}\n</code></pre>\n\n<p>And I got arrays of data of these structs:</p>\n\n<pre><code>users := []User\narticles := []Article\n</code></pre>\n\n<p>I'm trying to iterate over both of them at the same piece of code:</p>\n\n<pre><code>models := [][]interface{} {users, articles}\nfor _, model := range models {\n    log.Printf(\"%#v\", model)\n}\n</code></pre>\n\n<p>But I'm receiving an error:</p>\n\n<pre><code>cannot use users (type []User) as type []interface {} in array element\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["vim", "go"], "owner": {"reputation": 7593, "user_id": 1437346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/3a9caba75c99f7e17c7d2375aaee9320?s=128&d=identicon&r=PG", "display_name": "Yann Moisan", "link": "https://stackoverflow.com/users/1437346/yann-moisan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 346, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1441595876, "creation_date": 1441368532, "last_edit_date": 1441595876, "question_id": 32397713, "link": "https://stackoverflow.com/questions/32397713/using-vim-go-gocode-and-godep-doesnt-work-together", "title": "Using vim-go, gocode and godep doesn&#39;t work together", "body": "<p>I am using YCM, installing with this option <code>--gocode-completer</code>.</p>\n\n<p>After having started Vim, I see the gocode daemon :</p>\n\n<pre><code>$ ps -ef | grep gocode\n  501 53255     1   0  4:36PM ??         0:00.03 /Users/yamo/.vim/bundle/YouCompleteMe/third_party/ycmd/ycmd/completers/go/../../../third_party/gocode/gocode -s -sock unix -addr localhost:37373\n</code></pre>\n\n<p>Completion works well on a built-ins (like fmt) but not on a dependency in GoDeps.</p>\n\n<p>gocode displays the following message </p>\n\n<blockquote>\n  <p>: Gocode returned empty JSON response</p>\n</blockquote>\n\n<p>Nevertheless, godep seems have been correctly detected\n<code>:GoPath</code> displays</p>\n\n<pre><code>/Users/yamo/Projects/.go/src/github.com/YannMoisan/openshift-skeleton/Godeps/_workspace:/Users/yamo/Projects/.go/vendor/:/Users/yamo/Projects/.go\n</code></pre>\n\n<p>Any idea to fix that ?</p>\n"}, {"tags": ["java", "node.js", "multithreading", "go", "websocket"], "comments": [{"owner": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "edited": false, "score": 0, "creation_date": 1441366488, "post_id": 32396647, "comment_id": 52662337, "body": "So are your measurements comparable? Did you have 2450 threads with your node.js and golang implementations?"}, {"owner": {"reputation": 7731, "user_id": 1614378, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/lOzxR.png?s=128&g=1", "display_name": "dieter", "link": "https://stackoverflow.com/users/1614378/dieter"}, "reply_to_user": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "edited": false, "score": 0, "creation_date": 1441367750, "post_id": 32396647, "comment_id": 52663068, "body": "@Kayaman no since there is just one connection between proxy server and real server. But since Tyrus use non blocking IO and node.js also use it. Why is the scalability so different. I mean I see no advantages of <code>java.nio</code>"}, {"owner": {"reputation": 67717, "user_id": 2541560, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7H9TF.png?s=128&g=1", "display_name": "Kayaman", "link": "https://stackoverflow.com/users/2541560/kayaman"}, "edited": false, "score": 3, "creation_date": 1441368035, "post_id": 32396647, "comment_id": 52663220, "body": "Since you&#39;re not giving practically anything to go on, I&#39;ll provide you with a &quot;you&#39;re probably doing something wrong&quot; answer."}, {"owner": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "edited": false, "score": 0, "creation_date": 1441417610, "post_id": 32396647, "comment_id": 52685317, "body": "And what about the node.js and Go versions.  Are they spawning multiple threads too?"}, {"owner": {"reputation": 7731, "user_id": 1614378, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/lOzxR.png?s=128&g=1", "display_name": "dieter", "link": "https://stackoverflow.com/users/1614378/dieter"}, "reply_to_user": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "edited": false, "score": 0, "creation_date": 1441441757, "post_id": 32396647, "comment_id": 52689583, "body": "@StephenC node.js and go version spawning just some threads: THREAD_COUNT = CPU_COUNT"}], "answers": [{"tags": [], "owner": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1441456920, "last_edit_date": 1592644375, "creation_date": 1441369174, "answer_id": 32397916, "question_id": 32396647, "link": "https://stackoverflow.com/questions/32396647/java-websockets-poor-scalability-despite-the-use-of-java-nio/32397916#32397916", "title": "Java Websockets poor scalability despite the use of java.NIO", "body": "<p>There are a number possible answers to this <em>including</em>:</p>\n<ol>\n<li><p>Maybe Tyrus really doesn't scale well.</p>\n</li>\n<li><p>Maybe you are not using it the right way; i.e. your code is doing something that causes Tyrus to perform poorly.</p>\n</li>\n<li><p>Maybe you are &quot;comparing apples and oranges&quot;; i.e. your tests are comparing different things.</p>\n</li>\n<li><p>Maybe it <em>is</em> a memory issue.  What is your evidence that it isn't?</p>\n</li>\n<li><p>Maybe it is due to multiple causes.</p>\n</li>\n</ol>\n<p>Unfortunately, you have not provided any concrete information that would allow us to separate the likely from unlikely causes.</p>\n<hr />\n<p>Based on what you've reported in your updates / comments, it would appear that Tyrus is using a thread for each WebSocket connection, but the others using a more scalable approach.</p>\n<p>Use of NIO does not necessarily imply non-blocking I/O.</p>\n<hr />\n<p>In the <a href=\"https://tomcat.apache.org/tomcat-7.0-doc/web-socket-howto.html\" rel=\"nofollow noreferrer\">documentation</a> for the Tomcat 7 implementation of the WebSocket APIs, it says this:</p>\n<blockquote>\n<p>The Java WebSocket 1.0 specification requires that callbacks for asynchronous writes are performed on a different thread to the thread that initiated the write. Since the container thread pool is not exposed via the Servlet API, the WebSocket implementation has to provide its own thread pool. This thread pool is controlled by the following servlet context initialization parameters:</p>\n<ul>\n<li><code>org.apache.tomcat.websocket.executorCoreSize</code>: The core size of the executor thread pool. If not set, the default of 0 (zero) is used. Note that the maximum permitted size of the executor thread pool is hard coded to Integer.MAX_VALUE which effectively means it is unlimited.</li>\n<li><code>org.apache.tomcat.websocket.executorKeepAliveTimeSeconds</code>: The maximum time an idle thread will remain in the executor thread pool until it is terminated. If not specified, the default of 60 seconds is used.</li>\n</ul>\n</blockquote>\n<p>This hints as to why there are threads being created in Tyrus, and is implies that maybe Tomcat would be more scalable than Tyrus on Glassfish.  (And I'd try Tyrus on Grizzly too.)</p>\n"}], "owner": {"reputation": 7731, "user_id": 1614378, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/lOzxR.png?s=128&g=1", "display_name": "dieter", "link": "https://stackoverflow.com/users/1614378/dieter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1942, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1441456920, "creation_date": 1441365024, "last_edit_date": 1441375492, "question_id": 32396647, "link": "https://stackoverflow.com/questions/32396647/java-websockets-poor-scalability-despite-the-use-of-java-nio", "title": "Java Websockets poor scalability despite the use of java.NIO", "body": "<p>I tried to create about 5 thousand concurrent clients (non stop sending of data from server to client) connected to my glassfish websocket server. (CPU: Double-Core, 8 GB RAM)  </p>\n\n<p>After about 2500 clients were connected the connection time was about 67(!) seconds and I was not able to connect more clients cause of <code>TimeOutException</code>. </p>\n\n<p>Some facts:</p>\n\n<ul>\n<li>Thread Pool max size was set to <strong>12.000</strong>. </li>\n<li>At the time of first TimeoutException I had <strong>2500</strong> clients and about <strong>2450</strong> Threads. So we speak here about one thread per connection.</li>\n<li>It is not a memory issue!</li>\n</ul>\n\n<p>Then a wrote two simple Websocket Proxy Server in <em>Node.js</em> an <em>golang</em> to handle websocket connections. The data exchange between Proxy Server and glassfish server happen over simple Websocket connection.</p>\n\n<p>Now I was able to create over 5 thousand concurrent clients without problems. The same issue I had with Wildfly 8 and Tomcat 8.\nHere is the evaluation:</p>\n\n<p><a href=\"https://i.stack.imgur.com/4NZzy.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4NZzy.png\" alt=\"avaluation\"></a></p>\n\n<p>Now my question.\n<a href=\"https://tyrus.java.net/\" rel=\"nofollow noreferrer\">Tyrus</a> is the implementation of Websocket protocol in glassfish and uses <code>java.nio</code> library under the hood for non blocking I/O. </p>\n\n<p>So why it has anyway so poor scalability? Or why is the scalability so different. I mean I see <strong>no advantages</strong> of <code>java.nio</code></p>\n\n<p>P.S. just scheduling overhead?</p>\n\n<hr>\n\n<h2>EDIT: How to reproduce the issue</h2>\n\n<p><em>Client software for creating and connecting Clients and the Websocket Server are on different PCs.</em></p>\n\n<ol>\n<li>Start a glassfish simple echo websocket server. There are about 76 active glassfish threads.\n<a href=\"https://i.stack.imgur.com/Boli8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Boli8.png\" alt=\"GlassFish-2000-connected-And-Idle\"></a></li>\n<li>now connect 2000 clients without initiating any communication, just connect to the server - Idle mode. In my case it there was no problem to do it. Since all clients were connected there were about 80 active threads. Nearly unchanged.</li>\n<li>Using a <code>Timer</code> let all your 2000 clients start communication with the websocket server simultaneously. You will notice the amount of threads is now about 2019. The response time is about 6.5 seconds.\n<a href=\"https://i.stack.imgur.com/DqATW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/DqATW.png\" alt=\"GlassFish-2000-connected-And-Active\"></a></li>\n<li>Finally try to connect the next 500 clients. The first TimeoutException will occur. Only few clients will be connected.</li>\n<li>Stop simultaneously communication.\n<a href=\"https://i.stack.imgur.com/czi0K.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/czi0K.png\" alt=\"Stop communication\"></a></li>\n</ol>\n"}, {"tags": ["testing", "go", "bdd", "ginkgo"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1441381845, "post_id": 32396372, "comment_id": 52672336, "body": "IMO testing frameworks are unnecessary with Go. It sounds like you&#39;ve never written Go tests, have you tried just reading the <a href=\"https://golang.org/pkg/testing\" rel=\"nofollow noreferrer\"><code>testing</code> package documentation</a> and writing plain old ol&#39; idiomatic Go tests? I&#39;d start there and only consider something else if/when you find something lacking with plain Go and <code>testing</code>."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 154523, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iXJ5V.jpg?s=128&g=1", "display_name": "caiomoritz", "link": "https://stackoverflow.com/users/154523/caiomoritz"}, "is_accepted": false, "score": 0, "last_activity_date": 1459642418, "creation_date": 1459642418, "answer_id": 36380170, "question_id": 32396372, "link": "https://stackoverflow.com/questions/32396372/right-structure-of-tests-files-when-used-ginkgo-gomega-for-testing-go-app/36380170#36380170", "title": "Right structure of tests files when used ginkgo/gomega for testing Go app", "body": "<p>In Go you can run all tests of a given project with a single command regardless of where your test files are located. In a terminal, change to your project base directory and run:</p>\n\n<pre><code>$ go test ./...\n</code></pre>\n\n<p>In my Go projects I usually have a separate Bash script that will do this for me. You can can place it, for instance, in <code>bin/run_tests.sh</code> with the following contents:</p>\n\n<pre><code>#!/bin/bash -e\ntime go test ./... | grep -v '^?'\n</code></pre>\n\n<p>Make this file executable and then run it:</p>\n\n<pre><code>$ ./bin/run_tests.sh\n</code></pre>\n\n<p>I don't have a separate <code>test</code> folder. Judging by most Go projects I see around what developers are going for is having the test file in the same directory where the file being tested is located.</p>\n"}], "owner": {"reputation": 67, "user_id": 2013774, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/b26972193ae745c5636844effede88d2?s=128&d=identicon&r=PG", "display_name": "aleksandr", "link": "https://stackoverflow.com/users/2013774/aleksandr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 975, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1459642418, "creation_date": 1441364144, "question_id": 32396372, "link": "https://stackoverflow.com/questions/32396372/right-structure-of-tests-files-when-used-ginkgo-gomega-for-testing-go-app", "title": "Right structure of tests files when used ginkgo/gomega for testing Go app", "body": "<p>My Go app(restfull api service) is growing and i decided to use testing. My choise is Ginkgo/Gomega.</p>\n\n<p>Learning site (<a href=\"http://onsi.github.io/ginkgo/#getting-started-writing-your-first-test\" rel=\"nofollow\">http://onsi.github.io/ginkgo/#getting-started-writing-your-first-test</a>) i found that to start test you need</p>\n\n<ol>\n<li>goto the package</li>\n<li>ginkgo bootstrap</li>\n</ol>\n\n<p>This will create file [your_package]_suite_test in root of package folder.\nIt's Ok.</p>\n\n<p>But then if i want to test some feature or file or package i need again\ngoto the folder and ginkgo generate [test_name] which will create stub test file here.</p>\n\n<p>So, in one moment we will have many messy: files of our app and testing files together in one folder.\nFor example,\nserver.go, server_test.go, auth.go, auth_test.go, and so on.</p>\n\n<p>I want to searate app files and test files. For example i want to create a folder tests in root package and place all tests here.\nSo, when i need to test app i can run go test ./tests</p>\n\n<p>Is it correct pattern to use Ginkgo/Gomega with separate tests folder?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "edited": false, "score": 4, "creation_date": 1441356808, "post_id": 32393460, "comment_id": 52656463, "body": "Please provide more detailed sample, use <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a> for it. I just not understand you. What is <code>add</code>, what is <code>binFunc</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 9, "last_activity_date": 1441364444, "creation_date": 1441364444, "answer_id": 32396473, "question_id": 32393460, "link": "https://stackoverflow.com/questions/32393460/convert-function-type-in-golang/32396473#32396473", "title": "convert function type in Golang", "body": "<p><code>error</code> is an interface:</p>\n\n<pre><code>type error interface {\n    Error() string\n}\n</code></pre>\n\n<p>This means that any type which has a method: <code>Error() string</code> fulfills the interface and can be assigned to a variable of type <code>error</code>.</p>\n\n<p><code>binFunc</code> has such a method:</p>\n\n<pre><code>func (f binFunc) Error() string {\n    return \"binFunc error\"\n}\n</code></pre>\n\n<p>New developers in Go sometimes find this confusing because they don't realize it's possible to attach methods to more than just structs. In this case <code>binFunc</code> is defined liked this:</p>\n\n<pre><code>type binFunc func(int, int) int\n</code></pre>\n\n<p>So the way this works is you are allowed to convert any function which has the same signature: (from the <a href=\"http://golang.org/ref/spec#Function_types\" rel=\"noreferrer\">spec</a>)</p>\n\n<blockquote>\n  <p>A function type denotes the set of all functions with the same parameter and result types.</p>\n</blockquote>\n\n<p>So if you create a function <code>add</code>:</p>\n\n<pre><code>func add(x, y int) int {\n    return x + y\n}\n</code></pre>\n\n<p>You are allowed to convert this into a <code>binFunc</code>:</p>\n\n<pre><code>binFunc(add)\n</code></pre>\n\n<p>And because of the <code>Error</code> method on <code>binFunc</code> we defined above, we are then able to assign this new <code>binFunc</code> to a variable of type <code>error</code>:</p>\n\n<pre><code>var err error\nvar bf binFunc = binFunc(add)\nerr = bf\n</code></pre>\n\n<p><code>fmt.Println</code>'s behavior is to call <code>.Error()</code> on errors <a href=\"http://godoc.org/fmt#Print\" rel=\"noreferrer\">for you</a>:</p>\n\n<blockquote>\n  <ol start=\"4\">\n  <li>If an operand implements the error interface, the Error method will be invoked to convert the object to a string, which will then be formatted as required by the verb (if any).</li>\n  </ol>\n</blockquote>\n\n<p>So to answer your questions:</p>\n\n<ul>\n<li>The <code>Error</code> method is executed because <code>fmt.Println</code> looks for arguments of type <code>error</code>, invokes <code>.Error()</code> and prints the resulting string. </li>\n<li>You are allowed to assign <code>binFunc</code>s to <code>err</code> because <code>binFunc</code> has an <code>Error</code> method. You cannot assign <code>add</code> directly to <code>err</code> because it does not have an <code>Error</code> method. But you are allowed to convert <code>add</code> to a <code>binFunc</code> because they have the same function signature, and by doing so you can then assign it to the <code>err</code> variable.</li>\n</ul>\n"}], "owner": {"reputation": 325, "user_id": 3983594, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LXW7x.jpg?s=128&g=1", "display_name": "Jason Zhou", "link": "https://stackoverflow.com/users/3983594/jason-zhou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3912, "favorite_count": 2, "accepted_answer_id": 32396473, "answer_count": 1, "score": 2, "last_activity_date": 1441364444, "creation_date": 1441355254, "last_edit_date": 1441355715, "question_id": 32393460, "link": "https://stackoverflow.com/questions/32393460/convert-function-type-in-golang", "title": "convert function type in Golang", "body": "<pre><code>// Each type have Error() string method.\n// The error built-in interface type is the conventional interface for\n// representing an error condition, with the nil value representing no error.\n//  type error interface {\n//   Error() string\n//  }\n\nfunc (f binFunc) Error() string {\n    return \"binFunc error\"\n}\n\nfunc func_type_convert() {\n    var err error\n    err = binFunc(add)\n    fmt.Println(err)\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>I have two questions about the code above:</p>\n\n<ul>\n<li>I don't know why the <code>Error</code> method executed, when <code>add</code> function was converted into <code>binFunc</code> type?</li>\n<li>Why the <code>add</code> function converted result was able to assign to an err error interface variable?</li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "edited": false, "score": 1, "creation_date": 1441351728, "post_id": 32392311, "comment_id": 52653527, "body": "Would <a href=\"https://golang.org/pkg/reflect/#Value.FieldByName\" rel=\"nofollow noreferrer\">Value.FieldByName</a> help in your case?"}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "reply_to_user": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "edited": false, "score": 0, "creation_date": 1441352080, "post_id": 32392311, "comment_id": 52653744, "body": "I just wanted the tag names for something, it was more me being a lazy programmer and trying to do a little less coding (which always turns into a ton more work it seems). I don&#39;t know if I am going to stick to that method anymore, now I am just kinda interested in the answer."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1441353687, "post_id": 32392311, "comment_id": 52654622, "body": "Even though GC (the standard Go compiler) and GCCGO don&#39;t reoder struct fields, I wouldn&#39;t rely on any ordering. There are no express guarantees in the documentation."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1441353905, "post_id": 32392311, "comment_id": 52654752, "body": "Maybe this is a silly question but how do you know they don&#39;t reorder struct fields? Also (with the risk of asking too much in a comment) would it ever be considered advantageous for them to do so? I don&#39;t know much about compiler design."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1441355043, "post_id": 32392311, "comment_id": 52655436, "body": "It can be advantageous if you can achieve memory alignment by just reordering the fields instead of adding padding in between them."}, {"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1441356873, "post_id": 32392311, "comment_id": 52656498, "body": "Do you want to add your first comment as an answer so people at least know they can get some info out of this?"}], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1441396152, "post_id": 32394764, "comment_id": 52679382, "body": "I&#39;d like to add that it&#39;s very unlikely since that would break a lot of things that depend on that memory alignment but you&#39;re still correct."}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 5, "last_activity_date": 1441359475, "last_edit_date": 1495540888, "creation_date": 1441359475, "answer_id": 32394764, "question_id": 32392311, "link": "https://stackoverflow.com/questions/32392311/reflect-type-field-order/32394764#32394764", "title": "Reflect Type.Field() order", "body": "<p>Even though GC (the standard Go compiler) and GCCGO don't reoder struct fields today, I wouldn't rely on any ordering. There are no express guarantees in the documentation. This might be done in a future version of either compiler.</p>\n\n<p>Field reordering is a technique used to memory-align fields inside of a struct without resorting to padding (unnecessarily inflating the struct's memory representation). You can read about it in the following question:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/9486364/why-cant-c-compilers-rearrange-struct-members-to-eliminate-alignment-padding\">Why can&#39;t C compilers rearrange struct members to eliminate alignment padding?</a></p>\n"}, {"tags": [], "owner": {"reputation": 151, "user_id": 7869253, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-RHrtLVxNyY4/AAAAAAAAAAI/AAAAAAAAVC4/3or5830_4AQ/photo.jpg?sz=128", "display_name": "Fred Akalin", "link": "https://stackoverflow.com/users/7869253/fred-akalin"}, "is_accepted": false, "score": 5, "last_activity_date": 1497387573, "creation_date": 1497387573, "answer_id": 44531475, "question_id": 32392311, "link": "https://stackoverflow.com/questions/32392311/reflect-type-field-order/44531475#44531475", "title": "Reflect Type.Field() order", "body": "<p>I asked on golang-nuts about this, and got <a href=\"https://groups.google.com/d/msg/golang-nuts/_he7g1TL0K8/8BBCFB0tCgAJ\" rel=\"noreferrer\">an answer from Ian Lance Taylor</a> confirming it's declaration order, and will not change.</p>\n"}], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 871, "favorite_count": 0, "accepted_answer_id": 32394764, "answer_count": 2, "score": 8, "last_activity_date": 1497387573, "creation_date": 1441351243, "last_edit_date": 1441354093, "question_id": 32392311, "link": "https://stackoverflow.com/questions/32392311/reflect-type-field-order", "title": "Reflect Type.Field() order", "body": "<p>I can't seem to find it in documentation, is there any guarantee that the order from the fields will match the order declared in the struct? I know it seems like it would logically (due to memory layout),and it seems to perform this way too, but just making sure. I don't want code to break later on if this isn't a guarantee.</p>\n\n<p>For example, if I had</p>\n\n<pre><code>type Foo struct {\n    bar    string `tag:\"bar\"`\n    baz    string `tag:\"baz\"`\n    barbaz string `tag:\"barbaz\"`\n}\n</code></pre>\n\n<p>and I ran this code:</p>\n\n<pre><code>var c Foo\nt := reflect.TypeOf(c)\nnf := t.NumField()\n\ntags := make([]string, nf)\n\nfor f := 0; f &lt; nf; f++ {\n    tags[f] = t.Field(f).Tag.Get(\"tag\")\n}\n</code></pre>\n\n<p>Would <code>tags</code> be guaranteed to be <code>[\"bar\", \"baz\", \"barbaz\"]</code>?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": true, "score": 8, "last_activity_date": 1441352894, "last_edit_date": 1441352894, "creation_date": 1441347115, "answer_id": 32391217, "question_id": 32391147, "link": "https://stackoverflow.com/questions/32391147/golang-make-function-and-third-param/32391217#32391217", "title": "Golang: Make function and third param", "body": "<p><code>x := make([]int, 5)</code> Makes <strong>slice</strong> of <code>int</code> with length 5 and capacity 5 (same as length).</p>\n\n<p><code>x := make([]int, 5, 10)</code> Makes <strong>slice</strong> of <code>int</code> with length 5 and capacity 10.</p>\n\n<p><code>x := [5]int{}</code> Makes <strong>array</strong> of <code>int</code> with length 5.</p>\n\n<h2>Slices</h2>\n\n<p>If you need to append more items than <em>capacity</em> of slice using <code>append</code> function, go runtime will allocate new <em>underlying</em> array and copy existing one to it. So if you know about estimated length of your slice, better to use explicit capacity declaration. It will consume more memory for underlying array at the beginning, but safe cpu time for many allocations and array copying.<br>\nYou can explore how <code>len</code> and <code>cap</code> changes while <code>append</code>, using that simple test on <kbd><a href=\"https://play.golang.org/p/Y25rolYvgZ\" rel=\"nofollow\">Go playground</a></kbd><br>\nEvery time when <code>cap</code> value changed, new array allocated</p>\n\n<h2>Arrays</h2>\n\n<p>Array size is fixed, so if you need to grow array you have to create new one with new length and copy your old array into it by your own. </p>\n\n<p>There are some great articles about slices and arrays in go:<br>\n<a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow\">http://blog.golang.org/go-slices-usage-and-internals</a><br>\n<a href=\"http://blog.golang.org/slices\" rel=\"nofollow\">http://blog.golang.org/slices</a></p>\n"}, {"tags": [], "owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "is_accepted": false, "score": 1, "last_activity_date": 1441347157, "creation_date": 1441347157, "answer_id": 32391230, "question_id": 32391147, "link": "https://stackoverflow.com/questions/32391147/golang-make-function-and-third-param/32391230#32391230", "title": "Golang: Make function and third param", "body": "<p>The second line will allocate 10 int's worth memory at the very beginning, but returning you a slice of 5 int's. The second line does not stand less memory, it saves you another memory allocation if you need to expand the slice to anything not more than 10 * load_factor.</p>\n"}], "owner": {"reputation": 1606, "user_id": 2083490, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/e17201a6c69309fe0bb3fef4b7cc4177?s=128&d=identicon&r=PG", "display_name": "Evgeniy Tkachenko", "link": "https://stackoverflow.com/users/2083490/evgeniy-tkachenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 206, "favorite_count": 0, "accepted_answer_id": 32391217, "answer_count": 2, "score": 2, "last_activity_date": 1441356128, "creation_date": 1441346834, "last_edit_date": 1441356128, "question_id": 32391147, "link": "https://stackoverflow.com/questions/32391147/golang-make-function-and-third-param", "title": "Golang: Make function and third param", "body": "<p>What is the difference between:</p>\n\n<pre><code>   x := make([]int, 5, 10)    \n   x := make([]int, 5)   \n   x := [5]int{}\n</code></pre>\n\n<p>I know that <code>make</code> allocates an array and returns a slice that refers to that array. I don't understand where it can be used?</p>\n\n<p>I can't find a good example that will clarify the situation.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "edited": false, "score": 0, "creation_date": 1441333444, "post_id": 32389029, "comment_id": 52647378, "body": "It was not supposed to be a method, but a function, I did a mistake. I corrected it now."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 3, "last_activity_date": 1441332483, "creation_date": 1441332483, "answer_id": 32389029, "question_id": 32388837, "link": "https://stackoverflow.com/questions/32388837/how-should-i-pass-around-the-sql-db-variable-in-several-places-in-the-code/32389029#32389029", "title": "How should I pass around the *sql.DB variable in several places in the code?", "body": "<p>Super simple? A global <code>var db *sql.DB</code> object. <code>*sql.DB</code> is thread-safe and therefore can be accessed concurrently.</p>\n\n<p>Alternatively, you can define your query methods on a type that wraps <code>*sql.DB</code>. It's my opinion that <code>func (u *User) FindByID(id string) (*User, error)</code> doesn't make a whole lot of sense - you accept a User pointer but return a new pointer to a User? </p>\n\n<p>As a simplified example, you could change your code to resemble the below:</p>\n\n<pre><code>type DB struct {\n    *sql.DB\n}\n\nfunc NewDB(host, port string) (*DB, error) {\n    db, err := sql.Open(...)\n    if err != nil {\n        return nil, err\n    }\n\n    return &amp;DB{db}, nil \n}\n\nfunc (db *DB) UserByID(id string) (*User, error) {\n    res, err := db.Query(...)\n    // etc.\n}\n\nfunc (db *DB) UsersList(limit int) ([]*User, error) {\n    res, err := db.Query(...)\n    // etc.\n}\n</code></pre>\n\n<p>In order to call these functions from your handlers you can either:</p>\n\n<ul>\n<li>Use closures (as you are doing now)</li>\n<li>Define an \"environment\" or \"services\" struct that contains your <code>DB</code> type or just vanilla <code>*sql.DB</code> as a field and create your handlers as methods on this. This could also be a global (noting that any members MUST be thread safe).</li>\n<li>Define a custom handler type (my approach) where you call <code>router.GET(\"/user/:id\", GetUserByID(env)</code> instead of using closures.</li>\n</ul>\n\n<p>Some additional reading:</p>\n\n<ol>\n<li><a href=\"http://www.alexedwards.net/blog/organising-database-access\" rel=\"nofollow\">http://www.alexedwards.net/blog/organising-database-access</a> (covers multiple approaches - one of the most comprehensive articles)</li>\n<li><a href=\"https://robots.thoughtbot.com/interface-with-your-database-in-go\" rel=\"nofollow\">https://robots.thoughtbot.com/interface-with-your-database-in-go</a></li>\n<li><a href=\"https://medium.com/@benbjohnson/structuring-applications-in-go-3b04be4ff091\" rel=\"nofollow\">https://medium.com/@benbjohnson/structuring-applications-in-go-3b04be4ff091</a></li>\n<li><a href=\"http://elithrar.github.io/article/http-handler-error-handling-revisited/#a-little-different\" rel=\"nofollow\">http://elithrar.github.io/article/http-handler-error-handling-revisited/#a-little-different</a></li>\n</ol>\n"}], "owner": {"reputation": 911, "user_id": 4748214, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a408837d80439552ffbc5b9b8a88a8dd?s=128&d=identicon&r=PG&f=1", "display_name": "Aiden", "link": "https://stackoverflow.com/users/4748214/aiden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1571, "favorite_count": 2, "accepted_answer_id": 32389029, "answer_count": 1, "score": 4, "last_activity_date": 1441333401, "creation_date": 1441330792, "last_edit_date": 1441333401, "question_id": 32388837, "link": "https://stackoverflow.com/questions/32388837/how-should-i-pass-around-the-sql-db-variable-in-several-places-in-the-code", "title": "How should I pass around the *sql.DB variable in several places in the code?", "body": "<p>I read that you should not close the *sql.DB variable.</p>\n\n<p><a href=\"http://go-database-sql.org/accessing.html\" rel=\"nofollow\">http://go-database-sql.org/accessing.html</a></p>\n\n<p>And it also says that I should: \"Pass it around as needed, or make it available somehow globally, but keep it open.\"</p>\n\n<p>But this article says I should not use global variables but should use closures:\n<a href=\"https://medium.com/@benbjohnson/structuring-applications-in-go-3b04be4ff091\" rel=\"nofollow\">https://medium.com/@benbjohnson/structuring-applications-in-go-3b04be4ff091</a></p>\n\n<p>I found an example of closure here:\n<a href=\"https://gist.github.com/tsenart/5fc18c659814c078378d\" rel=\"nofollow\">https://gist.github.com/tsenart/5fc18c659814c078378d</a></p>\n\n<p>My question is: How should I pass around this variable to different packages?</p>\n\n<p>For example if I have a package called User like this:</p>\n\n<pre><code>package user\n\nimport \"errors\"\n\nvar userNotFound = errors.New(\"User was not found.\")\n\n// Should I have a pointer to sql.DB as a property of the User type?\ntype User struct {\n    // db *sql.DB\n    Id       int\n    Email    string\n    Username string\n}\n\n// Should I pass in *sql.DB as parameter in the function?\nfunc FindById(id int) (*User, error) {\n    // Access *sql.DB somehow\n\n    // Do query and look if user with id is found\n\n    // Should I return an error if the user is not found?\n    return &amp;User{}, nil\n}\n</code></pre>\n\n<p>Should I then have a pointer to sql.DB as property of the User type?\nOr should I pass a pointer to it in the findById method?</p>\n\n<p>If I want to find a user by it's id, how should I do all this from a main function like below?</p>\n\n<pre><code>func getUserById(db *sql.DB) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n        fmt.Fprint(w, ps.ByName(\"id\"))\n\n        // I will create a new(User) here, how should I use the *sql.DB in the user package?\n    }\n}\n\nfunc main() {\n\n    dsn := fmt.Sprintf(\"%s:%s@%s(%s:%s)/%s?charset=utf8\",\n        cfg.DbUser, cfg.DbPass, cfg.DbProtocol, cfg.DbAddress, cfg.DbPort, cfg.DbName)\n\n    db, err := sql.Open(\"mysql\", dsn)\n    err = db.Ping()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    router := httprouter.New()\n    router.GET(\"/api/user/:id\", getUserById(db))\n    router.NotFound = &amp;DefaultHandler{}\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n\n<p>How should I this? What is a good preferred way, or kind of a best practice?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 621, "user_id": 3758505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ac686fa8f23c2781ca23f0790c8739e?s=128&d=identicon&r=PG&f=1", "display_name": "Gustavo Bittencourt", "link": "https://stackoverflow.com/users/3758505/gustavo-bittencourt"}, "is_accepted": true, "score": 6, "last_activity_date": 1441361094, "last_edit_date": 1441361094, "creation_date": 1441332918, "answer_id": 32389085, "question_id": 32388777, "link": "https://stackoverflow.com/questions/32388777/error-when-creating-a-template-and-then-parsing-from-files/32389085#32389085", "title": "Error when creating a template and then parsing from files", "body": "<p>I found the problem. According the <a href=\"http://golang.org/pkg/text/template/#Template.ParseFiles\" rel=\"noreferrer\">package documentation</a>, the template should usually have the name of one of the names of the files.</p>\n\n<p><strong>Corrected code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"text/template\"\n)\n\nfunc main() {\n    t1 := template.New(\"test.tmpl\")\n    t2 := template.Must(t1.ParseFiles(\"test.tmpl\"))\n    err := t2.Execute(os.Stdout, nil)\n    if err != nil {\n        log.Println(\"error: \", err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 621, "user_id": 3758505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ac686fa8f23c2781ca23f0790c8739e?s=128&d=identicon&r=PG&f=1", "display_name": "Gustavo Bittencourt", "link": "https://stackoverflow.com/users/3758505/gustavo-bittencourt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 974, "favorite_count": 0, "accepted_answer_id": 32389085, "answer_count": 1, "score": 0, "last_activity_date": 1441361094, "creation_date": 1441330154, "last_edit_date": 1441331610, "question_id": 32388777, "link": "https://stackoverflow.com/questions/32388777/error-when-creating-a-template-and-then-parsing-from-files", "title": "Error when creating a template and then parsing from files", "body": "<p>I don't know if I made some mistake or hit a golang's bug. The following code does not work as I expect and returns:  </p>\n\n<ul>\n<li><em>error:  template: name: \"name\" is an incomplete or empty template; defined templates are: \"test.tmpl\"</em></li>\n</ul>\n\n<hr>\n\n<p><strong>test.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"text/template\"\n)\n\nfunc main() {\n    t1 := template.New(\"name\")\n    t2 := template.Must(t1.ParseFiles(\"test.tmpl\"))\n    err := t2.Execute(os.Stdout, nil)\n    if err != nil {\n        log.Println(\"error: \", err)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p><strong>test.tmpl</strong></p>\n\n<pre><code>{{\"\\\"test ok\\\"\"}}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 3, "last_activity_date": 1441327976, "creation_date": 1441327976, "answer_id": 32387586, "question_id": 32387502, "link": "https://stackoverflow.com/questions/32387502/why-does-defer-stmnt-close-seem-to-block-my-http-redirect/32387586#32387586", "title": "Why does defer stmnt.Close() seem to block my http.Redirect?", "body": "<p>Use <code>db.Exec</code> instead of <code>db.Query</code>.</p>\n\n<blockquote>\n  <p>Exec executes a query without returning any rows.</p>\n</blockquote>\n\n<p>vs</p>\n\n<blockquote>\n  <p>Query executes a query that returns rows</p>\n</blockquote>\n\n<p>As for why, I would guess the mysql <code>Rows.Close</code> is waiting for data <a href=\"https://github.com/go-sql-driver/mysql/blob/master/rows.go#L57\" rel=\"nofollow\">on the connection</a>:</p>\n\n<pre><code>func (rows *mysqlRows) Close() error {\n    mc := rows.mc\n    if mc == nil {\n        return nil\n    }\n    if mc.netConn == nil {\n        return ErrInvalidConn\n    }\n\n    // Remove unread packets from stream\n    err := mc.readUntilEOF()\n    rows.mc = nil\n    return err\n}\n</code></pre>\n\n<p>Which is never going to happen.</p>\n\n<p>See <a href=\"https://github.com/go-sql-driver/mysql/pull/255\" rel=\"nofollow\">this</a> for example.</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 32387586, "answer_count": 1, "score": 0, "last_activity_date": 1441327976, "creation_date": 1441327176, "question_id": 32387502, "link": "https://stackoverflow.com/questions/32387502/why-does-defer-stmnt-close-seem-to-block-my-http-redirect", "title": "Why does defer stmnt.Close() seem to block my http.Redirect?", "body": "<p>Why does my <code>defer stmnt.Close()</code> seem to block my <code>http.Redirect</code> from redirecting it just hangs on the website infinitely trying to load.</p>\n\n<p>But if I remove the <code>defer stmnt.Close()</code> it redirects just fine?</p>\n\n<pre><code>    err = db.QueryRow(\"SELECT steamid FROM accounts WHERE steamid = ?\", ids).Scan(&amp;steamid)\n    if err != nil {\n        common.WriteLog(err.Error(), r)\n        http.Error(w, \"Failed to connect to database. Try again in a bit.\", 500)\n    }\n\n    switch {\n    case len(profile.Response.Players) == 0:\n        common.WriteLog(\"Failed to look you up in the steam database. Try again in a bit.\", r)\n        http.Error(w, \"Failed to look you up in the steam database. Try again in a bit.\", 500)\n    case err == sql.ErrNoRows:\n        stmnt, err := db.Query(\"INSERT INTO accounts SET steamid=?\", ids)\n        if err != nil {\n            common.WriteLog(err.Error(), r)\n            http.Error(w, \"Failed to insert your account to the database. Try again in a bit.\", 500)\n        }\n        defer stmnt.Close() // &lt;&lt;&lt;&lt;&lt; The suspect\n        // Insert Account\n\n        http.Redirect(w, r, \"/\", 303)\n    case err != nil:\n        common.WriteLog(err.Error(), r)\n        http.Error(w, \"Failed to insert your account to the database. Try again in a bit.\", 500)\n\n    default:\n        // Login User\n\n        http.Redirect(w, r, \"/\", 303)\n\n    }\n</code></pre>\n"}, {"tags": ["go", "go-html-template"], "comments": [{"owner": {"reputation": 240688, "user_id": 14955, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/5DblQ.png?s=128&g=1", "display_name": "Thilo", "link": "https://stackoverflow.com/users/14955/thilo"}, "edited": false, "score": 0, "creation_date": 1441326707, "post_id": 32387427, "comment_id": 52645140, "body": "You could have your program list all the HTML files in that directory, and pass the resulting list to <code>ParseFiles</code>."}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1441341646, "post_id": 32387505, "comment_id": 52649332, "body": "In addition to using <code>ParseGlob</code> you can also build a map or slice of templates using <code>filepath.Walk</code> if your requirements don&#39;t fit globbing."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1441327193, "creation_date": 1441327193, "answer_id": 32387505, "question_id": 32387427, "link": "https://stackoverflow.com/questions/32387427/what-is-the-best-way-to-call-template-parsefiles-dynamically-in-go-instead-of/32387505#32387505", "title": "What is the best way to call template.ParseFiles() dynamically in Go instead of passing in x number of strings?", "body": "<p>Use <a href=\"http://godoc.org/html/template#ParseGlob\" rel=\"nofollow\">ParseGlob</a> to parse a folder of HTML templates in one API call.</p>\n\n<pre><code>templates = template.Must(template.ParseGlob(\"../web/html_templates/*.html\"))\n</code></pre>\n\n<p>See the <a href=\"http://godoc.org/path/filepath#Match\" rel=\"nofollow\">Match</a> function documentation for the glob syntax.</p>\n"}, {"tags": [], "owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "is_accepted": false, "score": 3, "last_activity_date": 1441328578, "creation_date": 1441328578, "answer_id": 32387650, "question_id": 32387427, "link": "https://stackoverflow.com/questions/32387427/what-is-the-best-way-to-call-template-parsefiles-dynamically-in-go-instead-of/32387650#32387650", "title": "What is the best way to call template.ParseFiles() dynamically in Go instead of passing in x number of strings?", "body": "<p>You could use the fact that <a href=\"https://golang.org/pkg/text/template/#ParseFiles\" rel=\"nofollow\">template.ParseFiles</a> is a <a href=\"https://gobyexample.com/variadic-functions\" rel=\"nofollow\">variadic function</a> :</p>\n\n<pre><code>var templatesFiles []string\n// [...]\n// Here fill the slice from your config file or any other source\n// [...]\ntemplates = template.Must(template.ParseFiles(templatesFiles...))\n</code></pre>\n"}], "owner": {"reputation": 178, "user_id": 2099971, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ee26f7a1e5c40283aaf5e0f4a564bec6?s=128&d=identicon&r=PG", "display_name": "mbridges", "link": "https://stackoverflow.com/users/2099971/mbridges"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1037, "favorite_count": 0, "accepted_answer_id": 32387505, "answer_count": 2, "score": 0, "last_activity_date": 1441328578, "creation_date": 1441326470, "question_id": 32387427, "link": "https://stackoverflow.com/questions/32387427/what-is-the-best-way-to-call-template-parsefiles-dynamically-in-go-instead-of", "title": "What is the best way to call template.ParseFiles() dynamically in Go instead of passing in x number of strings?", "body": "<p>I want to load a folder of HTML templates in Go and right now I can only pass in each file path as a string in an argument. </p>\n\n<p>Example:</p>\n\n<pre><code>templates = template.Must(template.ParseFiles(\"../web/html_templates/edit.html\",\"../web/html_mplates/view.html\"))\n</code></pre>\n\n<p>Works fine. </p>\n\n<p>This and similar solutions won't work:</p>\n\n<pre><code>templates = template.Must(template.ParseFiles(\"../web/html_templates/*\"))\n</code></pre>\n\n<p>I'd like to specify my templates in a config file but I currently can't. What's the best way to go about this?</p>\n"}, {"tags": ["http", "nginx", "go", "proxy", "reverse-proxy"], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 1, "last_activity_date": 1441319709, "creation_date": 1441319709, "answer_id": 32386488, "question_id": 32386451, "link": "https://stackoverflow.com/questions/32386451/go-web-server-with-nginx-server-in-web-application/32386488#32386488", "title": "Go web server with nginx server in web application", "body": "<p>The general idea of using nginx in this scenario is to serve up static resources via nginx and allow Go to handle everything else.</p>\n\n<p>Search for \"try_files\" in nginx.  It allows for checking the disk for the existence of a file and serving it directly instead of having to handle static assets in the Go app.</p>\n"}, {"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1441326127, "post_id": 32386788, "comment_id": 52645039, "body": "Good answer. Go can do a lot of this too, but you (as a developer) or your team need to decide where to draw the line on &quot;writing stuff to suit our precise purposes&quot; vs. &quot;nginx does this for us already&quot;. nginx/HAProxy/Varnish are well tested tools and can save you reinventing several wheels."}], "tags": [], "owner": {"reputation": 94522, "user_id": 7595, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/99108829176dfbbc5d0bf3c041542a26?s=128&d=identicon&r=PG", "display_name": "Pablo Fernandez", "link": "https://stackoverflow.com/users/7595/pablo-fernandez"}, "is_accepted": true, "score": 6, "last_activity_date": 1441321700, "creation_date": 1441321700, "answer_id": 32386788, "question_id": 32386451, "link": "https://stackoverflow.com/questions/32386451/go-web-server-with-nginx-server-in-web-application/32386788#32386788", "title": "Go web server with nginx server in web application", "body": "<p>There's nothing stopping you from serving requests from Go directly.</p>\n\n<p>On the other hand, there are some features that nginx provides out-of-the box that may be useful, for example:</p>\n\n<ul>\n<li><p>handle many virtual servers (e.g. have go respond on <code>app.example.com</code> and a different app on <code>www.example.com</code>)</p></li>\n<li><p>http basic auth in some paths, say www.example.com/secure</p></li>\n<li><p>access logs</p></li>\n<li>etc</li>\n</ul>\n\n<p>All of this can be done in go but would require programming, while in nginx it's just a matter of editing a <code>.conf</code> file and reloading the configuration. Nginx doesn't even need a restart for this changes to take place.</p>\n\n<p>(From a \"process\" point of view, nginx could be managed by an ops employee, with root permissions, running in a well known port, while developers deploy their apps on higher ones.)</p>\n"}, {"comments": [{"owner": {"reputation": 581, "user_id": 2004580, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B8TbS.jpg?s=128&g=1", "display_name": "dbra", "link": "https://stackoverflow.com/users/2004580/dbra"}, "edited": false, "score": 1, "creation_date": 1441328618, "post_id": 32387374, "comment_id": 52645516, "body": "Another useful feature of nginx is the easy balancing."}], "tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": false, "score": 1, "last_activity_date": 1441325966, "last_edit_date": 1495540386, "creation_date": 1441325966, "answer_id": 32387374, "question_id": 32386451, "link": "https://stackoverflow.com/questions/32386451/go-web-server-with-nginx-server-in-web-application/32387374#32387374", "title": "Go web server with nginx server in web application", "body": "<p>This has been asked a few times before[<a href=\"https://stackoverflow.com/questions/17776584/webserver-for-go-golang-webservices-using-nginx-or-not/17777630#17777630\">1</a>] but for posterity:</p>\n\n<blockquote>\n  <p>It depends.</p>\n  \n  <p>Out of the box, putting nginx in front as a reverse proxy is going to\n  give you:</p>\n  \n  <ul>\n  <li>Access logs</li>\n  <li>Error logs</li>\n  <li>Easy SSL termination</li>\n  <li>SPDY support</li>\n  <li>gzip support</li>\n  <li>Easy ways to set HTTP headers for certain routes in a couple of lines</li>\n  <li>Very fast static asset serving (if you're serving off S3/etc. though, this isn't that relevant)</li>\n  </ul>\n  \n  <p>The Go HTTP server is very good, but you <em>will</em> need to reinvent the\n  wheel to do some of these things (which is fine: it's not meant to be\n  everything to everyone).</p>\n  \n  <p>I've always found it easier to put nginx in front\u2014which is what it is\n  good at\u2014and let it do the \"web server\" stuff. My Go application does\n  the application stuff, and only the bare minimum of headers/etc. that\n  it needs to. Don't look at putting nginx in front as a \"bad\" thing.</p>\n</blockquote>\n\n<p>Further, to extend on my answer there, there's also the question of crash resilience: your Go application isn't restricted by a configuration language and can do a <em>lot</em> of things.</p>\n\n<p>Some of these things may crash your program. Having nginx (or HAProxy, or Varnish, etc.) as a reverse proxy can give you a some request buffering (to allow your program to restart) and/or serve stale content from its local cache (i.e. your static home page), which may be better than having the browser time out and serve a \"cannot connect to server error\".</p>\n\n<p>On the other hand, if you're building small internal services, 'naked' Go web servers with your own logging library can be easier to manage (in terms of ops).</p>\n\n<p>If you <em>do</em> want to keep everything in your Go program, look at <a href=\"https://github.com/gorilla/handlers\" rel=\"nofollow noreferrer\">gorilla/handlers</a> for gzip, logging and proxy header middleware, and <a href=\"https://github.com/natefinch/lumberjack\" rel=\"nofollow noreferrer\">lumberjack</a> for log rotation (else you can use your system's logging tools).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1332, "favorite_count": 0, "closed_date": 1441333758, "accepted_answer_id": 32386788, "answer_count": 3, "score": 4, "last_activity_date": 1441325966, "creation_date": 1441319516, "question_id": 32386451, "link": "https://stackoverflow.com/questions/32386451/go-web-server-with-nginx-server-in-web-application", "closed_reason": "Duplicate", "title": "Go web server with nginx server in web application", "body": "<p>Sorry, I cannot find this answer from Google search\nand nobody seems to explain clearly the difference between pure Go webserver\nand nginx reverse proxy. Everybody seems to use nginx in front\nfor web applications.</p>\n\n<p>My question is, while Go has all http serving functions,\nwhat is the benefit of using nginx over pure Go web servers?</p>\n\n<p>And in most cases, we set up the Go webserver for all routes here\nand have the nginx configurations in front.</p>\n\n<p>Something like:</p>\n\n<pre><code>limit_req_zone $binary_remote_addr zone=limit:10m rate=2r/s;\n\nserver {\n    listen 80;\n\n    log_format lf '[$time_local] $remote_addr ;\n\n    access_log /var/log/nginx/access.log lf;\n    error_log /var/log/nginx/error.log;\n\n    set_real_ip_from 0.0.0.0/0;\n    real_ip_header X-Forwarded-For;\n    real_ip_recursive on;\n    server_name 1.2.3.4 mywebsite.com;\n}\n</code></pre>\n\n<p>When we have this Go:</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p><strong>Are the traffic to nginx and Go web server different?\nIf not, why do we have two layers of web server?</strong></p>\n\n<p>Please help me understand this.</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["go", "gokogiri"], "comments": [{"owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 0, "creation_date": 1441308175, "post_id": 32383662, "comment_id": 52638237, "body": "have you seen <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow noreferrer\">github.com/PuerkitoBio/goquery</a> ? maybe is a good alternative to what you try to achieve. It def. is easier to use."}, {"owner": {"reputation": 2200, "user_id": 513536, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c454086b558236682f7ed0e7652cfd50?s=128&d=identicon&r=PG", "display_name": "David Oliver", "link": "https://stackoverflow.com/users/513536/david-oliver"}, "reply_to_user": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 0, "creation_date": 1441308289, "post_id": 32383662, "comment_id": 52638296, "body": "I have, but having got this far with gokogiri I&#39;d prefer to find out how to do the last bit and convert to string. Plus I&#39;d like to know how to use XPath for real projects in future. But thanks - I&#39;ll keep that alternative in mind."}, {"owner": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 1, "creation_date": 1441308902, "post_id": 32383662, "comment_id": 52638634, "body": "Sure, understandable. What does <code>postTitleRes[0]</code> returns?"}, {"owner": {"reputation": 2200, "user_id": 513536, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c454086b558236682f7ed0e7652cfd50?s=128&d=identicon&r=PG", "display_name": "David Oliver", "link": "https://stackoverflow.com/users/513536/david-oliver"}, "reply_to_user": {"reputation": 2337, "user_id": 600061, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bbac8bb4d3ffbceca42b09eb0729e63c?s=128&d=identicon&r=PG", "display_name": "Twisted1919", "link": "https://stackoverflow.com/users/600061/twisted1919"}, "edited": false, "score": 0, "creation_date": 1441309370, "post_id": 32383662, "comment_id": 52638898, "body": "It returns a <code>*xml.TextNode</code>, which I <i>can</i> call <code>String()</code> on! Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 533, "user_id": 771564, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49bd4c92dcc00d019e3f6a2a858b803f?s=128&d=identicon&r=PG", "display_name": "Peter Mellett", "link": "https://stackoverflow.com/users/771564/peter-mellett"}, "is_accepted": true, "score": 0, "last_activity_date": 1441309344, "creation_date": 1441309344, "answer_id": 32384168, "question_id": 32383662, "link": "https://stackoverflow.com/questions/32383662/how-can-i-convert-a-text-node-to-a-string-in-go-with-gokogiri/32384168#32384168", "title": "How can I convert a text node to a string in Go with Gokogiri?", "body": "<p>You've got an array of xml.Node structs there. You would need to access the nodes contained in that array.</p>\n\n<p>If you're sure you have one element then you can</p>\n\n<pre><code>postTitleRes[0].Content()\n</code></pre>\n\n<p>or to capture all of those nodes:</p>\n\n<pre><code>for _, node := range postTitleRes {\n    fmt.Printf(\"%T: %v\\n\", node, node.Content())\n}\n</code></pre>\n\n<p>You can see that the <code>Content</code> function should be available to you once you have a singular xml.Node. <a href=\"https://github.com/moovweb/gokogiri/blob/master/xml/node.go#L848\" rel=\"nofollow\">Definition</a>.</p>\n"}], "owner": {"reputation": 2200, "user_id": 513536, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/c454086b558236682f7ed0e7652cfd50?s=128&d=identicon&r=PG", "display_name": "David Oliver", "link": "https://stackoverflow.com/users/513536/david-oliver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 403, "favorite_count": 0, "accepted_answer_id": 32384168, "answer_count": 1, "score": 1, "last_activity_date": 1441309344, "creation_date": 1441307473, "last_edit_date": 1441308494, "question_id": 32383662, "link": "https://stackoverflow.com/questions/32383662/how-can-i-convert-a-text-node-to-a-string-in-go-with-gokogiri", "title": "How can I convert a text node to a string in Go with Gokogiri?", "body": "<p>For my first programming attempt with Go I'm trying to automate the downloading of the lovely wallpapers from <a href=\"http://psiupuxa3.webflow.io/\" rel=\"nofollow\">Psiu Puxa</a>, saving the images with filenames based on titles in the posts in the HTML.</p>\n\n<p>However, I haven't found how to get the value of a text node as a string.</p>\n\n<p>Example HTML, simplified:</p>\n\n<pre><code>&lt;div class=\"post\"&gt;\n    &lt;a class=\"w-inline-block post-name-link\" href=\"/posts/mars-30\"&gt;\n        &lt;h4&gt;#80 Martian Landscape&lt;/h4&gt;\n    &lt;/a&gt;\n&lt;/div&gt;\n&lt;div class=\"post\"&gt;\n    &lt;a class=\"w-inline-block post-name-link\" href=\"#\"&gt;\n        &lt;h4&gt;&lt;strong&gt;#79 MARTIAN terrain&lt;/strong&gt;&lt;/h4&gt;\n    &lt;/a&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>My Go package:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"io/ioutil\"\n    \"github.com/moovweb/gokogiri\"\n)\n\nfunc main() {\n    resp, _ := http.Get(\"http://psiupuxa3.webflow.io/\")\n    page, _ := ioutil.ReadAll(resp.Body)\n    resp.Body.Close()\n\n    doc, _ := gokogiri.ParseHtml(page)\n    res, _ := doc.Search(\"//div[@class='post']\")\n    defer doc.Free()\n\n    for i := range res {\n        postTitleRes, _ := res[i].Search(\"a[contains(@class,'post-name-link')]//text()\")\n        fmt.Printf(\"%T: %v\\n\", postTitleRes, postTitleRes)\n    }\n\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>[]xml.Node: [#80 Martian Landscape]\n[]xml.Node: [#79 MARTIAN terrain]\n[]xml.Node: [#78 MARTIAN TERRAIN]\n</code></pre>\n\n<p>How can I obtain <code>#79 MARTIAN terrain</code>, etc., as strings for later use when saving files?</p>\n\n<p>I've tried <code>postTitle := postTitleRes.String()</code> but the method apparently isn't available for <code>xml.Node</code>. I've spent some time looking through Gokogiri's source code and have found methods/instructions on coercing to strings, but I'm quite lost and would appreciate any pointers.</p>\n"}, {"tags": ["go", "concurrency", "shutdown", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "edited": false, "score": 0, "creation_date": 1441317683, "post_id": 32383382, "comment_id": 52642837, "body": "Thank you for answering my question.  Icza got in first, so I have to accept his answer.  Definitely upvoting yours too."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 5, "last_activity_date": 1441311204, "last_edit_date": 1441311204, "creation_date": 1441306493, "answer_id": 32383382, "question_id": 32383063, "link": "https://stackoverflow.com/questions/32383063/shutdown-worker-go-routine-after-buffer-is-empty/32383382#32383382", "title": "Shutdown &quot;worker&quot; go routine after buffer is empty", "body": "<p>It's usually a bad idea to have a consumer of a channel close it, since sending on a closed channel is a panic.</p>\n\n<p>In this case, if you never want to interrupt the consumer before all messages have been sent, just use a <code>for...range</code> loop and close the channel when you're done. You will also need a signal like a <code>WaitGroup</code> to wait for the goroutine to finish (rather than using time.Sleep)</p>\n\n<p><a href=\"http://play.golang.org/p/r97vRPsxEb\" rel=\"nofollow\">http://play.golang.org/p/r97vRPsxEb</a></p>\n\n<pre><code>var wg sync.WaitGroup\n\nfunc ProcessToDo(todo chan string) {\n    defer wg.Done()\n    for work := range todo {\n        fmt.Printf(\"todo: %q\\n\", work)\n        time.Sleep(100 * time.Millisecond)\n\n    }\n    fmt.Printf(\"Shutting down ProcessToDo - todo channel closed!\\n\")\n\n}\n\nfunc main() {\n    todo := make(chan string, 100)\n    wg.Add(1)\n    go ProcessToDo(todo)\n\n    for i := 0; i &lt; 20; i++ {\n        todo &lt;- fmt.Sprintf(\"Message %02d\", i)\n    }\n\n    fmt.Println(\"*** all messages queued ***\")\n    close(todo)\n    wg.Wait()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "edited": false, "score": 1, "creation_date": 1441317623, "post_id": 32383393, "comment_id": 52642817, "body": "Fantastic!  Thanks.  The more I use Go, and the more I learn about it, the more I like it.  Very elegant, very simple.  Thanks again for your very thorough and helpful answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1471849975, "last_edit_date": 1495542794, "creation_date": 1441306533, "answer_id": 32383393, "question_id": 32383063, "link": "https://stackoverflow.com/questions/32383063/shutdown-worker-go-routine-after-buffer-is-empty/32383393#32383393", "title": "Shutdown &quot;worker&quot; go routine after buffer is empty", "body": "<p><code>done</code> channel in your case is completely unnecessary as you can signal the shutdown by closing the <code>todo</code> channel itself.</p>\n\n<p>And use the <code>for range</code> on the channel which will iterate until the channel is closed and its buffer is empty.</p>\n\n<p>You should have a <code>done</code> channel, but only so that the goroutine itself can signal that it finished work and so the main goroutine can continue or exit.</p>\n\n<p>This variant is equivalent to yours, is much simpler and does not require <code>time.Sleep()</code> calls to wait other goroutines (which would be too erroneous and undeterministic anyway). Try it on the <a href=\"http://play.golang.org/p/UbiQuODHZT\" rel=\"nofollow noreferrer\">Go Playground</a>:</p>\n\n<pre><code>func ProcessToDo(done chan struct{}, todo chan string) {\n    for work := range todo {\n        fmt.Printf(\"todo: %q\\n\", work)\n        time.Sleep(100 * time.Millisecond)\n    }\n    fmt.Printf(\"Shutting down ProcessToDo - todo channel closed!\\n\")\n    done &lt;- struct{}{} // Signal that we processed all jobs\n}\n\nfunc main() {\n    done := make(chan struct{})\n    todo := make(chan string, 100)\n\n    go ProcessToDo(done, todo)\n\n    for i := 0; i &lt; 20; i++ {\n        todo &lt;- fmt.Sprintf(\"Message %02d\", i)\n    }\n\n    fmt.Println(\"*** all messages queued ***\")\n    close(todo)\n    &lt;-done // Wait until the other goroutine finishes all jobs\n}\n</code></pre>\n\n<p>Also note that worker goroutines should signal completion using <code>defer</code> so the main goroutine won't get stuck waiting for the worker if it returns in some unexpected way, or panics. So it should rather start like this:</p>\n\n<pre><code>defer func() {\n    done &lt;- struct{}{} // Signal that we processed all jobs\n}()\n</code></pre>\n\n<p>You can also use <a href=\"http://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a> to sync the main goroutine to the worker (to wait it up). In fact if you plan to use multiple worker goroutines, that is cleaner than to read multiple values from the <code>done</code> channel. Also it's simpler to signal the completion with <code>WaitGroup</code> as it has a <a href=\"http://golang.org/pkg/sync/#WaitGroup.Done\" rel=\"nofollow noreferrer\"><code>Done()</code></a> method (which is a function call) so you don't need an anonymous function:</p>\n\n<pre><code>defer wg.Done()\n</code></pre>\n\n<p>See <a href=\"https://stackoverflow.com/a/32383382/1705598\">JimB's anwser</a> for the complete example with <code>WaitGroup</code>.</p>\n\n<p>Using the <code>for range</code> is also idiomatic if you want to use multiple worker goroutines: channels are synchronized so you don't need any extra code that would synchronize access to the <code>todo</code> channel or the jobs received from it. And if you close the <code>todo</code> channel in the <code>main()</code>, that will properly signal all worker goroutines. But of course all queued jobs will be received and processed exactly once.</p>\n\n<p>Now taking the variant that uses <code>WaitGroup</code>  to make the main goroutine to wait for the worker (JimB's answer): What if you want more than 1 worker goroutine; to process your jobs concurrently (and most likely parallel)?</p>\n\n<p>The only thing you need to add / change in your code is this: to really start multiple of them:</p>\n\n<pre><code>for i := 0; i &lt; 10; i++ {\n    wg.Add(1)\n    go ProcessToDo(todo)\n}\n</code></pre>\n\n<p>Without changing anything else, you now have a correct, concurrent application which receives and processes your jobs using 10 concurrent goroutines. And we haven't used any \"ugly\" <code>time.Sleep()</code> (we used one but only to simulate slow processing, not to wait other goroutines), and you don't need any extra synchronization.</p>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 5935998, "user_type": "registered", "profile_image": "https://graph.facebook.com/10156631293995602/picture?type=large", "display_name": "Rami Kalai", "link": "https://stackoverflow.com/users/5935998/rami-kalai"}, "is_accepted": false, "score": 0, "last_activity_date": 1587665353, "creation_date": 1587665353, "answer_id": 61394123, "question_id": 32383063, "link": "https://stackoverflow.com/questions/32383063/shutdown-worker-go-routine-after-buffer-is-empty/61394123#61394123", "title": "Shutdown &quot;worker&quot; go routine after buffer is empty", "body": "<p>I think the accepted answer is pretty valid for this specific example. However to answer the question \"Shutdown \u201cworker\u201d go routine after buffer is empty\" - a more elegant solution is possible.</p>\n\n<p>The worker can just return when the buffer is empty without needing to signal by closing the channel.</p>\n\n<p>This is especially useful if the number of tasks that the worker needs to process in not known.</p>\n\n<p>Check it out here: <a href=\"https://play.golang.org/p/LZ1y0eIRMeS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LZ1y0eIRMeS</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"math/rand\"\n)\n\nfunc main() {\n    rand.Seed(time.Now().UnixNano())\n    ch := make(chan interface{}, 10)\n\n    go worker(ch)\n    for i := 1; i &lt;= rand.Intn(9) + 1; i++ {\n            ch &lt;- i\n    }\n\n    blocker := make(chan interface{})\n    &lt;-blocker\n}\n\nfunc worker(ch chan interface{}){   \n    for {\n        select {\n        case msg := &lt;- ch:\n            fmt.Println(\"msg: \", msg)\n        default:\n            fmt.Println(\"exiting worker\")\n            return\n        }\n    }       \n}\n</code></pre>\n"}], "owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1718, "favorite_count": 1, "accepted_answer_id": 32383393, "answer_count": 3, "score": 2, "last_activity_date": 1587665353, "creation_date": 1441305275, "last_edit_date": 1475439298, "question_id": 32383063, "link": "https://stackoverflow.com/questions/32383063/shutdown-worker-go-routine-after-buffer-is-empty", "title": "Shutdown &quot;worker&quot; go routine after buffer is empty", "body": "<p>I want my go routine worker (<code>ProcessToDo()</code> in the code below) to wait until all \"queued\" work is processed before shutting down.  </p>\n\n<p>The worker routine has a \"to do\" channel (buffered), through which work is sent to it.  And it has a \"done\" channel to tell it to start shutdown. The documentation says that the select on the channels will pick a \"pseudo-random value\" if more than one of the selects are met... which means the shutdown (return) is being triggered before all the buffered work is completed.  </p>\n\n<p>In the code sample below, I want all 20 messages to print... </p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"fmt\"\n)\n\n\nfunc ProcessToDo(done chan struct{}, todo chan string) {\n    for {\n        select {\n        case work, ok := &lt;-todo:\n            if !ok {\n                fmt.Printf(\"Shutting down ProcessToDo - todo channel closed!\\n\")\n                return\n            }\n            fmt.Printf(\"todo: %q\\n\", work)\n            time.Sleep(100 * time.Millisecond)\n        case _, ok := &lt;-done:\n            if ok {\n                fmt.Printf(\"Shutting down ProcessToDo - done message received!\\n\")\n            } else {\n                fmt.Printf(\"Shutting down ProcessToDo - done channel closed!\\n\")\n            }\n            close(todo)\n            return\n        }\n    }\n}\n\nfunc main() {\n\n    done := make(chan struct{})\n    todo := make(chan string, 100)\n\n    go ProcessToDo(done, todo)\n\n    for i := 0; i &lt; 20; i++ {\n        todo &lt;- fmt.Sprintf(\"Message %02d\", i)\n    }\n\n    fmt.Println(\"*** all messages queued ***\")\n    time.Sleep(1 * time.Second)\n    close(done)\n    time.Sleep(4 * time.Second)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1441302453, "post_id": 32382211, "comment_id": 52634962, "body": "No, and it would not help if there were. Redesign your solution."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1441302524, "post_id": 32382211, "comment_id": 52635007, "body": "No. What is available to use is up to the kernel, and may change at the moment you request it."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1441304631, "post_id": 32382211, "comment_id": 52636166, "body": "Also note that kernels of some popular operating systems will lie to your process about the real amount of the available memory anyway -- this is called <a href=\"https://www.google.com/search?q=linux+overcommit\" rel=\"nofollow noreferrer\">&quot;overcommitting&quot;</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1441305491, "post_id": 32382211, "comment_id": 52636678, "body": "Oh, and while we&#39;re at it, IUUC the reference Go implemetation (dubbed <code>gc</code>, that one which originates from Google -- as opposed to <code>gccgo</code> which is a part of GCC) uses the so-called &quot;arena&quot; allocation when it asks the OS to &quot;reserve&quot; a huge pile of contiguous memory and then uses this chunk for allocation -- see <a href=\"https://golang.org/src/runtime/malloc.go\" rel=\"nofollow noreferrer\">this code</a> starting from line 231. Basically that&#39;s why even small Go programs appears as using lots of <i>virtual</i> memory while they use just moderate amount of physical memory."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1441305704, "post_id": 32382211, "comment_id": 52636827, "body": "...continuing with the topic, you might consider implementing a second-order allocator for your needs (see <a href=\"http://stackoverflow.com/a/31561221/720999\">this</a> for further pointers, and don&#39;t forget to check out comments there as well) or use a ready-made one, like <a href=\"https://github.com/couchbase/go-slab\" rel=\"nofollow noreferrer\"><code>go-slab</code></a>."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1441332788, "post_id": 32385195, "comment_id": 52647250, "body": "The relationship between what <code>mem.VirtualMemory</code> reports and how big a size you can pass to <code>make</code> without it failing is tenuous at best. Also note that virtual memory is often a <i>lot</i> larger than physical memory."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1441375468, "post_id": 32385195, "comment_id": 52668223, "body": "<code>vm.Available</code> has no real bearing on whether you can allocate or not. <i>If</i> the server has no swap, and <i>if</i> the server has overcommit off, and nothing changes between the time you check and the time you request memory, and the <code>make</code> call causes the allocation arena to expand, and the kernel doesn&#39;t sacrifice another process for you in the meantime, <code>vm.Available</code> <i>might</i> correlate with running out of memory."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 0, "last_activity_date": 1441313442, "creation_date": 1441313442, "answer_id": 32385195, "question_id": 32382211, "link": "https://stackoverflow.com/questions/32382211/how-to-determine-available-memory-before-a-make-statement/32385195#32385195", "title": "How to determine available memory before a make() statement", "body": "<p>Yes there is. You can use the <a href=\"https://godoc.org/github.com/shirou/gopsutil/mem\" rel=\"nofollow\">gopsutil</a> package:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/shirou/gopsutil/mem\"\n)\n\nfunc main() {\n    vm, err := mem.VirtualMemory()\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"Total:%d, Available:%d, Used:%d\", vm.Total, vm.Available, vm.Used)\n}\n</code></pre>\n\n<p>There are also lots of ways to get this information that are OS-specific. None of them are perfect, but they'll give you something.</p>\n\n<p>You could also have Max Memory as a configuration variable and use: <a href=\"http://godoc.org/runtime#MemStats\" rel=\"nofollow\">http://godoc.org/runtime#MemStats</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 131, "user_id": 1329380, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d197c0cb5b5739c5e7b05a9f106b428e?s=128&d=identicon&r=PG", "display_name": "user1329380", "link": "https://stackoverflow.com/users/1329380/user1329380"}, "is_accepted": false, "score": 1, "last_activity_date": 1441371808, "creation_date": 1441371808, "answer_id": 32398795, "question_id": 32382211, "link": "https://stackoverflow.com/questions/32382211/how-to-determine-available-memory-before-a-make-statement/32398795#32398795", "title": "How to determine available memory before a make() statement", "body": "<p>Thank you for all your input.</p>\n\n<p>I have decided to use a Max_Memory configuration option, since the use case for this is to utilize n Megabytes of memory up to about 75% max available, on test servers, which are only running this application, as a way to trigger autoscaling in a test environment.</p>\n"}], "owner": {"reputation": 131, "user_id": 1329380, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d197c0cb5b5739c5e7b05a9f106b428e?s=128&d=identicon&r=PG", "display_name": "user1329380", "link": "https://stackoverflow.com/users/1329380/user1329380"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1441371808, "creation_date": 1441302173, "last_edit_date": 1441304663, "question_id": 32382211, "link": "https://stackoverflow.com/questions/32382211/how-to-determine-available-memory-before-a-make-statement", "title": "How to determine available memory before a make() statement", "body": "<p>In Go, when using a make statement,\nfor example, allocating megabytes of memory</p>\n\n<pre><code>    make([]byte, 1024*1024*d)\n</code></pre>\n\n<p>Is there a way to determine how much memory is free, before asking for more memory?</p>\n"}]