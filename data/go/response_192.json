[{"tags": ["go", "godeps"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1536798268, "post_id": 52303228, "comment_id": 91557597, "body": "What happens if you compile the <code>ma</code> package instead of the <code>*.go</code> files: <code>go build .&#47;ma</code>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1536802656, "post_id": 52303228, "comment_id": 91558323, "body": "An underscore usually indicates that you&#39;re not working correctly with GOPATH. Are all your packages correctly located in GOPATH? Can you build you package by it&#39;s import name? You shouldn&#39;t be building a collection of files like <code>ma&#47;*.go</code>, you should be building a package."}, {"owner": {"reputation": 10643, "user_id": 448579, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a666a08c628484266cf0d5411df91038?s=128&d=identicon&r=PG", "display_name": "Parris Varney", "link": "https://stackoverflow.com/users/448579/parris-varney"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1536841028, "post_id": 52303228, "comment_id": 91574113, "body": "@MartinTournoij @JimB building the package instead of collection by removing the <code>&#47;*.go</code> bit seems to have done the trick.  Thanks!"}], "owner": {"reputation": 10643, "user_id": 448579, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a666a08c628484266cf0d5411df91038?s=128&d=identicon&r=PG", "display_name": "Parris Varney", "link": "https://stackoverflow.com/users/448579/parris-varney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 126, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1536785129, "creation_date": 1536785129, "question_id": 52303228, "link": "https://stackoverflow.com/questions/52303228/gopath-duplicating-path-with-underscore-with-dep-packages", "title": "GOPATH duplicating path with underscore with dep packages", "body": "<p>My <code>GOPATH</code> is /Users/admin/go/marketing</p>\n\n<p>Running <code>dep ensure</code> then <code>go build -ldflags=\"-s -w\" -o bin/ma ma/*.go</code> creates the following error.</p>\n\n<pre><code>../database-helpers/database-drivers.go:5:2: cannot find package \"_/Users/admin/go/marketing/src/gitlab.myrepo.com/ma/database-helpers/vendor/github.com/denisenkom/go-mssqldb\" in any of: /Users/admin/go/marketing/src/_/Users/admin/go/marketing/src/gitlab.myrepo.com/ma/database-helpers/vendor/github.com/denisenkom/go-mssqldb (from $GOPATH)\n</code></pre>\n\n<p>The directory definitely exists if you exclude the underscore and everything before.</p>\n\n<pre><code>ls /Users/admin/go/marketing/src/gitlab.myrepo.com/ma/database-helpers/vendor/github.com/denisenkom/go-mssqldb\nLICENSE.txt     bulkcopy.go     doc.go          mssql.go        net.go          sspi_windows.go     tran.go\nREADME.md       bulkcopy_sql.go     error.go        mssql_go110.go      ntlm.go         tds.go          types.go\nappveyor.yml        convert.go      internal        mssql_go19.go       parser.go       token.go        uniqueidentifier.go\nbuf.go          decimal.go      log.go          mssql_go19pre.go    rpc.go          token_string.go\n</code></pre>\n\n<p>Any ideas on what I'm doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1215, "user_id": 10007682, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OQ0dG.png?s=128&g=1", "display_name": "Dylan", "link": "https://stackoverflow.com/users/10007682/dylan"}, "edited": false, "score": 0, "creation_date": 1536784056, "post_id": 52302831, "comment_id": 91553678, "body": "llgo was not used to compile go to LLVM. It was a tool <b>written in go</b> to use LLVM."}], "answers": [{"tags": [], "owner": {"reputation": 1215, "user_id": 10007682, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OQ0dG.png?s=128&g=1", "display_name": "Dylan", "link": "https://stackoverflow.com/users/10007682/dylan"}, "is_accepted": false, "score": 2, "last_activity_date": 1536784165, "creation_date": 1536784165, "answer_id": 52302997, "question_id": 52302831, "link": "https://stackoverflow.com/questions/52302831/is-it-possible-to-compile-go-programs-to-llvm-ir/52302997#52302997", "title": "Is it possible to compile Go programs to LLVM IR?", "body": "<p><a href=\"https://go.googlesource.com/gollvm\" rel=\"nofollow noreferrer\">GOLLVM</a> is still being maintained, It is stable and its latest commit was in August. Therefore the project is not dead.</p>\n\n<p>However, it only targets x64 Linux right now. So your application would not run on macOS or Windows.</p>\n"}], "owner": {"reputation": 81, "user_id": 8659809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef07701b94b6712def25667e263422f?s=128&d=identicon&r=PG&f=1", "display_name": "grafix", "link": "https://stackoverflow.com/users/8659809/grafix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1065, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1536784165, "creation_date": 1536783392, "last_edit_date": 1536783686, "question_id": 52302831, "link": "https://stackoverflow.com/questions/52302831/is-it-possible-to-compile-go-programs-to-llvm-ir", "title": "Is it possible to compile Go programs to LLVM IR?", "body": "<p>I found this project: \n<a href=\"https://github.com/go-llvm/llgo\" rel=\"nofollow noreferrer\">https://github.com/go-llvm/llgo</a>.<br>\nBut the last commit was almost 4 years ago and they mention:</p>\n\n<blockquote>\n  <p>This project has moved to llvm.org. Any contributions or bug reports should be sent there. Please refer to the llgo readme for more information</p>\n</blockquote>\n\n<p>So is it unusable for today's programs?</p>\n\n<p>Another project is:\n<a href=\"https://go.googlesource.com/gollvm\" rel=\"nofollow noreferrer\">https://go.googlesource.com/gollvm</a>.<br>\nBut according to their website, it is still in development. But is it stable enough to use it now and will it be developed further?</p>\n\n<blockquote>\n  <p>Gollvm is currently in development -- releases are not yet available for download. Instructions for building gollvm follow. </p>\n</blockquote>\n\n<p>Are there any other projects or ways to compile Go to LLVM IR, or is it not possible yet?</p>\n"}, {"tags": ["go", "pprof"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1536785723, "post_id": 52302692, "comment_id": 91554355, "body": "<code>go tool pprof</code> isn&#39;t for running your application, it&#39;s for analyzing profiler data. The binary passed to it is to allow it to analyze the profile and associate profiler data with instructions in the binary. So, you cannot pass parameters to your executable this way because it isn&#39;t running your executable in the first place."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1536785850, "post_id": 52302692, "comment_id": 91554401, "body": "<a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">This Go blog post</a>, as well as the rest of the Go documentation regarding pprof and profiling (eg <a href=\"https://golang.org/pkg/runtime/pprof/\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime/pprof</a> and <a href=\"https://golang.org/pkg/net/http/pprof/\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/pprof</a>), provide a wealth of information on how pprof works and how to profile Go programs."}, {"owner": {"reputation": 85078, "user_id": 31610, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/20571f32acd27d2cf5f1b1f42ea1a75b?s=128&d=identicon&r=PG", "display_name": "Geo", "link": "https://stackoverflow.com/users/31610/geo"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536864386, "post_id": 52302692, "comment_id": 91587352, "body": "@Adrian, unfortunately, nothing I do seems to work. Always, I get something more or less similar to <code>Duration: 5.49s, Total samples = 0</code>, and <code>No samples were found with the default sample value type.</code>. The duration of course varies, and I even inserted some sleeps but I&#39;m still not getting anything out of pprof. I&#39;ve also added a code sample showing how I&#39;m creating the profile data ( taken from the docs )"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536865985, "post_id": 52302692, "comment_id": 91588092, "body": "That would seem to be a completely different question from the original question. Perhaps a new post would be appropriate."}, {"owner": {"reputation": 85078, "user_id": 31610, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/20571f32acd27d2cf5f1b1f42ea1a75b?s=128&d=identicon&r=PG", "display_name": "Geo", "link": "https://stackoverflow.com/users/31610/geo"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536867206, "post_id": 52302692, "comment_id": 91588638, "body": "@Adrian , I&#39;ve posted <a href=\"https://stackoverflow.com/questions/52320597/how-can-i-get-samples-when-running-go-with-pkg-profile-enabled\" title=\"how can i get samples when running go with pkg profile enabled\">stackoverflow.com/questions/52320597/&hellip;</a> . Could you have a look?"}, {"owner": {"reputation": 35704, "user_id": 4958, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6ca82d17e7496d3c20b9c8038f87ae49?s=128&d=identicon&r=PG", "display_name": "ShreevatsaR", "link": "https://stackoverflow.com/users/4958/shreevatsar"}, "edited": false, "score": 0, "creation_date": 1603079659, "post_id": 52302692, "comment_id": 113912388, "body": "As mentioned in the first comment, and <a href=\"https://gperftools.github.io/gperftools/cpuprofile.html\" rel=\"nofollow noreferrer\">here</a> there are a few different ways to run the profiler: after building with the profiler enabled, (1) set the environment variable CPUPROFILE, (2) set the environment variables CPUPROFILE and CPUPROFILESIGNAL, and send the corresponding signal, (3) add <code>ProfilerStart()</code> and <code>ProfilerStop()</code> in your code (before building). After this, running <code>pprof</code> is just for viewing the generated profile from the actual run."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12481905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6ed5a3e9bb422a6c96b12b776dffd8c?s=128&d=identicon&r=PG&f=1", "display_name": "mutl3y", "link": "https://stackoverflow.com/users/12481905/mutl3y"}, "is_accepted": false, "score": 0, "last_activity_date": 1575489891, "last_edit_date": 1575489891, "creation_date": 1575489579, "answer_id": 59183837, "question_id": 52302692, "link": "https://stackoverflow.com/questions/52302692/can-i-run-something-under-pprof-and-pass-it-command-line-arguments/59183837#59183837", "title": "Can I run something under pprof and pass it command line arguments?", "body": "<p>@Geo</p>\n\n<p>Had the same issue profiling a cobra command line app with pprof</p>\n\n<p>you just need to embed your flag choices in a separate main.go and call the package directly</p>\n\n<p>In my case I managed to work around this by </p>\n\n<ul>\n<li>creating another folder at top level which I added to .gitignore</li>\n<li>created package main with a func main()</li>\n</ul>\n\n<p>you will need to edit the main func for each combination you want to try but you end up with a binary you can pprof without any flags</p>\n\n<h1>the cobra command I am profiling</h1>\n\n<p><a href=\"https://github.com/mutl3y/PRTG_VMware/blob/dev1/cmd/summary.go\" rel=\"nofollow noreferrer\">https://github.com/mutl3y/PRTG_VMware/blob/dev1/cmd/summary.go</a></p>\n\n<p>my example of profiling it</p>\n\n<h1>/profiling/main.go</h1>\n\n<pre><code>package main\n\nimport (\n    \"github.com/mutl3y/PRTG_VMware/VMware\"\n    \"github.com/pkg/profile\"\n    \"log\"\n    \"net/url\"\n    \"time\"\n)\n\nfunc main() {\n    defer profile.Start().Stop()\n    u, err := url.Parse(\"https://192.168.59.4/sdk\")\n    if err != nil {\n        log.Fatalf(\"failed to parse url\")\n    }\n    c, err := VMware.NewClient(u, \"prtg@heynes.local\", \".l3tm31n\", 2*time.Second)\n    if err != nil {\n        log.Fatalf(\"failed %v\", err)\n    }\n\n    err = c.VmSummary(\"\", \"vm-13\", &amp;VMware.LimitsStruct{}, time.Second, true,[]string{})\n    if err != nil {\n        log.Fatalf(\"vmSummaryfailed %v\", err)\n\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 85078, "user_id": 31610, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/20571f32acd27d2cf5f1b1f42ea1a75b?s=128&d=identicon&r=PG", "display_name": "Geo", "link": "https://stackoverflow.com/users/31610/geo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1192, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1575489891, "creation_date": 1536782875, "last_edit_date": 1536864484, "question_id": 52302692, "link": "https://stackoverflow.com/questions/52302692/can-i-run-something-under-pprof-and-pass-it-command-line-arguments", "title": "Can I run something under pprof and pass it command line arguments?", "body": "<p>I have a go binary, which uses cobra for subcommands. Each subcommand has it's own flags. I'd like to be able to create a CPU profile for a command with a specific set of parameters, like for example:</p>\n\n<pre><code>myBinary dryRun -c configs/config.json\n</code></pre>\n\n<p>However, if I try to run it, like this:</p>\n\n<pre><code>go tool pprof -pdf myBinary -- dryRun -c configs/config.json\n</code></pre>\n\n<p>I get the following error:</p>\n\n<pre><code>-: open --: no such file or directory\ndryRun: open dryRun: no such file or directory\n-c: open -c: no such file or directory\nconfigs/config.json: parsing profile: unrecognized profile format\n</code></pre>\n\n<p>If I try to quote the entire command, it's also not working. Is there any way to get <code>go tool pprof</code> to pass other command line arguments?</p>\n\n<p>EDIT: This is how I'm trying to profile:</p>\n\n<pre><code>func main() {\n    defer profile.Start().Stop()\n\n    fmt.Println(\"running version\", version, \"built on\", date)\n    fmt.Println()\n    cmd.Execute()\n\n    time.Sleep(2 * time.Second)\n}\n</code></pre>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1536781317, "post_id": 52302275, "comment_id": 91552569, "body": "Can you give some code for context?"}, {"owner": {"reputation": 33, "user_id": 10100011, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wxxEZpvLveI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qOIkM7c9m7-Reg_7tldulibyC3fA/mo/photo.jpg?sz=128", "display_name": "Mingde Qiu", "link": "https://stackoverflow.com/users/10100011/mingde-qiu"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1536786046, "post_id": 52302275, "comment_id": 91554452, "body": "Like I need to run something like this  sq.Update(tableA). Where(&quot;id=?&quot;, tableA.ID). Set(&quot;dt_edited&quot;, &quot;NOW()&quot;)  But the code above does not work as it will treat the &quot;NOW()&quot; as string, not as a MySQL function. And I cannot use my local time, because the app container&#39;s local time is in different timezone  I tried to run Set(&quot;dt_edited=NOW()&quot;, nil) but it does not work as well, as the squirrel will translate it into &quot;dt_edited=NOW()=?&quot;"}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1536786070, "post_id": 52302275, "comment_id": 91554464, "body": "You need to be more specific than &quot;I need to run something like this&quot;."}, {"owner": {"reputation": 33, "user_id": 10100011, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wxxEZpvLveI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qOIkM7c9m7-Reg_7tldulibyC3fA/mo/photo.jpg?sz=128", "display_name": "Mingde Qiu", "link": "https://stackoverflow.com/users/10100011/mingde-qiu"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 0, "creation_date": 1536786912, "post_id": 52302275, "comment_id": 91554771, "body": "That is the issue. All of the more complicated issues can be handled without any problem. The only thing left is to run this simple update. If other data are updated, then this dt_edited field will be auto-updated by MySQL. But the issue here is that I cannot change any other fields, but I still need to have the dt_edited field to be updated with the MySQL &#39;s local time."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 10100011, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wxxEZpvLveI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qOIkM7c9m7-Reg_7tldulibyC3fA/mo/photo.jpg?sz=128", "display_name": "Mingde Qiu", "link": "https://stackoverflow.com/users/10100011/mingde-qiu"}, "edited": false, "score": 0, "creation_date": 1536846005, "post_id": 52304725, "comment_id": 91577157, "body": "it will not work as the the Squirrel&#39;s SET requires 2 parameters, have to be Set(&quot;string&quot;, interface{}). I tried to pass the interface with <code>nil</code> or just nil but it did not work. It is translated into query like <code>dt_edited=NOW() = ?</code>"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1536855409, "last_edit_date": 1536855409, "creation_date": 1536794700, "answer_id": 52304725, "question_id": 52302275, "link": "https://stackoverflow.com/questions/52302275/golang-update-set-time-now-with-squirrel/52304725#52304725", "title": "golang update set time now with squirrel", "body": "<p>I assume you're using this <a href=\"https://github.com/Masterminds/squirrel\" rel=\"nofollow noreferrer\">squirrel</a> package, next time give a link and ideally some example code. So I assume what you really want is sql like this: </p>\n\n<pre><code>update tablename set dt_edited=NOW() where id=1;\n</code></pre>\n\n<p>You could easily just build that with fmt.Sprintf safely, and execute it with the db driver directly or via sq.Exec(). </p>\n\n<pre><code>sql := fmt.Sprintf(\"update tablename set dt_edited=NOW() where id=%d\" tableA.ID)\n</code></pre>\n\n<p>Using squirrel you probably want something like: </p>\n\n<pre><code>db.Exec(update tablename set dt_edited=NOW() where id=?\",tableA.ID)\n</code></pre>\n\n<p>I'm not sure on the exact syntax but something like that should work fine, you just need a query object to send sql to. Don't attempt to send dt_edited=NOW() as a param as that will get escaped the id you can safely pass in that way.</p>\n\n<hr>\n\n<p>You\u2019re passing it as a string. Try:</p>\n\n<pre><code>Set(\"dt_edited=NOW()\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 108, "user_id": 3791259, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jI3Bq.png?s=128&g=1", "display_name": "BrushyAmoeba", "link": "https://stackoverflow.com/users/3791259/brushyamoeba"}, "is_accepted": true, "score": 7, "last_activity_date": 1546469777, "creation_date": 1546469777, "answer_id": 54014253, "question_id": 52302275, "link": "https://stackoverflow.com/questions/52302275/golang-update-set-time-now-with-squirrel/54014253#54014253", "title": "golang update set time now with squirrel", "body": "<p>Instead of <code>Set(column, \"NOW()\")</code>, you need to do <code>Set(column, sq.Expr(\"NOW()\"))</code></p>\n"}], "owner": {"reputation": 33, "user_id": 10100011, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wxxEZpvLveI/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7qOIkM7c9m7-Reg_7tldulibyC3fA/mo/photo.jpg?sz=128", "display_name": "Mingde Qiu", "link": "https://stackoverflow.com/users/10100011/mingde-qiu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1398, "favorite_count": 0, "accepted_answer_id": 54014253, "answer_count": 2, "score": 3, "last_activity_date": 1546469777, "creation_date": 1536781123, "last_edit_date": 1536847095, "question_id": 52302275, "link": "https://stackoverflow.com/questions/52302275/golang-update-set-time-now-with-squirrel", "title": "golang update set time now with squirrel", "body": "<p>Right now my container's timezone is different with MySQL's, and I need to run a query to just update the time field on MySQL to its timezone.\nNormally, I can run the query with \"edited=NOW()\", but with the Golang squirrel, it does not have a proper way to set this clause.\nI cannot change both my app and mysql container's timezone, and I just need to update the date in DB. \nIs there any way to do in Squirell properly?</p>\n"}, {"tags": ["unit-testing", "go", "testify"], "comments": [{"owner": {"reputation": 1210, "user_id": 9254201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1f2505c3de03d96aef77af3a9246e52?s=128&d=identicon&r=PG", "display_name": "Stratadox", "link": "https://stackoverflow.com/users/9254201/stratadox"}, "edited": false, "score": 0, "creation_date": 1536781836, "post_id": 52302228, "comment_id": 91552797, "body": "Not an exact answer to your question, so I&#39;ll post it as comment.. But it looks like it&#39;d be pretty easy to sidestep the problem and use a custom test double that simply raises an error in its <code>SessionRelease</code> method."}], "answers": [{"tags": [], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "is_accepted": true, "score": 0, "last_activity_date": 1536782083, "creation_date": 1536782083, "answer_id": 52302503, "question_id": 52302228, "link": "https://stackoverflow.com/questions/52302228/how-to-define-that-mock-method-gets-invoked-zero-times/52302503#52302503", "title": "How to define that mock method gets invoked zero times", "body": "<p>I feel a bit silly for this. </p>\n\n<p>The problem was that I was bothering with </p>\n\n<pre><code>sessionMock.AssertExpectations(t)\n</code></pre>\n\n<p>when I could have simply said</p>\n\n<pre><code>sessionMock.AssertNotCalled(t, \"SessionRelease\", w)\n</code></pre>\n\n<p>(Documentation on that method <a href=\"https://godoc.org/github.com/stretchr/testify/mock#Mock.AssertNotCalled\" rel=\"nofollow noreferrer\">here</a>)</p>\n\n<p>Doing the latter resolved the issue, and did exactly what I was trying to accomplish.</p>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 0, "accepted_answer_id": 52302503, "answer_count": 1, "score": 0, "last_activity_date": 1536782083, "creation_date": 1536780931, "question_id": 52302228, "link": "https://stackoverflow.com/questions/52302228/how-to-define-that-mock-method-gets-invoked-zero-times", "title": "How to define that mock method gets invoked zero times", "body": "<p>I'm trying to test the following method:</p>\n\n<pre><code>//AuthenticationMiddleware Middleware which handles all of the authentication.\nfunc AuthenticationMiddleware(context context.ContextIntf, w web.ResponseWriter, r *web.Request, next web.NextMiddlewareFunc) {\n    //Check if url is one that doesn't need authorization. If not than send them to the login page.\n    for _, url := range AuthMWInstance.GetInfo().nonAuthURLs {\n        if url.Method == r.Method &amp;&amp; strings.Contains(r.URL.Path, url.DomainName) {\n            next(w, r)\n            return\n        }\n    }\n\n    if errSt := CheckForAuthorization(context, r, w); errSt != nil {\n        responses.Write(w, responses.Unauthorized(*errSt))\n        return\n    }\n    defer context.GetInfo().Session.SessionRelease(w)\n    next(w, r)\n}\n</code></pre>\n\n<p>In this case, there's a <code>SessionRelease</code> that gets invoked iff <code>r</code> contains a URL that requires authorization, and that authorization was successful. </p>\n\n<p>It may be important to know that :</p>\n\n<pre><code>type MiddlewareSt struct {\n    //NonAuthUrls URLs that can be accessed without a token.\n    nonAuthURLs []url.URLSt\n}\n\ntype MiddlewareIntf interface {\n    GetInfo() *MiddlewareSt\n    CheckTokenAndSetSession(context context.ContextIntf, r *web.Request, w web.ResponseWriter,\n        token string, scope string, remoteAddr string) *errors.ErrorSt\n}\n\nvar AuthMWInstance MiddlewareIntf\n</code></pre>\n\n<p>and that <code>CheckForAuthorization</code>'s return value ultimately relies upon <code>AuthMWInstance</code></p>\n\n<p><strong>My Test Strategy</strong></p>\n\n<ul>\n<li>Create a stub middleware instance to initialize <code>AuthMWInstance</code> to, that simply returns <code>nil</code> for <code>CheckTokenAndSetSession</code> (with the session setting abstracted out, of course, to the creation of the stub object itself, which has the <code>Session</code>), and a <code>MiddlewareSt</code> full of fake <code>nonAuthURLs</code> for <code>GetInfo()</code></li>\n<li>Create a mock <a href=\"https://godoc.org/github.com/astaxie/beego/session#Store\" rel=\"nofollow noreferrer\"><code>session.Store</code></a> that, for all tests except the Sanity Test, expects zero calls to <code>SessionRelease</code>. </li>\n</ul>\n\n<p><em>It's probably worth noting (but assumed) that I'm using <a href=\"http://godoc.org/github.com/stretchr/testify/mock\" rel=\"nofollow noreferrer\">testify</a>,<a href=\"https://godoc.org/github.com/vektra/mockery\" rel=\"nofollow noreferrer\">mockery</a> libraries for the mocking and the assertion stuff.</em></p>\n\n<p><strong>The test</strong></p>\n\n<p>Is implemented thus:</p>\n\n<pre><code>func TestAuthenticationMiddleware(t *testing.T) {\n    // bring in the errors\n    sdkTesting.InitErrors()\n    // create/set up the test doubles\n    // mock session\n    sessionMock := new(testing_mock.MockStore)\n    // temporarily set AuthMWInstance to a stub\n    instance := AuthMWInstance\n    AuthMWInstance = &amp;StubMiddlewareInstance{\n        Session: sessionMock,\n    }\n    // AuthMWInstance.Session\n    defer func() { AuthMWInstance = instance }()\n    // fake ResponseWriter\n    w := new(StubResponseWriter)\n    // fake web requests\n    requestWithoutAuth := new(web.Request)\n    requestWithoutAuth.Request = httptest.NewRequest(\"GET\",\n        \"http://example.com/logout\",\n        nil,\n    )\n\n    // do tests here\n    t.Run(\"AuthorizationNotRequired\", func(t *testing.T) {\n        // place expectations on sessionMock, namely that it does\n        //  **not** invoke `SessionRelease`\n        sessionMock.On(\"SessionRelease\", w).\n            Times(0)\n\n        AuthenticationMiddleware(new(context.Context),\n            w,\n            requestWithoutAuth,\n            web.NextMiddlewareFunc(func(web.ResponseWriter, *web.Request) {}))\n\n        sessionMock.AssertExpectations(t)\n    })\n\n}\n</code></pre>\n\n<p><strong>Runtime behavior</strong></p>\n\n<p>The following false fail happens: <a href=\"https://i.stack.imgur.com/GgFQP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/GgFQP.png\" alt=\"enter image description here\"></a>. It's literally as if, instead of doing:</p>\n\n<pre><code>sessionMock.On(\"SessionRelease\", w).\n            Times(0)\n</code></pre>\n\n<p>, I was like:</p>\n\n<pre><code>sessionMock.On(\"SessionRelease\", w).\n            Once()\n</code></pre>\n\n<p><strong>NOTE</strong> <code>session.Store.SessionRelease</code> does not return anything, hence why I didn't even bother using <code>Return()</code>. </p>\n\n<p><strong>Am I asserting that it is to be called exactly zero times right?</strong></p>\n"}, {"tags": ["linux", "go", "makefile", "gnu-make", "gnu"], "comments": [{"owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 0, "creation_date": 1536782501, "post_id": 52302183, "comment_id": 91553037, "body": "Sorry, I don&#39;t understand.  It would be much more clear if you included the actual output of the makefile you show above, then describe clearly why that output is wrong and what output you would prefer to see.  Also it would be good to specify any special cases you need to deal with."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "reply_to_user": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 0, "creation_date": 1536783380, "post_id": 52302183, "comment_id": 91553390, "body": "@MadScientist - Done, please have a look"}, {"owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 0, "creation_date": 1536785133, "post_id": 52302183, "comment_id": 91554105, "body": "Does the output of the <code>fxt</code> program include the square brackets (<code>[]</code>)?  If you had more elements would it show <code>[app1 app2 app3 app4] is called</code>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "reply_to_user": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 0, "creation_date": 1536810578, "post_id": 52302183, "comment_id": 91559980, "body": "@MadScientist - yes exactly it looks like <code>[app1 app2 app3 appN] is called</code>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "edited": false, "score": 0, "creation_date": 1536820692, "post_id": 52303039, "comment_id": 91562977, "body": "<code>In the loop running with make: [app In the loop running with make: app2] </code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "edited": false, "score": 0, "creation_date": 1536820781, "post_id": 52303039, "comment_id": 91563009, "body": "the array is there, how can I omit the array <code>[&#39; and this </code>]` ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "edited": false, "score": 0, "creation_date": 1536820840, "post_id": 52303039, "comment_id": 91563037, "body": "even if I&#39;ve 100 apps inside, I need to remove the first and the last <code>[]</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "edited": false, "score": 0, "creation_date": 1536822675, "post_id": 52303039, "comment_id": 91563843, "body": "well, this is not a new question ...:) i didnt edit my question , in the question I wrote that I&#39;ve array of strings and this is the issue here ..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "edited": false, "score": 0, "creation_date": 1536822721, "post_id": 52303039, "comment_id": 91563866, "body": "but as you suggest i will open a new question : )"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "edited": false, "score": 0, "creation_date": 1536823518, "post_id": 52303039, "comment_id": 91564244, "body": "as you suggest:)  <a href=\"https://stackoverflow.com/questions/52308564/how-to-loop-on-strings-and-remove-the-string-array\" title=\"how to loop on strings and remove the string array\">stackoverflow.com/questions/52308564/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "edited": false, "score": 0, "creation_date": 1536823584, "post_id": 52303039, "comment_id": 91564291, "body": "btw, regard you answer here which is more <code>make </code>  native way ? the first loop or the second inside <code>recipe</code> ?"}, {"owner": {"reputation": 19779, "user_id": 878532, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/5fbebb625a289267abd098c0e676c760?s=128&d=identicon&r=PG", "display_name": "Klaus", "link": "https://stackoverflow.com/users/878532/klaus"}, "edited": false, "score": 0, "creation_date": 1536823934, "post_id": 52303039, "comment_id": 91564452, "body": "@JennyM: This is only a question of your requirements. If you want to create variables, expressions or new recipes within make itself inside your loop, you have to use the &quot;make loop&quot;. If you only need the vars inside the recipes, you can use the loop inside the recipe."}], "tags": [], "owner": {"reputation": 19779, "user_id": 878532, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/5fbebb625a289267abd098c0e676c760?s=128&d=identicon&r=PG", "display_name": "Klaus", "link": "https://stackoverflow.com/users/878532/klaus"}, "is_accepted": true, "score": 4, "last_activity_date": 1536784329, "creation_date": 1536784329, "answer_id": 52303039, "question_id": 52302183, "link": "https://stackoverflow.com/questions/52302183/how-to-loop-on-array-of-string/52303039#52303039", "title": "How to loop on array of string", "body": "<p>You want to run your loop inside make itself or in the recipe which is in fact executing a shell? Here you have both!</p>\n\n<p>Remark: I replace the executed command to test it myself. Here I use <code>ls</code> to fill my array.</p>\n\n<pre><code>apps := $(shell ls)\n\n#looping in make itself\n$(foreach var,$(apps),$(info In the loop running with make: $(var)))\n\n#loop in shell inside recipe \ngo:\n    @for v in $(apps) ; do \\\n        echo inside recipe loop with sh command: $$v ; \\\n    done\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>In the loop running with make: a\nIn the loop running with make: b\nIn the loop running with make: c\nIn the loop running with make: Makefile\ninside recipe loop with sh command: a\ninside recipe loop with sh command: b\ninside recipe loop with sh command: c\ninside recipe loop with sh command: Makefile\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6171746"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1587, "favorite_count": 2, "accepted_answer_id": 52303039, "answer_count": 1, "score": 1, "last_activity_date": 1536784329, "creation_date": 1536780773, "last_edit_date": 1536783757, "question_id": 52302183, "link": "https://stackoverflow.com/questions/52302183/how-to-loop-on-array-of-string", "title": "How to loop on array of string", "body": "<p>I've command line tool which implemented  with golang, which works OK.\nI want to execute some command that should provide list of strings</p>\n\n<pre><code>apps := $(shell fxt run apps)\napps:\n    @echo $(apps) is called\n</code></pre>\n\n<p>in the terminal I see the following while executing <code>make</code> (which is totally fine)</p>\n\n<pre><code>[app1 app2] is called\n</code></pre>\n\n<p>Since the command <code>fxt run apps</code> return array of string (<code>var apps []string</code>)</p>\n\n<p>My question is how can I <strong>loop over</strong> the <code>apps</code>\nvariable?</p>\n\n<p>the data which is returned by the command is fine, but now I need to take this list (app1... appN)  and loop over it, the issue which is not clear to me, how can I loop over array of strings?</p>\n\n<p><em>special case</em> is if in the list of theloop I got <code>app7</code> how should do a fork in the code for example if(app7) prints <code>mvn clean install</code></p>\n\n<p><strong>example.</strong></p>\n\n<p>for each app (in the app list) I need to run command</p>\n\n<p><code>go test ./...</code></p>\n\n<p>But for app7 in need to run </p>\n\n<p><code>mvn clean install</code></p>\n\n<p>and for app10 </p>\n\n<p><code>yarn</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1536778101, "post_id": 52301574, "comment_id": 91551047, "body": "That depends on how you&#39;re getting the undesired output, which isn&#39;t shown here. Please include the code that actually generates the output you&#39;re getting."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536778654, "post_id": 52301574, "comment_id": 91551336, "body": "What is a &quot;map string&quot;?"}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "edited": false, "score": 0, "creation_date": 1536833124, "post_id": 52302945, "comment_id": 91569704, "body": "This is exactly what I meant, cheers."}], "tags": [], "owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "is_accepted": true, "score": 1, "last_activity_date": 1536785449, "last_edit_date": 1536785449, "creation_date": 1536783926, "answer_id": 52302945, "question_id": 52301574, "link": "https://stackoverflow.com/questions/52301574/convert-map-values-to-plain-strings-without-brackets/52302945#52302945", "title": "Convert map values to plain strings without brackets?", "body": "<p>From the below information provided by you:</p>\n\n<blockquote>\n  <p>when I iterate over it and return the values they return [hello] [world]</p>\n</blockquote>\n\n<p>It seems that your <code>currentMap</code> actually stores string slices <code>[]string</code> as values, behind the <code>interface{}</code> type. Assuming that above line means that you see this when printing the map using fmt.Println(), or similar functions.</p>\n\n<blockquote>\n  <p><code>map[first:[hello] second:[world]]</code></p>\n</blockquote>\n\n<p>Here's a possible reproduction &amp; solution of your problem::</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    currentMap := make(map[interface{}]interface{})\n    currentMap[\"first\"] = []string{\"hello\"}\n    currentMap[\"second\"] = []string{\"world\"}\n    newStringMap := make(map[string]interface{})\n\n    fmt.Println(\"Problem:\")\n\n    fmt.Printf(\"%v\\n\", currentMap)\n\n    fmt.Println(\"\\nSolution:\")\n\n    for k, v := range currentMap {\n        lst, ok := v.([]string)\n        //fmt.Println(lst, ok)\n\n        if ok &amp;&amp; len(lst) &gt; 0 {\n            newStringMap[k.(string)] = v.([]string)[0]\n        } else {\n            newStringMap[k.(string)] = nil\n        }\n    }\n\n    fmt.Printf(\"%v\\n\", newStringMap)\n}\n</code></pre>\n\n<p>Which outputs to:</p>\n\n<pre><code>Problem:\nmap[first:[hello] second:[world]]\n\nSolution:\nmap[first:hello second:world]\n</code></pre>\n\n<p>Try it here\n<a href=\"https://play.golang.org/p/5XAA3m6MDX_b\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5XAA3m6MDX_b</a></p>\n\n<p>It's not necessary that the content stored in <code>currentMap</code> is always of similar type. (if it is, then why would interface{} ever be used). Which means, don't forget your error-checking. I have tried to cover the same. You may need to add some more, based on the possible <code>actual types</code> in the map, similar to this section:</p>\n\n<pre><code>if ok &amp;&amp; len(lst) &gt; 0 {\n    newStringMap[k.(string)] = v.([]string)[0]\n} else {\n    newStringMap[k.(string)] = nil\n}\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 10286830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9abe2796224ac4d6b16ff6bae943dc1a?s=128&d=identicon&r=PG&f=1", "display_name": "Jeffrey Anderson", "link": "https://stackoverflow.com/users/10286830/jeffrey-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "closed_date": 1536820860, "accepted_answer_id": 52302945, "answer_count": 1, "score": -6, "last_activity_date": 1536785449, "creation_date": 1536777845, "question_id": 52301574, "link": "https://stackoverflow.com/questions/52301574/convert-map-values-to-plain-strings-without-brackets", "closed_reason": "Needs more focus", "title": "Convert map values to plain strings without brackets?", "body": "<p>I have a map string that looks like this</p>\n\n<pre><code>map[first:[hello] second:[world]]\n</code></pre>\n\n<p>The problem is that when I iterate over it and return the values they return <code>[hello] [world]</code> and I want them to just return <code>hello world</code></p>\n\n<pre><code>// currentMap is of type map[interface{}]interface{} originally\nnewStringMap := make(map[string]interface{})\n\nfor k, v := range currentMap {\n    newStringMap[k.(string)] = v\n}\n\nreturn newStringMap\n</code></pre>\n\n<p>How can this be done?</p>\n"}, {"tags": ["json", "rest", "api", "go", "mapping"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1536777484, "post_id": 52301467, "comment_id": 91550804, "body": "You parse the response in a <code>struct{Couint int; Customers json.RawMessage}</code> and depending on Count you unmarshal Customers to either a struct or a slice of struct."}, {"owner": {"reputation": 687, "user_id": 409096, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/sDacS.jpg?s=128&g=1", "display_name": "Javier Valencia", "link": "https://stackoverflow.com/users/409096/javier-valencia"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536778105, "post_id": 52301467, "comment_id": 91551052, "body": "Now I know <code>json.RawMessage</code>, it&#39;s very powerful. THX"}], "answers": [{"tags": [], "owner": {"reputation": 106, "user_id": 5705706, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-LXhCXGfIPuY/AAAAAAAAAAI/AAAAAAAABQ8/mn4H5egcrsA/photo.jpg?sz=128", "display_name": "jklaw90", "link": "https://stackoverflow.com/users/5705706/jklaw90"}, "is_accepted": false, "score": 1, "last_activity_date": 1536801116, "last_edit_date": 1536801116, "creation_date": 1536795128, "answer_id": 52304764, "question_id": 52301467, "link": "https://stackoverflow.com/questions/52301467/api-almost-restful-variable-response-with-golang/52304764#52304764", "title": "API (almost) RESTFul variable response with GoLang", "body": "<p>I use this tool a lot when consuming new apis\n<a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a>\nif you copy paste your json you can get automated struts ie:</p>\n\n<pre><code>type AutoGenerated struct {\n    Count     int `json:\"count\"`\n    Customers struct {\n        ID        int    `json:\"id\"`\n        Name      string `json:\"name\"`\n        Vatnum    string `json:\"vatnum\"`\n        CountryID int    `json:\"country_id\"`\n    } `json:\"customers\"`\n}\n</code></pre>\n\n<p>This is the single struct which the other one would just be an array of this.</p>\n\n<p>I realized i misread your question.\n<a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#RawMessage</a>\nThe previous answer was right raw message is best.</p>\n"}, {"tags": [], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "is_accepted": false, "score": 0, "last_activity_date": 1536804773, "creation_date": 1536804773, "answer_id": 52305720, "question_id": 52301467, "link": "https://stackoverflow.com/questions/52301467/api-almost-restful-variable-response-with-golang/52305720#52305720", "title": "API (almost) RESTFul variable response with GoLang", "body": "<pre><code>type ListResponse struct{\n    Count int `json:\"count\"`\n    Customers []Customer `json:\"customers\"`\n}\n\ntype Customer struct{\nID int               `json:\"id\"`\nVatNum string        `json:\"vatnum\"`\nName string          `json:\"name\"`\nCountryId int        `country_id`\n}\nfunc main(){\n    customer1 = Customer{1,\"vat 1\",\"name 1\",1000}\n    customer2 = Customer{2,\"vat 2\",\"name 2\",1001}\n    customers := make([]Customer,0,10)\n    customers = append(customers,customer1,customer2)\n    response = ListResponse{len(customers),customers}\n    buf,_ = json.Marshal(response)\n    fmt.Println(string(buf))\n}\n</code></pre>\n"}], "owner": {"reputation": 687, "user_id": 409096, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/sDacS.jpg?s=128&g=1", "display_name": "Javier Valencia", "link": "https://stackoverflow.com/users/409096/javier-valencia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1536804773, "creation_date": 1536777254, "question_id": 52301467, "link": "https://stackoverflow.com/questions/52301467/api-almost-restful-variable-response-with-golang", "title": "API (almost) RESTFul variable response with GoLang", "body": "<p>I have a software which I can not replace for various reasons and has an API that looks like RESTFul.</p>\n\n<p>All EndPoints can respond with one or more (in array) objects, even if the RESTFul architecture says that it has to respond with an array of objects, if it only finds one, it returns the object without being wrapped in an array.</p>\n\n<p><code>GET /customers?country_id=10000</code></p>\n\n<pre><code>{\n  \"count\": 5,\n  \"customers\": [\n    { \"id\": 10000, \"name\": \"Customer 10000\", \"vatnum\": \"123456789P\", \"country_id\": 10000 },\n    { \"id\": 10001, \"name\": \"Customer 10001\", \"vatnum\": \"234567891P\", \"country_id\": 10000 },\n    { \"id\": 10002, \"name\": \"Customer 10002\", \"vatnum\": \"345678912P\", \"country_id\": 10000 },\n    { \"id\": 10003, \"name\": \"Customer 10003\", \"vatnum\": \"456789123P\", \"country_id\": 10000 },\n    { \"id\": 10004, \"name\": \"Customer 10004\", \"vatnum\": \"567891234P\", \"country_id\": 10000 }\n  ]\n}\n</code></pre>\n\n<p><code>GET /customers?vatnum=123456789P</code></p>\n\n<pre><code>{\n  \"count\": 1,\n  \"customers\": {\n    \"id\": 10000,\n    \"name\": \"Customer 10000\",\n    \"vatnum\": \"123456789P\",\n    \"country_id\": 10000\n  }\n}\n</code></pre>\n\n<p>My problem is that I am making the client of this API and I do not know which is the best strategy to solve this problem in terms of mapping/parsing the server response in Golang structs.</p>\n"}, {"tags": ["database", "docker", "go", "cassandra", "crud"], "answers": [{"tags": [], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "is_accepted": false, "score": 0, "last_activity_date": 1536782164, "creation_date": 1536782164, "answer_id": 52302517, "question_id": 52301209, "link": "https://stackoverflow.com/questions/52301209/golang-w-gocql-driver-not-returning-all-entries-in-cassandra-db/52302517#52302517", "title": "Golang (w/gocql driver) not returning all entries in Cassandra DB", "body": "<p>I maybe shouldn't, but I'm going to keep this here in case someone else runs into the same problem. I wasn't making sure that my primary key in my table was unique. Doing something like this: </p>\n\n<pre><code>util.CassSession.Query(\"CREATE TABLE cassmessage(\" +\n    \"messageto text, messagefrom text, messagecontent text, uniqueID text, PRIMARY KEY (uniqueID))\").Exec()\n</code></pre>\n\n<p>Managed to fix the issue.</p>\n\n<p>Thanks to everyone who took a look and helped. Cheers!</p>\n"}], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 216, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536782164, "creation_date": 1536776032, "question_id": 52301209, "link": "https://stackoverflow.com/questions/52301209/golang-w-gocql-driver-not-returning-all-entries-in-cassandra-db", "title": "Golang (w/gocql driver) not returning all entries in Cassandra DB", "body": "<p>I have what appears to be a strange bug in either the <code>gocql</code> driver for Cassandra, or in the Cassandra database itself.</p>\n\n<p>I am trying to do a simple write and then read all request in two separate functions. I would expect that I would get all entries on the read all request, but I am only getting the last entry in Cassandra.</p>\n\n<p><em>Here is how I am doing the <strong>write</strong>:</em></p>\n\n<pre><code>    util.CassSession, _ = util.CassCluster.CreateSession()\n    defer util.CassSession.Close()\n    keySpaceMeta, _ := util.CassSession.KeyspaceMetadata(\"platypus\")\n    valC, exists := keySpaceMeta.Tables[\"cassmessage\"]\n\n    if exists==true {\n        fmt.Println(\"cassmessage exists!!!\")\n    }else{\n        fmt.Println(\"cassmessage doesnt exist!\")\n    }\n\n    if valC!=nil{\n        fmt.Println(\"return from valC cassmessage: \", valC)\n    }\n\n    insertString:=`INSERT INTO cassmessage \n    (messagefrom, messageto, messagecontent) \n    VALUES('`+sendMsgReq.MessageFrom+`', '`\n    +sendMsgReq.MessageTo+`', '`+sendMsgReq.MessageContent+`')`\n\n    fmt.Println(\"insertString value: \", insertString)\n\n    err := util.CassSession.Query(insertString).Exec()\n\nif err != nil {\n        fmt.Println(\"there was an error in appending data to cassmessage: \", err)\n    } else {\n        fmt.Println(\"inserted data into cassmessage successfully\")\n    }\n</code></pre>\n\n<p><em>the terminal output from the above:</em></p>\n\n<pre><code>app_1          | [17:59:43][WEBSERVER] : cassmessage exists!!!\napp_1          | [17:59:43][WEBSERVER] : return from valC cassmessage:\n&amp;{platypus cassmessage    [] []  \n[0xc000400140] [] map[messagefrom:0xc0004000a0 \nmessageto:0xc000400140 messagecontent:0xc000400000] \n[messagecontent messagefrom messageto]}\napp_1          | [17:59:43][WEBSERVER] : inserted data into cassmessage successfully\n</code></pre>\n\n<p>I am not entirely sure what the output of <code>valC</code> is returning, although it appears to be some sort of memory address which is a good sign. I also see that I am not getting any error on the write exec function which is hopeful.</p>\n\n<p><em>Here is how I am doing the <strong>read</strong>:</em></p>\n\n<pre><code>util.CassSession, _ = util.CassCluster.CreateSession()\ndefer util.CassSession.Close()\nkeySpaceMeta, _ := util.CassSession.KeyspaceMetadata(\"platypus\")\nvalC, exists := keySpaceMeta.Tables[\"cassmessage\"]\n\nqueryString := `SELECT messageto, messagecontent, messagefrom FROM cassmessage WHERE messagefrom='`+mailReq.Email+`'`\n//returns nothing, should return many rows\nqueryString2 := `SELECT messageto, messagecontent, messagefrom FROM cassmessage`\n//returns only last entry, should return many rows\nqueryString3 := `SELECT * FROM cassmessage WHERE messagefrom='`+mailReq.Email+`'`\n//returns nothing, should return many rows\nqueryAllString := `SELECT * FROM cassmessage` \n//returns only last entry, should return many rows\n\nvar messageto string\nvar messagecontent string\nvar messagefrom string\n\niter := util.CassSession.Query(queryAllString).Iter()\nfor iter.Scan(&amp;messageto, &amp;messagecontent, &amp;messagefrom) {\n    fmt.Println(\"Iter messageto: %v\", messageto)\n    fmt.Println(\"Iter messagecontent: %v\", messagecontent)\n    fmt.Println(\"Iter messagefrom: %v\", messagefrom)\n}\n</code></pre>\n\n<p><em>the terminal output from above:</em></p>\n\n<pre><code>app_1          | [18:09:54][WEBSERVER] : Iter messageto: %v xyz@xyz.com\napp_1          | [18:09:54][WEBSERVER] : Iter messagecontent: %v a\napp_1          | [18:09:54][WEBSERVER] : Iter messagefrom: %v abc@abc.com\n</code></pre>\n\n<p><strong>This is not what I expect</strong>, as this is the output from the read, <em>after</em> multiple writes to the database. If you look at comments on the various <code>queryString</code> values I have tried 2 of them return nothing when I expect all entries to be returned, and 2 of them only return the last write entry (they are all symmetric queries to my knowledge).</p>\n\n<p>Does anyone know why I cannot return multiple entries using Iter or why my four different values on the different query strings I have tried are returning different results?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1536775664, "post_id": 52301095, "comment_id": 91549940, "body": "What have you tried so far?"}, {"owner": {"reputation": 33, "user_id": 10296743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a32cff0917d2c091a98e48fd39d76166?s=128&d=identicon&r=PG&f=1", "display_name": "N_b26", "link": "https://stackoverflow.com/users/10296743/n-b26"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1536776348, "post_id": 52301095, "comment_id": 91550263, "body": "@\u0417\u0435\u043b\u0451\u043d\u044b\u0439 i have edited the code and provide details of what I have tried so far."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536777671, "post_id": 52301095, "comment_id": 91550872, "body": "Since that field appears to hold nested JSON, you would need to unmarshal it before you can properly sort by it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536777743, "post_id": 52301095, "comment_id": 91550897, "body": "That&#39;s just a guess though based on the pasted &quot;JSON&quot;, which is actually invalid and would not be accepted by the Go parser (or any other parser) in the first place."}, {"owner": {"reputation": 33, "user_id": 10296743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a32cff0917d2c091a98e48fd39d76166?s=128&d=identicon&r=PG&f=1", "display_name": "N_b26", "link": "https://stackoverflow.com/users/10296743/n-b26"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536778335, "post_id": 52301095, "comment_id": 91551181, "body": "@Adrian I have updated the above json. I also want to does custom_meta has nested json or  just a string ?"}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 0, "last_activity_date": 1536794441, "last_edit_date": 1536794441, "creation_date": 1536787487, "answer_id": 52303682, "question_id": 52301095, "link": "https://stackoverflow.com/questions/52301095/sorting-the-parse-of-json-based-on-object-value-in-golang/52303682#52303682", "title": "Sorting the parse of JSON based on object value in Golang", "body": "<p>It looks like the main issue here is that the \"custom_meta\" value is a quoted JSON string instead of a nested object, which means it cannot be unmarshaled into an object with the (presumably) desired \"part_num\" integer.</p>\n\n<p>Ideally you could fix the source of this data so that it emits a JSON object instead of a quoted JSON string; however, if that is not feasible, then you could do the following.</p>\n\n<ol>\n<li>Have the \"Custom_meta\" type implement <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Umarshaler</code></a> by first unquoting the source string and then unmarshaling as usual.</li>\n<li>Sort \"Maininfo.Meta\" by the nested \"Custom_meta.Part\" field separately or as part of a custom unmarshaler for that type.</li>\n</ol>\n\n<p>For example (<a href=\"https://play.golang.com/p/76NzvHdLWv2\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>type MainInfo struct {\n  Id        string     `json:\"id\"`\n  MetaInfos []MetaInfo `json:\"meta\"`\n}\n\ntype MetaInfo struct {\n  Filename    string     `json:\"filename\"`\n  Custom      CustomMeta `json:\"custom_meta\"`\n  Size        int        `json:\"size\"`\n  ContentHash string     `json:\"content_hash\"`\n}\n\ntype CustomMeta struct {\n  PartNum int `json:\"part_num\"`\n}\n\nfunc (cm *CustomMeta) UnmarshalJSON(bs []byte) error {\n  // Unquote the source string so we can unmarshal it.\n  unquoted, err := strconv.Unquote(string(bs))\n  if err != nil {\n    return err\n  }\n\n  // Create an aliased type so we can use the default unmarshaler.\n  type CustomMeta2 CustomMeta\n  var cm2 CustomMeta2\n\n  // Unmarshal the unquoted string and assign to the original object.\n  if err := json.Unmarshal([]byte(unquoted), &amp;cm2); err != nil {\n    return err\n  }\n  *cm = CustomMeta(cm2)\n  return nil\n}\n</code></pre>\n\n<p>Then you can sort after parsing like so:</p>\n\n<pre><code>var doc MainInfo\nerr := json.Unmarshal([]byte(jsonstr), &amp;doc)\nif err != nil {\n  panic(err)\n}\nsort.Slice(doc.MetaInfos, func(i, j int) bool {\n  p1 := doc.MetaInfos[i].Custom.PartNum\n  p2 := doc.MetaInfos[j].Custom.PartNum\n  return p1 &lt; p2\n})\n</code></pre>\n\n<p>Of course, you could also perform the sorting as part of a custom <code>UnmarshalJSON</code> method for the \"MainInfo\" type.</p>\n"}], "owner": {"reputation": 33, "user_id": 10296743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a32cff0917d2c091a98e48fd39d76166?s=128&d=identicon&r=PG&f=1", "display_name": "N_b26", "link": "https://stackoverflow.com/users/10296743/n-b26"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "accepted_answer_id": 52303682, "answer_count": 1, "score": 1, "last_activity_date": 1536796772, "creation_date": 1536775526, "last_edit_date": 1536796772, "question_id": 52301095, "link": "https://stackoverflow.com/questions/52301095/sorting-the-parse-of-json-based-on-object-value-in-golang", "title": "Sorting the parse of JSON based on object value in Golang", "body": "<p>Trying to parse the json and sorting based on one of the values of struct.\nI want to sort the json based on the custom_meta's part_num, how we can do that. The code is as follows:</p>\n\n<pre><code>type Maininfo struct {\n    Id   string     `json:\"id\"`\n    Meta []Metainfo `json:\"meta\"`\n}\n\n\ntype Metainfo struct {\n    Filename     string `json:\"filename\"`\n    Custom_meta  string `json:\"custom_meta\"`\n    Size         int    `json:\"size\"`\n    Content_hash string `json:\"content_hash\"`\n}\n\ntype Custom_meta struct {\n    Part_num string `json:\"part_num\"`\n    Part     int\n}\n\nfunc getMeta(body []byte) (*Maininfo, error) {\n    var s = new(Maininfo)\n    err := json.Unmarshal(body, &amp;s)\n    if err != nil {\n        fmt.Println(\"whoops:\", err)\n    }\n    return s, err\n}\n\n\nfunc getMetainfo(body []byte) (*Metainfo, error) {\n    var s = new(Metainfo)\n    err := json.Unmarshal(body, &amp;s)\n    if err != nil {\n        fmt.Println(\"error\", err)\n    }\n    return s, err\n}\n\ntype AxisSorter []Metainfo\n\nfunc (a AxisSorter) Len() int           { return len(a) }\nfunc (a AxisSorter) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }\nfunc (a AxisSorter) Less(i, j int) bool { return a[i].Custom_meta &lt; a[j].Custom_meta }\n\n\ntype NameSorter []Metainfo\n\nfunc (a NameSorter) Len() int           { return len(a) }\nfunc (a NameSorter) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }\nfunc (a NameSorter) Less(i, j int) bool { return a[i].Custom_meta &lt; a[j].Custom_meta }\n\nfunc main() {\ns, err := getMeta([]byte(body))\n    fmt.Println(\"Main stuff\", s)\n\n    var metaInfo []Metainfo\n    metaInfo = s.Meta\n}\n    var customMeta CustomMeta\n\n    sort.Sort(AxisSorter(metaInfo))\n    fmt.Println(\"metaInfo sorted \", metaInfo)\n\n    sort.Sort(NameSorter(metaInfo))\n    fmt.Println(\"metaInfo sorted 2 \", metaInfo)\n\n    sort.Slice(metaInfo, func(i, j int) bool {\n        fmt.Println(\"meta \", metaInfo[i].Custom_meta)\n        return metaInfo[i].Custom_meta &lt; metaInfo[j].Custom_meta\n      })\n\n}\n</code></pre>\n\n<p>I am not able to sort the code based on the part_num, how can we do that, since info is not a separate object it is a string. How we can parse string and sort it based on the int value. </p>\n"}, {"tags": ["date", "go", "range"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 6494549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc24da9f6d4ab1e3fdbc20ae891113a5?s=128&d=identicon&r=PG&f=1", "display_name": "EuSousa", "link": "https://stackoverflow.com/users/6494549/eusousa"}, "edited": false, "score": 0, "creation_date": 1536880111, "post_id": 52303730, "comment_id": 91593242, "body": "Excellent.. Thanks"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1578583751, "last_edit_date": 1578583751, "creation_date": 1536787746, "answer_id": 52303730, "question_id": 52300644, "link": "https://stackoverflow.com/questions/52300644/date-range-by-week-number-golang/52303730#52303730", "title": "Date range by week number Golang", "body": "<p><strong>Foreword:</strong> <a href=\"https://golang.org/pkg/time/#Time.ISOWeek\" rel=\"nofollow noreferrer\"><code>Time.ISOWeek()</code></a> returns you the week number that starts on Monday, so I will answer your question that also handles weeks starting on Monday. Alter it to your needs if you want it to work with weeks starting on Sunday.</p>\n\n<p>I released this utility in <a href=\"https://github.com/icza/gox\" rel=\"nofollow noreferrer\"><code>github.com/icza/gox</code></a>, see <a href=\"https://godoc.org/github.com/icza/gox/timex#WeekStart\" rel=\"nofollow noreferrer\"><code>timex.WeekStart()</code></a>.</p>\n\n<hr>\n\n<p>The standard library does not provide a function that would return you the date range of a given week (year+week number). So we have to construct one ourselves.</p>\n\n<p>And it's not that hard. We can start off from the middle of the year, align to the first day of the week (Monday), get the week of this time value, and corrigate: add as many days as the week difference multiplied by 7.</p>\n\n<p>This is how it could look like:</p>\n\n<pre><code>func WeekStart(year, week int) time.Time {\n    // Start from the middle of the year:\n    t := time.Date(year, 7, 1, 0, 0, 0, 0, time.UTC)\n\n    // Roll back to Monday:\n    if wd := t.Weekday(); wd == time.Sunday {\n        t = t.AddDate(0, 0, -6)\n    } else {\n        t = t.AddDate(0, 0, -int(wd)+1)\n    }\n\n    // Difference in weeks:\n    _, w := t.ISOWeek()\n    t = t.AddDate(0, 0, (week-w)*7)\n\n    return t\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>fmt.Println(WeekStart(2018, 1))\nfmt.Println(WeekStart(2018, 2))\nfmt.Println(WeekStart(2019, 1))\nfmt.Println(WeekStart(2019, 2))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/0M0ZOQ8nKlW\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>2018-01-01 00:00:00 +0000 UTC\n2018-01-08 00:00:00 +0000 UTC\n2018-12-31 00:00:00 +0000 UTC\n2019-01-07 00:00:00 +0000 UTC\n</code></pre>\n\n<p>One nice property of this <code>WeekStart()</code> implementation is that it handles <em>out-of-range</em> weeks nicely. That is, if you pass <code>0</code> for the week, it will be interpreted as the last week of the previous year. If you pass <code>-1</code> for the week, it will designate the second to last week of the previous year. Similarly, if you pass max week of the year plus 1, it will be interpreted as the first week of the next year etc.</p>\n\n<p>The above <code>WeekStart()</code> function only returns the given week's first day (Monday), because the last day of the week is always its first day + 6 days.</p>\n\n<p>If we also need the last day:</p>\n\n<pre><code>func WeekRange(year, week int) (start, end time.Time) {\n    start = WeekStart(year, week)\n    end = start.AddDate(0, 0, 6)\n    return\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>fmt.Println(WeekRange(2018, 1))\nfmt.Println(WeekRange(2018, 2))\nfmt.Println(WeekRange(2019, 1))\nfmt.Println(WeekRange(2019, 2))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/p-_NtndZ3Ts\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>2018-01-01 00:00:00 +0000 UTC 2018-01-07 00:00:00 +0000 UTC\n2018-01-08 00:00:00 +0000 UTC 2018-01-14 00:00:00 +0000 UTC\n2018-12-31 00:00:00 +0000 UTC 2019-01-06 00:00:00 +0000 UTC\n2019-01-07 00:00:00 +0000 UTC 2019-01-13 00:00:00 +0000 UTC\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10005263, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kY7oX.jpg?s=128&g=1", "display_name": "Yuriy Olkhovyy", "link": "https://stackoverflow.com/users/10005263/yuriy-olkhovyy"}, "is_accepted": false, "score": 0, "last_activity_date": 1610871657, "last_edit_date": 1610871657, "creation_date": 1610870468, "answer_id": 65758436, "question_id": 52300644, "link": "https://stackoverflow.com/questions/52300644/date-range-by-week-number-golang/65758436#65758436", "title": "Date range by week number Golang", "body": "<p>The following does the work of finding the first day of week for me, although not from week number but from time. If you add an extra parameter - for the hard-coded time.Monday - that can be any day of week, e.g. Sunday.</p>\n<pre><code>func weekStartDate(date time.Time) time.Time {\n    offset := (int(time.Monday) - int(date.Weekday()) - 7) % 7\n    result := date.Add(time.Duration(offset*24) * time.Hour)\n    return result\n}\n</code></pre>\n<p>Test:</p>\n<pre><code>    func TestWeekStartDate(t *testing.T) {\n        date := time.Date(2020, 1, 1, 0, 0, 0, 0, time.UTC)\n        for i := 0; i &lt; 2000; i++ {\n            weekStart := weekStartDate(date)\n            log.Printf(&quot;%s %s&quot;, date.Format(&quot;2006-01-02 Mon&quot;), weekStart.Format(&quot;2006-01-02 Mon&quot;))\n            assert.NotNil(t, weekStart)\n            assert.Equal(t, time.Monday, weekStart.Weekday())\n            date = date.Add(24 * time.Hour)\n        }\n    }\n</code></pre>\n<p>Output:</p>\n<pre><code>...\n2021/01/17 08:50:03 2020-12-15 Tue 2020-12-14 Mon\n2021/01/17 08:50:03 2020-12-16 Wed 2020-12-14 Mon\n2021/01/17 08:50:03 2020-12-17 Thu 2020-12-14 Mon\n2021/01/17 08:50:03 2020-12-18 Fri 2020-12-14 Mon\n2021/01/17 08:50:03 2020-12-19 Sat 2020-12-14 Mon\n2021/01/17 08:50:03 2020-12-20 Sun 2020-12-14 Mon\n2021/01/17 08:50:03 2020-12-21 Mon 2020-12-21 Mon\n2021/01/17 08:50:03 2020-12-22 Tue 2020-12-21 Mon\n2021/01/17 08:50:03 2020-12-23 Wed 2020-12-21 Mon\n2021/01/17 08:50:03 2020-12-24 Thu 2020-12-21 Mon\n2021/01/17 08:50:03 2020-12-25 Fri 2020-12-21 Mon\n2021/01/17 08:50:03 2020-12-26 Sat 2020-12-21 Mon\n2021/01/17 08:50:03 2020-12-27 Sun 2020-12-21 Mon\n2021/01/17 08:50:03 2020-12-28 Mon 2020-12-28 Mon\n2021/01/17 08:50:03 2020-12-29 Tue 2020-12-28 Mon\n2021/01/17 08:50:03 2020-12-30 Wed 2020-12-28 Mon\n2021/01/17 08:50:03 2020-12-31 Thu 2020-12-28 Mon\n2021/01/17 08:50:03 2021-01-01 Fri 2020-12-28 Mon\n2021/01/17 08:50:03 2021-01-02 Sat 2020-12-28 Mon\n2021/01/17 08:50:03 2021-01-03 Sun 2020-12-28 Mon\n2021/01/17 08:50:03 2021-01-04 Mon 2021-01-04 Mon\n2021/01/17 08:50:03 2021-01-05 Tue 2021-01-04 Mon\n2021/01/17 08:50:03 2021-01-06 Wed 2021-01-04 Mon\n2021/01/17 08:50:03 2021-01-07 Thu 2021-01-04 Mon\n2021/01/17 08:50:03 2021-01-08 Fri 2021-01-04 Mon\n2021/01/17 08:50:03 2021-01-09 Sat 2021-01-04 Mon\n2021/01/17 08:50:03 2021-01-10 Sun 2021-01-04 Mon\n2021/01/17 08:50:03 2021-01-11 Mon 2021-01-11 Mon\n2021/01/17 08:50:03 2021-01-12 Tue 2021-01-11 Mon\n2021/01/17 08:50:03 2021-01-13 Wed 2021-01-11 Mon\n2021/01/17 08:50:03 2021-01-14 Thu 2021-01-11 Mon\n2021/01/17 08:50:03 2021-01-15 Fri 2021-01-11 Mon\n2021/01/17 08:50:03 2021-01-16 Sat 2021-01-11 Mon\n2021/01/17 08:50:03 2021-01-17 Sun 2021-01-11 Mon\n2021/01/17 08:50:03 2021-01-18 Mon 2021-01-18 Mon\n2021/01/17 08:50:03 2021-01-19 Tue 2021-01-18 Mon\n2021/01/17 08:50:03 2021-01-20 Wed 2021-01-18 Mon\n2021/01/17 08:50:03 2021-01-21 Thu 2021-01-18 Mon\n2021/01/17 08:50:03 2021-01-22 Fri 2021-01-18 Mon\n2021/01/17 08:50:03 2021-01-23 Sat 2021-01-18 Mon\n2021/01/17 08:50:03 2021-01-24 Sun 2021-01-18 Mon\n2021/01/17 08:50:03 2021-01-25 Mon 2021-01-25 Mon\n2021/01/17 08:50:03 2021-01-26 Tue 2021-01-25 Mon\n2021/01/17 08:50:03 2021-01-27 Wed 2021-01-25 Mon\n2021/01/17 08:50:03 2021-01-28 Thu 2021-01-25 Mon\n2021/01/17 08:50:03 2021-01-29 Fri 2021-01-25 Mon\n2021/01/17 08:50:03 2021-01-30 Sat 2021-01-25 Mon\n2021/01/17 08:50:03 2021-01-31 Sun 2021-01-25 Mon\n2021/01/17 08:50:03 2021-02-01 Mon 2021-02-01 Mon\n2021/01/17 08:50:03 2021-02-02 Tue 2021-02-01 Mon\n2021/01/17 08:50:03 2021-02-03 Wed 2021-02-01 Mon\n2021/01/17 08:50:03 2021-02-04 Thu 2021-02-01 Mon\n2021/01/17 08:50:03 2021-02-05 Fri 2021-02-01 Mon\n...\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 6494549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc24da9f6d4ab1e3fdbc20ae891113a5?s=128&d=identicon&r=PG&f=1", "display_name": "EuSousa", "link": "https://stackoverflow.com/users/6494549/eusousa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4185, "favorite_count": 2, "accepted_answer_id": 52303730, "answer_count": 2, "score": 6, "last_activity_date": 1610871657, "creation_date": 1536773572, "last_edit_date": 1536773739, "question_id": 52300644, "link": "https://stackoverflow.com/questions/52300644/date-range-by-week-number-golang", "title": "Date range by week number Golang", "body": "<p>With this simple function, I can get the week number. Now, with the number of the week, how can I get the date range, started on Sunday?</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"time\"\n)\nfunc main() {\n    Week(time.Now().UTC())\n}\n\nfunc Week(now time.Time) string {\n    _, thisWeek := now.ISOWeek()\n    return \"S\" + strconv.Itoa(thisWeek)\n}\n</code></pre>\n\n<p>Any help is welcome. Thank you.</p>\n"}, {"tags": ["go", "dependency-management", "dep"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1536768453, "post_id": 52299402, "comment_id": 91546536, "body": "Only vendor dependencies in a binary, not in a library."}, {"owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536768626, "post_id": 52299402, "comment_id": 91546626, "body": "@Adrian, could you please explain this, bc in my vendor I have source code of dependencies libs."}], "answers": [{"tags": [], "owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "is_accepted": true, "score": 2, "last_activity_date": 1536780467, "last_edit_date": 1536780467, "creation_date": 1536780096, "answer_id": 52302031, "question_id": 52299402, "link": "https://stackoverflow.com/questions/52299402/dependency-issue-within-two-projects-that-use-same-lib/52302031#52302031", "title": "Dependency issue within two projects that use same lib", "body": "<p>Looks like the situation is that <code>sharedproject</code> vendors the <code>github.com/go-openapi/spec</code> dependency while <code>myproject</code>\ngets both <code>sharedproject</code> and <code>github.com/go-openapi/spec</code> dependencies from\n<code>GOPATH</code>.</p>\n\n<p>Now when you refer to <code>github.com/go-openapi/spec</code> in <code>sharedproject</code>, it refers to\nthe package inside the vendor directory, which is technically different from the\nsame package in <code>GOPATH</code>, even if both have the same content. So when you pass a\nvariable of type <code>*github.com/go-openapi/spec.Operation</code> from <code>myproject</code> to a\nfunction in <code>sharedproject</code>, the package of the type differs from what's expected and compilation fails.</p>\n\n<p>To solve this, make sure <code>sharedproject</code> is vendored inside <code>myproject</code>. When\nyou do this, <code>dep ensure</code> will put a copy of <code>sharedproject</code> without its vendor\ndirectory into <code>myproject</code>'s vendor directory. After this, both <code>myproject</code> and <code>sharedproject</code> will use the <code>github.com/go-openapi/spec</code> package from <code>myproject</code>'s vendor directory.</p>\n\n<p>That does make local development hard if you change <code>sharedproject</code> often and want\nto immediately use those changes in <code>myproject</code> (can't use <code>dep</code> till the changes are pushed to the Git remote). I'd work around that by copying\nover <code>sharedproject</code> into <code>myproject</code>'s vendor directory manually without using <code>dep</code> (excluding the vendor directory of course). Be careful to not commit those manually copied changes to Git though!</p>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 52302031, "answer_count": 1, "score": 0, "last_activity_date": 1536780467, "creation_date": 1536768387, "question_id": 52299402, "link": "https://stackoverflow.com/questions/52299402/dependency-issue-within-two-projects-that-use-same-lib", "title": "Dependency issue within two projects that use same lib", "body": "<p>I have two projects:</p>\n\n<pre><code>/myproject\n/sharedproject\n</code></pre>\n\n<p>both of them are managed by dep, I have execute <code>go get -u github.com/golang/dep/cmd/dep</code> in order to have latest dep version, and run <code>dep ensure</code> on both projects.</p>\n\n<p>When I run <code>myproject</code> I get following error:</p>\n\n<pre><code>cannot use op (type *\"myproject/vendor/github.com/go-openapi/spec\".Operation) as type *\"sharedproject/vendor/github.com/go-openapi/spec\".Operation\n</code></pre>\n\n<p>What is wrong and how to fix this?</p>\n"}, {"tags": ["json", "regex", "go"], "comments": [{"owner": {"reputation": 495, "user_id": 2653881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d037157c1fe71163801cd5aab631ca6a?s=128&d=identicon&r=PG&f=1", "display_name": "Ajaypayne", "link": "https://stackoverflow.com/users/2653881/ajaypayne"}, "edited": false, "score": 0, "creation_date": 1536767596, "post_id": 52299091, "comment_id": 91546019, "body": "Parsing JSON is best done without regex. In golang you can use json unmarshal, then use them as an object as normal."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1536767652, "post_id": 52299091, "comment_id": 91546051, "body": "That&#39;s not JSON. If you want to capture the quotes, put the quotes into the capture group (i.e. inside the parentheses)."}, {"owner": {"reputation": 317, "user_id": 10217443, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ipP2mZGiFGU/AAAAAAAAAAI/AAAAAAAAADc/ZvHNj7o3sOI/photo.jpg?sz=128", "display_name": "Yuliang Li", "link": "https://stackoverflow.com/users/10217443/yuliang-li"}, "reply_to_user": {"reputation": 495, "user_id": 2653881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d037157c1fe71163801cd5aab631ca6a?s=128&d=identicon&r=PG&f=1", "display_name": "Ajaypayne", "link": "https://stackoverflow.com/users/2653881/ajaypayne"}, "edited": false, "score": 0, "creation_date": 1536826804, "post_id": 52299091, "comment_id": 91566006, "body": "@Ajaypayne It is not a standard json, I have to deal with unqualified attributes before I can get the json object."}, {"owner": {"reputation": 495, "user_id": 2653881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d037157c1fe71163801cd5aab631ca6a?s=128&d=identicon&r=PG&f=1", "display_name": "Ajaypayne", "link": "https://stackoverflow.com/users/2653881/ajaypayne"}, "edited": false, "score": 0, "creation_date": 1536836265, "post_id": 52299091, "comment_id": 91571358, "body": "@YuliangLi That only poses a problem if you want to unmarshal into a struct. You could unmarshal to a map for example (from decode.go infile comments on unmarshal -  // To unmarshal a JSON object into a map, Unmarshal first establishes a map to // use. If the map is nil, Unmarshal allocates a new map. Otherwise Unmarshal // reuses the existing map, keeping existing entries. Unmarshal then stores // key-value pairs from the JSON object into the map. The map&#39;s key type must // either be a string, an integer, or implement encoding.TextUnmarshaler."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 1, "last_activity_date": 1538431927, "last_edit_date": 1538431927, "creation_date": 1538428767, "answer_id": 52599032, "question_id": 52299091, "link": "https://stackoverflow.com/questions/52299091/how-do-i-match-the-content-in-double-quotes-with-regexp-in-golang/52599032#52599032", "title": "How do I match the content in double quotes with regexp in golang?", "body": "<p>One solution would be to use a regular expression that matches any character between quotes (such as your example or <code>\".*?\"</code>) and either put a matching group (aka \"submatch\") inside the quotes or return the relevant substring of the match, using <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllStringSubmatch\" rel=\"nofollow noreferrer\"><code>regexp.FindAllStringSubmatch(...)</code></a> or <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllString\" rel=\"nofollow noreferrer\"><code>regexp.FindAllString(...)</code></a>, respectively.</p>\n\n<p>For example (<a href=\"https://play.golang.com/p/ICO9g1hsTTK\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>func main() {\n  str := `{null,\"Age\":24,\"Balance\":33.23}`\n\n  fmt.Printf(\"OK1: %#v\\n\", getQuotedStrings1(str))\n  // OK1: []string{\"Age\", \"Balance\"}\n  fmt.Printf(\"OK2: %#v\\n\", getQuotedStrings2(str))\n  // OK2: []string{\"Age\", \"Balance\"}\n}\n\nvar re1 = regexp.MustCompile(`\"(.*?)\"`) // Note the matching group (submatch).\n\nfunc getQuotedStrings1(s string) []string {\n  ms := re1.FindAllStringSubmatch(s, -1)\n  ss := make([]string, len(ms))\n  for i, m := range ms {\n    ss[i] = m[1]\n  }\n  return ss\n}\n\nvar re2 = regexp.MustCompile(`\".*?\"`)\n\nfunc getQuotedStrings2(s string) []string {\n  ms := re2.FindAllString(s, -1)\n  ss := make([]string, len(ms))\n  for i, m := range ms {\n    ss[i] = m[1 : len(m)-1] // Note the substring of the match.\n  }\n  return ss\n\n}\n</code></pre>\n\n<p>Note that the second version (without a submatching group) may be slightly faster based on a simple benchmark, if performance is critical.</p>\n"}], "owner": {"reputation": 317, "user_id": 10217443, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ipP2mZGiFGU/AAAAAAAAAAI/AAAAAAAAADc/ZvHNj7o3sOI/photo.jpg?sz=128", "display_name": "Yuliang Li", "link": "https://stackoverflow.com/users/10217443/yuliang-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1915, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1538431927, "creation_date": 1536767315, "question_id": 52299091, "link": "https://stackoverflow.com/questions/52299091/how-do-i-match-the-content-in-double-quotes-with-regexp-in-golang", "title": "How do I match the content in double quotes with regexp in golang?", "body": "<pre><code>content := `{null,\"Age\":24,\"Balance\":33.23}`\nrule,_ := regexp.Compile(`\"([^\\\"]+)\"`)\nresults := rule.FindAllString(content,-1)\nfmt.Println(results[0]) //\"Age\" \nfmt.Println(results[1]) //\"Balance\"\n</code></pre>\n\n<p>There is a json string with a ``null`` value that it look like this.</p>\n\n<p>This json is from a web api and i don't want to replace anything inside.</p>\n\n<p>I want to using regex to match all the keys in this json which are without the double quote and the output are ``Age`` and ``Balance`` but not ``\"Age\"`` and ``\"Balance\"``.</p>\n\n<p>How can I achieve this?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "is_accepted": false, "score": 2, "last_activity_date": 1536766145, "creation_date": 1536766145, "answer_id": 52298773, "question_id": 52298564, "link": "https://stackoverflow.com/questions/52298564/transport-options-to-ensure-net-http-client-connect-via-tls-1-2/52298773#52298773", "title": "Transport options to ensure net/http client connect via TLS 1.2", "body": "<p>From the <a href=\"https://golang.org/pkg/crypto/tls/\" rel=\"nofollow noreferrer\">docs</a></p>\n\n<blockquote>\n  <p>Package tls partially implements TLS 1.2, as specified in RFC 5246.</p>\n</blockquote>\n\n<p>That beeing said I keep this function as a snippet to create the necessary configuration:</p>\n\n<pre><code>func NewTLSConfig(clientCertFile, clientKeyFile, caCertFile string) (*tls.Config, error) {\n tlsConfig := tls.Config{}\n\n // Load client cert\n cert, err := tls.LoadX509KeyPair(clientCertFile, clientKeyFile)\n if err != nil {\n  return &amp;tlsConfig, err\n }\n tlsConfig.Certificates = []tls.Certificate{cert}\n\n // Load CA cert\n caCert, err := ioutil.ReadFile(caCertFile)\n if err != nil {\n  return &amp;tlsConfig, err\n }\n caCertPool := x509.NewCertPool()\n caCertPool.AppendCertsFromPEM(caCert)\n tlsConfig.RootCAs = caCertPool\n\n tlsConfig.BuildNameToCertificate()\n return &amp;tlsConfig, err\n}\n</code></pre>\n\n<p>After that you just need to initialize the transport:</p>\n\n<pre><code>transport := &amp;http.Transport{TLSClientConfig: tlsConfig}\nclient := &amp;http.Client{Transport: transport}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 5, "last_activity_date": 1536766977, "creation_date": 1536766977, "answer_id": 52299006, "question_id": 52298564, "link": "https://stackoverflow.com/questions/52298564/transport-options-to-ensure-net-http-client-connect-via-tls-1-2/52299006#52299006", "title": "Transport options to ensure net/http client connect via TLS 1.2", "body": "<p>At the time of writing, Go will speak TLS 1.2 automatically if the server supports it.</p>\n\n<p><a href=\"https://golang.org/pkg/crypto/tls/#ConnectionState\" rel=\"noreferrer\">tls.ConnectionState</a> reports various negotiated TLS parameters of a connection, including the protocol version.</p>\n\n<p>To get the underlying TLS connection for an HTTP client it is easiest to set the <code>DialTLS</code> field of the <code>Transport</code> to a function that establishes and remembers the connection. Once the response arrived (but before you close the response body!), call <a href=\"https://golang.org/pkg/crypto/tls/#Conn.ConnectionState\" rel=\"noreferrer\">tls.Conn.ConnectionState</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n)\n\nfunc main() {\n    var (\n        conn *tls.Conn\n        err  error\n    )\n\n    tlsConfig := http.DefaultTransport.(*http.Transport).TLSClientConfig\n\n    c := &amp;http.Client{\n        Transport: &amp;http.Transport{\n            DialTLS: func(network, addr string) (net.Conn, error) {\n                conn, err = tls.Dial(network, addr, tlsConfig)\n                return conn, err\n            },\n        },\n    }\n\n    res, err := c.Get(\"https://example.com\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    versions := map[uint16]string{\n        tls.VersionSSL30: \"SSL\",\n        tls.VersionTLS10: \"TLS 1.0\",\n        tls.VersionTLS11: \"TLS 1.1\",\n        tls.VersionTLS12: \"TLS 1.2\",\n    }\n\n    fmt.Println(res.Request.URL)\n    fmt.Println(res.Status)\n    v := conn.ConnectionState().Version\n    fmt.Println(versions[v])\n\n    res.Body.Close()\n}\n\n// Output:\n// https://example.com\n// 200 OK\n// TLS 1.2\n</code></pre>\n"}], "owner": {"reputation": 3540, "user_id": 131051, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1b41d7397afdd0a922953945f1111e55?s=128&d=identicon&r=PG", "display_name": "GSP", "link": "https://stackoverflow.com/users/131051/gsp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3646, "favorite_count": 0, "accepted_answer_id": 52299006, "answer_count": 2, "score": 1, "last_activity_date": 1536766977, "creation_date": 1536765523, "question_id": 52298564, "link": "https://stackoverflow.com/questions/52298564/transport-options-to-ensure-net-http-client-connect-via-tls-1-2", "title": "Transport options to ensure net/http client connect via TLS 1.2", "body": "<p>I have a go service that makes REST requests to an HTTP server that I don't control. A customer asked my to \"confirm\" that my service is connecting via TLS 1.2. Is that something that I can do in code?</p>\n\n<p>Current code looks something like this:</p>\n\n<pre><code>request, _ := http.NewRequest(\"PUT\",\n    \"https://example.com/path/to/endpoint\",\n    bytes.NewReader(json))\n\nclient := &amp;http.Client{}\n\nresponse, _ := client.Do(request)\ndefer response.Body.Close()\n\nstr, err := ioutil.ReadAll(response.Body)\n</code></pre>\n\n<p>Based on a quick read of the docs I believe I need to use a <code>Transport</code> and build my client using that transport. Something like this:</p>\n\n<pre><code>tr := &amp;http.Transport{\n    ... some options here ...\n}\nclient := &amp;http.Client{Transport: tr}\n</code></pre>\n\n<p>But I'm not sure what options I should set. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 1, "creation_date": 1536765611, "post_id": 52298469, "comment_id": 91544870, "body": "Could you describe the use-case for this, e.g. why can&#39;t the different functions be stored in different maps."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1536765616, "post_id": 52298469, "comment_id": 91544871, "body": "Yes, use <code>interface{}</code> as the value type. To call functions use type assertions to specific types or reflection.  Describe the higher-level problem that you are trying to solve.  There may be a better solution to that problem."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536768521, "post_id": 52298469, "comment_id": 91546566, "body": "The cleanest way would be to just use two maps, one for each signature."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 1, "creation_date": 1536831910, "post_id": 52298469, "comment_id": 91568938, "body": "I don&#39;t understand. Why so many down votes. It&#39;s a good question. Scenarios like this are quite useful, especially in case of implementing factory pattern or something similar in go. Desire to be able to do things that are possible in one language, in other(in a decent way), is a genuine step in learning a new language."}, {"owner": {"reputation": 584, "user_id": 361602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea916f379968be90df65ea73b7a1cef3?s=128&d=identicon&r=PG", "display_name": "raja kolluru", "link": "https://stackoverflow.com/users/361602/raja-kolluru"}, "edited": false, "score": 0, "creation_date": 1577477142, "post_id": 52298469, "comment_id": 105183552, "body": "This is not as bad as it is made out to be with all the downvoting from people who think they know it all. A command catalog is made of different function pointers mapped to different strings. In configuration, you will know which function to call depending on the string. This happens all the time in Java with the spring framework. What else is a bean factory? A good solution to this would solve the problem of dependency inversion nicely. Auto wiring by name is possible only because of this kind of thing"}], "answers": [{"comments": [{"owner": {"reputation": 11647, "user_id": 275002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fe80cff5f1586741e1f03d02168d882f?s=128&d=identicon&r=PG", "display_name": "Volatil3", "link": "https://stackoverflow.com/users/275002/volatil3"}, "edited": false, "score": 0, "creation_date": 1586340198, "post_id": 52299360, "comment_id": 108090336, "body": "SO can I use <code>map[string]interface{}</code> for a kind of Key/Value structure where key will always be a <code>string</code> but the value could be either string, int or even a list?"}], "tags": [], "owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "is_accepted": true, "score": 1, "last_activity_date": 1536821475, "last_edit_date": 1536821475, "creation_date": 1536768252, "answer_id": 52299360, "question_id": 52298469, "link": "https://stackoverflow.com/questions/52298469/map-to-store-generic-type-functions-in-go/52299360#52299360", "title": "Map to store generic type functions in Go", "body": "<p>Go is a strongly typed language. So, it's not possible the way, it is possible with, say python. But just like python, once you do this, you loose the benefit of compile time error checks, and your runtime error checking has to be full-proof.\nHere's what you can do:</p>\n\n<ol>\n<li><p><strong>Use <code>map[string]interface{}</code> type for your function map</strong>, which enables you to store anything. But then you are responsible to correctly type assertion at the time of calling. Problem is that, in most cases, if while calling a function, you could know the type of function, may be you might not need a map in the first place.</p></li>\n<li><p><strong>Use a <code>map[string]string</code> or <code>map[string]interface{}</code> as the argument</strong>, and return type in all the functions that are supposed to go into this map. Or at least put all the variable arguments into this map.</p>\n\n<p>eg.</p>\n\n<p><code>map[string](func (name string, age int, other_attributes\nmap[string]interface{}) (map[string]interface{}, error))</code></p></li>\n</ol>\n\n<p>But again, each function call should provide the correct arguments, and there should also be checks inside the functions, to see (with non-panic version of map lookup), if the parameters are correctly provided, if not, you can return a custom error like ErrInvalidParametersPassed. (playing the role of an interpreter). But you will still have lesser chances of messing up, compared to first option. As the <code>burden of type assertion</code> will be on the function implementation, and not the caller. Caller just needs to fetch it's required values, which it anyways needs to know about.</p>\n\n<p>But yet, best option would be to redesign your actual solution in a way, so that it can be done without going this road. As @bereal suggested in comments, it's good to have separate maps if possible, or maybe use a superset of arguments if they aren't too different, or too many. If there are just a few arguments, even switch case could be clean enough. Look for ways that cheat/bypass compile time checks, when you are truly convinced that there is no other elegant way.</p>\n"}], "owner": {"reputation": 361, "user_id": 991739, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6aa5192a21a7f9f56cdfcb1b355fa57c?s=128&d=identicon&r=PG", "display_name": "Mahi G", "link": "https://stackoverflow.com/users/991739/mahi-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 882, "favorite_count": 0, "accepted_answer_id": 52299360, "answer_count": 1, "score": -1, "last_activity_date": 1536821475, "creation_date": 1536765230, "last_edit_date": 1536765476, "question_id": 52298469, "link": "https://stackoverflow.com/questions/52298469/map-to-store-generic-type-functions-in-go", "title": "Map to store generic type functions in Go", "body": "<p>I am trying to create a Map with String and functions as key and Value. It works if all functions are of same signature but my requirement is to store functions of different signature in the same map. Is this possible in Go?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    functions := buildFunctions()\n    f := functions[\"isInValid\"]\n\n    //  f(\"hello\")\n\n}\n\nfunc buildFunctions() map[string]func() bool {\n\n    functions := map[string]func() bool{\n        \"isInValid\":   isInValid,\n        \"isAvailable\": isAvailable,\n    }\n    return functions\n}\n\nfunc isInValid(s string) bool {\n    fmt.Println(\"Invalid \", s)\n    return true\n}\n\nfunc isAvailable(s string, s1 string) bool {\n    return true\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ocwCgEpa_0G\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ocwCgEpa_0G</a></p>\n"}, {"tags": ["go", "dependency-injection", "inversion-of-control", "factory"], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 6935236, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hC8l2tY8XIY/AAAAAAAAAAI/AAAAAAAAABg/TZuFezYPtoc/photo.jpg?sz=128", "display_name": "Shivaprasad Bhat", "link": "https://stackoverflow.com/users/6935236/shivaprasad-bhat"}, "edited": false, "score": 1, "creation_date": 1536766604, "post_id": 52298462, "comment_id": 91545469, "body": "Thanks for the answer. DI framework is not something i am considering. I am currently testing out the second pattern in a slightly complex code base. Till now it seems to be the best option. First approach made the handler contain lot of domain logic making it hard to test."}], "tags": [], "owner": {"reputation": 2178, "user_id": 3067964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CvonS.jpg?s=128&g=1", "display_name": "jwells131313", "link": "https://stackoverflow.com/users/3067964/jwells131313"}, "is_accepted": true, "score": 2, "last_activity_date": 1536765217, "creation_date": 1536765217, "answer_id": 52298462, "question_id": 52297859, "link": "https://stackoverflow.com/questions/52297859/factory-functions-in-golang/52298462#52298462", "title": "Factory functions in Golang", "body": "<p>If you are using a DI system like <a href=\"https://github.com/jwells131313/dargo/\" rel=\"nofollow noreferrer\">Dargo</a> you can use its Provider injection to dynamically choose the implementation at runtime.</p>\n\n<p>In that case your services would look something like the following:</p>\n\n<pre><code>import \"github.com/jwells131313/dargo/ioc\"\n\ntype RateLimiter interface {\n}\n\ntype UserType1RateLimiter struct {\n}\n\ntype UserType2RateLimiter struct {\n}\n\ntype ComputeService struct {\n    RateLimiterProvider ioc.Provider `inject:\"RateLimiter\"`\n}\n\nfunc (svc ComputeService) Compute(userType string, data Data) (Result, error) {\n    // rate limit based on userType (both check and increment counter)\n    // if not rate limited, compute and return result\n    raw, err := svc.RateLimiterProvider.QualifiedBy(userType).Get()\n    if err != nil {\n        return nil, err\n    }\n\n    limiter := raw.(RateLimiter)\n    //...\n}  \n</code></pre>\n\n<p>This is how you would bind these into the ServiceLocator:</p>\n\n<pre><code>func initializer() {\n    serviceLocator, _ = ioc.CreateAndBind(\"ExampleLocator\", func(binder ioc.Binder) error {\n        binder.Bind(\"RateLimiter\", UserType1RateLimiter{}).QualifiedBy(\"UserType1\")\n        binder.Bind(\"RateLimiter\", UserType2RateLimiter{}).QualifiedBy(\"UserType2\")\n        binder.Bind(\"ComputeService\", ComputeService{})\n        return nil\n    })\n}\n</code></pre>\n\n<p>This only applies when you are using something like Dargo, but it still might be useful in your case.</p>\n\n<p>If you are not using Dargo it seems to me to be a matter of opinion, although I personally would choose the second approach</p>\n"}], "owner": {"reputation": 375, "user_id": 6935236, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hC8l2tY8XIY/AAAAAAAAAAI/AAAAAAAAABg/TZuFezYPtoc/photo.jpg?sz=128", "display_name": "Shivaprasad Bhat", "link": "https://stackoverflow.com/users/6935236/shivaprasad-bhat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 466, "favorite_count": 0, "closed_date": 1536769971, "accepted_answer_id": 52298462, "answer_count": 1, "score": 2, "last_activity_date": 1536765217, "creation_date": 1536763316, "question_id": 52297859, "link": "https://stackoverflow.com/questions/52297859/factory-functions-in-golang", "closed_reason": "Opinion-based", "title": "Factory functions in Golang", "body": "<p>I have a service object similar to the one shown below which is exposed through HTTP:</p>\n\n<pre><code>type ComputeService struct {\n\n}\n\nfunc (svc ComputeService) Compute(userType string, data Data) (Result, error) {\n   // rate limit based on userType (both check and increment counter)\n   // if not rate limited, compute and return result\n}\n</code></pre>\n\n<p>Now, as you can see rate-limiting needs to be done based on <code>userType</code>. Implementation of rate limiter itself changes according to <code>userType</code>. I am thinking of 2 approaches of resolving the rate limiter using <code>userType</code>.</p>\n\n<pre><code>// First approach: for each request new ComputeService object is\n// created after resolving RateLimiter using userType in the handler\n// itself\ntype ComputeService struct {\n    RateLimiter RateLimiter\n}\n\n// Second approach: ComputeService object is initialized during startup\n// and only RateLimiter is resolved with every Compute() call by calling\n// the provider function\ntype ComputeService struct {\n    RateLimiterProvider func(userType string) RateLimiter\n}\n</code></pre>\n\n<p>Both are testable. Which one would be preferable ? I'm leaning towards the 2nd approach since using it would mean that the handler will be purely read request, delegate to service, write out the response whereas in 1st approach, handler would contain additional step of resolving the rate limiter implementation.</p>\n"}, {"tags": ["c", "go", "system-calls"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 4, "creation_date": 1536761020, "post_id": 52297027, "comment_id": 91541954, "body": "What do you mean by a &quot;raw systemcall&quot;? Can you please elaborate? And please try to make your question self-contained by adding a <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable Example</a> or two."}, {"owner": {"reputation": 107137, "user_id": 364696, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7eBCp.jpg?s=128&g=1", "display_name": "ShadowRanger", "link": "https://stackoverflow.com/users/364696/shadowranger"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1536761278, "post_id": 52297027, "comment_id": 91542112, "body": "@JimB: It states that pure C calls are only 2244 ns/op though. You&#39;re looking at CGo (using native C interfaces from within Go) vs. Go, not Go vs. C."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1536761434, "post_id": 52297027, "comment_id": 91542220, "body": "@JimB we are comparing C and Go, not Cgo."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1536761453, "post_id": 52297027, "comment_id": 91542231, "body": "And how many times did you run your benchmarks?  How do you know how many times your test processes were swapped out during a test, or switched to another CPU core?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 2, "creation_date": 1536761728, "post_id": 52297027, "comment_id": 91542405, "body": "Maybe because you&#39;re comparing apples to pears?"}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1536761786, "post_id": 52297027, "comment_id": 91542455, "body": "@Jabberwocky Am I? Why?"}, {"owner": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1536761922, "post_id": 52297027, "comment_id": 91542551, "body": "@ChangkunOu not sure, but mabe the overhead is different? Perhaps you need to clarify the question and add more background information."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1536761969, "post_id": 52297027, "comment_id": 91542601, "body": "@AndrewHenle You should read the benchmark and running script."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1536762112, "post_id": 52297027, "comment_id": 91542724, "body": "@Someprogrammerdude You are saying nothing helpful. The code is provided in the link. You literally can run the benchmark with two lines of command (<code>git clone</code> and <code>sh run.sh</code>)"}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 40219, "user_id": 898348, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13b3f2c44ba8449bd60764d07f4538dc?s=128&d=identicon&r=PG", "display_name": "Jabberwocky", "link": "https://stackoverflow.com/users/898348/jabberwocky"}, "edited": false, "score": 0, "creation_date": 1536762289, "post_id": 52297027, "comment_id": 91542859, "body": "@Jabberwocky I added more background information regarding C system call and Go syscall in the description."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1536762741, "post_id": 52297027, "comment_id": 91543146, "body": "<i>You should read the benchmark and running script.</i>  I did.  So tell me, how many times did your benchmark processes get swapped out or switched to another CPU while running?  If you&#39;re going to benchmark things like this, you have to account for context switches and everything else that can pollute your results."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1536763108, "post_id": 52297027, "comment_id": 91543358, "body": "@AndrewHenle <i>how many times did your benchmark processes get swapped out or switched to another CPU while running?</i> You can profiling the benchmark your self. If I can do anything myself, why am I seeking insights here? The final result is an average based on <code>500000</code> times execution as you can see from the output of the benchmark. The average shows C system call is significantly faster than Go syscall."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 3, "creation_date": 1536763438, "post_id": 52297027, "comment_id": 91543561, "body": "Links can go stale, change, or disappear completely. That&#39;s why questions should be <i>self contained</i>. Otherwise they run the risk of becoming worthless. It&#39;s not only about helping you now, but helping other programmers with similar (or the same) problem in the future as well. If you need, then please (re-)read about <a href=\"http://stackoverflow.com/help/how-to-ask\">how to ask good questions</a>, as well as <a href=\"https://codeblog.jonskeet.uk/2012/11/24/stack-overflow-question-checklist/\" rel=\"nofollow noreferrer\">this question checklist</a>."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1536763575, "post_id": 52297027, "comment_id": 91543647, "body": "@Someprogrammerdude Thank you very much. I&#39;ve added all benchmarks in the question description, please help, thanks again."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 2, "creation_date": 1536764488, "post_id": 52297027, "comment_id": 91544213, "body": "<i>You can profiling the benchmark your self.</i> I&#39;m not the one <b>asking</b> for help.  The information you have given does not &quot;shows C system call is significantly faster than Go syscall&quot; at all. That may be true, but your data doesn&#39;t establish that. Something that fast can be perturbed by a lot of things the data you have collected doesn&#39;t account for. You can try to account for unknowns by running your benchmarks many times to see if the results are significant and consistent."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1536766372, "post_id": 52297027, "comment_id": 91545340, "body": "@AndrewHenle Well. Chart is added."}], "answers": [{"comments": [{"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1536766980, "post_id": 52298477, "comment_id": 91545676, "body": "A great explanation! I appreciate a lot. Thus there is no way to optimize and I must suffer that if I make massive IO calls, mustn&#39;t I?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1536768342, "post_id": 52298477, "comment_id": 91546471, "body": "Updated my answer to address your comment."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1537164667, "post_id": 52298477, "comment_id": 91667511, "body": "Hi, I managed your proposal, however, the benchmark shows the performance not even close to pure system calls (in description updates). Is there anything wrong with my benchmark?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1537206072, "post_id": 52298477, "comment_id": 91690862, "body": "Both the question and answer already accreted too much additional information, clearly displaying SO is not fit for solving it. Please post the question to <a href=\"https://groups.google.com/d/forum/golang-nuts\" rel=\"nofollow noreferrer\">the mailing list</a> instead. Please be sure to post <i>the question</i> (complete with a short summary of the insight provided by others, and your concerns left unsolved), not just drop a link to this discussion. Thanks."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 18, "last_activity_date": 1575829699, "last_edit_date": 1575829699, "creation_date": 1536765265, "answer_id": 52298477, "question_id": 52297027, "link": "https://stackoverflow.com/questions/52297027/go-syscall-v-s-c-system-call/52298477#52298477", "title": "Go syscall v.s. C system call", "body": "<blockquote>\n  <p>My benchmark shows, pure C system call is 15.82% faster than pure Go system call in the latest release (go1.11).</p>\n  \n  <p>What did I miss? What could be a reason and how to optimize them?</p>\n</blockquote>\n\n<p>The reason is that while both C and Go (on a typical platform Go supports\u2014such as Linux or *BSD or Windows) are compiled down to machine code, Go-native code runs in an environment quite different from that of C.</p>\n\n<p>The two chief differences to C are:</p>\n\n<ul>\n<li>Go code runs in the context of so-called goroutines which are freely scheduled by the Go runtime on different OS threads.</li>\n<li>Goroutines use their own (growable and <em>reallocatable)</em> lightweight stacks which have nothing to do with the OS-supplied stack C code uses.</li>\n</ul>\n\n<p>So, when Go code wants to make a syscall, quite a lot should happen:</p>\n\n<ol>\n<li>The goroutine which is about to enter a syscall must be \"pinned\" to the OS thread on which it's currently running.</li>\n<li>The execution must be switched to use the OS-supplied C stack.</li>\n<li>The necessary preparation in the Go runtime's scheduler are made.</li>\n<li>The goroutine enters the syscall.</li>\n<li>Upon exiting the execution of the goroutine has to be resumed, which is a relatively involved process in itself which may be additionaly hampered if the goroutine was <em>in</em> the syscall for too long and the scheduler removed the so-called \"processor\" from under that goroutine, spawned another OS thread and made that processor run another goroutine (\"processors\", or <code>P</code>s are thingies which run goroutines on OS threads).</li>\n</ol>\n\n<hr>\n\n<p><em>Update</em> to answer the OP's comment</p>\n\n<blockquote>\n  <p>&lt;\u2026> Thus there is no way to optimize and I must suffer that if I make massive IO calls, mustn't I?</p>\n</blockquote>\n\n<p>It heavily depends on the nature of the \"massive I/O\" you're after.</p>\n\n<p>If your example (with <code>socketpair(2)</code>) is not toy, there is simply no reason to use syscalls directly: the FDs returned by <code>socketpair(2)</code> are \"pollable\" and hence the Go runtime may use its native \"netpoller\" machinery to perform I/O on them. Here is a working code from one of my projects which properly \"wraps\" FDs produced by <code>socketpair(2)</code> so that they can be used as \"regular\" sockets (produced by functions from the <code>net</code> standard package):</p>\n\n<pre><code>func socketpair() (net.Conn, net.Conn, error) {\n       fds, err := syscall.Socketpair(syscall.AF_LOCAL, syscall.SOCK_STREAM, 0)\n       if err != nil {\n               return nil, nil, err\n       }\n\n       c1, err := fdToFileConn(fds[0])\n       if err != nil {\n               return nil, nil, err\n       }\n\n       c2, err := fdToFileConn(fds[1])\n       if err != nil {\n               c1.Close()\n               return nil, nil, err\n       }\n\n       return c1, c2, nil\n}\n\nfunc fdToFileConn(fd int) (net.Conn, error) {\n       f := os.NewFile(uintptr(fd), \"\")\n       defer f.Close()\n       return net.FileConn(f)\n}\n</code></pre>\n\n<p>If you're talking about some other sort of I/O, the answer is that yes, syscalls are not really cheap and if you <em>must</em> do lots of them, there are ways to work around their cost (such as offloading to some C code\u2014linked in or hooked up as an external process\u2014which would somehow <em>batch</em> them so that each call to that C code would result in several syscalls done by the C side).</p>\n"}], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3100, "favorite_count": 7, "accepted_answer_id": 52298477, "answer_count": 1, "score": 15, "last_activity_date": 1575829699, "creation_date": 1536760857, "last_edit_date": 1537164367, "question_id": 52297027, "link": "https://stackoverflow.com/questions/52297027/go-syscall-v-s-c-system-call", "title": "Go syscall v.s. C system call", "body": "<p>Go, and C both involve system calls directly (Technically, C will call a stub).</p>\n\n<blockquote>\n  <p>Technically, write is both a system call and a C function (at least on many systems). However, the C function is just a stub which invokes the system call. Go does not call this stub, it invokes the system call directly, which means that C is not involved here</p>\n  \n  <p>From <a href=\"https://stackoverflow.com/questions/52081841/differences-between-c-write-call-and-go-syscall-write\">Differences between C write call and Go syscall.Write</a></p>\n</blockquote>\n\n<p>My benchmark shows, pure C system call is 15.82% faster than pure Go system call in the latest release (go1.11).</p>\n\n<p>What did I miss? What could be a reason and how to optimize them?</p>\n\n<p>Benchmarks:</p>\n\n<p>Go:</p>\n\n<pre><code>package main_test\n\nimport (\n    \"syscall\"\n    \"testing\"\n)\n\nfunc writeAll(fd int, buf []byte) error {\n    for len(buf) &gt; 0 {\n        n, err := syscall.Write(fd, buf)\n        if n &lt; 0 {\n            return err\n        }\n        buf = buf[n:]\n    }\n    return nil\n}\n\nfunc BenchmarkReadWriteGoCalls(b *testing.B) {\n    fds, _ := syscall.Socketpair(syscall.AF_UNIX, syscall.SOCK_STREAM, 0)\n    message := \"hello, world!\"\n    buffer := make([]byte, 13)\n    for i := 0; i &lt; b.N; i++ {\n        writeAll(fds[0], []byte(message))\n        syscall.Read(fds[1], buffer)\n    }\n}\n</code></pre>\n\n<p>C:</p>\n\n<pre><code>#include &lt;time.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;sys/socket.h&gt;\n\nint write_all(int fd, void* buffer, size_t length) {\n    while (length &gt; 0) {\n        int written = write(fd, buffer, length);\n        if (written &lt; 0)\n            return -1;\n        length -= written;\n        buffer += written;\n    }\n    return length;\n}\n\nint read_call(int fd, void *buffer, size_t length) {\n    return read(fd, buffer, length);\n}\n\nstruct timespec timer_start(){\n    struct timespec start_time;\n    clock_gettime(CLOCK_PROCESS_CPUTIME_ID, &amp;start_time);\n    return start_time;\n}\n\nlong timer_end(struct timespec start_time){\n    struct timespec end_time;\n    clock_gettime(CLOCK_PROCESS_CPUTIME_ID, &amp;end_time);\n    long diffInNanos = (end_time.tv_sec - start_time.tv_sec) * (long)1e9 + (end_time.tv_nsec - start_time.tv_nsec);\n    return diffInNanos;\n}\n\nint main() {\n    int i = 0;\n    int N = 500000;\n    int fds[2];\n    char message[14] = \"hello, world!\\0\";\n    char buffer[14] = {0};\n\n    socketpair(AF_UNIX, SOCK_STREAM, 0, fds);\n    struct timespec vartime = timer_start();\n    for(i = 0; i &lt; N; i++) {\n        write_all(fds[0], message, sizeof(message));\n        read_call(fds[1], buffer, 14);\n    }\n    long time_elapsed_nanos = timer_end(vartime);\n    printf(\"BenchmarkReadWritePureCCalls\\t%d\\t%.2ld ns/op\\n\", N, time_elapsed_nanos/N);\n}\n</code></pre>\n\n<p>340 different running, each C running contains 500000 executions, and each Go running contains b.N executions (mostly 500000, few times executed in 1000000 times):</p>\n\n<p><a href=\"https://i.stack.imgur.com/MVOvW.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/MVOvW.png\" alt=\"enter image description here\"></a></p>\n\n<p>T-Test for 2 Independent Means: The t-value is -22.45426. The p-value is &lt; .00001. The result is significant at p &lt; .05.</p>\n\n<p><a href=\"https://i.stack.imgur.com/fnCFT.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/fnCFT.png\" alt=\"enter image description here\"></a></p>\n\n<p>T-Test Calculator for 2 Dependent Means: The value of t is 15.902782. The value of p is &lt; 0.00001. The result is significant at p \u2264 0.05.</p>\n\n<p><a href=\"https://i.stack.imgur.com/XTZmc.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/XTZmc.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<p>Update: I managed the proposal in the answers and wrote another benchmark, it shows the proposed approach significantly drops the performance of massive I/O calls, its performance close to CGO calls.</p>\n\n<p>Benchmark:</p>\n\n<pre><code>func BenchmarkReadWriteNetCalls(b *testing.B) {\n    cs, _ := socketpair()\n    message := \"hello, world!\"\n    buffer := make([]byte, 13)\n    for i := 0; i &lt; b.N; i++ {\n        cs[0].Write([]byte(message))\n        cs[1].Read(buffer)\n    }\n}\n\nfunc socketpair() (conns [2]net.Conn, err error) {\n    fds, err := syscall.Socketpair(syscall.AF_LOCAL, syscall.SOCK_STREAM, 0)\n    if err != nil {\n        return\n    }\n    conns[0], err = fdToFileConn(fds[0])\n    if err != nil {\n        return\n    }\n    conns[1], err = fdToFileConn(fds[1])\n    if err != nil {\n        conns[0].Close()\n        return\n    }\n    return\n}\n\nfunc fdToFileConn(fd int) (net.Conn, error) {\n    f := os.NewFile(uintptr(fd), \"\")\n    defer f.Close()\n    return net.FileConn(f)\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/IcdWm.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/IcdWm.png\" alt=\"enter image description here\"></a></p>\n\n<p>The above figure shows, 100 different running, each C running contains 500000 executions, and each Go running contains b.N executions (mostly 500000, few times executed in 1000000 times)</p>\n"}, {"tags": ["go", "wrapper", "lib"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1536758678, "post_id": 52296250, "comment_id": 91540400, "body": "Do you &quot;have&quot; to?  Well, that depends on how you want your package to work. If your real question is &quot;Is there an automatic way to do this?&quot; The answer is no.  In theory, it could be done with some code generation, but I&#39;m not aware of any tools that do that, and asking for such a tool would be off-topic, unfortunately."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1536822978, "last_edit_date": 1536822978, "creation_date": 1536758861, "answer_id": 52296378, "question_id": 52296250, "link": "https://stackoverflow.com/questions/52296250/reassigning-constants-when-creating-wrapper-library-in-go/52296378#52296378", "title": "Reassigning constants when creating wrapper library in Go", "body": "<p>There is no \"package embedding\", so constants from <code>lib</code> will not magically appear to be constants of <code>mylib</code>. If you want to provide those same constants in <code>mylib</code>, yes, you have to provide (copy) all those.</p>\n\n<blockquote>\n  <p>but what if this library has a ton of constants ?</p>\n</blockquote>\n\n<p>Then on your mission to provide a wrapper for such a library that has a ton of constants, you also have to provide a ton of constants yourself (if the users of <code>mylib</code> do need all those constants).</p>\n\n<p>If you want to mimic the complete functionality of <code>lib</code>, that raises the question whether you really need this, and wouldn't it be simpler to just use <code>lib</code> instead of <code>mylib</code>.</p>\n\n<p>Note that you may create a utility that would generate a <code>.go</code> source file for <code>mylib</code> that would \"copy\" all exported constants of <code>lib</code>. Check out the <a href=\"https://golang.org/pkg/go/parser/\" rel=\"nofollow noreferrer\"><code>go/parser</code></a> package for a starting point.</p>\n"}], "owner": {"reputation": 3597, "user_id": 7946807, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UkEte.png?s=128&g=1", "display_name": "Schidu Luca", "link": "https://stackoverflow.com/users/7946807/schidu-luca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 52296378, "answer_count": 1, "score": 1, "last_activity_date": 1536909094, "creation_date": 1536758476, "last_edit_date": 1536909094, "question_id": 52296250, "link": "https://stackoverflow.com/questions/52296250/reassigning-constants-when-creating-wrapper-library-in-go", "title": "Reassigning constants when creating wrapper library in Go", "body": "<p>So I want to create my own wrapper library from already existing lib A.\nLibrary A has some functions and also some constants, example:</p>\n\n<pre><code>package lib\n\n\nconst(\n   HeaderA = \"headerA\"\n   HeaderB = \"headerB\"\n)\n\nfunc doWork(string header) {\n   // some work\n}\n</code></pre>\n\n<p>Now the question is: Do I have to reassign these constants in my own library ? </p>\n\n<pre><code>package mylib\nconst (\n    myHeaderA = lib.HeaderA\n    myHeaderB = lib.HeaderB\n)\n</code></pre>\n\n<p>What is the best practice in this case ? It seems ok to reassign them in order to make the user unaware of lib A, but what if this library has a ton of constants ? </p>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "module"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 6, "creation_date": 1536758117, "post_id": 52296086, "comment_id": 91539961, "body": "Don&#39;t use relative imports."}, {"owner": {"reputation": 679, "user_id": 1016771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca8fd7158817a17bf51e0f4af7cd932?s=128&d=identicon&r=PG", "display_name": "nahsh", "link": "https://stackoverflow.com/users/1016771/nahsh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536759267, "post_id": 52296086, "comment_id": 91540804, "body": "Did that too. got an error. I changed the import to <code>application&#47;aLocalPackage</code> and got <code>cannot find module for path application&#47;aLocalPackage</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536761719, "post_id": 52296086, "comment_id": 91542394, "body": "Where is you go.mod? Show its content. Note that &quot;module builds&quot; inside GOPATH are off by default. Read go help modules."}, {"owner": {"reputation": 679, "user_id": 1016771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca8fd7158817a17bf51e0f4af7cd932?s=128&d=identicon&r=PG", "display_name": "nahsh", "link": "https://stackoverflow.com/users/1016771/nahsh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536762307, "post_id": 52296086, "comment_id": 91542873, "body": "go.mod is under <code>application&#47;</code>. its content is just <code>module application</code> + some requires. I did run <code>export GO111MODULE=on</code>"}, {"owner": {"reputation": 679, "user_id": 1016771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca8fd7158817a17bf51e0f4af7cd932?s=128&d=identicon&r=PG", "display_name": "nahsh", "link": "https://stackoverflow.com/users/1016771/nahsh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536817833, "post_id": 52296086, "comment_id": 91561889, "body": "It&#39;s working for me now, kind of... I can&#39;t use prometheus client with vgo (some packages are not loaded) so I dropped vgo from my project for now. Thanks anyway!"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536829483, "post_id": 52296086, "comment_id": 91567428, "body": "Can you explain what is vgo is?"}, {"owner": {"reputation": 679, "user_id": 1016771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca8fd7158817a17bf51e0f4af7cd932?s=128&d=identicon&r=PG", "display_name": "nahsh", "link": "https://stackoverflow.com/users/1016771/nahsh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536832034, "post_id": 52296086, "comment_id": 91569018, "body": "vgo was adopted into golang 1.11: <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536841031, "post_id": 52296086, "comment_id": 91574114, "body": "Ah, Russ&#39; demo implementation!. No need to use vgo anymore."}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 1, "last_activity_date": 1564515086, "creation_date": 1564515086, "answer_id": 57278850, "question_id": 52296086, "link": "https://stackoverflow.com/questions/52296086/golang-modules-and-local-packages/57278850#57278850", "title": "golang modules and local packages", "body": "<p>Relative import paths are not supported in module mode. You will need to update your <code>import</code> statements to use a full (absolute) import path.</p>\n\n<p>You should also choose a module name other than <code>application</code>. Your module path should generally begin with a URL prefix that you control \u2014 either your own domain name, or a unique path such as <code>github.com/$USER/$REPO</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3906, "user_id": 624395, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/202bfd99f4900ed88a72e4c1721dbe95?s=128&d=identicon&r=PG", "display_name": "Marco", "link": "https://stackoverflow.com/users/624395/marco"}, "edited": false, "score": 0, "creation_date": 1579619467, "post_id": 58754175, "comment_id": 105822106, "body": "You might find this blog interesting. <a href=\"https://marcofranssen.nl/manage-go-tools-via-go-modules/\" rel=\"nofollow noreferrer\">marcofranssen.nl/manage-go-tools-via-go-modules</a> that is how I managed in some of my projects."}], "tags": [], "owner": {"reputation": 3365, "user_id": 1569204, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/bd0db7459f9940095b1518fa7ec32a72?s=128&d=identicon&r=PG", "display_name": "Bruce Adams", "link": "https://stackoverflow.com/users/1569204/bruce-adams"}, "is_accepted": false, "score": 0, "last_activity_date": 1573475182, "last_edit_date": 1573475182, "creation_date": 1573147862, "answer_id": 58754175, "question_id": 52296086, "link": "https://stackoverflow.com/questions/52296086/golang-modules-and-local-packages/58754175#58754175", "title": "golang modules and local packages", "body": "<p>I had some problems working with local packages myself. \nThere are two tricks to make it work:</p>\n\n<ol>\n<li>you run \"go build\" in the package directory</li>\n</ol>\n\n<p>This compiles the package and places it in the build cache.\nThis link about <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">code organisation in go</a> explains more.\nYou can identify where the cache is using:</p>\n\n<pre><code>&gt;go env GOCACHE\n/home/&lt;user&gt;/.cache/go-build\n</code></pre>\n\n<ol start=\"2\">\n<li>Import using a path relative to the project</li>\n</ol>\n\n<p>I puzzled loads over what the correct import path was and finally discovered that <code>go doc</code> or <code>go list</code> will tell you.</p>\n\n<pre><code>&gt;go doc\npackage docs // import \"tools/src/hello/docs\"\n&gt;go list\ntools/src/hello/docs\n</code></pre>\n\n<p>For example. I have a hello world API project and was using <a href=\"https://github.com/swaggo\" rel=\"nofollow noreferrer\">swaggo</a> to generate documentation which it does in a <code>docs</code> sub-directory.\nTo use it I add an import:</p>\n\n<pre><code>_ \"tools/src/hello/docs\"\n</code></pre>\n\n<p>For my case the _ is important as docs is not used directly but we its init() function to be invoked.</p>\n\n<p>Now in <code>hello/main.go</code> I can add <code>\"tools/src/hello/docs\"</code> and it will import the correct package.</p>\n\n<p>The path is relative to the location of go.mod if you have one.\nI have tools/ here as I have a go.mod declaring \"modules tools\".</p>\n\n<p>Modules are a different kettle of fish - see <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules</a>.\nRecent versions of go (1.11 and later) can create a <code>go.mod</code> file which you may use to fix the version of a module that is used and avoid go's crazy default behaviour of just downloading the latest version of any package you import.</p>\n"}, {"tags": [], "owner": {"reputation": 3906, "user_id": 624395, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/202bfd99f4900ed88a72e4c1721dbe95?s=128&d=identicon&r=PG", "display_name": "Marco", "link": "https://stackoverflow.com/users/624395/marco"}, "is_accepted": false, "score": 1, "last_activity_date": 1585312098, "last_edit_date": 1585312098, "creation_date": 1579619385, "answer_id": 59844002, "question_id": 52296086, "link": "https://stackoverflow.com/questions/52296086/golang-modules-and-local-packages/59844002#59844002", "title": "golang modules and local packages", "body": "<p>I have written a blogpost on how to start your first Go project using modules.</p>\n\n<p><a href=\"https://marcofranssen.nl/start-on-your-first-golang-project/\" rel=\"nofollow noreferrer\">https://marcofranssen.nl/start-on-your-first-golang-project/</a></p>\n\n<p>In general it boils down to just create a new folder somewhere on your system (doesn't have to be in GOPATH).</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>mkdir my-project\ncd my-project\ngo mod init github.com/you-user/my-project\n</code></pre>\n\n<p>This will create the go.mod file. Now you can simply create your project layout and start building whatever you like.</p>\n\n<p>Maybe one of my other blogs can inspire you a bit more on how to do things.</p>\n\n<p><a href=\"https://marcofranssen.nl/categories/software-development/golang/\" rel=\"nofollow noreferrer\">https://marcofranssen.nl/categories/software-development/golang/</a></p>\n"}], "owner": {"reputation": 679, "user_id": 1016771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca8fd7158817a17bf51e0f4af7cd932?s=128&d=identicon&r=PG", "display_name": "nahsh", "link": "https://stackoverflow.com/users/1016771/nahsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3148, "favorite_count": 1, "answer_count": 3, "score": 7, "last_activity_date": 1585312098, "creation_date": 1536757966, "last_edit_date": 1580288212, "question_id": 52296086, "link": "https://stackoverflow.com/questions/52296086/golang-modules-and-local-packages", "title": "golang modules and local packages", "body": "<p>I'm trying to understand how to organize my golang project using go1.11 modules. I tried several options, but none of them worked.</p>\n\n<p>I have some code in the main package under the application folder and a local package that the main package uses.</p>\n\n<pre><code>$GOPATH\n+ src\n  + application/\n    + main/\n      + main.go\n      + otherFileUnderMainPackage.go\n    + aLocalPackage/\n      + someCode.go\n      + someCode_test.go\n      + someMoreCode.go\n      + someMoreCode_test.go\n</code></pre>\n\n<p>Files in the main package, imports <code>../aLocalPackage</code>. When I compile by <code>go build main/*.go</code> it's working.</p>\n\n<p>Then, I ran <code>go mod init application: V.0.9.9</code> and got the go.mod file, but the build always fails. I always get error about not finding the local package: <code>build application:V0.9.9/main: cannot find module for path _/.../src/application/aLocalPackage</code>. I also tried to place the local package right under src/, place it under main/ etc. but none of these methods worked for me.</p>\n\n<p>What is the way to use modules and local packages?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["http", "go", "logging"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1536753447, "post_id": 52294334, "comment_id": 91536754, "body": "Unfortunately, this is not possible, since <code>*log.Logger</code> is a concrete type. The closest you can do is use a logger that logs to your own <code>io.Writer</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1536754086, "post_id": 52294334, "comment_id": 91537176, "body": "There is <a href=\"https://github.com/golang/go/issues/13182\" rel=\"nofollow noreferrer\">a proposal</a> to make log.Logger an interface, which would make this much easier."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536762986, "post_id": 52294334, "comment_id": 91543282, "body": "How do you want to transform the single error message logged by <code>net&#47;http</code> to <code>message</code> and <code>keyAndValues</code> which are the parameters of <code>SugaredLogger.Errorw()</code>?"}, {"owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536763610, "post_id": 52294334, "comment_id": 91543670, "body": "@icza, I am going to skip <code>keyAndValues</code>. I would like to pass only <code>message</code> from <code>net&#47;http</code>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1536768250, "last_edit_date": 1536768250, "creation_date": 1536763990, "answer_id": 52298092, "question_id": 52294334, "link": "https://stackoverflow.com/questions/52294334/net-http-set-custom-logger/52298092#52298092", "title": "net/http set custom logger", "body": "<p>This is easily doable, because the <a href=\"https://golang.org/pkg/log/#Logger\" rel=\"nofollow noreferrer\"><code>log.Logger</code></a> type guarantees that each log message is delivered to the destination <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a> with a single <code>Writer.Write()</code> call:</p>\n\n<blockquote>\n  <p>Each logging operation makes a single call to the Writer's Write method. A Logger can be used simultaneously from multiple goroutines; it guarantees to serialize access to the Writer.</p>\n</blockquote>\n\n<p>So basically you just need to create a type which implements <code>io.Writer</code>, and whose <code>Write()</code> method simply calls your logger.</p>\n\n<p>Here's a simple implementation which does that:</p>\n\n<pre><code>type fwdToZapWriter struct {\n    logger *zap.SugaredLogger\n}\n\nfunc (fw *fwdToZapWriter) Write(p []byte) (n int, err error) {\n    fw.logger.Errorw(string(p))\n    return len(p), nil\n}\n</code></pre>\n\n<p>And that's all. You can \"install\" this writer at your <code>http.Server</code> like this:</p>\n\n<pre><code>server := &amp;http.Server{\n    Addr:     addr,\n    Handler:  handler,\n    ErrorLog: logger.New(&amp;fwdToZapWriter{logger}, \"\", 0),\n}\n</code></pre>\n\n<p><code>logger</code> in the above example is from your example: <code>logger, err := cfg.Build()</code></p>\n\n<p>If you want, you can just as easily forward to your <code>AppLogger</code> instead of <code>logger</code>.</p>\n\n<p>See similar question: <a href=\"https://stackoverflow.com/questions/40396499/go-create-io-writer-inteface-for-logging-to-mongodb-database/40397008#40397008\">Go: Create io.Writer inteface for logging to mongodb database</a></p>\n"}, {"tags": [], "owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "is_accepted": false, "score": 1, "last_activity_date": 1579653509, "creation_date": 1579653509, "answer_id": 59851157, "question_id": 52294334, "link": "https://stackoverflow.com/questions/52294334/net-http-set-custom-logger/59851157#59851157", "title": "net/http set custom logger", "body": "<p>You can use <code>zap.NewStdLog()</code> to get a new instance of a <code>*log.Logger</code>.</p>\n\n<p><a href=\"https://godoc.org/go.uber.org/zap#NewStdLog\" rel=\"nofollow noreferrer\">https://godoc.org/go.uber.org/zap#NewStdLog</a></p>\n\n<pre><code>logger := zap.NewExample()\ndefer logger.Sync()\n\nstd := zap.NewStdLog(logger)\nstd.Print(\"standard logger wrapper\")\n\n// Output:\n// {\"level\":\"info\",\"msg\":\"standard logger wrapper\"}\n</code></pre>\n"}], "owner": {"reputation": 8341, "user_id": 3014866, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/epfow.jpg?s=128&g=1", "display_name": "Rudzianko\u016d", "link": "https://stackoverflow.com/users/3014866/rudzianko%c5%ad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1323, "favorite_count": 2, "accepted_answer_id": 52298092, "answer_count": 2, "score": 4, "last_activity_date": 1579653509, "creation_date": 1536752617, "last_edit_date": 1536761763, "question_id": 52294334, "link": "https://stackoverflow.com/questions/52294334/net-http-set-custom-logger", "title": "net/http set custom logger", "body": "<p>I would like to log errors from net/http in my own format. In net/http package I have found <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\">Server</a> struct:</p>\n\n<pre><code>type Server struct {\n        //...\n        ErrorLog *log.Logger\n}\n</code></pre>\n\n<p>I would like to substitute logger with my own implementation:</p>\n\n<pre><code>type AppLogger struct {\n    log *zap.SugaredLogger\n}\n\nfunc (l *AppLogger) Error(message string, keyAndValues ...interface{}) {\n    l.log.Errorw(message, keyAndValues...)\n}\n</code></pre>\n\n<p>What is the correct way of implementing this?</p>\n\n<hr>\n\n<p><strong>Update:</strong></p>\n\n<p>I have <a href=\"https://github.com/uber-go/zap\" rel=\"nofollow noreferrer\">zap</a> logger with following config:</p>\n\n<pre><code>cfg := zap.Config{\n    Encoding:         encoding,\n    Level:            zap.NewAtomicLevelAt(zap.DebugLevel),\n    OutputPaths:      []string{\"stdout\"},\n    ErrorOutputPaths: []string{\"stdout\"},\n    EncoderConfig:    encCfg,\n}\nlogger, err := cfg.Build()\n</code></pre>\n\n<p>It configured to write in json format. I would like errors from <code>net/http</code> be written in the same way as zap. I create following:</p>\n\n<pre><code>type serverJsonWriter struct {\n    io.Writer\n}\n\n// ListenAndServeTLS - with custom log Writer\nfunc ListenAndServeTLS(addr, certFile, keyFile string, handler http.Handler) error {\n    server := &amp;http.Server{\n        Addr: addr,\n        Handler: handler,\n        ErrorLog: logger.New(serverJsonWriter{}, \"\", 0),\n    }\n}\n\nfunc (w serverJsonWriter) Write(p []byte) (n int, err error){\n    // {\"error\":{\"type\":\"net/http error\",\"message\":\"header too long\"}}\n}\n</code></pre>\n\n<p><strong>Questions:</strong></p>\n\n<ol>\n<li>What should be the body of <code>serverJsonWriter</code> method?</li>\n<li>Should I retrieve <code>zap</code> io.Writer in order to pass it <code>log.Logger</code>? How to do this?</li>\n</ol>\n"}, {"tags": ["json", "go", "struct", "nested", "unmarshalling"], "comments": [{"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 0, "creation_date": 1536752603, "post_id": 52294027, "comment_id": 91536264, "body": "Why do you have bools in <code>A</code> but strings in the JSON? If you had matching types, then you wouldn&#39;t need to write an unmarshaller at all. Perhaps you can have a method for <code>A</code> that returns the boolean value based on the string values that it already has?"}, {"owner": {"reputation": 31, "user_id": 9801381, "user_type": "registered", "profile_image": "https://graph.facebook.com/1576193345763164/picture?type=large", "display_name": "Alex Bungiu", "link": "https://stackoverflow.com/users/9801381/alex-bungiu"}, "reply_to_user": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 0, "creation_date": 1536753341, "post_id": 52294027, "comment_id": 91536684, "body": "@svsd this is just a sample, we receive a string from our front-end but we need a struct that we identify by that string on back-end. Unfortunately, matching types is not an option here."}, {"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 0, "creation_date": 1536755404, "post_id": 52294027, "comment_id": 91537950, "body": "(1) Make B embed another struct C which contains the fields not contained in A (2) Write an UnmarshalJSON() method for B which unmarshals the same JSON into both B.A and B.C. See <a href=\"https://play.golang.org/p/roF6hKZJ8Bc\" rel=\"nofollow noreferrer\">play.golang.org/p/roF6hKZJ8Bc</a>  The advantage of defining another type C with the fields not in A is that you can delegate unmarshalling it to the <code>json</code> package. (assuming that you have contraints preventing you from matching the types in A and the JSON)"}, {"owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "edited": false, "score": 0, "creation_date": 1536802462, "post_id": 52294027, "comment_id": 91558289, "body": "Just added an answer based on the comment since the question is no longer marked as a duplicate."}], "answers": [{"tags": [], "owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "is_accepted": true, "score": 1, "last_activity_date": 1536802388, "creation_date": 1536802388, "answer_id": 52305457, "question_id": 52294027, "link": "https://stackoverflow.com/questions/52294027/golang-structure-doesnt-unmarshal-properly-when-using-a-custom-unmarshal-for-a/52305457#52305457", "title": "GoLang structure doesn&#39;t unmarshal properly when using a custom unmarshal for a nested struct", "body": "<p>Since <code>B</code> embeds <code>A</code>, <code>A.UnmarshalJSON()</code> is exposed as <code>B.UnmarshalJSON()</code>. Due to that, <code>B</code> implements <code>json.Unmarshaler</code> and as a result <code>json.Unmarshal()</code> calls <code>B.UnmarshalJSON()</code> which only unmarshal's <code>A</code>'s fields. That's the reason <code>B.Z</code> does not get set from the JSON.</p>\n\n<p>This is the easiest way I could think of to get it working in accordance with your constraint of not changing the data types in <code>A</code>:</p>\n\n<ol>\n<li>Make B embed another struct C which contains the fields not contained in A.</li>\n<li>Write an UnmarshalJSON() method for B which unmarshals the same JSON into both B.A and B.C. The advantage of defining another type C with the fields not in A is that you can delegate unmarshalling it to the json package.</li>\n</ol>\n\n<p>With the new <code>B.UnmarshalJSON()</code> method, you now have full control to unmarshal the fields outside of <code>A</code> as well. </p>\n\n<pre><code>type A struct {\n    X bool `json:\"x\"`\n    Y bool `json:\"y\"`\n}\n\nfunc (a *A) UnmarshalJSON(bytes []byte) error {\n    // the special unmarshalling logic here\n}\n\ntype C struct {\n    Z int `json:\"z\"`\n}\n\ntype B struct {\n    A\n    C\n}\n\nfunc (b *B) UnmarshalJSON(bytes []byte) error {\n    if err := json.Unmarshal(bytes, &amp;b.A); err != nil {\n        return err\n    }\n    if err := json.Unmarshal(bytes, &amp;b.C); err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 9801381, "user_type": "registered", "profile_image": "https://graph.facebook.com/1576193345763164/picture?type=large", "display_name": "Alex Bungiu", "link": "https://stackoverflow.com/users/9801381/alex-bungiu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 801, "favorite_count": 0, "accepted_answer_id": 52305457, "answer_count": 1, "score": 2, "last_activity_date": 1536802388, "creation_date": 1536751497, "last_edit_date": 1536753916, "question_id": 52294027, "link": "https://stackoverflow.com/questions/52294027/golang-structure-doesnt-unmarshal-properly-when-using-a-custom-unmarshal-for-a", "title": "GoLang structure doesn&#39;t unmarshal properly when using a custom unmarshal for a nested struct", "body": "<p>We need to use a custom unmarshaler for a struct nested in multiple other structs which don't require a custom unmarshaler. We have lots of structs similar to <code>B</code> struct defined below (similar as in nesting <code>A</code>). The code's output is <code>true false 0</code> (expected <code>true false 2</code>). Any ideas?</p>\n\n<hr>\n\n<p>Go Playground example <a href=\"https://play.golang.org/p/JYBLR5klMnO\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype A struct {\n    X bool `json:\"x\"`\n    Y bool `json:\"y\"`\n}\n\ntype B struct {\n    A\n    Z int `json:\"z\"`\n}\n\nfunc (a *A) UnmarshalJSON(bytes []byte) error {\n    var aa struct {\n        X string `json:\"x\"`\n        Y string `json:\"y\"`\n    }\n    json.Unmarshal(bytes, &amp;aa)\n\n    a.X = aa.X == \"123\"\n    a.Y = aa.Y == \"abc\"\n    return nil\n}\n\nconst myJSON = `{\"x\": \"123\", \"y\": \"fff\", \"z\": 2}`\n\nfunc main() {\n    var b B\n    json.Unmarshal([]byte(myJSON), &amp;b)\n    fmt.Print(b.X,\" \",b.Y,\" \",b.Z)\n}\n</code></pre>\n\n<hr>\n\n<p>EDIT: question was marked as duplicate <a href=\"https://stackoverflow.com/questions/38982445/json-unmarshal-embedded-struct\">here</a> but making <code>A</code> an explicit field will make our API cluttered. Also after making <code>A</code> an explicit field the result is <code>false false 2</code> so it does not help at all.</p>\n"}, {"tags": ["go", "gnupg", "pgp", "openpgp"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1536743954, "post_id": 52291669, "comment_id": 91531167, "body": "If I&#39;m not mistaken, the results <i>should not</i> be identical, as there&#39;s an element of randomness in every signature."}, {"owner": {"reputation": 33721, "user_id": 695343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KX04R.jpg?s=128&g=1", "display_name": "Jens Erat", "link": "https://stackoverflow.com/users/695343/jens-erat"}, "edited": false, "score": 0, "creation_date": 1536744349, "post_id": 52291669, "comment_id": 91531414, "body": "And there are timestamps included."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 8166781, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-MIYaGripKqA/AAAAAAAAAAI/AAAAAAAAC8k/n1w98zGgwss/photo.jpg?sz=128", "display_name": "Peeter Piegaze", "link": "https://stackoverflow.com/users/8166781/peeter-piegaze"}, "edited": false, "score": 0, "creation_date": 1536746196, "post_id": 52292002, "comment_id": 91532589, "body": "Ok. Thanks. I didn&#39;t realize that."}, {"owner": {"reputation": 39, "user_id": 8166781, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-MIYaGripKqA/AAAAAAAAAAI/AAAAAAAAC8k/n1w98zGgwss/photo.jpg?sz=128", "display_name": "Peeter Piegaze", "link": "https://stackoverflow.com/users/8166781/peeter-piegaze"}, "edited": false, "score": 0, "creation_date": 1536748608, "post_id": 52292002, "comment_id": 91534034, "body": "One question: Is the original text recoverable from the output of gpg --sign?"}, {"owner": {"reputation": 33721, "user_id": 695343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KX04R.jpg?s=128&g=1", "display_name": "Jens Erat", "link": "https://stackoverflow.com/users/695343/jens-erat"}, "reply_to_user": {"reputation": 39, "user_id": 8166781, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-MIYaGripKqA/AAAAAAAAAAI/AAAAAAAAC8k/n1w98zGgwss/photo.jpg?sz=128", "display_name": "Peeter Piegaze", "link": "https://stackoverflow.com/users/8166781/peeter-piegaze"}, "edited": false, "score": 0, "creation_date": 1536788186, "post_id": 52292002, "comment_id": 91555256, "body": "Please don&#39;t ask unrelated follow-up questions in comments. Also be aware this definitely leaves the scope of Stack Overflow, consider asking on Security Stack Exchange or Super User instead."}], "tags": [], "owner": {"reputation": 33721, "user_id": 695343, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/KX04R.jpg?s=128&g=1", "display_name": "Jens Erat", "link": "https://stackoverflow.com/users/695343/jens-erat"}, "is_accepted": false, "score": 3, "last_activity_date": 1536744928, "creation_date": 1536744928, "answer_id": 52292002, "question_id": 52291669, "link": "https://stackoverflow.com/questions/52291669/equivalent-of-gpg-sign-in-golang/52292002#52292002", "title": "Equivalent of gpg --sign in golang?", "body": "<p>You cannot compare signatures based on a binary diff; they <a href=\"https://tools.ietf.org/html/rfc4880#section-5.9\" rel=\"nofollow noreferrer\">include timestamps</a>. Furthermore, you might apply different compression and signature algorithms. Compare the output of <code>gpg --list-packets</code> or <code>pgpdump</code> instead.</p>\n\n<p>Looking at a rather arbitrary signature:</p>\n\n<pre><code>$ echo foo | gpg --sign | gpg --list-packets\n</code></pre>\n\n<p>Here, you might be using different compression algorithms (or none at all, here: 1):</p>\n\n<pre><code># off=0 ctb=a3 tag=8 hlen=1 plen=0 indeterminate\n:compressed packet: algo=1\n</code></pre>\n\n<p>The signature packet might use different digest algorithms (here: <code>10</code>):</p>\n\n<pre><code># off=2 ctb=90 tag=4 hlen=2 plen=13\n:onepass_sig packet: keyid 8E78E44DFB1B55E9\n    version 3, sigclass 0x00, digest 10, pubkey 1, last=1\n</code></pre>\n\n<p>Here we have a timestamp:</p>\n\n<pre><code># off=17 ctb=cb tag=11 hlen=2 plen=10 new-ctb\n:literal data packet:\n    mode b (62), created 1536744536, name=\"\",\n    raw data: 4 bytes\n</code></pre>\n\n<p>And another timestamp (the signing algorithm should be the same for the same key):</p>\n\n<pre><code># off=29 ctb=89 tag=2 hlen=3 plen=563\n:signature packet: algo 1, keyid 8E78E44DFB1B55E9\n    version 4, created 1536744536, md5len 0, sigclass 0x00\n    digest algo 10, begin of digest f4 03\n    hashed subpkt 33 len 21 (issuer fpr v4 292F04A99AA52EC6F3088C608E78E44DFB1B55E9)\n    hashed subpkt 2 len 4 (sig created 2018-09-12)\n    subpkt 16 len 8 (issuer key ID 8E78E44DFB1B55E9)\n    data: [4096 bits]\n</code></pre>\n\n<p>By diffing the output of <code>gpg --list-packets</code>, you should be able to understand whether there is any noteworthy difference in the output. If you're using the same algorithms and fake the time, you should be able to get the same output.</p>\n\n<p>The constants/magic numbers mentioned above are also defined in <a href=\"https://tools.ietf.org/html/rfc4880#section-9\" rel=\"nofollow noreferrer\">RFC 4880, OpenPGP</a>.</p>\n"}], "owner": {"reputation": 39, "user_id": 8166781, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-MIYaGripKqA/AAAAAAAAAAI/AAAAAAAAC8k/n1w98zGgwss/photo.jpg?sz=128", "display_name": "Peeter Piegaze", "link": "https://stackoverflow.com/users/8166781/peeter-piegaze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1003, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1536744928, "creation_date": 1536743896, "question_id": 52291669, "link": "https://stackoverflow.com/questions/52291669/equivalent-of-gpg-sign-in-golang", "title": "Equivalent of gpg --sign in golang?", "body": "<p>I currently have a Perl script that performs a PGP sign on an email address to produce an obfuscated token. The Perl script uses the command line utility GPG version 2.2.8 (on MacOS). I would like to convert this functionality to Go.</p>\n\n<p>The relevant line in Perl:</p>\n\n<pre><code>my $token = `printf $emailaddress | gpg --sign -u myprivatekeyname | base64`;\n</code></pre>\n\n<p>My attempt in Go:</p>\n\n<pre><code>import (\n    \"golang.org/x/crypto/openpgp\"\n    \"log\"\n    \"fmt\"\n    \"strings\"\n    \"bytes\"\n    )\n\n\nconst privateKey = `-----BEGIN PGP PRIVATE KEY BLOCK-----\n&lt;the same private key as is used by the GPG tool&gt;\n-----END PGP PRIVATE KEY BLOCK-----`\n\nfunc main() {\n    email := \"bob@foo.com\"\n    token := makeToken(email)\n    fmt.Println(token)\n}\n\nfunc getPrivateKey() *openpgp.Entity {\n    pp := \"mypassphrase\"\n    ppb := []byte(pp)\n\n    entitylist, err := openpgp.ReadArmoredKeyRing(strings.NewReader(privateKey))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    entity := entitylist[0]\n\n    if entity.PrivateKey != nil &amp;&amp; entity.PrivateKey.Encrypted {\n        err := entity.PrivateKey.Decrypt(ppb)\n        if err != nil {\n            fmt.Println(\"Failed to decrypt key\")\n        }\n    }\n\n    for _, subkey := range entity.Subkeys {\n        if subkey.PrivateKey != nil &amp;&amp; subkey.PrivateKey.Encrypted {\n            err := subkey.PrivateKey.Decrypt(ppb)\n            if err != nil {\n                fmt.Println(\"Failed to decrypt subkey\")\n            }\n        }\n    }\n    return entity\n}\n\nfunc makeToken(email string) string {\n    pk := getPrivateKey()\n    out := new(bytes.Buffer)\n    in, err := openpgp.Sign(out, pk, nil, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    in.Write([]byte(email))\n    in.Close()\n    return base64.StdEncoding.EncodeToString(out.Bytes())\n}\n</code></pre>\n\n<p>Unfortunately the results for a given email addresss (like 'bob@foo.com') are not identical. </p>\n\n<p>I am using the same private key: I exported it from GPG and pasted it into my go code (obviously this is just for testing, I won't leave it like that).</p>\n\n<p>Any idea what Iam doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536742515, "post_id": 52291156, "comment_id": 91530220, "body": "Use a slice as the first argument. Why is this confusing?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536742570, "post_id": 52291156, "comment_id": 91530251, "body": "What type of slice i have used to make a query. means what correction should be there"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1536742716, "creation_date": 1536742716, "answer_id": 52291278, "question_id": 52291156, "link": "https://stackoverflow.com/questions/52291156/how-to-solve-the-first-argument-must-be-slice-when-appending-the-data/52291278#52291278", "title": "How to solve the first argument must be slice when appending the data", "body": "<p>Right now you're passing an <code>interface{}</code>, as you can see from <a href=\"https://godoc.org/labix.org/v2/mgo/bson#M\" rel=\"nofollow noreferrer\">the definition of bson.M</a>. So you need to assert that to some type of slice.</p>\n\n<p>You're assigning a slice of type <code>[]bson.M</code> to the value earlier, so just assert that type. Example:</p>\n\n<pre><code>    query[\"$or\"] = append(query[\"$or\"].([]bson.M), bson.M{\"author\": bson.RegEx{\"(?i).*\" + keyword + \".*\", \"i\"}})\n</code></pre>\n\n<p>what would probably be more readable, though, is to assign your calculated value at the end instead:</p>\n\n<pre><code>or := []bson.M{}\n// ...\n    or = append(or, ...)\n\nquery[\"$or\"] = or\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1611484959, "creation_date": 1536742295, "last_edit_date": 1611484959, "question_id": 52291156, "link": "https://stackoverflow.com/questions/52291156/how-to-solve-the-first-argument-must-be-slice-when-appending-the-data", "title": "How to solve the first argument must be slice when appending the data", "body": "<p>I'm making a query on the basis of the conditions but there is a error in the appending of them the query I'm making is:-</p>\n<pre><code>query := bson.M{}\nquery[&quot;$or&quot;] = []bson.M{}\nif keyword != &quot;&quot; {\n    query[&quot;$or&quot;] = append(query[&quot;$or&quot;], bson.M{&quot;author&quot;: bson.RegEx{&quot;(?i).*&quot; + keyword + &quot;.*&quot;, &quot;i&quot;}})\n    query[&quot;$or&quot;] = append(query[&quot;$or&quot;], bson.M{&quot;title&quot;: bson.RegEx{&quot;(?i).*&quot; + keyword + &quot;.*&quot;, &quot;i&quot;}})\n}\nif types == &quot;&quot; {\n    query[&quot;$or&quot;] = append(query[&quot;$or&quot;], bson.M{&quot;type&quot;: bson.RegEx{&quot;(?i).*&quot; + types + &quot;.*&quot;, &quot;i&quot;}})\n}\nif category == &quot;&quot; {\n    query[&quot;$or&quot;] = append(query[&quot;$or&quot;], bson.M{&quot;category&quot;: bson.RegEx{&quot;(?i).*&quot; + category + &quot;.*&quot;, &quot;i&quot;}})\n}\nif tag == &quot;&quot; {\n    query[&quot;$or&quot;] = append(query[&quot;$or&quot;], bson.M{&quot;tags&quot;: bson.RegEx{&quot;(?i).*&quot; + tag + &quot;.*&quot;, &quot;i&quot;}})\n}\nif len(ids) &gt; 0 {\n    query[&quot;_id&quot;] = bson.M{&quot;$in&quot;: ids}\n}\n</code></pre>\n<p>There is problem of appending the data with the <code>query[&quot;$or&quot;]</code>. The error comes out is:-</p>\n<blockquote>\n<p>first argument to append must be slice; have interface {}</p>\n<p>first argument to append must be slice; have interface {}</p>\n<p>first argument to append must be slice; have interface {}</p>\n<p>first argument to append must be slice; have interface {}</p>\n<p>first argument to append must be slice; have interface {}</p>\n</blockquote>\n<p>Can anyone tell me that how will I solve this problem.</p>\n"}, {"tags": ["javascript", "http", "go", "google-cloud-platform", "google-compute-engine"], "answers": [{"comments": [{"owner": {"reputation": 404, "user_id": 8462259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2476bb86b12efeceac2ccbccc0581fd?s=128&d=identicon&r=PG&f=1", "display_name": "G.D", "link": "https://stackoverflow.com/users/8462259/g-d"}, "edited": false, "score": 0, "creation_date": 1536754260, "post_id": 52292204, "comment_id": 91537291, "body": "Hi :) this doesn&#39;t change anything :/"}, {"owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "reply_to_user": {"reputation": 404, "user_id": 8462259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2476bb86b12efeceac2ccbccc0581fd?s=128&d=identicon&r=PG&f=1", "display_name": "G.D", "link": "https://stackoverflow.com/users/8462259/g-d"}, "edited": false, "score": 0, "creation_date": 1536762050, "post_id": 52292204, "comment_id": 91542659, "body": "Updated the answer @G.D."}], "tags": [], "owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "is_accepted": false, "score": 2, "last_activity_date": 1536761901, "last_edit_date": 1536761901, "creation_date": 1536745608, "answer_id": 52292204, "question_id": 52291137, "link": "https://stackoverflow.com/questions/52291137/connection-problems-between-two-google-compute-engine-instances/52292204#52292204", "title": "Connection problems between two Google compute engine instances", "body": "<p>Your VM only has a <a href=\"https://en.m.wikipedia.org/wiki/Private_network#Private_IPv4_addresses\" rel=\"nofollow noreferrer\">private IP address</a>. There is no way you can access this from your browser. You need to <a href=\"https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address\" rel=\"nofollow noreferrer\">assign a public IP address</a> to your VM and use that instead.</p>\n\n<hr>\n\n<p>Once that's fixed, you still need to make the request on the correct port. You are listening on port 8080 but in your request you don't specify a port, so it uses the default http port (80).</p>\n\n<p>Change your request to</p>\n\n<pre><code>function callGoServer(){\n  fetch('http://10.132.0.3:8080')\n    .then(response =&gt; response.json())\n    .then(json =&gt; console.log(json))\n}\n</code></pre>\n\n<p>or listen on port 80 instead.</p>\n"}], "owner": {"reputation": 404, "user_id": 8462259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2476bb86b12efeceac2ccbccc0581fd?s=128&d=identicon&r=PG&f=1", "display_name": "G.D", "link": "https://stackoverflow.com/users/8462259/g-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1536761901, "creation_date": 1536742225, "question_id": 52291137, "link": "https://stackoverflow.com/questions/52291137/connection-problems-between-two-google-compute-engine-instances", "title": "Connection problems between two Google compute engine instances", "body": "<p>I'm working on a webapp with Go and Javascript. I also use Google Compute Engine for serving my app. I have 3 VMs, one for my DB, on for the frontend and the last for the backend. I don't have any problem to recover datas from my DB with Go but when I'm try to send datas from Go to Javascript, I got this error message </p>\n\n<pre><code>GET http://10.132.0.3/ 0 ()    (index):10\n    callGoServer    @   (index):10\n    onclick @   (index):15\n\nUncaught (in promise) TypeError: Failed to fetch    (index):1 \n    Promise.then (async)        \n    callGoServer    @   (index):12\n    onclick @   (index):15\n</code></pre>\n\n<p>Here's my Go code</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"encoding/json\"\n    \"fmt\"\n    \"github.com/gorilla/handlers\"\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n\n    _ \"github.com/lib/pq\"\n)\n\n//Quote is a quote\ntype Quote struct {\n    ID     int `json:\"id\"`\n    Phrase string `json:\"phrase\"`\n    Author string `json:\"author\"`\n}\n\nvar db *sql.DB\n\nfunc init() {\n    var err error\n    db, err = sql.Open(\"postgres\", \"postgres://postgres:password@10.132.0.2:5432/quotes?sslmode=disable\")\n    if err != nil {\n        panic(err)\n    }\n\n    if err = db.Ping(); err != nil {\n        panic(err)\n    }\n    fmt.Println(\"You connected to your database\")\n}\n\nfunc getQuotes(w http.ResponseWriter, r *http.Request) {\n\n    if r.Method != \"GET\" {\n        http.Error(w, http.StatusText(405), http.StatusMethodNotAllowed)\n        return\n    }\n\n    rows, err := db.Query(\"SELECT id, phrase, author FROM citations ORDER BY RANDOM() LIMIT 1;\")\n    if err != nil {\n        http.Error(w, http.StatusText(500), 500)\n        return\n    }\n    defer rows.Close()\n\n    quotations := make([]Quote, 0)\n    for rows.Next() {\n        qt := Quote{}\n        err := rows.Scan(&amp;qt.ID, &amp;qt.Phrase, &amp;qt.Author)\n        if err != nil {\n            panic(err)\n        }\n        quotations = append(quotations, qt)\n    }\n    if err = rows.Err(); err != nil {\n        panic(err)\n    }\n\n    for _, qt := range quotations {\n        payload, _ := json.Marshal(qt)\n        w.Header().Add(\"Content-Type\", \"application/json\")\n        w.Write(payload)\n    }\n}\n\nfunc main() {\n    router:= mux.NewRouter()\n    router.HandleFunc(\"/\", getQuotes)\n    log.Fatal(http.ListenAndServe(\":8080\",handlers.CORS(handlers.AllowedHeaders([]string{\"X-Requested-With\", \"Content-Type\", \"Authorization\"}),handlers.AllowedMethods([]string{\"GET\",\"POST\",\"PUT\",\"DELETE\"}),handlers.AllowedOrigins([]string{\"*\"}))(router)))\n}\n</code></pre>\n\n<p>Here's my JS code</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n    &lt;head&gt;\n        &lt;meta charset=\"UTF-8\"&gt;\n        &lt;title&gt;Random quote&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;script type=\"text/javascript\" language=\"javascript\"&gt;\n            function callGoServer(){\n                fetch('http://10.132.0.3')\n                    .then(response =&gt; response.json())\n                    .then(json =&gt; console.log(json))\n            }\n        &lt;/script&gt;\n        &lt;button onclick=\"callGoServer()\"&gt;Click here&lt;/button&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>I've made a firewall rule on GCP that allow TCP protocol between my VM via port <code>5432</code> (postgresql) and <code>8080</code> (my go server)</p>\n\n<p>Does someone can help me ?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "dayofweek"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1536742176, "post_id": 52290915, "comment_id": 91530025, "body": "Use a map instead of an array (<a href=\"https://tour.golang.org/moretypes/19\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/19</a>), or a switch/case statement (<a href=\"https://tour.golang.org/flowcontrol/9\" rel=\"nofollow noreferrer\">tour.golang.org/flowcontrol/9</a>)."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1536742598, "last_edit_date": 1536742598, "creation_date": 1536741904, "answer_id": 52291045, "question_id": 52290915, "link": "https://stackoverflow.com/questions/52290915/show-the-next-day-of-the-week-in-golang/52291045#52291045", "title": "Show the next day of the week in golang", "body": "<p>Range over the array of days to get the value of its index. Check for the string passed and fetch the value of matched string index. Then use that index to get the value of next day:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar (\n    counter int\n    day     string\n)\n\nfunc main() {\n\n    var dag [7]string\n    dag[0] = \"Zondag\"\n    dag[1] = \"Maandag\"\n    dag[2] = \"Dinsdag\"\n    dag[3] = \"Woensdag\"\n    dag[4] = \"Donderdag\"\n    dag[5] = \"Vrijdag\"\n    dag[6] = \"Zaterdag\"\n\n    fmt.Println(\"Welke dag is het?\")\n    fmt.Scan(&amp;day)\n    for key, value := range dag {\n        if day == value {\n            counter = key\n        }\n    }\n    fmt.Println(counter)\n    if counter == 6 {\n        counter = 0\n        fmt.Println(dag[counter])\n    }\n\n    if counter != 6 {\n        counter = counter + 1\n        fmt.Println(dag[counter])\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/pwFiWxav72Z\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n\n<p>Or as Peter suggested you can use maps also which is more convenient and easy to use in this case:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    var value string\n    dag := make(map[string]string)\n    dag[\"Zondag\"] = \"Maandag\"\n    dag[\"Maandag\"] = \"Dinsdag\"\n    dag[\"Dinsdag\"] = \"Woensdag\"\n    dag[\"Woensdag\"] = \"Donderdag\"\n    dag[\"Donderdag\"] = \"Vrijdag\"\n    dag[\"Vrijdag\"] = \"Zaterdag\"\n\n    fmt.Println(\"Welke dag is het?\")\n    fmt.Scan(&amp;value)\n    fmt.Println(dag[value])\n}\n</code></pre>\n\n<p>Working code on <a href=\"https://play.golang.org/p/ngRT9wnRocr\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "is_accepted": false, "score": 0, "last_activity_date": 1536742633, "creation_date": 1536742633, "answer_id": 52291249, "question_id": 52290915, "link": "https://stackoverflow.com/questions/52290915/show-the-next-day-of-the-week-in-golang/52291249#52291249", "title": "Show the next day of the week in golang", "body": "<p>you can enumerate the array and transfer the number and the string</p>\n\n<pre><code>func GetNextDay(someday string){\n    for i, v := range dag{\n      if v == someday {\n          if i==6 {\n              i = 0\n          }else {\n             i = i + 1\n          }\n          return dag[i]\n      }\n    }\n    return \"no such day in a week\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 333, "user_id": 8989452, "user_type": "registered", "profile_image": "https://graph.facebook.com/1517851688282463/picture?type=large", "display_name": "Krzysztof Skolimowski", "link": "https://stackoverflow.com/users/8989452/krzysztof-skolimowski"}, "is_accepted": true, "score": 0, "last_activity_date": 1536743395, "last_edit_date": 1536743395, "creation_date": 1536742972, "answer_id": 52291368, "question_id": 52290915, "link": "https://stackoverflow.com/questions/52290915/show-the-next-day-of-the-week-in-golang/52291368#52291368", "title": "Show the next day of the week in golang", "body": "<p>What are you looking for are enums. In Go they can be implemented like this: </p>\n\n<pre><code>type Weekday int \n\nconst (\n   Sunday    Weekday = iota\n   Monday    \n   Tuesday   \n   Wednesday \n   Thursday  \n   Friday    \n   Saturday   \n)\n\nfunc (day Weekday) String() string {\n    // declare an array of strings\n    // ... operator counts how many\n    // items in the array (7)\n    names := [...]string{\n        \"Sunday\", \n        \"Monday\", \n        \"Tuesday\", \n        \"Wednesday\",\n        \"Thursday\", \n        \"Friday\", \n        \"Saturday\"}\n    // \u2192 `day`: It's one of the\n    // values of Weekday constants.    \n    // If the constant is Sunday,\n    // then day is 0.\n    // prevent panicking in case of\n    // `day` is out of range of Weekday\n    if day &lt; Sunday || day &gt; Saturday {\n      return \"Unknown\"\n    }\n    // return the name of a Weekday\n    // constant from the names array \n    // above.\n    return names[day]\n}\n\n// will display \"Sunday\"\nfmt.Println(Sunday)\n\n// will display \"Monday\"\nfmt.Println(Sunday + 1)\n</code></pre>\n\n<p>If you do not need int underlying type, you can create it like this:</p>\n\n<pre><code>const (\n    Sunday = \"Sunday\"\n     //...\n)\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 10352020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a392ebff53d4ebfefab59a34e89369a?s=128&d=identicon&r=PG&f=1", "display_name": "Wobelaar", "link": "https://stackoverflow.com/users/10352020/wobelaar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2069, "favorite_count": 1, "accepted_answer_id": 52291368, "answer_count": 3, "score": 0, "last_activity_date": 1536745727, "creation_date": 1536741477, "last_edit_date": 1536745727, "question_id": 52290915, "link": "https://stackoverflow.com/questions/52290915/show-the-next-day-of-the-week-in-golang", "title": "Show the next day of the week in golang", "body": "<p>I've just started my study IT and I thought it would be fun to make a little program that would show you what day it is tomorrow. Sadly I'm stuck. Currently it's working when you write the correct number from the array, but I would like it to work with a string. So when you write 'Maandag' (monday in Dutch), the program will answer Dinsdag (Tuesday in Dutch)</p>\n\n<p>This is my code so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    var counter int\n\n    var dag [7]string\n    dag[0] = \"Zondag\"\n    dag[1] = \"Maandag\"\n    dag[2] = \"Dinsdag\"\n    dag[3] = \"Woensdag\"\n    dag[4] = \"Donderdag\"\n    dag[5] = \"Vrijdag\"\n    dag[6] = \"Zaterdag\"\n\n    fmt.Println(\"Welke dag is het?\")\n    fmt.Scan(&amp;counter)\n\n    if counter == 6 {\n        counter = 0\n        fmt.Println(dag[counter])\n    }\n\n    if counter != 6 {\n        counter++\n        fmt.Println(dag[counter])\n    }\n}\n</code></pre>\n"}, {"tags": ["parsing", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536740032, "post_id": 52290372, "comment_id": 91528730, "body": "&quot;and I assume that [...] ReadString(&#39;\\n&#39;) will not read a string if it does not have the delimiting character at the end&quot;. Your assumption is wrong. See e.g. <a href=\"https://play.golang.org/p/Mc2D17Dovnh\" rel=\"nofollow noreferrer\">play.golang.org/p/Mc2D17Dovnh</a>"}, {"owner": {"reputation": 49, "user_id": 7741234, "user_type": "registered", "profile_image": "https://graph.facebook.com/1558292174426425/picture?type=large", "display_name": "TheApeMachine", "link": "https://stackoverflow.com/users/7741234/theapemachine"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536740430, "post_id": 52290372, "comment_id": 91528951, "body": "Hmm, you are right... There must be something else wrong then. It&#39;s strange, because as soon as I add a newline to the last line in the original file, everything works fine."}], "answers": [{"comments": [{"owner": {"reputation": 4165, "user_id": 3299397, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/HvJkt.jpg?s=128&g=1", "display_name": "Kyle Bridenstine", "link": "https://stackoverflow.com/users/3299397/kyle-bridenstine"}, "edited": false, "score": 0, "creation_date": 1597179192, "post_id": 52290681, "comment_id": 112048432, "body": "You should provide the code so others can reference this. I&#39;m having the same problem."}], "tags": [], "owner": {"reputation": 49, "user_id": 7741234, "user_type": "registered", "profile_image": "https://graph.facebook.com/1558292174426425/picture?type=large", "display_name": "TheApeMachine", "link": "https://stackoverflow.com/users/7741234/theapemachine"}, "is_accepted": true, "score": 0, "last_activity_date": 1536740659, "creation_date": 1536740659, "answer_id": 52290681, "question_id": 52290372, "link": "https://stackoverflow.com/questions/52290372/how-to-get-the-last-line-from-reader-readstring-if-there-is-no-newline-character/52290681#52290681", "title": "How to get the last line from reader.ReadString if there is no newline character", "body": "<p>Problem solved, I was breaking out of the loop before adding the last character to my obfuscated line. Moving the EOF handling to the bottom resolved it.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 14842608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da5364e1be4efbcaa3837b9551124911?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandre Henriet", "link": "https://stackoverflow.com/users/14842608/alexandre-henriet"}, "is_accepted": false, "score": 0, "last_activity_date": 1609003786, "creation_date": 1609003786, "answer_id": 65458929, "question_id": 52290372, "link": "https://stackoverflow.com/questions/52290372/how-to-get-the-last-line-from-reader-readstring-if-there-is-no-newline-character/65458929#65458929", "title": "How to get the last line from reader.ReadString if there is no newline character", "body": "<p>As I cannot comment yet, this is my answer to @Kyle Bridenstine</p>\n<p>I experimented the same issue with the following script (extract below) :\n<a href=\"https://github.com/setsuna-/golang/blob/master/mass_replace.go\" rel=\"nofollow noreferrer\">https://github.com/setsuna-/golang/blob/master/mass_replace.go</a></p>\n<p>By moving the error test from line 88 to line 93, the last line of source files ending by<br />\n} without a new line character are now correctly copied to the destination file.</p>\n<pre><code>bufr := bufio.NewReader(f1)\nbufr2 := bufio.NewWriter(f2)\nfor {\n    line, err := bufr.ReadString('\\n')\n    if strings.Contains(line, searchText) {\n        line = strings.Replace(line, searchText, replaceText, -1)\n        count++\n    }\n    bufr2.WriteString(line)\n    if err != nil {\n        break\n    }\n}\nbufr2.Flush()\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 7741234, "user_type": "registered", "profile_image": "https://graph.facebook.com/1558292174426425/picture?type=large", "display_name": "TheApeMachine", "link": "https://stackoverflow.com/users/7741234/theapemachine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 52290681, "answer_count": 2, "score": -4, "last_activity_date": 1609003786, "creation_date": 1536739540, "last_edit_date": 1536740030, "question_id": 52290372, "link": "https://stackoverflow.com/questions/52290372/how-to-get-the-last-line-from-reader-readstring-if-there-is-no-newline-character", "title": "How to get the last line from reader.ReadString if there is no newline character", "body": "<p>I've been writing this Php parser in Go, but I seem to have hit a little problem, which is that sometimes the final line is not added to the new file I am writing.</p>\n\n<p>Basically I go over the original Php file, do some obfuscating, and then write those obfuscated lines to a new file.</p>\n\n<p>Problem is that at times I run into a file that does not have a newline at the end, and I assume that <code>line, err := reader.ReadString('\\n')</code> will not read a string if it does not have the delimiting character at the end?</p>\n\n<p>Is there an easy solution for this that doesn't involve using Scanner, because a lot of the parsing code is dependent on interpreting newlines...</p>\n"}, {"tags": ["sql", "postgresql", "go", "notifications", "pg"], "comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 3, "creation_date": 1536737111, "post_id": 52289338, "comment_id": 91527073, "body": "<a href=\"https://www.postgresql.org/docs/10/static/sql-notify.html\" rel=\"nofollow noreferrer\">NOTIFY</a> and <a href=\"https://www.postgresql.org/docs/10/static/libpq-notify.html\" rel=\"nofollow noreferrer\">friends</a> might be of interest. AFAIK you&#39;d need to set up insert-triggers on the tables you want to watch and I&#39;m not sure how well any of this works with Go&#39;s PostgreSQL interface."}, {"owner": {"reputation": 107, "user_id": 2715821, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6e2c1f7817c37a0a912c3186b05d5eea?s=128&d=identicon&r=PG&f=1", "display_name": "Feralus", "link": "https://stackoverflow.com/users/2715821/feralus"}, "edited": false, "score": 0, "creation_date": 1536745604, "post_id": 52289338, "comment_id": 91532198, "body": "Take a look at Postgresql Listen/Notify feature.  <a href=\"https://www.postgresql.org/docs/9.3/static/sql-listen.html\" rel=\"nofollow noreferrer\">postgresql.org/docs/9.3/static/sql-listen.html</a> You can create a listener which sends a NOTIFY-Message to a channel. You can listen on that channel in golang."}], "answers": [{"tags": [], "owner": {"reputation": 107, "user_id": 2715821, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6e2c1f7817c37a0a912c3186b05d5eea?s=128&d=identicon&r=PG&f=1", "display_name": "Feralus", "link": "https://stackoverflow.com/users/2715821/feralus"}, "is_accepted": false, "score": 3, "last_activity_date": 1584546028, "last_edit_date": 1584546028, "creation_date": 1536748714, "answer_id": 52293191, "question_id": 52289338, "link": "https://stackoverflow.com/questions/52289338/how-can-i-catch-an-event-of-a-new-postgresql-record-with-golang/52293191#52293191", "title": "How can I catch an event of a new postgreSQL record with golang", "body": "<p>You can use <code>LISTEN/NOTIFY</code> features of Postgresql.</p>\n\n<p>With <code>\"github.com/lib/pq\"</code>, you can easily fetch notify-events and react to new database-events.</p>\n\n<p>Here is an <a href=\"https://play.golang.org/p/hOsU89oC6fS\" rel=\"nofollow noreferrer\">example</a> of the go implementation.</p>\n"}, {"tags": [], "owner": {"reputation": 336, "user_id": 8689468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZXP3.jpg?s=128&g=1", "display_name": "Mzia", "link": "https://stackoverflow.com/users/8689468/mzia"}, "is_accepted": true, "score": 2, "last_activity_date": 1584560511, "last_edit_date": 1584560511, "creation_date": 1536909990, "answer_id": 52326931, "question_id": 52289338, "link": "https://stackoverflow.com/questions/52289338/how-can-i-catch-an-event-of-a-new-postgresql-record-with-golang/52326931#52326931", "title": "How can I catch an event of a new postgreSQL record with golang", "body": "<p>Solved this using sql triggers and <code>go-pg</code> library:</p>\n\n<ol>\n<li><p>Create sql function called <code>insert_test_func</code>, that on <code>INSERT</code> do: </p>\n\n<pre><code>PERFORM pg_notify('mychan', 'Message');\n</code></pre></li>\n<li><p>Create trigger, that executes func: </p>\n\n<pre><code>create trigger check_insert \nbefore insert or update on *my_table_name*\nfor each row \nexecute procedure insert_test_func();\n</code></pre></li>\n<li><p>Execute this trigger</p></li>\n<li><p>With <code>github.com/go-pg/pg</code>, connect to the DB and with <code>pg.Listen()</code> listening to the channel for the <code>'Message'</code>.</p></li>\n</ol>\n"}], "owner": {"reputation": 336, "user_id": 8689468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZXP3.jpg?s=128&g=1", "display_name": "Mzia", "link": "https://stackoverflow.com/users/8689468/mzia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2307, "favorite_count": 1, "accepted_answer_id": 52326931, "answer_count": 2, "score": 4, "last_activity_date": 1584560511, "creation_date": 1536736009, "question_id": 52289338, "link": "https://stackoverflow.com/questions/52289338/how-can-i-catch-an-event-of-a-new-postgresql-record-with-golang", "title": "How can I catch an event of a new postgreSQL record with golang", "body": "<p>I have a script that connects to DB and can get data from it\nCan I somehow make it to notify me, when any new record is added to the DB table</p>\n"}, {"tags": ["c#", "go", "elixir", "phoenix-framework"], "answers": [{"comments": [{"owner": {"reputation": 1763, "user_id": 1175415, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9d2e16819b10749cd775f0dfc5db1635?s=128&d=identicon&r=PG", "display_name": "Hokutosei", "link": "https://stackoverflow.com/users/1175415/hokutosei"}, "edited": false, "score": 0, "creation_date": 1536740955, "post_id": 52289508, "comment_id": 91529292, "body": "thank you for the interest.. I have tried your suggestion but it is not what I want, or maybe I need to put the value to a map?"}, {"owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "reply_to_user": {"reputation": 1763, "user_id": 1175415, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9d2e16819b10749cd775f0dfc5db1635?s=128&d=identicon&r=PG", "display_name": "Hokutosei", "link": "https://stackoverflow.com/users/1175415/hokutosei"}, "edited": false, "score": 0, "creation_date": 1536741798, "post_id": 52289508, "comment_id": 91529806, "body": "To share the data from different processes you need to introduce an <code>Agent</code> and put your data there from your tasks."}, {"owner": {"reputation": 14904, "user_id": 2274224, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9095331a47468a6898495b05c49ee422?s=128&d=identicon&r=PG", "display_name": "Sascha Wolf", "link": "https://stackoverflow.com/users/2274224/sascha-wolf"}, "reply_to_user": {"reputation": 1763, "user_id": 1175415, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9d2e16819b10749cd775f0dfc5db1635?s=128&d=identicon&r=PG", "display_name": "Hokutosei", "link": "https://stackoverflow.com/users/1175415/hokutosei"}, "edited": false, "score": 0, "creation_date": 1536829855, "post_id": 52289508, "comment_id": 91567659, "body": "@Hokutosei what exactly does miss for you? The answer given by mudasobwa is correct and all you need."}, {"owner": {"reputation": 14904, "user_id": 2274224, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9095331a47468a6898495b05c49ee422?s=128&d=identicon&r=PG", "display_name": "Sascha Wolf", "link": "https://stackoverflow.com/users/2274224/sascha-wolf"}, "edited": false, "score": 0, "creation_date": 1536829898, "post_id": 52289508, "comment_id": 91567690, "body": "After the <code>Task.yield_many</code> you can simply continue to manipulate your data - for example using <code>Enum.reduce</code> to create a single map."}, {"owner": {"reputation": 1763, "user_id": 1175415, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9d2e16819b10749cd775f0dfc5db1635?s=128&d=identicon&r=PG", "display_name": "Hokutosei", "link": "https://stackoverflow.com/users/1175415/hokutosei"}, "edited": false, "score": 0, "creation_date": 1536833248, "post_id": 52289508, "comment_id": 91569769, "body": "sorry, I still can&#39;t achieve what I want. after trying what mudasobwa example, I got a list of tasks, and how to get it&#39;s values is just another question.. is there any other example I can look on? I am following this example now <a href=\"https://hexdocs.pm/elixir/Task.html#yield_many/2\" rel=\"nofollow noreferrer\">hexdocs.pm/elixir/Task.html#yield_many/2</a>"}], "tags": [], "owner": {"reputation": 105308, "user_id": 2035262, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/pPtKA.jpg?s=128&g=1", "display_name": "Aleksei Matiushkin", "link": "https://stackoverflow.com/users/2035262/aleksei-matiushkin"}, "is_accepted": false, "score": 1, "last_activity_date": 1536750476, "last_edit_date": 1536750476, "creation_date": 1536736606, "answer_id": 52289508, "question_id": 52289296, "link": "https://stackoverflow.com/questions/52289296/parallel-or-async-task-for-functions-in-elixir-from-golang-and-c/52289508#52289508", "title": "parallel or async task for functions in elixir from golang and c#", "body": "<p>I believe what you need is <a href=\"https://hexdocs.pm/elixir/Task.html#yield_many/2\" rel=\"nofollow noreferrer\"><code>Task.yield_many/2</code></a> and <a href=\"https://hexdocs.pm/elixir/Kernel.SpecialForms.html#for/1\" rel=\"nofollow noreferrer\"><code>Kernel.SpecialForms.for/1</code></a> to treat the result:</p>\n\n\n\n<pre class=\"lang-rb prettyprint-override\"><code>results = \n  1..3\n  |&gt; Enum.map(&amp;Task.async(fn -&gt; get_request(&amp;1) end))\n  |&gt; Task.yield_many()\n\nfor { _, {:ok, value}} &lt;- results, do: IO.inspect(value)\n</code></pre>\n"}], "owner": {"reputation": 1763, "user_id": 1175415, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/9d2e16819b10749cd775f0dfc5db1635?s=128&d=identicon&r=PG", "display_name": "Hokutosei", "link": "https://stackoverflow.com/users/1175415/hokutosei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 266, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536750476, "creation_date": 1536735857, "last_edit_date": 1536747800, "question_id": 52289296, "link": "https://stackoverflow.com/questions/52289296/parallel-or-async-task-for-functions-in-elixir-from-golang-and-c", "title": "parallel or async task for functions in elixir from golang and c#", "body": "<p>I am learning Elixir with Phoenix. I built a few REST API servers, easily, but there is one more requirement that I need to implement. I need to be able to do parallel or async tasks to call/execute some API from the Backend, and put those results to a JSON response.</p>\n\n<p>This is how I would implement it roughly from Go and C#</p>\n\n<pre><code>// Golang\nuserCount := make(chan int)\nusersList := make(chan []Users)\n\ngo getAggregateUserCounts(userCount)\ngo getGetUsersList(usersList)\n\n// do other heavy tasks from here\n\nhttpJsonResponse(map[string]interface{}{\n    \"test\":       1,\n    \"user_count\": &lt;-userCount,\n    \"users_list\": &lt;- usersList ,\n})\n\n\n\n// C# or dotnetcore\npublic async Task&lt;JsonResult&gt; GetJson(string dbName, string collection)\n{\n    using(var client = new MongoDBCon())\n    {\n        // some heavy computations\n        var documents = await col.FindAsync&lt;Users&gt;(FilterDefinition&lt;Users&gt;.Empty);\n        return Json(new {\n              users_count: await documents.ToListAsync().Result.Count,\n              users: await users.GetusersList()\n        });\n    }\n}\n</code></pre>\n\n<p>So far, this is what I have for elixir:</p>\n\n<pre><code>// Elixir\ndef start do\n  IO.puts \"starting..\"\n  response = %{}\n  1..3\n  |&gt; Enum.map(fn(id) -&gt; async_get_request(id) end)\n  |&gt; Enum.each(\n    fn(_) -&gt; \n      item = get_result()\n      IO.inspect :\"#{item[:user][:id]}\"\n      IO.inspect item[:user]\n\n      # Map.put(response, :\"#{item[:user][:id]}\", item[:user])\n    end)\n\n  IO.puts \"done..\"\n  IO.inspect response\nend\n\ndef start2 do\n  IO.puts \"start2..\"\n  res = %{\n    \"item\" =&gt; Task.async(fn -&gt; IO.puts \"weee\" end) \n  }\nend\n\ndef get_request(id) do\n  sleep = :rand.uniform(10)\n  :timer.sleep(sleep)  \n  %{user: %{id: id, sleep: sleep}}\nend  \n\ndef async_get_request(id) do\n  caller = self()\n  spawn(fn -&gt;  \n    send(caller, {:result, get_request(id)})  \n  end)      \nend\n\ndef get_result do\n  receive do\n    {:result, result} -&gt; result\n  end\nend\n</code></pre>\n\n<p>the result is</p>\n\n<pre><code>iex(3)&gt; Para.start\nstarting..\n%{id: 2, sleep: 1}\n%{id: 3, sleep: 3}\n%{id: 1, sleep: 9}\ndone..\n%{}\n</code></pre>\n\n<p>what I want is to have, is</p>\n\n<pre><code>%{\n id: 2, {id: 2, sleep: 1},\n id: 3, {id: 3, sleep: 3},\n id: 1, {id: 1, sleep: 9}\n }\n</code></pre>\n\n<p>The above example is just for learning or practice, but for real world, I would prefer adding values to the map by some parallel tasks.</p>\n\n<p>I'm not sure if this is even possible with elixir.</p>\n\n<pre><code> %{\n    \"users_count\": AsyncUsersModule.GetUsersTotal(),\n    \"users_list\": AsyncUsersModule.GetUsersList()\n }\n</code></pre>\n\n<p>and response in json should be</p>\n\n<pre><code>{\n  \"users_count\": 10000,\n  \"users_list\": []\n}\n</code></pre>\n\n<p>I know I still need lots of practice and reading, I just need some help.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 14053, "user_id": 2189130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/trlri.png?s=128&g=1", "display_name": "kmdreko", "link": "https://stackoverflow.com/users/2189130/kmdreko"}, "edited": false, "score": 0, "creation_date": 1536733183, "post_id": 52288549, "comment_id": 91524930, "body": "Not 100% sure what you&#39;re wanting, but mongodb has a <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#join-conditions-and-uncorrelated-sub-queries\" rel=\"nofollow noreferrer\">second $lookup form</a> (introduced in 3.6) that gives you more control over it by way of a sub-pipeline. That might be what you need..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "reply_to_user": {"reputation": 14053, "user_id": 2189130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/trlri.png?s=128&g=1", "display_name": "kmdreko", "link": "https://stackoverflow.com/users/2189130/kmdreko"}, "edited": false, "score": 0, "creation_date": 1536733493, "post_id": 52288549, "comment_id": 91525087, "body": "@kmdreko see the edited question"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "edited": false, "score": 0, "creation_date": 1536736938, "post_id": 52288947, "comment_id": 91526965, "body": "I make a query like you said but it does not works.Why?"}, {"owner": {"reputation": 14053, "user_id": 2189130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/trlri.png?s=128&g=1", "display_name": "kmdreko", "link": "https://stackoverflow.com/users/2189130/kmdreko"}, "edited": false, "score": 0, "creation_date": 1536738377, "post_id": 52288947, "comment_id": 91527813, "body": "<code>$match</code> should be the first stage (but it wouldn&#39;t affect results) in this case. What do you mean by doesn&#39;t work? Could you supply some sample data to make sure I&#39;ve made the right suggestions?"}], "tags": [], "owner": {"reputation": 14053, "user_id": 2189130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/trlri.png?s=128&g=1", "display_name": "kmdreko", "link": "https://stackoverflow.com/users/2189130/kmdreko"}, "is_accepted": false, "score": 0, "last_activity_date": 1536734575, "creation_date": 1536734575, "answer_id": 52288947, "question_id": 52288549, "link": "https://stackoverflow.com/questions/52288549/how-to-use-or-with-the-lookup-in-mongodb-query-using-go/52288947#52288947", "title": "How to use $or with the $lookup in mongodb query using go?", "body": "<p>If the fields you're filtering are on the root document, then the first stage should be a <code>$match</code> stage. So the pipeline will look like this:</p>\n\n<pre><code>{ $match: { $or: [...] } }, // your query\n{ $lookup: {...} },         // same as before\n{ $addFields: {...} }       // same as before\n</code></pre>\n\n<p>Its surprising your query doesn't return an error as <code>$or</code> is not an <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#join-conditions-and-uncorrelated-sub-queries\" rel=\"nofollow noreferrer\">aggregation pipeline stage</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 261, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536737270, "creation_date": 1536732748, "last_edit_date": 1536737270, "question_id": 52288549, "link": "https://stackoverflow.com/questions/52288549/how-to-use-or-with-the-lookup-in-mongodb-query-using-go", "title": "How to use $or with the $lookup in mongodb query using go?", "body": "<p>I want to get the data records from mongodb document using $or and $lookup.\nHere is a query I make for assertion:-</p>\n\n<pre><code>pipeline1 := []bson.M{\n    {\"$lookup\": bson.M{\"from\": \"comment\", \"localField\": \"_id\", \"foreignField\": \"blog_id\", \"as\": \"comments\"}},\n    {\"$addFields\": bson.M{\"comments\": bson.M{\"$size\": \"$comments\"}}},\n}\npipe1 := getCollection.Pipe(pipeline1)\n</code></pre>\n\n<p>In the above query it will first count the records and add the field with the particular data. But now I have a little change in the query is that now there are two more parameters i have to search with this using $or for regular expression I want that the function will doing the same thing but while getting the records if the user will entered any parameter then it will fetch the record by using that keyword and also make the count of that data.</p>\n\n<p><strong>Edited</strong></p>\n\n<p>I have to combined the above query with the below query:-</p>\n\n<pre><code>query[\"$or\"] = []bson.M{\n    bson.M{\"title\": bson.RegEx{\"(?i).*\" + value + \".*\", \"i\"}},\n    bson.M{\"type\": bson.RegEx{\"(?i).*\" + value + \".*\", \"i\"}},\n    bson.M{\"author\": bson.RegEx{\"(?i).*\" + value + \".*\", \"i\"}},\n    bson.M{\"tags\": bson.RegEx{\"(?i).*\" + value + \".*\", \"i\"}},\n}\n</code></pre>\n\n<p>I'm combining it like this but it return Nothing.</p>\n\n<pre><code>pipeline1 := []bson.M{\n    {\"$or\": []bson.M{\n        bson.M{\"_id\": bson.M{\"$in\": ids}},\n        bson.M{\"type\": bson.RegEx{\"(?i).*\" + types + \".*\", \"i\"}},\n        bson.M{\"category\": bson.RegEx{\"(?i).*\" + category + \".*\", \"i\"}},\n        bson.M{\"author\": bson.RegEx{\"(?i).*\" + keyword + \".*\", \"i\"}},\n        bson.M{\"title\": bson.RegEx{\"(?i).*\" + keyword + \".*\", \"i\"}},\n        bson.M{\"tags\": bson.RegEx{\"(?i).*\" + tag + \".*\", \"i\"}}}},\n    {\"$lookup\": bson.M{\"from\": \"comment\", \"localField\": \"_id\", \"foreignField\": \"blog_id\", \"as\": \"comments\"}},\n    {\"$addFields\": bson.M{\"comments\": bson.M{\"$size\": \"$comments\"}}},\n}\npipe1 := getCollection.Pipe(pipeline1)\n</code></pre>\n\n<p><strong>Latest Edit</strong></p>\n\n<p>AS @kmdreko say I make a similar like that but does not works:-</p>\n\n<pre><code> query := bson.M{}\nquery[\"$or\"] = []bson.M{\n    bson.M{\"_id\": bson.M{\"$in\": ids}},\n    bson.M{\"type\": bson.RegEx{\"(?i).*\" + types + \".*\", \"i\"}},\n    bson.M{\"category\": bson.RegEx{\"(?i).*\" + category + \".*\", \"i\"}},\n    bson.M{\"author\": bson.RegEx{\"(?i).*\" + keyword + \".*\", \"i\"}},\n    bson.M{\"title\": bson.RegEx{\"(?i).*\" + keyword + \".*\", \"i\"}},\n    bson.M{\"tags\": bson.RegEx{\"(?i).*\" + tag + \".*\", \"i\"}},\n}\nfmt.Println(query)\npipeline1 := []bson.M{\n    {\"$lookup\": bson.M{\"from\": \"comment\", \"localField\": \"_id\", \"foreignField\": \"blog_id\", \"as\": \"comments\"}},\n    {\"$addFields\": bson.M{\"comments\": bson.M{\"$size\": \"$comments\"}}},\n    {\"$match\": query},\n}\nfmt.Println(pipeline1)\npipe1 := getCollection.Pipe(pipeline1)\n</code></pre>\n"}, {"tags": ["json", "postgresql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 2869, "user_id": 975987, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/VsuyE.jpg?s=128&g=1", "display_name": "William Wino", "link": "https://stackoverflow.com/users/975987/william-wino"}, "edited": false, "score": 0, "creation_date": 1536731898, "post_id": 52288237, "comment_id": 91524329, "body": "If I store non-base64encoded bytes in the database, how does the json library convert it to json? Is it using a base64 encoding?"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 2869, "user_id": 975987, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/VsuyE.jpg?s=128&g=1", "display_name": "William Wino", "link": "https://stackoverflow.com/users/975987/william-wino"}, "edited": false, "score": 1, "creation_date": 1536732207, "post_id": 52288237, "comment_id": 91524464, "body": "It stores a <code>StoredFile</code> structure, right? So when you put it in your database, it&#39;s just inserting an entry to your <code>StoredFiles</code> table that contains two strings. Since your database doesn&#39;t know the difference between a slice of bytes and a string, it will just be inserted as two strings. There is no conversion or encoding made into base 64, no."}, {"owner": {"reputation": 2869, "user_id": 975987, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/VsuyE.jpg?s=128&g=1", "display_name": "William Wino", "link": "https://stackoverflow.com/users/975987/william-wino"}, "edited": false, "score": 0, "creation_date": 1536736909, "post_id": 52288237, "comment_id": 91526946, "body": "Alright, thanks for the answer. What is your suggestion on this? Should I just override the MarshalJSON and UnmarshalJSON? Or there is a tag for this?"}, {"owner": {"reputation": 2869, "user_id": 975987, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/VsuyE.jpg?s=128&g=1", "display_name": "William Wino", "link": "https://stackoverflow.com/users/975987/william-wino"}, "edited": false, "score": 0, "creation_date": 1536739182, "post_id": 52288237, "comment_id": 91528251, "body": "there is someone who says that it is encoded with base64 encoding: <a href=\"https://stackoverflow.com/questions/36465065/marshaling-json-byte-as-strings-in-go\" title=\"marshaling json byte as strings in go\">stackoverflow.com/questions/36465065/&hellip;</a>"}, {"owner": {"reputation": 5734, "user_id": 415628, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/84d8280499418f22f42778cc40c20a12?s=128&d=identicon&r=PG", "display_name": "Ezequiel Muns", "link": "https://stackoverflow.com/users/415628/ezequiel-muns"}, "edited": false, "score": 0, "creation_date": 1537956731, "post_id": 52288237, "comment_id": 91970146, "body": "If you wanted your data to be base64 encoded when in JSON format, and binary encoded when it&#39;s in the database, the best way is to create your own type (based on a <code>[]byte</code>), which implements the <code>driver.Valuer</code>, <code>sql.Scanner</code>, <code>json.Marshaler</code> and <code>json.Unmarshaler</code> interfaces."}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": false, "score": 1, "last_activity_date": 1536731306, "creation_date": 1536731306, "answer_id": 52288237, "question_id": 52287534, "link": "https://stackoverflow.com/questions/52287534/how-to-deal-with-byte-byte-array-with-base64-encoding-as-input/52288237#52288237", "title": "How to deal with []byte (byte array) with base64 encoding as input", "body": "<ol>\n<li><p>Yes, it considers your b64 string like plain text, because there's no way it can know that it's a base 64 string. So yes again, your size increase will still be there.</p></li>\n<li><p>The encoding depends on the table. If gorm is simply writing into an already existing table, it will use the encoding that is specified in the structure. For example:</p></li>\n</ol>\n\n<blockquote>\n<pre><code>CREATE TABLE `users` (\n  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `email` varchar(255) NOT NULL,\n  `password` varchar(255) NOT NULL,\n  `token_user_id` varchar(255) NOT NULL,\n  `is_admin` tinyint(4) NOT NULL DEFAULT '1',\n  PRIMARY KEY (`id`),\n  UNIQUE KEY (email)\n\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;\n</code></pre>\n</blockquote>\n\n<p>For this table, the <code>CHARSET</code> is <code>utf8mb4</code> so it would store using an UTF-8 encoding.</p>\n\n<p>If gorm is also responsible for creating the table however, I believe it uses <code>utf8</code> by default as the encoding, but I can't seem to find any source to back it up.</p>\n"}], "owner": {"reputation": 2869, "user_id": 975987, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/VsuyE.jpg?s=128&g=1", "display_name": "William Wino", "link": "https://stackoverflow.com/users/975987/william-wino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1049, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536743590, "creation_date": 1536726709, "last_edit_date": 1536743590, "question_id": 52287534, "link": "https://stackoverflow.com/questions/52287534/how-to-deal-with-byte-byte-array-with-base64-encoding-as-input", "title": "How to deal with []byte (byte array) with base64 encoding as input", "body": "<p>I want to send a json string with base64 encoded file in it from a client, basically it looks like this:</p>\n\n<pre><code>{  \n   \"data\":\"aGVscA==\",\n   \"filename\":\"file.txt\"\n}\n</code></pre>\n\n<p>And I wrote this struct:</p>\n\n<pre><code>type StoredFile struct {\n    Data     []byte `json:\"data\"`\n    Filename string `json:\"filename\"`\n}\n</code></pre>\n\n<p>Then I decode the json into the struct:</p>\n\n<pre><code>decoder := json.NewDecoder(request.Body)\nstoredFile := StoredFile{}\nerr := decoder.Decode(&amp;storedFile)\n</code></pre>\n\n<p>And save it with gorm:</p>\n\n<pre><code>db.Create(&amp;storedFile)\n</code></pre>\n\n<p>My question is:</p>\n\n<ol>\n<li>How do json package decode the base64 string to byte array? Does it\ntreat it like plain text, because I know that the data size will be\nincreased by 33% when it is encoded to base64 and if it is treated\nlike text the 33% increase will still be there right?</li>\n<li>What kind of encoding does gorm use when it stores []byte to\nPostgreSQL database? Is it UTF-8? If not, how do I set the encoding to UTF-8?</li>\n</ol>\n"}, {"tags": ["go", "methods"], "comments": [{"owner": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "edited": false, "score": 0, "creation_date": 1536726784, "post_id": 52287499, "comment_id": 91522808, "body": "Rather than sending all the ids in the query string, have you considered sending them in the <code>body</code> and submitting it as a <code>POST</code> ? Since, you&#39;re going to be querying the database with those <code>ids</code>, I would prefer sending them in the body, and it won&#39;t expose them in the URL. You could make it look like <code>localhost:8080&#47;names</code>, in the <b>request body</b> - <code>{&quot;user_ids&quot;: [1, 2, 3, 4]}</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "reply_to_user": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "edited": false, "score": 1, "creation_date": 1536727457, "post_id": 52287499, "comment_id": 91522969, "body": "@KedarnagMukanahallipatna I don&#39;t I don&#39;t think that there is post method is used because we are getting the records."}, {"owner": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "edited": false, "score": 0, "creation_date": 1536727875, "post_id": 52287499, "comment_id": 91523079, "body": "<code>POST</code> is meant to store something and <code>GET</code> is to retrieve, however, <code>POST</code> is more secure in a way where <i>request payload is not logged by the server</i>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "reply_to_user": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "edited": false, "score": 0, "creation_date": 1536727949, "post_id": 52287499, "comment_id": 91523101, "body": "@KedarnagMukanahallipatna But here I want to retrieve the records sir thats why I&#39;m telling this"}, {"owner": {"reputation": 103, "user_id": 6640820, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/665585763b05fec8f3e0a5f5ec88f34f?s=128&d=identicon&r=PG&f=1", "display_name": "avenged_badger", "link": "https://stackoverflow.com/users/6640820/avenged-badger"}, "edited": false, "score": 1, "creation_date": 1536746798, "post_id": 52287499, "comment_id": 91532951, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4541338/how-to-construct-a-rest-api-that-takes-an-array-of-ids-for-the-resources\">How to construct a REST API that takes an array of id&#39;s for the resources</a>"}], "answers": [{"tags": [], "owner": {"reputation": 474, "user_id": 4063201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/uU5YK.png?s=128&g=1", "display_name": "monirz", "link": "https://stackoverflow.com/users/4063201/monirz"}, "is_accepted": false, "score": 1, "last_activity_date": 1536736740, "creation_date": 1536736740, "answer_id": 52289551, "question_id": 52287499, "link": "https://stackoverflow.com/questions/52287499/what-method-is-used-to-get-multiple-ids-from-postman-using-golang/52289551#52289551", "title": "What method is used to Get multiple Ids from postman using golang", "body": "<p>Surely you can do it <code>GET</code> method. And it depends on how you are dealing with the <code>ids</code>, the best way to do it would be sending the values as an array. Something like this </p>\n\n<p><code>localhost:8080/name?ids=[1,2,3,4]\n</code>\nThen you can retrieve that ids with something like this:</p>\n\n<pre><code>ids := r.URL.Query().Get(\"ids\")\nlog.Println(ids)\n</code></pre>\n\n<p>And you will get the data like this <code>[1,2,3,3]</code>, but again it depends on how you are dealing with the data.  </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1029, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1536736740, "creation_date": 1536726410, "question_id": 52287499, "link": "https://stackoverflow.com/questions/52287499/what-method-is-used-to-get-multiple-ids-from-postman-using-golang", "title": "What method is used to Get multiple Ids from postman using golang", "body": "<p>Here I want to fetch the multiple IDs from the postman and I'm confuse which  method (POST, GET, PUT, DELETE) should I have to use for this. From these IDs I have to retrieve the data from database.</p>\n\n<p>Can I use <code>Get</code> method and using <code>query string</code> then the url will be </p>\n\n<pre><code>localhost:8080/name?ids=1,2,3,4\n</code></pre>\n\n<p>Can anyone please tell me that I'm thinking is right or not and If not, then  What should I have to used for this.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536726776, "post_id": 52287035, "comment_id": 91522805, "body": "This implementation, is also supposed to work when there are structs within structs correct? it fails there. There is  a way of doing this using <a href=\"https://github.com/fatih/structs\" rel=\"nofollow noreferrer\">github.com/fatih/structs</a>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 1, "creation_date": 1536728626, "post_id": 52287035, "comment_id": 91523278, "body": "@whitespace OP&#39;s code works with the type in question and this type has nested structs."}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1536728929, "post_id": 52287035, "comment_id": 91523350, "body": "@ThunderCat, I think you misunderstood my concern. I am not talking about first level copy. I think, question is still valid for structs which have structs inside them, where the nested structs have some fields I would want to copy and some fields I don&#39;t want to copy."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536729381, "post_id": 52287035, "comment_id": 91523472, "body": "@whitespace The OP may want to selectively copy within nested structs, but the question does not ask for that feature, nor is that feature needed in all possible uses of the function.  Sebastian, do you want to selectively copy within nested structs or do you want to copy nested selects wholesale?"}, {"owner": {"reputation": 929, "user_id": 6146337, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207160730031528/picture?type=large", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/6146337/sebastian"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536758511, "post_id": 52287035, "comment_id": 91540259, "body": "@whitespace selectively copying fields within nested structs is beyond the scope of my original question. Maybe someone will have that question down the road however. It could add to the robustness of this code or be part of another question."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536768756, "post_id": 52287035, "comment_id": 91546703, "body": "This doesn&#39;t seem to be a question so much as a request for code review, which belongs on codereview.stackexchange.com."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 3, "last_activity_date": 1536728252, "last_edit_date": 1536728252, "creation_date": 1536728011, "answer_id": 52287699, "question_id": 52287035, "link": "https://stackoverflow.com/questions/52287035/selectively-copy-go-struct-fields/52287699#52287699", "title": "Selectively copy go struct fields", "body": "<p>The code will panic if the arguments are not pointers to structs. There'a check for a pointer, but not for a pointer to a struct.  Add this code:</p>\n\n<pre><code>srcVal := reflect.ValueOf(src).Elem()\nif srcVal.Kind() != reflect.Struct {\n    return errors.New(\"arguments must be pointers to structs\")\n}\n</code></pre>\n\n<p>Because the function is starting with a pointer to a struct, the fields are guaranteed to be settable. Because the field values are obtained from a valid struct value, the fields are guaranteed to be valid. Fields can be accessed by index in addition to by name.  Given this, the inner loop can be simplified to:</p>\n\n<pre><code>for i := 0; i &lt; srcVal.NumField(); i++ {\n    s := srcType.Field(i)\n    if tag := s.Tag.Get(\"update\"); tag == \"\" {\n        continue\n    }\n    dstVal.Field(i).Set(srcVal.Field(i))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/JNBJrBBlHxQ\" rel=\"nofollow noreferrer\">Run it on the playground</a></p>\n"}], "owner": {"reputation": 929, "user_id": 6146337, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207160730031528/picture?type=large", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/6146337/sebastian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 3, "answer_count": 1, "score": 1, "last_activity_date": 1536728252, "creation_date": 1536722563, "question_id": 52287035, "link": "https://stackoverflow.com/questions/52287035/selectively-copy-go-struct-fields", "title": "Selectively copy go struct fields", "body": "<p>I wanted a way to <strong>selectively</strong> copy Go fields from one struct to another. This allows me to <em>update</em> data from one struct to another without changing certain information. Here's the solution I came up with. It depends on setting a tag field of \"update\". Would appreciate any feedback for making this more robust or better or maybe why this is just a bad idea to begin with.</p>\n\n<pre><code>import (\n    \"errors\"\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc UpdateStruct(src, dst interface{}) error {\n    if reflect.TypeOf(src) != reflect.TypeOf(dst) {\n        return errors.New(\"structs not of same type\")\n    }\n\n    if reflect.ValueOf(src).Kind() != reflect.Ptr {\n        return errors.New(\"arguments must be pointers\")\n    }\n\n    srcVal := reflect.ValueOf(src).Elem()\n    srcType := srcVal.Type()\n\n    dstVal := reflect.ValueOf(dst).Elem()\n\n    for i := 0; i &lt; srcVal.NumField(); i++ {\n        s := srcType.Field(i)\n        if tag := s.Tag.Get(\"update\"); tag == \"\" {\n            continue\n        }\n        fieldName := srcType.Field(i).Name\n        d := dstVal.FieldByName(fieldName)\n        if d.IsValid() {\n            if d.CanSet() {\n                d.Set(srcVal.Field(i))\n            } else {\n                return fmt.Errorf(\"cannot set field: %s\", fieldName)\n            }\n        } else {\n            return fmt.Errorf(\"invalid field: %s\", fieldName)\n        }\n\n    }\n    return nil\n}\n</code></pre>\n\n<p>example struct:</p>\n\n<pre><code>type Tester struct {\n    ID      string\n    Name    string    `update:\"true\"`\n    Date    time.Time `update:\"true\"`\n    Decimal float64   `update:\"true\"`\n    Number  int       `update:\"true\"`\n    CaseID  uuid.UUID `update:\"true\"`\n}\n</code></pre>\n"}, {"tags": ["go", "flags"], "comments": [{"owner": {"reputation": 5875, "user_id": 2702398, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87402651ed56717034035915b95c1ae0?s=128&d=identicon&r=PG&f=1", "display_name": "oakad", "link": "https://stackoverflow.com/users/2702398/oakad"}, "edited": false, "score": 0, "creation_date": 1536721654, "post_id": 52286439, "comment_id": 91521770, "body": "On a side note: consider checking out an alternative CLI library with first class subcommand support, if you can afford it. In my experience, &quot;mov.cli&quot; is substantially more efficient and easier to use in complex cases (multiple levels of subcommands, etc: <a href=\"https://github.com/jawher/mow.cli\" rel=\"nofollow noreferrer\">github.com/jawher/mow.cli</a>)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5875, "user_id": 2702398, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/87402651ed56717034035915b95c1ae0?s=128&d=identicon&r=PG&f=1", "display_name": "oakad", "link": "https://stackoverflow.com/users/2702398/oakad"}, "edited": false, "score": 0, "creation_date": 1536768845, "post_id": 52286439, "comment_id": 91546751, "body": "@oakad per the question, that&#39;s exactly what OP is not trying to do."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10350504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0265892e1f658c9f8b2953592aab73d6?s=128&d=identicon&r=PG&f=1", "display_name": "gonn00b", "link": "https://stackoverflow.com/users/10350504/gonn00b"}, "edited": false, "score": 0, "creation_date": 1536722595, "post_id": 52286974, "comment_id": 91521938, "body": "Thank you for the response. The reason I used <code>FlagSet</code> is in the hope that the <code>pflag</code> library would enforce that all flags in the <code>FlagSet</code> would appear together. What you suggested definitely works. But enforcing that all three should appear together would be the responsibility of my code, correct?"}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "reply_to_user": {"reputation": 11, "user_id": 10350504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0265892e1f658c9f8b2953592aab73d6?s=128&d=identicon&r=PG&f=1", "display_name": "gonn00b", "link": "https://stackoverflow.com/users/10350504/gonn00b"}, "edited": false, "score": 0, "creation_date": 1536724328, "post_id": 52286974, "comment_id": 91522250, "body": "No, using <code>FlagSet</code> will not ensure that all flags are set. What it ensures is you have a group of flags, which have all a common Error Function and sorting rule. If you want to check if all flags are set you can use the &#39;VisitAll` functionality. Your function can set some map or slice for each flag and then by checking the length of that slice or value(s) of map you can check if all flags are set."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536768921, "post_id": 52286974, "comment_id": 91546785, "body": "That&#39;s a fairly non-standard usage of flags, though; it sounds like what you really want is just command-line arguments, not flags. Flags are generally for options, not required arguments."}], "tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 1, "last_activity_date": 1536722077, "creation_date": 1536722077, "answer_id": 52286974, "question_id": 52286439, "link": "https://stackoverflow.com/questions/52286439/query-about-flagset-usage/52286974#52286974", "title": "Query about FlagSet usage", "body": "<p><a href=\"https://github.com/spf13/pflag/blob/298182f68c66c05229eb03ac171abe6e309ee79a/flag.go#L1202-L1213\" rel=\"nofollow noreferrer\">https://github.com/spf13/pflag/blob/298182f68c66c05229eb03ac171abe6e309ee79a/flag.go#L1202-L1213</a>, as told here, you are forming a <code>FlagSet</code> with name <code>alpha</code>. Obviously your code does not consider that as a flag. The correct way to define a new flag with name <code>alpha</code> would be</p>\n\n<p><code>abcFlagSet.StringVar(&amp;alpha, \"alpha\", \"\", \"alpha-description\")</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 10350504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0265892e1f658c9f8b2953592aab73d6?s=128&d=identicon&r=PG&f=1", "display_name": "gonn00b", "link": "https://stackoverflow.com/users/10350504/gonn00b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 373, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536722077, "creation_date": 1536717631, "question_id": 52286439, "link": "https://stackoverflow.com/questions/52286439/query-about-flagset-usage", "title": "Query about FlagSet usage", "body": "<p>I am trying to build a CLI where I expect a group of three arguments to appear together.</p>\n\n<pre><code>command --alpha \"value-a\" --bravo \"value-b\" --charlie \"value-c\"\n</code></pre>\n\n<p>This is how I am attempting to do it:</p>\n\n<pre><code>import (\n    \"github.com/spf13/pflag\"\n)\n\nvar (\n    alpha         string\n    bravo         string\n    charlie       string\n)\n\nabcFlagSet := pflag.NewFlagSet(\"alpha\", pflag.ContinueOnError)\nabcFlagSet.StringVar(&amp;bravo, \"bravo\", \"\", \"bravo-description\")\nabcFlagSet.StringVar(&amp;charlie, \"charlie\", \"\", \"charlie-description\")\ncmd.Flags().AddFlagSet(abcFlagSet)\n</code></pre>\n\n<p>This recognizes the <code>bravo</code> and <code>charlie</code> flags correctly. However, I think it treats the <code>alpha</code> as a sub command of <code>command</code> and does not parse the value assigned to it i.e., <code>value-a</code>. Is <code>FlagSet</code> a wrong usage for this use case? How should I parse this scenario where the three arguments can appear all together or none at all?</p>\n"}, {"tags": ["json", "templates", "go", "schema", "hugo"], "comments": [{"owner": {"reputation": 304, "user_id": 10345175, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qeuw8B8gaoA/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPH2lkdguMe7Cev3kHi-e6VIlPuAA/mo/photo.jpg?sz=128", "display_name": "Phani Kandula", "link": "https://stackoverflow.com/users/10345175/phani-kandula"}, "edited": false, "score": 1, "creation_date": 1536896646, "post_id": 52285697, "comment_id": 91596331, "body": "Can you share more details of the directory structure? Is the json file in &quot;data&quot; dir? How do you get to the point where the partial is invoked? Are you create a new type?"}, {"owner": {"reputation": 423, "user_id": 1128889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3a26aee44d974c455a5be4bfd802e3c?s=128&d=identicon&r=PG", "display_name": "G Amini", "link": "https://stackoverflow.com/users/1128889/g-amini"}, "reply_to_user": {"reputation": 304, "user_id": 10345175, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qeuw8B8gaoA/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPH2lkdguMe7Cev3kHi-e6VIlPuAA/mo/photo.jpg?sz=128", "display_name": "Phani Kandula", "link": "https://stackoverflow.com/users/10345175/phani-kandula"}, "edited": false, "score": 0, "creation_date": 1536956996, "post_id": 52285697, "comment_id": 91624948, "body": "The JSON schema files are in /data, the template is in /layouts/_default, and the schema partial is in /layouts/partials. I&#39;m able to get data from the schema as well as render the template and partial, I simply can&#39;t pass the data to the partial."}], "answers": [{"comments": [{"owner": {"reputation": 423, "user_id": 1128889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3a26aee44d974c455a5be4bfd802e3c?s=128&d=identicon&r=PG", "display_name": "G Amini", "link": "https://stackoverflow.com/users/1128889/g-amini"}, "edited": false, "score": 0, "creation_date": 1537290777, "post_id": 52339196, "comment_id": 91728224, "body": "Thank you for taking a look!  It appears that using this, the &quot;schema&quot; partial gets a new map that looks like this:   <code>{&quot;target_name&quot;: &quot;.definitions.loginResponse&quot;}</code>  Unfortunately, I still can&#39;t look up the data using that string. I want so badly to just be able to do this: <code>schema[&quot;definitions.loginResponse&quot;]</code> !"}], "tags": [], "owner": {"reputation": 304, "user_id": 10345175, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qeuw8B8gaoA/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPH2lkdguMe7Cev3kHi-e6VIlPuAA/mo/photo.jpg?sz=128", "display_name": "Phani Kandula", "link": "https://stackoverflow.com/users/10345175/phani-kandula"}, "is_accepted": false, "score": 0, "last_activity_date": 1536959124, "creation_date": 1536959124, "answer_id": 52339196, "question_id": 52285697, "link": "https://stackoverflow.com/questions/52285697/looking-up-data-by-key-in-hugo-with-a-string/52339196#52339196", "title": "Looking up data by key in Hugo with a string", "body": "<p>I think you need to use dict <a href=\"https://gohugo.io/functions/dict/\" rel=\"nofollow noreferrer\">https://gohugo.io/functions/dict/</a></p>\n\n<p>Your <code>{{ partial \"schema\" $target }}</code> can be changed to <code>{{ partial \"schema\" (dict \"target_name\" $target) }}</code></p>\n\n<p>In the \"schema\" partial, you can access value with <code>\"{{ .target_name }}\"</code></p>\n"}, {"tags": [], "owner": {"reputation": 423, "user_id": 1128889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3a26aee44d974c455a5be4bfd802e3c?s=128&d=identicon&r=PG", "display_name": "G Amini", "link": "https://stackoverflow.com/users/1128889/g-amini"}, "is_accepted": false, "score": 1, "last_activity_date": 1537550051, "creation_date": 1537550051, "answer_id": 52448359, "question_id": 52285697, "link": "https://stackoverflow.com/questions/52285697/looking-up-data-by-key-in-hugo-with-a-string/52448359#52448359", "title": "Looking up data by key in Hugo with a string", "body": "<p>Figured it out! In case anyone runs into this same problem, param lookup is done simply with Hugo's <a href=\"https://gohugo.io/functions/index-function/\" rel=\"nofollow noreferrer\">index function</a>.</p>\n\n<pre><code>{{ $target := index $info.schema \"$ref\" | findRE \"[^/]+(/?$)\" }}\n</code></pre>\n\n<p>With <code>$target</code>, under the parent context, it's merely <code>{{ index . $target }}</code>. </p>\n"}], "owner": {"reputation": 423, "user_id": 1128889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3a26aee44d974c455a5be4bfd802e3c?s=128&d=identicon&r=PG", "display_name": "G Amini", "link": "https://stackoverflow.com/users/1128889/g-amini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1779, "favorite_count": 2, "answer_count": 2, "score": 14, "last_activity_date": 1537550051, "creation_date": 1536710967, "question_id": 52285697, "link": "https://stackoverflow.com/questions/52285697/looking-up-data-by-key-in-hugo-with-a-string", "title": "Looking up data by key in Hugo with a string", "body": "<p>I'm trying to create a HUGO-based API documentation site which reads JSON schemas, and prints them in HTML.</p>\n\n<p>I'm almost there, but I'm stumped on how exactly to pass in the data I want to a partial. </p>\n\n<p>Given a standard JSON schema file, such as the following:</p>\n\n<pre><code>{\"paths\": {\n  \"/auth/login\": {\n    \"get\": {\n    \"operationId\": \"login\",\n    \"responses\": {\n      \"200\": {\n        \"description\": \"\",\n        \"schema\": {\n          \"ref\": \"#/definitions/loginResponse\"\n        }\n      }\n    }\n  },\n},\n\"definitions\": {\n  \"loginResponse\": {\n    \"type\": \"object\"\n  }\n}}\n</code></pre>\n\n<p>I'd like to display the details of that path, and then render a partial using the schema definition in \"ref\". I found a way to read that ref param and parse it into a reference for the definition. \"Target\" below looks like:</p>\n\n<blockquote>\n  <p>Target: .definitions.loginResponse</p>\n</blockquote>\n\n<pre><code>{{ range $path, $methods := .paths }}\n  &lt;h4&gt;{{ $path }}&lt;/h4&gt;\n\n  {{ range $method, $items := $methods }}\n    &lt;h5&gt;{{ $method }}&lt;/h5&gt;\n    &lt;ul&gt;\n      {{ range $status, $info := .responses }}\n        &lt;li&gt;\n          &lt;div&gt;{{ $status }}&lt;/div&gt;\n          &lt;h6&gt;Ref: {{ $info.schema.ref }}&lt;/h6&gt;\n          &lt;p&gt;Target: {{ $target := (printf \".definitions.%s\" (index (findRE \"[^/]+(/?$)\" $info.schema.ref) 0))}}&lt;/p&gt;\n          &lt;div&gt;{{ partial \"schema\" $target }}&lt;/div&gt;\n        &lt;/li&gt;\n      {{ end }}\n    &lt;/ul&gt;\n  {{end}}\n{{end}}\n</code></pre>\n\n<p>The trouble is, <code>$target</code> is a string. In Javascript, I'd just be able to pass it in as a key to get that object param: <code>schema[\"definitions.loginResponse\"]</code>.</p>\n\n<p>No such luck in HUGO, however. I simply can't find a way to go from that target key string to the actual param. </p>\n\n<p>Help! Am I missing something obvious? Am I going about this all wrong?</p>\n"}, {"tags": ["go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 8221, "user_id": 264712, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e4868b6d3075a52e98423a0ef0d8e111?s=128&d=identicon&r=PG", "display_name": "TheBuzzSaw", "link": "https://stackoverflow.com/users/264712/thebuzzsaw"}, "edited": false, "score": 0, "creation_date": 1536763397, "post_id": 52291521, "comment_id": 91543540, "body": "I was slowly circling in on this answer in the docs. They didn&#39;t make sense to me the first time over. <i>shrug</i> This will get me what I want. Is the type <code>datastore.Entity</code> there for convenience then? A place to capture the results?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 8221, "user_id": 264712, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e4868b6d3075a52e98423a0ef0d8e111?s=128&d=identicon&r=PG", "display_name": "TheBuzzSaw", "link": "https://stackoverflow.com/users/264712/thebuzzsaw"}, "edited": false, "score": 0, "creation_date": 1536763472, "post_id": 52291521, "comment_id": 91543587, "body": "@TheBuzzSaw <code>datastore.Entity</code> is to model embedded documents."}, {"owner": {"reputation": 8221, "user_id": 264712, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e4868b6d3075a52e98423a0ef0d8e111?s=128&d=identicon&r=PG", "display_name": "TheBuzzSaw", "link": "https://stackoverflow.com/users/264712/thebuzzsaw"}, "edited": false, "score": 0, "creation_date": 1536764476, "post_id": 52291521, "comment_id": 91544208, "body": "Oooooh so I can put that into the struct as one of the fields?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 8221, "user_id": 264712, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e4868b6d3075a52e98423a0ef0d8e111?s=128&d=identicon&r=PG", "display_name": "TheBuzzSaw", "link": "https://stackoverflow.com/users/264712/thebuzzsaw"}, "edited": false, "score": 0, "creation_date": 1536764620, "post_id": 52291521, "comment_id": 91544294, "body": "@TheBuzzSaw I haven&#39;t tried. Its purpose is that if your entity contains a nested struct, getting it (e.g. into a <code>PropertyList</code> or any other custom way), you will get the nested struct as a value of <code>datastore.Entity</code>."}, {"owner": {"reputation": 2947, "user_id": 1308883, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IEAHs.jpg?s=128&g=1", "display_name": "Jofre", "link": "https://stackoverflow.com/users/1308883/jofre"}, "edited": false, "score": 0, "creation_date": 1537527202, "post_id": 52291521, "comment_id": 91826930, "body": "I have an example written to load and save arbitrary structs in <a href=\"https://stackoverflow.com/a/51763670/1308883\">this unrelated answer</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1536743438, "creation_date": 1536743438, "answer_id": 52291521, "question_id": 52284710, "link": "https://stackoverflow.com/questions/52284710/is-there-a-way-to-retrieve-an-entity-without-using-a-custom-struct/52291521#52291521", "title": "Is there a way to retrieve an entity without using a custom struct?", "body": "<p>So you want a \"general\" type that can hold any type of entity? The <code>datastore</code> package already provides you such a type: <a href=\"https://godoc.org/cloud.google.com/go/datastore#PropertyList\" rel=\"nofollow noreferrer\"><code>datastore.PropertyList</code></a>.</p>\n\n<p>This is how you can use it:</p>\n\n<pre><code>var entity datastore.PropertyList\nif err := client.Get(ctx, key, &amp;entity); err != nil {\n    // TODO: Handle error.\n}\n</code></pre>\n\n<p>Relevant docs from <a href=\"https://godoc.org/cloud.google.com/go/datastore#hdr-Properties\" rel=\"nofollow noreferrer\"><code>datastore</code></a>:</p>\n\n<blockquote>\n  <h3>Properties</h3>\n  \n  <p>An entity's contents can be represented by a variety of types. These are typically struct pointers, but can also be any type that implements the PropertyLoadSaver interface. If using a struct pointer, you do not have to explicitly implement the PropertyLoadSaver interface; the datastore will automatically convert via reflection. If a struct pointer does implement that interface then those methods will be used in preference to the default behavior for struct pointers. Struct pointers are more strongly typed and are easier to use; PropertyLoadSavers are more flexible.</p>\n</blockquote>\n\n<p>So you may use any type that implements the <a href=\"https://godoc.org/cloud.google.com/go/datastore#PropertyLoadSaver\" rel=\"nofollow noreferrer\"><code>datastore.PropertyLoadSaver</code></a> interface. This interface type is:</p>\n\n<pre><code>type PropertyLoadSaver interface {\n    Load([]Property) error\n    Save() ([]Property, error)\n}\n</code></pre>\n\n<p>Quoting again from <a href=\"https://godoc.org/cloud.google.com/go/datastore#hdr-The_PropertyLoadSaver_Interface\" rel=\"nofollow noreferrer\">package doc</a>:</p>\n\n<blockquote>\n  <h3>The PropertyLoadSaver Interface</h3>\n  \n  <p>An entity's contents can also be represented by any type that implements the PropertyLoadSaver interface. This type may be a struct pointer, but it does not have to be. The datastore package will call Load when getting the entity's contents, and Save when putting the entity's contents. Possible uses include deriving non-stored fields, verifying fields, or indexing a field only if its value is positive.</p>\n  \n  <p>[...] <strong>The *PropertyList type implements PropertyLoadSaver, and can therefore hold an arbitrary entity's contents.</strong></p>\n</blockquote>\n"}], "owner": {"reputation": 8221, "user_id": 264712, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/e4868b6d3075a52e98423a0ef0d8e111?s=128&d=identicon&r=PG", "display_name": "TheBuzzSaw", "link": "https://stackoverflow.com/users/264712/thebuzzsaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "accepted_answer_id": 52291521, "answer_count": 1, "score": 2, "last_activity_date": 1536743592, "creation_date": 1536702880, "question_id": 52284710, "link": "https://stackoverflow.com/questions/52284710/is-there-a-way-to-retrieve-an-entity-without-using-a-custom-struct", "title": "Is there a way to retrieve an entity without using a custom struct?", "body": "<p>The struct <a href=\"https://godoc.org/cloud.google.com/go/datastore#Entity\" rel=\"nofollow noreferrer\">datastore.Entity</a> looks very useful, and it's how I want to process entities, but I don't see any API the makes use of it. Most of the functions (such as <a href=\"https://godoc.org/cloud.google.com/go/datastore#Client.Get\" rel=\"nofollow noreferrer\">Get</a>) take an <code>interface{}</code> that only seems to work if it is struct that is <em>precisely</em> structured like the incoming data.</p>\n\n<pre><code>// https://godoc.org/cloud.google.com/go/datastore#Client.Get\n\nctx := context.Background()\nclient, err := datastore.NewClient(ctx, \"project-id\")\nif err != nil {\n    // TODO: Handle error.\n}\n\ntype Article struct {\n    Title       string\n    Description string\n    Body        string `datastore:\",noindex\"`\n    Author      *datastore.Key\n    PublishedAt time.Time\n}\nkey := datastore.NameKey(\"Article\", \"articled1\", nil)\narticle := &amp;Article{}\nif err := client.Get(ctx, key, article); err != nil {\n    // TODO: Handle error.\n}\n</code></pre>\n\n<p>How would I obtain this entity in a generalized way? What if I don't know the structure perfectly? (More specifically, how do I obtain an instance of <code>datastore.Entity</code> instead?)</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1536701687, "post_id": 52284478, "comment_id": 91517237, "body": "Glad I could help :)"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1536771642, "post_id": 52284478, "comment_id": 91548060, "body": "Hi, I just encounter another problem with the solution, see my updated question"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1536771970, "post_id": 52284478, "comment_id": 91548227, "body": "Yes it changes the original slice, and that is why it didn&#39;t work originally, you were returning the first element of your slice and then deleting it, which in turn made it so that you returned the first element of your old slice :) I will update my answer."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1536772443, "post_id": 52284478, "comment_id": 91548464, "body": "wouldn&#39;t that be expensive if I do it multiple times?"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1536772620, "post_id": 52284478, "comment_id": 91548527, "body": "I can write a less expensive version if you want, sure"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1536773332, "post_id": 52284478, "comment_id": 91548865, "body": "Updated the code &amp; link to the playground, and explained what are the speed improvements. Feel free to benchmark it, it should be quite faster than the previous version, but the main bottleneck stays the creation of a new slice, which can only be solved by changing the way you are architecturing your code to not require the creation of a second slice :/ Let me know if this is good enough for you and feel free to validate the answer if so :)"}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1536773691, "post_id": 52284478, "comment_id": 91549030, "body": "It does not work, it continues to change the original slice"}, {"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1536783688, "post_id": 52284478, "comment_id": 91553501, "body": "Yep my bad, forgot that calling <code>append()</code> on <code>names</code> would modify it. The only obvious option I see then is to append it to the newSlice, updated the code."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 1, "creation_date": 1536804532, "post_id": 52284478, "comment_id": 91558684, "body": "At the end it&#39;s the same as the other one :D, but anyway I&#39;ll stick with that one, thanks!"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 2, "last_activity_date": 1536783622, "last_edit_date": 1536783622, "creation_date": 1536701470, "answer_id": 52284478, "question_id": 52284400, "link": "https://stackoverflow.com/questions/52284400/delete-element-in-a-slice-and-returning-the-removed-one-and-the-remaining/52284478#52284478", "title": "Delete element in a slice and returning the removed one and the remaining", "body": "<p>Simply use the range to get both the value and the index, instead of accessing the value by using the index.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var names = []string{\"john\", \"julio\", \"pepito\", \"carlos\"}\n    name, newNames, _ := getMe(\"john\", names)\n\n    fmt.Println(\"extracted name:\\t\\t\\t\\t\", name)\n    fmt.Println(\"new slice without extracted name:\\t\", newNames)\n    fmt.Println(\"old slice still intact:\\t\\t\\t\", names)\n}\n\nfunc getMe(me string, names []string) (string, []string, bool) {\n    var newSlice []string\n\n    for i := 0; i &lt; len(names); i++ {\n        if names[i] == me {\n            newSlice = append(newSlice, names[:i]...)\n            newSlice = append(newSlice, names[i+1:]...)\n            return names[i], newSlice, true\n        }\n    }\n\n    return \"\", nil, false\n}\n</code></pre>\n\n<p>Outputs</p>\n\n<blockquote>\n<pre><code>extracted name:                        john\nnew slice without extracted name:      [julio pepito carlos]\nold slice still intact:                [john julio pepito carlos]\n</code></pre>\n</blockquote>\n\n<p>See <a href=\"https://play.golang.org/p/pFT0DV6HCy5\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p>Edit after request for a faster version: Using the manual for instead of the range loop is much faster. Since you need to create a new slice without the element, it's necessary to build a new slice within the function, which is always going to take some processing power.</p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 52284478, "answer_count": 1, "score": 1, "last_activity_date": 1536783622, "creation_date": 1536700926, "last_edit_date": 1592644375, "question_id": 52284400, "link": "https://stackoverflow.com/questions/52284400/delete-element-in-a-slice-and-returning-the-removed-one-and-the-remaining", "title": "Delete element in a slice and returning the removed one and the remaining", "body": "<p>I just want a function that having a slice of a struct type &quot;t&quot;, returns the returns the element I'm looking for and the remaining, I tried with the partial solution for my problem like pointed out here:\n<a href=\"https://stackoverflow.com/questions/25025409/delete-element-in-a-slice\">Delete element in a slice</a>\nBut for a weird reason, it does not work as expected\n<a href=\"https://play.golang.org/p/tvJwkF5c_tj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tvJwkF5c_tj</a></p>\n<pre><code>    func main() {\n    var names = []string{&quot;john&quot;, &quot;julio&quot;, &quot;pepito&quot;,&quot;carlos&quot;}\n    fmt.Println(getMe(&quot;john&quot;, names))\n}\nfunc getMe(me string, names []string) (string, []string, bool) {\n    for i := range names {\n        if names[i] == me {\n            return names[i], append(names[:i], names[i+1:]...), true\n        }\n    }\n    return &quot;&quot;, nil, false\n}\n</code></pre>\n<p>but the result gives me:</p>\n<pre><code>julio [julio pepito carlos] true\n</code></pre>\n<p>UPDATE:\n<a href=\"https://play.golang.org/p/1xbu01rOiMg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1xbu01rOiMg</a>\nTaking the answer from @Ullaakut\nIf I do: <code>append(names[:i], names[i+1:]...)</code>, it changes the original slice, so this does not work for me, I do not want my slice to change, because I will be using it later on</p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"tags": [], "owner": {"reputation": 12629, "user_id": 54696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f653f4bd8bd51e7e9f718b94b7c7987?s=128&d=identicon&r=PG", "display_name": "Jordan Liggitt", "link": "https://stackoverflow.com/users/54696/jordan-liggitt"}, "is_accepted": false, "score": 1, "last_activity_date": 1536702547, "creation_date": 1536702547, "answer_id": 52284658, "question_id": 52283025, "link": "https://stackoverflow.com/questions/52283025/how-to-use-golang-api-to-do-external-authentication-to-kubernetes-without-kubeco/52284658#52284658", "title": "How to use golang api to do external authentication to kubernetes without kubeconfig file?", "body": "<p>The <code>rest.Config</code> struct passed to the <code>NewFromConfig</code> client constructors lets you specify bearer tokens and/or client certificate/key data directly. </p>\n"}, {"tags": [], "owner": {"reputation": 88487, "user_id": 6508, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6baa1023a5f700292f7e9791311e7f7a?s=128&d=identicon&r=PG", "display_name": "Jorge Ferreira", "link": "https://stackoverflow.com/users/6508/jorge-ferreira"}, "is_accepted": false, "score": 1, "last_activity_date": 1536704539, "creation_date": 1536704539, "answer_id": 52284943, "question_id": 52283025, "link": "https://stackoverflow.com/questions/52283025/how-to-use-golang-api-to-do-external-authentication-to-kubernetes-without-kubeco/52284943#52284943", "title": "How to use golang api to do external authentication to kubernetes without kubeconfig file?", "body": "<p>Looking at the source code, this should work:</p>\n\n<pre><code>// error handling omitted for brevity\ncc, _ := clientcmd.NewClientConfigFromBytes([]byte(d1))\nconfig, _ := cc.ClientConfig()\nclientset, _ := kubernetes.NewForConfig(config)\n</code></pre>\n"}], "owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1536704539, "creation_date": 1536694319, "question_id": 52283025, "link": "https://stackoverflow.com/questions/52283025/how-to-use-golang-api-to-do-external-authentication-to-kubernetes-without-kubeco", "title": "How to use golang api to do external authentication to kubernetes without kubeconfig file?", "body": "<p>While the <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/out-of-cluster-client-configuration/main.go\" rel=\"nofollow noreferrer\">kubernetes golang api example for out-of-cluster authentication works fine</a>, and <a href=\"https://gist.github.com/innovia/fbba8259042f71db98ea8d4ad19bd708\" rel=\"nofollow noreferrer\">creating a service account and exporting the bearer token works great</a>, it feels silly to write the pieces to a temporary file only to tell the API to read it. Is there an API way to pass these pieces as an object rather than write to a file?</p>\n\n<pre><code>    clusterData := map[string]string{\n        \"BEARER_TOKEN\":       bearerToken,\n        \"CA_DATA\":            clusterCA,\n        \"ENDPOINT\":           clusterUrl,\n    }\n\n    const kubeConfigTmpl = `\napiVersion: v1\nclusters:\n    - cluster:\n    certificate-authority-data: {{.CA_DATA}}\nserver: {{.HOST_IP_ADDRESS}}\n  name: kubernetes\ncontexts:\n- context:\n    cluster: kubernetes\n    namespace: default\n    user: lamdba-serviceaccount-default-kubernetes\n  name: lamdba-serviceaccount-default-kubernetes\ncurrent-context: lamdba-serviceaccount-default-kubernetes\nkind: Config\npreferences: {}\nusers:\n- name: lamdba-serviceaccount-default-kubernetes\n  user:\n    token: {{.BEARER_TOKEN}}\n`\n    t := template.Must(template.New(\"registration\").Parse(kubeConfigTmpl))\n    buf := &amp;bytes.Buffer{}\n    if err := t.Execute(buf, clusterData); err != nil {\n        panic(err)\n    }\n    registrationPayload := buf.String()\n\n    d1 := []byte(registrationPayload)\n    err := ioutil.WriteFile(\"/tmp/config\", d1, 0644)\n</code></pre>\n"}, {"tags": ["go", "two-factor-authentication"], "comments": [{"owner": {"reputation": 474, "user_id": 4063201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/uU5YK.png?s=128&g=1", "display_name": "monirz", "link": "https://stackoverflow.com/users/4063201/monirz"}, "edited": false, "score": 0, "creation_date": 1536695438, "post_id": 52282852, "comment_id": 91514668, "body": "Have you seen  this <a href=\"https://stackoverflow.com/questions/27500861/whats-the-proper-way-to-go-get-a-private-repository\">thread</a>?"}, {"owner": {"reputation": 71, "user_id": 6047243, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/564b49e71ba10037360a5b65d358d2b0?s=128&d=identicon&r=PG&f=1", "display_name": "iamak", "link": "https://stackoverflow.com/users/6047243/iamak"}, "reply_to_user": {"reputation": 474, "user_id": 4063201, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/uU5YK.png?s=128&g=1", "display_name": "monirz", "link": "https://stackoverflow.com/users/4063201/monirz"}, "edited": false, "score": 0, "creation_date": 1536697546, "post_id": 52282852, "comment_id": 91515616, "body": "That was a great help. Pointed me in right direction."}], "owner": {"reputation": 71, "user_id": 6047243, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/564b49e71ba10037360a5b65d358d2b0?s=128&d=identicon&r=PG&f=1", "display_name": "iamak", "link": "https://stackoverflow.com/users/6047243/iamak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 26, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1536693636, "creation_date": 1536693636, "question_id": 52282852, "link": "https://stackoverflow.com/questions/52282852/golang-get-command-with-duosecurity", "title": "golang get command with duosecurity", "body": "<p>In my company we have our internal git repo that is protected by duosecurity two factor authentication. \nWhen I try to run this command</p>\n\n<pre><code>go get -u git.source.mycompany.com/projects/myproj\n</code></pre>\n\n<p>In the response it redirects me to the twofactor URL.</p>\n\n<pre><code>https fetch: Get https://mycompany.com/Redirect/SSO?SReq=fIpehPwuz9NB3%2BkJLJ76dAKSzI6U%2BSnYXnC%2Fbit%2BYJPkOlr8RTujF0F9asMfOufVMjWVkl%2FevKrMx8KCcBATRmjSj%2Fw%2FjeQb&amp;RelayState=ss%3Amem%3A3727673680e6043f2e111\n</code></pre>\n\n<p>Has anyone seen or dealt with two factor when doing go get from terminal.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 758, "user_id": 1654922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c516e83dd770df894f17c3e2aea81ee?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1654922/alex"}, "edited": false, "score": 0, "creation_date": 1536689465, "post_id": 52281767, "comment_id": 91511722, "body": "whoever left a downvote - can you please elaborate why? Enlighten me"}, {"owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "edited": false, "score": 1, "creation_date": 1536690633, "post_id": 52281767, "comment_id": 91512322, "body": "WRT the quote from GO docs: critical keyword here is &#39;same block&#39;. <code>if</code> opens a new nested block, so this doesn&#39;t apply (see my answer for a more detailed explanation)."}], "answers": [{"comments": [{"owner": {"reputation": 758, "user_id": 1654922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c516e83dd770df894f17c3e2aea81ee?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1654922/alex"}, "edited": false, "score": 0, "creation_date": 1536689607, "post_id": 52281872, "comment_id": 91511797, "body": "Please read the go, documentation - := operator ASSIGNS the existing variables OR declares new ones. The condition is that at least one variable must be new."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 758, "user_id": 1654922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c516e83dd770df894f17c3e2aea81ee?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1654922/alex"}, "edited": false, "score": 2, "creation_date": 1536689737, "post_id": 52281872, "comment_id": 91511856, "body": "I&#39;ve read it, and I have extensive experience with Go, which is how I identified your issue. This is the fix. Consider trying it before arguing against it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 758, "user_id": 1654922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c516e83dd770df894f17c3e2aea81ee?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1654922/alex"}, "edited": false, "score": 1, "creation_date": 1536689941, "post_id": 52281872, "comment_id": 91511951, "body": "Added further documentation references for clarity."}, {"owner": {"reputation": 758, "user_id": 1654922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c516e83dd770df894f17c3e2aea81ee?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1654922/alex"}, "edited": false, "score": 0, "creation_date": 1536690243, "post_id": 52281872, "comment_id": 91512110, "body": "I am not argueing that it&#39;s not going to work. I&#39;m argueing that what I am doing is invalid Go. In the Go spec you referenced, please read: <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Short_variable_declarations</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 758, "user_id": 1654922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c516e83dd770df894f17c3e2aea81ee?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1654922/alex"}, "edited": false, "score": 0, "creation_date": 1536690399, "post_id": 52281872, "comment_id": 91512207, "body": "Yes, I&#39;ve read it - in fact, I had linked to the exact same section in this answer already. But you&#39;re right, what you&#39;re doing is invalid Go. Both the answers you&#39;ve received are the same, and both are correct. I hope this helps you to resolve your issue and better understand the Go language."}, {"owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "reply_to_user": {"reputation": 758, "user_id": 1654922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c516e83dd770df894f17c3e2aea81ee?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1654922/alex"}, "edited": false, "score": 3, "creation_date": 1536690422, "post_id": 52281872, "comment_id": 91512226, "body": "@Alex, it is true that <code>:=</code> can both assign existing vars and declare new ones - but the docs clearly show that this works only if the declarations are in the same scope. In your case <code>if</code> opens a new scope, so none of the existing declarations (such as your <code>var tm</code>) are taken into account and everything on the left of <code>:=</code> is newly-declared."}, {"owner": {"reputation": 758, "user_id": 1654922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c516e83dd770df894f17c3e2aea81ee?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1654922/alex"}, "edited": false, "score": 0, "creation_date": 1536695152, "post_id": 52281872, "comment_id": 91514525, "body": "@Adrian Applogies for the &#39;RTFM&#39; responses. Indeed I did miscomprehend that bit in the spec. I&#39;m new to go and apparently have a lot to learn. Event though I&#39;ve accepted Leo K&#39;s answer because it was clearer(imo) and helped me understand the issue better, I still appreciate your quick response. Thanks."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1536689928, "last_edit_date": 1592644375, "creation_date": 1536689505, "answer_id": 52281872, "question_id": 52281767, "link": "https://stackoverflow.com/questions/52281767/short-variable-declaration-and-variable-declared-and-not-used-error/52281872#52281872", "title": "Short variable declaration and &quot;variable declared and not used&quot; error", "body": "<p>Your <code>if</code> statement declares a new variable <code>tm</code> that exists only within the scope of the <code>if</code> block and is indeed never used:</p>\n<pre><code>if tm, err := time.Parse(time.RFC3339, &quot;2018-09-11T17:50:54.247Z&quot;); err != nil {\n    panic(err)\n}\n</code></pre>\n<p>In Go, <code>:=</code> declares a <em>new</em> variable and initializes it. You probably meant:</p>\n<pre><code>func main() {\n    var val reflect.Value\n    var tm time.Time\n    var err error\n\n    // Note the change to normal assignment here instead of :=\n    if tm, err = time.Parse(time.RFC3339, &quot;2018-09-11T17:50:54.247Z&quot;); err != nil {\n        panic(err)\n    }\n    val = reflect.ValueOf(tm)\n\n    fmt.Println(val, tm, reflect.TypeOf(tm))\n}\n</code></pre>\n<p>The <code>:=</code> shortcut operator is demonstrated in the <a href=\"https://tour.golang.org/basics/10\" rel=\"nofollow noreferrer\">Tour of Go</a> and explained in <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">the Go spec</a>, the latter of which includes:</p>\n<blockquote>\n<p>It is shorthand for a regular variable declaration with initializer expressions but no types:</p>\n<p><code>&quot;var&quot; IdentifierList = ExpressionList .</code></p>\n</blockquote>\n<p>Scoping is explained in <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">the Go spec</a> as well.</p>\n"}, {"tags": [], "owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "is_accepted": true, "score": 9, "last_activity_date": 1536690730, "last_edit_date": 1536690730, "creation_date": 1536689516, "answer_id": 52281875, "question_id": 52281767, "link": "https://stackoverflow.com/questions/52281767/short-variable-declaration-and-variable-declared-and-not-used-error/52281875#52281875", "title": "Short variable declaration and &quot;variable declared and not used&quot; error", "body": "<p>This part:</p>\n\n<pre><code>if tm, err := time.Parse(...)\n</code></pre>\n\n<p>creates a <strong>new</strong> variable <code>tm</code> that has scope only within the <code>if</code> statement - it is NOT the one you declared as <code>var tm time.Time</code>.</p>\n\n<p>This new variable is not used within the <code>if</code>, therefore you get the error. Note you also don't get the outer-level <code>tm</code> assigned, so <code>fmt.Println</code> will print the zero time, not what time.Parse returned.</p>\n\n<p>To fix this:\ndeclare <code>err</code> and change your <code>if</code> to read:</p>\n\n<pre><code>var err error\nif tm, err = time.Parse(...)\n</code></pre>\n\n<p>NOTE this is a subtle thing in GO and a fairly common source of mistakes. The <code>:=</code> statement can in fact be used with a mix of variables that are already declared and one or more <em>new</em> variables - if the already-declared ones are in the <em>same lexical scope</em>. Then, only the new ones are auto-declared by <code>:=</code> and the rest are just assigned (as with <code>=</code>). However, if you use <code>:=</code> in a new scope, then ALL variables are declared in that scope and mask any outer-scope variables with the same name (such as in an <code>if</code>; note that the <code>if</code> condition is not inside the braces, but is still considered as if it were within the <code>{code}</code> block; same happens with the <code>for</code> and other compound statements in GO).</p>\n"}], "owner": {"reputation": 758, "user_id": 1654922, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c516e83dd770df894f17c3e2aea81ee?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/1654922/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 0, "accepted_answer_id": 52281875, "answer_count": 2, "score": 1, "last_activity_date": 1536693460, "creation_date": 1536689080, "last_edit_date": 1536693460, "question_id": 52281767, "link": "https://stackoverflow.com/questions/52281767/short-variable-declaration-and-variable-declared-and-not-used-error", "title": "Short variable declaration and &quot;variable declared and not used&quot; error", "body": "<p>I've stumbled across a strange issue where the code below fails to compile:</p>\n\n<pre><code>func main() {\n    var val reflect.Value\n    var tm time.Time\n\n    if tm, err := time.Parse(time.RFC3339, \"2018-09-11T17:50:54.247Z\"); err != nil {\n        panic(err)\n    }\n    val = reflect.ValueOf(tm)\n\n    fmt.Println(val, tm, reflect.TypeOf(tm))\n}\n</code></pre>\n\n<p>with the error (the code is what linter recommends).:</p>\n\n<pre><code>$ go run main.go\n# command-line-arguments\n./main.go:13:5: tm declared and not used\n</code></pre>\n\n<p>Note the <code>tm</code> variable is indeed used.</p>\n\n<p>If however I add an else block - everything compiles as expected:</p>\n\n<pre><code>func main() {\n    var val reflect.Value\n    var tm time.Time\n\n    if tm, err := time.Parse(time.RFC3339, \"2018-09-11T17:50:54.247Z\"); err != nil {\n        panic(err)\n    } else {\n        val = reflect.ValueOf(tm)\n    }\n\n    fmt.Println(val, tm, reflect.TypeOf(tm))\n}\n</code></pre>\n\n<p>This looks like a bug in the compiler or perhaps a known issue? Any idea? (I'm using go 1.11)</p>\n\n<p>edit: to all respondends so far. As per: <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Short_variable_declarations</a></p>\n\n<blockquote>\n  <p>Unlike regular variable declarations, a short variable declaration may\n  redeclare variables provided they were originally declared earlier in\n  the same block (or the parameter lists if the block is the function\n  body) with the same type, and at least one of the non-blank variables\n  is new. As a consequence, redeclaration can only appear in a\n  multi-variable short declaration. Redeclaration does not introduce a\n  new variable; it just assigns a new value to the original.</p>\n</blockquote>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536725527, "post_id": 52281358, "comment_id": 91522521, "body": "@icza Can you tell me for this what method from (POST,GET, PUT, DELETE) is used means what method should I have to use for better result"}], "owner": {"reputation": 21, "user_id": 10348945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3829ca68ba5337f327b554458ad995c?s=128&d=identicon&r=PG&f=1", "display_name": "manu", "link": "https://stackoverflow.com/users/10348945/manu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "closed_date": 1536693409, "answer_count": 0, "score": 2, "last_activity_date": 1536693494, "creation_date": 1536687309, "last_edit_date": 1536688477, "question_id": 52281358, "link": "https://stackoverflow.com/questions/52281358/how-to-fetch-the-data-on-the-basis-of-multiple-ids", "closed_reason": "Duplicate", "title": "How to fetch the data on the basis of multiple ids?", "body": "<p>Here I'm fetching the data from the database mongodb using golang. Suppose I have an <code>Id</code> attribute and i want to receive the data on the basis of this id and it was easy by passing the id attribute in the query like below:-</p>\n\n<pre><code> c.Find(bson.M{\"_id\": 1}).One(&amp;data)\n</code></pre>\n\n<p>If the id is given 1. but I have an case that i have find two or more at  one time on the basis of the ids that it will returns the array of the ids like \"_id\":[1,2,3] then How will I retrieve the data from that ids. Can anyone help for if. </p>\n\n<p><strong>EDITED</strong></p>\n\n<p>IS this <a href=\"https://stackoverflow.com/questions/26428281/querying-mongodb-from-golang-using-the-id-stored-in-an-array\">question</a> solve my problem.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536688808, "post_id": 52281320, "comment_id": 91511386, "body": "what is returned from <code>MakeHandler</code> is a <code>mux</code>, you can test your mux using functions that let you see inside a <code>mux</code> like so <a href=\"https://godoc.org/github.com/gorilla/mux#Route.GetMethods\" rel=\"nofollow noreferrer\">godoc.org/github.com/gorilla/mux#Route.GetMethods</a>. However, doing that restricts your test case, to your specific type of <code>mux</code>. In future if you end up using a different router, this test will fail."}], "answers": [{"tags": [], "owner": {"reputation": 1671, "user_id": 4600983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37d236a59e7d7e6871716bc25752dae6?s=128&d=identicon&r=PG&f=1", "display_name": "svsd", "link": "https://stackoverflow.com/users/4600983/svsd"}, "is_accepted": true, "score": 0, "last_activity_date": 1536713026, "creation_date": 1536713026, "answer_id": 52285935, "question_id": 52281320, "link": "https://stackoverflow.com/questions/52281320/writing-unit-test-for-make-handler-function-in-go-kit/52285935#52285935", "title": "Writing unit test for make handler function in Go-kit", "body": "<p>TL;DR: Yes, that test is in the right direction. You shouldn't try to test the\ninternals of the returned handler since that third party package may change in ways you didn't expect in the future.</p>\n\n<blockquote>\n  <p>Is it possible to just validate what's returned from MakeHandler() instead of\n  during a request?</p>\n</blockquote>\n\n<p>Not in a good way. <code>MakeHandler()</code> returns an interface and ideally you'd use\njust the interface methods in your tests.</p>\n\n<p>You could look at the docs of the type returned by <code>mux.NewRouter()</code> to see if\nthere are any fields or methods in the concrete type that can give you the\ninformation, but that can turn out to be a pain - both for understanding the\ntests (one more rarely used type to learn about) and due to how future\nmodifications to the <code>mux</code> package may affect your code without breaking the\ntests.</p>\n\n<blockquote>\n  <p>What would be the correct way of writing a proper unit test?</p>\n</blockquote>\n\n<p>Your example is actually in the right direction. When testing <code>MakeHandler()</code>,\nyou're testing that the handler returned by it is able to handle all the paths\nand calls the correct handler for each path. So you need to call the\n<code>ServeHTTP()</code> method, let it do its thing and then test to see it worked\ncorrectly. Only introspecting the handler does not guarantee correctness during\nactual usage.</p>\n\n<p>You may need to make actually valid requests though so you're able to understand\nwhich handler was called based on the response body or header. That should\nbring the test to a quite reasonable state. (I think you already have that)</p>\n\n<p>Similarly, I'd add a basic sub test for each route that's added in the future.\nDetailed handler tests can be written in separate funcs.</p>\n"}], "owner": {"reputation": 443, "user_id": 948383, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/40d0367c1bec78fc750f133415c7eff0?s=128&d=identicon&r=PG", "display_name": "madshov", "link": "https://stackoverflow.com/users/948383/madshov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 844, "favorite_count": 0, "accepted_answer_id": 52285935, "answer_count": 1, "score": 1, "last_activity_date": 1536713026, "creation_date": 1536687157, "question_id": 52281320, "link": "https://stackoverflow.com/questions/52281320/writing-unit-test-for-make-handler-function-in-go-kit", "title": "Writing unit test for make handler function in Go-kit", "body": "<p>My problem is specific to Go-kit and how to organize code within.\nI'm trying to write a unit test for the following function:</p>\n\n<pre><code>func MakeHandler(svc Service, logger kitlog.Logger) http.Handler {\n    orderHandler := kithttptransport.NewServer(\n       makeOrderEndpoint(svc),\n       decodeRequest,\n       encodeResponse,\n    )\n\n    r := mux.NewRouter()\n    r.Handle(\"/api/v1/order/\", orderHandler).Methods(\"GET\")\n\n    return r\n</code></pre>\n\n<p>}</p>\n\n<p>What would be the correct way of writing a proper unit test? I have seen examples such as the following:</p>\n\n<pre><code>sMock := &amp;ServiceMock{}\nh := MakeHandler(sMock, log.NewNopLogger())\n\nr := httptest.NewRecorder()\nreq := httptest.NewRequest(\"GET\", \"/api/v1/order/\", bytes.NewBuffer([]byte(\"{}\")))\n\nh.ServeHTTP(r, req)\n</code></pre>\n\n<p>And then testing the body and headers of the request. But this doesn't seem like a proper unit test, as calls other parts of the code (<code>orderHandler</code>). Is it possible to just validate what's returned from <code>MakeHandler()</code> instead of during a request?</p>\n"}, {"tags": ["bash", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1536685554, "post_id": 52280905, "comment_id": 91509822, "body": "If it&#39;s a bash command, you need bash to execute it. <code>ls</code> can&#39;t use <code>&gt;</code> as an argument."}, {"owner": {"reputation": 136, "user_id": 5367712, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10205439123331950/picture?type=large", "display_name": "Divyaanand Sinha", "link": "https://stackoverflow.com/users/5367712/divyaanand-sinha"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1536685763, "post_id": 52280905, "comment_id": 91509924, "body": "anyway I can do using channels in go?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1536685835, "post_id": 52280905, "comment_id": 91509968, "body": "I&#39;m not sure what channels have to do with executing a command. You either need to execute a shell, or write the output yourself."}], "answers": [{"tags": [], "owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "is_accepted": true, "score": 6, "last_activity_date": 1536686005, "creation_date": 1536686005, "answer_id": 52281031, "question_id": 52280905, "link": "https://stackoverflow.com/questions/52280905/golang-exec-command-bash-command-not-working/52281031#52281031", "title": "Golang exec.Command() bash command not working", "body": "<p>From the docs:</p>\n\n<blockquote>\n  <p>Unlike the \"system\" library call from C and other languages, the os/exec package intentionally does not invoke the system shell and does not expand any glob patterns or handle other expansions, pipelines, or redirections typically done by shells. The package behaves more like C's \"exec\" family of functions. To expand glob patterns, either call the shell directly, taking care to escape any dangerous input, or use the path/filepath package's Glob function. To expand environment variables, use package os's ExpandEnv.</p>\n</blockquote>\n\n<p>With that in hand, my best guess to what you're trying to do is running bash and passing your command as an argument to it:</p>\n\n<pre><code>out, err := exec.Command(\"bash\", \"-c\", cmd)\n</code></pre>\n"}], "owner": {"reputation": 136, "user_id": 5367712, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/10205439123331950/picture?type=large", "display_name": "Divyaanand Sinha", "link": "https://stackoverflow.com/users/5367712/divyaanand-sinha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2591, "favorite_count": 2, "closed_date": 1536686021, "accepted_answer_id": 52281031, "answer_count": 1, "score": 0, "last_activity_date": 1536686318, "creation_date": 1536685487, "question_id": 52280905, "link": "https://stackoverflow.com/questions/52280905/golang-exec-command-bash-command-not-working", "closed_reason": "Duplicate", "title": "Golang exec.Command() bash command not working", "body": "<p>I want to run the following bash command using golang's exec.Command()</p>\n\n<pre><code>ls &gt; sample.txt\n</code></pre>\n\n<p>For this I write</p>\n\n<pre><code>_,err:=exec.Command(\"ls\",\"&gt;\",\"sample.txt\").Output()\n</code></pre>\n\n<p>But this doesn't seem to work. I know I can write to a file by using </p>\n\n<pre><code>exec.Command().StdoutPipe()\n</code></pre>\n\n<p>But I want to write sepcifically in that manner. Any idea how I can do it in golang?</p>\n"}, {"tags": ["go", "redis"], "answers": [{"comments": [{"owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1536735412, "post_id": 52280160, "comment_id": 91526118, "body": "Does not work  LPOP does not take a timeout option  I get this error   ERROR = ERR wrong number of arguments for &#39;lpop&#39; command  Also if I were to pass only 2 args still that does not give me a string output"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1536740228, "post_id": 52280160, "comment_id": 91528841, "body": "Sorry, that was a copy and paste error with the extra argument to LPOP.  Fixed.  The key point is that you should use redis.String when for commands that return a single value."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1536740162, "last_edit_date": 1536740162, "creation_date": 1536682414, "answer_id": 52280160, "question_id": 52279988, "link": "https://stackoverflow.com/questions/52279988/how-to-do-redis-redigo-lpop-in-golang/52280160#52280160", "title": "How to do Redis (redigo) lpop in golang", "body": "<p>The <a href=\"https://redis.io/commands/blpop\" rel=\"nofollow noreferrer\">BLPOP</a> command returns a two element array where the first element is the key and the second value is the popped element.</p>\n\n<p>The <a href=\"https://redis.io/commands/lpop\" rel=\"nofollow noreferrer\">LPOP</a> command returns the popped element.</p>\n\n<p>Use the String helper function to get the popped element:</p>\n\n<pre><code>reply, err := redis.String(conn.Do(\"LPOP\", key))\n        if err == nil {         \n           fmt.Println(reply)\n        // do something with string reply\n       }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "is_accepted": true, "score": 1, "last_activity_date": 1536737340, "creation_date": 1536737340, "answer_id": 52289710, "question_id": 52279988, "link": "https://stackoverflow.com/questions/52279988/how-to-do-redis-redigo-lpop-in-golang/52289710#52289710", "title": "How to do Redis (redigo) lpop in golang", "body": "<p>I can get the lpop'ed value using redis.String()</p>\n\n<p>so this works </p>\n\n<pre><code>reply, err := redis.String(conn.Do(\"LPOP\", key))\n    if err == nil { \n     fmt.Printf(\"REPLY= %s\\n\", reply)\n      //do something \n</code></pre>\n"}], "owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1317, "favorite_count": 0, "accepted_answer_id": 52289710, "answer_count": 2, "score": 0, "last_activity_date": 1536740162, "creation_date": 1536681686, "question_id": 52279988, "link": "https://stackoverflow.com/questions/52279988/how-to-do-redis-redigo-lpop-in-golang", "title": "How to do Redis (redigo) lpop in golang", "body": "<p>I need to do a simple lpop from a redis queue. \nIn go lang If I use a blocking pop using blpop then the foll code works </p>\n\n<pre><code>reply, err := redis.Strings(conn.Do(\"BLPOP\", key, 1))\n        if err == nil {         \n           fmt.Println(reply[1])\n\n        // do something with string reply[1]\n\n       }\n</code></pre>\n\n<p>But I do not want to block. I just need to end when the queue is empty. \nSo how can I do that \nIf I do <code>redis.Strings(conn.Do(\"LPOP\", key))</code>\nie change BLPOP to LPOP and I get a redigo error </p>\n\n<pre><code>ERROR = redigo: unexpected type for Strings, got type []uint8 \n</code></pre>\n"}, {"tags": ["go", "kubernetes", "google-cloud-platform", "google-kubernetes-engine", "kubernetes-go-client"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 9505597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eccb1561aaee2af6f7a19cb48963378b?s=128&d=identicon&r=PG&f=1", "display_name": "KcinnaY", "link": "https://stackoverflow.com/users/9505597/kcinnay"}, "edited": false, "score": 0, "creation_date": 1536745465, "post_id": 52285672, "comment_id": 91532101, "body": "Thank you for your reply! However it is not working yet. I set the GOOGLE_APPLICATION_CREDENTIALS to my service account json file that has &quot;Kubernetes Engine Admin&quot; and &quot;Kubernetes Engine Cluster Admin&quot; as role. For now I am using gcloud <code>container clusters describe</code> and hardcode the fields for <code>rest.Config</code> Username, password, host and use <code>clusterCaCertificate</code> field to set the <code>CAData</code> in <code>rest.TLSClientConfig</code>.  Within my application I am using &quot;cloud.google.com/go/container&quot; and I ideally don&#39;t want to execute gcloud commands. How can I get the data from the container package?"}, {"owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "reply_to_user": {"reputation": 63, "user_id": 9505597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eccb1561aaee2af6f7a19cb48963378b?s=128&d=identicon&r=PG&f=1", "display_name": "KcinnaY", "link": "https://stackoverflow.com/users/9505597/kcinnay"}, "edited": false, "score": 0, "creation_date": 1536779637, "post_id": 52285672, "comment_id": 91551829, "body": "There&#39;s examples of using GKE API in Python and Go here: <a href=\"https://ahmet.im/blog/gke-api/\" rel=\"nofollow noreferrer\">ahmet.im/blog/gke-api</a>. GKE has client libraries published in all languages supported by GCP client libraries. You can use them. Just take a look at <code>gcloud</code> command with <code>--log-http</code> to see the request."}, {"owner": {"reputation": 63, "user_id": 9505597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eccb1561aaee2af6f7a19cb48963378b?s=128&d=identicon&r=PG&f=1", "display_name": "KcinnaY", "link": "https://stackoverflow.com/users/9505597/kcinnay"}, "edited": false, "score": 0, "creation_date": 1536844926, "post_id": 52285672, "comment_id": 91576478, "body": "That worked to get the data within my application. Thank you. However I am still not able to connect to the cluster using the go-client with that CA data, username, password and endpoint. Is there maybe something like a firewall blocking it?"}, {"owner": {"reputation": 63, "user_id": 9505597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eccb1561aaee2af6f7a19cb48963378b?s=128&d=identicon&r=PG&f=1", "display_name": "KcinnaY", "link": "https://stackoverflow.com/users/9505597/kcinnay"}, "edited": false, "score": 0, "creation_date": 1537276038, "post_id": 52285672, "comment_id": 91719050, "body": "I also found your issue in <a href=\"https://github.com/kubernetes/client-go/issues/416\" rel=\"nofollow noreferrer\">the go-client issues</a>. I see that you are using the BearerToken. Do I also have to use this for gke? Where would I get that?"}, {"owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "reply_to_user": {"reputation": 63, "user_id": 9505597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eccb1561aaee2af6f7a19cb48963378b?s=128&d=identicon&r=PG&f=1", "display_name": "KcinnaY", "link": "https://stackoverflow.com/users/9505597/kcinnay"}, "edited": false, "score": 0, "creation_date": 1537325581, "post_id": 52285672, "comment_id": 91739134, "body": "Nope, don&#39;t use bearer token. Use the service account key by setting <code>GOOGLE_APPLICATION_CREDENTIALS</code> env variable and <code>import _ &quot;k8s.io&#47;client-go&#47;plugin&#47;pkg&#47;client&#47;auth&#47;gcp&quot;</code> package. See <code>client-go</code> examples/ directory."}], "tags": [], "owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "is_accepted": false, "score": 1, "last_activity_date": 1536710720, "creation_date": 1536710720, "answer_id": 52285672, "question_id": 52279187, "link": "https://stackoverflow.com/questions/52279187/google-container-cluster-as-config/52285672#52285672", "title": "Google container cluster as config", "body": "<p>I've answered a very similar question here: <a href=\"https://stackoverflow.com/questions/48400966/access-kubernetes-gke-cluster-outside-of-gke-cluster-with-client-go/48412272#48412272\">Access Kubernetes GKE cluster outside of GKE cluster with client-go?</a>.</p>\n\n<p>Basically, in a nutshell, the recommended way to do this is to:</p>\n\n<ol>\n<li>Create a Google Cloud IAM service account + download its json key</li>\n<li>Set <code>GOOGLE_APPLICATION_CREDENTIALS</code> env var to that key.json</li>\n<li>Find IP address and CA cert of the cluster from <code>gcloud container clusters describe</code> (or simply get a <code>.kube/config</code> file from <code>gcloud get-credentials</code></li>\n<li>Pass these values to client-go and run your program with the env var.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 9505597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eccb1561aaee2af6f7a19cb48963378b?s=128&d=identicon&r=PG&f=1", "display_name": "KcinnaY", "link": "https://stackoverflow.com/users/9505597/kcinnay"}, "is_accepted": true, "score": 4, "last_activity_date": 1537305340, "creation_date": 1537305340, "answer_id": 52394693, "question_id": 52279187, "link": "https://stackoverflow.com/questions/52279187/google-container-cluster-as-config/52394693#52394693", "title": "Google container cluster as config", "body": "<p>The ClientCertificate, ClientKey and ClusterCaCertificate need to be decoded as described <a href=\"https://github.com/terraform-providers/terraform-provider-kubernetes/issues/85\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>func CreateK8sClientFromCluster(cluster *gkev1.Cluster) {\n    decodedClientCertificate, err := base64.StdEncoding.DecodeString(cluster.MasterAuth.ClientCertificate)\n    if err != nil {\n        fmt.Println(\"decode client certificate error:\", err)\n        return\n    }\n    decodedClientKey, err := base64.StdEncoding.DecodeString(cluster.MasterAuth.ClientKey)\n    if err != nil {\n        fmt.Println(\"decode client key error:\", err)\n        return\n    }\n    decodedClusterCaCertificate, err := base64.StdEncoding.DecodeString(cluster.MasterAuth.ClusterCaCertificate)\n    if err != nil {\n        fmt.Println(\"decode cluster CA certificate error:\", err)\n        return\n    }\n\n    config := &amp;rest.Config{\n        Username: cluster.MasterAuth.Username,\n        Password: cluster.MasterAuth.Password,\n        Host:     \"https://\" + cluster.Endpoint,\n        TLSClientConfig: rest.TLSClientConfig{\n            Insecure: false,\n            CertData: decodedClientCertificate,\n            KeyData:  decodedClientKey,\n            CAData:   decodedClusterCaCertificate,\n        },\n    }\n\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        fmt.Printf(\"failed to get k8s client set from config: %s\\n\", err)\n        return\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 9505597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eccb1561aaee2af6f7a19cb48963378b?s=128&d=identicon&r=PG&f=1", "display_name": "KcinnaY", "link": "https://stackoverflow.com/users/9505597/kcinnay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 506, "favorite_count": 0, "accepted_answer_id": 52394693, "answer_count": 2, "score": 2, "last_activity_date": 1537305340, "creation_date": 1536678938, "last_edit_date": 1536704815, "question_id": 52279187, "link": "https://stackoverflow.com/questions/52279187/google-container-cluster-as-config", "title": "Google container cluster as config", "body": "<p>I am trying to use the <a href=\"https://github.com/kubernetes/client-go\" rel=\"nofollow noreferrer\">kubernetes go-client</a> with cloud.google.com/go/container. I create the cluster using the google cloud go container package, then I want to deploy on that cluster using go-client. The <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/out-of-cluster-client-configuration/main.go\" rel=\"nofollow noreferrer\">out of cluster example</a> given by the go-client uses the kube config file to get the credentials for the cluster. But since I just created this cluster within my application I don\u2019t have that config file.</p>\n\n<p>How can I setup a \u201ck8s.io/client-go/rest\u201d config with a \"google.golang.org/genproto/googleapis/container/v1\" Cluster? What are the required fields? The code below is what I currently have (without showing the actual CA certificate).</p>\n\n<pre><code>func getConfig(cluster *containerproto.Cluster) *rest.Config {\n    return &amp;rest.Config{\n        Host:     \"https://\" + cluster.GetEndpoint(),\n        TLSClientConfig: rest.TLSClientConfig{\n            Insecure: false,\n            CAData: []byte(`-----BEGIN CERTIFICATE-----\n                ...\n                -----END CERTIFICATE-----`),\n        },\n    }\n</code></pre>\n\n<p>It results in this error: x509: certificate signed by unknown authority. So there is obviously something missing.\nAny other approach is more than welcome! Thanks in advance</p>\n"}, {"tags": ["api", "go", "endpoint"], "comments": [{"owner": {"reputation": 95, "user_id": 6117766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09e3f10505afcaf56b6fc59ca471eed3?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Laguna", "link": "https://stackoverflow.com/users/6117766/paul-laguna"}, "reply_to_user": {"reputation": 21133, "user_id": 1084416, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/RLhZZ.jpg?s=128&g=1", "display_name": "Peter Wood", "link": "https://stackoverflow.com/users/1084416/peter-wood"}, "edited": false, "score": 0, "creation_date": 1536678225, "post_id": 52278556, "comment_id": 91505772, "body": "I\u2019m open to using Python to search for my APIs if thats a solution there too."}, {"owner": {"reputation": 21133, "user_id": 1084416, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/RLhZZ.jpg?s=128&g=1", "display_name": "Peter Wood", "link": "https://stackoverflow.com/users/1084416/peter-wood"}, "edited": false, "score": 2, "creation_date": 1536678297, "post_id": 52278556, "comment_id": 91505821, "body": "That&#39;s too broad a question really, then. See what&#39;s on topic in the <a href=\"https://stackoverflow.com/help/on-topic\">help center</a>."}, {"owner": {"reputation": 95, "user_id": 6117766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09e3f10505afcaf56b6fc59ca471eed3?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Laguna", "link": "https://stackoverflow.com/users/6117766/paul-laguna"}, "reply_to_user": {"reputation": 21133, "user_id": 1084416, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/RLhZZ.jpg?s=128&g=1", "display_name": "Peter Wood", "link": "https://stackoverflow.com/users/1084416/peter-wood"}, "edited": false, "score": 0, "creation_date": 1536678474, "post_id": 52278556, "comment_id": 91505932, "body": "Yeah sorry to disappoint you Peter, but that all I\u2019ve got. Desperate to find a solution. Guess I\u2019ll just leave this here for a few hours till someone appears that knows what to do in this situation. I\u2019ve got an upvote so it\u2019s clearly on some people minds."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 6117766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09e3f10505afcaf56b6fc59ca471eed3?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Laguna", "link": "https://stackoverflow.com/users/6117766/paul-laguna"}, "edited": false, "score": 0, "creation_date": 1536681154, "post_id": 52279648, "comment_id": 91507656, "body": "This is great. Thank you.!"}], "tags": [], "owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "is_accepted": true, "score": 1, "last_activity_date": 1536680516, "creation_date": 1536680516, "answer_id": 52279648, "question_id": 52278556, "link": "https://stackoverflow.com/questions/52278556/how-can-i-find-all-the-apis-of-my-website/52279648#52279648", "title": "How can I find all the APIs of my website?", "body": "<p>This really depends on what your developer used to create the APIs. Your best bet is to parse the source code rather than poke with tools like Chrome inspector. What you want to find is the router for the API handlers. The router is basically a structure that maps API endpoints (like <code>/api/v1/login/</code>) to Go functions that handle the calls (appropriately called handlers). But, unfortunately, depending on what framework/library was used and how the code was structured, this could be in a lot of very different places. So, while I cannot give you one definite answer, I can give you a few suggestions.</p>\n\n<ol>\n<li>You are going to have to read Go code. No way around it. It is not that hard, so don't get scared.</li>\n<li>There is a good chance that there is a file or multiple files called route.go or routes.go or router.go or something similar. If you find anything like that, look there first.</li>\n<li>If you cannot find any routes, use Chrome inspector's network tab to see what API calls your front end makes, then grep the code for the endpoints. Say, if your front end makes an API call to <code>http://api.domain.com/api/v1/accounts/</code>, search the code for <code>/accounts/</code> and for <code>/api/v1/</code> and if that doesn't work for <code>/api/</code>. With any luck the second or third search might get you to the root router for the application and you will be able to trace it from there.</li>\n<li>If you find some routes (or route handlers), but not all of them, look for the package name at the top of the file. If it is not <code>main</code>, and especially if it is called something like <code>routes</code> look for any place where this package is imported (just grep for the package name in all the files and ignore the package declaration itself).</li>\n<li>Probably the most popular router library is <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">gorilla mux</a>. Check the code for any references to <code>github.com/gorilla/mux</code> in case it was used. If it was used, look for any code that has <code>HandleFunc</code> in it. These are going to be the routers. The same is true if no router library is used at all.</li>\n</ol>\n\n<p>Good luck.</p>\n"}], "owner": {"reputation": 95, "user_id": 6117766, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09e3f10505afcaf56b6fc59ca471eed3?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Laguna", "link": "https://stackoverflow.com/users/6117766/paul-laguna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "closed_date": 1536927441, "accepted_answer_id": 52279648, "answer_count": 1, "score": 0, "last_activity_date": 1536680516, "creation_date": 1536677019, "last_edit_date": 1536678225, "question_id": 52278556, "link": "https://stackoverflow.com/questions/52278556/how-can-i-find-all-the-apis-of-my-website", "closed_reason": "Needs more focus", "title": "How can I find all the APIs of my website?", "body": "<p>The lead developer abruptly left my company last week. The APIs weren't documented. So I'm scrabbling to discover what each one API is, and then document them in JIRA. We use Golang for our backend. I tried using Charles Proxy, Fiddler, JMeter, and Chromes inspector/network, but the APIs aren't displaying. I have technical limitations and I'd like to find all our APIs as soon as possible. One of my developers told me to download and install Goland. And instructed me to perform the following</p>\n\n<p>\"byte.*(okay|StatusOK|Successful)\nand <code>mux.</code> and <code>nomapi.</code> to get the end points and those that are using it, not sure if all of them use mux and nomapi though</p>\n\n<p>With goland you can jump to definitions easily very useful with not familiar code\nAnd find usages\"</p>\n\n<p>Not sure what he meant by all of that. </p>\n\n<p>Can someone point me in the right direction?</p>\n"}, {"tags": ["go", "go-http"], "comments": [{"owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "reply_to_user": {"reputation": 1844, "user_id": 4844024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9de342e1ce408f4874eac3f019efb33?s=128&d=identicon&r=PG&f=1", "display_name": "mad.meesh", "link": "https://stackoverflow.com/users/4844024/mad-meesh"}, "edited": false, "score": 0, "creation_date": 1536673858, "post_id": 52277317, "comment_id": 91502891, "body": "I found the culprit: the underlying <code>http.Request</code> passed in. It&#39;s a pointer, and that same pointer is being assigned to the fields of both fakeRequests. idk how to remedy this by deep-copy."}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1536674631, "post_id": 52277317, "comment_id": 91503431, "body": "I don&#39;t think there is a simple way to do a deep-copy. But you could try dereferencing both pointers when copying the request for a start (take a look at <a href=\"https://stackoverflow.com/questions/21011023/copy-pointer-values-a-b-in-golang\">this question</a>). This will at least create a new <code>http.Request</code>. But fields like the request&#39;s <code>Body</code> require special handling and I am not sure which other fields would require additional attention. Maybe take a look at <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/ICMa3bQBUkM/lKxI4xuXXt0J\" rel=\"nofollow noreferrer\">this discussion</a> on the topic in the golang-nuts group."}], "answers": [{"tags": [], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "is_accepted": true, "score": 0, "last_activity_date": 1536683018, "creation_date": 1536683018, "answer_id": 52280322, "question_id": 52277317, "link": "https://stackoverflow.com/questions/52277317/field-state-of-web-request-struct-not-cloning-properly-in-golang/52280322#52280322", "title": "field state of web.Request struct not cloning properly in Golang", "body": "<p>The issue was, indeed, not with the <code>Header</code> field, but instead the <code>Request</code> field, which was a pointer. (Oh no! I accidentally shallow-copied)</p>\n\n<p><strong>The Solution</strong></p>\n\n<p>I recalled, in one of my earlier tests, a method that I wrote specifically to get around this: </p>\n\n<pre><code>func makeBasicRequest() *web.Request {\n    baseReq := httptest.NewRequest(http.MethodPost,\n        \"[some url here]\",\n        nil)\n    req := new(web.Request)\n    req.Request = baseReq\n    return req\n}\n</code></pre>\n\n<p>I basically just brought it into this test, and used it, hitting it once per fake request that I needed. </p>\n"}], "owner": {"reputation": 3022, "user_id": 2027839, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0cdfc83802dff15a73a5c273c1b4154?s=128&d=identicon&r=PG", "display_name": "Mike Warren", "link": "https://stackoverflow.com/users/2027839/mike-warren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 1, "accepted_answer_id": 52280322, "answer_count": 1, "score": 1, "last_activity_date": 1536686667, "creation_date": 1536673230, "last_edit_date": 1536686667, "question_id": 52277317, "link": "https://stackoverflow.com/questions/52277317/field-state-of-web-request-struct-not-cloning-properly-in-golang", "title": "field state of web.Request struct not cloning properly in Golang", "body": "<p>In trying to set up two different <a href=\"https://github.com/hsoshiant/web\" rel=\"nofollow noreferrer\"><code>web.Request</code></a> states for use in some test cases, one without any headers and one with, I run into issue: </p>\n\n<p><strong>Setup</strong></p>\n\n<p>I create <code>fakeRequest</code>,<code>fakeRequestNoHeaders</code> thus:</p>\n\n<pre><code>// create fake request\nfakeRequest := new(web.Request)\nfakeRequest.Request = httptest.NewRequest(\"GET\",\n    fakeServer.URL,\n    nil)\n\nfakeRequestNoHeaders := new(web.Request)\nfakeRequestNoHeaders.Request = fakeRequest.Request\n\n// give fakeRequest some headers\nfakeRequest.Header.Add(\"Authorization\", \"Bearer ksjaf;oipyu7\")\nfakeRequest.Header.Add(\"Scope\", \"test\")\n</code></pre>\n\n<p><strong>Sanity Test</strong></p>\n\n<p>I expect, of course, that <code>fakeRequest.Header != fakeRequestNoHeaders.Header</code>.\nI write that test:</p>\n\n<pre><code>t.Run(\"HeadersSanityTest\", func(t *testing.T) {\n\n\n    assert.NotEqualf(t,\n        fakeRequest.Header,\n        fakeRequestNoHeaders.Header,\n        \"fakeRequest,fakeRequestNoHeaders share the same header state\")\n</code></pre>\n\n<p><strong>Result of test</strong></p>\n\n<p>It fails. </p>\n\n<p>Why is this and how can I achieve what I'm trying?</p>\n\n<p><strong>UPDATE</strong>: I found the culprit: </p>\n\n<p>the underlying <code>http.Request</code>, returned by <code>httptest.NewRequest</code>, is actually a pointer. <code>Header</code> simply belongs to that <code>Request</code>. The problem now reduces down to \"How to deep-copy that <code>Request</code>.\"</p>\n"}, {"tags": ["go", "raspberry-pi", "raspbian", "cockroachdb"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536675062, "post_id": 52277016, "comment_id": 91503758, "body": "With no code to look at, this is difficult, if not impossible, to answer. If you&#39;re just trying to build someone else&#39;s project without familiarity with the code, and running into issues, contact the project maintainer and/or file a bug report with them."}, {"owner": {"reputation": 750, "user_id": 2690165, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/f0fab7c7aace5c1103b6cc490206c8e0?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian", "link": "https://stackoverflow.com/users/2690165/lucian"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536676889, "post_id": 52277016, "comment_id": 91504944, "body": "What &#39;code to look&#39;, it&#39;s written in Golang, it has 50Mb of source code and uses ~50 3rd party libs. The question is related to buiding it from sources, it&#39;s an open source...if you have no XP with this open source projects, please ask before.."}, {"owner": {"reputation": 750, "user_id": 2690165, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/f0fab7c7aace5c1103b6cc490206c8e0?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian", "link": "https://stackoverflow.com/users/2690165/lucian"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536676968, "post_id": 52277016, "comment_id": 91505003, "body": "It&#39;s like saying give me the sources from QT, I want to look over it to see where the problem is..It&#39;s an open source sw and you can build it on various platforms..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536677863, "post_id": 52277016, "comment_id": 91505548, "body": "But if you have no familiarity with the code, if you&#39;re asking about a build problem with no concept of the underlying code problem, you&#39;re basically asking the community to read that 50MB of source for you. Which is why I suggest instead reaching out to the project&#39;s maintainers instead of SO."}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1536799577, "post_id": 52277016, "comment_id": 91557811, "body": "Note that the stack trace shows you where the error is: <code>&#47;home&#47;pi&#47;work&#47;go&#47;src&#47;github.com&#47;cockroachdb&#47;cockroach&#47;pkg&#47;ut&zwnj;&#8203;il&#47;humanizeutil&#47;huma&zwnj;&#8203;nize.go:109</code>. This looks like a bug in that program, and is probably better reported on their issue tracker."}], "answers": [{"comments": [{"owner": {"reputation": 750, "user_id": 2690165, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/f0fab7c7aace5c1103b6cc490206c8e0?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian", "link": "https://stackoverflow.com/users/2690165/lucian"}, "edited": false, "score": 0, "creation_date": 1536926033, "post_id": 52318443, "comment_id": 91609525, "body": "Thank you for the answer, really helped"}], "tags": [], "owner": {"reputation": 414, "user_id": 3435257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4e0bfc85f4590393266d551926a5756?s=128&d=identicon&r=PG&f=1", "display_name": "Nathan VanBenschoten", "link": "https://stackoverflow.com/users/3435257/nathan-vanbenschoten"}, "is_accepted": false, "score": 1, "last_activity_date": 1536857865, "creation_date": 1536857865, "answer_id": 52318443, "question_id": 52277016, "link": "https://stackoverflow.com/questions/52277016/buiding-cockroachdb-for-rpi-yields-segmentation-violation-error/52318443#52318443", "title": "Buiding CockroachDB for RPi yields &#39;segmentation violation error&#39;", "body": "<p>thanks for the question. I was the original author of that blog post. It looks like you're running into an issue related to <a href=\"https://github.com/golang/go/issues/9959\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/9959</a>. It looks like golang requires 64-bit alignment of 64-bit words when atomically accessed. This is somewhat tricky to enforce across an entire project. Still, we can try to get this working by removing the atomic access on <code>pkg/util/humanizeutil/humanize.go:109</code> (which doesn't look necessary) and replacing it with <code>return IBytes(*b.val)</code>. That should at least get you past this roadblock. There may be other issues you run into after this though. Unfortunately, CockroachDB has never set up CI around a 32-bit ARMv7 build because 32-bit architectures have never been officially supported by the project.</p>\n\n<p>However, a 64-bit ARMv8 build is more actively maintained. In fact, an entire cross-compilation toolchain has been introduced to build CockroachDB for ARMv8 on an x86_64 host. Compilation using this toolchain can be kicked off by running <code>build/builder.sh mkrelease arm64-linux-gnueabi</code>. The resulting binary can be dropped onto a RaspberryPi running a 64-bit OS like <a href=\"https://wiki.debian.org/RaspberryPi3\" rel=\"nofollow noreferrer\">https://wiki.debian.org/RaspberryPi3</a>. I actually tried this out last week and ran into no problems.</p>\n"}], "owner": {"reputation": 750, "user_id": 2690165, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/f0fab7c7aace5c1103b6cc490206c8e0?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian", "link": "https://stackoverflow.com/users/2690165/lucian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536857865, "creation_date": 1536672327, "last_edit_date": 1536673096, "question_id": 52277016, "link": "https://stackoverflow.com/questions/52277016/buiding-cockroachdb-for-rpi-yields-segmentation-violation-error", "title": "Buiding CockroachDB for RPi yields &#39;segmentation violation error&#39;", "body": "<p>I am trying to build CockroachDB from sources on a RPi 3, following a couple of posts (<a href=\"https://www.cockroachlabs.com/blog/run-cockroachdb-on-a-raspberry-pi/\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://forum.cockroachlabs.com/t/cockroach-on-the-raspbery-pi-3-64-bit/1246\" rel=\"nofollow noreferrer\">this</a>).</p>\n\n<blockquote>\n  <p>My RaspberryPi setup:</p>\n  \n  <ul>\n  <li>OS: 2018-06-27-raspbian-stretch</li>\n  <li>CPU: ARMv7 rev 4(v71)</li>\n  <li>Mem: 1G + SWAP: 1.5G</li>\n  <li>Go version: go1.11 linux/arm</li>\n  </ul>\n</blockquote>\n\n<p>I fixed a couple of errors regarding 3rd party libraries while 'make'ing it but now I got stuck on this:</p>\n\n<pre><code>pi@raspberrypi:~/work/go/src/github.com/cockroachdb/cockroach $ make build TAGS='stdmalloc' -j2\nGOPATH set to /home/pi/work/go\ngo build -o cockroach -v  -tags 'stdmalloc make arm_linux_gnueabihf_stdmalloc' -ldflags '-X github.com/cockroachdb/cockroach/pkg/build.typ=development -extldflags \"\" -X \"github.com/cockroachdb/cockroach/pkg/build.tag=v2.2.0-alpha.00000000-668-gf76d921f42-dirty\" -X \"github.com/cockroachdb/cockroach/pkg/build.rev=f76d921f4262356fde83312d0f471262d995f1e0\" -X \"github.com/cockroachdb/cockroach/pkg/build.cgoTargetTriple=arm-linux-gnueabihf\"   -X \"github.com/cockroachdb/cockroach/pkg/build.utcTime=2018/09/11 12:47:32\"' ./pkg/cmd/cockroach\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x2372b8]\n\ngoroutine 1 [running]:\nruntime/internal/atomic.goLoad64(0x3d65bdc, 0x0, 0x5607a20)\n/usr/local/go/src/runtime/internal/atomic/atomic_arm.go:124 +0x1c\ngithub.com/cockroachdb/cockroach/pkg/util/humanizeutil.(*BytesValue).String(0x55fb578, 0x5607a01, 0x56d9ea0)\n/home/pi/work/go/src/github.com/cockroachdb/cockroach/pkg/util/humanizeutil/humanize.go:109 +0x28\ngithub.com/cockroachdb/cockroach/pkg/cli.(*bytesOrPercentageValue).String(0x57b4920, 0x56d9ea0, 0x7)\n/home/pi/work/go/src/github.com/cockroachdb/cockroach/pkg/cli/flags_util.go:492 +0x20\ngithub.com/cockroachdb/cockroach/vendor/github.com/spf13/pflag.(*FlagSet).VarPF(0x54d3a00, 0x25cf778, 0x57b4920, 0x1ef3864, 0xe, 0x0, 0x0, 0x56d2900, 0x169, 0x56d9ea0)\n/home/pi/work/go/src/github.com/cockroachdb/cockroach/vendor/github.com/spf13/pflag/flag.go:778 +0x24\ngithub.com/cockroachdb/cockroach/vendor/github.com/spf13/pflag.(*FlagSet).VarP(0x54d3a00, 0x25cf778, 0x57b4920, 0x1ef3864, 0xe, 0x0, 0x0, 0x56d2900, 0x169)\n/home/pi/work/go/src/github.com/cockroachdb/cockroach/vendor/github.com/spf13/pflag/flag.go:786 +0x5c\ngithub.com/cockroachdb/cockroach/pkg/cli.VarFlag(0x54d3a00, 0x25cf778, 0x57b4920, 0x1ef3864, 0xe, 0x0, 0x0, 0x0, 0x0, 0x1fa4462, ...)\n/home/pi/work/go/src/github.com/cockroachdb/cockroach/pkg/cli/flags.go:129 +0x6c\ngithub.com/cockroachdb/cockroach/pkg/cli.init.5()\n/home/pi/work/go/src/github.com/cockroachdb/cockroach/pkg/cli/flags.go:324 +0x6c0\nMakefile:1288: recipe for target 'docs/generated/settings/settings.html' failed\nmake: *** [docs/generated/settings/settings.html] Error 2\nmake: *** Deleting file 'docs/generated/settings/settings.html'\n</code></pre>\n\n<p>Any ideas what might be wrong?</p>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "mongo-go"], "answers": [{"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 2, "last_activity_date": 1536710722, "creation_date": 1536710722, "answer_id": 52285673, "question_id": 52276568, "link": "https://stackoverflow.com/questions/52276568/how-to-parse-extended-json-date-in-aggregation-pipeline-using-parseextjsonarray/52285673#52285673", "title": "How to parse extended JSON Date in aggregation pipeline using ParseExtJSONArray() in mongo-go-driver", "body": "<p>The idea behind <a href=\"https://docs.mongodb.com/manual/reference/mongodb-extended-json/#mongodb-extended-json\" rel=\"nofollow noreferrer\">MongoDB Extended JSON</a> is to represent Binary JSON (<a href=\"https://docs.mongodb.com/manual/reference/glossary/#term-bson\" rel=\"nofollow noreferrer\">BSON</a>) types in plain JSON. </p>\n\n<p>The general syntax is to represent an object as a single embedded document. For example, BSON <a href=\"https://docs.mongodb.com/manual/reference/mongodb-extended-json/#binary\" rel=\"nofollow noreferrer\">binary</a> object is represented as a document <code>{\"$binary\": \"&lt;binary data&gt;\"}</code>. The <code>$</code> prefix in the key field indicates the type. The same goes for BSON <a href=\"https://docs.mongodb.com/manual/reference/mongodb-extended-json/#date\" rel=\"nofollow noreferrer\">date</a> object.</p>\n\n<p>The method <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson#ParseExtJSONArray\" rel=\"nofollow noreferrer\">bson.ParseExtJSONArray()</a> expects extended JSON types to be documents, and not in MongoDB <a href=\"https://docs.mongodb.com/manual/core/document/#dot-notation\" rel=\"nofollow noreferrer\">dot-notation</a> expression. For example, instead of below: </p>\n\n<pre><code>{ \"$match\": { \"dateTimeGMT.$date\":\"2018-08-22T09:29:25.000Z\" } }\n</code></pre>\n\n<p>The method expects: </p>\n\n<pre><code>{ \"$match\": { \"dateTimeGMT\": {\"$date\":\"2018-08-22T09:29:25.000Z\" } } }\n</code></pre>\n\n<p>You can also supply the date value in <a href=\"https://docs.mongodb.com/manual/reference/glossary/#term-unix-epoch\" rel=\"nofollow noreferrer\">Unix Epoch</a>, for example: </p>\n\n<pre><code>{ \"$match\": { \"dateTimeGMT\": {\"$date\": { \"$numberLong\": \"1546300800\"} } } }\n</code></pre>\n\n<p>Using <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson\" rel=\"nofollow noreferrer\">mongo-go-driver/bson</a>, an example would be: </p>\n\n<pre><code>raw := `[ { \"$match\": {\"dateTimeGMT\": {\"$date\": {\"$numberLong\": \"1530962624753\" } } } } ]`\npipeline, err := bson.ParseExtJSONArray(raw)\ncursor, err := collection.Aggregate(context.Background(), pipeline)\n</code></pre>\n\n<p><em>Extra Note:</em> \nyou can debug <code>ParseExtJSONArray()</code> before passing the resulting value to aggregation by iterating over it. For example: </p>\n\n<pre><code>toConvert := `[\n   { \"$lookup\": {\n        \"from\": \"anotherCollection\",\n        \"localField\": \"foreignKey\",\n        \"foreignField\": \"_id\",\n        \"as\": \"someField\"\n    }},\n    { \"$match\": {\"dateTimeGMT\":{\"$lt\": {\"$date\": \"2019-01-10T09:29:25.000Z\" } } } }\n]`\npipeline, err := bson.ParseExtJSONArray(toConvert)\n\nit, err := bson.NewArrayIterator(pipeline)\nfor it.Next() {\n    fmt.Println(it.Value().MutableDocument().ToExtJSON(true))\n}\n\n//Outputs : \n//   {\"$lookup\":{\"from\":\"anotherCollection\",\"localField\":\"foreignKey\",\"foreignField\":\"_id\",\"as\":\"someField\"}}\n//   {\"$match\":{\"dateTimeGMT\":{\"$lt\":{\"$date\":{\"$numberLong\":\"1547112565000\"}}}}}\n//\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 8532196, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vhyAG.jpg?s=128&g=1", "display_name": "Andrew Springman", "link": "https://stackoverflow.com/users/8532196/andrew-springman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1277, "favorite_count": 0, "accepted_answer_id": 52285673, "answer_count": 1, "score": 1, "last_activity_date": 1536710990, "creation_date": 1536670799, "last_edit_date": 1536710990, "question_id": 52276568, "link": "https://stackoverflow.com/questions/52276568/how-to-parse-extended-json-date-in-aggregation-pipeline-using-parseextjsonarray", "title": "How to parse extended JSON Date in aggregation pipeline using ParseExtJSONArray() in mongo-go-driver", "body": "<p>I've got a collection with a Date field:</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"5b92b359ddceef5b24502834\"),\n    \"dateTimeGMT\" : ISODate(\"2018-08-22T09:29:25.000Z\"),\n    yada, yada, yada\n}\n</code></pre>\n\n<p>I'm trying to find by date in a $match aggregation stage with the ParseExtJSONArray function of mongo-go-driver.  (I am aware of how to do this with *bson.Array directly.  I'm asking so I know the right way to do it with ParserExtJSONArray or if I've run up against a limitation.)</p>\n\n<p>I've simplified to this example and confirmed it is failing to match the above document.</p>\n\n<pre><code>pipeline, err := bson.ParseExtJSONArray(`[\n    { \"$match\": { \"dateTimeGMT.$date\":\"2018-08-22T09:29:25.000Z\" } }\n]`)\ncursor, err := receivedFromResponseQueue.Aggregate(ctx, pipeline)\n</code></pre>\n\n<p>The following doesn't work in the mongo shell.  ( Not surprising because it converts automatically to ISODate() format )</p>\n\n<pre><code>db.getCollection('received_from_response_queue').aggregate([\n    { \"$match\": { \"dateTimeGMT.$date\":\"2018-08-22T09:29:25.000Z\" } }\n])\n</code></pre>\n\n<p>But this does work in the mongo shell.</p>\n\n<pre><code>db.getCollection('received_from_response_queue').aggregate([\n    { \"$match\": { \"dateTimeGMT\": ISODate(\"2018-08-22T09:29:25.000Z\") } }\n])\n</code></pre>\n\n<p>But this returns an empty array in \"pipeline\".  (Because ParseExtJSONArray doesn't handle JavaScript)</p>\n\n<pre><code>pipeline, err := bson.ParseExtJSONArray(`[\n    { \"$match\": { \"dateTimeGMT\":ISODate(\"2018-08-22T09:29:25.000Z\") } }\n]`)\n</code></pre>\n\n<p>Because it then uses an empty array it retuns all the documents in the collection.  Interestingly, the date is formatted differently in the document we are trying to match.</p>\n\n<pre><code>{\n    \"_id\" : { \"$oid\" : \"5b92b359ddceef5b24502834\" },\n    \"dateTimeGMT\" : { \"$date\" : \"2018-08-22T05:29:25-04:00\" },\n    yada yada yada\n}\n</code></pre>\n\n<p>But this doesn't match either.</p>\n\n<pre><code>pipeline, err := bson.ParseExtJSONArray(`[\n    { \"$match\": { \"dateTimeGMT.$date\":\"2018-08-22T05:29:25-04:00\" } }\n]`)\ncursor, err := receivedFromResponseQueue.Aggregate(ctx, pipeline)\n</code></pre>\n\n<p>And this doesn't work in the mongo shell.</p>\n\n<pre><code>db.getCollection('received_from_response_queue').aggregate([\n    { \"$match\": { \"dateTimeGMT.$date\":\"2018-08-22T05:29:25-04:00\" } }\n])\n</code></pre>\n\n<p>Any insight?</p>\n"}, {"tags": ["go", "random"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1536680884, "post_id": 52276548, "comment_id": 91507494, "body": "Wouldn&#39;t have thought of re-seeding an RNG on each call to demonstrate the cost of function calls, but the fact that 47 and 99 show up 32 and 33 times respectively, compared to 34&#39;s 19 matches and 10 matching just 12 times indicates CPU level optimisation, perhaps. At any rate, it shows that <code>fmt.Print</code> + <code>getRand</code> + the 5 calls within <code>getRand</code> all happen in under .1 nanoseconds. Don&#39;t know why, but I like it when simple code examples hint at what is going on at a lower level. +1 for that"}], "answers": [{"comments": [{"owner": {"reputation": 255, "user_id": 10347465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf6002c0020b219420a37e125d167238?s=128&d=identicon&r=PG", "display_name": "kapaw", "link": "https://stackoverflow.com/users/10347465/kapaw"}, "edited": false, "score": 0, "creation_date": 1536671443, "post_id": 52276590, "comment_id": 91501137, "body": "Awesome, thanks! I do plan on spinning go threads, so I&#39;m wondering if synchronized access would reduce efficiency gains obtained through concurrency?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 255, "user_id": 10347465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf6002c0020b219420a37e125d167238?s=128&d=identicon&r=PG", "display_name": "kapaw", "link": "https://stackoverflow.com/users/10347465/kapaw"}, "edited": false, "score": 0, "creation_date": 1536671608, "post_id": 52276590, "comment_id": 91501265, "body": "@kapaw Yes, synchronization will make it somewhat slower, but that doesn&#39;t mean your app will be slower. Measure. Also if you create and use a separate <code>rand.Rand</code> for each goroutine, you don&#39;t need to use synchronization."}, {"owner": {"reputation": 255, "user_id": 10347465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf6002c0020b219420a37e125d167238?s=128&d=identicon&r=PG", "display_name": "kapaw", "link": "https://stackoverflow.com/users/10347465/kapaw"}, "edited": false, "score": 0, "creation_date": 1536673395, "post_id": 52276590, "comment_id": 91502512, "body": "So I&#39;d have to globally define each one?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 255, "user_id": 10347465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf6002c0020b219420a37e125d167238?s=128&d=identicon&r=PG", "display_name": "kapaw", "link": "https://stackoverflow.com/users/10347465/kapaw"}, "edited": false, "score": 0, "creation_date": 1536676917, "post_id": 52276590, "comment_id": 91504958, "body": "@kapaw It doesn&#39;t matter how you store them, it doesn&#39;t have to be global variables, but each such goroutine should have its own, that is only used by a single goroutine."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1536686296, "last_edit_date": 1536686296, "creation_date": 1536670866, "answer_id": 52276590, "question_id": 52276548, "link": "https://stackoverflow.com/questions/52276548/generating-identical-random-numbers-in-sequence-after-time-seed-running-on-my/52276590#52276590", "title": "Generating identical random numbers in sequence after time seed? (Running on my machine)", "body": "<p>This is because <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a> has a granularity (which is 1 nanosecond) just like your system clock (which might even be multiple milliseconds\u2013depends on many things), and if you call <a href=\"https://golang.org/pkg/time/#Now\" rel=\"nofollow noreferrer\"><code>time.Now()</code></a> multiple times within the greater of these granularities, chances are the returned <code>time.Time</code> will be the same, meaning its <a href=\"https://golang.org/pkg/time/#Time.UnixNano\" rel=\"nofollow noreferrer\"><code>Time.UnixNano()</code></a> method will return you the same nanoseconds (the same number).</p>\n\n<p>And if you use the same number as the seed, the random number generator is ought to return the same numbers.</p>\n\n<p>You only need to seed the RNG once, on app startup, not before each use. You may use a package <code>init()</code> function for that, or in the variable declaration:</p>\n\n<pre><code>var r = rand.New(rand.NewSource(time.Now().UnixNano()))\n\n//Generates random int as function of range\nfunc getRand(Range int) int {\n    return r.Intn(Range)\n}\n\n//Print 100 random ints between 0 and 100\nfunc main() {\n    for i := 0; i &lt; 100; i++ {\n        fmt.Print(getRand(100), \", \")\n    }\n}\n</code></pre>\n\n<p>Example output (try it on the <a href=\"https://play.golang.org/p/fA3aProJUFG\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<blockquote>\n  <p>0, 28, 27, 62, 63, 89, 24, 27, 88, 84, 82, 55, 49, 35, 2, 32, 84, 58, 78, 28, 26, 58, 30, 28, 74, 6, 39, 24, 40, 47, 49, 39, 61, 62, 67, 7, 94, 87, 37, 99, 90, 80, 93, 83, 27, 69, 25, 45, 99, 12, 44, 39, 34, 86, 18, 42, 76, 40, 44, 12, 70, 3, 70, 99, 57, 43, 90, 65, 97, 64, 68, 60, 65, 56, 3, 81, 54, 56, 43, 57, 92, 93, 54, 92, 9, 86, 16, 72, 29, 12, 97, 87, 55, 42, 87, 41, 94, 53, 23, 64, </p>\n</blockquote>\n\n<p>One thing to note here: <a href=\"https://golang.org/pkg/math/rand/#NewSource\" rel=\"nofollow noreferrer\"><code>rand.NewSource()</code></a> returns a source which is not safe for concurrent use. If you need to call <code>getRand()</code> from multiple goroutines, you need to synchronize access to <code>r</code>, or use a separate <a href=\"https://golang.org/pkg/math/rand/#Rand\" rel=\"nofollow noreferrer\"><code>rand.Rand</code></a> in each goroutine.</p>\n"}, {"tags": [], "owner": {"reputation": 274, "user_id": 8248344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f4caffd048139d7b9bd6eab182f402f?s=128&d=identicon&r=PG&f=1", "display_name": "Nandl66", "link": "https://stackoverflow.com/users/8248344/nandl66"}, "is_accepted": false, "score": 1, "last_activity_date": 1536672218, "last_edit_date": 1536672218, "creation_date": 1536671610, "answer_id": 52276788, "question_id": 52276548, "link": "https://stackoverflow.com/questions/52276548/generating-identical-random-numbers-in-sequence-after-time-seed-running-on-my/52276788#52276788", "title": "Generating identical random numbers in sequence after time seed? (Running on my machine)", "body": "<p>I'm not a Go expert but I think the problem is a generic programming issue. It is related to the fact you set the seed to each call. The seed is based on time function. So what is happening is that in a very short time, you have a number of calls while the time is not changed (yet) and so you get the same value because you are setting the same seed again and again.</p>\n\n<p>Try to set the seed, <em>once only</em> and <em>outside</em> the <code>for</code> loop of calls.</p>\n"}], "owner": {"reputation": 255, "user_id": 10347465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf6002c0020b219420a37e125d167238?s=128&d=identicon&r=PG", "display_name": "kapaw", "link": "https://stackoverflow.com/users/10347465/kapaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 995, "favorite_count": 0, "accepted_answer_id": 52276590, "answer_count": 2, "score": 2, "last_activity_date": 1610976948, "creation_date": 1536670735, "last_edit_date": 1610976948, "question_id": 52276548, "link": "https://stackoverflow.com/questions/52276548/generating-identical-random-numbers-in-sequence-after-time-seed-running-on-my", "title": "Generating identical random numbers in sequence after time seed? (Running on my machine)", "body": "<p>I'm trying to understand precisely why, when called from an external function, my time seeded random number generator returns sequences of identical numbers.</p>\n\n<p>Minimal working example of issue:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\n//Generates random int as function of range\nfunc getRand(Range int) int {\n    s1 := rand.NewSource(time.Now().UnixNano())\n    r1 := rand.New(s1)\n    return r1.Intn(Range)\n}\n\n//Print 100 random ints between 0 and 100\nfunc main() {\n    for i := 0; i &lt; 100; i++ {\n        fmt.Print(getRand(100), \", \")\n    }\n}\n</code></pre>\n\n<p>The output of this is </p>\n\n<pre><code>Out[1]: 40, 40, 40, 40, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 34,\n34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 34, 47, \n47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, \n47,47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 47, 99, 99, 99, 99, 99, 99, 99, \n99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99,\n99, 99, 99, 99, 99, 99, 99,\n</code></pre>\n\n<p>I'd like to know why this is happening for my own education. I'm also open to suggestions for a solution. </p>\n\n<p>Details: I need to call random numbers in lots of external functions of my code but, like this MWE, when seeded within a function other than main they repeatedly return the same numbers. Additionally, I need to dynamically update the range, so generating lists a priori is not an option. I would rather not have to generate the numbers in main() and pass them into each function-- ranges are calculated inside these and it would complicate things</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1536669628, "post_id": 52276079, "comment_id": 91499847, "body": "What about struct&#39;s fields? Isn&#39;t a common interface field-less?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1536670296, "post_id": 52276079, "comment_id": 91500317, "body": "@Alexey Interfaces may only define methods, but not struct fields. For that, you need to add setter (and / or getter) methods. You may use embedding to make code less repetitive."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1536670514, "last_edit_date": 1536670514, "creation_date": 1536669306, "answer_id": 52276079, "question_id": 52275975, "link": "https://stackoverflow.com/questions/52275975/how-to-create-a-variable-with-needed-type-instead-of-type-assertion/52276079#52276079", "title": "How to create a variable with needed type instead of type assertion", "body": "<p>Go is a statically typed language, the type of <code>a</code> must be known at compile time. And since Go does not support generics yet, you can't do what you want.</p>\n\n<p>Try to come up with some other solution, e.g. abstract away the things you want to do with <code>a</code> into an interface, and have the concrete types implement that interface. Then <code>a</code> can be a variable of this interface type, and you can call methods of it.</p>\n\n<p>If you can achieve this, actually you can even change the parameter of the <code>data</code> type to this interface, and no type assertion or type switch is needed.</p>\n\n<p>Alternatively you could use reflection to access common fields (either for get or set) identified by their name, but reflection provides no compile-time guarantee, and it's usually less efficient. For an example how to do that, see this question: <a href=\"https://stackoverflow.com/questions/52164276/assert-interface-to-its-type/52164510#52164510\">Assert interface to its type</a></p>\n"}, {"tags": [], "owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "is_accepted": false, "score": 2, "last_activity_date": 1536670981, "creation_date": 1536670981, "answer_id": 52276615, "question_id": 52275975, "link": "https://stackoverflow.com/questions/52275975/how-to-create-a-variable-with-needed-type-instead-of-type-assertion/52276615#52276615", "title": "How to create a variable with needed type instead of type assertion", "body": "<p>You can't do what you ask for in your question directly, go is statically typed, so you can't have one variable that can hold different types, and still access that variable as if it is typed.</p>\n\n<p>If you're only working on the common struct fields in your method, you are perhaps better off gathering all the common variables in its own struct, illustrated below as the <code>commons</code> struct and have your <code>method</code> take that type as an argument</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype commons struct {\n    name string\n    age int\n}\ntype structA struct {\n    commons\n    other_stuff int\n}\n\ntype structB struct {\n    commons\n    foo string\n}\n\nfunc method(c* commons) {\n    fmt.Println(c)\n    c.age +=1\n\n}\nfunc main() {\n    a := structA{commons{\"foo\", 44}, 1} \n    b := structB{commons{\"bar\", 33}, \"test\"} \n    method(&amp;a.commons)\n    method(&amp;b.commons)\n    fmt.Println(a)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/UHLlxd_RXpv\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 362, "user_id": 1111002, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5175ed7bc99de14d8026f9173bdbb679?s=128&d=identicon&r=PG", "display_name": "sio4", "link": "https://stackoverflow.com/users/1111002/sio4"}, "is_accepted": false, "score": 0, "last_activity_date": 1536739918, "creation_date": 1536739918, "answer_id": 52290467, "question_id": 52275975, "link": "https://stackoverflow.com/questions/52275975/how-to-create-a-variable-with-needed-type-instead-of-type-assertion/52290467#52290467", "title": "How to create a variable with needed type instead of type assertion", "body": "<p>I can't figure out what is your real goal but if the \"method\" you want to write handles common fields from similar structures, and you cannot fix original structures using <strong>Type Embedding</strong>, as @nos said above, then you can try to make another structure for method-internal use:</p>\n\n<pre><code>var v Vehicle // with common fields\n\nswitch data.(type) {\ncase *Car:\n    v.Handle = data.(*Car).Handle // or CircleHandle\ncase *Motorcycle:\n    v.Handle = data.(*Motorcycle).Handle // or BarHandle\n}\n\nv.Degree = 15\nv.Speed = 50\nv.Direction = \"left\"\nv.Style = \"rough\"\n/// so many things on `v`...\n\nsteering(v)\n</code></pre>\n\n<p>I think it is not a good approach but sometimes... :-)</p>\n"}], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1536739918, "creation_date": 1536668999, "last_edit_date": 1536670022, "question_id": 52275975, "link": "https://stackoverflow.com/questions/52275975/how-to-create-a-variable-with-needed-type-instead-of-type-assertion", "title": "How to create a variable with needed type instead of type assertion", "body": "<p>I have a function which takes an interface, like this:</p>\n\n<pre><code>func method(data interface{})\n</code></pre>\n\n<p>.. because I need to process different structs which have common fields/methods. In this function I use <code>data</code> tens or hundreds of times, in different places. It's really unpleasant to add <code>switch a.(type) { case .. case ..</code> all the time.</p>\n\n<p>Is there a way to create a variable with just one <code>switch</code> with needed type and then just use this variable everywhere later? Something like:</p>\n\n<pre><code>var a .... // something here\n\nswitch data.(type) {\ncase *Struct1:\n    a = data.(*Struct1)\ncase *Struct2:\n    a = data.(*Struct2)\n}\n\n// Continue with 'a' only\na.Param = 15\nfmt.Println(a.String())\n</code></pre>\n"}, {"tags": ["session", "go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "edited": false, "score": 0, "creation_date": 1536673303, "post_id": 52277113, "comment_id": 91502441, "body": "how i can get the request from controllers handlers"}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "reply_to_user": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "edited": false, "score": 0, "creation_date": 1536675612, "post_id": 52277113, "comment_id": 91504112, "body": "that is difficult without actually calling the controller. So the function which needs this session, can be called either within the controller or in the middleware. You can do this in multiple ways but for that you need to tell me where this new file is and what you want it to do."}, {"owner": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "edited": false, "score": 0, "creation_date": 1536676328, "post_id": 52277113, "comment_id": 91504607, "body": "structure of my authentication api is like: -----Authentication API -services.go -controllers.go -middleware.go  ------- after /login, I set value of [&quot;authenticated&quot;] = true, in order to check if user authenticated to  get him access to the route:/admin/application"}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "reply_to_user": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "edited": false, "score": 0, "creation_date": 1536684230, "post_id": 52277113, "comment_id": 91509177, "body": "have you checked if client is setting the cookie from response you get from <code>login</code> in all subsequent requests?"}, {"owner": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "edited": false, "score": 0, "creation_date": 1536690434, "post_id": 52277113, "comment_id": 91512231, "body": "I have checked session, _ := store.Get(r, &quot;session&quot;) in the middleware, so it returns empty map, it means that it does not see  stored values  But I have saved it with Save() method in the login. It has confused me"}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "reply_to_user": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "edited": false, "score": 0, "creation_date": 1536719248, "post_id": 52277113, "comment_id": 91521282, "body": "check at the client side code if cookie is read from response, and set into new request. this is how cookie-session management works. All that <code>store.Get</code> does is read from a database. For that it needs the key under which session is stored. That key is the cookie."}], "tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 0, "last_activity_date": 1536672615, "creation_date": 1536672615, "answer_id": 52277113, "question_id": 52275658, "link": "https://stackoverflow.com/questions/52275658/cannot-get-gorilla-session-value-by-key/52277113#52277113", "title": "Cannot get gorilla session.Value by key", "body": "<p><code>session, _ := store.Get(r, \"session\") //SESSION START</code>, your session depends on the request <code>r</code>, which is a pointer that is created by the package that calls your controller. If you are calling <code>session</code> from another file, you need to ensure, that it is the same request that is passed into <code>store.Get()</code>. That could be the reason.</p>\n"}], "owner": {"reputation": 43, "user_id": 6889344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a4743b94402677e0bf0504a1f27779?s=128&d=identicon&r=PG&f=1", "display_name": "Maruf Saidov", "link": "https://stackoverflow.com/users/6889344/maruf-saidov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 186, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536672615, "creation_date": 1536667889, "last_edit_date": 1536668337, "question_id": 52275658, "link": "https://stackoverflow.com/questions/52275658/cannot-get-gorilla-session-value-by-key", "title": "Cannot get gorilla session.Value by key", "body": "<p>The problem is, cannot get value from session.Value in another file in the same package</p>\n\n<p>In the controllers.go file</p>\n\n<pre><code>func (c *AuthenticationControllers) AdminLogin() http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"application/json\")\n\n          //AUTHENTICATION\n\n        if answer {\n            w.Write([]byte(\"Successful Authenticated!\"))\n\n            //1* Create Session\n\n            session, _ := store.Get(r, \"session\") //SESSION START\n\n            ///Here I've setted true\n            session.Values[\"authenticated\"] = true//Successful Authenticated\n\n            sessionToken, _ := uuid.NewV4() //Generate session token\n\n            session.Values[\"userid\"] = sessionToken.String()\n\n            session.Save(r, w)\n\n\n            //Redirect\n            http.Redirect(w, r, \"/admin/application\", 302)\n        } else {\n            //http.Redirect(w, r, \"/login\", 302)\n\n            http.Error(w, http.StatusText(http.StatusForbidden), http.StatusForbidden)\n        }\n\n    }\n}\n</code></pre>\n\n<p>IN middleware.go file in the same package</p>\n\n<pre><code> func (m *AuthenticationMiddleWares) RequiresLogin(handler http.HandlerFunc) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        session, _ := store.Get(r, \"session\") //!!!\n\n        if auth, ok := session.Values[\"authenticated\"].(bool); !ok || !auth {\n            http.Error(w, \"Forbidden\", http.StatusForbidden)\n            return\n        }\n\n        handler(w, r)\n    }\n}\n\n\n session.Values[\"authenticated\"] //has nil value, but has to be true after authentification in order to get you access to the route\nrouter.HandleFunc(\"/admin/applications\", authMiddle.RequiresLogin(authContrl.Application()))\n</code></pre>\n\n<p>What I have done wrong? Why session.Values[\"authenticated\"] returns \"nil\"</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536664353, "post_id": 52274353, "comment_id": 91496412, "body": "One of zap&#39;s key features is that it&#39;s fast because it doesn&#39;t have custom formatting, so I&#39;d kind of doubt it has the feature you want, but that&#39;s just from reading the docs for 5 minutes."}, {"owner": {"reputation": 23, "user_id": 3056434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fff6c96cac29e850cdb54665f5db37ae?s=128&d=identicon&r=PG&f=1", "display_name": "shinwu", "link": "https://stackoverflow.com/users/3056434/shinwu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536810101, "post_id": 52274353, "comment_id": 91559871, "body": "I found out the way to record complete string format.  The <code>zapcore</code> support a struct EncoderConfig. When I set matter keys empty value, zap doesn&#39;t record info of these keys. Config is like this:  <code>cfg := zapcore.EncoderConfig{ \tTimeKey:        &quot;&quot;, \tLevelKey:       &quot;&quot;, \tNameKey:        &quot;&quot;, \tCallerKey:      &quot;&quot;, \tMessageKey:     &quot;M&quot;, \tStacktraceKey:  &quot;&quot; }</code>  Anyway, thank you very much for your answer!"}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 3056434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fff6c96cac29e850cdb54665f5db37ae?s=128&d=identicon&r=PG&f=1", "display_name": "shinwu", "link": "https://stackoverflow.com/users/3056434/shinwu"}, "is_accepted": false, "score": 0, "last_activity_date": 1600452652, "last_edit_date": 1600452652, "creation_date": 1536810478, "answer_id": 52306367, "question_id": 52274353, "link": "https://stackoverflow.com/questions/52274353/how-to-custom-log-format-when-use-zap/52306367#52306367", "title": "How to custom log format when use zap?", "body": "<p>set <code>EncoderConfig</code></p>\n<pre class=\"lang-golang prettyprint-override\"><code>cfg := zapcore.EncoderConfig{ \n    TimeKey: &quot;&quot;, \n    LevelKey: &quot;&quot;, \n    NameKey: &quot;&quot;, \n    CallerKey: &quot;&quot;, \n    MessageKey: &quot;M&quot;, \n    StacktraceKey: &quot;&quot;,\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 4860392, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWjdY.jpg?s=128&g=1", "display_name": "Noman", "link": "https://stackoverflow.com/users/4860392/noman"}, "is_accepted": false, "score": 0, "last_activity_date": 1542284130, "last_edit_date": 1542284130, "creation_date": 1542283125, "answer_id": 53319025, "question_id": 52274353, "link": "https://stackoverflow.com/questions/52274353/how-to-custom-log-format-when-use-zap/53319025#53319025", "title": "How to custom log format when use zap?", "body": "<p>Zap allows to <a href=\"https://blog.sandipb.net/2018/05/03/using-zap-creating-custom-encoders/\" rel=\"nofollow noreferrer\">customize encoders</a>. In the linked article author sets a field <code>EncodeLevel</code> of <a href=\"https://godoc.org/go.uber.org/zap/zapcore#EncoderConfig\" rel=\"nofollow noreferrer\">EncoderConfig</a> to a custom function. That way you can change encoding of logging level, timestamp, duration, caller and logger name.</p>\n\n<p>You also can use <a href=\"https://godoc.org/go.uber.org/zap#RegisterEncoder\" rel=\"nofollow noreferrer\">zap.RegisterEncoder</a> to add your custom encoder and then set <code>Encoding</code> field in <a href=\"https://godoc.org/go.uber.org/zap#Config\" rel=\"nofollow noreferrer\">config</a> to the name of your encoder.</p>\n\n<p>Keep in mind that encoder is used on every call of a logging methods, so it must have a good perfomance.</p>\n"}], "owner": {"reputation": 23, "user_id": 3056434, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fff6c96cac29e850cdb54665f5db37ae?s=128&d=identicon&r=PG&f=1", "display_name": "shinwu", "link": "https://stackoverflow.com/users/3056434/shinwu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 5285, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1600452652, "creation_date": 1536663495, "last_edit_date": 1536811319, "question_id": 52274353, "link": "https://stackoverflow.com/questions/52274353/how-to-custom-log-format-when-use-zap", "title": "How to custom log format when use zap?", "body": "<p>Currently, our project's log format is like:</p>\n\n<pre><code>www.abcdef.com`3`1s\n</code></pre>\n\n<p>I want to use Go to rewrite project and import zap as log tool. By zap the log's format is like:</p>\n\n<pre><code>{\"url\": \"www.abcdef.com\", \"attempt\": 3, \"backoff\": \"1s\"}\n</code></pre>\n\n<p>I google its usage, but I don't find out any way that changes zap's format to above mentioned, so I want to seek some advice here.</p>\n"}, {"tags": ["unit-testing", "go", "table-driven"], "comments": [{"owner": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "edited": false, "score": 0, "creation_date": 1536663624, "post_id": 52274333, "comment_id": 91495999, "body": "You can use the CreateTestContext function <a href=\"https://github.com/gin-gonic/gin/blob/master/test_helpers.go#L10\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin/blob/master/test_helpers.go#L10</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1417, "user_id": 3149444, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/2dbLO.jpg?s=128&g=1", "display_name": "Perimosh", "link": "https://stackoverflow.com/users/3149444/perimosh"}, "edited": false, "score": 0, "creation_date": 1609956577, "post_id": 52275029, "comment_id": 115985107, "body": "what do you do with &quot;r *http.Request&quot; inside the handler func?"}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 2, "last_activity_date": 1536665973, "creation_date": 1536665973, "answer_id": 52275029, "question_id": 52274333, "link": "https://stackoverflow.com/questions/52274333/how-to-write-the-test-case-of-when-a-function-having-the-parameters-of-c-gin-co/52275029#52275029", "title": "How to write the test case of When a function having the parameters of c *gin.Context", "body": "<p>there is a <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\">library</a> for what you want to do</p>\n\n<pre><code>handler := func(w http.ResponseWriter, r *http.Request) {\n    c := CreateTestContext(w)\n    SaveProvider(c)\n}\n\nreq := httptest.NewRequest(\"GET\", \"http://example.com/foo\", nil)\nw := httptest.NewRecorder()\nhandler(w, req)\n\nresp := w.Result()\nbody, _ := ioutil.ReadAll(resp.Body)\n\nfmt.Println(resp.StatusCode)\nfmt.Println(resp.Header.Get(\"Content-Type\"))\nfmt.Println(string(body))\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10031766"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1886, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1536665973, "creation_date": 1536663403, "question_id": 52274333, "link": "https://stackoverflow.com/questions/52274333/how-to-write-the-test-case-of-when-a-function-having-the-parameters-of-c-gin-co", "title": "How to write the test case of When a function having the parameters of c *gin.Context", "body": "<p>I'm writing the test cases of the controllers for my project in golang. In the controllers there is the function name <code>SaveProvider()</code>having parameter <code>c *gin.Context</code> and I don't know how to pass the JSON to the <code>c *gin.Context</code> this parameter and How I test my functions used in the controllers Can anyone tell me that How What is the problem in this code.It is also called table driven test.</p>\n\n<pre><code>package controllers\n\nimport (\n    \"bkapiv1/models\"\n    \"fmt\"\n    \"testing\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc TestSaveProvider(t *testing.T) {\n    type args struct {\n        c    *gin.Context\n        json ProviderProfile\n    }\n    tests := []struct {\n        name string\n        args args\n        want bool\n    }{\n        {\n            \"SaveProvider\",\n            args{\n                &amp;gin.Context{\n                   //How to pass here a JSON means the below JSON ProviderProfile.\n                },\n                ProviderProfile{\n                     models.User{\n                         FirstName:                  \"Harry\",\n                         LastName:                   \"Potter\",\n                         FullName:                   \"Harry Potter\",\n                         CompanyName:                \"TheIronNetwork\",\n                         EmailId:                   \"harry@gmail.com\",\n                         Password:                   \"vadhera123\",\n                     },\n                     models.AddressStruct{},\n                     models.Provider{\n                        ProviderCategory: \"IC\",\n                        Priority:         1,\n                     },\n                },\n            },\n            true,\n         },\n     }\n     for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            SaveProvider(tt.args.c)\n        })\n     }\n}\n</code></pre>\n\n<p>The function in the controller is:-</p>\n\n<pre><code>func SaveProvider(c *gin.Context){\n\n}\n</code></pre>\n"}, {"tags": ["go", "data-structures", "maps", "guava", "go-map"], "answers": [{"tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 1, "last_activity_date": 1536668947, "creation_date": 1536668947, "answer_id": 52275948, "question_id": 52274187, "link": "https://stackoverflow.com/questions/52274187/is-there-guava-table-equivalent-in-golang-if-not-what-is-the-right-way-of-doing/52275948#52275948", "title": "is there Guava table equivalent in Golang? if not what is the right way of doing in Go", "body": "<p>You can create a list of \"rows\", each \"row\" containing one line of your table:</p>\n\n<pre><code>type Data struct {\n  A int\n  B int\n  C string\n}\n\nfunc main() {\n  var table []Data\n\n  table = append(table, Data{A: 1, B: 2, C: \"foo\"})\n  ...\n}\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 4299004, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DMd4nI7daVk/AAAAAAAAAAI/AAAAAAAAAKw/cXtZ_aHPqZk/photo.jpg?sz=128", "display_name": "Junaid s", "link": "https://stackoverflow.com/users/4299004/junaid-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1536678139, "creation_date": 1536662823, "last_edit_date": 1536678139, "question_id": 52274187, "link": "https://stackoverflow.com/questions/52274187/is-there-guava-table-equivalent-in-golang-if-not-what-is-the-right-way-of-doing", "title": "is there Guava table equivalent in Golang? if not what is the right way of doing in Go", "body": "<p>I want something like this in go</p>\n\n<ol>\n<li><p>table</p></li>\n<li><p>map[string]table</p></li>\n</ol>\n\n<p>what I have tired for <code>map[string]table</code> is mentioned below but not sure if its the right approach:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype table struct{\n    a,b []int\n    c []string\n}\n\nfunc main() {\n    mytable := make(map[string]table)\n    var a1 []int\n    var b1 []int\n    var c1 []int\n\n    a1=append(a1,1)\n    a1=append(a1,1)\n    b1=append(b1,2)\n    c1=append(c1,\"Golang\")  \n\n    t1 := table{a1,b1,c1}\n\n    mytable[\"abc\"]=t1\n}\n</code></pre>\n\n<p>I need the table since I will be using the data for the CSV file. Let me know the best approach for doing this.</p>\n"}, {"tags": ["ssl", "go", "keychain"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1536661208, "post_id": 52273566, "comment_id": 91494672, "body": "The term &quot;client certificate&quot; usually refers to a certificate that the client presents to the server to authenticate itself, as an alternative for username/password for instance. Is that really what you mean?"}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "edited": false, "score": 1, "creation_date": 1536682010, "post_id": 52273566, "comment_id": 91508103, "body": "You can&#39;t. You specify the certificate to use in your code. During the protocol exchange there is no time (or even a method) available to wait for user input."}, {"owner": {"reputation": 302, "user_id": 3856170, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/664c9879e1edc98551398dee37f3276f?s=128&d=identicon&r=PG&f=1", "display_name": "VikasPushkar", "link": "https://stackoverflow.com/users/3856170/vikaspushkar"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1536907174, "post_id": 52273566, "comment_id": 91599363, "body": "Yes @peter thats what i mean."}], "owner": {"reputation": 302, "user_id": 3856170, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/664c9879e1edc98551398dee37f3276f?s=128&d=identicon&r=PG&f=1", "display_name": "VikasPushkar", "link": "https://stackoverflow.com/users/3856170/vikaspushkar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 31, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1536660631, "creation_date": 1536660631, "question_id": 52273566, "link": "https://stackoverflow.com/questions/52273566/access-installed-client-certificate-on-client-machine-for-tls-handshake-with-se", "title": "Access installed client certificate on client machine, for TLS handshake with server golang", "body": "<p>I have a golang APP, which is supposed to get few contents from a Server(HTTPS). during TLS handshakes how should i get the installed client certs from the system(keychain for example on Mac). How would i prompt to user when there are two certificate installed for same server?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1536659953, "post_id": 52273325, "comment_id": 91493898, "body": "Greater by how much? If it&#39;s tiny, it&#39;s most likely a rounding error, and you can truncate &gt;1 values to 1. Although I would just use <code>x*x</code> instead of <code>Pow(x, 2)</code> and <code>x*x*x</code> instead of <code>Pow(x, 3)</code>, most likely faster."}, {"owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536660094, "post_id": 52273325, "comment_id": 91493978, "body": "It ranges on the variables passed in, but its generally in the range of 1 to 4. - Have added output for clarity"}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1536660171, "post_id": 52273325, "comment_id": 91494027, "body": "<code>1.4258552799000002e+07</code> is a bit outside the range of 1 to 4. Specifically, it&#39;s about 10000000 times bigger. I assume you might need to convert RGB to 0..1 from 0..255."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536660208, "post_id": 52273325, "comment_id": 91494057, "body": "math.Pow computes arbitrary powers. Computing squares or cubes might be simpler by direct multiplication. And no function can save you from floating point peculiarities. Start by grouping positive and negative summands (do not subtract floats of roughly equal size)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536660217, "post_id": 52273325, "comment_id": 91494064, "body": "Your result goes out of range because the <code>CXX</code> weights you use, they are also not exact, just truncated or rounded values. So what you experience is &quot;normal&quot;. Negate the effect by truncating the result into the <code>0..1</code> range."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536660484, "post_id": 52273325, "comment_id": 91494230, "body": "@icza: It is not normal. If you have RGB as (1, 1, 1), the result is 1.0011999999999999; that&#39;s normal margin of error. If the RGB is (255, 255, 255), then the result is <code>14258552.799000002</code>, which is more than a slight error from a value that OP is &quot;expecting values in the range of 0 to 1&quot;."}, {"owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "edited": false, "score": 0, "creation_date": 1536660653, "post_id": 52273325, "comment_id": 91494338, "body": "Amazing help, cheers guys. Converting RGB from 255 ranges to 0-1 produces results I would have expected."}], "answers": [{"comments": [{"owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "edited": false, "score": 0, "creation_date": 1536660708, "post_id": 52273569, "comment_id": 91494372, "body": "Works like a charm! Produces far more logical results, cheers @Amaden!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536660711, "post_id": 52273569, "comment_id": 91494374, "body": "No, running the above formula with R=1, G=1 and B=1 gives 1.0012 (still bigger than 1). This is what I assumed after the question, so my comments still apply above."}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1536660784, "post_id": 52273569, "comment_id": 91494416, "body": "@izca: As I said above, that might well be the floating rounding (whether in constants provided, or in the floating point operations). The core cause of the problem being 7 orders of magnitude off is not using the right scale of RGB input."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536660864, "post_id": 52273569, "comment_id": 91494466, "body": "@Amadan This is too large to be a rounding error. If we change everything from variables to constants (go has &quot;arbitrary&quot; precision in the const &quot;space&quot;), it still gives roughly the same error. This is due to the fact that the used  &quot;weights&quot; are imprecise."}, {"owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "edited": false, "score": 0, "creation_date": 1536660899, "post_id": 52273569, "comment_id": 91494490, "body": "Oh lord, what have I started?!"}, {"owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "edited": false, "score": 0, "creation_date": 1536660922, "post_id": 52273569, "comment_id": 91494504, "body": "You say &quot;weights&quot;, I say &quot;constants&quot;. In the mathematical sense, not Go sense. We are not disagreeing. I am talking about <code>-0.0343</code> and the rest probably being rounded off from a more exact number, likely a cosine or something."}], "tags": [], "owner": {"reputation": 167912, "user_id": 240443, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/495d675e3bc42ed1dee469e2ce701f1b?s=128&d=identicon&r=PG", "display_name": "Amadan", "link": "https://stackoverflow.com/users/240443/amadan"}, "is_accepted": true, "score": 3, "last_activity_date": 1536660640, "creation_date": 1536660640, "answer_id": 52273569, "question_id": 52273325, "link": "https://stackoverflow.com/questions/52273325/is-math-pow-in-golang-good-for-this-forumla/52273569#52273569", "title": "Is math.Pow in golang good for this forumla?", "body": "<p>Your RGB values are not in the same range as the formula requires. This formula works with R, G and B components in the mathematically normal range of 0 (darkest) to 1 (brightest), not the usual computery range of 0 (darkest) to 255 (brightest). </p>\n\n<p>Divide RGB by 255.0 before running your formula.</p>\n"}], "owner": {"reputation": 5015, "user_id": 983925, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d824ee5b7e18058b97236525d9afdd5?s=128&d=identicon&r=PG&f=1", "display_name": "fantasitcalbeastly", "link": "https://stackoverflow.com/users/983925/fantasitcalbeastly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 52273569, "answer_count": 1, "score": -1, "last_activity_date": 1536660796, "creation_date": 1536659758, "last_edit_date": 1536660796, "question_id": 52273325, "link": "https://stackoverflow.com/questions/52273325/is-math-pow-in-golang-good-for-this-forumla", "title": "Is math.Pow in golang good for this forumla?", "body": "<p>Formula:</p>\n\n<pre><code>C1*B+C2B^2+C3*G+C4*G*B+C5*G*B^2+C6*G^2+\nC7*G^2*B+C8*R+C9*R*B+C10*R*B^2+C11*R*G+\nC12*R*G*B+C13*R*G^2+C14*R^2+C15*R^2*B+\nC16*R^2*G+C17*1+C18*R^3+C19*G^3+C20*B^3\n</code></pre>\n\n<p>Go:</p>\n\n<pre><code>var C1 = -0.0343\nvar C2 = 0.4062\n...snipped\n\nC1*B + C2*math.Pow(B, 2) + C3*G + C4*G*B +\nC5*G*math.Pow(B, 2) + C6*G*math.Pow(G, 2) +\nC7*math.Pow(G, 2)*B + C8*R + C9*R*B +\nC10*R*math.Pow(B, 2) + C11*R*G + C12*R*G*B +\nC13*R*math.Pow(G, 2) + C14*math.Pow(R, 2) +\nC15*math.Pow(R, 2)*B + C16*math.Pow(R, 2)*G +\nC17*1 + C18*math.Pow(R, 3) + C19*math.Pow(G, 3) +\nC20*math.Pow(B, 3)\n</code></pre>\n\n<p>All my code works, but I'm seeing values greater than <code>1</code> and I should be expecting values in the range of <code>0</code> to <code>1</code>, so I'm assuming that <code>math.Pow</code> isn't what I should be using. New to Go, any help greatly appreciated.</p>\n"}, {"tags": ["go", "tcpserver", "nats.io"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 10346220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853ad442f86a0d9c46153c416ac67707?s=128&d=identicon&r=PG&f=1", "display_name": "vladbalv", "link": "https://stackoverflow.com/users/10346220/vladbalv"}, "edited": false, "score": 0, "creation_date": 1538489421, "post_id": 52562102, "comment_id": 92154578, "body": "thanx for an answer. I responded to you via question updation. My message appeared to be too long for the comment"}, {"owner": {"reputation": 676, "user_id": 7817149, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x4Mpb.jpg?s=128&g=1", "display_name": "I. Kozlovic", "link": "https://stackoverflow.com/users/7817149/i-kozlovic"}, "reply_to_user": {"reputation": 13, "user_id": 10346220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853ad442f86a0d9c46153c416ac67707?s=128&d=identicon&r=PG&f=1", "display_name": "vladbalv", "link": "https://stackoverflow.com/users/10346220/vladbalv"}, "edited": false, "score": 0, "creation_date": 1538521185, "post_id": 52562102, "comment_id": 92169215, "body": "I see. Before proposing another approach, why do you need to keep the original TCP connection opened though? From what I understand, the accepted TCP connection simply trigger a NATS connect and publish, right?"}, {"owner": {"reputation": 676, "user_id": 7817149, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x4Mpb.jpg?s=128&g=1", "display_name": "I. Kozlovic", "link": "https://stackoverflow.com/users/7817149/i-kozlovic"}, "reply_to_user": {"reputation": 13, "user_id": 10346220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853ad442f86a0d9c46153c416ac67707?s=128&d=identicon&r=PG&f=1", "display_name": "vladbalv", "link": "https://stackoverflow.com/users/10346220/vladbalv"}, "edited": false, "score": 0, "creation_date": 1538522492, "post_id": 52562102, "comment_id": 92169514, "body": "I have edited my answer regardless. Will update again based on your answer :-)"}, {"owner": {"reputation": 13, "user_id": 10346220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853ad442f86a0d9c46153c416ac67707?s=128&d=identicon&r=PG&f=1", "display_name": "vladbalv", "link": "https://stackoverflow.com/users/10346220/vladbalv"}, "edited": false, "score": 0, "creation_date": 1538897191, "post_id": 52562102, "comment_id": 92300016, "body": "Great! Thank you for help"}], "tags": [], "owner": {"reputation": 676, "user_id": 7817149, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/x4Mpb.jpg?s=128&g=1", "display_name": "I. Kozlovic", "link": "https://stackoverflow.com/users/7817149/i-kozlovic"}, "is_accepted": true, "score": 0, "last_activity_date": 1538522464, "last_edit_date": 1538522464, "creation_date": 1538165608, "answer_id": 52562102, "question_id": 52271741, "link": "https://stackoverflow.com/questions/52271741/how-to-reply-an-accepted-connection-in-nats-subscribe-in-golang/52562102#52562102", "title": "How to reply an accepted connection in nats.Subscribe in golang", "body": "<p>Based on your updated question, here is a possible approach.\nNote that the two extra processes are represented by go-routines here, but you would have them be separate processes in real case.\nI have also omitted error checking.</p>\n\n<pre><code>// This represent what would be the last process in your\n// example.\ngo func() {\n    nc, _ := nats.Connect(nats.DefaultURL)\n    nc.Subscribe(\"bar\", func(m *nats.Msg) {\n        fmt.Printf(\"Received request: %s, final stop, sending back to %v\\n\", m.Data, m.Reply)\n        nc.Publish(m.Reply, []byte(\"I'm here to help!\"))\n    })\n    nc.Flush()\n    runtime.Goexit()\n}()\n\n// This would be the in-between process that receives\n// the message triggered by the TCP accept\ngo func() {\n    nc, _ := nats.Connect(nats.DefaultURL)\n    nc.Subscribe(\"foo\", func(m *nats.Msg) {\n        fmt.Printf(\"Received request: %s, forward to bar\\n\", m.Data)\n        nc.PublishRequest(\"bar\", m.Reply, []byte(fmt.Sprintf(\"got %s\", m.Data)))\n    })\n    nc.Flush()\n    runtime.Goexit()\n}()\n\n// This would be your TCP server\nl, _ := net.Listen(\"tcp\", \"127.0.0.1:1234\")\nfor {\n    c, _ := l.Accept()\n    go func(c net.Conn) {\n        // Close socket when done\n        defer c.Close()\n        // Connect to NATS\n        nc, _ := nats.Connect(nats.DefaultURL)\n        // Close NATS connection when done\n        defer nc.Close()\n        // Sends the request to first process. Note that this\n        // has a timeout and so if no response is received, the\n        // go-routine will exit, closing the TCP connection.\n        reply, err := nc.Request(\"foo\", []byte(\"help\"), 10*time.Second)\n        if err != nil {\n            fmt.Printf(\"Got error: %v\\n\", err)\n        } else {\n            fmt.Printf(\"Got reply: %s\\n\", reply.Data)\n        }\n    }(c)\n}\n</code></pre>\n\n<p>Note that is is usually not recommended to create very short lived NATS connections. You may want to reuse the NATS connection if that fits with your model.</p>\n"}], "owner": {"reputation": 13, "user_id": 10346220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853ad442f86a0d9c46153c416ac67707?s=128&d=identicon&r=PG&f=1", "display_name": "vladbalv", "link": "https://stackoverflow.com/users/10346220/vladbalv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 52562102, "answer_count": 1, "score": 1, "last_activity_date": 1538522464, "creation_date": 1536654358, "last_edit_date": 1538489303, "question_id": 52271741, "link": "https://stackoverflow.com/questions/52271741/how-to-reply-an-accepted-connection-in-nats-subscribe-in-golang", "title": "How to reply an accepted connection in nats.Subscribe in golang", "body": "<p>I am trying to make a tcp server in golang which accepts the connection, reads data and then publishes it via nats.Publish. But I also want to reply and close the connection inside the subsriber not in the main server script\nI see two possible ways: to publish connection or to make a new one in a subsriber, but I cannot realize either\nThank you in advance</p>\n\n<p>UPD\nA comment regarding I. Kozlovic answer:\nNot exactly what I wanted but may help :) \nI was writing about closing tcp connection - not a nats one and to close in another go process - not in the one it was accepted. But as I did not succeeded in it I could do the following basing on your answer: I can publish information I need via nats, process it and then reply with \"OK. Close connection\" and close the TCP connection in publisher which is a TCP server. However that would be great if I could reply not from this go process but from the another one. Its tricky I understand but I want to do the same I wrote in the previous message but with some modification. I have TCP server, it accepts connection and then connects nats and publishes message, another go process subscribed to this message processes input and then publishes its output to the third go process which processes its input and then replies \"OK. Done. Close TCP connection\" to the first go process.... :)</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536650944, "post_id": 52270257, "comment_id": 91488749, "body": "This is a great example why I have come to loathe ORMs. They make easy jobs easy, and they make difficult jobs impossible."}, {"owner": {"reputation": 7010, "user_id": 45207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/5yAUM.jpg?s=128&g=1", "display_name": "LaserJesus", "link": "https://stackoverflow.com/users/45207/laserjesus"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536653058, "post_id": 52270257, "comment_id": 91489882, "body": "@Flimzy I&#39;m new to Go and Go-Gorm so hopefully I&#39;m just at that part of the learning curve. I did realize I mistakenly had an ID on the Job object which explains why it tried to sort by a non existent field. So now it sorts on another field, in addition to the one I specified, but at least the query can run now. I&#39;d still like to know how to get rid of the unnecessary additional sort though. I also don&#39;t like the unnecessary sql query for the user even though I only want schools and jobs, but I&#39;m not sure how else to deal with the many-to-many relationship between user and school"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536656917, "post_id": 52270257, "comment_id": 91492012, "body": "I don&#39;t mean this to be facetious, but is there a reason you need to use gorm? Why not use straight SQL (even if only for this particular query). You seem to know the SQL you want, so why not just use that?"}, {"owner": {"reputation": 1201, "user_id": 5097493, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/95b290a191545edb4077adfaab317f1a?s=128&d=identicon&r=PG&f=1", "display_name": "RuNpiXelruN", "link": "https://stackoverflow.com/users/5097493/runpixelrun"}, "edited": false, "score": 1, "creation_date": 1536922500, "post_id": 52270257, "comment_id": 91607654, "body": "@laserjesus just a FYI, you can remove the Preload(&quot;Schools&quot;) as Preload(&quot;Schools.Jobs&quot;) will inflate both models for you."}, {"owner": {"reputation": 7010, "user_id": 45207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/5yAUM.jpg?s=128&g=1", "display_name": "LaserJesus", "link": "https://stackoverflow.com/users/45207/laserjesus"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541536228, "post_id": 52270257, "comment_id": 93249142, "body": "@Flimzy I like compile time checking (to some extent) of my SQL queries. I like that I can switch database provider and my code will most likely be easy to port. The ORM handles avoiding injection attacks and other parsing steps that I don&#39;t need to think about. Also something like GORM also provides structs that I can reuse with hints for json serialization when I need to return results"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541572212, "post_id": 52270257, "comment_id": 93258564, "body": "In order: 1. ORMs don&#39;t provide compile-time checking of your SQL anyway. But there are other ways to validate your SQL, such as with unit tests. 1b. You can use a query builder without an ORM. 2. Switching between SQL dialects is a nice benefit, but is, in my experience, always overblown. I&#39;ve never seen even ORM code port nicely. I see this is a theoretical benefit that never actually lives up to its promise. When it does live up, it will be with incredibly simple code, where the benefit is actually negligible (going back to my &quot;ORMs make easy jobs easy, and hard jobs impossible&quot; mantra)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541572266, "post_id": 52270257, "comment_id": 93258573, "body": "2. Injection attacks were solved decades before ORMs were existed. This is 100% not a reason to use an ORM. The other &quot;parsing steps&quot; are provided by any query builder, without an ORM. 3. The struct parsing and serialization benefits are part of Go, not GORM. I use those exact same benefits in every DB app I write in Go, and never use an ORM."}, {"owner": {"reputation": 7010, "user_id": 45207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/5yAUM.jpg?s=128&g=1", "display_name": "LaserJesus", "link": "https://stackoverflow.com/users/45207/laserjesus"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541618560, "post_id": 52270257, "comment_id": 93281226, "body": "@Flimzy All valid points. My original question is really about the query building component of GORM and I would potentially still have that question using something like Squirrel for query building. The additional feature of GORM beyond building the query is the return of strongly typed objects which I prefer to some string or reflection based approach since I get compile time checking on any fields that I reference and I can also use refactoring IDE features to easily change the name of such fields throughout my code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1541622611, "post_id": 52270257, "comment_id": 93283178, "body": "For scanning SQL results into Go structs, the <code>sqlx</code> package is my preferred method."}], "answers": [{"tags": [], "owner": {"reputation": 432, "user_id": 1041895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d80d0ceda06d6de6960584f9975583cc?s=128&d=identicon&r=PG", "display_name": "Rafa\u0142 Mnich", "link": "https://stackoverflow.com/users/1041895/rafa%c5%82-mnich"}, "is_accepted": false, "score": 1, "last_activity_date": 1613982188, "creation_date": 1613982188, "answer_id": 66312213, "question_id": 52270257, "link": "https://stackoverflow.com/questions/52270257/how-do-i-stop-gorm-from-sorting-my-preload-by-id/66312213#66312213", "title": "How do I stop GORM from sorting my preload by ID?", "body": "<p>I had the same problem. When you use <code>.First()</code> it needs to be ordered by something. Just change in your example to use <code>Scan</code> instead:</p>\n<pre><code>err := db.Where(&quot;id = ?&quot;, userID).Preload(&quot;Schools&quot;)\n.Preload(&quot;Schools.Jobs&quot;, func(db *gorm.DB) *gorm.DB {\n    return db.Order(&quot;job.job_reference DESC&quot;)\n}).Scan(&amp;user).Error\nreturn &amp;user.Schools, err\n\n\nsource: https://github.com/go-gorm/gorm/blob/master/finisher_api.go#L113\n</code></pre>\n"}], "owner": {"reputation": 7010, "user_id": 45207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/5yAUM.jpg?s=128&g=1", "display_name": "LaserJesus", "link": "https://stackoverflow.com/users/45207/laserjesus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 515, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1613982188, "creation_date": 1536648783, "last_edit_date": 1536652577, "question_id": 52270257, "link": "https://stackoverflow.com/questions/52270257/how-do-i-stop-gorm-from-sorting-my-preload-by-id", "title": "How do I stop GORM from sorting my preload by ID?", "body": "<p>In my database I have a users table, joined via a many-to-many table to schools. A school has many jobs. I'm trying to return all the schools and their jobs for a specific user. This is my code so far:</p>\n\n<pre><code>var user User\nerr := db.Where(\"id = ?\", userID).Preload(\"Schools\")\n.Preload(\"Schools.Jobs\", func(db *gorm.DB) *gorm.DB {\n    return db.Order(\"job.job_reference DESC\")\n}).First(&amp;user).Error\nreturn &amp;user.Schools, err\n</code></pre>\n\n<p>Gorm is then executing the following queries:</p>\n\n<pre><code>SELECT * FROM `user`  WHERE (id = 'foo') ORDER BY `user`.`id` ASC LIMIT 1\n\nSELECT * FROM `school` \nINNER JOIN `user_school` ON `user_school`.`school_id` = `school`.`id` \nWHERE (`user_school`.`user_id` IN ('foo'))  \n\nSELECT * FROM `job` WHERE (`school_id` IN ('1','2')) \nORDER BY job.job_reference DESC,`job`.`id` ASC\n</code></pre>\n\n<p>The first two generated SQL queries are exectly what I expected however the last query tries to sort by the criteria I provided AND a default sort by ID. If I remove my specific sort instructions it still tries to sort by ID. How can I stop it from doing that?</p>\n"}, {"tags": ["go", "dep"], "comments": [{"owner": {"reputation": 2748, "user_id": 3266953, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/5feb665600e276fd9c6361a5adc5cc93?s=128&d=identicon&r=PG&f=1", "display_name": "TWONEKSONE", "link": "https://stackoverflow.com/users/3266953/twoneksone"}, "edited": false, "score": 0, "creation_date": 1542364021, "post_id": 52269852, "comment_id": 93550706, "body": "I have the same problem"}], "answers": [{"tags": [], "owner": {"reputation": 1087, "user_id": 8707637, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/7a599986cb1673bdd7b540ea2d88ecc1?s=128&d=identicon&r=PG&f=1", "display_name": "Nithin", "link": "https://stackoverflow.com/users/8707637/nithin"}, "is_accepted": true, "score": -1, "last_activity_date": 1542367065, "creation_date": 1542367065, "answer_id": 53336803, "question_id": 52269852, "link": "https://stackoverflow.com/questions/52269852/dep-init-fails-even-when-package-exists/53336803#53336803", "title": "Dep init fails even when package exists", "body": "<p>I found the answer.</p>\n\n<p>Firstly <code>go get github.com/milagro-crypto/amcl</code></p>\n\n<p>Then <code>cd</code> into this location (based on your <code>$GOPATH</code>) <code>github.com/milagro-crypto/amcl/version3/go</code></p>\n\n<p>Follow this instructions to instal <code>milagro</code><br>\n<a href=\"https://github.com/milagro-crypto/amcl/tree/master/version3/go\" rel=\"nofollow noreferrer\">https://github.com/milagro-crypto/amcl/tree/master/version3/go</a></p>\n\n<p>I recommend installing all options one after the other and then don't forget to </p>\n\n<p><code>go run TestALL.go</code></p>\n\n<p>and</p>\n\n<p><code>go run BenchtestALL.go</code></p>\n\n<p>else it fails to resolve, idk why.</p>\n"}], "owner": {"reputation": 1087, "user_id": 8707637, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/7a599986cb1673bdd7b540ea2d88ecc1?s=128&d=identicon&r=PG&f=1", "display_name": "Nithin", "link": "https://stackoverflow.com/users/8707637/nithin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "accepted_answer_id": 53336803, "answer_count": 1, "score": 2, "last_activity_date": 1542367065, "creation_date": 1536647223, "question_id": 52269852, "link": "https://stackoverflow.com/questions/52269852/dep-init-fails-even-when-package-exists", "title": "Dep init fails even when package exists", "body": "<p>I am trying to package a <code>go</code> application using <code>dep</code> and when doing <code>dep init</code> the below error occours.</p>\n\n<p>I have installed the <code>amcl</code> library from here - <a href=\"https://github.com/milagro-crypto/amcl/tree/master/version3/go\" rel=\"nofollow noreferrer\">https://github.com/milagro-crypto/amcl/tree/master/version3/go</a></p>\n\n<p>Even the following packages exists</p>\n\n<pre><code>nithin@XPS-L401X:~/go/src/github.com/milagro-crypto/amcl/version3/go/amcl/FP256BN$ ls\nARCH.go  BIG.go  DBIG.go  ECDH.go  ECP2.go  ECP.go  FP12.go  FP2.go  FP4.go  FP.go  MPIN.go  PAIR.go  ROM.go\n</code></pre>\n\n<p>But still i get the following error</p>\n\n<pre><code>init failed: unable to solve the dependency graph: Solving failure: No versions of github.com/milagro-crypto/amcl met constraints:\n    281d0829b307c911bb2f14f2fedc414a257cb8c8: Could not introduce github.com/milagro-crypto/amcl@281d0829b307c911bb2f14f2fedc414a257cb8c8 due to multiple problematic subpackages:\n    Subpackage github.com/milagro-crypto/amcl/version3/go/amcl/FP256BN is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)  Subpackage github.com/milagro-crypto/amcl/version3/go/amcl is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)\n    master: Could not introduce github.com/milagro-crypto/amcl@master due to multiple problematic subpackages:\n    Subpackage github.com/milagro-crypto/amcl/version3/go/amcl is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)  Subpackage github.com/milagro-crypto/amcl/version3/go/amcl/FP256BN is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)\n    add-js-tests: Could not introduce github.com/milagro-crypto/amcl@add-js-tests due to multiple problematic subpackages:\n    Subpackage github.com/milagro-crypto/amcl/version3/go/amcl is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)  Subpackage github.com/milagro-crypto/amcl/version3/go/amcl/FP256BN is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)\n    fix-retval: Could not introduce github.com/milagro-crypto/amcl@fix-retval due to multiple problematic subpackages:\n    Subpackage github.com/milagro-crypto/amcl/version3/go/amcl is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)  Subpackage github.com/milagro-crypto/amcl/version3/go/amcl/FP256BN is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)\n    milagro-crypto-c: Could not introduce github.com/milagro-crypto/amcl@milagro-crypto-c due to multiple problematic subpackages:\n    Subpackage github.com/milagro-crypto/amcl/version3/go/amcl/FP256BN is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)  Subpackage github.com/milagro-crypto/amcl/version3/go/amcl is missing. (Package is required by github.com/hyperledger/fabric@release-1.1.)\n</code></pre>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1536643346, "post_id": 52269117, "comment_id": 91485617, "body": "<code>dep</code> is not in that docker image"}, {"owner": {"reputation": 92, "user_id": 4035454, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-cA1QPqmSr60/AAAAAAAAAAI/AAAAAAAAAVo/AQDUeWgrK8o/photo.jpg?sz=128", "display_name": "Bagus Andrian", "link": "https://stackoverflow.com/users/4035454/bagus-andrian"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1536645690, "post_id": 52269117, "comment_id": 91486382, "body": "U can pull from my repo: <a href=\"http://github.com/bagusandrian/mini-api\" rel=\"nofollow noreferrer\">github.com/bagusandrian/mini-api</a>"}], "answers": [{"comments": [{"owner": {"reputation": 92, "user_id": 4035454, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-cA1QPqmSr60/AAAAAAAAAAI/AAAAAAAAAVo/AQDUeWgrK8o/photo.jpg?sz=128", "display_name": "Bagus Andrian", "link": "https://stackoverflow.com/users/4035454/bagus-andrian"}, "edited": false, "score": 0, "creation_date": 1536643489, "post_id": 52269134, "comment_id": 91485662, "body": "where i add this command? Sorry im very beginner for docker-compose."}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1536644422, "post_id": 52269134, "comment_id": 91485952, "body": "add it before <code>dep ensure</code>, i also recommend using docker file instead of command field"}, {"owner": {"reputation": 92, "user_id": 4035454, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-cA1QPqmSr60/AAAAAAAAAAI/AAAAAAAAAVo/AQDUeWgrK8o/photo.jpg?sz=128", "display_name": "Bagus Andrian", "link": "https://stackoverflow.com/users/4035454/bagus-andrian"}, "edited": false, "score": 0, "creation_date": 1536645476, "post_id": 52269134, "comment_id": 91486301, "body": "<code>&#47;home&#47;nakama&#47;gopath&#47;src&#47;github.com&#47;bagusandrian&#47;mini-api is not within a known GOPATH&#47;src</code> I already try, but got error"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1536645562, "post_id": 52269134, "comment_id": 91486340, "body": "you need to run <code>go build</code> with the sources, as error claims."}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": false, "score": 3, "last_activity_date": 1536644504, "last_edit_date": 1536644504, "creation_date": 1536643354, "answer_id": 52269134, "question_id": 52269117, "link": "https://stackoverflow.com/questions/52269117/go-dep-not-running-on-docker-compose/52269134#52269134", "title": "go dep not running on docker-compose", "body": "<p>You need to install <code>go dep</code> first. Add this to your images</p>\n\n<pre><code>RUN go get -u github.com/golang/dep/cmd/dep\n</code></pre>\n\n<p>Or to the compose file:</p>\n\n<pre><code>command: &gt;\n    bash -c \"go get -u github.com/golang/dep/cmd/dep\n    &amp;&amp; dep ensure -v &amp;&amp; go build -v &amp;&amp; ./mini-api\"\n</code></pre>\n"}], "owner": {"reputation": 92, "user_id": 4035454, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-cA1QPqmSr60/AAAAAAAAAAI/AAAAAAAAAVo/AQDUeWgrK8o/photo.jpg?sz=128", "display_name": "Bagus Andrian", "link": "https://stackoverflow.com/users/4035454/bagus-andrian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 634, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1536674162, "creation_date": 1536643217, "last_edit_date": 1536674162, "question_id": 52269117, "link": "https://stackoverflow.com/questions/52269117/go-dep-not-running-on-docker-compose", "title": "go dep not running on docker-compose", "body": "<p>My problem is docker-compose always return: </p>\n\n<p><code>golang_1    | bash: dep: command not found</code></p>\n\n<p>It's my <code>docker-compose.yml</code> :</p>\n\n<pre><code>    version: \"3\"\n\nservices:\n  postgres:\n    image: postgres\n    environment:\n      POSTGRES_USER: mini_api\n      POSTGRES_PASSWORD: p4ssw0rd\n      POSTGRES_DB: mini-api\n    volumes:\n      - ./db.sql:/docker-entrypoint-initdb.d/db.sql\n    ports:\n    - \"5433:5432\"\n\n  golang:\n    image: golang:1.11.0-stretch\n    volumes:\n      - ./:$GOPATH/src/github.com/bagusandrian/mini-api\n    working_dir: $GOPATH/src/github.com/bagusandrian/mini-api\n    links:\n        - postgres\n    ports: \n      - \"8000:9090\"\n    command: bash -c \"dep ensure -v &amp;&amp; go build -v &amp;&amp; ./mini-api\"\n</code></pre>\n\n<p>I run with command: <code>docker-compose up</code> and always return:</p>\n\n<pre><code>golang_1    | bash: dep: command not found\n</code></pre>\n\n<p>Any false in my <code>docker-compose.yml</code> or I missing something? </p>\n\n<p>You can pull from my repo: <a href=\"http://github.com/bagusandrian/mini-api\" rel=\"nofollow noreferrer\">http://github.com/bagusandrian/mini-api</a></p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 522, "user_id": 1391008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e03f3a6314e7ed2bd34b7200d48742d2?s=128&d=identicon&r=PG", "display_name": "Moch Lutfi", "link": "https://stackoverflow.com/users/1391008/moch-lutfi"}, "edited": false, "score": 0, "creation_date": 1536635454, "post_id": 52268113, "comment_id": 91483818, "body": "ID table on database already use autoincrement?"}, {"owner": {"reputation": 693, "user_id": 425993, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1267cef00f1c7f190e1912bc50d1e6e5?s=128&d=identicon&r=PG", "display_name": "Ace.Yin", "link": "https://stackoverflow.com/users/425993/ace-yin"}, "reply_to_user": {"reputation": 522, "user_id": 1391008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e03f3a6314e7ed2bd34b7200d48742d2?s=128&d=identicon&r=PG", "display_name": "Moch Lutfi", "link": "https://stackoverflow.com/users/1391008/moch-lutfi"}, "edited": false, "score": 0, "creation_date": 1536636378, "post_id": 52268113, "comment_id": 91484004, "body": "@MochLutfi no, the ID column is not auto increment. here is the DDL: CREATE TABLE <code>users</code> (   <code>id</code> bigint(20) NOT NULL,   <code>created_at</code> timestamp NULL ,   <code>updated_at</code> timestamp NULL ,   <code>deleted_at</code> timestamp NULL ,   <code>username</code> varchar(100)  ,   <code>email</code> varchar(100)  ,   <code>mobile</code> varchar(20)  ,   <code>nickname</code> varchar(100)  ,   <code>avatar</code> varchar(255)  ,   <code>password</code> varchar(40)  ,   <code>salt</code> varchar(40)  ,   <code>lang</code> varchar(40)  ,   <code>register_from</code> varchar(40) ,   <code>status</code> varchar(40) ,   PRIMARY KEY (<code>id</code>) ) ENGINE=InnoDB"}, {"owner": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "edited": false, "score": 0, "creation_date": 1536636511, "post_id": 52268113, "comment_id": 91484024, "body": "Can you try adding <code>ID unit</code> into the model exclusively and check if the ID is being populated with Non-Zero values."}, {"owner": {"reputation": 693, "user_id": 425993, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1267cef00f1c7f190e1912bc50d1e6e5?s=128&d=identicon&r=PG", "display_name": "Ace.Yin", "link": "https://stackoverflow.com/users/425993/ace-yin"}, "reply_to_user": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "edited": false, "score": 0, "creation_date": 1536636962, "post_id": 52268113, "comment_id": 91484120, "body": "@KedarnagMukanahallipatna, as your suggestion, i move the &quot;id&quot; into my user model: type User struct { \tID           uint              <code>gorm:&quot;id;primary_key;type:bigint(20);&quot;</code> }. but there is nothing changed. the &quot;ID&quot; column also be 0"}, {"owner": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "edited": false, "score": 0, "creation_date": 1536638325, "post_id": 52268113, "comment_id": 91484403, "body": "Can you change your definition to look like -&gt; <code>ID int </code>gorm:&quot;AUTO_INCREMENT&quot;``. Also, I don&#39;t see this as an issue with <code>gorm</code>. Can you also update your question with the <code>create</code> code."}, {"owner": {"reputation": 693, "user_id": 425993, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1267cef00f1c7f190e1912bc50d1e6e5?s=128&d=identicon&r=PG", "display_name": "Ace.Yin", "link": "https://stackoverflow.com/users/425993/ace-yin"}, "reply_to_user": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "edited": false, "score": 0, "creation_date": 1536638921, "post_id": 52268113, "comment_id": 91484511, "body": "@KedarnagMukanahallipatna, yes you are right. when change the &quot;id&quot; column definition to &quot;auto_increment&quot;, the issue solved. i ever think the &quot;id&quot; column don&#39;t need to be &quot;auto increment&quot;, the gorm can handle the id value properly .. it&#39;s my fault. thanks ~"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536641355, "post_id": 52268113, "comment_id": 91485049, "body": "Please <a href=\"https://meta.stackoverflow.com/questions/303812/discourage-screenshots-of-code-and-or-errors\">do not include images of code</a>! They are hard to read. Instead, copy and paste your code directly into the question."}], "answers": [{"tags": [], "owner": {"reputation": 1831, "user_id": 4160532, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Ey34JagqMzQ/AAAAAAAAAAI/AAAAAAAAABo/G70W8D2LXM4/photo.jpg?sz=128", "display_name": "Kedarnag Mukanahallipatna", "link": "https://stackoverflow.com/users/4160532/kedarnag-mukanahallipatna"}, "is_accepted": true, "score": 2, "last_activity_date": 1536639462, "creation_date": 1536639462, "answer_id": 52268579, "question_id": 52268113, "link": "https://stackoverflow.com/questions/52268113/the-value-of-id-column-is-0-when-use-db-create-and-db-firstorcreate-to-save/52268579#52268579", "title": "The value of &quot;ID&quot; column is &quot;0&quot; when use db.Create and db.FirstOrCreate to save data into database", "body": "<p>Change your definition to look like this</p>\n\n<pre><code>type User struct {\n  gorm.Model\n  ID int `gorm:\"AUTO_INCREMENT\"`\n  ..\n  ..\n}\n</code></pre>\n"}], "owner": {"reputation": 693, "user_id": 425993, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1267cef00f1c7f190e1912bc50d1e6e5?s=128&d=identicon&r=PG", "display_name": "Ace.Yin", "link": "https://stackoverflow.com/users/425993/ace-yin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1361, "favorite_count": 0, "accepted_answer_id": 52268579, "answer_count": 1, "score": 0, "last_activity_date": 1536641266, "creation_date": 1536635256, "last_edit_date": 1536641266, "question_id": 52268113, "link": "https://stackoverflow.com/questions/52268113/the-value-of-id-column-is-0-when-use-db-create-and-db-firstorcreate-to-save", "title": "The value of &quot;ID&quot; column is &quot;0&quot; when use db.Create and db.FirstOrCreate to save data into database", "body": "<p>I am using \"do.FirstOrCreate\" to check my data and I want the data been created if it not exist in my table, everything works well except the \"ID\" not generated (the value of \"ID\" column is 0).</p>\n\n<p>here are my codes:</p>\n\n<p><code>domain object</code></p>\n\n<p><a href=\"https://i.stack.imgur.com/wEQRp.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wEQRp.png\" alt=\"enter image description here\"></a></p>\n\n<p><code>codes calling db.FirstOrCreate</code></p>\n\n<p><a href=\"https://i.stack.imgur.com/eOLo3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/eOLo3.png\" alt=\"enter image description here\"></a></p>\n\n<p>here is the data inserted into my user table:</p>\n\n<p><a href=\"https://i.stack.imgur.com/ruyye.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ruyye.png\" alt=\"enter image description here\"></a></p>\n\n<p>the gorm version is : 1.9.1</p>\n"}, {"tags": ["go", "embeddedwebserver"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1536634109, "post_id": 52267801, "comment_id": 91483503, "body": "I don&#39;t see what&#39;s wrong after a quick glance.  I recommend starting from <a href=\"https://github.com/golang/go/blob/0f72e79856d246af85c449f9e5a357ba751cd234/src/net/http/fs_test.go#L599-L662\" rel=\"nofollow noreferrer\">the http.FileServer test</a>.   That code is known to work."}, {"owner": {"reputation": 13, "user_id": 10282900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OtMCi.png?s=128&g=1", "display_name": "nomadist", "link": "https://stackoverflow.com/users/10282900/nomadist"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1536634281, "post_id": 52267801, "comment_id": 91483547, "body": "Thanks for the quick reply :) It compiles fine but the result is invariably &quot;404 not found&quot;... I&#39;ll have a look at the fileserver test thanks; although i think the problem is likely to be in the map - to filesystem part.."}], "answers": [{"comments": [{"owner": {"reputation": 2364, "user_id": 4206629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ea9a378d5409478f2717aae6354396?s=128&d=identicon&r=PG", "display_name": "YongHao Hu", "link": "https://stackoverflow.com/users/4206629/yonghao-hu"}, "edited": false, "score": 0, "creation_date": 1536641184, "post_id": 52268777, "comment_id": 91485000, "body": "In fact, I can figure out this by add debug message. One question, <code>&quot;&#47;index.html&quot;</code> not works as expected because browser treat <code>index.html</code> as <code>&#47;</code>."}, {"owner": {"reputation": 13, "user_id": 10282900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OtMCi.png?s=128&g=1", "display_name": "nomadist", "link": "https://stackoverflow.com/users/10282900/nomadist"}, "edited": false, "score": 0, "creation_date": 1536643525, "post_id": 52268777, "comment_id": 91485672, "body": "@Gavin - thank you so much for your thorough answer; it works now :) Have a terrific day :)"}, {"owner": {"reputation": 13, "user_id": 10282900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OtMCi.png?s=128&g=1", "display_name": "nomadist", "link": "https://stackoverflow.com/users/10282900/nomadist"}, "reply_to_user": {"reputation": 2364, "user_id": 4206629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ea9a378d5409478f2717aae6354396?s=128&d=identicon&r=PG", "display_name": "YongHao Hu", "link": "https://stackoverflow.com/users/4206629/yonghao-hu"}, "edited": false, "score": 0, "creation_date": 1536643598, "post_id": 52268777, "comment_id": 91485698, "body": "@YongHaoHu - indeed, when trying it out with &#39;other.html&#39; and adding the leading slash it did actually work. Thanks for your help as well :)"}], "tags": [], "owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "is_accepted": true, "score": 2, "last_activity_date": 1536949923, "last_edit_date": 1536949923, "creation_date": 1536640839, "answer_id": 52268777, "question_id": 52267801, "link": "https://stackoverflow.com/questions/52267801/serving-a-map-of-strings-without-3rd-party-libraries-using-http-filesystem-in-go/52268777#52268777", "title": "Serving a map of strings without 3rd party libraries using http.filesystem in Go (Golang)", "body": "<p>Here is the main code we will need to look at, which comes from the source regarding <code>http.FileServer</code>:</p>\n\n<pre><code>func (f *fileHandler) ServeHTTP(w ResponseWriter, r *Request) {\n    upath := r.URL.Path\n    if !strings.HasPrefix(upath, \"/\") {\n        upath = \"/\" + upath\n        r.URL.Path = upath\n    }\n    serveFile(w, r, f.root, path.Clean(upath), true)\n}\n\n// name is '/'-separated, not filepath.Separator.\nfunc serveFile(w ResponseWriter, r *Request, fs FileSystem, name string, redirect bool) {\n    const indexPage = \"/index.html\"\n\n    // redirect .../index.html to .../\n    // can't use Redirect() because that would make the path absolute,\n    // which would be a problem running under StripPrefix\n    if strings.HasSuffix(r.URL.Path, indexPage) {\n        localRedirect(w, r, \"./\")\n        return\n    }\n\n    f, err := fs.Open(name)\n    if err != nil {\n        msg, code := toHTTPError(err)\n        Error(w, msg, code)\n        return\n    }\n    defer f.Close()\n\n    ...\n}\n</code></pre>\n\n<p>In the <code>ServeHTTP</code> method, you will see a call to an unexported function.</p>\n\n<pre><code>serveFile(w, r, f.root, path.Clean(upath), true)\n</code></pre>\n\n<p>where <code>upath</code> is the request's URL path that is guaranteed to begin with \"/\".</p>\n\n<p>In <code>serveFile</code>, <code>fs.Open(name)</code> is called, where <code>fs</code> is the <code>FileSystem</code> you provided and <code>name</code> is the argument we passed as <code>path.Clean(upath)</code>. Note that <code>path.Clean</code> is already being called, so you should not need to call this in your <code>prepare</code> method.</p>\n\n<p>The takeaway here is that you are storing your \"file names\" without a preceding \"/\", which would represent they are in the root of the filesystem.</p>\n\n<p>You can fix this two different ways.</p>\n\n<p>1.</p>\n\n<pre><code>ASSETS[\"/index.html\"] = LoadAsset(\"index.html\", HTML, ASSETS)\nASSETS[\"/style.css\"] = LoadAsset(\"style.css\", CSS, ASSETS)\n</code></pre>\n\n<p>2.</p>\n\n<pre><code>func (fs StaticFS) Open(name string) (http.File, error) {\n    if strings.HasPrefix(name, \"/\") {\n        name = name[1:]\n    }\n    f, err := fs.prepare(name)\n    if err != nil {\n        return nil, err\n    }\n    return f.File()\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 10282900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OtMCi.png?s=128&g=1", "display_name": "nomadist", "link": "https://stackoverflow.com/users/10282900/nomadist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 52268777, "answer_count": 1, "score": 1, "last_activity_date": 1536949923, "creation_date": 1536632288, "last_edit_date": 1536640433, "question_id": 52267801, "link": "https://stackoverflow.com/questions/52267801/serving-a-map-of-strings-without-3rd-party-libraries-using-http-filesystem-in-go", "title": "Serving a map of strings without 3rd party libraries using http.filesystem in Go (Golang)", "body": "<p>I am just starting out with Go and am trying to learn how to build a simple web app without using 3rd party libraries / packages. </p>\n\n<p>Using <a href=\"https://stackoverflow.com/questions/21595295/golang-serve-static-files-from-memory\">this post</a> and <a href=\"https://github.com/mjibson/esc/blob/master/embed/embed.go\" rel=\"nofollow noreferrer\">this code</a> as a guideline, I've hacked the following together:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"net/http\"\n    \"os\"\n    \"path\"\n    \"time\"\n)\n\ntype StaticFS map[string]*staticFile\n\ntype staticFile struct {\n    name string\n    data []byte\n    fs   StaticFS\n}\n\nfunc LoadAsset(name string, data string, fs StaticFS) *staticFile {\n    return &amp;staticFile{name: name,\n        data: []byte(data),\n        fs:   fs}\n}\n\nfunc (fs StaticFS) prepare(name string) (*staticFile, error) {\n    f, present := fs[path.Clean(name)]\n    if !present {\n        return nil, os.ErrNotExist\n    }\n    return f, nil\n}\n\nfunc (fs StaticFS) Open(name string) (http.File, error) {\n    f, err := fs.prepare(name)\n    if err != nil {\n        return nil, err\n    }\n    return f.File()\n}\n\nfunc (f *staticFile) File() (http.File, error) {\n    type httpFile struct {\n        *bytes.Reader\n        *staticFile\n    }\n    return &amp;httpFile{\n        Reader:     bytes.NewReader(f.data),\n        staticFile: f,\n    }, nil\n}\n\n//implement the rest of os.FileInfo\nfunc (f *staticFile) Close() error {\n    return nil\n}\n\nfunc (f *staticFile) Stat() (os.FileInfo, error) {\n    return f, nil\n}\n\nfunc (f *staticFile) Readdir(count int) ([]os.FileInfo, error) {\n    return nil, nil\n}\n\nfunc (f *staticFile) Name() string {\n    return f.name\n}\n\nfunc (f *staticFile) Size() int64 {\n    return int64(len(f.data))\n}\n\nfunc (f *staticFile) Mode() os.FileMode {\n    return 0\n}\n\nfunc (f *staticFile) ModTime() time.Time {\n    return time.Time{}\n}\n\nfunc (f *staticFile) IsDir() bool {\n    return false\n}\n\nfunc (f *staticFile) Sys() interface{} {\n    return f\n}\n\nfunc main() {\n\n    const HTML = `&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;title&gt;Test&lt;/title&gt;\n&lt;link rel=\"stylesheet\" href=\"style.css\"&gt;\n&lt;/head&gt;\n&lt;body&gt;\n&lt;main&gt;\n&lt;p&gt;Hello World&lt;/p&gt;\n&lt;/main&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n`\n\n    const CSS = `\np {\n    color:red;\n    text-align:center;\n} \n`\n    ASSETS := make(StaticFS)\n    ASSETS[\"index.html\"] = LoadAsset(\"index.html\", HTML, ASSETS)\n    ASSETS[\"style.css\"] = LoadAsset(\"style.css\", CSS, ASSETS)\n    http.Handle(\"/\", http.FileServer(ASSETS))\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>Which compiles fine, but doesn't actually produce any results other than 404 page not found..</p>\n\n<p>What I want to achieve is having a package in my app that allows me to make a map, embed some static content such as css and js in it and then serve it with http.Handle - Without using 3rd party tools like go-bindata, rice or anything else.</p>\n\n<p>Any help would be greatly appreciated..</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1536822621, "post_id": 52266332, "comment_id": 91563820, "body": "isn&#39;t this just <code>go mod download</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "edited": false, "score": 4, "creation_date": 1536637355, "post_id": 52267771, "comment_id": 91484203, "body": "This is more a question of whether the new <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">modules</a> system that landed in 1.11 has a built-in way to do this. If you check the dep repo, you&#39;ll see its actually being deprecated for modules :("}], "tags": [], "owner": {"reputation": 510, "user_id": 1544694, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xRSRy.jpg?s=128&g=1", "display_name": "mdh.heydari", "link": "https://stackoverflow.com/users/1544694/mdh-heydari"}, "is_accepted": false, "score": 0, "last_activity_date": 1536631962, "creation_date": 1536631962, "answer_id": 52267771, "question_id": 52266332, "link": "https://stackoverflow.com/questions/52266332/manually-fetch-dependencies-from-go-mod/52267771#52267771", "title": "Manually fetch dependencies from go.mod?", "body": "<p>You can use a package manager, There are many of them like <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a>, <a href=\"https://github.com/Masterminds/glide\" rel=\"nofollow noreferrer\">glide</a>, and <a href=\"https://github.com/kardianos/govendor\" rel=\"nofollow noreferrer\">govendor</a>. <code>dep</code> is newer and is going to be integrated into go toolchain as official dependency management tool.</p>\n\n<p>We also make docker images for go applications and we use <a href=\"https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/\" rel=\"nofollow noreferrer\">dind</a> to make those images and we prepared a CI/CD image with all dependencies preinstalled to make the builds faster. Though, it took a little bit of scripting to glue everything together.</p>\n\n<p>Moreover, layering up the dependencies could result in big size of docker images. I suggest try <a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\" rel=\"nofollow noreferrer\">multi-stage builds</a> which could help making images super lite.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 18, "last_activity_date": 1536686189, "last_edit_date": 1536686189, "creation_date": 1536654076, "answer_id": 52271668, "question_id": 52266332, "link": "https://stackoverflow.com/questions/52266332/manually-fetch-dependencies-from-go-mod/52271668#52271668", "title": "Manually fetch dependencies from go.mod?", "body": "<p>You may use the <code>go mod vendor</code> command which will create a <code>vendor</code> folder in the main module's root folder, and copy all dependencies into it. After this you may pass the <code>-mod=vendor</code> param to the go tool, and then dependencies from the <code>vendor</code> folder will be used to build / compile / test your app.</p>\n\n<p>So what you may do to speed up your builds:</p>\n\n<ol>\n<li>Run the <code>go mod vendor</code> command to have an actual version of your dependencies.</li>\n<li>Save / cache this <code>vendor</code> folder.</li>\n<li>During builds, restore this <code>vendor</code> folder, and build / install your app by passing the <code>-mod=vendor</code> argument to the go tool, so no dependencies will be downloaded, but the content of the <code>vendor</code> folder will be used.</li>\n</ol>\n\n<p>Quoting from <code>go help mod</code>:</p>\n\n<blockquote>\n  <p>Modules and vendoring</p>\n  \n  <p>When using modules, the go command completely ignores vendor directories.</p>\n  \n  <p>By default, the go command satisfies dependencies by downloading modules\n  from their sources and using those downloaded copies (after verification,\n  as described in the previous section). To allow interoperation with older\n  versions of Go, or to ensure that all files used for a build are stored\n  together in a single file tree, 'go mod vendor' creates a directory named\n  vendor in the root directory of the main module and stores there all the\n  packages from dependency modules that are needed to support builds and\n  tests of packages in the main module.</p>\n  \n  <p>To build using the main module's top-level vendor directory to satisfy\n  dependencies (disabling use of the usual network sources and local\n  caches), use 'go build -mod=vendor'. Note that only the main module's\n  top-level vendor directory is used; vendor directories in other locations\n  are still ignored.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 3280, "user_id": 429476, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/V3SVL.jpg?s=128&g=1", "display_name": "Alex Punnen", "link": "https://stackoverflow.com/users/429476/alex-punnen"}, "edited": false, "score": 0, "creation_date": 1574419112, "post_id": 56693289, "comment_id": 104235639, "body": "does it install the package in /go/bin ?"}], "tags": [], "owner": {"reputation": 61409, "user_id": 485343, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e18b024a122df74275dd2c4486e8a2b4?s=128&d=identicon&r=PG", "display_name": "rustyx", "link": "https://stackoverflow.com/users/485343/rustyx"}, "is_accepted": true, "score": 27, "last_activity_date": 1561061703, "creation_date": 1561061703, "answer_id": 56693289, "question_id": 52266332, "link": "https://stackoverflow.com/questions/52266332/manually-fetch-dependencies-from-go-mod/56693289#56693289", "title": "Manually fetch dependencies from go.mod?", "body": "<p>It was an issue <a href=\"https://github.com/golang/go/issues/26610\" rel=\"noreferrer\">#26610</a>, which is fixed now.</p>\n\n<p>So now you can just use:</p>\n\n<pre><code>go mod download\n</code></pre>\n\n<p>For this to work you need just the <code>go.mod</code> / <code>go.sum</code> files.</p>\n\n<p>For example, here's how to have a cached multistage Docker build:</p>\n\n<pre><code>FROM golang:1.12-alpine as builder\nRUN apk --no-cache add ca-certificates git\nWORKDIR /build/myapp\n\n# Fetch dependencies\nCOPY go.mod ./\nRUN go mod download\n\n# Build\nCOPY . ./\nRUN CGO_ENABLED=0 go build\n\n# Create final image\nFROM alpine\nWORKDIR /root\nCOPY --from=builder /build/myapp/myapp .\nEXPOSE 8080\nCMD [\"./myapp\"]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 583, "user_id": 2420718, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d17ad7992f6e42fdb8c1b8f170ad581?s=128&d=identicon&r=PG", "display_name": "Julian Espinel", "link": "https://stackoverflow.com/users/2420718/julian-espinel"}, "is_accepted": false, "score": 1, "last_activity_date": 1603723613, "last_edit_date": 1603723613, "creation_date": 1603500664, "answer_id": 64508939, "question_id": 52266332, "link": "https://stackoverflow.com/questions/52266332/manually-fetch-dependencies-from-go-mod/64508939#64508939", "title": "Manually fetch dependencies from go.mod?", "body": "<p>I wanted to re-download all the dependencies using <code>go mod</code>, this is what I did:</p>\n<ol>\n<li>Go to your <code>GOROOT</code></li>\n<li><code>sudo rm -rf pkg/mod/</code></li>\n<li>Go to the directory where the <code>go.mod</code> file exists</li>\n<li><code>go mod download</code></li>\n</ol>\n"}], "owner": {"reputation": 2186, "user_id": 1647656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0a27a80f0a9800a2fc5935ecf7071eca?s=128&d=identicon&r=PG", "display_name": "Alex Guerra", "link": "https://stackoverflow.com/users/1647656/alex-guerra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25486, "favorite_count": 6, "accepted_answer_id": 56693289, "answer_count": 4, "score": 19, "last_activity_date": 1603723613, "creation_date": 1536618586, "last_edit_date": 1571963858, "question_id": 52266332, "link": "https://stackoverflow.com/questions/52266332/manually-fetch-dependencies-from-go-mod", "title": "Manually fetch dependencies from go.mod?", "body": "<p>I'm using go 1.11 with module support. I understand that the go tool now installs dependencies automatically on build/install. I also understand the reasoning.</p>\n\n<p>I'm using docker to build my binaries. In many other ecosystems its common to copy over your dependency manifest (package.json, requirements.txt, etc) and install dependencies as a separate stage from build. This takes advantage of docker's layer caching, and makes rebuilds much faster since generally code changes vastly outnumber dependency changes.</p>\n\n<p>I was wondering if vgo has any way to do this?</p>\n"}, {"tags": ["database", "docker", "go", "cassandra", "docker-compose"], "answers": [{"comments": [{"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1536620296, "post_id": 52266457, "comment_id": 91480935, "body": "Thanks! I think this may be it - confirming some other things to get a fresh build and then ill give you internet points :P. One sec."}], "tags": [], "owner": {"reputation": 112, "user_id": 411355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7357ab10c5f9d8f7841bd2c291b4c2d6?s=128&d=identicon&r=PG", "display_name": "gazarsgo", "link": "https://stackoverflow.com/users/411355/gazarsgo"}, "is_accepted": true, "score": 3, "last_activity_date": 1536619524, "creation_date": 1536619524, "answer_id": 52266457, "question_id": 52266171, "link": "https://stackoverflow.com/questions/52266171/golang-gocql-cannot-connect-to-cassandra-using-docker/52266457#52266457", "title": "Golang gocql cannot connect to Cassandra (using Docker)", "body": "<p>Use the service name <code>cassandra00</code> for the hostname per the docker-compose documentation <a href=\"https://docs.docker.com/compose/compose-file/#links\" rel=\"nofollow noreferrer\">https://docs.docker.com/compose/compose-file/#links</a></p>\n\n<blockquote>\n  <p>Containers for the linked service are reachable at a hostname identical to the alias, or the service name if no alias was specified.</p>\n</blockquote>\n\n<p>Leave the <code>CASSANDRA_LISTEN_ADDRESS</code> envvar unset (or pass <code>auto</code>) per <a href=\"https://docs.docker.com/samples/library/cassandra/\" rel=\"nofollow noreferrer\">https://docs.docker.com/samples/library/cassandra/</a> </p>\n\n<blockquote>\n  <p>The default value is auto, which will set the listen_address option in cassandra.yaml to the IP address of the container as it starts. This default should work in most use cases.</p>\n</blockquote>\n"}], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1185, "favorite_count": 0, "accepted_answer_id": 52266457, "answer_count": 1, "score": 2, "last_activity_date": 1536619524, "creation_date": 1536617484, "last_edit_date": 1536617787, "question_id": 52266171, "link": "https://stackoverflow.com/questions/52266171/golang-gocql-cannot-connect-to-cassandra-using-docker", "title": "Golang gocql cannot connect to Cassandra (using Docker)", "body": "<p>I am trying to setup and connect to a Cassandra single node instance using docker and Golang and it is not working.</p>\n\n<p>The closest information I could find to addressing connection issues between the golang <code>gocql</code> package and Cassandra is available here: <a href=\"https://stackoverflow.com/questions/29121904/cassandra-cqlsh-connection-refused\">Cassandra cqlsh - connection refused</a>, however there are many different upvote answers with no clear indication of which is preferred. It is also a protected question (no \"me toos\"), so a lot of community members seem to be having trouble with this.</p>\n\n<p>This problem should be slightly different, as it is using Docker and I have tried most (if not all of the solutions linked to above). </p>\n\n<pre><code>version: \"3\"  \nservices:  \n  cassandra00:\n    restart: always\n    image: cassandra:latest\n    volumes: \n      - ./db/casdata:/var/lib/cassandra\n    ports: \n      - 7000:7000\n      - 7001:7001\n      - 7199:7199\n      - 9042:9042\n      - 9160:9160\n    environment:\n      - CASSANDRA_RPC_ADDRESS=127.0.0.1\n      - CASSANDRA_BROADCAST_ADDRESS=127.0.0.1\n      - CASSANDRA_LISTEN_ADDRESS=127.0.0.1\n      - CASSANDRA_START_RPC=true\n  db:\n    restart: always\n    build: ./db\n    environment:\n      POSTGRES_USER: patientplatypus\n      POSTGRES_PASSWORD: SUPERSECRETFAKEPASSD00T\n      POSTGRES_DB: zennify\n    expose:\n      - \"5432\"\n    ports:\n      - 5432:5432\n    volumes:\n      - ./db/pgdata:/var/lib/postgresql/data\n  app:\n    restart: always\n    build: \n      context: .\n      dockerfile: Dockerfile\n    command: bash -c 'while !&lt;/dev/tcp/db/5432; do sleep 10; done; realize start --run'\n    # command: bash -c 'while !&lt;/dev/tcp/db/5432; do sleep 10; done; go run main.go'\n    ports:\n      - 8000:8000\n    depends_on:\n      - db\n      - cassandra00\n    links:\n      - db\n      - cassandra00\n    volumes:\n      - ./:/go/src/github.com/patientplatypus/webserver/\n</code></pre>\n\n<p>Admittedly, I am a little shaky on what listening addresses I should pass to Cassandra in the environment section, so I just passed 'home':</p>\n\n<pre><code>  - CASSANDRA_RPC_ADDRESS=127.0.0.1\n  - CASSANDRA_BROADCAST_ADDRESS=127.0.0.1\n  - CASSANDRA_LISTEN_ADDRESS=127.0.0.1\n</code></pre>\n\n<p>If you try and pass <code>0.0.0.0</code> you get the following error:</p>\n\n<pre><code>cassandra00_1  | Exception (org.apache.cassandra.exceptions.ConfigurationException) encountered during startup: listen_address cannot be a wildcard address (0.0.0.0)!\ncassandra00_1  | listen_address cannot be a wildcard address (0.0.0.0)!\ncassandra00_1  | ERROR [main] 2018-09-10 21:50:44,530 CassandraDaemon.java:708 - Exception encountered during startup: listen_address cannot be a wildcard address (0.0.0.0)!\n</code></pre>\n\n<p>Overall, however I think that I am getting the correct start up procedure for Cassandra (afaict) because my terminal outputs that Cassandra started up as normal and is listening on the appropriate ports:</p>\n\n<pre><code>cassandra00_1  | INFO  [main] 2018-09-10 22:06:28,920 StorageService.java:1446 - JOINING: Finish joining ring\ncassandra00_1  | INFO  [main] 2018-09-10 22:06:29,179 StorageService.java:2289 - Node /127.0.0.1 state jump to NORMAL\ncassandra00_1  | INFO  [main] 2018-09-10 22:06:29,607 NativeTransportService.java:70 - Netty using native Epoll event loop\ncassandra00_1  | INFO  [main] 2018-09-10 22:06:29,750 Server.java:155 - Using Netty Version: [netty-buffer=netty-buffer-4.0.44.Final.452812a, netty-codec=netty-codec-4.0.44.Final.452812a, netty-codec-haproxy=netty-codec-haproxy-4.0.44.Final.452812a, netty-codec-http=netty-codec-http-4.0.44.Final.452812a, netty-codec-socks=netty-codec-socks-4.0.44.Final.452812a, netty-common=netty-common-4.0.44.Final.452812a, netty-handler=netty-handler-4.0.44.Final.452812a, netty-tcnative=netty-tcnative-1.1.33.Fork26.142ecbb, netty-transport=netty-transport-4.0.44.Final.452812a, netty-transport-native-epoll=netty-transport-native-epoll-4.0.44.Final.452812a, netty-transport-rxtx=netty-transport-rxtx-4.0.44.Final.452812a, netty-transport-sctp=netty-transport-sctp-4.0.44.Final.452812a, netty-transport-udt=netty-transport-udt-4.0.44.Final.452812a]\ncassandra00_1  | INFO  [main] 2018-09-10 22:06:29,754 Server.java:156 - Starting listening for CQL clients on /127.0.0.1:9042 (unencrypted)...\ncassandra00_1  | INFO  [main] 2018-09-10 22:06:29,990 ThriftServer.java:116 - Binding thrift service to /127.0.0.1:9160\n</code></pre>\n\n<p>In my golang code I have the following package that is being called (simplified to show relevant section):</p>\n\n<pre><code>package data\n\nimport(\n    \"fmt\"\n    \"github.com/gocql/gocql\"\n)\n\nfunc create_userinfo_table() {\n    &lt;...&gt;\n    fmt.Println(\"replicating table in cassandra\")\n    cluster := gocql.NewCluster(\"localhost\") //&lt;---error here!\n    cluster.ProtoVersion = 4\n    &lt;...&gt;\n}\n</code></pre>\n\n<p>Which results in the following error in my terminal:</p>\n\n<pre><code>app_1          | [21:52:38][WEBSERVER] : 2018/09/10 \n21:52:38 gocql: unable to dial control conn 127.0.0.1: \ndial tcp 127.0.0.1:9042: connect: connection refused\n\napp_1          | [21:52:38][WEBSERVER] : 2018/09/10 \n21:52:38 gocql: unable to dial control conn ::1: \ndial tcp [::1]:9042: connect: cannot assign requested address\n\napp_1          | [21:52:38][WEBSERVER] : 2018/09/10 \n21:52:38 Could not connect to cassandra cluster: gocql: \nunable to create session: control: unable to connect to initial hosts: \ndial tcp [::1]:9042: connect: cannot assign requested address\n</code></pre>\n\n<p>I have tried several variations on the connection address </p>\n\n<p><code>cluster := gocql.NewCluster(\"localhost\")</code></p>\n\n<p><code>cluster := gocql.NewCluster(\"127.0.0.1\")</code></p>\n\n<p><code>cluster := gocql.NewCluster(\"127.0.0.1:9042\")</code></p>\n\n<p><code>cluster := gocql.NewCluster(\"127.0.0.1:9160\")</code></p>\n\n<p>These seemed likely candidates for example, but no luck.</p>\n\n<p>Does anyone have any idea what I am doing wrong?</p>\n"}, {"tags": ["go", "aws-lambda"], "comments": [{"owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "edited": false, "score": 1, "creation_date": 1536612990, "post_id": 52265277, "comment_id": 91478762, "body": "AWS exports a variable called <code>LAMBDA_TASK_ROOT</code> which points to the source of your deployed code. You should use that as base path"}], "answers": [{"tags": [], "owner": {"reputation": 416, "user_id": 4381225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/aec91934b189d3d6738211b322cf2acb?s=128&d=identicon&r=PG&f=1", "display_name": "mycellius", "link": "https://stackoverflow.com/users/4381225/mycellius"}, "is_accepted": false, "score": 0, "last_activity_date": 1536780397, "creation_date": 1536780397, "answer_id": 52302102, "question_id": 52265277, "link": "https://stackoverflow.com/questions/52265277/how-to-reference-other-files-within-a-lambda-function/52302102#52302102", "title": "How to reference other files within a lambda function?", "body": "<p>I solved my problem by listing the contents of the directory that I was using in my lambda, using the code found in this answer: <a href=\"https://stackoverflow.com/questions/14668850/list-directory-in-go/14668907#14668907\">List directory in Go</a>. After doing so I realized that I was in the root directory of the entire folder that I uploaded, not the directory of the specific package I was running the code from (containing <code>main.go</code>)</p>\n"}], "owner": {"reputation": 416, "user_id": 4381225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/aec91934b189d3d6738211b322cf2acb?s=128&d=identicon&r=PG&f=1", "display_name": "mycellius", "link": "https://stackoverflow.com/users/4381225/mycellius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1140, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1536780397, "creation_date": 1536612451, "question_id": 52265277, "link": "https://stackoverflow.com/questions/52265277/how-to-reference-other-files-within-a-lambda-function", "title": "How to reference other files within a lambda function?", "body": "<p>In a handler of mine, I open a <code>.mmdb</code> file for doing geo lookups. In my package, I use <code>./</code> notation to reference the file since the handler and file are in the same directory. Now that I want to deploy the function using serverless, I've included the file within the <code>include</code> block in my <code>serverless.yml</code> file. Based on the package size that I'm seeing, the file is being uploaded, however I'm getting the error </p>\n\n<pre><code>open ./GeoLite2-City.mmdb: no such file or directory \n</code></pre>\n\n<p>when running the lambda. What is the proper way to get the location of the file from within my lambda?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 3, "creation_date": 1536613546, "post_id": 52265146, "comment_id": 91478989, "body": "With channels, it can be good to have only one place from where things are sent. This way it. sending to a closed channel can easily be avoided as the only sender knows if the channel is open, as it is his responsibility to close to it. In your case, this could be archived by adding another &quot;sender&quot; goroutine, which as 2 channels from which it receives (e.g. <code>sendQueue</code> and <code>failed</code>) and one channel to which it forwards everything (e.g. <code>toSend</code>). You would then queue the emails in the <code>sendQueue</code> and failed emails would be sent to <code>failed</code>. When a sender is done, it can close its channel."}], "answers": [{"comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 2, "creation_date": 1536672168, "post_id": 52275902, "comment_id": 91501682, "body": "The approach you are describing is reasonable, but I see a problem with it. If I am not mistaken, a <code>for</code> loop over a channel only stops when <code>break</code> is used or the channel is closed. Now the problem in your approach is, that the channel will only be closed, once the for loop finishes, which only happens once the channel is closed. This would lead to a deadlock. Also, I think you have a typo in what needs to be changed, as the 2 code blocks are identical (from the rest of the answer, I&#39;d guess you want to swap the 2 lines in the first code block)."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1536673720, "post_id": 52275902, "comment_id": 91502789, "body": "Ohhh.. yes, thanks for pointing out. Will update the answer in some time. Will post with a working code. It&#39;s easy to miss such things without writing actual code. My statement &quot;only this change is needed&quot; was certainly wrong."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1536831191, "post_id": 52275902, "comment_id": 91568496, "body": "@Leon : Updated my answer with another approach."}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 1, "creation_date": 1536837660, "post_id": 52275902, "comment_id": 91572142, "body": "That looks good and I only noticed 2 things: First, the timeout-select in <code>sendEmailSSHWrapper</code> is run inside the goroutine, meaning the timeout will start, once <code>sendEmailSSH</code> returns. Moving the select out of the goroutine would make it an actual timeout, instead of waiting for it to finish before starting the timeout."}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 1, "creation_date": 1536837776, "post_id": 52275902, "comment_id": 91572223, "body": "Second, in <code>worker</code>, the only way the <code>toRetry</code> channel will be closed, it when the timeout happens. This means that checking <code>ok</code> is unnecessary, as. when the channel is closed, the loop will be broken. If that is not intentional, you would need to add a mechanism to close the channel, once all <code>sendEmailSSHWrapper</code> have returned (e.g. with a <code>sync.WaitGroup</code> which tracks all running <code>sendEmailSSHWrapper</code> and an additional goroutine, which waits for it to be <code>Done()</code> and then closes the channel.)."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1536839568, "post_id": 52275902, "comment_id": 91573300, "body": "First one, Updated. Thanks. About closing <code>retryChan</code>, tried few approaches.  <code>sync.WaitGroup</code> didn&#39;t look like a safe option when tried, as there were continuous <code>.Add(1)</code> &amp; <code>.Done()</code> calls, and <code>.Add(1)</code> being called after <code>.Wait()</code>.   I also tried checking for <code>len(retryChan)</code> and taking decision to close(retryChan) on basis of that. But same problem. There were go-routines still running, and they try to <code>send after close()</code>, causing a BOOM.  So to be on safe side, I suggested keeping a reasonably big enough timeout, and then <code>context</code> can be used if some go routine is still running."}, {"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1536840652, "post_id": 52275902, "comment_id": 91573903, "body": "My idea would look like the following: create a new WaitGroup before <code>range toSend</code> loop, add an <code>Add(1)</code> inside the loop, before starting the goroutine, <code>defer</code> the <code>Done()</code> call inside the goroutine and start a goroutine doing <code>Wait()</code> and then <code>close()</code> after the <code>range toSend</code> loop finishes (<a href=\"https://play.golang.org/p/Ze2REwhrU62\" rel=\"nofollow noreferrer\">Playground</a>). This way, all <code>Add()</code> calls happen before the <code>Wait()</code> call, as we only start waiting once the <code>toSend</code> channel is closed. Maybe I missed something, but I don&#39;t see how this would <code>close</code> the channel before all <code>sendEmailSSHWrapper</code> are done."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1536863485, "post_id": 52275902, "comment_id": 91586934, "body": "Understood slightly, what you are trying to say. But your code ends up closing the <code>retryChan</code> right after <code>toSend</code> loop is done, and before we actually start with <code>retryChan</code>. <code>sendEmailSSH: failing randomly after 0 seconds: {success:false toEmail:c} toRetry is already closed toRetry is already closed worker 0: picking up {success:false toEmail:c} for retry toRetry is already closed toRetry is already closed toRetry is already closed Send emails Done!</code> No retries actually happen.Though, I will try working on similar idea on the block that handles <code>retryChan</code>, once we see the OP again"}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "reply_to_user": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1536863723, "post_id": 52275902, "comment_id": 91587033, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/180018/discussion-between-tushar-and-leon\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "is_accepted": false, "score": 0, "last_activity_date": 1536839650, "last_edit_date": 1536839650, "creation_date": 1536668778, "answer_id": 52275902, "question_id": 52265146, "link": "https://stackoverflow.com/questions/52265146/how-do-i-wait-for-all-work-to-be-completed-before-closing-the-channel/52275902#52275902", "title": "How do I wait for all work to be completed before closing the channel?", "body": "<p>Here's the approach I would suggest. I have removed few SMTP specific parts, for simplicity. You can plug them in again.</p>\n\n<p><strong>1. Sample code:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"math/rand\"\n    \"sync\"\n    \"time\"\n)\n\ntype combo struct {\n    success bool\n    toEmail string\n}\n\nfunc sendEmailSSH(try combo, delegate chan bool) {\n\n    defer close(delegate)\n\n    r := rand.Intn(7)\n    time.Sleep(time.Duration(r) * time.Second)\n    if r%2 == 0 {\n        fmt.Printf(\"sendEmailSSH: failing randomly after %d seconds: %+v\\n\", r, try)\n\n        delegate &lt;- false\n    } else {\n        fmt.Printf(\"sendEmailSSH: successful after %d seconds: %+v\\n\", r, try)\n\n        delegate &lt;- true\n\n    }\n\n}\n\nfunc sendEmailSSHWrapper(try combo, toRetry chan combo) {\n\n    // do something with try\n    delegate := make(chan bool, 1)\n    smtpTimeout := 3 // if no success within 3 seconds, mark it as failed\n\n    go sendEmailSSH(try, delegate)\n\n\n    go func() {\n                select {\n        case res := &lt;-delegate:\n            if res == true {\n                try.success = res\n            } else {\n                toRetry &lt;- try // if send not successfull, add to retry channel\n            }\n        case &lt;-time.After(time.Duration(smtpTimeout) * time.Second):\n            fmt.Printf(\"sendEmailSSHWrapper: failing due to timeout: %+v\\n\", try)\n\n            toRetry &lt;- try // if send timeout, add to retry channel\n        }\n\n    }()\n\n}\n\n// where we actually do the work\nfunc worker(toSend chan combo, wg *sync.WaitGroup, id int) {\n\n    toRetry := make(chan combo, 5)\n    retryDone := false\n\n    for try := range toSend {\n        go sendEmailSSHWrapper(try, toRetry)\n    }\n\n    for !retryDone {\n        select {\n\n        case try, ok := &lt;-toRetry:\n            if !ok {\n                log.Println(\"toRetry is already closed\")\n                retryDone = true\n                continue\n            }\n            fmt.Printf(\"worker %d: picking up %+v for retry\\n\", id, try)\n            go sendEmailSSHWrapper(try, toRetry)\n        case &lt;-time.After(time.Duration(15) * time.Second):\n            fmt.Printf(\"worker %d: no data in toRetry(%d) channel for 15 seconds. closing toRetry now\\n\", id, id)\n            close(toRetry)\n            toRetry = nil\n            retryDone = true\n        }\n\n    }\n\n    wg.Done()\n}\n\nfunc main() {\n\n    var wg sync.WaitGroup // keep track of the workers\n\n    toSend := make(chan combo) // to the workers\n\n    // emailList := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\"}\n    emailList := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\"}\n\n\n    // initialize n workers\n\n    for i := 0; i &lt; 5; i++ {\n        wg.Add(1)\n        go worker(toSend, &amp;wg, i)\n    }\n\n    var count int = 0\n\n    for i := 0; i &lt; len(emailList); i++ {\n        count++\n        toSend &lt;- combo{toEmail: emailList[i], success: false}\n    }\n\n    close(toSend)\n    wg.Wait()\n\n    fmt.Println(\"Send emails Done!\")\n}\n</code></pre>\n\n<p>Try it here:\n<a href=\"https://play.golang.org/p/W7ur2wr3HeD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/W7ur2wr3HeD</a></p>\n\n<p><strong>2. What I have done:</strong></p>\n\n<ol>\n<li>Whenever main is done adding data, it should close the <code>toSend</code> channel. It won't be used any further.</li>\n<li>Create a wrapper over sendEmailSSH function. Your current implementation of calling <code>go sendEmailSSH(try, delegate, s, try.line)</code> is not very optimised, as after starting the go routine, it is anyways blocked on a unary sized channel, which is as good as a serial call.</li>\n<li>Alternatively, I have called <code>go sendEmailSSHWrapper(try, toRetry)</code>, and it internally calls actual <code>sendEmailSSHWrapper</code> function &amp; monitors delegate channel.</li>\n<li><code>sendEmailSSH</code> randomly fails few requests, for the purpose of demonstration.</li>\n<li><code>sendEmailSSHWrapper</code> monitors <code>delegate</code> it's own channel for failures, and also checks for timeout (I kept it 3 seconds for demonstration)</li>\n<li>Worker first completely exhausts the <code>toSend</code> channel. And then moves to <code>toRetry</code> channel. It works on it, unless it sees no data on this channel for 15 seconds(again, kept high for demonstration)</li>\n</ol>\n\n<p><strong>3. What you will need to add:</strong></p>\n\n<ol>\n<li><p>You should really implement some mechanism so that you retry only a given number of times for any given email address. Or else, you might be stuck in the for loop forever, for any faulty email address, or any unexpected scenario (multiple continuous timeouts due to latency), maybe using a map to track counts of retried entries. Or even simpler, add a <code>retryCount int</code> to your <code>combo</code> struct, and increment it with every retry, and check before retrying every time.</p></li>\n<li><p>Note that in both your and my approach, we are retrying on timeout. Are you sure if timeout happens, email will never be delivered? If not, you should really be using <code>context with cancellation</code>, or someway to kill the actual go routine if it takes more time, before retrying. Else, on some bad day, if the latency is more, you might end up timing out a lot, and keep retrying. While in reality you would be spamming the user with a lot of emails.</p></li>\n</ol>\n"}], "owner": {"reputation": 41, "user_id": 10342425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c677fcc71067f199f1f3f010eaeb250?s=128&d=identicon&r=PG&f=1", "display_name": "Constantino Bene", "link": "https://stackoverflow.com/users/10342425/constantino-bene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1536839650, "creation_date": 1536611856, "last_edit_date": 1536621640, "question_id": 52265146, "link": "https://stackoverflow.com/questions/52265146/how-do-i-wait-for-all-work-to-be-completed-before-closing-the-channel", "title": "How do I wait for all work to be completed before closing the channel?", "body": "<p>I am creating an email sending application in Go.</p>\n\n<p>I have encountered a problem when an email could not be sent successfully. In these cases, I want to return the email in a go channel, but the channel is closed.</p>\n\n<p>How I can prevent the channel being closed before all tasks have completed?</p>\n\n<p>This is the function with this problem: </p>\n\n<pre><code>func worker(toSend chan combo, tried chan combo, s smptInfo, wg *sync.WaitGroup) {\n    for try := range toSend {\n\n        startSend := time.Now()\n        delegate := make(chan bool, 1)\n        go sendEmailSSH(try, delegate, s, try.line)\n        select {\n        case res := &lt;-delegate:\n            if res == true {\n                try.success = res\n                tried &lt;- try\n            } else {\n                toSend &lt;- try // if send not successfull return back to channel\n            }\n        case &lt;-time.After(smtpTimeout):\n            toSend &lt;- try // if send timeout return back to channel\n        }\n\n        Pauza(startSend) // if send more fast like limit send, wait.\n    }\n\n    wg.Done()\n}\n</code></pre>\n\n<p>The complete application can be found on <a href=\"https://gist.github.com/obreja/c960e3e672297de28fd9ae397303b272\" rel=\"nofollow noreferrer\">GitHub</a>.</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-sdk"], "answers": [{"tags": [], "owner": {"reputation": 61, "user_id": 10343916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52138f6467c837592c80c210dac495d3?s=128&d=identicon&r=PG&f=1", "display_name": "l33tn00b", "link": "https://stackoverflow.com/users/10343916/l33tn00b"}, "is_accepted": true, "score": 2, "last_activity_date": 1536811269, "creation_date": 1536811269, "answer_id": 52306455, "question_id": 52264557, "link": "https://stackoverflow.com/questions/52264557/google-golang-sdk-use-custom-ca-bundle/52306455#52306455", "title": "Google Golang SDK Use Custom CA Bundle", "body": "<p>For anyone else interested in the answer to this problem, you can set an environmental variable:</p>\n\n<pre><code>export GRPC_DEFAULT_SSL_ROOTS_FILE_PATH=/path/to/my/cert/bundle.pem\n</code></pre>\n\n<p>Also, you can display more debug information by setting this environmental variable:</p>\n\n<pre><code>export GRPC_VERBOSITY=DEBUG\n</code></pre>\n\n<p>For the list of all env vars you can set see here: <a href=\"https://github.com/grpc/grpc/blob/master/doc/environment_variables.md\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc/blob/master/doc/environment_variables.md</a></p>\n"}], "owner": {"reputation": 61, "user_id": 10343916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52138f6467c837592c80c210dac495d3?s=128&d=identicon&r=PG&f=1", "display_name": "l33tn00b", "link": "https://stackoverflow.com/users/10343916/l33tn00b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 2, "accepted_answer_id": 52306455, "answer_count": 1, "score": 4, "last_activity_date": 1543777559, "creation_date": 1536609075, "last_edit_date": 1543777559, "question_id": 52264557, "link": "https://stackoverflow.com/questions/52264557/google-golang-sdk-use-custom-ca-bundle", "title": "Google Golang SDK Use Custom CA Bundle", "body": "<p>I am trying to pull messages from a Google Cloud Pub/Sub Subscription using the Google Cloud Client Library for Go (<a href=\"https://godoc.org/cloud.google.com/go/pubsub\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/pubsub</a>). </p>\n\n<p>I am going through an HTTP proxy that uses TLS interception, so I need the pubsub client (it appears to be using gRPC) to use a custom CA cert bundle for its request verification. How can I make this work? Also, is there a way to configure proxy support other than setting http_proxy and https_proxy? </p>\n"}, {"tags": ["go", "configuration"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1536605367, "post_id": 52263725, "comment_id": 91475415, "body": "There is no one &quot;best solution&quot;, but generally your configuration doesn&#39;t include every environment at once; the whole point of a config file is that you can fill it with different values appropriate to the environment where it&#39;s running, so that you can ship the same binary and a different config file as needed."}, {"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1536608109, "post_id": 52263725, "comment_id": 91476628, "body": "See <a href=\"https://12factor.net/config\" rel=\"nofollow noreferrer\">The 12-Factor App &quot;Config&quot; section</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": false, "score": 2, "last_activity_date": 1536607820, "creation_date": 1536607820, "answer_id": 52264307, "question_id": 52263725, "link": "https://stackoverflow.com/questions/52263725/configuration-of-database-details-based-on-environments-in-golang/52264307#52264307", "title": "Configuration of database details based on environments in golang", "body": "<p>You would not normally bake in the configuration for the runtime environment at build time. You want a built binary (or Docker image or whatever) which is generic and independent of the deployment environment. Any configuration for external resources should be supplied at runtime so as to late bind the configuration when the application starts up.</p>\n\n<p>Consider third-party components which are freely available on the internet. They are written in a <em>generic</em> fashion which makes them suitable in not just your environment, but the environments of <em>anyone</em> who downloads them.</p>\n\n<p>This approach requires that you have a mechanism to supply the configuration directives when you deploy the application into dev, test, production or similar.</p>\n\n<p>There are several mechanisms you might use to achieve this. The following list is <strong>non-exhaustive</strong>:</p>\n\n<h1>Environment variables</h1>\n\n<p>Define environment variables at the top-level of your application, and pass these in when spawning the application binary. For example, you might define the environment variable <code>DATABASE_HOSTADDR</code> and set this equal to the <code>host:port</code> of the desired database server. In your <code>main</code> method, or similar:</p>\n\n<pre><code>// Load database host address\ndbHostAddr, ok := os.LookupEnv(\"DATABASE_HOSTADDR\")\nif !ok || dbHostAddr == \"\" {\n    log.Fatal(\"DATABASE_HOSTADDR not specified\")\n}\n\n// Do something here to use the value retrieved from the env var,\n// splitting on the port separator (:) if necessary to retrieve\n// the hostname and port number as separate values.\n</code></pre>\n\n<h1>Command line arguments (or flags)</h1>\n\n<p>You might use a library to parse the arguments supplied to the binary when it starts. So, for example, if your application has the name <code>somebinary</code>, you would invoke it using:</p>\n\n<pre><code>./somebinary dbserver:12345\n</code></pre>\n\n<p>or, if you use command line flags (as provided by Go's built-in <a href=\"http://godoc.org/pkg/flag\" rel=\"nofollow noreferrer\"><code>flag</code></a> library, among others):</p>\n\n<pre><code>./somebinary --db dbserver:12345\n</code></pre>\n\n<p>Example using flags:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"log\"\n)\n\nvar dbHostAddr string\n\nfunc main() {\n    flag.Parse()\n\n    if dbHostAddr == \"\" {\n        log.Fatalf(\"--db flag must be specified\")\n    }\n\n    // Do something with dbHostAddr\n}\n\nfunc init() {\n    // Bind desired flags\n    flag.StringVar(&amp;dbHostAddr, \"db\", \"\", \"Database connection path, in format host:port\")\n}\n</code></pre>\n\n<p>Example using <code>os.Args</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    if len(os.Args) &lt; 2 {\n        log.Fatalf(\"database host address not supplied\")\n    }\n\n    dbHostAddr := os.Args[1]\n\n    // Do something with dbHostAddr\n}\n</code></pre>\n\n<h1>External configuration files (JSON/TOML/YAML)</h1>\n\n<p>There is support in Go for parsing config files in a variety of formats, and if not included, there are libraries for the most popular. If your configuration requirements are more complex, consider writing a configuration file and deploying this alongside the application.</p>\n\n<p>Configuration management solutions, such as Ansible or Salt, will help here in defining your deployment process and infrastructure configuration in code and can potentially generate your configuration for you. If your configuration is simple and static, you might store it directly into source control and package it as build artifacts in your build process.</p>\n"}], "owner": {"reputation": 21, "user_id": 10226225, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SRffamlChTI/AAAAAAAAAAI/AAAAAAAAAAA/mXD7DvkmtAc/photo.jpg?sz=128", "display_name": "Dev", "link": "https://stackoverflow.com/users/10226225/dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 0, "closed_date": 1536653935, "answer_count": 1, "score": -1, "last_activity_date": 1536648767, "creation_date": 1536605138, "last_edit_date": 1536648767, "question_id": 52263725, "link": "https://stackoverflow.com/questions/52263725/configuration-of-database-details-based-on-environments-in-golang", "closed_reason": "Opinion-based", "title": "Configuration of database details based on environments in golang", "body": "<p>Requirement:\nConfigure database connections based on environments (like QA, PROD) in golang.\nFor eg:</p>\n\n<pre><code>{\"QA\":{\n    \"host\":\"124.44.2.2\",\n    \"port\":\"1234\"\n    },\n\"PROD\":{\n    \"host\":\"125.65.23.64\",\n    \"port\":\"1234\"\n    }\n}\n</code></pre>\n\n<p>I can configure it in JSON / YAML, etc, but problem is when we build go, build file does not contain non go files.  Hence, when deploying builds into different instances, it loses configuration files.</p>\n\n<p>Another solution, I tried setting config in go itself (by setting constants).  And then reading constants based on environment name passed as parameters.  But then in docker, parameters are passed after build file name, whereas in go , it can read parameters only if passed before build file.</p>\n\n<p>Can someone recommend best solution?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 6, "creation_date": 1536596410, "post_id": 52261720, "comment_id": 91471345, "body": "There is an in-depth blog post on the official golang blog about the topic of slices <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">here</a>, which might interest you."}], "answers": [{"comments": [{"owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "edited": false, "score": 0, "creation_date": 1536682442, "post_id": 52261882, "comment_id": 91508336, "body": "Thanks for the answer, but I understand this part. The blogpost Leon refers to has the answer to my question"}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 5, "last_activity_date": 1536596453, "creation_date": 1536596453, "answer_id": 52261882, "question_id": 52261720, "link": "https://stackoverflow.com/questions/52261720/slicing-a-sliced-reference/52261882#52261882", "title": "Slicing a sliced reference", "body": "<p>A slice is basically a pointer to memory with some additional information:</p>\n\n<p>1) the number of elements currently used and</p>\n\n<p>2) the capacity, i.e. the remaining length it can occupy.</p>\n\n<p>At the start we create a slice with 6 integers, this makes go create the underlying int array with a total size of 6 as well.</p>\n\n<pre><code>here is your memory locations with addresses (content does not matter here)\n *  *  *  *  *  *\n[0][1][2][3][4][5]\n ^\n s points to the start of the memory\nlen(s) = 6\ncap(s) = 6\n</code></pre>\n\n<p>Next we say: make this slice's <code>len</code> be 0, this is the <code>s = s[:0]</code> which takes a sub-slice of <code>s</code> at position 0 with length 0. Note that <code>s[0:0]</code> is the same, you can omit the first 0.</p>\n\n<pre><code>[0][1][2][3][4][5]\n ^\n s still points to the start of the memory\nlen(s) = 0\ncap(s) = 6\n</code></pre>\n\n<p>Since the capacity is still the same, we might as well make the length 4 by saying <code>s = s[:4]</code>.</p>\n\n<pre><code> *  *  *  *\n[0][1][2][3][4][5]\n ^\n s still points to the start of the memory\nlen(s) = 4\ncap(s) = 6\n</code></pre>\n\n<p>Then we take a sub-slice that does not start at the beginning of the memory by doing <code>s = s[2:]</code>.</p>\n\n<pre><code>       *  *\n[0][1][2][3][4][5]\n       ^\n       s now points to the original address plus two!\nlen(s) = 2\ncap(s) = 4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "is_accepted": true, "score": 0, "last_activity_date": 1536682312, "last_edit_date": 1592644375, "creation_date": 1536682312, "answer_id": 52280131, "question_id": 52261720, "link": "https://stackoverflow.com/questions/52261720/slicing-a-sliced-reference/52280131#52280131", "title": "Slicing a sliced reference", "body": "<p><em>Leon</em> addressed me to the Go's blog post, where they address exactly my question.</p>\n<p>This is the snippet which helped me better understanding this concept:</p>\n<blockquote>\n<p>A slice is a descriptor of an array segment. It consists of a pointer to the array, the length of the segment, and its capacity (the maximum length of the segment).</p>\n<p><em>A slice cannot be grown beyond its capacity.</em> Attempting to do so will cause a runtime panic, just as when indexing outside the bounds of a slice or array. <strong>Similarly, slices cannot be re-sliced below zero to access earlier elements in the array.</strong></p>\n</blockquote>\n<p>Slices can be extended if the array has more elements in it, but it can not access elements below 0 of the slice. <em>It's a <strong>window</strong> to the underlaying array</em>. The <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog post</a> explains it in more depth.</p>\n"}], "owner": {"reputation": 7592, "user_id": 840582, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/R97cw.png?s=128&g=1", "display_name": "Chen A.", "link": "https://stackoverflow.com/users/840582/chen-a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 52280131, "answer_count": 2, "score": 1, "last_activity_date": 1536682312, "creation_date": 1536595785, "last_edit_date": 1536597541, "question_id": 52261720, "link": "https://stackoverflow.com/questions/52261720/slicing-a-sliced-reference", "title": "Slicing a sliced reference", "body": "<p>I'm taking the tour on Golang site, and I'm trying to digest one of the examples. It is unclear how it works:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := []int{2, 3, 5, 7, 11, 13}\n    printSlice(s)\n\n    // Slice the slice to give it zero length.\n    s = s[:0]\n    printSlice(s)\n\n    // Extend its length.\n    s = s[:4]\n    printSlice(s)\n\n    // Drop its first two values.\n    s = s[2:]\n    printSlice(s)\n}\n\nfunc printSlice(s []int) {\n    fmt.Printf(\"len=%d cap=%d %v\\n\", len(s), cap(s), s)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>len=6 cap=6 [2 3 5 7 11 13]\nlen=0 cap=6 []\nlen=4 cap=6 [2 3 5 7]\nlen=2 cap=4 [5 7]\n</code></pre>\n\n<p>After the first slice, <code>s = s[:0]</code> the slice length is 0. Then there is another slicing of <code>s = s[:4]</code>. Although the length is 0, this seems to work. <em>But how this happens</em>? Shouldn't the underlaying array be in accessible from <code>s</code>? </p>\n\n<p>What confuses me more is, the next time we slice it, <code>s = s[2:]</code> we slice the old value of s (which is 4 elements) and not the <em>original array</em>.</p>\n\n<p>Can someone shed some lights what is the difference between the two cases?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1536596659, "post_id": 52261692, "comment_id": 91471471, "body": "Just call <code>go build</code>. You&#39;re probably not actually updating your binary calling build the way you are. Also please post the actual output you receive."}, {"owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 1, "creation_date": 1536600166, "post_id": 52261692, "comment_id": 91473078, "body": "If you&#39;re going to use run, you have to include all source files like <code>go run hello.go consts.go</code>. For build the project, just do <code>go build</code>"}], "answers": [{"tags": [], "owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "is_accepted": false, "score": 0, "last_activity_date": 1536673369, "creation_date": 1536673369, "answer_id": 52277373, "question_id": 52261692, "link": "https://stackoverflow.com/questions/52261692/function-call-difference-between-go-build-and-go-run/52277373#52277373", "title": "function call difference between go build and go run", "body": "<p>go run works because go run works based on file names, but go build works based on package names. </p>\n\n<p>also </p>\n\n<pre><code>go help build says:\n</code></pre>\n\n<blockquote>\n  <p>When compiling multiple packages or a single non-main package, build\n  compiles the packages but discards the resulting object, serving only\n  as a check that the packages can be built.</p>\n</blockquote>\n\n<p>to my understanding this means you can not have multiple files in the main package and then get working executable by using go build</p>\n"}], "owner": {"reputation": 7041, "user_id": 236555, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/eUcRO.jpg?s=128&g=1", "display_name": "Rakesh K", "link": "https://stackoverflow.com/users/236555/rakesh-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 248, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1536673369, "creation_date": 1536595695, "question_id": 52261692, "link": "https://stackoverflow.com/questions/52261692/function-call-difference-between-go-build-and-go-run", "title": "function call difference between go build and go run", "body": "<p>I'm new to Golang and I'm trying out a few examples as part of my learning. I have 2 Go source files - hello.go and consts.go in my example. consts.go contains some constants which are used by the functions defined in hello.go. When I build both the source files like so: \n<code>go build consts.go hello.go</code> and run the output <code>./hello</code>\nthe function arrayDemo() is not called at all.</p>\n\n<p>However, when I just run the file hello.go using <code>go run hello.go</code>, the function arrayDemo() is called. </p>\n\n<p>What is the difference in both the approaches that's causing the function not to be called when building?</p>\n\n<p>Here's the code for hello.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    fmt.Printf(\"Speed is %f\\n\", computeSpeed(54.3, 3.4))\n    fmt.Printf(\"%d\\n\", arrayDemo())\n}\n\nfunc arrayDemo() int32 {\n    fmt.Println(\"in arrayDemo\")\n    return 5\n}\n</code></pre>\n\n<p>Code for consts.go:</p>\n\n<pre><code>package main\n\n// Speed speed of a vehicle\ntype Speed float32\n\nfunc computeSpeed(dist float32, t float32) Speed {\n    return Speed(dist / t)\n}\n</code></pre>\n"}, {"tags": ["go", "aws-lambda"], "answers": [{"tags": [], "owner": {"reputation": 3467, "user_id": 3393308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9a3f30f7c191e8d556c70c951fe3d9af?s=128&d=identicon&r=PG", "display_name": "yorodm", "link": "https://stackoverflow.com/users/3393308/yorodm"}, "is_accepted": false, "score": 2, "last_activity_date": 1536598318, "creation_date": 1536598318, "answer_id": 52262287, "question_id": 52261661, "link": "https://stackoverflow.com/questions/52261661/what-is-the-method-signature-of-a-lambda-that-receives-lambda-invokeinput/52262287#52262287", "title": "What is the method signature of a lambda that receives lambda InvokeInput?", "body": "<p>From AWS docuentation:<a href=\"https://docs.aws.amazon.com/lambda/latest/dg/go-programming-model-handler-types.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/lambda/latest/dg/go-programming-model-handler-types.html</a></p>\n\n<blockquote>\n  <p>The following lists valid handler signatures. TIn and TOut represent types compatible with the encoding/json standard library. For more information, see func Unmarshal to learn how these types are deserialized.</p>\n</blockquote>\n\n<pre><code>func ()\nfunc () error\nfunc (TIn), error\nfunc () (TOut, error)\nfunc (context.Context) error\nfunc (context.Context, TIn) error\nfunc (context.Context) (TOut, error)\nfunc (context.Context, TIn) (TOut, error)\n</code></pre>\n\n<p>So it depends on what is in your payload. AWS will try to deserialize your data and match it with the <code>TIn</code> parameter in your function. There are already some types that represent AWS Event types, but in your case you should write your own struct. Check the link for some examples.</p>\n"}], "owner": {"reputation": 416, "user_id": 4381225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/aec91934b189d3d6738211b322cf2acb?s=128&d=identicon&r=PG&f=1", "display_name": "mycellius", "link": "https://stackoverflow.com/users/4381225/mycellius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1536598318, "creation_date": 1536595576, "question_id": 52261661, "link": "https://stackoverflow.com/questions/52261661/what-is-the-method-signature-of-a-lambda-that-receives-lambda-invokeinput", "title": "What is the method signature of a lambda that receives lambda InvokeInput?", "body": "<p>I'd like to get my two lambdas to communicate with each other. Lambda A uses InvokeInput, passing Payload as used in the example here:</p>\n\n<p><a href=\"https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/go/example_code/lambda/aws-go-sdk-lambda-example-run-function.go\" rel=\"nofollow noreferrer\">https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/go/example_code/lambda/aws-go-sdk-lambda-example-run-function.go</a></p>\n\n<p>However, the example doesn't show the receiving end i.e Lambda B. I'm trying to access <code>Payload</code>, so I've tried a handler with the method signatures:</p>\n\n<pre><code>func Handler(ctx context.Context, lambdaInput messages.InvokeRequest) (api.Response, error)\n</code></pre>\n\n<p>as well as </p>\n\n<pre><code>func Handler(ctx context.Context, lambdaInput lambda.InvokeInput) (api.Response, error)\n</code></pre>\n\n<p>When calling <code>lambdaInput.Payload</code> on the former it returns <code>[]</code> despite what's being sent as a payload.</p>\n\n<p>I am unable to find the documentation on this, does anyone know the proper signature that I should be using?</p>\n"}, {"tags": ["go", "graphql", "graphql-go"], "answers": [{"comments": [{"owner": {"reputation": 791, "user_id": 1441597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/129c9d44240bafaa6ccf94fb89072c75?s=128&d=identicon&r=PG", "display_name": "SebScoFr", "link": "https://stackoverflow.com/users/1441597/sebscofr"}, "edited": false, "score": 0, "creation_date": 1536611647, "post_id": 52264948, "comment_id": 91478188, "body": "If you look closely at my code, this is exactly what I have already. I haven\u2019t created two separate input type but just one with everything in it but ultimately it\u2019s the same thing. Also I haven\u2019t mentioned it but I have obviously added the input object to the mutation type."}, {"owner": {"reputation": 5023, "user_id": 3849167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DKwJ6.jpg?s=128&g=1", "display_name": "Herku", "link": "https://stackoverflow.com/users/3849167/herku"}, "reply_to_user": {"reputation": 791, "user_id": 1441597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/129c9d44240bafaa6ccf94fb89072c75?s=128&d=identicon&r=PG", "display_name": "SebScoFr", "link": "https://stackoverflow.com/users/1441597/sebscofr"}, "edited": false, "score": 0, "creation_date": 1536611801, "post_id": 52264948, "comment_id": 91478251, "body": "You are missing for example the name property in the nested input type. Not sure of that is relevant."}, {"owner": {"reputation": 791, "user_id": 1441597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/129c9d44240bafaa6ccf94fb89072c75?s=128&d=identicon&r=PG", "display_name": "SebScoFr", "link": "https://stackoverflow.com/users/1441597/sebscofr"}, "edited": false, "score": 0, "creation_date": 1536612381, "post_id": 52264948, "comment_id": 91478504, "body": "I&#39;ve just tested it and yes, I just needed to add the name property! Thanks :) I just wish the error message could have been more explicit haha"}, {"owner": {"reputation": 5023, "user_id": 3849167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DKwJ6.jpg?s=128&g=1", "display_name": "Herku", "link": "https://stackoverflow.com/users/3849167/herku"}, "reply_to_user": {"reputation": 791, "user_id": 1441597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/129c9d44240bafaa6ccf94fb89072c75?s=128&d=identicon&r=PG", "display_name": "SebScoFr", "link": "https://stackoverflow.com/users/1441597/sebscofr"}, "edited": false, "score": 1, "creation_date": 1536612463, "post_id": 52264948, "comment_id": 91478542, "body": "I would suggest to group type definitions in the way I did so that those things are easier to catch :)"}], "tags": [], "owner": {"reputation": 5023, "user_id": 3849167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DKwJ6.jpg?s=128&g=1", "display_name": "Herku", "link": "https://stackoverflow.com/users/3849167/herku"}, "is_accepted": true, "score": 1, "last_activity_date": 1536610895, "creation_date": 1536610895, "answer_id": 52264948, "question_id": 52261045, "link": "https://stackoverflow.com/questions/52261045/mutation-arguments-as-object/52264948#52264948", "title": "Mutation arguments as object", "body": "<p>This are my first ever lines of Go but I will try to convey what I think the problem is.</p>\n\n<p>First lets talk about the structure you want to be going for. I will use SDL here:</p>\n\n<pre><code>type Mutation {\n  createUser(user: CreateUser!): Boolean! # Maybe return user type here?\n}\n\ninput CreateUser {\n  name: CreateUserName!\n  email: String!\n}\n\ninput CreateUserName {\n  first: String!\n  last: String!\n}\n</code></pre>\n\n<p>Okay now that we know that we need two input types lets get started!</p>\n\n<pre><code>var CreateUserName = graphql.NewInputObject(graphql.InputObjectConfig{\n    Name: \"CreateUserName\",\n    Fields: graphql.InputObjectConfigFieldMap{\n        \"first\": &amp;graphql.InputObjectFieldConfig{\n            Type: graphql.NewNonNull(graphql.String),\n        },\n        \"last\": &amp;graphql.InputObjectFieldConfig{\n            Type: graphql.NewNonNull(graphql.String),\n        },\n    },\n})\n\nvar CreateUser = graphql.NewInputObject(graphql.InputObjectConfig{\n    Name: \"CreateUser\",\n    Fields: graphql.InputObjectConfigFieldMap{\n        \"name\": &amp;graphql.InputObjectFieldConfig{\n            Type: graphql.NewNonNull(CreateUserName),\n        },\n        \"email\": &amp;graphql.InputObjectFieldConfig{\n            Type: graphql.NewNonNull(graphql.String),\n        },\n    },\n})\n</code></pre>\n\n<p>Now all that should be left is adding the mutation field to your mutation object type.</p>\n"}], "owner": {"reputation": 791, "user_id": 1441597, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/129c9d44240bafaa6ccf94fb89072c75?s=128&d=identicon&r=PG", "display_name": "SebScoFr", "link": "https://stackoverflow.com/users/1441597/sebscofr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 453, "favorite_count": 0, "accepted_answer_id": 52264948, "answer_count": 1, "score": 0, "last_activity_date": 1536612453, "creation_date": 1536593145, "last_edit_date": 1536612453, "question_id": 52261045, "link": "https://stackoverflow.com/questions/52261045/mutation-arguments-as-object", "title": "Mutation arguments as object", "body": "<p>I'm using the <a href=\"https://github.com/graphql-go/graphql\" rel=\"nofollow noreferrer\">Go implemenatation of GraphQL</a>.</p>\n\n<p>How would you configure a mutation so that it can receive arguments with more than 1 level?\nFor exemple, here is the list of arguments I would like to pass to a mutation CreateUser:</p>\n\n<pre><code>mutation createUser($user: CreateUser!) {\n  createUser(input: $user)\n}\n\n{\n  \"user\": {\n    \"name\": {\n      \"first\": \"John\",\n      \"last\": \"Doe\"\n    },\n    \"email\": \"john@doe.com\"\n  }\n}\n</code></pre>\n\n<p>(Notice that I dont want to use <strong>firstname</strong> and <strong>lastname</strong> but a <strong>name</strong> object instead)</p>\n\n<p>And this is my (unsuccessful) attempt so far:</p>\n\n<pre><code>var CreateUserInput = graphql.FieldConfigArgument{\n    \"input\": &amp;graphql.ArgumentConfig{\n        Description: \"Input for creating a new user\",\n        Type: graphql.NewNonNull(graphql.NewInputObject(graphql.InputObjectConfig{\n            Name: \"CreateUser\",\n            Fields: graphql.InputObjectConfigFieldMap{\n                \"name\": &amp;graphql.InputObjectFieldConfig{\n                    Type: graphql.NewNonNull(graphql.NewInputObject(graphql.InputObjectConfig{\n                        Fields: graphql.InputObjectConfigFieldMap{\n                            \"first\": &amp;graphql.InputObjectFieldConfig{\n                                Type: graphql.NewNonNull(graphql.String),\n                            },\n                            \"last\": &amp;graphql.InputObjectFieldConfig{\n                                Type: graphql.NewNonNull(graphql.String),\n                            },\n                        },\n                    })),\n                },\n                \"email\": &amp;graphql.InputObjectFieldConfig{\n                    Type: graphql.NewNonNull(graphql.String),\n                },\n            },\n        })),\n    },\n}\n</code></pre>\n\n<p>Apparently the subfields <strong>first</strong> and <strong>last</strong> are not recognized as this is what I get when I run this mutation:</p>\n\n<pre><code>{\n  \"data\": null,\n  \"errors\": [\n    {\n      \"message\": \"Variable \\\"$user\\\" got invalid value {\\\"email\\\":\\\"john@doe.com\\\",\\\"name\\\":{\\\"first\\\":\\\"john\\\",\\\"last\\\":\\\"doe\\\"}}.\\nIn field \\\"name\\\": In field \\\"first\\\": Unknown field.\\nIn field \\\"name\\\": In field \\\"last\\\": Unknown field.\",\n      \"locations\": [\n        {\n          \"line\": 1,\n          \"column\": 21\n        }\n      ]\n    }\n  ]\n}\n</code></pre>\n\n<p>Is this even possible?</p>\n\n<p>EDIT: See comments in the accepted answer for the solution.</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1536593087, "post_id": 52261006, "comment_id": 91469588, "body": "You declared <code>Write()</code> to have pointer receiver, so use a pointer value: <code>boo := &amp;CountWriter{0, os.Stdout}</code>. See: <a href=\"https://stackoverflow.com/questions/40823315/go-x-does-not-implement-y-method-has-a-pointer-receiver/40824044#40824044\">Go, X does not implement Y (\u2026 method has a pointer receiver)</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1536593228, "post_id": 52261006, "comment_id": 91469655, "body": "Indeed, as icza points out, it&#39;s not that you can&#39;t satisfy the interface with a pointer receiver, it&#39;s that only a <code>*CounterWriter</code> satisfies the interface (because of the pointer receiver) while a <code>CounterWriter</code> does not."}, {"owner": {"reputation": 1029, "user_id": 2121526, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Ot3q.jpg?s=128&g=1", "display_name": "DarkerIvy", "link": "https://stackoverflow.com/users/2121526/darkerivy"}, "edited": false, "score": 0, "creation_date": 1536593861, "post_id": 52261006, "comment_id": 91470010, "body": "Very nice! I misunderstood what was causing the error (not the satisfaction)."}], "answers": [{"tags": [], "owner": {"reputation": 27690, "user_id": 362589, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/125a471032cdef6e8de28ff6d54c7324?s=128&d=identicon&r=PG", "display_name": "Dani", "link": "https://stackoverflow.com/users/362589/dani"}, "is_accepted": true, "score": 0, "last_activity_date": 1536593238, "creation_date": 1536593238, "answer_id": 52261070, "question_id": 52261006, "link": "https://stackoverflow.com/questions/52261006/make-persistent-changes-to-struct-fields-and-satisfy-the-writer-interface/52261070#52261070", "title": "Make persistent changes to struct fields *and* satisfy the Writer interface?", "body": "<p><code>boo</code> Doesn\u2019t implement the interface because Write takes <code>*CountWriter</code> and not a <code>CountWriter</code><br>\nHowever, <code>&amp;boo</code> will be accepted by Write, so you have to pass it instead.</p>\n"}], "owner": {"reputation": 1029, "user_id": 2121526, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Ot3q.jpg?s=128&g=1", "display_name": "DarkerIvy", "link": "https://stackoverflow.com/users/2121526/darkerivy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "closed_date": 1536593214, "accepted_answer_id": 52261070, "answer_count": 1, "score": -1, "last_activity_date": 1536593238, "creation_date": 1536592971, "question_id": 52261006, "link": "https://stackoverflow.com/questions/52261006/make-persistent-changes-to-struct-fields-and-satisfy-the-writer-interface", "closed_reason": "Duplicate", "title": "Make persistent changes to struct fields *and* satisfy the Writer interface?", "body": "<p>In order to actually change <code>struct</code> fields in a method, you need a pointer-type receiver. <a href=\"https://stackoverflow.com/questions/16610857/increment-struct-variable-in-go\">I understand that.</a></p>\n\n<p>Why can't I satisfy the <code>io.Writer</code> interface with a pointer receiver so that I can make changes to struct fields? Is there an idiomatic way to do this? </p>\n\n<pre><code>// CountWriter is a type representing a writer that also counts\ntype CountWriter struct {\n    Count      int\n    Output     io.Writer\n}\n\nfunc (cw *CountWriter) Write(p []byte) (int, error) {\n    cw.Count++\n    return cw.Output.Write(p)\n}\n\nfunc takeAWriter(w io.Writer) {\n    w.Write([]byte(\"Testing\"))\n}\n\nfunc main() {\n    boo := CountWriter{0, os.Stdout}\n    boo.Write([]byte(\"Hello\\n\"))\n    fmt.Printf(\"Count is incremented: %d\", boo.Count)\n    takeAWriter(boo)\n}\n</code></pre>\n\n<p>The code yields this error:</p>\n\n<pre><code>prog.go:27:13: cannot use boo (type CountWriter) as type io.Writer in argument to takeAWriter:\n    CountWriter does not implement io.Writer (Write method has pointer receiver)\n</code></pre>\n\n<p>It seems you can <em>either</em> satisfy the <code>Writer</code> interface <em>or</em> have your changes made to the actual <code>struct</code>. If I change the Write method to a value receiver (<code>func (cw CountWriter) Write...</code>), I can avoid the error but the value does not increment. :(</p>\n\n<p><a href=\"https://play.golang.org/p/pEUwwTj0zrb\" rel=\"nofollow noreferrer\" title=\"Go Playground\">https://play.golang.org/p/pEUwwTj0zrb</a></p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "edited": false, "score": 0, "creation_date": 1536591924, "post_id": 52260298, "comment_id": 91468859, "body": "<code>urfletch.Client</code> returns an <a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"nofollow noreferrer\"><code>http.Client</code></a>, so you should be able to use <a href=\"https://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow noreferrer\"><code>http.NewRequest</code></a> to create your requests, add headers as you would in any other go application and then execute the request using the <a href=\"https://golang.org/pkg/net/http/#Client.Do\" rel=\"nofollow noreferrer\"><code>Do</code></a> method of the client returned by <code>urlfetch.Client</code>. How to set headers on the request object is answered in <a href=\"https://stackoverflow.com/questions/12864302/how-to-set-headers-in-http-get-request\">this question</a>."}], "answers": [{"tags": [], "owner": {"reputation": 77, "user_id": 5763907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69cd0adad5797be5704f8d8d98394b32?s=128&d=identicon&r=PG&f=1", "display_name": "Will K.", "link": "https://stackoverflow.com/users/5763907/will-k"}, "is_accepted": true, "score": 3, "last_activity_date": 1536593259, "last_edit_date": 1536593259, "creation_date": 1536592559, "answer_id": 52260890, "question_id": 52260298, "link": "https://stackoverflow.com/questions/52260298/correct-way-to-add-headers-using-urlfetch-on-google-app-engine-with-golang-and-s/52260890#52260890", "title": "Correct way to add headers using urlfetch on Google App Engine with Golang and Standard Env", "body": "<p>Here is a working solution that uses <a href=\"https://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow noreferrer\"><code>http.NewRequest</code></a> to add in a header.</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n    ctx := appengine.NewContext(r)\n    client := urlfetch.Client(ctx)\n\n    req, err := http.NewRequest(\"GET\", \"https://www.google.com/\", nil)\n    req.Header.Add(\"CUSTOM-HEADER\", \"VALUE\")\n    if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n    }\n\n    resp, err := client.Do(req)\n    if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n    }\n\n    fmt.Fprintf(w, \"HTTP GET returned status %v\", resp.Status)\n}\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 5763907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69cd0adad5797be5704f8d8d98394b32?s=128&d=identicon&r=PG&f=1", "display_name": "Will K.", "link": "https://stackoverflow.com/users/5763907/will-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "accepted_answer_id": 52260890, "answer_count": 1, "score": 3, "last_activity_date": 1536593259, "creation_date": 1536590564, "question_id": 52260298, "link": "https://stackoverflow.com/questions/52260298/correct-way-to-add-headers-using-urlfetch-on-google-app-engine-with-golang-and-s", "title": "Correct way to add headers using urlfetch on Google App Engine with Golang and Standard Env", "body": "<p>I am newer to Go and Google App Engine and I'm trying to build a simple middleware API that queries an external API.</p>\n\n<p>Because I am using the standard env on Google App Engine I have to use urlfetch to create a http request. With Google's documentation, I can't figure out how to add in headers to my GET request - though the documentation clearly states I can add in headers.</p>\n\n<p><a href=\"https://cloud.google.com/appengine/docs/standard/go/outbound-requests\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/go/outbound-requests</a></p>\n\n<p>This is the code I am trying to modify to include a custom request header:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net/http\"\n\n    \"google.golang.org/appengine\"\n    \"google.golang.org/appengine/urlfetch\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n        ctx := appengine.NewContext(r)\n        client := urlfetch.Client(ctx)\n        resp, err := client.Get(\"https://www.google.com/\")\n        if err != nil {\n                http.Error(w, err.Error(), http.StatusInternalServerError)\n                return\n        }\n        fmt.Fprintf(w, \"HTTP GET returned status %v\", resp.Status)\n}\n</code></pre>\n\n<p>Any help would be much appreciated.</p>\n"}, {"tags": ["database", "go", "sqlx"], "comments": [{"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1536589633, "post_id": 52259193, "comment_id": 91467396, "body": "could you share with us the table&#39;s structure with indexes you have?"}, {"owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1536594323, "post_id": 52259193, "comment_id": 91470292, "body": "@kabanek updated."}, {"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536599987, "post_id": 52259193, "comment_id": 91472981, "body": "are there more than one server making that request? to the same table?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536603715, "post_id": 52259193, "comment_id": 91474620, "body": "If you execute the exact same SQL statement (by copy and paste) at the normal SQL command prompt, does it take the same time?"}, {"owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536657657, "post_id": 52259193, "comment_id": 91492484, "body": "@Flimzy nope, literally less than a second"}, {"owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "reply_to_user": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1536658109, "post_id": 52259193, "comment_id": 91492765, "body": "@whitespace nope, each server has &quot;own&quot; server with db, consequently, to the table too."}], "owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1536603738, "creation_date": 1536587110, "last_edit_date": 1536603738, "question_id": 52259193, "link": "https://stackoverflow.com/questions/52259193/why-is-select-from-sqlx-lib-executing-so-long", "title": "Why is select from sqlx lib executing so long?", "body": "<p>I've got a function which is doing simple sqlx.Select(...):</p>\n\n<pre><code>    func filteredEntities(ex sqlx.Ext, baseStmt string, res interface{}, f entities.UserProjectTimeFilter) error {\n        finalStmt, args, err := filteredStatement(baseStmt, f)\n        if err != nil {\n            return err\n        }\n\n        err = sqlx.Select(ex, res, finalStmt, args...)\n        return errors.Wrap(err, \"db query failed\")\n}\n</code></pre>\n\n<p>Most of queries are going well (10-20ms), but one of them, such as:</p>\n\n<pre><code>\"\\n\\tSELECT * FROM Productivity\\n\\t WHERE user_id IN (?) AND (tracker_id, project_id) IN ((?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?,?),(?...\n</code></pre>\n\n<p>The query was taken from logs and not formatted. It is executing more than 10 seconds (sometimes even more than 20). However, from a dump of the database, it is executing less than 1 second. The selection has less than 100 rows.  A query even doesn't have \"joins\" and etc. Just simple \"select\" with conditions.</p>\n\n<p>Which might be slower? All time was measured by default time.Now() and time.Since().</p>\n\n<p>The table has these columns: </p>\n\n<pre><code>+---------+-------------+---------+-------------+----------+------------+------------+------------+--------+\n| id      | planning_id | user_id | activity_id | duration | project_id | tracker_id | created_at | useful |\n+---------+-------------+---------+-------------+----------+------------+------------+------------+--------+\n</code></pre>\n"}, {"tags": ["string", "go", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1536583886, "post_id": 52258192, "comment_id": 91463628, "body": "What have you tried? What problems have you encountered? Please post your attempt. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 15, "user_id": 9679609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2AgO.jpg?s=128&g=1", "display_name": "Fantone", "link": "https://stackoverflow.com/users/9679609/fantone"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536584492, "post_id": 52258192, "comment_id": 91464000, "body": "I have tried to append the *net vars to the slice, but obviously it didn&#39;t worked, since it&#39;s not a standard type the one used for pkt.Nbytes, pkt.IPAddr, pkt.Seq, pkt.Rtt I haven&#39;t found anything useful on internet. What I&#39;d need is to append to the slice the value as it is of those vars"}], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 0, "last_activity_date": 1536584429, "creation_date": 1536584429, "answer_id": 52258388, "question_id": 52258192, "link": "https://stackoverflow.com/questions/52258192/how-can-i-convert-and-append-to-a-slice-of-strings-in-golang-a-net-type-variable/52258388#52258388", "title": "How can I convert and append to a slice of strings in Golang a net type variable from go-ping repository?", "body": "<p>Use <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\">fmt.Sprintf</a> with your example code:</p>\n\n<pre><code>var s []string\ns = append(s, fmt.Sprintf(\"%d\", pkt.Nbytes)\ns = append(s, fmt.Sprintf(\"%s\", pkt.IPAddr)\ns = append(s, fmt.Sprintf(\"%d\", pkt.Seq)\ns = append(s, fmt.Sprintf(\"%v\", pkt.Rtt)\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 9679609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/a2AgO.jpg?s=128&g=1", "display_name": "Fantone", "link": "https://stackoverflow.com/users/9679609/fantone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 52258388, "answer_count": 1, "score": 0, "last_activity_date": 1536584429, "creation_date": 1536583714, "last_edit_date": 1536584366, "question_id": 52258192, "link": "https://stackoverflow.com/questions/52258192/how-can-i-convert-and-append-to-a-slice-of-strings-in-golang-a-net-type-variable", "title": "How can I convert and append to a slice of strings in Golang a net type variable from go-ping repository?", "body": "<p>This is the entire code, not much different from the one you can find on the git repo page.</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"github.com/go-ping\"\n    \"time\"\n)\n\nvar stats = [][]string{nil}\n\nfunc pinging(domain string, interval int, unit string, exit int) {\n\ncurrent_time:= time.Now().Local()\ncurrent_time.Format(\"02-01-2000\")\n\nswitch unit {\n\ncase \"ms\":\n    interval *= 1\ncase \"sec\":\n    interval *= 1000\ncase \"min\":\n    interval *= 6000\n\n}\n\npinger, err := ping.NewPinger(domain)\nif err != nil {\n    panic(err)\n}\n\n// interval between ping\npinger.Interval=time.Millisecond*time.Duration(interval)\n\n//number of total pings\npinger.Count=exit\n\npinger.OnRecv = func(pkt *ping.Packet) {\n    fmt.Printf(\"%d bytes from %s: icmp_seq=%d time=%v\\n\",\n        pkt.Nbytes, pkt.IPAddr, pkt.Seq, pkt.Rtt)\n}\npinger.OnFinish = func(stats *ping.Statistics) {\n    fmt.Printf(\"\\n--- %s ping statistics ---\\n\", stats.Addr)\n    fmt.Printf(\"%d packets transmitted, %d packets received, %v%% packet loss\\n\",\n        stats.PacketsSent, stats.PacketsRecv, stats.PacketLoss)\n    fmt.Printf(\"round-trip min/avg/max/stddev = %v/%v/%v/%v\\n\",\n        stats.MinRtt, stats.AvgRtt, stats.MaxRtt, stats.StdDevRtt)\n}\n\nfmt.Printf(\"PING %s (%s):\\n\", pinger.Addr(), pinger.IPAddr())\npinger.Run()\n</code></pre>\n\n<p>}</p>\n\n<p>I need to convert and append to a slice of string these variables  pkt.Nbytes, pkt.IPAddr, pkt.Seq, pkt.Rtt, which are type *net from this repo <a href=\"https://github.com/sparrc/go-ping\" rel=\"nofollow noreferrer\">https://github.com/sparrc/go-ping</a> .</p>\n\n<p>I need to do so because after that I'll print everything to a .csv\nHow could I do that?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536583952, "post_id": 52258176, "comment_id": 91463663, "body": "To summarize, your question is: How to unmarshal <code>{&quot;Id&quot;:{&quot;Value&quot;:...}}</code> into your provided struct? Is that it?"}, {"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536584054, "post_id": 52258176, "comment_id": 91463721, "body": "@Flimzy <code>{&quot;Id&quot;:{&quot;Value&quot;:...}}</code> and the value of the key after - f.e. <code>&quot;String_ &quot;</code> or  <code>&quot;Long&quot;</code> :) It&#39;s double nested. So more like unmarshaling <code>{&quot;Id&quot;:{&quot;Value&quot;:{&quot;String_&quot;: &lt;Value&gt;}}</code>, as an example."}], "answers": [{"comments": [{"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 0, "creation_date": 1536585799, "post_id": 52258455, "comment_id": 91464911, "body": "Trying it out -- however for example at <code>result.ID.Long</code> I get <code>Undefined</code>  since the <code>val</code> struct doesn&#39;t have it -- I see where you&#39;re going with this and trying to work with it, but perhaps you can elaborate? Cheers.."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 0, "creation_date": 1536586396, "post_id": 52258455, "comment_id": 91465330, "body": "I&#39;m not sure what you mean... where are you getting  &quot;Undefined&quot;?  And the <code>val</code> struct does have a <code>Long</code> field..."}, {"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 0, "creation_date": 1536586547, "post_id": 52258455, "comment_id": 91465437, "body": "Running it throws: <code>\\main.go:107:18: result.ID undefined (type map[string]struct...</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 0, "creation_date": 1536586629, "post_id": 52258455, "comment_id": 91465493, "body": "Oh I see. I&#39;ve corrected the code... (I started with a map, converted to struct, and failed to do a full conversion)"}, {"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 0, "creation_date": 1536586823, "post_id": 52258455, "comment_id": 91465622, "body": "Ah good, that threw me off a bit. Thanks. I&#39;m unsure of how to exactly use the <code>UnmarshalJSON</code> function in my case, though it looks like the right direction. Digging into it, thanks for the help."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 1, "creation_date": 1536587072, "post_id": 52258455, "comment_id": 91465760, "body": "With <code>UnmarshalJSON</code> in place, you can just unmarshal your data structure as normal. To unmarshal an list of your custom types, for instance:  <code>x := []*MyStruct{}; json.Unmarshal(jsonData, &amp;x)</code>"}, {"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 0, "creation_date": 1536587680, "post_id": 52258455, "comment_id": 91466172, "body": "Gotcha. Right now, it prints the objects as I wish, however the values are empty strings(except ID, which defaults to 0). Hmm. Gotta debug it. Thanks for your advice though :)! Doesn&#39;t your way call the standard json.Unmarshal, though?"}, {"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536588087, "post_id": 52258455, "comment_id": 91466419, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/179749/discussion-between-cbll-and-flimzy\">continue this discussion in chat</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 0, "creation_date": 1536739393, "post_id": 52258455, "comment_id": 91528374, "body": "@cbll: I see you found the solution. I&#39;m glad to hear that!"}, {"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 1, "creation_date": 1536739475, "post_id": 52258455, "comment_id": 91528418, "body": "indeed - thanks for your help, I learned a thing or two about structs+json in Go. Edited your answer to represent my end-solution."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1536739364, "last_edit_date": 1536739364, "creation_date": 1536584590, "answer_id": 52258455, "question_id": 52258176, "link": "https://stackoverflow.com/questions/52258176/how-to-reformat-json-via-a-struct/52258455#52258455", "title": "How to reformat JSON via a struct?", "body": "<p>Create a custom unmarshaler, that unmarshals the entire thing, then converts for you:</p>\n\n<pre><code>type MyStruct struct {\n    ID                  int    `json:\"Id\"`\n    Language            string `json:\"Language\"`\n    Location            string `json:\"Location\"`\n}\n\ntype val struct {\n    Value struct {\n        String string `json:\"String_\"`\n        Long   int    `json:\"Long\"`\n    }\n}\n\nfunc (s *MyStruct) UnmarshalJSON(p []byte) error {\n    var result struct{\n        ID       val `json:\"Id\"`\n        Language val `json:\"language\"`\n        Location val `json:\"location\"`\n    }\n    if err := json.Unmarshal(p, &amp;result); err != nil {\n        return err\n    }\n    s.ID = result.ID.Value.Long\n    s.Language = result.Langauge.Value.String\n    s.Location= result.Location.Value.String\n    return nil\n}\n</code></pre>\n\n<p>Note that minimal error checking and data validation is done in this example--I leave that as an exercise for the reader.</p>\n"}], "owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 52258455, "answer_count": 1, "score": -1, "last_activity_date": 1536739364, "creation_date": 1536583661, "last_edit_date": 1536583800, "question_id": 52258176, "link": "https://stackoverflow.com/questions/52258176/how-to-reformat-json-via-a-struct", "title": "How to reformat JSON via a struct?", "body": "<p>I have pulled some data out of a given database - the format however is not correct as per what I want.</p>\n\n<p>Sample struct:</p>\n\n<pre><code>type myStruct struct {\n    ID                  int    `json:\"Id\"`\n    Language            string `json:\"Language\"`\n    Location            string `json:\"Location\"`\n}\n</code></pre>\n\n<p>Right, I serialize a given map of strings with a custom struct representing the given returned columns:</p>\n\n<pre><code>func transformJSON(extract []map[string]*sql.SqlCell) ([]byte, error) {\n    return json.MarshalIndent(extract, \"\", \" \")\n}\n</code></pre>\n\n<p>This returns valid JSON, but with the format:</p>\n\n<pre><code>  {\n      {\n      \"id\": {\n       \"Value\": {\n        \"Long\": 12353\n       }\n      },\n      \"language\": {\n       \"Value\": {\n        \"String_\": \"ja-JP\"\n       }\n      },\n      \"location\": {\n       \"Value\": {\n        \"String_\": \"Osaka\"\n       }\n  },\n</code></pre>\n\n<p>Referring to my struct above, I'd like a format as such:</p>\n\n<pre><code> [\n  {\n    \"Id\": 12353,\n    \"Language\": \"ja-JP\",\n    \"Location\": \"Osaka\"\n  },\n  // .. other objects\n ]\n</code></pre>\n\n<p>Assuming the same input to the <code>func transformJSON</code>, how would I match the nested keys with the column type values as well?</p>\n\n<p>Should I <code>Marshal</code> the map first, then transform the data -- or work directly with the <code>[]map[string]*sql.SqlCell</code> data structure before marshal?</p>\n\n<p>In my head, I was thinking along the lines of:</p>\n\n<pre><code>func transformJSON(extract []map[string]*sql.SqlCell) ([]byte, error) {\n    struct :=[] myStruct{}\n    // Loop over extract objects, match nested keys, write to struct?\n\n    return json.MarshalIndent(struct, \"\", \" \")\n}\n</code></pre>\n"}, {"tags": ["go", "beego", "golang-migrate"], "owner": {"reputation": 1021, "user_id": 5160688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e91397eeb44ebbcdb5db2bc679df067e?s=128&d=identicon&r=PG", "display_name": "kiran malvi", "link": "https://stackoverflow.com/users/5160688/kiran-malvi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 288, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1536584795, "creation_date": 1536583059, "last_edit_date": 1536584795, "question_id": 52257985, "link": "https://stackoverflow.com/questions/52257985/is-there-any-way-to-middleware-router-with-group-router", "title": "Is there any way to middleware router with group router?", "body": "<p>I am beginner in beego framework, I have completed few R&amp;D inside on it.\nBut I need few helps related routers.</p>\n\n<p>I have created few route with middleware and group router but I need few suggestions from expert.</p>\n\n<p>Let me share example which I did.</p>\n\n<p><strong>Router.go</strong></p>\n\n<pre><code>func init() {\n    ns := beego.NewNamespace(\"/api/v1\",\n\n        beego.NSNamespace(\"/front\",\n            beego.NSBefore(AuthFilter),\n            beego.NSRouter(\"/user\",&amp;controllers.ObjectController{},\"*:GetValueByAdmin\"),\n            beego.NSRouter(\"/test\",&amp;controllers.ObjectController{},\"*:GetValueByAdmin\"),\n            beego.NSRouter(\"/test\",&amp;controllers.ObjectController{},\"*:GetValueByAdmin\"),\n            beego.NSRouter(\"/test\",&amp;controllers.ObjectController{},\"*:GetValueByAdmin\"),\n            beego.NSRouter(\"/product\",&amp;controllers.ObjectController{},\"*:GetValueByAdmin\"),\n        ),\n\n\n        beego.NSNamespace(\"/a1\",\n            beego.NSRouter(\"/test1\",&amp;controllers.ObjectController{},\"*:GetValueByAdmin1\"),\n            beego.NSRouter(\"/test2\",&amp;controllers.ObjectController{},\"*:GetValueByAdmin1\"),\n            beego.NSInclude(\n                &amp;controllers.UserController{},\n            ),\n        ),\n    )\n\n    beego.AddNamespace(ns)\n}\n\nvar AuthFilter = func(ctx *context.Context) {\n    // The Authorization header should come in this format: Bearer &lt;jwt&gt;\n    // The first thing we do is check that the JWT exists\n    header := strings.Split(ctx.Input.Header(\"Authorization\"), \" \")\n    if header[0] != \"Bearer\" {\n        ctx.Abort(401, \"Not authorized\")\n    }\n}\n</code></pre>\n\n<p>I have created router using Namespace and It is working fine using this url (<a href=\"http://localhost:8080/api/v1/front/test\" rel=\"nofollow noreferrer\">http://localhost:8080/api/v1/front/test</a>). But I want to remove \"front\" keyword from URL.</p>\n\n<p><strong>I tried below options like:</strong></p>\n\n<ol>\n<li><p>I copied code inside \"Front\" namespace to put outside but My \"NSBefore\" Will apply all the method which is defined after that. I need 2 group. Before auth and after auth. In after auth, I want to add <code>beego.NSBefore(AuthFilter)</code>.</p></li>\n<li><p>I tried using policy but it will not work as I needed.</p>\n\n<p><code>beego.Policy(\"/api/v1/front/*\",\"*\", AuthFilter)</code>\n<code>beego.Policy(\"/api/v1/admin/*\",\"*\", AuthFilter)</code></p></li>\n</ol>\n\n<p>If I will remove front from policy then it will apply all the URL.</p>\n\n<p>Do we have any option to create group router without URL path and it will cover my concept?</p>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536576162, "post_id": 52256008, "comment_id": 91459240, "body": "For question #1: Who knows? But don&#39;t use mgo anyway, it&#39;s been abandoned."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536576268, "post_id": 52256008, "comment_id": 91459302, "body": "For #2, what do you want your recovery to do? And in what way is it not working?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536576356, "post_id": 52256008, "comment_id": 91459368, "body": "I dunno. the mgo README links to several options. I&#39;ve never used any of them."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536576761, "post_id": 52256008, "comment_id": 91459626, "body": "Please explain what you&#39;re trying to accomplish. It looks like you&#39;re expecting your defer statement to return an error, but you don&#39;t tell it to return an error. Is that actually your goal?"}, {"owner": {"reputation": 341, "user_id": 6218097, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/prV1P.jpg?s=128&g=1", "display_name": "Gibi", "link": "https://stackoverflow.com/users/6218097/gibi"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536577119, "post_id": 52256008, "comment_id": 91459806, "body": "Yes something like that. Actually I do want an error to return but panic occurs. So I try to recover as I told before."}, {"owner": {"reputation": 341, "user_id": 6218097, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/prV1P.jpg?s=128&g=1", "display_name": "Gibi", "link": "https://stackoverflow.com/users/6218097/gibi"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536577195, "post_id": 52256008, "comment_id": 91459848, "body": "@Flimzy I just dont understand the behavior of it or what I did wrong. I am newbie to golang. Please help"}, {"owner": {"reputation": 341, "user_id": 6218097, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/prV1P.jpg?s=128&g=1", "display_name": "Gibi", "link": "https://stackoverflow.com/users/6218097/gibi"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536577386, "post_id": 52256008, "comment_id": 91459942, "body": "@Flimzy Actually I use the one recommended for alternative, <a href=\"https://github.com/globalsign/mgo\" rel=\"nofollow noreferrer\">github.com/globalsign/mgo</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": false, "score": 5, "last_activity_date": 1536583044, "last_edit_date": 1536583044, "creation_date": 1536579826, "answer_id": 52257061, "question_id": 52256008, "link": "https://stackoverflow.com/questions/52256008/golang-cannot-recover-from-panic-mgo-dialwithinfo/52257061#52257061", "title": "Golang Cannot recover from panic mgo.DialWithInfo", "body": "<blockquote>\n  <p>Why does <code>mgo.DialWithInfo</code> not return error but panic?</p>\n</blockquote>\n\n<p>I don't know. It could be the case that:</p>\n\n<ul>\n<li>you are doing something unsupported, which causes the library call to panic</li>\n<li>the library author chose to use panics to communicate non-recoverable error conditions</li>\n<li>the library has an internal bug which causes the runtime to panic on encountering an unrecoverable situation (e.g. a nil pointer dereference)</li>\n</ul>\n\n<p>or a combination thereof.</p>\n\n<p>Your code doesn't look obviously broken, although I am not a user of the mgo library, and that doesn't mean to say there are no issues communicating with external resources, which cannot be diagnosed by looking at the code. Post the contents of the panic message, which may help us determine exactly where the problem lies.</p>\n\n<blockquote>\n  <p>Why recovery does not work?</p>\n</blockquote>\n\n<p>It isn't clear from your question, but from your unit test and <a href=\"https://stackoverflow.com/questions/52256008/golang-cannot-recover-from-panic-mgo-dialwithinfo#comment91459806_52256008\">this comment</a>, it appears recovery <strong>is</strong> working, but not as you intended because it is not returning an error with the panic's value.</p>\n\n<p>The <code>recover()</code> call in the deferred statement will recover control of a panicking goroutine, return the value given when the panic was initiated, and resume the normal flow of execution. <strong>This is all <code>recover</code> will do.</strong> It won't do anything about errors unless you explicitly write code to do so. (And, for completeness, without a call to <code>recover</code> somewhere in a deferred function in your call stack, a panic will eventually bubble up and be fatal to your application.)</p>\n\n<p>In this context, panic is working: the application will not exit fatally if a panic occurs during the execution of the <code>Connect</code> function. However, you eat the panic without doing anything about it or signalling to the caller that an error occurred during the <code>Connect</code> method.</p>\n\n<p>To report this error, you should recover the panic and produce an error which can be returned from the <code>Connect</code> function. You can't return a value in the deferred function directly, but you can use a named return value to do so. Example code, skipping non-essential parts of the function body:</p>\n\n<pre><code>func Connect(mongoDBDialInfo *mgo.DialInfo) (err error) {\n    defer func() {\n        if r := recover(); r != nil {\n            fmt.Println(\"Recovered in f\", r)\n\n            // Return error from Connect with panic's value\n            err = fmt.Errorf(\"%v\", r)\n        }\n    }()\n\n    // rest of function body\n}\n</code></pre>\n"}], "owner": {"reputation": 341, "user_id": 6218097, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/prV1P.jpg?s=128&g=1", "display_name": "Gibi", "link": "https://stackoverflow.com/users/6218097/gibi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 493, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1536586803, "creation_date": 1536576012, "last_edit_date": 1536586803, "question_id": 52256008, "link": "https://stackoverflow.com/questions/52256008/golang-cannot-recover-from-panic-mgo-dialwithinfo", "title": "Golang Cannot recover from panic mgo.DialWithInfo", "body": "<p>I tried to unit test connection to MongoDB using <code>mgo.DialWithInfo</code> function (in the failure case). <code>mgo.DialWithInfo</code> does not return an error but panics instead.</p>\n\n<p>I tried to add recovery logic to recover from the panic without success.</p>\n\n<p>My questions are:</p>\n\n<ol>\n<li>Why does <code>mgo.DialWithInfo</code> not return an <code>error</code> but panics?</li>\n<li>Why does my recovery not work?</li>\n</ol>\n\n<p>Code:</p>\n\n<p><strong>Function</strong></p>\n\n<pre><code>func Connect(mongoDBDialInfo *mgo.DialInfo) error {\n    log.Infof(\"connect to MongoDB with %v\", mongoDBDialInfo)\n    defer func() {\n        if r := recover(); r != nil {\n            fmt.Println(\"Recovered in f\", r)\n        }\n    }()\n\n    mongoSession, err := mgo.DialWithInfo(mongoDBDialInfo)\n    if err != nil {\n        log.Errorf(\"error, cannot connect to MongoDB, %v\", err)\n        msg := fmt.Sprintf(\"fail, cannot connect to MongoDB, %v\", mongoDBDialInfo)\n        sf := \"main.main\"\n        errM := err.Error()\n        util.LogError(msg, sf, errM)\n        return err\n    }\n\n    DBSession = mongoSession\n    return err\n}\n</code></pre>\n\n<p><strong>Unit test</strong></p>\n\n<pre><code>func TestConnect_Fail(t *testing.T) {\n    cf, err := config.GetConfigInstance()\n    if err != nil {\n        t.Errorf(\"expected, cannot connect to MongoDB but found, %v\", err)\n    }\n    mongoDBDialInfo := &amp;mgo.DialInfo{\n        Addrs:    []string{cf.Config.MongoDB.Host + \"ss\"},\n        Timeout:  time.Duration(cf.Config.MongoDB.Timeout) * time.Second,\n        Database: cf.Config.MongoDB.DBName,\n        Username: cf.Config.MongoDB.Username,\n        Password: cf.Config.MongoDB.Password,\n    }\n    err = Connect(mongoDBDialInfo)\n    if err == nil {\n        t.Errorf(\"expected, cannot connect to MongoDB but can\")\n    }\n}\n</code></pre>\n"}, {"tags": ["php", "go", "ecdsa"], "answers": [{"tags": [], "owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "is_accepted": true, "score": 2, "last_activity_date": 1536582003, "last_edit_date": 1536582003, "creation_date": 1536581043, "answer_id": 52257396, "question_id": 52255715, "link": "https://stackoverflow.com/questions/52255715/php-create-ecdsa-signature-and-verify-with-golang/52257396#52257396", "title": "PHP create ECDSA signature and verify with Golang", "body": "<p>The problem with your code seems to be, that you hash the string in PHP using MD5 before signing it using <code>OPENSSL_ALGO_SHA256</code>, which hashes what you sign (the MD5 hash) again, while in your Go program, you only have the first of these 2 hashes. To fix this, I would remove the <code>MD5</code> step in the PHP code and replace the <code>h := md5.New()</code> line in your code with the hash used by your signature algorithm (<code>h := sha256.New()</code> in your example).</p>\n\n<p>To elaborate a bit more on what theses signing functions do, I would first like to break signing and verifying down into the following steps:</p>\n\n<ul>\n<li>Signing:\n\n<ol>\n<li>Hash the message</li>\n<li>Encrypt the message's hash using the private key (this encrypted hash is the signature)</li>\n</ol></li>\n<li>Verifying:\n\n<ol>\n<li>Hash the message</li>\n<li>Decrypt the signature using the public key (this yields the hash which was encrypted while signing).</li>\n<li>Compare the calculated and decrypted hashes. If they match, then the signature is correct.</li>\n</ol></li>\n</ul>\n\n<p>Now the call to <a href=\"http://php.net/manual/en/function.openssl-sign.php\" rel=\"nofollow noreferrer\"><code>openssl_sign</code></a> in your PHP code, does all the signing steps, while the call to <a href=\"https://golang.org/pkg/crypto/ecdsa/#Verify\" rel=\"nofollow noreferrer\"><code>ecdsa.Verify</code></a> in Go, only does the second and third step of the verification process. And this is why it takes a hash as the second argument. So to verify a signature, you must implement the first verification step yourself, namely generating the hash. </p>\n\n<p>You must use the same hashing algorithm while signing and verifying, therefore you must use SHA256, not MD5, in your Go code (as you sign using <code>OPENSSL_ALGO_SHA256</code>), otherwise the hashes will (generally) not match.</p>\n\n<p>Also, I would recommend to not use MD5 for signatures, as it is no longer considered collision resistant (a hash collision is, when you have 2 different strings/files/... with the same hash). For more details about that, you can check the <a href=\"https://en.wikipedia.org/wiki/MD5#Collision_vulnerabilities\" rel=\"nofollow noreferrer\">Wikipedia article on MD5</a>, specifically the section \"Collision vulnerabilities\". This is a problem, as 2 messages with the same MD5 hash, will also have the same signature and an attacker could use the signature generated for one of the strings to trick you into thinking the other was signed (and therefore trust it).</p>\n\n<p>Additionally, <a href=\"https://golang.org/pkg/crypto/ecdsa/#PrivateKey\" rel=\"nofollow noreferrer\"><code>ecdsa.PrivateKey</code></a> can give you the corresponding public key, and you can call <a href=\"https://golang.org/pkg/crypto/ecdsa/#Verify\" rel=\"nofollow noreferrer\"><code>ecdsa.Verify</code></a> like this:</p>\n\n<pre><code>ecdsa.Verify(&amp;prikey.PublicKey, data, &amp;r, &amp;s)\n</code></pre>\n\n<p>This saves you the trouble of copying all the data from the private key to a new object.</p>\n"}], "owner": {"reputation": 1491, "user_id": 629960, "user_type": "registered", "accept_rate": 52, "profile_image": "https://i.stack.imgur.com/2i6rf.jpg?s=128&g=1", "display_name": "Roman Gelembjuk", "link": "https://stackoverflow.com/users/629960/roman-gelembjuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1855, "favorite_count": 0, "accepted_answer_id": 52257396, "answer_count": 1, "score": 7, "last_activity_date": 1536582003, "creation_date": 1536575010, "question_id": 52255715, "link": "https://stackoverflow.com/questions/52255715/php-create-ecdsa-signature-and-verify-with-golang", "title": "PHP create ECDSA signature and verify with Golang", "body": "<p>I try to make the app with PHP that creates ECDSA signature for some document and that signature is verified with Golang app.</p>\n\n<p>I use private keys generated with openssl tool. It is prime256v1 curve key. Created with the command:</p>\n\n<pre><code>openssl ecparam -name prime256v1 -genkey -noout -out prime256v1-key.pem\n</code></pre>\n\n<p>In PHP i create signature using openssl_sign function.</p>\n\n<p>And all my attempts to verify the signature with Golang fail. In Golang  use the crypto/ecdsa, crypto/elliptic packages.</p>\n\n<p>There is my code.</p>\n\n<p>PHP  </p>\n\n<pre><code>&lt;?php\n\n$stringtosign = \"my test string to sign\";\n\n// Privcate key was geerated with openssl tool with the command\n// openssl ecparam -name prime256v1 -genkey -noout -out prime256v1-key.pem\n$cert = file_get_contents('prime256v1-key.pem');\n\n$prkey = openssl_pkey_get_private($cert);\n\n// we sign only hashes, because Golang lib can wok with hashes only\n$stringtosign = md5($stringtosign);\n\n// we generate 64 length signature (r and s 32 bytes length)\nwhile(1) {\n\n    openssl_sign($stringtosign, $signature, $prkey, OPENSSL_ALGO_SHA256);\n\n    $rlen = ord(substr($signature,3,1));\n\n    $slen = ord(substr($signature,5+$rlen,1));\n\n    if ($slen != 32 || $rlen != 32) {\n        // try other signature if length is not 32 for both parts\n        continue;\n    }\n    $r = substr($signature,4,$rlen);\n    $s = substr($signature,6+$rlen,$slen);\n\n    $signature = $r.$s;\n\n    break;\n}\nopenssl_free_key($prkey);\n\n$signature = bin2hex($signature);\n\necho $signature.\"\\n\";\n</code></pre>\n\n<p>Golang</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/ecdsa\"\n    \"crypto/elliptic\"\n    \"crypto/md5\"\n    \"encoding/hex\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"math/big\"\n\n    \"crypto/x509\"\n\n    \"encoding/pem\"\n)\n\nfunc main() {\n    stringtosign := \"my test string to sign\"\n\n    // This is outpur of PHP app. Signature generated by PHP openssl_sign\n    signature := \"18d5c1d044a4a752ad91bc06499c72a590b2842b3d3b4c4b1086bfd0eea3e7eb5c06b77e15542e5ba944f3a1a613c24eabaefa4e2b2251bd8c9355bba4d14640\"\n\n    // NOTE . Error verificaion is skipped here\n\n    // Privcate key was geerated with openssl tool with the command\n    // openssl ecparam -name prime256v1 -genkey -noout -out prime256v1-key.pem\n    prikeybytes, _ := ioutil.ReadFile(\"prime256v1-key.pem\")\n\n    p, _ := pem.Decode(prikeybytes)\n\n    prikey, _ := x509.ParseECPrivateKey(p.Bytes)\n\n    signatureBytes, _ := hex.DecodeString(signature)\n\n    // make MD5 hash\n    h := md5.New()\n    io.WriteString(h, stringtosign)\n    data := h.Sum(nil)\n\n    // build key and verify data\n    r := big.Int{}\n    s := big.Int{}\n    // make signature numbers\n    sigLen := len(signatureBytes)\n    r.SetBytes(signatureBytes[:(sigLen / 2)])\n    s.SetBytes(signatureBytes[(sigLen / 2):])\n\n    curve := elliptic.P256()\n\n    // make public key from private key\n    x := big.Int{}\n    y := big.Int{}\n    x.SetBytes(prikey.PublicKey.X.Bytes())\n    y.SetBytes(prikey.PublicKey.Y.Bytes())\n    rawPubKey := ecdsa.PublicKey{Curve: curve, X: &amp;x, Y: &amp;y}\n\n    v := ecdsa.Verify(&amp;rawPubKey, data, &amp;r, &amp;s)\n\n    if v {\n        fmt.Println(\"Success verify!\")\n        return\n    }\n\n    fmt.Println(fmt.Sprintf(\"Signatire doed not match\"))\n\n}\n</code></pre>\n\n<p>What do i do wrong? Can anyone show me working example where Golang verifies signatre created with PHP?</p>\n\n<p>I tried to use different versions in openssl_sign instead of OPENSSL_ALGO_SHA256  . Tried OPENSSL_ALGO_SHA1, OPENSSL_ALGO_SHA512</p>\n"}, {"tags": ["string", "go", "null"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1536575049, "post_id": 52255683, "comment_id": 91458594, "body": "There are <i>no</i> nil strings in Go. So you cannot do what you want."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536581904, "post_id": 52255683, "comment_id": 91462444, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/46726832/how-to-return-int-or-nil-in-golang\">How to return int or nil in golang?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1220, "user_id": 1520793, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d0155363af97f63765cf92e647adb003?s=128&d=identicon&r=PG", "display_name": "sotona", "link": "https://stackoverflow.com/users/1520793/sotona"}, "edited": false, "score": 0, "creation_date": 1536575585, "post_id": 52255707, "comment_id": 91458896, "body": "well, looks like returning string pointer instead of the string itself is the best way to avoid additional entities"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1220, "user_id": 1520793, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d0155363af97f63765cf92e647adb003?s=128&d=identicon&r=PG", "display_name": "sotona", "link": "https://stackoverflow.com/users/1520793/sotona"}, "edited": false, "score": 3, "creation_date": 1536576384, "post_id": 52255707, "comment_id": 91459391, "body": "@sotona Depends on how (and how often) you intend to use this function. Multi-return values are quite common in Go, and working with string pointers is more cumbersome. I&#39;d go with multi-return values in most of the time."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 45, "last_activity_date": 1536591907, "last_edit_date": 1536591907, "creation_date": 1536574991, "answer_id": 52255707, "question_id": 52255683, "link": "https://stackoverflow.com/questions/52255683/how-to-return-nil-string-in-go/52255707#52255707", "title": "How to Return Nil String in Go?", "body": "<p>If you can't use <code>\"\"</code>, return a pointer of type <code>*string</code>; or\u2013since this is Go\u2013you may declare multiple return values, such as: <code>(response string, ok bool)</code>.</p>\n\n<p>Using <code>*string</code>: return <code>nil</code> pointer when you don't have a \"useful\" string to return. When you do, assign it to a local variable, and return its address.</p>\n\n<pre><code>func test() (response *string) {\n    if runtime.GOOS != \"linux\" {\n        return nil\n    } else {\n        ret := \"useful\"\n        return &amp;ret\n    }\n}\n</code></pre>\n\n<p>Using multiple return values: when you have a useful string to return, return it with <code>ok = true</code>, e.g.:</p>\n\n<pre><code>return \"useful\", true\n</code></pre>\n\n<p>Otherwise:</p>\n\n<pre><code>return \"\", false\n</code></pre>\n\n<p>This is how it would look like:</p>\n\n<pre><code>func test() (response string, ok bool) {\n    if runtime.GOOS != \"linux\" {\n        return \"\", false\n    } else {\n        return \"useful\", true\n    }\n}\n</code></pre>\n\n<p>At the caller, first check the <code>ok</code> return value. If that's <code>true</code>, you may use the <code>string</code> value. Otherwise, consider it useless.</p>\n\n<p><strong>Also see related questions:</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/30731687/how-do-i-represent-an-optional-string-in-go/30741287#30741287\">How do I represent an Optional String in Go?</a></p>\n\n<p>Alternatives for obtaining and returning a pointer to <code>string</code>: <a href=\"https://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#30716481\">How do I do a literal *int64 in Go?</a></p>\n"}, {"tags": [], "owner": {"reputation": 10410, "user_id": 2450507, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qNPPb.jpg?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/2450507/nicholas"}, "is_accepted": false, "score": 6, "last_activity_date": 1536585403, "last_edit_date": 1536585403, "creation_date": 1536575094, "answer_id": 52255740, "question_id": 52255683, "link": "https://stackoverflow.com/questions/52255683/how-to-return-nil-string-in-go/52255740#52255740", "title": "How to Return Nil String in Go?", "body": "<p><a href=\"https://gobyexample.com/multiple-return-values\" rel=\"nofollow noreferrer\">Go has built-in support for multiple return values</a>:</p>\n\n<p>This feature is used often in idiomatic Go, <a href=\"https://gobyexample.com/errors\" rel=\"nofollow noreferrer\">for example</a> to return both result and error values from a function.</p>\n\n<p>In your case it could be like this:</p>\n\n<pre><code>func test() (response string, err error) {\n    if runtime.GOOS != \"linux\" {  \n        return \"\", nil\n    } else {\n        /* blablabla*/\n    }\n}\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>response, err := test()\nif err != nil { \n    // Error handling code\n    return;\n}\n\n// Normal code \n</code></pre>\n\n<p>If you want to ignore the error, simply use <code>_</code>:</p>\n\n<pre><code>response, _ := test()\n// Normal code\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 670, "user_id": 2047029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb0105ba319eb9e69cab2d26a04120a2?s=128&d=identicon&r=PG", "display_name": "Mightee", "link": "https://stackoverflow.com/users/2047029/mightee"}, "is_accepted": false, "score": 0, "last_activity_date": 1536575114, "creation_date": 1536575114, "answer_id": 52255751, "question_id": 52255683, "link": "https://stackoverflow.com/questions/52255683/how-to-return-nil-string-in-go/52255751#52255751", "title": "How to Return Nil String in Go?", "body": "<p>Go allows multiple return types. So use this to your advantage and return an error or any other type. Check this out for more info: <a href=\"http://golangtutorials.blogspot.com/2011/06/return-values-from-go-functions.html?m=1\" rel=\"nofollow noreferrer\">http://golangtutorials.blogspot.com/2011/06/return-values-from-go-functions.html?m=1</a></p>\n"}], "owner": {"reputation": 1220, "user_id": 1520793, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d0155363af97f63765cf92e647adb003?s=128&d=identicon&r=PG", "display_name": "sotona", "link": "https://stackoverflow.com/users/1520793/sotona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43860, "favorite_count": 4, "accepted_answer_id": 52255707, "answer_count": 3, "score": 25, "last_activity_date": 1536591907, "creation_date": 1536574898, "last_edit_date": 1536586029, "question_id": 52255683, "link": "https://stackoverflow.com/questions/52255683/how-to-return-nil-string-in-go", "title": "How to Return Nil String in Go?", "body": "<p>I have a function which returns a string under certain circumstances, namely when the program runs in Linux or MacOS, otherwise the return value should be nil in order to omit some OS-specific checks further in code.</p>\n\n<pre><code>func test() (response string) {\n    if runtime.GOOS != \"linux\" {  \n        return nil\n    } else {\n        /* blablabla*/\n    }\n}\n</code></pre>\n\n<p>however when I try to compile this code I get an error:</p>\n\n<blockquote>\n  <blockquote>\n    <p>test.go:10:3: cannot use nil as type string in return argument.</p>\n  </blockquote>\n</blockquote>\n\n<p>If I return just an empty string like <code>return \"\"</code>, I cannot compare this return value with <code>nil</code> further in code.</p>\n\n<p>So the question is how to return a correct nil string value?</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "http-accept-language"], "answers": [{"tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": false, "score": 1, "last_activity_date": 1536687044, "last_edit_date": 1536687044, "creation_date": 1536597247, "answer_id": 52262042, "question_id": 52254979, "link": "https://stackoverflow.com/questions/52254979/why-language-matcher-returns-such-strange-result/52262042#52262042", "title": "Why language.Matcher returns such strange result?", "body": "<p>You will need to add \"ru-RU\" when you create your matcher.</p>\n\n<pre><code>var matcher = language.NewMatcher([]language.Tag{\n    language.English,\n    language.MustParse(\"ru-RU\"),\n    language.Russian,\n})\n</code></pre>\n\n<p>when you pass in a region and it's not in your matcher it defaults to <a href=\"https://godoc.org/golang.org/x/text/language#Region.String\" rel=\"nofollow noreferrer\">ZZ</a> and you hit this <a href=\"https://github.com/golang/text/blob/master/language/match.go#L114\" rel=\"nofollow noreferrer\">code</a> in the language package. </p>\n\n<pre><code>    } else if r := w.RegionID.String(); len(r) == 2 {\n        // TODO: also filter macro and deprecated.\n        tt, _ = tt.SetTypeForKey(\"rg\", strings.ToLower(r)+\"zzzz\")\n    }\n</code></pre>\n\n<p>If you only want to get the language you can get use the <code>Base</code> method from the returned matched tag</p>\n\n<pre><code>matched, _, _ := matcher.Match(tag)\nbase, _ := matched.Base();\nfmt.Println(base.String()) // will only print the language\n</code></pre>\n\n<p>using <code>base.String()</code> will print <code>ru</code> for all of the language headers you provided. </p>\n"}], "owner": {"reputation": 423, "user_id": 1338475, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03415ab76e1aeba98311a52268b71e50?s=128&d=identicon&r=PG", "display_name": "skeeph", "link": "https://stackoverflow.com/users/1338475/skeeph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1536687044, "creation_date": 1536572424, "last_edit_date": 1536572561, "question_id": 52254979, "link": "https://stackoverflow.com/questions/52254979/why-language-matcher-returns-such-strange-result", "title": "Why language.Matcher returns such strange result?", "body": "<p>I am implementing a multilang web service based on <code>Accept-Language</code> header. I use next code for parsing header and getting the requested language:</p>\n\n<pre><code>var matcher = language.NewMatcher([]language.Tag{\n    language.English,\n    language.Russian,\n})\nheader:=\"ru, RUS, ru-RU, ru-ru\"\ntags, q, err := language.ParseAcceptLanguage(header)\nfor key, tag := range tags {\n        matched, _, c := matcher.Match(tag)\n        fmt.Printf(\"%s=&gt;%f Matched as: %s (confidence: %s)\\n\", tag, q[key], matched, c)\n    }\n</code></pre>\n\n<p>And results I get is</p>\n\n<pre><code>ru=&gt;1.000000 Matched as: ru (confidence: Exact)\nru=&gt;1.000000 Matched as: ru (confidence: Exact)\nru-RU=&gt;1.000000 Matched as: ru-u-rg-ruzzzz (confidence: Exact)\nru-RU=&gt;1.000000 Matched as: ru-u-rg-ruzzzz (confidence: Exact)\n</code></pre>\n\n<p>Why is 'ru-RU' matched as strange tag 'ru-u-rg-ruzzzz'? How can I match 'ru-Ru' as 'ru'?</p>\n"}, {"tags": ["go", "package"], "comments": [{"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536569250, "post_id": 52254046, "comment_id": 91455668, "body": "@Flimzy Reading go docs, one should never really import with relative paths. Maybe I am wrong? It&#39;s the answer I see most places, like on SO, too. Besides, I&#39;ve seen other projects with a similar structure as to what I&#39;m attempting here. Id"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536569335, "post_id": 52254046, "comment_id": 91455703, "body": "You say your code lives in <code>Users\\user\\go\\src\\project-name</code>. So you should import it as <code>project-name</code>.  If you import it as <code>github.com&#47;org&#47;project-name</code>, then, as you can tell from the errors, it looks in <code>Users&#47;user&#47;go&#47;src&#47;github.com&#47;org&#47;project-name</code>."}, {"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536569337, "post_id": 52254046, "comment_id": 91455706, "body": "No clue what you refer to by &quot;making up&quot; names and lying about their locations? The files are there in the correct path in relation to the <code>GOPATH</code>, and it&#39;s exported as one is supposed to..?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1536569357, "post_id": 52254046, "comment_id": 91455711, "body": "&quot;My project exists under: Users\\user\\go\\src\\project-name&quot; This is wrong. Why did you deviate from what &quot;How to Write Go Code&quot; tells you. Place your project under $GOPATH/github.com/org/project-name. Stop fighting the tooling."}, {"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "edited": false, "score": 0, "creation_date": 1536569398, "post_id": 52254046, "comment_id": 91455727, "body": "No need to be hostile and rude... I was simply asking for advice and help :)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536569437, "post_id": 52254046, "comment_id": 91455746, "body": "&quot;My package is called foo, so I&#39;ll just call it github.com/randomstuff/foo&quot; is what I mean by &quot;making up names&quot;.  Call your package by it&#39;s actual name--don&#39;t just make stuff up."}, {"owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536569626, "post_id": 52254046, "comment_id": 91455841, "body": "Great stuff, thanks. By the way, the attitude of you and @Volker is likely why SO is becoming seemingly hostile. You could just make your point without being rude about it - I&#39;m just trying to learn, really. You actively deter people from asking questions by being rude just to cement your points.. :)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1536570007, "post_id": 52254046, "comment_id": 91456030, "body": "I cannot speak for Volker, but for myself, I come to SO because I believe in helping people become better coders. Spoon-feeding answers rarely does that. My goal is never to be rude, but sometimes answering an obvious question with an obvious answer, inevitably, seems rude. I blame the impersonal medium. In this particular case, every detail for the answer is contained in the question. It&#39;s further clear that you&#39;ve read the documentation, yet continue to fight the tools. If Volker and I can point that out in a &quot;less rude&quot; way, I welcome your suggestions."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1536570849, "last_edit_date": 1536570849, "creation_date": 1536570253, "answer_id": 52254371, "question_id": 52254046, "link": "https://stackoverflow.com/questions/52254046/golang-local-import-via-github-com-repo-doesnt-work-even-though-the-files-are-t/52254371#52254371", "title": "Golang local import via github.com repo doesn&#39;t work even though the files are there", "body": "<p>A package has two things:</p>\n\n<ol>\n<li>A <em>name</em>. This is set by the <code>package thename</code> declaration.</li>\n<li>An <em>import</em> <em>path</em>. This path is relative to $GOPATH/src.</li>\n</ol>\n\n<p>You should (no arguing here) do the following:</p>\n\n<ol>\n<li><p>The <em>name</em> and the last component of the <em>import</em> <em>path</em> should match. E.g. if the import path is \"sun/moon/stars\" than the package name is \"stars\". (A lot of people get this wrong and either call the package or the folder stuff like go-stars. Don't do that.)</p></li>\n<li><p>Your folder structure on disk must match the import paths of your package. If the import path of your package is \"whatever/random/noise\" you <em>must</em> place it under $GOPATH/src/whatever/random/noise. Or put the other way around: If you code is in $GOPATH/src/ill/do/it/my/own/way then the import path of package \"way\" is \"ill/do/it/my/own/way\".</p></li>\n<li><p>If you want you package to be <code>go get</code>able place it on a known code hosting and import it by the full import path. Restrictions on import path might apply. Place code of package \"foo\" under $GOPATH/src/github.com/you/repo/whatever/deep/folder/structure/foo and import it with <code>import \"github.com/you/repo/whatever/deep/folder/structure/foo\"</code></p></li>\n<li><p>All your paths and package names should be all lowercase.</p></li>\n</ol>\n\n<p>It boils down to: Do not do anything fancy, keep it natural. Import path and folder structure <em>must</em> match.</p>\n"}], "owner": {"reputation": 4217, "user_id": 5010082, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4afc5a5544e4bf8a0d7093a986990392?s=128&d=identicon&r=PG&f=1", "display_name": "cbll", "link": "https://stackoverflow.com/users/5010082/cbll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 765, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1536570849, "creation_date": 1536569052, "last_edit_date": 1536569129, "question_id": 52254046, "link": "https://stackoverflow.com/questions/52254046/golang-local-import-via-github-com-repo-doesnt-work-even-though-the-files-are-t", "title": "Golang local import via github.com repo doesn&#39;t work even though the files are there", "body": "<p>I do understand Go is quirky for imports, but I've tried following the convention (I believe) to the point, however I cannot import a struct.</p>\n\n<p>Project structure:</p>\n\n<pre><code>/project-name\n    /parser/main.go\n    /query/main.go\n... Project files in root\n</code></pre>\n\n<p>I have a struct in <code>/parser/main.go</code> exported:</p>\n\n<pre><code>package parser\ntype SomeTranslationStuff struct {\n    ID                  int    `json:\"Id\"`\n    Language            string `json:\"Language\"`\n}\n</code></pre>\n\n<p>I wish to import this in <code>/query/main.go</code>.</p>\n\n<p>I do it as such:</p>\n\n<pre><code>import (\n    \"github.com/org/project-name/parser\"\n)\n</code></pre>\n\n<p>It does not import it - I am met with \"cannot find package ... in Gopath\".</p>\n\n<p>My project exists under: <code>Users\\user\\go\\src\\project-name</code>. The imported project(which is the same project, imported from github via go get) does indeed exist in <code>Users\\user\\go\\src\\github.com\\org\\project-name</code>.. Everything seems according to the \"Go\"-way of importing stuff, yet it doesn't appear to import?</p>\n\n<p>It specifically says:</p>\n\n<pre><code>Cannot find package name:\nC:\\Users\\user\\go\\src\\github.com\\org\\project-name\\parser(from $GOPATH)\n</code></pre>\n\n<p>If I go to that path, the project is, correctly, there! What gives? Why doesn't it import?</p>\n"}, {"tags": ["delphi", "go", "dll", "interop", "pinvoke"], "comments": [{"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 0, "creation_date": 1536567084, "post_id": 52253015, "comment_id": 91454517, "body": "<a href=\"https://stackoverflow.com/questions/43385670/understanding-vbbyrefstr-in-vb-net-p-invoke-declarations\" title=\"understanding vbbyrefstr in vb net p invoke declarations\">stackoverflow.com/questions/43385670/&hellip;</a>  Also, how in the go code are you handling the fact that the function has <code>void</code> return type? And how do you know that the two double arrays are long enough?"}, {"owner": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "reply_to_user": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 0, "creation_date": 1536568630, "post_id": 52253015, "comment_id": 91455359, "body": "@DavidHeffernan Strings in go are utf-8 encoded, so I manually convert it to Windows-1251 manually and pass pointer to byte array as parameter to procedure. I&#39;m not sure what is there to handle with <code>void</code> type return. I do have documentation for this dll, so I know what size of arrays I need, but it does not specify format of strings."}, {"owner": {"reputation": 570607, "user_id": 505088, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/3c0aac2191718ef0309dbc034d9b9961?s=128&d=identicon&r=PG", "display_name": "David Heffernan", "link": "https://stackoverflow.com/users/505088/david-heffernan"}, "edited": false, "score": 0, "creation_date": 1536569722, "post_id": 52253015, "comment_id": 91455895, "body": "The C# pinvoke specifies the ABI for the function call."}], "answers": [{"comments": [{"owner": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "edited": false, "score": 0, "creation_date": 1536757838, "post_id": 52258153, "comment_id": 91539769, "body": "Thanks for such detailed explanation, I learned a lot from it. Unfortunately it looks like there might be problem with calling convention. I edited my question with more details."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "edited": false, "score": 0, "creation_date": 1536762326, "post_id": 52258153, "comment_id": 91542880, "body": "Are you by chance able to (temporarily) use <code>cgo</code> to attempt to call your function? With <code>cgo</code>, you should be able to specify the calling convention in the function declaration so that the compiler would arrange to employ proper calling convention. Another possible vector to attack this problem is to try linking this DLL to a Delphi-native test program which would specify different calling convention for that imported function before each compile+run cycle\u2014so that you could figure out which one is correct."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "edited": false, "score": 0, "creation_date": 1536762385, "post_id": 52258153, "comment_id": 91542923, "body": "BTW I would be grateful if you would keep me posted on your progress on this issue (I&#39;m interested in this stuff). ;-)"}, {"owner": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "edited": false, "score": 0, "creation_date": 1536778229, "post_id": 52258153, "comment_id": 91551121, "body": "I actually gave it a try but ran into problems with linker, somehow my toolchain does not play nicely with 32bit go (Most of libraries I need for this project don&#39;t have 64bit versions) I&#39;ll try to clean my setup later to make it work. I&#39;m comparing execution of this procedure side by side called from working program and mine. It seems to execute identically up till call to CoCreateInstance in combase library, but I still have to confirm this tomorrow."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "edited": false, "score": 0, "creation_date": 1536778558, "post_id": 52258153, "comment_id": 91551291, "body": "Hmm, may be <a href=\"https://github.com/go-ole/go-ole\" rel=\"nofollow noreferrer\"><code>go-ole</code></a> might come in handy with this?"}, {"owner": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "edited": false, "score": 0, "creation_date": 1537797210, "post_id": 52258153, "comment_id": 91903230, "body": "I finally found out what caused all this, and posted an answer, <code>go-ole</code> did indeed come in handy. Thanks a lot. :)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "edited": false, "score": 0, "creation_date": 1537805366, "post_id": 52258153, "comment_id": 91908072, "body": "Thanks for keeping me in the loop. Glad you got it sorted!"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "edited": false, "score": 0, "creation_date": 1590777692, "post_id": 52258153, "comment_id": 109820066, "body": "(Apologies for my broken edit, not sure what happened there!)"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1590769190, "last_edit_date": 1590769190, "creation_date": 1536583590, "answer_id": 52258153, "question_id": 52253015, "link": "https://stackoverflow.com/questions/52253015/unhandled-delphi-exception-in-3rd-party-dll/52258153#52258153", "title": "Unhandled delphi exception in 3rd party dll", "body": "<p>You're consistently making a rather common error: taking a pointer to a Go string or slice. The problem with this is that both slices and strings\n<a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">are in fact <code>struct</code>s</a>\u2014of three and two fields, correspondingly. Hence when you're taking an address of a variable containing a slice or a string, that's an address of the first field of that struct, <em>not</em> of the first item contained in the container.</p>\n\n<p>So, the first fix is to replace all places making use of</p>\n\n<pre><code>var v []whatever\np := unsafe.Pointer(&amp;v)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>var s string\np := unsafe.Pointer(&amp;s)\n</code></pre>\n\n<p>with</p>\n\n<pre><code>var v []whatever\np := unsafe.Pointer(&amp;v[0])\n</code></pre>\n\n<p>and</p>\n\n<pre><code>var s string\np := unsafe.Pointer(&amp;s[0])\n</code></pre>\n\n<p>correspondingly.</p>\n\n<p>Two more points to consider:</p>\n\n<ul>\n<li><p>It's hard for me to figure exact semantics of <code>VBByRefStr</code> just by reading a poorly-worded MSDN doc, but from cursory reading of some posts about it I have managed to google, it appears your target function has these parameters typed as <code>PChar</code>.</p>\n\n<p>If I'm correct in my assessment, the strings you pass to the function must be zero-terminated as they are not Delphi-native strings, and have no length field encoded in them.</p>\n\n<p>Hence when preparing the strings I'd make sure you add the <code>\\x00</code> character at the end.</p>\n\n<p>Note that in your example the Go strings are plain ASCII (and note that UTF-8 is ASCII-clean, i.e. UTF-8-encoded strings which contain only 7-bit ASCII characters to not need any re-encoding before passing them to anything which intends to see an ASCII data), and Windows code pages are ASCII-compatible as well. Hence for your case for a start I'd not mess with proper character set conversion and would do something like</p>\n\n<pre><code>func toPChar(s string) unsafe.Pointer {\n  dst := make([]byte, len(s)+1)\n  copy(dst, s)\n  dst[len(s)] = 0 // NUL terminator\n  return unsafe.Pointer(&amp;dst[0])\n}\n</code></pre>\n\n<p>\u2026and once you make it work with plain ASCII strings, add character conversion in the mix.</p></li>\n<li><p>Do not store the result of type-conversion of an <code>unsafe.Pointer</code> to <code>uintptr</code> in a variable!</p>\n\n<p>This is a non-obvious thing, I admit, but the logic is as follows:</p>\n\n<ul>\n<li>For Go GC, a variable containing a value of type <code>unsafe.Pointer</code>constitutes a live reference to the memory it points to (if the value is non-<code>nil</code>, of course).</li>\n<li>The <code>uintptr</code> type is specifically defined as representing an <em>opaque pointer-sized integer</em> value, not a pointer. Hence an address stored in a variable of type <code>uintptr</code> does not count as a live reference to the memory at that address.</li>\n</ul></li>\n</ul>\n\n<p>These rules mean when you take an address of some variable and store it in a variable of type <code>uintptr</code>, it means you may have zero references\nto that memory block. For instance, in this example</p>\n\n<pre><code>    func getPtr() unsafe.Pointer\n    ...\n    v := uintptr(getPtr())\n</code></pre>\n\n<p>the GC is free to reclaim the memory a pointer to which was returned by <code>getPtr()</code>.</p>\n\n<p>As a special case, Go guarantees that it's OK to use casting of <code>unsafe.Pointer</code> to <code>uintptr</code> in expressions which are evaluated to produce actual arguments to call a function. So, store intermediate pointers not as <code>uintptr</code>s but rather than <code>unsafe.Pointer</code>s and cast them at the function call site, like in</p>\n\n<pre><code>    a1 := unsafe.Pointer(&amp;whatever[0])\n    ...\n    ret, _, _ := proc.Call(uintptr(a1), uintptr(a2),\n        uintptr(a3), uintptr(a4))\n</code></pre>\n\n<p>It would also be cool to see the actual Delphi-native type of the function you're calling.</p>\n\n<hr>\n\n<p>Another problem might be mismatch in the calling convention but if I understand correctly, P/Invoke defaults to <code>winapi</code> CC (which equals <code>stdcall</code> on Windows), and since your P/Invoke wrapper does not list any CC explicitly, we may hope it's indeed <code>winapi</code> so we should be fine here.</p>\n"}, {"tags": [], "owner": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "is_accepted": true, "score": 1, "last_activity_date": 1537797148, "creation_date": 1537797148, "answer_id": 52480926, "question_id": 52253015, "link": "https://stackoverflow.com/questions/52253015/unhandled-delphi-exception-in-3rd-party-dll/52480926#52480926", "title": "Unhandled delphi exception in 3rd party dll", "body": "<p>Okay, so I've finally found an answer. As @kostix noticed <code>go-ole</code> was required, since DLL uses COM and I had to call CoInitializeEx first. </p>\n\n<p>But that was only part of this, turns out string parameters of procedure were declared as UnicodeString, which required me to put together a conversion function to properly fit into layout described in documentation: <a href=\"http://docwiki.embarcadero.com/RADStudio/Tokyo/en/Unicode_in_RAD_Studio#New_String_Type:_UnicodeString\" rel=\"nofollow noreferrer\">http://docwiki.embarcadero.com/RADStudio/Tokyo/en/Unicode_in_RAD_Studio#New_String_Type:_UnicodeString</a></p>\n\n<p>And once that was done, all started to work as intended.</p>\n"}], "owner": {"reputation": 747, "user_id": 964133, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/342737e3bf4716493d7b6929b58657c8?s=128&d=identicon&r=PG", "display_name": "K. Kowalczyk", "link": "https://stackoverflow.com/users/964133/k-kowalczyk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 52480926, "answer_count": 2, "score": 1, "last_activity_date": 1590769190, "creation_date": 1536564603, "last_edit_date": 1537805814, "question_id": 52253015, "link": "https://stackoverflow.com/questions/52253015/unhandled-delphi-exception-in-3rd-party-dll", "title": "Unhandled delphi exception in 3rd party dll", "body": "<p>I have a dynamic library from which I need to call a procedure in my Go program, but I can't seem to get it right. I have another program written in C# which uses this DLL and according to dnSpy dllimport compiles to:</p>\n\n<pre><code>[DllImport(\"Library.dll\", CharSet = CharSet.Ansi, ExactSpelling = true, SetLastError = true)]\n    public static extern void Calc(double[] Input, [MarshalAs(UnmanagedType.VBByRefStr)] ref string Pattern, [MarshalAs(UnmanagedType.VBByRefStr)] ref string Database_path, double[] Output);\n</code></pre>\n\n<p>So basing on this I tried to call it in my code like so:</p>\n\n<pre><code>func main() {\n    lib := syscall.NewLazyDLL(\"Library.dll\")\n    proc := lib.NewProc(\"Calc\")\n\n    input := [28]float64{0.741, 0.585, 2, 12, 1, 1, 1, 101325, 2500, 3, 20, 17.73, 17.11, 45, 1, 0, 80, 60, 0, 0, 0, 0, 0, 0, 0, 20, 0, 0}\n    output := [20]float64{}\n    tubePattern := marshalAnsi(\"P8-16G-E145/028\")\n    basePath, _ := filepath.Abs(\".\")\n    databasePath := marshalAnsi(basePath)\n    a1 := uintptr(unsafe.Pointer(&amp;input))\n    a2 := uintptr(unsafe.Pointer(tubePattern))\n    a3 := uintptr(unsafe.Pointer(databasePath))\n    a4 := uintptr(unsafe.Pointer(&amp;output))\n    ret, _, _ := proc.Call(a1, a2, a3, a4)\n    log.Println(ret)\n    log.Println(output)\n}\n\nfunc marshalAnsi(input string) *[]byte {\n    var b bytes.Buffer\n    writer := transform.NewWriter(&amp;b, charmap.Windows1252.NewEncoder())\n    writer.Write([]byte(input))\n    writer.Close()\n    output := b.Bytes()\n    return &amp;output\n}\n</code></pre>\n\n<p>This results in unhandled delphi exception:</p>\n\n<pre><code>Exception 0xeedfade 0x31392774 0x32db04e4 0x7677ddc2\nPC=0x7677ddc2\n\nsyscall.Syscall6(0x314af7d0, 0x4, 0x10ee7eb8, 0x10ed21a0, 0x10ed21d0, 0x10ee7d78, 0x0, 0x0, 0x0, 0x0, ...)\n        C:/Go32/src/runtime/syscall_windows.go:184 +0xcf\nsyscall.(*Proc).Call(0x10ed21e0, 0x10ed85e0, 0x4, 0x4, 0x10, 0x49bee0, 0x533801, 0x10ed85e0)\n        C:/Go32/src/syscall/dll_windows.go:152 +0x32e\nsyscall.(*LazyProc).Call(0x10ecb9c0, 0x10ed85e0, 0x4, 0x4, 0x0, 0x0, 0x4c6d70, 0x5491a0)\n        C:/Go32/src/syscall/dll_windows.go:302 +0x48\nmain.main()\n        C:/Users/Krzysztof Kowalczyk/go/src/danpoltherm.pl/dllloader/main.go:32 +0x2c0\neax     0x19f3f0\nebx     0x31392774\necx     0x7\nedx     0x0\nedi     0x10ee7d78\nesi     0x31392774\nebp     0x19f448\nesp     0x19f3f0\neip     0x7677ddc2\neflags  0x216\ncs      0x23\nfs      0x53\ngs      0x2b\n</code></pre>\n\n<p>I believe that problem might lie in the way I pass these strings to procedure, but I can't see what my code does different than that C# application.</p>\n\n<p>Library have a few other procedures, I can call <code>DLL_Version</code> with no problems like so:</p>\n\n<pre><code>lib := syscall.NewLazyDLL(\"Library.dll\")\nverProc := lib.NewProc(\"DLL_Version\")\nvar version float64\nverProc.Call(uintptr(unsafe.Pointer(&amp;version)))\nlog.Printf(\"DLL version: %f\\n\", version)\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>2018/09/10 09:13:11 DLL version: 1.250000\n</code></pre>\n\n<p>EDIT:\nI believe that I found out what causes the exception. It seems that when called from my code, 2nd and 3rd parameters for this procedure, which should be pointers to string buffers, are instead pointers to pointers on these buffers, if I break on the beginning of procedure and patch this manually, code runs and terminates correctly. I still did not found a reason why this happens, and how to fix it though.</p>\n\n<p>EDIT2:\nApparently my previous assessment of this case was invalid. I was able to stop program from throwing exception, but I analyzed assembly and it turned out it was only due to program exiting before this exception was thrown, and instead of exception I got normal error code about invalid string. </p>\n\n<p>While I'm not really good at understanding disassembled code, it seems that problem might indeed be caused by calling convention mismatch. At the beginning of procedure code, when called from working program EAX, EBX, ECX and EDX registers are empty, meanwhile when called from my code, only EAX and ECX are empty, EDX holds something but EBX points to Calc procedure pointer in my executable. Later in the DLL there is a part which checks if EBX is empty and throws exception if not.</p>\n\n<p>EDIT 3:\nWell, that seems to also be unrelated, I'm aware that there is too little information for anyone to be able to make any guess as to what is going on. So I'll try to track where this exception comes from exactly and come back to this question.</p>\n"}, {"tags": ["go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 1, "creation_date": 1536550861, "post_id": 52250742, "comment_id": 91449236, "body": "This doesn&#39;t explain why behaviour is different for  <code>v[1]</code> and <code>v[1:]...</code> for the same slice"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536550925, "post_id": 52250742, "comment_id": 91449248, "body": "@user3698446 runtime behaviour regarding index boundary check is the same for both <code>v[1:]</code> and <code>v[1:]...</code>"}, {"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536551084, "post_id": 52250742, "comment_id": 91449276, "body": "I mean <code>v[1]</code> and <code>v[1:]...</code>, it was a typo,sorry"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536551117, "post_id": 52250742, "comment_id": 91449282, "body": "Yep, I added the quote for indexing as well"}, {"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536551428, "post_id": 52250742, "comment_id": 91449338, "body": "I think this still doesn&#39;t explain the difference.."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536551488, "post_id": 52250742, "comment_id": 91449348, "body": "@user3698446 what&#39;s not clear? The quotes explain in what case the panic will occur. They both explain why <code>v[1]</code> would panic and <code>v[1:]</code> would not."}, {"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536551817, "post_id": 52250742, "comment_id": 91449398, "body": "The difference lies in whether it&#39;s <code>index</code> or <code>range</code> op, it has nothing to do whether it&#39;s <code>array</code> or <code>slice</code>."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536552053, "post_id": 52250742, "comment_id": 91449442, "body": "@user3698446 it&#39;s actually both. Range operation for slices and arrays and strings behaves slightly differently. But all the important semantics are quoted in this answer. Click those links and carefully read the corresponding sections."}, {"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536552149, "post_id": 52250742, "comment_id": 91449460, "body": "Can you update the answer to make it more explicit instead of implicit?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536552218, "post_id": 52250742, "comment_id": 91449471, "body": "I just did a second ago"}, {"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536552651, "post_id": 52250742, "comment_id": 91449557, "body": "I think your answer still doesn&#39;t explain well why <code>v[1]</code> fits in <code>0 &lt;= low &lt;= high &lt; len(a)</code> but <code>v[1]...</code> fits in <code>0 &lt;= low &lt;= high &lt;= len(a)</code>, but I will accept it because it&#39;s the most close to the perfect answer..."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536552957, "post_id": 52250742, "comment_id": 91449633, "body": "@user3698446 <code>v[1]</code> does not fit <code>0 &lt;= low &lt;= high &lt; len(a)</code>, that check is only for range expressions. Checks for single index and slice expressions are <b>DIFFERENT</b> and explained in different spec sections (which I both referred and quoted)"}, {"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536553029, "post_id": 52250742, "comment_id": 91449648, "body": "So the real reason lies in whether it&#39;s <code>range</code> or <code>index</code>, still has little to do whether it&#39;s array or slice anyway."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536553067, "post_id": 52250742, "comment_id": 91449656, "body": "@user3698446 it makes difference for arrays and slices, it&#39;s whether <code>0 &lt;= low &lt;= high &lt;= len(a)</code> or <code>0 &lt;= low &lt;= high &lt;= cap(a)</code>. Mentioning that difference is still required to be able to explain the runtime behaviour. Eg: <code>v[2:2]</code> would still be valid for your very code."}, {"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536553143, "post_id": 52250742, "comment_id": 91449675, "body": "I see, but your answer doesn&#39;t make all this explicit, I think that&#39;s why it&#39;s not voted by others even I have accepted it.."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536553184, "post_id": 52250742, "comment_id": 91449683, "body": "@user3698446 my answer quotes the spec that says exactly that: &quot;For slices, the upper index bound is the slice capacity cap(a) rather than the length.&quot;. I personally tend to think that people just don&#39;t like reading 2 paragraphs of the spec, and prefer looking at examples that provide imprecise approximations."}, {"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536553254, "post_id": 52250742, "comment_id": 91449698, "body": "I see, that&#39;s why I accepted it.But it&#39;s still not explicit enough, readers has to follow the links to finally understand that you are right"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 0, "creation_date": 1536553282, "post_id": 52250742, "comment_id": 91449703, "body": "@user3698446 that&#39;s the idea: you cannot quote the complete spec here, if one needs a deeper understanding - they must read the source of truth. Any approximation would be in the best case incomplete, in the worst case - plain wrong. It&#39;s up to what your aim is. If you read my answer you could have explained why <code>v[2:2]</code> is valid, if you read both other answers - you wouldn&#39;t."}, {"owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "edited": false, "score": 1, "creation_date": 1536553386, "post_id": 52250742, "comment_id": 91449722, "body": "they don&#39;t need to if you can make your answer more explicitly, anyway, your answer is fine to me, I&#39;ll accept it:)"}], "tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 2, "last_activity_date": 1536553024, "last_edit_date": 1592644375, "creation_date": 1536550637, "answer_id": 52250742, "question_id": 52250700, "link": "https://stackoverflow.com/questions/52250700/why-go-doesnt-report-slice-bounds-out-of-range-in-this-case/52250742#52250742", "title": "Why go doesn&#39;t report &quot;slice bounds out of range&quot; in this case?", "body": "<p>That's how spec defines slice expressions</p>\n<blockquote>\n<p>For arrays or strings, the indices are in range if 0 &lt;= low &lt;= high &lt;= len(a), otherwise they are out of range. For slices, the upper index bound is the slice capacity cap(a) rather than the length.</p>\n</blockquote>\n<p><a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Slice_expressions</a></p>\n<p>And that's how index expressions for slices are defined</p>\n<blockquote>\n<p>the index x is in range if 0 &lt;= x &lt; len(a), otherwise it is out of range</p>\n<p>if x is out of range at run time, a run-time panic occurs</p>\n</blockquote>\n<p><a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Index_expressions</a></p>\n<p>For your example:</p>\n<p><code>v[1]</code> panics because it's our of range as per the definition above (because <code>1</code> does not qualify the <code>0 &lt;= x &lt; len(a)</code> reqirement)</p>\n<p><code>v[1:]</code> runs fine because it's identical to <code>v[1:len(v)]</code> and fits the <code>if 0 &lt;= low &lt;= high &lt;= cap(a)</code> requirement.</p>\n"}, {"tags": [], "owner": {"reputation": 328, "user_id": 9227192, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e85d835b94a938d78c738ddcd211b11f?s=128&d=identicon&r=PG&f=1", "display_name": "Sumanth Rao", "link": "https://stackoverflow.com/users/9227192/sumanth-rao"}, "is_accepted": false, "score": 3, "last_activity_date": 1536550939, "creation_date": 1536550939, "answer_id": 52250784, "question_id": 52250700, "link": "https://stackoverflow.com/questions/52250700/why-go-doesnt-report-slice-bounds-out-of-range-in-this-case/52250784#52250784", "title": "Why go doesn&#39;t report &quot;slice bounds out of range&quot; in this case?", "body": "<p>v[1:] returns a list type. Here an empty list is returned as nothing comes in the slice range specified. Hence no error is thrown.</p>\n\n<p>v[1] is trying to access element explicitly out of bound. No default value is returned hence an error is thrown.</p>\n"}, {"tags": [], "owner": {"reputation": 2742, "user_id": 10314, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20cf40f15981c94eb92341e8cdf98e85?s=128&d=identicon&r=PG", "display_name": "James Antill", "link": "https://stackoverflow.com/users/10314/james-antill"}, "is_accepted": false, "score": 1, "last_activity_date": 1536551261, "last_edit_date": 1536551261, "creation_date": 1536551176, "answer_id": 52250813, "question_id": 52250700, "link": "https://stackoverflow.com/questions/52250700/why-go-doesnt-report-slice-bounds-out-of-range-in-this-case/52250813#52250813", "title": "Why go doesn&#39;t report &quot;slice bounds out of range&quot; in this case?", "body": "<p>You are allowed to reference an empty slice just past the last element, because this can be useful when implementing things.</p>\n\n<p>Eg.</p>\n\n<pre><code> s := make([]byte, n)\n // Fill s with something...\n for len(s) &gt; 0 { \n      b := s[0] // Get next byte\n      s = s[1:] // Remove it from the slice\n      // Deal with byte\n }\n</code></pre>\n\n<p>...the last removal wouldn't be valid if s[1:1] didn't work on a 1 byte slice.</p>\n"}], "owner": {"reputation": 53, "user_id": 3698446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbdbbb0f0f692dd130c3cc1962083d77?s=128&d=identicon&r=PG&f=1", "display_name": "user3698446", "link": "https://stackoverflow.com/users/3698446/user3698446"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 767, "favorite_count": 0, "closed_date": 1536558730, "accepted_answer_id": 52250742, "answer_count": 3, "score": -2, "last_activity_date": 1536553024, "creation_date": 1536550166, "question_id": 52250700, "link": "https://stackoverflow.com/questions/52250700/why-go-doesnt-report-slice-bounds-out-of-range-in-this-case", "closed_reason": "Duplicate", "title": "Why go doesn&#39;t report &quot;slice bounds out of range&quot; in this case?", "body": "<p>Here's the code to reproduce:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var v []int\n    v = append(v,1)\n    v = append(v,v[1:]...)\n    fmt.Println(\"hi\", v)\n\n}\n</code></pre>\n\n<p><code>v[1]</code> will report <code>index out of range</code>, but <code>v[1:]...</code> won't, why? </p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 382, "user_id": 7479934, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100007344395075/picture?type=large", "display_name": "Amanda Ferrari", "link": "https://stackoverflow.com/users/7479934/amanda-ferrari"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1536547776, "post_id": 52250388, "comment_id": 91448783, "body": "See if it&#39;s clear now @BasileStarynkevitch"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1536547849, "post_id": 52250388, "comment_id": 91448790, "body": "No, because JSON is designed to be <i>fully</i> parsed. Look again on <a href=\"http://json.org/\" rel=\"nofollow noreferrer\">json.org</a> and show some <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> <i>with Go code</i> (that we could run on <i>our</i> computer) in your question. Perhaps you are using &quot;JSON parsing&quot; in a way that is not the common meaning of it."}, {"owner": {"reputation": 382, "user_id": 7479934, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100007344395075/picture?type=large", "display_name": "Amanda Ferrari", "link": "https://stackoverflow.com/users/7479934/amanda-ferrari"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1536548923, "post_id": 52250388, "comment_id": 91448933, "body": "@BasileStarynkevitch I added an example."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 24, "last_activity_date": 1536549508, "last_edit_date": 1536549508, "creation_date": 1536549074, "answer_id": 52250578, "question_id": 52250388, "link": "https://stackoverflow.com/questions/52250388/how-to-partially-parse-json-using-go/52250578#52250578", "title": "How to partially parse JSON using Go?", "body": "<p>Use <a href=\"https://godoc.org/encoding/json#RawMessage\" rel=\"noreferrer\">json.RawMessage</a> to get the raw JSON text of the <code>inputs</code> field:</p>\n\n<pre><code>type Item struct {\n    Type   string `json:\"type\"`\n    Inputs json.RawMessage\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>var data Configuration\nif err := json.Unmarshal([]byte(myJson), &amp;data); err != nil {\n    // handle error\n}\n\n// Loop over items and unmarshal items.Inputs to Go type specific\n// to each input type.    \nfor _, item := range data.Items {\n    switch item.Type {\n    case \"type-of-item\":\n        var v struct{ Input1 string }\n        if err := json.Unmarshal(item.Inputs, &amp;v); err != nil {\n            // handle error\n        }\n        fmt.Printf(\"%s has value %+v\\n\", item.Type, v)\n\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/wNcDsRvDQon\" rel=\"noreferrer\">Run it on the playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 10348691, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SvCTp3OVmDA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2WGQpwHDaClDXxgT2xDXOKIBdeNw/mo/photo.jpg?sz=128", "display_name": "Earl Huskey", "link": "https://stackoverflow.com/users/10348691/earl-huskey"}, "is_accepted": false, "score": 2, "last_activity_date": 1536686180, "creation_date": 1536686180, "answer_id": 52281073, "question_id": 52250388, "link": "https://stackoverflow.com/questions/52250388/how-to-partially-parse-json-using-go/52281073#52281073", "title": "How to partially parse JSON using Go?", "body": "<p>Try gjson, super simple, you do not have to unmarshal the whole thing. you can take the bytes and pull a specific field out.\n<a href=\"https://github.com/tidwall/gjson\" rel=\"nofollow noreferrer\">https://github.com/tidwall/gjson</a></p>\n\n<pre><code>    // Get string (has string, int, bool parsing)\n    someField := gjson.ParseBytes(b).Get(\"some_field.some_nested_field\").Str\n    // Other types\n    v, ok := gjson.ParseBytes(b).Get(\"some_other_field\").Value().(map[string]string)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 565388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8fd7ade109fc5fee3fe40b8997e1fe8d?s=128&d=identicon&r=PG", "display_name": "pablosan", "link": "https://stackoverflow.com/users/565388/pablosan"}, "is_accepted": false, "score": 1, "last_activity_date": 1544114693, "creation_date": 1544114693, "answer_id": 53656017, "question_id": 52250388, "link": "https://stackoverflow.com/questions/52250388/how-to-partially-parse-json-using-go/53656017#53656017", "title": "How to partially parse JSON using Go?", "body": "<p>In fairness Go would actually parse partially if you defined a partial struct. Quoting the documentation (<a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">https://blog.golang.org/json-and-go</a>):</p>\n\n<blockquote>\n  <p>How does Unmarshal identify the fields in which to store the decoded data? For a given JSON key \"Foo\", Unmarshal will look through the destination struct's fields to find (in order of preference):</p>\n</blockquote>\n\n<pre><code>An exported field with a tag of \"Foo\" (see the Go spec for more on struct tags),\n\nAn exported field named \"Foo\", or\n\nAn exported field named \"FOO\" or \"FoO\" or some other case-insensitive match of \"Foo\".\n</code></pre>\n\n<blockquote>\n  <p>What happens when the structure of the JSON data doesn't exactly match the Go type?</p>\n</blockquote>\n\n<pre><code>b := []byte(`{\"Name\":\"Bob\",\"Food\":\"Pickle\"}`)\nvar m Message\nerr := json.Unmarshal(b, &amp;m)\n</code></pre>\n\n<blockquote>\n  <p>Unmarshal will decode only the fields that it can find in the destination type. In this case, only the Name field of m will be populated, and the Food field will be ignored. This behavior is particularly useful when you wish to pick only a few specific fields out of a large JSON blob. It also means that any unexported fields in the destination struct will be unaffected by Unmarshal. </p>\n</blockquote>\n"}], "owner": {"reputation": 382, "user_id": 7479934, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100007344395075/picture?type=large", "display_name": "Amanda Ferrari", "link": "https://stackoverflow.com/users/7479934/amanda-ferrari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4278, "favorite_count": 0, "accepted_answer_id": 52250578, "answer_count": 3, "score": 8, "last_activity_date": 1544114693, "creation_date": 1536547178, "last_edit_date": 1536548911, "question_id": 52250388, "link": "https://stackoverflow.com/questions/52250388/how-to-partially-parse-json-using-go", "title": "How to partially parse JSON using Go?", "body": "<p>I have the following json:</p>\n\n<pre><code>{\n    \"app\": {\n        \"name\": \"name-of-app\",\n        \"version\" 1\n    },\n    \"items\": [\n        {\n            \"type\": \"type-of-item\",\n            \"inputs\": {\n                \"input1\": \"value1\"\n            }\n        }\n    ]\n}\n</code></pre>\n\n<p>The <code>items[0].inputs</code> change based on the <code>items[0].type</code>.</p>\n\n<p>Knowing that, is there a way to keep the <code>inputs</code> field a string? The idea is to use the <code>type</code> to call the right handler passing the <code>inputs</code>, and in there I would parse the <code>inputs</code> string using the right struct. </p>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Configuration struct {\n    App   App `json:\"app\"`\n    Items []Item `json:\"items\"`\n}\n\ntype App struct {\n    Name    string `json:\"name\"`\n    Version int    `json:\"version\"`\n}\n\ntype Item struct {\n    Type string `json:\"type\"`\n    // What to put here to mantain the field a string so I can Unmarshal later?\n    // Inputs string\n}\n\nvar myJson = `\n{\n    \"app\": {\n        \"name\": \"name-of-app\",\n        \"version\": 1\n    },\n    \"items\": [\n        {\n            \"type\": \"type-of-item\",\n            \"inputs\": {\n                \"input1\": \"value1\"\n            }\n        }\n    ]\n}\n`\n\nfunc main() {\n    data := Configuration{}\n    json.Unmarshal([]byte(myJson), &amp;data)\n\n    fmt.Println(\"done!\", data)\n    // Loop through data.Items and use the type to define what to call, and pass inputs\n    // as argument\n}\n</code></pre>\n\n<p>Thank you in advance.</p>\n"}, {"tags": ["go", "containers", "gmail-api", "google-kubernetes-engine"], "answers": [{"tags": [], "owner": {"reputation": 135, "user_id": 2159960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0639ac05ae00fc8d57154e2176e792b5?s=128&d=identicon&r=PG", "display_name": "Bill Chung", "link": "https://stackoverflow.com/users/2159960/bill-chung"}, "is_accepted": true, "score": 1, "last_activity_date": 1536547626, "creation_date": 1536547626, "answer_id": 52250429, "question_id": 52249647, "link": "https://stackoverflow.com/questions/52249647/using-gmail-api-from-an-app-running-inside-container/52250429#52250429", "title": "Using Gmail API from an app running inside container", "body": "<p>It appears to be one of the dns pod exited that caused dns lookup to hang and resulted in tcp i/o timeout:</p>\n\n<p><code>kube-dns-5dcfcbf5fb-w2vjc    0/4       ExitCode:0   23         3d</code></p>\n\n<p>after fixing the pod, now the application is able to send email thru gmail APIs.</p>\n"}], "owner": {"reputation": 135, "user_id": 2159960, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0639ac05ae00fc8d57154e2176e792b5?s=128&d=identicon&r=PG", "display_name": "Bill Chung", "link": "https://stackoverflow.com/users/2159960/bill-chung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 52250429, "answer_count": 1, "score": 0, "last_activity_date": 1536547626, "creation_date": 1536538717, "last_edit_date": 1536539316, "question_id": 52249647, "link": "https://stackoverflow.com/questions/52249647/using-gmail-api-from-an-app-running-inside-container", "title": "Using Gmail API from an app running inside container", "body": "<p>I'm wondering how to use Gmail API from an app running inside the container (of GKE)?</p>\n\n<p>For my local development, I can run the example <a href=\"https://developers.google.com/gmail/api/quickstart/go\" rel=\"nofollow noreferrer\">https://developers.google.com/gmail/api/quickstart/go</a> to get a code then the program saves a token, send an email successfully (I've changed the scope, the example only has read-only)</p>\n\n<p>But I don't have the interactive terminal for the container running in K8S, so I set the credentials and token as env var for the process running inside the container (my program consumes the env var, and local testing sent the email successfully), it doesn't seem to be able to contact Gmail API.</p>\n\n<p>The exact error is : \n<code>\nPost https://www.googleapis.com/gmail/v1/users/me/messages/send?alt=json&amp;prettyPrint=false: dial tcp: i/o timeout\"\n</code></p>\n\n<p>So I have two question here:</p>\n\n<ol>\n<li>why is container in GKE is unable to contact www.googleapis.com</li>\n<li>What's the best way of handling gmail api inside a container? Am I missing steps to setup google APIs?</li>\n</ol>\n\n<p>Thanks,\nBill</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 2478, "user_id": 1586231, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/sRho9.jpg?s=128&g=1", "display_name": "Max von Hippel", "link": "https://stackoverflow.com/users/1586231/max-von-hippel"}, "edited": false, "score": 0, "creation_date": 1536530407, "post_id": 52248878, "comment_id": 91446001, "body": "Hi - I don&#39;t understand your question.  What do you want the output to look like, in contrast to how it actually comes out at the moment?  Can you reduce this to a <a href=\"https://stackoverflow.com/help/mcve\">Minimum, Complete, Verifiable Example</a>?"}, {"owner": {"reputation": 1, "user_id": 7998554, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YchAJrSCdbg/AAAAAAAAAAI/AAAAAAAAAoY/Ceq6hSiQ2Cw/photo.jpg?sz=128", "display_name": "Oleksandr Chub", "link": "https://stackoverflow.com/users/7998554/oleksandr-chub"}, "reply_to_user": {"reputation": 2478, "user_id": 1586231, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/sRho9.jpg?s=128&g=1", "display_name": "Max von Hippel", "link": "https://stackoverflow.com/users/1586231/max-von-hippel"}, "edited": false, "score": 1, "creation_date": 1536532371, "post_id": 52248878, "comment_id": 91446400, "body": "Thank you Max, i was add base struct and wanted result, hope it&#39;s clear"}, {"owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "edited": false, "score": 0, "creation_date": 1536532827, "post_id": 52248878, "comment_id": 91446496, "body": "I think you are missing information about how you are extracting data from the database. What is the type of <code>db</code> and how are you initializing it?"}, {"owner": {"reputation": 1, "user_id": 7998554, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YchAJrSCdbg/AAAAAAAAAAI/AAAAAAAAAoY/Ceq6hSiQ2Cw/photo.jpg?sz=128", "display_name": "Oleksandr Chub", "link": "https://stackoverflow.com/users/7998554/oleksandr-chub"}, "edited": false, "score": 0, "creation_date": 1536533845, "post_id": 52248878, "comment_id": 91446668, "body": "Thank you Dolan. is standard mysql, is working perfectly, but i was add it info too now"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1536541463, "post_id": 52248878, "comment_id": 91447834, "body": "I bet as long as your structs have only private variables, nothing else (including the templating code) will be able to see them.  It&#39;d help if you could make your reproduction not require a database, though (it doesn&#39;t seem directly relevant to the templating question)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536549684, "post_id": 52248878, "comment_id": 91449071, "body": "Start by exporting your fields."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1536563245, "post_id": 52248878, "comment_id": 91452681, "body": "You have to export fields of your struct. Also, <code>Template.ExecuteTemplate()</code> returns an error which you don&#39;t check, <b>always check all errors</b>."}], "owner": {"reputation": 1, "user_id": 7998554, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YchAJrSCdbg/AAAAAAAAAAI/AAAAAAAAAoY/Ceq6hSiQ2Cw/photo.jpg?sz=128", "display_name": "Oleksandr Chub", "link": "https://stackoverflow.com/users/7998554/oleksandr-chub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "closed_date": 1536563202, "answer_count": 0, "score": 0, "last_activity_date": 1536563056, "creation_date": 1536529344, "last_edit_date": 1536563056, "question_id": 52248878, "link": "https://stackoverflow.com/questions/52248878/filling-and-listing-nested-struct", "closed_reason": "Duplicate", "title": "filling and listing nested struct", "body": "<p>Could someone help me please fill template from nested struct data, here code what get data from mysql ad fill <strong>em</strong> very good</p>\n\n<pre><code>package main\n\nimport (\n        \"html/template\"\n        \"log\"\n        \"net/http\"\n        \"database/sql\"\n        \"github.com/gorilla/mux\"\n        _ \"github.com/go-sql-driver/mysql\"\n)\n\nvar (\n        o one\n)\n\ntype one struct {\n        point bool\n        em    []two\n}\n\ntype two struct {\n        id  uint16\n        uid uint16\n}\n\nfunc checkErr(err error) {\n        if err != nil {\n                log.Fatal(err)\n        }\n}\n\nfunc listandlist(w http.ResponseWriter, r *http.Request) {\n        db, err = sql.Open(\"mysql\", \"torwald:ragnar@tcp(127.0.0.1:3306)/harpy\")\n        checkErr(err)\n\n        defer db.Close()\n\n        err = db.Ping()\n        checkErr(err)\n\n        rows, err := db.Query(\"select * from global where point=?\", o.point)\n        checkErr(err)\n\n        em := []two{}\n\n        for rows.Next() {\n                p := two{}\n                err := rows.Scan(&amp;p.id, &amp;p.uid)\n                if err != nil {\n                        log.Println(err)\n                        continue\n                }\n                log.Println(\"full list id and uid\", p.id, p.uid)\n                em = append(em, p)\n        }\n\n        if r.Method != \"POST\" {\n                t, err := template.ParseFiles(\"templates/one.html\", \"templates/two.html\", \"templates/tree.html\")\n                if err != nil {\n                        log.Fatal(w, err.Error())\n                        return\n                }\n                t.ExecuteTemplate(w, \"list\", o)\n                return\n\n        }\n}\n</code></pre>\n\n<p>but in template are empty </p>\n\n<pre><code>{{ define \"list\" }} {{ template \"header\" .}}\n{{range .two}}\n{{.id}}\n{{.uid}}\n{{end}}\n{{ template \"footer\" }} {{ end }}\n</code></pre>\n\n<p>could tell me please when i'm are broken ? how i can get it info from nested struct in template ?</p>\n\n<p>in mysql table global we have struct</p>\n\n<pre><code>TABLE `global` (\n  `id` int(11) unsigned NOT NULL,\n  `uid` int(11) unsigned NOT NULL,\n  `point`  tinyint(4) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `id_UNIQUE` (`id`)\n) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8 COLLATE=utf8_bin\n</code></pre>\n\n<p>and filled with data, sample</p>\n\n<pre>id | uid | point\n 1 |  2  |   0\n 2 |  3  |   0\n 2 |  1  |   1\n 3 |  1  |   0\n 1 |  3  |   0\n 3 |  2  |   1</pre>\n\n<p>and as result run this query with point=1 i want see in template result with two row :</p>\n\n<pre>2 1\n3 2</pre>\n"}, {"tags": ["file", "go", "mnist"], "answers": [{"comments": [{"owner": {"reputation": 441, "user_id": 6451721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh4.googleusercontent.com/-4pC3WCmF5xE/AAAAAAAAAAI/AAAAAAAAAFI/NjnGhmZoI6w/photo.jpg?sz=128", "display_name": "Fer Vargas", "link": "https://stackoverflow.com/users/6451721/fer-vargas"}, "edited": false, "score": 1, "creation_date": 1536521861, "post_id": 52248006, "comment_id": 91443871, "body": "Oh, didn&#39;t realize that. Thanks!"}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 2, "last_activity_date": 1536521583, "creation_date": 1536521583, "answer_id": 52248006, "question_id": 52247955, "link": "https://stackoverflow.com/questions/52247955/ioutil-readfile-adds-extra-bytes/52248006#52248006", "title": "ioutil ReadFile adds extra bytes", "body": "<p>Looking at <a href=\"http://yann.lecun.com/exdb/mnist/\" rel=\"nofollow noreferrer\">their web site</a> you can see that the data format for the file is:</p>\n\n<pre><code>[offset] [type]          [value]          [description]\n0000     32 bit integer  0x00000803(2051) magic number\n0004     32 bit integer  60000            number of images\n0008     32 bit integer  28               number of rows\n0012     32 bit integer  28               number of columns\n0016     unsigned byte   ??               pixel\n0017     unsigned byte   ??               pixel\n........\nxxxx     unsigned byte   ??               pixel\n</code></pre>\n\n<p>which means the first 16 bytes are 4 32 bit integers, hence 16 byte, of header information.</p>\n"}], "owner": {"reputation": 441, "user_id": 6451721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh4.googleusercontent.com/-4pC3WCmF5xE/AAAAAAAAAAI/AAAAAAAAAFI/NjnGhmZoI6w/photo.jpg?sz=128", "display_name": "Fer Vargas", "link": "https://stackoverflow.com/users/6451721/fer-vargas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 52248006, "answer_count": 1, "score": 0, "last_activity_date": 1536563036, "creation_date": 1536521247, "last_edit_date": 1536563036, "question_id": 52247955, "link": "https://stackoverflow.com/questions/52247955/ioutil-readfile-adds-extra-bytes", "title": "ioutil ReadFile adds extra bytes", "body": "<p>I've been working on trying to draw a number of the MNIST database to an image file, in my first attempts, the image generated seemed shifted, as follows:</p>\n\n<p><a href=\"https://i.stack.imgur.com/ZFgJY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ZFgJY.png\" alt=\"enter image description here\"></a></p>\n\n<p>I know that the training file consists of 60,000 images, each one is 28 x 28 pixels big, which in the file is represented as an array of 28 x 28 x 60,000 uint8, which should give 47040000 as it's length.</p>\n\n<p>However, when printing the length of the file, it gives 47040016 as it's length, that extra 16 numbers are what causes the image to shift.</p>\n\n<p>The code used is the following, the const imgNum is defined by the image I want to print and the length of the image. I don't really see anything weird going on when reading the images file.</p>\n\n<pre><code>package main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"image/png\"\n\n    \"io/ioutil\"\n\n    \"os\"\n)\n\nconst (\n    imgSideLength = 28\n    imgSize = imgSideLength * imgSideLength\n    imgNum = 499 * imgSize\n)\n\nvar images []uint8\n\nfunc main() {\n    images, err := ioutil.ReadFile(\"train-images\")\n    check(err)\n\n    canvas := image.NewRGBA(image.Rect(0, 0, imgSideLength, imgSideLength))\n\n    pixelIndex := imgNum\n    for i := 0; i &lt; imgSideLength; i++ {\n        for j := 0; j &lt; imgSideLength; j++ {\n            currPixel := images[pixelIndex]\n            pixelIndex++\n\n            pixelColor := color.RGBA{currPixel, currPixel, currPixel, 255}\n            canvas.Set(j, i, pixelColor)\n        }   \n    }\n\n    numFile, err := os.Create(\"number.png\")\n    check(err)\n    defer numFile.Close()\n\n    png.Encode(numFile, canvas)\n}\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n</code></pre>\n\n<p>Knowing that those 16 pixels are the ones that causes the image to shift, I decided to modify imgNum:</p>\n\n<pre><code>imgNum = 499 * imgSize + 16\n</code></pre>\n\n<p>With that change, the image draws fine. </p>\n\n<p><a href=\"https://i.stack.imgur.com/k9aSM.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/k9aSM.png\" alt=\"enter image description here\"></a></p>\n\n<p>But I would still like to know why are there an extra 16 numbers where there shouldn't be?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2709, "user_id": 5189673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5a1a8d2328d31cdd52ed37dee8d91d4?s=128&d=identicon&r=PG&f=1", "display_name": "Leon", "link": "https://stackoverflow.com/users/5189673/leon"}, "is_accepted": true, "score": 4, "last_activity_date": 1536520534, "creation_date": 1536520534, "answer_id": 52247866, "question_id": 52247757, "link": "https://stackoverflow.com/questions/52247757/create-method-to-a-slice-type/52247866#52247866", "title": "Create method to a slice type", "body": "<p>You are getting a pointer to <code>SliceStr</code> (<code>*SliceStr</code>), not <code>SliceStr</code> and therefore not a slice-type. Just dereference the pointer</p>\n\n<pre><code>func (ss *SliceStr) Add(s string) {\n    *ss = append(*ss, s)\n}\n</code></pre>\n\n<p>and it works just fine. <code>*ss = ...</code> sets the value <code>ss</code> is pointing to and the <code>*ss</code> in the call to <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\"><code>append</code></a> passes it the value <code>ss</code> is pointing to, instead of the pointer.</p>\n"}], "owner": {"reputation": 29, "user_id": 5017196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/082c943310fdd05d1d0fb195e8889aa7?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/5017196/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "accepted_answer_id": 52247866, "answer_count": 1, "score": 0, "last_activity_date": 1536563067, "creation_date": 1536519862, "last_edit_date": 1536563067, "question_id": 52247757, "link": "https://stackoverflow.com/questions/52247757/create-method-to-a-slice-type", "title": "Create method to a slice type", "body": "<p>I am new to golang. I am trying to add a method to a slice. The method is just a wrapper of append, which does not work.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype SliceStr []string\n\nfunc (ss *SliceStr) Add(s string) {\n    ss = append(ss, s)\n}\n\nfunc main() {\n    var s SliceStr\n\n    s.Add(\"hello\")\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>prog.go:10:12: first argument to append must be slice; have *SliceStr</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 572, "user_id": 1369587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c45b8df80bdc328da043f13f0f21f891?s=128&d=identicon&r=PG", "display_name": "Dygnus", "link": "https://stackoverflow.com/users/1369587/dygnus"}, "edited": false, "score": 0, "creation_date": 1536520864, "post_id": 52247852, "comment_id": 91443607, "body": "I&#39;m afraid that&#39;s the only performing solution, I was thinking likely right after posting the question."}], "tags": [], "owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "is_accepted": false, "score": 6, "last_activity_date": 1536520416, "creation_date": 1536520416, "answer_id": 52247852, "question_id": 52247755, "link": "https://stackoverflow.com/questions/52247755/remove-first-n-lines-of-file/52247852#52247852", "title": "Remove first N lines of file", "body": "<p>Filesystems doesn't support deleting from arbitrary locations of a file, so you at least need to re-write the entire file yourself. The common way to implement what you need is to </p>\n\n<ul>\n<li>Open a temporary file,</li>\n<li>read small pieces from the original file, e.g. one line at a time in your case</li>\n<li>Write only lines you want to retain in the original file to the temporary file</li>\n<li>rename the temporary file to the original filename when done.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": false, "score": 0, "last_activity_date": 1536533068, "creation_date": 1536533068, "answer_id": 52249186, "question_id": 52247755, "link": "https://stackoverflow.com/questions/52247755/remove-first-n-lines-of-file/52249186#52249186", "title": "Remove first N lines of file", "body": "<p>Are you trying to do something akin to log truncation and rotation?</p>\n\n<p>A common pattern that might help you would be to split logs across multiple files and overwrite or delete files in the order they were created.</p>\n\n<p>For example you might have <code>2018-09-09.log.txt</code> or <code>log.1.txt</code> and rotate to a new log file every hour. That way older files could be deleted to free up space.</p>\n\n<p>Other than that, I don't think there is a specific way to remove early lines of a file in Go without rewriting the remainder of the file.</p>\n"}, {"comments": [{"owner": {"reputation": 572, "user_id": 1369587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c45b8df80bdc328da043f13f0f21f891?s=128&d=identicon&r=PG", "display_name": "Dygnus", "link": "https://stackoverflow.com/users/1369587/dygnus"}, "edited": false, "score": 0, "creation_date": 1536653631, "post_id": 52265423, "comment_id": 91490164, "body": "I wonder if you don&#39;t miss out on changes when a log-file is heavily written, when rewriting the file without the first N lines. In the time that this script takes to process the input file, the file itself could have been changed. This could result in losing a some data.  Since you&#39;re returning the contents of the tailed data with <code>GoTail()</code> I can imagine (depending on the file being inspected), this could be heavily consuming memory."}, {"owner": {"reputation": 194, "user_id": 1478294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b079763724f5d11cd9381594bb925d?s=128&d=identicon&r=PG", "display_name": "Dippo", "link": "https://stackoverflow.com/users/1478294/dippo"}, "reply_to_user": {"reputation": 572, "user_id": 1369587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c45b8df80bdc328da043f13f0f21f891?s=128&d=identicon&r=PG", "display_name": "Dygnus", "link": "https://stackoverflow.com/users/1369587/dygnus"}, "edited": false, "score": 1, "creation_date": 1536701154, "post_id": 52265423, "comment_id": 91517056, "body": "@Dygnus I updated the code solving the issue you pointed to me. Thank you!"}], "tags": [], "owner": {"reputation": 194, "user_id": 1478294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1b079763724f5d11cd9381594bb925d?s=128&d=identicon&r=PG", "display_name": "Dippo", "link": "https://stackoverflow.com/users/1478294/dippo"}, "is_accepted": false, "score": 1, "last_activity_date": 1536701043, "last_edit_date": 1536701043, "creation_date": 1536613233, "answer_id": 52265423, "question_id": 52247755, "link": "https://stackoverflow.com/questions/52247755/remove-first-n-lines-of-file/52265423#52265423", "title": "Remove first N lines of file", "body": "<p>The most efficient way to do this is read the file backwards. </p>\n\n<pre><code>/*\n    This package implements funcationality similar to the UNIX command tail.\n    It prints out the last \"x\" many lines of a file, usually 10.\n    The number of lines in a file is determined by counting newline (\\n) characters.\n    This can be use either from CLI or imported into other projects.\n*/\n\npackage main\n\nimport (\n    \"errors\"\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nvar (\n    //DEFINE FLAG DEFAULTS\n    filename = \"\"\n    numLines = 10\n\n    //ErrNoFilename is thrown when the path the the file to tail was not given\n    ErrNoFilename = errors.New(\"You must provide the path to a file in the \\\"-file\\\" flag.\")\n\n    //ErrInvalidLineCount is thrown when the user provided 0 (zero) as the value for number of lines to tail\n    ErrInvalidLineCount = errors.New(\"You cannot tail zero lines.\")\n)\n\n//GET FLAGS FROM CLI\nfunc init() {\n    flag.StringVar(&amp;filename, \"file\", \"\", \"Filename to get last lines of text from.\")\n    flag.IntVar(&amp;numLines, \"n\", numLines, \"Number of lines to get from end of file.\")\n    flag.Parse()\n}\n\n//MAIN FUNCTIONALITY OF APP\n//make sure filename (path to file) was given\n//run it through the tailing function\n//print the output to stdout\nfunc main() {\n    //TAIL\n    text, err := GoTail(filename, numLines)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    //DONE\n    fmt.Print(text)\n    return\n}\n\n//GoTail IS THE FUNCTION THAT ACTUALLY DOES THE \"TAILING\"\n//this can be used this package is imported into other golang projects\nfunc GoTail(filename string, numLines int) (string, error) {\n    //MAKE SURE FILENAME IS GIVEN\n    //actually, a path to the file\n    if len(filename) == 0 {\n        return \"\", ErrNoFilename\n    }\n\n    //MAKE SURE USER WANTS TO GET AT LEAST ONE LINE\n    if numLines == 0 {\n        return \"\", ErrInvalidLineCount\n    }\n\n    //OPEN FILE\n    file, err := os.Open(filename)\n    if err != nil {\n        return \"\", err\n    }\n    defer file.Close()\n\n    //SEEK BACKWARD CHARACTER BY CHARACTER ADDING UP NEW LINES\n    //offset must start at \"-1\" otherwise we are already at the EOF\n    //\"-1\" from numLines since we ignore \"last\" newline in a file\n    numNewLines := 0\n    var offset int64 = -1\n    var finalReadStartPos int64\n    for numNewLines &lt;= numLines-1 {\n        //seek to new position in file\n        startPos, err := file.Seek(offset, 2)\n        if err != nil {\n            return \"\", err\n        }\n\n        //make sure start position can never be less than 0\n        //aka, you cannot read from before the file starts\n        if startPos == 0 {\n            //set to -1 since we +1 to this below\n            //the position will then start from the first character\n            finalReadStartPos = -1\n            break\n        }\n\n        //read the character at this position\n        b := make([]byte, 1)\n        _, err = file.ReadAt(b, startPos)\n        if err != nil {\n            return \"\", err\n        }\n\n        //ignore if first character being read is a newline\n        if offset == int64(-1) &amp;&amp; string(b) == \"\\n\" {\n            offset--\n            continue\n        }\n\n        //if the character is a newline\n        //add this to the number of lines read\n        //and remember position in case we have reached our target number of lines\n        if string(b) == \"\\n\" {\n            numNewLines++\n            finalReadStartPos = startPos\n        }\n\n        //decrease offset for reading next character\n        //remember, we are reading backward!\n        offset--\n    }\n\n    //READ TO END OF FILE\n    //add \"1\" here to move offset from the newline position to first character in line of text\n    //this position should be the first character in the \"first\" line of data we want\n    endPos, err := file.Seek(int64(-1), 2)\n    if err != nil {\n        return \"\", err\n    }\n    b := make([]byte, (endPos+1)-finalReadStartPos)\n    _, err = file.ReadAt(b, finalReadStartPos+1)\n    if err == io.EOF {\n        return string(b), nil\n    } else if err != nil {\n        return \"\", err\n    }\n\n    //special case\n    //if text is read, then err == io.EOF should hit\n    //there should *never* not be an error above\n    //so this line should never return\n    return \"**No error but no text read.**\", nil\n}\n</code></pre>\n\n<p>In the console you must type : <code>gotail -file &lt;filename&gt; -n=&lt;number of lines&gt;</code>\nSo with this you can read the last number of lines from the end of the file. If you want all lines except the first 10 lines, then i will alter this code. </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 4607662, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-8GcYl7Hc4gI/AAAAAAAAAAI/AAAAAAAAB3w/_GwKpTsbV-Q/photo.jpg?sz=128", "display_name": "Aditya Gupta", "link": "https://stackoverflow.com/users/4607662/aditya-gupta"}, "is_accepted": false, "score": 0, "last_activity_date": 1536613790, "creation_date": 1536613790, "answer_id": 52265519, "question_id": 52247755, "link": "https://stackoverflow.com/questions/52247755/remove-first-n-lines-of-file/52265519#52265519", "title": "Remove first N lines of file", "body": "<p>You can find the total number of lines in the file using <code>wc -l &lt;fileName&gt;</code> let it be <code>x</code>, and suppose u want to read all lines except first 1000 then use <code>tail -n&lt;x-1000&gt; &lt;fileName&gt;</code>.</p>\n\n<p>An efficient way would be to use the sed. See <a href=\"https://unix.stackexchange.com/questions/138398/how-to-get-lines-10-to-100-from-a-200-line-file-into-a-new-file\">this</a> answer </p>\n"}], "owner": {"reputation": 572, "user_id": 1369587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c45b8df80bdc328da043f13f0f21f891?s=128&d=identicon&r=PG", "display_name": "Dygnus", "link": "https://stackoverflow.com/users/1369587/dygnus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2455, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1539018694, "creation_date": 1536519848, "last_edit_date": 1536571412, "question_id": 52247755, "link": "https://stackoverflow.com/questions/52247755/remove-first-n-lines-of-file", "title": "Remove first N lines of file", "body": "<p>I was wondering how I can remove the first N lines of a specific file <strong>efficiently</strong>. </p>\n\n<p>Of course, we can load the complete file into memory, then remove the first N lines and write the complete changed contents to the file.</p>\n\n<p>But, I was wondering if there is a way to make this more effective compared to just loading all contents in memory.</p>\n"}, {"tags": ["go", "networking", "encoding", "stream"], "owner": {"reputation": 11, "user_id": 4409440, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c406678ab54e8d971852bd151691f5d1?s=128&d=identicon&r=PG&f=1", "display_name": "Doz", "link": "https://stackoverflow.com/users/4409440/doz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1536613694, "creation_date": 1536518804, "last_edit_date": 1536613694, "question_id": 52247602, "link": "https://stackoverflow.com/questions/52247602/how-would-i-reliably-encode-and-send-an-opencv-mat-object-in-go-using-encoding", "title": "How would I reliably encode and send an OpenCV Mat object in Go using &quot;encoding/gob&quot;?", "body": "<p>This is a heavily edited post. </p>\n\n<p>I\u2019m working on a client/server setup to practice golang where I use gocv to grab an image from my webcam and process it on a remote server using gocv again. Both processes are written in Go. What would be the best way to transmit the mat to the server process?</p>\n\n<p>I have already tried to use gob like so:</p>\n\n<pre><code>func svr(){\n\n    ln, _ := net.Listen(\"tcp\", \":8090\")\n    conn, _ := ln.Accept()\n    dec := gob.NewDecoder(conn)\n    var p gocv.Mat\n\n    dec.Decode(&amp;p)\n\n    gocv.IMWrite(\"copy.jpg\", p)\n    conn.Close()\n\n}\n\nfunc clnt(){\n\n    time.Sleep(19999)\n\n    conn, _ := net.Dial(\"tcp\", \"localhost:8090\")\n    encoder := gob.NewEncoder(conn)\n    var chip gocv.Mat\n    chip = gocv.IMRead(\"test.jpg\", 0)\n    encoder.Encode(chip)\n\n}\n\nfunc main(){\n\n    go svr()\n\n    clnt()\n    time.Sleep(10000)\n}\n</code></pre>\n\n<p>The program doesn't return any errors but doesn't create a file, either. I'm not sure what's wrong here. What am I doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1536517519, "post_id": 52247411, "comment_id": 91442781, "body": "So just copy the relevant fields."}, {"owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536517570, "post_id": 52247411, "comment_id": 91442799, "body": "Is there any other way, these structs are going to get bigger, i was looking for a smart solution. In python, if i want to create a copy of a list on some condition, I dont do element wise operation, just saying."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 1, "creation_date": 1536519017, "post_id": 52247411, "comment_id": 91443122, "body": "Go isn&#39;t Python, just saying. Maybe you should clarify why you don&#39;t want to do it by hand (it&#39;ll only be a couple lines of code, if your structs are so massive that it isn&#39;t a couple lines of code then you have a different problem) or why you don&#39;t want to use reflection."}, {"owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "edited": false, "score": 0, "creation_date": 1536519266, "post_id": 52247411, "comment_id": 91443196, "body": "lesson learnt, I will not compare any languages from now on. Just out of curiosity, what kind of problems i would face when i would have massive structs."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1536523480, "post_id": 52247411, "comment_id": 91444336, "body": "&quot;what kind of problems i would face when i would have massive structs&quot; None. At least none from copying."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1536571370, "post_id": 52247411, "comment_id": 91456722, "body": "@muistooshort &quot;Go isn&#39;t Python&quot; Quote of the day..."}], "answers": [{"tags": [], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "is_accepted": true, "score": 3, "last_activity_date": 1536707362, "last_edit_date": 1536707362, "creation_date": 1536519128, "answer_id": 52247658, "question_id": 52247411, "link": "https://stackoverflow.com/questions/52247411/copy-common-fields-between-structs-of-different-types/52247658#52247658", "title": "Copy common fields between structs of different types", "body": "\n\n<p><strong>Go is a statically typed language</strong> (and is not Python). If you want to copy fields between the structs, you must either <strong>cause code to be supplied at compile time</strong> which knows how to do this, or <strong>use the <code>reflect</code> library</strong> to perform the operation at runtime.</p>\n\n<hr>\n\n<p>Note that I said \"cause code to be supplied at compile time\" because you <em>don't have to explicitly write that code</em>. You could use code generation to produce the copy code from the struct definitions, or from a higher-level definition (e.g. XML) which generates both the struct definition and the copying code.</p>\n\n<p>However, <strong>good Go programmers prefer clear code over clever solutions</strong>. If this is a single localized requirement, writing a code generator to avoid \"boilerplate\" code is almost certainly overkill; its implementation will take longer than the code to copy the structs, and the associated complexity will introduce a risk of more bugs. Similarly, <code>reflect</code>-based solutions are complicated, <em>not</em> clear, and  only recommended in cases where you require a generic or extensible solution, and where this cannot be fulfilled at compile time.</p>\n\n<p>I recommend simply write the copying code, and add appropriate comments to the <code>struct</code> definitions and copy methods to ensure future maintainers are aware of their obligation to maintain the copy methods.</p>\n\n<hr>\n\n<h2>Example</h2>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Define your types - bodies elided for brevity\n\n// NOTE TO MAINTAINERS: if editing the fields in these structs, ensure\n// the methods defined in source file &lt;filename&gt;.go are updated to\n// ensure common fields are copied between structs on instantiation.\ntype UserStruct struct { ... }\ntype SecretStruct struct { ... }\n\n// NewSecretStructFromUserStruct populates and returns a SecretStruct\n// from the elements common to the two types. This method must be\n// updated if the set of fields common to both structs is changed in\n// future.\nfunc NewSecretStructFromUserStruct(us *UserStruct) *SecretStruct {\n    // You should take care to deep copy where necessary,\n    // e.g. for any maps shared between the structs (not\n    // currently the case).\n    ss := new(SecretStruct)\n    ss.UserID = us.UserID\n    ss.Address = us.Address\n    ss.Email = us.Email\n    ss.CreatedAt = us.CreatedAt\n    ss.PhoneNumber = us.PhoneNumber\n    ss.PanCard = us.PanCard\n    return ss\n}\n\n// You may also consider this function to be better suited as\n// a receiver method on UserStruct.\n</code></pre>\n"}], "owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 52247658, "answer_count": 1, "score": -2, "last_activity_date": 1536707362, "creation_date": 1536517443, "last_edit_date": 1536558495, "question_id": 52247411, "link": "https://stackoverflow.com/questions/52247411/copy-common-fields-between-structs-of-different-types", "title": "Copy common fields between structs of different types", "body": "\n\n<p>I have two structs, whose types are as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type UserStruct struct {\n    UserID      string            `bson:\"user_id\" json:\"user_id\"`\n    Address     string            `bson:\"address\" json:\"address\"`\n    Email       string            `bson:\"email\" json:\"email\"`\n    CreatedAt   time.Time         `bson:\"created_at\" json:\"created_at\"`\n    PhoneNumber string            `bson:\"phone_number\" json:\"phone_number\"`\n    PanCard     string            `bson:\"pancard\" json:\"pancard\"`\n    Details     map[string]string `json:\"details\"`\n}\n\ntype SecretsStruct struct {\n    UserID      string    `r:\"user_id\" json:\"user_id\"`\n    Secrets     []string  `r:\"secrets\" json:secrets`\n    Address     string    `r:\"address\" json:\"address\"`\n    Email       string    `r:\"email\"json:\"email\"`\n    CreatedAt   time.Time `r:\"created_at\"json:\"created_at\"`\n    PhoneNumber string    `r:\"phone_number\" json:\"phone_number\"`\n    PanCard     string    `r:\"pancard\" json:\"pancard\"`\n}\n</code></pre>\n\n<p>I already have an instance of <code>UserStruct</code>. I want to copy the fields common to both structs from <code>UserStruct</code> to a new instance of <code>SecretStruct</code>, without using reflection.</p>\n"}, {"tags": ["api", "docker", "go", "vendor"], "comments": [{"owner": {"reputation": 7023, "user_id": 790075, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fdb8ce54c398b1aa794833a601507361?s=128&d=identicon&r=PG", "display_name": "turtlemonvh", "link": "https://stackoverflow.com/users/790075/turtlemonvh"}, "edited": false, "score": 1, "creation_date": 1536517545, "post_id": 52247374, "comment_id": 91442792, "body": "What were the steps you took then you tried to update dep to &quot;the actual commit&quot;?  Using a git commit hash usually works.  You need to update <code>Gopkg.toml </code> with the new reference and run <code>dep ensure</code> as documented here: <a href=\"https://golang.github.io/dep/docs/daily-dep.html\" rel=\"nofollow noreferrer\">golang.github.io/dep/docs/daily-dep.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 598, "user_id": 38413, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/155702d497cd4fe07b166296b5b2fb5f?s=128&d=identicon&r=PG", "display_name": "RoKK", "link": "https://stackoverflow.com/users/38413/rokk"}, "is_accepted": true, "score": 0, "last_activity_date": 1536522204, "creation_date": 1536522204, "answer_id": 52248092, "question_id": 52247374, "link": "https://stackoverflow.com/questions/52247374/how-can-i-properly-vendor-github-com-docker-docker/52248092#52248092", "title": "how can i properly vendor github.com/docker/docker?", "body": "<pre><code>[[constraint]]\n  name = \"github.com/docker/docker\"\n  branch = \"master\"\n\n[[override]]\n  name = \"github.com/docker/distribution\"\n  branch = \"master\"\n</code></pre>\n\n<p>Actually this two entries helped solve the dependency issue in <code>Gopkg.toml</code>, then running <code>dep ensure</code></p>\n"}], "owner": {"reputation": 598, "user_id": 38413, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/155702d497cd4fe07b166296b5b2fb5f?s=128&d=identicon&r=PG", "display_name": "RoKK", "link": "https://stackoverflow.com/users/38413/rokk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 52248092, "answer_count": 1, "score": 1, "last_activity_date": 1536522204, "creation_date": 1536517116, "question_id": 52247374, "link": "https://stackoverflow.com/questions/52247374/how-can-i-properly-vendor-github-com-docker-docker", "title": "how can i properly vendor github.com/docker/docker?", "body": "<p>here my main.go</p>\n\n<pre><code>package cmd\n\nimport (\n    \"context\"\n    \"fmt\"\n\n    \"github.com/docker/docker/api/types\"\n    \"github.com/docker/docker/client\"\n)\n\nfunc main() {\n    cli, err := client.NewClientWithOpts(client.WithVersion(\"1.38\"))\n    if err != nil {\n        panic(err)\n    }\n\n    networks, err := cli.NetworkList(context.Background(), types.NetworkListOptions{})\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(networks)\n}\n</code></pre>\n\n<p>i tried to run <code>dep init</code> but vendor folder ended up with an older version of docker/docker because the newest tag is 17.05 tried to pin the actual commit but that did not work either</p>\n\n<p>i give a shot to <code>go mod vendor</code> but that also rely on git tags</p>\n\n<p>Strangely enough docker/docker is an alias to moby/moby and docker/engine.</p>\n\n<p>Anyone could explain me and give example how can i successfully use vendoring with docker API?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": true, "score": 4, "last_activity_date": 1536512139, "creation_date": 1536512139, "answer_id": 52246714, "question_id": 52246540, "link": "https://stackoverflow.com/questions/52246540/failed-to-parse-trace-no-evfrequency-event/52246714#52246714", "title": "Failed to parse trace: no EvFrequency event", "body": "<p>Trace data can only be viewed after you stopped the trace (i.e. after <code>trace.Stop()</code> has been called). In the code you supplied <code>http.ListenAndServer(...)</code> will block forever (unless it runs into an error).</p>\n\n<p>Are you trying to view the trace before the trace has been stopped?</p>\n\n<p>One solution might be to wait for an interrupt signal and then exit the function when received which would cause the tracing to be stopped and written.</p>\n\n<pre><code>func main() {\n    f, err := os.Create(\"trace.out\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    err = trace.Start(f)\n    if err != nil {\n        panic(err)\n    }\n    defer trace.Stop()\n\n    http.HandleFunc(\"/\", someFunc)\n    go func() {\n        log.Fatal(http.ListenAndServe(\":5000\", nil))\n    }()\n\n    signalChan := make(chan os.Signal, 1)\n    signal.Notify(signalChan, os.Interrupt)\n    &lt;-signalChan\n}\n</code></pre>\n"}], "owner": {"reputation": 4322, "user_id": 162414, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/d7fd5d3b2926236f63384ba2ca7f1eb0?s=128&d=identicon&r=PG", "display_name": "Gabriel A. Zorrilla", "link": "https://stackoverflow.com/users/162414/gabriel-a-zorrilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 660, "favorite_count": 0, "accepted_answer_id": 52246714, "answer_count": 1, "score": 2, "last_activity_date": 1545640472, "creation_date": 1536510838, "last_edit_date": 1545640472, "question_id": 52246540, "link": "https://stackoverflow.com/questions/52246540/failed-to-parse-trace-no-evfrequency-event", "title": "Failed to parse trace: no EvFrequency event", "body": "<p>I generate a trace like this:</p>\n\n<pre><code>func main() {\n    f, err := os.Create(\"trace.out\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    err = trace.Start(f)\n    if err != nil {\n        panic(err)\n    }\n    defer trace.Stop()\n//this is my app:\n    http.HandleFunc(\"/\", someFunc)\n    log.Fatal(http.ListenAndServe(\":5000\", nil))\n}\n</code></pre>\n\n<p>Then i run in the CLI:</p>\n\n<pre><code>$ go run main.go\n</code></pre>\n\n<p>Refresh browser, trace.out is generated, 1.8 MB, then:</p>\n\n<pre><code>$ go tool trace trace.out\n018/09/09 13:25:18 Parsing trace...\nfailed to parse trace: no EvFrequency event\n</code></pre>\n\n<p>What am I missing here? Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1536513639, "post_id": 52246487, "comment_id": 91441844, "body": "It looks like you already found the equivalent in Go. What is your question?"}], "answers": [{"tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": false, "score": 1, "last_activity_date": 1536512454, "creation_date": 1536512454, "answer_id": 52246758, "question_id": 52246487, "link": "https://stackoverflow.com/questions/52246487/what-are-regex-grep-applied-to-files-equivalents-in-golang/52246758#52246758", "title": "What are `regex grep`, applied to files, equivalents in Golang?", "body": "<p>You might want to check out the optimizations made by <a href=\"https://github.com/ggreer/the_silver_searcher\" rel=\"nofollow noreferrer\">the silver searcher</a> (a.k.a <code>ag</code>). It does a number of optimizations in order to have extremely fast code search.</p>\n\n<p>Another option might be to pre-construct an index so searches are even fast than anything performed in real time. In the <code>ag</code> README, <a href=\"http://ctags.sourceforge.net/\" rel=\"nofollow noreferrer\">exuberant ctags</a> is referenced which does this and could work for extremely large code bases.</p>\n"}], "owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1536512454, "creation_date": 1536510545, "question_id": 52246487, "link": "https://stackoverflow.com/questions/52246487/what-are-regex-grep-applied-to-files-equivalents-in-golang", "title": "What are `regex grep`, applied to files, equivalents in Golang?", "body": "<p><strong>Problem</strong></p>\n\n<p>I am now running a regex grep to multiple files in order to get all TODOs, but it takes a couple of minutes before the commands completes:</p>\n\n<pre><code>real    5m8.073s\nuser    0m35.593s\nsys     4m17.608s\n</code></pre>\n\n<p><strong>Aim</strong></p>\n\n<p>The aim is to get the number of TODOs in no time.</p>\n\n<p><strong>Attempt</strong></p>\n\n<p>According to what I have found on the internet, I think that Golang would be a good candidate and I created the following code.</p>\n\n<pre><code>func check_for_todo(path string) {\n    text := \"//\\\\sTODO\\\\s\\\\d\"\n\n    b, err := ioutil.ReadFile(path)\n    if err != nil {\n        panic(err)\n    }\n    s := string(b)\n\n    // containsTodo := strings.Contains(s, text)\n    containsTodo, _ := regexp.MatchString(text, s)\n\n    if containsTodo {\n        numberOfTodos++\n        fmt.Println(\"This file contains a todo:\", path)\n    }\n}\n</code></pre>\n\n<p><strong>Results</strong></p>\n\n<p>The query is now twice as fast compared to bash.</p>\n\n<pre><code>real    2m17.050s\nuser    0m0.015s\nsys     0m0.015s\n</code></pre>\n\n<p><strong>Discussion</strong></p>\n\n<p>I have the feeling that this code could be optimized and is currently devious. I am now looking into channels and goroutines.</p>\n"}, {"tags": ["arrays", "go", "garbage-collection", "cgo"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1536516633, "post_id": 52246481, "comment_id": 91442539, "body": "I&#39;ve never played too much with the GC specifically as it relates to cgo, but note that the slice header and the underlying array are two entirely separate memory allocations.  Slice headers can and often are GC&#39;d without the underlying array being GC&#39;d because that array is still referenced somewhere else.  So there&#39;s no reason to expect the underlying data to necessarily be GC&#39;d just because the slice header is.  It&#39;s also worth noting that the slice header in this case is almost certainly allocated on the stack, since it is returned as a copy (ie. not as a <code>*[]byte</code>)."}], "owner": {"reputation": 1595, "user_id": 673474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8de335ff4b6aae11f54a318741e5a239?s=128&d=identicon&r=PG", "display_name": "Zv_oDD", "link": "https://stackoverflow.com/users/673474/zv-odd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 194, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1536512831, "creation_date": 1536510451, "last_edit_date": 1536512831, "question_id": 52246481, "link": "https://stackoverflow.com/questions/52246481/will-go-gc-attempted-to-free-an-external-heap-from-unsafe-pointer-in-a-reflect", "title": "Will Go GC attempted to free an &quot;external heap&quot; from unsafe.Pointer in a reflect.SliceHeader struct?", "body": "<p>So I found out how to create a slice from an unsafe pointer in Go:</p>\n\n<pre><code>func cArray2ByteSlice(array unsafe.Pointer, len int) (list []byte) {\n    sliceHeader := (*reflect.SliceHeader)((unsafe.Pointer(&amp;list)))\n    sliceHeader.Cap = len\n    sliceHeader.Len = len\n    sliceHeader.Data = uintptr(array)\n    return list\n}\n</code></pre>\n\n<p>I have a window of opportunity to access the heap memory at <code>array unsafe.Pointer</code> between calling the external C API <code>lock</code> and <code>unlock</code>.</p>\n\n<p>The GC will eventually attempt to collect the slice <code>list []byte</code>.\nThe thing is:  the slice header is in golang allocated heap, but the <code>sliceHeader.Data</code> is not.</p>\n\n<p>Is the GC smart enough to ignore none-golang heap allocation in that situation, as in most others?</p>\n\n<p>After calling <code>unlock</code>, I want to be sure that Go GC doesn't attempt to release the heap memeory at <code>sliceHeader.Data</code>.</p>\n\n<p>Also if I want to copy the data for use outside of the <code>lock</code>/<code>unlock</code> period, I assume I could return this var instead:</p>\n\n<pre><code> var safeList []byte = list[:]\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "cgo"], "comments": [{"owner": {"reputation": 27690, "user_id": 362589, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/125a471032cdef6e8de28ff6d54c7324?s=128&d=identicon&r=PG", "display_name": "Dani", "link": "https://stackoverflow.com/users/362589/dani"}, "edited": false, "score": 0, "creation_date": 1536494399, "post_id": 52244284, "comment_id": 91436884, "body": "Your call stack includes the name \u2018vectorization\u2019. Do you use any advanced opcodes? It might be that not all aws\u2019s processors support them. Can you get a disassembly of the offending instruction?"}, {"owner": {"reputation": 31, "user_id": 9328421, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-taP-qRSOpo8/AAAAAAAAAAI/AAAAAAAAFGE/3vCnjfcylyg/photo.jpg?sz=128", "display_name": "Adam Sowinski", "link": "https://stackoverflow.com/users/9328421/adam-sowinski"}, "reply_to_user": {"reputation": 27690, "user_id": 362589, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/125a471032cdef6e8de28ff6d54c7324?s=128&d=identicon&r=PG", "display_name": "Dani", "link": "https://stackoverflow.com/users/362589/dani"}, "edited": false, "score": 0, "creation_date": 1536495148, "post_id": 52244284, "comment_id": 91437136, "body": "I&#39;m using Dlib and OpenBLAS.  Below I added Compile parameters. Sorry, but I&#39;m not familiar with low-level programming so, I don&#39;t know what and how to disassemble this binary and what to look for.  <code>#cgo CXXFLAGS: -Wall -Wno-sign-compare -g0 -O3 -std=c++11 -march=native -DNDEBUG -DDLIB_NO_GUI_SUPPORT -DNO_MAKEFILE -DDLIB_JPEG_SUPPORT -DDLIB_USE_BLAS -DDLIB_USE_LAPACK -DLAPACK_FORCE_UNDERSCORE -mavx</code>"}, {"owner": {"reputation": 27690, "user_id": 362589, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/125a471032cdef6e8de28ff6d54c7324?s=128&d=identicon&r=PG", "display_name": "Dani", "link": "https://stackoverflow.com/users/362589/dani"}, "edited": false, "score": 0, "creation_date": 1536529478, "post_id": 52244284, "comment_id": 91445814, "body": "The -mavx can be the issue"}], "owner": {"reputation": 31, "user_id": 9328421, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-taP-qRSOpo8/AAAAAAAAAAI/AAAAAAAAFGE/3vCnjfcylyg/photo.jpg?sz=128", "display_name": "Adam Sowinski", "link": "https://stackoverflow.com/users/9328421/adam-sowinski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 213, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1536527951, "creation_date": 1536494115, "last_edit_date": 1536527951, "question_id": 52244284, "link": "https://stackoverflow.com/questions/52244284/awl-lambda-cgo-not-deterministic-sigill-illegal-instruction", "title": "AWL Lambda CGO not deterministic SIGILL: illegal instruction", "body": "<p>I tried to test AWS lambda function with golang and cgo. I compiled everything on Amazon Linux AMI 2018.03.0 (HVM) and attached all necessary libraries. When I run it looks like a lambda function is not deterministic. Sometimes it's working properly and sometimes I get an exception attached below. It looks like lambda has two different environments (architectures). When it's working properly, lambda response properly to every query until will die or I will deploy a new version. The same binary working now and not working in half an hour. </p>\n\n<pre><code>SIGILL: illegal instruction\nPC=0xb94571 m=10 sigcode=2\n\ngoroutine 0 [idle]:\nruntime: unknown pc 0xb94571\nstack: frame={sp:0x7f8957ffcef0, fp:0x0} stack=[0x7f89577fd830,0x7f8957ffd430)\n00007f8957ffcdf0: 00007f8950000078 00007f8968e64de2 \n00007f8957ffce00: 0000000800000002 0000000000001000 \n00007f8957ffce10: 3ff0000000000000 0000000000000000 \n00007f8957ffce20: 0000000100000000 0000000000000001 \n00007f8957ffce30: 0000000100000002 0000000000000100 \n00007f8957ffce40: 0000000000000000 00000000014351f8 \n00007f8957ffce50: 00000000000000fa 00007f8950000078 \n00007f8957ffce60: 00007f8950000020 000000000002d97e \n00007f8957ffce70: 0000000000002710 000000000002d990 \n00007f8957ffce80: 00007f8950000078 00007f8968e65ba5 \n00007f8957ffce90: 000000000002d97e 00007f896c05b5c4 \n00007f8957ffcea0: 0000000000000b66 00007f89693c3678 \n00007f8957ffceb0: 0000000000000005 000000000000000b \n00007f8957ffcec0: 000000000f71e367 00007f896c05bcfb \n00007f8957ffced0: 0000007c0000009b 00007f8957ffcf10 \n00007f8957ffcee0: 00007f89693c30ec 00007f89693c3c48 \n00007f8957ffcef0: &lt;00007f8957ffd020 00007f8957ffd010 \n00007f8957ffcf00: d04e2b6900000027 eeba4bc401709342 \n00007f8957ffcf10: 0000000000000000 3fdfdf19b3eb7010 \n00007f8957ffcf20: 00000000000005e2 00007f8964663010 \n00007f8957ffcf30: 00000000000000f8 00000000000001f6 \n00007f8957ffcf40: 00000000000001f3 00000000000002ee \n00007f8957ffcf50: 0000000000000000 00007f896c107010 \n00007f8957ffcf60: 0000000000000000 bfdfdf19b3eb7010 \n00007f8957ffcf70: 00007f896c26aca8 00007f896c2754a8 \n00007f8957ffcf80: 00007f896c275150 00007f896c05bfdf \n00007f8957ffcf90: 00000000000000f9 00007f896c26aca8 \n00007f8957ffcfa0: 0000000000000005 0000000000000000 \n00007f8957ffcfb0: 00007f8900000001 00007f896c275150 \n00007f8957ffcfc0: 00007f8957ffd0f0 00007f8957ffd0e0 \n00007f8957ffcfd0: 00007f8900000029 0000000000b7652d \n00007f8957ffcfe0: 0000000000000000 00007f896c2754a8 \nruntime: unknown pc 0xb94571\nstack: frame={sp:0x7f8957ffcef0, fp:0x0} stack=[0x7f89577fd830,0x7f8957ffd430)\n00007f8957ffcdf0: 00007f8950000078 00007f8968e64de2 \n00007f8957ffce00: 0000000800000002 0000000000001000 \n00007f8957ffce10: 3ff0000000000000 0000000000000000 \n00007f8957ffce20: 0000000100000000 0000000000000001 \n00007f8957ffce30: 0000000100000002 0000000000000100 \n00007f8957ffce40: 0000000000000000 00000000014351f8 \n00007f8957ffce50: 00000000000000fa 00007f8950000078 \n00007f8957ffce60: 00007f8950000020 000000000002d97e \n00007f8957ffce70: 0000000000002710 000000000002d990 \n00007f8957ffce80: 00007f8950000078 00007f8968e65ba5 \n00007f8957ffce90: 000000000002d97e 00007f896c05b5c4 \n00007f8957ffcea0: 0000000000000b66 00007f89693c3678 \n00007f8957ffceb0: 0000000000000005 000000000000000b \n00007f8957ffcec0: 000000000f71e367 00007f896c05bcfb \n00007f8957ffced0: 0000007c0000009b 00007f8957ffcf10 \n00007f8957ffcee0: 00007f89693c30ec 00007f89693c3c48 \n00007f8957ffcef0: &lt;00007f8957ffd020 00007f8957ffd010 \n00007f8957ffcf00: d04e2b6900000027 eeba4bc401709342 \n00007f8957ffcf10: 0000000000000000 3fdfdf19b3eb7010 \n00007f8957ffcf20: 00000000000005e2 00007f8964663010 \n00007f8957ffcf30: 00000000000000f8 00000000000001f6 \n00007f8957ffcf40: 00000000000001f3 00000000000002ee \n00007f8957ffcf50: 0000000000000000 00007f896c107010 \n00007f8957ffcf60: 0000000000000000 bfdfdf19b3eb7010 \n00007f8957ffcf70: 00007f896c26aca8 00007f896c2754a8 \n00007f8957ffcf80: 00007f896c275150 00007f896c05bfdf \n00007f8957ffcf90: 00000000000000f9 00007f896c26aca8 \n00007f8957ffcfa0: 0000000000000005 0000000000000000 \n00007f8957ffcfb0: 00007f8900000001 00007f896c275150 \n00007f8957ffcfc0: 00007f8957ffd0f0 00007f8957ffd0e0 \n00007f8957ffcfd0: 00007f8900000029 0000000000b7652d \n00007f8957ffcfe0: 0000000000000000 00007f896c2754a8 \n\ngoroutine 12 [syscall]:\nruntime.cgocall(0xb20bc0, 0xc420144af0, 0x240)\n/usr/local/go/src/runtime/cgocall.go:128 +0x64 fp=0xc420144ab0 sp=0xc420144a78 pc=0x4b7c84\ngithub.com/app/vectorization._Cfunc_GetFaceRectangles(0xc420413680, 0x7f89500008c0, 0xc, 0x0)\n_cgo_gotypes.go:99 +0x4e fp=0xc420144af0 sp=0xc420144ab0 pc=0xb1df8e\ngithub.com/app/vectorization.GetFaceBoundingRectangles(0xc420402f40, 0x32, 0xc40000000c, 0x0, 0x0, 0x0, 0x0, 0x0)\n...\n</code></pre>\n"}, {"tags": ["api", "go", "slice", "mux", "gocql"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9626387"}, "edited": false, "score": 0, "creation_date": 1536497861, "post_id": 52244669, "comment_id": 91437817, "body": "I get it,so when (for example) i have 5 structs in array, i deleting third, and it goes away from range, because it tries to get into 5th but after deleting third, slice is range of 4 not 5?"}, {"owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "edited": false, "score": 0, "creation_date": 1536498635, "post_id": 52244669, "comment_id": 91437989, "body": "@michasacuer exactly."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1536516921, "post_id": 52244669, "comment_id": 91442629, "body": "And alternative option is to use the 3-part for loop style <code>for i := 0; i &lt; len(data); i++</code>.  Len is checked and on each iteration and thus captures the updated index.  That all said, altering the slice while iterating isn&#39;t actually what&#39;s breaking your code.  You&#39;re iterating over the slice <code>emails</code> but using the index variable to index and subslice <code>structs</code>.  And this works fine as long as you&#39;re only ever cutting one thing out of <code>structs</code>, but once you&#39;re cutting more than one (and it&#39;s at the end), your emails slice is now longer than structs and panics."}], "tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 2, "last_activity_date": 1536497159, "creation_date": 1536497159, "answer_id": 52244669, "question_id": 52244171, "link": "https://stackoverflow.com/questions/52244171/golang-bad-readout-from-slice/52244669#52244669", "title": "GoLang, bad readout from slice", "body": "<p>You shouldn't modify slices while you're iterating over them. The <code>range</code> doesn't know that the slice is now shorter than it was when it started, so eventually it tries to iterate beyond that point and -- whoops! -- there's no more slice to be found.</p>\n\n<p>What I'd recommend doing instead is keeping a separate slice with a list of indexes where the item to be deleted can be found. Then, when you're done iterating over the email slice, you can iterate over this index-tracker slice and delete the relevant items. Make sure you sort the index-tracker slice so that it goes from high indexes to low indexes or you'll end up shortening the slice relative to where the remaining index points are. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9626387"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1536514706, "creation_date": 1536493280, "last_edit_date": 1536514706, "question_id": 52244171, "link": "https://stackoverflow.com/questions/52244171/golang-bad-readout-from-slice", "title": "GoLang, bad readout from slice", "body": "<p>Im pretty new in GoLang and i need some help. Im making simple API app. </p>\n\n<p>pasing structs by API to slice looks like this:</p>\n\n<pre><code>type Struct struct {\n    //some records\n}\n\nvar structs []Struct //slice\n\nfunc SetStruct(w http.ResponseWriter, req *http.Request) {\n    var st Struct\n    decoder := json.NewDecoder(req.Body)\n    decoder.Decode(&amp;st)\n    emails = append(structs, st)\n    json.NewEncoder(w).Encode(structs)\n}\n</code></pre>\n\n<p>And that function works ok. </p>\n\n<p>Second thing i want to do, is to deleting that structs from slice depends on <code>NR</code> parametr. I call it <code>POST</code>. Method looks like this:</p>\n\n<pre><code>func SendStruct(w http.ResponseWriter, req *http.Request) {\n    var st Email\n    decoder := json.NewDecoder(req.Body)\n    decoder.Decode(&amp;st)\n    for i, item := range emails {\n        if item.NR == st.NR {\n            structs = append(structs[:i], structs[i+1:]...)\n            //if numbers match, delete from slice emails\n        }\n    }\n    json.NewEncoder(w).Encode(emails)\n}\n</code></pre>\n\n<p>And it works pretty ok when i have scenerio like (for example):</p>\n\n<pre><code>{\"NR\": \"22\"}\n{\"NR\": \"33\"}\n{\"NR\": \"22\"}\n</code></pre>\n\n<p>When i want to delete <code>\"33\"</code>, it works pretty ok. When i want to delete <code>\"22\"</code> (both of them) things starts to be complicated, because when i pass <code>22</code>, app crashes. </p>\n\n<p>In <code>item.NR</code> (from <code>SendStruct</code>) i get variable out of range. When i add <code>break</code> paarmetr in <code>for</code>, it works ok but i can only deleting structs one-by-one. I want to delete all <code>22</code> in one API call. Error that i get:</p>\n\n<blockquote>\n  <p>http: panic serving [::1]:52163: runtime error: slice bounds out of range</p>\n</blockquote>\n\n<p>Thanks for any advices!</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "edited": false, "score": 2, "creation_date": 1536495570, "post_id": 52244001, "comment_id": 91437253, "body": "You can store it in a <code>string</code> that contains JSON encoded data, and marshal/unmarshal it as you write/read from the DB. However, the reason why this type isn&#39;t supported is because MySQL isn&#39;t supposed to be used like that. You should have an image table with a game ID in it and a path string or something like that instead."}], "answers": [{"tags": [], "owner": {"reputation": 1306, "user_id": 5705686, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jYuOhkTQVgQ/AAAAAAAAAAI/AAAAAAAAA1A/v5x1CDU6W4s/photo.jpg?sz=128", "display_name": "dolan", "link": "https://stackoverflow.com/users/5705686/dolan"}, "is_accepted": true, "score": 3, "last_activity_date": 1536513552, "creation_date": 1536513552, "answer_id": 52246919, "question_id": 52244001, "link": "https://stackoverflow.com/questions/52244001/go-gorm-mysql-unsupported-type-string-a-slice-of-string/52246919#52246919", "title": "Go-gorm mysql &quot;unsupported type []string, a slice of string&quot;", "body": "<p>If you want a list of something in MySql, you have two options</p>\n\n<ol>\n<li>You could serialize the list yourself (into a comma-separated string, json, or another serialization format) and store it in a string or bytes column.</li>\n<li>You can use join to associate the two tables.</li>\n</ol>\n\n<p>gorm supports joins through something it calls associations. In this case, you have a has many association (<a href=\"http://doc.gorm.io/associations.html#has-many\" rel=\"nofollow noreferrer\">http://doc.gorm.io/associations.html#has-many</a>).</p>\n\n<p>An example of how you might do this is:</p>\n\n<pre><code>type Game struct {\n    gorm.Model\n    GameImages   []GameImage\n}\n\ntype GameImage struct {\n    gorm.Model\n    Name string\n}\n\ndb.Model(&amp;game).Related(&amp;gameImages)\n</code></pre>\n"}], "owner": {"reputation": 164, "user_id": 5723095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e34e6a6005a9eb610fe395be4ceb19?s=128&d=identicon&r=PG&f=1", "display_name": "Georgy", "link": "https://stackoverflow.com/users/5723095/georgy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10590, "favorite_count": 1, "accepted_answer_id": 52246919, "answer_count": 1, "score": 3, "last_activity_date": 1539070282, "creation_date": 1536492157, "last_edit_date": 1539070282, "question_id": 52244001, "link": "https://stackoverflow.com/questions/52244001/go-gorm-mysql-unsupported-type-string-a-slice-of-string", "title": "Go-gorm mysql &quot;unsupported type []string, a slice of string&quot;", "body": "<p>I use gorm, and try to create transaction to mysql. I have a struct </p>\n\n<pre><code>type Game struct {\n    Images []string\n}\n\ngame := Game{Images: []string{\"1.png\", \"2.png\"}}\n\ndb := Database()\n\ntx := db.Begin()\n\nif err := tx.Create(&amp;game).Error; err != nil {\n    tx.Rollback()\n    return errors.New(\"Cannot add game\")\n}\n\ntx.Commit()\n</code></pre>\n\n<p>But I get error <code>(sql: converting argument $1 type: unsupported type []string, a slice of string)</code>. I understand, that mysql unsupported this type, but can I someway resolve this problem? I guess I can change type to <code>json.rawMessage</code>, but I think it's a wrong way.</p>\n\n<p>I use dialect <code>\"github.com/jinzhu/gorm/dialects/mysql\"</code></p>\n"}]