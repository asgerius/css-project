[{"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1464218870, "post_id": 37449117, "comment_id": 62400152, "body": "What is <code>soundcloud</code> in the above code?  If it&#39;s a package, what&#39;s the import path. If it&#39;s a variable, show the definition and any code that modifies it."}, {"owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1464218968, "post_id": 37449117, "comment_id": 62400180, "body": "Hi there Karrot, it&#39;s a custom struct I&#39;m attaching the references here.   <a href=\"https://github.com/njasm/gosoundcloud/blob/master/soundcloud.go\" rel=\"nofollow noreferrer\">github.com/njasm/gosoundcloud/blob/master/soundcloud.go</a> It is NewSoundcloudApi"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1464219448, "post_id": 37449117, "comment_id": 62400287, "body": "Run the code with the <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">race detector</a>.  There&#39;s a race on <a href=\"https://github.com/njasm/gosoundcloud/blob/0c4ec422f41aefe7d39cfefd7261733ea9423e18/soundcloud.go#L217-L221\" rel=\"nofollow noreferrer\">these lines</a> that can lead to issues."}, {"owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1464219698, "post_id": 37449117, "comment_id": 62400340, "body": "@KarrotKake I knew it must be something like that! Thanks a lot"}, {"owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1464220721, "post_id": 37449117, "comment_id": 62400616, "body": "@KarrotKake The race detector didn&#39;t told me anything. I&#39;m running the binary with -race and also checked the package. Why do you say there&#39;s a race?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1464222723, "post_id": 37449117, "comment_id": 62401100, "body": "The program can call <code>GetUser</code> concurrently.  This method eventually calls <code>do</code> which sets  and gets the <code>response</code> field without locking. Because there&#39;s no locking, it&#39;s possible for <code>do</code> to return a single response to two goroutines.  Bad things will happen from there.  All access to <code>response</code> should be protected by a mutex. If you don&#39;t need access to the last response, I suggest you delete this field."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1464222394, "creation_date": 1464222394, "answer_id": 37449680, "question_id": 37449117, "link": "https://stackoverflow.com/questions/37449117/golang-nil-in-http-requests/37449680#37449680", "title": "Golang, nil in http requests", "body": "<p>in the function:</p>\n\n<pre><code>func processAndUnmarshalResponses(resp *http.Response, err error, holder interface{}) error {\n    defer resp.Body.Close()\n    if err != nil {\n        return err\n    }\n</code></pre>\n\n<p>You are defering <code>resp.Body.Close()</code> before you check the error. If there is an error, <code>resp</code> will be nil, and dereferencing it will panic. Always put the error check first. </p>\n"}], "owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1007, "favorite_count": 0, "accepted_answer_id": 37449680, "answer_count": 1, "score": 0, "last_activity_date": 1464222394, "creation_date": 1464218070, "last_edit_date": 1464220930, "question_id": 37449117, "link": "https://stackoverflow.com/questions/37449117/golang-nil-in-http-requests", "title": "Golang, nil in http requests", "body": "<p>I'm creating a Go script to get as many http requests as possible from an API.</p>\n\n<p>I'm getting a nil pointer reference at the line of soundcloud.GetUser(i) when I call worker() with multiple goroutines, more than 200 to be exact.</p>\n\n<p>This is the error I'm getting to be exact.</p>\n\n<pre><code>goroutine 28 [running]:\nruntime.panic(0x75fca0, 0x98cf13)\n/usr/lib/go/src/pkg/runtime/panic.c:279 +0xf5 www.github.com/Juanvulcano/gosoundcloud%2egit.processAndUnmarshalResponses(0x0, 0x7f1d338e9fd0, 0xc209467a10, 0x780a60, 0xc20809c300, 0x0, 0x0)\n      /home/maker/go/src/www.github.com/Juanvulcano/gosoundcloud.git/gosoundcloud.go:31 +0x413\nwww.github.com/Juanvulcano/gosoundcloud%2egit.(*SoundcloudApi).GetUser(0xc208040520, 0x2, 0x7f1d41e81f40, 0x0, 0x0)\n    /home/maker/go/src/www.github.com/Juanvulcano/gosoundcloud.git/soundcloud.go:295 +0x1b1\nmain.worker()\n    /home/maker/go/src/GoBot/GoBot.go:28 +0xdd\ncreated by main.main\n    /home/maker/go/src/GoBot/GoBot.go:71 +0x55d\n</code></pre>\n\n<p>Here I'm attaching the important parts of my code.</p>\n\n<pre><code>func worker() {\n   defer wg.Done()\n   for i := range input {\n       member,  err := soundcloud.GetUser(uint64(i))\n       if err != nil{\n           fmt.Println(err)\n       }\n       if member != nil {\n           output &lt;- fmt.Sprint(member.Username)\n       }\n    }\n}    \n\n\nfunc main() {    \n    var err error\n    if err = soundcloud.PasswordCredentialsToken(\"email\", \"password\"); err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }  \n    go func() {    \n        for i := 1; i &lt; 1000; i++ {\n                input &lt;- i\n       }\n       close(input)\n       wg.Wait()\n       close(output)\n    }()\n\n    for i := 0; i &lt; 200; i++ {\n        wg.Add(1)\n        go worker()\n    }    \n    printOutput()\n}\n</code></pre>\n"}, {"tags": ["javascript", "go", "react-native", "gomobile"], "answers": [{"tags": [], "owner": {"reputation": 7224, "user_id": 4826200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e770b50f4469fe1425c791386ef7f868?s=128&d=identicon&r=PG&f=1", "display_name": "agenthunt", "link": "https://stackoverflow.com/users/4826200/agenthunt"}, "is_accepted": false, "score": 0, "last_activity_date": 1464224676, "creation_date": 1464224676, "answer_id": 37449944, "question_id": 37449103, "link": "https://stackoverflow.com/questions/37449103/call-js-bundle-from-gomobile/37449944#37449944", "title": "Call JS bundle from GoMobile?", "body": "<p>That js bundle is/can be used the React Engine that has specific native implementations for both ios and android.</p>\n\n<ol>\n<li><p>One way you could use is if you have a GoMobile implementation/bindings of ReactEngine.</p></li>\n<li><p>Another way as you have already mentioned is by Objective C-Swift/Java bindings.</p></li>\n<li><p>Another way is you could implement a embedded REST API server on GoMobile and use react-native to talk to that.</p></li>\n</ol>\n"}], "owner": {"reputation": 31, "user_id": 6382088, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PjbMQpV7sK4/AAAAAAAAAAI/AAAAAAAAAB0/YR8f4TLk6aQ/photo.jpg?sz=128", "display_name": "Andy Brewer", "link": "https://stackoverflow.com/users/6382088/andy-brewer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1496238182, "creation_date": 1464218019, "last_edit_date": 1496238182, "question_id": 37449103, "link": "https://stackoverflow.com/questions/37449103/call-js-bundle-from-gomobile", "title": "Call JS bundle from GoMobile?", "body": "<p>It's my understanding that ReactNative compiles it's JavaScript into a JS bundle available here: <a href=\"http://localhost:8081/index.ios.bundle\" rel=\"nofollow\">http://localhost:8081/index.ios.bundle</a></p>\n\n<p>Is it possible within GoMobile to render a view using that JS bundle file?</p>\n\n<p>I'm trying to figure out if I can use Go for backend app development and ReactNative for the UI, without having to hook up bindings to Swift/Java.</p>\n"}, {"tags": ["postgresql", "variables", "go"], "answers": [{"comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 3, "creation_date": 1464218320, "post_id": 37449128, "comment_id": 62400006, "body": "<a href=\"https://godoc.org/github.com/lib/pq#QuoteIdentifier\" rel=\"nofollow noreferrer\">pq.QuoteIdentifier</a> should be what&#39;s needed to finish the job."}, {"owner": {"reputation": 1952, "user_id": 1567269, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7e5ef5c449437de2befaf4851a80d2a4?s=128&d=identicon&r=PG", "display_name": "trueCamelType", "link": "https://stackoverflow.com/users/1567269/truecameltype"}, "edited": false, "score": 0, "creation_date": 1464226309, "post_id": 37449128, "comment_id": 62401890, "body": "Thank you both, that&#39;s exactly what I needed.  And to anyone who swings by that is new to go, to use pq, just <code>go get github.com&#47;lib&#47;pq</code>, then use <code>import &quot;github.com&#47;lib&#47;pq&quot;</code> at the top of your file."}], "tags": [], "owner": {"reputation": 996, "user_id": 253298, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/07d1db375942d93877c2a6512a654e61?s=128&d=identicon&r=PG", "display_name": "duckbrain", "link": "https://stackoverflow.com/users/253298/duckbrain"}, "is_accepted": true, "score": 6, "last_activity_date": 1464218586, "last_edit_date": 1464218586, "creation_date": 1464218129, "answer_id": 37449128, "question_id": 37448982, "link": "https://stackoverflow.com/questions/37448982/what-am-i-not-getting-about-go-sql-query-with-variables/37449128#37449128", "title": "What am I not getting about Go sql query with variables?", "body": "<p>It looks like you are using <a href=\"https://github.com/lib/pq\" rel=\"noreferrer\">https://github.com/lib/pq</a> based on the error message and it's <a href=\"https://godoc.org/github.com/lib/pq\" rel=\"noreferrer\">docs</a> say that</p>\n\n<blockquote>\n  <p>pq uses the Postgres-native ordinal markers, as shown above</p>\n</blockquote>\n\n<p>I've never known a database engine that allows the parameterized values in anything other than values. I think you are going to have to resort to string concatenation. I don't have a Go compiler available to me right now, but try something like this. Because you are inserting the table name by concatination, you need it sanitized. <a href=\"https://godoc.org/github.com/lib/pq#QuoteIdentifier\" rel=\"noreferrer\"><code>pq.QuoteIdentifier</code></a> should be able to help with that.</p>\n\n<pre><code>func SelectAll (table string) {\n    db, err := sql.Open(\"postgres\",\"user=postgres dbname=mydb sslmode=disable\")\n\n        if err != nil {\n                 fmt.Println(err)\n        }\n\n        defer db.Close()\n\n        table = pq.QuoteIdentifier(table)\n        rows, err := db.Query(fmt.Sprintf(\"SELECT * FROM %v\", table))\n\n        if err != nil {\n                fmt.Println(err)\n        } else {\n\n                PrintRows(rows)\n        }\n\n}\n</code></pre>\n\n<p>EDIT: Thanks to hobbs to pointing out <code>pq.QuoteIdentifier</code></p>\n"}], "owner": {"reputation": 1952, "user_id": 1567269, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7e5ef5c449437de2befaf4851a80d2a4?s=128&d=identicon&r=PG", "display_name": "trueCamelType", "link": "https://stackoverflow.com/users/1567269/truecameltype"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1686, "favorite_count": 0, "accepted_answer_id": 37449128, "answer_count": 1, "score": 1, "last_activity_date": 1464218586, "creation_date": 1464217210, "question_id": 37448982, "link": "https://stackoverflow.com/questions/37448982/what-am-i-not-getting-about-go-sql-query-with-variables", "title": "What am I not getting about Go sql query with variables?", "body": "<p>I'm brand new to Go, and I've started working on some postgres queries, and I'm having very little luck.</p>\n\n<p>I have a package that's just going to have some database queries in it.  Here's my code.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    fmt.Println(\"Querying data\")\n    myqueries.SelectAll(\"mytable\")\n\n}\n</code></pre>\n\n<p><strong>myqueries.go</strong></p>\n\n<pre><code>package myqueries\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n)\n\nfunc SelectAll (table string) {\n    db, err := sql.Open(\"postgres\",\"user=postgres dbname=mydb sslmode=disable\")\n\n        if err != nil {\n                 fmt.Println(err)\n        }\n\n        defer db.Close()\n\n        rows, err := db.Query(\"SELECT * FROM $1\", table)\n\n        if err != nil {\n                fmt.Println(err)\n        } else {\n\n                PrintRows(rows)\n        }\n\n}\n\nfunc PrintRows(rows *sql.Rows) {\n    for rows.Next() {\n        var firstname string\n        var lastname string\n\n        err := rows.Scan(&amp;firstname, &amp;lastname)\n\n        if err != nil {\n            fmt.Println(err)\n        }\n        fmt.Println(\"first name | last name\")\n\n        fmt.Println(\"%v | %v\\n\", firstname, lastname)\n\n    }\n}\n</code></pre>\n\n<p>The error I get is <code>pq: syntax error at or near \"$1\"</code> </p>\n\n<p>which is from <strong>myqueries.go</strong> file in the <code>db.Query</code>.</p>\n\n<p>I've tried several variations of this, but nothing has worked yet.  Any help is appreciated.</p>\n"}, {"tags": ["select", "go", "channel"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464236898, "post_id": 37448372, "comment_id": 62404326, "body": "<code>go fmt</code> is your best friend, please use it."}], "answers": [{"comments": [{"owner": {"reputation": 401, "user_id": 3324751, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/654dbe483626fc572507566155c2a389?s=128&d=identicon&r=PG&f=1", "display_name": "hagh", "link": "https://stackoverflow.com/users/3324751/hagh"}, "edited": false, "score": 0, "creation_date": 1464217380, "post_id": 37448700, "comment_id": 62399819, "body": "Go syntax does not like that. You&#39;ll get this error &quot;select cases cannot be lists&quot;"}], "tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": false, "score": -2, "last_activity_date": 1464296292, "last_edit_date": 1464296292, "creation_date": 1464215353, "answer_id": 37448700, "question_id": 37448372, "link": "https://stackoverflow.com/questions/37448372/go-language-running-the-same-code-for-multiple-select-cases/37448700#37448700", "title": "Go language - running the same code for multiple select cases", "body": "<p>Why signaling to yourself using a channel if you can just call doSomething()? I understand do Something might not be exactly a function, but you can always use a local closure.</p>\n\n<p>See a working example: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\n\n\nfunc someRoutine (userReq chan int) {\n    doSomething := func () {\n        fmt.Printf (\"OK %v\\n\", time.Now())\n    }\n\n  var ticker = time.NewTicker(10*time.Second)\n  for {\n    select {\n    case &lt;-ticker.C:\n        doSomething()\n    case &lt;-userReq: // some channel activated occasionally \n        doSomething()\n    }\n  }\n}\n\nfunc main() {\n    userReq := make(chan int, 1)\n    go someRoutine(userReq);\n\n    userReq &lt;- 1 // user requested some action here (just to mark the start)\n    time.Sleep(15*time.Second)\n    userReq &lt;- 1 // user requested some action here\n\n    time.Sleep(30*time.Second)// Put your own waiting and exiting logic here\n}\n</code></pre>\n\n<p>If you still want to optimize it beyond this simple correction, there are always some alternatives available. But with just two channels to read from, make sure you're not doing premature optimization.</p>\n"}, {"tags": [], "owner": {"reputation": 1018, "user_id": 1249216, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/07Pzy.jpg?s=128&g=1", "display_name": "timestee", "link": "https://stackoverflow.com/users/1249216/timestee"}, "is_accepted": false, "score": 0, "last_activity_date": 1464234859, "creation_date": 1464234859, "answer_id": 37451296, "question_id": 37448372, "link": "https://stackoverflow.com/questions/37448372/go-language-running-the-same-code-for-multiple-select-cases/37451296#37451296", "title": "Go language - running the same code for multiple select cases", "body": "<p>Perhaps you could do this using the Select function from the reflect package:</p>\n\n<blockquote>\n  <p>func Select(cases []SelectCase) (chosen int, recv Value, recvOK bool)</p>\n</blockquote>\n"}], "owner": {"reputation": 401, "user_id": 3324751, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/654dbe483626fc572507566155c2a389?s=128&d=identicon&r=PG&f=1", "display_name": "hagh", "link": "https://stackoverflow.com/users/3324751/hagh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 539, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1464296292, "creation_date": 1464213681, "question_id": 37448372, "link": "https://stackoverflow.com/questions/37448372/go-language-running-the-same-code-for-multiple-select-cases", "title": "Go language - running the same code for multiple select cases", "body": "<p>Assuming we have multiple notification sources (channels) and we want to perform some similar tasks on some of these notification events. For example, consider the case where we call <code>doSomething()</code> every 10 minutes and also upon user request. A possible implementation in Go could be something like this:</p>\n\n<pre><code>var ticker = time.NewTicker(10*time.Minute)\nnowDoSomething := make(chan time.Time, 1)\nfor {\n    select {\n    case &lt;-ticker.C:\n        nowDoSomething&lt;-time.Now()\n\n    case &lt;-userReq: // some channel activated occasionally \n        nowDoSomething&lt;-time.Now()\n\n    case &lt;-nowDoSomething:\n        doSomething()\n    }\n}\n</code></pre>\n\n<p>What would be other, perhaps better, ways of achieving a similar functionality?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464206969, "post_id": 37446623, "comment_id": 62395398, "body": "Do the structs need to have an equivalent memory layout, or can you use <code>Name: []byte</code>?"}, {"owner": {"reputation": 1201, "user_id": 651028, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d5887835c21dace586b98180544c74e?s=128&d=identicon&r=PG", "display_name": "Sergei G", "link": "https://stackoverflow.com/users/651028/sergei-g"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464207373, "post_id": 37446623, "comment_id": 62395598, "body": "I am sorry, the struct is just a context.  I just need to convert data from C go data type of char[8] to go data type [8]byte, so I can discard c structure and work with go structure."}, {"owner": {"reputation": 1201, "user_id": 651028, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d5887835c21dace586b98180544c74e?s=128&d=identicon&r=PG", "display_name": "Sergei G", "link": "https://stackoverflow.com/users/651028/sergei-g"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464207512, "post_id": 37446623, "comment_id": 62395676, "body": "The size of char arrays is fixed as it represents some predefined data in EEPROM.  It would be nice to cary fixed size in GO structure."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464207635, "post_id": 37446623, "comment_id": 62395745, "body": "It&#39;s up to you is you want to use an array, but Go already has a <code>copy</code> function to copy contiguous bytes."}, {"owner": {"reputation": 1201, "user_id": 651028, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d5887835c21dace586b98180544c74e?s=128&d=identicon&r=PG", "display_name": "Sergei G", "link": "https://stackoverflow.com/users/651028/sergei-g"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464207776, "post_id": 37446623, "comment_id": 62395812, "body": "My current solution is something like this:func charToBytes(dest []byte, src [8]C.char) { \tbuf := C.GoBytes(src, C.int(len(dest))) \tcopy(dest, buf) },  but I have to write a new function for each size of array or put code inline."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1464229461, "last_edit_date": 1464229461, "creation_date": 1464208569, "answer_id": 37447154, "question_id": 37446623, "link": "https://stackoverflow.com/questions/37446623/c-char-name8-to-golang-name-8byte/37447154#37447154", "title": "C char name[8] to GoLang Name [8]byte", "body": "<p>To make this a little more generic, you can decompose the C char array to a <code>*C.char</code>, then use <code>unsafe.Pointer</code> to cast it back to an array. </p>\n\n<pre><code>func charToBytes(dest []byte, src *C.char) {\n    n := len(dest)\n    copy(dest, (*(*[1024]byte)(unsafe.Pointer(src)))[:n:n])\n}\n</code></pre>\n\n<p>Or maybe a little easier</p>\n\n<pre><code>func charToBytes(src *C.char, sz int) []byte {\n    dest := make([]byte, sz)\n    copy(dest, (*(*[1024]byte)(unsafe.Pointer(src)))[:sz:sz])\n    return dest\n}\n</code></pre>\n"}], "owner": {"reputation": 1201, "user_id": 651028, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6d5887835c21dace586b98180544c74e?s=128&d=identicon&r=PG", "display_name": "Sergei G", "link": "https://stackoverflow.com/users/651028/sergei-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 899, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1464229461, "creation_date": 1464206679, "question_id": 37446623, "link": "https://stackoverflow.com/questions/37446623/c-char-name8-to-golang-name-8byte", "title": "C char name[8] to GoLang Name [8]byte", "body": "<p>I've got a C function that fills a C struct:</p>\n\n<pre><code>typedef struct {\n  char name[8];\n}\n</code></pre>\n\n<p>I need to copy data into Go lang struct that has the same content:</p>\n\n<pre><code>type sData struct {\n  Name [8]byte\n}\n</code></pre>\n\n<p>The structure has parameters of multiple sizes: 4, 12, 32 so it would be nice to have a function that deals with more than just one size.</p>\n\n<p>thanks</p>\n"}, {"tags": ["function", "go", "struct", "idioms"], "comments": [{"owner": {"reputation": 5459, "user_id": 1734730, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/L8dDj.jpg?s=128&g=1", "display_name": "Nathan Cooper", "link": "https://stackoverflow.com/users/1734730/nathan-cooper"}, "edited": false, "score": 0, "creation_date": 1464206552, "post_id": 37446501, "comment_id": 62395179, "body": "<a href=\"https://gobyexample.com/methods\" rel=\"nofollow noreferrer\">gobyexample.com/methods</a>"}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1464206604, "post_id": 37446501, "comment_id": 62395203, "body": "Really depends on your use case; if you don&#39;t need to change the struct, you can get away with using a non-pointer receiver. Check out <a href=\"http://nathanleclaire.com/blog/2014/08/09/dont-get-bitten-by-pointer-vs-non-pointer-method-receivers-in-golang/\" rel=\"nofollow noreferrer\">nathanleclaire.com/blog/2014/08/09/&hellip;</a> for a nicely written article on the differences."}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1464207199, "creation_date": 1464207199, "answer_id": 37446770, "question_id": 37446501, "link": "https://stackoverflow.com/questions/37446501/what-is-the-correct-go-idiom-for-calling-functions-on-a-struct/37446770#37446770", "title": "What is the correct go idiom for calling functions on a struct?", "body": "<p>There isn't one correct way of doing this. It's important to understand the differences between the two and apply each where appropriate. Further more, your functions aren't really comparable. In the one case you've defined a function with a receiver of type <code>Person</code> and it is passed by value, meaning a copy of the instance is made and pushed onto the stack. In the other instance the function is stand alone and you pass a <code>Person</code> reference to it. You can also, do pass by reference with an 'instance method' by making the receiving type a pointer.</p>\n\n<p>So in the first case;</p>\n\n<pre><code>func (p Person) fullname() string {\n    return p.firstname + p.lastname\n}\n</code></pre>\n\n<p>you call the function like <code>p.fullname()</code> and a copy of <code>p</code> is pushed onto the stack. If you did assignment in this function, <code>p</code> would not be modified, the instance in the scope would be modified. So for setters, or any function that is intended to change the objects state, this isn't an option at all.</p>\n\n<p>To elaborate on the alternative I was talking about, you could instead do this;</p>\n\n<pre><code>func (p *Person) fullname() string {\n    return p.firstname + p.lastname\n}\n</code></pre>\n\n<p>Which still allow you to call it on an instance like <code>p.fullname()</code> however, what's passed to the function is a reference of type <code>*Person</code>. So this would be the typical choice for implementing a function that sets a value on a struct.</p>\n\n<p>Now your second example;</p>\n\n<pre><code>func fullname(p *Person) string {\n    return p.firstname + p.lastname\n}\n</code></pre>\n\n<p>has no receiver and passes a pointer. Meaning you call it like this <code>fullname(p)</code>. The function is not exported so it's only available in the package where it was declared, in this case main. To draw parallels to (potentially) more familiar languages, this is like defining a function in C++ where the other two are defining a 'method' or a function in a class. And the other two would be compared to 'passing by value' or 'passing by reference'. This passes by reference by is no associated to any type.</p>\n\n<p>In your example I would always use <code>func (p *Person) fullname() string</code> for performance reasons. In my opinion the most appropriate time to use the pass by value alternative <code>func (p Person) fullname() string</code> is when you want to enforce immutability. If you want to do operations where it's better to produce a new object rather than modifying an existing one (a lot of collection libraries operate like this, for example LINQ in C# always produces a new collection and an attempt to modify the collection during a query will result in an exception) then you probably want a value type receiver.</p>\n\n<p>Hope that helps. I can update with more information if any of this is still the cause of confusion.</p>\n"}], "owner": {"reputation": 2449, "user_id": 4313927, "user_type": "registered", "accept_rate": 64, "profile_image": "https://graph.facebook.com/568720341/picture?type=large", "display_name": "Nicky Feller", "link": "https://stackoverflow.com/users/4313927/nicky-feller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 37446770, "answer_count": 1, "score": 0, "last_activity_date": 1464207556, "creation_date": 1464206276, "question_id": 37446501, "link": "https://stackoverflow.com/questions/37446501/what-is-the-correct-go-idiom-for-calling-functions-on-a-struct", "title": "What is the correct go idiom for calling functions on a struct?", "body": "<h3>I am new to go (coming from python and ruby) and want to know what is the idiomatic way of calling functions on a struct?</h3>\n\n<p>Mostly I want to know if I should use the dot operator to call functions or use my type as one of the arguments. Also is it better to use pointers or not?</p>\n\n<ul>\n<li>pointer vs no pointer?</li>\n<li>dot vs argument?\n*</li>\n</ul>\n\n<p>I can do it this way?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    me := Person{firstname: \"John\", lastname: \"Doe\", age: 40}\n    fmt.Println(me.fullname())\n}\n\ntype Person struct {\n    firstname string\n    lastname  string\n    age       int\n}\n\nfunc (p Person) fullname() string {\n    return p.firstname + p.lastname\n}\n</code></pre>\n\n<hr>\n\n<p>or this way</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    me := Person{firstname: \"John\", lastname: \"Doe\", age: 40}\n    fmt.Println(fullname(&amp;me))\n}\n\ntype Person struct {\n    firstname string\n    lastname  string\n    age       int\n}\n\nfunc fullname(p *Person) string {\n    return p.firstname + p.lastname\n}\n</code></pre>\n"}, {"tags": ["python", "go", "client-server", "named-pipes"], "comments": [{"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464201616, "post_id": 37442476, "comment_id": 62392546, "body": "1st guess: you have to <code>npipe.Dial</code> to your named pipe from go. Do you have any <code>err</code>&#39;s running your code?"}, {"owner": {"reputation": 111, "user_id": 5773017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74266223a02812ed8bbae3a27aa8fdb0?s=128&d=identicon&r=PG&f=1", "display_name": "Rjain", "link": "https://stackoverflow.com/users/5773017/rjain"}, "reply_to_user": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464244357, "post_id": 37442476, "comment_id": 62407051, "body": "no error, &quot;ConnectNamedPipe&quot; seem to not detect Server. I have tried the same piece of code with server implemented in Python and it works fine."}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464256967, "post_id": 37442476, "comment_id": 62414899, "body": "afaik <code>CreateNamedPipe</code> create pipe waiting for connections, and <code>npipe.Listen</code> create pipe waiting for connections as well"}, {"owner": {"reputation": 111, "user_id": 5773017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74266223a02812ed8bbae3a27aa8fdb0?s=128&d=identicon&r=PG&f=1", "display_name": "Rjain", "link": "https://stackoverflow.com/users/5773017/rjain"}, "reply_to_user": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464259125, "post_id": 37442476, "comment_id": 62416247, "body": "i am trying to establish a one way communication, before making it duplex. so, my snippet does include code as you required."}], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 5773017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74266223a02812ed8bbae3a27aa8fdb0?s=128&d=identicon&r=PG&f=1", "display_name": "Rjain", "link": "https://stackoverflow.com/users/5773017/rjain"}, "is_accepted": true, "score": 2, "last_activity_date": 1464686330, "last_edit_date": 1464686330, "creation_date": 1464355410, "answer_id": 37484655, "question_id": 37442476, "link": "https://stackoverflow.com/questions/37442476/implementing-client-sever-model-using-go-and-python-on-windows-os/37484655#37484655", "title": "Implementing Client- Sever model using Go and Python on Windows OS", "body": "<p>i Could not find a solution using pipes, so i moved to sockets and i am able to communicate via sockets. Following is the snippets of the codes</p>\n\n<p><strong>Client.py</strong></p>\n\n<pre><code>import socket\nimport struct\n\n# create a socket object\nrequestCore = socket.socket(\n                socket.AF_INET, socket.SOCK_STREAM) \nresponseCore = socket.socket(\n                socket.AF_INET, socket.SOCK_STREAM) \n\n# get local machine name\nhost = socket.gethostname()                           \nport = 8100                                           \n\n# bind to the port\nrequestCore.bind((host, port))                                  \n# queue up to 5 requests\nrequestCore.listen(5)                                           \nclient,addr = requestCore.accept()\n\nport = 9999\nresponseCore.connect((host, port))\n\nwhile True:\n    msg = input(\"User Input: \")\n    client.send(bytes(msg.encode('UTF-8')))\n\n    msgFrmServ = responseCore.recv(64)\n    print(\"message from Server\",msgFrmServ)\n\nclient.close()\nresponseCore.close()\n</code></pre>\n\n<p><strong>server.go</strong></p>\n\n<pre><code>package main \n\nimport \"net\" \nimport \"fmt\" \nimport \"bufio\" \nimport \"os\"\nimport \"bytes\"\n\nfunc main() {   \n\n    hostname,_ := os.Hostname()\n\n    // connect to this socket   \n    readconn, _ := net.Dial(\"tcp\", hostname+\":8100\")   \n    reader := bufio.NewReader(readconn)     \n\n    ln, _ := net.Listen(\"tcp\", hostname+\":9999\")   \n    writeconn, _ := ln.Accept()    // accept connection on port   \n\n    for { \n        text := make([]byte,64)\n        reader.Read(text)\n        text = bytes.Trim(text,\"\\x00\")\n        fmt.Println(string(text))\n\n        Acktext := \"Core Acknowledge: \" + string(text)\n        writeconn.Write([]byte(Acktext))\n    } \n}\n</code></pre>\n\n<p>The above snippet works fine for my application. </p>\n"}], "owner": {"reputation": 111, "user_id": 5773017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74266223a02812ed8bbae3a27aa8fdb0?s=128&d=identicon&r=PG&f=1", "display_name": "Rjain", "link": "https://stackoverflow.com/users/5773017/rjain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 37484655, "answer_count": 1, "score": 2, "last_activity_date": 1464686330, "creation_date": 1464192479, "question_id": 37442476, "link": "https://stackoverflow.com/questions/37442476/implementing-client-sever-model-using-go-and-python-on-windows-os", "title": "Implementing Client- Sever model using Go and Python on Windows OS", "body": "<p>I am working on an GUI application, the UI is developed using python(+kivy) and the core is implemented using GoLang.</p>\n\n<p>My Application involves passing data from UI to Core, for which i am using pipes. Following is the snippet of Client and Server code. </p>\n\n<p>Client.py:</p>\n\n<pre><code>p = win32pipe.CreateNamedPipe(r'\\\\.\\pipe\\test_pipe',\n                              win32pipe.PIPE_ACCESS_DUPLEX,\n                              win32pipe.PIPE_TYPE_MESSAGE |win32pipe.PIPE_WAIT,\n                              1, 65536, 65536,300,None)\n\nwin32pipe.ConnectNamedPipe(p, None)\n\n\ndata = \"Hello Pipe\"  \nwin32file.WriteFile(p, bytes(data,\"UTF-8\")) \n</code></pre>\n\n<p>Server.go:</p>\n\n<pre><code>ln, err := npipe.Listen(`\\\\.\\pipe\\test_pipe`)\nif err != nil {\n    // handle error\n}\n\n\nfor {\n    conn, err := ln.Accept()\n    if err != nil {\n        // handle error\n        continue\n    }\n\n    // handle connection like any other net.Conn\n    go func(conn net.Conn) {\n        r := bufio.NewReader(conn)\n        msg, err := r.ReadString('\\n')\n        if err != nil {\n            // handle error\n            return\n        }\n        fmt.Println(msg)\n\n    }(conn)\n}\n</code></pre>\n\n<p>With the above piece of code, i am not able to setup a connection between them. My Application involves duplex communication between client and server</p>\n\n<p>Any sort of help is appreciated!!</p>\n"}, {"tags": ["javascript", "go", "react-native"], "comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1464191893, "post_id": 37442045, "comment_id": 62386998, "body": "umm, no.  unless you can use C bindings and expose them from the binary to consume.  even then you are looking at consuming a library, not a binary."}], "answers": [{"tags": [], "owner": {"reputation": 10246, "user_id": 1559386, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/52ebc97578e2a9226fd3794b6d683036?s=128&d=identicon&r=PG", "display_name": "Daniel Schmidt", "link": "https://stackoverflow.com/users/1559386/daniel-schmidt"}, "is_accepted": false, "score": 0, "last_activity_date": 1464444678, "creation_date": 1464444678, "answer_id": 37500002, "question_id": 37442045, "link": "https://stackoverflow.com/questions/37442045/call-binary-from-react-native/37500002#37500002", "title": "Call binary from React Native?", "body": "<p>You can <a href=\"https://facebook.github.io/react-native/docs/native-modules-ios.html#content\" rel=\"nofollow\">access native modules</a>, so uncompiled source code in either Java or Objective-c / Swift is possible. Compiled binaries are always compiled for one platform, which means that you can not link such binaries in to react native. For moving the logic away from Javascript, you have two options</p>\n\n<ol>\n<li>Connect a web server and store most of the business logic there, so use the iOS / Android app mostly as a view layer.</li>\n<li>Find a transpiler, that transpiles the language you would like to use to Javascript</li>\n</ol>\n"}], "owner": {"reputation": 31, "user_id": 6382088, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-PjbMQpV7sK4/AAAAAAAAAAI/AAAAAAAAAB0/YR8f4TLk6aQ/photo.jpg?sz=128", "display_name": "Andy Brewer", "link": "https://stackoverflow.com/users/6382088/andy-brewer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1464444678, "creation_date": 1464191244, "question_id": 37442045, "link": "https://stackoverflow.com/questions/37442045/call-binary-from-react-native", "title": "Call binary from React Native?", "body": "<p>Is it possible to include and exec a compiled binary inside a React Native project? I'm exploring handling the business logic in React Native with languages other than Javascript, but still have the compiled code be cross platform.</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 525, "user_id": 1264021, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/270f846af2d52aab055b25a3037c97e1?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1264021/james"}, "edited": false, "score": 0, "creation_date": 1464246624, "post_id": 37442619, "comment_id": 62408251, "body": "I think we&#39;re working along the lines of what you&#39;re saying. At the minute we chain middleware functions that get the required data from the request and set it to the context. Instead of accessing the context package directly inside the handler, we should inject the values from the context into the handler, is that right?"}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "reply_to_user": {"reputation": 525, "user_id": 1264021, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/270f846af2d52aab055b25a3037c97e1?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1264021/james"}, "edited": false, "score": 0, "creation_date": 1464262068, "post_id": 37442619, "comment_id": 62418137, "body": "Yep, that&#39;s how we do it. keeps the handlees simple and by having the signature if the method reflect exactly what you are using within that handler.  this is how MVC frameworks in other languages define MVC routes."}], "tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": true, "score": 1, "last_activity_date": 1464192829, "creation_date": 1464192829, "answer_id": 37442619, "question_id": 37442010, "link": "https://stackoverflow.com/questions/37442010/testing-handlers-that-use-gorilla-context/37442619#37442619", "title": "Testing handlers that use Gorilla/context", "body": "<p>This is a classic <a href=\"http://cyrille.martraire.com/2009/12/your-crosscuttingconcerns-are-someone-else-core-domai/\" rel=\"nofollow\">cross-cutting concerns</a> example.</p>\n\n<p>You are using a 3rd party to magically handle input params for your unit under test.  By that very definition, you are going to have to do some extra setup to prep the <code>context</code> for the state you want.</p>\n\n<p>When it comes to Go http handlers (which the convention is to KISS it), you shouldn't need to \"reach out of context\" of your func to get extra data: keep all the data you need within your single func.</p>\n\n<p>Personally, I try to avoid corrupting my handlers like this.  I think I've only used gorilla's context once out of the dozens of big sites I've built.  And that was basically to get around a cached response, just to keep the data refesh to the end user.  Of which I simply ignored in my unit tests, as it was out-of-scrope of what I was testing.</p>\n\n<p>Instead, I use middle-ware wrappers to setup the basics I want in my handles and modify the handler's signature accordingly.</p>\n\n<ul>\n<li>caching</li>\n<li>logging</li>\n<li>authentication and authorization</li>\n<li>json marshaling</li>\n<li>context (e.g. expected User{} object loaded from DB)</li>\n</ul>\n\n<p>...etc.  I would create a middle-ware that wraps your handler when you register it with <code>mux</code> that uses gorilla/context to lookup your cookie or userid or something, hidrates that user object from cache, DB, redis, etc, and then calls your handler that would have a signature like:</p>\n\n<pre><code>func MyHandler(u User, p Page, w http.ResponseWriter, r *http.Request) {\n    // u is the User object loaded from middle-ware\n\n    // p is your global Page object... etc\n}\n</code></pre>\n\n<p>That way, your unit tests inject only the items you need under test.</p>\n\n<p>And you can integration test your middle-ware on a QA server with expected User and Page objects in a datastore.</p>\n"}, {"comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1465089706, "post_id": 37443609, "comment_id": 62754831, "body": "I use this method for defining URLs in code, like redirects."}], "tags": [], "owner": {"reputation": 2619, "user_id": 2249725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06905a0d11a7662cbadd4daffe029452?s=128&d=identicon&r=PG", "display_name": "mvndaai", "link": "https://stackoverflow.com/users/2249725/mvndaai"}, "is_accepted": false, "score": 1, "last_activity_date": 1464196101, "creation_date": 1464196101, "answer_id": 37443609, "question_id": 37442010, "link": "https://stackoverflow.com/questions/37442010/testing-handlers-that-use-gorilla-context/37443609#37443609", "title": "Testing handlers that use Gorilla/context", "body": "<p>The way my team does it is to add a name to the route handler and then in the tests we call that route by name.</p>\n\n<p>This is how to add a route:</p>\n\n<p><code>r.HandleFunc(\"/&lt;route&gt;\", MyHandler).Methods(\"GET\").Name(\"MyHandlerByName\")</code></p>\n\n<p>Then this is how to test it</p>\n\n<p><code>r.Get(\"MyHandlerByName\")</code></p>\n"}, {"comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1464261933, "post_id": 37446207, "comment_id": 62418043, "body": "this is middle-ware, which my answer describes. but good u had examples. :)"}], "tags": [], "owner": {"reputation": 1153, "user_id": 1371064, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/NnrmE.jpg?s=128&g=1", "display_name": "Carlos Andr&#233;s Garc&#237;a", "link": "https://stackoverflow.com/users/1371064/carlos-andr%c3%a9s-garc%c3%ada"}, "is_accepted": false, "score": 1, "last_activity_date": 1464205190, "creation_date": 1464205190, "answer_id": 37446207, "question_id": 37442010, "link": "https://stackoverflow.com/questions/37442010/testing-handlers-that-use-gorilla-context/37446207#37446207", "title": "Testing handlers that use Gorilla/context", "body": "<p>One way to test handles is modify the way in which they are created. for example, Creating a function that return a http.HandlerFunc, this function can have parameters. You can mock the values that you send to the function</p>\n\n<p>Without parameters</p>\n\n<pre><code> func State() http.HandlerFunc {\n        return http.HandlerFunc(func(pResponse http.ResponseWriter, r *http.Request)    {\n            // your code\n        })\n    }\n</code></pre>\n\n<p>With Parameters</p>\n\n<pre><code>   func State(pParam1,pParam2,pParam3 ...) http.HandlerFunc {\n        return http.HandlerFunc(func(pResponse http.ResponseWriter, r *http.Request)    {\n            // your code using pParam1,pParam2,pParam3 \n        })\n    }\n</code></pre>\n\n<p>The mapping will be </p>\n\n<pre><code>http.HandleFunc(\"/State\", State())\n</code></pre>\n\n<p>or </p>\n\n<pre><code>http.HandleFunc(\"/State\", State(value1,value2,value3 ....))\n</code></pre>\n"}], "owner": {"reputation": 525, "user_id": 1264021, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/270f846af2d52aab055b25a3037c97e1?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1264021/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 37442619, "answer_count": 3, "score": 0, "last_activity_date": 1464205190, "creation_date": 1464191152, "last_edit_date": 1464192017, "question_id": 37442010, "link": "https://stackoverflow.com/questions/37442010/testing-handlers-that-use-gorilla-context", "title": "Testing handlers that use Gorilla/context", "body": "<p>I'm using gorilla/context in a web app. The example in the docs looks like:</p>\n\n<pre><code>func MyHandler(w http.ResponseWriter, r *http.Request) {\n    //...\n\n    val := context.Get(r, foo.MyKey)\n\n    //...\n}\n</code></pre>\n\n<p>How can I unit test a handler that works like this? The only way I've managed so far is to use the context package inside my tests. I'm thinking at the moment that I could inject a context parameter into the handler but then I'm not conforming to the HandlerFunc interface.</p>\n"}, {"tags": ["go", "concurrency", "channel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1464186871, "post_id": 37439776, "comment_id": 62383078, "body": "You have <code>len(channel)</code> all over the place, but that channel has no length because it&#39;s un-buffered. You need to receive from the channel for any sends to complete (and in general, making decisions based on the length of a buffered channel is a mistake, since concurrent operations can race to change that value)"}, {"owner": {"reputation": 906, "user_id": 2901457, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/nxFaL.jpg?s=128&g=1", "display_name": "s_dolan", "link": "https://stackoverflow.com/users/2901457/s-dolan"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464187498, "post_id": 37439776, "comment_id": 62383629, "body": "So, if I&#39;m doing all of my writes to the channel, waiting for them to complete, and then reading from the channel... that can never happen because the sends will never actually complete and trigger the <code>defer wg.Done()</code>? How would you tackle implementing this concurrency, in general?  Also, I&#39;m not sure that you&#39;re correct on the <code>len(channel)</code>, since the godocs state that it returns the current number of elements in the channel, not the capacity like <code>cap(channel)</code> would.  <a href=\"https://golang.org/pkg/builtin/#len\" rel=\"nofollow noreferrer\">golang.org/pkg/builtin/#len</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464188050, "post_id": 37439776, "comment_id": 62384048, "body": "<code>len(channel)</code> returns the current number of items in a &quot;buffered&quot; channel, but since channels are usually used concurrently, the result of <code>len</code> is &quot;stale&quot; as soon as you read it. One would generally have concurrent goroutines sending and receiving from the channel. I would advise going through the <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">Concurrency</a> section in the Tour Of Go again to get a better grasp of how channels work."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1464189061, "post_id": 37439776, "comment_id": 62384888, "body": "@s_dolan yes, the first channel send will block until someone reads it, which never happens. The simplest thing you can do is to start a goroutine that reads from the other end of the channel <i>before</i> writing to it. As for len and cap, consider that <code>len(c)</code> is always &lt;= <code>cap(c)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 4, "creation_date": 1464188961, "post_id": 37441058, "comment_id": 62384806, "body": "But it kind of defeats the purpose of a channel as a pipe between concurrent blocks...."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1464189128, "post_id": 37441058, "comment_id": 62384933, "body": "@RickyA There&#39;s nothing wrong with using a channel is a queue of items."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1464189206, "post_id": 37441058, "comment_id": 62384991, "body": "true, it saves you the overhead of passing a mutexed slice around."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 2, "creation_date": 1464189317, "post_id": 37441058, "comment_id": 62385071, "body": "Yup, a slice with mutex requires more code and is unlikely to perform significantly better in this scenario."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464189741, "post_id": 37441058, "comment_id": 62385380, "body": "yes, buffered channels make great fifo buffers/queues, but in this case there&#39;s no reason to wait for the buffer to fill when each issue is already &quot;queued&quot; up in its own goroutine. The goal was to improve concurrency here, not add another queue to the pipeline."}, {"owner": {"reputation": 906, "user_id": 2901457, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/nxFaL.jpg?s=128&g=1", "display_name": "s_dolan", "link": "https://stackoverflow.com/users/2901457/s-dolan"}, "edited": false, "score": 0, "creation_date": 1464190162, "post_id": 37441058, "comment_id": 62385681, "body": "Excellent, thank you. The only additional change I had to make was to <code>close(channel)</code> after I was done with all of my writes."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 19, "last_activity_date": 1464190206, "last_edit_date": 1464190206, "creation_date": 1464188745, "answer_id": 37441058, "question_id": 37439776, "link": "https://stackoverflow.com/questions/37439776/why-is-my-golang-channel-write-blocking-forever/37441058#37441058", "title": "Why is my Golang Channel Write Blocking Forever?", "body": "<p>The goroutines block on sending to the unbuffered channel. \nA minimal change unblocks the goroutines is to create a buffered channel with capacity for all issues:</p>\n\n<pre><code>channel := make(chan Issue, len(allIssues))\n</code></pre>\n\n<p>and close the channel after the call to wg.Wait().</p>\n"}], "owner": {"reputation": 906, "user_id": 2901457, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/nxFaL.jpg?s=128&g=1", "display_name": "s_dolan", "link": "https://stackoverflow.com/users/2901457/s-dolan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15546, "favorite_count": 0, "accepted_answer_id": 37441058, "answer_count": 1, "score": 12, "last_activity_date": 1464190206, "creation_date": 1464185565, "question_id": 37439776, "link": "https://stackoverflow.com/questions/37439776/why-is-my-golang-channel-write-blocking-forever", "title": "Why is my Golang Channel Write Blocking Forever?", "body": "<p>I've been attempting to take a swing at concurrency in Golang by refactoring one of my command-line utilities over the past few days, but I'm stuck.</p>\n\n<p><a href=\"https://github.com/stephendolan/jira_open_comment_emailer\" rel=\"noreferrer\">Here's</a> the original code (master branch).</p>\n\n<p><a href=\"https://github.com/stephendolan/jira_open_comment_emailer/tree/x_concurrent\" rel=\"noreferrer\">Here's</a> the branch with concurrency (x_concurrent branch).</p>\n\n<p>When I execute the concurrent code with <code>go run jira_open_comment_emailer.go</code>, the <code>defer wg.Done()</code> never executes if the JIRA issue is added to the channel <a href=\"https://github.com/stephendolan/jira_open_comment_emailer/blob/x_concurrent/jira_open_comment_emailer.go#L241\" rel=\"noreferrer\">here</a>, which causes my <code>wg.Wait()</code> to hang forever.</p>\n\n<p>The idea is that I have a large amount of JIRA issues, and I want to spin off a goroutine for each one to see if it has a comment I need to respond to. If it does, I want to add it to some structure (I chose a channel after some research) that I can read from like a queue later to build up an email reminder.</p>\n\n<p>Here's the relevant section of the code:</p>\n\n\n\n<pre><code>// Given an issue, determine if it has an open comment\n// Returns true if there is an open comment on the issue, otherwise false\nfunc getAndProcessComments(issue Issue, channel chan&lt;- Issue, wg *sync.WaitGroup) {\n    // Decrement the wait counter when the function returns\n    defer wg.Done()\n\n    needsReply := false\n\n    // Loop over the comments in the issue\n    for _, comment := range issue.Fields.Comment.Comments {\n        commentMatched, err := regexp.MatchString(\"~\"+config.JIRAUsername, comment.Body)\n        checkError(\"Failed to regex match against comment body\", err)\n\n        if commentMatched {\n            needsReply = true\n        }\n\n        if comment.Author.Name == config.JIRAUsername {\n            needsReply = false\n        }\n    }\n\n    // Only add the issue to the channel if it needs a reply\n    if needsReply == true {\n        // This never allows the defered wg.Done() to execute?\n        channel &lt;- issue\n    }\n}\n\nfunc main() {\n    start := time.Now()\n\n    // This retrieves all issues in a search from JIRA\n    allIssues := getFullIssueList()\n\n    // Initialize a wait group\n    var wg sync.WaitGroup\n\n    // Set the number of waits to the number of issues to process\n    wg.Add(len(allIssues))\n\n    // Create a channel to store issues that need a reply\n    channel := make(chan Issue)\n\n    for _, issue := range allIssues {\n        go getAndProcessComments(issue, channel, &amp;wg)\n    }\n\n    // Block until all of my goroutines have processed their issues.\n    wg.Wait()\n\n    // Only send an email if the channel has one or more issues\n    if len(channel) &gt; 0 {\n        sendEmail(channel)\n    }\n\n    fmt.Printf(\"Script ran in %s\", time.Since(start))\n}\n</code></pre>\n"}, {"tags": ["dictionary", "go", "hashtable"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464181596, "post_id": 37438108, "comment_id": 62378821, "body": "No, you can&#39;t change how the map hashes."}, {"owner": {"reputation": 614, "user_id": 1985957, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/9f0f12529e549a7bcd9392d664060abc?s=128&d=identicon&r=PG", "display_name": "theGamblerRises", "link": "https://stackoverflow.com/users/1985957/thegamblerrises"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464181671, "post_id": 37438108, "comment_id": 62378879, "body": "Oh, that&#39;s a bad news. I need to find some alternative. Golang is very &#39;limited&#39;. :-("}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 4, "creation_date": 1464181786, "post_id": 37438108, "comment_id": 62378980, "body": "@theGamblerRises Not limited. What do you want to do? Don&#39;t implement java code in golang."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 3, "creation_date": 1464184269, "post_id": 37438108, "comment_id": 62380929, "body": "Looks like only ID is a key, timestamp is a value and should be stored as value. I don&#39;t see any reason why you have to put both of them into a struct and use it as a map key"}, {"owner": {"reputation": 614, "user_id": 1985957, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/9f0f12529e549a7bcd9392d664060abc?s=128&d=identicon&r=PG", "display_name": "theGamblerRises", "link": "https://stackoverflow.com/users/1985957/thegamblerrises"}, "edited": false, "score": 0, "creation_date": 1464184944, "post_id": 37438108, "comment_id": 62381452, "body": "Yes, I am thinking in that direction. Looks like it might work for this case. But there could be some different scenarios in future. Thanks for the help. :-))"}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 1, "creation_date": 1464185413, "post_id": 37438108, "comment_id": 62381848, "body": "You could use a priority queue, too: <a href=\"http://stackoverflow.com/q/6644688/124319\">stackoverflow.com/q/6644688/124319</a>"}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1464186966, "post_id": 37438108, "comment_id": 62383170, "body": "@theGamblerRises, different scenario may be if you have some kind of composite key. But even in that case you can combine it into a single unique key by hashing the whole thing, joining strings, combining multiple integers into a bigger one etc. I don&#39;t remember any case in any language when that didn&#39;t work and I had to create complex key object with it&#39;s own comparison rules."}, {"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1464188032, "post_id": 37438108, "comment_id": 62384034, "body": "@creker What you describe (combining/joining...) is exactly what happens when you define a custom hash function (and equality) for a complex object."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1464188133, "post_id": 37438108, "comment_id": 62384117, "body": "It sounds to me like you want a Time Based Cache.  If so I would recommend having a look at <a href=\"https://github.com/patrickmn/go-cache\" rel=\"nofollow noreferrer\">github.com/patrickmn/go-cache</a> to see if it fits your needs."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "reply_to_user": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 0, "creation_date": 1464190935, "post_id": 37438108, "comment_id": 62386237, "body": "@coredump, I mean I don&#39;t remember when I had to use the object itself as a key. It&#39;s always some primitive value (string or integer) in some way or another. What I&#39;m getting at is I don&#39;t find the ability to use complex objects as keys that useful. So Go&#39;s maps are not a limiting factor for me personally as I don&#39;t use that feature anyway."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464192017, "post_id": 37438108, "comment_id": 62387088, "body": "You can iterate the keys and/or values of a map and compare them however you like but you can&#39;t modify how it calculates the hash for access operations."}], "answers": [{"comments": [{"owner": {"reputation": 614, "user_id": 1985957, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/9f0f12529e549a7bcd9392d664060abc?s=128&d=identicon&r=PG", "display_name": "theGamblerRises", "link": "https://stackoverflow.com/users/1985957/thegamblerrises"}, "edited": false, "score": 0, "creation_date": 1464205135, "post_id": 37443619, "comment_id": 62394501, "body": "Thanks for that. I am going with timestamp in values, now. I will update with my solution. Other than that, equality overrides in Java are very convenient for me. I like golang for it&#39;s simplicity and faster processing. But Java is so beautiful for me, ** personal views **."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 614, "user_id": 1985957, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/9f0f12529e549a7bcd9392d664060abc?s=128&d=identicon&r=PG", "display_name": "theGamblerRises", "link": "https://stackoverflow.com/users/1985957/thegamblerrises"}, "edited": false, "score": 0, "creation_date": 1464206495, "post_id": 37443619, "comment_id": 62395153, "body": "@theGamblerRises yeah disliking overrides is just a matter of opinion. They can make code look nice but I think they make it harder to maintain in large projects and if you later on find you need to do reference compare it puts you in a pretty rough spot."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1464196130, "creation_date": 1464196130, "answer_id": 37443619, "question_id": 37438108, "link": "https://stackoverflow.com/questions/37438108/in-golang-can-i-customise-key-comparison-if-i-am-taking-struct-as-key/37443619#37443619", "title": "In Golang, can I customise key comparison, if I am taking struct as key?", "body": "<p>Put the time on your value. Here's some example of how to structure your data.</p>\n\n<pre><code>type DataObj struct {\n     Id int\n     Updated time.Date\n     // other fields\n}\n\nm := map[int]DataObj{}\nm[d.Id] = d // assign using the id as your key\n\nfor k, v := range m {\n    if time.Since(v.Updated) &gt; duration {\n         delete(m, k) // remove the stale item\n    }\n}\n\n// some logic like this for adding/overwriting\nv, ok := m[newObj.Id]\nif ok { // an element with this id existed\n     if time.Since(v.Updated) &gt; duration {\n          m[v.Id] = newObj // assign new value over old one\n     }\n}\n</code></pre>\n\n<p>I can't provide anything much more specific because you don't have any code with which to work. It seems like you'd probably like some of this (like the remove bits) to run on a timer. To do that, invoke the function as a goroutine and use a timer so every X seconds it unblocks and removes items from the map. If you're doing this you also need to use a mutex so the calling scope doesn't access the map while the remove function running the background is filtering out old items.</p>\n\n<p>The overwrite bit is really straight forward, just test if the item is in the map, check it's time stamp, if it's beyond the threshold assign the new value, if not do nothing.</p>\n\n<p>The main thing to take away here is to not use a struct for your key... There is no reason to do object equality, your object has an id, us it as your key. Everything else you care about can be held on the value (even the key itself is). As someone pointed out this isn't Java and even if it were, equality overrides in C# and Java are literally a fucking nightmare.</p>\n"}], "owner": {"reputation": 614, "user_id": 1985957, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/9f0f12529e549a7bcd9392d664060abc?s=128&d=identicon&r=PG", "display_name": "theGamblerRises", "link": "https://stackoverflow.com/users/1985957/thegamblerrises"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 273, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464196130, "creation_date": 1464181554, "last_edit_date": 1464182467, "question_id": 37438108, "link": "https://stackoverflow.com/questions/37438108/in-golang-can-i-customise-key-comparison-if-i-am-taking-struct-as-key", "title": "In Golang, can I customise key comparison, if I am taking struct as key?", "body": "<p>How does map in Golang compare keys? For some reason, I need to have a struct as a key, which has 2 values inside. I want map to compare by only first value, not second. Second is for my usage. Like in java, I can customise <code>equals</code> method, so map will take only <code>logically equal</code> keys within. Is there any way to do that?</p>\n\n<p>Edit: Looks like there is no way to do that. So I am now putting down my problem here. Please help me to think in 'Go-way'.</p>\n\n<p>So, I want to implement a 'timed map', which tracks the key insertion time. In other words, there is a map which accepts and processes the values. Now, if the data in map is older than some specific time-interval, then I should clear it out. </p>\n\n<p>So, I thought of having a key struct which has id and timestamp. When a new key comes, map takes it with id and currentTimeInMillis. After sometime, if a key comes which already exists, then map should preserve the first insertion time and only updates the value array. </p>\n\n<p>To process, I will have a looping over map and check if any particular key is inside for more than threshold limit, then I clear it out. I can have this timestamp in value array, but that also has a timestamp of its own, so putting one more might confuse someone else.</p>\n\n<p>Please suggest something.</p>\n"}, {"tags": ["plugins", "go", "influxdb"], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 6327865, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J8Neq.jpg?s=128&g=1", "display_name": "PhilDpt", "link": "https://stackoverflow.com/users/6327865/phildpt"}, "is_accepted": true, "score": 4, "last_activity_date": 1464598783, "creation_date": 1464598783, "answer_id": 37521611, "question_id": 37437090, "link": "https://stackoverflow.com/questions/37437090/how-to-add-a-plugin-to-telegraf/37521611#37521611", "title": "How to add a plugin to Telegraf?", "body": "<p>-> I receive this, it gave me a better understanding, I think it could be helpful:</p>\n\n<blockquote>\n  <p><a href=\"https://github.com/influxdata/telegraf/blob/master/CONTRIBUTING.md\" rel=\"nofollow\">https://github.com/influxdata/telegraf/blob/master/CONTRIBUTING.md</a></p>\n  \n  <p>\"His plugin code looks good to go. He needs to place that file in $GOPATH/src/github.com/influxdata/telegraf/plugin/inputs/testPlugin/testPlugin.go</p>\n  \n  <p>He should write a test for the plugin and place it at $GOPATH/src/github.com/influxdata/telegraf/plugin/inputs/testPlugin/testPlugin_test.go</p>\n  \n  <p>After this is complete he needs to register the plugin at $GOPATH/src/github.com/influxdata/telegraf/plugin/inputs/all/all.go</p>\n  \n  <p>Then he should run <code>make</code> from $GOPATH/src/github.com/influxdata/telegraf. This will place the new telegraf binary in $GOPATH/bin/telegraf.</p>\n  \n  <p>Run the binary with the following flags to generate the valid configuration:</p>\n  \n  <p>$GOPATH/bin/telegraf -sample-config -input-filter testPlugin -output-filter influxdb > testPlugin_config.conf</p>\n  \n  <p>From there you can run the binary with the -test flag by passing it the sample config:</p>\n  \n  <p>$GOPATH/bin/telegraf -config testPlugin_config.conf -test</p>\n  \n  <p>This will output the line protocol that is to be inserted into the database.\"</p>\n</blockquote>\n\n<p>-> And the <strong>testPlugin.go</strong> that he talks about: </p>\n\n<pre><code>package testPlugin\n\nimport (\n    \"time\"\n)\n\ntype ReadFile struct {\n counter int64\n}\n\nfunc (s *TestPlugin) Description() string {\n  return \"This is a test plugin to write data to influxdb with a plugin\"\n}\n\nfunc (s *TestPlugin) SampleConfig() string {\n  return \"ok = true # indicate if everything is fine\"\n}\n\nfunc Gather(acc telegraf.Accumulator) error {\n\nc := time.Tick(10 * time.Second)\nfor now := range c {\n\n    counter := counter + 1\n    acc.Add(\"counter\",counter, tags)\n }\n} \n\nfunc init() {\n  inputs.Add(\"testPlugin\", func() telegraf.Input { return &amp;TestPlugin{} })\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 25866, "user_id": 334831, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bf2a7f4d71e1d892ce564fe4bd81193f?s=128&d=identicon&r=PG", "display_name": "Tombart", "link": "https://stackoverflow.com/users/334831/tombart"}, "is_accepted": false, "score": 2, "last_activity_date": 1494406726, "creation_date": 1494406726, "answer_id": 43887869, "question_id": 37437090, "link": "https://stackoverflow.com/questions/37437090/how-to-add-a-plugin-to-telegraf/43887869#43887869", "title": "How to add a plugin to Telegraf?", "body": "<p>There's an opened issue for <a href=\"https://github.com/influxdata/telegraf/issues/1717\" rel=\"nofollow noreferrer\">external plugin support</a> which might be part of Telegraf 1.4.0. If will probably load <a href=\"https://github.com/influxdata/telegraf/pull/2373\" rel=\"nofollow noreferrer\">external *.so files</a>.</p>\n\n<p>Until then all plugins are supposed to be merged into master <a href=\"https://github.com/influxdata/telegraf/blob/master/CONTRIBUTING.md\" rel=\"nofollow noreferrer\">repository via PRs</a>. There are already many plugins waiting in review process. This model is obviously not very scalable.</p>\n"}], "owner": {"reputation": 113, "user_id": 6327865, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J8Neq.jpg?s=128&g=1", "display_name": "PhilDpt", "link": "https://stackoverflow.com/users/6327865/phildpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13824, "favorite_count": 1, "accepted_answer_id": 37521611, "answer_count": 2, "score": 6, "last_activity_date": 1494406726, "creation_date": 1464179157, "question_id": 37437090, "link": "https://stackoverflow.com/questions/37437090/how-to-add-a-plugin-to-telegraf", "title": "How to add a plugin to Telegraf?", "body": "<p>Hello I would to know if someone have all ready <strong>add a plugin to telegraf for Influxdb</strong>. \nI have my go code which is working. What do I need next and where to put theses files?</p>\n\n<p>I've found that I need to do something like this:</p>\n\n<pre><code>type ReadFile struct {\n    //buf []byte\n    //MemoryBytes int64\n   //PID int\n}\n\nfunc (s *ReadFile) Description() string {\n   return \"This is a test plugin to read data from a file and send them to influxdb\" }\n\nfunc (s *ReadFile) SampleConfig() string {\n    return \"ok = true # indicate if everything is fine\"\n}\n\nfunc Gather(acc plugins.Accumulator) error {\n\n     readFile(alarmFile)\n\n    acc.Add(\"alarm\", result_of_readFile_here, tags)\n    }\n  }\n\n    func init() {\n    plugins.Add(\"readFile\", func() plugins.Plugin { &amp;ReadFile{} })\n }\n</code></pre>\n\n<p>But is this my entire Go plugin or another file in Go to add with my Go program?</p>\n\n<p>And where does the file.conf is store?</p>\n\n<pre><code>[tags]\ndc = \"alarm\"\n\n[agent]\ninterval = \"10s\"\n\n# OUTPUTS\n[outputs]\n[outputs.influxdb]\nurl = \"http://127.0.0.1:8086\" # required.\ndatabase = \"summer\" # required.\nprecision = \"s\"\n\n# PLUGINS\n[readFile]\n</code></pre>\n\n<p>If you have a list of what I need, how to structure it, where I store file or maybe an example could be really helpful.</p>\n\n<p>Thanks!!</p>\n"}, {"tags": ["google-app-engine", "go", "go-gin"], "comments": [{"owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "edited": false, "score": 0, "creation_date": 1464191949, "post_id": 37434777, "comment_id": 62387041, "body": "Can you share your app.yaml as well?"}, {"owner": {"reputation": 620, "user_id": 2576287, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh5.googleusercontent.com/-VegFz4P9Ovc/AAAAAAAAAAI/AAAAAAAAATo/Z-69W9rBCno/photo.jpg?sz=128", "display_name": "mrLSD", "link": "https://stackoverflow.com/users/2576287/mrlsd"}, "reply_to_user": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "edited": false, "score": 0, "creation_date": 1464207125, "post_id": 37434777, "comment_id": 62395475, "body": "@Sean I added app.yaml and some folder structure"}], "answers": [{"comments": [{"owner": {"reputation": 620, "user_id": 2576287, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh5.googleusercontent.com/-VegFz4P9Ovc/AAAAAAAAAAI/AAAAAAAAATo/Z-69W9rBCno/photo.jpg?sz=128", "display_name": "mrLSD", "link": "https://stackoverflow.com/users/2576287/mrlsd"}, "edited": false, "score": 0, "creation_date": 1464246847, "post_id": 37447000, "comment_id": 62408373, "body": "Thanks for response! But app/ as sub directiry  not an accident. There are another problem: (<a href=\"https://groups.google.com/forum/#!topic/google-appengine-go/dNhqV6PBqVc\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/google-appengine-go/dNhqV6P&zwnj;&#8203;BqVc</a>)  for example: (<a href=\"https://github.com/andrascsibi/how-many-pullups\" rel=\"nofollow noreferrer\">github.com/andrascsibi/how-many-pullups</a>)"}, {"owner": {"reputation": 749, "user_id": 291340, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/29d1c6b3aca5e8ad8fc6e45b38c01811?s=128&d=identicon&r=PG", "display_name": "ccsakuweb", "link": "https://stackoverflow.com/users/291340/ccsakuweb"}, "edited": false, "score": 0, "creation_date": 1483622228, "post_id": 37447000, "comment_id": 70177171, "body": "Yes, I have the same issue than sean"}], "tags": [], "owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "is_accepted": false, "score": 1, "last_activity_date": 1464208006, "creation_date": 1464208006, "answer_id": 37447000, "question_id": 37434777, "link": "https://stackoverflow.com/questions/37434777/go-google-app-engine-cant-find-template-files/37447000#37447000", "title": "Go Google app engine - can&#39;t find template files", "body": "<p>If I'm not mistaken all of your directories should live within the root directory where your app.yaml exists.  So you would want something like this.  Also, when you want your application to access a static file directory you need to add <code>application_readable: true</code> to that directories definition.  See the next example down.  Hope this helps.</p>\n\n<pre><code>app/\n    app.go\n    app.yaml\n    static/\n        ...\n    frontend/views/\n        home/\n        *.html\n    anotherfolder/\n        *.html\n</code></pre>\n\n<p>Example Directory Definition:</p>\n\n<pre><code>- url: /s\n  static_dir: s/\n  application_readable: true\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 620, "user_id": 2576287, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh5.googleusercontent.com/-VegFz4P9Ovc/AAAAAAAAAAI/AAAAAAAAATo/Z-69W9rBCno/photo.jpg?sz=128", "display_name": "mrLSD", "link": "https://stackoverflow.com/users/2576287/mrlsd"}, "is_accepted": false, "score": 2, "last_activity_date": 1464256346, "creation_date": 1464256346, "answer_id": 37457338, "question_id": 37434777, "link": "https://stackoverflow.com/questions/37434777/go-google-app-engine-cant-find-template-files/37457338#37457338", "title": "Go Google app engine - can&#39;t find template files", "body": "<p>I found next solution.</p>\n\n<p>I reorginize structure:</p>\n\n<pre><code>app/\n    static/\n        ...\n    frontend/\n        views/\n           home/\n               *.html\n           user/\n               *.html\n           anotherfolder/\n               *.html\n    backend/\n        views/\n            main/\n                *.html\n            anotherfolder/\n                *.html\n    app.go\n    app.yaml\n\nfrontend/\n    controllers/\n        UserController.go\n        ...\n    models/\n        UserModel.go\n        ...\nbackend/\n    controllers/\n        MainController.go\n    ...\n    models/\n        SomeModel.go\n    ...\n...\n</code></pre>\n\n<p>Change:</p>\n\n<p><strong>app.yaml</strong></p>\n\n<pre><code>runtime: go\napi_version: go1\n\nhandlers:\n- url: /images\n  static_dir: static/images\n\n- url: /css\n  static_dir: static/css\n\n- url: /js\n  static_dir: static/js\n\n- url: /fonts\n  static_dir: static/fonts\n\n- url: /.*\n  script: _go_app\n</code></pre>\n\n<p>It's really strange ecision GAE. I can't put app.yaml to root directory for application because I got panic message for duplication import. And I can't put templates to root directory because that not under scope, only at directory parent to app.yaml</p>\n"}], "owner": {"reputation": 620, "user_id": 2576287, "user_type": "registered", "accept_rate": 56, "profile_image": "https://lh5.googleusercontent.com/-VegFz4P9Ovc/AAAAAAAAAAI/AAAAAAAAATo/Z-69W9rBCno/photo.jpg?sz=128", "display_name": "mrLSD", "link": "https://stackoverflow.com/users/2576287/mrlsd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 836, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1464256346, "creation_date": 1464173117, "last_edit_date": 1464247427, "question_id": 37434777, "link": "https://stackoverflow.com/questions/37434777/go-google-app-engine-cant-find-template-files", "title": "Go Google app engine - can&#39;t find template files", "body": "<p>I using Gin framework.\nAt local development mode: goapp serve\nall works fine.</p>\n\n<pre><code>func init() {\n    route := gin.Default()\n    route.LoadHTMLGlob(\"../*/views/**/*.html\")\n    ...\n}\n</code></pre>\n\n<p>But after deploy:</p>\n\n<blockquote>\n  <p>panic: html/template: pattern matches no files: <code>../*/views/**/*.html</code></p>\n</blockquote>\n\n<p>OK. I try:</p>\n\n<pre><code>func init() {\n    route := gin.Default()\n    dir, _ := filepath.Abs(filepath.Dir(os.Args[0]))\n    route.LoadHTMLGlob(dir + \"/../*/views/**/*.html\")\n    ...\n}\n</code></pre>\n\n<p>Same result.</p>\n\n<p>I try fetch dir:</p>\n\n<pre><code>...\ndir, err := filepath.Abs(filepath.Dir(os.Args[0]))\nif err != nil {\n    ...\n}\nc.String(http.StatusOK, \"Dir: \", dir)\n\nc.String(http.StatusOK, \"\\nOK\")\nres, err := filepath.Glob(dir + \"/*\")\nc.String(http.StatusOK, fmt.Sprintf(\"%v | %v\\n\\n\", res, err))\n\nc.String(http.StatusOK, \"Dirs:\")\nres, err = filepath.Glob(dir + \"/**/*\")\nc.String(http.StatusOK, fmt.Sprintf(\"%v | %v\", res, err))\n...\n</code></pre>\n\n<p>Result:</p>\n\n<blockquote>\n  <p>Dir: %!(EXTRA string=/base/data/home/apps/tmp-LEIYJC/_ah)\n  OK[/base/data/home/apps/tmp-LEIYJC/_ah/exe] | </p>\n  \n  <p>Dirs:[] | </p>\n</blockquote>\n\n<p>Ooops. What I done wrong?</p>\n\n<p>UPD:</p>\n\n<p><strong>app.yaml</strong></p>\n\n<pre><code>runtime: go\napi_version: go1\n\nhandlers:\n- url: /images\n  static_dir: ../static/images\n\n- url: /css\n  static_dir: ../static/css\n\n- url: /js\n  static_dir: ../static/js\n\n- url: /fonts\n  static_dir: ../static/fonts\n\n- url: /.*\n  script: _go_app\n</code></pre>\n\n<p>I put app.yaml to subdirectory, cause without that another problem:\n[<a href=\"https://groups.google.com/forum/#!topic/google-appengine-go/dNhqV6PBqVc\" rel=\"nofollow\">https://groups.google.com/forum/#!topic/google-appengine-go/dNhqV6PBqVc</a></p>\n\n<p><strong>Folder structure</strong>:</p>\n\n<pre><code>app/\n    app.go\n    app.yaml\nstatic/\n    ...\nfrontend/\ncontrollers/\n    UserController.go\n    ...\nmodels/\n    UserModel.go\n    ...\nviews/\n        home/\n            *.html\n        user/\n            *.html\n        anotherfolder/\n            *.html\nbackend/\ncontrollers/\n    MainController.go\n    ...\nmodels/\n    SomeModel.go\n    ...\nviews/\n        main/\n            *.html\n        anotherfolder/\n            *.html\n...\n</code></pre>\n"}, {"tags": ["function", "go", "var"], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1464171898, "post_id": 37434292, "comment_id": 62371725, "body": "Nice try. Unfortunately this will consume half of the fibonacci numbers and only half of them will be printed."}, {"owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1464171963, "post_id": 37434292, "comment_id": 62371771, "body": "@Volker Ah yes, duh. Edited."}], "tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": true, "score": 1, "last_activity_date": 1464172049, "last_edit_date": 1464172049, "creation_date": 1464171807, "answer_id": 37434292, "question_id": 37434201, "link": "https://stackoverflow.com/questions/37434201/how-to-assign-an-int-returned-by-a-function-to-a-variable/37434292#37434292", "title": "How to assign an int returned by a function to a variable?", "body": "<p>Try calling the function:</p>\n\n<pre><code>for x := f(); x &lt; 100; x = f() {\n    fmt.Println(x)\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 6380605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e406765bd381886e3d4d563a547ba375?s=128&d=identicon&r=PG&f=1", "display_name": "DigitalKraken", "link": "https://stackoverflow.com/users/6380605/digitalkraken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 37434292, "answer_count": 1, "score": 0, "last_activity_date": 1464172049, "creation_date": 1464171624, "last_edit_date": 1464171784, "question_id": 37434201, "link": "https://stackoverflow.com/questions/37434201/how-to-assign-an-int-returned-by-a-function-to-a-variable", "title": "How to assign an int returned by a function to a variable?", "body": "<p>I am new to Go and having some issues with figuring out a really simple problem. I am learning by working through some simple problem sets and at the moment am trying to print the sequence of Fibonacci numbers that are smaller than 10 million. My Fibonacci function is fine but I am not sure how to assign its value to a variable which I can then use in control structures. For instance:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc fib() func() int {\n    x, y := 0, 1\n    return func() int {\n        x, y = y, x+y\n        return x\n    }\n}\n\nfunc main() {\n    f := fib()\n    for f &lt;= 10000000 {\n        fmt.Println(f())\n    }\n}\n</code></pre>\n\n<p>I know I am missing something simple here but should this not keep calling my function and grabbing the next number in the Fibonacci sequence until that number is no greater than or equal to 10 million? I receive an error telling me there are mismatched types func() (int and int). I know this is dead simple and I am likely just an idiot.\nThanks in advance.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3359, "user_id": 122727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5e946def051f311e802140ecb9fbf?s=128&d=identicon&r=PG", "display_name": "kubanczyk", "link": "https://stackoverflow.com/users/122727/kubanczyk"}, "edited": false, "score": 1, "creation_date": 1569321664, "post_id": 37429317, "comment_id": 102551383, "body": "The <code>for i := 1; i &lt; ...</code> nicely handles empty slices, too, which other answers don&#39;t offer."}, {"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 0, "creation_date": 1595791871, "post_id": 37429317, "comment_id": 111589916, "body": "Isn&#39;t there a way to merge both answers? (they are the same and are just splitting the vote...)"}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 7, "last_activity_date": 1464160117, "last_edit_date": 1464160117, "creation_date": 1464157607, "answer_id": 37429317, "question_id": 37429248, "link": "https://stackoverflow.com/questions/37429248/skip-first-element-of-an-array-in-golang/37429317#37429317", "title": "Skip first element of an array in Golang", "body": "<p>Use a standard <code>for</code> loop or the slice operator:</p>\n\n<pre><code>for _, val := range Arr[1:] {\n    // Do something\n}\n\n// Or\nfor i := 1; i &lt; len(Arr); i++ {\n    val = Arr[i]\n    // Do something\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "reply_to_user": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 1, "creation_date": 1464158370, "post_id": 37429331, "comment_id": 62363255, "body": "@T.Claverie Good catch. I edited it. I was using len(Arr) Forgot to edit out the other part."}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1464159026, "post_id": 37429331, "comment_id": 62363652, "body": "It&#39;s enough the first version. It&#39;s more idiomatic and in the Go way."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 1, "creation_date": 1464181168, "post_id": 37429331, "comment_id": 62378443, "body": "and you should probably never name a variable &quot;l&quot; (lower case L) as it looks too much like a &quot;1&quot; (one) in most fonts.   When I read your second example, I thought it said Arr[1:1] (as in, a zero length slice starting at the second position)"}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1464181393, "post_id": 37429331, "comment_id": 62378657, "body": "@DavidBudworth Thanks, and will follow that advice."}, {"owner": {"reputation": 3359, "user_id": 122727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b5e946def051f311e802140ecb9fbf?s=128&d=identicon&r=PG", "display_name": "kubanczyk", "link": "https://stackoverflow.com/users/122727/kubanczyk"}, "edited": false, "score": 1, "creation_date": 1569322427, "post_id": 37429331, "comment_id": 102551839, "body": "Doesn&#39;t work on an empty slice <code>runtime error: slice bounds out of range</code>. See T. Claverie&#39;s answer."}], "tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": true, "score": 33, "last_activity_date": 1569412668, "last_edit_date": 1569412668, "creation_date": 1464157667, "answer_id": 37429331, "question_id": 37429248, "link": "https://stackoverflow.com/questions/37429248/skip-first-element-of-an-array-in-golang/37429331#37429331", "title": "Skip first element of an array in Golang", "body": "<p>Yes. Use this</p>\n\n<pre><code>for _, val := range Arr[1:] {\n// something to do with val\n}\n</code></pre>\n\n<p>Or in case you can get empty slice: </p>\n\n<pre><code>for i := 1; i &lt; len(Arr); i++ {\n// something to do with Arr[i]\n}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 1, "last_activity_date": 1464192794, "last_edit_date": 1464192794, "creation_date": 1464192083, "answer_id": 37442353, "question_id": 37429248, "link": "https://stackoverflow.com/questions/37429248/skip-first-element-of-an-array-in-golang/37442353#37442353", "title": "Skip first element of an array in Golang", "body": "<p>convert to slice then skip first element(with the range query):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    Arr := [...]int{1, 2, 3, 4}\n    for _, val := range Arr[1:] {\n        fmt.Println(val)\n    }\n}\n</code></pre>\n\n<p>using index to skip first element(with the range query):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    Arr := [...]int{1, 2, 3, 4}\n    for i, val := range Arr {\n        if i == 0 {\n            continue\n        }\n        fmt.Println(val)\n    }\n}\n</code></pre>\n\n<p>using one bool var to skip first element(with the range query):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    Arr := [...]int{1, 2, 3, 4}\n    first := true\n    for _, val := range Arr {\n        if first {\n            first = false\n            continue\n        }\n        fmt.Println(val)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2619, "user_id": 2249725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06905a0d11a7662cbadd4daffe029452?s=128&d=identicon&r=PG", "display_name": "mvndaai", "link": "https://stackoverflow.com/users/2249725/mvndaai"}, "is_accepted": false, "score": 0, "last_activity_date": 1464196370, "creation_date": 1464196370, "answer_id": 37443696, "question_id": 37429248, "link": "https://stackoverflow.com/questions/37429248/skip-first-element-of-an-array-in-golang/37443696#37443696", "title": "Skip first element of an array in Golang", "body": "<p>In case you what to do something different with the first value, you can do this:</p>\n\n<pre><code>for i, val := range Arr {\n   if i == 0 {\n       //Ignore or do something with first val   \n   }else{\n       // something have to do with val\n   }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 0, "creation_date": 1595791939, "post_id": 61115892, "comment_id": 111589944, "body": "Heh! Downvoted, since <code>len(Arr)-(len(Arr)-1) = 1</code> (do the math!) so you could pretty much save yourself two function calls (who knows, possibly the Go compiler catches that), and then your answer would be the same as <a href=\"https://stackoverflow.com/a/37429331/1035977\">stackoverflow.com/a/37429331/1035977</a> and <a href=\"https://stackoverflow.com/a/37429317/1035977\">stackoverflow.com/a/37429317/1035977</a>"}], "tags": [], "owner": {"reputation": 131, "user_id": 2018712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879b1800611aa7e8e8ce15e7834114d5?s=128&d=identicon&r=PG", "display_name": "ashokrajar", "link": "https://stackoverflow.com/users/2018712/ashokrajar"}, "is_accepted": false, "score": -1, "last_activity_date": 1604265845, "last_edit_date": 1604265845, "creation_date": 1586416814, "answer_id": 61115892, "question_id": 37429248, "link": "https://stackoverflow.com/questions/37429248/skip-first-element-of-an-array-in-golang/61115892#61115892", "title": "Skip first element of an array in Golang", "body": "<pre><code>for _, val := range Arr[len(Arr)-(len(Arr)-1):] {\n    // something have to do with val\n}\n</code></pre>\n<p>Instead use this</p>\n<pre><code>for _, val := range Arr[1:] {\n    // something have to do with val\n}\n</code></pre>\n"}], "owner": {"reputation": 2138, "user_id": 2315473, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/e611302f4eae2c6ddc4c6221b882bf69?s=128&d=identicon&r=PG&f=1", "display_name": "sunkuet02", "link": "https://stackoverflow.com/users/2315473/sunkuet02"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12616, "favorite_count": 2, "accepted_answer_id": 37429331, "answer_count": 5, "score": 16, "last_activity_date": 1604265845, "creation_date": 1464157381, "question_id": 37429248, "link": "https://stackoverflow.com/questions/37429248/skip-first-element-of-an-array-in-golang", "title": "Skip first element of an array in Golang", "body": "<p>I have the following code segments</p>\n\n<pre><code>for _, val := range Arr {\n    // something have to do with val\n}\n</code></pre>\n\n<p>In <strong>Arr</strong> , there might be more than 1 elements. I want to skip the first element of <strong>Arr</strong> and continue the loop from the second element.</p>\n\n<p>For example if <strong>Arr</strong> contains {1,2,3,4}. With the query I just want to take {2,3,4}.</p>\n\n<p>Is there a way to do that with the range query ?  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9243, "user_id": 1318181, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1ZfAE.png?s=128&g=1", "display_name": "kylieCatt", "link": "https://stackoverflow.com/users/1318181/kyliecatt"}, "edited": false, "score": 1, "creation_date": 1464145184, "post_id": 37427023, "comment_id": 62358975, "body": "Why are you even giving these function receivers? You don&#39;t use them. I feel like you are trying to make an <code>interface</code>."}, {"owner": {"reputation": 347, "user_id": 5207376, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/929972057068521/picture?type=large", "display_name": "Xu Chen", "link": "https://stackoverflow.com/users/5207376/xu-chen"}, "reply_to_user": {"reputation": 9243, "user_id": 1318181, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1ZfAE.png?s=128&g=1", "display_name": "kylieCatt", "link": "https://stackoverflow.com/users/1318181/kyliecatt"}, "edited": false, "score": 0, "creation_date": 1464147550, "post_id": 37427023, "comment_id": 62359499, "body": "it is a requirement of the question. I suspect the pic.ShowImage() is calling these methods for the interface image."}], "answers": [{"tags": [], "owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "is_accepted": false, "score": 2, "last_activity_date": 1464147929, "creation_date": 1464147929, "answer_id": 37427447, "question_id": 37427023, "link": "https://stackoverflow.com/questions/37427023/pointer-receiver-and-value-receiver-in-exerciseimage/37427447#37427447", "title": "Pointer receiver and value receiver in Exercise:Image", "body": "<p>There are two ways you can go about fixing this.</p>\n\n<p>one way is using</p>\n\n<pre><code>func main() {\n    m := &amp;Image{}\n    pic.ShowImage(m)\n}\n</code></pre>\n\n<p>the other way is using a constructor</p>\n\n<pre><code>func NewImage() *Image {\n    return &amp;Image{}\n}\n\nfunc main() {\n    m := NewImage()\n    pic.ShowImage(m)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 3, "last_activity_date": 1464151635, "creation_date": 1464151635, "answer_id": 37428037, "question_id": 37427023, "link": "https://stackoverflow.com/questions/37427023/pointer-receiver-and-value-receiver-in-exerciseimage/37428037#37428037", "title": "Pointer receiver and value receiver in Exercise:Image", "body": "<p>When you use interfaces in Go you need to make sure the instance you are using implements that interface.  In the Go-Tour example problem, <code>Image</code> does not satisfy the <code>image.Image</code> interface, only <code>&amp;Image</code> does.</p>\n\n<p>As such you need to either change your method signatures to take value receivers which will make <code>Image</code> work, or pass <code>&amp;Image</code> to the <code>pic.ShowImage</code> function since the pointer to <code>Image</code> does implement the interface.</p>\n"}], "owner": {"reputation": 347, "user_id": 5207376, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/929972057068521/picture?type=large", "display_name": "Xu Chen", "link": "https://stackoverflow.com/users/5207376/xu-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 328, "favorite_count": 1, "accepted_answer_id": 37428037, "answer_count": 2, "score": 1, "last_activity_date": 1464229991, "creation_date": 1464144892, "last_edit_date": 1464229991, "question_id": 37427023, "link": "https://stackoverflow.com/questions/37427023/pointer-receiver-and-value-receiver-in-exerciseimage", "title": "Pointer receiver and value receiver in Exercise:Image", "body": "<p>I am quite new to go, and quite confused about the receiver idea in Go. It is the exercise from A tour of Go. </p>\n\n<p>Question body:</p>\n\n<blockquote>\n  <p>Remember the picture generator you wrote earlier? Let's write another\n  one, but this time it will return an implementation of image.Image\n  instead of a slice of data.</p>\n  \n  <p>Define your own Image type, implement the necessary methods, and call\n  pic.ShowImage.</p>\n  \n  <p>Bounds should return a image.Rectangle, like image.Rect(0, 0, w, h).</p>\n  \n  <p>ColorModel should return color.RGBAModel.</p>\n  \n  <p>At should return a color; the value v in the last picture generator\n  corresponds to color.RGBA{v, v, 255, 255} in this one.</p>\n</blockquote>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport \"golang.org/x/tour/pic\"\nimport \"image\"\nimport \"image/color\"\n\n\ntype Image struct{}\n\nfunc (img *Image) Bounds() image.Rectangle{\n    w := 100\n    h := 100\n    return image.Rect(0,0,w,h)\n}\n\nfunc (img *Image) ColorModel() color.Model{\n    return color.RGBAModel\n}\n\nfunc (img *Image) At(x int, y int) color.Color{\n    return color.RGBA{uint8(x^y), uint8(y/2), 255,255}\n}\n\nfunc main() {\n    m := Image{}\n    pic.ShowImage(m)\n}\n</code></pre>\n\n<p>And it will report a compile error: </p>\n\n<h1>command-line-arguments ./compile110.go:26: cannot use m (type Image) as type image.Image in argument to pic.ShowImage:    Image does not implement image.Image (At method has pointer receiver)</h1>\n\n<hr>\n\n<p>My understanding is that for receivers of methods, it is alright to set them as either pointers or values. However, when I set all the \"*Image\" to \"Image\", the errors go away. </p>\n\n<p>Can someone help me with this?</p>\n\n<hr>\n\n<p>The answers provided below are sufficient for the question I raised. However, it seems that the pointer and value receivers thingy can be a bit more complicated.</p>\n\n<p>From Effective Go:</p>\n\n<blockquote>\n  <p>The rule about pointers vs. values for receivers is that value methods\n  can be invoked on pointers and values, but pointer methods can only be\n  invoked on pointers. This rule arises because pointer methods can\n  modify the receiver; invoking them on a value would cause the method\n  to receive a copy of the value, so any modifications would be\n  discarded. The language therefore disallows this mistake. There is a\n  handy exception, though. When the value is addressable, the language\n  takes care of the common case of invoking a pointer method on a value\n  by inserting the address operator automatically.</p>\n</blockquote>\n\n<p>Hope this will help some of you as well. </p>\n"}, {"tags": ["multithreading", "go"], "answers": [{"comments": [{"owner": {"reputation": 4316, "user_id": 1270000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/43931a46da4ec8856dfea56f2b165bf1?s=128&d=identicon&r=PG", "display_name": "sorifiend", "link": "https://stackoverflow.com/users/1270000/sorifiend"}, "edited": false, "score": 0, "creation_date": 1464143632, "post_id": 37426783, "comment_id": 62358647, "body": "Additional reading: <a href=\"http://stackoverflow.com/questions/25361831/benefits-of-runtime-lockosthread-in-golang\" title=\"benefits of runtime lockosthread in golang\">stackoverflow.com/questions/25361831/&hellip;</a>"}, {"owner": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "edited": false, "score": 3, "creation_date": 1464146034, "post_id": 37426783, "comment_id": 62359192, "body": "But the documentation states that &quot;<b>no</b> other goroutines can&quot; execute in that thread. That&#39;s misleading documentation if anything. I do not intend to sleep or halt the OS thread, but prevent the goroutine on line 3 of main from executing."}, {"owner": {"reputation": 4316, "user_id": 1270000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/43931a46da4ec8856dfea56f2b165bf1?s=128&d=identicon&r=PG", "display_name": "sorifiend", "link": "https://stackoverflow.com/users/1270000/sorifiend"}, "reply_to_user": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "edited": false, "score": 0, "creation_date": 1464147510, "post_id": 37426783, "comment_id": 62359488, "body": "Yeah it is a little misleading. However if you read through the insert in the middle it does say &quot;Until the calling goroutine exits -snip- no other goroutine can&quot;. The goroutine its talking about is referring to something else you run after using <code>LockOSThread()</code>. It should possibly have &quot;can be run&quot; at the end of that doc."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "reply_to_user": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "edited": false, "score": 1, "creation_date": 1464427950, "post_id": 37426783, "comment_id": 62490020, "body": "@EMBLEM, &quot;prevent the goroutine on line 3 of main from executing.&quot; then <code>LockOSThread</code> will not help you. Documentation is not misleading. As you can see in my answer, no other goroutine is execetuted on the thread but nothing stops the runtime to execute goroutine on other thread. Documentation is fine but you should read about Go&#39;s scheduler and how it correlates with <code>GOMAXPROCS</code>. <code>LockOSThread</code> is for cases when some piece of code has to execute on a specific thread. And it does exactly that."}], "tags": [], "owner": {"reputation": 4316, "user_id": 1270000, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/43931a46da4ec8856dfea56f2b165bf1?s=128&d=identicon&r=PG", "display_name": "sorifiend", "link": "https://stackoverflow.com/users/1270000/sorifiend"}, "is_accepted": false, "score": 0, "last_activity_date": 1464150427, "last_edit_date": 1464150427, "creation_date": 1464142892, "answer_id": 37426783, "question_id": 37426511, "link": "https://stackoverflow.com/questions/37426511/why-doesnt-gos-lockosthread-lock-this-os-thread/37426783#37426783", "title": "Why doesn&#39;t Go&#39;s LockOSThread lock this OS thread?", "body": "<p>That looks like correct behavior to me. From what I understand the <code>LockOSThread()</code> function only ties all future go calls to the single OS thread, it does not sleep or halt the thread ever.</p>\n\n<p>Edit for clarity: the only thing that <code>LockOSThread()</code> does is turn off multithreadding so that all future GO calls happen on a single thread. This is primarily for use with things like graphics API's that require a single thread to work correctly.</p>\n\n<p>Edited again.</p>\n\n<p>If you compare this:</p>\n\n<pre><code>func main() {\n    runtime.GOMAXPROCS(6)\n    //insert long running routine here.\n    go fmt.Println(\"This may run almost straight away if tho long routine uses a different thread\")\n}\n</code></pre>\n\n<p>To this:</p>\n\n<pre><code>func main() {\n    runtime.GOMAXPROCS(6)\n    runtime.LockOSThread()\n    //insert long running routine here.\n    go fmt.Println(\"This will only run after the task above has completed\")\n}\n</code></pre>\n\n<p>If we insert a long running routine in the location indicated above then the first block may run almost straight away if the long routine runs on a new thread, but in the second example it will always have to wait for the routine to complete.</p>\n"}, {"comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1464153618, "post_id": 37427671, "comment_id": 62361215, "body": "so the question <code>Why doesn&#39;t Go&#39;s LockOSThread lock this OS thread?</code> should be <code>why multiple goroutines run even if GOMAXPROCS set to 1</code>"}], "tags": [], "owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "is_accepted": true, "score": 6, "last_activity_date": 1464149334, "creation_date": 1464149334, "answer_id": 37427671, "question_id": 37426511, "link": "https://stackoverflow.com/questions/37426511/why-doesnt-gos-lockosthread-lock-this-os-thread/37427671#37427671", "title": "Why doesn&#39;t Go&#39;s LockOSThread lock this OS thread?", "body": "<p>From the <a href=\"https://golang.org/pkg/runtime/\"><code>runtime</code> package documentation</a>:</p>\n\n<blockquote>\n  <p>The GOMAXPROCS variable limits the number of operating system threads that can execute user-level Go code simultaneously. <strong>There is no limit to the number of threads that can be blocked in system calls on behalf of Go code; those do not count against the GOMAXPROCS limit.</strong></p>\n</blockquote>\n\n<p>The sleeping thread doesn't count towards the <code>GOMAXPROCS</code> value of 1, so Go is free to have another thread run the <code>fmt.Println</code> goroutine.</p>\n"}, {"tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": false, "score": 1, "last_activity_date": 1464186333, "creation_date": 1464186333, "answer_id": 37440072, "question_id": 37426511, "link": "https://stackoverflow.com/questions/37426511/why-doesnt-gos-lockosthread-lock-this-os-thread/37440072#37440072", "title": "Why doesn&#39;t Go&#39;s LockOSThread lock this OS thread?", "body": "<p>Here's a Windows sample that will probably help you understand what's going on. It prints thread IDs on which goroutines are running. Had to use syscall so it works only on Windows. But you can easily port it to other systems.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"golang.org/x/sys/windows\"\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(1)\n    runtime.LockOSThread()\n    ch := make(chan bool, 0)\n    go func(){\n        fmt.Println(\"2\", windows.GetCurrentThreadId())\n        &lt;- ch\n    }()\n    fmt.Println(\"1\", windows.GetCurrentThreadId())\n    &lt;- ch\n}\n</code></pre>\n\n<p>I don't use sleep to prevent runtime from spawning another thread for sleeping goroutine. Channel will block and just remove goroutine from running queue. If you execute the code you will see that thread IDs are different. Main goroutine locked one of the threads so the runtime has to spawn another one.</p>\n\n<p>As you already know <code>GOMAXPROCS</code> does not prevent the runtime from spawning more threads. <code>GOMAXPROCS</code> is more about the number of threads that can execute goroutines in parallel. But more threads can be created for goroutines that are waiting for syscall to complete, for example.</p>\n\n<p>If you remove <code>runtime.LockOSThread()</code> you will see that thread IDs are equal. That's because channel read blocks the goroutine and allows the runtime to yield execution to another goroutine without spawning new thread. That's how multiple goroutines can execute concurrently even when <code>GOMAXPROCS</code> is 1.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 14290872, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74c9558f17ec18ac49ee4492f5f51441?s=128&d=identicon&r=PG", "display_name": "Uday Jonnala", "link": "https://stackoverflow.com/users/14290872/uday-jonnala"}, "is_accepted": false, "score": 0, "last_activity_date": 1600316250, "last_edit_date": 1600316250, "creation_date": 1600301339, "answer_id": 63929499, "question_id": 37426511, "link": "https://stackoverflow.com/questions/37426511/why-doesnt-gos-lockosthread-lock-this-os-thread/63929499#63929499", "title": "Why doesn&#39;t Go&#39;s LockOSThread lock this OS thread?", "body": "<p>GOMAXPROCS(1) which causes you to have one ACTIVE M (OS thread) to be present to server the go routines (G).</p>\n<p>In your program there are two Go routines, one is <code>main</code>, and the other is <code>fmt.Println</code>. Since <code>main</code> routine is in sleep, M is free to run any go routine, which in this case <code>fmt.Println</code> can run.</p>\n"}], "owner": {"reputation": 1907, "user_id": 3161525, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6c4bdb240d87fd9fa82717d3cfbea305?s=128&d=identicon&r=PG&f=1", "display_name": "EMBLEM", "link": "https://stackoverflow.com/users/3161525/emblem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1945, "favorite_count": 1, "accepted_answer_id": 37427671, "answer_count": 4, "score": 8, "last_activity_date": 1600316250, "creation_date": 1464140554, "question_id": 37426511, "link": "https://stackoverflow.com/questions/37426511/why-doesnt-gos-lockosthread-lock-this-os-thread", "title": "Why doesn&#39;t Go&#39;s LockOSThread lock this OS thread?", "body": "<p><a href=\"https://golang.org/pkg/runtime/#LockOSThread\">The documentation</a> for <code>runtime.LockOsThread</code> states:</p>\n\n<blockquote>\n  <p>LockOSThread wires the calling goroutine to its current operating system thread. Until the calling goroutine exits or calls UnlockOSThread, it will always execute in that thread, and no other goroutine can.</p>\n</blockquote>\n\n<p>But consider this program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(1)\n    runtime.LockOSThread()\n    go fmt.Println(\"This shouldn't run\")\n    time.Sleep(1 * time.Second)\n}\n</code></pre>\n\n<p>The <code>main</code> goroutine is wired to the one available OS thread set by <code>GOMAXPROCS</code>, so I would expect that the goroutine created on line 3 of <code>main</code> will not run. But instead the program prints <code>This shouldn't run</code>, pauses for 1 second, and quits. Why does this happen?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464137943, "post_id": 37426051, "comment_id": 62357449, "body": "GAE uses its own Go runtime/compiler, the command line uses the installed Go version."}], "tags": [], "owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "is_accepted": false, "score": 0, "last_activity_date": 1464136500, "creation_date": 1464136500, "answer_id": 37426051, "question_id": 37425805, "link": "https://stackoverflow.com/questions/37425805/builds-at-commandline-but-fails-to-build-as-gae-app/37426051#37426051", "title": "Builds at commandline but fails to build as gae app", "body": "<p>I got past this issue by redownloading and reinstalling Go App Engine SDK .  My best guess why that worked is that an old version of go was somehow getting included.</p>\n"}], "owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464136500, "creation_date": 1464134466, "last_edit_date": 1464134849, "question_id": 37425805, "link": "https://stackoverflow.com/questions/37425805/builds-at-commandline-but-fails-to-build-as-gae-app", "title": "Builds at commandline but fails to build as gae app", "body": "<p>No issues building at commandline:</p>\n\n<blockquote>\n  <p>Darians-MacBook-Pro:gdriveweb darianhickman$ go build helloworld/hello.go</p>\n  \n  <p>Darians-MacBook-Pro:gdriveweb darianhickman$ </p>\n</blockquote>\n\n<p>Error at locahost:8080/</p>\n\n<blockquote>\n  <p>The Go application could not be built.</p>\n  \n  <p>(Executed command: /Users/darianhickman/go_appengine/goroot/bin/go-app-builder -app_base /Users/darianhickman/gowork/src/bitbucket.org/darian_hickman/gdriveweb/helloworld -arch 6 -dynamic -goroot /Users/darianhickman/go_appengine/goroot -nobuild_files ^^$ -unsafe -gopath /Users/darianhickman/gowork -binary_name _go_app -extra_imports appengine_internal/init -work_dir /var/folders/fk/wknp5jzn53gbgbml0yn695_m0000gn/T/tmpsHFP6tappengine-go-bin -gcflags -I,/Users/darianhickman/go_appengine/goroot/pkg/darwin_amd64_appengine -ldflags -L,/Users/darianhickman/go_appengine/goroot/pkg/darwin_amd64_appengine hello.go)\n  /Users/darianhickman/gowork/src/golang.org/x/net/context/ctxhttp/ctxhttp.go:35: req.Cancel undefined (type *http.Request has no field or method Cancel)</p>\n  \n  <p>2016/05/24 19:39:17 go-app-builder: build timing: 6\u00d76g (469ms total), 0\u00d76l (0 total)\n  2016/05/24 19:39:17 go-app-builder: failed running 6g: exit status 1</p>\n</blockquote>\n\n<p>When I research the error</p>\n\n<blockquote>\n  <p>*http.Request has no field or method Cancel</p>\n</blockquote>\n\n<p>it leads to a bunch of nonapplicable posts about updating to >Go1.5. </p>\n\n<p>Source:</p>\n\n<pre><code> package hello\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"golang.org/x/net/context\"\n    \"golang.org/x/oauth2\"\n    \"golang.org/x/oauth2/google\"\n    \"google.golang.org/api/drive/v3\"\n    _ \"google.golang.org/appengine/urlfetch\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"net/url\"\n    \"os\"\n    \"os/user\"\n    \"path/filepath\"\n)\n\nconst (\n    assetfolder = \"0B-zdryEj60U_MXVkajFweXBQWHM\"\n)\n\nvar (\n    dir *drive.FileList\n)\n\nfunc init() {\n    http.HandleFunc(\"/\", handler)\n\n    ctx := context.Background()\n\n    b, err := ioutil.ReadFile(\"client_secret.json\")\n    if err != nil {\n        log.Fatalf(\"Unable to read client secret file: %v\", err)\n    }\n\n    // If modifying these scopes, delete your previously saved credentials\n    // at ~/.credentials/drive-go-quickstart.json\n    config, err := google.ConfigFromJSON(b, drive.DriveMetadataReadonlyScope)\n    if err != nil {\n        log.Fatalf(\"Unable to parse client secret file to config: %v\", err)\n    }\n    client := getClient(ctx, config)\n\n    srv, err := drive.New(client)\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve drive Client %v\", err)\n    }\n\n    dir, err = srv.Files.List().PageSize(10).\n        Fields(\"nextPageToken, files(id, name)\").Do()\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve files.\", err)\n    }\n\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n\n    //fmt.Fprint(w, r.RequestURI)\n\n    fmt.Fprint(w, \"Files:\")\n    if len(dir.Files) &gt; 0 {\n        for _, i := range dir.Files {\n            fmt.Fprint(w, \"%s (%s)\\n\", i.Name, i.Id)\n        }\n    } else {\n        fmt.Fprint(w, \"No files found.\")\n    }\n}\n\n// getClient uses a Context and Config to retrieve a Token\n// then generate a Client. It returns the generated Client.\nfunc getClient(ctx context.Context, config *oauth2.Config) *http.Client {\n    cacheFile, err := tokenCacheFile()\n    if err != nil {\n        log.Fatalf(\"Unable to get path to cached credential file. %v\", err)\n    }\n    tok, err := tokenFromFile(cacheFile)\n    if err != nil {\n        tok = getTokenFromWeb(config)\n        saveToken(cacheFile, tok)\n    }\n    return config.Client(ctx, tok)\n}\n\n// getTokenFromWeb uses Config to request a Token.\n// It returns the retrieved Token.\nfunc getTokenFromWeb(config *oauth2.Config) *oauth2.Token {\n    authURL := config.AuthCodeURL(\"state-token\", oauth2.AccessTypeOffline)\n    fmt.Printf(\"Go to the following link in your browser then type the \"+\n        \"authorization code: \\n%v\\n\", authURL)\n\n    var code string\n    if _, err := fmt.Scan(&amp;code); err != nil {\n        log.Fatalf(\"Unable to read authorization code %v\", err)\n    }\n\n    tok, err := config.Exchange(oauth2.NoContext, code)\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve token from web %v\", err)\n    }\n    return tok\n}\n\n// tokenCacheFile generates credential file path/filename.\n// It returns the generated credential path/filename.\nfunc tokenCacheFile() (string, error) {\n    usr, err := user.Current()\n    if err != nil {\n        return \"\", err\n    }\n    tokenCacheDir := filepath.Join(usr.HomeDir, \".credentials\")\n    os.MkdirAll(tokenCacheDir, 0700)\n    return filepath.Join(tokenCacheDir,\n        url.QueryEscape(\"drive-go-quickstart.json\")), err\n}\n\n// tokenFromFile retrieves a Token from a given file path.\n// It returns the retrieved Token and any read error encountered.\nfunc tokenFromFile(file string) (*oauth2.Token, error) {\n    f, err := os.Open(file)\n    if err != nil {\n        return nil, err\n    }\n    t := &amp;oauth2.Token{}\n    err = json.NewDecoder(f).Decode(t)\n    defer f.Close()\n    return t, err\n}\n\n// saveToken uses a file path to create a file and store the\n// token in it.\nfunc saveToken(file string, token *oauth2.Token) {\n    fmt.Printf(\"Saving credential file to: %s\\n\", file)\n    f, err := os.Create(file)\n    if err != nil {\n        log.Fatalf(\"Unable to cache oauth token: %v\", err)\n    }\n    defer f.Close()\n    json.NewEncoder(f).Encode(token)\n}\n\nfunc main() {\n    ctx := context.Background()\n\n    b, err := ioutil.ReadFile(\"client_secret.json\")\n    if err != nil {\n        log.Fatalf(\"Unable to read client secret file: %v\", err)\n    }\n\n    // If modifying these scopes, delete your previously saved credentials\n    // at ~/.credentials/drive-go-quickstart.json\n    config, err := google.ConfigFromJSON(b, drive.DriveMetadataReadonlyScope)\n    if err != nil {\n        log.Fatalf(\"Unable to parse client secret file to config: %v\", err)\n    }\n    client := getClient(ctx, config)\n\n    srv, err := drive.New(client)\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve drive Client %v\", err)\n    }\n\n    r, err := srv.Files.List().PageSize(10).\n        Fields(\"nextPageToken, files(id, name)\").Do()\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve files.\", err)\n    }\n\n    fmt.Println(\"Files:\")\n    if len(r.Files) &gt; 0 {\n        for _, i := range r.Files {\n            fmt.Printf(\"%s (%s)\\n\", i.Name, i.Id)\n        }\n    } else {\n        fmt.Print(\"No files found.\")\n    }\n\n}\n</code></pre>\n"}, {"tags": ["http", "go", "concurrency"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1464134574, "post_id": 37425554, "comment_id": 62356722, "body": "You&#39;re using <code>member</code> on line 19 even when there&#39;s an error returned from <code>GetUser</code>. It doesn&#39;t seem related to concurrency -- perhaps you&#39;re seeing it now just because your concurrent version makes more calls to <code>GetUser</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "edited": false, "score": 0, "creation_date": 1464133400, "post_id": 37425621, "comment_id": 62356402, "body": "Actually, I&#39;m making the function into goroutines. Is there a better way to do it or by just checking this it should solve it? @evanmcdonnal"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "edited": false, "score": 0, "creation_date": 1464133468, "post_id": 37425621, "comment_id": 62356422, "body": "@Juanvulcano I would assume you&#39;re calling <code>concurrent</code> in a go routine like <code>go concurrent(10)</code>, you have no goroutines within <code>concurrent</code> so within that scope there is no concurrency. That being said, just the check will probably do it for you, I&#39;d be surprised if the root cause isn&#39;t a failure in <code>GetUser</code>"}, {"owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "edited": false, "score": 0, "creation_date": 1464133583, "post_id": 37425621, "comment_id": 62356454, "body": "I&#39;m using a for loop. <a href=\"https://play.golang.org/p/WyjoLFzCVW\" rel=\"nofollow noreferrer\">play.golang.org/p/WyjoLFzCVW</a> Am I doing it wrong? @evanmcdonnal"}, {"owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "edited": false, "score": 0, "creation_date": 1464134440, "post_id": 37425621, "comment_id": 62356693, "body": "I implemented your code, it still fails. What could it be?"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1464133115, "creation_date": 1464133115, "answer_id": 37425621, "question_id": 37425554, "link": "https://stackoverflow.com/questions/37425554/golang-nil-pointer-dereference-or-invalid-memory-address/37425621#37425621", "title": "Golang, nil pointer dereference or invalid memory address", "body": "<p>Firstly, you could prevent the panic by checking the return value of <code>GetUser</code> which you're currently ignoring;</p>\n\n<pre><code>        member,  err := s.GetUser(i)\n        if err != nil {\n           // handle error\n        }\n        if member != nil { // prevents the panic attempting to access Username on nil instance of user/member\n             output &lt;- fmt.Sprint(member.Username) //This is line 19 that triggers the error\n            if err != nil &amp;&amp; member != nil {\n              continue\n           }\n       }\n</code></pre>\n\n<p>Beyond that, what is <code>GetUser</code> doing? If it's making an HTTP GET, then typically the application would block until it returns, meaning chances are, if you check your error, there will be one like an HTTP 404, 403, 500 ect.</p>\n\n<p>If the call to <code>GetUser</code> were concurrent, then you could run into an issue where the code below attempts to access the <code>member.Username</code> before <code>GetUser</code> has returned causing the <code>nil</code> panic but I don't see how that could happen since you have no goroutine there. It should just be a simple blocking call. If you find the above suggestion doesn't lead you to the root cause of your problem, then edit your question with the results from <code>GetUser</code> and it's implementation and I'll look into it further.</p>\n"}], "owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5799, "favorite_count": 0, "accepted_answer_id": 37425621, "answer_count": 1, "score": 0, "last_activity_date": 1464133115, "creation_date": 1464132688, "question_id": 37425554, "link": "https://stackoverflow.com/questions/37425554/golang-nil-pointer-dereference-or-invalid-memory-address", "title": "Golang, nil pointer dereference or invalid memory address", "body": "<p>my code works perfectly until I want to scale it using many concurrent calls. It works by asking the client a Get request.</p>\n\n<p>This is what I'm getting:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x0 pc=0x400da9]\n\ngoroutine 125 [running]:\nruntime.panic(0x697480, 0x850d13)\n    /usr/lib/go/src/pkg/runtime/panic.c:279 +0xf5\nmain.concurrent(0x25e5)\n    /home/maker/go/src/GoBot/GoBot.go:19 +0x1a9\ncreated by main.main\n    /home/maker/go/src/GoBot/GoBot.go:51 +0x224\n</code></pre>\n\n<p>I think I'm not properly handling the error and when making a lot of requests it crashes.</p>\n\n<pre><code>func concurrent(n uint64) {\n    for i := n; i &lt; n+11; i++ {\n            member,  err := s.GetUser(i)\n            output &lt;- fmt.Sprint(member.Username) //This is line 19 that triggers the error\n            if err != nil &amp;&amp; member != nil {\n              continue\n           }\n     }\ndefer wg.Done()\n}\n</code></pre>\n\n<p>How can I solve this?\nReferences for s.GetUser here:\n<a href=\"https://github.com/njasm/gosoundcloud/blob/master/soundcloud.go#L274\" rel=\"nofollow\">https://github.com/njasm/gosoundcloud/blob/master/soundcloud.go#L274</a></p>\n"}, {"tags": ["go", "dependency-management"], "answers": [{"tags": [], "owner": {"reputation": 2666, "user_id": 1421957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8e742c4a05e312502c828847c455ad?s=128&d=identicon&r=PG", "display_name": "Tico", "link": "https://stackoverflow.com/users/1421957/tico"}, "is_accepted": false, "score": 0, "last_activity_date": 1464130235, "last_edit_date": 1464130235, "creation_date": 1464129409, "answer_id": 37425030, "question_id": 37424862, "link": "https://stackoverflow.com/questions/37424862/how-to-specify-install-dependencies-for-go-get/37425030#37425030", "title": "How to specify install dependencies for go get", "body": "<p>In one of my projects I use <a href=\"https://github.com/tools/godep\" rel=\"nofollow\">Godep</a>. According to its page:</p>\n\n<blockquote>\n  <p>This tool assumes you are working in a standard Go workspace, as\n  described in <a href=\"http://golang.org/doc/code.html\" rel=\"nofollow\">http://golang.org/doc/code.html</a>. We expect godep to build\n  on Go 1.4* or newer, but you can use it on any project that works with\n  Go 1 or newer.</p>\n</blockquote>\n\n<p>You'll have your dependencies in a JSON file, just like Node, Bower, etc... It's vert simple to use.</p>\n\n<p>In your case, assuming you already have <code>go get</code>ed the package, run:</p>\n\n<pre><code>godep save\n</code></pre>\n\n<p>This will generate the JSON file with all your other dependencies and save to a folder in your project. Thanks to it I was capable of cross compiling my project.</p>\n"}, {"comments": [{"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1464157095, "post_id": 37429043, "comment_id": 62362615, "body": "Wouldn&#39;t that mean having all the assets twice, once encoded and once original?"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1464156576, "creation_date": 1464156576, "answer_id": 37429043, "question_id": 37424862, "link": "https://stackoverflow.com/questions/37424862/how-to-specify-install-dependencies-for-go-get/37429043#37429043", "title": "How to specify install dependencies for go get", "body": "<p>To answer your question: No. </p>\n\n<p>But you could vendor go-bindata into your project which would make it available after after <code>go get</code>ing your project.</p>\n\n<p>But maybe there is a slight confusion about when and why to run <code>go generate</code>: The intended use for <code>go generate</code> (as I understand it) is for package or command <em>authors</em> to generate code during the development phase. Code which is checked in and processed \"normally\" by <code>go {build,install,get}</code>. So <em>you</em> run <code>go generate</code>, check in the generated stuff and users of your package <code>go get</code> it and do <em>not</em> run go generate. They don't need to, the code comes in the proper checked in version during <code>get</code>ing.</p>\n\n<p>For more complicated builds which a end-user has to perform: Use Makefiles or similar tools as such stuff is out of the scope of <code>go get</code>.</p>\n"}], "owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 890, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1464156576, "creation_date": 1464128541, "question_id": 37424862, "link": "https://stackoverflow.com/questions/37424862/how-to-specify-install-dependencies-for-go-get", "title": "How to specify install dependencies for go get", "body": "<p>I can specify dependencies to be downloaded by <code>go get</code> after checking out my project by importing them. I can even force the download of packages that are not used in the code by importing them for side effects:</p>\n\n<p><code>import _ \"github.com/jteeuwen/go-bindata\"</code></p>\n\n<p>Furthermore, on the shell I can apparently <em>install</em> a program with <code>go get</code> by using an ellipsis after the path:</p>\n\n<pre><code>$ go get github.com/jteeuwen/go-bindata/...\n</code></pre>\n\n<p>However, it seems I cannot combine both techniques:</p>\n\n<p><code>import _ \"github.com/jteeuwen/go-bindata/...\"</code></p>\n\n<pre><code>$ go get\nmain.go:9:8: open c:\\gopath\\src\\github.com\\jteeuwen\\go-bindata\\...: Access denied\n</code></pre>\n\n<p>I would like to tell <code>go get</code> that for building (actually <code>go generate</code>ing) this project, <a href=\"https://github.com/jteeuwen/go-bindata\" rel=\"nofollow\"><code>go-bindata</code></a> has to be <em>installed</em>. Is it possible to specify install-dependencies?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1464121757, "post_id": 37423213, "comment_id": 62351742, "body": "I always struggle finding type names for global variables because <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/zD8tRKAmoJE\" rel=\"nofollow noreferrer\">I read</a> you shouldn&#39;t name them <code>var something somethingType</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1464122696, "last_edit_date": 1464122696, "creation_date": 1464121540, "answer_id": 37423213, "question_id": 37423058, "link": "https://stackoverflow.com/questions/37423058/how-to-not-initialize-part-of-a-struct/37423213#37423213", "title": "How to not initialize part of a struct", "body": "<p>You use a type literal:</p>\n\n<pre><code>stats := struct {\n    sync.RWMutex\n    m map[string]statsEntry\n}{\n    sync.RWMutex{},\n    make(map[string]statsEntry),\n}\n</code></pre>\n\n<p>But since the zero value of <code>sync.RWMutex</code> is valid, you can skip it and specify the fields you're assigning</p>\n\n<pre><code>stats := struct {\n    sync.RWMutex\n    m map[string]statsEntry\n}{\n    m: make(map[string]statsEntry),\n}\n</code></pre>\n\n<p>But it's often just clearer to define the type locally</p>\n\n<pre><code>type s struct {\n    sync.RWMutex\n    m map[string]statsEntry\n}\n\nstats = s{m: make(map[string]statsEntry)}\n</code></pre>\n"}], "owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 37423213, "answer_count": 1, "score": 2, "last_activity_date": 1464122696, "creation_date": 1464120970, "last_edit_date": 1464121839, "question_id": 37423058, "link": "https://stackoverflow.com/questions/37423058/how-to-not-initialize-part-of-a-struct", "title": "How to not initialize part of a struct", "body": "<p>I want to combine what I think is called a <em>grouped global</em> with an <em>embedded lock</em> like this:</p>\n\n<pre><code>var stats struct {\n    sync.RWMutex\n    m map[string]statsEntry\n}\n</code></pre>\n\n<p>Unfortunately for the map to be useful, it has to be made, so the code becomes:</p>\n\n<pre><code>var stats = struct {\n  sync.RWMutex\n  m map[string]statsEntry\n}\n{\n  ???,\n  make(map[string]statsEntry),\n}\n</code></pre>\n\n<p>What to put instead of <code>???</code>?</p>\n"}, {"tags": ["arrays", "go"], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 8, "last_activity_date": 1464119016, "last_edit_date": 1464119016, "creation_date": 1464118696, "answer_id": 37422446, "question_id": 37422338, "link": "https://stackoverflow.com/questions/37422338/golang-trimming-leading-characters-from-byteslice-until-some-specific-character/37422446#37422446", "title": "GOLANG Trimming leading characters from byteslice until some specific character is encountered", "body": "<p>Find the first index of the rune '{' in the byte slice and re-slice <code>b</code>. The <a href=\"https://godoc.org/bytes\">bytes</a> package provide such functions:</p>\n\n<pre><code>var b = []byte(\"I want this removed {here is some json}\")\nb = b[bytes.IndexRune(b, '{'):]\nfmt.Println(string(b))\n# {here is some json}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/B-KPV0wgKk\">Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": false, "score": 3, "last_activity_date": 1464120318, "last_edit_date": 1464120318, "creation_date": 1464118723, "answer_id": 37422456, "question_id": 37422338, "link": "https://stackoverflow.com/questions/37422338/golang-trimming-leading-characters-from-byteslice-until-some-specific-character/37422456#37422456", "title": "GOLANG Trimming leading characters from byteslice until some specific character is encountered", "body": "<p>Find the index of the first brace. Then, you can use strings.substring, or you can slice your byte array:</p>\n\n<pre><code>var b = []byte(\"I want this removed {here is some json}\")\ni := strings.Index(string(b), \"{\")\nfmt.Println(string(b[i:]))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/FFFPJEbnLj\" rel=\"nofollow\">https://play.golang.org/p/FFFPJEbnLj</a></p>\n"}], "owner": {"reputation": 166, "user_id": 5853709, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/hkHXI.png?s=128&g=1", "display_name": "FS&#39;W&#230;hre", "link": "https://stackoverflow.com/users/5853709/fsw%c3%a6hre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 0, "accepted_answer_id": 37422446, "answer_count": 2, "score": 1, "last_activity_date": 1605916995, "creation_date": 1464118373, "last_edit_date": 1605916995, "question_id": 37422338, "link": "https://stackoverflow.com/questions/37422338/golang-trimming-leading-characters-from-byteslice-until-some-specific-character", "title": "GOLANG Trimming leading characters from byteslice until some specific character is encountered", "body": "<p>I have a slice of bytes which contains a json object inclosed in curlybrackets with some leading characters of variable lenght. I need to trim away the leading characters until the first curlybracket is encountered. How can i do this? Below is some code just to give an idea of what i want it to look like, the \"somefunction()\" is the function i'm hoping someone can tell me about.</p>\n\n<pre><code>var b = []byte(\"I want this removed {here is some json}\")\na := somefunction(b, \"{\")\nfmt.Println(string(a)) // desired output: {here is some json}\n</code></pre>\n"}, {"tags": ["file", "go", "concurrency"], "comments": [{"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 0, "creation_date": 1464116506, "post_id": 37421669, "comment_id": 62348966, "body": "Why would you not want to use a mutex to lock it? You&#39;ll run into a race condition. Unless you have a SERIOUS requirement that prevents you from doing so, I absolutely would lock your read/writes."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464117178, "post_id": 37421669, "comment_id": 62349313, "body": "<code>os.File</code> isn&#39;t guaranteed to be safe for concurrent writes. You need a lock (though you could open the file multiple times with O_APPEND)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1464119408, "post_id": 37421669, "comment_id": 62350470, "body": "Do you <i>append</i> to your file in each request or do you <i>rewrite</i> your file in each request? The latter could be done in parallel to reads using temporary file and atomicity guarantees of the <code>rename(2)</code> call. The former must use some sort of synchronization -- such as <code>sync.RWMutex</code>."}], "answers": [{"tags": [], "owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "is_accepted": false, "score": 4, "last_activity_date": 1464119249, "creation_date": 1464119249, "answer_id": 37422579, "question_id": 37421669, "link": "https://stackoverflow.com/questions/37421669/reading-from-file-without-locking-it/37422579#37422579", "title": "Reading from file without locking it", "body": "<p>You could make use of <a href=\"https://godoc.org/sync#RWMutex\" rel=\"nofollow noreferrer\"><code>sync.RWMutex</code></a>. Then:</p>\n\n<ul>\n<li>When you need to read the file, call <code>RLock()</code>, read, then call <code>RUnlock()</code>.</li>\n<li>When you need to write to the file, call <code>Lock()</code>, write, then call <code>Unlock()</code>.</li>\n</ul>\n\n<p>As long as you do that, you're ensuring that:</p>\n\n<ul>\n<li>Only one goroutine will be writing to the file at any time.</li>\n<li>If you try to read the file while it's being modified, the lock will wait until you finish writing before starting to read the file.</li>\n<li>If you try to write to the file while it's being read, the lock will wait until you finish reading before starting to write.</li>\n</ul>\n\n<p>Here's a very little example:</p>\n\n<pre><code>package sample\n\nimport (\n    \"sync\"\n)\n\nvar fileMutex = new(sync.RWMutex)\n\nfunc readFile() {\n    fileMutex.RLock()\n    defer fileMutex.RUnlock()\n\n    // Read the file. Don't modify it.\n}\n\nfunc writeFile() {\n    fileMutex.Lock()\n    defer fileMutex.Unlock()\n\n    // Write to the file.\n}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1464208930, "creation_date": 1464208930, "answer_id": 37447244, "question_id": 37421669, "link": "https://stackoverflow.com/questions/37421669/reading-from-file-without-locking-it/37447244#37447244", "title": "Reading from file without locking it", "body": "<p>so you want Read &amp; Write file <strong>without locking</strong> it,<br>\n<a href=\"https://gobyexample.com/stateful-goroutines\" rel=\"nofollow\">Stateful Goroutines</a> and channels are the solution:<br>\none Stateful Goroutine manages the read and write requests.<br>\nworking sample code:  </p>\n\n<pre><code>package main\n\nimport \"os\"\nimport \"fmt\"\nimport \"sync\"\n\ntype Buffer struct {\n    buf []byte\n    off int64\n}\n\nvar wg sync.WaitGroup\n\nfunc main() {\n    wr := make(chan *Buffer)\n    rq := make(chan *Buffer)\n    rd := make(chan *Buffer)\n    wg.Add(1)\n    go manage(\"file.bin\", wr, rq, rd)\n\n    wr &lt;- &amp;Buffer{buf: []byte{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}, off: 0}            //write\n    wr &lt;- &amp;Buffer{buf: []byte{10, 11, 12, 13, 14, 15, 16, 17, 18, 19}, off: 10} //write\n\n    rq &lt;- &amp;Buffer{buf: make([]byte, 20), off: 0} //request to read\n    b := &lt;-rd                                    //read\n    fmt.Println(\"read:\", b)\n    //read: &amp;{[1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19] 0}\n\n    rq &lt;- &amp;Buffer{buf: nil, off: -1} // exit\n    wg.Wait()\n    fmt.Println(\"Bye\") //Bye\n}\n\nfunc manage(filename string, wr, rq, rd chan *Buffer) {\n    f, e := os.OpenFile(filename, os.O_RDWR|os.O_CREATE|os.O_TRUNC, 0666)\n    if e != nil {\n        panic(e.Error())\n    }\n    defer f.Close()\n    for {\n        select {\n        case b := &lt;-wr:\n            f.WriteAt(b.buf, b.off)\n        default:\n        }\n        select {\n        case b := &lt;-rq:\n            if b.off == -1 {\n                wg.Done()\n                return\n            }\n            n, _ := f.ReadAt(b.buf, b.off)\n            rd &lt;- &amp;Buffer{b.buf[1:n], b.off}\n        default:\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1784, "user_id": 5479258, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/9013d6bb5ccbdd8ef0cac115267fa2f1?s=128&d=identicon&r=PG&f=1", "display_name": "user99999", "link": "https://stackoverflow.com/users/5479258/user99999"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1156, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1464208930, "creation_date": 1464115947, "question_id": 37421669, "link": "https://stackoverflow.com/questions/37421669/reading-from-file-without-locking-it", "title": "Reading from file without locking it", "body": "<p>I constantly write to one file some data everytime requests come in. I also want to parse this file and read from it sometimes. How can I do this reading if the file is constantly being written to? What's the pattern?</p>\n"}, {"tags": ["linux", "go", "runc"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464114034, "post_id": 37420728, "comment_id": 62347757, "body": "<a href=\"https://golang.org/pkg/os/exec/#Cmd.CombinedOutput\" rel=\"nofollow noreferrer\"><code>CombinedOutput</code></a> blocks until the process exits. If you don&#39;t want to block, use <code>Start()</code>"}, {"owner": {"reputation": 51, "user_id": 6031373, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eolisCIgLxc/AAAAAAAAAAI/AAAAAAAAAGA/j7GnOFn5SIk/photo.jpg?sz=128", "display_name": "Docker hero", "link": "https://stackoverflow.com/users/6031373/docker-hero"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464114562, "post_id": 37420728, "comment_id": 62348019, "body": "start will runc it in a separate thread so it doesn&#39;t wait for it be done"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464115882, "post_id": 37420728, "comment_id": 62348651, "body": "Oh, you want runc to detach, not the exec.Cmd (BTW, all subprocess are managed in separate threads, but <code>CombinedOutput</code> calls <code>Wait</code> for you). I&#39;m not too familiar with runc, does the container rely on a console? In which case you could specify one with <code>--console</code>."}, {"owner": {"reputation": 51, "user_id": 6031373, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eolisCIgLxc/AAAAAAAAAAI/AAAAAAAAAGA/j7GnOFn5SIk/photo.jpg?sz=128", "display_name": "Docker hero", "link": "https://stackoverflow.com/users/6031373/docker-hero"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464118268, "post_id": 37420728, "comment_id": 62349898, "body": "No I am creating a demonized container that doesn&#39;t have a console the strange is that the <code>runc start -d -b &#47;containers&#47;redis redis </code> works fine"}], "answers": [{"tags": [], "owner": {"reputation": 10312, "user_id": 42219, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/918b627daf7d848cd40770ed6cd15233?s=128&d=identicon&r=PG", "display_name": "apenwarr", "link": "https://stackoverflow.com/users/42219/apenwarr"}, "is_accepted": false, "score": 0, "last_activity_date": 1546469835, "last_edit_date": 1546469835, "creation_date": 1546469662, "answer_id": 54014233, "question_id": 37420728, "link": "https://stackoverflow.com/questions/37420728/runc-container-start-go-lang-deattached-mode/54014233#54014233", "title": "runc container start go-lang deattached mode", "body": "<p>When you start a subprocess from sh, it waits for the child process to exit (using something like <code>waitpid()</code>), and then immediately returns.  The stdout and stderr of the subprocess (and all its children) will be written directly to your terminal (not via sh), even after sh has returned to the prompt.  This is also what <code>.Start()</code> would do.</p>\n\n<p>When you use <code>.CombinedOutput()</code>, you wait until the stdout and stderr of the started process (and all subprocesses that inherit it) get closed.  Even if your immediate child process (<code>runc start</code>) exits, the container it starts might still have a copy of the stdout and stderr and be writing to them, so <code>.CombinedOutput()</code> can't return until it's sure all copies of those files are closed.</p>\n"}], "owner": {"reputation": 51, "user_id": 6031373, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-eolisCIgLxc/AAAAAAAAAAI/AAAAAAAAAGA/j7GnOFn5SIk/photo.jpg?sz=128", "display_name": "Docker hero", "link": "https://stackoverflow.com/users/6031373/docker-hero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1546469835, "creation_date": 1464112816, "question_id": 37420728, "link": "https://stackoverflow.com/questions/37420728/runc-container-start-go-lang-deattached-mode", "title": "runc container start go-lang deattached mode", "body": "<p>I'm testing runc container start time using an automatic go lang script\nmy code is like below and it keep blocking the process even that it runs without blocking in shell.</p>\n\n<pre><code>    command := exec.Command(\"runc\",\"start\",\"-d\",\"redis\")\n    command.Dir = \"/containers/redis\"\n    start := time.Now() \n    r,err:=command.CombinedOutput()\n    duration:= time.Since(start)/time.Millisecond\n    fmt.Println(duration)   \n    fmt.Println(err) \n    fmt.Println(string(r))\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "kubernetes-health-check"], "answers": [{"tags": [], "owner": {"reputation": 96, "user_id": 4783696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4afa64c5c405f389699b4890ae50b3e2?s=128&d=identicon&r=PG&f=1", "display_name": "Pablo Mercado", "link": "https://stackoverflow.com/users/4783696/pablo-mercado"}, "is_accepted": false, "score": 1, "last_activity_date": 1464113204, "creation_date": 1464113204, "answer_id": 37420854, "question_id": 37419260, "link": "https://stackoverflow.com/questions/37419260/how-should-i-check-the-health-of-my-go-service-in-kubernetes/37420854#37420854", "title": "How should I check the health of my go service in Kubernetes?", "body": "<p>I won't get into reasoning about the convenience of instrumenting the process running into the pod to focus on the question.</p>\n\n<p>I'd avoid creating another process inside the container to expose data, or modify the current process just to expose health endpoint, so I'd choose the liveness check exec way. It doesn't gets into your application and hopefully, it will only consume some cycles of CPU periodically. </p>\n\n<p>Anyway, if you decide to expose health info from the pod, I'd use a <a href=\"http://kubernetes.io/docs/user-guide/pods/multi-container/\" rel=\"nofollow\">multi-container pod</a>, with the health exposing application as a sidecar and the working process in a different container.</p>\n"}, {"tags": [], "owner": {"reputation": 3027, "user_id": 3653449, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/YE2UG.jpg?s=128&g=1", "display_name": "Tim Hockin", "link": "https://stackoverflow.com/users/3653449/tim-hockin"}, "is_accepted": true, "score": 1, "last_activity_date": 1472682303, "creation_date": 1472682303, "answer_id": 39259931, "question_id": 37419260, "link": "https://stackoverflow.com/questions/37419260/how-should-i-check-the-health-of-my-go-service-in-kubernetes/39259931#39259931", "title": "How should I check the health of my go service in Kubernetes?", "body": "<p>In general I recommend the HTTP mechanism because it is SO easy to add in Go.  If you already have an <code>exec</code>able command that will return a useful status, go for it.  Or you might consider <a href=\"https://github.com/kubernetes/contrib/tree/master/exec-healthz\" rel=\"nofollow\">https://github.com/kubernetes/contrib/tree/master/exec-healthz</a></p>\n"}], "owner": {"reputation": 3796, "user_id": 104749, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/E0lCr.png?s=128&g=1", "display_name": "Ross McFarlane", "link": "https://stackoverflow.com/users/104749/ross-mcfarlane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1407, "favorite_count": 1, "accepted_answer_id": 39259931, "answer_count": 2, "score": 3, "last_activity_date": 1472682303, "creation_date": 1464107670, "question_id": 37419260, "link": "https://stackoverflow.com/questions/37419260/how-should-i-check-the-health-of-my-go-service-in-kubernetes", "title": "How should I check the health of my go service in Kubernetes?", "body": "<p>I'm running a service written in go in a pod in Kubernetes. The service doesn't expose an HTTP interface; it's processing work from a queue.</p>\n\n<p>I could:</p>\n\n<ul>\n<li>Use an executable liveness check to see if the process is running</li>\n<li>Expose an HTTP health check endpoint</li>\n<li>Use expvars to expose basic health data.</li>\n</ul>\n\n<p>Is there a common / idiomatic way of doing this in go/Kubernetes?</p>\n"}, {"tags": ["ajax", "go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 1784, "user_id": 5479258, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/9013d6bb5ccbdd8ef0cac115267fa2f1?s=128&d=identicon&r=PG&f=1", "display_name": "user99999", "link": "https://stackoverflow.com/users/5479258/user99999"}, "edited": false, "score": 0, "creation_date": 1464189475, "post_id": 37421338, "comment_id": 62385181, "body": "Thanks! It helper me a lot, but I got one more little question - where do I send <code>false</code> to w.QuitChan?"}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "reply_to_user": {"reputation": 1784, "user_id": 5479258, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/9013d6bb5ccbdd8ef0cac115267fa2f1?s=128&d=identicon&r=PG&f=1", "display_name": "user99999", "link": "https://stackoverflow.com/users/5479258/user99999"}, "edited": false, "score": 1, "creation_date": 1464190458, "post_id": 37421338, "comment_id": 62385887, "body": "Its better to <code>close(w.QuitChan)</code> rather then send <code>false</code>. And, I dont know =) You do not track/keep pointers to workers. The only place you have pointers to workers is the first &quot;for&quot; loop in StartDispatcher(). Save these pointers in a slice and later you will be able to stop them."}], "tags": [], "owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1464114870, "creation_date": 1464114870, "answer_id": 37421338, "question_id": 37418623, "link": "https://stackoverflow.com/questions/37418623/queuing-ajax-requests-using-go-routines/37421338#37421338", "title": "Queuing ajax requests using go routines", "body": "<p>And i dont like <code>go func() {...}</code> <strong>inside</strong> Worker.Start(), IMO Worker.Start() must be synchronous, then you must call it as <code>go worker.Start()</code> in StartDispatcher().</p>\n\n<p>How it works.</p>\n\n<p>In StartDispatcher() it creates workers in a loop, which in turn put their's input channel on WorkerQueue buffered channel (buffered channels works like arrays, but channels) and blocks waiting for requests. Then we start a new goroutine to serve incoming requests: pick 1st <strong>worker's input channel</strong> (worker variable) from buffered channel WorkerQueue and send request to it.</p>\n\n<p>Worker will pick it up, do the work, and go for the next cycle: put his input channel to WorkerQueue (yes, its the place where its done 1st time when StartDispatcher() starts).</p>\n\n<p>Anytime you may close workers QuitChan and worker will terminate in <code>case &lt;-w.QuitChan</code> case (read from a closed channels returns immediately).</p>\n\n<p>Btw, your <code>RequestQueue = make(chan Request, 1024)</code> is also buffered channel, so writes to it does not block (unless its full).</p>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 1784, "user_id": 5479258, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/9013d6bb5ccbdd8ef0cac115267fa2f1?s=128&d=identicon&r=PG&f=1", "display_name": "user99999", "link": "https://stackoverflow.com/users/5479258/user99999"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "accepted_answer_id": 37421338, "answer_count": 1, "score": 1, "last_activity_date": 1464114870, "creation_date": 1464105790, "question_id": 37418623, "link": "https://stackoverflow.com/questions/37418623/queuing-ajax-requests-using-go-routines", "title": "Queuing ajax requests using go routines", "body": "<p>I have the following code:</p>\n\n<pre><code>var (\n    WorkersNum int = 12\n    HTTPAddr string = \"127.0.0.1:8080\"\n    Delay = 3e9\n)\n\nvar (\n    RequestQueue = make(chan Request, 1024)\n    WorkerQueue chan chan Request\n)\n\ntype Request struct {\n    Buf []byte\n    Delay time.Duration\n}\n\ntype Worker struct {\n    ID          int\n    Request     chan Request\n    WorkerQueue chan chan Request\n    QuitChan    chan bool\n}\n\nfunc main() {\n    fmt.Println(\"Starting the dispatcher\")\n    StartDispatcher()\n\n    fmt.Println(\"Registering the handler\")\n    http.HandleFunc(\"/\", handleRequest)\n\n    fmt.Println(\"HTTP server listening on\", HTTPAddr)\n    if err := http.ListenAndServe(HTTPAddr, nil); err != nil {\n        fmt.Println(err.Error())\n    }\n}\n\nfunc StartDispatcher() {\n    WorkerQueue = make(chan chan Request, WorkersNum)\n\n    for i := 0; i &lt; WorkersNum; i++ {\n        fmt.Println(\"Starting worker\", i + 1)\n        worker := NewWorker(i + 1, WorkerQueue)\n        worker.Start()\n    }\n\n    go func() {\n        for {\n            select {\n            case request := &lt;-RequestQueue:\n                    fmt.Println(\"Received requeust\")\n                    go func() {\n                        worker := &lt;-WorkerQueue\n                        fmt.Println(\"Dispatching request\")\n                        worker &lt;- request\n                    }()\n            }\n        }\n    }()\n}\n\nfunc NewWorker(id int, workerQueue chan chan Request) Worker {\n    worker := Worker{\n        ID:          id,\n        Request:     make(chan Request),\n        WorkerQueue: workerQueue,\n        QuitChan:    make(chan bool),\n    }\n    return worker\n}\n\nfunc (w *Worker) Start() {\n    go func() {\n        for {\n            w.WorkerQueue &lt;- w.Request\n            select {\n            case request := &lt;-w.Request:\n                    fmt.Printf(\"worker%d: Received work request, delaying for %f seconds\\n\", w.ID, request.Delay.Seconds())\n                    time.Sleep(request.Delay)\n                    writeToFile(request.Buf)\n                    fmt.Printf(\"worker%d: Saved to file!\\n\", w.ID)\n                case &lt;-w.QuitChan:\n                    fmt.Printf(\"worker%d stopping\\n\", w.ID)\n                    return\n            }\n        }\n    }()\n}\n\nfunc handleRequest(w http.ResponseWriter, r *http.Request) {\n    // make sure it's POST\n    if r.Method != \"POST\" {\n        w.Header().Set(\"Allow\", \"POST\")\n        w.WriteHeader(http.StatusMethodNotAllowed)\n        return\n    }\n    // add cors\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    // retrieve\n    buf, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        //http.Error(w, err, http.StatusBadRequest)\n        return\n    }\n    request := Request{Buf: buf, Delay: Delay}\n    RequestQueue &lt;- request\n    fmt.Println(\"Request queued\")\n}\n</code></pre>\n\n<p>I'm pretty new to go language and go routines - can you help me to understand how this code works?</p>\n\n<p>First I call start() function on each worker which assigns Worker.Request to Worker.WorkerQueue - how can I assign empty channel to empty array of channels?</p>\n\n<p>Then in StartDispatcher() I create go routine waiting for requests.</p>\n\n<p>When request comes I add it to RequestQueue variable. What's next? Start() function should trigger, but case is waiting for w.Request. Which is not filled because it's RequestQueue variable that changes.</p>\n\n<p>Could you give me some simple explanation?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464126929, "post_id": 37417901, "comment_id": 62354292, "body": "(FYI, @ mentions only work in comments) You can&#39;t use the GoString safely from C, because it contains a pointer to memory allocated in Go. The fact that using a string literal gets missed by cgocheck is beside the point."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464127404, "post_id": 37417901, "comment_id": 62354474, "body": "@JimB , thank you for the tip and the explanation."}], "answers": [{"tags": [], "owner": {"reputation": 17491, "user_id": 901827, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/86a6acccf7e8dbe398ebda4f8524ed50?s=128&d=identicon&r=PG", "display_name": "LinearZoetrope", "link": "https://stackoverflow.com/users/901827/linearzoetrope"}, "is_accepted": false, "score": 3, "last_activity_date": 1464104205, "creation_date": 1464104205, "answer_id": 37418078, "question_id": 37417901, "link": "https://stackoverflow.com/questions/37417901/how-to-return-a-string-from-json-to-a-c-caller-golang-cgo/37418078#37418078", "title": "How to return a string from JSON to a C caller (Golang CGO)?", "body": "<p>You need to use <code>C.CString</code> to convert Go strings to raw pointers to C strings. Note that C Strings are not garbage collected and must be freed by you elsewhere in the program.</p>\n\n<p>This will make the return type <code>*C.char</code> which should be visible to C as a <code>char</code> array. It will also be your responsibility to return the buffer length (whether your write a separate function or a C struct to do that is up to you).</p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1464105096, "creation_date": 1464105096, "answer_id": 37418401, "question_id": 37417901, "link": "https://stackoverflow.com/questions/37417901/how-to-return-a-string-from-json-to-a-c-caller-golang-cgo/37418401#37418401", "title": "How to return a string from JSON to a C caller (Golang CGO)?", "body": "<p>You can't return a Go <code>string</code> to a C function. If you want a C string, you can use the <code>C.CString</code> function to create one and return a <code>*C.char</code></p>\n\n<pre><code>//export GetKey\nfunc GetKey() *C.char {\n    theKey := lookupKey()\n    return C.CString(theKey)\n}\n</code></pre>\n\n<p>The return value from this function <em>must</em> be explicitly freed in the C code.</p>\n\n<p>If freeing the allocated buffer isn't convenient, its common to fill a buffer provided by the caller:</p>\n\n<pre><code>func GetKey(buff *C.char, n int) int\n</code></pre>\n\n<p>If you can allocate the memory but don't want to handle C strings, you can insert the buffer into a pointer and return the size. </p>\n\n<pre><code>func GetKey(buff **C.char) int\n</code></pre>\n"}], "owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2079, "favorite_count": 1, "accepted_answer_id": 37418401, "answer_count": 2, "score": 2, "last_activity_date": 1464114451, "creation_date": 1464103707, "last_edit_date": 1464114451, "question_id": 37417901, "link": "https://stackoverflow.com/questions/37417901/how-to-return-a-string-from-json-to-a-c-caller-golang-cgo", "title": "How to return a string from JSON to a C caller (Golang CGO)?", "body": "<p>I'm trying to develop a routine in Go that will be called by a C++ program.  The Go looks like the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"C\"\n    \"encoding/json\"\n    \"log\"\n)\n\ntype keydata struct {\n    Key   string `json:\"key\"`\n    Error string `json:\"Error\"`\n}\n\nfunc lookupKey() string {\n//simplified to remove the call to web service\n    body := \"{\\\"key\\\": \\\"blahblah\\\", \\\"Error\\\": \\\"\\\"}\"\n\n    k := keydata{}\n    err := json.Unmarshal([]byte(body), &amp;k)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return k.Key\n}\n\n//export GetKey\nfunc GetKey() string {\n    theKey := lookupKey()\n    return theKey\n}\n\nfunc main() {}\n</code></pre>\n\n<p>If I substitute some hard coded value for the return k.Key statement everything works fine and the C or C++ can call the exported GetKey function.  When I try to return the decoded JSON string from k.Key or even just return the string from the variable named body - I receive an error:</p>\n\n<p>runtime error: cgo result has Go pointer\ngoroutine 17 [running, locked to thread]</p>\n\n<p>I'm building this as follows:</p>\n\n<p>go build -buildmode=c-archive example.go</p>\n\n<p>The C++ is built as follow: </p>\n\n<p>g++ -pthread test.cpp example.a -o test</p>\n\n<p>What am I missing to make this work without raising a panic error? I'm digging around to find an answer but have yet to resolve this.</p>\n\n<p>@JimB &amp; @Jsor, thank you so much for your responses.  Returning a *C.char certainly worked.  I'm left wondering though, when I return it as a Go string behind the scenes in the auto generated header file Go actually creates and passes a C struct named GoString that contains a char array named p and the length named n.  As long as I pass a hard-coded string instead of k.Key it actually works and I can interrogate the auto-generated char array in C++.  When I try to return k.Key, a string it throws that exception.  Is it possible to cast the Go string or add some notation to the export decoration to make it work?  </p>\n\n<p>I can certainly return the C.CString char array and make it work - thank you! I'm just also wanting to understand why it works when returning a hard coded string and not in the example I've posted.</p>\n\n<p>Thank you both for your time and explanations.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "is_accepted": false, "score": 4, "last_activity_date": 1464100217, "creation_date": 1464100217, "answer_id": 37416572, "question_id": 37416188, "link": "https://stackoverflow.com/questions/37416188/convert-struct-to-struct-in-golang/37416572#37416572", "title": "convert struct to struct in golang", "body": "<p>The easiest is probably to simply do something like <code>u2 := user2{FirstName: u1.FirstName, LastName: u1.LastName}</code>. That is assuming you don't mind that the username is lost in the \"conversion\".</p>\n\n<p>It's possible to build more general converters using reflection, but I would normally try to structure my code so it's not needed.</p>\n"}], "owner": {"reputation": 925, "user_id": 94416, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c6bdec5132fd3906e89001ad195df15b?s=128&d=identicon&r=PG", "display_name": "Chadit", "link": "https://stackoverflow.com/users/94416/chadit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1711, "favorite_count": 0, "closed_date": 1464106892, "answer_count": 1, "score": 0, "last_activity_date": 1464100217, "creation_date": 1464099187, "question_id": 37416188, "link": "https://stackoverflow.com/questions/37416188/convert-struct-to-struct-in-golang", "closed_reason": "Duplicate", "title": "convert struct to struct in golang", "body": "<p>trying to figure out what the best option is to convert one struct to another, Example</p>\n\n<pre><code>type user1 struct {\n    FirstName string\n    LastName string\n    UserName string\n}\n\ntype user2 struct {\n    FirstName string\n    LastName string\n}\n</code></pre>\n"}, {"tags": ["go", "tcp", "grpc"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464097805, "post_id": 37414825, "comment_id": 62337251, "body": "I&#39;m not sure I understand the questions. You have a timeout in Dial already, so that can&#39;t hang for more than 20 seconds (BTW, a &quot;deadline&quot; is an absolute time, a &quot;timeout&quot; is a duration). If you want the rpc call to timeout, put a context with a timeout or deadline in that call too."}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464098621, "post_id": 37414825, "comment_id": 62337854, "body": "I agree with @JimB. You can easily set up a goroutine with a timer that closes the connection (and/or prints a message, etc) if it doesn&#39;t return before the timer is up."}, {"owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "edited": false, "score": 0, "creation_date": 1464178643, "post_id": 37414825, "comment_id": 62376400, "body": "The timeout in dial is a connection timeout, if the server connects then that timeout is not respected. The second part refers to the deadline feature in gRPC - where if the server doesn&#39;t return a response message within a certain time frame then a DEADLINE_EXCEEDED error is raised (All caps due to the cross-platform nature of gRPC)."}], "answers": [{"tags": [], "owner": {"reputation": 1470, "user_id": 151825, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lpRxz.png?s=128&g=1", "display_name": "matt.s", "link": "https://stackoverflow.com/users/151825/matt-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1464100477, "creation_date": 1464100477, "answer_id": 37416660, "question_id": 37414825, "link": "https://stackoverflow.com/questions/37414825/specify-a-deadline-with-go-grpc-for-peer-to-peer-connections/37416660#37416660", "title": "Specify a deadline with Go gRPC for peer to peer connections.", "body": "<p>You should look at the <code>context</code> package more closely.  GRPC was built with contexts as a fundamental part of it.  You might need the <code>grpc.Dial</code> context and <code>client.SayHello</code> context to be built off related info, but that should be fairly straight forward.</p>\n"}, {"comments": [{"owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "edited": false, "score": 0, "creation_date": 1498744386, "post_id": 44823585, "comment_id": 76634406, "body": "It&#39;s been a while since I looked at this, but you&#39;re right - having a timeout on the client side seems to be the only way to go about it according to my reading of the context library. I would update your suggestion to use the cancel method to ensure that the server does not try to respond when the client cancels the result."}], "tags": [], "owner": {"reputation": 1408, "user_id": 2457827, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/SR64C.png?s=128&g=1", "display_name": "akawhy", "link": "https://stackoverflow.com/users/2457827/akawhy"}, "is_accepted": false, "score": 3, "last_activity_date": 1498734862, "creation_date": 1498734862, "answer_id": 44823585, "question_id": 37414825, "link": "https://stackoverflow.com/questions/37414825/specify-a-deadline-with-go-grpc-for-peer-to-peer-connections/44823585#44823585", "title": "Specify a deadline with Go gRPC for peer to peer connections.", "body": "<p>According to the <code>WithTimeout</code> example of <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">context</a></p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    // Pass a context with a timeout to tell a blocking function that it\n    // should abandon its work after the timeout elapses.\n    ctx, cancel := context.WithTimeout(context.Background(), 50*time.Millisecond)\n    defer cancel()\n\n    select {\n        case &lt;-time.After(1 * time.Second):\n        fmt.Println(\"overslept\")\n    case &lt;-ctx.Done():\n        fmt.Println(ctx.Err()) // prints \"context deadline exceeded\"\n    }\n} \n</code></pre>\n\n<p>You can change the <code>helloworld example</code> client code for 100ms timeout:</p>\n\n<pre><code>ctx, _ := context.WithTimeout(context.Background(), 100 * time.Millisecond)\nr, err := c.SayHello(ctx, &amp;pb.HelloRequest{Name: name})\nif err != nil {\n    log.Fatalf(\"could not greet: %v\", err)\n}\nlog.Printf(\"Greeting: %s\", r.Message)\n</code></pre>\n"}], "owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10155, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1498734862, "creation_date": 1464095885, "question_id": 37414825, "link": "https://stackoverflow.com/questions/37414825/specify-a-deadline-with-go-grpc-for-peer-to-peer-connections", "title": "Specify a deadline with Go gRPC for peer to peer connections.", "body": "<p>According to the gRPC documentation, <a href=\"http://www.grpc.io/docs/guides/concepts.html#deadlines\" rel=\"noreferrer\">deadlines</a> can be specified by clients to determine how long the client will wait on the server before exiting with a <code>DEADLINE_EXCEEDED</code> error. The documentation mentions that different languages have different implementations and that some languages do not have default values. </p>\n\n<p>Indeed, a quick CTRL+F for \"deadline\" on the <a href=\"https://godoc.org/google.golang.org/grpc\" rel=\"noreferrer\">Go gRPC documentation</a> reveals no results. What I did discover was a <a href=\"https://godoc.org/google.golang.org/grpc#WithTimeout\" rel=\"noreferrer\"><code>WithTimeout</code></a> on the dialer for the TCP connection. </p>\n\n<p>Implemented as follows (from the <a href=\"https://github.com/grpc/grpc-go/tree/master/examples/helloworld\" rel=\"noreferrer\">helloworld example</a>): </p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"time\"\n\n    \"golang.org/x/net/context\"\n    \"google.golang.org/grpc\"\n    pb \"google.golang.org/grpc/examples/helloworld/helloworld\"\n)\n\nconst (\n    address     = \"localhost:50051\"\n    defaultName = \"world\"\n    deadline    = 20 \n)\n\nfunc main() {\n    // Set up a connection to the server with a timeout \n    conn, err := grpc.Dial(address, grpc.WithInsecure(), grpc.WithTimeout(time.Duration(deadline)*time.Second)\n    if err != nil {\n        log.Fatalf(\"did not connect: %v\", err)\n    }\n    defer conn.Close()\n    c := pb.NewGreeterClient(conn)\n\n    // Contact the server and print out its response.\n    name := defaultName\n    if len(os.Args) &gt; 1 {\n        name = os.Args[1]\n    }\n    r, err := c.SayHello(context.Background(), &amp;pb.HelloRequest{Name: name})\n    if err != nil {\n        log.Fatalf(\"could not greet: %v\", err)\n    }\n    log.Printf(\"Greeting: %s\", r.Message)\n}\n</code></pre>\n\n<p>The code will raise an error only if <em>the client cannot connect after 20 seconds</em>. The output will be something as follows: </p>\n\n<pre><code>2016/05/24 09:02:54 grpc: Conn.resetTransport failed to create client transport: connection error: desc = \"transport: dial tcp [::1]:3265: getsockopt: connection refused\"; Reconnecting to \"localhost:3265\"\n2016/05/24 09:02:54 Failed to dial localhost:3265: grpc: timed out trying to connect; please retry.\n2016/05/24 09:02:54 could not greet: rpc error: code = 2 desc = grpc: the client connection is closing\n</code></pre>\n\n<p>As noted in the question title, the system I'm working with is peer to peer, so there is no central, always up server and therefore the retry system that gRPC implements is wonderful. However, I'm actually looking for deadlines because if the remote does connect, but the server takes > 20 seconds to respond, no exception will be raised in the <code>WithTimeout</code> context. </p>\n\n<p>A complete win for me would be a timeout/deadline system where:</p>\n\n<ul>\n<li>if the client cannot connect, an error is returned after timeout </li>\n<li>if the client connects, but the server doesn't respond before timeout, an error is returned. </li>\n<li>if the client connects, but the connection drops before timeout, an error is returned. </li>\n</ul>\n\n<p>My feeling though is that I will need some combination of connection management plus gRPC deadline management. Does anyone know how to implement deadlines in Go?</p>\n"}, {"tags": ["go", "dependencies"], "answers": [{"comments": [{"owner": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 0, "creation_date": 1464123182, "post_id": 37413291, "comment_id": 62352525, "body": "So that means the project maintainer needs to run go generate before pushing their latest changes?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 0, "creation_date": 1464132349, "post_id": 37413291, "comment_id": 62356090, "body": "@GerbenJacobs correct, but that also means it is the project maintainer&#39;s job to ensure the vendored libs are working as expected."}, {"owner": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 1, "creation_date": 1464272334, "post_id": 37413291, "comment_id": 62425821, "body": "Alright, I see your point. This is all pretty different from other languages that have vendored libs. So I guess that really does make it a opinion question. I&#39;ll accept your answer anyway and see what approach I want to take. Thanks."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 4, "last_activity_date": 1464092109, "creation_date": 1464092109, "answer_id": 37413291, "question_id": 37412206, "link": "https://stackoverflow.com/questions/37412206/library-dependencies-in-go/37413291#37413291", "title": "Library dependencies in Go", "body": "<p>This is more of an opinion question I guess, however I'll share what I use.</p>\n\n<p>I use <a href=\"https://developer.atlassian.com/blog/2015/05/the-power-of-git-subtree/\" rel=\"nofollow\">git subtree</a> for vendoring sub repos in my tree then add a <code>//go:generate</code> line to update it later on, for example:</p>\n\n<pre><code>\u279c git subtree add --prefix vendor/xxx/yyy/zzz https://github.com/xxx/yyy/zzz master --squash\n</code></pre>\n\n<p>Then add <code>//go:generate git subtree pull --prefix vendor/xxx/yyy/zzz https://github.com/xxx/yyy/zzz master --squash</code> to one of my library files.</p>\n\n<p>And just run <code>go generate</code> before I make release.</p>\n\n<p>That solves the vendoring issue without the need of any external tools.</p>\n\n<p>Live example: <a href=\"https://github.com/OneOfOne/xxhash/blob/master/xxhash_cgo.go\" rel=\"nofollow\">https://github.com/OneOfOne/xxhash/blob/master/xxhash_cgo.go</a></p>\n"}], "owner": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "accepted_answer_id": 37413291, "answer_count": 1, "score": 6, "last_activity_date": 1464092109, "creation_date": 1464089159, "question_id": 37412206, "link": "https://stackoverflow.com/questions/37412206/library-dependencies-in-go", "title": "Library dependencies in Go", "body": "<p>I've created a library/package in Go and the consensus was that only applications include a <code>vendor</code> folder in their project and libraries don't.</p>\n\n<p>So now I included <a href=\"https://github.com/gerbenjacobs/docserv\" rel=\"noreferrer\">my package</a> in another (<code>govendor</code>'ed) project and everything worked fine, untill it got to Jenkins and it had to use its local resources, where 2 of the dependencies were missing.</p>\n\n<p>My project readme says all you need to do is <code>go get</code> my project and you're done. But that's not the case in case you're using govendoring. </p>\n\n<p>What should be the approach for my library? Can this be solved, or is this 'problem' just something the end-user has to solve because they use <code>govendor</code>?</p>\n"}, {"tags": ["ajax", "go", "beego"], "comments": [{"owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "edited": false, "score": 0, "creation_date": 1464091682, "post_id": 37412187, "comment_id": 62332590, "body": "try using <code>dataType: &#39;json&#39;</code> instead of <code>dataType: &#39;html&#39;</code>"}, {"owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "reply_to_user": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "edited": false, "score": 0, "creation_date": 1464092649, "post_id": 37412187, "comment_id": 62333262, "body": "@AH now success block is not receiving anything I think. I put an if(data == &quot;&quot;) condition with some alert boxes, neither alert in if nor in else responded."}, {"owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "edited": false, "score": 0, "creation_date": 1464095140, "post_id": 37412187, "comment_id": 62335154, "body": "Arjun, I posted an answer since its too long to comment. See if it helps. And use the javascript console of your browser for debugging."}], "answers": [{"tags": [], "owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "is_accepted": true, "score": 4, "last_activity_date": 1464095063, "creation_date": 1464095063, "answer_id": 37414509, "question_id": 37412187, "link": "https://stackoverflow.com/questions/37412187/golang-ajax-how-to-return-slices-or-struct-in-a-success-function/37414509#37414509", "title": "Golang, Ajax - How to return slices or struct in a success function?", "body": "<p>The <code>dataType</code> parameter of your ajax request should be <code>json</code> as you are expecting JSON data from the server. But if you server does not respond with valid JSON the ajax request is going to result in an error. Check your browser's javascript console for errors.</p>\n\n<p>From what you are currently doing in the controller, its definitely going to result in invalid JSON response. See following.</p>\n\n<pre><code>aSlice := []string{\"foo\", \"bar\"}\nbSlice := []string{\"baz\", \"qux\"}\n\nb, _ := json.Marshal(aSlice) // json Marshal\nc, _ := json.Marshal(bSlice)\n\nthis.Ctx.ResponseWriter.Write(b) // Writes `[\"foo\",\"bar\"]`\nthis.Ctx.ResponseWriter.Write(c) // Appends `[\"baz\",\"qux\"]`\n</code></pre>\n\n<p>This results in sending <code>[\"foo\",\"bar\"][\"baz\",\"qux\"]</code> Thats just two JSON array strings appended together. Its not valid.</p>\n\n<p>What you probably want to send to browser is this: <code>[[\"foo\",\"bar\"],[\"baz\",\"qux\"]]</code>.</p>\n\n<p>That is an array of two arrays. You can do this to send it from the server.</p>\n\n<pre><code>aSlice := []string{\"foo\", \"bar\"}\nbSlice := []string{\"baz\", \"qux\"}\n\nslice := []interface{}{aSlice, bSlice}\n\ns, _ := json.Marshal(slice) \nthis.Ctx.ResponseWriter.Write(s) \n</code></pre>\n\n<p>And in the javascript side,</p>\n\n<pre><code>$.ajax({\n        url: '/delete_process',\n        type: 'post',\n        dataType: 'json',\n        data : \"&amp;processName=\" + processName,\n        success : function(data) {\n            alert(data);\n            alert(data[0]);    // [\"foo\",\"bar\"]\n            alert(data[1]);    // [\"baz\",\"qux\"]\n            alert(data.length) // 2\n        }\n});\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1153, "user_id": 1371064, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/NnrmE.jpg?s=128&g=1", "display_name": "Carlos Andr&#233;s Garc&#237;a", "link": "https://stackoverflow.com/users/1371064/carlos-andr%c3%a9s-garc%c3%ada"}, "is_accepted": false, "score": 2, "last_activity_date": 1464114483, "last_edit_date": 1495542312, "creation_date": 1464114483, "answer_id": 37421219, "question_id": 37412187, "link": "https://stackoverflow.com/questions/37412187/golang-ajax-how-to-return-slices-or-struct-in-a-success-function/37421219#37421219", "title": "Golang, Ajax - How to return slices or struct in a success function?", "body": "<p>The answer of @AH works really well for multiple slices. Now if you want a Struct you should change a little bit your code :</p>\n\n<pre><code> package controllers\n\nimport \"github.com/astaxie/beego\"\nimport \"encoding/json\"\n\n\ntype Controller2 struct {\n    beego.Controller\n}\n\ntype Controller2Result struct {\n    Accommodation []string\n    Vehicle []string\n}\n\nfunc (this *Controller2) Post() {\n   var result Controller2Result\n\n   aSlice := []string{\"House\", \"Apartment\", \"Hostel\"}\n   bSlice := []string{\"Car\", \"Moto\", \"Airplane\"}\n   result.Accommodation = aSlice\n   result.Vehicle = bSlice\n\n   s, _ := json.Marshal(result) \n   this.Ctx.ResponseWriter.Header().Set(\"Content-Type\", \"application/json\")\n   this.Ctx.ResponseWriter.Write(s) \n\n}\n</code></pre>\n\n<p>Ajax</p>\n\n<pre><code>  $.ajax({\n           url: '/Controller2',\n           type: 'post',\n           dataType: 'json',\n           //data : \"&amp;processName=\" + processName,\n           success : function(data) {\n              alert(JSON.stringify(data));\n           }\n         });\n</code></pre>\n\n<p>How is explained <a href=\"https://stackoverflow.com/a/9218947/1371064\">here</a> alert only can display strings and <code>data</code>is a object type of JavaScript. So you have to use <code>JSON.stringify</code> to turn object into JSON-String.</p>\n"}], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1799, "favorite_count": 1, "accepted_answer_id": 37414509, "answer_count": 2, "score": 1, "last_activity_date": 1464114483, "creation_date": 1464089102, "last_edit_date": 1495540432, "question_id": 37412187, "link": "https://stackoverflow.com/questions/37412187/golang-ajax-how-to-return-slices-or-struct-in-a-success-function", "title": "Golang, Ajax - How to return slices or struct in a success function?", "body": "<p>My problem is similar to that of the question in <a href=\"https://stackoverflow.com/questions/19503631/ajax-how-to-use-a-returned-array-in-a-success-function\">this link.</a> I need to return multiple slices or a struct from golang to the ajax success block. I tried to marshal my slice into JSON but it is received in ajax as a string. I need to receive it as an array. Is it possible to send multiple arrays or a struct like this?</p>\n\n<p>My code:</p>\n\n<pre><code>b, _ := json.Marshal(aSlice)      // json Marshal\nc, _ := json.Marshal(bSlice)\nthis.Ctx.ResponseWriter.Write(b) // Beego responsewriter\nthis.Ctx.ResponseWriter.Write(c)\n</code></pre>\n\n<p>My ajax:</p>\n\n<pre><code>$.ajax({\n        url: '/delete_process',\n        type: 'post',\n        dataType: 'html',\n        data : \"&amp;processName=\" + processName,\n        success : function(data) {\n            alert(data);\n            alert(data.length)\n        }\n});\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["ajax", "file", "go", "concurrency"], "comments": [{"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1464090314, "post_id": 37411114, "comment_id": 62331559, "body": "<code>mutex.Lock</code>is used to ensure exclusive access to a resource from within a goroutine. This is useful when you have several goroutines trying to read and write to a global resource. Writing to file is a blocking I/O, and you will need to let that goroutine to block naturally."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1464094535, "last_edit_date": 1464094535, "creation_date": 1464090079, "answer_id": 37412539, "question_id": 37411114, "link": "https://stackoverflow.com/questions/37411114/concurrent-writing-to-file-from-ajax-request/37412539#37412539", "title": "Concurrent writing to file from ajax request", "body": "<p>You only need to make writing to the file \"sequential\", meaning don't allow 2 concurrent goroutines to write to the file. Yes, if you use locking in the <code>writeToFile()</code> function, serving your ajax requests may become (partially) sequential too.</p>\n\n<p>What I suggest is open the file once, when your application starts. And designate a single goroutine which will be responsible writing to the file, no other goroutines should do it.</p>\n\n<p>And use a buffered channel to send data that should be written to the file. This will make serving ajax requests non-blocking, and still the file will not be written concurrently / parallel.</p>\n\n<p>Note that this way ajax requests won't even have to wait while the data is actually written to the file (faster response time). This may or may not be a problem. For example if later writing fails, your ajax response might already be committed => no chance to signal failure to the client.</p>\n\n<p>Example how to do it:</p>\n\n<pre><code>var (\n    f      *os.File\n    datach = make(chan []byte, 100) // Buffered channel\n)\n\nfunc init() {\n    // Open file for appending (create if doesn't exist)\n    var err error\n    f, err = os.OpenFile(\"data.txt\", os.O_CREATE|os.O_APPEND|os.O_WRONLY, 0666)\n    if err != nil {\n        panic(err)\n    }\n\n    // Start goroutine which writes to the file\n    go writeToFile()\n}\n\nfunc writeToFile() {\n    // Loop through any data that needs to be written:\n    for data := range datach {\n        if _, err := f.Write(data); err != nil {\n            // handle error!\n        }\n    }\n    // We get here if datach is closed: shutdown\n    f.Close()\n}\n\nfunc ajaxHandler(w http.ResponseWriter, r *http.Request) {\n    // Assmeble data that needs to be written (appended) to the file\n    data := []byte{1, 2, 3}\n    // And send it:\n    datach &lt;- data\n}\n</code></pre>\n\n<p>To gracefully exit from the app, you should close the <code>datach</code> channel: when it's closed, the loop in the <code>writeToFile()</code> will terminate, and the file will be closed (flushing any cached data, releasing OS resources).</p>\n\n<p>If you want to write text to the file, you may declare the <code>data</code> channel like this:</p>\n\n<pre><code>var datach = make(chan string, 100) // Buffered channel\n</code></pre>\n\n<p>And you may use <a href=\"https://golang.org/pkg/os/#File.WriteString\" rel=\"nofollow\"><code>File.WriteString()</code></a> to write it to the file:</p>\n\n<pre><code>if _, err := f.WriteString(data); err != nil {\n    // handle error!\n}\n</code></pre>\n"}], "owner": {"reputation": 1784, "user_id": 5479258, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/9013d6bb5ccbdd8ef0cac115267fa2f1?s=128&d=identicon&r=PG&f=1", "display_name": "user99999", "link": "https://stackoverflow.com/users/5479258/user99999"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1464094535, "creation_date": 1464086193, "question_id": 37411114, "link": "https://stackoverflow.com/questions/37411114/concurrent-writing-to-file-from-ajax-request", "title": "Concurrent writing to file from ajax request", "body": "<p>I want to write requests to one file from some ajax script. The problem arises when there will be many of those in a second and writing to file will take more time than the break between requests, and when there will be two requests at the same time.</p>\n\n<p>How could I solve this?</p>\n\n<p>I've came up using mutex, like:</p>\n\n<pre><code>var mu sync.Mutex\nfunc writeToFile() {\n    mu.Lock()\n    defer mu.Unlock()\n    // write to file\n}\n</code></pre>\n\n<p>But it makes the whole thing synchronous and I don't really know what happens when there are two requests at the same time. And it still does not lock the file itself.</p>\n\n<p>Uh, what's the proper way to do this?</p>\n"}, {"tags": ["api", "sockets", "go", "server"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 1, "creation_date": 1464083883, "post_id": 37408252, "comment_id": 62327119, "body": "Here is a great resource about socket level programming in Go: <a href=\"https://jan.newmarch.name/go/socket/chapter-socket.html\" rel=\"nofollow noreferrer\">jan.newmarch.name/go/socket/chapter-socket.html</a>"}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 1, "creation_date": 1464096778, "post_id": 37408252, "comment_id": 62336440, "body": "Depends on your scale.  If you are only expecting a few sockets, then use <code>goroutines</code> to spin up a new socket - be careful with this approach as each <code>goroutine</code> takes up about 4KB of ram, so if you are spinning up a million you could have memory issues.  If you planning this at scale, then yes have a separate service listening on a different port.  Kind of odd to start a socket <i>after</i> a request to an API - in that case, you&#39;d have to issue a command to start a new service each time or some other way to pass around the context."}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "reply_to_user": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 1, "creation_date": 1464101496, "post_id": 37408252, "comment_id": 62339966, "body": "Thank you both for your help. Simo your link is really interesting ! @eduncan911 Yep I knew that goroutines would take a bit of memory, but I didn&#39;t think it was so much.. Your last sentence is what I want to do, I juste don&#39;t understand how I can create a socket  chat or something like that.. Does it have to be on the same server or I have to make 2 servers which share the same database? Multi-threading also have to work  with mutex :/"}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 1, "creation_date": 1464113341, "post_id": 37408252, "comment_id": 62347388, "body": "@MaximeGuittet Why not have a generic HTTP mux (like you have) and a generic Socker listener (running in a go routine)?  you don&#39;t have to listen on a 1-to-1 ratio but use pooled connections instead.  you store the context on the backend, and key it with a hash/encoded ID or something alike.  That way, when you instruct the client to connect, you tell it to <i>use this SessionID</i> when making the connection.  then the socket listener would take that sessionid and do whatever u want to do."}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1464113890, "post_id": 37408252, "comment_id": 62347674, "body": "That is what I want to do at the end, but I need to keep my API for things as authentication by example, but I need a socket system like Skype or Messenger chat by example, at the same time :)"}], "answers": [{"comments": [{"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1464102715, "post_id": 37417039, "comment_id": 62340853, "body": "Thank for your answer @Darigaaz :) however, I&#39;m not sure to understand the part &quot;In your main()&quot;. If I understand it good, you said I have my API, and after starting it, I initialize MultiSocketServer. But where? after the starting of my API? Or you mean it would be better that I use the logic of your code as an API? Every request trough a socket"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1464114111, "post_id": 37417039, "comment_id": 62347801, "body": "Wow your update interesting me ! :) (I&#39;m not at the work) If I understood what you said, it means that a client (C# currently) will make a request on /socket_request which will give me a listener (a socket). So if it&#39;s a request, I will get a response to my c# code, but I will not be connected as  a TCP client, you know what I mean? In your answer above at my comment, you said about use go routine to handle the sockets, so it&#39;s not better to just have a double server running? I mean my handler, and in goroutine the TCP part? Sorry if I missunderstood something.. It&#39;s my first API !"}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 1, "creation_date": 1464115472, "post_id": 37417039, "comment_id": 62348475, "body": "client will make a request on /socket_request which will create a new socket and return an addr where its listening for your connections. after that you can connect to this addr with your tcp client. &gt;it&#39;s not better to just have a double server running? what do you mean by &quot;server&quot;? http.Server or MultiSocketServer is just a multiplexor serving &quot;connections&quot;, every connection runs in its own gouroutine eventually (check source code of http.Server.ListenAndServe). So yes, its like running two servers because http.Server is able to listen on one address only and use HTTP protocol to communicate"}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 1, "creation_date": 1464116125, "post_id": 37417039, "comment_id": 62348760, "body": "As you said &quot;a client connects itself (only by request), but then, he joins a chat, so a socket is created and linked to the good channel&quot;.| Sorry for repeating. Send request to /socket_request and connect with your client to the returned addr. Exactly as you asked. Oh i think i got it now. Client joins API chat and asks server to create a socket to communicate? And server must reply with addr where it waits for his personal connections?"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1464116843, "post_id": 37417039, "comment_id": 62349141, "body": "That&#39;s it ;) I run my handler which have routes, nothing complicated. It&#39;s kind of a service for customer ok? The seller connect itself as available to answer a customer about this service. So the seller, once he&#39;s connected, get a socket. (Seller == Client). when a customer (also a client) selects a service, then we give him a socket ;) After that, I think make something as TCP you know, with a sessionID like you also said :)"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1464118339, "post_id": 37417039, "comment_id": 62349926, "body": "Forgot to give this link <a href=\"http://stackoverflow.com/questions/37344445/golang-api-architecture-sockets\" title=\"golang api architecture sockets\">stackoverflow.com/questions/37344445/&hellip;</a>"}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1464118496, "post_id": 37417039, "comment_id": 62350001, "body": "When Seller is ready to answer (whatever logic you needs) call from your API <code>seller_listener := multi_socket_server.ListenAndServe(addr_to_listen)</code> and <code>save_listener_in_context_or_whatever_you_like_to_track_it(li&zwnj;&#8203;stener)</code>, later when client selects a service give him a new socket with <code>client_listener := multi_socket_server.ListenAndServe(addr_to_listen)</code>, pick &quot;seller&quot; listener from context and connect them with <code>io.Pipe(client_listener, seller_listener); io.Pipe(seller_listener;client_listener)</code> for example. but watch out for errors."}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "reply_to_user": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1464118656, "post_id": 37417039, "comment_id": 62350082, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/112825/discussion-between-darigaaz-and-maxime-guittet\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "is_accepted": false, "score": 1, "last_activity_date": 1464108739, "last_edit_date": 1464108739, "creation_date": 1464101462, "answer_id": 37417039, "question_id": 37408252, "link": "https://stackoverflow.com/questions/37408252/golang-api-server-and-socket-at-the-same-time/37417039#37417039", "title": "Golang - API Server and Socket at the same time", "body": "<p>default http server accepts connection on one \"host:port\" only</p>\n\n<p>Answer depends on what protocol you are going to use to communicate via your sockets.</p>\n\n<p>I suggest to do it this way: (much simplified)</p>\n\n<ol>\n<li><p>Leave http.Server alone to serve your API (it implements protocols HTTP 1.*/2 so you dont need to worry about it)</p></li>\n<li><p>Implement your own \"MultiSocketServer\", do to so:</p>\n\n<p>2.1 Implement GracefulListener (must implement net.Listener) (you need to shutdown your sockets when you dont need them anymore, right?)</p>\n\n<p>2.2 Implement MultiSocketServer.Serve(l GracefulListener) (hello http.Server.Serve() ) to serve individual connection (your protocol to communicate with client via sockets goes here. something like net.textproto will be easy to implement since you  GracefulListener.Accept() will return net.Conn)</p>\n\n<p>2.3 Add methods MultiSocketServer.ListenAndServe(addr), MultiSocketServer.StopServe(l GracefulListener) to your MultiSocketServer</p>\n\n<pre><code>type MultiSocketServer struct {\n    listeners GracefulListener[] //or map?\n\n    // lots of other stuff\n}\n\n\n// looks familiar? (http.Server.ListenAndServe) \nfunc (s *MultiSocketServer) ListenAndServe(addr string) {\n    ln, err := net.Listen(\"tcp\", addr)\n    graceful_listner = &amp;GracefulListener(ln)\n\n    s.listeners = append(s.listeners, graceful_listner)\n\n    go s.Serve(graceful_listner)\n    return graceful_listner\n}\n\nfunc (s *MultiSocketServer) StopServe(graceful_listner  GracefulListener) {\n    graceful_listner.Stop()\n    //pseudocode\n    remove_listener_from_slice(s.listeners, graceful_listner)\n}\n</code></pre></li>\n</ol>\n\n<p>Ofcourse, you need to add error checking and mutex (propably) to guard MultiSocketServer.listeners to make it thread safe.</p>\n\n<p>In your main() start your API http.Server, and initialize your MultiSocketServer. Now from your http.Handler/http.HandlerFunc of http.Server you should be able to call MultiSocketServer.ListenAndServe(addr) to listen and serve your sockets connections.</p>\n\n<p><strong>UPDATE based on question</strong></p>\n\n<blockquote>\n  <p>however, I'm not sure to understand the part \"In your main()\". If I understand it good, you said I have my API, and after starting it, I initialize MultiSocketServer. But where? after the starting of my API? Or you mean it would be better that I use the logic of your code as an API? Every request trough a socket </p>\n</blockquote>\n\n<p>BTW: updated MultiSocketServer.ListenAndServe to start Listen and return graceful_listner</p>\n\n<pre><code>func main() {\n    //init MultiSocketServer\n    multi_socket_server = &amp;MultiSocketServer{} //nil for GracefulListener[] is fine for now, complex initialization will be added later\n    // no listners yet, serves nothing\n\n    // create new Handeler for your \"socket requests\"\n    SocketRequestHandler := function(w http.ResponseWriter, r *http.Request) {\n       // identify client, assign him an address to connect\n       addr_to_listen := parse_request(r) //pseudocode\n\n       listener := multi_socket_server.ListenAndServe(addr_to_listen)\n       // TODO: handle errors\n       // now your multi_socket_server listen to addr_to_listen and serves it with multi_socket_server.Serve method in its own goroutine\n       // as i said MultiSocketServer.Serve method must implement your protocol (plaintext Reader/Writer on listener for now?)\n\n       save_listener_in_context_or_whatever_you_like_to_track_it(listener) //pseudo\n   }  \n\n    SocketDisconnectHandler := function(w http.ResponseWriter, r *http.Request) {\n      // identify client \n      some_client := parse_request(r) //pseudocode\n      // get listener based on info\n      listener := get_listener_from_context_or_whatever(some_client) //pseudo\n\n      multi_socket_server.StopServe(listener)\n      // TODO: handle errors\n    }\n\n    //initialize your API http.Server\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", HomeHandler)\n    r.HandleFunc(\"/products\", ProductsHandler)\n    r.HandleFunc(\"/articles\", ArticlesHandler)\n    r.HandleFunc(\"/socket_request\", SocketRequestHandler) // added\n    r.HandleFunc(\"/socket_disconnect\", SocketDisconnectHandler) //added\n    http.Handle(\"/\", r)\n\n    // it creates new http.Server with DefaultServeMux as Handler (which is configured with your http.Handle(\"/\", r) call)\n   http.ListenAndServe(\":8080\") // start serving API via HTTP proto\n}\n</code></pre>\n\n<p>Actually, you may call <code>multi_socket_server.ListenAndServe(addr_to_listen)</code> and <code>multi_socket_server.StopServe(listener)</code> from any handler in your API server.</p>\n\n<p>Every time you call <code>multi_socket_server.ListenAndServe(addr_to_listen)</code> it will create new listener and serve on it, you have to control it (dont listen on the same address more then once (i think it will error out anyway))</p>\n\n<p>Your MultiSocketServer.Serve may looks like:</p>\n\n<pre><code>func (s *MultiSocketServer) Serve(l net.Listener) {\n    defer l.Close()\n\n    for {     \n        // will listen for message to process ending in newline (\\n)\n        message, _ := bufio.NewReader(conn).ReadString('\\n')\n        // output message received     \n        fmt.Print(\"Message Received:\", string(message))\n        // sample process for string received     \n        newmessage := strings.ToUpper(message)\n        // send new string back to client     \n        conn.Write([]byte(newmessage + \"\\n\"))   \n    } \n}\n</code></pre>\n\n<p>Possible GracefulListener <a href=\"http://www.hydrogen18.com/blog/stop-listening-http-server-go.html\" rel=\"nofollow\">implementation</a> <a href=\"https://github.com/hydrogen18/stoppableListener\" rel=\"nofollow\">github</a></p>\n\n<p>Or are you trying to achieve something completely different? =)</p>\n"}, {"tags": [], "owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1464140304, "last_edit_date": 1464140304, "creation_date": 1464132063, "answer_id": 37425451, "question_id": 37408252, "link": "https://stackoverflow.com/questions/37408252/golang-api-server-and-socket-at-the-same-time/37425451#37425451", "title": "Golang - API Server and Socket at the same time", "body": "<p>Based on our chat discussion.</p>\n\n<p><strong>OVER</strong>simplified example with lots of pseudocode</p>\n\n<pre><code>import (\n    \"net\"\n    \"encoding/json\"\n    \"errors\"\n)\n\ntype User struct {\n    name string\n}\n\ntype Message {\n    Action string\n    Params map[string]string\n}\n\ntype Server struct {\n    connected_users map[*User]net.Conn\n    users_connected_with_each_other map[*User][]*User\n    good_users map[string]*User\n}\n\nfunc (srv *Server) ListenAndServe(addr string) error {\n    ln, err := net.Listen(\"tcp\", addr)\n    if err != nil {\n        return err\n    }\n    return srv.Serve(tcpKeepAliveListener{ln.(*net.TCPListener)})\n}\n\nfunc (srv *Server) Serve(l net.Listener) error {\n    defer l.Close()\n\n    for {\n        rw, e := l.Accept()\n        if e != nil {\n            return e\n        }\n\n        // you want to create server_conn here with buffers, channels and stuff\n        // to use async thread safe read/write from it\n        go srv.serve_conn(rw)\n    }\n}\n\nfunc (srv *Server) serve_conn(rw net.Conn) error {  \n    dec := json.NewDecoder(rw)\n\n    var message Message\n\n    //read 1st message he sent, should be token to connect\n    dec.Decode(&amp;message)\n\n    token := get_token(Message)\n\n    user, ok := srv.good_users[token]\n\n    if !ok {\n        return errors.New(\"BAD USER!\")\n    }\n    // store connected user\n    srv.connected_users[user] = rw\n\n    for {\n        // async reader will be nice\n        dec.Decode(&amp;message)\n\n        switch message.Action {\n            case \"Message\":\n                // find users to send message to\n                if chats_with, err := users_connected_with_each_other[user]; err == nil {                   \n                    for user_to_send_message_to := range chats_with {\n                        // find connections to send message to\n                        if conn, err := srv.connected_users[user_to_send_message_to]; err == nil {\n                            // send json encoded message\n                            err := json.NewEncoder(conn).Encode(message)\n                            //if write failed store message for later\n                        }\n                    }\n                }\n\n            //other cases\n\n            default:\n                // log?\n        }       \n    }\n}\n\nfunc main() {\n    known_users_with_tokens := make(map[string]*User)\n\n\n    srv := &amp;Server{\n        connected_users: make(map[*User]net.Conn),\n        users_connected_with_each_other: make(map[*User][]*User),\n        good_users: known_users_with_tokens, // map is reference type, so treat it like pointer\n    }\n    // start our server\n    go srv.ListenAndServe(\":54321\")\n\n\n    ConnRequestHandler := function(w http.ResponseWriter, r *http.Request) {\n        user := create_user_based_on_request(r)\n        token := create_token(user)\n\n        // now user will be able to connect to server with token\n        known_users_with_tokens[token] = user\n    }\n\n    ConnectUsersHandler := function(user1,user2) {\n        // you should guard your srv.* members to avoid concurrent read/writes to map\n        srv.users_connected_with_each_other[user1] = append(srv.users_connected_with_each_other[user1], user2)\n        srv.users_connected_with_each_other[user2] = append(srv.users_connected_with_each_other[user2], user1)\n    }\n\n    //initialize your API http.Server\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", HomeHandler)\n    r.HandleFunc(\"/products\", ProductsHandler)\n    r.HandleFunc(\"/articles\", ArticlesHandler)\n    r.HandleFunc(\"/connection_request\", ConnRequestHandler) // added\n    http.Handle(\"/\", r)\n}\n</code></pre>\n\n<p>Call <code>ConnectUsersHandler(user1, user2)</code> to allow them communicate with each other.</p>\n\n<p><code>known_users_with_tokens[token] = user</code> to allow user to connect to server</p>\n\n<p>You need to implement async reader/writer for connections to your server. Usefull structs to keep good Users.\nGuard Server struct members and provide thread safe access to update it.</p>\n\n<p><strong>UDP</strong></p>\n\n<p>Looks like <code>json.NewEncoder(connection).Encode(&amp;message)</code> and <code>json.NewDecoder(connection).Decode(&amp;message)</code> is async and thread safe. So you can write simultaneously from different goroutines. No need to manual sync, YAY! </p>\n"}], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5276, "favorite_count": 2, "accepted_answer_id": 37425451, "answer_count": 2, "score": 3, "last_activity_date": 1464140304, "creation_date": 1464078710, "last_edit_date": 1464101581, "question_id": 37408252, "link": "https://stackoverflow.com/questions/37408252/golang-api-server-and-socket-at-the-same-time", "title": "Golang - API Server and Socket at the same time", "body": "<p>I try to make sockets to communicate with my clients.</p>\n\n<p>A socket would be created after some requests to my API. It means, a client connects itself (only by request), but then, he joins a chat, so a socket is created and linked to the good channel.</p>\n\n<p>I already used sockets so I understand how it works (C, C++, C#, Java), but what I want to make, with what I saw on the web, I think it's possible, but I don't understand how to handle it with golang.</p>\n\n<p>I create a first server:</p>\n\n<pre><code>func main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", HomeHandler)\n    r.HandleFunc(\"/products\", ProductsHandler)\n    r.HandleFunc(\"/articles\", ArticlesHandler)\n    http.Handle(\"/\", r)\n}\n</code></pre>\n\n<p>But for socket, I need another one?</p>\n\n<pre><code>package main\n\nimport \"net\"\nimport \"fmt\"\nimport \"bufio\"\nimport \"strings\" // only needed below for sample processing\n\nfunc main() {\n\n    fmt.Println(\"Launching server...\")\n\n    // listen on all interfaces\n    ln, _ := net.Listen(\"tcp\", \":8081\")\n\n    // accept connection on port\n    conn, _ := ln.Accept()   \n\n    // run loop forever (or until ctrl-c)\n    for {     \n        // will listen for message to process ending in newline (\\n)\n        message, _ := bufio.NewReader(conn).ReadString('\\n')\n        // output message received     \n        fmt.Print(\"Message Received:\", string(message))\n        // sample process for string received     \n        newmessage := strings.ToUpper(message)\n        // send new string back to client     \n        conn.Write([]byte(newmessage + \"\\n\"))   \n    } \n}\n</code></pre>\n\n<p>Thank for help !</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1464078756, "post_id": 37407785, "comment_id": 62323566, "body": "Please take the Tour of Go."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1464092273, "post_id": 37407785, "comment_id": 62332990, "body": "Welcome To Go, please stop everything that you are doing and take the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">tour</a>."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1464092321, "post_id": 37407785, "comment_id": 62333018, "body": "I&#39;m voting to close this question as off-topic because it lacks zero research or understanding the very basics of the language."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1464098159, "last_edit_date": 1464098159, "creation_date": 1464077564, "answer_id": 37407860, "question_id": 37407785, "link": "https://stackoverflow.com/questions/37407785/dim-varname-as-int64-in-go/37407860#37407860", "title": "Dim varName as int64 in Go?", "body": "<p>Using a <a href=\"https://golang.org/ref/spec#Variable_declarations\" rel=\"nofollow\">variable declaration</a> (can be used inside functions and at the top level to create global variables):</p>\n\n<pre><code>var i int64 = value\n</code></pre>\n\n<p>If <code>value</code> is a typed <code>int64</code> value, you may omit the type which will be inferred:</p>\n\n<pre><code>var i2 = value // type is inferred\n</code></pre>\n\n<p><a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow\">Short variable declaration</a> (may only appear inside function bodies):</p>\n\n<pre><code>i3 := value // type is inferred\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<p>Both with the variable declaration (without type) and with short variable declaration care must be taken if you use a value with different type - or an untyped constant. In these cases explicit <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow\">type conversion</a> may be required in order for the new variable to get the proper <code>int64</code> type!</p>\n\n<pre><code>var i4 = 4        // Wrong! i4 will be of type int\nvar i5 = int64(4) // Good! i5 will be of type int64\nvar i6 int64 = 4  // Also good: explicitly provided type\ni7 := 4           // Wrong! i4 will be of type int\ni8 := int64(4)    // Good! i5 will be of type int64\n</code></pre>\n"}], "owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 37407860, "answer_count": 1, "score": -4, "last_activity_date": 1464098159, "creation_date": 1464077381, "question_id": 37407785, "link": "https://stackoverflow.com/questions/37407785/dim-varname-as-int64-in-go", "title": "Dim varName as int64 in Go?", "body": "<p>How do I write the equivalent of <code>Dim varName as int64 = value</code> in Go?</p>\n\n<p>Whenever I find myself needing to declare a variable in Go I google a lot until I find the correct syntax.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "is_accepted": true, "score": 8, "last_activity_date": 1464100542, "last_edit_date": 1464100542, "creation_date": 1464079769, "answer_id": 37408597, "question_id": 37407476, "link": "https://stackoverflow.com/questions/37407476/how-to-push-in-golang-for-nested-array/37408597#37408597", "title": "How to $push in golang for nested array?", "body": "<p>You are pushing an array of <code>Sales</code> with syntax for a single item.<br>\nIt should be either a single <code>Sales</code> object to push:</p>\n\n<pre><code>addsales:= Sales{\n    FIRSTNAME : \"chetan\",\n    LASTNAME : \"kumar\",\n    AGE : 24,\n},\nchange := bson.M{\"$push\":bson.M{\"user.$.sales\":addsales}}\n</code></pre>\n\n<p>or use <code>$each</code> modifier to push multiple items:</p>\n\n<pre><code>addsales:= []Sales{Sales{\n    FIRSTNAME : \"chetan\",\n    LASTNAME : \"kumar\",\n    AGE : 24,\n    },\n}\nchange := bson.M{\"$push\":bson.M{\"user.$.sales\":bson.M{\"$each\":addsales}}}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1464096421, "creation_date": 1464096421, "answer_id": 37415066, "question_id": 37407476, "link": "https://stackoverflow.com/questions/37407476/how-to-push-in-golang-for-nested-array/37415066#37415066", "title": "How to $push in golang for nested array?", "body": "<pre><code>addsales:= []Sales{Sales{\n            FIRSTNAME : \"chetan\",\n         LASTNAME : \"kumar\",\n         AGE : 24,\n          },\n        }\n\n    match := bson.M{\"user.firstName\" : \"nepolean\"}\n    change := bson.M{\"$push\":bson.M{\"user.$.sales\":bson.M{\"$each\":addsales}}}\n\n\n    err = c.Update(match,change)\n    if err !=nil{\n        panic(err)      \n    }else{\n    fmt.Println(\"success\")\n    }\n</code></pre>\n"}], "owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5853, "favorite_count": 6, "accepted_answer_id": 37408597, "answer_count": 2, "score": 5, "last_activity_date": 1464100542, "creation_date": 1464076407, "last_edit_date": 1464078298, "question_id": 37407476, "link": "https://stackoverflow.com/questions/37407476/how-to-push-in-golang-for-nested-array", "title": "How to $push in golang for nested array?", "body": "<p>I tried to push some data in nested array using <code>$push</code>. Here is my json file</p>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"57307906f051147d5317984e\"),\n    \"user\" : [\n        {\n            \"firstName\" : \"chetan\",\n            \"lastName\" : \"kumar\",\n            \"age\" : 23,\n            \"sales\" : [\n                {\n            \"firstName\" : \"ashu\",\n            \"lastName\" : \"jha\",\n            \"age\" : 27\n                }\n            ],\n        },\n        {\n            \"firstName\" : \"nepolean\",\n            \"lastName\" : \"dang\",\n            \"age\" : 26\n        },\n        {\n            \"firstName\" : \"Raj\",\n            \"lastname\" : \"kumar\",\n            \"age\" : 26\n        }\n    ],\n\n}\n</code></pre>\n\n<p>Now here is my golang code which I tried here to execute</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n        //\"encoding/json\"\n    \"github.com/gorilla/mux\"\n        \"gopkg.in/mgo.v2\"\n        \"gopkg.in/mgo.v2/bson\"\n)\ntype User struct{\n    SALES       []Sales     `json:\"sales\" bson:\"sales\"`\n    FIRSTNAME   string      `json:\"firstName\" bson:\"firstName\"`\n    LASTNAME    string      `json:\"lastName\" bson:\"lastName\"`\n    AGE     int     `json:\"age\" bson:\"age\"`\n}\ntype Sales struct{\n    FIRSTNAME   string      `json:\"firstName\" bson:\"firstName\"`\n    LASTNAME    string      `json:\"lastName\" bson:\"lastName\"`\n    AGE     int     `json:\"age\" bson:\"age\"`\n}\n\ntype Details struct{\n    ID  bson.ObjectId   `json:\"_id\" bson:\"_id\"`\n    USER    []User      `json:\"user\" bson:\"user\"`\n\n}\n\n\nfunc detail(w http.ResponseWriter, r *http.Request){\n    session, err := mgo.Dial(\"127.0.0.1\")\n        if err != nil {\n                panic(err)\n        }else{\n                fmt.Println(\"dial\")\n        }\n        defer session.Close()\n\n\n        session.SetMode(mgo.Monotonic, true)\n\n        c := session.DB(\"userdb\").C(\"user\")\n        addsales:= []Sales{Sales{\n            FIRSTNAME : \"chetan\",\n            LASTNAME : \"kumar\",\n            AGE : 24,\n            },\n        }\n    fmt.Println(addsales)\n    match := bson.M{\"firstName\" : \"nepolean\"}\n    change := bson.M{\"$push\":bson.M{\"user.$.sales\":addsales}}\n    err = c.Update(match,change)\n    if err !=nil{\n        panic(err)      \n    }else{\n    fmt.Println(\"success\")\n    }\n}\n\nfunc main(){\n    router := mux.NewRouter().StrictSlash(true)\n    router.HandleFunc(\"/detail\",detail)\n    log.Fatal(http.ListenAndServe(\":9080\", router))\n\n}\n</code></pre>\n\n<p>Here, is my OutPut after executing</p>\n\n<pre><code>/Desktop$ go run arrayupdate.go dial [{chetan kumar 24}] 2016/05/24\n 12:39:48 http: panic serving 127.0.0.1:43928: not found goroutine 5\n [running]: net/http.(*conn).serve.func1(0xc820082200)\n    /usr/local/go/src/net/http/server.go:1389 +0xc1 panic(0x7c6bc0,\n 0xc82000b080)  /usr/local/go/src/runtime/panic.go:426 +0x4e9\n main.detail(0x7f4a62bf9900, 0xc8200735f0, 0xc8200d6000)\n    /home/joybynature/Desktop/arrayupdate.go:93 +0x7a6\n net/http.HandlerFunc.ServeHTTP(0x91d9f0, 0x7f4a62bf9900, 0xc8200735f0,\n 0xc8200d6000)  /usr/local/go/src/net/http/server.go:1618 +0x3a\n github.com/gorilla/mux.(*Router).ServeHTTP(0xc820012550,\n 0x7f4a62bf9900, 0xc8200735f0, 0xc8200d6000)\n    /home/joybynature/src/github.com/gorilla/mux/mux.go:107 +0x285\n net/http.serverHandler.ServeHTTP(0xc820082180, 0x7f4a62bf9900,\n 0xc8200735f0, 0xc8200d6000)    /usr/local/go/src/net/http/server.go:2081\n +0x19e net/http.(*conn).serve(0xc820082200)    /usr/local/go/src/net/http/server.go:1472 +0xf2e created by\n net/http.(*Server).Serve   /usr/local/go/src/net/http/server.go:2137\n +0x44e\n</code></pre>\n"}, {"tags": ["go", "concurrency", "channel"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1483963185, "last_edit_date": 1483963185, "creation_date": 1464074860, "answer_id": 37407004, "question_id": 37406914, "link": "https://stackoverflow.com/questions/37406914/golang-cannot-send-on-channel/37407004#37407004", "title": "Golang: cannot send on channel", "body": "<p>Because you have an <em>unbuffered</em> channel, and you can only send a value on an unbuffered channel without blocking if there is another goroutine which is ready to receive from it.</p>\n\n<p>Since you only have 1 goroutine, it gets blocked. Solution is simple: launch your <code>Quack.quack()</code> method in a new goroutine:</p>\n\n<pre><code>go self.quack(ch)\n</code></pre>\n\n<p>Then the output (try it on the <a href=\"https://play.golang.org/p/UJDm4LtztF\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>mockQuack start\nmockQuack done\ntrue\n</code></pre>\n\n<p>Another option is to not launch a new goroutine but make a <em>buffered</em> channel, so it can hold some values without any receivers ready to receive from it:</p>\n\n<pre><code>ch := make(chan bool, 1) // buffered channel, buffer for 1 value\n</code></pre>\n\n<p>This creates a channel which is capable of \"storing\" one value without any receivers ready to receive it. A second send on the channel would also block, unless the value is received from it first (or a receiver ready to receive a value from it).</p>\n\n<p>Try this buffered channel version on the <a href=\"https://play.golang.org/p/Kd84lz4SAe\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Relevant section from the spec: <a href=\"https://golang.org/ref/spec#Send_statements\" rel=\"nofollow noreferrer\">Send statements:</a></p>\n\n<blockquote>\n  <p>Both the channel and the value expression are evaluated before communication begins. <strong>Communication blocks until the send can proceed. A send on an unbuffered channel can proceed if a receiver is ready.</strong> A send on a buffered channel can proceed if there is room in the buffer. A send on a closed channel proceeds by causing a <a href=\"https://golang.org/ref/spec#Run_time_panics\" rel=\"nofollow noreferrer\">run-time panic</a>. A send on a <em>nil</em> channel blocks forever.</p>\n</blockquote>\n\n<p><strong>Notes:</strong></p>\n\n<p>Based on the received value you print <code>true</code> or <code>false</code>. This can be done with a single line, without the <code>if</code> statement:</p>\n\n<pre><code>fmt.Println(b)\n</code></pre>\n\n<p>You can even get rid of the <code>b</code> local variable, and print the received value right away:</p>\n\n<pre><code>fmt.Println(&lt;-ch)\n</code></pre>\n\n<p>Also I assume you used channels because you wanted to play with them, but in your case <code>mockQuack()</code> could simply return the <code>bool</code> value, without the use of channels.</p>\n"}], "owner": {"reputation": 311, "user_id": 5011904, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-12PpZ-hxzTA/AAAAAAAAAAI/AAAAAAAAAPs/U4Jp9skB1dQ/photo.jpg?sz=128", "display_name": "Florian Boehmak", "link": "https://stackoverflow.com/users/5011904/florian-boehmak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3155, "favorite_count": 0, "accepted_answer_id": 37407004, "answer_count": 1, "score": 1, "last_activity_date": 1483963185, "creation_date": 1464074597, "last_edit_date": 1464075796, "question_id": 37406914, "link": "https://stackoverflow.com/questions/37406914/golang-cannot-send-on-channel", "title": "Golang: cannot send on channel", "body": "<p>Why is it not sending on the channel and blocking the execution? How can I make this constellation work so that I can send a signal into <code>MoneyDive()</code> and continue execution?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Quack func(ch chan bool)\n\ntype DagobertDuck struct {\n    quack Quack\n}\n\nfunc (self *DagobertDuck) MoneyDive() {\n    ch := make(chan bool)\n    self.quack(ch)\n    b := &lt;-ch\n    if b {\n        fmt.Println(\"true\")\n    } else {\n        fmt.Println(\"false\")\n    }\n}\n\nfunc mockQuack(ch chan bool) {\n    fmt.Println(\"mockQuack start\")\n    ch &lt;- true\n    fmt.Println(\"mockQuack done\")\n}\n\nfunc main() {\n    dd := DagobertDuck{quack: mockQuack}\n    dd.MoneyDive()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/1omlb7u6-A\" rel=\"nofollow\">https://play.golang.org/p/1omlb7u6-A</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1464072295, "post_id": 37406075, "comment_id": 62319874, "body": "Are you sure you&#39;re not just interested in a string representation of the object and want to implement the <code>Stringer</code> interface?"}, {"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1464073514, "post_id": 37406075, "comment_id": 62320536, "body": "what output do you want?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464074067, "post_id": 37406075, "comment_id": 62320912, "body": "Related / possible duplicate of <a href=\"http://stackoverflow.com/questions/33142594/how-to-print-struct-with-string-of-fields\">How to print struct with String() of fields?</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1464078882, "post_id": 37406075, "comment_id": 62323646, "body": "Package reflect is your friend here."}], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 3, "last_activity_date": 1464081067, "creation_date": 1464081067, "answer_id": 37409084, "question_id": 37406075, "link": "https://stackoverflow.com/questions/37406075/list-the-struct-fields-and-methods-dynamically/37409084#37409084", "title": "List the struct fields and methods dynamically", "body": "<p>To get information about a struct at runtime, you have to use the package <code>reflect</code>. First, get the type of the struct, and then you can iterate through it. However, with your example, be aware that the type <code>main.Student</code> doesn't have any methods associated, but the type <code>*main.Student</code> has.</p>\n\n<p>Here is an example of how you can fetch those information:</p>\n\n<pre><code>func main() {\n    s := Student{1, \"Jack\", 22}\n    t := reflect.TypeOf(s)\n    ptr_t := reflect.TypeOf(&amp;s)\n\n    methods := make([]string, 0)\n    for i := 0; i &lt; ptr_t.NumMethod(); i++ {\n        methods = append(methods, ptr_t.Method(i).Name)\n    }\n\n    fields := make([]string, 0)\n    for i := 0; i &lt; t.NumField(); i++ {\n        fields = append(fields, t.Field(i).Name)\n    }\n\n    fmt.Println(methods)\n    # [getAge getId getName setAge setId setName]\n    fmt.Println(fields)\n    # [id name age]\n\n}\n</code></pre>\n\n<p>A point about your code: look at how the export of fields and methods between package is done. Because all the fields and methods starting by a lowercase letter are not accessible outside of the package. You have to start them with an uppercase letter.</p>\n\n<p>Another point: there are usually no getters and setters in Go code. If you want to read and write a struct field, simply start it with an uppercase letter.</p>\n"}], "owner": {"reputation": 206, "user_id": 5960957, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh4.googleusercontent.com/-pctNIU3p1i0/AAAAAAAAAAI/AAAAAAAAS9U/zdAijtjqGZs/photo.jpg?sz=128", "display_name": "Yajnesh Rai", "link": "https://stackoverflow.com/users/5960957/yajnesh-rai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 949, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1464081067, "creation_date": 1464071888, "question_id": 37406075, "link": "https://stackoverflow.com/questions/37406075/list-the-struct-fields-and-methods-dynamically", "title": "List the struct fields and methods dynamically", "body": "<p>How to list the fields and methods of a struct, in GoLang dynamically? For eg, I want to get the output as id, name, age, and all the method names.</p>\n\n<pre><code>type Student struct {\n    id int\n    name string\n    age int\n}\n\nfunc (s *Student) setId(i int) {\n    s.id = i\n}\n\nfunc (s *Student) getId() int {\n    return s.id\n}\n\nfunc (s *Student) setName(n string) {\n    s.name = n\n}\n\nfunc (s *Student) getName() string {\n    return s.name\n}\n\nfunc (s *Student) setAge(a int) {\n    s.age = a\n}\n\nfunc (s *Student) getAge() int {\n    return s.age\n}\n\nfunc main() {\n    st := Student{1,\"Jack\",22}\n    fmt.Println(st.getId(),\" \",st.getName(),\" \",st.getAge())\n\n}\n</code></pre>\n"}, {"tags": ["performance", "serialization", "go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464069470, "post_id": 37405162, "comment_id": 62318496, "body": "Which version of Go?"}, {"owner": {"reputation": 9, "user_id": 6374192, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe10c936a1869db0670ac5b2b8fe2bf7?s=128&d=identicon&r=PG&f=1", "display_name": "zhannk", "link": "https://stackoverflow.com/users/6374192/zhannk"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464069619, "post_id": 37405162, "comment_id": 62318575, "body": "go version go1.6 linux/amd64"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1464078968, "post_id": 37405162, "comment_id": 62323701, "body": "Don&#39;t write to disk if you want to measure how fast (de)serialization is. Beside from that: What is the question?"}], "answers": [{"tags": [], "owner": {"reputation": 742, "user_id": 717318, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/13e99fc7225ca378040ef36ef1a3049e?s=128&d=identicon&r=PG", "display_name": "Kevin Deenanauth", "link": "https://stackoverflow.com/users/717318/kevin-deenanauth"}, "is_accepted": false, "score": 0, "last_activity_date": 1464072841, "creation_date": 1464072841, "answer_id": 37406355, "question_id": 37405162, "link": "https://stackoverflow.com/questions/37405162/serialization-performance-in-golang-json-gob-xml/37406355#37406355", "title": "Serialization performance in golang json/gob/xml", "body": "<p>The default json encoder/decoder performs a lot of reflection. Check out <a href=\"https://github.com/pquerna/ffjson\" rel=\"nofollow\">https://github.com/pquerna/ffjson</a> for a drop in replacement that generates code for greatly improved performance.</p>\n"}, {"tags": [], "owner": {"reputation": 3157, "user_id": 73007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b736113aa1557b9a110b5123d81d5f6?s=128&d=identicon&r=PG", "display_name": "Daniel Lemire", "link": "https://stackoverflow.com/users/73007/daniel-lemire"}, "is_accepted": false, "score": 1, "last_activity_date": 1482420310, "creation_date": 1482420310, "answer_id": 41286475, "question_id": 37405162, "link": "https://stackoverflow.com/questions/37405162/serialization-performance-in-golang-json-gob-xml/41286475#41286475", "title": "Serialization performance in golang json/gob/xml", "body": "<p>As you report, your benchmark has a lot of inter-run variability. This makes it difficult to reason about the problem. What we really want is a benchmark that always gives the same results, no matter what time of the day we run it. </p>\n\n<p>I revised your benchmark slightly so that it easier to reproduce reliably the results:\n1. I serialize the data to memory (as a byte slice<code>[]byte</code>),\n2. I avoid overflowing the processor's cache with data (i.e., use little data).</p>\n\n<p>There is a standard way to write benchmarks in Go, to get more reproducible results (<a href=\"https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go\" rel=\"nofollow noreferrer\">https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go</a>) but in this instance, I have not found it necessary.</p>\n\n<p>See my code at <a href=\"https://github.com/lemire/Code-used-on-Daniel-Lemire-s-blog/tree/master/extra/golang/serialization\" rel=\"nofollow noreferrer\">https://github.com/lemire/Code-used-on-Daniel-Lemire-s-blog/tree/master/extra/golang/serialization</a></p>\n\n<p>On my test server (a Skylake processor configured for testing, running at a flat 3.4 GHz, with go 1.7), I get...</p>\n\n<p><code>\n2016/12/22 09:55:54 Serialization by JSON elapsed: 599 us\n2016/12/22 09:55:54 serialized size in bytes:  18781\n2016/12/22 09:55:54 Serialization by GOB elapsed: 230 us\n2016/12/22 09:55:54 serialized size in bytes:  9066\n2016/12/22 09:55:54 Serialization by XML elapsed: 2404 us\n2016/12/22 09:55:54 serialized size in bytes:  25780\n</code></p>\n\n<p>As you can see with my results, JSON is just slighly larger (30%) than XML, and GOB is much smaller. This is in agreement with your results. Still in agreement with your results, GOB is much faster than XML and JSON.</p>\n\n<p>However, JSON serialization is much faster than XML serialization (by a factor of 4). GOB is twice as fast as JSON. </p>\n\n<p>You will get different results on your own hardware, but I suspect you will get fairly consistent numbers (little inter-run variability), especially if you disable CPU features such as TurboBoost.</p>\n\n<p>What would happen if we were to actually serialize to disk or use large blobs of data? It would not change the performance ordering since GOB is faster and smaller, JSON is in the middle with respect to both data size and processing size, and XML is more bloated and slower to process. </p>\n\n<p>So I think we can safely conclude that we have the following...</p>\n\n<ol>\n<li><p>GOB is smaller and faster.</p></li>\n<li><p>JSON is small and fast.</p></li>\n<li><p>XML is large and slow.</p></li>\n</ol>\n"}], "owner": {"reputation": 9, "user_id": 6374192, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe10c936a1869db0670ac5b2b8fe2bf7?s=128&d=identicon&r=PG&f=1", "display_name": "zhannk", "link": "https://stackoverflow.com/users/6374192/zhannk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2014, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1504829121, "creation_date": 1464068132, "last_edit_date": 1464068510, "question_id": 37405162, "link": "https://stackoverflow.com/questions/37405162/serialization-performance-in-golang-json-gob-xml", "title": "Serialization performance in golang json/gob/xml", "body": "<p>Go standard lib, Json serialization performance question...JSON is slower than XML and GOB, while json size less than xml file size?</p>\n\n<p>please help point out anything mistake?</p>\n\n<pre><code>docker@dockhost:~/go/projects/wiki$ go run encoding.go \n2016/05/24 00:52:16 Serialization by JSON elapsed: 2152195 us\n2016/05/24 00:52:16 students.json 19177782\n2016/05/24 00:52:17 Serialization by GOB elapsed: 748867 us\n2016/05/24 00:52:17 students.gob 9305166\n2016/05/24 00:52:18 Serialization by XML elapsed: 1507397 us\n2016/05/24 00:52:18 students.xml 26177780\n\ndocker@dockhost:~/go/projects/wiki$ go run encoding.go \n2016/05/24 00:52:32 Serialization by JSON elapsed: 1388153 us\n2016/05/24 00:52:32 students.json 19177782\n2016/05/24 00:52:33 Serialization by GOB elapsed: 502814 us\n2016/05/24 00:52:33 students.gob 9305166\n2016/05/24 00:52:34 Serialization by XML elapsed: 897859 us\n2016/05/24 00:52:34 students.xml 26177780\n\ndocker@dockhost:~/go/projects/wiki$ go run encoding.go \n2016/05/24 00:52:41 Serialization by JSON elapsed: 1290359 us\n2016/05/24 00:52:41 students.json 19177782\n2016/05/24 00:52:42 Serialization by GOB elapsed: 434203 us\n2016/05/24 00:52:42 students.gob 9305166\n2016/05/24 00:52:42 Serialization by XML elapsed: 862379 us\n2016/05/24 00:52:42 students.xml 26177780\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>package main\n\n\nimport (\n        \"log\"\n        \"encoding/json\"\n        \"encoding/gob\"\n        \"encoding/xml\"\n        \"math/rand\"\n        \"strconv\"\n        \"os\"\n        \"time\"\n)\n\n\n\nconst (\n        Male=iota\n        Female\n        Unknown\n\n        ALL=100000\n)\n\ntype Person struct {\n        Name string\n        Id      string\n        Age     int\n        Gender  int\n}\ntype Student struct {\n        Person Person\n        Grade int\n        Class   string\n        Teacher Person\n}\n\nfunc (s  Student) String() string{\n        v,err:=json.Marshal(s)\n        if err!=nil {\n                log.Fatal(\"Marshal failed\",s)\n        }\n        return string(v)\n\n}\n\nvar students []Student\nfunc init(){\n        students=make([]Student,ALL)\n        for i:=0;i&lt;ALL;i++ {\n                students[i].Grade=rand.Intn(5)\n                students[i].Class=strconv.Itoa(students[i].Grade)+\",class\"+strconv.Itoa(rand.Intn(10))\n                students[i].Person.Name=\"Student \"+strconv.Itoa(i)\n                students[i].Person.Id=\"11001234512345551\"+strconv.Itoa(rand.Intn(10))\n                students[i].Person.Age=10+rand.Intn(10)\n                students[i].Person.Gender=rand.Intn(3)\n                students[i].Teacher.Id=\"22001154365151344\"+strconv.Itoa(rand.Intn(10))\n                students[i].Teacher.Name=\"Teacher \"+strconv.Itoa(i)\n                students[i].Teacher.Age=40+rand.Intn(10)\n                students[i].Teacher.Gender=rand.Intn(3)\n        }\n\n}\n\nfunc toJsonFile(){\n        f,err:=os.OpenFile(\"students.json\",os.O_RDWR ,0600)\n        if err!=nil {\n                log.Fatal(\"Can't open students.json \"+ err.Error())\n        }\n        defer f.Close()\n        en:=json.NewEncoder(f)\n        err=en.Encode(students)\n        if err!=nil {\n\n                log.Fatal(err)\n        }\n\n}\n\nfunc loadJsonFile(){\n        f,err:=os.Open(\"students.json\")\n        if err!=nil {\n                log.Fatal(err)\n        }\n        defer f.Close()\n        dec:=json.NewDecoder(f)\n        ss:=make([]Student,ALL)\n        err=dec.Decode(&amp;ss)\n        if err!=nil {\n\n                log.Fatal(err)\n        }\n//      log.Println(ss)\n}\n\n\n\nfunc toGobFile(){\n        f,err:=os.OpenFile(\"students.gob\",os.O_RDWR ,0600)\n        if err!=nil {\n                log.Fatal(\"Can't open students.gob \"+ err.Error())\n        }\n        defer f.Close()\n        en:=gob.NewEncoder(f)\n        err=en.Encode(students)\n        if err!=nil {\n\n                log.Fatal(err)\n        }\n\n}\n\nfunc loadGobFile(){\n        f,err:=os.Open(\"students.gob\")\n        if err!=nil {\n                log.Fatal(err)\n        }\n        defer f.Close()\n        dec:=gob.NewDecoder(f)\n        ss:=make([]Student,ALL)\n        err=dec.Decode(&amp;ss)\n        if err!=nil {\n\n                log.Fatal(err)\n        }\n//      log.Println(ss)\n}\n\n\n\nfunc toXmlFile(){\n        f,err:=os.OpenFile(\"students.xml\",os.O_RDWR ,0600)\n        if err!=nil {\n                log.Fatal( err.Error())\n        }\n        defer f.Close()\n        en:=xml.NewEncoder(f)\n        err=en.Encode(students)\n        if err!=nil {\n\n                log.Fatal(err)\n        }\n\n}\nfunc loadXmlFile(){\n        f,err:=os.Open(\"students.xml\")\n        if err!=nil {\n                log.Fatal(err)\n        }\n        defer f.Close()\n        dec:=xml.NewDecoder(f)\n        ss:=make([]Student,ALL)\n        err=dec.Decode(&amp;ss)\n        if err!=nil {\n\n                log.Fatal(err)\n        }\n//      log.Println(ss)\n}\n\n\n\n\nfunc main(){\n        start:=time.Now()\n        toJsonFile()\n        loadJsonFile()\n        end:=time.Now()\n\n        log.Printf(\"Serialization by JSON elapsed: %d us\",end.Sub(start)/1000)\n\n        fi,err:=os.Stat(\"students.json\")\n        if err!=nil {\n                log.Fatal(err)\n        }\n        log.Println(fi.Name(), fi.Size())\n\n\n\n        start=time.Now()\n        toGobFile()\n        loadGobFile()\n        end=time.Now()\n\n\n        log.Printf(\"Serialization by GOB elapsed: %d us\",end.Sub(start)/1000)\n\n        fi,err=os.Stat(\"students.gob\")\n        if err!=nil {\n                log.Fatal(err)\n        }\n        log.Println(fi.Name(), fi.Size())\n\n        start=time.Now()\n        toXmlFile()\n        loadXmlFile()\n        end=time.Now()\n\n\n        log.Printf(\"Serialization by XML elapsed: %d us\",end.Sub(start)/1000)\n\n        fi,err=os.Stat(\"students.xml\")\n        if err!=nil {\n                log.Fatal(err)\n        }\n        log.Println(fi.Name(), fi.Size())\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 113, "user_id": 5943721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mSgAn.jpg?s=128&g=1", "display_name": "itczl", "link": "https://stackoverflow.com/users/5943721/itczl"}, "edited": false, "score": 0, "creation_date": 1464069524, "post_id": 37404989, "comment_id": 62318532, "body": "Here is an reference: <a href=\"http://go-database-sql.org/prepared.html\" rel=\"nofollow noreferrer\">go-database-sql.org/prepared.html</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1236, "user_id": 1221253, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c05edd2a49079a60ee18c6609dc44e10?s=128&d=identicon&r=PG&f=1", "display_name": "Dina", "link": "https://stackoverflow.com/users/1221253/dina"}, "edited": false, "score": 0, "creation_date": 1500875820, "post_id": 37405166, "comment_id": 77509573, "body": "But I want at a specific point in time to execute a single query, is there a difference between the two? And if I have a certain query which I intend to use several times (with different parameters) but infrequently and not in parallel, should I still prepare a statement? Does it make sense not to close a Stmt throughout the entire lifetime of the application?"}], "tags": [], "owner": {"reputation": 13358, "user_id": 3878940, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/v1J2L.jpg?s=128&g=1", "display_name": "Aditya Singh", "link": "https://stackoverflow.com/users/3878940/aditya-singh"}, "is_accepted": false, "score": 3, "last_activity_date": 1464071936, "last_edit_date": 1464071936, "creation_date": 1464068174, "answer_id": 37405166, "question_id": 37404989, "link": "https://stackoverflow.com/questions/37404989/whats-the-difference-between-db-query-and-db-preparestmt-query-in-golang/37405166#37405166", "title": "what`s the difference between DB.Query() and DB.Prepare()+Stmt.Query() in golang", "body": "<p><strong>DB.Query</strong></p>\n\n<blockquote>\n<pre><code>func (db *DB) Query(query string, args ...interface{}) (*Rows, error)\n</code></pre>\n  \n  <p>Query executes a query that returns rows, typically a SELECT. The args are for any placeholder parameters in the query.</p>\n</blockquote>\n\n<p>By definition this accepts a single query and returns rows to iterate from</p>\n\n<p><strong>DB.Prepare() + Stmt.Query()</strong></p>\n\n<blockquote>\n<pre><code>func (db *DB) Prepare(query string) (*Stmt, error)\n</code></pre>\n  \n  <p>Prepare creates a prepared statement for later queries or executions. Multiple queries or executions may be run concurrently from the returned statement</p>\n\n<pre><code>func (s *Stmt) Query(args ...interface{}) (*Rows, error)\n</code></pre>\n  \n  <p>Query executes a prepared query statement with the given arguments and returns the query results as a *Rows.</p>\n</blockquote>\n\n<p>Since <em>DB.prepare</em> can accept multiple queries and <em>Stmt.Query</em> can run them concurrently, this can be used to <strong>run multiple concurrent queries</strong> as well, unlike the <em>DB.Query</em> which is used to <strong>execute a single query</strong></p>\n"}], "owner": {"reputation": 113, "user_id": 5943721, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mSgAn.jpg?s=128&g=1", "display_name": "itczl", "link": "https://stackoverflow.com/users/5943721/itczl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2143, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1464071936, "creation_date": 1464067414, "question_id": 37404989, "link": "https://stackoverflow.com/questions/37404989/whats-the-difference-between-db-query-and-db-preparestmt-query-in-golang", "title": "what`s the difference between DB.Query() and DB.Prepare()+Stmt.Query() in golang", "body": "<p>These two schemes can achieve the same function, so what`s the difference between them? \nreference:\n      <a href=\"https://golang.org/pkg/database/sql/\" rel=\"nofollow\">https://golang.org/pkg/database/sql/</a></p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "is_accepted": true, "score": 0, "last_activity_date": 1464068114, "last_edit_date": 1464068114, "creation_date": 1464067473, "answer_id": 37405003, "question_id": 37404523, "link": "https://stackoverflow.com/questions/37404523/parse-mongodb-results-using-go-and-mgo/37405003#37405003", "title": "Parse MongoDB results Using Go and mgo", "body": "<p>Remove the space in the middle of tags.</p>\n\n<p>Use <code>bson:\"firstName\"</code> instead of <code>bson: \"firstName\"</code></p>\n\n<pre><code>type Person struct {\n    FirstName string `bson:\"firstName\" json:\"firstName\"`\n    LastName string `bson:\"lastName json:\"lastName\"`\n}\n</code></pre>\n\n<p>From documentation at <a href=\"https://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow\">https://golang.org/pkg/reflect/#StructTag</a>,</p>\n\n<blockquote>\n  <p>By convention, tag strings are a concatenation of optionally\n  space-separated key:\"value\" pairs.</p>\n</blockquote>\n\n<p>So there should be no space between key and value. Different pairs of a key and a value could be separated by a space.</p>\n"}], "owner": {"reputation": 129, "user_id": 2213011, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/118c30f58273b8fd17c08bc4160d0dfe?s=128&d=identicon&r=PG", "display_name": "kccoers", "link": "https://stackoverflow.com/users/2213011/kccoers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 664, "favorite_count": 0, "accepted_answer_id": 37405003, "answer_count": 1, "score": 1, "last_activity_date": 1464068114, "creation_date": 1464064881, "question_id": 37404523, "link": "https://stackoverflow.com/questions/37404523/parse-mongodb-results-using-go-and-mgo", "title": "Parse MongoDB results Using Go and mgo", "body": "<p>I am trying to parse the results of a MongoDB query from Go. I have document(s) that output from my Database as a result of:</p>\n\n<pre><code>db.getCollection('People').find({})\n\n{\n    \"_id\" : ObjectId(\"5730fd75113c8b08703b5974\"),\n    \"firstName\" : \"George\",\n    \"lastName\" : \"FakeLastName\"\n}\n{\n    \"_id\" : ObjectId(\"5730fd75113c8b08703b5975\"),\n    \"firstName\" : \"John\",\n    \"lastName\" : \"Doe\"\n}\n{\n    \"_id\" : ObjectId(\"5730fd75113c8b08703b5976\"),\n    \"firstName\" : \"Jane\",\n    \"lastName\" : \"Doe\"\n}\n</code></pre>\n\n<p>Here is the Go code that I am trying to use:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"gopkg.in/mgo.v2\"\n)\n\ntype Person struct {\n    FirstName string `bson: \"firstName\" json: \"firstName\"`\n    LastName string `bson: \"lastName json: \"lastName\"`\n}\n\nfunc main() {\n    session, err := mgo.Dial(\"10.0.0.89\")\n    if err != nil {\n            panic(err)\n    }\n    defer session.Close()\n\n    // Optional. Switch the session to a monotonic behavior.\n    session.SetMode(mgo.Monotonic, true)\n\n    c := session.DB(\"PeopleDatabase\").C(\"People\")\n\n    var people []Person\n    err = c.Find(nil).All(&amp;people)\n    if err != nil {\n            log.Fatal(err)\n    }\n\n    for _, res := range people{\n        fmt.Printf(\"Name: %v\\n\", res)\n    }\n}\n</code></pre>\n\n<p>When I run this code I get the following Output:</p>\n\n<pre><code>Name: { }\nName: { }\nName: { }\n</code></pre>\n\n<p>When using res.FirstName in place of res I just get a space in lieu of the {}.</p>\n\n<p>I have been over the documentation in the following locations:</p>\n\n<p><a href=\"https://labix.org/mgo\" rel=\"nofollow\">https://labix.org/mgo</a></p>\n\n<p><a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Find\" rel=\"nofollow\">https://godoc.org/gopkg.in/mgo.v2#Collection.Find</a></p>\n\n<p><a href=\"https://gist.github.com/border/3489566\" rel=\"nofollow\">https://gist.github.com/border/3489566</a></p>\n\n<p>I would be extemely grateful for any help that can be given. Thank You.</p>\n"}, {"tags": ["go", "revel", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "edited": false, "score": 0, "creation_date": 1464115812, "post_id": 37408544, "comment_id": 62348618, "body": "I don&#39;t know the shard db options like host, db name until request cross the security filter. So I cannot create db connection inside init"}, {"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "reply_to_user": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "edited": false, "score": 0, "creation_date": 1464134827, "post_id": 37408544, "comment_id": 62356779, "body": "why you don&#39;t know? is it application that you will build, no?"}, {"owner": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "edited": false, "score": 0, "creation_date": 1464150596, "post_id": 37408544, "comment_id": 62360279, "body": "I will get user database details from other service (cluster service) . That will be fetched in security filter."}, {"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "reply_to_user": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "edited": false, "score": 0, "creation_date": 1464164337, "post_id": 37408544, "comment_id": 62366586, "body": "But I believe you have a list of the DB server, so you can connect to all DB you have. And when any request come, just select which DB to use. I still don&#39;t know why you don&#39;t know your DB."}, {"owner": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "edited": false, "score": 0, "creation_date": 1464287080, "post_id": 37408544, "comment_id": 62435405, "body": "DB server list maintain in other service. One db server will have 300 db &#39;s.  Suppose we have 5 db server means, is it need to create 1500 gorm.open? Is it right to do?"}], "tags": [], "owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "is_accepted": true, "score": 0, "last_activity_date": 1464079653, "creation_date": 1464079653, "answer_id": 37408544, "question_id": 37404483, "link": "https://stackoverflow.com/questions/37404483/how-can-i-switch-database-connection-and-share-it-to-model-in-golang-revel-g/37408544#37408544", "title": "How can I switch database connection and share it to model in Golang? (Revel + Gorm)", "body": "<p>First is prepare you DB connection on the init (only call once) : </p>\n\n<pre><code>db1, err := gorm.Open(dbdriver, dboption) //your main server\ndb2, err := gorm.Open(dbdriver, dboption) //your sharding 1\ndb3, err := gorm.Open(dbdriver, dboption) //your sharding 2\n</code></pre>\n\n<p>And on your db filter just choose the between db1, db2, or db3 you want to be used by your model. Thats all.</p>\n\n<p>Gorm already make the pool for you, so you don't need to take care.</p>\n"}], "owner": {"reputation": 309, "user_id": 4517341, "user_type": "registered", "accept_rate": 36, "profile_image": "https://graph.facebook.com/100000867481103/picture?type=large", "display_name": "Kumar Siva", "link": "https://stackoverflow.com/users/4517341/kumar-siva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1188, "favorite_count": 0, "accepted_answer_id": 37408544, "answer_count": 1, "score": 0, "last_activity_date": 1464079653, "creation_date": 1464064623, "question_id": 37404483, "link": "https://stackoverflow.com/questions/37404483/how-can-i-switch-database-connection-and-share-it-to-model-in-golang-revel-g", "title": "How can I switch database connection and share it to model in Golang? (Revel + Gorm)", "body": "<p>I want to setup Database sharding like <a href=\"https://github.com/thiagopradi/octopus\" rel=\"nofollow\">https://github.com/thiagopradi/octopus</a> in Revel + Gorm(or any other ORM in Golang). </p>\n\n<p>I will get db connection string in <strong>security filter</strong> (which was a custom filter, added after revel's param filter). Now I need to switch db connection in next custom filter called <strong>db filter</strong></p>\n\n<p>And also need to implement db connection pool in revel application start up. </p>\n"}, {"tags": ["dictionary", "go", "concurrency"], "comments": [{"owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464090061, "post_id": 37404025, "comment_id": 62331383, "body": "What is your problem with <code>self</code>, is it a kind of OCD?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464091461, "post_id": 37404025, "comment_id": 62332432, "body": "it&#39;s actually looked down upon by the Go creators themselves, along with the majority of the community. <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#receiver-names\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/CodeReviewComments#receiver-names</a> also check <a href=\"http://programmers.stackexchange.com/questions/286406/use-of-this-in-golang\" title=\"use of this in golang\">programmers.stackexchange.com/questions/286406/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "edited": false, "score": 0, "creation_date": 1464062218, "post_id": 37404064, "comment_id": 62316292, "body": "So my code is correct with a part from 2nd example?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1464061843, "creation_date": 1464061843, "answer_id": 37404064, "question_id": 37404025, "link": "https://stackoverflow.com/questions/37404025/should-i-rlock-map-before-range/37404064#37404064", "title": "Should I RLock map before range?", "body": "<p>You must lock the map to prevent concurrent reads in <code>notifyAll</code> with the write in <code>removeConn</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "edited": false, "score": 0, "creation_date": 1464088424, "post_id": 37410279, "comment_id": 62330167, "body": "There is 2nd code example, is it correct in this case?"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "edited": false, "score": 0, "creation_date": 1464089617, "post_id": 37410279, "comment_id": 62331057, "body": "No; because you are removing the item in another go-routine which might get started after <code>notifyAll</code> has exited and <code>defer mu.RUnlock()</code> line of-course got executed. In other words locking your map inside <code>notifyAll</code> has nothing to do with what you do inside that inner go-routine."}, {"owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "edited": false, "score": 0, "creation_date": 1464099624, "post_id": 37410279, "comment_id": 62338583, "body": "I am removing item with mu.Lock(), not just plain removal. Can you tell me how it must be done then?"}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 0, "last_activity_date": 1464342019, "last_edit_date": 1464342019, "creation_date": 1464084018, "answer_id": 37410279, "question_id": 37404025, "link": "https://stackoverflow.com/questions/37404025/should-i-rlock-map-before-range/37410279#37410279", "title": "Should I RLock map before range?", "body": "<p>Short answer: maps are not concurrent-safe (one can still say thread-safe) in Go.</p>\n\n<p>So, if you need to access a map from different go-routines, you must employ some form of access orchestration, otherwise \"uncontrolled map access can crash the program\" (see <a href=\"https://golang.org/doc/faq#atomic_maps\" rel=\"nofollow\">this</a>). </p>\n\n<p><strong>Edit:</strong></p>\n\n<p>This is another implementation (without considering housekeeping concerns - timeouts, quit, log, etc) which ignores the mutex all-together and uses a more Goish approach (this is just for demonstrating this approach which helps us to clear access orchestration concerns - might be right or not for your case):</p>\n\n<pre><code>type Server struct {\n    connections map[*Conn]struct{}\n\n    _removeConn, _addConn chan *Conn\n    _notifyAll            chan *Event\n}\n\nfunc NewServer() *Server {\n    s := new(Server)\n    s.connections = make(map[*Conn]struct{})\n    s._addConn = make(chan *Conn)\n    s._removeConn = make(chan *Conn, 1)\n    s._notifyAll = make(chan *Event)\n    go s.agent()\n    return s\n}\n\nfunc (s *Server) agent() {\n    for {\n        select {\n        case c := &lt;-s._addConn:\n            s.connections[c] = struct{}{}\n        case c := &lt;-s._removeConn:\n            delete(s.connections, c)\n        case e := &lt;-s._notifyAll:\n            for c := range s.connections {\n                closure := c\n                go func() {\n                    err := closure.sendMessage(e)\n                    if err != nil {\n                        s._removeConn &lt;- closure\n                    }\n                }()\n            }\n        }\n    }\n}\n\nfunc (s *Server) removeConn(c *Conn) {\n    s._removeConn &lt;- c\n}\n\nfunc (s *Server) addConn(c *Conn) {\n    s._addConn &lt;- c\n}\n</code></pre>\n\n<p><strong>Edit:</strong></p>\n\n<p>I stand corrected; according to <a href=\"https://twitter.com/dgryski/status/735839074297253889\" rel=\"nofollow\">Damian Gryski</a> maps are safe for concurrent reads. The reason that the map order changes on each iteration is \"the random seed chosen for map iteration order, which is local to the goroutine iterating\" (another <a href=\"https://twitter.com/dgryski/status/735852386414170112\" rel=\"nofollow\">tweet</a> of him). This fact does not affect the first edit and suggested solution.</p>\n"}], "owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1464342019, "creation_date": 1464061483, "last_edit_date": 1464062344, "question_id": 37404025, "link": "https://stackoverflow.com/questions/37404025/should-i-rlock-map-before-range", "title": "Should I RLock map before range?", "body": "<p>Is it safe to range map without locking if multiple goroutines will run notifyAll func? Actually in a range I need to sometimes remove entries from a map.</p>\n\n<pre><code>var mu sync.RWMutex\n\nfunc (self *Server) notifyAll(event *Event)\n  ch := make(chan int, 64)\n  num := 0\n  for k, v := range self.connections {\n    num++\n    ch &lt;- num\n\n    go func(int k, conn *Conn) {\n      err := conn.sendMessage(event)\n      &lt;-ch\n      if err != nil {\n        self.removeConn(k)\n      }\n    }(k, v)\n  }\n}\n\nfunc (self *Server) removeConn(int k) {\n  mu.Lock()\n  defer mu.Unlock()\n  delete(self.connections, k)\n}\n\n// Somewhere in another goroutine\nfunc (self *Server) addConn(conn *Conn, int k) {\n  mu.Lock()\n  defer mu.Unlock()\n  self.connections[k] = conn\n}\n</code></pre>\n\n<p>Or I must RLock map before range?</p>\n\n<pre><code>func (self *Server) notifyAll(event *Event)\n  mu.RLock()\n  defer mu.RUnlock()\n  // Skipped previous body...\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "dns", "network-programming"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1464049859, "post_id": 37402459, "comment_id": 62313475, "body": "<code>bind</code> is a daemon that you&#39;re reconfiguring. Are you trying to write it&#39;s reconfiguration from Go, or are you trying to run a dns server (in which case you need to replace the bind server with your own)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464136176, "post_id": 37402459, "comment_id": 62357078, "body": "Thanks. I want to replace bind server if i can."}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464300250, "post_id": 37402459, "comment_id": 62442115, "body": "does &quot;test.com&quot; comes from 3rd party or is it hardcoded in your app/lib? Do you lookup SRV record directly via net.LookupSRV, or is it called from some library (does it support custom net.Transport or net.Dialer)?"}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 1, "creation_date": 1464303723, "post_id": 37402459, "comment_id": 62443259, "body": "@cvxv31431asdas I have created a bind server. If you need futher help, then comment.  This server works I have tested it."}], "answers": [{"tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": true, "score": 4, "last_activity_date": 1464341893, "last_edit_date": 1464341893, "creation_date": 1464303578, "answer_id": 37472364, "question_id": 37402459, "link": "https://stackoverflow.com/questions/37402459/go-for-dns-srv-bind-programmatically/37472364#37472364", "title": "Go for DNS SRV bind programmatically", "body": "<p>First you need to add your local ip to /etc/resolv.conf</p>\n\n<p>Then you can use following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net\"\n\n    \"github.com/miekg/dns\"\n)\n\nconst (\n    DOM    = \"test.com.\"\n    srvDom = \"_etcd-client._tcp.\"\n)\n\nfunc handleSRV(w dns.ResponseWriter, r *dns.Msg) {\n    var a net.IP\n    m := new(dns.Msg)\n    m.SetReply(r)\n    if ip, ok := w.RemoteAddr().(*net.UDPAddr); ok {\n        a = ip.IP\n    }\n    if ip, ok := w.RemoteAddr().(*net.TCPAddr); ok {\n        a = ip.IP\n    }\n\n    // Add in case you are using IPv6 alongwith AAAA\n    /*if a.To4() !=nil {\n        a = a.To4()\n        }\n    */\n    // Checking which type of query has come\n    switch r.Question[0].Qtype {\n    default:\n        fallthrough\n    case dns.TypeA:\n        rr := new(dns.A)\n        rr.Hdr = dns.RR_Header{Name: DOM, Rrtype: dns.TypeA, Class: dns.ClassINET, Ttl: 0}\n        rr.A = a.To4()\n        m.Answer = append(m.Answer, rr)\n    case dns.TypeSRV:\n        rr := new(dns.SRV)\n        rr.Hdr = dns.RR_Header{Name: srvDom, Rrtype: dns.TypeSRV, Class: dns.ClassINET, Ttl: 0}\n        rr.Priority = 0\n        rr.Weight = 0\n        rr.Port = 5000\n        rr.Target = DOM\n        m.Answer = append(m.Answer, rr)\n    }\n    w.WriteMsg(m)\n}\n\nfunc serve(net string) {\n    server := &amp;dns.Server{Addr: \":53\", Net: net, TsigSecret: nil}\n    err := server.ListenAndServe()\n    if err != nil {\n        log.Fatal(\"Server can't be started\")\n    }\n}\n\nfunc main() {\n    dns.HandleFunc(DOM, handleSRV)\n    dns.HandleFunc(srvDom, handleSRV)\n    go serve(\"tcp\")\n    go serve(\"udp\")\n    for {\n    }\n}\n</code></pre>\n\n<p>You can check that this bind server gives correct answer for dig</p>\n\n<pre><code>dig @\"127.0.0.1\"  _etcd-client._tcp. SRV\n</code></pre>\n\n<p>I have assumed that you are using IPv4 address (It's addition of about only ten lines but I wanted code to be succinct without handling IPv6).</p>\n\n<p>You can change DOM and SRV pattern that I have taken as const. </p>\n\n<p>You can integrate this as library which start the dns server when you do test. I am using port 53 for which you need to be root user. You can change it to something else. And when tests are run, you can get it from some different port.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4211028"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1009, "favorite_count": 2, "accepted_answer_id": 37472364, "answer_count": 1, "score": 5, "last_activity_date": 1464341893, "creation_date": 1464048407, "question_id": 37402459, "link": "https://stackoverflow.com/questions/37402459/go-for-dns-srv-bind-programmatically", "title": "Go for DNS SRV bind programmatically", "body": "<p>Could anybody know how to set up SRV record locally in Go?</p>\n\n<p>It's for testing purposes. For example, I want to bind <code>test.com</code> to <code>localhost</code> just during the tests. Currently, I have to edit host <code>/etc/bind/test.com.hosts</code></p>\n\n<pre><code>test.com.   IN  SOA bindhostname. admin.test.com. (\n1452607488\n10800\n3600\n604800\n38400 )\ntest.com.   IN  NS  bindhostname.\nmy1.test.com.   300 IN  A   127.0.0.1\n_etcd-client._tcp   300 IN  SRV 0 0 5000 my1.test.com.\n</code></pre>\n\n<p>I looked at <a href=\"https://github.com/miekg/dns\" rel=\"noreferrer\">https://github.com/miekg/dns</a> but can't figure out where to start. Could anybody help?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["http", "go", "oauth", "concurrency"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1464053098, "post_id": 37402400, "comment_id": 62314216, "body": "<code>lookup example.com: no such host</code> means &#39;DNS&#39; error , I think."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464054539, "post_id": 37402400, "comment_id": 62314547, "body": "RoundTripper is the interface, you need to change settings on the implementation. If you are providing an <code>*http.Transport</code>, it <i>is</i> an <code>http.RoundTripper</code>."}, {"owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464059518, "post_id": 37402400, "comment_id": 62315672, "body": "@JimB Any hint on how to do that? More info here <a href=\"https://play.golang.org/p/w42d303Qqk\" rel=\"nofollow noreferrer\">play.golang.org/p/w42d303Qqk</a>"}], "owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 407, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1464047999, "creation_date": 1464047999, "question_id": 37402400, "link": "https://stackoverflow.com/questions/37402400/optimizing-get-requests-changing-roundtripper-with-transport-go", "title": "Optimizing Get Requests - Changing RoundTripper with Transport go", "body": "<p>I reach a limit in the number of requests I can get using the default httpClient that my API wrapper provides.</p>\n\n<pre><code>//I was getting something like this at the beginning\nHead www.example.com:80/: lookup example.com: no such host\n</code></pre>\n\n<p>To solve this I want to change the MaxIdleConnsPerHost setting for the httpClient.Transport of my client. It looks much more like this:\n    However, the Transport my client uses is a RoundTripper and subsequently, it doesn't have a MaxIdleConnsPerHost param.</p>\n\n<pre><code>&amp;oauth2.Transport{Source:(*oauth2.reuseTokenSource)(0xc2082ac0c0), \n              Base:http.RoundTripper(nil), \n              mu:sync.Mutex{state:0, sema:0x0}, \n              modReq:map[*http.Request]*http.Request(nil)\n              }\n</code></pre>\n\n<p>The one I'm providing is mostly a default one and it lacks the proper configuration I suppose or simple what I want to do is not feasible.</p>\n\n<pre><code>&amp;http.Transport{idleMu:sync.Mutex{state:0, sema:0x0}, \n                         idleConn:map[http.connectMethodKey][]*http.persistConn(nil), \n                         idleConnCh:map[http.connectMethodKey]chan *http.persistConn(nil), \n                         reqMu:sync.Mutex{state:0, sema:0x0}, \n                         reqCanceler:map[*http.Request]func()(nil), \n                         altMu:sync.RWMutex{w:sync.Mutex{state:0, sema:0x0}, \n                         writerSem:0x0, \n                         readerSem:0x0, \n                         readerCount:0, \n                         readerWait:0}, \n                         altProto:map[string]http.RoundTripper(nil), \n                         Proxy:(func(*http.Request) (*url.URL, error))(nil), \n                         Dial:(func(string, string) (net.Conn, error))(nil), \n                         TLSClientConfig:(*tls.Config)(nil), \n                         TLSHandshakeTimeout:0, \n                         DisableKeepAlives:false, \n                         DisableCompression:false, \n                         MaxIdleConnsPerHost:200, \n                         ResponseHeaderTimeout:0}\n</code></pre>\n\n<p>Can someone guide me on the right direction?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 2941675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dMuaY.jpg?s=128&g=1", "display_name": "cmiller01", "link": "https://stackoverflow.com/users/2941675/cmiller01"}, "is_accepted": false, "score": 1, "last_activity_date": 1466549869, "creation_date": 1466549869, "answer_id": 37955912, "question_id": 37401664, "link": "https://stackoverflow.com/questions/37401664/golang-undefined-google-jwtaccesstokensourcefromjson-after-installing-appengine/37955912#37955912", "title": "Golang Undefined google.JWTAccessTokenSourceFromJSON after installing appengine sdk", "body": "<p>I ran into this problem as well. I think the <code>go get</code> functionality pulled an outdated repo when updating the Google app engine packages.</p>\n\n<p>This worked for me:</p>\n\n<pre><code>cd $GOPATH/src/golang.org/x/oauth2/google\ngit fetch \ngit pull\n</code></pre>\n\n<p>Turns out I was 66 commits behind master; this fixed it for me. Hope it works for you.</p>\n"}], "owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 332, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1466549869, "creation_date": 1464043087, "question_id": 37401664, "link": "https://stackoverflow.com/questions/37401664/golang-undefined-google-jwtaccesstokensourcefromjson-after-installing-appengine", "title": "Golang Undefined google.JWTAccessTokenSourceFromJSON after installing appengine sdk", "body": "<p>I installed the Go app engine packages this evening. This seems to have broken my whole Go installation. </p>\n\n<p>Each time I attempt to run any go command, it fails with:</p>\n\n<pre><code>../../../google.golang.org/grpc/credentials/oauth/oauth.go:85: undefined: google.JWTAccessTokenSourceFromJSON\n</code></pre>\n\n<p>Erm...</p>\n\n<p>I tried nuking the google.golang.org directory without success. When I run go get -x ./... I get the following:</p>\n\n<pre><code>WORK=/var/folders/94/4lkprvq57vj4svwmt_kz5h6m0000gn/T/go-build842729114\nmkdir -p $WORK/google.golang.org/grpc/credentials/oauth/_obj/\nmkdir -p $WORK/google.golang.org/grpc/credentials/\ncd /Users/simon/Documents/Code/golang/src/google.golang.org/grpc/credentials/oauth\n/usr/local/Cellar/go/1.6.2/libexec/pkg/tool/darwin_amd64/compile -o $WORK/google.golang.org/grpc/credentials/oauth.a -trimpath $WORK -p google.golang.org/grpc/credentials/oauth -complete -buildid 8d03dba436005dd3d1e75147bde330259f288075 -D _/Users/simon/Documents/Code/golang/src/google.golang.org/grpc/credentials/oauth -I $WORK -I /Users/simon/Documents/Code/golang/pkg/darwin_amd64 -pack ./oauth.go\n# google.golang.org/grpc/credentials/oauth\n../../../google.golang.org/grpc/credentials/oauth/oauth.go:85: undefined: google.JWTAccessTokenSourceFromJSON\n</code></pre>\n\n<p>Help needed fixing before all sanity gone.</p>\n"}, {"tags": ["go", "yaml", "viper-go"], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 1, "last_activity_date": 1464130614, "creation_date": 1464130614, "answer_id": 37425224, "question_id": 37400832, "link": "https://stackoverflow.com/questions/37400832/viper-yaml-config-sequence/37425224#37425224", "title": "viper yaml config sequence", "body": "<p>If you look closely at the different <code>Get</code> methods available, you'll see that the return types are <code>string</code>, <code>[]string</code>, <code>map[string]interface{}</code>, <code>map[string]string</code> and <code>map[string][]string</code>.</p>\n\n<p>However, the type of the value associated with \"issue-types\" is <code>[]map[string]string</code>. So, the only way to get this data is through the <code>Get</code> method and using type assertions.</p>\n\n<p>Now, the following code produces the appropriate type of <code>issue_types</code>, which is <code>[]map[string]string</code>.</p>\n\n<pre><code>issues_types := make([]map[string]string, 0)\nvar m map[string]string\n\nissues_i := viper.Get(\"issue-types\")\n// issues_i is interface{}\n\nissues_s := issues_i.([]interface{})\n// issues_s is []interface{}\n\nfor _, issue := range issues_s {\n    // issue is an interface{}\n\n    issue_map := issue.(map[interface{}]interface{})\n    // issue_map is a map[interface{}]interface{}\n\n    m = make(map[string]string)\n    for k, v := range issue_map {\n        m[k.(string)] = v.(string)\n    }\n    issues_types = append(issues_types, m)\n}\n\nfmt.Println(reflect.TypeOf(issues_types))\n# []map[string]string\n\nfmt.Println(issues_types)\n# [map[source-type:Incident remote-type:Task]\n#  map[source-type:Service Request remote-type:Task]\n#  map[source-type:Change remote-type:Story]\n#  map[source-type:Problem remote-type:Task]]\n</code></pre>\n\n<p>Note that I did not do any safety check in order to make the code smaller.  However, the correct way of doing type assertion is:</p>\n\n<pre><code>var i interface{} = \"42\"\nstr, ok := i.(string)\nif !ok {\n    // A problem occurred, do something\n}\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 5516510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb2b4a075d1411485ea7a12ede6542b4?s=128&d=identicon&r=PG&f=1", "display_name": "trorbyte", "link": "https://stackoverflow.com/users/5516510/trorbyte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2744, "favorite_count": 0, "accepted_answer_id": 37425224, "answer_count": 1, "score": 0, "last_activity_date": 1464130614, "creation_date": 1464038754, "question_id": 37400832, "link": "https://stackoverflow.com/questions/37400832/viper-yaml-config-sequence", "title": "viper yaml config sequence", "body": "<p>I'm trying to read a yaml config file using viper (<a href=\"https://godoc.org/github.com/spf13/viper\" rel=\"nofollow\">see viper docs</a>). But I cannot see a way to read the sequence of map values under issue-types. I've tried the various Get_ methods\nbut none seem to support this.</p>\n\n<pre><code>remote:\n  host: http://localhost/\n  user: admin\n  password:  changeit\n\nmapping:\n    source-project-key: IT\n    remote-project-key: SCRUM\n\nissue-types:\n  - source-type: Incident\n    remote-type: Task\n  - source-type: Service Request\n    remote-type: Task\n  - source-type: Change\n    remote-type: Story\n  - source-type: Problem\n    remote-type: Task\n</code></pre>\n\n<p>I'd like to be able to iterate over the sequence of map[strings] </p>\n"}, {"tags": ["gcc", "go", "sqlite", "compilation", "clang"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464035087, "post_id": 37399813, "comment_id": 62308369, "body": "go-sqlite2 uses cgo, so it&#39;s dependent on the C compiler and shared libraries. Can you build the package on a 10.7 machine? (10.6 isn&#39;t really supported) What you often need to do is build on the minimum supported version you want to target."}, {"owner": {"reputation": 437, "user_id": 1922771, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/UTA6Q.jpg?s=128&g=1", "display_name": "Javier Carmona", "link": "https://stackoverflow.com/users/1922771/javier-carmona"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464035375, "post_id": 37399813, "comment_id": 62308526, "body": "Is there a way of passing some kind of flag specifying 10.7 as a minimum version that I do not need to build it from a 10.7 machine?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464035961, "post_id": 37399813, "comment_id": 62308871, "body": "Looks like it can be done in clang. Try setting <code>CGO_CFLAGS=&quot;-mmacosx-version-min=10.6&quot;</code> to pass the option to clang when building the package."}, {"owner": {"reputation": 437, "user_id": 1922771, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/UTA6Q.jpg?s=128&g=1", "display_name": "Javier Carmona", "link": "https://stackoverflow.com/users/1922771/javier-carmona"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464039432, "post_id": 37399813, "comment_id": 62310589, "body": "No success with CGO_CFLAGS=&quot;-mmacosx-version-min=10.6&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464050166, "post_id": 37399813, "comment_id": 62313545, "body": "The option does at least produce a different binary on my system, but I don&#39;t have an old osx to test on. Can you run with the <code>-x</code> flag and make sure clang is being invoked correctly?"}, {"owner": {"reputation": 437, "user_id": 1922771, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/UTA6Q.jpg?s=128&g=1", "display_name": "Javier Carmona", "link": "https://stackoverflow.com/users/1922771/javier-carmona"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464053548, "post_id": 37399813, "comment_id": 62314309, "body": "I am not sure what I should be looking for... I am editing the question with something I found regarding slite3"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464053914, "post_id": 37399813, "comment_id": 62314405, "body": "did you set the <code>CGO_CFLAGS</code> env variable? because it&#39;s not reflected in the clang calls. (it might be easier to just install the sqlite3 package by itself first to get less output)"}, {"owner": {"reputation": 437, "user_id": 1922771, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/UTA6Q.jpg?s=128&g=1", "display_name": "Javier Carmona", "link": "https://stackoverflow.com/users/1922771/javier-carmona"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464054672, "post_id": 37399813, "comment_id": 62314581, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/112731/discussion-between-javier-carmona-and-jimb\">continue this discussion in chat</a>."}], "owner": {"reputation": 437, "user_id": 1922771, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/UTA6Q.jpg?s=128&g=1", "display_name": "Javier Carmona", "link": "https://stackoverflow.com/users/1922771/javier-carmona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1464054655, "creation_date": 1464034776, "last_edit_date": 1464054655, "question_id": 37399813, "link": "https://stackoverflow.com/questions/37399813/why-is-go-build-executable-not-working-on-osx-10-7-or-below-with-third-party-lib", "title": "Why is Go build executable not working on osx 10.7 or below with third party libraries?", "body": "<p>I have a web application that uses the library </p>\n\n<p><code>github.com/mattn/go-sqlite3</code> </p>\n\n<p>and I build using the command </p>\n\n<p><code>env GOOS=darwin GOARCH=amd64 go build -ldflags \"-s\" $GOPATHsrc/github.com/user/example/main.go</code> </p>\n\n<p>I am building it in OSX El Capitan 10.11.5.\nWhen I run the executable on osx 10.8 and above it works correctly but fails on 10.7 and below with the error message \"Illegal Instruction\". If I remove the go-sqlite3 library it works correctly on 10.6 and 10.7.</p>\n\n<p>Any help on what is going on here and how to fix this for 10.6 and 10.7?</p>\n\n<p>I found this regarding sqlite3 using the -x option when compiling <code>env CGO_CFLAGS=\"-mmacosx-version-min=10.6\" GOOS=darwin GOARCH=amd64 go build -x -ldflags \"-s\" $GOPATHsrc/github.com/user/example/main.go</code>:</p>\n\n<pre><code>clang -I . -fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common -o $WORK/github.com/mattn/go-sqlite3/_obj/_cgo_.o $WORK/github.com/mattn/go-sqlite3/_obj/_cgo_main.o $WORK/github.com/mattn/go-sqlite3/_obj/_cgo_export.o $WORK/github.com/mattn/go-sqlite3/_obj/backup.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/callback.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/error.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3_load_extension.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3_other.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3-binding.o -g -O2\n/usr/local/Cellar/go/1.6.2/libexec/pkg/tool/darwin_amd64/cgo -objdir $WORK/github.com/mattn/go-sqlite3/_obj/ -dynpackage sqlite3 -dynimport $WORK/github.com/mattn/go-sqlite3/_obj/_cgo_.o -dynout $WORK/github.com/mattn/go-sqlite3/_obj/_cgo_import.go\nclang -I . -fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common -o $WORK/github.com/mattn/go-sqlite3/_obj/_all.o $WORK/github.com/mattn/go-sqlite3/_obj/_cgo_export.o $WORK/github.com/mattn/go-sqlite3/_obj/backup.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/callback.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/error.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3_load_extension.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3_other.cgo2.o $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3-binding.o -g -O2 -Wl,-r -nostdlib\n/usr/local/Cellar/go/1.6.2/libexec/pkg/tool/darwin_amd64/compile -o $WORK/github.com/mattn/go-sqlite3.a -trimpath $WORK -p github.com/mattn/go-sqlite3 -buildid 32b9303c80e2bd23ae9dab9f38370b654df12034 -D _/Users/javier/projects/go/src/github.com/mattn/go-sqlite3 -I $WORK -pack ./doc.go $WORK/github.com/mattn/go-sqlite3/_obj/_cgo_gotypes.go $WORK/github.com/mattn/go-sqlite3/_obj/backup.cgo1.go $WORK/github.com/mattn/go-sqlite3/_obj/callback.cgo1.go $WORK/github.com/mattn/go-sqlite3/_obj/error.cgo1.go $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3.cgo1.go $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3_load_extension.cgo1.go $WORK/github.com/mattn/go-sqlite3/_obj/sqlite3_other.cgo1.go $WORK/github.com/mattn/go-sqlite3/_obj/_cgo_import.go\npack r $WORK/github.com/mattn/go-sqlite3.a $WORK/github.com/mattn/go-sqlite3/_obj/_all.o # internal\n</code></pre>\n"}, {"tags": ["go", "dns", "upgrade"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464029848, "post_id": 37398412, "comment_id": 62305514, "body": "Please try to the current version of Go first in case this is a bug that&#39;s been fixed."}, {"owner": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464030792, "post_id": 37398412, "comment_id": 62306070, "body": "I did. It did not get fixed in the go1.6.2 version."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464031535, "post_id": 37398412, "comment_id": 62306433, "body": "FYI, you can force either resolver with the <code>GODEBUG=netdns=</code> setting without rebuilding (might need go1.6, I would avoid go1.5 by now anyway). It might be useful to force the Go resolver and get debug output with <code>GODEBUG=netdns=go+1</code> to see where it&#39;s timing out exactly."}, {"owner": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464032145, "post_id": 37398412, "comment_id": 62306740, "body": "I used that too, but it did not seem very useful. It just gives the strategy is that it is picking. I instrumented all the paths in go and recompiled to trace this api flow and figured that it times on this line. <a href=\"https://github.com/golang/go/blob/release-branch.go1.5/src/net/dnsclient_unix.go#L44\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/release-branch.go1.5/src/net/&hellip;</a>  Nothing changed in regard to this in 1.6"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464033070, "post_id": 37398412, "comment_id": 62307247, "body": "What is your system resolver doing differently when the DNS server times out? Was it racing resolution from multiple servers? Does it have a local cache so there were just fewer timeouts?"}], "owner": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 270, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1464030737, "creation_date": 1464029461, "last_edit_date": 1464030737, "question_id": 37398412, "link": "https://stackoverflow.com/questions/37398412/dns-resolution-timeouts-after-upgrade-to-go1-5", "title": "DNS resolution timeouts after upgrade to go1.5", "body": "<p>After upgrading from go1.3 to go1.5.2, I have been experiencing DNS request timeouts in my connections which go through ResolveTCPAddr() API in net library. I dug a little deeper to see what's going wrong in go1.5 because there's was a mention of DNS resolution implementation change in release notes of go1.5.</p>\n\n<p><a href=\"https://golang.org/doc/go1.5#net\" rel=\"nofollow\">https://golang.org/doc/go1.5#net</a></p>\n\n<p>\nIn go1.5, for DNS resolution of unknown address, there's first a UDP dial and then a TCP dial to make the DNS request.</p>\n\n<p><a href=\"https://github.com/golang/go/blob/release-branch.go1.5/src/net/dnsclient_unix.go#L134\" rel=\"nofollow\">https://github.com/golang/go/blob/release-branch.go1.5/src/net/dnsclient_unix.go#L134</a></p>\n\n<p>\nSometimes, the read on UDP conn for a dns request is timing out (which could be for whatever reason being UDP) and my connection establishment is terribly slowing down (1ms becomes 5sec sometimes) randomly.\n</p>\n\n<p>\nThis made me force --netcgo flag at compile time to revert to old behavior mentioned in the release notes. But I want to resolve this without have to force anything that's not default.\n</p>\n\n<p>\nIs this a known issue? Did anybody else run into this? I also want to understand why its making a udp connection first and what it did earlier and what changed for this to act differently now.\n</p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 97819, "user_id": 131874, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b3600796ab1d9e78c7545c91468c2e51?s=128&d=identicon&r=PG", "display_name": "Clodoaldo Neto", "link": "https://stackoverflow.com/users/131874/clodoaldo-neto"}, "edited": false, "score": 0, "creation_date": 1464025469, "post_id": 37397161, "comment_id": 62303208, "body": "It is not a type problem. The problem is that the placeholder is not being replaced or the <code>id</code> variable value is <code>? </code>"}, {"owner": {"reputation": 1106495, "user_id": 1144035, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e514b017977ebf742a418cac697d8996?s=128&d=identicon&r=PG", "display_name": "Gordon Linoff", "link": "https://stackoverflow.com/users/1144035/gordon-linoff"}, "edited": false, "score": 0, "creation_date": 1464025698, "post_id": 37397161, "comment_id": 62303347, "body": "Could the problem be the semicolon?"}, {"owner": {"reputation": 518, "user_id": 5813225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4f05e2c4ff75c55a8f233f80050ebf1a?s=128&d=identicon&r=PG&f=1", "display_name": "cfatt10", "link": "https://stackoverflow.com/users/5813225/cfatt10"}, "reply_to_user": {"reputation": 97819, "user_id": 131874, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b3600796ab1d9e78c7545c91468c2e51?s=128&d=identicon&r=PG", "display_name": "Clodoaldo Neto", "link": "https://stackoverflow.com/users/131874/clodoaldo-neto"}, "edited": false, "score": 0, "creation_date": 1464025745, "post_id": 37397161, "comment_id": 62303373, "body": "@ClodoaldoNeto What do you mean by the <code>id</code> variable value is <code>?</code>? Like Postgres doesn&#39;t know which <code>id</code> it&#39;s looking at?"}, {"owner": {"reputation": 97819, "user_id": 131874, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b3600796ab1d9e78c7545c91468c2e51?s=128&d=identicon&r=PG", "display_name": "Clodoaldo Neto", "link": "https://stackoverflow.com/users/131874/clodoaldo-neto"}, "edited": false, "score": 0, "creation_date": 1464026282, "post_id": 37397161, "comment_id": 62303642, "body": "I mean somehow the <code>id</code> variable has been set to <code>?</code>. Check the <code>db.Exec</code> syntax"}], "answers": [{"comments": [{"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 3, "creation_date": 1464031995, "post_id": 37397859, "comment_id": 62306665, "body": "Note that the comment from the manual refers to statement inside a procedural language e.g PL/pgSQL. The placeholder handling from a &quot;client&quot; language is handled by language&#39;s driver. In JDBC the placehoder <i>is</i> <code>?</code> and <code>$1</code> wouldn&#39;t work there. So in this case apparently the driver for Go uses the same syntax as the backend. But the quote from the manual doesn&#39;t really refer to prepared statements from an application language"}, {"owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "reply_to_user": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1464032233, "post_id": 37397859, "comment_id": 62306781, "body": "@a_horse_with_no_name Thats a good point. I was assuming the OP was using pq which mimics postgres&#39;s <code>$1</code> syntax."}, {"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 0, "creation_date": 1464047202, "post_id": 37397859, "comment_id": 62312878, "body": "@poopoothegorilla another small point: you need a comma after <code>id</code> :)"}], "tags": [], "owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "is_accepted": true, "score": 4, "last_activity_date": 1464032486, "last_edit_date": 1464032486, "creation_date": 1464027431, "answer_id": 37397859, "question_id": 37397161, "link": "https://stackoverflow.com/questions/37397161/comparing-field-to-placeholder-postgresql/37397859#37397859", "title": "Comparing field to placeholder - PostgreSQL", "body": "<p>Postgres uses <code>$#</code> for placeholders <a href=\"http://www.postgresql.org/docs/9.1/static/sql-prepare.html\" rel=\"nofollow\">postgres docs</a></p>\n\n<blockquote>\n  <p>When creating the prepared statement, refer to parameters by position, using $1, $2, etc. A corresponding list of parameter data types can optionally be specified. When a parameter's data type is not specified or is declared as unknown, the type is inferred from the context in which the parameter is used (if possible). When executing the statement, specify the actual values for these parameters in the EXECUTE statement. Refer to EXECUTE for more information about that.</p>\n</blockquote>\n\n<p>so try</p>\n\n<pre><code>result, err := db.Exec(`\n    UPDATE tags\n    SET association_count = association_count - 1\n    WHERE id=$1;`, id\n)\n</code></pre>\n\n<p>Here is what <a href=\"https://golang.org/pkg/database/sql/#Result\" rel=\"nofollow\">result</a> looks like</p>\n\n<p><strong>UPDATE:</strong>\n<em>a_horse_with_no_name</em> makes a good point.\nThis depends on what client library you are using. I assumed it was <strong>pq</strong> since that is popular for postgres in golang. </p>\n"}], "owner": {"reputation": 518, "user_id": 5813225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4f05e2c4ff75c55a8f233f80050ebf1a?s=128&d=identicon&r=PG&f=1", "display_name": "cfatt10", "link": "https://stackoverflow.com/users/5813225/cfatt10"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4167, "favorite_count": 0, "accepted_answer_id": 37397859, "answer_count": 1, "score": 1, "last_activity_date": 1464032486, "creation_date": 1464024781, "question_id": 37397161, "link": "https://stackoverflow.com/questions/37397161/comparing-field-to-placeholder-postgresql", "title": "Comparing field to placeholder - PostgreSQL", "body": "<p>I am using Go to execute a query on a PostgreSQL DB. Note that in the DB <code>id</code> is type <code>bigint</code>.</p>\n\n<pre><code>db.Exec(\"UPDATE tags SET association_count = association_count - 1 WHERE id=?;\", id)\n</code></pre>\n\n<p>When I run this code, I get a SQL error</p>\n\n<pre><code>operator does not exist: bigint =?\n</code></pre>\n\n<p>From what I can tell this is caused by a typing mismatch between the <code>id</code> and the <code>?</code>. I've tried casting with <code>::</code> but it throws an error, and haven't found anything about this. Interestingly, if there is a space, like <code>id = ?</code> it throws a general syntax error. Any idea how to cast or work around this?</p>\n"}, {"tags": ["multithreading", "go", "block", "condition-variable"], "comments": [{"owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "edited": false, "score": 6, "creation_date": 1464021687, "post_id": 37396207, "comment_id": 62301201, "body": "Can you share some code so we have a better idea of what you intend to do?"}, {"owner": {"reputation": 11, "user_id": 6372301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fd3e79819fed5916979a067545803b?s=128&d=identicon&r=PG&f=1", "display_name": "Yue", "link": "https://stackoverflow.com/users/6372301/yue"}, "reply_to_user": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "edited": false, "score": 0, "creation_date": 1464152838, "post_id": 37396207, "comment_id": 62360967, "body": "Thank you for your help. I have updated the question."}], "answers": [{"tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": false, "score": 0, "last_activity_date": 1465427136, "creation_date": 1465427136, "answer_id": 37714374, "question_id": 37396207, "link": "https://stackoverflow.com/questions/37396207/block-go-routine-in-a-shared-library/37714374#37714374", "title": "Block Go routine in a shared library", "body": "<p>I think your problem boils down to <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow\"><code>cgo</code></a> and the condition variable is just obscuring things. As a tiny demonstration of what you can do, consider a go program and a library built from a C++ file.</p>\n\n<pre><code>package main\n\n// #cgo LDFLAGS: func.so\n// void someFunc();\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    fmt.Printf(\"Before C stuff.\\n\")\n\n    t0 := time.Now()\n    C.someFunc()\n    fmt.Printf(\"%v\\n\", time.Now().Sub(t0))\n}\n</code></pre>\n\n<p>And now the C++ file:</p>\n\n<pre><code>#include &lt;iostream&gt;\n#include &lt;unistd.h&gt;\n\nextern \"C\" {\n    void someFunc();\n}    \nvoid someFunc() {\n    sleep(10);\n    std::cout &lt;&lt; \"And print something\\n\";\n}\n</code></pre>\n\n<p>Build it and run it like this: </p>\n\n<pre><code>% g++ -Wall -Wextra -o func.o -c func.cc -fPIC\n% gcc -Wall -Wextra -o func.so -shared func.o\n% go build\n% LD_LIBRARY_PATH=. ./cgofun\nBefore C stuff.                                  \nAnd print something\n10.000273351s\n</code></pre>\n\n<p>Using the same technique you should be able to call a function that blocks on a condition variable. The go runtime won't care and will keep the calling goroutine blocked for as long as necessary.</p>\n"}], "owner": {"reputation": 11, "user_id": 6372301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04fd3e79819fed5916979a067545803b?s=128&d=identicon&r=PG&f=1", "display_name": "Yue", "link": "https://stackoverflow.com/users/6372301/yue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 302, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1465427136, "creation_date": 1464021402, "last_edit_date": 1464152820, "question_id": 37396207, "link": "https://stackoverflow.com/questions/37396207/block-go-routine-in-a-shared-library", "title": "Block Go routine in a shared library", "body": "<p>I have shared library which provides a function that will go to waiting state during processing.  The waiting is achieved by the condition variable provided by c++. Any one knows how to call this function correctly from Go?</p>\n\n<p>C++ functions:</p>\n\n<p>I have a queue to store all the tasks to be processed. </p>\n\n<pre><code>queue&lt;Task&gt; tasks;\nMutex mutex;\ncondition_variable cv;\n\nvoid process(string img_path) {\n    std::unique_lock&lt;Mutex&gt; lock(mutex);\n    Task task(img_path);\n    tasks.push_back(task);\n    cv.wait(); //wait the task to be processed, because i have to process the tasks in a batch way using GPU\n}\n</code></pre>\n\n<p>The above code is just used to illustrate the key component which is the blocking wait function of condition variable.  It will be compiled into a dynamic library.   If called from Python, I found a solution illustrated in <a href=\"https://docs.python.org/2.7/c-api/init.html#thread-state-and-the-global-interpreter-lock\" rel=\"nofollow\">here</a>. Any one knows how to call from Golang?</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 3, "creation_date": 1464013356, "post_id": 37392724, "comment_id": 62295999, "body": "A package that makes it easy to pass request-scoped values, cancelation signals, and deadlines across API boundaries to all the goroutines involved in handling a request. See the full article at: <a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">blog.golang.org/context</a>"}], "answers": [{"tags": [], "owner": {"reputation": 978, "user_id": 5843918, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ef4d8b41449d85eef88b08fdf9b05f?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/5843918/sean"}, "is_accepted": true, "score": 3, "last_activity_date": 1464021621, "last_edit_date": 1491982277, "creation_date": 1464021621, "answer_id": 37396285, "question_id": 37392724, "link": "https://stackoverflow.com/questions/37392724/can-you-explain-what-the-app-engine-context-interface-is/37396285#37396285", "title": "Can you explain what the app engine context interface is?", "body": "<p>Context in the paradigm of programming extends beyond just Go.  You should take a look at this thread for a deeper explanation <a href=\"https://softwareengineering.stackexchange.com/questions/196475/whats-the-meaning-of-term-context-in-programming\">The term \u201cContext\u201d in programming?</a>.  In terms of App Engine it usually shares information about the request being made i.e. Initiating Server, Client IP, Errors, Timeouts, Is it in the background?, etc.  You can take a look at the <a href=\"https://godoc.org/golang.org/x/net/context\" rel=\"nofollow noreferrer\">x/net/context</a> package for some ideas of how Context can be used.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 1, "accepted_answer_id": 37396285, "answer_count": 1, "score": 2, "last_activity_date": 1464021621, "creation_date": 1464011140, "question_id": 37392724, "link": "https://stackoverflow.com/questions/37392724/can-you-explain-what-the-app-engine-context-interface-is", "title": "Can you explain what the app engine context interface is?", "body": "<p>I am contributing to a Go application where the appengine context interface is used a lot. I have come across a lot of documentation where the context is used as a variable. But I haven't yet found an explanation that I understand of exactly what the context is and what purpose it fills.</p>\n\n<p>What is the go appengine context interface and what is its purpose?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 5, "creation_date": 1464007276, "post_id": 37391009, "comment_id": 62291824, "body": "No. Go routines and threads are quite different things and concurrent access means you cannot guarantee the order of execution; locks and/or channels are still required."}], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 5, "last_activity_date": 1464013288, "last_edit_date": 1464013288, "creation_date": 1464009326, "answer_id": 37392030, "question_id": 37391009, "link": "https://stackoverflow.com/questions/37391009/is-lock-necessary-when-gomaxprocs-is-1/37392030#37392030", "title": "Is lock necessary when GOMAXPROCS is 1", "body": "<p>Yes, locks are still needed, even if you are running your program on one processor. Concurrency and Parallelism are different things, you'll find a very good explanation <a href=\"https://www.goinggo.net/2014/01/concurrency-goroutines-and-gomaxprocs.html\" rel=\"nofollow\">here</a>.</p>\n\n<p>Just a little example here:</p>\n\n<pre><code>func main() {\n    runtime.GOMAXPROCS(1)\n\n    t := &amp;test{}\n\n    go func() {\n        for i := 0; i &lt; 100; i++ {\n            // Some computation prior to using t.Num\n            time.Sleep(300 * time.Microsecond)\n            num := t.Num\n            // Some computation using num\n            time.Sleep(300 * time.Microsecond)\n            t.Num = num + 1\n        }\n    }()\n\n    go func() {\n        for i := 0; i &lt; 100; i++ {\n            num := t.Num\n            // Some computation using num\n            time.Sleep(300 * time.Microsecond)\n            t.Num = num + 1\n        }\n    }()\n\n    time.Sleep(1 * time.Second) // Wait goroutines to finish\n\n    fmt.Println(t.Num)\n\n}\n</code></pre>\n\n<p>The sleeping time is there to represent some computation which takes some time. I wanted to keep the example runnable and simple, that's why I used it.</p>\n\n<p>When running this, even on a single processor, the output is not 200 as we want to. So yes, locks are necessary when accessing variables concurrently, or you'll run into problems.</p>\n"}, {"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": true, "score": 6, "last_activity_date": 1464012643, "last_edit_date": 1464012643, "creation_date": 1464009412, "answer_id": 37392073, "question_id": 37391009, "link": "https://stackoverflow.com/questions/37391009/is-lock-necessary-when-gomaxprocs-is-1/37392073#37392073", "title": "Is lock necessary when GOMAXPROCS is 1", "body": "<p>The short answer is, \"no\" it is not safe. The long answer is really too long to explain in enough detail here, but I'll give a short summary and some links to articles which should help you put the pieces together.</p>\n\n<p>Let's differentiate between \"concurrent\" and \"parallel\" first. Consider two functions. Running in parallel they can both be executing at the same instant on separate processors. Running concurrently either, or both, or neither <em>may</em> be executing but both are <em>able</em> to execute. If they are concurrent but not parallel then they are switching\u2014and without channels or locks we cannot guarantee the sequence in terms of which gets where first.</p>\n\n<p>It may be weird to think about \"concurrent but not parallel\" but consider that the opposite is quite unremarkable, parallel but not concurrent; my text editor, terminal and browser are all running in parallel but are most definitely not concurrent.</p>\n\n<p>So if two (or 20,000) functions have access to the same memory, say one writes and one reads, and they are running concurrently, then perhaps the write happens first, perhaps the read happens first. There are no guarantees unless we take responsibility for the scheduling/sequencing, hence locks and channels.</p>\n\n<p>Setting GOMAXSPROCS to greater than 1 makes it possible for a concurrent program to run in parallel, but it may not, all <em>concurrent</em> goroutines may be on one CPU thread, or they may be on multiple. Thus setting GOMAXPROCS to 1 is no guarantee that concurrent processes are safe without locks or channels to orchestrate their execution. </p>\n\n<p>Threads are [typically] scheduled by the operating system. See <a href=\"https://en.wikipedia.org/wiki/Thread_%28computing%29\" rel=\"nofollow\">Wikipedia</a> or your favorite repository of human knowledge. Goroutines are scheduled by Go.</p>\n\n<p>Next consider this:</p>\n\n<blockquote>\n  <p>Even with [a] single logical processor and operating system thread, hundreds of thousands of goroutines can be scheduled to run concurrently with amazing efficiency and performance.</p>\n</blockquote>\n\n<p>and this:</p>\n\n<blockquote>\n  <p>The problem with building concurrency into our applications is eventually our goroutines are going to attempt to access the same resources, possibly at the same time. Read and write operations against a shared resource must always be atomic. In other words reads and writes must happen by one goroutine at a time or else we create race conditions in our programs.</p>\n</blockquote>\n\n<p>from  <a href=\"https://www.goinggo.net/2014/01/concurrency-goroutines-and-gomaxprocs.html\" rel=\"nofollow\">this article</a>, which explains the difference really well and references some other material you may want to look up (the article is somewhat outdated, as GMAXPROCS no longer defaults to 1, but the general theory is still accurate).</p>\n\n<p>And finally, Effective Go can be daunting when you're starting out but is a must-read. <a href=\"https://golang.org/doc/effective_go.html#concurrency\" rel=\"nofollow\">Here</a> is the explanation of concurrency in Go.</p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 0, "last_activity_date": 1464030371, "creation_date": 1464030371, "answer_id": 37398652, "question_id": 37391009, "link": "https://stackoverflow.com/questions/37391009/is-lock-necessary-when-gomaxprocs-is-1/37398652#37398652", "title": "Is lock necessary when GOMAXPROCS is 1", "body": "<p>Changing state, with <code>runtime.GOMAXPROCS(1)</code> assumed, will fail; even for just two go-routines:</p>\n\n<pre><code>func main() {\n    runtime.GOMAXPROCS(1)\n\n    start := make(chan struct{})\n    wg := &amp;sync.WaitGroup{}\n\n    N := 2 //10, 1000, 10000, ... fails with even 2 go-routines\n\n    for i := 0; i &lt; N; i++ {\n        wg.Add(1)\n\n        go func() {\n            defer wg.Done()\n            &lt;-start\n\n            //processing state\n            initialState := globalState\n\n            //give another goroutine a chance, by halting this one\n            //and lend some processing cycles\n            //(also simulating \"concurrent\" processing of initialState)\n            runtime.Gosched()\n\n            if globalState != initialState {\n                panic(fmt.Sprintf(\"oops! %d != %d\", initialState, globalState))\n            }\n            globalState = initialState + 1\n        }()\n    }\n\n    close(start)\n    wg.Wait()\n\n    log.Println(`global state:`, globalState)\n}\n\nvar (\n    globalState int\n)\n</code></pre>\n\n<p>Other answers went more into details - good for studying different aspects of concurrent programming.</p>\n"}], "owner": {"reputation": 10595, "user_id": 325320, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/23bc4a16f6a4bac91accd76c8078cd35?s=128&d=identicon&r=PG", "display_name": "Mr.Wang from Next Door", "link": "https://stackoverflow.com/users/325320/mr-wang-from-next-door"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1253, "favorite_count": 0, "accepted_answer_id": 37392073, "answer_count": 3, "score": 4, "last_activity_date": 1464030371, "creation_date": 1464006381, "question_id": 37391009, "link": "https://stackoverflow.com/questions/37391009/is-lock-necessary-when-gomaxprocs-is-1", "title": "Is lock necessary when GOMAXPROCS is 1", "body": "<blockquote>\n  <p>The <code>GOMAXPROCS</code> variable limits the number of operating system\n  threads that can execute user-level Go code simultaneously.</p>\n</blockquote>\n\n<p>So, if <code>GOMAXPROCS</code> is 1, no matter how many goroutines I have, it is safe to access variable (like <code>map</code>) from different goroutines  without any lock. Correct?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463998963, "post_id": 37387808, "comment_id": 62286358, "body": "Thanks How can I check exists an item like if registry[&quot;MyFunc100&quot;] {} without call it"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463999231, "post_id": 37387808, "comment_id": 62286544, "body": "It&#39;s a simple map, so you can check if an entry exists , there are examples in <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">blog.golang.org/go-maps-in-action</a>"}, {"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463999363, "post_id": 37387808, "comment_id": 62286631, "body": "non-bool registry[&quot;MyFunc100&quot;] (type func(http.ResponseWriter, *http.Request)) used as if condition"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463999457, "post_id": 37387808, "comment_id": 62286689, "body": "<code>if fn, ok := registry[&quot;Myfunc100&quot;]; ok { fn(resp, req) }</code>"}, {"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463999691, "post_id": 37387808, "comment_id": 62286838, "body": "I have nothing in http.ResponseWriter, *http.Request type (in call) I just want check an item in that map (just check the key)"}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 1, "last_activity_date": 1463997074, "creation_date": 1463997074, "answer_id": 37387808, "question_id": 37387549, "link": "https://stackoverflow.com/questions/37387549/call-http-func-in-a-function-registry/37387808#37387808", "title": "Call HTTP func in a function registry", "body": "<p>From, the documentation, <code>HandleFunc</code> expects a <code>func(http.ResponseWriter, *http.Request)</code> type.</p>\n\n<p>However, you have a typo in your code because you are not giving the function as argument, you are calling it:</p>\n\n<p>Change the part <code>registry[\"MyFunc1\"]()</code> into <code>registry[\"MyFunc1\"]</code></p>\n"}], "owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 37387808, "answer_count": 1, "score": 2, "last_activity_date": 1464116382, "creation_date": 1463996312, "last_edit_date": 1464116382, "question_id": 37387549, "link": "https://stackoverflow.com/questions/37387549/call-http-func-in-a-function-registry", "title": "Call HTTP func in a function registry", "body": "<p>I have a func registry but I don't know how can I call a HTTP func on it.</p>\n\n<pre><code>registry := map[string]func(){\n    \"MyFunc1\": MyFunc1,\n}\nregistry[\"MyFunc1\"]()\n\nfunc MyFunc1(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hi Gorilla!\"))\n}\n</code></pre>\n\n<p>I changed them to these:</p>\n\n<pre><code>registry := map[string]func(http.ResponseWriter, *http.Request){\n    \"MyFunc1\": MyFunc1,\n}\n</code></pre>\n\n<p>But I can not call it now!</p>\n\n<pre><code>gorilla.HandleFunc(\"/\", registry[\"MyFunc1\"]()).Name(parentKey)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464001391, "post_id": 37386303, "comment_id": 62287862, "body": "If you want to use <code>select</code> use <code>syscall.Select</code>, but that is almost always the wrong way to do it in Go"}, {"owner": {"reputation": 15279, "user_id": 1680919, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/y0BRq.jpg?s=128&g=1", "display_name": "Levite", "link": "https://stackoverflow.com/users/1680919/levite"}, "edited": false, "score": 1, "creation_date": 1557748286, "post_id": 37386303, "comment_id": 98856991, "body": "Related: <a href=\"https://stackoverflow.com/questions/18825207/how-can-i-interrupt-a-goroutine-executing-tcplistener-accept/48661619#48661619\" title=\"how can i interrupt a goroutine executing tcplistener accept\">stackoverflow.com/questions/18825207/&hellip;</a> (An example implementation of <code>SetDeadline</code> for a <code>TCPListener</code> also there)"}], "answers": [{"comments": [{"owner": {"reputation": 1377, "user_id": 1308707, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/w5C7K.jpg?s=128&g=1", "display_name": "mesmerizingr", "link": "https://stackoverflow.com/users/1308707/mesmerizingr"}, "edited": false, "score": 1, "creation_date": 1463995399, "post_id": 37387126, "comment_id": 62284110, "body": "Your second statement contradicts with a mere existence of <code>SetDeadline()</code> call on <code>TCPListener</code> type."}, {"owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "reply_to_user": {"reputation": 1377, "user_id": 1308707, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/w5C7K.jpg?s=128&g=1", "display_name": "mesmerizingr", "link": "https://stackoverflow.com/users/1308707/mesmerizingr"}, "edited": false, "score": 0, "creation_date": 1463996048, "post_id": 37387126, "comment_id": 62284524, "body": "Nope. The fact that setDeadline exist does not mean you need to use it in general case to make a server. You are using it wrong. I added an example with a typical basic Go server code."}, {"owner": {"reputation": 183, "user_id": 4783213, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/832893010098737/picture?type=large", "display_name": "Daniel Cull", "link": "https://stackoverflow.com/users/4783213/daniel-cull"}, "edited": false, "score": 2, "creation_date": 1566142849, "post_id": 37387126, "comment_id": 101555308, "body": "How do you gracefully shutdown this server if the Accept() call is blocking?"}], "tags": [], "owner": {"reputation": 8752, "user_id": 559289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8183a67842b916b7d7dfd99f5ce7759d?s=128&d=identicon&r=PG", "display_name": "Micka&#235;l R&#233;mond", "link": "https://stackoverflow.com/users/559289/micka%c3%abl-r%c3%a9mond"}, "is_accepted": false, "score": 0, "last_activity_date": 1463996684, "last_edit_date": 1463996684, "creation_date": 1463995093, "answer_id": 37387126, "question_id": 37386303, "link": "https://stackoverflow.com/questions/37386303/setting-timeout-via-setdeadline-for-tcp-listener/37387126#37387126", "title": "Setting timeout via SetDeadline() for TCP listener", "body": "<p>Accept is supposed to be blocking. You do not want to set deadline on listen / Accept, as you want it to permanently listen to new connections.</p>\n\n<p>You need to put the accept inside a loop and basically start a new go routine to process the connexion and return to waiting to new client connexion (Accept).</p>\n\n<p>Here is a typical server in Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"os\"\n)\n\nfunc main() {\n    l, err := net.Listen(\"tcp\", \"localhost:12819\")\n    if err != nil {\n        log.Fatalln(\"Can't listen on provided IP/port!\")\n    }\n    defer l.Close()\n\n    for {\n        // Listen for an incoming connection.\n        conn, err := l.Accept()\n        if err != nil {\n            fmt.Println(\"Error accepting: \", err.Error())\n            os.Exit(1)\n        }\n\n        // Handle connections in a new goroutine.\n        go handleRequest(conn)\n    }\n}\n\nfunc handleRequest(conn net.Conn) {\n    buf := make([]byte, 1024)\n    if _, err := conn.Read(buf); err != nil {\n        fmt.Println(\"Error reading:\", err.Error())\n    }\n    conn.Write([]byte(\"Message received.\"))\n    conn.Close()\n}\n</code></pre>\n\n<p>You can connect with it with the following command from your shell:</p>\n\n<pre><code>telnet localhost 12819\n</code></pre>\n\n<p>Type a command and your request will be handled and processed.</p>\n\n<p>As you see, the accept command is intended to be blocking on purpose. SetDeadline on server is generally used further done in the processing phase to timeout on read on data coming from client. </p>\n"}], "owner": {"reputation": 1377, "user_id": 1308707, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/w5C7K.jpg?s=128&g=1", "display_name": "mesmerizingr", "link": "https://stackoverflow.com/users/1308707/mesmerizingr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3589, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1463996684, "creation_date": 1463992655, "question_id": 37386303, "link": "https://stackoverflow.com/questions/37386303/setting-timeout-via-setdeadline-for-tcp-listener", "title": "Setting timeout via SetDeadline() for TCP listener", "body": "<p>I'm trying to implement non-blocking <code>Accept()</code> and the best I've come so far is the following code snippet (it's a working Go v1.6.2 program):</p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"log\"\n    \"time\"\n)\n\nfunc createClient() {\n    tcpConn, err := net.DialTCP(\"tcp4\", nil, &amp;net.TCPAddr{\n        IP:     net.IPv4(127, 0, 0, 1),\n        Port:   12819,\n    })\n    if err != nil {\n        log.Fatalln(\"Error connecting to the server!\")\n    }\n    log.Println(\"Managed to dial!\")\n    tcpConn.Close()\n}\n\nfunc main() {\n    go createClient()\n    l, err := net.ListenTCP(\"tcp4\", &amp;net.TCPAddr{\n        IP:     net.IPv4(127, 0, 0, 1),\n        Port:   12819,\n    })\n    if err != nil {\n        log.Fatalln(\"Can't listen on provided IP/port!\")\n    }\n    defer l.Close()\n    if err = l.SetDeadline(time.Now().Add(time.Nanosecond)); err != nil {\n        log.Fatalln(\"Can't set appropriate deadline!\")\n    }\n    tcpConn, err := l.AcceptTCP()\n    if err != nil {\n        if opError, ok := err.(*net.OpError); ok &amp;&amp; opError.Timeout() {\n            log.Fatalln(\"Timeout error!\")\n        }\n        log.Fatalln(\"Error while accepting connection!\")\n    }\n    log.Println(\"Accepted new connection!\")\n    tcpConn.Close()\n}\n</code></pre>\n\n<p>The problem is that I always get <code>Timeout error!</code>. As far as I understand that's because by the time listener's <code>AcceptTCP()</code> gets called the deadline previously set will have already expired. Try changing it to <code>time.Microsecond</code> and you'd probably get the same result (unless you have CPU slower than mine). Things start to change only when the deadline gets at least <code>time.Second</code>. That's when I start to get <code>Accepted new connection!</code>/<code>Managed to dial!</code>.</p>\n\n<p>So I think I nailed the problem. Any thoughts?</p>\n"}, {"tags": ["go", "constants"], "comments": [{"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1463993722, "post_id": 37385007, "comment_id": 62283025, "body": "You can look into go&#39;s source code for some ideas: <a href=\"https://golang.org/src/go/constant/value.go\" rel=\"nofollow noreferrer\">value.go</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1463995969, "post_id": 37385007, "comment_id": 62284479, "body": "For your case here: <code>type unary bool</code> as bool is two-valued in Go."}], "answers": [{"comments": [{"owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "edited": false, "score": 0, "creation_date": 1464006715, "post_id": 37386119, "comment_id": 62291448, "body": "So essentially its up to the programmer to use such types in a responsible way?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "edited": false, "score": 0, "creation_date": 1464007873, "post_id": 37386119, "comment_id": 62292249, "body": "@G4143 If you want simple, clean and efficient code, then basically yes. If you want safe code, then you have to resort the unexported struct type, with unexported global vars."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 42, "last_activity_date": 1599047718, "last_edit_date": 1599047718, "creation_date": 1463992105, "answer_id": 37386119, "question_id": 37385007, "link": "https://stackoverflow.com/questions/37385007/creating-a-constant-type-and-restricting-the-types-values/37386119#37386119", "title": "Creating a Constant Type and Restricting the Type&#39;s Values", "body": "<h3>Flaws</h3>\n<p>Your proposed solution is not safe in a way you want it to be. One can use untyped integer constants to create new values of <code>unary</code> having a different <code>int</code> value than <code>1</code> or <code>-1</code>. See this example:</p>\n<pre><code>p := unary.Positive\nfmt.Printf(&quot;%v %d\\n&quot;, p, p)\n\np = 3\nfmt.Printf(&quot;%v %d\\n&quot;, p, p)\n</code></pre>\n<p>Output will be:</p>\n<pre><code>+ 1\n- 3\n</code></pre>\n<p>We could change <code>p</code>'s value to store the <code>int</code> value <code>3</code> which is obviously not equal to <code>Positive</code> nor to <code>Negative</code>. This is possible because <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"noreferrer\">Spec: Assignability:</a></p>\n<blockquote>\n<p>A value <code>x</code> is <em>assignable</em> to a <a href=\"https://golang.org/ref/spec#Variables\" rel=\"noreferrer\">variable</a> of type <code>T</code> (&quot;<code>x</code> is assignable to <code>T</code>&quot;) in any of these cases:</p>\n<ul>\n<li>...</li>\n<li><code>x</code> is an untyped <a href=\"https://golang.org/ref/spec#Constants\" rel=\"noreferrer\">constant</a> representable by a value of type <code>T</code>.</li>\n</ul>\n</blockquote>\n<p><code>3</code> is an untyped constant, and it is representable by a value of type <code>unary</code> which has underlying type <code>int</code>.</p>\n<p>In Go you can't have &quot;safe&quot; constants of which &quot;outsider&quot; packages cannot create new values of, for the above mentioned reason. Because if you want to declare <em>constants</em> in your package, you can only use expressions that have &quot;untyped&quot; versions\u2013which may be used by other packages too in assignments (just as in our example).</p>\n<h3>Unexported struct</h3>\n<p>If you want to fulfill the &quot;safe&quot; part, you may use unexported <code>struct</code>s, but then they cannot be used in <a href=\"https://golang.org/ref/spec#Constant_declarations\" rel=\"noreferrer\">constant declarations</a>.</p>\n<p>Example:</p>\n<pre><code>type unary struct {\n    val int\n}\n\nvar (\n    Positive = unary{1}\n    Negative = unary{-1}\n)\n\nfunc (u unary) String() string {\n    if u == Positive {\n        return &quot;+&quot;\n    }\n    return &quot;-&quot;\n}\n\nfunc (u unary) CalExpr() int {\n    return u.val\n}\n</code></pre>\n<p>Attempting to change its value:</p>\n<pre><code>p := unary.Positive\n\np.val = 3 // Error: p.val undefined (cannot refer to unexported field or method val)\n\np = unary.unary{3} // Error: cannot refer to unexported name unary.unary\n// Also error: implicit assignment of unexported field 'val' in unary.unary literal\n</code></pre>\n<p>Note that since we're now using a <code>struct</code>, we can further simplify our code by adding the <code>string</code> representation of our values to the <code>struct</code>:</p>\n<pre><code>type unary struct {\n    val int\n    str string\n}\n\nvar (\n    Positive = unary{1, &quot;+&quot;}\n    Negative = unary{-1, &quot;-&quot;}\n)\n\nfunc (u unary) String() string { return u.str }\n\nfunc (u unary) CalExpr() int { return u.val }\n</code></pre>\n<p>Note that this solution still has a &quot;flaw&quot;: it uses exported global variables (more precisely package-level variables) whose values can be changed by other packages. It's true that other packages cannot create and assign <em>new</em> values, but they can do so with existing values, e.g.:</p>\n<pre><code>unary.Positive = unary.Negative\n</code></pre>\n<p>If you want to protect yourself from such misuse, you also have to make such global variables unexported. And then of course you have to create exported functions to expose those values, for example:</p>\n<pre><code>var (\n    positive = unary{1}\n    negative = unary{-1}\n)\n\nfunc Positive() unary { return positive }\n\nfunc Negative() unary { return negative }\n</code></pre>\n<p>Then acquiring/using the values:</p>\n<pre><code>p := unary.Positive()\n</code></pre>\n<h3>Interface</h3>\n<p>Care must be taken if you plan to use an interface type for your &quot;constants&quot;. An example can be seen in Kaveh Shahbazian's answer. An unexported method is used to prevent others from implementing the interface, giving you the illusion that others truly can't implement it:</p>\n<pre><code>type Unary interface {\n    fmt.Stringer\n    CalExpr() int\n    disabler() // implementing this interface outside this package is disabled\n}\n\nvar (\n    Positive Unary = unary(1)  // visible outside of the package unary\n    Negative Unary = unary(-1) // visible outside of the package unary\n)\n\ntype unary int // not visible outside of the package unary\n\nfunc (u unary) disabler() {}\n\nfunc (u unary) String() string { /* ... */ }\n\nfunc (u unary) CalExpr() int { /* ... */ }\n</code></pre>\n<p>This is not the case however. With a dirty trick, this can be circumvented. The exported <code>Unary</code> type can be embedded, and an existing value can be used in order to implement the interface (along with the unexported method), and we can add our own implementations of the exported methods, doing / returning whatever we want to.</p>\n<p>Here is how it may look like:</p>\n<pre><code>type MyUn struct {\n    unary.Unary\n}\n\nfunc (m MyUn) String() string { return &quot;/&quot; }\n\nfunc (m MyUn) CalExpr() int { return 3 }\n</code></pre>\n<p>Testing it:</p>\n<pre><code>p := unary.Positive\nfmt.Printf(&quot;%v %d\\n&quot;, p, p)\n\np = MyUn{p}\nfmt.Printf(&quot;%v %d\\n&quot;, p, p.CalExpr())\n</code></pre>\n<p>Output:</p>\n<pre><code>+ 1\n/ 3\n</code></pre>\n<h3>Special case</h3>\n<p>As Volker mentioned in his comment, in your special case you could just use</p>\n<pre><code>type unary bool\n\nconst (\n    Positive unary = true\n    Negative unary = false\n)\n</code></pre>\n<p>As the type <code>bool</code> has two possible values: <code>true</code> and <code>false</code>, and we've used all. So there are no other values that could be &quot;exploited&quot; to create other values of our constant type.</p>\n<p>But know that this can only be used if the number of constants is equal to the number of possible values of the type, so the usability of this technique is very limited.</p>\n<p>Also keep in mind that this does not prevent such misuses when a type of <code>unary</code> is expected, and someone accidentally passes an untyped constant like <code>true</code> or <code>false</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1464000649, "post_id": 37386404, "comment_id": 62287415, "body": "Be aware that an unexported method does not prevent others to implement the interface. See my answer for explanation and example."}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1464005424, "last_edit_date": 1464005424, "creation_date": 1463992910, "answer_id": 37386404, "question_id": 37385007, "link": "https://stackoverflow.com/questions/37385007/creating-a-constant-type-and-restricting-the-types-values/37386404#37386404", "title": "Creating a Constant Type and Restricting the Type&#39;s Values", "body": "<p>If you like to just work with <code>int</code> without introducing a wrapper type: a classic way to do that in Go is using a public interface with a private function; so everybody can use it but nobody can implement it; like:</p>\n\n<pre><code>type Unary interface {\n    fmt.Stringer\n    CalExpr() int\n    disabler() //implementing this interface outside this package is disabled\n}\n\nvar (\n    Positive Unary = unary(1)  //visible outside of the package unary\n    Negative Unary = unary(-1) //visible outside of the package unary\n)\n\ntype unary int //not visible outside of the package unary\n\nfunc (u unary) disabler() {}\n\nfunc (u unary) String() string { //visible outside of the package unary\n    if u == Positive {\n        return \"+\"\n    }\n    return \"-\"\n}\n\nfunc (u unary) CalExpr() int { //visible outside of the package unary\n    if u == Positive {\n        return 1\n    }\n    return -1\n}\n</code></pre>\n\n<p>Others are able to set <code>Positive</code> to <code>nil</code> though; but that's not a thing in Go world - in such cases.</p>\n\n<p>As @icza mentioned, one can overwrite public methods. But for private methods, Go will not call \"the most shallow\" one, but instead calls the original.</p>\n"}], "owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16538, "favorite_count": 13, "accepted_answer_id": 37386119, "answer_count": 2, "score": 29, "last_activity_date": 1599047718, "creation_date": 1463988598, "last_edit_date": 1564504354, "question_id": 37385007, "link": "https://stackoverflow.com/questions/37385007/creating-a-constant-type-and-restricting-the-types-values", "title": "Creating a Constant Type and Restricting the Type&#39;s Values", "body": "<p>I have a question about types of constants which are restricted to certain values and how you accomplish that in Go. Say I create a type <code>unary</code> which has two constant values <code>Positive(1)</code> and <code>Negative(-1)</code> and I want to restrict the user of that type (<code>unary</code>) from creating other values of type <code>unary</code>. Do I achieve this by creating a package and making the values <code>Positive</code> and <code>Negative</code> visible and making the type <code>unary</code> restricted to the containing package? See code below for example</p>\n\n<pre><code>package unary\n\ntype unary int////not visible outside of the package unary\n\nconst (\n    Positive unary = 1//visible outside of the package unary\n    Negative unary = -1//visible outside of the package unary\n)\n\nfunc (u unary) String() string {//visible outside of the package unary\n    if u == Positive {\n        return \"+\"\n    }\n    return \"-\"\n}\n\nfunc (u unary) CalExpr() int {//visible outside of the package unary\n    if u == Positive {\n        return 1\n    }\n    return -1\n}\n</code></pre>\n\n<p>Is this the correct way to restrict a type to certain constant values?</p>\n"}, {"tags": ["string", "function", "go"], "comments": [{"owner": {"reputation": 4163, "user_id": 4606130, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/343d4fbd72bc47b7ca8db0947a45b122?s=128&d=identicon&r=PG&f=1", "display_name": "micstr", "link": "https://stackoverflow.com/users/4606130/micstr"}, "edited": false, "score": 0, "creation_date": 1463987082, "post_id": 37384473, "comment_id": 62279287, "body": "Hi Masood. In your sub functions don&#39;t you mean to say the Hello World text matches the function not all MyFunc1?: i.e.  func MyFunc2() {     fmt.Println(&quot;Hello MyFunc2&quot;) }"}, {"owner": {"reputation": 4163, "user_id": 4606130, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/343d4fbd72bc47b7ca8db0947a45b122?s=128&d=identicon&r=PG&f=1", "display_name": "micstr", "link": "https://stackoverflow.com/users/4606130/micstr"}, "edited": false, "score": 0, "creation_date": 1463987211, "post_id": 37384473, "comment_id": 62279361, "body": "Ok great I see you have fixed this."}, {"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "reply_to_user": {"reputation": 4163, "user_id": 4606130, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/343d4fbd72bc47b7ca8db0947a45b122?s=128&d=identicon&r=PG&f=1", "display_name": "micstr", "link": "https://stackoverflow.com/users/4606130/micstr"}, "edited": false, "score": 0, "creation_date": 1463987222, "post_id": 37384473, "comment_id": 62279364, "body": "Hi no I mean call funcs with special prefix. Lets change fmt output  to be more than clear"}], "answers": [{"comments": [{"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463987604, "post_id": 37384665, "comment_id": 62279570, "body": "Thank but is there any other way without map?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 1, "creation_date": 1463987769, "post_id": 37384665, "comment_id": 62279662, "body": "@MasoodAfrashteh You may do it with a registry, or by transforming functions to methods. Having functions and no registry - you can&#39;t."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1463987949, "post_id": 37384665, "comment_id": 62279777, "body": "or <code>reflect</code>, which helping turn string to function."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1463988126, "post_id": 37384665, "comment_id": 62279863, "body": "@JiangYD You can&#39;t get a function by name using <code>reflect</code>, only methods."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463988216, "post_id": 37384665, "comment_id": 62279907, "body": "@MasoodAfrashteh Considering your edit to the question, the answers still stand: you can&#39;t do it without a registry or using methods instead of functions."}, {"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463988640, "post_id": 37384665, "comment_id": 62280112, "body": "Thanks I just change MyType type to string It&#39;s working."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1463988751, "post_id": 37384665, "comment_id": 62280173, "body": "yes I missed it. why golang designed  not get to <code>Package</code> at runtime?"}, {"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463989408, "post_id": 37384665, "comment_id": 62280568, "body": "Sorry It&#39;s not working because in my example functions write by user and I&#39;m going to connect those functions with special prefix or suffix like &quot;route&quot; to gorilla."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1463989626, "post_id": 37384665, "comment_id": 62280709, "body": "@MasoodAfrashteh As said previously, if they remain functions (and you can&#39;t make them methods), you can only do it with a function registry (or some other construct, explicitly listing the names, routing them to functions manually)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 20, "last_activity_date": 1547548779, "last_edit_date": 1547548779, "creation_date": 1463987467, "answer_id": 37384665, "question_id": 37384473, "link": "https://stackoverflow.com/questions/37384473/call-functions-with-special-prefix-suffix/37384665#37384665", "title": "Call functions with special prefix/suffix", "body": "<p>You can't get a function by its name, and that is what you're trying to do. The reason is that if the Go tool can detect that a function is not referred to explicitly (and thus unreachable), it may not even get compiled into the executable binary. For details see <a href=\"https://stackoverflow.com/questions/38875016/splitting-client-server-code/38875901#38875901\">Splitting client/server code</a>.</p>\n\n<h3>With a function registry</h3>\n\n<p>One way to do what you want is to build a \"function registry\" prior to calling them:</p>\n\n<pre><code>registry := map[string]func(){\n    \"MyFunc1\": MyFunc1,\n    \"MyFunc2\": MyFunc2,\n    \"MyFunc3\": MyFunc3,\n}\nfor k := 1; k &lt;= 3; k++ {\n    registry[fmt.Sprintf(\"MyFunc%d\", k)]()\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/SePjpsDkyT\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Hello MyFunc1\nHello MyFunc2\nHello MyFunc3\n</code></pre>\n\n<h3>Manual \"routing\"</h3>\n\n<p>Similar to the registry is inspecting the name and manually routing to the function, for example:</p>\n\n<pre><code>func callByName(name string) {\n    switch name {\n    case \"MyFunc1\":\n        MyFunc1()\n    case \"MyFunc2\":\n        MyFunc2()\n    case \"MyFunc3\":\n        MyFunc3()\n    default:\n        panic(\"Unknown function name\")\n    }\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>for k := 1; k &lt;= 3; k++ {\n    callByName(fmt.Sprintf(\"MyFunc%d\", k))\n}\n</code></pre>\n\n<p>Try this on the <a href=\"https://play.golang.org/p/j3DqtPbNrv\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p><strong>Note:</strong> It's up to you if you want to call the function identified by its name in the <code>callByName()</code> helper function, or you may choose to return a function value (of type <code>func()</code>) and have it called in the caller's place.</p>\n\n<h3>Transforming functions to methods</h3>\n\n<p>Also note that if your functions would actually be <em>methods</em> of some type, you could do it without a registry. Using reflection, you can get a method by name: <a href=\"https://golang.org/pkg/reflect/#Value.MethodByName\" rel=\"noreferrer\"><code>Value.MethodByName()</code></a>. You can also get / enumerate all methods without knowing their names using <a href=\"https://golang.org/pkg/reflect/#Value.NumMethod\" rel=\"noreferrer\"><code>Value.NumMethod()</code></a> and <a href=\"https://golang.org/pkg/reflect/#Value.Method\" rel=\"noreferrer\"><code>Value.Method()</code></a> (also see <code>Type.NumMethod()</code> and <code>Type.Method()</code> if you need the name of the method or its parameter types).</p>\n\n<p>This is how it could be done:</p>\n\n<pre><code>type MyType int\n\nfunc (m MyType) MyFunc1() {\n    fmt.Println(\"Hello MyFunc1\")\n}\n\nfunc (m MyType) MyFunc2() {\n    fmt.Println(\"Hello MyFunc2\")\n}\n\nfunc (m MyType) MyFunc3() {\n    fmt.Println(\"Hello MyFunc3\")\n}\n\nfunc main() {\n    v := reflect.ValueOf(MyType(0))\n    for k := 1; k &lt;= 3; k++ {\n        v.MethodByName(fmt.Sprintf(\"MyFunc%d\", k)).Call(nil)\n    }\n}\n</code></pre>\n\n<p>Output is the same. Try it on the <a href=\"https://play.golang.org/p/v7Jgo_D-Ik\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": false, "score": 0, "last_activity_date": 1541206947, "creation_date": 1541206947, "answer_id": 53127497, "question_id": 37384473, "link": "https://stackoverflow.com/questions/37384473/call-functions-with-special-prefix-suffix/53127497#53127497", "title": "Call functions with special prefix/suffix", "body": "<p>Another alternative would be to range over an array of your functions</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc MyFunc1() {\n    fmt.Println(\"I am Masood\")\n}\n\nfunc MyFunc2() {\n    fmt.Println(\"I am a programmer\")\n}\n\nfunc MyFunc3() {\n    fmt.Println(\"I want to buy a car\")\n}\n\n\nfunc main() {\n   for _, fn := range []func(){MyFunc1, MyFunc2, MyFunc3} {\n        fn()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2969, "favorite_count": 5, "accepted_answer_id": 37384665, "answer_count": 2, "score": 16, "last_activity_date": 1547548779, "creation_date": 1463986817, "last_edit_date": 1547537981, "question_id": 37384473, "link": "https://stackoverflow.com/questions/37384473/call-functions-with-special-prefix-suffix", "title": "Call functions with special prefix/suffix", "body": "<p>I have a package named \"seeder\":</p>\n\n<pre><code>package seeder\n\nimport \"fmt\"\n\nfunc MyFunc1() {\n    fmt.Println(\"I am Masood\")\n}\n\nfunc MyFunc2() {\n    fmt.Println(\"I am a programmer\")\n}\n\nfunc MyFunc3() {\n    fmt.Println(\"I want to buy a car\")\n}\n</code></pre>\n\n<p>Now I want to call all functions with MyFunc prefix</p>\n\n<pre><code>package main\n\nimport \"./seeder\"\n\nfunc main() {\n    for k := 1; k &lt;= 3; k++ {\n        seeder.MyFunc1() // This calls MyFunc1 three times\n    }\n}\n</code></pre>\n\n<p>I want something like this:</p>\n\n<pre><code>for k := 1; k &lt;= 3; k++ {\n    seeder.MyFunc + k ()\n}\n</code></pre>\n\n<p>and this output:</p>\n\n<blockquote>\n<pre><code>I am Masood\nI am a programmer\nI want to buy a car\n</code></pre>\n</blockquote>\n\n<p><strong>EDIT1</strong>:\nIn this example, parentKey is a string variable which changed in a loop</p>\n\n<pre><code>for parentKey, _ := range uRLSjson{ \n    pppp := seeder + \".\" + strings.ToUpper(parentKey)\n    gorilla.HandleFunc(\"/\", pppp).Name(parentKey)\n}\n</code></pre>\n\n<p>But GC said:</p>\n\n<blockquote>\n  <p>use of package seeder without selector</p>\n</blockquote>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1463987668, "post_id": 37384246, "comment_id": 62279602, "body": "what the error message in panic?"}, {"owner": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1463991185, "post_id": 37384246, "comment_id": 62281548, "body": "added the error message"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464011070, "post_id": 37384246, "comment_id": 62294365, "body": "Besides the C compiler warnings because you&#39;re not including &quot;_cgo_export.h&quot;, and the memory leak because you&#39;re not freeing the CString from c_ccB, I don&#39;t see a reason to segfault. What version of Go are you using?"}, {"owner": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "edited": false, "score": 0, "creation_date": 1464059072, "post_id": 37384246, "comment_id": 62315570, "body": "yes, got warning message using GCC 5.3.1, but no warning message using GCC 4.4.6. And I don&#39;t understand how to free the CString from <code>c_ccB</code>, because if you free this, then C code will get a &quot;&quot; string."}, {"owner": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "edited": false, "score": 0, "creation_date": 1464060630, "post_id": 37384246, "comment_id": 62315938, "body": "I tried go version 1.6.2 and version 1.5.1, both will panic."}, {"owner": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464074051, "post_id": 37384246, "comment_id": 62320899, "body": "Including &quot;_cgo_export.h&quot; can also solve this, thank @JimB."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "edited": false, "score": 0, "creation_date": 1463994554, "post_id": 37386558, "comment_id": 62283544, "body": "no need to declare <code>c_ccB</code> again, and yes I didn&#39;t free the memory because  <code>C.free</code> may make func <code>c_ccB</code> return a null value."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "edited": false, "score": 0, "creation_date": 1464052071, "post_id": 37386558, "comment_id": 62313939, "body": "<code>again</code>? where your <code>p.c</code> can get the declaration of <code>c_ccB</code>?"}, {"owner": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "edited": false, "score": 0, "creation_date": 1464059414, "post_id": 37386558, "comment_id": 62315648, "body": "I don&#39;t know how go handle this, and I got warning message using GCC 5.3.1, but no warning message using GCC 4.4.6.  And it&#39;s just a warning message."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "edited": false, "score": 0, "creation_date": 1464069914, "post_id": 37386558, "comment_id": 62318703, "body": "so you have added the declaration and it still crash? I tried it locally it crash only if I not declare <code>c_ccB</code>."}, {"owner": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "edited": false, "score": 0, "creation_date": 1464070693, "post_id": 37386558, "comment_id": 62319064, "body": "Sorry, I think add extern statement only solve the &quot;implicit declare&quot; warning and haven&#39;t try this. Now I tried it and it will not get panic, thank you!"}, {"owner": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "edited": false, "score": 0, "creation_date": 1464073719, "post_id": 37386558, "comment_id": 62320662, "body": "Acceptted now, I am busy to answer some questions to up my reputation for vote your answer, and didn&#39;t see the accept button."}], "tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": true, "score": 0, "last_activity_date": 1463993424, "creation_date": 1463993424, "answer_id": 37386558, "question_id": 37384246, "link": "https://stackoverflow.com/questions/37384246/confused-about-why-this-cgo-code-panic/37386558#37386558", "title": "Confused about why this cgo code panic", "body": "<p>you missed the declaration of  <code>c_ccB</code> in your c code. add <code>extern char* c_ccB(char*);</code> to you <code>p.c</code> please.</p>\n\n<p>And, you forget to free the memory allocated for <code>CString</code> in <code>c_ccB</code>.</p>\n"}], "owner": {"reputation": 33, "user_id": 4361639, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2551b0388209b9bbd3cbedc2b8cf2e77?s=128&d=identicon&r=PG&f=1", "display_name": "suwey", "link": "https://stackoverflow.com/users/4361639/suwey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 720, "favorite_count": 1, "accepted_answer_id": 37386558, "answer_count": 1, "score": 0, "last_activity_date": 1464009607, "creation_date": 1463986016, "last_edit_date": 1463991152, "question_id": 37384246, "link": "https://stackoverflow.com/questions/37384246/confused-about-why-this-cgo-code-panic", "title": "Confused about why this cgo code panic", "body": "<p>I want to write a demo about use golang call c function, and I write this files and found it will get panic and I don't know why.</p>\n\n<p>First, a c header file <code>p.h</code>:</p>\n\n<pre><code>    void output(char* str, int s);\n    void cc(char *str);\n</code></pre>\n\n<p>Second, a c file <code>p.c</code>:</p>\n\n<pre><code>    #include&lt;stdio.h&gt;\n    #include&lt;stdlib.h&gt;\n    #include&lt;unistd.h&gt;\n\n    void output(char* str, int s) {\n            fflush(stdout);\n            sleep(s);\n            printf(\"%s\", str);\n    }\n\n    void cc(char *str) {\n            printf(\"%s\", c_ccB(str));\n    }\n</code></pre>\n\n<p>It's quite simple, a <code>output</code> function for go code and a <code>cc</code> function call <code>c_ccB</code> in go code, the last go code file is <code>p.go</code>:</p>\n\n<pre><code>     package main\n\n     /*\n     #include&lt;stdlib.h&gt;\n     #include \"p.h\"\n     */\n     import \"C\"\n     import \"unsafe\"\n     import \"fmt\"\n\n     //export c_ccB\n     func c_ccB(cs *C.char) *C.char {\n             gs := C.GoString(cs)\n             return C.CString(gs + \"wwww\")\n     }\n\n     func main() { \n             ch := make(chan int)\n             task(\"A\", ch, 5)\n             task(\"B\", ch, 1)\n             fmt.Printf(\"begin\\n\")\n             &lt;-ch\n     }\n\n     func task(name string, ch chan int, s int) {\n             go func() {\n                     i:= 1\n                     for {\n                              str := \":\" + name\n                              cstr := C.CString(str)\n                              C.output(cstr, C.int(s))\n                              C.cc(cstr)\n                              C.free(unsafe.Pointer(cstr))\n                              i++\n                     }\n                     ch &lt;- 1\n              }();\n      }\n</code></pre>\n\n<p>The go code is just two goroutime keep print some strings, if delete <code>C.cc(cstr)</code>, it will work fine, but why <code>C.cc</code> will cause panic ? It just call <code>func c_ccB</code> in go.</p>\n\n<p>Here is the panic message:</p>\n\n<pre><code>      begin\n      :B:Bwwww:B:Bwwww:B:Bwwww:B:Bwwwwfatal error: unexpected signal       during runtime execution\n      [signal 0xb code=0x1 addr=0x900008e0 pc=0x7ff5973f8c80]\n\n      runtime stack:\n      runtime.throw(0x5438a0, 0x2a)\n          /usr/local/go/src/runtime/panic.go:547 +0x90\n      runtime.sigpanic()\n          /usr/local/go/src/runtime/sigpanic_unix.go:12 +0x5a\n\n      goroutine 5 [syscall, locked to thread]:\n      runtime.cgocall(0x4b1b20, 0xc82002bf20, 0x0)\n        /usr/local/go/src/runtime/cgocall.go:123 +0x11b                     fp=0xc82002bee8 sp=0xc82002beb8\n      main._Cfunc_cc(0x7ff5900008c0)\n        _/home/suwey/code/go/src/_obj/_cgo_gotypes.go:62 +0x36 fp=0xc82002bf20 sp=0xc82002bee8\n      main.task.func1(0x51bf48, 0x1, 0x5, 0xc820062060)\n        /home/suwey/code/go/src/p.go:32 +0xae fp=0xc82002bfa0 sp=0xc82002bf20\n      runtime.goexit()\n        /usr/local/go/src/runtime/asm_amd64.s:1998 +0x1 fp=0xc82002bfa8 sp=0xc82002bfa0\n      created by main.task\n        /home/suwey/code/go/src/p.go:37 +0x53\n\n      goroutine 1 [chan receive]:\n      main.main()\n        /home/suwey/code/go/src/p.go:22 +0xda\n\n      goroutine 17 [syscall, locked to thread]:\n      runtime.goexit()\n        /usr/local/go/src/runtime/asm_amd64.s:1998 +0x1\n\n      goroutine 6 [syscall, locked to thread]:\n      main._Cfunc_output(0x1de38b0, 0x1)\n        _/home/suwey/code/go/src/_obj/_cgo_gotypes.go:74 +0x3a\n      main.task.func1(0x51bfd0, 0x1, 0x1, 0xc820062060)\n        /home/suwey/code/go/src/p.go:31 +0xa0\n      created by main.task\n        /home/suwey/code/go/src/p.go:37 +0x53\n</code></pre>\n"}, {"tags": ["networking", "go", "docker", "kubernetes", "flannel"], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 5602264, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cyy_-GR357Y/AAAAAAAAAAI/AAAAAAAABeE/nvJp4v88FT4/photo.jpg?sz=128", "display_name": "Oliver Li", "link": "https://stackoverflow.com/users/5602264/oliver-li"}, "is_accepted": false, "score": 0, "last_activity_date": 1463995021, "creation_date": 1463995021, "answer_id": 37387103, "question_id": 37384042, "link": "https://stackoverflow.com/questions/37384042/flannel-error-failed-to-initialize-network-failed-to-open-tun-device/37387103#37387103", "title": "flannel error failed to initialize network failed to open tun device", "body": "<p>It turned out to be a permission issue. Simply <code>sudo flanneld</code> will work.</p>\n"}], "owner": {"reputation": 31, "user_id": 5602264, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cyy_-GR357Y/AAAAAAAAAAI/AAAAAAAABeE/nvJp4v88FT4/photo.jpg?sz=128", "display_name": "Oliver Li", "link": "https://stackoverflow.com/users/5602264/oliver-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 507, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1463995021, "creation_date": 1463985265, "question_id": 37384042, "link": "https://stackoverflow.com/questions/37384042/flannel-error-failed-to-initialize-network-failed-to-open-tun-device", "title": "flannel error failed to initialize network failed to open tun device", "body": "<p>I'm using flannel for the first time and I'm testing it with two nodes (Ubuntu14.04) with etcd running. The ip addresses of the two nodes are 192.168.0.124 (node1) and 192.168.0.127 (node2), and they can ping each other without problem. I have configured flannel network in etcd as follows:<br>\nOn node1: <code>etcdctl set /coreos.com/network/config '{ \"Network\": \"10.1.15.0/16\" }'</code><br>\nOn node2: <code>etcdctl set /coreos.com/network/config '{ \"Network\": \"10.1.20.0/16\" }'</code>\nHowever, whenever I run flanneld on either node I get the following error:<br></p>\n\n<blockquote>\n  <p>E0523 14:11:29.325240 28803 network.go:71] Failed to initialize network (type UDP): Failed to open TUN device: ioctl failed with 'operation not permitted'</p>\n</blockquote>\n\n<p>Is there any clue on solving this problem?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5268, "user_id": 302164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XucHp.png?s=128&g=1", "display_name": "miltonb", "link": "https://stackoverflow.com/users/302164/miltonb"}, "edited": false, "score": 0, "creation_date": 1463979311, "post_id": 37382843, "comment_id": 62276244, "body": "This existing question may provide you with some clues (<a href=\"http://stackoverflow.com/questions/22391847/package-structure-for-go-app-engine-project\" title=\"package structure for go app engine project\">stackoverflow.com/questions/22391847/&hellip;</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 1629, "user_id": 998919, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/947cfda8c228b7ca9b72764e93d2600e?s=128&d=identicon&r=PG", "display_name": "fgblomqvist", "link": "https://stackoverflow.com/users/998919/fgblomqvist"}, "edited": false, "score": 0, "creation_date": 1463990770, "post_id": 37384057, "comment_id": 62281359, "body": "Thank you! Digging deeper into the go tool code, I also noticed that the binary &quot;go tool&quot; actually looks for and executes other binaries. Executing &quot;go tool vet&quot; will actually execute a binary named just &quot;vet&quot;. Using this way, they can build all their commands like separate binaries, but still give you the feeling that it&#39;s just one big well-organized one."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 1, "last_activity_date": 1463985325, "creation_date": 1463985325, "answer_id": 37384057, "question_id": 37382843, "link": "https://stackoverflow.com/questions/37382843/commands-in-separate-modules/37384057#37384057", "title": "Commands in separate modules", "body": "<p>You do not need a <code>main.go</code> in the root package. If you are into the myapp folder and run <code>go install ./...</code> then Go will recursively search for <code>main()</code> functions in subfolders.</p>\n\n<p>For each <code>main()</code> function in a different package, Go will compile it in a single executable containing all the necessary packages. In your example, it would produce three binaries: <code>first</code>, <code>second</code> and <code>third</code></p>\n\n<p>About the implementation/debugging you just do it the usual way. That is, you implement and test your packages one by one with standard tests. If you want to test the compiled binaries, you can use the <code>exec.Cmd</code> struct.</p>\n\n<p>Also, if you want good-looking commands, you can use some third-party libraries like <a href=\"https://github.com/spf13/cobra\" rel=\"nofollow\">cobra</a> or <a href=\"https://github.com/urfave/cli\" rel=\"nofollow\">cli</a></p>\n"}], "owner": {"reputation": 1629, "user_id": 998919, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/947cfda8c228b7ca9b72764e93d2600e?s=128&d=identicon&r=PG", "display_name": "fgblomqvist", "link": "https://stackoverflow.com/users/998919/fgblomqvist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "accepted_answer_id": 37384057, "answer_count": 1, "score": 0, "last_activity_date": 1463985325, "creation_date": 1463979065, "last_edit_date": 1495541807, "question_id": 37382843, "link": "https://stackoverflow.com/questions/37382843/commands-in-separate-modules", "title": "Commands in separate modules", "body": "<p>After viewing the go tool source code, along with reading this SO answer (and the linked article):\n<a href=\"https://stackoverflow.com/questions/14867452/what-is-a-sensible-way-to-layout-a-go-project\">What is a sensible way to layout a Go project</a> (Separate your binary from your application)</p>\n\n<p>E.g. the following setup:</p>\n\n<pre><code>myapp/\n  cmd/\n    first/\n      main.go\n    second/\n      main.go\n    third/\n      main.go\n  otherpackage/\n</code></pre>\n\n<p>I am curious as to how you would go about implementing/building/debugging such a solution?</p>\n\n<p>Am I supposed to have a main.go in the root which then somehow executes the different packages in the cmd directory depending on which command the user runs? Or how do I build this multi-command package without a 'main' package in root?</p>\n"}, {"tags": ["memory", "go", "buffer", "zlib"], "comments": [{"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1463979132, "post_id": 37382600, "comment_id": 62276196, "body": "What about draining the buffer using b.WriteTo(os.stdout) ?"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1463979669, "post_id": 37382600, "comment_id": 62276351, "body": "How are you measuring memory usage?"}, {"owner": {"reputation": 379, "user_id": 1405695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iChib.jpg?s=128&g=1", "display_name": "JohnGalt", "link": "https://stackoverflow.com/users/1405695/johngalt"}, "edited": false, "score": 0, "creation_date": 1463980548, "post_id": 37382600, "comment_id": 62276620, "body": "I placed a pause (waiting for user input) before and after this statement and watch the process memory grow in between. I check it in SysInternals ProcessExplorer in column &quot;WorkingSetSize&quot; and &quot;PrivateBytes&quot;."}, {"owner": {"reputation": 379, "user_id": 1405695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iChib.jpg?s=128&g=1", "display_name": "JohnGalt", "link": "https://stackoverflow.com/users/1405695/johngalt"}, "edited": false, "score": 0, "creation_date": 1463980849, "post_id": 37382600, "comment_id": 62276709, "body": "Thanks khrm, good idea - I tried to add <code>b.WriteTo(ioutil.Discard)</code> without success."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1463995845, "post_id": 37382600, "comment_id": 62284404, "body": "@JohnGalt This is <i>not</i> the proper way to check if memory is collected by the GC. Stop worrying. The GC collects unused memory and might or might not hand it back to the OS which is fine."}], "answers": [{"comments": [{"owner": {"reputation": 379, "user_id": 1405695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iChib.jpg?s=128&g=1", "display_name": "JohnGalt", "link": "https://stackoverflow.com/users/1405695/johngalt"}, "edited": false, "score": 0, "creation_date": 1463978286, "post_id": 37382627, "comment_id": 62276027, "body": "I even put everything in a separate function, call the garbage collector after returning from the function by runtime.GC() and it does not get cleaned up by the garbage collector"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 379, "user_id": 1405695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iChib.jpg?s=128&g=1", "display_name": "JohnGalt", "link": "https://stackoverflow.com/users/1405695/johngalt"}, "edited": false, "score": 1, "creation_date": 1464007425, "post_id": 37382627, "comment_id": 62291935, "body": "@JohnGalt: it&#39;s not the garbage collector&#39;s job to free memory. The heap scavenger may offer free memory back to the OS when it runs, but that has nothing to do with GC."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 3, "last_activity_date": 1463977416, "creation_date": 1463977416, "answer_id": 37382627, "question_id": 37382600, "link": "https://stackoverflow.com/questions/37382600/cannot-free-memory-once-occupied-by-bytes-buffer/37382627#37382627", "title": "Cannot free memory once occupied by bytes.Buffer", "body": "<p>It will eventually get released when nothing references it anymore, Go has a rather decent GC.</p>\n"}, {"comments": [{"owner": {"reputation": 379, "user_id": 1405695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iChib.jpg?s=128&g=1", "display_name": "JohnGalt", "link": "https://stackoverflow.com/users/1405695/johngalt"}, "edited": false, "score": 0, "creation_date": 1464009099, "post_id": 37383604, "comment_id": 62293058, "body": "Thanks you very much - that helped"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 37, "last_activity_date": 1464010981, "last_edit_date": 1495540048, "creation_date": 1463983552, "answer_id": 37383604, "question_id": 37382600, "link": "https://stackoverflow.com/questions/37382600/cannot-free-memory-once-occupied-by-bytes-buffer/37383604#37383604", "title": "Cannot free memory once occupied by bytes.Buffer", "body": "<p>Some things to clear. Go is a garbage collected language, which means that memory allocated and used by variables is automatically freed by the garbage collector when those variables become unreachable (if you have another pointer to the variable, that still counts as \"reachable\").</p>\n\n<p>Freed memory does not mean it is returned to the OS. Freed memory means the memory can be reclaimed, reused for another variable if there is a need. So from the operating system you won't see memory decreasing right away just because some variable became unreachable and the garbage collector detected this and freed memory used by it.</p>\n\n<p>The Go runtime will however return memory to the OS if it is not used for some time (which is usually around 5 minutes). If the memory usage increases during this period (and optionally shrinks again), the memory will most likely not be returned to the OS.</p>\n\n<p>If you wait some time and not allocate memory again, freed memory will be returned to the OS eventually (obviously not all, but unused \"big chunks\" will be). If you can't wait for this to happen, you may call <a href=\"https://golang.org/pkg/runtime/debug/#FreeOSMemory\" rel=\"noreferrer\"><code>debug.FreeOSMemory()</code></a> to force this behavior:</p>\n\n<blockquote>\n  <p>FreeOSMemory forces a garbage collection followed by an attempt to return as much memory to the operating system as possible. (Even if this is not called, the runtime gradually returns memory to the operating system in a background task.)</p>\n</blockquote>\n\n<p>Check out this kind of old but really informative question+answers:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/24376817/go-1-3-garbage-collector-not-releasing-server-memory-back-to-system\">Go 1.3 Garbage collector not releasing server memory back to system</a></p>\n"}], "owner": {"reputation": 379, "user_id": 1405695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/iChib.jpg?s=128&g=1", "display_name": "JohnGalt", "link": "https://stackoverflow.com/users/1405695/johngalt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13000, "favorite_count": 7, "accepted_answer_id": 37383604, "answer_count": 2, "score": 8, "last_activity_date": 1611565447, "creation_date": 1463977189, "last_edit_date": 1511447006, "question_id": 37382600, "link": "https://stackoverflow.com/questions/37382600/cannot-free-memory-once-occupied-by-bytes-buffer", "title": "Cannot free memory once occupied by bytes.Buffer", "body": "<p>I receive bytes of compressed ASCII text in <code>compressedbytes</code> of type []byte. The problem I face is that the following procedure occupies a lot of memory that does not get freed after the function reaches its end and remains occupied during the whole runtime of the program.</p>\n\n<pre><code>    b := bytes.NewReader(compressedbytes)\n    r, err := zlib.NewReader(b)\n    if err != nil {\n        panic(err)\n    }\n    cleartext, err = ioutil.ReadAll(r)\n    if err != nil {\n        panic(err)\n    }\n</code></pre>\n\n<p>I noticed that the type in use is <code>bytes.Buffer</code> and this type has the <code>Reset()</code> and <code>Truncate()</code> functions but none of them allows to free the memory that is once occupied.</p>\n\n<p>The <a href=\"https://golang.org/pkg/bytes/#Buffer.Reset\" rel=\"noreferrer\">documentation</a> of <code>Reset()</code> states the following:</p>\n\n<blockquote>\n  <p>Reset resets the buffer to be empty, but it retains the underlying storage for use by future writes. Reset is the same as Truncate(0).</p>\n</blockquote>\n\n<p>How can I unset the buffer and free the memory again?\nMy program needs about 50MB of memory during the run that takes 2h. When I import strings that are zlib compressed the program needs 200 MB of memory.</p>\n\n<p>Thanks for your help.</p>\n\n<p>=== Update</p>\n\n<p>I even created a separate function for the decompression and call the garbage collector manually with <code>runtime.GC()</code> after the program returns from that function without success. </p>\n\n<pre><code>// unpack decompresses zlib compressed bytes\nfunc unpack(packedData []byte) []byte {\n    b := bytes.NewReader(packedData)\n    r, err := zlib.NewReader(b)\n    if err != nil {\n        panic(err)\n    }\n    cleartext, err := ioutil.ReadAll(r)\n    if err != nil {\n        panic(err)\n    }\n    r.Close()\n    return cleartext\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1463971443, "post_id": 37381776, "comment_id": 62274614, "body": "why share fd? reuse port should be the the thing you need."}, {"owner": {"reputation": 1, "user_id": 6369152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5d433f110d40a9b8f71aef6a2c4103b?s=128&d=identicon&r=PG&f=1", "display_name": "RuinanChen", "link": "https://stackoverflow.com/users/6369152/ruinanchen"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1463972186, "post_id": 37381776, "comment_id": 62274789, "body": "I want to gracefull restart golang server.I listen a fd in master process, fork a child process inherit the fd and only the child accept connection.When i restart, I want to firstly fork new master process and child process which inherit the listen fd from old master&#39;s listen fd.Do this, in any time listen port is alive. And why two processes alive: I want to master monitor child, if child process crash, master process can start a new child process inmediately."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1463972465, "post_id": 37381776, "comment_id": 62274851, "body": "it&#39;s not a problem, add a system scope lock before <code>accept</code> in you processes."}, {"owner": {"reputation": 1, "user_id": 6369152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5d433f110d40a9b8f71aef6a2c4103b?s=128&d=identicon&r=PG&f=1", "display_name": "RuinanChen", "link": "https://stackoverflow.com/users/6369152/ruinanchen"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1463973507, "post_id": 37381776, "comment_id": 62275080, "body": "I has try somes: If master process is alive, only it can accept connection; it is killed, child do it."}, {"owner": {"reputation": 1, "user_id": 6369152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5d433f110d40a9b8f71aef6a2c4103b?s=128&d=identicon&r=PG&f=1", "display_name": "RuinanChen", "link": "https://stackoverflow.com/users/6369152/ruinanchen"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1463992445, "post_id": 37381776, "comment_id": 62282225, "body": "sorry, I check again, It is ok."}], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": false, "score": 0, "last_activity_date": 1464097833, "creation_date": 1464097833, "answer_id": 37415652, "question_id": 37381776, "link": "https://stackoverflow.com/questions/37381776/how-can-master-process-and-child-process-share-listen-fd-and-accept-new-connecti/37415652#37415652", "title": "How can master process and child process share listen fd and accept new connection in golang?", "body": "<p>Kill off your master - let your child handle the new connections (the child will become the master).</p>\n\n<p><a href=\"http://grisha.org/blog/2014/06/03/graceful-restart-in-golang/\" rel=\"nofollow\">http://grisha.org/blog/2014/06/03/graceful-restart-in-golang/</a></p>\n\n<p>As a side note...</p>\n\n<p>I did this for a little while, graceful restarting the service on dedicated servers and VMs.  But I always ran into issues with Canary Testing and Blue/Green deployments, trying out new code in a staging environment before I flipped the switch for it to go live.  It gets rather difficult once you are running 200 instances of your app (or really, more than 2 or 3!). </p>\n\n<p>I always thought it was imperative that I manage all connections and don't drop a single package on my dedicated VMs.  But learning to use the managed cloud tools Amazon's Elastic Beanstalk and Azure Websites for packaging up executables (and now, Docker support in Beanstalk) and deploying them on new VMs, and throwing away the old VMs, it really freed me from this burden at scale.  I just let Amazon handle the \"spinning up\" and \"shutting down\" of the docker instances on different VMs, deleting the old ones.  It will deploy your new code on the new VMs, and will keep the old ones active until there are no more connections through the load balancer.  Then it finally shuts down the old ones.  Zero dropped connections, zero issues.</p>\n\n<p>By switching to these managed approaches, you gain the ability to test our code in limited traffic (say 5% of traffic directed to the new version of the services, where you can canary test), you can gracefully roll out new versions, or even do a hard switch of all new connections going to the new system.</p>\n\n<p>Just trying to save you a few years of heartache and lessons learned.  :)</p>\n"}], "owner": {"reputation": 1, "user_id": 6369152, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5d433f110d40a9b8f71aef6a2c4103b?s=128&d=identicon&r=PG&f=1", "display_name": "RuinanChen", "link": "https://stackoverflow.com/users/6369152/ruinanchen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464097833, "creation_date": 1463970348, "question_id": 37381776, "link": "https://stackoverflow.com/questions/37381776/how-can-master-process-and-child-process-share-listen-fd-and-accept-new-connecti", "title": "How can master process and child process share listen fd and accept new connection in golang?", "body": "<p>I've been stucked with this issue for days:</p>\n\n<p>I listen a port with a fd in master process. Then I fork a new child process which inhert the fd.</p>\n\n<p>I don't want to kill the master process, and How can I accept connections no mattter in master process or child process????</p>\n\n<p>I has try somes: If master process is alive, only it can accept connection; it is killed, child do it.</p>\n\n<p>My golang's version is 1.6.2.</p>\n\n<p>Thx, Look forward to your reply\uff01\uff01\uff01</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2966, "user_id": 2190546, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6451296ba1e76dc99cace352b93b5488?s=128&d=identicon&r=PG", "display_name": "J Freebird", "link": "https://stackoverflow.com/users/2190546/j-freebird"}, "edited": false, "score": 0, "creation_date": 1463957100, "post_id": 37380205, "comment_id": 62271782, "body": "It seems that <code>for</code> loop inside the goroutine runs forever?  If I have <code>top.Process.Signal(os.Kill)</code>, then how to stop that goroutine accordingly? Thanks."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 2966, "user_id": 2190546, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6451296ba1e76dc99cace352b93b5488?s=128&d=identicon&r=PG", "display_name": "J Freebird", "link": "https://stackoverflow.com/users/2190546/j-freebird"}, "edited": false, "score": 0, "creation_date": 1463957960, "post_id": 37380205, "comment_id": 62271949, "body": "@JFreebird <code>sc.Scan()</code> will return false since the reader will return <code>io.EOF</code> and it will exit."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 1, "last_activity_date": 1463955227, "creation_date": 1463955227, "answer_id": 37380205, "question_id": 37379940, "link": "https://stackoverflow.com/questions/37379940/go-prepend-content-to-outputs-from-top/37380205#37380205", "title": "Go: Prepend Content to Outputs from Top", "body": "<p>Something along the lines of:</p>\n\n<pre><code>func main() {\n    for ln := range topMon(2543) {\n        fmt.Println(time.Now().UTC().Format(time.RFC3339), ln)\n    }\n}\n\nfunc topMon(pids ...int) &lt;-chan string {\n    ch := make(chan string, 1)\n    top := exec.Command(\"top\", \"-b\")\n    for _, pid := range pids {\n        top.Args = append(top.Args, \"-p\", strconv.Itoa(pid))\n    }\n    r, w, _ := os.Pipe()\n    go func() {\n        sc := bufio.NewScanner(r)\n        for sc.Scan() {\n            ch &lt;- sc.Text()\n        }\n        close(ch)\n    }()\n    top.Stdout = w\n    top.Stderr = os.Stderr\n    if err := top.Start(); err != nil {\n        panic(err)\n    }\n    return ch\n}\n</code></pre>\n\n<p>The channel usage is just an example, you can just return the rwader from the pipe directly.</p>\n"}], "owner": {"reputation": 2966, "user_id": 2190546, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6451296ba1e76dc99cace352b93b5488?s=128&d=identicon&r=PG", "display_name": "J Freebird", "link": "https://stackoverflow.com/users/2190546/j-freebird"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 37380205, "answer_count": 1, "score": 0, "last_activity_date": 1463955227, "creation_date": 1463953298, "question_id": 37379940, "link": "https://stackoverflow.com/questions/37379940/go-prepend-content-to-outputs-from-top", "title": "Go: Prepend Content to Outputs from Top", "body": "<p>In my go program, I need to run <code>top</code> to continuously monitoring a specific process.  But <code>top</code> does not give me the timestamp when each line is recorded.  I'm thinking about prepending it to the outputs my self:</p>\n\n<pre><code>top := exec.Command(\"top\", \"-p\", pid)\nr, w := os.Pipe()\ntop.Stdout = w\ntop.Start()\n</code></pre>\n\n<p>This way I can read the outputs from <code>r</code> at one end of the pipe.  I wonder how can I fire an action to get the current timestamp and prepend it to the output whenever there's a new line from <code>top.Stdout</code>?  I think it should be like a callback or Python's generator, but I'm not sure how to do it in Go.</p>\n"}, {"tags": ["go", "struct", "switch-statement", "client"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1463966012, "post_id": 37379706, "comment_id": 62273520, "body": "I&#39;d say this is a feature request, any answer here would be a pure hack. You should file an <a href=\"https://github.com/njasm/gosoundcloud/issues\" rel=\"nofollow noreferrer\">issue</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "edited": false, "score": 0, "creation_date": 1464044240, "post_id": 37397067, "comment_id": 62312128, "body": "I think this changes much more than just the Transport"}], "tags": [], "owner": {"reputation": 1153, "user_id": 1371064, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/NnrmE.jpg?s=128&g=1", "display_name": "Carlos Andr&#233;s Garc&#237;a", "link": "https://stackoverflow.com/users/1371064/carlos-andr%c3%a9s-garc%c3%ada"}, "is_accepted": false, "score": 1, "last_activity_date": 1464024453, "creation_date": 1464024453, "answer_id": 37397067, "question_id": 37379706, "link": "https://stackoverflow.com/questions/37379706/golang-changing-structs-of-custom-clients-maxidleconnsperhost/37397067#37397067", "title": "Golang, changing structs of custom clients MaxIdleConnsPerHost", "body": "<p>How about:</p>\n\n<pre><code>tr := &amp;http.Transport{DisableKeepAlives: false, MaxIdleConnsPerHost:250} \nclient := &amp;http.Client{Transport: tr}\n</code></pre>\n\n<p>And assing <code>client</code> to <code>SoundcloudApi.httpClient</code> </p>\n"}, {"tags": [], "owner": {"reputation": 431, "user_id": 1363688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/054bce579d597ac3f559aad8ebd7d287?s=128&d=identicon&r=PG", "display_name": "njasm", "link": "https://stackoverflow.com/users/1363688/njasm"}, "is_accepted": false, "score": 1, "last_activity_date": 1464994656, "creation_date": 1464994656, "answer_id": 37624583, "question_id": 37379706, "link": "https://stackoverflow.com/questions/37379706/golang-changing-structs-of-custom-clients-maxidleconnsperhost/37624583#37624583", "title": "Golang, changing structs of custom clients MaxIdleConnsPerHost", "body": "<p>I'm the creator of the gosoundcloud..</p>\n\n<p>First of all thanks for using the library. </p>\n\n<p>Second, as @OneOfOne pointed out, I too believe that any answer to your needs here will be a workaround that we can probably fix with a feature request.</p>\n\n<p>So, I invite you to file an <a href=\"https://github.com/njasm/gosoundcloud/issues\" rel=\"nofollow\">issue</a> to discuss the issue further.</p>\n\n<p>I'll be more then glad to help out.</p>\n"}], "owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1464994656, "creation_date": 1463951441, "last_edit_date": 1463952025, "question_id": 37379706, "link": "https://stackoverflow.com/questions/37379706/golang-changing-structs-of-custom-clients-maxidleconnsperhost", "title": "Golang, changing structs of custom clients MaxIdleConnsPerHost", "body": "<p>I want to set a custom http client to get several http requests concurrently.\nHowever, I'm relatively new to Golang and I'm facing issues with changing the struct of the clients and the feasibility of what I want to do.</p>\n\n<p>I want to change the Transport of s with the one I created.</p>\n\n<p>A simplified version of my script is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"github.com/njasm/gosoundcloud\"\n)\n\nfunc main() {\n    s, err := gosoundcloud.NewSoundcloudApi(\"client_id\", \"client_secret\", nil)\n    if err != nil {\n        panic(err)\n    }\n\n   if err = s.PasswordCredentialsToken(\"user@mail.com\", \"password\"); err!= nil {\n    fmt.Println(err)\n    os.Exit(1)\n    }\n\n    var userID uint64 = 1\n    Transport, ok := http.DefaultTransport.(*http.Transport)\n    if !ok {\n        fmt.Println(\"http.DefaultClient is not an http.Client\")\n        os.Exit(1)\n    }\n    Transport.MaxIdleConnsPerHost = 250\n    //Here I would like to change s'Transport so that it handles 250 MaxIdleConns\n    member, err := s.GetUser(userID)\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    fmt.Println(member)\n}\n</code></pre>\n\n<p>Here are the structs for s</p>\n\n<pre><code>type SoundcloudApi struct {\nconf       *oauth2.Config\nhttpClient *http.Client\nresponse   *http.Response\n}\n</code></pre>\n\n<p>References:</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"nofollow\">https://golang.org/pkg/net/http/#Client</a>\n<a href=\"https://godoc.org/github.com/njasm/gosoundcloud#SoundcloudApi\" rel=\"nofollow\">https://godoc.org/github.com/njasm/gosoundcloud#SoundcloudApi</a></p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1463969360, "post_id": 37379548, "comment_id": 62274215, "body": "You can wrap the <code>http.ResponseWriter</code> - doing something like <a href=\"https://godoc.org/github.com/zenazn/goji/web/mutil#WrapWriter\" rel=\"nofollow noreferrer\">godoc.org/github.com/zenazn/goji/web/mutil#WrapWriter</a> - and then write what you want from within your own <code>WriteHeader</code> or <code>Write</code> method."}], "owner": {"reputation": 2626, "user_id": 1400204, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/T8OEV.jpg?s=128&g=1", "display_name": "Anuruddha", "link": "https://stackoverflow.com/users/1400204/anuruddha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1533, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1464009403, "creation_date": 1463950383, "question_id": 37379548, "link": "https://stackoverflow.com/questions/37379548/how-to-dump-both-http-request-and-response-in-golang", "title": "How to dump both HTTP request and response in golang", "body": "<p>I'm using gorilla web tool kit. There's a <a href=\"http://www.gorillatoolkit.org/pkg/handlers#LoggingHandler\" rel=\"nofollow\">LoggingHandler</a> available in the handler package, however it can only log the request data via the handler.</p>\n\n<pre><code>r := mux.NewRouter()\nr.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"This is a catch-all route\"))\n})\n// This can only log the request, how can we log the response?\nloggedRouter := handlers.LoggingHandler(os.Stdout, r) \nhttp.ListenAndServe(\":1123\", loggedRouter)\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/net/http/httputil/#DumpRequest\" rel=\"nofollow\">httputil</a> has the same feature available via DumpRequest(). In my case client is a browser, and I'm looking for a handler approach to log the response rather than logging it inside each and every handler.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 0, "creation_date": 1463950302, "post_id": 37379450, "comment_id": 62270068, "body": "Perhaps it&#39;s only for the sake of the example but please always check your errors. Assigning them to _ will never make your life better."}, {"owner": {"reputation": 3621, "user_id": 999248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/G9pId.jpg?s=128&g=1", "display_name": "robstarbuck", "link": "https://stackoverflow.com/users/999248/robstarbuck"}, "reply_to_user": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 0, "creation_date": 1463950787, "post_id": 37379450, "comment_id": 62270215, "body": "Thanks Snowman, you&#39;re correct, it was for the sake of the example."}], "answers": [{"comments": [{"owner": {"reputation": 3621, "user_id": 999248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/G9pId.jpg?s=128&g=1", "display_name": "robstarbuck", "link": "https://stackoverflow.com/users/999248/robstarbuck"}, "edited": false, "score": 0, "creation_date": 1463951482, "post_id": 37379650, "comment_id": 62270441, "body": "Makes sense! Thanks kindly noisypixy, I can sleep tonight! Regards."}], "tags": [], "owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "is_accepted": true, "score": 2, "last_activity_date": 1463951061, "creation_date": 1463951061, "answer_id": 37379650, "question_id": 37379450, "link": "https://stackoverflow.com/questions/37379450/instantiating-stucts-and-arrays-doesnt-create-new-references/37379650#37379650", "title": "Instantiating Stucts and Arrays doesn&#39;t create new references", "body": "<p>Inside the <code>for</code> loop, take a closer look to this part:</p>\n\n<pre><code>// If it's a blank line\nif rgxRoot.MatchString(linetext) {\n    rule := &amp;Section{} // Notice the `:=`\n    rule.Category = linetext\n}\n</code></pre>\n\n<p>You're basically creating a new <code>rule</code> variable in the scope of that <code>if</code>, when you probably want to reuse the one you have already created outside the <code>for</code> loop.</p>\n\n<p>So, try changing it to:</p>\n\n<pre><code>// If it's a blank line\nif rgxRoot.MatchString(linetext) {\n    rule = &amp;Section{} // Notice the `=`\n    rule.Category = linetext\n}\n</code></pre>\n"}], "owner": {"reputation": 3621, "user_id": 999248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/G9pId.jpg?s=128&g=1", "display_name": "robstarbuck", "link": "https://stackoverflow.com/users/999248/robstarbuck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23, "favorite_count": 0, "accepted_answer_id": 37379650, "answer_count": 1, "score": 0, "last_activity_date": 1463951061, "creation_date": 1463949721, "question_id": 37379450, "link": "https://stackoverflow.com/questions/37379450/instantiating-stucts-and-arrays-doesnt-create-new-references", "title": "Instantiating Stucts and Arrays doesn&#39;t create new references", "body": "<p>I'm attempting to convert a simple markdown file into json, the markdown looks something like this:</p>\n\n<pre><code>#TITLE 1\n- Line 1\n- Line 2\n- Line 3\n\n#TITLE 2\n- Line 1\n- Line 2\n- Line 3\n&lt;!-- blank line --&gt;\n</code></pre>\n\n<p>I can't understand what's required to refactor the following in <strong>func main()</strong>:</p>\n\n<pre><code>    type Section struct {\n        Category string\n        Lines    []string\n    }\n\n    file, _ := os.Open(\"./src/basicmarkdown/basicmarkdown.md\")\n\n    defer file.Close()\n\n    rgxRoot, _ := regexp.Compile(\"^#[^#]\")\n    rgxBehaviour, _ := regexp.Compile(\"^-[ ]?.*\")\n\n    scanner := bufio.NewScanner(file)\n\n    ruleArr := []*Section{}\n    rule := &amp;Section{}\n\n    for scanner.Scan() {\n\n        linetext := scanner.Text()\n\n        // If it's a blank line\n        if rgxRoot.MatchString(linetext) {\n            rule := &amp;Section{}\n            rule.Category = linetext\n        }\n\n        if rgxBehaviour.MatchString(linetext) {\n            rule.Lines = append(rule.Lines, linetext)\n        }\n\n        if len(strings.TrimSpace(linetext)) == 0 {\n            ruleArr = append(ruleArr, rule)\n        }\n\n    }\n\n    jsonSection, _ := json.MarshalIndent(ruleArr, \"\", \"\\t\")\n    fmt.Println(string(jsonSection))\n</code></pre>\n\n<p>The code above outputs:</p>\n\n<pre><code>[\n{\n        \"Category\": \"\",\n        \"Lines\": [\n            \"- Line 1\",\n            \"- Line 2\",\n            \"- Line 3\",\n            \"- Line 1\",\n            \"- Line 2\",\n            \"- Line 3\"\n        ]\n    },\n    {\n        \"Category\": \"\",\n        \"Lines\": [\n            \"- Line 1\",\n            \"- Line 2\",\n            \"- Line 3\",\n            \"- Line 1\",\n            \"- Line 2\",\n            \"- Line 3\"\n        ]\n    }\n]\n</code></pre>\n\n<p>When I was hoping to output:</p>\n\n<pre><code>[\n    {\n        \"Category\": \"#TITLE 1\",\n        \"Lines\": [\n            \"- Line 1\",\n            \"- Line 2\",\n            \"- Line 3\"\n        ]\n    },\n    {\n        \"Category\": \"#TITLE 2\",\n        \"Lines\": [,\n            \"- Line 1\",\n            \"- Line 2\",\n            \"- Line 3\"\n        ]\n    }\n]\n</code></pre>\n\n<p>Couple of things wrong for sure. Please excuse the verbosity of the question, hard to explain without an example when you're a noob. Thanks in advance.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": true, "score": 1, "last_activity_date": 1463972966, "last_edit_date": 1463972966, "creation_date": 1463947177, "answer_id": 37379049, "question_id": 37378775, "link": "https://stackoverflow.com/questions/37378775/go-act-on-signal-while-not-blocking-operations/37379049#37379049", "title": "Go: Act on Signal while not Blocking Operations", "body": "<p>One way that you could achieve this is by utilizing the for/select timeout  idiom, there are a couple of similar methods of doing this. Take this trivial example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    abort := make(chan struct{})\n\n    go func() {\n        for {\n            select {\n            case &lt;-abort:\n                return\n            case &lt;-time.After(1 * time.Second):\n                // replace fmt.Println() with the command you wish to run\n                fmt.Println(\"tick\")\n            }\n        }\n    }()\n    // replace time.Sleep() with code waiting for 'abort' command input\n    time.Sleep(10 * time.Second)\n    abort &lt;- struct{}{}\n}\n</code></pre>\n\n<p>To modify this example to work in your circumstance place the code that you want to run in the <code>&lt;-time.After():</code> case, which (in this instance) will run once per second, if no other case is available to receive for that duration. And instead of <code>time.Sleep()</code> which I placed at the end, put the code that will interrupt the  <code>&lt;-time.After():</code> case, sending <code>&lt;- struct{}{}</code> on the <code>abort</code> channel (or whatever you name it).</p>\n\n<p>NOTE: In an earlier version of this answer I had abort as a <code>chan bool</code>, as I like the clarity of <code>&lt;-abort true</code> and don't consider  <code>chan struct{}</code> to be as clear, I opted to change it in this example however, as <code>&lt;- struct{}{}</code> isn't unclear, especially once you've gotten used to the pattern.</p>\n\n<p>Also, if you want the command to execute on each iteration of the for loop and not wait for a timeout then you can make that case <code>default:</code>, remove <code>&lt;-time.After()</code> and it will run on each iteration of the loop where another channel is not ready to receive.</p>\n\n<p>You can play with this example in the <a href=\"https://play.golang.org/p/8R3FElLtI-\" rel=\"nofollow\">playground</a> if you'd like, although it will not allow syscalls, or the <code>default:</code> case example to be run in that environment.</p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1463948805, "creation_date": 1463948805, "answer_id": 37379300, "question_id": 37378775, "link": "https://stackoverflow.com/questions/37378775/go-act-on-signal-while-not-blocking-operations/37379300#37379300", "title": "Go: Act on Signal while not Blocking Operations", "body": "<p>To run it over and over, without sleep:</p>\n\n<pre><code>func run(stop &lt;-chan struct{}) {\n    ps := exec.Command(\"ps\")\n    for {\n        select {\n        case &lt;-stop:\n            return\n        default:\n            ps.Run()\n            //processing the output\n        }\n    }\n}\n</code></pre>\n\n<p>And then <code>go run(stop)</code>. And to run it every 3 seconds (for example):</p>\n\n<pre><code>func run(stop &lt;-chan struct{}) {\n    ps := exec.Command(\"ps\")\n    tk := time.Tick(time.Second * 3)\n    for {\n        select {\n        case &lt;-stop:\n            return\n        case &lt;-tk:\n            ps.Run()\n            //processing the output\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2966, "user_id": 2190546, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6451296ba1e76dc99cace352b93b5488?s=128&d=identicon&r=PG", "display_name": "J Freebird", "link": "https://stackoverflow.com/users/2190546/j-freebird"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 37379049, "answer_count": 2, "score": 2, "last_activity_date": 1463972966, "creation_date": 1463945679, "question_id": 37378775, "link": "https://stackoverflow.com/questions/37378775/go-act-on-signal-while-not-blocking-operations", "title": "Go: Act on Signal while not Blocking Operations", "body": "<p>I want to fire the <code>ps</code> command continuously in a goroutine to monitor mem and cpu usages.  I didn't use <code>top</code> because <code>top</code> doesn't allow me to select columns as <code>ps</code> does.  This goroutine needs to receive a stop signal to stop the <code>command</code>, but I don't know how not to block running the command while waiting the signal. For <code>top</code> I can do:</p>\n\n<pre><code>top := exec.Command(\"top\")\n&lt;-stop // blocking\ntop.Process.Signal(os.Kill)\n</code></pre>\n\n<p>But for <code>ps</code> if I do:</p>\n\n<pre><code>ps := exec.Command(\"ps\")\nfor {\n    ps.Run()\n    &lt;-stop\n}\n</code></pre>\n\n<p>The above code will block on <code>stop</code>. I want to keep firing <code>ps.Run()</code>, while being able to stop when a stop signal is ready.  Thanks.</p>\n"}, {"tags": ["c", "dll", "go", "cgo", "lib-nfc"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1463935612, "post_id": 37376935, "comment_id": 62265234, "body": "I wrote Go bindings for the libnfc a while ago. Maybe you can use them."}, {"owner": {"reputation": 51, "user_id": 5481288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bef1970ab90b4e067f45945ff3d77940?s=128&d=identicon&r=PG&f=1", "display_name": "qwelp", "link": "https://stackoverflow.com/users/5481288/qwelp"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1463937187, "post_id": 37376935, "comment_id": 62265767, "body": "Yes I also tried to use this bindings.   Install it by go get and  write test program      package main     import &quot;github.com/fuzxxl/nfc&quot;     import &quot;fmt&quot;      func main() {     res:= nfc.Version()     fmt.Printf(res)     }  But I couldn&#39;t managed to build it.  Could you describe some steps in order to use your library?"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1463937243, "post_id": 37376935, "comment_id": 62265787, "body": "well, where did it fail? Do you have the libnfc installed and set up so the Go compiler finds it? Have you ever worked with DLLs before?"}, {"owner": {"reputation": 51, "user_id": 5481288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bef1970ab90b4e067f45945ff3d77940?s=128&d=identicon&r=PG&f=1", "display_name": "qwelp", "link": "https://stackoverflow.com/users/5481288/qwelp"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1463939111, "post_id": 37376935, "comment_id": 62266368, "body": "Now I create env variable LIBRARY_PATH and point it to libnfc.lib file So Go compiler find it and successfully build app, but I get same error when try to start it &quot;This application has failed to start because (null).DLL was not found.&quot;"}, {"owner": {"reputation": 51, "user_id": 5481288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bef1970ab90b4e067f45945ff3d77940?s=128&d=identicon&r=PG&f=1", "display_name": "qwelp", "link": "https://stackoverflow.com/users/5481288/qwelp"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1463939174, "post_id": 37376935, "comment_id": 62266392, "body": "When I try to register libnfc.dll by  <code>regsvr32.exe libnfc.dll</code>  I get error:  DllRegisterServer entry point was not found"}, {"owner": {"reputation": 51, "user_id": 5481288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bef1970ab90b4e067f45945ff3d77940?s=128&d=identicon&r=PG&f=1", "display_name": "qwelp", "link": "https://stackoverflow.com/users/5481288/qwelp"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1464002457, "post_id": 37376935, "comment_id": 62288580, "body": "It seems that error occurs due to libnfc.dll compiled as 32bit dll. Go compiler couldn&#39;t use 32bit library with 64bit application.  I tried to make 32bit Go app using &quot;Set GOARCH=386&quot; but pakages with cgo don&#39;t support this option. So the only option is to try to compile libnfc as 64bit library under Windows.  Any ideas how to do that?  I use this tutorial in order to compile it under Windows <a href=\"http://www.mobilefish.com/developer/libnfc/libnfc.html\" rel=\"nofollow noreferrer\">mobilefish.com/developer/libnfc/libnfc.html</a>"}], "owner": {"reputation": 51, "user_id": 5481288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bef1970ab90b4e067f45945ff3d77940?s=128&d=identicon&r=PG&f=1", "display_name": "qwelp", "link": "https://stackoverflow.com/users/5481288/qwelp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 756, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1463935330, "creation_date": 1463935330, "question_id": 37376935, "link": "https://stackoverflow.com/questions/37376935/using-libnfc-with-golang", "title": "Using libnfc with golang", "body": "<p>I successfully compiled libnfc written in C under Windows.\nAfter compilation I get 3 files: libnfc.dll, libnfc.dll.a, libnfc.lib.\nI want to call functions of this library in my Go application.\nMy test program</p>\n\n<pre><code>package main\n/*\n#cgo CFLAGS: -I .\n#cgo LDFLAGS: -L . -lnfc\n#include &lt;nfc/nfc.h&gt;\n*/\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n  res:= C.nfc_version() \n  fmt.Printf(C.GoString(res))\n}\n</code></pre>\n\n<p>nfc_version - name of function available in library.\nI put libnfc.lib file in directory with go source and also copy folder nfc with header files.\n(If I put libnfc.dll or libnfc.dll.a instead of libnfc.lib - I get error message library not found.)\nThen I run </p>\n\n<pre><code>go build\n</code></pre>\n\n<p>Go successfully compiled program, but when I try to start it I get error: \"This application has failed to start because (null).DLL was not found.\"\nHow to properly use library with golang application?</p>\n"}, {"tags": ["go", "interface"], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 1972465, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a05eac78d04217088658b20b38a7ca83?s=128&d=identicon&r=PG", "display_name": "mzdravkov", "link": "https://stackoverflow.com/users/1972465/mzdravkov"}, "edited": false, "score": 0, "creation_date": 1463935393, "post_id": 37376653, "comment_id": 62265159, "body": "Yes, this seems to be the best solution in the general case. However my case is a little bit special, so I think I&#39;ll just drop the MyInterface in favor of interface{} and use reflection to force-call MyMethod on it."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 135, "user_id": 1972465, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a05eac78d04217088658b20b38a7ca83?s=128&d=identicon&r=PG", "display_name": "mzdravkov", "link": "https://stackoverflow.com/users/1972465/mzdravkov"}, "edited": false, "score": 4, "creation_date": 1463935526, "post_id": 37376653, "comment_id": 62265206, "body": "@mzdravkov I&#39;d run benchmarks, because I&#39;d almost bet using my method would be a hell lot faster than using reflection."}, {"owner": {"reputation": 135, "user_id": 1972465, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a05eac78d04217088658b20b38a7ca83?s=128&d=identicon&r=PG", "display_name": "mzdravkov", "link": "https://stackoverflow.com/users/1972465/mzdravkov"}, "edited": false, "score": 1, "creation_date": 1463936174, "post_id": 37376653, "comment_id": 62265444, "body": "Damn it, you are right. Didn&#39;t thought about the performance of reflection. And I&#39;m writing a game engine :D Although, this is not in a performance critical part... I will think about it. Thanks for the notice."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 4, "last_activity_date": 1463933716, "creation_date": 1463933716, "answer_id": 37376653, "question_id": 37376577, "link": "https://stackoverflow.com/questions/37376577/interface-in-method-signature-inside-interface-definition/37376653#37376653", "title": "Interface in method signature inside interface definition", "body": "<p>Why is this? It's the language design.</p>\n\n<p>Solution would be to match the interface:</p>\n\n<pre><code>type MyType struct{}\n\nfunc (mt *MyType) MyMethod(v interface{}) {\n    v, ok := v.(SomeConcreteType)\n    if !ok {\n        panic(\"!ok\")\n    }\n    v.doStuff()\n}\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 1972465, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a05eac78d04217088658b20b38a7ca83?s=128&d=identicon&r=PG", "display_name": "mzdravkov", "link": "https://stackoverflow.com/users/1972465/mzdravkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27, "favorite_count": 0, "accepted_answer_id": 37376653, "answer_count": 1, "score": -1, "last_activity_date": 1463933716, "creation_date": 1463933321, "question_id": 37376577, "link": "https://stackoverflow.com/questions/37376577/interface-in-method-signature-inside-interface-definition", "title": "Interface in method signature inside interface definition", "body": "<p>I want to have something like this:</p>\n\n<pre><code>type MyInterface interface {\n    MyMetod(interface{})\n}\n</code></pre>\n\n<p>and to have the type</p>\n\n<pre><code>type MyType struct {}\n</code></pre>\n\n<p>with method</p>\n\n<pre><code>func (mt *MyType) MyMethod(SomeConcreteType) {\n   // body\n}\n</code></pre>\n\n<p>implementing <strong>MyInterface</strong>.</p>\n\n<p>But it seems that Go can't handle this. I recieve an error that says that it have <strong>MyMethod(SomeConcreteType)</strong> but it wants <strong>MyMethod(interface{})</strong>. Why is this so, and what would be a good solution to this problem?</p>\n"}, {"tags": ["generics", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 6256602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bafb1aa784e2f486c4fa1c0696e06590?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/6256602/abel"}, "edited": false, "score": 1, "creation_date": 1463933843, "post_id": 37376618, "comment_id": 62264648, "body": "Wow.. ok, I think it would be better to have a separate method for each type :P  Thanks!"}, {"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1463933949, "post_id": 37376618, "comment_id": 62264693, "body": "What about <code>case []float64, []int64, []int: doSmt</code>?"}, {"owner": {"reputation": 133, "user_id": 6256602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bafb1aa784e2f486c4fa1c0696e06590?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/6256602/abel"}, "edited": false, "score": 0, "creation_date": 1463934576, "post_id": 37376618, "comment_id": 62264894, "body": "I tried to run the above code and got <code>invalid argument slice (type interface {}) for len</code>..."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1463935189, "post_id": 37376618, "comment_id": 62265081, "body": "@u_mulder it won&#39;t work, because then slice will be type <code>interface{}</code>."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 5, "last_activity_date": 1463933497, "creation_date": 1463933497, "answer_id": 37376618, "question_id": 37376513, "link": "https://stackoverflow.com/questions/37376513/how-to-accept-different-types-of-slices-in-the-same-function/37376618#37376618", "title": "How to accept different types of slices in the same function?", "body": "<p>Short answer? you can't.</p>\n\n<p>Long answer, you still can't directly do it, BUT:</p>\n\n<pre><code>func removeFrom(slice interface{}, index int) interface{} {\n    switch slice := slice.(type) {\n    case []float64:\n        if len(slice) &gt; index {\n            return append(slice[:index], slice[index+1:]...)\n        }\n    case []int64:\n        if len(slice) &gt; index {\n            return append(slice[:index], slice[index+1:]...)\n        }\n    case []int:\n        if len(slice) &gt; index {\n            return append(slice[:index], slice[index+1:]...)\n        }\n    default:\n        log.Panicf(\"unknown type: %T\", slice)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133, "user_id": 6256602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bafb1aa784e2f486c4fa1c0696e06590?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/6256602/abel"}, "edited": false, "score": 0, "creation_date": 1463954244, "post_id": 37379691, "comment_id": 62271168, "body": "Awesome. That&#39;s what I was looking for. Thanks!"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1463954394, "post_id": 37379691, "comment_id": 62271207, "body": "Note that this horribly slow compared to type assertion."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1463955605, "post_id": 37379691, "comment_id": 62271482, "body": "@OneOfOne This general solution uses reflection, so yes, it will be slower than something that has concrete types &quot;wired in&quot;. &quot;Horribly&quot; is a strong word though, as by that I would expect the difference being order of magnitude(s). Quick benchmarks show the general, reflection solution is 2.5 times slower."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1463955723, "post_id": 37379691, "comment_id": 62271509, "body": "I can&#39;t edit it, but yeah horribly is a strong word, my apologizes."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1557597495, "last_edit_date": 1557597495, "creation_date": 1463951341, "answer_id": 37379691, "question_id": 37376513, "link": "https://stackoverflow.com/questions/37376513/how-to-accept-different-types-of-slices-in-the-same-function/37379691#37379691", "title": "How to accept different types of slices in the same function?", "body": "<p>Go doesn't support generics, there is no \"common ancestor\" for all slice types (<code>[]interface{}</code> is not \"compatible\" with <code>[]int</code> for example, see <a href=\"https://stackoverflow.com/questions/12990338/cannot-convert-string-to-interface\">Cannot convert []string to []interface {}</a> for more details).</p>\n\n<p>So if you want your function to accept any slice types, you have to use <code>interface{}</code> (both for the \"incoming\" parameter and for the return type). But now you have an (interface) wrapper value to which you can't apply slicing and which you can't pass to the builtin <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\"><code>append()</code></a> function.</p>\n\n<p>You could use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> and <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switches</a> for known types, but you would have to repeat code for each, so it's not really a step ahead.</p>\n\n<p>Actually there's a way to create a <code>removeFrom()</code> function that will work for all slice types, with using <em>reflection</em>.</p>\n\n<p><a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a> is a type describing any Go value. It has supporting methods for different types of Go values, including slices.</p>\n\n<p>What's interesting to us is the <a href=\"https://golang.org/pkg/reflect/#Value.Slice\" rel=\"nofollow noreferrer\"><code>Value.Slice()</code></a> method:</p>\n\n<pre><code>func (v Value) Slice(i, j int) Value\n</code></pre>\n\n<p>We can use it to slice a slice. Good. It is a key point in our element-removal algorithm. What's still needed is to \"join\" 2 slices, the one before and the one after the removable element. Luckily the <code>reflect</code> package also has support for this: <a href=\"https://golang.org/pkg/reflect/#AppendSlice\" rel=\"nofollow noreferrer\"><code>reflect.AppendSlice()</code></a>:</p>\n\n<pre><code>func AppendSlice(s, t Value) Value\n</code></pre>\n\n<p>As the last remaining key, we can use <a href=\"https://golang.org/pkg/reflect/#Value.Len\" rel=\"nofollow noreferrer\"><code>Value.Len()</code></a> to get the length of any slice.</p>\n\n<p>We now have everything that's needed for our general <code>removeFrom()</code> function, which is surprisingly simple:</p>\n\n<pre><code>func removeFrom(s interface{}, idx int) interface{} {\n    if v := reflect.ValueOf(s); v.Len() &gt; idx {\n        return reflect.AppendSlice(v.Slice(0, idx), v.Slice(idx+1, v.Len())).Interface()\n    }\n    return s\n}\n</code></pre>\n\n<p>Really, that's all. Testing it:</p>\n\n<pre><code>for i := 0; i &lt; 4; i++ {\n    fmt.Println(removeFrom([]int{0, 1, 2}, i), \"missing:\", i)\n}\nfor i := 0; i &lt; 4; i++ {\n    fmt.Println(removeFrom([]string{\"zero\", \"one\", \"two\"}, i), \"missing:\", i)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/VyhUkUUESn\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[1 2] missing: 0\n[0 2] missing: 1\n[0 1] missing: 2\n[0 1 2] missing: 3\n[one two] missing: 0\n[zero two] missing: 1\n[zero one] missing: 2\n[zero one two] missing: 3\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<p>This solution uses reflection, so it will be slower than another solution not using reflection but having the concrete, supported types \"wired in\". Quick benchmarks show this general solution is 2.5 times slower than a non-reflection with wired-in types. Should be weighted whether performance or convenience/general solution is more important. Or you may combine this with concrete types: you may add a type switch to handle frequent types, and only revert to this general solution if the actual concrete type is not handled by the type switch.</p>\n"}], "owner": {"reputation": 133, "user_id": 6256602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bafb1aa784e2f486c4fa1c0696e06590?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/6256602/abel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 844, "favorite_count": 2, "accepted_answer_id": 37379691, "answer_count": 2, "score": 3, "last_activity_date": 1557597495, "creation_date": 1463932887, "last_edit_date": 1463953659, "question_id": 37376513, "link": "https://stackoverflow.com/questions/37376513/how-to-accept-different-types-of-slices-in-the-same-function", "title": "How to accept different types of slices in the same function?", "body": "<p>I have a function <code>removeFrom</code> that removes an item from a slice. It accepts a <code>float64</code> slice and an index: </p>\n\n<pre><code>func removeFrom(slice []float64, index int) []float64 {\n    if len(slice) &gt; index {\n        return append(slice[:index], slice[index+1:]...)\n    }\n}\n</code></pre>\n\n<p>It works fine, but now I have to remove from slices of integers also. So how could I change this to accept both types (and return a slice of the given type)? I tried to use empty interfaces but apparently I have to do some conversion inside the function and I didn't find out how to do it.</p>\n"}, {"tags": ["java", "go", "bytestream"], "comments": [{"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 0, "creation_date": 1463930446, "post_id": 37375679, "comment_id": 62263494, "body": "The top answers to <a href=\"http://stackoverflow.com/q/12357865/4740606\">stackoverflow.com/q/12357865/4740606</a> and <a href=\"http://stackoverflow.com/q/28949063/4740606\">stackoverflow.com/q/28949063/4740606</a> might be helpful to you"}], "answers": [{"comments": [{"owner": {"reputation": 991, "user_id": 2155614, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-yPPj1XVo0uI/AAAAAAAAAAI/AAAAAAAAACQ/NW3rM807aQs/photo.jpg?sz=128", "display_name": "andor kesselman", "link": "https://stackoverflow.com/users/2155614/andor-kesselman"}, "edited": false, "score": 0, "creation_date": 1463929811, "post_id": 37375905, "comment_id": 62263255, "body": "This seems to work, though the unsafe operations scares me a little bit. Will play with this to make sure I understand this completely"}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 3, "last_activity_date": 1463929190, "creation_date": 1463929190, "answer_id": 37375905, "question_id": 37375679, "link": "https://stackoverflow.com/questions/37375679/convert-an-unsigned-byte-stream-to-signed-bytestream-golang/37375905#37375905", "title": "Convert an unsigned byte stream to signed bytestream Golang", "body": "<p>You can use <code>unsafe.Pointer</code> if you know <strong>exactly</strong> what you are doing. Because as its name suggests, it is unsafe. Therefore, it will blow up if you use it unwisely.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    unsigned := make([]uint8, 0)\n    unsigned = append(unsigned, 128)\n    unsigned = append(unsigned, 255)\n\n    signed := *(*[]int8)(unsafe.Pointer(&amp;unsigned))\n    fmt.Printf(\"%d : %d\\n\", signed[0], unsigned[0])\n    fmt.Printf(\"%d : %d\\n\", signed[1], unsigned[1])\n}\n// -128 : 128\n// -1 : 255\n</code></pre>\n\n<p>You can find this example on the <a href=\"https://play.golang.org/p/LHTl-Io3CY\" rel=\"nofollow\">Go playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 1, "last_activity_date": 1463933175, "creation_date": 1463933175, "answer_id": 37376553, "question_id": 37375679, "link": "https://stackoverflow.com/questions/37375679/convert-an-unsigned-byte-stream-to-signed-bytestream-golang/37376553#37376553", "title": "Convert an unsigned byte stream to signed bytestream Golang", "body": "<p>The unsafe answer above is perfectly fine, however it wouldn't work on appengine.</p>\n\n<p>Here's the safe version:</p>\n\n<pre><code>signed := make([]int8, len(unsigned))\nfor i, v := range unsigned {\n    signed[i] = int8(v)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/XF6RsLkm0m\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1476506082, "last_edit_date": 1476506082, "creation_date": 1463938186, "answer_id": 37377413, "question_id": 37375679, "link": "https://stackoverflow.com/questions/37375679/convert-an-unsigned-byte-stream-to-signed-bytestream-golang/37377413#37377413", "title": "Convert an unsigned byte stream to signed bytestream Golang", "body": "<p>Some things to clear: both Java and Go reads the data the same way from files.</p>\n\n<p>Files are series of binary data grouped by 8 bits, which we call a <em>byte</em>. This <em>byte</em> is 8 bits, how you interpret it is entirely up to you.</p>\n\n<p>Both Go and Java will read the same 8-bit groups, but Java will store it in a Java <code>byte</code> type which is a <em>signed</em> type, and Go will store it in a Go <code>byte</code> type which is <em>unsigned</em>. But both will have the same 8 bits, the read data will be equal:</p>\n\n<pre><code>var b byte = 248\nvar i int8 = -8\nfmt.Printf(\"%x %x\\n\", b, byte(i))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>f8 f8\n</code></pre>\n\n<p>Should you need to interpret the read 8 bits as a signed value, simply use a type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow\">conversion</a>:</p>\n\n<pre><code>data := []byte{8, 248, 198}\nfor _, v := range data {\n    fmt.Println(int8(v))\n}\n</code></pre>\n\n<p>Output (same as the Java output):</p>\n\n<pre><code>8|-8|-58|\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/4nRJ5zQ8IE\" rel=\"nofollow\">Go Playground</a>.</p>\n\n<p>Should you worry about performance (because of type conversions)? Absolutely not. <code>byte</code> -> <code>int8</code> conversion has no runtime cost, as both have the same memory layout (that is, 8 bits = 1 byte), and the conversion just tells to interpret those 8 bits differently. </p>\n"}], "owner": {"reputation": 991, "user_id": 2155614, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-yPPj1XVo0uI/AAAAAAAAAAI/AAAAAAAAACQ/NW3rM807aQs/photo.jpg?sz=128", "display_name": "andor kesselman", "link": "https://stackoverflow.com/users/2155614/andor-kesselman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2304, "favorite_count": 0, "accepted_answer_id": 37375905, "answer_count": 3, "score": 1, "last_activity_date": 1476506082, "creation_date": 1463927708, "last_edit_date": 1463929310, "question_id": 37375679, "link": "https://stackoverflow.com/questions/37375679/convert-an-unsigned-byte-stream-to-signed-bytestream-golang", "title": "Convert an unsigned byte stream to signed bytestream Golang", "body": "<p>What is the best way to convert an bytestream to a bytestream slice in Golang? Currently I'm trying to replicate a java program in golang and I believe I am having some issues with the fact that java reads the bytestream as a signed value, whereas golang treats it as an unsigned value. </p>\n\n<p>When I print in Java note the negative values are different. Positive are the same:</p>\n\n<blockquote>\n  <p>Java:</p>\n  \n  <p>8|<strong>-8</strong>|<strong>-58</strong>|-61|-56|-113|42|16|-64|2|24|-16|1</p>\n  \n  <p>Golang:</p>\n  \n  <p>8|<strong>248</strong>|<strong>198</strong>|195|200|143|42|16|192|2|2|240|1</p>\n</blockquote>\n\n<p>Currently, my implementation right in GO looks like:</p>\n\n<pre><code>//open the file with os.open\n//create new reader and unzip it\n\n//reads from zip file and returns an array of bytes associated with it.\ndata, err := ioutil.ReadAll(fz)\nif err != nil {\n    return nil, err\n}\n//reflect.TypeOf shows this is a []uint8\n//I want this to be a []int8 (so signed). \n</code></pre>\n\n<p>In Java the implementation was pretty much:</p>\n\n<pre><code>  //create buffer reader\n  //create input stream\n  //create datainput stream\n  //use the .Read function to get the values required. \n</code></pre>\n\n<p>I didn't see any easy way to typecast it quickly to a signed int (maybe I'm wrong). I could try to iterate through the entire slice, converting each value to a signed int, but that approach seems rather messy. It would also require me to operate on each. Is there a cleaner way of converting the slice? </p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "comments": [{"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 0, "creation_date": 1463919724, "post_id": 37374205, "comment_id": 62259807, "body": "Just curious, why <code>defer</code> is in the goroutine? (I&#39;m assuming you open the file in the <code>starCircuit</code> function)"}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 0, "creation_date": 1463919895, "post_id": 37374205, "comment_id": 62259865, "body": "Also, can you provide a MWE? I&#39;m a bit curious to try myself :)"}, {"owner": {"reputation": 15832, "user_id": 1156707, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/99055b620fb3a9d30a8f6ac480c25227?s=128&d=identicon&r=PG", "display_name": "Louis Thibault", "link": "https://stackoverflow.com/users/1156707/louis-thibault"}, "reply_to_user": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 0, "creation_date": 1463921034, "post_id": 37374205, "comment_id": 62260266, "body": "@T.Claverie You removed your answer but your suggestion to move the <code>make</code> call outside of the goroutine seems to have fixed the issue.  Feel free to resubmit your answer!"}, {"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 1, "creation_date": 1463921441, "post_id": 37374205, "comment_id": 62260409, "body": "That was going to be my suggestion. It appears that <code>anchor := &lt;-anchorChan</code> is trying to receive on an uninitialized channel since <code>make</code> is called from within the go routine."}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 1, "creation_date": 1463921450, "post_id": 37374205, "comment_id": 62260411, "body": "@blz Then I am glad it helped. I deleted it because the comment made me doubt my solution would work on your case, and I didn&#39;t want to mislead you."}], "answers": [{"comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 2, "creation_date": 1463920669, "post_id": 37374383, "comment_id": 62260146, "body": "I don&#39;t think this is <i>quite</i> right -- the assignment to <code>c</code> inside the goroutine races with the <code>str := &lt;-c</code> statement outside the goroutine. So the assignment does affect the channel in the main function, and the code isn&#39;t guaranteed to deadlock, but it&#39;s definitely broken because it contains a race. The race detector will catch this."}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1463921680, "post_id": 37374383, "comment_id": 62260486, "body": "Thanks for showing me my wrongs, I was mistaken about the problem."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 5, "last_activity_date": 1463921614, "last_edit_date": 1463921614, "creation_date": 1463920104, "answer_id": 37374383, "question_id": 37374205, "link": "https://stackoverflow.com/questions/37374205/why-isnt-my-function-returning/37374383#37374383", "title": "Why isn&#39;t my function returning?", "body": "<p>The problem is in fact quite simple. Hint: the following code ends in a <strong>deadlock</strong>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var c chan string\n\n    go func() {\n        c = make(chan string)\n        c &lt;- \"42\"\n    }()\n\n    str := &lt;-c\n    fmt.Println(str)\n}\n</code></pre>\n\n<p>From there, the problem is trivial. Your channel is not initialized when you start the goroutine. There is a race with the two goroutines, and apparently go cannot decide which should have the priority.</p>\n\n<p>So, your answer is: call <code>make(chan ...)</code> before the goroutine starts, it should solve your problem. There is a perfect example of this in <a href=\"https://golang.org/doc/effective_go.html#channels\" rel=\"nofollow\">effective go.</a></p>\n"}, {"tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 0, "last_activity_date": 1464058461, "creation_date": 1464058461, "answer_id": 37403624, "question_id": 37374205, "link": "https://stackoverflow.com/questions/37374205/why-isnt-my-function-returning/37403624#37403624", "title": "Why isn&#39;t my function returning?", "body": "<p>Dave Cheney has a good related blog post: <a href=\"http://dave.cheney.net/2014/03/19/channel-axioms\" rel=\"nofollow\">http://dave.cheney.net/2014/03/19/channel-axioms</a></p>\n\n<p>Most relevant points:</p>\n\n<ol>\n<li>A send to a nil channel blocks forever </li>\n<li>A receive from a nil channel blocks forever</li>\n</ol>\n\n<p>Since uninitialized channel is nil, and thus any read and write to it will result in deadlock. In example, in T. Claverie's answer, there is a race: If <code>c = make(chan string)</code>, (and <code>c &lt;- \"42\"</code>, I believe that <code>str := &lt;-c</code> has to wait at this point) happen first, then receive happens from initialized, non-empty channel and everything is runs fine:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n    var c chan string\n\n    go func() {\n        c = make(chan string)\n        c &lt;- \"42\"\n    }()\n\n    time.Sleep(time.Second * 1)\n    str := &lt;-c\n    fmt.Println(str)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/oLs1-Kh3P3\" rel=\"nofollow\">go playground</a></p>\n\n<p>You can run the above example to convince yourself. (This is not good practice or even guaranteed to work every time.)</p>\n\n<p>However, if <code>str := &lt;-c</code> happens first, then you are receiving from an <code>nil</code> channel, which results in a deadlock.</p>\n"}], "owner": {"reputation": 15832, "user_id": 1156707, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/99055b620fb3a9d30a8f6ac480c25227?s=128&d=identicon&r=PG", "display_name": "Louis Thibault", "link": "https://stackoverflow.com/users/1156707/louis-thibault"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 1, "accepted_answer_id": 37374383, "answer_count": 2, "score": 1, "last_activity_date": 1464058461, "creation_date": 1463919104, "question_id": 37374205, "link": "https://stackoverflow.com/questions/37374205/why-isnt-my-function-returning", "title": "Why isn&#39;t my function returning?", "body": "<p>Below is a function that starts an external process, matches a regular expression against the process' standard output, and returns the contents of the match.</p>\n\n<pre><code>func (c *Colony) startCircuit(peer *string) (string, error) {\n    var (\n        err        error\n        cmd        *exec.Cmd\n        anchorChan chan string\n    )\n\n    // ... (omitted for readability)\n\n    // get the anchor from standard output\n    go func() {\n        defer out.Close()\n\n        anchorChan = make(chan string)\n        for scanner := bufio.NewScanner(out); scanner.Scan(); {\n            line := scanner.Text()\n            if anchor := reRootAnchor.FindString(line); anchor != \"\" {\n                log.Println(\"Started circuit server with anchor:\", anchor)\n                anchorChan &lt;- anchor\n                break\n            }\n        }\n    }()\n\n    anchor := &lt;-anchorChan\n    return anchor, err\n}\n</code></pre>\n\n<p>When running the function, I obtain the following output, which shows that a match is indeed found and (presumably) pushed into <code>anchorChan</code>:</p>\n\n<pre><code>2016/05/22 14:04:36 Started circuit server with anchor: circuit://[::]:36195/20666/Q431cc5fe613aa04b\n</code></pre>\n\n<p>However, <code>startCircuit</code>'s caller seems to hang.  Here is the relevant bit of code:</p>\n\n<pre><code>rootAnchor, err := c.startCircuit(peer)\nif err != nil {\n    return \"\", err\n}\nlog.Fatal(rootAnchor) // DEBUG\n</code></pre>\n\n<p>Why is <code>startCircuit</code> hanging indefinitely instead of returning?</p>\n"}, {"tags": ["go", "concurrency", "channels"], "comments": [{"owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "edited": false, "score": 0, "creation_date": 1463898671, "post_id": 37371206, "comment_id": 62254411, "body": "<code>I know that there will be no concurrent access</code> so the go routines are not operating at the same time?"}, {"owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "reply_to_user": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "edited": false, "score": 0, "creation_date": 1463899710, "post_id": 37371206, "comment_id": 62254635, "body": "They do operate at the same time, but I can easily synchronize the read/write via a simple and fast <code>chan struct{}</code> to ensure read happens after write finishes, i.e. reader would wait for writer to finish modifying the struct fields(writing to Bytes.Buffer and setting some simple fields(int) in the struct). By design there is no concurrent access, but reader and writer are always located in different goroutines"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 3, "creation_date": 1463907249, "post_id": 37371206, "comment_id": 62256433, "body": "If there are no concurrent access and each goroutine share the address of the same struct in memory, then there&#39;s no reason for staleness."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 1, "creation_date": 1463920059, "post_id": 37371206, "comment_id": 62259930, "body": "Always protect data that can be accessed concurrently. If there&#39;s no contention then performance hit will be negligible anyway. Don&#39;t rely on assumptions, it will cause problems that will be difficult to debug. On the other hand, you can always tweak you code if locking causes performance problems."}], "answers": [{"comments": [{"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 1, "creation_date": 1463919658, "post_id": 37373292, "comment_id": 62259784, "body": "That code looks too complicated for such a simple thing. Mutexes in go are used for this exact reason - it will be much simpler and probably even faster. Don&#39;t use channels just because you can. Also, any use of <code>runtime.Gosched()</code> most of the times means you&#39;re doing it wrong. You don&#39;t need it, remove <code>default</code> cases from <code>select</code> statements. Also remove <code>select</code> statements with just one channel operation and use channels directly instead"}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1463920468, "post_id": 37373292, "comment_id": 62260075, "body": "I can see that your code uses <code>select</code> with <code>runtime.Gosched()</code> to access channels without blocking but, again, you&#39;re doing it wrong. The whole example is too complicated, unnecessary, fragile and simply not the Go way of doing things. And because of the <code>runtime.Gosched()</code> I&#39;m not sure how it will behave when GOMAXPROCS is 1."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1463921828, "post_id": 37373292, "comment_id": 62260541, "body": "Did you measure the performance? I also didn&#39;t but quite sure that mutex will be faster. Channels are expensive by themselves, mutexes are cheap if there&#39;s no contention. But it doesn&#39;t matter anyway, mutex will make the code much simpler and that&#39;s more important. Until benchmark tells you that channels faster and you can justify why performance benefit is worth hurting readability, use mutexes"}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 2, "creation_date": 1463922231, "post_id": 37373292, "comment_id": 62260685, "body": "<a href=\"https://github.com/golang/go/wiki/MutexOrChannel\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/MutexOrChannel</a> <code>Use whichever is most expressive and&#47;or most simple</code>. That&#39;s the universal rule for almost everything until you have very good reasons why you need to use more complicated solution. But that&#39;s not the only problem with your code, it&#39;s just not a good Go code by itself."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1463939251, "post_id": 37373292, "comment_id": 62266416, "body": "@creker: This is called Stateful Goroutines: <a href=\"https://gobyexample.com/stateful-goroutines\" rel=\"nofollow noreferrer\">gobyexample.com/stateful-goroutines</a> If you comment out all runtime.Gosched() time=5.8523347s and above code time=5.0052863s it is faster with runtime.Gosched() so I keep it The scheduler is instructed to switch the execution to another goroutine. This is exactly needed here, buffer is empty and another goroutine needed to fill the buffer.   About channels I do not agree with you. It is very elemental to Golang and concurrency, I\u2019ve been using it before Golang: (Erlang Message Passing) it is very simple and cheap."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 4, "last_activity_date": 1472051941, "last_edit_date": 1495542810, "creation_date": 1463913707, "answer_id": 37373292, "question_id": 37371206, "link": "https://stackoverflow.com/questions/37371206/golang-share-big-chunk-of-data-between-goroutines/37373292#37373292", "title": "Golang share big chunk of data between goroutines", "body": "<p>There are many answers to this, and it depends to your data structure and   program logic.</p>\n\n<p>see:  <a href=\"https://stackoverflow.com/questions/10728863/how-to-lock-synchronize-access-to-a-variable-in-go-during-concurrent-goroutines\">How to lock/synchronize access to a variable in Go during concurrent goroutines?</a><br>\nand:  <a href=\"https://stackoverflow.com/questions/19148809/how-to-use-rwmutex-in-golang\">How to use RWMutex in Golang?</a>  </p>\n\n<p>1- using  <a href=\"https://gobyexample.com/stateful-goroutines\" rel=\"nofollow noreferrer\">Stateful Goroutines</a> and channels<br>\n2- using <a href=\"https://github.com/golang/go/wiki/MutexOrChannel\" rel=\"nofollow noreferrer\">sync.Mutex</a><br>\n3- using sync/atomic<br>\n4- using WaitGroup<br>\n5- using program logic(<a href=\"https://en.wikipedia.org/wiki/Semaphore_(programming)\" rel=\"nofollow noreferrer\">Semaphore</a>)<br>\n...</p>\n\n<hr>\n\n<p>1: <a href=\"https://gobyexample.com/stateful-goroutines\" rel=\"nofollow noreferrer\">Stateful Goroutines</a> and channels:<br>\nI simulated very similar sample(imagine you want to read from one SSD and write to another SSD with different speed):<br>\nIn this sample code one goroutine (named write) does some job prepares data and fills the big struct, and another goroutine (named read) reads data from big struct then do some job, And the manger goroutine, guarantee no concurrent access to same data.\nAnd communication between three goroutines done with channels. And in your case you can use pointers for channel data, or global struct like this sample.<br>\noutput will be like this:<br>\nmean= 36.6920166015625 stdev= 6.068973186592054  </p>\n\n<p>I hope this helps you to get the idea.<br>\nWorking sample code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"math/rand\"\n    \"runtime\"\n    \"sync\"\n    \"time\"\n)\n\ntype BigStruct struct {\n    big     []uint16\n    rpos    int\n    wpos    int\n    full    bool\n    empty   bool\n    stopped bool\n}\n\nfunc main() {\n    wg.Add(1)\n    go write()\n    go read()\n    go manage()\n    runtime.Gosched()\n    stopCh &lt;- &lt;-time.After(5 * time.Second)\n    wg.Wait()\n    mean := Mean(hist)\n    stdev := stdDev(hist, mean)\n    fmt.Println(\"mean=\", mean, \"stdev=\", stdev)\n}\n\nconst N = 1024 * 1024 * 1024\n\nvar wg sync.WaitGroup\nvar stopCh chan time.Time = make(chan time.Time)\n\nvar hist []int = make([]int, 65536)\n\nvar s *BigStruct = &amp;BigStruct{empty: true,\n    big: make([]uint16, N), //2GB\n}\n\nvar rc chan uint16 = make(chan uint16)\nvar wc chan uint16 = make(chan uint16)\n\nfunc next(pos int) int {\n    pos++\n    if pos &gt;= N {\n        pos = 0\n    }\n    return pos\n}\n\nfunc manage() {\n    dataReady := false\n    var data uint16\n    for {\n        if !dataReady &amp;&amp; !s.empty {\n            dataReady = true\n            data = s.big[s.rpos]\n            s.rpos++\n            if s.rpos &gt;= N {\n                s.rpos = 0\n            }\n            s.empty = s.rpos == s.wpos\n            s.full = next(s.wpos) == s.rpos\n        }\n        if dataReady {\n            select {\n            case rc &lt;- data:\n                dataReady = false\n            default:\n                runtime.Gosched()\n            }\n        }\n        if !s.full {\n            select {\n            case d := &lt;-wc:\n                s.big[s.wpos] = d\n                s.wpos++\n                if s.wpos &gt;= N {\n                    s.wpos = 0\n                }\n                s.empty = s.rpos == s.wpos\n                s.full = next(s.wpos) == s.rpos\n            default:\n                runtime.Gosched()\n            }\n        }\n        if s.stopped {\n            if s.empty {\n                wg.Done()\n                return\n            }\n        }\n\n    }\n}\n\nfunc read() {\n    for {\n        d := &lt;-rc\n        hist[d]++\n    }\n}\n\nfunc write() {\n    for {\n        wc &lt;- uint16(rand.Intn(65536))\n        select {\n        case &lt;-stopCh:\n            s.stopped = true\n            return\n        default:\n            runtime.Gosched()\n        }\n    }\n}\n\nfunc stdDev(data []int, mean float64) float64 {\n    sum := 0.0\n    for _, d := range data {\n        sum += math.Pow(float64(d)-mean, 2)\n    }\n    variance := sum / float64(len(data)-1)\n    return math.Sqrt(variance)\n}\nfunc Mean(data []int) float64 {\n    sum := 0.0\n    for _, d := range data {\n        sum += float64(d)\n    }\n    return sum / float64(len(data))\n}\n</code></pre>\n\n<hr>\n\n<p>5: another way(faster) for some use cases:<br>\nhere another way to use shared data structure for read job/write job/ processing job which it was separated in first post, now here doing same 3 jobs <strong>without channels</strong> and without <strong>mutex</strong>.  </p>\n\n<p>working sample:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"math/rand\"\n    \"time\"\n)\n\ntype BigStruct struct {\n    big     []uint16\n    rpos    int\n    wpos    int\n    full    bool\n    empty   bool\n    stopped bool\n}\n\nfunc manage() {\n    for {\n        if !s.empty {\n            hist[s.big[s.rpos]]++ //sample read job with any time len\n            nextPtr(&amp;s.rpos)\n        }\n        if !s.full &amp;&amp; !s.stopped {\n            s.big[s.wpos] = uint16(rand.Intn(65536)) //sample wrire job with any time len\n            nextPtr(&amp;s.wpos)\n        }\n        if s.stopped {\n            if s.empty {\n                return\n            }\n        } else {\n            s.stopped = time.Since(t0) &gt;= 5*time.Second\n        }\n    }\n}\n\nfunc main() {\n    t0 = time.Now()\n    manage()\n    mean := Mean(hist)\n    stdev := StdDev(hist, mean)\n    fmt.Println(\"mean=\", mean, \"stdev=\", stdev)\n    d0 := time.Since(t0)\n    fmt.Println(d0) //5.8523347s\n}\n\nvar t0 time.Time\n\nconst N = 100 * 1024 * 1024\n\nvar hist []int = make([]int, 65536)\n\nvar s *BigStruct = &amp;BigStruct{empty: true,\n    big: make([]uint16, N), //2GB\n}\n\nfunc next(pos int) int {\n    pos++\n    if pos &gt;= N {\n        pos = 0\n    }\n    return pos\n}\nfunc nextPtr(pos *int) {\n    *pos++\n    if *pos &gt;= N {\n        *pos = 0\n    }\n\n    s.empty = s.rpos == s.wpos\n    s.full = next(s.wpos) == s.rpos\n}\n\nfunc StdDev(data []int, mean float64) float64 {\n    sum := 0.0\n    for _, d := range data {\n        sum += math.Pow(float64(d)-mean, 2)\n    }\n    variance := sum / float64(len(data)-1)\n    return math.Sqrt(variance)\n}\nfunc Mean(data []int) float64 {\n    sum := 0.0\n    for _, d := range data {\n        sum += float64(d)\n    }\n    return sum / float64(len(data))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 5, "last_activity_date": 1463919100, "creation_date": 1463919100, "answer_id": 37374204, "question_id": 37371206, "link": "https://stackoverflow.com/questions/37371206/golang-share-big-chunk-of-data-between-goroutines/37374204#37374204", "title": "Golang share big chunk of data between goroutines", "body": "<p>To prevent concurrent modifications to a struct while retaining the ability to read, you'd typically embed a <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"noreferrer\">sync.RWMutex</a>. This is no exemption. You can simply <a href=\"https://golang.org/pkg/sync/#RWMutex.Lock\" rel=\"noreferrer\">lock your struct for writes</a> while it is in transit and unlock it at a point in time of your convenience.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\n// Big simulates your big struct\ntype Big struct {\n    sync.RWMutex\n    value string\n}\n\n// pump uses a groutine to take the slice of pointers to Big,\n// locks the underlying structs and sends the pointers to\n// the locked instances of Big downstream\nfunc pump(bigs []*Big) chan *Big {\n\n    // We make the channel buffered for this example\n    // for illustration purposes\n    c := make(chan *Big, 3)\n\n    go func() {\n        for _, big := range bigs {\n            // We lock the struct before sending it to the channel\n            // so it can not be changed via pointer while in transit\n            big.Lock()\n            c &lt;- big\n        }\n        close(c)\n    }()\n\n    return c\n}\n\n// sink reads pointers to the locked instances of Big\n// reads them and unlocks them\nfunc sink(c chan *Big) {\n\n    for big := range c {\n        fmt.Println(big.value)\n        time.Sleep(1 * time.Second)\n        big.Unlock()\n\n    }\n}\n\n// modify tries to achieve locks to the instances and modify them\nfunc modify(bigs []*Big) {\n    for _, big := range bigs {\n\n        big.Lock()\n        big.value = \"modified\"\n        big.Unlock()\n    }\n}\n\nfunc main() {\n\n    bigs := []*Big{&amp;Big{value: \"Foo\"}, &amp;Big{value: \"Bar\"}, &amp;Big{value: \"Baz\"}}\n    c := pump(bigs)\n\n    // For the sake of this example, we wait until all entries are\n    // send into the channel and hence are locked\n    time.Sleep(1 * time.Second)\n\n    // Now we try to modify concurrently before we even start to read\n    // the struct of which the pointers were sent into the channel\n    go modify(bigs)\n    sink(c)\n\n    // We use sleep here to keep waiting for modify() to finish simple.\n    // Usually, you'd use a sync.waitGroup\n    time.Sleep(1 * time.Second)\n\n    for _, big := range bigs {\n        fmt.Println(big.value)\n    }\n\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/7VdJe2T3Xz\" rel=\"noreferrer\"><strong>Run on playground</strong></a></kbd></p>\n"}], "owner": {"reputation": 1012, "user_id": 1812225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/5f4353e2db7dca0676814e41a0582980?s=128&d=identicon&r=PG", "display_name": "let4be", "link": "https://stackoverflow.com/users/1812225/let4be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4726, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1472051941, "creation_date": 1463897943, "last_edit_date": 1463898305, "question_id": 37371206, "link": "https://stackoverflow.com/questions/37371206/golang-share-big-chunk-of-data-between-goroutines", "title": "Golang share big chunk of data between goroutines", "body": "<p>I have a need to read structure fields set from another goroutine, afaik doing so directly even when knowing for sure there will be <em>no concurrent</em> access(write finished before read occurred, signaled via <code>chan struct{}</code>) may result in stale data</p>\n\n<p>Will sending a <em>pointer</em> to the structure(created in the 1st goroutine, modified in the 2nd, read by the 3rd) resolve the possible staleness issue, considering I can guarantee no concurrent access?</p>\n\n<p>I would like to avoid copying as structure is big and contains huge Bytes.Buffer filled in the 2nd goroutine, I need to read from the 3rd</p>\n\n<p>There is an option for locking, but seems like an overkill considering I know that there will be no concurrent access</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 105, "user_id": 6366257, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-yx9H89Icy64/AAAAAAAAAAI/AAAAAAAAK8Y/-M20oehmPV8/photo.jpg?sz=128", "display_name": "Luke Mann", "link": "https://stackoverflow.com/users/6366257/luke-mann"}, "edited": false, "score": 0, "creation_date": 1463884217, "post_id": 37369925, "comment_id": 62252169, "body": "@LukeMann Not sure though, this was an out of range on a slice: I have edited the answer."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1463884914, "last_edit_date": 1463884914, "creation_date": 1463883856, "answer_id": 37369925, "question_id": 37369868, "link": "https://stackoverflow.com/questions/37369868/panic-runtime-error-index-out-of-range/37369925#37369925", "title": "Panic: runtime error: index out of range", "body": "<p><code>[...]int{1,2,3}</code> is not a slice. It is an array of capacity 3.<br>\nSee \"<a href=\"https://nanxiao.gitbooks.io/golang-101-hacks/content/posts/array.html\" rel=\"nofollow\">golang-101-hacks: Array</a>\"</p>\n\n<p>If you try to append a fourth element... that will be out of range.</p>\n\n<p>But here <code>s[:]</code> <a href=\"https://blog.golang.org/slices\" rel=\"nofollow\">transforms it into a slice</a>.</p>\n\n<p>The actual '<code>index out of range</code>' comes from <code>input[len(input)-i]</code> which, with <code>i=0</code>, means <code>input[len(input)]</code>: out of range.</p>\n\n<p>This would work better (<a href=\"https://play.golang.org/p/OXSZ3Z42oG\" rel=\"nofollow\">playground</a>) (no out of range)</p>\n\n<p>The final <code>fmt.Println(s)</code> was still print the original array, not the return of <code>rev()</code> (which is ignored).<br>\nThis prints the \"expected\" result (using append, so mutating and adding to the slice):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := [...]int{1, 2, 3}\n    t := rev(s[:])\n    fmt.Println(s)\n    fmt.Println(t)\n}\n\nfunc rev(input []int) []int {\n    var j int\n    l := len(input) - 1\n    for i := 0; i &lt;= l; i++ {\n        j = input[l-i]\n        input = append(input, j)\n    }\n    return input\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>[1 2 3]\n[1 2 3 3 2 1]\n</code></pre>\n\n<p>This (<a href=\"https://play.golang.org/p/Mw5QtCy2QO\" rel=\"nofollow\">playground</a>) would actually reverse the slice:</p>\n\n<pre><code>var j int\nvar res []int\nl := len(input) - 1\nfor i := 0; i &lt;= l; i++ {\n    j = input[l-i]\n    res = append(res, j)\n}\nreturn res\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>[1 2 3]\n[3 2 1]\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 6366257, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-yx9H89Icy64/AAAAAAAAAAI/AAAAAAAAK8Y/-M20oehmPV8/photo.jpg?sz=128", "display_name": "Luke Mann", "link": "https://stackoverflow.com/users/6366257/luke-mann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4876, "favorite_count": 2, "accepted_answer_id": 37369925, "answer_count": 1, "score": 5, "last_activity_date": 1463884914, "creation_date": 1463883086, "question_id": 37369868, "link": "https://stackoverflow.com/questions/37369868/panic-runtime-error-index-out-of-range", "title": "Panic: runtime error: index out of range", "body": "<p>Sorry if this seems pretty basic but why am I getting this error? I dont see any slices/arrays out of range.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main(){\n    s:= [...]int{1,2,3}\n    rev(s[:])\n    fmt.Println(s)\n}\n\nfunc rev(input []int) []int {\n    var j int\n    l:=len(input)-1\n    for i:=0; i&lt;l;i++ {\n        j= input[len(input)-i]\n        input=append(input, j)\n        i++\n    }\n    return input[:l]\n}\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 3004431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec4a5b3f8e656858100d4c821baac6aa?s=128&d=identicon&r=PG&f=1", "display_name": "nicomo", "link": "https://stackoverflow.com/users/3004431/nicomo"}, "edited": false, "score": 0, "creation_date": 1486047170, "post_id": 41977898, "comment_id": 71186565, "body": "Yes I thought about that. Rather than do  <code>DB.Set(&quot;gorm:save_associations&quot;, false)</code> on a case by case basis. But it seems like it&#39;s a case of the glass half-full rather than half-empty. Because then Gorm now always assumes the field exists, but I can&#39;t rely on that. Someone else did an <a href=\"https://github.com/jinzhu/gorm/issues/1061\" rel=\"nofollow noreferrer\">issue on the gorm repo</a> for this. It&#39;s Open."}], "tags": [], "owner": {"reputation": 1, "user_id": 7499916, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/ba1f276b6be6a61a8b3ac0d920025b79?s=128&d=identicon&r=PG", "display_name": "Guest", "link": "https://stackoverflow.com/users/7499916/guest"}, "is_accepted": false, "score": 0, "last_activity_date": 1485946418, "creation_date": 1485946418, "answer_id": 41977898, "question_id": 37369490, "link": "https://stackoverflow.com/questions/37369490/gorm-creates-duplicate-in-association/41977898#41977898", "title": "Gorm creates duplicate in association", "body": "<p><code>gorm:\"many2many:message_locations;save_association:false\"</code></p>\n\n<p>Is getting closer to what you would like to have.  You need to place it in your struct definition for Message.  The field is then assumed to exist in the db and only the associations table will be populated with data.</p>\n"}], "owner": {"reputation": 43, "user_id": 3004431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec4a5b3f8e656858100d4c821baac6aa?s=128&d=identicon&r=PG&f=1", "display_name": "nicomo", "link": "https://stackoverflow.com/users/3004431/nicomo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2468, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1485946418, "creation_date": 1463878299, "last_edit_date": 1464185427, "question_id": 37369490, "link": "https://stackoverflow.com/questions/37369490/gorm-creates-duplicate-in-association", "title": "Gorm creates duplicate in association", "body": "<p>I have the following 2 structs with a many-2-many relationship.</p>\n\n<pre><code>type Message struct {\n    gorm.Model\n    Body         string     `tag:\"body\" schema:\"body\"`\n    Locations    []Location `tag:\"locations\" gorm:\"many2many:message_locations;\"`\n    TimeSent     time.Time  `tag:\"timesent\"`\n    TimeReceived time.Time  `tag:\"timereceived\"`\n    User         User\n}\n\ntype Location struct {\n    gorm.Model\n    PlaceID string  `tag:\"loc_id\" gorm:\"unique\"`\n    Lat     float64 `tag:\"loc_lat\"`\n    Lng     float64 `tag:\"loc_lng\"`\n}\n</code></pre>\n\n<p>If I create a Message with DB.Create(my_message), everything works fine : the Message is created in DB, along with a Location and the join message_locations table is filled with the respective IDs of the Message and the Location.</p>\n\n<p>What I was expecting though was that if the Location already exists in DB (based on the place_id field, which is passed on), gorm would create the Message, retrieve the Location ID and populate message_locations.That's not what is happening.\nSince the PlaceID must be unique, gorm finds that a duplicate key value violates unique constraint \"locations_place_id_key\" and aborts the transaction.</p>\n\n<p>If on the other hand I make the PlaceID not unique, gorm creates the message alright, with the association, but then that creates another, duplicate entry for the Location.</p>\n\n<p>I can test if the location already exists before trying to save the message:</p>\n\n<pre><code>existsLoc := Location{}\nDB.Where(\"place_id = ?\", mssg.Locations[0].PlaceID).First(&amp;existsLoc)\n</code></pre>\n\n<p>then if true switch the association off:</p>\n\n<pre><code>DB.Set(\"gorm:save_associations\", false).Create(mssg)\nDB.Create(mssg)\n</code></pre>\n\n<p>The message is saved without gorm complaining, but then message_locations is not filled.\nI could fill it \"manually\" since I've retrieved the Location ID when testing for its existence, but it seems to me it kind of defeats the purpose of using gorm in the first place.</p>\n\n<p>I'm not sure what the right way to proceed might be. I might be missing something obvious, I suspect maybe something's wrong with the way I declared my structs? Hints welcome.</p>\n\n<p><strong>UPDATE 2016/03/25</strong></p>\n\n<p>I ended up doing the following, which I'm pretty sure is not optimal. If you have a better idea, please chime in.</p>\n\n<p>After testing if the location already exists and it does:</p>\n\n<pre><code>// in a transaction\ntx := DB.Begin()\n\n// create the message with transaction disabled\nif errMssgCreate := tx.Set(\"gorm:save_associations\", false).Create(mssg).Error; errMssgCreate != nil {\n            tx.Rollback()\n            log.Println(errMssgCreate)\n}\n\n// then create the association with existing location\nif errMssgLocCreate := tx.Model(&amp;mssg).Association(\"Locations\").Replace(&amp;existLoc).Error; errMssgLocCreate != nil {\n            tx.Rollback()\n            log.Println(errMssgLocCreate)\n}\n\ntx.Commit()\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1463869192, "post_id": 37368442, "comment_id": 62249803, "body": "You probably missed a space in the beginning or something. I took the value and wrote a playground program and it just works. <a href=\"https://play.golang.org/p/ka3btmI4W0\" rel=\"nofollow noreferrer\">play.golang.org/p/ka3btmI4W0</a>"}, {"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1463869525, "post_id": 37368442, "comment_id": 62249866, "body": "I tried your example and please take a lookt at this. No idea why my string wont work <a href=\"https://play.golang.org/p/EtuohgMP8R\" rel=\"nofollow noreferrer\">play.golang.org/p/EtuohgMP8R</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "is_accepted": true, "score": 4, "last_activity_date": 1463870701, "creation_date": 1463870701, "answer_id": 37368727, "question_id": 37368442, "link": "https://stackoverflow.com/questions/37368442/go-parsing-time-string/37368727#37368727", "title": "Go parsing time string", "body": "<p>You can compare the two strings (the one that won't work, and where you type the \"same\" string in manually) and you can see there's a difference. The string that doesn't work uses <strong>A0</strong> (hex) <em>non-breaking space</em>, while the one that works uses the regular <em>space</em> <strong>20</strong> (hex).</p>\n\n<p>You can see it in the playground: <a href=\"https://play.golang.org/p/6UIEKg9hs0\" rel=\"nofollow\">https://play.golang.org/p/6UIEKg9hs0</a></p>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 37368727, "answer_count": 1, "score": 1, "last_activity_date": 1463870701, "creation_date": 1463868047, "question_id": 37368442, "link": "https://stackoverflow.com/questions/37368442/go-parsing-time-string", "title": "Go parsing time string", "body": "<p>I currently have the following date string</p>\n\n<pre><code>May 21 2016, 21:47:08 CEST\n</code></pre>\n\n<p>So I want to parse it. I tried the following</p>\n\n<pre><code>time, err := time.Parse(\"Jan 2 2006, 15:04:05 MST\", date)\n</code></pre>\n\n<p>But I am getting the following error</p>\n\n<pre><code>parsing time \"May\u00a021\u00a02016,\u00a021:47:08\u00a0CEST\" as \"Jan 2 2006, 15:04:05 CEST\": cannot parse \"\u00a021\u00a02016,\u00a021:47:08\u00a0CEST\" as \" \"\n</code></pre>\n\n<p>I think I have checked that all the values are correct on the layout.</p>\n"}, {"tags": ["performance", "go", "profiling", "pprof"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1463868784, "post_id": 37368353, "comment_id": 62249720, "body": "You&#39;re going to have to sample for a lot longer that 1.7 sec, especially at only 4-10% cpu. Try sampling for a few minutes."}, {"owner": {"reputation": 5956, "user_id": 354132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1ac5fd6aa3d8027e6f022d789e92cddd?s=128&d=identicon&r=PG", "display_name": "Arnout Engelen", "link": "https://stackoverflow.com/users/354132/arnout-engelen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463869556, "post_id": 37368353, "comment_id": 62249878, "body": "I ran the process for something like a minute wall-clock time. I&#39;m guessing the 1.77 seconds mentioned in the output are CPU time, so excluding the time that the CPU was idle (program being blocked or sleeping). I&#39;ll try running longer though!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1463871011, "post_id": 37368353, "comment_id": 62250178, "body": "Normally when you profile you stress the code path that you&#39;re profiling to get as many samples as possible from there, rather than an idle runtime. If you&#39;re only using 4-10% cpu, 90-96% of your samples won&#39;t be any good."}, {"owner": {"reputation": 5956, "user_id": 354132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1ac5fd6aa3d8027e6f022d789e92cddd?s=128&d=identicon&r=PG", "display_name": "Arnout Engelen", "link": "https://stackoverflow.com/users/354132/arnout-engelen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463871311, "post_id": 37368353, "comment_id": 62250240, "body": "Certainly that&#39;s the next step, but first I need to identify what part of the code needs improvement. Of course I can make an educated guess, but it&#39;d be great if a profiler could validate that theory before going further."}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 0, "creation_date": 1463887465, "post_id": 37368353, "comment_id": 62252641, "body": "The reason of the issue are elsewhere, but you should try to increase the sampling time anyway, for example, performing the same task in a loop a few times."}], "answers": [{"comments": [{"owner": {"reputation": 5956, "user_id": 354132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1ac5fd6aa3d8027e6f022d789e92cddd?s=128&d=identicon&r=PG", "display_name": "Arnout Engelen", "link": "https://stackoverflow.com/users/354132/arnout-engelen"}, "edited": false, "score": 0, "creation_date": 1463904127, "post_id": 37370216, "comment_id": 62255583, "body": "Thanks, I feel so stupid! I take some comfort in the fact that I&#39;m not alone: <a href=\"https://github.com/golang/go/issues/10863\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/10863</a> :)"}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "reply_to_user": {"reputation": 5956, "user_id": 354132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1ac5fd6aa3d8027e6f022d789e92cddd?s=128&d=identicon&r=PG", "display_name": "Arnout Engelen", "link": "https://stackoverflow.com/users/354132/arnout-engelen"}, "edited": false, "score": 0, "creation_date": 1463915258, "post_id": 37370216, "comment_id": 62258502, "body": "Yes don&#39;t worry, happened to me as well and I was lucky enough to notice it before posting on SO! :D"}, {"owner": {"reputation": 5956, "user_id": 354132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1ac5fd6aa3d8027e6f022d789e92cddd?s=128&d=identicon&r=PG", "display_name": "Arnout Engelen", "link": "https://stackoverflow.com/users/354132/arnout-engelen"}, "edited": false, "score": 1, "creation_date": 1463915674, "post_id": 37370216, "comment_id": 62258626, "body": "Hopefully <a href=\"https://go-review.googlesource.com#/c/23323/\" rel=\"nofollow noreferrer\">go-review.googlesource.com#/c/23323</a> will make it through in some form or other, so we&#39;ll save future generations this confusion"}], "tags": [], "owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "is_accepted": true, "score": 3, "last_activity_date": 1463887381, "creation_date": 1463887381, "answer_id": 37370216, "question_id": 37368353, "link": "https://stackoverflow.com/questions/37368353/pprof-cpu-profile-of-a-go-application-does-not-show-any-samples/37370216#37370216", "title": "pprof CPU profile of a go application does not show any samples", "body": "<p>You are mis-using the <code>go tool pprof</code>, because you shall specify the executable file associated with the generated profile.</p>\n\n<p>Compare this</p>\n\n<pre><code>$ go tool pprof --text cpuprofile.prof\n680ms of 680ms total (  100%)\n      flat  flat%   sum%        cum   cum%\n     680ms   100%   100%      680ms   100% \n</code></pre>\n\n<p>with this (note <code>main</code>, that is the executable that produced the <code>cpuprofile.prof</code>)</p>\n\n<pre><code>$ go tool pprof --text main cpuprofile.prof\n680ms of 680ms total (  100%)\n      flat  flat%   sum%        cum   cum%\n     350ms 51.47% 51.47%      610ms 89.71%  main.renderMandelbrotUnified\n     130ms 19.12% 70.59%      130ms 19.12%  math.Log\n      40ms  5.88% 76.47%       60ms  8.82%  image.(*RGBA).Set\n[cut]\n</code></pre>\n\n<p>It's not a matter of wrong sampling: consider that around 100 samples are taken every second of execution, so even of 1.7s you should get some samples anyway (<a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow\">from here</a>):</p>\n\n<blockquote>\n  <p>When CPU profiling is enabled, the Go program stops about 100 times\n  per second and records a sample consisting of the program counters on\n  the currently executing goroutine's stack</p>\n</blockquote>\n"}], "owner": {"reputation": 5956, "user_id": 354132, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/1ac5fd6aa3d8027e6f022d789e92cddd?s=128&d=identicon&r=PG", "display_name": "Arnout Engelen", "link": "https://stackoverflow.com/users/354132/arnout-engelen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2897, "favorite_count": 2, "accepted_answer_id": 37370216, "answer_count": 1, "score": 4, "last_activity_date": 1463887638, "creation_date": 1463867363, "last_edit_date": 1463887638, "question_id": 37368353, "link": "https://stackoverflow.com/questions/37368353/pprof-cpu-profile-of-a-go-application-does-not-show-any-samples", "title": "pprof CPU profile of a go application does not show any samples", "body": "<p>I'm profiling a Go application with pprof.</p>\n\n<p>The application is using about 4-10% CPU and leaving it running for a short while produces a profile of around 6-11kb. This suggests to me that it should be able to sample some activity.</p>\n\n<p>When I view the result, however, I see the following:</p>\n\n<pre><code>$ go tool pprof --text bigproc\n1.77s of 1.77s total (  100%)\n      flat  flat%   sum%        cum   cum%\n     1.77s   100%   100%      1.77s   100%\n$\n</code></pre>\n\n<p>The interesting information appears to be missing. What could be wrong?</p>\n\n<p>This is on linux, with go version 1.6.1 and pprof version 2.2.1 of google-perftools (if that matters).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4532, "user_id": 366864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yP664.jpg?s=128&g=1", "display_name": "ddotsenko", "link": "https://stackoverflow.com/users/366864/ddotsenko"}, "edited": false, "score": 0, "creation_date": 1512850399, "post_id": 37368278, "comment_id": 82425966, "body": "<a href=\"https://coderwall.com/p/p1fckg/context-managers-in-go-don-t-be-ridiculous\" rel=\"nofollow noreferrer\">coderwall.com/p/p1fckg/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 570, "user_id": 1377607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IwqMP.png?s=128&g=1", "display_name": "chinmay", "link": "https://stackoverflow.com/users/1377607/chinmay"}, "edited": false, "score": 0, "creation_date": 1463867227, "post_id": 37368310, "comment_id": 62249373, "body": "Actually i was not just looking for opening and closing of a file. Just provided that as an example. Looking for more or less like <code>__enter__</code> and <code>__exit__</code>, which we have in python."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 570, "user_id": 1377607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IwqMP.png?s=128&g=1", "display_name": "chinmay", "link": "https://stackoverflow.com/users/1377607/chinmay"}, "edited": false, "score": 0, "creation_date": 1463867341, "post_id": 37368310, "comment_id": 62249397, "body": "@Chinmay the answer is still no, there&#39;s <a href=\"https://golang.org/pkg/runtime/#SetFinalizer\" rel=\"nofollow noreferrer\"><code>runtime.SetFinalizer</code></a> but it shouldn&#39;t really be relayed on since it&#39;s not always guaranteed to run."}, {"owner": {"reputation": 570, "user_id": 1377607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IwqMP.png?s=128&g=1", "display_name": "chinmay", "link": "https://stackoverflow.com/users/1377607/chinmay"}, "edited": false, "score": 0, "creation_date": 1463868580, "post_id": 37368310, "comment_id": 62249671, "body": "Thanks, marking it as the answer, May be you can provide the usage of the method <code>WithFile</code> to make it complete."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1463881385, "post_id": 37368310, "comment_id": 62251768, "body": "It exists in a less convenient form with a different syntax than Python. You can <a href=\"https://play.golang.org/p/yv9VlnmwDU\" rel=\"nofollow noreferrer\">see an inline example on Go Playground</a> that is usable in many situations rather than using a specific function for <code>*os.File</code> objects. That said, this answer isn&#39;t wrong, just specific to <code>*os.File</code> since that was the context of the original question. Basically, the only difference between Go and Python is that you must call the <code>Close</code> method of the file explicitly, even if you <code>defer</code> the call until the function exits."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 6, "last_activity_date": 1463867030, "creation_date": 1463867030, "answer_id": 37368310, "question_id": 37368278, "link": "https://stackoverflow.com/questions/37368278/can-we-create-context-managers-in-go-like-how-we-have-in-python/37368310#37368310", "title": "Can we create context managers in Go like how we have in python", "body": "<p>No, you can't, but you can create the same illusion with a little wrapper func:</p>\n\n<pre><code>func WithFile(fname string, fn func(f *os.File) error) error {\n    f, err := os.Open(fname)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n    return fn(f)\n}\n</code></pre>\n"}], "owner": {"reputation": 570, "user_id": 1377607, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IwqMP.png?s=128&g=1", "display_name": "chinmay", "link": "https://stackoverflow.com/users/1377607/chinmay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 943, "favorite_count": 1, "accepted_answer_id": 37368310, "answer_count": 1, "score": 3, "last_activity_date": 1463868640, "creation_date": 1463866821, "last_edit_date": 1463868640, "question_id": 37368278, "link": "https://stackoverflow.com/questions/37368278/can-we-create-context-managers-in-go-like-how-we-have-in-python", "title": "Can we create context managers in Go like how we have in python", "body": "<p>In python, I find the context managers really helpful. I was trying to find the same in <em>Go</em>.</p>\n\n<p>e.g:</p>\n\n<pre><code>with open(\"filename\") as f:\n    do something here\n</code></pre>\n\n<p>where open is a context manager in python handling the entry and exit, which implicitly takes care of closing the file opened.</p>\n\n<p>Instead of we explicitly doing like this:</p>\n\n<pre><code>f := os.Open(\"filename\")\n//do something here\ndefer f.Close()\n</code></pre>\n\n<p>Can this be done in Go as well ? Thanks in advance.</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 0, "creation_date": 1463856800, "post_id": 37366674, "comment_id": 62246527, "body": "First of all Go is designed for concurrency, not parallelism. You should take a look at <a href=\"https://talks.golang.org/2012/waza.slide#1\" rel=\"nofollow noreferrer\">talks.golang.org/2012/waza.slide#1</a> to understand the difference."}, {"owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "edited": false, "score": 0, "creation_date": 1463857380, "post_id": 37366674, "comment_id": 62246709, "body": "It might be helpful to post the example links you are referencing."}, {"owner": {"reputation": 309, "user_id": 2044498, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/e0864c51659e8fc7ace84a5fb0401ba2?s=128&d=identicon&r=PG", "display_name": "Phil", "link": "https://stackoverflow.com/users/2044498/phil"}, "edited": false, "score": 0, "creation_date": 1463858217, "post_id": 37366674, "comment_id": 62246928, "body": "I had some thoughts around an application which is waiting for incoming requests and then uses concurrency to deal with those, in some way similar to a load balancer. I just can&#39;t find any more simplistic self contained examples which would nicely demonstrate concurrency bringing a performance benefit."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 8, "creation_date": 1463858844, "post_id": 37366674, "comment_id": 62247085, "body": "Concurrency does not bring performance by itself, it&#39;s more about design and architecture of your application. It can make your program more scalable because concurrent programs can become faster very easily by executing everything in parallel just like Golang does with it&#39;s goroutines that are multiplexed on multiple threads. But goroutines do not make your program faster by themselves. So any code that use goroutines will be concurrent. Whether it will be faster when executed on multiple threads depends on the code itself."}, {"owner": {"reputation": 309, "user_id": 2044498, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/e0864c51659e8fc7ace84a5fb0401ba2?s=128&d=identicon&r=PG", "display_name": "Phil", "link": "https://stackoverflow.com/users/2044498/phil"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1463859165, "post_id": 37366674, "comment_id": 62247183, "body": "@creker, yes, i think you&#39;ve hit the nail on the head and it ultimately explains why there isn&#39;t really just a simple example."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1463860358, "post_id": 37366674, "comment_id": 62247513, "body": "@Phil, this question and the answer may be interesing to you <a href=\"http://stackoverflow.com/questions/36104038/go-concurrency-chudnovkys-algorithm-slower-than-sync/\" title=\"go concurrency chudnovkys algorithm slower than sync\">stackoverflow.com/questions/36104038/&hellip;</a> It has simple example that solves pretty popular problem. The initial version is concurrent but is even slower when executed in parallel on multiple cores. With the right approach you can make it both concurrent and faster when executed in parallel."}, {"owner": {"reputation": 742, "user_id": 717318, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/13e99fc7225ca378040ef36ef1a3049e?s=128&d=identicon&r=PG", "display_name": "Kevin Deenanauth", "link": "https://stackoverflow.com/users/717318/kevin-deenanauth"}, "edited": false, "score": 0, "creation_date": 1463871598, "post_id": 37366674, "comment_id": 62250295, "body": "Also checkout some of the examples at <a href=\"https://divan.github.io/posts/go_concurrency_visualize/\" rel=\"nofollow noreferrer\">divan.github.io/posts/go_concurrency_visualize</a>"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1463876577, "post_id": 37366674, "comment_id": 62251119, "body": "Little general for SO, but a common case is a server dealing with lots of Web requests coming in. Each takes some time, between CPU and waiting for the DB and network to do their things. You&#39;re relying on the system&#39;s ability to do multiple things at once (on one CPU or multiple). You aren&#39;t taking a big problem and splitting it into N CPU-limited threads, which is the prototypical case of CPU parallelism. If you parse it closely the distinction gets fuzzy; I think the larger point is that everyday uses of concurrency often aren&#39;t in the &quot;split up one big task to use many cores&quot; paradigm."}], "answers": [{"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1464648936, "post_id": 37370555, "comment_id": 62559361, "body": "The latter remarks are related to Amdahl&#39;s Law (more of a useful guidance really), which can be paraphrased as: parallelism only gets you a speed-up in proportion to the amount of your program that still executes sequentially. <a href=\"https://en.wikipedia.org/wiki/Amdahl%27s_law\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Amdahl%27s_law</a>"}], "tags": [], "owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "is_accepted": true, "score": 4, "last_activity_date": 1463915456, "last_edit_date": 1463915456, "creation_date": 1463891318, "answer_id": 37370555, "question_id": 37366674, "link": "https://stackoverflow.com/questions/37366674/simple-go-concurrency-example/37370555#37370555", "title": "Simple Go concurrency example", "body": "<p>Concurrency and parallelism are two related, but different things. The topic is broad, but let me briefly focus here on the speed.</p>\n\n<p>Concurrency is related to how design and structure a program in a way that, if parallelism can be applied, then the software may run faster.</p>\n\n<p>For example; if you have a loop such as</p>\n\n<pre><code>x := []int{1, 2, 3, 4, 5, 6}\nfor i := range x {\n  x[i] *= x[i];\n}\n</code></pre>\n\n<p>this program \"feels\" concurrent, because the read and write instructions that compute the square of each number in the array are logically independent one from the other. So, you could theoretically design your code in a concurrent way, for example by using goroutines:</p>\n\n<pre><code>x := []int{1, 2, 3, 4, 5, 6}\nfor i := range x {\n  go func(j int) { x[j] *= x[j]; }(i)\n}\nwait_the_goroutines();\n</code></pre>\n\n<p>Assume for now that there are no data races in this example, and each update can be done independently. Well, the update of those values could be made in parallel, because the concurrent <em>design</em> allows it. With the old code, the update is serial <em>by design</em>.</p>\n\n<p>Parallelism comes in when the computer (CPU, GPU, etc) is able to process multiple instructions at once, in the exact same time. If you have one core in your computer, the goroutines above are unlikely executed in parallel. If you have multiple cores, they <em>may</em> be executed in parallel - because they can be, but you have no <em>actual</em> control on how your computer's parallel hardware is used to execute the code in parallel. That's a task for the go runtime.</p>\n\n<p>In some sense, concurrency is not used to increase execution speed: parallelism is. Concurrency is used to allow correct parallelization of code.</p>\n\n<p>Therefore, you cannot really get such example, because even if you can get a \"very concurrent\" code, the execution speed is bounded to two things:</p>\n\n<ol>\n<li>how much you can parallelize </li>\n<li>how the go runtime will schedule the goroutines.</li>\n</ol>\n"}], "owner": {"reputation": 309, "user_id": 2044498, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/e0864c51659e8fc7ace84a5fb0401ba2?s=128&d=identicon&r=PG", "display_name": "Phil", "link": "https://stackoverflow.com/users/2044498/phil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 1, "accepted_answer_id": 37370555, "answer_count": 1, "score": 0, "last_activity_date": 1463915456, "creation_date": 1463855632, "question_id": 37366674, "link": "https://stackoverflow.com/questions/37366674/simple-go-concurrency-example", "title": "Simple Go concurrency example", "body": "<p>What would be a simple example of concurrency being used to increase execution speed? \nI've found a number of examples which use parallelism but none that just use concurrency.</p>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": false, "score": 2, "last_activity_date": 1463856818, "creation_date": 1463856818, "answer_id": 37366860, "question_id": 37366668, "link": "https://stackoverflow.com/questions/37366668/strange-behaviour-when-passing-a-struct-property-slice-to-a-function-that-remo/37366860#37366860", "title": "Strange behaviour when passing a struct property (slice) to a function that removes elements from it", "body": "<p>The slice is a composite type. It has a pointer to the data, the length and the capacity. When you pass it as an argument you're passing those values, the pointer, the length and the capacity; they are copies, always.</p>\n\n<p>In your case you modify the data within the slice when you call <code>removeFrom()</code>, which you can do because you've copied the value of a pointer to the original data into the func, but the length and capacity remain unchanged outside the scope of that function as those are not pointers. </p>\n\n<p>So, when you print it again from <code>main()</code> you see the altered values but it still uses the original length and capacity as any changes made to those within the scope of the other funcs were actually on copies of those values.</p>\n"}, {"comments": [{"owner": {"reputation": 133, "user_id": 6256602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bafb1aa784e2f486c4fa1c0696e06590?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/6256602/abel"}, "edited": false, "score": 0, "creation_date": 1463857798, "post_id": 37366894, "comment_id": 62246811, "body": "But how do I print the original slice values instead of the new ones in the third <code>Println</code>? Is there any way to prevent changes made to it&#39;s values inside the function from affecting it externally? Or perhaps a way to copy its original value before manipulating it inside the function?"}, {"owner": {"reputation": 133, "user_id": 6256602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bafb1aa784e2f486c4fa1c0696e06590?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/6256602/abel"}, "edited": false, "score": 0, "creation_date": 1463859416, "post_id": 37366894, "comment_id": 62247244, "body": "But what I want is the third print to show the same as the first :P"}, {"owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "reply_to_user": {"reputation": 133, "user_id": 6256602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bafb1aa784e2f486c4fa1c0696e06590?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/6256602/abel"}, "edited": false, "score": 1, "creation_date": 1463859901, "post_id": 37366894, "comment_id": 62247371, "body": "@abel you might want to use <code>copy()</code>.  <code>copy(newSlice, slice)</code>"}], "tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": true, "score": 4, "last_activity_date": 1463985575, "last_edit_date": 1463985575, "creation_date": 1463857021, "answer_id": 37366894, "question_id": 37366668, "link": "https://stackoverflow.com/questions/37366668/strange-behaviour-when-passing-a-struct-property-slice-to-a-function-that-remo/37366894#37366894", "title": "Strange behaviour when passing a struct property (slice) to a function that removes elements from it", "body": "<p>Usually we don't know whether a given call to append will cause a reallocation, so we can't assume that the original slice refers to the same array as the resulting slice, nor that it refers to a different one. </p>\n\n<p>To use slices correctly, it's important to remember that although the elements of the underlying array are indirect, the slice's pointer, length and capacity are not. </p>\n\n<p>As a result, it's usual to assign the result of a call to append to the same slice variable:</p>\n\n<pre><code>array = append(array, ...)\n</code></pre>\n\n<p>So to sum up, to receive the desired result always remember to assign the append function to a new or the same slice variable.</p>\n\n<p>Here is the corrected and working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype testStruct struct {\n    testArray []float64\n}\n\nvar test = testStruct {\n    testArray: []float64{10,20,30,40,50},\n}\n\nfunc main() {\n    fmt.Println(test.testArray)\n    a := testFunction(test.testArray)\n    fmt.Println(a)\n}\n\nfunc testFunction(array []float64)[]float64 {\n    for i:=0; i&lt;3; i++ {\n        array = removeFrom(array, 0)\n    }\n    fmt.Println(array)\n    return array\n}\n\nfunc removeFrom(array []float64, index int) []float64 {\n    return append(array[:index], array[index+1:]...)\n}\n</code></pre>\n\n<p>Check it the working code on <kbd><a href=\"https://play.golang.org/p/GUevGDbXxX\" rel=\"nofollow\">Go Playground</a></kbd>.</p>\n\n<hr>\n\n<p>Another solution is to pass the array argument via pointer reference:</p>\n\n<pre><code>func testFunction(array *[]float64) {\n    for i:=0; i&lt;3; i++ {\n        *array = removeFrom(*array, 0)\n    }\n    fmt.Println(*array)\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/_w4NFZAcBA\" rel=\"nofollow\">Go Playground</a></kbd></p>\n"}, {"tags": [], "owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "is_accepted": false, "score": 2, "last_activity_date": 1463857050, "creation_date": 1463857050, "answer_id": 37366903, "question_id": 37366668, "link": "https://stackoverflow.com/questions/37366668/strange-behaviour-when-passing-a-struct-property-slice-to-a-function-that-remo/37366903#37366903", "title": "Strange behaviour when passing a struct property (slice) to a function that removes elements from it", "body": "<p>Here is a useful blog post about slices <a href=\"https://blog.golang.org/slices\" rel=\"nofollow\">https://blog.golang.org/slices</a>. It states this in particular.</p>\n\n<blockquote>\n  <p>It's important to understand that even though a slice contains a\n  pointer, it is itself a value. Under the covers, it is a struct value\n  holding a pointer and a length. It is not a pointer to a struct.</p>\n</blockquote>\n\n<p>The reason you see <code>[40 50 50 50 50]</code> is because you changed the values in the slice, but you did not alter the slice itself(it's cap and len)</p>\n"}], "owner": {"reputation": 133, "user_id": 6256602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bafb1aa784e2f486c4fa1c0696e06590?s=128&d=identicon&r=PG", "display_name": "abel", "link": "https://stackoverflow.com/users/6256602/abel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 37366894, "answer_count": 3, "score": 1, "last_activity_date": 1463985575, "creation_date": 1463855610, "question_id": 37366668, "link": "https://stackoverflow.com/questions/37366668/strange-behaviour-when-passing-a-struct-property-slice-to-a-function-that-remo", "title": "Strange behaviour when passing a struct property (slice) to a function that removes elements from it", "body": "<p>I've started learning Go these days and got stuck in trying to pass a struct property's value (a slice) to a function. Apparently it's being passed as a reference (or it holds a pointer to its slice) and changes made inside the function affect it. </p>\n\n<p>Here is my code, in which <code>testFunction</code> is supposed to receive a slice, remove its first 3 elements and print the updated values, but without affecting it externally:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype testStruct struct {\n    testArray []float64\n}\n\nvar test = testStruct {\n    testArray: []float64{10,20,30,40,50},\n}\n\nfunc main() {\n    fmt.Println(test.testArray)\n    testFunction(test.testArray)\n    fmt.Println(test.testArray)\n}\n\nfunc testFunction(array []float64) {\n    for i:=0; i&lt;3; i++ {\n        array = removeFrom(array, 0)\n    }\n    fmt.Println(array)\n}\n\nfunc removeFrom(array []float64, index int) []float64 {\n    return append(array[:index], array[index+1:]...)\n}\n</code></pre>\n\n<p>That outputs:</p>\n\n<pre><code>[10 20 30 40 50]\n[40 50]\n[40 50 50 50 50]\n</code></pre>\n\n<p>My question is: what is causing the third <code>fmt.Println</code> to print this strange result?</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/G8W3H085In\" rel=\"nofollow\">https://play.golang.org/p/G8W3H085In</a></p>\n\n<p>p.s.: This code is only an example. It's not my goal to remove the first elements of something. I just wanna know what is causing this strange behaviour. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "edited": false, "score": 0, "creation_date": 1463857678, "post_id": 37366219, "comment_id": 62246785, "body": "Yeah I can&#39;t believe it was that simple. I guess I need some down time. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "is_accepted": true, "score": 1, "last_activity_date": 1463854525, "creation_date": 1463854525, "answer_id": 37366490, "question_id": 37366219, "link": "https://stackoverflow.com/questions/37366219/golang-recursive-data-structures/37366490#37366490", "title": "Golang: Recursive data structures", "body": "<p><a href=\"https://play.golang.org/p/gZyKp2bNWY\" rel=\"nofollow\">Is this</a> what you're looking for?</p>\n"}, {"comments": [{"owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "edited": false, "score": 0, "creation_date": 1504166146, "post_id": 37366752, "comment_id": 78910863, "body": "This is a better solution when not having a list but only a recursive association"}], "tags": [], "owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "is_accepted": false, "score": 1, "last_activity_date": 1463856086, "creation_date": 1463856086, "answer_id": 37366752, "question_id": 37366219, "link": "https://stackoverflow.com/questions/37366219/golang-recursive-data-structures/37366752#37366752", "title": "Golang: Recursive data structures", "body": "<p>TLDR: I think it is possible</p>\n\n<p>Using your Trie struct</p>\n\n<pre><code>type Trie struct {\n    elem byte\n    others []*Trie\n}\n</code></pre>\n\n<p>Here is a modified <code>createTrie</code> constructor. I wasn't sure if you wanted to show a chain of <code>Trie</code>s so I figured to pass <code>level</code> just as an example.</p>\n\n<pre><code>func createTrie(levels int) *Trie {\n    result := &amp;Trie{\n        others: make([]*Trie, 0, 13),\n    }\n    for level := 0 ;level &lt; levels; level++ {\n        result.others = append(result.others, createTrie(levels - 1))\n    }\n\n    return result\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-GRm0tV-B1\" rel=\"nofollow\">https://play.golang.org/p/-GRm0tV-B1</a></p>\n"}], "owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2034, "favorite_count": 2, "accepted_answer_id": 37366490, "answer_count": 2, "score": 4, "last_activity_date": 1463856086, "creation_date": 1463852683, "question_id": 37366219, "link": "https://stackoverflow.com/questions/37366219/golang-recursive-data-structures", "title": "Golang: Recursive data structures", "body": "<p>I have a simple question... I'm trying to reproduce this recursive data structure in Golang with slices.</p>\n\n<pre><code>type Trie map[byte]Trie\n</code></pre>\n\n<p>Right now I have some 'rough' source code using the recursive data structure below with slices and everything works fine except my typed structure is a structure and not a slice of structures. Ideally I would like my typed recursive data structure to be a slice of Trie's which has elements Trie{byte, []Trie}. Hope that makes sense? Right now I have a type which is a Trie struct{byte, []Trie}. </p>\n\n<pre><code>type Trie struct {\nelem byte\nothers []Trie\n} \n</code></pre>\n\n<p>Maybe this will help. When I create my Trie of slices right now I use this function.</p>\n\n<pre><code>func CreateTrie() []Trie {\n    return make([]Trie, 0, 13)\n}\n</code></pre>\n\n<p>I would like to have the Trie of slices defined in such a way that I could create the slices like this.</p>\n\n<pre><code>func CreateTrie() Trie {\n    return make(Trie, 0, 13)\n}\n</code></pre>\n\n<p>Is this possible with slices or do I have use my first(only) solution for slices?</p>\n"}, {"tags": ["go", "websocket", "server", "gorilla"], "comments": [{"owner": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "edited": false, "score": 0, "creation_date": 1463852791, "post_id": 37366214, "comment_id": 62245198, "body": "Have you checked the examples in the Github repo?"}, {"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "reply_to_user": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "edited": false, "score": 0, "creation_date": 1463852929, "post_id": 37366214, "comment_id": 62245232, "body": "@JohnSmith <a href=\"https://github.com/gorilla/websocket/blob/master/server.go\" rel=\"nofollow noreferrer\">This one</a>?"}, {"owner": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "edited": false, "score": 0, "creation_date": 1463853086, "post_id": 37366214, "comment_id": 62245277, "body": "Nope, <a href=\"https://github.com/gorilla/websocket/blob/master/examples/filewatch/main.go\" rel=\"nofollow noreferrer\">this one</a>."}, {"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "reply_to_user": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "edited": false, "score": 0, "creation_date": 1463853392, "post_id": 37366214, "comment_id": 62245388, "body": "@JohnSmith I&#39;m not sure how that would help :/ could you explain?"}, {"owner": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "edited": false, "score": 0, "creation_date": 1463853834, "post_id": 37366214, "comment_id": 62245541, "body": "It shows how to handle ping/pong requests. Basically you don&#39;t really need to do anything other than handling the deadlines as it is in the example. Once there is no response from the client within the specified timeframe, you can just return (close the connection on the server)."}, {"owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "reply_to_user": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "edited": false, "score": 0, "creation_date": 1463857750, "post_id": 37366214, "comment_id": 62246800, "body": "Alright, thanks. Think i got it now"}], "owner": {"reputation": 4510, "user_id": 6224823, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-eVoU_E2fMho/AAAAAAAAAAI/AAAAAAAAAC4/7qlAOwlIJkM/photo.jpg?sz=128", "display_name": "Olian04", "link": "https://stackoverflow.com/users/6224823/olian04"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2637, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1463852643, "creation_date": 1463852643, "question_id": 37366214, "link": "https://stackoverflow.com/questions/37366214/gorilla-websocket-read-error-repeated-read-on-failed-websocket-connection", "title": "Gorilla Websocket - Read error: repeated read on failed websocket connection", "body": "<p>Using the gorilla websocket api for go, how do i know if a client is still connected?</p>\n\n<p>What Im trying with now is: </p>\n\n<pre><code>func Listen(ws *websocket.Conn) {\n    connTimeout := 3\n    timeLastSent := time.Now().Second()\n\n    for ((timeLastSent + connTimeout) % 60) != time.Now().Second() {\n\n        msg := Message{}\n        err := ws.ReadJSON(&amp;msg)\n\n        if err == websocket.ErrCloseSent {\n            break\n        } else if err != nil {\n            continue\n        }\n\n        //Message recived\n        EventMessage &lt;- msg\n\n        timeLastSent = time.Now().Second()\n    }\n  //Connection timed out.\n    return\n}\n</code></pre>\n\n<p>But this results in the error <code>repeated read on failed websocket connection</code>.  </p>\n\n<p>Ive been looking into using <code>ws.SetReadDeadline(t)</code>, but Ive no idea of either how to use it nor if its even the thing Im looking for.</p>\n\n<p>How should i go about this?   </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1463857198, "post_id": 37366140, "comment_id": 62246646, "body": "But how can I set a funcMap variable for each request?"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "edited": false, "score": 0, "creation_date": 1463867139, "post_id": 37366140, "comment_id": 62249350, "body": "@AlvaroCarvajalNakosmai you set it once before you start your http handler."}], "tags": [], "owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "is_accepted": false, "score": 0, "last_activity_date": 1463852152, "creation_date": 1463852152, "answer_id": 37366140, "question_id": 37365825, "link": "https://stackoverflow.com/questions/37365825/variables-for-goroutines/37366140#37366140", "title": "Variables for goroutines", "body": "<p>There are only two ways that I know to communicate between the go code and the template.</p>\n\n<p>The first one is the one you use. By passing a struct to the ExecuteTemplate function you can access all its field in the template.</p>\n\n<p>The second one is to register other functions using:</p>\n\n<pre><code>func (t *Template) Funcs(funcMap FuncMap) *Template\n</code></pre>\n\n<p>See <a href=\"https://golang.org/pkg/html/template/#Template.Funcs\" rel=\"nofollow\">documentation for more information</a>. The funcMap is a simple map[string]interface{}, you can register any function and call it in the template by using its name (the key of the map).</p>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1463852152, "creation_date": 1463850399, "question_id": 37365825, "link": "https://stackoverflow.com/questions/37365825/variables-for-goroutines", "title": "Variables for goroutines", "body": "<p>Im currently making a web app using Go. I want to know on my templates when the user is logged in or not and I am currently making it using this approach</p>\n\n<pre><code>response := &amp;viewCharacter{true}\ntemplate.Renderer.ExecuteTemplate(w, \"character_search.html\", response)\n</code></pre>\n\n<p>As you see I am passing a viewCharacter struct that only contains a bool Logged then on a template I can do the following</p>\n\n<pre><code>{{ if .Logged }}\n</code></pre>\n\n<p>Is there any other approach to do this? instead of passing on each template a logged bool? </p>\n\n<p>Maybe setting a variable for each goroutine of the http handler that saves if the user is logged or not?</p>\n"}, {"tags": ["go", "request", "client"], "answers": [{"comments": [{"owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "edited": false, "score": 0, "creation_date": 1463850196, "post_id": 37365134, "comment_id": 62244366, "body": "Why do you say it is a private field?"}, {"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "reply_to_user": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "edited": false, "score": 0, "creation_date": 1463850463, "post_id": 37365134, "comment_id": 62244449, "body": "Because it is part of the language: [<a href=\"https://tour.golang.org/basics/3]\" rel=\"nofollow noreferrer\">tour.golang.org/basics/3]</a>. A name starting with a capital letter is exported (public), if it doesn&#39;t it is not exported (private)."}], "tags": [], "owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "is_accepted": true, "score": 3, "last_activity_date": 1463846354, "creation_date": 1463846354, "answer_id": 37365134, "question_id": 37364795, "link": "https://stackoverflow.com/questions/37364795/how-to-make-a-custom-http-client-in-go/37365134#37365134", "title": "How to make a custom http client in Go?", "body": "<p>With Golang, you can easily create a client and use it for a request:</p>\n\n<pre><code>client := &amp;http.Client{\n    CheckRedirect: redirectPolicyFunc,\n}\n\nresp, err := client.Get(\"http://example.com\")\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow\">See the http documentation</a></p>\n\n<p>But in your case, according to the gosoundcloud package you are using, the http.Client is created when calling:</p>\n\n<pre><code>s.PasswordCredentialsToken(\"email@example.com\", \"password\");\n</code></pre>\n\n<p>The created client is embedded into the \"SoundcloudApi\" struct (the \"s\" in your code), and is a private field. Thus, you can't access it. </p>\n\n<p>Anyway it seems to be used anytime you ask \"s\" to do something (when calling s.User for example), so it seems to do what you are asking for.</p>\n"}], "owner": {"reputation": 1194, "user_id": 4135058, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/55f736d900d8dcc786419c14300dcf96?s=128&d=identicon&r=PG&f=1", "display_name": "Juanvulcano", "link": "https://stackoverflow.com/users/4135058/juanvulcano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2166, "favorite_count": 1, "accepted_answer_id": 37365134, "answer_count": 1, "score": 3, "last_activity_date": 1463853226, "creation_date": 1463844413, "last_edit_date": 1463853226, "question_id": 37364795, "link": "https://stackoverflow.com/questions/37364795/how-to-make-a-custom-http-client-in-go", "title": "How to make a custom http client in Go?", "body": "<p>I want to create a custom http Client so I can reuse it as many times as possible.\nHowever, I think Go has abstracted some of the processes that happen behind the code.\nI understand that to have a get request a client must have been created. </p>\n\n<p>Where is the client created and how can I customize it or replace it with my own? </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/njasm/gosoundcloud\"\n)\n\n s, err = gosoundcloud.NewSoundcloudApi(\"Client_Id\", \"Client_Secret\", nil)\n\n\nfunc main() {\n    if err = s.PasswordCredentialsToken(\"email@example.com\", \"password\"); err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n}\n    member, err := s.GetUser(uint64(1))\n    if err != nil {\n               panic(err)\n     }\n    fmt.Println(member.Followers)\n}\n</code></pre>\n\n<p>Here are the references of the soundcloud wrapper:</p>\n\n<pre><code>func NewSoundcloudApi(c string, cs string, callback *string) (*SoundcloudApi, error)\n\nfunc (s *SoundcloudApi) PasswordCredentialsToken(u string, p string) error\n\nfunc (s *SoundcloudApi) GetUser(id uint64) (*User, error)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "is_accepted": false, "score": 0, "last_activity_date": 1463841835, "creation_date": 1463841835, "answer_id": 37364334, "question_id": 37364267, "link": "https://stackoverflow.com/questions/37364267/unrecognized-import-path-while-fetching-go-package-gin/37364334#37364334", "title": "Unrecognized import path while fetching go package gin", "body": "<p>I just tried the command, and it works find.</p>\n\n<p>Is your GOPATH correctly set? see <a href=\"https://golang.org/doc/code.html#GOPATH\" rel=\"nofollow\">the documentation for more info.</a></p>\n"}, {"tags": [], "owner": {"reputation": 2666, "user_id": 1421957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8e742c4a05e312502c828847c455ad?s=128&d=identicon&r=PG", "display_name": "Tico", "link": "https://stackoverflow.com/users/1421957/tico"}, "is_accepted": false, "score": 1, "last_activity_date": 1463846952, "last_edit_date": 1463846952, "creation_date": 1463841892, "answer_id": 37364349, "question_id": 37364267, "link": "https://stackoverflow.com/questions/37364267/unrecognized-import-path-while-fetching-go-package-gin/37364349#37364349", "title": "Unrecognized import path while fetching go package gin", "body": "<p>According to issue <a href=\"https://github.com/gin-gonic/gin/issues/511\" rel=\"nofollow\">#51</a> - which has a similar error - indicates that this is a problem with your network. Try again later or use some proxy, as suggested on the GitHub page, such as:</p>\n\n<p><a href=\"https://github.com/ooclab/goproxy\" rel=\"nofollow\">Goproxy</a></p>\n\n<p><a href=\"https://getlantern.org/\" rel=\"nofollow\">Lantern</a></p>\n\n<p>Also, make sure you can <code>go get</code> other packages. It might be a package only problem or a 'global' one. In this case try the proxies above</p>\n"}], "owner": {"reputation": 3332, "user_id": 1900290, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/6faa40dca462409201ce09fd4f40b4d4?s=128&d=identicon&r=PG", "display_name": "Rpj", "link": "https://stackoverflow.com/users/1900290/rpj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2133, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1463846952, "creation_date": 1463841450, "question_id": 37364267, "link": "https://stackoverflow.com/questions/37364267/unrecognized-import-path-while-fetching-go-package-gin", "title": "Unrecognized import path while fetching go package gin", "body": "<p>Unrecognized import path while fetching go package gin. How do I resolve this issue</p>\n\n<pre><code>go get github.com/gin-gonic/gin\npackage gopkg.in/go-playground/validator.v8: unrecognized import path \"gopkg.in/go-playground/validator.v8\" (https fetch: Get https://gopkg.in/go-playground/validator.v8?go-get=1: dial tcp: i/o timeout)\npackage gopkg.in/yaml.v2: unrecognized import path \"gopkg.in/yaml.v2\" (https fetch: Get https://gopkg.in/yaml.v2?go-get=1: dial tcp: i/o timeout)\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "is_accepted": true, "score": 2, "last_activity_date": 1463841727, "creation_date": 1463841727, "answer_id": 37364316, "question_id": 37364033, "link": "https://stackoverflow.com/questions/37364033/find-query-with-logical-operator-for-nested-structs/37364316#37364316", "title": "Find query with logical operator for nested structs?", "body": "<p>You need to construct the equivalent of this mongo shell query using the <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/query/or/\" rel=\"nofollow\"><code>$or</code></a></strong> operator:</p>\n\n<pre><code>db.collection.find({\n    \"$or\": [\n        { \"resources.compute\" : \"compute5\" },\n        { \"resources.storage\" : \"storage3\" },\n        { \"resources.network\" : \"network1\" }\n    ]\n})\n</code></pre>\n\n<p>where in <code>go</code> this would be structured as:</p>\n\n<pre><code>bkCollection.Find(bson.M{ \"$or\": []bson.M{ \n    bson.M{ \"resources.compute\": filter.Resources.Compute }, \n    bson.M{ \"resources.storage\": filter.Resources.Storage },\n    bson.M{ \"resources.network\": filter.Resources.Network }\n}}).All(&amp;result)\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 3051068, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c57a274400e2780b6f66574a0b7df341?s=128&d=identicon&r=PG&f=1", "display_name": "FlowerPower1990", "link": "https://stackoverflow.com/users/3051068/flowerpower1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 37364316, "answer_count": 1, "score": 1, "last_activity_date": 1463850390, "creation_date": 1463840159, "last_edit_date": 1463850390, "question_id": 37364033, "link": "https://stackoverflow.com/questions/37364033/find-query-with-logical-operator-for-nested-structs", "title": "Find query with logical operator for nested structs?", "body": "<p>I want to find entries that contain any of the given arguments using $or. The database entry looks like below</p>\n\n<pre><code>\"resources\" : {\n    \"compute\" : \"compute4\",\n    \"storage\" : \"storage3\",\n    \"network\" : \"network2\"\n},\n</code></pre>\n\n<p>I want to find entries that satisfy any of the fields inside resources.</p>\n\n<pre><code>bkCollection.Find(bson.M{\"resources\": bson.M{\n    \"compute\": filter.Resources.Compute, \"$or\",\n    \"storage\": filter.Resources.Storage, \"$or\",\n    \"network\": filter.Resources.Network}}).All(&amp;result)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 547, "user_id": 4036946, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wMtQe.gif?s=128&g=1", "display_name": "jsxqf", "link": "https://stackoverflow.com/users/4036946/jsxqf"}, "edited": false, "score": 0, "creation_date": 1463883306, "post_id": 37363691, "comment_id": 62252060, "body": "I think the -html report is a good way to find branch coverage."}], "answers": [{"tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": true, "score": 2, "last_activity_date": 1550822305, "last_edit_date": 1550822305, "creation_date": 1542729153, "answer_id": 53396774, "question_id": 37363691, "link": "https://stackoverflow.com/questions/37363691/getting-branch-coverage-for-golang-tests/53396774#53396774", "title": "Getting branch coverage for golang tests", "body": "<p>As of Go 1.11 (November 2018), the generated machine code for the coverage <a href=\"https://golang.org/src/cmd/cover/cover.go#L377\" rel=\"nofollow noreferrer\">only covers each block of statements</a>. It should be possible to take that code and adjust it to cover every branch of an expression.</p>\n\n<p>It looks as if <a href=\"https://github.com/junhwi/gobco\" rel=\"nofollow noreferrer\">the gobco project</a> has done exactly this, although only for single files and not for whole packages (again, as of November 2018).</p>\n\n<p>I <a href=\"https://github.com/golang/go/issues/28888\" rel=\"nofollow noreferrer\">filed an issue</a> to see whether branch coverage is considered to be worthwhile by the Go team. The decision is to keep the current code as simple as it is now, and that decision <a href=\"https://golang.org/src/cmd/cover/cover.go#L142\" rel=\"nofollow noreferrer\">had already been documented in the code itself</a>.</p>\n\n<p>In the end <a href=\"https://github.com/rillig/gobco\" rel=\"nofollow noreferrer\">I forked the gobco project</a> and added all the features I need.</p>\n"}], "owner": {"reputation": 4123, "user_id": 785523, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b51864374e248ee87686628bc8528677?s=128&d=identicon&r=PG", "display_name": "tuk", "link": "https://stackoverflow.com/users/785523/tuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2106, "favorite_count": 0, "accepted_answer_id": 53396774, "answer_count": 1, "score": 3, "last_activity_date": 1558432623, "creation_date": 1463837930, "last_edit_date": 1558432623, "question_id": 37363691, "link": "https://stackoverflow.com/questions/37363691/getting-branch-coverage-for-golang-tests", "title": "Getting branch coverage for golang tests", "body": "<p>Can someone suggest a way to me if we can get branch coverage for my golang tests? Let's say I have a golang code which looks like below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc HelloWorld(name string, printv int) string {\n    if name == \"tuk\" || printv == 1 {\n        fmt.Println(\"Hello tuk\")\n        return \"Hello tuk\"\n    } else {\n        fmt.Println(\"Who are you?\")\n        return \"Who are you?\"\n    }\n}\n</code></pre>\n\n<p>The corresponding test file looks like below:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc TestHelloWorld(t *testing.T) {\n    r := HelloWorld(\"tuk\", 0)\n    if r != \"Hello tuk\" {\n        t.Error(\"Test Failed\")\n    }\n}\n</code></pre>\n\n<p>If I execute the below test command, it is just giving me the statement coverage:</p>\n\n<pre><code>go test -coverprofile=cover.out .\nok      test    0.007s  coverage: 60.0% of statements\n</code></pre>\n\n<p>Is there a way I can get the branch coverage as well?     </p>\n"}, {"tags": ["function", "go", "types", "type-conversion"], "comments": [{"owner": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 1, "creation_date": 1463832296, "post_id": 37362562, "comment_id": 62238813, "body": "Why don&#39;t you use ORM like GORM? Its much easier"}, {"owner": {"reputation": 231, "user_id": 786466, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0ccf67551965e4dc3a795c1b9bd54089?s=128&d=identicon&r=PG", "display_name": "roshkattu", "link": "https://stackoverflow.com/users/786466/roshkattu"}, "reply_to_user": {"reputation": 2090, "user_id": 2797642, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7f18efc80d45cd819f45c9ee71c9d2a9?s=128&d=identicon&r=PG", "display_name": "Apin", "link": "https://stackoverflow.com/users/2797642/apin"}, "edited": false, "score": 0, "creation_date": 1463832439, "post_id": 37362562, "comment_id": 62238850, "body": "I am still a beginner in Go lang. So I am trying to find out most of the perks and mindset of this programming language. GORM seems to actually be the solution that I&#39;m looking for so I&#39;ll be checking it. Thanks a lot for your response!"}], "answers": [{"comments": [{"owner": {"reputation": 231, "user_id": 786466, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0ccf67551965e4dc3a795c1b9bd54089?s=128&d=identicon&r=PG", "display_name": "roshkattu", "link": "https://stackoverflow.com/users/786466/roshkattu"}, "edited": false, "score": 0, "creation_date": 1463832294, "post_id": 37362669, "comment_id": 62238812, "body": "You are a life saver! Indeed. I forgot about the thing that I can expand the argument list! Thanks a lot!!!!"}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 1, "last_activity_date": 1463832150, "creation_date": 1463832150, "answer_id": 37362669, "question_id": 37362562, "link": "https://stackoverflow.com/questions/37362562/convert-a-variable-interface-into-variable-interface-in-go/37362669#37362669", "title": "Convert a variable []interface{} into variable ...interface{} in go", "body": "<p>From what I understand, your problem is that when you call <code>Exec</code> from <code>Insert</code> with the same arguments, it considers <code>[]interface{}</code> as an <code>interface{}</code>. In golang, you can expand a slice with the operator <code>...</code>. This way you can pass the arguments from <code>Insert</code> to <code>Exec</code>.</p>\n\n<pre><code>func exec(args ...interface{}) {\n    fmt.Println(args)\n}\n\nfunc insert(args ...interface{}) {\n    exec(args)      // Prints [[5 42]]\n    exec(args...)   // Prints [5 42]\n}\n\nfunc main() {\n    insert(5, \"42\")\n}\n</code></pre>\n"}], "owner": {"reputation": 231, "user_id": 786466, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0ccf67551965e4dc3a795c1b9bd54089?s=128&d=identicon&r=PG", "display_name": "roshkattu", "link": "https://stackoverflow.com/users/786466/roshkattu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 37362669, "answer_count": 1, "score": 0, "last_activity_date": 1463832150, "creation_date": 1463831536, "last_edit_date": 1463831863, "question_id": 37362562, "link": "https://stackoverflow.com/questions/37362562/convert-a-variable-interface-into-variable-interface-in-go", "title": "Convert a variable []interface{} into variable ...interface{} in go", "body": "<p>I am using a go mysql library to perform several database tasks. Given the fact that I want to write a wrapper package over the mysql library, I found myself into the following situation:</p>\n\n<p>I have a method with the following signature:</p>\n\n<p><code>func(db *MySQL) Insert(query string, args ...interface{}) (int64, error)</code></p>\n\n<p>This method is calling the <code>db.Exec</code> function from the library which has the following signature:</p>\n\n<p><code>func (db *DB) Exec(query string, args ...interface{}) (Result, error)</code></p>\n\n<p>It seems that when I call my method <code>Insert(\"some query\", 1, \"test\")</code> the <code>values ...interface{}</code> is translated into <code>[]interface{}</code> type which is incompatible to the Exec functions argument <code>args ...interface{}</code>. </p>\n\n<p>Q1: By understanding this situation and having in consideration that I <em>can't</em> modify the signature of <code>Exec</code> function, how would it be possible for me to transfer the <code>args</code> from my <code>Insert</code> function to the <code>Exec</code> function?</p>\n\n<p>I have tried several things to implement this but it seems I cannot achieve nor find a way to put my arguments in that function call.</p>\n\n<p>Q2: Is this even possible without modifying the signature of <code>Exec</code> ?</p>\n\n<p><strong>Edit:</strong> This is an example of what I am trying to achieve with the above functionality:</p>\n\n<pre><code>func(db *MySQL) Insert(query string, values ...interface{}) (int64, error) {\n    /**\n     * TODO: find a way to implement the args slice\n     * to implement this remember that behind Exec(_, values) there is a [] interface{} element\n     * which will decompose this element inside. so by passing a values ...interface{} function won't work\n     * as the values ...interface{} has another data type structure in the end\n     */\n    //\n    if res, err := db.dbConn.Exec(query, values); err != nil {\n        return -1, err\n    } else {\n        if lastId, err := res.LastInsertId(); err != nil {\n            return -1, err\n        } else {\n            return lastId, nil\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1463830123, "creation_date": 1463830123, "answer_id": 37362313, "question_id": 37362131, "link": "https://stackoverflow.com/questions/37362131/interface-fulfilled-by-struct-embedding/37362313#37362313", "title": "Interface fulfilled by struct embedding", "body": "<p>As per your code function mytest can be called on receiver which pointer to Base.</p>\n\n<p>Struct Derived inherits/embeds Base and Derived2 inherits/embeds *Base i.e. pointer to base.</p>\n\n<p>For   </p>\n\n<ol>\n<li><p>var _MyInt = &amp;Derived2{}: Here pointer of Derived2 is created and since Dervied2 inherits from *Base calling mytest on _MyInt will work</p></li>\n<li><p>var _MyInt = Derived2{}: Instance of Derived2 is created and since Dervied2 inherits from *Base calling mytest on _MyInt will work</p></li>\n<li><p>var _MyInt = &amp;Derived{}: Here pointer of Derived is created and since Dervied inherits from Base calling mytest on _MyInt will work</p></li>\n<li><p>var _MyInt = Derived{}: Instance of Derived is created and since Dervied inherits from Base calling mytest on _MyInt will not work has pointer to Base is expected.</p></li>\n</ol>\n\n<p>You rightly pointed out that changing receiver from *Base to Base will work because Go will be able recognize Object from pointer and will be able to call mytest.</p>\n\n<p>As per golang specification\nA type may have a method set associated with it. The method set of an interface type is its interface. The method set of any other type T consists of all methods declared with receiver type T. The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T). </p>\n\n<p>Hope this helps</p>\n"}, {"comments": [{"owner": {"reputation": 449, "user_id": 1104300, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3e28717bca99fffd3b840ec4c9ca2878?s=128&d=identicon&r=PG", "display_name": "M. Tong", "link": "https://stackoverflow.com/users/1104300/m-tong"}, "edited": false, "score": 0, "creation_date": 1463838084, "post_id": 37363643, "comment_id": 62240555, "body": "This explains it but I don&#39;t understand the motivation behind these rules."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 449, "user_id": 1104300, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3e28717bca99fffd3b840ec4c9ca2878?s=128&d=identicon&r=PG", "display_name": "M. Tong", "link": "https://stackoverflow.com/users/1104300/m-tong"}, "edited": false, "score": 0, "creation_date": 1463839073, "post_id": 37363643, "comment_id": 62240847, "body": "@M.Tong I added a paragraph explaining what I think the motivation is."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 1, "last_activity_date": 1463838959, "last_edit_date": 1463838959, "creation_date": 1463837634, "answer_id": 37363643, "question_id": 37362131, "link": "https://stackoverflow.com/questions/37362131/interface-fulfilled-by-struct-embedding/37363643#37363643", "title": "Interface fulfilled by struct embedding", "body": "<p>From the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow\">Go language specification</a>:</p>\n\n<blockquote>\n  <p>Given a struct type S and a type named T, promoted methods are\n  included in the method set of the struct as follows:</p>\n  \n  <ul>\n  <li>If S contains an anonymous field T, the method sets of S and *S both\n  include promoted methods with receiver T.</li>\n  <li>The method set of *S also\n  includes promoted methods with receiver *T.</li>\n  <li>If S contains an anonymous\n  field *T, the method sets of S and *S both include promoted methods\n  with receiver T or *T.</li>\n  </ul>\n</blockquote>\n\n<p>The case that doesn't work in your code:</p>\n\n<pre><code>var _ MyInt = Derived{}\n</code></pre>\n\n<p>Here the method set of <code>Derived</code> (which contains an anonymous field <code>Base</code>) includes methods of <code>Base</code> by rule 1. Since <code>mytest</code> is a method of <code>*Base</code> and not <code>Base</code>, it's promoted to a method of <code>*Derived</code> (by the second rule), but not of <code>Derived</code>.</p>\n\n<p>Why is it like that? Well, it's similar to the rule for method sets of structs: methods of <code>T</code> are also methods of <code>T*</code>, but not vice-versa. That's because a method of a pointer receiver can expect to be able to mutate its receiver, but a method of a non-pointer receiver can't.</p>\n"}], "owner": {"reputation": 449, "user_id": 1104300, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3e28717bca99fffd3b840ec4c9ca2878?s=128&d=identicon&r=PG", "display_name": "M. Tong", "link": "https://stackoverflow.com/users/1104300/m-tong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 37363643, "answer_count": 2, "score": 0, "last_activity_date": 1465290354, "creation_date": 1463828903, "last_edit_date": 1465290354, "question_id": 37362131, "link": "https://stackoverflow.com/questions/37362131/interface-fulfilled-by-struct-embedding", "title": "Interface fulfilled by struct embedding", "body": "<p>I'm confused by my experiments with the following program, related to fulfilling interface with struct embedding, with named types and pointer receivers, respectively:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype MyInt interface {\n    mytest()\n}\n\ntype Base struct {\n}\n\nfunc (b *Base) mytest() {\n    fmt.Println(\"From base\")\n}\n\ntype Derived struct {\n    Base\n}\n\ntype Derived2 struct {\n    *Base\n}\n\nfunc main() {\n    // Only this one has problem\n    // However, if we change mytest's receiver from *Base to Base, all the four assignments are OK\n    var _ MyInt = Derived{}\n\n    // OK\n    var _ MyInt = &amp;Derived{}\n    var _ MyInt = Derived2{}\n    var _ MyInt = &amp;Derived2{}\n}\n</code></pre>\n\n<p>See the comments in the code for my confusions. Are there any principal ways to explain them?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user3699818"}, "edited": false, "score": 0, "creation_date": 1489791879, "post_id": 37370412, "comment_id": 72842880, "body": "Thanks for this answer, really helped me. Do you know of any tools that do this better than using sed?"}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 0, "creation_date": 1489942690, "post_id": 37370412, "comment_id": 72880487, "body": "Well, yes! I used sed just as an example, but you could use awk or even your own custom tools. For example, using go itself, you can create a tool which is syntax-aware by using the parser and ast modules (check out <a href=\"https://golang.org/pkg/go/\" rel=\"nofollow noreferrer\">golang.org/pkg/go</a>)"}], "tags": [], "owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "is_accepted": true, "score": 9, "last_activity_date": 1463889830, "creation_date": 1463889830, "answer_id": 37370412, "question_id": 37362054, "link": "https://stackoverflow.com/questions/37362054/explain-go-generate-in-this-example/37370412#37370412", "title": "Explain go generate in this example", "body": "<p>I am not expert with go generate, but AFAIK, go generate is called to perform commands specified in buildable go files, normally with the intent to produce something new.</p>\n\n<p>Generate scans for files searching for a specific directive: <code>//go:generate</code> and, if found, it will execute the command following it.</p>\n\n<p>To understand better what's happening, let's make a simple example: a template go file will have a string to be replaced.</p>\n\n<h1>Example 1</h1>\n\n<p>Let's make a command that replace the template string, <code>NAME</code>, with another string, <code>AkiRoss</code>:</p>\n\n<h3>repl.sh</h3>\n\n<pre><code>#!/usr/bin/sh\nsed \"s/NAME/AkiRoss/g\" $1 &gt; $2\n</code></pre>\n\n<p>Here follows the go template, note the directive:</p>\n\n<h3>templ.go</h3>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n//go:generate ./repl.sh $GOFILE aki_$GOFILE\n\nfunc main() {\n    fmt.Println(\"Hello,\", NAME)\n}\n</code></pre>\n\n<p>Both files are in the same directory, for convenience, and repl.sh is executable. If I run <code>go generate</code> in the directory, the go tool will call <code>repl.sh templ.go aki_templ.go</code>, being <code>$GOFILE</code> expanded to be the name of the file processed by generate.</p>\n\n<p>Here's what I get:</p>\n\n<h3>aki_templ.go</h3>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n//go:generate ./repl.sh $GOFILE aki_$GOFILE\n\nfunc main() {\n        fmt.Println(\"Hello,\", AkiRoss)\n}\n</code></pre>\n\n<h1>Example 2</h1>\n\n<p>Regarding your example, you will need to place the <code>//go:generate</code> directive somewhere. It is likely, however, that the directive will be included in a different file, not the template file, that calls a replacement script, similar to the one I made, to produce a file which is needed for building.</p>\n\n<p>Let me explain this better by changing my example:</p>\n\n<h3>repl.sh</h3>\n\n<pre><code>#!/usr/bin/sh\nsed \"s/%NAME%/$3/g\" $1 &gt; $2\n</code></pre>\n\n<h3>templ.txt</h3>\n\n<pre><code>// This is a template for a go file\npackage main\n\nimport \"fmt\"\n\ntype %NAME% struct {\n    foo string\n    bar int\n}\n\nfunc (self *%NAME%) Perform() {\n    fmt.Println(self.foo, self.bar)\n}\n</code></pre>\n\n<h3>main.go</h3>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n//go:generate ./repl.sh templ.txt foobar.go FooBar\n\nfunc main() {\n    var fb = FooBar{\"AkiRoss\", -1}\n    fmt.Println(\"Running!\")\n    fb.Perform()\n}\n</code></pre>\n\n<p>Running <code>go generate</code> will produce a new file</p>\n\n<h3>foobar.go</h3>\n\n<pre><code>// This is a template for a go file\npackage main\n\nimport \"fmt\"\n\ntype FooBar struct {\n        foo string\n        bar int\n}\n\nfunc (self *FooBar) Perform() {\n        fmt.Println(self.foo, self.bar)\n}\n</code></pre>\n\n<p>which allows now to compile correctly the main:</p>\n\n<pre><code>$ go build\n$ ./program\nRunning!\nAkiRoss -1\n</code></pre>\n\n<p>I hope this clarified.</p>\n\n<h1>References</h1>\n\n<p>More details <a href=\"https://golang.org/cmd/go/#hdr-Generate_Go_files_by_processing_source\" rel=\"noreferrer\">here</a>, and a better example is <a href=\"https://blog.golang.org/generate\" rel=\"noreferrer\">here</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2312578"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5507, "favorite_count": 1, "accepted_answer_id": 37370412, "answer_count": 1, "score": 4, "last_activity_date": 1463889830, "creation_date": 1463828498, "question_id": 37362054, "link": "https://stackoverflow.com/questions/37362054/explain-go-generate-in-this-example", "title": "Explain go generate in this example", "body": "<p>I'm having difficulties understanding <code>go generate</code>. I also find barely any posts dealing with <code>go generate</code>.</p>\n\n<p>please explain <code>go generate</code> in this following example:</p>\n\n<pre><code>package main\n\nimport (\n        \"gopkg.in/mgo.v2\"\n        \"gopkg.in/mgo.v2/bson\"\n)\n\n// --- Address\n\ntype Address struct {\n        Id            bson.ObjectId `bson:\"_id,omitempty\"`\n        AccountId     string        `bson:\"account_id\"`\n        Name          string        `bson:\"name\"`\n        StreetAddress string        `bson:\"streetaddress\"`\n        Town          string        `bson:\"town\"`\n        Country       string        `bson:\"country\"`\n}\n\n// --- AddressHandler\n\ntype AddressHandler struct {\n        MS *mgo.Session\n}\n\nfunc NewAddressHandler(ms *mgo.Session) *AddressHandler {\n        return &amp;AddressHandler{MS: ms.Clone()}\n}\n\nfunc (h *AddressHandler) Close() {\n        h.MS.Close()\n}\n\n// Add\n\ntype AddAddressInput struct {\n        Address *Address\n}\n\ntype AddAddressOutput struct {\n        Error error\n}\n\nfunc (h *AddressHandler) AddAddress(in *AddAddressInput, out *AddAddressOutput) {\n        ms := h.MS.Copy()\n        defer ms.Close()\n        c := ms.DB(\"\").C(\"address\")\n        out.Error = c.Insert(in.Address)\n}\n\n// Remove\n\ntype RemoveAddressInput struct {\n        AddressId string\n}\n\ntype RemoveAddressOutput struct {\n        Error error\n}\n\nfunc (h *AddressHandler) RemoveAddress(in *RemoveAddressInput, out *RemoveAddressOutput) {\n        ms := h.MS.Copy()\n        defer ms.Close()\n        c := ms.DB(\"\").C(\"address\")\n        out.Error = c.RemoveId(bson.ObjectIdHex(in.AddressId))\n}\n\n// Update\n\ntype UpdateAddressInput struct {\n        Address *Address\n}\n\ntype UpdateAddressOutput struct {\n        Error error\n}\n\nfunc (h *AddressHandler) UpdateAddress(in *UpdateAddressInput, out *UpdateAddressOutput) {\n        ms := h.MS.Copy()\n        defer ms.Close()\n        c := ms.DB(\"\").C(\"address\")\n        out.Error = c.UpdateId(in.Address.AccountId)\n}\n\n// GetAllByAccount\n\ntype GetAddressInput struct {\n        AccountId string\n}\n\ntype GetAddressOutput struct {\n        Address []*Address\n        Error   error\n}\n\nfunc (h *AddressHandler) GetAddress(in *GetAddressInput, out *GetAddressOutput) {\n        ms := h.MS.Copy()\n        defer ms.Close()\n        c := ms.DB(\"\").C(\"address\")\n        out.Error = c.Find(bson.ObjectIdHex(in.AccountId)).All(&amp;out.Address)\n}\n</code></pre>\n\n<p>I would like to create almost carbon copies of this not yet template code.</p>\n\n<p>the \"template\" code:</p>\n\n<pre><code>package main\n\nimport (\n        \"gopkg.in/mgo.v2\"\n        \"gopkg.in/mgo.v2/bson\"\n)\n\n// --- Address\n\ntype %Model% struct {\n        Id            bson.ObjectId `bson:\"_id,omitempty\"`\n}\n\n// --- %Model%Handler\n\ntype %Model%Handler struct {\n        MS *mgo.Session\n}\n\nfunc New%Model%Handler(ms *mgo.Session) *%Model%Handler {\n        return &amp;%Model%Handler{MS: ms.Clone()}\n}\n\nfunc (h *%Model%Handler) Close() {\n        h.MS.Close()\n}\n\n// Add\n\ntype Add%Model%Input struct {\n        %Model% *%Model%\n}\n\ntype Add%Model%Output struct {\n        Error error\n}\n\nfunc (h *%Model%Handler) Add%Model%(in *Add%Model%Input, out *Add%Model%Output) {\n        ms := h.MS.Copy()\n        defer ms.Close()\n        c := ms.DB(\"\").C(\"%Model%\")\n        out.Error = c.Insert(in.%Model%)\n}\n\n// Remove %Model%\n\ntype Remove%Model%Input struct {\n        %Model%Id string\n}\n\ntype Remove%Model%Output struct {\n        Error error\n}\n\nfunc (h *%Model%Handler) Remove%Model%(in *Remove%Model%Input, out *Remove%Model%Output) {\n        ms := h.MS.Copy()\n        defer ms.Close()\n        c := ms.DB(\"\").C(\"%Model%\")\n        out.Error = c.RemoveId(bson.ObjectIdHex(in.%Model%Id))\n}\n\n// Update\n\ntype Update%Model%Input struct {\n        %Model% *%Model%\n}\n\ntype Update%Model%Output struct {\n        Error error\n}\n\nfunc (h *%Model%Handler) Update%Model%(in *Update%Model%Input, out *Update%Model%Output) {\n        ms := h.MS.Copy()\n        defer ms.Close()\n        c := ms.DB(\"\").C(\"%Model%\")\n        out.Error = c.UpdateId(in.%Model%.AccountId)\n}\n\n// GetAllByAccount\n\ntype Get%Model%Input struct {\n        AccountId string\n}\n\ntype Get%Model%Output struct {\n        %Model% []*%Model%\n        Error   error\n}\n\nfunc (h *%Model%Handler) Get%Model%(in *Get%Model%Input, out *Get%Model%Output) {\n        ms := h.MS.Copy()\n        defer ms.Close()\n        c := ms.DB(\"\").C(\"%Model%\")\n        out.Error = c.Find(bson.ObjectIdHex(in.AccountId)).All(&amp;out.%Model%)\n}\n</code></pre>\n\n<p>What do I need to add or change so I can <code>go generate</code> output from this supposed template. As you can see everything <code>Address</code> is replaced with <code>%Model%</code>. </p>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 3493, "user_id": 5798798, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/690198606a06d6fdbfbaf69200282532?s=128&d=identicon&r=PG&f=1", "display_name": "The Codesee", "link": "https://stackoverflow.com/users/5798798/the-codesee"}, "edited": false, "score": 2, "creation_date": 1463820950, "post_id": 37360541, "comment_id": 62235698, "body": "How do you know it&#39;s not working?"}, {"owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "reply_to_user": {"reputation": 3493, "user_id": 5798798, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/690198606a06d6fdbfbaf69200282532?s=128&d=identicon&r=PG&f=1", "display_name": "The Codesee", "link": "https://stackoverflow.com/users/5798798/the-codesee"}, "edited": false, "score": 0, "creation_date": 1463821378, "post_id": 37360541, "comment_id": 62235797, "body": "i tried to execute bt it give some err like this:**syntax error: unexpected ObjectId, expecting comma or }**"}], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 1, "last_activity_date": 1463825876, "last_edit_date": 1463825876, "creation_date": 1463824223, "answer_id": 37361334, "question_id": 37360541, "link": "https://stackoverflow.com/questions/37360541/how-to-write-insert-golang-code/37361334#37361334", "title": "How to write insert golang code?", "body": "<p>Your syntax is off, in several places. However the code is messy so I'll split it like that:</p>\n\n<pre><code>users := {USERID: new ObjectId(), FIRSTNAME: \"sam\",LASTNAME: \"billing\", AGE: 25}\nsales := {SALESID: new ObjectId(),FIRSTNAME: \"joe\", LASTNAME: \"root\", AGE: 23}\ninfo := &amp;userinfo{ID:new ObjectId(), NAME:\"Admin\", USER: users, SALES: sales, DATEADDED: time.Now()}\n</code></pre>\n\n<p>About the creation of sales and user, this is not the right way to create a slice and a struct. Instantiation of a struct of type T in Golang is <code>T{}</code>. You can create slices the same way. Therefore the <code>sales</code> and <code>users</code> become</p>\n\n<pre><code>users := []User{User{USERID: new ObjectId(), FIRSTNAME: \"sam\",LASTNAME: \"billing\", AGE: 25}}\nsales := []Sales{Sales{SALESID: new ObjectId(),FIRSTNAME: \"joe\", LASTNAME: \"root\", AGE: 23}}\n</code></pre>\n\n<p>Then, you should take a look at mgo's documentation. The way of creating an ObjectId is <code>bson.NewObjectId()</code>. Now, with all the modifications: </p>\n\n<pre><code>func main() {\n    users := []User{User{USERID: bson.NewObjectId(), FIRSTNAME: \"sam\", LASTNAME: \"billing\", AGE: 25}}\n    sales := []Sales{Sales{SALESID: bson.NewObjectId(), FIRSTNAME: \"joe\", LASTNAME: \"root\", AGE: 23}}\n    info := &amp;userinfo{ID: bson.NewObjectId(), NAME: \"Admin\", USER: users, SALES: sales, DATEADDED: time.Now()}\n    data, _ := json.MarshalIndent(info, \"\", \"    \")\n    fmt.Println(string(data))\n}\n\n/* Prints\n{\n    \"_id\": \"57402f27e13823740d742417\",\n    \"user\": [\n        {\n            \"userid\": \"57402f27e13823740d742415\",\n            \"firstName\": \"sam\",\n            \"lastName\": \"billing\",\n            \"age\": 25\n        }\n    ],\n    \"sales\": [\n        {\n            \"salesid\": \"57402f27e13823740d742416\",\n            \"firstName\": \"joe\",\n            \"lastName\": \"root\",\n            \"age\": 23\n        }\n    ],\n    \"dateAdded\": \"2016-05-21T11:49:27.507636096+02:00\",\n    \"name\": \"Admin\"\n}\n*/\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2312578"}, "is_accepted": true, "score": 2, "last_activity_date": 1463827759, "last_edit_date": 1463827759, "creation_date": 1463827306, "answer_id": 37361843, "question_id": 37360541, "link": "https://stackoverflow.com/questions/37360541/how-to-write-insert-golang-code/37361843#37361843", "title": "How to write insert golang code?", "body": "<p>There is so much wrong with this.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/gorilla/mux\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype Userinfo struct {\n    ID        bson.ObjectId `bson:\"_id,omitempty\" json:\"id\"`\n    USER      []string      `json:\"user\" bson:\"user\"`\n    SALES     []string      `json:\"sales\" bson:\"sales\"`\n    DATEADDED time.Time     `json:\"dateAdded\" bson:\"dateAdded\"`\n    NAME      string        `json:\"name\" bson:\"name\"`\n}\n\ntype User struct {\n    ID        bson.ObjectId `bson:\"_id,omitempty\" json:\"id\"`\n    FIRSTNAME string        `json:\"firstName\" bson:\"firstName\"`\n    LASTNAME  string        `json:\"lastName\" bson:\"lastName\"`\n    AGE       int           `json:\"age\" bson:\"age\"`\n}\n\ntype Sales struct {\n    ID        bson.ObjectId `bson:\"_id,omitempty\" json:\"id\"`\n    FIRSTNAME string        `json:\"firstName\" bson:\"firstName\"`\n    LASTNAME  string        `json:\"lastName\" bson:\"lastName\"`\n    AGE       int           `json:\"age\" bson:\"age\"`\n}\n\nvar session *mgo.Session\n\nfunc main() {\n    var err error\n    session, err = mgo.Dial(\"127.0.0.1\")\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true)\n\n    fmt.Fprintln(w, \"conn\")\n\n    router := mux.NewRouter().StrictSlash(true)\n    router.HandleFunc(\"/post/\", post)\n    router.HandleFunc(\"/getusers/\", getusers)\n    http.ListenAndServe(\":8080\", router)\n\n}\n\nfunc post(w http.ResponseWriter, r *http.Request) {\n\n    ms := session.Copy()\n    defer ms.Close()\n\n    cui := session.DB(\"userdb\").C(\"userinfo\")\n    cu := session.DB(\"userdb\").C(\"user\")\n    cs := session.DB(\"userdb\").C(\"sales\")\n\n    u := User{FIRSTNAME: \"sam\", LASTNAME: \"billing\", AGE: 25}\n    s := Sales{FIRSTNAME: \"joe\", LASTNAME: \"root\", AGE: 23}\n\n    if e := cu.Insert(u); e != nil {\n        log.Println(e.Error)\n        w.WriteHeader(500)\n        return\n    }\n    if e := cs.Insert(s); e != nil {\n        log.Println(e.Error)\n        w.WriteHeader(500)\n        return\n    }\n\n    ui := new(Userinfo)\n    ui.ID = bson.NewObjectId()\n    ui.NAME = \"admin\"\n    ui.USER = []string{u.Id.Hex()}\n    ui.SALES = []string{s.Id.Hex()}\n    ui.DATEADDED = time.Now()\n\n    if e := cui.Insert(ui); e != nil {\n        log.Println(e.Error)\n        w.WriteHeader(500)\n        return\n    }\n    w.WriteHeader(201)\n}\n\nfunc getusers(w http.ResponseWriter, r *http.Request) {\n    ms := session.Copy()\n    defer ms.Close()\n\n    cui := session.DB(\"userdb\").C(\"userinfo\")\n    cu := session.DB(\"userdb\").C(\"user\")\n    cs := session.DB(\"userdb\").C(\"sales\")\n\n    // Query for users of userinfo\n\n    uadm := new(Userinfo)\n\n    if e := cui.Find(bson.M{\"name\": \"admin\"}).One(uadm); e != nil {\n        log.Println(e.Error)\n    }\n\n    for _, userid := range uadm.USER {\n        tempu := new(User)\n        if e := cu.Find(bson.M{\"_id\": bson.ObjectIdHex(userid)}).One(tempu); e != nil {\n            log.Println(e.Error)\n            w.WriteHeader(500)\n            return\n        }\n        enc := json.NewEncoder(w)\n        if e := enc.Encode(tempu); e != nil {\n            log.Println(e.Error)\n            w.WriteHeader(500)\n            return\n        }\n    }\n\n}\n</code></pre>\n\n<ol>\n<li><p>The session</p></li>\n<li><p>Separate collections for all models</p></li>\n</ol>\n\n<p>I've changed the user and sales fields of Userinfo into []string because every independantly editable and queryable model should have its own collection. Instead of the whole object the id reference is saved so you can query for a user by ObjectId.</p>\n\n<ol start=\"3\">\n<li>Userinfo should be uppercase</li>\n</ol>\n"}], "owner": {"reputation": 308, "user_id": 6098460, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1182201388457702/picture?type=large", "display_name": "Chetan Kumar", "link": "https://stackoverflow.com/users/6098460/chetan-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 417, "favorite_count": 0, "accepted_answer_id": 37361843, "answer_count": 2, "score": -1, "last_activity_date": 1463827759, "creation_date": 1463818831, "question_id": 37360541, "link": "https://stackoverflow.com/questions/37360541/how-to-write-insert-golang-code", "title": "How to write insert golang code?", "body": "<blockquote>\n  <p>Here Is my json file and i want to insert the data using golang and\n  mgo in this json format</p>\n</blockquote>\n\n<pre><code>[{\n    \"_id\" : ObjectId(\"57307906f051147d5317984e\"),\n    \"dateAdded\" : \" 20015-11-10 23:00:00 +0000 UTC\"\n    \"firstName\" : \"chetan\",\n    \"lastName\" : \"kumar\",\n    \"age\" : 23,\n\n    \"user\" : [\n        {\n            \"userid\" : ObjectId(\"57307906f051147d5317984a\"),\n            \"firstName\" : \"chetan\",\n            \"lastName\" : \"kumar\",\n            \"age\" : 23\n        },\n        {\n            \"userid\" : ObjectId(\"57307906f051147d5317984b\"),\n            \"firstName\" : \"nepolean\",\n            \"lastName\" : \"dang\",\n            \"age\" : 26\n        },\n        {\n            \"userid\" : ObjectId(\"57307906f051147d5317984c\"),\n            \"firstName\" : \"Raj\",\n            \"lastname\" : \"kumar\",\n            \"age\" : 26\n        }\n    ],\n    \"sales\" : [\n        {\n            \"salesid\" : ObjectId(\"57307906f051147d5317984d\"),\n            \"firstName\" : \"ashu\",\n            \"lastName\" : \"jha\",\n            \"age\" : 27\n        }\n    ]\n}]\n</code></pre>\n\n<blockquote>\n  <p>Now ,here is my go file which i was trying to insert data through\n  golang and mgo</p>\n</blockquote>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"time\"\n    \"net/http\"\n    \"github.com/gorilla/mux\"\n        \"gopkg.in/mgo.v2\"\n        \"gopkg.in/mgo.v2/bson\"\n)\ntype userinfo struct{\n\n    ID          bson.ObjectId   `json:\"_id\" bson:\"_id\"`\n        USER        []User      `json:\"user\" bson:\"user\"`\n    SALES       []Sales     `json:\"sales\" bson:\"sales\"`\n    DATEADDED   time.Time   `json:\"dateAdded\" bson:\"dateAdded\"`\n    NAME        string      `json:\"name\" bson:\"name\"`\n\n} \ntype User struct{\n    USERID      bson.ObjectId   `json:\"userid\" bson:\"userid\"`\n    FIRSTNAME   string      `json:\"firstName\" bson:\"firstName\"`\n    LASTNAME    string      `json:\"lastName\" bson:\"lastName\"`\n    AGE     int     `json:\"age\" bson:\"age\"`\n\n}\ntype Sales struct{\n    SALESID     bson.ObjectId   `json:\"salesid\" bson:\"salesid\"`\n    FIRSTNAME   string      `json:\"firstName\" bson:\"firstName\"`\n    LASTNAME    string      `json:\"lastName\" bson:\"lastName\"`\n    AGE     int     `json:\"age\" bson:\"age\"`\n\n}\n\nfunc post(w http.ResponseWriter,r *http.Request){\n\n    session,err := mgo.Dial(\"127.0.0.1\")\n    if err != nil{\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic,true)\n    c:= session.DB(\"userdb\").C(\"user\")\n    fmt.Fprintln(w,\"conn\")\n\n\n\n\n    err = c.Insert(&amp;userinfo{ID:new ObjectId(),NAME:\"Admin\",USER:{USERID:new ObjectId(), FIRSTNAME: \"sam\",LASTNAME : \"billing\",AGE : 25},SALES:{SALESID:new ObjectId(),FIRSTNAME : \"joe\",LASTNAME : \"root\",AGE : 23},DATEADDED:time.Now()})\n\n    if err != nil {\n        panic(err)\n    }\n\n\n\n}\n\nfunc main(){\n    router := mux.NewRouter().StrictSlash(true)\n    router.HandleFunc(\"/post/\",post)\n    http.ListenAndServe(\":8080\",router)\n}\n</code></pre>\n\n<blockquote>\n  <p>but it's not work at all please help me out</p>\n</blockquote>\n"}, {"tags": ["string", "go", "formatting"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1463830971, "post_id": 37358545, "comment_id": 62238409, "body": "This is basically grouping decimals, using <code>|</code> as the separator symbol. Possible duplicate of <a href=\"http://stackoverflow.com/questions/13020308/how-to-fmt-printf-an-integer-with-thousands-comma\">How to fmt.Printf an integer with thousands comma</a>."}], "answers": [{"tags": [], "owner": {"reputation": 4222, "user_id": 2072269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/xNPjb.png?s=128&g=1", "display_name": "muru", "link": "https://stackoverflow.com/users/2072269/muru"}, "is_accepted": false, "score": 2, "last_activity_date": 1463804075, "last_edit_date": 1463804075, "creation_date": 1463803076, "answer_id": 37358731, "question_id": 37358545, "link": "https://stackoverflow.com/questions/37358545/is-there-a-better-way-to-insert-into-binary-string-rep-to-get-this-1000000/37358731#37358731", "title": "Is there a better way to insert &quot;|&#39; into binary string rep to get this 10|000|001", "body": "<p>Depends on what you call better. I'd use regular expressions.</p>\n\n<p>In this case, the complexity arises from inserting separators from the right. If we padded the string so that its length was a multiple of 3, we could insert the separator from the left. And we could easily use a regular expression to insert <code>|</code> before every three characters. Then, we can just strip off the leading <code>|</code> + padding.</p>\n\n<pre><code>func (i Binary) FString() string {\n    a := strconv.FormatUint(i.Get(), 2)\n    pad_req := len(a) % 3\n    padding := strings.Repeat(\"0\", (3 - pad_req))\n    a = padding + a\n    re := regexp.MustCompile(\"([01]{3})\")\n    a = re.ReplaceAllString(a, \"|$1\")\n    start := len(padding) + 1\n    if len(padding) == 3 {\n        // If we padded with \"000\", we want to remove the `|` before *and* after it\n        start = 5\n    }\n    a = a[start:]\n    return a\n}\n</code></pre>\n\n<ul>\n<li><a href=\"https://play.golang.org/p/X0AyIe-KKv\" rel=\"nofollow\">Snippet on the Go Playground</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "edited": false, "score": 0, "creation_date": 1463831768, "post_id": 37358912, "comment_id": 62238654, "body": "Thanks everybody.  I guess I was not that far off -- Your solutions are"}, {"owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "edited": false, "score": 0, "creation_date": 1463831796, "post_id": 37358912, "comment_id": 62238663, "body": "are better than mine in most cases  -- Thank You"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1472542568, "last_edit_date": 1495541807, "creation_date": 1463805225, "answer_id": 37358912, "question_id": 37358545, "link": "https://stackoverflow.com/questions/37358545/is-there-a-better-way-to-insert-into-binary-string-rep-to-get-this-1000000/37358912#37358912", "title": "Is there a better way to insert &quot;|&#39; into binary string rep to get this 10|000|001", "body": "<p>If performance is not critical and you just want a compact version, you may copy the input digits to output, and insert a <code>|</code> symbol whenever a group of 2 has been written to the output.</p>\n\n<p>Groups are counted from right-to-left, so when copying the digits from left-to-right, the first group might be smaller. So the counter of digits inside a group may not necessarily start from <code>0</code> in case of the first group, but from <code>len(input)%3</code>.</p>\n\n<p>Here is an example of it:</p>\n\n<pre><code>func Format(s string) string {\n    b, count := &amp;bytes.Buffer{}, len(s)%3\n    for i, r := range s {\n        if i &gt; 0 &amp;&amp; count == i%3 {\n            b.WriteRune('|')\n        }\n        b.WriteRune(r)\n    }\n    return b.String()\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>for i := uint64(0); i &lt; 10; i++ {\n    fmt.Println(Format(strconv.FormatUint(i, 2)))\n}\nfmt.Println(Format(strconv.FormatInt(1234, 2)))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/4Pe9QhuhJx\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0\n1\n10\n11\n100\n101\n110\n111\n1|000\n1|001\n10|011|010|010\n</code></pre>\n\n<p>If you have to do this many times and performance does matter, then check out my answer to the question: <a href=\"https://stackoverflow.com/a/31046325/1705598\">How to fmt.Printf an integer with thousands comma</a></p>\n\n<p>Based on that a fast solution can be:</p>\n\n<pre><code>func Format(s string) string {\n    out := make([]byte, len(s)+(len(s)-1)/3)\n    for i, j, k := len(s)-1, len(out)-1, 0; ; i, j = i-1, j-1 {\n        out[j] = s[i]\n        if i == 0 {\n            return string(out)\n        }\n        if k++; k == 3 {\n            j, k = j-1, 0\n            out[j] = '|'\n        }\n    }\n}\n</code></pre>\n\n<p>Output is the same of course. Try it on the <a href=\"https://play.golang.org/p/qNMQ4Dg1ak\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 0, "last_activity_date": 1463947174, "creation_date": 1463947174, "answer_id": 37379047, "question_id": 37358545, "link": "https://stackoverflow.com/questions/37358545/is-there-a-better-way-to-insert-into-binary-string-rep-to-get-this-1000000/37379047#37379047", "title": "Is there a better way to insert &quot;|&#39; into binary string rep to get this 10|000|001", "body": "<p>This is a partitioning problem. You can use this function:</p>\n\n<pre><code>func partition(s, separator string, pLen int) string {\n    if pLen &lt; 1 || len(s) == 0 || len(separator) == 0 {\n        return s\n    }\n\n    buffer := []rune(s)\n    L := len(buffer)\n    pCount := L / pLen\n\n    result := []string{}\n\n    index := 0\n    for ; index &lt; pCount; index++ {\n        _from := L - (index+1)*pLen\n        _to := L - index*pLen\n        result = append(result, string(buffer[_from:_to]))\n    }\n\n    if L%pLen != 0 {\n        result = append(result, string(buffer[0:L-index*pLen]))\n    }\n\n    for h, t := 0, len(result)-1; h &lt; t; h, t = h+1, t-1 {\n        result[t], result[h] = result[h], result[t]\n    }\n\n    return strings.Join(result, separator)\n}\n</code></pre>\n\n<p>And <code>s := partition(\"11001000\", \"|\", 3)</code> will give you <code>11|001|000</code>.</p>\n\n<p>Here is a little test:</p>\n\n<pre><code>func TestSmokeTest(t *testing.T) {\n    input := \"11001000\"\n    s := partition(input, \"|\", 3)\n    if s != \"11|001|000\" {\n        t.Fail()\n    }\n    s = partition(input, \"|\", 2)\n    if s != \"11|00|10|00\" {\n        t.Fail()\n    }\n\n    input = \"0111001000\"\n    s = partition(input, \"|\", 3)\n    if s != \"0|111|001|000\" {\n        t.Fail()\n    }\n    s = partition(input, \"|\", 2)\n    if s != \"01|11|00|10|00\" {\n        t.Fail()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1472542568, "creation_date": 1463801112, "last_edit_date": 1463806446, "question_id": 37358545, "link": "https://stackoverflow.com/questions/37358545/is-there-a-better-way-to-insert-into-binary-string-rep-to-get-this-1000000", "title": "Is there a better way to insert &quot;|&#39; into binary string rep to get this 10|000|001", "body": "<p>Is there a better way to insert <code>\"|\"</code> into a string\ngiven a binary string representation of decimal <code>200 = 11001000</code>\nthis function returns a string = <code>11|001|000</code></p>\n\n<p>While this function works, it seems very kludgy!!  Why is it so<br>\nhard in GO to do a simple character insertion???</p>\n\n<pre><code>func (i Binary) FString() string {\n    a := strconv.FormatUint(i.Get(), 2)\n    y := make([]string, len(a), len(a)*2)\n    data := []rune(a)\n    r := []rune{}\n    for i := len(data) - 1; i &gt;= 0; i-- {\n        r = append(r, data[i])\n    }\n    for j := len(a) - 1; j &gt;= 0; j-- {\n        y = append(y, string(r[j]))\n        if ((j)%3) == 0 &amp;&amp; j &gt; 0 {\n            y = append(y, \"|\")\n        }\n    }\n    return strings.Join(y, \"\")\n}\n</code></pre>\n"}, {"tags": ["go", "memory-address", "memory-access"], "comments": [{"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 0, "creation_date": 1463826272, "post_id": 37358478, "comment_id": 62237074, "body": "Do you want to read <i>your process</i> memory, I hope, and not <i>system</i> memory, right? Because the operating system usually disallows processes to read outside their memory space."}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 0, "creation_date": 1463826991, "post_id": 37358478, "comment_id": 62237320, "body": "Also, the quality of the answer may be OS-dependent. Is your question relative to any OS, and do you want to operate within go&#39;s limits, or are you available to consider OS-dependent solutions?"}, {"owner": {"reputation": 1117, "user_id": 1636883, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f18625a3fce041f061d2e426c94bd7bd?s=128&d=identicon&r=PG", "display_name": "kkirsche", "link": "https://stackoverflow.com/users/1636883/kkirsche"}, "reply_to_user": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 0, "creation_date": 1463838123, "post_id": 37358478, "comment_id": 62240569, "body": "@AkiRoss \u2014 this is a macintosh application reading another processes memory. I am open to Mac and Windows focused solutions though"}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 1, "creation_date": 1463845041, "post_id": 37358478, "comment_id": 62242820, "body": "Normally, a non-root process cannot read the memory of another process due to OS&#39; memory protection mechanisms (edit: and even root processes can&#39;t do it very easily). So, you probably need some external agent allowing you to read the other process&#39; memory, such as the <code>&#47;proc</code> pseudo-filesystem in Linux (<a href=\"http://unix.stackexchange.com/questions/6301/how-do-i-read-from-proc-pid-mem-under-linux\" title=\"how do i read from proc pid mem under linux\">unix.stackexchange.com/questions/6301/&hellip;</a>) - you may want to search for similar mechanisms under mac, but I am not aware of any."}, {"owner": {"reputation": 2804, "user_id": 2326753, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/tzfnK.png?s=128&g=1", "display_name": "C4d", "link": "https://stackoverflow.com/users/2326753/c4d"}, "edited": false, "score": 0, "creation_date": 1509735040, "post_id": 37358478, "comment_id": 81155378, "body": "<b>BOUNTY EDIT:</b> We are talking about Windows-OS!"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1509750968, "post_id": 37358478, "comment_id": 81161911, "body": "Have you tried <a href=\"https://golang.org/pkg/unsafe/#Pointer\" rel=\"nofollow noreferrer\">golang.org/pkg/unsafe/#Pointer</a> ?"}], "answers": [{"comments": [{"owner": {"reputation": 1117, "user_id": 1636883, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f18625a3fce041f061d2e426c94bd7bd?s=128&d=identicon&r=PG", "display_name": "kkirsche", "link": "https://stackoverflow.com/users/1636883/kkirsche"}, "edited": false, "score": 0, "creation_date": 1510011011, "post_id": 47141650, "comment_id": 81245418, "body": "Great answer and if helps! Thank you!"}, {"owner": {"reputation": 332, "user_id": 2939828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68689ece97e5ab445f59649f6b69696f?s=128&d=identicon&r=PG&f=1", "display_name": "spd", "link": "https://stackoverflow.com/users/2939828/spd"}, "reply_to_user": {"reputation": 1117, "user_id": 1636883, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f18625a3fce041f061d2e426c94bd7bd?s=128&d=identicon&r=PG", "display_name": "kkirsche", "link": "https://stackoverflow.com/users/1636883/kkirsche"}, "edited": false, "score": 0, "creation_date": 1510014224, "post_id": 47141650, "comment_id": 81246281, "body": "I am glad that it helped :)"}, {"owner": {"reputation": 5119, "user_id": 4276647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6a929f6537e73d7cc1ec7b533032350?s=128&d=identicon&r=PG&f=1", "display_name": "Kurtis Rader", "link": "https://stackoverflow.com/users/4276647/kurtis-rader"}, "reply_to_user": {"reputation": 1117, "user_id": 1636883, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f18625a3fce041f061d2e426c94bd7bd?s=128&d=identicon&r=PG", "display_name": "kkirsche", "link": "https://stackoverflow.com/users/1636883/kkirsche"}, "edited": false, "score": 1, "creation_date": 1588301142, "post_id": 47141650, "comment_id": 108852252, "body": "This does not do what the O.P. wanted. I have no idea why it was accepted as correct, let alone upvoted at least ten times. Someone recently asked the same question on the go-nuts mailing list and referred to this question. They didn&#39;t understand why this solution did not do what they wante. Which was the same thing that @kkirsche wanted. The answer is this solution doesn&#39;t do what either of those individuals want to do. You have to used specialized debugging APIs, such as <code>ptrace()</code>, to read the virtual memory of other processes."}], "tags": [], "owner": {"reputation": 332, "user_id": 2939828, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68689ece97e5ab445f59649f6b69696f?s=128&d=identicon&r=PG&f=1", "display_name": "spd", "link": "https://stackoverflow.com/users/2939828/spd"}, "is_accepted": true, "score": 8, "last_activity_date": 1509986151, "creation_date": 1509986151, "answer_id": 47141650, "question_id": 37358478, "link": "https://stackoverflow.com/questions/37358478/read-random-memory-locations-with-golang/47141650#47141650", "title": "Read Random Memory Locations with Golang", "body": "<p>I don't know how much useful this will be, but here is a sample code. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    var i int = 1\n    fmt.Println(\"Address : \", &amp;i, \" Value : \", i)\n\n    var address *int\n    address = &amp;i // getting the starting address\n\n    loc := (uintptr)(unsafe.Pointer(address))\n    p := unsafe.Pointer(loc)\n\n    // verification - it should print 1\n    var val int = *((* int)(p))\n    fmt.Println(\"Location : \", loc, \" Val :\",val) // it does print !!\n\n    // lets print 1000 bytes starting from address of variable i\n    // first memory location contains 1 as expected\n    printValueAtMemoryLocation(loc, 1000)\n\n    // now lets test for some arbitrary memory location\n    // not so random ! wanted to reduce the diff value also any arbitrary memory location you can't read !!\n    memoryToReach := 842350500000\n    loc = changeToInputLocation(loc, memoryToReach)\n    fmt.Println(\"Loc is now at : \", loc)\n    // lets print 1000 bytes starting from the memory location \"memoryToReach\"\n    printValueAtMemoryLocation(loc, 1000)\n\n}\n\nfunc changeToInputLocation(location uintptr, locationToreach int) uintptr {\n    var diff,i int\n    diff = locationToreach - int(location)\n\n    fmt.Println(\"We need to travel \", diff, \" memory locations !\")\n\n    if diff &lt; 0 {\n        i= diff * -1\n        for i &gt; 0 {\n            location--\n            i--\n        }\n    } else {\n        i= diff\n        for i &gt; 0 {\n            location++\n            i--\n        }\n    }\n    return location\n}\n\nfunc printValueAtMemoryLocation(location uintptr, next int) {\n    var v byte\n    p := unsafe.Pointer(location)\n    fmt.Println(\"\\n\")\n    for i:=1; i&lt;next; i++ {\n        p = unsafe.Pointer(location)\n        v = *((*byte)(p))\n        fmt.Print(v,\" \")\n        //fmt.Println(\"Loc : \", loc, \" --- Val : \", v)\n        location++\n    }\n    fmt.Println(\"\\n\")\n}\n</code></pre>\n\n<p>Using \"unsafe\" package is not a good idea, also you can not read any arbitrary location I believe.</p>\n\n<p>For me when I tried some other random locations where, most probably, I didn't have read access, it threw me error like this:</p>\n\n<pre><code>unexpected fault address 0xc41ff8f780\nfatal error: fault\n[signal SIGBUS: bus error code=0x2 addr=0xc41ff8f780 pc=0x1093ec0]\n</code></pre>\n\n<p>But hopefully, it can be of some value to you.</p>\n"}], "owner": {"reputation": 1117, "user_id": 1636883, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f18625a3fce041f061d2e426c94bd7bd?s=128&d=identicon&r=PG", "display_name": "kkirsche", "link": "https://stackoverflow.com/users/1636883/kkirsche"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3147, "favorite_count": 5, "accepted_answer_id": 47141650, "answer_count": 1, "score": 14, "last_activity_date": 1509986151, "creation_date": 1463800259, "question_id": 37358478, "link": "https://stackoverflow.com/questions/37358478/read-random-memory-locations-with-golang", "title": "Read Random Memory Locations with Golang", "body": "<p>Good evening,</p>\n\n<p>I've been trying to build a golang application which scans values in memory but am struggling trying to understand how to address specific memory locations. I know that when accessing memory within the application you can use <code>*variablename</code> to deference and get the address location, but how would I provide an address location and print the value to the screen or grab the next allocated object of any size from RAM and print it's value?</p>\n\n<p>Thanks in advance for any help you may be willing to share</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "edited": false, "score": 1, "creation_date": 1463784342, "post_id": 37356892, "comment_id": 62229038, "body": "See <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">the spec</a> on a full list of available expressions. What you want is not possible."}, {"owner": {"reputation": 99, "user_id": 4334759, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-MrTO3kjWT0I/AAAAAAAAAAI/AAAAAAAAABI/UjSj15--ht4/photo.jpg?sz=128", "display_name": "Maeve Kennedy", "link": "https://stackoverflow.com/users/4334759/maeve-kennedy"}, "reply_to_user": {"reputation": 47141, "user_id": 1643939, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Mww2p.png?s=128&g=1", "display_name": "nemo", "link": "https://stackoverflow.com/users/1643939/nemo"}, "edited": false, "score": 0, "creation_date": 1463784577, "post_id": 37356892, "comment_id": 62229096, "body": "@nemo that is helpful thank you!"}, {"owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "edited": false, "score": 0, "creation_date": 1463786701, "post_id": 37356892, "comment_id": 62229511, "body": "This is also a great <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">resource</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2129, "user_id": 1210278, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5120fc4e345db0d1a964888272073819?s=128&d=identicon&r=PG", "display_name": "Riking", "link": "https://stackoverflow.com/users/1210278/riking"}, "is_accepted": true, "score": 4, "last_activity_date": 1463784306, "creation_date": 1463784306, "answer_id": 37356911, "question_id": 37356892, "link": "https://stackoverflow.com/questions/37356892/go-programming-language-slice-from-end/37356911#37356911", "title": "Go programming language slice from end", "body": "<p>Nope, you have to use <code>len(a)</code>.</p>\n\n<pre><code>a[len(a)-1]\na[len(a)-2:]\na[:len(a)-2]\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 4334759, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-MrTO3kjWT0I/AAAAAAAAAAI/AAAAAAAAABI/UjSj15--ht4/photo.jpg?sz=128", "display_name": "Maeve Kennedy", "link": "https://stackoverflow.com/users/4334759/maeve-kennedy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 37356911, "answer_count": 1, "score": 0, "last_activity_date": 1463784306, "creation_date": 1463784182, "question_id": 37356892, "link": "https://stackoverflow.com/questions/37356892/go-programming-language-slice-from-end", "title": "Go programming language slice from end", "body": "<p>In python you can use the following syntax as a shortcut:</p>\n\n<pre><code>a[-1]    # last item in the array\na[-2:]   # last two items in the array\na[:-2]   # everything except the last two items\n</code></pre>\n\n<p>Does Go have shortcuts similar to the second and third example when creating new slices?</p>\n"}, {"tags": ["go", "ldap"], "comments": [{"owner": {"reputation": 704, "user_id": 3536948, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/50341f59bb4c3c845eb159056357aaf0?s=128&d=identicon&r=PG&f=1", "display_name": "poopoothegorilla", "link": "https://stackoverflow.com/users/3536948/poopoothegorilla"}, "edited": false, "score": 0, "creation_date": 1463776384, "post_id": 37355003, "comment_id": 62226161, "body": "could you provide the error messages?"}], "answers": [{"tags": [], "owner": {"reputation": 1749, "user_id": 3243380, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrCc3.jpg?s=128&g=1", "display_name": "nussjustin", "link": "https://stackoverflow.com/users/3243380/nussjustin"}, "is_accepted": true, "score": 4, "last_activity_date": 1463778410, "creation_date": 1463778410, "answer_id": 37355844, "question_id": 37355003, "link": "https://stackoverflow.com/questions/37355003/golang-utf16le-encoding-for-ldap-password-attribute/37355844#37355844", "title": "Golang utf16le encoding for ldap password attribute", "body": "<p>You can use the <a href=\"https://godoc.org/golang.org/x/text/encoding/unicode\" rel=\"nofollow\">golang.org/x/text/encoding/unicode</a> package to encode your string as UTF16.</p>\n\n<p>Using this package you can write something like this:</p>\n\n<pre><code>utf16 := unicode.UTF16(unicode.LittleEndian, unicode.IgnoreBOM)\n\nencoded, err := utf16.NewEncoder().String(\"encodedsecret\")\n\nmodify := ldap.NewModifyRequest(dn)\nmodify.Replace(\"unicodePwd\", []string{encoded})\n\n// do something with modify\n</code></pre>\n"}], "owner": {"reputation": 378, "user_id": 2209376, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/19f53942dacb5e9e8dbf6159c76a69a5?s=128&d=identicon&r=PG", "display_name": "steverippl", "link": "https://stackoverflow.com/users/2209376/steverippl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 995, "favorite_count": 0, "accepted_answer_id": 37355844, "answer_count": 1, "score": 1, "last_activity_date": 1537534430, "creation_date": 1463774732, "last_edit_date": 1463792068, "question_id": 37355003, "link": "https://stackoverflow.com/questions/37355003/golang-utf16le-encoding-for-ldap-password-attribute", "title": "Golang utf16le encoding for ldap password attribute", "body": "<p>I'm trying to reset a MS Active Directory password attribute using ldap in Go. AD won't play nicely with <code>ldap.PasswordModifyRequest</code> so I'm using <code>ldap.NewModifyRequest</code>. (Using gopkg.in/ldap.v2)</p>\n\n<p>AD will accept the password surrounded in quotes and utf16le encoded, in Python I can do this using </p>\n\n<pre><code>unicode_pass = unicode(\"\\\"secret\\\"\", \"iso-8859-1\")\npassword_value = unicode_pass.encode(\"utf-16-le\")\nmod_attrs = [(ldap.MOD_REPLACE, \"unicodePwd\", [password_value])]\nl.modify_s(user_dn, mod_attrs)\n</code></pre>\n\n<p>How can I do this in Go? Using <code>ldap.NewModifyRequest</code> and <code>Replace</code> I can change other attributes, but I need to pass <code>Request</code> <code>[]string</code> for the updated value, that needs to be my encoded password, and I'm running into type mismatches when I play around with <code>utf16.Encode</code>...</p>\n\n<pre><code>modify := ldap.NewModifyRequest(dn)\nmodify.Replace(\"unicodePwd\", []string{\"encodedsecret\"})\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "import", "packages"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463767674, "post_id": 37353068, "comment_id": 62221830, "body": "Yes, it&#39;s wrong to import via <code>.&#47;</code>. <i>never</i> use an import by relative path. Is your GOPATH set correctly? You shouldn&#39;t have any 3rd party packages in your GOROOT."}, {"owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463768080, "post_id": 37353068, "comment_id": 62222017, "body": "@JimB thank you for your helpful comment.  Yes, GOPATH is set correctly (points to my workspace) Is there information anywhere that documents what importing by a relative path does and why you wouldn&#39;t want to use it?    Are applications and packages just not stored in the same repository in go projects?  Or should I be using the full package name if my project has both a main package and what I (probably incorrectly) called sub packages"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1463768438, "post_id": 37353068, "comment_id": 62222161, "body": "<a href=\"https://golang.org/cmd/go/#hdr-Relative_import_paths\" rel=\"nofollow noreferrer\">Relative Import Paths</a>. The problem is that if you use a relative import path you can&#39;t build that package from within a workspace. All imports are relative to <code>$GOPATH&#47;src</code>, so just use the full import path even for &quot;sub packages&quot;."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 1, "creation_date": 1463783286, "post_id": 37353068, "comment_id": 62228738, "body": "A great way to start with go is to read this: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a> and then do this small tutorial: <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">tour.golang.org/welcome/1</a> Go is a small language and it&#39;s pretty well documented. Also read the articles in the go blog about slices and concurency. You can go from noob to expert in no time."}], "owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1463767253, "creation_date": 1463767253, "question_id": 37353068, "link": "https://stackoverflow.com/questions/37353068/go-sql-lite-package-not-loading-from-workspace", "title": "Go: SQL Lite Package not Loading from Workspace", "body": "<p>New Go programmer here -- apologies in advance for any misused terminology or convention breaking -- I'm still getting up to speed on the language.  I'm trying to use this <a href=\"https://github.com/mattn/go-sqlite3\" rel=\"nofollow\">sql lite</a> package in my go programs, and <em>sometimes</em> my program will fail with the following error</p>\n\n<pre><code># command-line-arguments\n/usr/local/go/pkg/tool/darwin_amd64/link: cannot open file        \n/usr/local/go/pkg/darwin_amd64/github.com/mattn/go-sqlite3.a: open   \n/usr/local/go/pkg/darwin_amd64/github.com/mattn/go-sqlite3.a: no such \nfile or directory\n</code></pre>\n\n<p>This happens when I try to run my program with <code>go run main.go</code>.  The <code>go-sqlite3.a</code> file exists in my workspace package, but go doesn't want to load it for for some reason.  This only seems to happen when I try importing the module from a \u2014 sub-package (? not sure if this is the right term).</p>\n\n<p>If I do the following in a single <code>main.go</code> file</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n  _ \"github.com/mattn/go-sqlite3\"    \n)\n\nfunc main(){\n    fmt.Println(\"Hello World from main()\")\n}\n</code></pre>\n\n<p>everything works fine.  However, if I add a package to my program so the file structure is laid out like this</p>\n\n<pre><code>main.go\ntest/test.go\n</code></pre>\n\n<p>and I include my package (in <code>main.go</code>) like this</p>\n\n<pre><code>import(\n    \"fmt\"\n    \"./test\"    \n)\n\nfunc main(){\n    test.Test()\n}\n</code></pre>\n\n<p>and my package (<code>test/test.go</code>) looks like this</p>\n\n<pre><code>package test\n\nimport(\n    \"fmt\"\n    _ \"github.com/mattn/go-sqlite3\"    \n)\n\nfunc Test(){\n    fmt.Println(\"Hello World from Test() in test/test.go\")\n}\n</code></pre>\n\n<p>then <code>go run main.go</code> fails with the above error message.  </p>\n\n<p>Does anyone know what's going on here?  Is it wrong to use a <code>./</code> in my import?  I've tried reading up on this online, but I've had trouble finding something that addresses the behavior I'm seeing and the reasons for it. </p>\n"}, {"tags": ["go", "memory-leaks"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463768836, "post_id": 37352764, "comment_id": 62222356, "body": "Sys-HeapReleased should roughly correlate with RSS, but there&#39;s no guarantee that what the program says it&#39;s using matches what the OS provides."}, {"owner": {"reputation": 11, "user_id": 6362180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2fbb878d45ac299b5d0c645f2e106ce?s=128&d=identicon&r=PG&f=1", "display_name": "HusbandFatherCoder", "link": "https://stackoverflow.com/users/6362180/husbandfathercoder"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463769628, "post_id": 37352764, "comment_id": 62222803, "body": "@JimB Thank you. I didn&#39;t list the HeapReleased stat here, but it was zero. I think it&#39;s fair to say that 30GB RSS doesn&#39;t &quot;roughly correlate&quot; with 3.5GB reported by Sys, giving credence to the memory leak hypothesis.   One further avenue I could investigate is what happens to HeapReleased as we approach 100% memory usage in RSS. It actually seems to top out at 85% so likely that&#39;s where the OS starts swapping, explaining some of the performance degradation. If it starts releasing heap at that point, then it would indicate Go&#39;s GC is somehow aware of the problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463769852, "post_id": 37352764, "comment_id": 62222917, "body": "What version of Go are you using? I think stacks used to get missed in some stats, and also couldn&#39;t be released. Get a stack trace and see what goroutines you have running, as you&#39;re likely leaking some from each request."}, {"owner": {"reputation": 11, "user_id": 6362180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2fbb878d45ac299b5d0c645f2e106ce?s=128&d=identicon&r=PG&f=1", "display_name": "HusbandFatherCoder", "link": "https://stackoverflow.com/users/6362180/husbandfathercoder"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463770110, "post_id": 37352764, "comment_id": 62223065, "body": "@JimB Using Go 1.6. I&#39;ve kept a fairly close eye on the profiles and nothing is out of the ordinary. We average about 35k goroutines with about 3-5k of them blocked at any given moment. Most of them blocked in IO wait as the http request comes in. That doesn&#39;t change as these stats get worse. When our response times degrade we start pruning requests (the nature of our application allows us to ignore some requests if necessary) which keeps that number fairly static."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463771023, "post_id": 37352764, "comment_id": 62223568, "body": "Sounds like the memory is allocated via cgo then."}, {"owner": {"reputation": 11, "user_id": 6362180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2fbb878d45ac299b5d0c645f2e106ce?s=128&d=identicon&r=PG&f=1", "display_name": "HusbandFatherCoder", "link": "https://stackoverflow.com/users/6362180/husbandfathercoder"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463887421, "post_id": 37352764, "comment_id": 62252634, "body": "@JimB I eliminated cgo from the equation today--didn&#39;t help. So strange!"}], "owner": {"reputation": 11, "user_id": 6362180, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d2fbb878d45ac299b5d0c645f2e106ce?s=128&d=identicon&r=PG&f=1", "display_name": "HusbandFatherCoder", "link": "https://stackoverflow.com/users/6362180/husbandfathercoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 353, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1463767572, "creation_date": 1463766084, "last_edit_date": 1463767572, "question_id": 37352764, "link": "https://stackoverflow.com/questions/37352764/should-the-stats-reported-by-gos-runtime-readmemstats-approximately-equal-the-r", "title": "Should the stats reported by Go&#39;s runtime.ReadMemStats approximately equal the resident memory set reported by ps aux?", "body": "<p>In Go Should the \"Sys\" stat or any other stat/combination reported by <a href=\"https://golang.org/pkg/runtime/#ReadMemStats\" rel=\"nofollow\"><code>runtime.ReadMemStats</code></a> approximately equal the resident memory set reported by <code>ps aux</code>?</p>\n\n<p>Alternatively, assuming some memory may be swapped out, should the Sys stat be approximately greater than or equal to the RSS?</p>\n\n<p>We have a long-running web service that deals with a high frequency of requests and we are finding that the RSS quickly climbs up to consume virtually all of the 64GB memory on our servers. When it hits ~85% we begin to experience considerable degradation in our response times and in how many concurrent requests we can handle. The run I've listed below is after about 20 hours of execution, and is already at 51% memory usage.</p>\n\n<p>I'm trying to determine if the likely cause is a memory leak (we make some calls to CGO). The data seems to indicate that it is, but before I go down that rabbit hole I want to rule out a fundamental misunderstanding of the statistics I'm using to make that call. </p>\n\n<p>This is an <code>amd64</code> build targeting <code>linux</code> and executing on <code>CentOS</code>.</p>\n\n<p>Reported by <code>runtime.ReadMemStats</code>:</p>\n\n<pre><code>Alloc:     1294777080 bytes (1234.80MB)  // bytes allocated and not yet freed\nSys:       3686471104 bytes (3515.69MB)  // bytes obtained from system (sum of XxxSys below)\nHeapAlloc: 1294777080 bytes (1234.80MB)  // bytes allocated and not yet freed (same as Alloc above)\nHeapSys:   3104931840 bytes (2961.09MB)  // bytes obtained from system\nHeapIdle:  1672339456 bytes (1594.87MB)  // bytes in idle spans\nHeapInuse: 1432592384 bytes (1366.23MB)  // bytes in non-idle span\n</code></pre>\n\n<p>Reported by <code>ps aux</code>:</p>\n\n<pre><code>%CPU %MEM       VSZ      RSS \n1362 51.3 306936436 33742120\n</code></pre>\n"}, {"tags": ["go", "cloud-foundry"], "answers": [{"tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": false, "score": 0, "last_activity_date": 1463765939, "creation_date": 1463765939, "answer_id": 37352721, "question_id": 37352282, "link": "https://stackoverflow.com/questions/37352282/go-vcap-services-variables/37352721#37352721", "title": "GO &amp; VCAP_SERVICES Variables", "body": "<p>I googled \"VCAP_SERVICES\" and the first result was documentation on the Internet:</p>\n\n<p><a href=\"http://docs.run.pivotal.io/devguide/deploy-apps/environment-variable.html#VCAP-SERVICES\" rel=\"nofollow\">http://docs.run.pivotal.io/devguide/deploy-apps/environment-variable.html#VCAP-SERVICES</a></p>\n\n<p>It comes in as a JSON document, so you'll have to unmarshall the JSON and find the right data you're looking for.  It's possible that some Java tools exist that let you magically reference things via <code>\"\"vcap.services.postgres.credentials.jdbcUri\"</code> but in general you have to parse the JSON and access it like a normal JSON object to get what you're looking for.</p>\n"}, {"tags": [], "owner": {"reputation": 685, "user_id": 1057222, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/8c7c7a7f7e6f8e6aab03d51790369a03?s=128&d=identicon&r=PG", "display_name": "auhuman", "link": "https://stackoverflow.com/users/1057222/auhuman"}, "is_accepted": false, "score": 0, "last_activity_date": 1463767819, "creation_date": 1463767819, "answer_id": 37353225, "question_id": 37352282, "link": "https://stackoverflow.com/questions/37352282/go-vcap-services-variables/37353225#37353225", "title": "GO &amp; VCAP_SERVICES Variables", "body": "<p>I didnt something like below in my GO App to access the VCAP variables</p>\n\n<pre><code>json.Unmarshal([]byte(os.Getenv(\"VCAP_SERVICES\")), &amp;vcapServices)\n\n    postgresCredentials := vcapServices[\"postgres\"].([]interface{})[0].(map[string]interface{})[\"credentials\"].(map[string]interface{})\n    jdbcUri := postgresCredentials[\"jdbc_uri\"].(string)\n</code></pre>\n"}], "owner": {"reputation": 685, "user_id": 1057222, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/8c7c7a7f7e6f8e6aab03d51790369a03?s=128&d=identicon&r=PG", "display_name": "auhuman", "link": "https://stackoverflow.com/users/1057222/auhuman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 586, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1463767819, "creation_date": 1463764392, "question_id": 37352282, "link": "https://stackoverflow.com/questions/37352282/go-vcap-services-variables", "title": "GO &amp; VCAP_SERVICES Variables", "body": "<p>I developed a GO application for Cloud Foundry. I am trying to access/get VCAP_SERVICE variables in my GO application. No proper documentation on internet for this. In my code i am trying to access it the Java way, but returns me empty string.  <code>JDBC_URI = os.Getenv(\"vcap.services.postgres.credentials.jdbcUri\")</code></p>\n"}, {"tags": ["dictionary", "go", "assertion"], "comments": [{"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 2, "creation_date": 1463763740, "post_id": 37352080, "comment_id": 62219751, "body": "Can you paste the whole related code ? How is flash created and what is it ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1463763917, "post_id": 37352080, "comment_id": 62219860, "body": "Change the first print to <code>fmt.Printf(&quot;%T\\n&quot;, flash)</code>. This will print the type of <code>flash</code> and should guide you to the correct type to use in the type assertion.  Report back with the results if you need more help.  ... or show us the related code as asked in previous comment."}, {"owner": {"reputation": 1468, "user_id": 134617, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/30a007e4001c83a7befa2b231e08c03c?s=128&d=identicon&r=PG", "display_name": "Joseph Montanez", "link": "https://stackoverflow.com/users/134617/joseph-montanez"}, "reply_to_user": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1463765148, "post_id": 37352080, "comment_id": 62220520, "body": "@T.Claverie I&#39;ve added more code, flash is gin.H"}, {"owner": {"reputation": 1468, "user_id": 134617, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/30a007e4001c83a7befa2b231e08c03c?s=128&d=identicon&r=PG", "display_name": "Joseph Montanez", "link": "https://stackoverflow.com/users/134617/joseph-montanez"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1463765177, "post_id": 37352080, "comment_id": 62220539, "body": "@KarrotKake I&#39;ve added the type its *gin.H"}, {"owner": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "edited": false, "score": 4, "creation_date": 1463765302, "post_id": 37352080, "comment_id": 62220603, "body": "You&#39;re putting the <code>*</code> at the wrong place. It should be <code>flash.(*gin.H)</code>."}, {"owner": {"reputation": 1468, "user_id": 134617, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/30a007e4001c83a7befa2b231e08c03c?s=128&d=identicon&r=PG", "display_name": "Joseph Montanez", "link": "https://stackoverflow.com/users/134617/joseph-montanez"}, "reply_to_user": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "edited": false, "score": 0, "creation_date": 1463766555, "post_id": 37352080, "comment_id": 62221255, "body": "@JohnSmith thanks if you want to put that as an answer I can accept it. I had tried it but then I got &quot;cannot use post_data (type *gin.H) as type gin.H in assignment&quot; but that was resolved by dereferencing it"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1463766826, "post_id": 37352080, "comment_id": 62221415, "body": "Declare <code>data</code> as type *gin.H. It will be easier for us to help you find the problem if you show more code (the declaration of data for example)."}, {"owner": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "edited": false, "score": 0, "creation_date": 1463768598, "post_id": 37352080, "comment_id": 62222250, "body": "@Gorilla3D I&#39;ve posted it."}], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 0, "last_activity_date": 1463767092, "creation_date": 1463767092, "answer_id": 37353033, "question_id": 37352080, "link": "https://stackoverflow.com/questions/37352080/type-assertion-falling-on-reference-pointer/37353033#37353033", "title": "Type assertion falling on reference / pointer", "body": "<p>Type assertions require the type you want to assert to be of the exact same type of the assertion part.</p>\n\n<p>From your code, <code>flash</code> is a type <code>interface{}</code>, and the underlying type is <code>*gin.H</code> (printed by <code>fmt.Printf(\"%T\", flash)</code>). Therefore the assertion should be <code>flash.(*gin.H)</code></p>\n\n<p>Here are a few examples about of to use type assertions:</p>\n\n<pre><code>package main\n\nimport r \"reflect\"\n\ntype A struct {\n    Name string\n}\n\nfunc main() {\n    // No pointer\n    aa := A{\"name\"}\n    var ii interface{} = aa\n\n    bb := ii.(A)\n    // main.A\n\n    // Pointer\n    a := &amp;A{\"name\"}\n    var i interface{} = a\n\n    b := *i.(*A)\n    // main.A\n\n    c := i.(*A)\n    // *main.A\n\n    d := r.Indirect(r.ValueOf(i)).Interface().(A)\n    // main.A\n}\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2243, "user_id": 1994803, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/wuOhb.png?s=128&g=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/1994803/john-smith"}, "is_accepted": true, "score": 2, "last_activity_date": 1463768582, "creation_date": 1463768582, "answer_id": 37353431, "question_id": 37352080, "link": "https://stackoverflow.com/questions/37352080/type-assertion-falling-on-reference-pointer/37353431#37353431", "title": "Type assertion falling on reference / pointer", "body": "<p>You're putting the <code>*</code> at the wrong place. It should be <code>flash.(*gin.H)</code>. </p>\n"}], "owner": {"reputation": 1468, "user_id": 134617, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/30a007e4001c83a7befa2b231e08c03c?s=128&d=identicon&r=PG", "display_name": "Joseph Montanez", "link": "https://stackoverflow.com/users/134617/joseph-montanez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 162, "favorite_count": 0, "accepted_answer_id": 37353431, "answer_count": 2, "score": 1, "last_activity_date": 1463768582, "creation_date": 1463763596, "last_edit_date": 1463765111, "question_id": 37352080, "link": "https://stackoverflow.com/questions/37352080/type-assertion-falling-on-reference-pointer", "title": "Type assertion falling on reference / pointer", "body": "<p>I am trying to get a map out of the reference and the assertion seems to be failing:</p>\n\n<pre><code>session.AddFlash(gin.H{\n    \"username\": username,\n    \"password\": password,\n}, \"_post\")\n</code></pre>\n\n<p>...</p>\n\n<pre><code>flashes := session.Flashes(\"_post\")\nif flashes != nil {\n    flash = flashes[0]\n    fmt.Printf(\"%T\\n\", flash)\n    if post_data, ok := flash.(gin.H); ok {\n        fmt.Println(\"post_data:\", post_data)\n        data = post_data\n    } else {\n        fmt.Println(\"post_data(failed):\", post_data)\n    }\n}\n</code></pre>\n\n<p>However I always get the following output, which the assert fails:</p>\n\n<pre><code>*gin.H\npost_data(failed): map[]\n</code></pre>\n\n<p>I assume its due to the assertion I am doing so I've tried:</p>\n\n<pre><code>if post_data, ok := (*flash).(gin.H); ok {\n</code></pre>\n\n<p>But then I get <code>invalid indirect of flash (type interface {})</code></p>\n\n<p>I have also tried:</p>\n\n<pre><code>if post_data, ok := *flash.(gin.H); ok {\n</code></pre>\n\n<p>But that gives me <code>invalid indirect of flash.(gin.H) (type gin.H)</code></p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463771480, "post_id": 37352030, "comment_id": 62223793, "body": "<code>consumer</code> shouldn&#39;t be closed in this situation. Why do you consider receiving a message, processing it, then sending the response a &quot;race&quot; here?"}, {"owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1463774433, "post_id": 37352030, "comment_id": 62225203, "body": "if I read a message from the producer and consumer is incapable to handle it, I cannot return it back to the producer to be handled from another consumer. Since this is not an atomic operation - it is in race with any other thread that could put the consumer in a state that prevents it to handle the message (in privite closing it)"}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "edited": false, "score": 1, "creation_date": 1463827123, "post_id": 37352030, "comment_id": 62237352, "body": "What do you mean by &quot;tunnel&quot; between two channels?"}], "owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1463763395, "creation_date": 1463763395, "question_id": 37352030, "link": "https://stackoverflow.com/questions/37352030/implement-tunnel-between-two-golang-channels", "title": "implement tunnel between two golang channels", "body": "<p>I am trying to implement a tunnel between two go channels (note I am very new to go). My goroutine looks like this:</p>\n\n<pre><code>consumer := ...\nproducer := ...\ngo func() {\n    for jsn := range producer {\n        msg, err := ops.FromJSON(jsn)\n        if err != nil {\n            log.Print(err)\n            continue\n        }\n        consumer &lt;- msg\n    }\n}()\n</code></pre>\n\n<p>This though seems to have some issues. How can I check if the consumer is already closed? How to solve the race between getting the message from the producer and sending it to the consumer? ... and maybe others.</p>\n\n<p>Can someone provide a good example of a tunnel between two channels?</p>\n"}, {"tags": ["go", "vendor", "glide-golang"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 4519572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ctlk.jpg?s=128&g=1", "display_name": "BruceAuyeung", "link": "https://stackoverflow.com/users/4519572/bruceauyeung"}, "edited": false, "score": 1, "creation_date": 1463827038, "post_id": 37351667, "comment_id": 62237330, "body": "although your reply is not the direct answer of my question, you clarify what <code>outside pakcages</code> which confuse me means. thanks! <a href=\"https://github.com/mattfarina/golang-broken-vendor\" rel=\"nofollow noreferrer\">github.com/mattfarina/golang-broken-vendor</a> makes me understand why a library should not place third-party packages into <code>vendor&#47;</code> directory."}, {"owner": {"reputation": 63, "user_id": 4519572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ctlk.jpg?s=128&g=1", "display_name": "BruceAuyeung", "link": "https://stackoverflow.com/users/4519572/bruceauyeung"}, "edited": false, "score": 1, "creation_date": 1463827554, "post_id": 37351667, "comment_id": 62237475, "body": "how does vendor package manager such as <code>glide</code> manage third-party packages when we put them into library&#39;s codebase directory structure while developing a library?"}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "reply_to_user": {"reputation": 63, "user_id": 4519572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ctlk.jpg?s=128&g=1", "display_name": "BruceAuyeung", "link": "https://stackoverflow.com/users/4519572/bruceauyeung"}, "edited": false, "score": 0, "creation_date": 1463854942, "post_id": 37351667, "comment_id": 62245891, "body": "@BruceAuyeung I have only used <code>godep</code>, with which: You run <code>go get foo&#47;package1 bar&#47;package2...</code> to install packages into your gopath, then run <code>godep restore &amp;&amp; godep save .&#47;...</code> to copy the packages from gopath to <code>&lt;project&gt;&#47;vendor&#47;</code>. I expect that with glide, you similarly do not have to put anything in the vendor folder manually."}, {"owner": {"reputation": 63, "user_id": 4519572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ctlk.jpg?s=128&g=1", "display_name": "BruceAuyeung", "link": "https://stackoverflow.com/users/4519572/bruceauyeung"}, "edited": false, "score": 0, "creation_date": 1464311909, "post_id": 37351667, "comment_id": 62445180, "body": "but the recommendation said do not put 3rd party libs into vendor, right ?"}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "reply_to_user": {"reputation": 63, "user_id": 4519572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ctlk.jpg?s=128&g=1", "display_name": "BruceAuyeung", "link": "https://stackoverflow.com/users/4519572/bruceauyeung"}, "edited": false, "score": 0, "creation_date": 1464315129, "post_id": 37351667, "comment_id": 62445916, "body": "I only have experience with programs that have a main.go so I don&#39;t know why that recommendation was made. If your code needs the dependency, and you don&#39;t vendor that dependency, I expect users must manually <code>go get dependency&#47;...</code>"}], "tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": false, "score": 1, "last_activity_date": 1463762151, "creation_date": 1463762151, "answer_id": 37351667, "question_id": 37351481, "link": "https://stackoverflow.com/questions/37351481/should-we-always-place-our-own-packages-in-vendor-folder-when-developing-a-gola/37351667#37351667", "title": "should we always place our own packages in vendor/ folder when developing a golang library?", "body": "<p>\"outside packages\" means packages that live outside this repo. So, if the packages are in separate repos from the code that imports them: Yes, vendor them.</p>\n\n<p>If you just want to write and use multiple packages while implementing your library: No, put them in subfolders outside vendor/ in the library repo</p>\n\n<p>For example</p>\n\n<p><code>...\n\u25b8 server/\n    server.go \"package server\"\n\u25b8 store/\n\u25b8 testutils/\n\u25be vendor/\n  \u25b8 bitbucket.org/\n  \u25b8 github.com/\n...\n</code></p>\n"}, {"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 1, "last_activity_date": 1463762272, "creation_date": 1463762272, "answer_id": 37351713, "question_id": 37351481, "link": "https://stackoverflow.com/questions/37351481/should-we-always-place-our-own-packages-in-vendor-folder-when-developing-a-gola/37351713#37351713", "title": "should we always place our own packages in vendor/ folder when developing a golang library?", "body": "<p>No, it makes no sense to add your own packages inside a vendor/ directory, because the vendor directory is meant for code external to your project.</p>\n\n<p>What this recommendation means is: If you are developing a library, do not use vendor/ to store third-party libraries unless you know what you're doing and why you're doing it.</p>\n"}], "owner": {"reputation": 63, "user_id": 4519572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5ctlk.jpg?s=128&g=1", "display_name": "BruceAuyeung", "link": "https://stackoverflow.com/users/4519572/bruceauyeung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1390, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1553439140, "creation_date": 1463761546, "last_edit_date": 1553439140, "question_id": 37351481, "link": "https://stackoverflow.com/questions/37351481/should-we-always-place-our-own-packages-in-vendor-folder-when-developing-a-gola", "title": "should we always place our own packages in vendor/ folder when developing a golang library?", "body": "<p>recently i read a article <a href=\"http://glide.readthedocs.io/en/latest/vendor/\" rel=\"nofollow\">http://glide.readthedocs.io/en/latest/vendor/</a>, there are some recommendations, one of them is :</p>\n\n<blockquote>\n  <p>Libraries (codebases without a <code>main</code> package) should not store outside packages in a <code>vendor/</code> folder in their VCS unless they have a specific reason and understand why they're doing it.</p>\n</blockquote>\n\n<p>my question is :</p>\n\n<p>according to this recommendation, should we always place our own packages(not those third party packages) in <code>vendor/</code> folder when developing a golang library ?</p>\n"}]