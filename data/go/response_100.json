[{"tags": ["angular", "go", "oauth", "oauth-2.0", "authorization"], "comments": [{"owner": {"reputation": 98400, "user_id": 3001761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feZwC.jpg?s=128&g=1", "display_name": "jonrsharpe", "link": "https://stackoverflow.com/users/3001761/jonrsharpe"}, "edited": false, "score": 0, "creation_date": 1481152961, "post_id": 41029065, "comment_id": 69265836, "body": "You need a route Facebook can call back to that handles the URL parameters appropriately. I recently implemented this for OAuth via GitHub: <a href=\"https://github.com/textbook/prioritise-me/blob/d38a371784270146ad5f148bbb0573a2bce53def/web/src/app/auth/github/github.component.ts#L22\" rel=\"nofollow noreferrer\">github.com/textbook/prioritise-me/blob/&hellip;</a>. For OAuth to work you send the user away to the provider, then the provider needs to know where to send them back to."}, {"owner": {"reputation": 98400, "user_id": 3001761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feZwC.jpg?s=128&g=1", "display_name": "jonrsharpe", "link": "https://stackoverflow.com/users/3001761/jonrsharpe"}, "edited": false, "score": 1, "creation_date": 1481153854, "post_id": 41029065, "comment_id": 69266176, "body": "Facebook has a guide to implementing OAuth with examples: <a href=\"https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow/\" rel=\"nofollow noreferrer\">developers.facebook.com/docs/facebook-login/&hellip;</a>. You need to have a page at the <code>redirect_uri</code> that can handle the returned information."}, {"owner": {"reputation": 625, "user_id": 4174678, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh3.googleusercontent.com/-4-R8SvnftWw/AAAAAAAAAAI/AAAAAAAAAAA/rABVJRgbn1M/photo.jpg?sz=128", "display_name": "Andrey K.", "link": "https://stackoverflow.com/users/4174678/andrey-k"}, "reply_to_user": {"reputation": 98400, "user_id": 3001761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/feZwC.jpg?s=128&g=1", "display_name": "jonrsharpe", "link": "https://stackoverflow.com/users/3001761/jonrsharpe"}, "edited": false, "score": 0, "creation_date": 1481161008, "post_id": 41029065, "comment_id": 69268294, "body": "Thanks! One problem is... how can I use # in redirect_uri? or it is not possible?"}, {"owner": {"reputation": 485, "user_id": 8949598, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b7acf785755ddc97f828fcceebd1588a?s=128&d=identicon&r=PG&f=1", "display_name": "pelcomppl", "link": "https://stackoverflow.com/users/8949598/pelcomppl"}, "edited": false, "score": 0, "creation_date": 1542377420, "post_id": 41029065, "comment_id": 93557834, "body": "@AndreyK. Could you paste a sample code how to get <code>authorization_code</code> from Facebook in Angular?"}], "owner": {"reputation": 625, "user_id": 4174678, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh3.googleusercontent.com/-4-R8SvnftWw/AAAAAAAAAAI/AAAAAAAAAAA/rABVJRgbn1M/photo.jpg?sz=128", "display_name": "Andrey K.", "link": "https://stackoverflow.com/users/4174678/andrey-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1107, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1481153148, "creation_date": 1481152357, "last_edit_date": 1481153148, "question_id": 41029065, "link": "https://stackoverflow.com/questions/41029065/login-to-facebook-for-angular-2-app", "title": "Login to Facebook for Angular 2 app", "body": "<p>How can I organize login with Facebook in my Angular 2 app (with creation of a user account and authorization on my backend server)?</p>\n\n<p>At this moment I can get <code>authorization_code</code> from Facebook and then get <code>access_token</code> with my backend app.</p>\n\n<p>Now I try to create an Angular 2 app with a login page and an <code>AuthService</code> that sends a request to Facebook and handles the redirected answer with <code>authorization_code</code> and then sends this code to my backend server in order to receive <code>access_token</code>, create a new user if necessary and return a JWT to my Angular 2 app.</p>\n\n<p>How can I handle Facebook's response (callback) with <code>authorization_code</code> in my Angular 2 app in order to send it to my backend (in order to receive JWT)?</p>\n"}, {"tags": ["linux", "http", "go", "tcp", "localhost"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481150746, "post_id": 41028709, "comment_id": 69264938, "body": "The cleanest path to literally do what you&#39;re asking is to use the host firewall. Go doesn&#39;t see the TCP SYN packet, that&#39;s handled by the operating system,"}, {"owner": {"reputation": 6626, "user_id": 886749, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d8206b3ff36c7985108359f97562a9a4?s=128&d=identicon&r=PG", "display_name": "Cory Kendall", "link": "https://stackoverflow.com/users/886749/cory-kendall"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481150839, "post_id": 41028709, "comment_id": 69264976, "body": "@JimB So could I (from Go running on Linux) shell out and create an IPTable rule or something before I bind and listen on my port?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 12, "creation_date": 1481150884, "post_id": 41028709, "comment_id": 69264991, "body": "Why not <code>http.ListenAndServe(&quot;localhost:80&quot;, nil)</code>? That would bind the service to localhost only."}, {"owner": {"reputation": 6626, "user_id": 886749, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d8206b3ff36c7985108359f97562a9a4?s=128&d=identicon&r=PG", "display_name": "Cory Kendall", "link": "https://stackoverflow.com/users/886749/cory-kendall"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1481157530, "post_id": 41028709, "comment_id": 69267351, "body": "@VonC If that is the answer, then I would accept it."}], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 13, "last_activity_date": 1481183677, "last_edit_date": 1495542313, "creation_date": 1481183677, "answer_id": 41034423, "question_id": 41028709, "link": "https://stackoverflow.com/questions/41028709/only-accept-http-connections-from-localhost-in-go/41034423#41034423", "title": "Only accept HTTP connections from Localhost in Go?", "body": "<p>Converting <a href=\"https://stackoverflow.com/users/6309/vonc\"><code>VonC</code></a>'s comment into an answer.</p>\n\n<p>You can bind the host by setting <code>host:port</code> in your <code>http.Server.Addr</code> or <code>http.ListenAndServe</code>.</p>\n\n<p>They use <code>net.Listen</code> internally.</p>\n\n<p>From <a href=\"https://golang.org/pkg/net/#Listen\" rel=\"noreferrer\"><code>net.Listen</code></a> :</p>\n\n<blockquote>\n  <p>For TCP and UDP, the syntax of laddr is \"host:port\", like\n  \"127.0.0.1:8080\". If host is omitted, as in \":8080\", Listen listens on\n  all available interfaces instead of just the interface with the given\n  host address.</p>\n</blockquote>\n"}], "owner": {"reputation": 6626, "user_id": 886749, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/d8206b3ff36c7985108359f97562a9a4?s=128&d=identicon&r=PG", "display_name": "Cory Kendall", "link": "https://stackoverflow.com/users/886749/cory-kendall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6793, "favorite_count": 3, "accepted_answer_id": 41034423, "answer_count": 1, "score": 8, "last_activity_date": 1481183677, "creation_date": 1481150612, "question_id": 41028709, "link": "https://stackoverflow.com/questions/41028709/only-accept-http-connections-from-localhost-in-go", "title": "Only accept HTTP connections from Localhost in Go?", "body": "<p>I have a simple HTTP Server standing up in Golang: </p>\n\n<pre><code>h := http.NewServeMux()\nh.Handle(\"/somepath\", MyHandler)\n\ns := &amp;http.Server{\n    Addr:    \"1234\",\n    Handler: h,\n}   \n\ns.ListenAndServe();\n</code></pre>\n\n<p>What is the best way to drop connections where the caller is not localhost?  Currently I'm considering inspecting the underlying connection information and ensuring that the IP Address is <code>127.0.0.1</code>, but this wastes a whole lot of resources (and runs through a whole bunch of Go code) before ultimately dropping the connection.  Ideally, I can instrument the Golang server to drop the initial TCP SYN packet based on IP Address, and not create a TCP connection at all (or reveal that this port is listening).</p>\n\n<p>What's the cleanest path forward here?</p>\n"}, {"tags": ["dictionary", "random", "go"], "comments": [{"owner": {"reputation": 955, "user_id": 2012422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa63e9919136deb873c55bd717ac4c96?s=128&d=identicon&r=PG", "display_name": "matias elgart", "link": "https://stackoverflow.com/users/2012422/matias-elgart"}, "edited": false, "score": 0, "creation_date": 1481120283, "post_id": 41019703, "comment_id": 69246621, "body": "dictionary iteration order is usually a function of insertion and hash collision order, so if you need random, you probably need to introduce some randomness yourself. one way would be to pull the keys of the map, shuffle them randomly and then iterate over the map using your shuffled keys."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481120571, "post_id": 41019703, "comment_id": 69246831, "body": "It&#39;s not guaranteed to be in any specific order, which includes random. While the implementation currently shuffles the output, it&#39;s definitely not over a normal distribution."}, {"owner": {"reputation": 53, "user_id": 7262713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11242a72ffaca7d676bec977c4c7d370?s=128&d=identicon&r=PG&f=1", "display_name": "Brett Lempereur", "link": "https://stackoverflow.com/users/7262713/brett-lempereur"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481120767, "post_id": 41019703, "comment_id": 69246986, "body": "Thanks @JimB, I&#39;ll keep a slice of Clients and use that instead, or figure out a more efficient solution than that."}, {"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "reply_to_user": {"reputation": 955, "user_id": 2012422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa63e9919136deb873c55bd717ac4c96?s=128&d=identicon&r=PG", "display_name": "matias elgart", "link": "https://stackoverflow.com/users/2012422/matias-elgart"}, "edited": false, "score": 1, "creation_date": 1481120858, "post_id": 41019703, "comment_id": 69247062, "body": "@matiaselgart The current implementation actually explicitly randomises iteration. But this is not guaranteed by the standard."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481121159, "post_id": 41019703, "comment_id": 69247288, "body": "@BrettLempereur: is random access if more important that insertion and deletion, perhaps use a different data structure. A simple sorted slice is <code>O(1)</code> random access, <code>O(log n)</code> lookup, and <code>O(n)</code> insertion, which is often just fine."}, {"owner": {"reputation": 53, "user_id": 7262713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11242a72ffaca7d676bec977c4c7d370?s=128&d=identicon&r=PG&f=1", "display_name": "Brett Lempereur", "link": "https://stackoverflow.com/users/7262713/brett-lempereur"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481121390, "post_id": 41019703, "comment_id": 69247452, "body": "@JimB: Insertion and deletion each happen once per-session, pairing can happen multiple times. I&#39;ll need to get some real world data to see which happens more frequently in practice, for now I&#39;ll see which comes out cleaner."}, {"owner": {"reputation": 955, "user_id": 2012422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa63e9919136deb873c55bd717ac4c96?s=128&d=identicon&r=PG", "display_name": "matias elgart", "link": "https://stackoverflow.com/users/2012422/matias-elgart"}, "reply_to_user": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 0, "creation_date": 1481121519, "post_id": 41019703, "comment_id": 69247549, "body": "@Art wow, unexpected. thank you for the info, very much appreciated. i was curious why golang did this and found (from <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">blog.golang.org/go-maps-in-action</a>) : <code>Since Go 1 the runtime randomizes map iteration order, as programmers relied on the stable iteration order of the previous implementation.</code>"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 3, "last_activity_date": 1481121995, "creation_date": 1481121995, "answer_id": 41020432, "question_id": 41019703, "link": "https://stackoverflow.com/questions/41019703/is-map-iteration-sufficiently-random-for-randomly-selecting-keys/41020432#41020432", "title": "Is map iteration sufficiently random for randomly selecting keys?", "body": "<p>From the <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <ol start=\"3\">\n  <li>The iteration order over maps is not specified and is not guaranteed to be the same from one iteration to the next. <em>(...)</em></li>\n  </ol>\n</blockquote>\n\n<p>Which essentially means that the order in which maps are iterated is <em>undefined.</em> Even if it's random right now with the default Go compiler, other compilers or other versions might differ.</p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1481122647, "post_id": 41020528, "comment_id": 69248322, "body": "Yup, and the distribution gets even worse depending on the distribution of keys: <a href=\"https://play.golang.org/p/2MMS3pPCMO\" rel=\"nofollow noreferrer\">play.golang.org/p/2MMS3pPCMO</a> <code>[15597 9339 3211 3076 3153 3170 21979 3201 3119 3081 3082 3137 3114 2943 3099 3101 3151 0 0 3101 3150 3196 0]</code>"}, {"owner": {"reputation": 53, "user_id": 7262713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11242a72ffaca7d676bec977c4c7d370?s=128&d=identicon&r=PG&f=1", "display_name": "Brett Lempereur", "link": "https://stackoverflow.com/users/7262713/brett-lempereur"}, "edited": false, "score": 0, "creation_date": 1481132225, "post_id": 41020528, "comment_id": 69254823, "body": "Thanks a lot, that really clarifies it!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1481129298, "last_edit_date": 1495541633, "creation_date": 1481122254, "answer_id": 41020528, "question_id": 41019703, "link": "https://stackoverflow.com/questions/41019703/is-map-iteration-sufficiently-random-for-randomly-selecting-keys/41020528#41020528", "title": "Is map iteration sufficiently random for randomly selecting keys?", "body": "<p>Even though it said to be random (randomized) (<a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">spec</a>, <a href=\"https://blog.golang.org/go-maps-in-action#TOC_7.\" rel=\"nofollow noreferrer\">blog</a>, <a href=\"https://github.com/golang/go/blob/master/src/runtime/hashmap.go\" rel=\"nofollow noreferrer\">hashmap source</a>, <a href=\"https://nathanleclaire.com/blog/2014/04/27/a-surprising-feature-of-golang-that-colored-me-impressed/\" rel=\"nofollow noreferrer\">another blog</a>, <a href=\"https://stackoverflow.com/questions/28930416/why-cant-go-iterate-maps-in-insertion-order/28931555#28931555\">SO</a>), the distribution is far from being perfect.</p>\n\n<p>Why? Because we like maps being <em>fast</em>, and better random distribution tends to require more computation and/or bigger delays. A compromise had to be made. And because the intention is not to provide a quality \"shuffle\" functionality by <code>for range</code>, but only to prevent developers relying on stable iteration order (because it could change even without explicit randomization).</p>\n\n<p>But \"how good\" may this distribution be? Easy to get a \"taste\". Let's create a map of 10 pairs, and start iterating over it lot of times. And let's count the distribution of the very first index (key):</p>\n\n<pre><code>m := map[int]int{}\nfor i := 0; i &lt; 10; i++ {\n    m[i] = i\n}\n\ndist := make([]int, 10)\nfor i := 0; i &lt; 100000; i++ {\n    for idx := range m {\n        dist[idx]++\n        break\n    }\n}\n\nfmt.Println(\"Distribution:\", dist)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/XsHrKXNxK-\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Distribution: [25194 24904 6196 6134 6313 6274 6297 6189 6189 6310]\n</code></pre>\n\n<p>The first 2 keys (<code>0</code> and <code>1</code>) were roughly encountered <strong>4 times more</strong> than the rest which had roughly the same probability.</p>\n\n<p>You can tell it's pretty bad for being true (or even good) random, but that's not the point. It's good enough to provide varying iteration order (and importantly: it's fast).</p>\n"}], "owner": {"reputation": 53, "user_id": 7262713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11242a72ffaca7d676bec977c4c7d370?s=128&d=identicon&r=PG&f=1", "display_name": "Brett Lempereur", "link": "https://stackoverflow.com/users/7262713/brett-lempereur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 781, "favorite_count": 0, "accepted_answer_id": 41020528, "answer_count": 2, "score": 5, "last_activity_date": 1481129298, "creation_date": 1481120123, "question_id": 41019703, "link": "https://stackoverflow.com/questions/41019703/is-map-iteration-sufficiently-random-for-randomly-selecting-keys", "title": "Is map iteration sufficiently random for randomly selecting keys?", "body": "<p>Can I rely on the random iteration order of maps to implement a random \"pairing\" of clients in a web application?  I've tried looking around but can't seem to find a breakdown of how random this randomness is.</p>\n\n<p>The algorithm would look something like:</p>\n\n<pre><code>var clients map[Client]struct{}\n\nfunc PairClient(c Client) (Client, error) {\n    for m := range clients {\n        if m != c {\n            return m, nil\n        }\n    }\n    return nil, fmt.Errorf(\"lobby: insufficient number of clients\")\n}\n</code></pre>\n\n<p>Would this be sufficient when there are >1000 connected clients, or should I maintain a separate slice of clients and randomly select from that?</p>\n"}, {"tags": ["pointers", "go", "methods", "struct", "interface"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481107049, "post_id": 41015114, "comment_id": 69237632, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/40823315/go-x-does-not-implement-y-method-has-a-pointer-receiver/40824044#40824044\">Go, X does not implement Y (\u2026 method has a pointer receiver)</a>"}, {"owner": {"reputation": 557, "user_id": 617118, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/916c44d21c9c1eeef8d71564e990ecd2?s=128&d=identicon&r=PG", "display_name": "danze", "link": "https://stackoverflow.com/users/617118/danze"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481108228, "post_id": 41015114, "comment_id": 69238497, "body": "Thanks. But my question is, why does the compiler allows to call struct methods with value and pointer receivers using value types and pointers. But doesn&#39;t provide similar support to interfaces? May be its more of a design question than how the language works?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1481112123, "post_id": 41015114, "comment_id": 69240943, "body": "@danze If this is a design question than it is not appropriate for SO."}, {"owner": {"reputation": 557, "user_id": 617118, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/916c44d21c9c1eeef8d71564e990ecd2?s=128&d=identicon&r=PG", "display_name": "danze", "link": "https://stackoverflow.com/users/617118/danze"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1481143802, "post_id": 41015114, "comment_id": 69261508, "body": "@Volker My problem originated from not completely understanding Go interfaces and the accepted answer clarified that for me. It&#39;s not a design question."}], "answers": [{"comments": [{"owner": {"reputation": 557, "user_id": 617118, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/916c44d21c9c1eeef8d71564e990ecd2?s=128&d=identicon&r=PG", "display_name": "danze", "link": "https://stackoverflow.com/users/617118/danze"}, "edited": false, "score": 0, "creation_date": 1481111404, "post_id": 41016448, "comment_id": 69240486, "body": "This is what I was after. Now I understand why the compiler is behaving this way. Thanks!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1481130747, "last_edit_date": 1495542808, "creation_date": 1481110588, "answer_id": 41016448, "question_id": 41015114, "link": "https://stackoverflow.com/questions/41015114/types-of-go-struct-methods-that-satisfy-an-interface/41016448#41016448", "title": "Types of Go struct methods that satisfy an interface", "body": "<p>If a method has a pointer receiver, only a pointer value can be used as the receiver value. So to call this method on some value, the value itself must be a pointer, or it must be possible to acquire its address (to be used as the receiver).</p>\n\n<p>If you have a variable for example, it is <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a> and thus it's possible to get its address and use that as the receiver. And the spec allows you to do this, this happens automatically.</p>\n\n<p>Values wrapped in interfaces are not addressable. When an interface value is created, the value that is wrapped in the interface is copied. It is therefore not possible to take its address. Theoretically you could allow to take the address of the copy, but that would be the source of (even) more confusion than what benefit it would provide, as the address would point to a copy, and methods with pointer receiver could only modify the copy and not the original.</p>\n\n<p>See this answer which details / proves that values are copied when the interface value is created: <a href=\"https://stackoverflow.com/questions/36077566/how-can-a-slice-contain-itself/36078970#36078970\">How can a slice contain itself?</a></p>\n"}, {"tags": [], "owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "is_accepted": false, "score": 3, "last_activity_date": 1481110673, "creation_date": 1481110673, "answer_id": 41016472, "question_id": 41015114, "link": "https://stackoverflow.com/questions/41015114/types-of-go-struct-methods-that-satisfy-an-interface/41016472#41016472", "title": "Types of Go struct methods that satisfy an interface", "body": "<p>if you have a pointer to a struct then go will allow you to access the properties on the struct and its functions which have value type receivers (as apposed to pointer receivers) without having to dereference your pointer, but this only works for one level of pointer, see your code below where I turn t2 into a pointer to a pointer to a <code>tourguide</code>, at this point I need to explicitly dereference it to make it back into a pointer to a <code>tourguide</code>. think of the first level of a pointer to a struct as being a special case that go allows you to use syntatic sugar to access the value types properties and functions to save you having to constantly manually dereference you variables.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype greeter interface {\n    hello()\n    goodbye()\n}\n\ntype tourGuide struct {\n    name string\n}\n\nfunc (t tourGuide) hello() {\n    fmt.Println(\"Hello\", t.name)\n}\n\nfunc (t *tourGuide) goodbye() {\n    fmt.Println(\"Goodbye\", t.name)\n}\n\nfunc main() {\n    var t1 tourGuide = tourGuide{\"James\"}\n    t1.hello()   // Hello James\n    t1.goodbye() // Goodbye James (same as (&amp;t1).goodbye())\n\n    var tmpT2 *tourGuide = &amp;tourGuide{\"Smith\"}\n    var t2 **tourGuide = &amp;tmpT2\n    (*t2).hello()   // Hello Smith\n    (*t2).goodbye() // Goodbye Smith (same as (*t2).hello())\n\n    //illegal: t1 is not assignable to g1 (why?)\n    //var g1 greeter = t1\n\n    //now this is illegal too\n    //var g2 greeter = t2\n\n    var g3 greeter = (*t2)\n    g3.hello()   // Hello Smith\n    g3.goodbye() // Goodbye Smith\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 544, "user_id": 1365918, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/e4EoH.jpg?s=128&g=1", "display_name": "kapad", "link": "https://stackoverflow.com/users/1365918/kapad"}, "edited": false, "score": 1, "creation_date": 1598450421, "post_id": 48876236, "comment_id": 112463461, "body": "Up voting because the answer that you linked to (which is also written by you) is really good. Still, I think this should be reworded to &quot;My answer here&quot; to make it clear that the other answer has also been written by you."}], "tags": [], "owner": {"reputation": 817, "user_id": 32122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c2c929be789dc669b2901330ebdb5a9?s=128&d=identicon&r=PG", "display_name": "WPWoodJr", "link": "https://stackoverflow.com/users/32122/wpwoodjr"}, "is_accepted": false, "score": 1, "last_activity_date": 1601148697, "last_edit_date": 1601148697, "creation_date": 1519086752, "answer_id": 48876236, "question_id": 41015114, "link": "https://stackoverflow.com/questions/41015114/types-of-go-struct-methods-that-satisfy-an-interface/48876236#48876236", "title": "Types of Go struct methods that satisfy an interface", "body": "<p><a href=\"https://stackoverflow.com/a/48874650/32122\">My answer here</a> explains why Go prevents you from taking the address of a value stored in an interface.</p>\n<p><strong>tl;dr</strong> its because a pointer to <em><strong>A</strong></em> which points to a value of type <em><strong>A</strong></em> in an interface would be invalidated when a value of different type <em><strong>B</strong></em> is subsequently stored in the interface.</p>\n"}], "owner": {"reputation": 557, "user_id": 617118, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/916c44d21c9c1eeef8d71564e990ecd2?s=128&d=identicon&r=PG", "display_name": "danze", "link": "https://stackoverflow.com/users/617118/danze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 615, "favorite_count": 0, "accepted_answer_id": 41016448, "answer_count": 3, "score": 3, "last_activity_date": 1601148697, "creation_date": 1481106789, "last_edit_date": 1481111034, "question_id": 41015114, "link": "https://stackoverflow.com/questions/41015114/types-of-go-struct-methods-that-satisfy-an-interface", "title": "Types of Go struct methods that satisfy an interface", "body": "<p>Given the following Go code example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype greeter interface {\n    hello()\n    goodbye()\n}\n\ntype tourGuide struct {\n    name string\n}\n\nfunc (t tourGuide) hello() {\n    fmt.Println(\"Hello\", t.name)\n}\n\nfunc (t *tourGuide) goodbye() {\n    fmt.Println(\"Goodbye\", t.name)\n}\n\nfunc main() {\n    var t1 tourGuide = tourGuide{\"James\"}\n    t1.hello()   // Hello James\n    t1.goodbye() // Goodbye James (same as (&amp;t1).goodbye())\n\n    var t2 *tourGuide = &amp;tourGuide{\"Smith\"}\n    t2.hello()   // Hello Smith\n    t2.goodbye() // Goodbye Smith (same as (*t2).hello())\n\n    // illegal: t1 is not assignable to g1 (why?)\n    // var g1 greeter = t1\n\n    var g2 greeter = t2\n    g2.hello()   // Hello Smith\n    g2.goodbye() // Goodbye Smith\n}\n</code></pre>\n\n<p>I'm able to call the two methods of the struct <code>tourGuide</code> using either a variable of type tourGuide <code>t1</code> or a pointer to tourGuide <code>t2</code>. In other words, I can call a method with <code>T</code> receiver using a variable of type <code>T</code> or <code>*T</code>. Similarly, I can call a method with <code>*T</code> receiver using a variable of type <code>T</code> (if <code>T</code> is <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a>) or <code>*T</code>. I understand that the compiler handles the differences here (see my comments in the code).</p>\n\n<p>However, things change when we are implementing interfaces. In the above code, a variable of type <code>greeter</code> interface is assignable from a pointer to <code>tourGuide</code> but not from a <code>tourGuide</code>.</p>\n\n<p>Can anyone tell me why this is the case? Why am I able to call <code>t1.hello()</code> and <code>t1.goodbye()</code> but somehow <code>t1</code> is not enough for the interface <code>greeter</code>?</p>\n"}, {"tags": ["function", "go", "struct"], "comments": [{"owner": {"reputation": 5994, "user_id": 5710637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TAM5l.jpg?s=128&g=1", "display_name": "fafl", "link": "https://stackoverflow.com/users/5710637/fafl"}, "edited": false, "score": 0, "creation_date": 1481099668, "post_id": 41012624, "comment_id": 69232774, "body": "Have you tried renaming the method to resolve the conflict?"}, {"owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "reply_to_user": {"reputation": 5994, "user_id": 5710637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TAM5l.jpg?s=128&g=1", "display_name": "fafl", "link": "https://stackoverflow.com/users/5710637/fafl"}, "edited": false, "score": 0, "creation_date": 1481099945, "post_id": 41012624, "comment_id": 69232939, "body": "@fafl, Yes, I tried that. I replace the function Sort with InSort in both packages (sort &amp; main). It returns the following error. <b>i.InSort undefined (type sort.InsertionSort has no field or method InSort)</b>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481100428, "post_id": 41012624, "comment_id": 69233238, "body": "The code you posted works. Please post your complete code or this question as it is is off-topic."}, {"owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481100607, "post_id": 41012624, "comment_id": 69233364, "body": "@icza, please refer the following Git link to for the complete code. <a href=\"https://github.com/gokulnathk/Go/tree/master/testgo\" rel=\"nofollow noreferrer\">github.com/gokulnathk/Go/tree/master/testgo</a>"}, {"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1481100638, "post_id": 41012624, "comment_id": 69233388, "body": "Your code works fine. I didn&#39;t get any issue with it."}, {"owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "reply_to_user": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1481100790, "post_id": 41012624, "comment_id": 69233472, "body": "@nexus66, Did you tried creating two separate files for <i>package sort inside the directory sort</i> and main? Please refer the git link I shared."}, {"owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 0, "creation_date": 1481100853, "post_id": 41012624, "comment_id": 69233514, "body": "Is it correct your package path? It&#39;s like that <code>learning&#47;Go&#47;testgo&#47;sort</code> doesn&#39;t have your current changes in the code"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481100887, "post_id": 41012624, "comment_id": 69233538, "body": "@GokulnathK If you use the code you posted, your import should be <code>&quot;github.com&#47;gokulnathk&#47;Go&#47;sort&quot;</code>, not <code>&quot;learning&#47;Go&#47;testgo&#47;sort&quot;</code>."}, {"owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "reply_to_user": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 0, "creation_date": 1481100993, "post_id": 41012624, "comment_id": 69233624, "body": "@Motakjuq, Only change is there was a <b>Go</b> added in the path after learning. No other changes made with the code. I have made some mistake while cloning the project to my current working machine."}, {"owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481101245, "post_id": 41012624, "comment_id": 69233780, "body": "@icza, I&#39;m having a copy of the same code in my local workstation in this path <i>&quot;learning/Go/testgo/sort&quot;</i>. Can&#39;t I use that one?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481101386, "post_id": 41012624, "comment_id": 69233876, "body": "@GokulnathK Yes, you can, but since the code you posted works, I assume the copy you have in <code>learning&#47;Go&#47;testgo&#47;sort</code> is not the same what we see in <code>github.com&#47;gokulnathk&#47;Go&#47;sort</code>."}, {"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1481101445, "post_id": 41012624, "comment_id": 69233912, "body": "@GokulnathK look at my <a href=\"https://s11.postimg.org/quc6e4skz/S_lection_021.png\" rel=\"nofollow noreferrer\">folders tree</a>. It runs perfectly with this order."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1481101577, "post_id": 41012624, "comment_id": 69233992, "body": "@GokulnathK You must put your <code>main.go</code> into a folder too. Also do you have your <code>$GOPATH</code> set properly? What does <code>go env</code> print?"}, {"owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "edited": false, "score": 0, "creation_date": 1481101737, "post_id": 41012624, "comment_id": 69234100, "body": "as others have said above, your code works, see it running here <a href=\"https://play.golang.org/p/S1hk9s-p1U\" rel=\"nofollow noreferrer\">play.golang.org/p/S1hk9s-p1U</a>, you must have not recompiled with your latest changes."}, {"owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "reply_to_user": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "edited": false, "score": 0, "creation_date": 1481101935, "post_id": 41012624, "comment_id": 69234224, "body": "@0xor1, I tried that, if it is in a single file. It works. But whenever I moved it to a seperate folder it creates error."}, {"owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "reply_to_user": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1481101987, "post_id": 41012624, "comment_id": 69234263, "body": "@nexus66, If I removed the file bubblesort.go from the sort directory. It works fine. But I want both of them to work."}, {"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1481102202, "post_id": 41012624, "comment_id": 69234420, "body": "@GokulnathK i just added the bubblesort.go file and it works again. Do you want i post an answer with explicit order ?"}, {"owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "reply_to_user": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1481107660, "post_id": 41012624, "comment_id": 69238064, "body": "@nexus66, Could you please post the order change for the files, or send links to the files?"}, {"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1481112458, "post_id": 41012624, "comment_id": 69241176, "body": "@GokulnathK check my answer."}], "answers": [{"comments": [{"owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "edited": false, "score": 0, "creation_date": 1481121315, "post_id": 41017000, "comment_id": 69247393, "body": "It is working fine. Thanks for the help. Could you please explain what is wrong with my file structure?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "edited": false, "score": 2, "creation_date": 1481125957, "post_id": 41017000, "comment_id": 69250665, "body": "@GokulnathK: create only 1 packager per directory, always keep your packages in GOPATH, and never use relative imports. Read carefully through <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>"}, {"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481133951, "post_id": 41017000, "comment_id": 69255862, "body": "Good answer @JimB. Thanks."}], "tags": [], "owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "is_accepted": true, "score": 0, "last_activity_date": 1481112654, "last_edit_date": 1481112654, "creation_date": 1481112312, "answer_id": 41017000, "question_id": 41012624, "link": "https://stackoverflow.com/questions/41012624/gos-method-on-struct-throws-too-many-argument-in-call/41017000#41017000", "title": "Go&#39;s method on struct throws too many argument in call", "body": "<p>I think that the order of your directories isn't correct or maybe you've some other oddities.</p>\n\n<p><strong>Note:</strong> I'm running <code>Ubuntu 16.04.1 64bit</code> wihtin <code>go version go1.6.2 linux/amd64</code></p>\n\n<p>So, here are the steps that i used to run your package.</p>\n\n<p><strong>1-</strong> </p>\n\n<p>Check Your <code>GOPATH</code> or export a new one like this example</p>\n\n<pre><code>$ export GOPATH=$HOME/Bureau/stack\n</code></pre>\n\n<p><strong>2-</strong></p>\n\n<p>Check if your <code>$GOPATH</code> points to a directory :</p>\n\n<pre><code>$ $GOPATH\nbash: /home/nexus/Bureau/stack/ : is a directory\n</code></pre>\n\n<p><strong>3-</strong></p>\n\n<p>Clone your <a href=\"https://github.com/gokulnathk/Go\" rel=\"nofollow noreferrer\">repository</a> in <code>$GOPATH/src</code> folder </p>\n\n<pre><code>$ cd $GOPATH/src\n$ git clone https://github.com/gokulnathk/Go\n</code></pre>\n\n<p>Now, the hierarchy of the folders are:</p>\n\n<pre><code>$ tree\n.\n\u251c\u2500\u2500 Go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 atm-dispening\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 download\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 download.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 downloadParallel\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 downloadParallel.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 hello\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 hello.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 portserver\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 simpleport.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 safebrowsing\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 testgo\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 functionParam.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 functions.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 greeting\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 greeting.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 routine.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sort\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 bubblesort.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 insertionsort.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sort.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sorttest.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 struct.go\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 test.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 webserver\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 modcloth.txt\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 simple.go\n\u2514\u2500\u2500 main.go\n\n11 directories, 17 files\n</code></pre>\n\n<p>Here, what we need to know to run your code is:</p>\n\n<ul>\n<li>Path of sort folder which is : <code>Go/testgo/sort</code></li>\n<li>main.go placed in <code>$GOPATH/src</code></li>\n</ul>\n\n<p>main.go :</p>\n\n<pre><code>package main\n\nimport (\n  \"Go/testgo/sort\"\n  \"fmt\"\n)\n\nfunc main() {\n    unsort := []int {5, 7, 3, 2 ,4 ,8, 9, 12, 1};\n    i := sort.InsertionSort {unsort};\n\n    mode := \"asc\";\n    sorted:= i.Sort(mode);\n    fmt.Println(sorted);\n}\n</code></pre>\n\n<p><strong>Finally</strong></p>\n\n<p>Check you're in <code>$GOPATH/src</code> and run:</p>\n\n<pre><code>$ go run main.go\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[1 2 3 4 5 7 8 9 12]\n</code></pre>\n"}], "owner": {"reputation": 76, "user_id": 4354271, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bedfb82ecc3666ff7f1b1b4dfbb2d28b?s=128&d=identicon&r=PG&f=1", "display_name": "Gokulnath K", "link": "https://stackoverflow.com/users/4354271/gokulnath-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 41017000, "answer_count": 1, "score": 0, "last_activity_date": 1481112654, "creation_date": 1481099458, "question_id": 41012624, "link": "https://stackoverflow.com/questions/41012624/gos-method-on-struct-throws-too-many-argument-in-call", "title": "Go&#39;s method on struct throws too many argument in call", "body": "<p>I am getting the following compiler error while running the following Go Code.</p>\n\n<pre><code>package sort\n\ntype InsertionSort struct {\n    Unsorted []int;\n}\n\nfunc (is InsertionSort) Sort(mode string) []int {\n    length := len(is.Unsorted);\n\n    funcs := map[string] func(int, int) bool {\"method\":is.greaterThan};\n    if mode == \"desc\" {\n        funcs = map[string] func(int, int) bool {\"method\":is.lesserThan};\n    }\n\n    for i := 0; i &lt; length; i++ {\n        temp := is.Unsorted[i];\n        j := i - 1;\n        for ; j &gt;=0 &amp;&amp; funcs[\"method\"](is.Unsorted[j], temp); j-- {\n            is.Unsorted[j + 1] = is.Unsorted[j];\n        }\n        is.Unsorted[j + 1] = temp;\n    }\n\n    return is.Unsorted;\n}\n\nfunc (is InsertionSort) greaterThan (a int, b int) bool {\n    return a &gt; b;\n}\n\nfunc (is InsertionSort) lesserThan (a int, b int) bool {\n    return a &lt; b;\n}\n</code></pre>\n\n<p>and the main package which has the calling function</p>\n\n<pre><code>package main\n\nimport (\n  \"learning/Go/testgo/sort\"\n  \"fmt\"\n)\n\nfunc main() {\n    unsort := []int {5, 7, 3, 2 ,4 ,8, 9, 12, 1};\n    i := sort.InsertionSort {unsort};\n\n    mode := \"asc\";\n    sorted := i.Sort(mode);\n    fmt.Println(sorted);\n}\n</code></pre>\n\n<p>Error message returned by the compiler is </p>\n\n<blockquote>\n  <p>.\\sort.go:16: too many arguments in call to i.Sort</p>\n</blockquote>\n\n<p>Note :-\n<em>Package</em> <strong><em>sort</em></strong> <em>already has another struct called BubbleSort, which has the same Sort method with no arguments. I don't know whether it is conflicting the current struct</em>.</p>\n\n<p>Please help me on this.</p>\n"}, {"tags": ["reactjs", "go", "react-router", "single-page-application"], "answers": [{"comments": [{"owner": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 0, "creation_date": 1481176613, "post_id": 41017520, "comment_id": 69272660, "body": "&quot;since all unknown / unregistered routes match /&quot; ... I have no idea why I didn&#39;t knew this o.o, seemed like the kind of thing I should have learned way, way,way back."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "edited": false, "score": 0, "creation_date": 1481180052, "post_id": 41017520, "comment_id": 69274218, "body": "<code>Note that since a pattern ending in a slash names a rooted subtree, the pattern &quot;&#47;&quot; matches all paths not matched by other registered patterns, not just the URL with Path == &quot;&#47;&quot;.</code> from <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">GoDoc</a>"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 2, "last_activity_date": 1481114116, "last_edit_date": 1481114116, "creation_date": 1481113752, "answer_id": 41017520, "question_id": 41012485, "link": "https://stackoverflow.com/questions/41012485/golang-single-page-website-server/41017520#41017520", "title": "Golang single page website server", "body": "<p>In <code>net/http</code> you can use the handler than serves the <code>/</code> route to return a 404 page since all unknown / unregistered routes match <code>/</code>.</p>\n\n<pre><code>http.HandleFunc(\"/\", handler)\n\n...\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != \"/\" {\n       w.WriteHeader(http.StatusNotFound)\n       // Write custom 404 Page to w.Write()\n        return\n    }\n    // Handling for route /\n}\n</code></pre>\n\n<p>You could also use a different http multiplexer that supports <code>Not Found Handlers</code>.</p>\n\n<p>Eg. </p>\n\n<p>In <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\"><code>httprouter</code></a> you set <a href=\"https://godoc.org/github.com/julienschmidt/httprouter#Router\" rel=\"nofollow noreferrer\"><code>httprouter.Router.NotFound</code></a></p>\n\n<p>OR</p>\n\n<p>In <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\"><code>gorilla/mux</code></a> you set <a href=\"http://www.gorillatoolkit.org/pkg/mux#Router\" rel=\"nofollow noreferrer\"><code>mix.Router.NotFoundHandler</code></a></p>\n"}], "owner": {"reputation": 2415, "user_id": 7156008, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/QzIXM.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/7156008/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1543, "favorite_count": 0, "closed_date": 1481176562, "accepted_answer_id": 41017520, "answer_count": 1, "score": 0, "last_activity_date": 1481114116, "creation_date": 1481099016, "question_id": 41012485, "link": "https://stackoverflow.com/questions/41012485/golang-single-page-website-server", "closed_reason": "Duplicate", "title": "Golang single page website server", "body": "<p>I'm trying to build some spa/spw with golang and react-router as the back-end, but I've encountered a little problem. </p>\n\n<p>React-router seems to base itself around the idea that any \"bad\" request to the server (e.g. /path/dynamicRessourceHash ) delivers an .html page the user (said html page then imports the .js from the server) and react-router then kicks in, analyzes the path and gives the application the information needed to make fetch requests in the background and deliver the resources to the user.</p>\n\n<p>So what would be the standard way to configure a server like this using \"net/http\" from std , that is, to server resources normally on pre-configured endpoints but treat all other endpoints as wildcards for one (or few) routes ?</p>\n\n<p>Just to give an example (since today I seem to be bad with words). Say the user makes a request at:</p>\n\n<p>/route1/whatever/someotherstuff?... etc whatever the things after the second \"/\" are I want the user to be served by the handler function for /route1/ (Note, i don't want the user to be redirected, since that fucks up the URL and consequently the client-side routing).</p>\n"}, {"tags": ["linux", "go", "coreos"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 1, "creation_date": 1481098342, "post_id": 41012288, "comment_id": 69232026, "body": "The output message looks as if it was formatted by log package, so it means the binary is running correctly. It is an application issue then."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1481098346, "post_id": 41012288, "comment_id": 69232027, "body": "Does the application have any dependencies ? Config Files, Environment Variables, etc."}, {"owner": {"reputation": 337, "user_id": 2739823, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/e43384b242b9ab804f0234aae79e7d08?s=128&d=identicon&r=PG&f=1", "display_name": "user2739823", "link": "https://stackoverflow.com/users/2739823/user2739823"}, "edited": false, "score": 0, "creation_date": 1481098444, "post_id": 41012288, "comment_id": 69232090, "body": "Well, I am following this tutorial:  <a href=\"https://blog.codeship.com/extend-docker-via-plugin/\" rel=\"nofollow noreferrer\">blog.codeship.com/extend-docker-via-plugin</a> So I am expecting after execution of binary to have a socket in ls -la /run/docker/plugins , but it is not there  I&#39;ve changed &quot;Mount&quot; and &quot;Unmount&quot; methods in order to compile it and added Capabilities method as well."}, {"owner": {"reputation": 337, "user_id": 2739823, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/e43384b242b9ab804f0234aae79e7d08?s=128&d=identicon&r=PG&f=1", "display_name": "user2739823", "link": "https://stackoverflow.com/users/2739823/user2739823"}, "edited": false, "score": 0, "creation_date": 1481098881, "post_id": 41012288, "comment_id": 69232328, "body": "Maybe it is something like this:  <a href=\"https://github.com/docker/go-plugins-helpers/issues/38\" rel=\"nofollow noreferrer\">github.com/docker/go-plugins-helpers/issues/38</a> I will check"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1481104652, "post_id": 41012288, "comment_id": 69236021, "body": "Post your edit as an answer, and accept it -- this is a normal (and recommended) SO practice."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1481104709, "post_id": 41012288, "comment_id": 69236060, "body": "A nitpick: the invocation <code>GOOS=linux GOARCH=amd64 go build</code> should work just fine without <code>env</code>."}], "answers": [{"tags": [], "owner": {"reputation": 13767, "user_id": 2413201, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/rxfuw.jpg?s=128&g=1", "display_name": "Armali", "link": "https://stackoverflow.com/users/2413201/armali"}, "is_accepted": false, "score": 0, "last_activity_date": 1525858089, "creation_date": 1525858089, "answer_id": 50249918, "question_id": 41012288, "link": "https://stackoverflow.com/questions/41012288/error-starting-executable-built-by-a-go-compiler/50249918#50249918", "title": "Error starting executable built by a Go compiler", "body": "<p><p>The problem was in <code>ServerUnixGroup</code>. It should be \"docker\" instead of \"root\".</p> \u2013 user2739823</p>\n"}], "owner": {"reputation": 337, "user_id": 2739823, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/e43384b242b9ab804f0234aae79e7d08?s=128&d=identicon&r=PG&f=1", "display_name": "user2739823", "link": "https://stackoverflow.com/users/2739823/user2739823"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1525858089, "creation_date": 1481098143, "last_edit_date": 1481104559, "question_id": 41012288, "link": "https://stackoverflow.com/questions/41012288/error-starting-executable-built-by-a-go-compiler", "title": "Error starting executable built by a Go compiler", "body": "<p>I am new to Go, and I have a docker plugin written in Go on my MAC. I build it with the following command: </p>\n\n<pre><code>env GOOS=linux GOARCH=amd64 go build\n</code></pre>\n\n<p>The output is binary file. When I copy it to CoreOS and try to execute:</p>\n\n<pre><code>./my-binary-file\n</code></pre>\n\n<p>the result is:</p>\n\n<blockquote>\n  <p>\"2016/12/07 08:05:00 Error Group root not found\"</p>\n</blockquote>\n\n<p>The OS on which file is executed is CoreOS. I've checked MAC and CoreOS, both of them are x86_64.</p>\n\n<p>Why then I get this error?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>The problem was in <code>ServerUnixGroup</code>. It should be \"docker\" instead of \"root\".</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1481098142, "post_id": 41012247, "comment_id": 69231939, "body": "The error message tells exactly where the error is. <i>parsing time &quot;&quot;null&quot;&quot; as &quot;&quot;2006-01-02T15:04:05Z07:00&quot;&quot;: cannot parse &quot;null&quot;&quot; as &quot;2006&quot;</i>. In your JSON body, you&#39;ve typed null as a string (&quot;null&quot;). Try removing the quotes around it."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "reply_to_user": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1481098644, "post_id": 41012247, "comment_id": 69232220, "body": "I know there is an error there because I put it there. My question is asking how to print where the error occurred."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 1, "creation_date": 1481099178, "post_id": 41012247, "comment_id": 69232473, "body": "Have you tried the <code>json.unmarshal()</code> function? It returns an error if there is any that might help you, see <a href=\"https://play.golang.org/p/eQCG-RE5sK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eQCG-RE5sK</a>"}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1481099567, "post_id": 41012247, "comment_id": 69232713, "body": "unmarshall doesn&#39;t tell me what line it occurred on, and I think I need to use the Dec.More approach for efficiency."}, {"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1481099715, "post_id": 41012247, "comment_id": 69232810, "body": "Ah, it&#39;s not possible to get additional information, like a line number from the Unmarshaller or Decoder. There&#39;s a discussion here where someone has put together a &quot;solution&quot; <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/fizimmXtVfc\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/fizimmXtVfc</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1481166063, "post_id": 41013458, "comment_id": 69269581, "body": "I quickly tried *time.Time in my struct but I still got &quot;OUTPUT: barbar was published at 0001-01-01 00:00:00 +0000 UTC&quot;"}, {"owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1481230440, "post_id": 41013458, "comment_id": 69304807, "body": "ah, it looks like the parser tried to decode the <i>string</i> value <code>&quot;null&quot;</code> instead of a plain <i>null</i> value (<code>null</code> without the quotes)."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1481269992, "post_id": 41013458, "comment_id": 69317838, "body": "btw is there is <a href=\"https://golang.org/pkg/time/#Time.IsZero\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Time.IsZero</a> ... nonetheless, it does suck how it&#39;s not easy to flag down an issue in the original JSON by line number."}], "tags": [], "owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "is_accepted": true, "score": 3, "last_activity_date": 1502089056, "last_edit_date": 1502089056, "creation_date": 1481102123, "answer_id": 41013458, "question_id": 41012247, "link": "https://stackoverflow.com/questions/41012247/debugging-a-json-error-from-golang/41013458#41013458", "title": "Debugging a JSON error from Golang", "body": "<p>One way to both accept null values, and to not print anything if <code>published_at</code> is null, is to set <code>PublishedAt</code> field to a pointer value :</p>\n\n<pre><code>type Movie struct {\n    Title       string    `json:\"title\"`\n    PublishedAt *time.Time `json:\"published_at\"`\n}\n</code></pre>\n\n<hr>\n\n<p>The input string is valid <em>JSON</em>, so the json package does not raise a <code>SyntaxError</code>.</p>\n\n<p>The <code>json</code> package has some other error types, such as <code>UnmarshalTypeError</code>, which is raised when an error occurs when the json does not match a nuilt-in type (e.g : <code>string</code>, <code>int</code>, <code>array</code> ...).</p>\n\n<p>Unfortunately, when it calls a custom <code>UnmarshalJSON()</code> function, it looks like the <code>json</code> package returns the raw error :</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"time\"\n)\n\n// check the full type of an error raised when Unmarshaling a json string\nfunc main() {\n    var test struct {\n        Clock time.Time\n    }\n    buf := bytes.NewBufferString(`{\"Clock\":null}`)\n    dec := json.NewDecoder(buf)\n\n    // ask to decode an invalid null value into a flat time.Time field :\n    err := dec.Decode(&amp;test)\n\n    // print the details of the returned error :\n    fmt.Printf(\"%#v\\n\", err)\n}\n\n// Output :\n&amp;time.ParseError{Layout:\"\\\"2006-01-02T15:04:05Z07:00\\\"\", Value:\"null\", LayoutElem:\"\\\"\", ValueElem:\"null\", Message:\"\"}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/fhZxVpOflb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fhZxVpOflb</a></p>\n\n<p>The final error comes straight from the <code>time</code> package, it is not some kind of <code>UnmarshalError</code> from the <code>json</code> package which could at least tell you \"this error occured when trying to Unmarshal value at this offset\", and the error alone will not give you the context.</p>\n\n<hr>\n\n<p>You can look specifically for type <code>*time.ParseError</code> in the error :</p>\n\n<pre><code>if terr, ok := err.(*time.ParseError); ok {\n    // in the example : Movie has one single time.Time field ;\n    // if a time.ParseError occured, it was while trying to read that field\n    fmt.Println(\"Error when trying to read 'published_at' value\", terr)\n\n    // you can leave the field to its zero value,\n    // or if you switched to a pointer field :\n    m.PublishedAt = nil\n}\n</code></pre>\n\n<p>If you happen to have several time fields (e.g : <code>ProducedAt</code>\u00a0and <code>PublishedAt</code>), you can still look which field was left with its zero value :</p>\n\n<pre><code>if terr, ok := err.(*time.ParseError); ok {\n    if m.ProducedAt.IsZero() {\n        fmt.Println(\"Error when trying to read 'produced_at' value\", terr)\n    }\n\n    if m.PublishedAt == zero {\n        fmt.Println(\"Error when trying to read 'published_at' value\", terr)\n    }\n}\n</code></pre>\n\n<p>By the way : as specified in <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\">the docs</a>, \"0001-01-01 00:00:00 UTC\" is the zero value that the go team chose for go's <code>time.Time</code> zero value.</p>\n"}, {"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1481269844, "post_id": 41036350, "comment_id": 69317782, "body": "I&#39;d rather just try parse it to time (identify the err) and be done with it. What&#39;s with the unnecessary third party tools? But it might not be a string. Could be just null."}], "tags": [], "owner": {"reputation": 2086, "user_id": 1739662, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ca4e51bd75777486cb5ae469e9c85d2?s=128&d=identicon&r=PG", "display_name": "liwp_Stephen", "link": "https://stackoverflow.com/users/1739662/liwp-stephen"}, "is_accepted": false, "score": 0, "last_activity_date": 1481190647, "creation_date": 1481190647, "answer_id": 41036350, "question_id": 41012247, "link": "https://stackoverflow.com/questions/41012247/debugging-a-json-error-from-golang/41036350#41036350", "title": "Debugging a JSON error from Golang", "body": "<p>Your data for published_at is \"null\", it is string type, so I think you can define the PublishedAt as string, and you can use code to parse it to time.Time.</p>\n\n<p>This is my test code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n\n    \"github.com/swanwish/go-common/logs\"\n    \"github.com/swanwish/go-common/utils\"\n)\n\nfunc main() {\n    url := `https://s.natalian.org/2016-12-07/debugme2.json`\n    _, content, err := utils.GetUrlContent(url)\n    if err != nil {\n        logs.Errorf(\"Failed to get content from url %s, the error is %v\", url, err)\n        return\n    }\n\n    movies := []struct {\n        Title       string `json:\"title\"`\n        PublishedAt string `json:\"published_at\"`\n    }{}\n    err = json.Unmarshal(content, &amp;movies)\n    if err != nil {\n        logs.Errorf(\"Failed to unmarshal content %s, the error is %v\", string(content), err)\n        return\n    }\n    logs.Debugf(\"The movies are %v\", movies)\n}\n</code></pre>\n\n<p>The result is:</p>\n\n<pre><code>The movies are [{foobar 2016-11-24T16:17:12.000+08:00} {barbar null} { 1999-12-24T16:11:12.000+02:00} {Something else entirely 2000-01-24T16:11:12.000+02:00}]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 170, "user_id": 4000206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/745f2ff4b63d9d58f039020058fcc0d2?s=128&d=identicon&r=PG&f=1", "display_name": "outdead", "link": "https://stackoverflow.com/users/4000206/outdead"}, "is_accepted": false, "score": 0, "last_activity_date": 1501981700, "creation_date": 1501981700, "answer_id": 45527727, "question_id": 41012247, "link": "https://stackoverflow.com/questions/41012247/debugging-a-json-error-from-golang/45527727#45527727", "title": "Debugging a JSON error from Golang", "body": "<p>It looks like madness, but it should work:</p>\n\n<pre><code>rawBody := []byte(`{\"title\":\"test\", \"published_at\":\"2017-08-05T15:04:05Z\", \"edited_at\":\"05.08.2017\"}`)\n\ntype Movie struct {\n   Title       string    `json:\"title\"`\n   PublishedAt time.Time `json:\"published_at\"`\n   EditedAt    time.Time `json:\"edited_at\"`\n}\n\nvar msg Movie \n\nif err = json.Unmarshal(rawBody, &amp;msg); err != nil {\n    if _, ok := err.(*time.ParseError); ok {\n        value := reflect.ValueOf(msg).Elem()\n\n        if value.Kind().String() != \"struct\" {\n            return err\n        }\n\n        for i := 0; i &lt; value.NumField(); i++ {\n            field := value.Field(i)\n\n            if t, ok := field.Interface().(time.Time); ok {\n                if t.IsZero() {\n                    name := value.Type().Field(i).Name\n                    return fmt.Errorf(\"field: %s, message: %s\", strings.ToLower(name), \"time is not in RFC 3339 format.\")\n                }\n            }\n        }\n    }\n\n    return err\n}\n</code></pre>\n\n<p>This code will return first error happened. If PublishedAt is invalid we will know nothing about EditedAt even if it is valid.</p>\n"}, {"tags": [], "owner": {"reputation": 4049, "user_id": 1083428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/000f45b685d4d6ff1a171676512c382e?s=128&d=identicon&r=PG", "display_name": "Pavel Evstigneev", "link": "https://stackoverflow.com/users/1083428/pavel-evstigneev"}, "is_accepted": false, "score": 2, "last_activity_date": 1594375003, "creation_date": 1594375003, "answer_id": 62831796, "question_id": 41012247, "link": "https://stackoverflow.com/questions/41012247/debugging-a-json-error-from-golang/62831796#62831796", "title": "Debugging a JSON error from Golang", "body": "<p>I found some solution:</p>\n<pre><code>if err := json.Unmarshal([]byte(data), &amp;myStruct); err != nil {\n    if jsonErr, ok := err.(*json.SyntaxError); ok {\n        problemPart := data[jsonErr.Offset-10 : jsonErr.Offset+10]\n        err = fmt.Errorf(&quot;%w ~ error near '%s' (offset %d)&quot;, err, problemPart, jsonErr.Offset)\n    }\n}\n</code></pre>\n<p>It will print something like</p>\n<pre><code>invalid character 'n' after object key:value pair ~ error near 'rence\\&quot;,&quot;numberOfBil' (offset 14557)\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6709, "favorite_count": 0, "accepted_answer_id": 41013458, "answer_count": 4, "score": 2, "last_activity_date": 1594375003, "creation_date": 1481097969, "last_edit_date": 1481098890, "question_id": 41012247, "link": "https://stackoverflow.com/questions/41012247/debugging-a-json-error-from-golang", "title": "Debugging a JSON error from Golang", "body": "<p>I'm fetching and decoding a large JSON response that has an error in it. Now I need to find <strong>where</strong> the error is! I <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">read about json.SyntaxError</a> but I am struggling to find out how to use it.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"text/template\"\n    \"time\"\n)\n\ntype Movie struct {\n    Title       string    `json:\"title\"`\n    PublishedAt time.Time `json:\"published_at\"`\n}\n\nfunc main() {\n    req, _ := http.NewRequest(\"GET\", \"https://s.natalian.org/2016-12-07/debugme2.json\", nil)\n    resp, err := http.DefaultClient.Do(req)\n\n    defer resp.Body.Close()\n    dec := json.NewDecoder(resp.Body)\n\n    _, err = dec.Token()\n    for dec.More() {\n        var m Movie\n        if err = dec.Decode(&amp;m); err != nil {\n            fmt.Println(err)\n            fmt.Println(\"Bad\", m)\n\n            // https://blog.golang.org/error-handling-and-go\n            if serr, ok := err.(*json.SyntaxError); ok {\n                fmt.Println(\"Syntax error\", serr)\n            }\n\n        } else {\n            fmt.Println(\"Good\", m)\n        }\n\n        tmpl := template.Must(template.New(\"test\").Parse(\"OUTPUT: {{ if .Title }}{{.Title}}{{ if .PublishedAt }} was published at {{.PublishedAt}} {{ end }}{{end}}\\n\"))\n        tmpl.Execute(os.Stdout, m)\n    }\n\n}\n</code></pre>\n\n<p>What am I missing? Any tools or strategies or suggestions would be much appreciated. My output currently looks like:</p>\n\n<pre><code>Good {foobar 2016-11-24 16:17:12 +0800 SGT}\nOUTPUT: foobar was published at 2016-11-24 16:17:12 +0800 SGT\nparsing time \"\"null\"\" as \"\"2006-01-02T15:04:05Z07:00\"\": cannot parse \"null\"\" as \"2006\"\nBad {barbar 0001-01-01 00:00:00 +0000 UTC}\nOUTPUT: barbar was published at 0001-01-01 00:00:00 +0000 UTC\nGood { 1999-12-24 16:11:12 +0200 +0200}\nOUTPUT:\nGood {Something else entirely 2000-01-24 16:11:12 +0200 +0200}\nOUTPUT: Something else entirely was published at 2000-01-24 16:11:12 +0200 +0200\n</code></pre>\n\n<p>But I need something like this in my stderr to <strong>better debug the issue</strong>:</p>\n\n<pre><code>Line 8: published_at is invalid\n</code></pre>\n\n<p>And maybe some context of the Title so I can tell the API backend team they have an error in their JSON response.</p>\n\n<p><strong>BONUS question</strong>: Furthermore I don't want to print the value <em>0001-01-01 00:00:00 +0000 UTC</em> as it's actually really empty. I don't actually mind it being missing.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "is_accepted": false, "score": 0, "last_activity_date": 1481087232, "creation_date": 1481087232, "answer_id": 41009815, "question_id": 41009376, "link": "https://stackoverflow.com/questions/41009376/go-get-golang-org-x-tools-go-gcimporter15-fails-on-undefined-identifiers/41009815#41009815", "title": "&quot;go get golang.org/x/tools/go/gcimporter15&quot; fails on undefined identifiers", "body": "<p>The <a href=\"https://godoc.org/golang.org/x/tools/go/gcimporter15\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/tools/go/gcimporter15</a> tells that the package <code>gcimporter</code> is deprecated and this package will be deleted in October 2017. And this new code should be used: <a href=\"https://golang.org/x/tools/go/gcexportdata\" rel=\"nofollow noreferrer\">golang.org/x/tools/go/gcexportdata</a> instead of <code>gcimporter</code> .</p>\n\n<p>So, what you have to do is:</p>\n\n<pre><code>$ go get godoc.org/golang.org/x/tools/go/gcexportdata\n</code></pre>\n\n<p><strong>PS:</strong> Tested within <code>Ubuntu 16.04 64bit</code> and <code>go version go1.6.2 linux/amd64</code> without any issues.</p>\n\n<p>Test:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    gcexportdata \"golang.org/x/tools/go/gcexportdata\"\n)\nfunc main() {\n    filename, path := gcexportdata.Find(\"fmt\", \"\")\n    fmt.Println(filename, path)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>/usr/lib/go-1.6/pkg/linux_amd64/fmt.a fmt\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3372, "user_id": 762649, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f21acc9d59af609a140703b8c2c2aca1?s=128&d=identicon&r=PG", "display_name": "sunil", "link": "https://stackoverflow.com/users/762649/sunil"}, "is_accepted": false, "score": 0, "last_activity_date": 1482895084, "creation_date": 1482895084, "answer_id": 41354918, "question_id": 41009376, "link": "https://stackoverflow.com/questions/41009376/go-get-golang-org-x-tools-go-gcimporter15-fails-on-undefined-identifiers/41354918#41354918", "title": "&quot;go get golang.org/x/tools/go/gcimporter15&quot; fails on undefined identifiers", "body": "<p>Its bad but seems there is a mismatch between the <code>gcimporter15</code> and <code>go-1.5</code>. I faced the same problem and looked at <code>go-1.5</code> code in file <code>src/go/constant/value.go</code> and there is no <code>ToFloat()</code> function in the <code>constant</code> package. </p>\n\n<p>As @nexus66 says, the <code>gcimporter</code> is deprecated. So, I don't expect them to fix this. If you are using this package directly, its better to move on to the recommended <code>gcexportdata</code> package. If you are using a third party library which is in turn using <code>gcimporter</code>, may be you should upgrade to <code>go-1.7</code>. That's what I did and things worked fine. </p>\n"}], "owner": {"reputation": 73, "user_id": 1914745, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/8908d789c305f93d58b776d6bcdb4369?s=128&d=identicon&r=PG", "display_name": "user1914745", "link": "https://stackoverflow.com/users/1914745/user1914745"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 778, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1482895084, "creation_date": 1481084622, "question_id": 41009376, "link": "https://stackoverflow.com/questions/41009376/go-get-golang-org-x-tools-go-gcimporter15-fails-on-undefined-identifiers", "title": "&quot;go get golang.org/x/tools/go/gcimporter15&quot; fails on undefined identifiers", "body": "<p>I'm trying to make a program dependent upon gcimporter15 for Go, and so I'm using the command \"go get golang.org/x/tools/go/gcimporter15\", but it fails with the error:</p>\n\n<pre><code># golang.org/x/tools/go/gcimporter15\n../../go/src/golang.org/x/tools/go/gcimporter15/bexport.go:557: undefined: constant.ToFloat\n../../go/src/golang.org/x/tools/go/gcimporter15/gcimporter.go:396: pkg.SetName undefined (type *types.Package has no field or method SetName)\n</code></pre>\n\n<p>That appears to me that there is an error within gcimporter itself, but that doesn't make sense that I would get this when it doesn't appear that others are. Why isn't it working?</p>\n\n<p>I'm using Go 1.5.3.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 6803922, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/148de7ec8289954fcd634b00556026d0?s=128&d=identicon&r=PG&f=1", "display_name": "Cam.phiefr", "link": "https://stackoverflow.com/users/6803922/cam-phiefr"}, "edited": false, "score": 0, "creation_date": 1481083851, "post_id": 41009125, "comment_id": 69226452, "body": "would that work with ` router.POST(&quot;/hello/:name&quot;, Hello)` ? If i&#39;m looking for raw speed which of the router you&#39;ve listed would you recommend?"}, {"owner": {"reputation": 1837, "user_id": 381849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d44bcf5700e4fcb934221db2dab496?s=128&d=identicon&r=PG", "display_name": "KAdot", "link": "https://stackoverflow.com/users/381849/kadot"}, "reply_to_user": {"reputation": 77, "user_id": 6803922, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/148de7ec8289954fcd634b00556026d0?s=128&d=identicon&r=PG&f=1", "display_name": "Cam.phiefr", "link": "https://stackoverflow.com/users/6803922/cam-phiefr"}, "edited": false, "score": 0, "creation_date": 1481084115, "post_id": 41009125, "comment_id": 69226532, "body": "@Cam.phiefr it would. httrouter is one of the most efficient routers, you can find benchmarks at <a href=\"https://github.com/julienschmidt/go-http-routing-benchmark\" rel=\"nofollow noreferrer\">github.com/julienschmidt/go-http-routing-benchmark</a>."}], "tags": [], "owner": {"reputation": 1837, "user_id": 381849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d44bcf5700e4fcb934221db2dab496?s=128&d=identicon&r=PG", "display_name": "KAdot", "link": "https://stackoverflow.com/users/381849/kadot"}, "is_accepted": true, "score": 4, "last_activity_date": 1481082798, "creation_date": 1481082798, "answer_id": 41009125, "question_id": 41008999, "link": "https://stackoverflow.com/questions/41008999/net-http-is-it-possible-to-have-http-handlefunc-custom-params/41009125#41009125", "title": "net/http : is it possible to have http.HandleFunc custom params?", "body": "<p>It's not possible with the default <code>Mux</code>, but you can use alternative routers like <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\">httprouter</a>, <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">Gorilla Mux</a> or <a href=\"https://github.com/pressly/chi\" rel=\"nofollow noreferrer\">chi</a>.</p>\n\n<p>Here is an example of <code>httprouter</code> usage:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/julienschmidt/httprouter\"\n    \"net/http\"\n)\n\nfunc Hello(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n    fmt.Fprintf(w, \"hello, %s!\\n\", ps.ByName(\"name\"))\n}\n\nfunc main() {\n    router := httprouter.New()\n    router.GET(\"/hello/:name\", Hello)\n    http.ListenAndServe(\":8080\", router)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 430, "user_id": 3309694, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/aa69ee948cf7614ccd0b035a24ab5b01?s=128&d=identicon&r=PG&f=1", "display_name": "Vallerious", "link": "https://stackoverflow.com/users/3309694/vallerious"}, "is_accepted": false, "score": 0, "last_activity_date": 1599223217, "last_edit_date": 1599223217, "creation_date": 1599222872, "answer_id": 63741307, "question_id": 41008999, "link": "https://stackoverflow.com/questions/41008999/net-http-is-it-possible-to-have-http-handlefunc-custom-params/63741307#63741307", "title": "net/http : is it possible to have http.HandleFunc custom params?", "body": "<p>You can define a handle function on <code>/</code> and then have custom parsing of the path, like splitting on <code>/</code> character.</p>\n<p><code>http.HandleFunc(&quot;/&quot;, dispatcher)</code></p>\n<p>In this way, your handler will accept everything and you can route the requests manually to the respective function. For example, PUT calls would expect some parameter after the resource (<code>/orders/2</code>)</p>\n<p><code>logs.Info(&quot;The URL that you are calling is: &quot; + req.URL.Path)</code></p>\n<p>Output: <code>The URL that you are calling is: /orders/2</code></p>\n<p>You can also do:\n<code>http.HandleFunc(&quot;/orders/&quot;, dispatcher)</code>\nto narrow down the scope of your handler. In this way, you can leave the validation of the resource portion of the path to Go http package.</p>\n"}], "owner": {"reputation": 77, "user_id": 6803922, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/148de7ec8289954fcd634b00556026d0?s=128&d=identicon&r=PG&f=1", "display_name": "Cam.phiefr", "link": "https://stackoverflow.com/users/6803922/cam-phiefr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1225, "favorite_count": 0, "accepted_answer_id": 41009125, "answer_count": 2, "score": 0, "last_activity_date": 1599223217, "creation_date": 1481081886, "question_id": 41008999, "link": "https://stackoverflow.com/questions/41008999/net-http-is-it-possible-to-have-http-handlefunc-custom-params", "title": "net/http : is it possible to have http.HandleFunc custom params?", "body": "<p>I'm trying to find a way to create special routes to that would allow post request to work with a params ( /url/:param ).</p>\n\n<p>I've tried something like this :</p>\n\n<p><code>http.HandleFunc(\"/myroute/:myparam\",myfunction)</code></p>\n\n<p>And i was hopping to be able to get the params as of the http-request in side \"myfunction\" with <code>req.Form</code> but it keeps on failing on me and i get 404'ed.</p>\n\n<p>I recognize it is something strange to ask as i could pass my params in the body of the function, but for ease of use/display i've been asked to be able to pregenerate a list of static \"routes\" on some preset so that it can be distributed as different urls + optional params instead of one url for everybody + params..</p>\n"}, {"tags": ["oop", "go", "plugins"], "comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 2, "creation_date": 1481083387, "post_id": 41008918, "comment_id": 69226342, "body": "Unfortunately at this time there is little/no support for dynamic shared library loading in Go.  This is likely what you would need to support the sort of functionality you describe.  (I&#39;ve tried extensively abusing the runtime to trick it into doing so and it&#39;s simply a no-go, for at least a couple of reasons.)    You might be able to play some games with running each module as a separate process started dynamically at app init time,  and coordinating them with IPC, but this doesn&#39;t sound like a great design to me..."}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1481087595, "post_id": 41008918, "comment_id": 69227539, "body": "You can try the approach that <a href=\"https://www.terraform.io/docs/internals/internal-plugins.html\" rel=\"nofollow noreferrer\">hashicorp has taken with terraform</a>. Each plugin is just a static binary, and the plugin and host communicate with RPC like a client/server."}, {"owner": {"reputation": 51, "user_id": 7219322, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/acd61f4c20b57cdbd2b3c7ea846ce574?s=128&d=identicon&r=PG&f=1", "display_name": "rum", "link": "https://stackoverflow.com/users/7219322/rum"}, "edited": false, "score": 0, "creation_date": 1481096729, "post_id": 41008918, "comment_id": 69231317, "body": "Thanks you! I will try RPC with my design."}, {"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1481098335, "post_id": 41008918, "comment_id": 69232023, "body": "How about embedding something like Lua? Your plugins can be written in Lua -- <a href=\"https://github.com/Shopify/go-lua\" rel=\"nofollow noreferrer\">github.com/Shopify/go-lua</a>"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 1, "last_activity_date": 1481114106, "creation_date": 1481114106, "answer_id": 41017648, "question_id": 41008918, "link": "https://stackoverflow.com/questions/41008918/plugin-programming-on-golang/41017648#41017648", "title": "Plugin programming on golang", "body": "<p>Go 1.8 has support for plugins: <a href=\"https://beta.golang.org/pkg/plugin/\" rel=\"nofollow noreferrer\">https://beta.golang.org/pkg/plugin/</a>. If you can wait a couple months you could use that (or just use the beta 1.8).</p>\n"}, {"tags": [], "owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "is_accepted": false, "score": 2, "last_activity_date": 1481203392, "last_edit_date": 1481203392, "creation_date": 1481188433, "answer_id": 41035663, "question_id": 41008918, "link": "https://stackoverflow.com/questions/41008918/plugin-programming-on-golang/41035663#41035663", "title": "Plugin programming on golang", "body": "<p>Go with it's interfaces is a good choice to build something pluggable. </p>\n\n<h3>Interfaces</h3>\n\n<p>Interface in Go is a way of types abstraction.</p>\n\n<blockquote>\n  <p>Interfaces in Go provide a way to specify the behavior of an object: if something can do this, then it can be used here. </p>\n</blockquote>\n\n<p>It means a simple but very powerful thing - you can use different composite literals as an interface type if they implement the interface. This is already a pluggable system and if are looking for something simple it is possible to build with minimal effort.</p>\n\n<h3>Simplest implementation</h3>\n\n<p>Let's say you have such a primitive architecture:</p>\n\n<pre><code>\u25be pluggable/       \n  \u25be app/           \n      pusher.go    \n  \u25be plugins/       \n      green_button.go   \n      plugin_interface.go\n      red_button.go   \n    main.go        \n</code></pre>\n\n<p><strong>plugins/plugin_interface.go</strong></p>\n\n<p>An interface which will be used as a type abstraction for plugins.</p>\n\n<pre><code>package plugins        \n\ntype Button interface {\n    Push()             \n}                     \n</code></pre>\n\n<p><strong>plugins/green_button.go</strong> </p>\n\n<p>Now it is possible to extend your application with plugins implement the interface.</p>\n\n<pre><code>package plugins              \n\nimport (                     \n    \"fmt\"                    \n)                            \n\ntype GreenButton struct {    \n    Msg string               \n}                            \n\nfunc (b GreenButton) Push() {\n    fmt.Println(b.Msg)       \n}                            \n</code></pre>\n\n<p><strong>plugins/red_button.go</strong></p>\n\n<p>One more plugin...</p>\n\n<pre><code>package plugins            \n\nimport (                   \n    \"fmt\"                  \n)                          \n\ntype RedButton struct {    \n    Err error              \n}                          \n\nfunc (b RedButton) Push() {\n    fmt.Println(b.Err)     \n}                          \n</code></pre>\n\n<p><strong>app/pusher.go</strong></p>\n\n<p>An interface type embedded in the composite literal. Any cl implementing the interface could be used in the <code>Pusher</code> instance. <code>Pusher</code> doesn't care about particular plugin implementation it just pushes. It is well abstracted and encapsulated. </p>\n\n<pre><code>package app                            \n\nimport (                               \n    \"github.com/I159/pluggable/plugins\"\n)                                      \n\ntype Pusher struct {                   \n    plugins.Button                     \n}                                      \n</code></pre>\n\n<p><strong>main.go</strong></p>\n\n<p>Usage of all the stuff.</p>\n\n<pre><code>package main                                                                \n\nimport (                                                                    \n    \"errors\"                                                                \n    \"github.com/I159/pluggable/app\"                                         \n    \"github.com/I159/pluggable/plugins\"                                     \n)                                                                           \n\nfunc main() {                                                               \n    alert_pusher := app.Pusher{plugins.RedButton{Err: errors.New(\"Alert!\")}}\n    success_pusher := app.Pusher{plugins.GreenButton{Msg: \"Well done!\"}}    \n\n    alert_pusher.Push()                                                     \n    success_pusher.Push()                                                   \n}                                                                           \n</code></pre>\n\n<p>You can add more sugar, for example one more level of isolation to use a single button configured to be a one or another particular implementation and so on.</p>\n\n<h3>Plugins as libraries</h3>\n\n<p>Same trick with plugin-libraries. A composite literals declared in a plugin-libraries must implement a plugin interface of the main application. But in this case you will need a register a function and a file with libs imports, so it already looks like a nano plugin framework.</p>\n"}], "owner": {"reputation": 51, "user_id": 7219322, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/acd61f4c20b57cdbd2b3c7ea846ce574?s=128&d=identicon&r=PG&f=1", "display_name": "rum", "link": "https://stackoverflow.com/users/7219322/rum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1179, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1481203392, "creation_date": 1481081338, "question_id": 41008918, "link": "https://stackoverflow.com/questions/41008918/plugin-programming-on-golang", "title": "Plugin programming on golang", "body": "<p>I am coding my project with golang. I want to design my project like plugin programming but I have confused with golang. My project have data analysis task, I purpose make a folder that contain modules analysis, if I have new modules after, I just need copy it to folder and main application will pass data to the new modules without modified.\nCan you help me? Thanks for watching!</p>\n"}, {"tags": [".net", "go"], "answers": [{"tags": [], "owner": {"reputation": 1837, "user_id": 381849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d44bcf5700e4fcb934221db2dab496?s=128&d=identicon&r=PG", "display_name": "KAdot", "link": "https://stackoverflow.com/users/381849/kadot"}, "is_accepted": true, "score": 9, "last_activity_date": 1528724974, "last_edit_date": 1528724974, "creation_date": 1481082389, "answer_id": 41009065, "question_id": 41008725, "link": "https://stackoverflow.com/questions/41008725/rfc2898derivebytes-vs-golang-pbkdf2/41009065#41009065", "title": "Rfc2898DeriveBytes vs golang pbkdf2", "body": "<p>.NET is using UTF-16 strings, so each character is represented by at least 2 bytes, while Go is using UTF-8 strings.</p>\n\n<p>C#:</p>\n\n<pre><code>Encoding.Unicode.GetBytes(\"47687\") // [52 0 55 0 54 0 56 0 55 0]\n</code></pre>\n\n<p>Go:</p>\n\n<pre><code>[]byte(\"47687\") // [52 55 54 56 55]\n</code></pre>\n\n<p>If you want to get the same results in your Go application as in C#, you'll have to convert Go strings to UTF-16 byte slices:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/sha1\"\n    b64 \"encoding/base64\"\n    \"encoding/binary\"\n    \"fmt\"\n    \"golang.org/x/crypto/pbkdf2\"\n    \"unicode/utf16\"\n)\n\nvar (\n    PasswordSecuritySalt       = \"47687\"\n    PasswordSecurityIterations = 1000\n    PasswordSecurityKeylen     = 32\n)\n\nfunc stringToUTF16Bytes(s string) []byte {\n    runes := utf16.Encode([]rune(s))\n    bytes := make([]byte, len(runes)*2)\n    for i, r := range runes {\n        binary.LittleEndian.PutUint16(bytes[i*2:], r)\n    }\n    return bytes\n}\n\nfunc HashPassword(str string) string {\n    hashedPassword := pbkdf2.Key(stringToUTF16Bytes(str), stringToUTF16Bytes(PasswordSecuritySalt), PasswordSecurityIterations, PasswordSecurityKeylen, sha1.New)\n    return b64.StdEncoding.EncodeToString(hashedPassword)\n}\n\nfunc main() {\n    fmt.Println(HashPassword(\"123456\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 894, "user_id": 1268455, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8fcbaee4853656da35c65b7171b8bb0c?s=128&d=identicon&r=PG", "display_name": "Tuan Hoang Anh", "link": "https://stackoverflow.com/users/1268455/tuan-hoang-anh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 745, "favorite_count": 2, "accepted_answer_id": 41009065, "answer_count": 1, "score": 8, "last_activity_date": 1528724974, "creation_date": 1481079826, "question_id": 41008725, "link": "https://stackoverflow.com/questions/41008725/rfc2898derivebytes-vs-golang-pbkdf2", "title": "Rfc2898DeriveBytes vs golang pbkdf2", "body": "<p>Here is my C# Rfc2898DeriveBytes </p>\n\n<pre><code>using System;\nusing System.Text;\nusing System.Security.Cryptography;\n\npublic class Program\n{\n    public static void Main()\n    {\n        byte[] saltBytes = Encoding.Unicode.GetBytes(\"47687\");\n        Console.WriteLine(Convert.ToBase64String(saltBytes));\n\n        byte[] passBytes = Encoding.Unicode.GetBytes(\"123456\");\n        Console.WriteLine(Convert.ToBase64String(passBytes));\n\n        Rfc2898DeriveBytes k1 = new Rfc2898DeriveBytes(passBytes, saltBytes, 1000);\n        byte[] hashbyte = k1.GetBytes(32);\n\n        Console.WriteLine(Convert.ToBase64String(hashbyte));\n    }\n}\n</code></pre>\n\n<p>Result is \nNAA3ADYAOAA3AA==\nMQAyADMANAA1ADYA\naOyDnGG22ebqGmMvY7zQwdT+UKF6hUUmAt2Uc0jj2io=</p>\n\n<p>My golang code is </p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/sha1\"\n    \"fmt\"\n    \"golang.org/x/crypto/pbkdf2\"\n    b64 \"encoding/base64\"\n)\n\nvar (\n    PasswordSecuritySalt       = \"47687\"\n    PasswordSecurityIterations = 1000\n    PasswordSecurityKeylen     = 32\n)\n\nfunc HashPassword(str string) string {\n    hashedPassword := pbkdf2.Key([]byte(str), []byte(PasswordSecuritySalt), PasswordSecurityIterations, PasswordSecurityKeylen, sha1.New)\n    return  b64.StdEncoding.EncodeToString(hashedPassword)\n}\n\nfunc main() {\n    password := \"123456\"\n    fmt.Println(PasswordSecuritySalt + \" \" + password)\n    fmt.Println(HashPassword(password))\n\n}\n</code></pre>\n\n<p>Result is \n47687 123456\nEVqb1dCe8p+iVEquNjJmHhSjruGATNQX73F6msXivM8=</p>\n\n<p>Why golang result hash password is different with C#. Please help me.</p>\n"}, {"tags": ["http", "go", "webserver", "gorilla"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1481064814, "post_id": 41005888, "comment_id": 69221339, "body": "You can also create your own middleware function and chain them together using something like alice."}], "answers": [{"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": true, "score": 2, "last_activity_date": 1481064253, "creation_date": 1481064253, "answer_id": 41006313, "question_id": 41005888, "link": "https://stackoverflow.com/questions/41005888/setting-callback-with-golang-gorilla-package/41006313#41006313", "title": "Setting callback with Golang Gorilla package", "body": "<p>gorilla/mux itself is just a router and dispatcher, which, although technically could do what you're asking, is not really what it's designed for.</p>\n\n<p>The \"idiomatic\" approach is to wrap your handler with middleware that decorates your handler with any additional functions, like one to check headers for some information on every call.</p>\n\n<p>Expanding on the gorilla/mux <a href=\"https://github.com/gorilla/mux#full-example\" rel=\"nofollow noreferrer\">full example</a>, you could do something like:</p>\n\n<pre><code>package main\n\nimport (\n        \"log\"\n        \"net/http\"\n\n        \"github.com/gorilla/mux\"\n)\n\nfunc HeaderCheckWrapper(requiredHeader string, original func(http.ResponseWriter, *http.Request)) func(http.ResponseWriter, *http.Request) {\n        return func(w http.ResponseWriter, r *http.Request) {\n                if foo, ok := r.Header[requiredHeader]; ok {\n                        // do whatever with the header value, and then call the original:\n                        log.Printf(\"Found header %q, with value %q\", requiredHeader, foo)\n                        original(w, r)\n                        return\n                }\n                // otherwise reject the request\n                w.WriteHeader(http.StatusPreconditionFailed)\n                w.Write([]byte(\"missing expected header \" + requiredHeader))\n        }\n}\n\nfunc YourHandler(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"Gorilla!\\n\"))\n}\n\nfunc main() {\n        r := mux.NewRouter()\n        // Routes consist of a path and a handler function.\n        r.HandleFunc(\"/\", HeaderCheckWrapper(\"X-Foo-Header\", YourHandler))\n\n        // Bind to a port and pass our router in\n        log.Fatal(http.ListenAndServe(\":8000\", r))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1481066871, "post_id": 41006686, "comment_id": 69222061, "body": "Nice improvement @squiguy"}, {"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "reply_to_user": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 1, "creation_date": 1481068874, "post_id": 41006686, "comment_id": 69222727, "body": "Thanks, I figured I should share an example."}], "tags": [], "owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "is_accepted": false, "score": 2, "last_activity_date": 1481066143, "creation_date": 1481066143, "answer_id": 41006686, "question_id": 41005888, "link": "https://stackoverflow.com/questions/41005888/setting-callback-with-golang-gorilla-package/41006686#41006686", "title": "Setting callback with Golang Gorilla package", "body": "<p>If you want to have a handler that can receive all requests in the router you can use <a href=\"https://github.com/justinas/alice\" rel=\"nofollow noreferrer\">alice</a> to chain your handlers together.</p>\n\n<p>This is a simple way to act on all incoming requests.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/justinas/alice\"\n)\n\nfunc MyMiddleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        if len(r.URL.Path) &gt; 1 {\n            http.Error(w, \"please only call index because this is a lame example\", http.StatusNotFound)\n            return\n        }\n        next.ServeHTTP(w, r)\n    })\n}\n\nfunc Handler(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello\"))\n}\n\nfunc main() {\n    r := mux.NewRouter()\n\n    r.HandleFunc(\"/\", Handler)\n    r.HandleFunc(\"/fail\", Handler)\n\n    chain := alice.New(MyMiddleware).Then(r)\n\n    http.ListenAndServe(\":8080\", chain)\n}\n</code></pre>\n"}], "owner": {"reputation": 711, "user_id": 3125693, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/a3872b84555f5d5abe102f041780200f?s=128&d=identicon&r=PG&f=1", "display_name": "user3125693", "link": "https://stackoverflow.com/users/3125693/user3125693"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 0, "accepted_answer_id": 41006313, "answer_count": 2, "score": 0, "last_activity_date": 1481066143, "creation_date": 1481062176, "question_id": 41005888, "link": "https://stackoverflow.com/questions/41005888/setting-callback-with-golang-gorilla-package", "title": "Setting callback with Golang Gorilla package", "body": "<p>Is there an easy way to set a callback function that is called on every HTTP request made to a gorilla/mux HTTP webserver? They don't seem to have a notion of setting a callback function in their docs.</p>\n\n<p>I wanted to check one of the headers for some information on every call to my server. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 491, "user_id": 4699030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PtpXlAvuawc/AAAAAAAAAAI/AAAAAAAABgA/eeoUql28GSs/photo.jpg?sz=128", "display_name": "Juan Carlos Garcia", "link": "https://stackoverflow.com/users/4699030/juan-carlos-garcia"}, "edited": false, "score": 2, "creation_date": 1481061260, "post_id": 41005605, "comment_id": 69219863, "body": "This is the list of the current available operators in Go <a href=\"https://golang.org/ref/spec#Operators\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Operators</a>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 2, "creation_date": 1481064448, "post_id": 41005605, "comment_id": 69221225, "body": "You could, if you really wanted to, implement a <code>Coalesce()</code> type function, but it might not be as clean as you&#39;d probably like. <a href=\"https://play.golang.org/p/vzN_4N7Z1N\" rel=\"nofollow noreferrer\">play.golang.org/p/vzN_4N7Z1N</a>"}, {"owner": {"reputation": 443, "user_id": 2713480, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DsM1A.jpg?s=128&g=1", "display_name": "kitteehh", "link": "https://stackoverflow.com/users/2713480/kitteehh"}, "edited": false, "score": 0, "creation_date": 1481065640, "post_id": 41005605, "comment_id": 69221603, "body": "Interesting idea! I suppose a function like that could easily break at runtime unless one uses reflection to make sure the passed in types are compatible."}], "tags": [], "owner": {"reputation": 491, "user_id": 4699030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PtpXlAvuawc/AAAAAAAAAAI/AAAAAAAABgA/eeoUql28GSs/photo.jpg?sz=128", "display_name": "Juan Carlos Garcia", "link": "https://stackoverflow.com/users/4699030/juan-carlos-garcia"}, "is_accepted": true, "score": 4, "last_activity_date": 1481061176, "creation_date": 1481061176, "answer_id": 41005605, "question_id": 41005398, "link": "https://stackoverflow.com/questions/41005398/golang-version-of-rubys-or-equals/41005605#41005605", "title": "golang version of ruby&#39;s or-equals ||=", "body": "<p>Your version is already the simplest, shortest and idiomatic way to do it.</p>\n"}], "owner": {"reputation": 443, "user_id": 2713480, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DsM1A.jpg?s=128&g=1", "display_name": "kitteehh", "link": "https://stackoverflow.com/users/2713480/kitteehh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2125, "favorite_count": 0, "accepted_answer_id": 41005605, "answer_count": 1, "score": 4, "last_activity_date": 1481061176, "creation_date": 1481060327, "question_id": 41005398, "link": "https://stackoverflow.com/questions/41005398/golang-version-of-rubys-or-equals", "title": "golang version of ruby&#39;s or-equals ||=", "body": "<p>Out of curiosity, what would be the idiomatic way to assign a variable if it's nil in go?</p>\n\n<p>I'm looking for something similar to ruby's <code>foo ||= bar</code></p>\n\n<p>Is there a shorter version of this? </p>\n\n<pre><code>if foo == nil{  \n  foo = bar\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "synchronization"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481056589, "post_id": 41004262, "comment_id": 69217465, "body": "I&#39;m not sure what you&#39;re asking, you your <code>send</code> goroutine has a different <code>sync.WaitGroup</code> than the one in <code>main()</code>, so there&#39;s no synchronization going on."}, {"owner": {"reputation": 75, "user_id": 4152662, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/lRg9j.jpg?s=128&g=1", "display_name": "rayimpr", "link": "https://stackoverflow.com/users/4152662/rayimpr"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481058327, "post_id": 41004262, "comment_id": 69218407, "body": "@JimB hey, sorry for the vague statement! I have updated. Actually I use sync here to do something like <code>.join()</code> in c++ thread. From the doc, channel can also do in this way. Is that proper to use sync?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481058517, "post_id": 41004262, "comment_id": 69218501, "body": "Yes, that&#39;s what WaitGroup is for; waiting on a group of goroutines. I don&#39;t understand the question of &quot;proper way to use sync&quot;, since that is an entire package, and you use what it provides it when you need it. This <i>isn&#39;t</i> the proper way to use a <code>sync.WaitGroup</code>, since the <code>wg</code> value in <code>main</code> is different than the <code>wg</code> value in <code>send</code>."}, {"owner": {"reputation": 75, "user_id": 4152662, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/lRg9j.jpg?s=128&g=1", "display_name": "rayimpr", "link": "https://stackoverflow.com/users/4152662/rayimpr"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481059137, "post_id": 41004262, "comment_id": 69218832, "body": "@JimB Thanks for pointing out the problem of the title, I have updated! For <code>wg</code>, I declare it as a global variable. I guess all the new thread executing <code>send()</code> should have the same <code>wg</code> like <code>main()</code>?  Also, if it is not the proper way to use <code>sync.WaitGroup</code>, what should I do to with the example? Thanks a lot!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481059609, "post_id": 41004262, "comment_id": 69219068, "body": "Your problem was solely the different <code>wg</code> values. This is exactly how it&#39;s shown in the <a href=\"https://golang.org/pkg/sync/#example_WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code> docs</a>."}, {"owner": {"reputation": 75, "user_id": 4152662, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/lRg9j.jpg?s=128&g=1", "display_name": "rayimpr", "link": "https://stackoverflow.com/users/4152662/rayimpr"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481060235, "post_id": 41004262, "comment_id": 69219357, "body": "@JimB Thanks! Now I declare the <code>wg</code> as a global variable. I guess it works."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1481067623, "post_id": 41004262, "comment_id": 69222324, "body": "Conventional practice is to pass a <code>*sync.WaitGroup</code> as a parameter to the goroutine. The package-level variable is adequate in this specific example."}, {"owner": {"reputation": 75, "user_id": 4152662, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/lRg9j.jpg?s=128&g=1", "display_name": "rayimpr", "link": "https://stackoverflow.com/users/4152662/rayimpr"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1481068803, "post_id": 41004262, "comment_id": 69222711, "body": "@MellowMarmot Got it! Thx"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1481087915, "post_id": 41004262, "comment_id": 69227655, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/19208725/example-for-sync-waitgroup-correct\">Example for sync.WaitGroup correct?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 4727361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4baa917778790183fbc868c28c8c33c?s=128&d=identicon&r=PG&f=1", "display_name": "mylk", "link": "https://stackoverflow.com/users/4727361/mylk"}, "is_accepted": false, "score": 0, "last_activity_date": 1481106465, "creation_date": 1481106465, "answer_id": 41014992, "question_id": 41004262, "link": "https://stackoverflow.com/questions/41004262/what-is-the-proper-way-to-use-golang-sync-waitgroup/41014992#41014992", "title": "what is the proper way to use golang sync.WaitGroup", "body": "<p>This example could help you</p>\n\n<pre><code>var wg sync.WaitGroup\ndone := make(chan bool)\n\nfor _, element := range slice {\n    wg.Add(1)\n    go func(elem interface{}) {\n        wg.Done()\n    }(element)\n}\n\ngo func() {\n    wg.Wait()\n    done &lt;- true\n}()\n\nfor {\n    select {\n    case done:\n        fmt.Println(\"All goroutines completed\")\n        close(done)\n        return\n    case time.After(time.Minute * 2):\n        fmt.Println(\"Timeout!\")\n        return\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 981, "user_id": 2443267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea0440cab20ca78515c96d1997faed44?s=128&d=identicon&r=PG&f=1", "display_name": "Krishna Gupta", "link": "https://stackoverflow.com/users/2443267/krishna-gupta"}, "edited": false, "score": 0, "creation_date": 1596896650, "post_id": 41017056, "comment_id": 111961044, "body": "The usage of range over channel is not appropriate, AFAIK. What if any of the routines has not been send to the channel yet - the loop will not run."}], "tags": [], "owner": {"reputation": 5445, "user_id": 504110, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FDSc7.jpg?s=128&g=1", "display_name": "Satachito", "link": "https://stackoverflow.com/users/504110/satachito"}, "is_accepted": false, "score": -1, "last_activity_date": 1481213098, "last_edit_date": 1481213098, "creation_date": 1481112458, "answer_id": 41017056, "question_id": 41004262, "link": "https://stackoverflow.com/questions/41004262/what-is-the-proper-way-to-use-golang-sync-waitgroup/41017056#41017056", "title": "what is the proper way to use golang sync.WaitGroup", "body": "<p>I don't know whether it is proper, but code below does the trick without using lower level 'sync'.</p>\n\n<pre><code>package main\n\nfunc send(a string, b string, c chan bool) {\n//  println( a, b )\n    c &lt;- true;\n}\n\nfunc\nmain() {\n\n    c := make( chan bool )\n\n    for i:=0; i&lt;50; i++ {\n        go send(\"1111\", \"2222\", c)\n    }\n\n    w := 0\n    for _ = range c {\n        w += 1\n        if w == 50 { break }\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 4152662, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/lRg9j.jpg?s=128&g=1", "display_name": "rayimpr", "link": "https://stackoverflow.com/users/4152662/rayimpr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1531, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1481213098, "creation_date": 1481056101, "last_edit_date": 1481058807, "question_id": 41004262, "link": "https://stackoverflow.com/questions/41004262/what-is-the-proper-way-to-use-golang-sync-waitgroup", "title": "what is the proper way to use golang sync.WaitGroup", "body": "<p>As mentioned in <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">golang doc</a>, sync is intent for low level library routines. </p>\n\n<blockquote>\n  <p>Other than the Once and WaitGroup types, most are intended for use by\n  low-level library routines. Higher-level synchronization is better\n  done via channels and communication.</p>\n</blockquote>\n\n<p>I am not quite understanding this statement and I use sync like the example below.<br>\nMy purpose is just to let main thread wait until all the other threads finish, similar to <code>.join()</code> in c++ thread library. </p>\n\n<p>Questions:<br>\n1: Is that proper to use sync like this? Or should I use channel instead of sync?<br>\n2: What is the difference between channel and sync?  </p>\n\n<pre><code>var wg sync.WaitGroup      // declare the variable globally\n\nfunc send(a string, b string){\n    defer wg.Done()\n    // do something\n}\nfunc main(){\n    for i:=0; i&lt;50; i++ {\n         wg.Add(1)              // add delta\n         go send(\"1111\", \"2222\")\n    }\n    wg.Wait()                  // wait until wg becomes 0\n}\n</code></pre>\n\n<p>Any suggestions are appreciate! Thanks!</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481060884, "post_id": 41004102, "comment_id": 69219669, "body": "<code>golang_org&#47;x</code> is vendored in the go source. Make sure your GOROOT is complete and at the same version as your go binaries."}, {"owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481064882, "post_id": 41004102, "comment_id": 69221360, "body": "I just uninstalled / reinstalled Go, as per <a href=\"https://golang.org/doc/install#install\" rel=\"nofollow noreferrer\">golang.org/doc/install#install</a>: 1) deleted /usr/local/go, 2) deleted /etc/paths.d/go, 3) removed /usr/local/go from path.  Then reinstalled using the standard MacOS package from: <a href=\"https://golang.org/doc/install?download=go1.7.4.darwin-amd64.pkg\" rel=\"nofollow noreferrer\">golang.org/doc/install?download=go1.7.4.darwin-amd64.pkg</a>.  There is no &quot;golang_org&quot; directory anywhere in the /usr/local/go or any subdirs...  I&#39;m not sure how to &quot;make sure GOROOT is complete&quot; other than this?"}, {"owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481065821, "post_id": 41004102, "comment_id": 69221688, "body": "Correction to above -  The only &quot;golang_org&quot; directory is at &quot;/usr/local/go/src/vendor/golang_org&quot;... which is not the path the error continues to call out as per my original post."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481066187, "post_id": 41004102, "comment_id": 69221817, "body": "That is the correct path where it <i>should</i> resolve the <code>golang_org&#47;x&#47;net&#47;route</code> package. Do you have the latest versions of <code>golang.org&#47;x&#47;tools&#47;cmd&#47;gorename</code> and <code>golang.org&#47;x&#47;tools&#47;cmd&#47;guru</code> installed?"}, {"owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481067529, "post_id": 41004102, "comment_id": 69222289, "body": "That looks to have helped.  Thanks Jim!  Question: when I update Go, is there any expeditious way to also update all the golang.org/x/... contents, other than repeated &quot;go get -u &quot; calls for each package?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481067862, "post_id": 41004102, "comment_id": 69222407, "body": "Nope. Those are separate tools with separate upgrade cycles."}], "owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1228, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1481055513, "creation_date": 1481055513, "question_id": 41004102, "link": "https://stackoverflow.com/questions/41004102/vscode-symbol-rename-not-working-with-go", "title": "VSCode Symbol Rename not working with Go", "body": "<p>Whenever I attempt to use \"Rename Symbol\" in VSCode while editing a Go project, it fails.  Based on the error messages, it looks like it's only using GOROOT, and ignoring everything under GOPATH.  </p>\n\n<p>When I first tried using it, it gave me the following error:   </p>\n\n<blockquote>\n  <p>Cannot rename due to errors:\n  /usr/local/go/src/net/interface_bsd.go:12:2: could not import\n  golang_org/x/net/route (cannot find package \"golang_org/x/net/route\"\n  in any of: /usr/local/go/src/golang_org/x/net/route (from $GOROOT).</p>\n</blockquote>\n\n<p>This package was present under GOPATH.  I copied the entire \"golang.org\" directory to GOROOT/src, and renamed to \"golang_org\".  That eliminated that error, but now I'm getting errors regarding my own project's packages \"not found\".   </p>\n\n<p>Everything else in my GO development system and VS Code is working OK... auto reformat on save, errors, Intellisense, etc. </p>\n\n<p>go env:  </p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/james/Dropbox/Development/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -gno-record-gcc-switches -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>System &amp; Editor:  </p>\n\n<pre><code>MacOS 10.10.5\ngo version go1.7.4 darwin/amd64\nVSCode 1.7.2\n</code></pre>\n\n<p>VS Code Extensions:  </p>\n\n<pre><code>https://marketplace.visualstudio.com/items?itemName=lukehoban.Go (0.6.51)  \nDash 1.1.2\n</code></pre>\n"}, {"tags": ["json", "http", "go", "concurrency", "mux"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481050635, "post_id": 41002704, "comment_id": 69214345, "body": "You&#39;re sending all clients the same <code>globalJsonObject</code>. Why wouldn&#39;t they all receive the same response?"}, {"owner": {"reputation": 188, "user_id": 2776324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaf311ba7e3ff7977a6d1c9de183c9cd?s=128&d=identicon&r=PG", "display_name": "JoeriV", "link": "https://stackoverflow.com/users/2776324/joeriv"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481050891, "post_id": 41002704, "comment_id": 69214466, "body": "Good point. But let&#39;s say i would pass this object into the method somehow. How can i distinct between the response writers, so it correspondents to the correct requesting client?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481051189, "post_id": 41002704, "comment_id": 69214618, "body": "I don&#39;t understand. You don&#39;t need to distinguish between anything, because there&#39;s only 1 ResponseWriter in the call to getResponses. The RepsonseWriter should always be paired with its request."}, {"owner": {"reputation": 188, "user_id": 2776324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaf311ba7e3ff7977a6d1c9de183c9cd?s=128&d=identicon&r=PG", "display_name": "JoeriV", "link": "https://stackoverflow.com/users/2776324/joeriv"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481055022, "post_id": 41002704, "comment_id": 69216655, "body": "You were completely right! The global variable was just overriding the previous requests values! Thanks a lot!"}], "owner": {"reputation": 188, "user_id": 2776324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaf311ba7e3ff7977a6d1c9de183c9cd?s=128&d=identicon&r=PG", "display_name": "JoeriV", "link": "https://stackoverflow.com/users/2776324/joeriv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1481050316, "creation_date": 1481050316, "last_edit_date": 1495539958, "question_id": 41002704, "link": "https://stackoverflow.com/questions/41002704/golang-serves-mixed-responses", "title": "Golang serves mixed responses", "body": "<p>I'm writing an REST API in Go following this <a href=\"http://thenewstack.io/make-a-restful-json-api-go/\" rel=\"nofollow noreferrer\">example</a> as a basis.</p>\n\n<p>Now the issue i'm having is while doing multiple simultaneous requests to the GET route, it serves the first result to all pending clients. Instead of only sending the response to the requesting client.</p>\n\n<p>I've been searching for hours and trying everything i could think of. <a href=\"https://stackoverflow.com/questions/25721084/using-golang-channels-to-handle-http-requests\">This</a> is the only post i found that looked like my issue, but didn't solve mine. It resulted in a incomplete json response..</p>\n\n<p>The handle that's being called from the GET route:</p>\n\n<pre><code>func Index(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n\n    //some variable declaration here\n\n    getResponses(w,...)\n}\n</code></pre>\n\n<p>The getResponses method:</p>\n\n<pre><code>func getResponses(w http.ResponseWriter, ...) {\n    responses := 0\n    totalRequests = 0\n    var completeChannel = make(chan string, 1)\n    start = time.Now()\n\n    go func() {\n        totalRequests += 1\n        //some method()\n\n        responses += 1\n        fmt.Println(\"method done\")\n        routineDone(responses, completeChannel)\n    }()\n\n    go func() {\n        totalRequests += 1\n        //some method()\n\n        responses += 1\n        fmt.Println(\"method done\")\n        routineDone(responses, completeChannel)\n    }()\n\n\n\n    select {\n    case r := &lt;-completeChannel:\n        fmt.Println(r)\n        sendResponse(w)\n    case &lt;-time.After(time.Second * 10):\n        sendResponse(w)\n    }\n}\n\nfunc routineDone(responses int, completeChannel chan string) {\n    if totalRequests &gt; 0 {\n        fmt.Printf(\"completed %d of %s requests. duration: %s \\n\", responses, strconv.Itoa(totalRequests), time.Since(start))\n    }\n\n    if responses == totalRequests &amp;&amp; totalRequests != 0 {\n        completeChannel &lt;- \"DONE\"\n    }\n}\n\nfunc sendResponse(w http.ResponseWriter) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    w.WriteHeader(http.StatusOK)\n    if err := json.NewEncoder(w).Encode(globalJsonObject); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481049643, "post_id": 41002508, "comment_id": 69213823, "body": "No data structures in Go are safe for concurrent reads and writes."}, {"owner": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481049765, "post_id": 41002508, "comment_id": 69213893, "body": "What would be the worst thing that could happen? the memory can&#39;t physically be read and written to at the same time, so my instincts tell me the content of the bytes should be safe, although you couldn&#39;t guarantee that the whole array is completely updated"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481049932, "post_id": 41002508, "comment_id": 69213970, "body": "Anything could happen. There are no benign data races: <a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">software.intel.com/en-us/blogs/2013/01/06/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "edited": false, "score": 0, "creation_date": 1481050561, "post_id": 41002681, "comment_id": 69214307, "body": "The problem is that i need to do the write part many times a second, and mutexes take extra time and processing power. i know how to use them, but they are slow... As the data is only a array of byte, and i don&#39;t see any reason whatsoever for the compiler to generate code that partially writes a single byte I can&#39;t see any possible problem with it (although I could be wrong)"}, {"owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "reply_to_user": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "edited": false, "score": 0, "creation_date": 1481051106, "post_id": 41002681, "comment_id": 69214584, "body": "Check here: <a href=\"https://golang.org/doc/faq#atomic_maps\" rel=\"nofollow noreferrer\">golang.org/doc/faq#atomic_maps</a> I would be concerned about that part: ...This was not an easy decision, however, since it means uncontrolled map access can crash the program...&quot;"}, {"owner": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "edited": false, "score": 0, "creation_date": 1481051350, "post_id": 41002681, "comment_id": 69214714, "body": "I&#39;ve read up on the issue a bit more, and found this which explains a serious problem that could occur: <a href=\"https://www.reddit.com/r/programming/comments/19rtbn/benign_data_races_what_could_possibly_go_wrong/c8qwuuc/\" rel=\"nofollow noreferrer\">reddit.com/r/programming/comments/19rtbn/&hellip;</a> . Thanks for taking your time to help me"}], "tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": true, "score": 2, "last_activity_date": 1481050222, "creation_date": 1481050222, "answer_id": 41002681, "question_id": 41002508, "link": "https://stackoverflow.com/questions/41002508/is-it-safe-to-read-from-and-write-to-an-array-at-the-same-time-go/41002681#41002681", "title": "Is it safe to read from and write to an array at the same time Go", "body": "<p>@Pownyan, no, not safe, as mentioned by JimB in the comments. You need mutex locks to make this safe: <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sync/#Mutex</a></p>\n\n<p>Example: <a href=\"https://gobyexample.com/mutexes\" rel=\"nofollow noreferrer\">https://gobyexample.com/mutexes</a></p>\n"}, {"tags": [], "owner": {"reputation": 3608, "user_id": 3872951, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/b91699177225625641983d04e41e6403?s=128&d=identicon&r=PG&f=1", "display_name": "Renjith Thankachan", "link": "https://stackoverflow.com/users/3872951/renjith-thankachan"}, "is_accepted": false, "score": 0, "last_activity_date": 1481050232, "creation_date": 1481050232, "answer_id": 41002686, "question_id": 41002508, "link": "https://stackoverflow.com/questions/41002508/is-it-safe-to-read-from-and-write-to-an-array-at-the-same-time-go/41002686#41002686", "title": "Is it safe to read from and write to an array at the same time Go", "body": "<p>No, its not safe, you will need to use <a href=\"https://godoc.org/sync\" rel=\"nofollow noreferrer\">sync</a> package Mutex or <code>Waitgroup</code> depends on the type of the solution flow, i recommend <code>Mutex</code> since it is cheaper than other <code>channel</code> based solutions.</p>\n\n<p>please check the example <a href=\"https://gobyexample.com/mutexes\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 476, "user_id": 1235577, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/9e26e029aeb67386a54fff5db023348b?s=128&d=identicon&r=PG", "display_name": "Pownyan", "link": "https://stackoverflow.com/users/1235577/pownyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 41002681, "answer_count": 2, "score": 0, "last_activity_date": 1481050232, "creation_date": 1481049589, "last_edit_date": 1481049651, "question_id": 41002508, "link": "https://stackoverflow.com/questions/41002508/is-it-safe-to-read-from-and-write-to-an-array-at-the-same-time-go", "title": "Is it safe to read from and write to an array at the same time Go", "body": "<p>Would this be safe to use? it doesnt matter if the read routine reads a partially updated array, but i need it to have all values intact. All 3 routines run in a loop</p>\n\n<pre><code>var arr [100]byte\n\ngo ReadFrom(arr)\ngo ReadFrom(arr)\ngo WriteTo(arr)\n</code></pre>\n"}, {"tags": ["go", "dependencies", "lang"], "comments": [{"owner": {"reputation": 6770, "user_id": 3658660, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5b40f4e2bead9eca6951da110a3c84e7?s=128&d=identicon&r=PG&f=1", "display_name": "hlscalon", "link": "https://stackoverflow.com/users/3658660/hlscalon"}, "edited": false, "score": 0, "creation_date": 1481048058, "post_id": 41001984, "comment_id": 69213052, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/13967470/is-it-possible-to-use-the-go-compiler-to-distribute-a-executable-file-for-other\">Is it possible to use the Go compiler to distribute a executable file for other os?</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1481048350, "post_id": 41001984, "comment_id": 69213192, "body": "You don&#39;t need Go installed to run a Go binary. See the <a href=\"https://golang.org/pkg/time/#LoadLocation\" rel=\"nofollow noreferrer\">time.LoadLocation</a> docs about the zoneinfo.zip file."}], "answers": [{"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": true, "score": 0, "last_activity_date": 1481048222, "last_edit_date": 1481048222, "creation_date": 1481047882, "answer_id": 41002073, "question_id": 41001984, "link": "https://stackoverflow.com/questions/41001984/go-language-dependencies-using-build/41002073#41002073", "title": "GO Language Dependencies using build", "body": "<p>Without a fuller example of your code, it's hard to answer the specific issue, but what I do to generate standalone binaries is:</p>\n\n<pre><code> CGO_ENABLED=0 go build -v -a -ldflags '-s -w' ./...\n</code></pre>\n\n<p>Which builds a static binary without libc dependencies at least... It seems the zoneinfo.zip dependency wouldn't be covered by that.  </p>\n\n<p>The zoneinfo.zip file is not unique to Go... Go expects it to be installed on the system.  Here is the code that scans system folders for that file: <a href=\"https://golang.org/src/time/zoneinfo_unix.go#L31\" rel=\"nofollow noreferrer\">https://golang.org/src/time/zoneinfo_unix.go#L31</a></p>\n\n<p>At time of writing:</p>\n\n<pre><code>var zoneDirs = []string{\n    \"/usr/share/zoneinfo/\",\n    \"/usr/share/lib/zoneinfo/\",\n    \"/usr/lib/locale/TZ/\",\n    runtime.GOROOT() + \"/lib/time/zoneinfo.zip\",\n}\n</code></pre>\n"}], "owner": {"reputation": 1745, "user_id": 3888307, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/65d6a22ea2fb9fb7a3d78bd57b9d71ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3888307", "link": "https://stackoverflow.com/users/3888307/user3888307"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 424, "favorite_count": 0, "accepted_answer_id": 41002073, "answer_count": 1, "score": 0, "last_activity_date": 1481048222, "creation_date": 1481047530, "question_id": 41001984, "link": "https://stackoverflow.com/questions/41001984/go-language-dependencies-using-build", "title": "GO Language Dependencies using build", "body": "<p>I don't think I'm the only one that might be confused by this.</p>\n\n<p>I have a very simple Go Program, the only dependencies are.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"time\"\n   )\n</code></pre>\n\n<p>I used \"go build myprogram.go\" , and get a binary that runs fine (since I have GO installed)</p>\n\n<p>However, if someone else does not have GO installed they seem to get errors.</p>\n\n<p>For Example: </p>\n\n<pre><code>open c:\\go\\lib\\time\\zoneinfo.zip: The system cannot find the path specified.\npanic: time: missing Location in call to Time.In\n</code></pre>\n\n<p>What do I need to do to include third party libraries in the build ?</p>\n\n<p>I'd like to generate a Binary that will run on any Platform without worrying about dependencies</p>\n"}, {"tags": ["go", "channel"], "answers": [{"comments": [{"owner": {"reputation": 326, "user_id": 3316338, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/224f29da9f6daeb1de2edf6eb411753d?s=128&d=identicon&r=PG&f=1", "display_name": "Arno", "link": "https://stackoverflow.com/users/3316338/arno"}, "edited": false, "score": 0, "creation_date": 1481042347, "post_id": 41000212, "comment_id": 69209540, "body": "even more questions :D   but hopefully I&#39;ll figure out it on my own, thank you!"}, {"owner": {"reputation": 3927, "user_id": 1369136, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2b6b7bf248c0afdabeec79aa9c624cd9?s=128&d=identicon&r=PG", "display_name": "Jinsong Li", "link": "https://stackoverflow.com/users/1369136/jinsong-li"}, "reply_to_user": {"reputation": 326, "user_id": 3316338, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/224f29da9f6daeb1de2edf6eb411753d?s=128&d=identicon&r=PG&f=1", "display_name": "Arno", "link": "https://stackoverflow.com/users/3316338/arno"}, "edited": false, "score": 0, "creation_date": 1481135345, "post_id": 41000212, "comment_id": 69256610, "body": "@Arno, read this post <a href=\"http://stackoverflow.com/questions/18660533/why-using-unbuffered-channel-in-the-the-same-goroutine-gives-a-deadlock\" title=\"why using unbuffered channel in the the same goroutine gives a deadlock\">stackoverflow.com/questions/18660533/&hellip;</a> for the explanations :)"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 7, "last_activity_date": 1481041704, "creation_date": 1481041704, "answer_id": 41000212, "question_id": 41000161, "link": "https://stackoverflow.com/questions/41000161/non-blocking-channel-operations-in-go-send/41000212#41000212", "title": "Non-blocking channel operations in go. Send?", "body": "<blockquote>\n  <p>why in the second select does it trigger the default clause?</p>\n</blockquote>\n\n<p>Because the channel is unbuffered and there is no other go routine blocked on receiving.</p>\n\n<blockquote>\n  <p>how can I trigger the case messages &lt;- msg: clause?</p>\n</blockquote>\n\n<p>You can either:</p>\n\n<ol>\n<li><p>Make <code>messages</code> buffered</p>\n\n<pre><code>messages := make(chan string, 1)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/b1aO6N-dYf\" rel=\"noreferrer\">https://play.golang.org/p/b1aO6N-dYf</a></p></li>\n<li><p>Create another go routine that is blocked on receiving</p>\n\n<pre><code>go func() {\n    fmt.Println(\"Received from other go routine\", &lt;-messages)\n}()\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Z7e1ZcO3C5\" rel=\"noreferrer\">https://play.golang.org/p/Z7e1ZcO3C5</a></p></li>\n</ol>\n"}], "owner": {"reputation": 326, "user_id": 3316338, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/224f29da9f6daeb1de2edf6eb411753d?s=128&d=identicon&r=PG&f=1", "display_name": "Arno", "link": "https://stackoverflow.com/users/3316338/arno"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5285, "favorite_count": 0, "accepted_answer_id": 41000212, "answer_count": 1, "score": 3, "last_activity_date": 1481042055, "creation_date": 1481041513, "last_edit_date": 1481042055, "question_id": 41000161, "link": "https://stackoverflow.com/questions/41000161/non-blocking-channel-operations-in-go-send", "title": "Non-blocking channel operations in go. Send?", "body": "<p>I'm going through <a href=\"https://gobyexample.com/non-blocking-channel-operations\" rel=\"nofollow noreferrer\">Go by Example: Non-Blocking Channel Operations</a></p>\n\n<p>As far as I understand, the first <code>select</code> is triggering the <code>default</code> case because there are nothing in the <code>messages</code> channel, and if the <code>default</code> case didn't exist, we would receive a <code>fatal error: all goroutines are asleep - deadlock!</code> error, right?  </p>\n\n<p>Well, I cannot figure out how can I trigger the second <code>select</code>, specifically trigger the  <code>case messages &lt;- msg:</code></p>\n\n<p>As I thought, it should work opposite to the receive. So if there's a buffer for 2 messages and we send the 3rd message to the channel, it would trigger the <code>default</code> clause, but the <code>messages</code> channel is empty, so why in the second select does it trigger the <code>default</code> clause? And how can I trigger the <code>case messages &lt;- msg:</code> clause?</p>\n"}, {"tags": ["mongodb", "performance", "go", "mgo"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1481044140, "post_id": 40999637, "comment_id": 69210754, "body": "Do you have an index on <code>requests.active</code>?"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1481044194, "post_id": 40999637, "comment_id": 69210799, "body": "what does the query plan look like? (<code>db.collection.find( { $query: {}, $explain: 1 } )</code>)"}], "answers": [{"comments": [{"owner": {"reputation": 7606, "user_id": 180253, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/df46030788b7cc95cadb9778a2b9e7dd?s=128&d=identicon&r=PG", "display_name": "TheJediCowboy", "link": "https://stackoverflow.com/users/180253/thejedicowboy"}, "edited": false, "score": 0, "creation_date": 1481045391, "post_id": 41000876, "comment_id": 69211609, "body": "This cut down the average time to ~75ms :) Thanks for pointing this out, I had a feeling I was doing something severely wrong."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1501599656, "post_id": 41000876, "comment_id": 77843741, "body": "This even doesn&#39;t work in stressful apps: <a href=\"https://github.com/go-mgo/mgo/issues/473\" rel=\"nofollow noreferrer\">github.com/go-mgo/mgo/issues/473</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 13, "last_activity_date": 1481075109, "last_edit_date": 1481075109, "creation_date": 1481043708, "answer_id": 41000876, "question_id": 40999637, "link": "https://stackoverflow.com/questions/40999637/mgo-query-performance-seems-consistently-slow-500-650ms/41000876#41000876", "title": "mgo - query performance seems consistently slow (500-650ms)", "body": "<blockquote>\n  <p>.. is there anything obvious that would suggest why my queriers are averaging 500-650ms?</p>\n</blockquote>\n\n<p>Yes, there is. You are calling <a href=\"https://godoc.org/gopkg.in/mgo.v2#Dial\" rel=\"noreferrer\"><code>mgo.Dial()</code></a> before executing each query. <code>mgo.Dial()</code> has to connect to the MongoDB server every time, which you close right after the query. The connection may very likely take hundreds of milliseconds to estabilish, including authentication, allocating resources (both at server and client side), etc. This is very wasteful.</p>\n\n<blockquote>\n  <p><strong>This method is generally called just once for a given cluster.</strong> Further sessions to the same cluster are then established using the New or Copy methods on the obtained session. This will make them share the underlying cluster, and manage the pool of connections appropriately.</p>\n</blockquote>\n\n<p>Create a global session variable, connect on startup <em>once</em> (using e.g. a package <code>init()</code> function), and use that session (or a copy / clone of it, obtained by <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Copy\" rel=\"noreferrer\"><code>Session.Copy()</code></a> or <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Clone\" rel=\"noreferrer\"><code>Session.Clone()</code></a>).\nFor example:</p>\n\n<pre><code>var session *mgo.Session\nvar info *db.Inf // Use your type here\n\nfunc init() {\n    var err error\n    if info, err = db.Info(); err != nil {\n        log.Fatal(err)\n    }\n    if session, err = mgo.Dial(info.ConnectionString()); err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc (r userRepo) GetUserByID(id string) (User, error) {\n    sess := session.Clone()\n    defer sess.Close()\n\n    // Now we use sess to execute the query:\n    var user User\n    c := sess.DB(info.Db()).C(\"users\")\n    // Rest of the method is unchanged...\n}\n</code></pre>\n"}], "owner": {"reputation": 7606, "user_id": 180253, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/df46030788b7cc95cadb9778a2b9e7dd?s=128&d=identicon&r=PG", "display_name": "TheJediCowboy", "link": "https://stackoverflow.com/users/180253/thejedicowboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2329, "favorite_count": 2, "accepted_answer_id": 41000876, "answer_count": 1, "score": 5, "last_activity_date": 1481075109, "creation_date": 1481039973, "last_edit_date": 1481045776, "question_id": 40999637, "link": "https://stackoverflow.com/questions/40999637/mgo-query-performance-seems-consistently-slow-500-650ms", "title": "mgo - query performance seems consistently slow (500-650ms)", "body": "<p>My data layer uses Mongo aggregation a decent amount, and on average, queries are taking 500-650ms to return. I am using <code>mgo</code>.</p>\n\n<p>A sample query function is shown below which represents what most of my queries look like.</p>\n\n<pre><code>func (r userRepo) GetUserByID(id string) (User, error) {\n    info, err := db.Info()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    session, err := mgo.Dial(info.ConnectionString())\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer session.Close()\n\n    var user User\n    c := session.DB(info.Db()).C(\"users\")\n    o1 := bson.M{\"$match\": bson.M{\"_id\": id}}\n    o2 := bson.M{\"$project\": bson.M{\n        \"first\":           \"$first\",\n        \"last\":            \"$last\",\n        \"email\":           \"$email\",\n        \"fb_id\":           \"$fb_id\",\n        \"groups\":          \"$groups\",\n        \"fulfillments\":    \"$fulfillments\",\n        \"denied_requests\": \"$denied_requests\",\n        \"invites\":         \"$invites\",\n        \"requests\": bson.M{\n            \"$filter\": bson.M{\n                \"input\": \"$requests\",\n                \"as\":    \"item\",\n                \"cond\": bson.M{\n                    \"$eq\": []interface{}{\"$$item.active\", true},\n                },\n            },\n        },\n    }}\n    pipeline := []bson.M{o1, o2}\n    err = c.Pipe(pipeline).One(&amp;user)\n    if err != nil {\n        return user, err\n    }\n    return user, nil\n}\n</code></pre>\n\n<p>The <code>user</code> struct I have looks like the following..</p>\n\n<pre><code>type User struct {\n    ID             string        `json:\"id\" bson:\"_id,omitempty\"`\n    First          string        `json:\"first\" bson:\"first\"`\n    Last           string        `json:\"last\" bson:\"last\"`\n    Email          string        `json:\"email\" bson:\"email\"`\n    FacebookID     string        `json:\"facebook_id\" bson:\"fb_id,omitempty\"`\n    Groups         []UserGroup   `json:\"groups\" bson:\"groups\"`\n    Requests       []Request     `json:\"requests\" bson:\"requests\"`\n    Fulfillments   []Fulfillment `json:\"fulfillments\" bson:\"fulfillments\"`\n    Invites        []GroupInvite `json:\"invites\" bson:\"invites\"`\n    DeniedRequests []string      `json:\"denied_requests\" bson:\"denied_requests\"`\n}\n</code></pre>\n\n<p>Based on what I have provided, is there anything obvious that would suggest why my queries are averaging 500-650ms?</p>\n\n<p>I know that I am probably swallowing a bit of a performance hit by using aggregation pipeline, but I wouldn't expect it to be this bad.</p>\n"}, {"tags": ["go", "transactions", "redis"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481040297, "post_id": 40999446, "comment_id": 69208100, "body": "Transactions in that package are call <a href=\"https://godoc.org/gopkg.in/redis.v5#Tx\" rel=\"nofollow noreferrer\">Tx</a>"}, {"owner": {"reputation": 365, "user_id": 2130607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6423be6ad9f861ddba9f1f1016cf2b4?s=128&d=identicon&r=PG", "display_name": "Kebeng", "link": "https://stackoverflow.com/users/2130607/kebeng"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481040402, "post_id": 40999446, "comment_id": 69208167, "body": "i know that. but how to create tx object? i didn&#39;t find any function that return tx"}], "answers": [{"comments": [{"owner": {"reputation": 365, "user_id": 2130607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6423be6ad9f861ddba9f1f1016cf2b4?s=128&d=identicon&r=PG", "display_name": "Kebeng", "link": "https://stackoverflow.com/users/2130607/kebeng"}, "edited": false, "score": 0, "creation_date": 1481041515, "post_id": 41000054, "comment_id": 69208941, "body": "wow i didn&#39;t see that in the docs.  Tx is a param in anonymous function inside <code>Watch</code> function. that&#39;s why i miss it. thanks man."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 10, "last_activity_date": 1481052762, "last_edit_date": 1481052762, "creation_date": 1481041224, "answer_id": 41000054, "question_id": 40999446, "link": "https://stackoverflow.com/questions/40999446/how-to-create-redis-transaction-in-go-using-go-redis-redis-package/41000054#41000054", "title": "How to create Redis Transaction in Go using go-redis/redis package?", "body": "<p>You get a <a href=\"https://godoc.org/gopkg.in/redis.v5#Tx\" rel=\"noreferrer\"><code>Tx</code></a> value for a transaction when you use <a href=\"https://godoc.org/gopkg.in/redis.v5#Client.Watch\" rel=\"noreferrer\"><code>Client.Watch</code></a></p>\n\n<pre><code>err := client.Watch(func(tx *redis.Tx) error {\n    n, err := tx.Get(key).Int64()\n    if err != nil &amp;&amp; err != redis.Nil {\n        return err\n    }\n\n    _, err = tx.Pipelined(func(pipe *redis.Pipeline) error {\n        pipe.Set(key, strconv.FormatInt(n+1, 10), 0)\n        return nil\n    })\n    return err\n}, key)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 393, "user_id": 3129465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8730f6cd8b8f04ae64d7e262d14310cf?s=128&d=identicon&r=PG&f=1", "display_name": "Brachi", "link": "https://stackoverflow.com/users/3129465/brachi"}, "is_accepted": false, "score": 4, "last_activity_date": 1580807645, "last_edit_date": 1580807645, "creation_date": 1580222320, "answer_id": 59951133, "question_id": 40999446, "link": "https://stackoverflow.com/questions/40999446/how-to-create-redis-transaction-in-go-using-go-redis-redis-package/59951133#59951133", "title": "How to create Redis Transaction in Go using go-redis/redis package?", "body": "<p>You can find an example how to create a Redis transaction <a href=\"https://godoc.org/github.com/go-redis/redis#example-Client-TxPipeline\" rel=\"nofollow noreferrer\">here</a>:</p>\n\n<p>Code:</p>\n\n<pre><code>pipe := rdb.TxPipeline()\n\nincr := pipe.Incr(\"tx_pipeline_counter\")\npipe.Expire(\"tx_pipeline_counter\", time.Hour)\n\n// Execute\n//\n//     MULTI\n//     INCR pipeline_counter\n//     EXPIRE pipeline_counts 3600\n//     EXEC\n//\n// using one rdb-server roundtrip.\n_, err := pipe.Exec()\nfmt.Println(incr.Val(), err)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1 &lt;nil&gt;\n</code></pre>\n\n<p>And if you prefer to use the <a href=\"https://redis.io/commands/watch\" rel=\"nofollow noreferrer\">watch</a> (optimistic locking)\nYou can see an example <a href=\"https://godoc.org/github.com/go-redis/redis#Client.Watch\" rel=\"nofollow noreferrer\">here</a> </p>\n\n<p>Code:</p>\n\n<pre><code>const routineCount = 100\n\n// Transactionally increments key using GET and SET commands.\nincrement := func(key string) error {\n    txf := func(tx *redis.Tx) error {\n        // get current value or zero\n        n, err := tx.Get(key).Int()\n        if err != nil &amp;&amp; err != redis.Nil {\n            return err\n        }\n\n        // actual opperation (local in optimistic lock)\n        n++\n\n        // runs only if the watched keys remain unchanged\n        _, err = tx.TxPipelined(func(pipe redis.Pipeliner) error {\n            // pipe handles the error case\n            pipe.Set(key, n, 0)\n            return nil\n        })\n        return err\n    }\n\n    for retries := routineCount; retries &gt; 0; retries-- {\n        err := rdb.Watch(txf, key)\n        if err != redis.TxFailedErr {\n            return err\n        }\n        // optimistic lock lost\n    }\n    return errors.New(\"increment reached maximum number of retries\")\n}\n\nvar wg sync.WaitGroup\nwg.Add(routineCount)\nfor i := 0; i &lt; routineCount; i++ {\n    go func() {\n        defer wg.Done()\n\n        if err := increment(\"counter3\"); err != nil {\n            fmt.Println(\"increment error:\", err)\n        }\n    }()\n}\nwg.Wait()\n\nn, err := rdb.Get(\"counter3\").Int()\nfmt.Println(\"ended with\", n, err)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>ended with 100 &lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 365, "user_id": 2130607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6423be6ad9f861ddba9f1f1016cf2b4?s=128&d=identicon&r=PG", "display_name": "Kebeng", "link": "https://stackoverflow.com/users/2130607/kebeng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7179, "favorite_count": 1, "accepted_answer_id": 41000054, "answer_count": 2, "score": 9, "last_activity_date": 1580807645, "creation_date": 1481039357, "last_edit_date": 1580242598, "question_id": 40999446, "link": "https://stackoverflow.com/questions/40999446/how-to-create-redis-transaction-in-go-using-go-redis-redis-package", "title": "How to create Redis Transaction in Go using go-redis/redis package?", "body": "<p>I want to execute multiple redis commmand with transaction using <code>MULTI</code> and <code>EXEC</code>, so I can <code>DISCARD</code> it if something bad happens.</p>\n\n<p>I've looking for the example of how to do redis transaction using\n<a href=\"https://github.com/go-redis/redis\" rel=\"nofollow noreferrer\">go-redis/redis</a> package and found nothing.</p>\n\n<p>And I also look into the documentation <a href=\"https://godoc.org/gopkg.in/redis.v5\" rel=\"nofollow noreferrer\">here</a> and I got nothing related to how to do redis transaction <a href=\"https://redis.io/topics/transactions\" rel=\"nofollow noreferrer\">like this for example</a> using that package. Or maybe I missing something from the documentation because yeah you know that godoc is only explain every function in package mostly using one liner.</p>\n\n<p>Even though I found some example to do redis transaction using other Go Redis library, I won't modify my programs to use another library since the effort will be much larger to port whole application using another library.</p>\n\n<p>Can anyone help me to do that using go-redis/redis package?</p>\n"}, {"tags": ["go", "exec"], "comments": [{"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1481044152, "post_id": 40997816, "comment_id": 69210770, "body": "Looks like you have some race conditions. Run your program with the <code>--race</code> flag and it should show you some issues."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1481046390, "post_id": 40997816, "comment_id": 69212183, "body": "You can&#39;t call <code>done()</code> multiple times, and you&#39;re not closing the StdinPipe to signal to the command that there&#39;s no more input."}, {"owner": {"reputation": 394, "user_id": 2437315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e01b82306d827dd8c6c85ae087c61d59?s=128&d=identicon&r=PG", "display_name": "Christopher", "link": "https://stackoverflow.com/users/2437315/christopher"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1481061202, "post_id": 40997816, "comment_id": 69219836, "body": "I think the <code>done()</code> function here is going to cause a few problems. Such as the fact that attempts to close the exit channel every time its run. <a href=\"https://golang.org/ref/spec#Close\" rel=\"nofollow noreferrer\">As per the spec</a>, closing an already closed channel results in a run-time panic. I think you should probably re-work the program to use a <code>sync.WaitGroup</code> instead of the exit channel, and use <code>cmd.Run()</code> instead of <code>cmd.Start()</code>. I think @JimB is also correct about needing to close the StdinPipe here."}, {"owner": {"reputation": 46, "user_id": 4776467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6692edb9875f51e015e573c1b06d49f5?s=128&d=identicon&r=PG&f=1", "display_name": "user147133", "link": "https://stackoverflow.com/users/4776467/user147133"}, "edited": false, "score": 0, "creation_date": 1481090473, "post_id": 40997816, "comment_id": 69228563, "body": "Yes, you are right about the race conditions. But the problem occurs before the race.  I&#39;ve updated the code and removed the race. I&#39;ve also updated the example output."}], "owner": {"reputation": 46, "user_id": 4776467, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6692edb9875f51e015e573c1b06d49f5?s=128&d=identicon&r=PG&f=1", "display_name": "user147133", "link": "https://stackoverflow.com/users/4776467/user147133"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1034, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1481090387, "creation_date": 1481034800, "last_edit_date": 1481090387, "question_id": 40997816, "link": "https://stackoverflow.com/questions/40997816/how-to-pipe-io-stdin-and-io-stdout-to-exec-command", "title": "How to pipe io.Stdin and io.Stdout to exec.Command", "body": "<p>I'm trying to read and write to an <code>exec.Command</code>, but I'm struggling with piping.</p>\n\n<p>This first one is a example of the behaviour I want. The go application just proxies stdin, stdout and stderr to the command:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"bash\", \"-i\")\n\n    cmd.Stdin = os.Stdin\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n\n    cmd.Run()\n    fmt.Println(\"Done\")\n}\n</code></pre>\n\n<p>Running this is like:</p>\n\n<pre><code>pensarando@home: ~/go/src/test$ ./test\npensarando@home: ~/go/src/test$ echo \"hello\"\nhello\npensarando@home: ~/go/src/test$ exit\nDone\npensarando@home: ~/go/src/test$ \n</code></pre>\n\n<p>But this one does not work at all:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"os/exec\"\n    \"sync\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"bash\", \"-i\")\n\n    in, _ := cmd.StdinPipe()\n    out, _ := cmd.StdoutPipe()\n    err, _ := cmd.StderrPipe()\n\n    exit := make(chan struct{})\n\n    done := func() {\n        in.Close()\n        out.Close()\n        err.Close()\n        cmd.Wait()\n        close(exit)\n    }\n\n    var once sync.Once\n\n    go func() {\n        io.Copy(os.Stdout, out)\n        fmt.Println(\"done stdout\")\n        once.Do(done)\n    }()\n\n    go func() {\n        io.Copy(in, os.Stdin)\n        fmt.Println(\"done stdin\")\n        once.Do(done)\n    }()\n\n    go func() {\n        io.Copy(os.Stderr, err)\n        fmt.Println(\"done stderr\")\n        once.Do(done)\n    }()\n\n    cmd.Start()\n    &lt;-exit\n    fmt.Println(\"Done\")\n}\n</code></pre>\n\n<p>When I run this one from the terminal, the output is for example:</p>\n\n<pre><code>pensarando@home:~/go/src/test$ go build\npensarando@home:~/go/src/test$ ./test\npensarando@home:~/go/src/test$ echo \"Hello\"\n\n[1]+  Stopped                 ./test\npensarando@home:~/go/src/test$ echo \"Hello\"\nHello\npensarando@home:~/go/src/test$ fg\n./test\ndone stdin\ndone stdout\ndone stderr\nDone\npensarando@home:~/go/src/test$\n</code></pre>\n\n<p>What exactly happens here?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 1, "creation_date": 1481032498, "post_id": 40996894, "comment_id": 69202629, "body": "Why do you need to use it ? If you&#39;re unmarshalling JSON/Yaml, maybe you could look at the tags. Name your field something else, and simply add some struct tag next to it like ` <code>json:&quot;type&quot;</code> `"}, {"owner": {"reputation": 567, "user_id": 2257397, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/76803d4f925d746180a96dffdaec3509?s=128&d=identicon&r=PG", "display_name": "Benjamin Fuentes", "link": "https://stackoverflow.com/users/2257397/benjamin-fuentes"}, "reply_to_user": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 0, "creation_date": 1481033296, "post_id": 40996894, "comment_id": 69203126, "body": "I am rewriting an application from another language to GO. Serialized objects need to have same field names. I will use <code>json</code> struct tag so. No other solution"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 5, "last_activity_date": 1481032153, "creation_date": 1481032153, "answer_id": 40996936, "question_id": 40996894, "link": "https://stackoverflow.com/questions/40996894/how-can-i-use-type-as-a-structure-attribute-in-go/40996936#40996936", "title": "How can I use &quot;type&quot; as a structure attribute in Go?", "body": "<p><code>type</code> is a <a href=\"https://golang.org/ref/spec#Keywords\" rel=\"noreferrer\">keyword</a> in Go, so you can't use it as an identifier. As an alternative, you can use:</p>\n\n<ul>\n<li>exported <code>Type</code></li>\n<li><code>type_</code></li>\n<li><code>typ</code></li>\n</ul>\n\n<p>All of these I got from the Go source code.</p>\n"}, {"tags": [], "owner": {"reputation": 24723, "user_id": 3150943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06074c6f020f2509f0b51a2c0ad3a9a8?s=128&d=identicon&r=PG", "display_name": "nu11p01n73R", "link": "https://stackoverflow.com/users/3150943/nu11p01n73r"}, "is_accepted": false, "score": 2, "last_activity_date": 1481032200, "creation_date": 1481032200, "answer_id": 40996950, "question_id": 40996894, "link": "https://stackoverflow.com/questions/40996894/how-can-i-use-type-as-a-structure-attribute-in-go/40996950#40996950", "title": "How can I use &quot;type&quot; as a structure attribute in Go?", "body": "<p><code>type</code> is a reserved word and may not be used as identifiers.\n<a href=\"https://golang.org/ref/spec#Keywords\" rel=\"nofollow noreferrer\">Docs</a></p>\n"}, {"comments": [{"owner": {"reputation": 567, "user_id": 2257397, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/76803d4f925d746180a96dffdaec3509?s=128&d=identicon&r=PG", "display_name": "Benjamin Fuentes", "link": "https://stackoverflow.com/users/2257397/benjamin-fuentes"}, "edited": false, "score": 0, "creation_date": 1481032786, "post_id": 40997061, "comment_id": 69202795, "body": "why not ? actually , it is for a json serialized object so i can do it like you say."}], "tags": [], "owner": {"reputation": 71, "user_id": 2776340, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QiYSy.jpg?s=128&g=1", "display_name": "Philipp Franke", "link": "https://stackoverflow.com/users/2776340/philipp-franke"}, "is_accepted": true, "score": 3, "last_activity_date": 1481032886, "last_edit_date": 1481032886, "creation_date": 1481032550, "answer_id": 40997061, "question_id": 40996894, "link": "https://stackoverflow.com/questions/40996894/how-can-i-use-type-as-a-structure-attribute-in-go/40997061#40997061", "title": "How can I use &quot;type&quot; as a structure attribute in Go?", "body": "<p>Why do you need to use <code>type</code>? </p>\n\n<p>When you need to parse JSON-encoded data with this attribute, you can write the following:</p>\n\n<pre><code>type Message struct {\n  Kind string `json:\"type\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 567, "user_id": 2257397, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/76803d4f925d746180a96dffdaec3509?s=128&d=identicon&r=PG", "display_name": "Benjamin Fuentes", "link": "https://stackoverflow.com/users/2257397/benjamin-fuentes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 570, "favorite_count": 0, "accepted_answer_id": 40997061, "answer_count": 3, "score": -1, "last_activity_date": 1481032886, "creation_date": 1481032013, "question_id": 40996894, "link": "https://stackoverflow.com/questions/40996894/how-can-i-use-type-as-a-structure-attribute-in-go", "title": "How can I use &quot;type&quot; as a structure attribute in Go?", "body": "<p>\"type\" is a language keyword but I need to use it as an attribute name in my structure like :</p>\n\n<pre><code>type Message struct{\n    type string\n}\n</code></pre>\n\n<p>My IDE finds an error line 2</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1481026896, "post_id": 40994957, "comment_id": 69198908, "body": "I don&#39;t think you can. Just import github.com/pkg/errors &quot;manually&quot;."}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 1, "creation_date": 1481033525, "post_id": 40994957, "comment_id": 69203264, "body": "Welcome to the world of <code>goimports</code> and its wrong package imports.  Wait until you get to <code>templates</code>!  In reality, get away from this automated imports management and just learn the packages yourself - you&#39;ll thank us later.  Besides, to have proper intellisense in any IDE (VIM, Atom, Sublime, VS Code, VS, IntelliJ - ive used all!), <i>you will need to specify the Import first anyways!</i>"}], "answers": [{"comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1481027500, "post_id": 40995419, "comment_id": 69199329, "body": "Those are for packages under GOPATH, <code>lines naming a directory **relative** to the configuration</code>"}], "tags": [], "owner": {"reputation": 844, "user_id": 2459515, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SkRr0.jpg?s=128&g=1", "display_name": "StevieB", "link": "https://stackoverflow.com/users/2459515/stevieb"}, "is_accepted": false, "score": 1, "last_activity_date": 1481027202, "creation_date": 1481027202, "answer_id": 40995419, "question_id": 40994957, "link": "https://stackoverflow.com/questions/40994957/how-can-i-tell-goimports-to-prefer-one-package-over-another/40995419#40995419", "title": "How can I tell goimports to prefer one package over another?", "body": "<p>I haven't tried this but according to the docs at:\n<a href=\"https://github.com/golang/tools/blob/master/cmd/goimports/doc.go\" rel=\"nofollow noreferrer\">https://github.com/golang/tools/blob/master/cmd/goimports/doc.go</a></p>\n\n<blockquote>\n  <p>To exclude directories in your $GOPATH from being scanned for Go\n  files, goimports respects a configuration file at\n  $GOPATH/src/.goimportsignore which may contain blank lines, comment\n  lines (beginning with '#'), or lines naming a directory relative to\n  the configuration file to ignore when scanning. No globbing or regex\n  patterns are allowed. Use the \"-v\" verbose flag to verify it's working\n  and see what goimports is doing.</p>\n</blockquote>\n\n<p>So you could try excluding the errors directory.</p>\n"}, {"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 3, "last_activity_date": 1481086833, "last_edit_date": 1481086833, "creation_date": 1481028029, "answer_id": 40995650, "question_id": 40994957, "link": "https://stackoverflow.com/questions/40994957/how-can-i-tell-goimports-to-prefer-one-package-over-another/40995650#40995650", "title": "How can I tell goimports to prefer one package over another?", "body": "<p>Using <a href=\"https://godoc.org/golang.org/x/tools/cmd/goimports\" rel=\"nofollow noreferrer\"><code>.goimportsignore</code></a> would not work in your case as the package you want to ignore is in the standard lib and not under GOPATH.</p>\n\n<p>The <code>-local</code> flag would also not work because both the packages have the same name so <code>errors</code> will still be chosen over <code>pkg/errors</code>.</p>\n\n<p>Your options are to write your own version of <code>goimports</code> using the <a href=\"https://godoc.org/golang.org/x/tools/imports\" rel=\"nofollow noreferrer\"><code>golang.org/x/tools/imports</code></a></p>\n\n<p>Or another inconvenient way is to make sure you call <code>error.Wrap</code> or one of the other functions the first time in a new file, rather than <code>errors.New</code> so that <code>goimports</code> can identify <code>pkg/errors</code>.</p>\n"}], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1053, "favorite_count": 2, "answer_count": 2, "score": 6, "last_activity_date": 1481086833, "creation_date": 1481025816, "question_id": 40994957, "link": "https://stackoverflow.com/questions/40994957/how-can-i-tell-goimports-to-prefer-one-package-over-another", "title": "How can I tell goimports to prefer one package over another?", "body": "<p>This file:</p>\n\n<pre><code>package foo\n\nfunc errorer() error {\n    return errors.New(\"Whoops\")\n}\n</code></pre>\n\n<p>Will be transformed to this with <code>goimports</code>:</p>\n\n<pre><code>package foo\n\nimport \"errors\"\n\nfunc errorer() error {\n    return errors.New(\"Whoops\")\n}\n</code></pre>\n\n<p>However, I'd like to use the <code>github.com/pkg/errors</code> package everywhere in this project, and not the <code>errors</code> package.</p>\n\n<p>Can I tell <code>goimports</code> to always prefer the <code>github.com/pkg/errors</code> package?</p>\n"}, {"tags": ["json", "parsing", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "reply_to_user": {"reputation": 709, "user_id": 3016478, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/hTZcs.jpg?s=128&g=1", "display_name": "rsudip90", "link": "https://stackoverflow.com/users/3016478/rsudip90"}, "edited": false, "score": 0, "creation_date": 1481023842, "post_id": 40994172, "comment_id": 69197035, "body": "@rsudip90, glad it helps, you can actually read this from Go API docs <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">here</a>, especially this line: <code>Unmarshal will only set exported fields of the struct.</code>"}], "tags": [], "owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "is_accepted": true, "score": 3, "last_activity_date": 1481023730, "last_edit_date": 1481023730, "creation_date": 1481023397, "answer_id": 40994172, "question_id": 40993987, "link": "https://stackoverflow.com/questions/40993987/getting-nullable-object-on-json-unmarshal-in-golang/40994172#40994172", "title": "getting nullable object on json unmarshal in golang", "body": "<p>That is because your <strong>cls</strong> struct has embedded private struct (lower case unexported field) of <strong>student</strong> <code>st</code>, change to exported field should work, that is:</p>\n\n<pre><code>type cls struct {\n    // St field will be unmarshalled\n    St student `json:\"cls\"`\n}\n</code></pre>\n\n<p>See in <a href=\"https://play.golang.org/p/-IFQSrLf3Z\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 709, "user_id": 3016478, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/hTZcs.jpg?s=128&g=1", "display_name": "rsudip90", "link": "https://stackoverflow.com/users/3016478/rsudip90"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 40994172, "answer_count": 1, "score": 0, "last_activity_date": 1481023730, "creation_date": 1481022796, "last_edit_date": 1592644375, "question_id": 40993987, "link": "https://stackoverflow.com/questions/40993987/getting-nullable-object-on-json-unmarshal-in-golang", "title": "getting nullable object on json unmarshal in golang", "body": "<blockquote>\n<p>Go code(jsonTestParse.go)</p>\n<p>(this is just a test example I made, please don't argue that I should\nuse list of students in cls struct)</p>\n</blockquote>\n<pre><code>package main\n\nimport (\n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n    &quot;io/ioutil&quot;\n    &quot;os&quot;\n)\n\ntype student struct {\n    ID       string `json:&quot;id&quot;`\n    Name     string `json:&quot;name&quot;`\n    Standard string `json:&quot;std&quot;`\n}\n\ntype cls struct {\n    st student `json:&quot;cls&quot;`\n}\n\nfunc getValues() (cls, error) {\n    var clss cls\n    dataBytes, err := ioutil.ReadFile(&quot;studentclass.json&quot;)\n    if err != nil {\n        fmt.Printf(&quot;File error: %v\\n&quot;, err)\n        os.Exit(1)\n    }\n    err = json.Unmarshal(dataBytes, &amp;clss)\n    if err != nil {\n        fmt.Errorf(&quot;%s&quot;, err)\n    }\n    return clss, err\n}\n\nfunc main() {\n    s, err := getValues()\n    fmt.Printf(&quot;%#v\\n&quot;, s)\n    fmt.Println(err)\n}\n</code></pre>\n<blockquote>\n<p>Json File (studentclass.json)</p>\n</blockquote>\n<pre><code>{\n    &quot;cls&quot;: {\n        &quot;id&quot;: &quot;1&quot;,\n        &quot;name&quot;: &quot;test&quot;,\n        &quot;std&quot;: &quot;0&quot;\n    }\n}\n</code></pre>\n<p>When I run this code with <code>go run jsonTestParse.go</code> it gives me this output:</p>\n<pre><code>main.cls{st:main.student{ID:&quot;&quot;, Name:&quot;&quot;, Standard:&quot;&quot;}}\n&lt;nil&gt;\n</code></pre>\n<p>Please help me why I'm getting this blank object</p>\n<pre><code>main.cls{st:main.student{ID:&quot;&quot;, Name:&quot;&quot;, Standard:&quot;&quot;}}\n</code></pre>\n<p>instead of this</p>\n<pre><code>main.cls{st:main.student{ID:&quot;1&quot;, Name:&quot;test&quot;, Standard:&quot;0&quot;}}\n</code></pre>\n<p>Plus It would be great to help on how to get these values?</p>\n"}, {"tags": ["postgresql", "go", "orm", "beego"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 4, "creation_date": 1481018795, "post_id": 40992532, "comment_id": 69193881, "body": "You&#39;re missing the table name and <code>SET</code> keyword after <code>UPDATE</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 7239078, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/39a73253e39d7669f7ee20bb625f6c6c?s=128&d=identicon&r=PG&f=1", "display_name": "rajesh kumar", "link": "https://stackoverflow.com/users/7239078/rajesh-kumar"}, "edited": false, "score": 0, "creation_date": 1481072020, "post_id": 40994291, "comment_id": 69223519, "body": "Thanks very much...Solved"}], "tags": [], "owner": {"reputation": 538, "user_id": 6699598, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df9438356291b0610a990ff0d0fb06a8?s=128&d=identicon&r=PG&f=1", "display_name": "HubertS", "link": "https://stackoverflow.com/users/6699598/huberts"}, "is_accepted": true, "score": 3, "last_activity_date": 1481030471, "last_edit_date": 1481030471, "creation_date": 1481023779, "answer_id": 40994291, "question_id": 40992532, "link": "https://stackoverflow.com/questions/40992532/need-the-add-the-date-by-1-year-in-postgresql-using-golang/40994291#40994291", "title": "Need the add the date by 1 year in postgreSQL using golang", "body": "<p>I think that problem can be solved including the \"SET\" in your update statement <br />\n<code>_, err := o.Raw(\"UPDATE TABLE_NAME SET resetdate=resetdate + interval '1 year'  WHERE resetdate&gt;=?\",\"2016-12-12\").Exec()</code></p>\n\n<p>Reference: <a href=\"https://www.postgresql.org/docs/9.1/static/sql-update.html\" rel=\"nofollow noreferrer\">Postgres UPDATE</a></p>\n"}], "owner": {"reputation": 37, "user_id": 7239078, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/39a73253e39d7669f7ee20bb625f6c6c?s=128&d=identicon&r=PG&f=1", "display_name": "rajesh kumar", "link": "https://stackoverflow.com/users/7239078/rajesh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 40994291, "answer_count": 1, "score": 1, "last_activity_date": 1481030471, "creation_date": 1481018431, "last_edit_date": 1481023761, "question_id": 40992532, "link": "https://stackoverflow.com/questions/40992532/need-the-add-the-date-by-1-year-in-postgresql-using-golang", "title": "Need the add the date by 1 year in postgreSQL using golang", "body": "<p>I am using golang and postgreSQL version 9.5.5 in my application. I am using <code>github.com/lib/pq</code> as my database driver to connect to the database. One of my fields(resetdate) have the type date. I would like to add the resetdate by 1 year. So I used the following code:</p>\n\n<p><strong>Note</strong>:I m using beego as my framework and use orm to compute my\n queries.</p>\n\n<pre><code>_, err := o.Raw(\"UPDATE resetdate=resetdate + interval  '1 year'  WHERE resetdate&gt;=?\",\"2016-12-12\").Exec()\n</code></pre>\n\n<p>When I execute this I'm getting the following error:</p>\n\n<blockquote>\n  <p>\"pq: syntax error at or near \\\"=\\\"\"</p>\n</blockquote>\n\n<p>Appreciate any help.Thanks</p>\n"}, {"tags": ["go", "unicode"], "comments": [{"owner": {"reputation": 1226, "user_id": 413026, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/sn0TL.jpg?s=128&g=1", "display_name": "Tornike", "link": "https://stackoverflow.com/users/413026/tornike"}, "edited": false, "score": 0, "creation_date": 1481017897, "post_id": 40992042, "comment_id": 69193280, "body": "if you want to find the character just use <code>{Han}</code> without anything"}, {"owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "reply_to_user": {"reputation": 1226, "user_id": 413026, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/sn0TL.jpg?s=128&g=1", "display_name": "Tornike", "link": "https://stackoverflow.com/users/413026/tornike"}, "edited": false, "score": 0, "creation_date": 1481018669, "post_id": 40992042, "comment_id": 69193810, "body": "re, err = regexp.Compile(`{Han}`) like this? it print empty too."}, {"owner": {"reputation": 1226, "user_id": 413026, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/sn0TL.jpg?s=128&g=1", "display_name": "Tornike", "link": "https://stackoverflow.com/users/413026/tornike"}, "edited": false, "score": 0, "creation_date": 1481018739, "post_id": 40992042, "comment_id": 69193849, "body": "like this <code>regexp.Compile(`\\p{Han}`)</code>"}, {"owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "reply_to_user": {"reputation": 1226, "user_id": 413026, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/sn0TL.jpg?s=128&g=1", "display_name": "Tornike", "link": "https://stackoverflow.com/users/413026/tornike"}, "edited": false, "score": 0, "creation_date": 1481019206, "post_id": 40992042, "comment_id": 69194147, "body": "This will only match one character. I want to match more."}], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "edited": false, "score": 0, "creation_date": 1481032155, "post_id": 40993122, "comment_id": 69202420, "body": "I think i understand what happened:because * and ? also match empty  string, so find method print  first matched string which is empty, thanks for  reply."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 4, "last_activity_date": 1481020222, "creation_date": 1481020222, "answer_id": 40993122, "question_id": 40992042, "link": "https://stackoverflow.com/questions/40992042/regexp-find-for-chinese-unicode-character/40993122#40993122", "title": "regexp find for Chinese unicode character", "body": "<p>As the <a href=\"https://golang.org/pkg/regexp/#Regexp.FindString\" rel=\"nofollow noreferrer\">docs</a> say (emphasis added):</p>\n\n<blockquote>\n  <p>FindString returns a string holding the text of the leftmost match in s of the regular expression. If there is no match, the return value is an empty string, <strong>but it will also be empty if the regular expression successfully matches an empty string.</strong> Use FindStringIndex or FindStringSubmatch if it is necessary to distinguish these cases.</p>\n</blockquote>\n\n<p><code>\\p{Han}*</code> matches an empty string. You can also see that by using <code>FindAllString</code>:</p>\n\n<pre><code>fmt.Printf(\"%q\", re.FindAllString(s, -1))\n// Prints [\"\" \"\" \"\" \"\u4e2d\u6587\u54e6\" \"\" \"\" \"\" \"\"]\n</code></pre>\n\n<p>You can use <code>\\p{Han}+</code> which doesn't match an empty string.</p>\n"}], "owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 938, "favorite_count": 1, "closed_date": 1481032406, "answer_count": 1, "score": 4, "last_activity_date": 1481020222, "creation_date": 1481016945, "question_id": 40992042, "link": "https://stackoverflow.com/questions/40992042/regexp-find-for-chinese-unicode-character", "closed_reason": "Duplicate", "title": "regexp find for Chinese unicode character", "body": "<p>i have code like this </p>\n\n<pre><code>re, err = regexp.Compile(`\\p{Han}*`)\nif err != nil {\n    fmt.Println(err)\n    return\n}\ns := \"foo\u4e2d\u6587\u54e6woqu\"\nfmt.Println(re.FindString(s))\n</code></pre>\n\n<p>but it print empty.</p>\n\n<p>and then i change <code>\\p{Han}*</code> to <code>\\p{Han}+</code>, it display's \u4e2d\u6587\u54e6.</p>\n\n<p>change <code>\\p{Han}*</code> to <code>\\p{Han}?</code>, it print empty.</p>\n\n<p>I find the document like this:</p>\n\n<ul>\n<li>x*   zero or more x, prefer more </li>\n<li>x+   one or more x, prefer more </li>\n<li>x?   zero or one x, prefer one</li>\n</ul>\n\n<p>so i expect my print is:</p>\n\n<ul>\n<li><code>\\p{Han}*</code> print \u4e2d\u6587\u54e6</li>\n<li><code>\\p{Han}+</code> print \u4e2d\u6587\u54e6</li>\n<li><code>\\p{Han}?</code> print \u4e2d</li>\n</ul>\n\n<p>could someone tell me what happened?</p>\n"}, {"tags": ["go", "concurrency", "synchronization", "race-condition", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "reply_to_user": {"reputation": 75, "user_id": 6099303, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e8943ef1ec08aee84dfdbdad6bc524da?s=128&d=identicon&r=PG&f=1", "display_name": "\u5c0f\u660e\u6e56\u7554", "link": "https://stackoverflow.com/users/6099303/%e5%b0%8f%e6%98%8e%e6%b9%96%e7%95%94"}, "edited": false, "score": 1, "creation_date": 1481021920, "post_id": 40992319, "comment_id": 69195897, "body": "@\u5c0f\u660e\u6e56\u7554 The race detector detects potential race conditions, not only actual race conditions. It notices that memory is read/written from different goroutines without a lock - the time between that access is not a factor in the race detection. (And your particular code gives no guarantee that there will never be a race condition - particularly in situations where the machine is overloaded, your time.Sleep() might cause all goroutines to be scheduled at the same time and create a real race)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1481037818, "last_edit_date": 1481037818, "creation_date": 1481017716, "answer_id": 40992319, "question_id": 40991882, "link": "https://stackoverflow.com/questions/40991882/how-can-gos-race-detector-be-aware-of-lock/40992319#40992319", "title": "How can Go&#39;s race detector be aware of lock?", "body": "<p>The race detector does not analyze the source code, it doesn't know that you added locks in the source code.</p>\n\n<p>The race detector works at runtime:</p>\n\n<blockquote>\n  <p>When the <code>-race</code> command-line flag is set, the compiler instruments all memory accesses with code that records when and how the memory was accessed, while the runtime library watches for unsynchronized accesses to shared variables.</p>\n</blockquote>\n\n<p>Because of this design, the race detector can only detect race conditions <em>if</em> and <em>when</em> they actually occur. So when you add proper locking / synchronization, the race condition will not happen (the <em>if</em> condition will not be met), and so no warning will be printed.</p>\n\n<p>See this blog post for more details: <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\"><strong>Introducing the Go Race Detector</strong></a></p>\n\n<p>And this article: <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Data Race Detector</a></p>\n\n<p><strong>Edit for your example:</strong></p>\n\n<p>It may be that your 2 goroutines will never reach the point where they write the shared variable <code>a</code> at the same physical time (because the code runs so fast and the sleep time is relatively huge), but they run <em>concurrently</em>, in different goroutines, <em>without explicit synchronization</em> (a synchronization point may be channel communication, mutex lock/unlock etc.).</p>\n\n<p>The race condition does not imply that access to a shared variable <em>does happen</em> at the same time (one of which must be a write). The race condition is also met if access to a shared variable happens <em>concurrently</em> (from multiple goroutines), without synchronization. This can be detected at runtime by the race detector (due to the instrumented memory access code).</p>\n\n<p>Code generated by the compiler is allowed to use <em>cached</em> instances of the <code>a</code> variable in multiple goroutines, the runtime only has to guarantee that the cached instances are \"refreshed\" or disposed of if a synchronization point is reached. For details, see <a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">The Go Memory Model</a>.</p>\n\n<p>Also note that <a href=\"https://golang.org/pkg/time/#Sleep\" rel=\"nofollow noreferrer\"><code>time.Sleep()</code></a> does not guarantee that execution will continue right after the specified duration, only that execution will be suspended for <em>at least</em> the specified duration (so the execution may continue at a <em>later</em> time):</p>\n\n<blockquote>\n  <p>Sleep pauses the current goroutine for <strong>at least</strong> the duration d.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "is_accepted": false, "score": 0, "last_activity_date": 1481017786, "creation_date": 1481017786, "answer_id": 40992342, "question_id": 40991882, "link": "https://stackoverflow.com/questions/40991882/how-can-gos-race-detector-be-aware-of-lock/40992342#40992342", "title": "How can Go&#39;s race detector be aware of lock?", "body": "<p>The data race detector does not do static analysis. It is not aware of your lock. It\u2019s empirical, it just <em>notices</em> that when you run your code with the lock, two threads are never writing to the same value at the same time (or one writing, one reading).</p>\n"}], "owner": {"reputation": 75, "user_id": 6099303, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e8943ef1ec08aee84dfdbdad6bc524da?s=128&d=identicon&r=PG&f=1", "display_name": "\u5c0f\u660e\u6e56\u7554", "link": "https://stackoverflow.com/users/6099303/%e5%b0%8f%e6%98%8e%e6%b9%96%e7%95%94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 3, "accepted_answer_id": 40992319, "answer_count": 2, "score": 3, "last_activity_date": 1481037818, "creation_date": 1481016499, "last_edit_date": 1481021326, "question_id": 40991882, "link": "https://stackoverflow.com/questions/40991882/how-can-gos-race-detector-be-aware-of-lock", "title": "How can Go&#39;s race detector be aware of lock?", "body": "<p>Adding lock to a program with race condition can solve the race condition and make the race detector quiet. How can Go's race detector be aware of lock?</p>\n\n<p>Someone points out that \"the race detector can only detect race conditions <em>if</em> and <em>when</em> they actually occur\".</p>\n\n<p>Consider the following program:</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    var a int\n    var wg sync.WaitGroup\n    workers := 2\n    wg.Add(workers)\n    for i := 1; i &lt;= workers; i++ {\n        go func(sleep int) {\n            time.Sleep(time.Duration(sleep) * time.Second)\n            a = 1\n            wg.Done()\n        }(i * 5)\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>One goroutine sleeps for 5 seconds, another sleeps for 10 seconds, they don't write <code>a</code> at the same time in most cases, but the race detector prints the race condition warning every time. Why?</p>\n"}, {"tags": ["go", "lambda", "closures"], "comments": [{"owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "edited": false, "score": 1, "creation_date": 1481013044, "post_id": 40990735, "comment_id": 69190349, "body": "no, it will modify the original too."}, {"owner": {"reputation": 33, "user_id": 7235425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13abb0f05edc865cc0e4e5baf0bff9cf?s=128&d=identicon&r=PG&f=1", "display_name": "Yorke", "link": "https://stackoverflow.com/users/7235425/yorke"}, "reply_to_user": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "edited": false, "score": 0, "creation_date": 1481013393, "post_id": 40990735, "comment_id": 69190522, "body": "but,check this."}, {"owner": {"reputation": 33, "user_id": 7235425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13abb0f05edc865cc0e4e5baf0bff9cf?s=128&d=identicon&r=PG&f=1", "display_name": "Yorke", "link": "https://stackoverflow.com/users/7235425/yorke"}, "reply_to_user": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "edited": false, "score": 0, "creation_date": 1481013595, "post_id": 40990735, "comment_id": 69190651, "body": "huh,I set val and val1 as return values, then print them,their values are always 0, why?"}, {"owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "edited": false, "score": 0, "creation_date": 1481014029, "post_id": 40990735, "comment_id": 69190934, "body": "could you show me your test code? <a href=\"https://play.golang.org/p/EbH2dMCAeC\" rel=\"nofollow noreferrer\">play.golang.org/p/EbH2dMCAeC</a> see this to see how outer value changed by closure."}, {"owner": {"reputation": 33, "user_id": 7235425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13abb0f05edc865cc0e4e5baf0bff9cf?s=128&d=identicon&r=PG&f=1", "display_name": "Yorke", "link": "https://stackoverflow.com/users/7235425/yorke"}, "reply_to_user": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "edited": false, "score": 0, "creation_date": 1481015725, "post_id": 40990735, "comment_id": 69191920, "body": "My code is above."}, {"owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "edited": false, "score": 0, "creation_date": 1481016239, "post_id": 40990735, "comment_id": 69192197, "body": "1\u3001the print in for loop is all zero, because the val and val1 return from first call <code>fibonacci</code> is a copy from the variable in <code>fibonacci</code> function, so they are not be modify. 2\u3001the second call to <code>fibonacci</code> will create a new closure and a new val and val1 different from first call. so it will print zero also."}], "answers": [{"tags": [], "owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "is_accepted": true, "score": 0, "last_activity_date": 1481015962, "creation_date": 1481015962, "answer_id": 40991732, "question_id": 40990735, "link": "https://stackoverflow.com/questions/40990735/some-confusions-about-lambda-function-closure-in-golang/40991732#40991732", "title": "some confusions about lambda function/closure in Golang", "body": "<p>from your test code here: <a href=\"https://play.golang.org/p/pajT2bAIe2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pajT2bAIe2</a></p>\n\n<p>your fibonacci function is working out the nth numbers in the sequence provided it's called in an incremental fashion as you are doing. but the values you return from the initial call to <code>fibonacci</code> are not pointers (or references) to those integer values they are just the values of those integers at that time, think of them as being copied out of the function, try using integer pointers instead like this: <a href=\"https://play.golang.org/p/-vLja7Fpsq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/-vLja7Fpsq</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    f, val, val1 := fibonacci()\n    fmt.Println(val, val1)\n    for i := 0; i &lt;= 10; i++ {\n        fmt.Println(f(i), *val, *val1) //dereference the pointer to get its value at the current time\n    }\n    _, val, val1 = fibonacci()\n    fmt.Println(*val, *val1)\n}\nfunc fibonacci() (func(n int) int, *int, *int) {\n    var val int\n    var val1 int\n    f := func(n int) int {\n        if n == 0 || n == 1 {\n            val, val1 = 1, 1\n        } else {\n            val, val1 = val+val1, val\n        }\n        return val\n    }\n    fmt.Println(\"fibonacci val =\", val, \"val1 =\", val1)\n    return f, &amp;val, &amp;val1 // return pointers to the closured values instead of just the values\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 0, "last_activity_date": 1484470065, "last_edit_date": 1484470065, "creation_date": 1481026274, "answer_id": 40995108, "question_id": 40990735, "link": "https://stackoverflow.com/questions/40990735/some-confusions-about-lambda-function-closure-in-golang/40995108#40995108", "title": "some confusions about lambda function/closure in Golang", "body": "<p>Although you have accepted the above answer i'm giving another explanation. The reason why you receive the last value of the loop operation has to do with the <code>Go</code>'s  lexical scoping. The <code>for loop</code> introduces a new lexical block in which the value is referenced by it's memory address, so by pointer and not by it's value. In order to get the value, you have to de-reference.</p>\n\n<p>Each time the for loop makes an iteration the value processed is pointing to the same memory address. All the function values created by this loop \"capture\" and share the <strong>same</strong> variable - and addressable storage location, not it's value at that particular moment. Thus when the last iteration is finished, the variable holds the value from the final step.</p>\n\n<p>A much better approach for these kind of operations would be to use goroutines, because in these cases you are not communicating through sharing the same memory address, but you are sharing the memory through communication. </p>\n\n<p>Here is a more elegant solution using goroutine:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc fibonacci(ch chan interface{}, quit chan struct{}) {\n    x, y := 1, 1\n    for {\n        select {\n        case ch &lt;- x:\n            x, y = y, x+y\n            fmt.Println(x , y)\n        case &lt;-quit:\n            fmt.Println(\"Quiting...\")\n            return\n        }\n    }\n}\n\nfunc main() {\n    ch := make(chan interface{})\n    quit := make(chan struct{})\n\n    go func() {\n        for i := 0; i &lt; 10; i++ {\n            &lt;-ch\n        }\n        quit &lt;- struct{}{}\n    }()\n\n    fibonacci(ch, quit)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/oPQgXWyV9u\" rel=\"nofollow noreferrer\">https://play.golang.org/p/oPQgXWyV9u</a></p>\n"}], "owner": {"reputation": 33, "user_id": 7235425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13abb0f05edc865cc0e4e5baf0bff9cf?s=128&d=identicon&r=PG&f=1", "display_name": "Yorke", "link": "https://stackoverflow.com/users/7235425/yorke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 40991732, "answer_count": 2, "score": -1, "last_activity_date": 1484470065, "creation_date": 1481012337, "last_edit_date": 1481015682, "question_id": 40990735, "link": "https://stackoverflow.com/questions/40990735/some-confusions-about-lambda-function-closure-in-golang", "title": "some confusions about lambda function/closure in Golang", "body": "<pre><code>package main\nimport (\n    \"fmt\"\n)\nfunc main(){\n    f,val,val1:=fibonacci()\n    fmt.Println(val,val1)\n    for i:=0;i&lt;=10;i++ {\n        fmt.Println(f(i),val,val1)\n    }\n    _,val,val1=fibonacci()\n    fmt.Println(val,val1)\n}\nfunc fibonacci()(func(n int)int,int,int){\n    var val int\n    var val1 int\n    f:=func(n int)int{\n        if n==0||n==1{\n            val,val1=1,1\n        }else{\n            val,val1=val+val1,val\n        }\n        return val\n    }\n    fmt.Println(\"fibonacci val =\",val,\"val1 =\",val1)\n    return f,val,val1\n}\n</code></pre>\n\n<blockquote>\n  <p>Here is my code on sloving fibonacci without using recursion when I\n  read about lambda function/closure. And the Go Documentary says a\n  closure will  capture some external state. My understanding is the\n  closure will keep a  copy of state of the function which it is\n  declared. These states are just  copies whatever I do on them won't\n  modify the original, is that so?</p>\n</blockquote>\n"}, {"tags": ["json", "string", "go", "interface", "type-switch"], "answers": [{"comments": [{"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "edited": false, "score": 0, "creation_date": 1481006747, "post_id": 40988987, "comment_id": 69187412, "body": "I would say this is the best solution in his case."}, {"owner": {"reputation": 293, "user_id": 5494985, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b9100b9db686b28ffe9637aa37a33f1?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan D.", "link": "https://stackoverflow.com/users/5494985/ryan-d"}, "edited": false, "score": 0, "creation_date": 1481077139, "post_id": 40988987, "comment_id": 69224878, "body": "Yep, thats much cleaner. Thank you."}], "tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": true, "score": 2, "last_activity_date": 1481035228, "last_edit_date": 1481035228, "creation_date": 1481005181, "answer_id": 40988987, "question_id": 40988252, "link": "https://stackoverflow.com/questions/40988252/convert-json-with-variable-types-to-strings/40988987#40988987", "title": "Convert json with variable types to strings", "body": "<p>For this answer I'm assuming that JSON in your example is an example of (part of) your JSON input.\nIn this case, your JSON has a specific structure: you know which attributes are coming with a known data type and also you know which attributes a dynamic.\nFor example, you could unmarshal your JSON into smth like ResponseObj below:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype ResponseObj struct {\n    Response []Item `json:\"response\"`\n}\n\ntype Item struct {\n    TInt   int         `json:\"t_int\"`\n    TBool  bool        `json:\"t_bool\"`\n    TMixed interface{} `json:\"t_null_or_string\"`\n}\n\nfunc main() {\n\n    json_byte := []byte(`{\"response\":[{\"t_int\":1, \"t_bool\": true,  \"t_null_or_string\": null}, {\"t_int\":2, \"t_bool\": false, \"t_null_or_string\": \"string1\"}]}`)\n\n    data_json := ResponseObj{}\n    if err := json.Unmarshal(json_byte, &amp;data_json); err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%+v\\n\", data_json)\n}\n</code></pre>\n\n<p>Your data will look like:</p>\n\n<pre><code>{\n    Response:\n    [\n        {\n            TInt:1\n            TBool:true\n            TMixed:&lt;nil&gt;\n        }\n            {\n            TInt:2\n            TBool:false\n            TMixed:string1\n        }\n    ]\n}\n</code></pre>\n\n<p>And yes, for an attribute with a mixed type you'll run a type assertion (or comparison with nil as in your case or both).</p>\n\n<p>Unlikely your JSON is a total chaos of unpredictable types. Most likely, you can single out a <em>core</em> structure and use interface{} for remaining, mixed types.</p>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 293, "user_id": 5494985, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b9100b9db686b28ffe9637aa37a33f1?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan D.", "link": "https://stackoverflow.com/users/5494985/ryan-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3500, "favorite_count": 0, "accepted_answer_id": 40988987, "answer_count": 1, "score": 2, "last_activity_date": 1610957753, "creation_date": 1481001058, "last_edit_date": 1610957753, "question_id": 40988252, "link": "https://stackoverflow.com/questions/40988252/convert-json-with-variable-types-to-strings", "title": "Convert json with variable types to strings", "body": "<p>I am reading in json from an API response and I ran into an issue in that there are multiple data types inside the json values (strings, null, bool).  In addition, some keys have values which can be either a string or null which makes reading the data into types more difficult.  I want to convert everything to strings for ease of handling.  I created a type switch based on googling other examples.  I am wondering if this is the easiest way to do this or if I am missing a simpler approach.</p>\n\n<pre><code>  package main\n\nimport (\n\"encoding/json\"\n\"fmt\"\n\"strconv\"\n)\n\nfunc main() {\n\njson_byte := []byte(`{\"response\":[{\"t_int\":1, \"t_bool\": true,  \"t_null_or_string\": null}, {\"t_int\":2, \"t_bool\": false, \"t_null_or_string\": \"string1\"}]}`) \n\n//unmarshal the json to data structure using interface for variable data types\ndata_json := make(map[string][]map[string]interface{}) //create a structure to hold unmarshalled json\nif err := json.Unmarshal(json_byte, &amp;data_json); err != nil {\n    panic(err)\n}\nfmt.Println(\"json_data: \", data_json)\n\n//Iterate over data structure and convert Bool, Int, and Null types to string\nvar v_conv string                               // temporary holding for converted string values\ndata_map := make(map[string]string)             // temporary holding for converted maps\ndata_final := make([]map[string]string, 0, 100) // final holding for data converted to strings\n\nfor _, v := range data_json { //v is the value of the \"response\": key which is a slice of maps\n    for _, v2 := range v { //v2 is one of the maps in the slice of maps\n        for k3, v3 := range v2 { //k3 and v3 are the keys and values inside the map\n            fmt.Println(\"k3: \", k3, \"v3: \", v3)\n            switch v_type := v3.(type) {\n            case nil:\n                v_conv = \"\"\n            case bool:\n                v_conv = strconv.FormatBool(v3.(bool))\n            case int:\n                v_conv = strconv.Itoa(v3.(int))\n            case string:\n                v_conv = v3.(string)\n            case float64:\n                v_conv = strconv.FormatFloat(v3.(float64), 'f', 0, 64)\n            default:\n                fmt.Println(\"vtype unknown: \", v_type) //have to use v_type since it is declared\n                v_conv = \"\"\n            }\n            data_map[k3] = v_conv //append a new map key/value pair both as strings\n            fmt.Println(\"data_map: \", data_map)\n        }\n        data_final = append(data_final, data_map) // after each cycle through the loop append the map to the new list\n        fmt.Println(\"data_final: \", data_final)\n    }\n}\n}\n</code></pre>\n\n<p>Final Format Desired a Slice of Maps\n   [{\n   \"t_int\":  \"1\",\n   \"t_bool\": \"true\",\n   \"t_null_string\": \"\"\n   },\n   {\n   \"t_int\":  \"2\",\n   \"t_bool\": \"false\",\n   \"t_null_string\": \"string1\"\n   }]</p>\n"}, {"tags": ["xml", "go"], "answers": [{"comments": [{"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1481038384, "post_id": 40991193, "comment_id": 69206771, "body": "Related proposal of how this might be possible in future, in case people are interested in contributing to the discussion (although event driven parsing would probably still be the better option here): <a href=\"https://github.com/golang/go/issues/13504\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/13504</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1481014970, "last_edit_date": 1481014970, "creation_date": 1481014060, "answer_id": 40991193, "question_id": 40987994, "link": "https://stackoverflow.com/questions/40987994/unmarshalling-heterogeneous-list-of-xml-elements-in-go/40991193#40991193", "title": "Unmarshalling heterogeneous list of XML elements in Go", "body": "<p>You can't model such XML documents in Go, and you can't unmarshal into <code>interace{}</code>, so I would suggest <em>event-driven</em> parsing for this.</p>\n\n<p>This event-driven parsing means when you are parsing (the tokens of) the XML document, you receive events like \"start element encountered\", or \"end element encountered\" (with details of the element of course), and these events control the flow of your program (branch and/or change internal state based on them).</p>\n\n<p>The following example will show you the principle of this. It does not handle more complex XMLs because I wanted the example to be short, but this technique can be used to parse any XML documents.</p>\n\n<p>Create an <a href=\"https://golang.org/pkg/encoding/xml/#Decoder\" rel=\"nofollow noreferrer\"><code>xml.Decoder</code></a> using <a href=\"https://golang.org/pkg/encoding/xml/#NewDecoder\" rel=\"nofollow noreferrer\"><code>xml.NewDecoder()</code></a>, and parse the content of the XML by calling <a href=\"https://golang.org/pkg/encoding/xml/#Decoder.Token\" rel=\"nofollow noreferrer\"><code>Decoder.Token()</code></a> repeatedly (in a loop).</p>\n\n<p>The elements inside <code>&lt;val&gt;</code> will be collected in a slice of type <code>[]Entry</code>:</p>\n\n<pre><code>type Entry struct {\n    Name  string\n    Attr  string\n    Value string\n}\n\nfunc main() {\n    decoder := xml.NewDecoder(strings.NewReader(src))\n\n    entries := []Entry{}\n    for {\n        t, err := decoder.Token()\n        if err != nil {\n            if err != io.EOF {\n                fmt.Println(err)\n            }\n            break\n        }\n        if se, ok := t.(xml.StartElement); ok &amp;&amp; len(se.Attr) &gt; 0 {\n            entries = append(entries, Entry{\n                Name:  se.Name.Local,\n                Attr:  se.Attr[0].Name.Local,\n                Value: se.Attr[0].Value,\n            })\n        }\n    }\n\n    fmt.Printf(\"%+v\\n\", entries)\n}\n\nconst src = `&lt;val&gt;\n&lt;alpha \u03b2='\u03b3'/&gt;\n&lt;\u03b1 \u03b4='\u03b5'/&gt;\n&lt;x y='z'/&gt;\n&lt;/val&gt;`\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/VY-o5aGKS3\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[{Name:alpha Attr:\u03b2 Value:\u03b3} {Name:\u03b1 Attr:\u03b4 Value:\u03b5} {Name:x Attr:y Value:z}]\n</code></pre>\n"}], "owner": {"reputation": 3142, "user_id": 2474792, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/327964b28dd74fd6bbbe669aac4edf04?s=128&d=identicon&r=PG", "display_name": "Demi", "link": "https://stackoverflow.com/users/2474792/demi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1481014970, "creation_date": 1480999494, "question_id": 40987994, "link": "https://stackoverflow.com/questions/40987994/unmarshalling-heterogeneous-list-of-xml-elements-in-go", "title": "Unmarshalling heterogeneous list of XML elements in Go", "body": "<p>I have an XML document like this:</p>\n\n<pre><code>&lt;val&gt;\n&lt;alpha \u03b2='\u03b3'/&gt;\n&lt;\u03b1 \u03b4='\u03b5'/&gt;\n(a whole bunch of the above, in random order)\n&lt;/val&gt;\n</code></pre>\n\n<p>in other words, a heterogeneous list.  I would like to unmarshal it using the Go <code>encoding/xml</code> package.  How can I do this?</p>\n"}, {"tags": ["regex", "perl", "go"], "comments": [{"owner": {"reputation": 129, "user_id": 6669003, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d6d8f0db03cf2468997a8765218fea2e?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya J.", "link": "https://stackoverflow.com/users/6669003/aditya-j"}, "edited": false, "score": 0, "creation_date": 1480989607, "post_id": 40986527, "comment_id": 69182418, "body": "<code>&#47;(a.c*?)$&#47;</code> matches the last &#39;abc&#39; in &#39;abcabcabc&#39;. Since you are anchoring to the end, the c should be made non-greedy."}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "reply_to_user": {"reputation": 129, "user_id": 6669003, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d6d8f0db03cf2468997a8765218fea2e?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya J.", "link": "https://stackoverflow.com/users/6669003/aditya-j"}, "edited": false, "score": 0, "creation_date": 1480989802, "post_id": 40986527, "comment_id": 69182479, "body": "@AdityaJ., Nah, you&#39;ve changed the &quot;algorithm&quot;. For your &quot;solution&quot;, even without <code>*?</code>, i.e., <code>&#47;(a.c)$&#47;</code>, it&#39;d still work. But thanks for trying though."}, {"owner": {"reputation": 65435, "user_id": 2206004, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HCB1e.png?s=128&g=1", "display_name": "hwnd", "link": "https://stackoverflow.com/users/2206004/hwnd"}, "edited": false, "score": 0, "creation_date": 1480989966, "post_id": 40986527, "comment_id": 69182521, "body": "Using <code>.*?</code> the regex engine starts matching the minimum number of characters allowed by the quantifier\u2014which is <b>zero</b>. The engine then advances and tries the next token. This fails, so the engine backtracks and expands its match. The process repeats itself\u2014the regex engine advances, fails, backtracks, expand its match again, advances, fails, ... this is a case for negation <code>&#47;a[^a]*c$&#47;</code>"}], "answers": [{"tags": [], "owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "is_accepted": true, "score": 7, "last_activity_date": 1480996476, "last_edit_date": 1480996476, "creation_date": 1480992832, "answer_id": 40987052, "question_id": 40986527, "link": "https://stackoverflow.com/questions/40986527/regex-of-a-non-greedy-match-different-behavior/40987052#40987052", "title": "Regex of a non-greedy match different behavior", "body": "<blockquote>\n<pre><code>$ echo abcabcabc | perl -ne 'print $1 if /(a.*?c)$/'\nabcabcabc\n# what, non-greedy become greedy?\n</code></pre>\n</blockquote>\n\n<p>Non-greedy means it'll match the fewest characters possible <em>at the current location</em> such that the entire pattern matches.</p>\n\n<p>After matching <code>a</code> at position <code>0</code>, <code>bcabcab</code> is the least <code>.*?</code> can match at position <code>1</code> while still satisfying the rest of the pattern.</p>\n\n<p><code>\"abcabcabc\" = /a.*?c$/</code> in detail:</p>\n\n<ol>\n<li>At pos 0, <code>a</code> matches 1 char (<code>a</code>).\n\n<ol>\n<li>At pos 1, <code>.*?</code> matches 0 chars (empty string).\n\n<ol>\n<li>At pos 1, <code>c</code> fails to match. Backtrack!</li>\n</ol></li>\n<li>At pos 1, <code>.*?</code> matches 1 char (<code>b</code>).\n\n<ol>\n<li>At pos 2, <code>c</code> matches 1 char (<code>c</code>).\n\n<ol>\n<li>At pos 3, <code>$</code> fails to match. Backtrack!</li>\n</ol></li>\n</ol></li>\n<li>At pos 1, <code>.*?</code> matches 2 chars (<code>bc</code>).\n\n<ol>\n<li>At pos 1, <code>c</code> fails to match. Backtrack!</li>\n</ol></li>\n<li>...</li>\n<li>At pos 1, <code>.*?</code> matches 7 chars (<code>bcabcab</code>).\n\n<ol>\n<li>At pos 8, <code>c</code> matches 1 char (<code>c</code>).\n\n<ol>\n<li>At pos 9, <code>$</code> matches 0 chars (empty string). Match successful!</li>\n</ol></li>\n</ol></li>\n</ol></li>\n</ol>\n\n<p><code>\"abcabcabc\" = /a.*c$/</code> in detail (for contrast):</p>\n\n<ol>\n<li>At pos 0, <code>a</code> matches 1 char (<code>a</code>).\n\n<ol>\n<li>At pos 1, <code>.*</code> matches 8 chars (<code>abcabcabc</code>).\n\n<ol>\n<li>At pos 9, <code>c</code> fails to match. Backtrack!</li>\n</ol></li>\n<li>At pos 1, <code>.*</code> matches 7 chars (<code>abcabcab</code>).\n\n<ol>\n<li>At pos 8, <code>c</code> matches 1 char (<code>c</code>).\n\n<ol>\n<li>At pos 9, <code>$</code> matches 0 chars (empty string). Match successful!</li>\n</ol></li>\n</ol></li>\n</ol></li>\n</ol>\n\n<p>Tip: Avoid patterns with two instances of a non-greediness modifier. Unless you are using them as an optimization, there's a good chance they can match something you don't want them to match. This is relevant here because patterns implicitly start with <code>\\G(?s:.*?)\\K</code> (unless cancelled out by a leading <code>^</code>, <code>\\A</code> or <code>\\G</code>).</p>\n\n<p>What you want is one of the following:</p>\n\n<pre><code>/a[^a]*c$/\n/a[^c]*c$/\n/a[^ac]*c$/\n</code></pre>\n\n<p>You could also use one of the following:</p>\n\n<pre><code>/a(?:(?!a).)c$/s\n/a(?:(?!c).)c$/s\n/a(?:(?!a|c).)c$/s\n</code></pre>\n\n<p>It would be inefficient and unreadable to use these latter three in this situation, but they will work with boundaries that are longer than one character.</p>\n"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 40987052, "answer_count": 1, "score": 3, "last_activity_date": 1480996476, "creation_date": 1480989154, "question_id": 40986527, "link": "https://stackoverflow.com/questions/40986527/regex-of-a-non-greedy-match-different-behavior", "title": "Regex of a non-greedy match different behavior", "body": "<p>I found that non-greedy regex match only become non-greedy when anchoring to the front, not to the end:</p>\n\n<pre><code>$ echo abcabcabc | perl -ne 'print $1 if /^(a.*c)/'\nabcabcabc\n# OK, greedy match\n\n$ echo abcabcabc | perl -ne 'print $1 if /^(a.*?c)/'\nabc\n# YES! non-greedy match\n</code></pre>\n\n<p>Now look at this, when anchoring to the end:</p>\n\n<pre><code>$ echo abcabcabc | perl -ne 'print $1 if /(a.*c)$/'\nabcabcabc\n# OK, greedy match\n\n$ echo abcabcabc | perl -ne 'print $1 if /(a.*?c)$/'\nabcabcabc\n# what, non-greedy become greedy?\n</code></pre>\n\n<p>why is that? how come it doesn't print <code>abc</code> as before? </p>\n\n<p>(The problem was found in my Go code, but illustrated in Perl for simplicity). </p>\n"}, {"tags": ["postgresql", "go", "beego"], "comments": [{"owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 1, "creation_date": 1480989211, "post_id": 40986407, "comment_id": 69182329, "body": "High probability that DB expects a different date/time format. For example RFC3339. Try saving instead of time.Now() with  time.Now().Format(time.RFC3339)"}, {"owner": {"reputation": 37, "user_id": 7239078, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/39a73253e39d7669f7ee20bb625f6c6c?s=128&d=identicon&r=PG&f=1", "display_name": "rajesh kumar", "link": "https://stackoverflow.com/users/7239078/rajesh-kumar"}, "reply_to_user": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 0, "creation_date": 1480994242, "post_id": 40986407, "comment_id": 69183637, "body": "Thanks mpmlj .Its working.Saved my day....."}, {"owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 0, "creation_date": 1480995304, "post_id": 40986407, "comment_id": 69183895, "body": "awesome!! Moving to an actual answer for others to use as well."}], "answers": [{"tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": true, "score": 3, "last_activity_date": 1480995259, "creation_date": 1480995259, "answer_id": 40987382, "question_id": 40986407, "link": "https://stackoverflow.com/questions/40986407/cannot-update-the-timestamp-with-timezone-in-postgres-using-golang/40987382#40987382", "title": "Cannot update the timestamp with timezone in postgres using golang", "body": "<p>High probability that DB expects a different date/time format. For example RFC3339. Try saving instead of time.Now() with time.Now().Format(time.RFC3339)</p>\n"}], "owner": {"reputation": 37, "user_id": 7239078, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/39a73253e39d7669f7ee20bb625f6c6c?s=128&d=identicon&r=PG&f=1", "display_name": "rajesh kumar", "link": "https://stackoverflow.com/users/7239078/rajesh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2421, "favorite_count": 1, "accepted_answer_id": 40987382, "answer_count": 1, "score": 1, "last_activity_date": 1480995259, "creation_date": 1480988257, "last_edit_date": 1480988992, "question_id": 40986407, "link": "https://stackoverflow.com/questions/40986407/cannot-update-the-timestamp-with-timezone-in-postgres-using-golang", "title": "Cannot update the timestamp with timezone in postgres using golang", "body": "<p>I am using golang and postgreSQL version 9.5.5 in my application. I am using \"github.com/lib/pq\" as my database driver to connect to the database. One of my fields have the type timestamp with timezone. I would like to update to the current time. So I used the following code:</p>\n\n<blockquote>\n  <p>Note:I m using beego as my framework and use orm to compute my\n  queries.</p>\n</blockquote>\n\n<pre><code>_, err := o.Raw(\"UPDATE leave SET resultdate=? WHERE leaveid=?\",  time.Now(), leaveResult.LeaveId).Exec()\n</code></pre>\n\n<p>When I execute this I'm getting the following error:</p>\n\n<pre><code>\"pq: invalid input syntax for type timestamp with time zone: \\\"09:24:29\\\"\"\n</code></pre>\n\n<p>Appreciate any help.</p>\n"}, {"tags": ["go", "cors", "gorilla", "servemux"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1480985844, "post_id": 40985920, "comment_id": 69181475, "body": "Jup: <a href=\"http://www.gorillatoolkit.org/pkg/handlers#AllowedOrigins\" rel=\"nofollow noreferrer\">gorillatoolkit.org/pkg/handlers#AllowedOrigins</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1480985891, "post_id": 40985920, "comment_id": 69181484, "body": "Crossposted at <a href=\"https://groups.google.com/forum/#!topic/gorilla-web/T3ICTbJaly4\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/gorilla-web/T3ICTbJaly4</a>"}], "answers": [{"comments": [{"owner": {"reputation": 696, "user_id": 7250580, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2VtZT.jpg?s=128&g=1", "display_name": "jeremiah.trein", "link": "https://stackoverflow.com/users/7250580/jeremiah-trein"}, "edited": false, "score": 7, "creation_date": 1482537324, "post_id": 40987389, "comment_id": 69821337, "body": "Just some bookkeeping: Safari likes to send along the <code>Content-Type</code> request header when performing a &quot;non-standard&quot; operation (e.g. <code>PUT</code>), so you&#39;ll want to make your CORS headers allow <code>Content-Type</code> as well.  <code>headersOk := handlers.AllowedHeaders([]string{&quot;X-Requested-With&quot;, &quot;Content-Type&quot;})</code>  <a href=\"https://github.com/gorilla/handlers/blob/master/cors.go#L170\" rel=\"nofollow noreferrer\">related reference in Gorilla CORS package</a>"}], "tags": [], "owner": {"reputation": 696, "user_id": 7250580, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2VtZT.jpg?s=128&g=1", "display_name": "jeremiah.trein", "link": "https://stackoverflow.com/users/7250580/jeremiah-trein"}, "is_accepted": true, "score": 60, "last_activity_date": 1561191747, "last_edit_date": 1561191747, "creation_date": 1480995293, "answer_id": 40987389, "question_id": 40985920, "link": "https://stackoverflow.com/questions/40985920/making-golang-gorilla-cors-handler-work/40987389#40987389", "title": "Making golang Gorilla CORS handler work", "body": "<p>Please read the link Markus suggested, and also about what triggers CORS pre-flight requests. </p>\n\n<p><strong>Pre-flight requests</strong>: You may have a content type like JSON, or some other custom header that's triggering a pre-flight request, which your server may not be handling. Try adding this one, if you're using the ever-common AJAX in your front-end: <a href=\"https://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Requested-With\" rel=\"noreferrer\">https://en.wikipedia.org/wiki/List_of_HTTP_header_fields#Requested-With</a></p>\n\n<p>Gorilla's <code>handlers.CORS()</code> will set sane defaults to get the basics of CORS working for you; however, you can (and maybe should) take control in a more functional manner.</p>\n\n<h2>Here's some starter code:</h2>\n\n<pre><code>// Where ORIGIN_ALLOWED is like `scheme://dns[:port]`, or `*` (insecure)\nheadersOk := handlers.AllowedHeaders([]string{\"X-Requested-With\"})\noriginsOk := handlers.AllowedOrigins([]string{os.Getenv(\"ORIGIN_ALLOWED\")})\nmethodsOk := handlers.AllowedMethods([]string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"OPTIONS\"})\n\n// start server listen\n// with error handling\nlog.Fatal(http.ListenAndServe(\":\" + os.Getenv(\"PORT\"), handlers.CORS(originsOk, headersOk, methodsOk)(router)))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16685, "user_id": 1229624, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/33221e57892f65c519a16ff5cd30f874?s=128&d=identicon&r=PG", "display_name": "Aminadav Glickshtein", "link": "https://stackoverflow.com/users/1229624/aminadav-glickshtein"}, "is_accepted": false, "score": 20, "last_activity_date": 1480995513, "last_edit_date": 1495542858, "creation_date": 1480995513, "answer_id": 40987420, "question_id": 40985920, "link": "https://stackoverflow.com/questions/40985920/making-golang-gorilla-cors-handler-work/40987420#40987420", "title": "Making golang Gorilla CORS handler work", "body": "<p>You should create a <code>CORSOption</code> object. For example to allow any origin, Use this code:</p>\n\n<pre><code>corsObj:=handlers.AllowedOrigins([]string{\"*\"})\n</code></pre>\n\n<p>Then you pass this object to your <code>handle.CORS</code> function:</p>\n\n<pre><code>log.Fatal(http.ListenAndServe(\":3000\", handlers.CORS(corsObj)(router)))\n</code></pre>\n\n<p>For testing it you can use CURL:</p>\n\n<pre><code>curl -H \"Origin: http://example.com\" \\\n-H \"Access-Control-Request-Method: POST\" \\\n-H \"Access-Control-Request-Headers: X-Requested-With\" \\\n-X OPTIONS --verbose http://127.0.0.1:3000\n</code></pre>\n\n<p>When it works you should see those headers:</p>\n\n<pre><code>&gt; Accept: */*\n&gt; Origin: http://example.com\n&gt; Access-Control-Request-Method: POST\n&gt; Access-Control-Request-Headers: X-Requested-With\n</code></pre>\n\n<hr>\n\n<p>Final code is here: <a href=\"https://play.golang.org/p/AOrlJsWhvf\" rel=\"noreferrer\">https://play.golang.org/p/AOrlJsWhvf</a></p>\n\n<h3>More info:</h3>\n\n<ul>\n<li><a href=\"http://www.gorillatoolkit.org/pkg/handlers#AllowedOrigins\" rel=\"noreferrer\">AllowedOrigin function</a></li>\n<li><a href=\"https://stackoverflow.com/questions/12173990/how-can-you-debug-a-cors-request-with-curl\">How can you debug a CORS request with cURL?</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 17856, "user_id": 1439168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd72ad672b055a7d59cfb1c30d1c724f?s=128&d=identicon&r=PG", "display_name": "Miguel Mota", "link": "https://stackoverflow.com/users/1439168/miguel-mota"}, "edited": false, "score": 0, "creation_date": 1515122085, "post_id": 44959519, "comment_id": 83189051, "body": "Thanks, using github.com/rs/cors was easiest and works"}, {"owner": {"reputation": 113, "user_id": 11887481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kTYZQ.jpg?s=128&g=1", "display_name": "itsdilunga", "link": "https://stackoverflow.com/users/11887481/itsdilunga"}, "edited": false, "score": 0, "creation_date": 1608018605, "post_id": 44959519, "comment_id": 115446531, "body": "This is much leaner and really awesome...Thanks a lot dude! @from_Tanzania"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user5906464"}, "is_accepted": false, "score": 27, "last_activity_date": 1596941791, "last_edit_date": 1596941791, "creation_date": 1499378232, "answer_id": 44959519, "question_id": 40985920, "link": "https://stackoverflow.com/questions/40985920/making-golang-gorilla-cors-handler-work/44959519#44959519", "title": "Making golang Gorilla CORS handler work", "body": "<p>You can get more details here: <a href=\"https://stackoverflow.com/questions/20035101/no-access-control-allow-origin-header-is-present-on-the-requested-resource/42744707#42744707\">Why doesn\u2019t Postman get a &quot;No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource&quot; error when my JavaScript code does?</a> about this issue.</p>\n<p>Also try this handler: <a href=\"https://github.com/rs/cors/blob/master/README.md\" rel=\"noreferrer\">Go Cors Handler</a>  which should solve your issue. I find this much cleaner and easy to resolve the issue.</p>\n<pre><code>package main\n\nimport (\n    &quot;log&quot;\n    &quot;net/http&quot;\n    &quot;github.com/rs/cors&quot;\n    &quot;github.com/gorilla/handlers&quot;\n    &quot;github.com/gorilla/mux&quot;\n    &quot;myApp/src/controllers&quot;\n)\n\nfunc main() {\n    ac := new(controllers.AccountController)\n\n    router := mux.NewRouter()\n    router.HandleFunc(&quot;/signup&quot;, ac.SignUp).Methods(&quot;POST&quot;)\n    router.HandleFunc(&quot;/signin&quot;, ac.SignIn).Methods(&quot;POST&quot;)\n\n    c := cors.New(cors.Options{\n        AllowedOrigins: []string{&quot;http://localhost:8000&quot;},\n        AllowCredentials: true,\n    })\n\n    handler := c.Handler(router)\n    log.Fatal(http.ListenAndServe(&quot;:3000&quot;, handler)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "is_accepted": false, "score": 3, "last_activity_date": 1539717975, "creation_date": 1539717975, "answer_id": 52842717, "question_id": 40985920, "link": "https://stackoverflow.com/questions/40985920/making-golang-gorilla-cors-handler-work/52842717#52842717", "title": "Making golang Gorilla CORS handler work", "body": "<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/handlers\"\n    \"github.com/gorilla/mux\"\n    \"myApp/src/controllers\"\n       \"github.com/rs/cors\"\n)\n\nfunc main() {\n\n     ac := new(controllers.AccountController)\n\n    router := mux.NewRouter()\n    router.HandleFunc(\"/signup\", ac.SignUp).Methods(\"POST\")\n    router.HandleFunc(\"/signin\", ac.SignIn).Methods(\"POST\")\n//cors optionsGoes Below\ncorsOpts := cors.New(cors.Options{\n    AllowedOrigins: []string{\"http://localhost:8100\"}, //you service is available and allowed for this base url \n    AllowedMethods: []string{\n        http.MethodGet,//http methods for your app\n        http.MethodPost,\n        http.MethodPut,\n        http.MethodPatch,\n        http.MethodDelete,\n        http.MethodOptions,\n        http.MethodHead,\n    },\n\n    AllowedHeaders: []string{\n        \"*\",//or you can your header key values which you are using in your application\n\n    },\n})\n\n    http.ListenAndServe(\":3000\", corsOpts.Handler(router))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 934, "user_id": 2152417, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/SisW2.jpg?s=128&g=1", "display_name": "John Galt", "link": "https://stackoverflow.com/users/2152417/john-galt"}, "edited": false, "score": 0, "creation_date": 1615544234, "post_id": 59471343, "comment_id": 117729224, "body": "My issue was with not handling the actual request for &quot;OPTIONS&quot;, so sticking a return response in the middleware like you have done makes sense."}], "tags": [], "owner": {"reputation": 397, "user_id": 4997793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5dkyN.jpg?s=128&g=1", "display_name": "Nima Ghoroubi", "link": "https://stackoverflow.com/users/4997793/nima-ghoroubi"}, "is_accepted": false, "score": 3, "last_activity_date": 1577204609, "creation_date": 1577204609, "answer_id": 59471343, "question_id": 40985920, "link": "https://stackoverflow.com/questions/40985920/making-golang-gorilla-cors-handler-work/59471343#59471343", "title": "Making golang Gorilla CORS handler work", "body": "<p>After declaring the mux object, add the accessControlMiddleware as a middleware to the declared object.</p>\n\n<pre><code>func main(){\n  ac := new(controllers.AccountController)\n\n    router := mux.NewRouter()\n    router.Use(accessControlMiddleware)\n    router.HandleFunc(\"/signup\", ac.SignUp).Methods(\"POST\")\n    router.HandleFunc(\"/signin\", ac.SignIn).Methods(\"POST\")\n    http.ListenAndServe(\":3000\", corsOpts.Handler(router))\n}\n\n// access control and  CORS middleware\nfunc accessControlMiddleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n            w.Header().Set(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS,PUT\")\n            w.Header().Set(\"Access-Control-Allow-Headers\", \"Origin, Content-Type\")\n\n                if r.Method == \"OPTIONS\" {\n                    return\n                }\n\n                next.ServeHTTP(w, r)\n            })\n        }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "is_accepted": false, "score": 3, "last_activity_date": 1583488914, "last_edit_date": 1583488914, "creation_date": 1577788420, "answer_id": 59542906, "question_id": 40985920, "link": "https://stackoverflow.com/questions/40985920/making-golang-gorilla-cors-handler-work/59542906#59542906", "title": "Making golang Gorilla CORS handler work", "body": "<p>I realize this is an old issue but nonetheless it took me 30min to get this right.</p>\n\n<pre><code>handler = handlers.CORS(\n    // handlers.AllowedMethods([]string{\"GET\", \"POST\", \"PUT\"}),\n    handlers.AllowedHeaders([]string{\"Accept\", \"Accept-Language\", \"Content-Type\", \"Content-Language\", \"Origin\"}),\n    // handlers.AllowedOrigins([]string{\"*\"}),\n)(handler)\n</code></pre>\n\n<p>Things to note:</p>\n\n<ul>\n<li>AllowedMethods does NOT need to explicitly include <code>OPTIONS</code>, this is part of the CORS handler</li>\n<li>AllowedHeaders need to be explicitly mentioned, <code>*</code> is not a valid wildcard. Typical ajax libraries will send <code>Content-Type</code> when requesting something like <code>application/json</code>, so add that as well.</li>\n<li><code>*</code> is the default for AllowedOrigin</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 4155, "user_id": 4163254, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/zv1t7.jpg?s=128&g=1", "display_name": "avi.elkharrat", "link": "https://stackoverflow.com/users/4163254/avi-elkharrat"}, "is_accepted": false, "score": 4, "last_activity_date": 1583186004, "creation_date": 1583186004, "answer_id": 60497206, "question_id": 40985920, "link": "https://stackoverflow.com/questions/40985920/making-golang-gorilla-cors-handler-work/60497206#60497206", "title": "Making golang Gorilla CORS handler work", "body": "<p>Base on jeremiah.trein's answer.</p>\n\n<p>CORS filters are set on server side. Request may work with Postman and fail with a browser because Postman doesn't send preflight request whereas a browser does.</p>\n\n<p>Setting the CORS filters will allow you to configure the origins, methods and headers that the backend shall accept.</p>\n\n<p>In addition, if your browser emits POST or PUT requests that contain a json payload (which is quite reasonnable), you'll need to add <code>'Content-Type'</code> to the allowed headers.</p>\n\n<p>Finally the <code>handlers.CORS()(router)</code>  does not only work with the <code>http.ListenAndServe</code> function but also with <code>http.Handle()</code>.</p>\n\n<p>The snippet of code might as well look like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>router := mux.NewRouter()\n\n// do all your routes declaration\n\nheadersOK := handlers.AllowedHeaders([]string{\"X-Requested-With\", \"Content-Type\"})\noriginsOK := handlers.AllowedOrigins([]string{\"*\"})\nmethodsOK := handlers.AllowedMethods([]string{\"GET\", \"POST\", \"OPTIONS\", \"DELETE\", \"PUT\"})\n\nhttp.Handle(\"/\", handlers.CombinedLoggingHandler(os.Stderr, handlers.CORS(headersOK, originsOK, methodsOK)(router)))\n</code></pre>\n\n<p>It is worth mentionning that i have successfuly used this snippet of code in a Google Cloud Platform Standard AppEngine (and I believe it would work in a Flex AppEngine as well).</p>\n"}], "owner": {"reputation": 27333, "user_id": 309343, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0af367dc4d144a1580cac9500a29f16f?s=128&d=identicon&r=PG", "display_name": "Moon", "link": "https://stackoverflow.com/users/309343/moon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39161, "favorite_count": 9, "accepted_answer_id": 40987389, "answer_count": 7, "score": 39, "last_activity_date": 1596941791, "creation_date": 1480984811, "question_id": 40985920, "link": "https://stackoverflow.com/questions/40985920/making-golang-gorilla-cors-handler-work", "title": "Making golang Gorilla CORS handler work", "body": "<p>I have fairly simple setup here as described in the code below. But I am not able to get the <code>CORS</code> to work. I keep getting this error:</p>\n\n<blockquote>\n  <p>XMLHttpRequest cannot load <a href=\"http://localhost:3000/signup\" rel=\"noreferrer\">http://localhost:3000/signup</a>. Response to \n      preflight request doesn't pass access control check: No 'Access-\n      Control-Allow-Origin' header is present on the requested resource. \n      Origin '<a href=\"http://localhost:8000\" rel=\"noreferrer\">http://localhost:8000</a>' is therefore not allowed access. The \n      response had HTTP status code 403.</p>\n</blockquote>\n\n<p>I am sure I am missing something simple here.</p>\n\n<p>Here is the code I have:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/handlers\"\n    \"github.com/gorilla/mux\"\n    \"myApp/src/controllers\"\n)\n\nfunc main() {\n    ac := new(controllers.AccountController)\n\n    router := mux.NewRouter()\n    router.HandleFunc(\"/signup\", ac.SignUp).Methods(\"POST\")\n    router.HandleFunc(\"/signin\", ac.SignIn).Methods(\"POST\")\n\n    log.Fatal(http.ListenAndServe(\":3000\", handlers.CORS()(router)))\n}\n</code></pre>\n"}, {"tags": ["unix", "go"], "answers": [{"tags": [], "owner": {"reputation": 905, "user_id": 3781709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd4fa60c6b287ee4f006d6c4e320daf5?s=128&d=identicon&r=PG", "display_name": "Pradip Patil", "link": "https://stackoverflow.com/users/3781709/pradip-patil"}, "is_accepted": true, "score": 3, "last_activity_date": 1480990328, "last_edit_date": 1495541322, "creation_date": 1480990328, "answer_id": 40986705, "question_id": 40985556, "link": "https://stackoverflow.com/questions/40985556/what-does-syscall-stat-t-dev-map-to/40986705#40986705", "title": "What does syscall.Stat_t.Dev map to?", "body": "<p><code>syscall.Stat_t.Dev</code> represents the ID of device on which the given file resides. So it's not internal to Go. You can find it using <code>stat</code> command like,</p>\n\n<pre><code>stat --format=%d &lt;filename&gt;\n</code></pre>\n\n<p>See <a href=\"https://stackoverflow.com/questions/4309882/device-number-in-stat-command-output\">this thread</a> for more about device numbers.</p>\n"}], "owner": {"reputation": 245, "user_id": 4867444, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/faa0e6c29ebb965a8c6a87b02aacb155?s=128&d=identicon&r=PG&f=1", "display_name": "user4867444", "link": "https://stackoverflow.com/users/4867444/user4867444"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 40986705, "answer_count": 1, "score": 2, "last_activity_date": 1480990328, "creation_date": 1480982297, "question_id": 40985556, "link": "https://stackoverflow.com/questions/40985556/what-does-syscall-stat-t-dev-map-to", "title": "What does syscall.Stat_t.Dev map to?", "body": "<p>Golang's <code>syscall.Stat_t</code> has a <code>Dev</code> field, which I assume identifies the disk/device, see <a href=\"https://golang.org/src/syscall/ztypes_linux_amd64.go?s=1392:1688#L91\" rel=\"nofollow noreferrer\">https://golang.org/src/syscall/ztypes_linux_amd64.go?s=1392:1688#L91</a></p>\n\n<p>For example, for a <code>syscall.Stat_t</code> structure mapping to a file on my disk, <code>Dev</code> has value <code>51713</code>; my question is: is that ID purely internal to Go? Or does it map to some OS ID (in which case, which one, and how can I see it with standard Unix CLI tools?)</p>\n"}, {"tags": ["python", "go", "checksum", "modulo", "adler32"], "comments": [{"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1480980609, "post_id": 40985080, "comment_id": 69180092, "body": "Your subtraction is wrapping around."}, {"owner": {"reputation": 1753, "user_id": 628786, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c77ddd8c28e9acc0fe219dcb4f2a189e?s=128&d=identicon&r=PG", "display_name": "user48678", "link": "https://stackoverflow.com/users/628786/user48678"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1480980695, "post_id": 40985080, "comment_id": 69180115, "body": "How would you fix the code?"}, {"owner": {"reputation": 22202, "user_id": 696391, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VrUwT.jpg?s=128&g=1", "display_name": "samgak", "link": "https://stackoverflow.com/users/696391/samgak"}, "edited": false, "score": 0, "creation_date": 1480985497, "post_id": 40985080, "comment_id": 69181381, "body": "You get the same discrepancy (0xe10000) in the Python code if you apply a 32 bit mask in the calculation of b like this: <code>b = ((b - (n*leave) - 1 + a) &amp; 0xffffffff) % MOD</code>"}], "answers": [{"tags": [], "owner": {"reputation": 75043, "user_id": 84270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da2c0de47c3681c58f25b1eb821f7221?s=128&d=identicon&r=PG", "display_name": "John Machin", "link": "https://stackoverflow.com/users/84270/john-machin"}, "is_accepted": false, "score": 0, "last_activity_date": 1480984095, "creation_date": 1480984095, "answer_id": 40985810, "question_id": 40985080, "link": "https://stackoverflow.com/questions/40985080/why-does-my-rolling-adler32-checksum-not-work-in-go-modulo-arithmetic/40985810#40985810", "title": "Why does my rolling adler32 checksum not work in go? (modulo arithmetic)", "body": "<p>I don't know go, but here are some possibilities:</p>\n\n<pre><code>b := adler &gt;&gt; 16 change to b := (adler &gt;&gt; 16) &amp; 0xffff\n\nb = (b - n*leave - 1 + a) % MOD ... what happens if expression in () is negative?\n\nreturn b&lt;&lt;16 | a ... check operator precedence; (b&lt;&lt;16)|a or b&lt;&lt;(16|a) ?\n\n32-bit machine or 64-bit?\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 22202, "user_id": 696391, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VrUwT.jpg?s=128&g=1", "display_name": "samgak", "link": "https://stackoverflow.com/users/696391/samgak"}, "edited": false, "score": 0, "creation_date": 1480998787, "post_id": 40986904, "comment_id": 69184743, "body": "You also need to take the different handling of negative modulo dividends between python and go into account. <a href=\"https://play.golang.org/p/R87XWewRPY\" rel=\"nofollow noreferrer\">play.golang.org/p/R87XWewRPY</a> (ignores the n*leave overflow)"}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1481001796, "post_id": 40986904, "comment_id": 69185671, "body": "&quot;The code in both languages can give erroneous results if n*leave is large enough to wrap the integer type being used.&quot; - Python uses arbitrary-precision integers, so overflow isn&#39;t a problem in Python."}, {"owner": {"reputation": 78348, "user_id": 1180620, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/FXaAg.jpg?s=128&g=1", "display_name": "Mark Adler", "link": "https://stackoverflow.com/users/1180620/mark-adler"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1481005969, "post_id": 40986904, "comment_id": 69187083, "body": "@user2357112 Thanks. Fixed that."}, {"owner": {"reputation": 1753, "user_id": 628786, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c77ddd8c28e9acc0fe219dcb4f2a189e?s=128&d=identicon&r=PG", "display_name": "user48678", "link": "https://stackoverflow.com/users/628786/user48678"}, "edited": false, "score": 2, "creation_date": 1481007856, "post_id": 40986904, "comment_id": 69187896, "body": "Wow an answer from the author of the checksum himself! Thank you very much for your clear explanation."}, {"owner": {"reputation": 1753, "user_id": 628786, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c77ddd8c28e9acc0fe219dcb4f2a189e?s=128&d=identicon&r=PG", "display_name": "user48678", "link": "https://stackoverflow.com/users/628786/user48678"}, "edited": false, "score": 0, "creation_date": 1481014310, "post_id": 40986904, "comment_id": 69191095, "body": "In order to make sure that <code>n*leave</code> does not wrap, I guess I can replace it with <code>n*leave % MOD == n%MOD*leave</code>, which is the same as doing <code>n%=MOD</code> prior to the whole operation."}], "tags": [], "owner": {"reputation": 78348, "user_id": 1180620, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/FXaAg.jpg?s=128&g=1", "display_name": "Mark Adler", "link": "https://stackoverflow.com/users/1180620/mark-adler"}, "is_accepted": true, "score": 4, "last_activity_date": 1481005957, "last_edit_date": 1481005957, "creation_date": 1480991707, "answer_id": 40986904, "question_id": 40985080, "link": "https://stackoverflow.com/questions/40985080/why-does-my-rolling-adler32-checksum-not-work-in-go-modulo-arithmetic/40986904#40986904", "title": "Why does my rolling adler32 checksum not work in go? (modulo arithmetic)", "body": "<p>The integers in Python are signed. You declared all the integers in the golang version to be unsigned. That's the difference.</p>\n\n<p>When an unsigned number is subtracted from a smaller unsigned number, you get a huge unsigned number that gives a different remainder on division than the small negative difference would. When you wrap, you are effectively adding 2<sup>32</sup>. 2<sup>32</sup> mod 65521 is 225, or <code>0xe1</code>, which is why you're seeing that difference in <code>b</code>. It's much more likely to wrap on the <code>b</code> calculation, but it can happen for <code>a</code> as well, if <code>a</code> happens to be very small at that step.</p>\n\n<p>Per the comment by @samgak, you also have to worry about the definition of the % operator in different languages for signed values. So the solution that works across different conventions would be to make the values positive by adding as many <code>MOD</code>s as necessary, before doing the <code>% MOD</code>. For <code>a</code>, just add <code>MOD</code>. For <code>b</code>, add <code>(1 + n * leave / MOD) * MOD</code>.</p>\n\n<p>Take care to make sure that the intermediate values don't overflow. The code in go can give erroneous results if <code>n*leave</code> is large enough to wrap the integer type being used.</p>\n"}], "owner": {"reputation": 1753, "user_id": 628786, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c77ddd8c28e9acc0fe219dcb4f2a189e?s=128&d=identicon&r=PG", "display_name": "user48678", "link": "https://stackoverflow.com/users/628786/user48678"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 1, "accepted_answer_id": 40986904, "answer_count": 2, "score": 2, "last_activity_date": 1481005957, "creation_date": 1480979671, "last_edit_date": 1495542630, "question_id": 40985080, "link": "https://stackoverflow.com/questions/40985080/why-does-my-rolling-adler32-checksum-not-work-in-go-modulo-arithmetic", "title": "Why does my rolling adler32 checksum not work in go? (modulo arithmetic)", "body": "<p>I am implementing, in go, a <a href=\"https://en.wikipedia.org/wiki/Rolling_hash\" rel=\"nofollow noreferrer\">rolling</a> version of the <a href=\"https://en.wikipedia.org/wiki/Adler-32\" rel=\"nofollow noreferrer\">adler32 checksum</a>.</p>\n\n<p>This <a href=\"https://stackoverflow.com/a/20086159/628786\">answer</a> was helpful to double check my maths. However I am struggling at implementing it correctly in golang.</p>\n\n<p>I wrote the following code:</p>\n\n<pre><code>func roll(adler, n, leave, enter uint32) uint32 {\n    a := adler &amp; 0xffff\n    b := adler &gt;&gt; 16\n\n    a = (a + enter - leave) % MOD\n    b = (b - n*leave - 1 + a) % MOD\n    return b&lt;&lt;16 | a\n}\n</code></pre>\n\n<p>It tested it on various inputs and it worked fine, until I decided to run it on random data. Here is a <a href=\"https://play.golang.org/p/VxRqoLcFQr\" rel=\"nofollow noreferrer\">sample</a> where it does not work (I found several of them).</p>\n\n<p>What is baffling me is that the same code in python works perfectly on those inputs:</p>\n\n<pre><code>def roll(adler, n, leave, enter):\n    a = adler &amp; 0xffff\n    b = adler &gt;&gt; 16\n\n    a = (a + enter - leave) % MOD\n    b = (b - n*leave - 1 + a) % MOD\n    return b&lt;&lt;16 | a\n</code></pre>\n\n<p>For good measure, I am including <a href=\"https://repl.it/EhAV/0\" rel=\"nofollow noreferrer\">proof</a> that this works in python. Note that the python checksum matches the non-rolling version of the go checksum (and that part is directly from the go core libraries).</p>\n\n<p>I studied my results on all the other problematic samples, and found that I am never making a mistake on the least significant bits of the checksum (the \"a\" bits). Also, the error is consistently the same, equals to <code>0xe10000</code>. I suspect a peculiarity of how go handles modulo operations on uint32 integers to be the cause of this.</p>\n\n<p>What is happening and how do I fix my code?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "edited": false, "score": 0, "creation_date": 1480973323, "post_id": 40983506, "comment_id": 69176899, "body": "thx, <code>b</code> is a byte not an integer, and I can&#39;t use io.WriteString, for some reason converting b to string doesn&#39;t print anything"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 4, "last_activity_date": 1480973509, "last_edit_date": 1480973509, "creation_date": 1480972636, "answer_id": 40983506, "question_id": 40983475, "link": "https://stackoverflow.com/questions/40983475/write-to-stdout-without-creating-a-buffer/40983506#40983506", "title": "Write to stdout without creating a buffer", "body": "<p>You can do this by simply writing to the <a href=\"https://godoc.org/os#pkg-variables\" rel=\"nofollow noreferrer\"><code>os.Stdout</code></a> file:</p>\n\n<pre><code>var buff [1]byte\nfor i, i &lt; size; i++ {\n    b = a[i] + i * 10\n    buff[0] = b\n    os.Stdout.Write(buff[:])\n}\nbuff[0] = '\\n'\nos.Stdout.Write(buff[:])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 26448, "user_id": 10322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa46a3814b72439b1d2efa8f7c9162c2?s=128&d=identicon&r=PG", "display_name": "ctcherry", "link": "https://stackoverflow.com/users/10322/ctcherry"}, "edited": false, "score": 1, "creation_date": 1480973683, "post_id": 40983606, "comment_id": 69177057, "body": "<code>Printf</code> uses the struct <code>pp</code> internally. It does use a pool of these, but it still will allocate if needed. <a href=\"https://golang.org/src/fmt/print.go?s=5096:5159#L179\" rel=\"nofollow noreferrer\">golang.org/src/fmt/print.go?s=5096:5159#L179</a>"}], "tags": [], "owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "is_accepted": false, "score": 1, "last_activity_date": 1480973017, "creation_date": 1480973017, "answer_id": 40983606, "question_id": 40983475, "link": "https://stackoverflow.com/questions/40983475/write-to-stdout-without-creating-a-buffer/40983606#40983606", "title": "Write to stdout without creating a buffer", "body": "<p>You can use <code>fmt.Printf</code> instead of your <code>fmt.Print(string((b)))</code> like so:</p>\n\n<pre><code> fmt.Printf(\"%c\", b)\n</code></pre>\n"}], "owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2903, "favorite_count": 0, "accepted_answer_id": 40983506, "answer_count": 2, "score": 1, "last_activity_date": 1480973662, "creation_date": 1480972530, "last_edit_date": 1480973662, "question_id": 40983475, "link": "https://stackoverflow.com/questions/40983475/write-to-stdout-without-creating-a-buffer", "title": "Write to stdout without creating a buffer", "body": "<p>Inside a loop I do some calculations and then I want to print a string value from a byte array, once the loop is done print a new line.</p>\n\n<p>Using <code>fmt.Print</code> will allocate a buffer, but all I want to do is print the character to stdout. Is there a way to do that?</p>\n\n<pre><code>for i, i &lt; size; i++ {\n    b = a[i] + i * 10\n    fmt.Print(string((b)))\n}\nfmt.Println()\n</code></pre>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 1287, "user_id": 837173, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/11e601e42c1f51c5f2626d7124323a3f?s=128&d=identicon&r=PG", "display_name": "Sean Lindo", "link": "https://stackoverflow.com/users/837173/sean-lindo"}, "edited": false, "score": 0, "creation_date": 1480999068, "post_id": 40983350, "comment_id": 69184838, "body": "I wanted to stay away from using <code>ioutil.ReadAll</code>, but I&#39;m not sure anything else will work.  <a href=\"https://groups.google.com/forum/#!topic/golang-codereviews/e9bnpB5bpTw\" rel=\"nofollow noreferrer\">This</a> is going to be extremely helpful in 1.8."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1287, "user_id": 837173, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/11e601e42c1f51c5f2626d7124323a3f?s=128&d=identicon&r=PG", "display_name": "Sean Lindo", "link": "https://stackoverflow.com/users/837173/sean-lindo"}, "edited": false, "score": 1, "creation_date": 1481039341, "post_id": 40983350, "comment_id": 69207480, "body": "@sean: If you want the response body, then there&#39;s no reason to avoid <code>ioutil.ReadAll</code>. If you&#39;re worried about buffering too much data, you&#39;re not preventing that with the json.Decoder either. You need to use an <code>io.LimitedReader</code> to stop unexpectedly large responses."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1480972004, "creation_date": 1480972004, "answer_id": 40983350, "question_id": 40983193, "link": "https://stackoverflow.com/questions/40983193/how-do-i-save-the-response-body-when-json-newdecoder-decode-fails/40983350#40983350", "title": "How do I save the response body when `json.NewDecoder.Decode` fails?", "body": "<p>If you want to save the body, then save the body before Unmarshalling.</p>\n\n<pre><code>//...\nbody, err := ioutil.ReadAll(r.Body)\nif err != nil {\n    return err\n}\n\nerr = json.Unmarshal(body, &amp;mr)\n//...\n</code></pre>\n"}], "owner": {"reputation": 1287, "user_id": 837173, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/11e601e42c1f51c5f2626d7124323a3f?s=128&d=identicon&r=PG", "display_name": "Sean Lindo", "link": "https://stackoverflow.com/users/837173/sean-lindo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 795, "favorite_count": 0, "accepted_answer_id": 40983350, "answer_count": 1, "score": 1, "last_activity_date": 1480972004, "creation_date": 1480971476, "question_id": 40983193, "link": "https://stackoverflow.com/questions/40983193/how-do-i-save-the-response-body-when-json-newdecoder-decode-fails", "title": "How do I save the response body when `json.NewDecoder.Decode` fails?", "body": "<p>This gist of this snippet seems to be fairly common in Go:</p>\n\n<pre><code>if err := json.NewDecoder(r.Body).Decode(&amp;mr); err != nil {\n    return mr, err\n}\n</code></pre>\n\n<p>But how do I actually retrieve a string representation of <code>r.Body</code> in event of an error? In this case, it would be advantageous to include this with the error log as opposed to working through the struct only to find that Zip is sometimes a string and sometimes an integer. </p>\n\n<p>Unfortunately, the body has already been closed at this point, so I'm not sure how to access it again. </p>\n\n<p>Preemptively decoding the body to a string, and then later encoding it and attempting the struct mapping seems like an extra step. Is there a better way?</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "edited": false, "score": 4, "creation_date": 1480967268, "post_id": 40981992, "comment_id": 69173774, "body": "I&#39;d suggest you need to add a global time Ticker on to your GameServer struct that gets initialized only once, and change your first select case to <code>s.ticker.C</code>. At the moment you are creating a new ticker every time the run function gets called therefore that will only execute tick in the instance where no other channels have any data in them for at least a second from when run is called, which explains the behavior you are seeing."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1480967373, "post_id": 40981992, "comment_id": 69173837, "body": "You&#39;re creating a new Ticker on every iteration, so your&#39;e leaking resources on top of not having a stable tick interval."}], "answers": [{"comments": [{"owner": {"reputation": 445, "user_id": 2183937, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/fd28b1238d6a1f58e532f6804cc36949?s=128&d=identicon&r=PG", "display_name": "Artur Rychlewicz", "link": "https://stackoverflow.com/users/2183937/artur-rychlewicz"}, "edited": false, "score": 0, "creation_date": 1480967724, "post_id": 40982233, "comment_id": 69174025, "body": "But I only call <code>run</code> once and then it loops until process is killed."}, {"owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "reply_to_user": {"reputation": 445, "user_id": 2183937, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/fd28b1238d6a1f58e532f6804cc36949?s=128&d=identicon&r=PG", "display_name": "Artur Rychlewicz", "link": "https://stackoverflow.com/users/2183937/artur-rychlewicz"}, "edited": false, "score": 1, "creation_date": 1480967840, "post_id": 40982233, "comment_id": 69174091, "body": "still each time the for loop goes over you are creating a new ticker, you could just move the ticker creation outside the for loop, either way, it is creating the ticker every iteration which is the cause of your bug."}, {"owner": {"reputation": 445, "user_id": 2183937, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/fd28b1238d6a1f58e532f6804cc36949?s=128&d=identicon&r=PG", "display_name": "Artur Rychlewicz", "link": "https://stackoverflow.com/users/2183937/artur-rychlewicz"}, "edited": false, "score": 0, "creation_date": 1480967995, "post_id": 40982233, "comment_id": 69174191, "body": "Got it, that indeed works. I misunderstood your comment on top. Thank you :)"}], "tags": [], "owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "is_accepted": true, "score": 3, "last_activity_date": 1480967528, "creation_date": 1480967528, "answer_id": 40982233, "question_id": 40981992, "link": "https://stackoverflow.com/questions/40981992/go-high-performance-communication-between-goroutines/40982233#40982233", "title": "Go - high performance communication between goroutines?", "body": "<p>try this:</p>\n\n<pre><code>type GameServer struct {\n    players map[*Player]bool\n\n    register   chan *Player\n    unregister chan *Player\n\n    broadcast chan []byte\n\n    ticker *time.Ticker //use a single \"global\" *time.Ticker\n\n}\n\nfunc (s *GameServer) broadcastMessage(msg []byte) {\n    for player := range s.players {\n        player.messages &lt;- msg\n    }\n}\n\nfunc (s *GameServer) tick() {\n    s.broadcastMessage([]byte(time.Now().Format(time.RFC1123)))\n}\n\n// question is mostly related to this function\nfunc (s *GameServer) run() {\n    for {\n        select {\n        case _ = &lt;- s.Ticker.C: //use the \"global\" *time.Ticker instead of creating a new one every time\n            s.tick()\n        case client := &lt;-s.register:\n            s.players[client] = true\n        case client := &lt;-s.unregister:\n            delete(s.players, client)\n        case msg := &lt;-s.broadcast:\n            s.broadcastMessage(msg)\n        }\n    }\n}\n</code></pre>\n\n<p>I don't think you want to be creating a new time.Ticker every call to <code>run</code>. The above should fix your problems.</p>\n"}], "owner": {"reputation": 445, "user_id": 2183937, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/fd28b1238d6a1f58e532f6804cc36949?s=128&d=identicon&r=PG", "display_name": "Artur Rychlewicz", "link": "https://stackoverflow.com/users/2183937/artur-rychlewicz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1032, "favorite_count": 0, "accepted_answer_id": 40982233, "answer_count": 1, "score": 2, "last_activity_date": 1480967528, "creation_date": 1480966658, "question_id": 40981992, "link": "https://stackoverflow.com/questions/40981992/go-high-performance-communication-between-goroutines", "title": "Go - high performance communication between goroutines?", "body": "<p>I am trying to write a small game server in Go. I basically copied example from WebSocket library (<a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">https://github.com/gorilla/websocket</a>).</p>\n\n<p>Every second, servers executes function <code>s.tick()</code> which sends current time to the user. This works fine when users do not perform any actions.</p>\n\n<p>When a user joins, leaves or sends a message, information is send over one of three channels (one for each action) and corresponding action is executed, however <code>s.tick()</code> is either skipping or delayed. I have noticed, that if users perform actions all the time, <code>s.tick()</code> will never be called.</p>\n\n<p>Here's the output:</p>\n\n<pre><code>Mon, 05 Dec 2016 20:19:11 CET\nMon, 05 Dec 2016 20:19:12 CET\nMon, 05 Dec 2016 20:19:13 CET\nMon, 05 Dec 2016 20:19:15 CET\nMon, 05 Dec 2016 20:19:16 CET\nMon, 05 Dec 2016 20:19:17 CET\n\n-- users joining and leaving\n\nMon, 05 Dec 2016 20:19:25 CET\nMon, 05 Dec 2016 20:19:26 CET\nMon, 05 Dec 2016 20:19:27 CET\nMon, 05 Dec 2016 20:19:28 CET\nMon, 05 Dec 2016 20:19:29 CET\n</code></pre>\n\n<p>I tried to check what is causing so much delay between the actions (none of these actions is taking long time) and my only thought is that:</p>\n\n<ul>\n<li>my code is just bad (very likely)</li>\n<li>Go's channels are slow</li>\n</ul>\n\n<p>I checked time at the beginning of a loop and at the beginning of a case clause and it is often taking more than 200ms to even receive data from channel. Having said that, how can I improve the performance of this solution? I can't seem to be able to have server working well at one tick per second, let alone 60.</p>\n\n<p>Below's snippet of my code:</p>\n\n<pre><code>type GameServer struct {\n    players map[*Player]bool\n\n    register   chan *Player\n    unregister chan *Player\n\n    broadcast chan []byte\n}\n\nfunc (s *GameServer) broadcastMessage(msg []byte) {\n    for player := range s.players {\n        player.messages &lt;- msg\n    }\n}\n\nfunc (s *GameServer) tick() {\n    s.broadcastMessage([]byte(time.Now().Format(time.RFC1123)))\n}\n\n// question is mostly related to this function\nfunc (s *GameServer) run() {\n    for {\n        select {\n        case _ = &lt;-time.NewTicker(time.Second).C:\n            s.tick()\n        case client := &lt;-s.register:\n            s.players[client] = true\n        case client := &lt;-s.unregister:\n            delete(s.players, client)\n        case msg := &lt;-s.broadcast:\n            s.broadcastMessage(msg)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["web", "go", "web-scraping"], "comments": [{"owner": {"reputation": 32697, "user_id": 34208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f98600a959a58d3bd851c12fec2e1f88?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/34208/david"}, "edited": false, "score": 1, "creation_date": 1480961895, "post_id": 40980712, "comment_id": 69170841, "body": "It seems unlikely that a bot protection script would send back a redirect instead of just an error.  What page are they trying to redirect you to?"}, {"owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 1, "creation_date": 1480965903, "post_id": 40980712, "comment_id": 69172952, "body": "Would be great to see your code. Otherwise - Agree with David. Unlikely their response is to blame (and I believe this is confirmed by a successfully working Python script)."}, {"owner": {"reputation": 216447, "user_id": 846892, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/E9dZn.png?s=128&g=1", "display_name": "Ashwini Chaudhary", "link": "https://stackoverflow.com/users/846892/ashwini-chaudhary"}, "edited": false, "score": 1, "creation_date": 1480968208, "post_id": 40980712, "comment_id": 69174310, "body": "Try setting proper request headers, start with <code>User-Agent</code>, <code>Cookie</code> etc. You can get their values from browser&#39;s developer console."}, {"owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 2, "creation_date": 1480968786, "post_id": 40980712, "comment_id": 69174590, "body": "One more hint after looking at Python code: <a href=\"https://github.com/Anorov/cloudflare-scrape/blob/master/cfscrape/__init__.py\" rel=\"nofollow noreferrer\">github.com/Anorov/cloudflare-scrape/blob/master/cfscrape/&hellip;</a> It uses a pool of user agents accessing it by random to prevent throttling you. Just implement a similar approach, even with same user agents. Maybe this is not the <i>only</i> pre-requisite, but definitely one of the key ones."}, {"owner": {"reputation": 43, "user_id": 4014918, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WotpVQkEg5g/AAAAAAAAAAI/AAAAAAAAEtQ/foJcfcM8mT0/photo.jpg?sz=128", "display_name": "Brian Yu", "link": "https://stackoverflow.com/users/4014918/brian-yu"}, "reply_to_user": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 1, "creation_date": 1480993421, "post_id": 40980712, "comment_id": 69183431, "body": "Hi @mpmlj, thanks for your recommendation. I added the random user-agent (and updated the question&#39;s code), but I still am getting that redirect loop. I&#39;ll try playing around with more headers and keep you guys posted."}, {"owner": {"reputation": 43, "user_id": 4014918, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WotpVQkEg5g/AAAAAAAAAAI/AAAAAAAAEtQ/foJcfcM8mT0/photo.jpg?sz=128", "display_name": "Brian Yu", "link": "https://stackoverflow.com/users/4014918/brian-yu"}, "edited": false, "score": 0, "creation_date": 1480994247, "post_id": 40980712, "comment_id": 69183640, "body": "After snooping around the Network chrome tab, NYTimes does indeed use CloudFlare, so I think I will port cloudflare-scrape to Go."}, {"owner": {"reputation": 43, "user_id": 4014918, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WotpVQkEg5g/AAAAAAAAAAI/AAAAAAAAEtQ/foJcfcM8mT0/photo.jpg?sz=128", "display_name": "Brian Yu", "link": "https://stackoverflow.com/users/4014918/brian-yu"}, "reply_to_user": {"reputation": 32697, "user_id": 34208, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f98600a959a58d3bd851c12fec2e1f88?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/34208/david"}, "edited": false, "score": 0, "creation_date": 1480996974, "post_id": 40980712, "comment_id": 69184271, "body": "@David it looks like they&#39;re redirecting me to <code>http:&#47;&#47;www.nytimes.com&#47;glogin?URI=http%3A%2F%2Fwww.nytimes.c&zwnj;&#8203;om%2F2015%2F10%2F25%&zwnj;&#8203;2Fbooks%2Freview%2Ft&zwnj;&#8203;he-tsar-of-love-and-&zwnj;&#8203;techno-by-anthony-ma&zwnj;&#8203;rra.html%3F_r%3D0</code>"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 2, "creation_date": 1481031858, "post_id": 40980712, "comment_id": 69202225, "body": "you probably need to add the cookies that were returned from <code>&#47;glogin</code> page in the subsequent redirect to the article."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4014918, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WotpVQkEg5g/AAAAAAAAAAI/AAAAAAAAEtQ/foJcfcM8mT0/photo.jpg?sz=128", "display_name": "Brian Yu", "link": "https://stackoverflow.com/users/4014918/brian-yu"}, "edited": false, "score": 0, "creation_date": 1481055428, "post_id": 41001946, "comment_id": 69216864, "body": "Wow, what a simple answer! Thank you so much, I will upvote when I get enough reputation."}], "tags": [], "owner": {"reputation": 2058, "user_id": 1821692, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/aXNO2.jpg?s=128&g=1", "display_name": "feeeper", "link": "https://stackoverflow.com/users/1821692/feeeper"}, "is_accepted": true, "score": 0, "last_activity_date": 1481048803, "last_edit_date": 1481048803, "creation_date": 1481047419, "answer_id": 41001946, "question_id": 40980712, "link": "https://stackoverflow.com/questions/40980712/how-can-i-circumvent-bot-protection-when-scraping-full-nytimes-articles/41001946#41001946", "title": "How can I circumvent bot protection when scraping full NYTimes articles?", "body": "\n\n\n\n<p>You just have to add cookies to your client:</p>\n\n<pre><code>var cookieJar, _ = cookiejar.New(nil)\nvar client = &amp;http.Client{Jar: cookieJar}\n\nresp, err := client.Do(req)\nif err != nil {\n    log.Fatalln(err)\n}\n// now response contains all you need and \n// you can show it on the console or save to file\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4014918, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WotpVQkEg5g/AAAAAAAAAAI/AAAAAAAAEtQ/foJcfcM8mT0/photo.jpg?sz=128", "display_name": "Brian Yu", "link": "https://stackoverflow.com/users/4014918/brian-yu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 1, "accepted_answer_id": 41001946, "answer_count": 1, "score": 2, "last_activity_date": 1481048803, "creation_date": 1480961719, "last_edit_date": 1480993330, "question_id": 40980712, "link": "https://stackoverflow.com/questions/40980712/how-can-i-circumvent-bot-protection-when-scraping-full-nytimes-articles", "title": "How can I circumvent bot protection when scraping full NYTimes articles?", "body": "<p>I am trying to scrape full book reviews from the New York Times in order to perform sentiment analysis on them. I am aware of the <a href=\"https://developer.nytimes.com/books_api.json#/Console/GET/reviews.%7Bformat%7D\" rel=\"nofollow noreferrer\">NY Times API</a> and am using it to get book review URLs, but I need to devise a scraper to get the full article text, as the API only gives a snippet. I believe that nytimes.com has bot protection to prevent bots from scraping the website but I know there are ways to circumvent it.</p>\n\n<p>I found this <a href=\"https://github.com/Anorov/cloudflare-scrape\" rel=\"nofollow noreferrer\">python scraper</a> that works and can pull full text from nytimes.com, but I would prefer to implement my solution in Go. Should I just port this to Go or is this solution unnecessarily complex? I have already played around with changing the User-Agent header but everything that I do in Go ends in an infinite redirect loop error.</p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    //\"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"math/rand\"\n    \"net/http\"\n    \"time\"\n    //\"net/url\"\n)\n\nfunc main() {\n\n    rand.Seed(time.Now().Unix())\n\n    userAgents := [5]string{\n        \"Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36\",\n        \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36\",\n        \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36\",\n        \"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0\",\n        \"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:41.0) Gecko/20100101 Firefox/41.0\",\n    }\n\n    url := \"http://www.nytimes.com/2015/10/25/books/review/the-tsar-of-love-and-techno-by-anthony-marra.html\"\n\n    client := &amp;http.Client{}\n\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    req.Header.Set(\"User-Agent\", userAgents[rand.Intn(len(userAgents))])\n\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    log.Println(string(body))\n}\n</code></pre>\n\n<p>Results in:</p>\n\n<pre><code>2016/12/05 21:57:53 Get http://www.nytimes.com/2015/10/25/books/review/the-tsar-of-love-and-techno-by-anthony-marra.html?_r=4: stopped after 10 redirects\nexit status 1\n</code></pre>\n\n<p>Any help is appreciated! Thank you!</p>\n"}, {"tags": ["serialization", "go", "struct", "code-generation", "pretty-print"], "answers": [{"comments": [{"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 0, "creation_date": 1480970745, "post_id": 40980037, "comment_id": 69175587, "body": "I tried this, but when I&#39;ve got <code>type Foo string</code> and <code>{field : Foo(&quot;Bar&quot;)}</code>, it just prints this to <code>{field : &quot;Bar&quot;}</code>. Any workarounds for this?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 0, "creation_date": 1480971234, "post_id": 40980037, "comment_id": 69175807, "body": "@jmite: what is the type of <code>field</code> in the struct?"}, {"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 0, "creation_date": 1480971424, "post_id": 40980037, "comment_id": 69175903, "body": "It&#39;s type <code>Foo</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 0, "creation_date": 1480971558, "post_id": 40980037, "comment_id": 69175983, "body": "@jmite: then the type conversion is superfluous, since the string literal can be assigned to the <code>Foo</code> type."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 1, "creation_date": 1480971803, "post_id": 40980037, "comment_id": 69176115, "body": "@jmite: this still can&#39;t do everything, nested pointers are only going to be printed as <code>%p</code> with a type, and values assigned to an interface will only show the underlying type. If you want more detailed output, you need to format it manually."}, {"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 0, "creation_date": 1480974657, "post_id": 40980037, "comment_id": 69177577, "body": "Looks like the solution is to implement the <code>GoString()</code> method, described in the <code>fmt</code> library, thanks!"}, {"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 0, "creation_date": 1596253609, "post_id": 40980037, "comment_id": 111760252, "body": "Ugh...Correction, this is working for <code>map</code> as well, my IDE terminal is stupid and did not print it as a string. Thanks"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 10, "last_activity_date": 1480960946, "last_edit_date": 1480960946, "creation_date": 1480959265, "answer_id": 40980037, "question_id": 40979903, "link": "https://stackoverflow.com/questions/40979903/golang-print-struct-as-it-would-appear-in-source-code/40980037#40980037", "title": "Golang: print struct as it would appear in source code", "body": "<p>From the <code>fmt</code> package:</p>\n\n<blockquote>\n<pre><code>%#v   a Go-syntax representation of the value\n</code></pre>\n</blockquote>\n\n<p>This is as close as you can come with built-in formatting, after removing the package identifier (<code>main.</code> in this example) from the output. </p>\n\n<pre><code>type T struct {\n    A string\n    B []byte\n}\n\nfmt.Printf(\"%#v\\n\", &amp;T{A: \"hello\", B: []byte(\"world\")})\n\n// out\n// &amp;main.T{A:\"hello\", B:[]uint8{0x77, 0x6f, 0x72, 0x6c, 0x64}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/x6nqCzrFXs\" rel=\"noreferrer\">Run</a></p>\n"}], "owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2917, "favorite_count": 0, "accepted_answer_id": 40980037, "answer_count": 1, "score": 4, "last_activity_date": 1480960946, "creation_date": 1480958751, "last_edit_date": 1495542323, "question_id": 40979903, "link": "https://stackoverflow.com/questions/40979903/golang-print-struct-as-it-would-appear-in-source-code", "title": "Golang: print struct as it would appear in source code", "body": "<p>Similar to <a href=\"https://stackoverflow.com/questions/16331063/in-go-how-can-i-get-the-string-representation-of-a-struct\">this question</a> but not quite identical.</p>\n\n<p>I'm doing some code-generation, making .go files from within Go. I've got a struct, and I want to generate the text representation of it so that I can insert it as a literal into the generated code.</p>\n\n<p>So, if I had  <code>myVal := SomeStruct{foo : 1, bar : 2}</code>, I want to get the string <code>\"SomeStruct{foo : 1, bar : 2}\"</code>.</p>\n\n<p>Is this possible in Go?</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1480957704, "post_id": 40979516, "comment_id": 69168437, "body": "<a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}, {"owner": {"reputation": 575, "user_id": 1812730, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6684ac02f2186e87977ec4db56b6a007?s=128&d=identicon&r=PG", "display_name": "hsson", "link": "https://stackoverflow.com/users/1812730/hsson"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480957835, "post_id": 40979516, "comment_id": 69168508, "body": "Thanks! This is a good solution. Too bad it&#39;s necessary though..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1480957960, "post_id": 40979516, "comment_id": 69168573, "body": "It&#39;s helpful if you don&#39;t think of Go interfaces as type classes, but rather as pairs of (type,struct) where the &quot;type&quot; has a set of dynamic &quot;virtual&quot; pointers to the struct&#39;s implementation functions (if that makes sense!).   The assignment operator &#39;=&#39;  automatically creates these representations  as necessary.  But it doesn&#39;t support slices - that is - it won&#39;t go through and represent that pair for each slice element.  (The actual implementation is somewhat similar, but not exactly what I&#39;m describing, currently...)"}, {"owner": {"reputation": 575, "user_id": 1812730, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6684ac02f2186e87977ec4db56b6a007?s=128&d=identicon&r=PG", "display_name": "hsson", "link": "https://stackoverflow.com/users/1812730/hsson"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1480958308, "post_id": 40979516, "comment_id": 69168770, "body": "Great explanation @BadZen! Given this.. Is there a good way to make a function like FooBarBar work regardless of whether the objects passed are of type *FooBar or Foobar (since there is no way for the function to know if the interface was implemented like &quot;func (f *FooBar)...&quot; or &quot;func (f FooBar)...&quot;. I hope you understand my question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480958309, "post_id": 40979516, "comment_id": 69168771, "body": "Or more simply, the memory layout is different. <code>[]*FooBar</code> is a slice of pointer values, and <code>[]Foo</code> is a slice of 2-word interface values. One is not assignable directly to the other."}, {"owner": {"reputation": 575, "user_id": 1812730, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6684ac02f2186e87977ec4db56b6a007?s=128&d=identicon&r=PG", "display_name": "hsson", "link": "https://stackoverflow.com/users/1812730/hsson"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480958401, "post_id": 40979516, "comment_id": 69168817, "body": "@JimB, see my question above. Is there any good solution for this?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480958665, "post_id": 40979516, "comment_id": 69168992, "body": "@CrashproofCode: that&#39;s a different question, but not usually one that matters, since you can&#39;t compile with a value for an interface that doesn&#39;t already satisfy that interface. In your example here, just start with a <code>[]Foo</code> rather than <code>[]*FooBar</code>."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1481052252, "post_id": 40979516, "comment_id": 69215205, "body": "You could use generic <code>interface{}</code> type arguments, and then use rtti / type conversion to conditionally process either a <code>[]*FooBar</code> in the usual way, or a <code>[]Foo</code> by iterating and converting as we&#39;ve talked about above.   I hope this instinctively strikes you as a /terrible idea/, however. =)"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1481052343, "post_id": 40979516, "comment_id": 69215251, "body": "(Note that you are free to subtype slice types, and have those new types implement a common interface!   This may or may not be a terrible idea, depending...)"}], "answers": [{"tags": [], "owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "is_accepted": false, "score": 0, "last_activity_date": 1480999986, "creation_date": 1480999986, "answer_id": 40988061, "question_id": 40979516, "link": "https://stackoverflow.com/questions/40979516/cant-pass-slices-of-structs-implementing-the-foo-interface-to-a-function-that-e/40988061#40988061", "title": "Can&#39;t pass slices of structs implementing the Foo interface to a function that expects []Foo", "body": "<p>Can i try this way:</p>\n\n<pre><code>func main() {\n    fooBar := []Foo{&amp;FooBar{true}, &amp;FooBar{false}}\n    FooBarBar(fooBar)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0Mw9CkvR79\" rel=\"nofollow noreferrer\">GoPlayGround</a>: </p>\n"}, {"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1481052645, "post_id": 41001017, "comment_id": 69215431, "body": "What is it called if you do define a type such as <code>type FooSlice []Foo</code>, if not &quot;subtyping&quot; then?   (This is an actual and not rhetorical question - I&#39;ve always called this a &quot;subtype&quot; but if there is an official/better word for it...)"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1481052852, "post_id": 41001017, "comment_id": 69215555, "body": "(Also it&#39;s worth mentioning embedding in a thread where you say &quot;no inheritence&quot; - it along with some language syntactic sugar provides something roughly similar to a sort of type inheritance.   See <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#embedding</a>)"}], "tags": [], "owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "is_accepted": false, "score": 0, "last_activity_date": 1481044136, "creation_date": 1481044136, "answer_id": 41001017, "question_id": 40979516, "link": "https://stackoverflow.com/questions/40979516/cant-pass-slices-of-structs-implementing-the-foo-interface-to-a-function-that-e/41001017#41001017", "title": "Can&#39;t pass slices of structs implementing the Foo interface to a function that expects []Foo", "body": "<p>There is no \"sub typing\" in Go.</p>\n\n<p><code>[]Foo</code> and <code>[]*Foobar</code> are 2 different types, so all you can do is use a for loop to convert <code>[]*Foobar</code> into <code>[]Foo</code></p>\n\n<pre><code>foos := []Foo{}\n\nfor _,f:=range foobar {\n    foos = append(foos,f)\n}\n\nFooBarBar(foos)\n</code></pre>\n\n<p>Or you can put your *Foobar directly in a slice of Foo :</p>\n\n<pre><code>foos := []Foo{&amp;FooBar{true},&amp;FooBar{false}}\nFooBarBar(foos)\n</code></pre>\n\n<p>There are a few exceptions like the relationship between named types and unnamed types </p>\n\n<pre><code>type FooBar struct{}\n\ntype Foobars []*FooBar // Foobars is an named type, []*FooBar is an unnamed type\n\nAcceptFoobars := func(f []*FooBar) {} // Accepts Foobars too\n\nfoobars := Foobars{{}, {}, {}}\nAcceptFoobars(foobars)\n</code></pre>\n\n<p>Go type system is \"flat\", there is no inheritance or casting, only assertions and conversions. as defined by the Go spec. </p>\n\n<p><a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Types</a></p>\n\n<blockquote>\n  <p>A type determines the set of values and operations specific to values\n  of that type. Types may be named or unnamed. Named types are specified\n  by a (possibly qualified) type name; unnamed types are specified using\n  a type literal, which composes a new type from existing types.</p>\n</blockquote>\n"}], "owner": {"reputation": 575, "user_id": 1812730, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/6684ac02f2186e87977ec4db56b6a007?s=128&d=identicon&r=PG", "display_name": "hsson", "link": "https://stackoverflow.com/users/1812730/hsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 761, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1481044136, "creation_date": 1480957435, "question_id": 40979516, "link": "https://stackoverflow.com/questions/40979516/cant-pass-slices-of-structs-implementing-the-foo-interface-to-a-function-that-e", "title": "Can&#39;t pass slices of structs implementing the Foo interface to a function that expects []Foo", "body": "<p>I'm trying to work with interfaces in Go but I can't seem to be able to pass a slice of structs implementing a certain interface to a function that expects a slice of the interface. It works with functions that just takes a single object but not with functions expecting slices of the interface. Using the code below I get the following error:</p>\n\n<blockquote>\n  <p>./main.go:27: cannot use fooBar (type []*FooBar) as type []Foo in argument to FooBarBar</p>\n</blockquote>\n\n<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Foo interface {\n    Bar() bool\n}\n\ntype FooBar struct {\n    a bool\n}\n\nfunc (f *FooBar) Bar() bool {\n    return f.a\n}\n\nfunc FooBarBar(foos []Foo) {\n    for _, foo := range foos {\n        fmt.Println(foo.Bar())\n    }\n}\n\nfunc main() {\n    fooBar := make([]*FooBar, 2)\n    fooBar[0] = &amp;FooBar{true}\n    fooBar[1] = &amp;FooBar{false}\n    FooBarBar(fooBar)\n}\n</code></pre>\n"}, {"tags": ["go", "https"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480953322, "post_id": 40977992, "comment_id": 69165715, "body": "If it&#39;s a TCP proxy, it&#39;s forwarding the bytes already. Why would shadowsocks need to parse the response that it&#39;s already sending back? (you can&#39;t just &quot;parse&quot; https raw bytes, the client making the request is the one who can decrypt it)"}, {"owner": {"reputation": 407, "user_id": 1095292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/380f81966ae6c98bd3eb0c87ecf17948?s=128&d=identicon&r=PG", "display_name": "Petar Donchev", "link": "https://stackoverflow.com/users/1095292/petar-donchev"}, "edited": false, "score": 0, "creation_date": 1523630578, "post_id": 40977992, "comment_id": 86654026, "body": "While for the concrete problem maybe does not need raw HTTP parsing, the question is valid. I can imagine (and I have had) situations where there is need of a custom server, or just a parser without a server,and a library would be helpful."}], "answers": [{"tags": [], "owner": {"reputation": 157, "user_id": 5081979, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/87a1d.jpg?s=128&g=1", "display_name": "MNZT", "link": "https://stackoverflow.com/users/5081979/mnzt"}, "is_accepted": false, "score": 0, "last_activity_date": 1480954444, "creation_date": 1480954444, "answer_id": 40978568, "question_id": 40977992, "link": "https://stackoverflow.com/questions/40977992/how-to-parse-https-raw-bytes-in-golang/40978568#40978568", "title": "how to parse https raw bytes in golang", "body": "<p>You can make secure requests via go's <code>net/http</code> library. Just use the <code>https://</code> scheme in the URL.</p>\n"}], "owner": {"reputation": 536, "user_id": 1223304, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/c6c17d0bbcf2a33a3c823f42ff9106f0?s=128&d=identicon&r=PG", "display_name": "taigetco", "link": "https://stackoverflow.com/users/1223304/taigetco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 326, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1480985634, "creation_date": 1480952711, "last_edit_date": 1480985634, "question_id": 40977992, "link": "https://stackoverflow.com/questions/40977992/how-to-parse-https-raw-bytes-in-golang", "title": "how to parse https raw bytes in golang", "body": "<p>I am new to golang, want to modify shadowsocks-go code to parse https raw response bytes to check whether the google, facebook or twitter has blocked our service or not. Shadowsocks-go uses socket5 to read https data, I checked golang http module, still don't know how to parse https raw bytes. From google, examples are only about how to use go http module. </p>\n\n<p><strong>Update</strong></p>\n\n<p>Actually, I want to make a Reverse Proxy, every proxy node contains a shadowsocks server. So every request I want to know the destinations whether block our request or not, if blocked, need to remove the node, and add new one. This requirement need to parse the https raw bytes to check response status.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480952773, "post_id": 40977960, "comment_id": 69165390, "body": "Isn&#39;t <code>GOBIN</code> already in your PATH? Have you just tried running the program again?"}, {"owner": {"reputation": 13525, "user_id": 978461, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1d8513b3d982479f054d4640f5a626cb?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Varhegyi", "link": "https://stackoverflow.com/users/978461/adam-varhegyi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480952937, "post_id": 40977960, "comment_id": 69165477, "body": "@JimB Its in my PATH. I have already built successfully a hello world Go program. But I cannot build this one with the method given in the hello world example"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1480953482, "post_id": 40977960, "comment_id": 69165837, "body": "I don&#39;t understand. running <code>go get github.com&#47;zpeters&#47;speedtest</code> already built the binary and put it in GOBIN."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1480953511, "post_id": 40977960, "comment_id": 69165854, "body": "re: your last edit, &quot;speedtest&quot; isn&#39;t a package, the package is &quot;github.com/zpeters/speedtest&quot;"}, {"owner": {"reputation": 13525, "user_id": 978461, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1d8513b3d982479f054d4640f5a626cb?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Varhegyi", "link": "https://stackoverflow.com/users/978461/adam-varhegyi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480953771, "post_id": 40977960, "comment_id": 69166028, "body": "@JimB Add this as an answer so I can accept. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "is_accepted": false, "score": 0, "last_activity_date": 1480953936, "creation_date": 1480953936, "answer_id": 40978381, "question_id": 40977960, "link": "https://stackoverflow.com/questions/40977960/build-a-go-program-in-windows/40978381#40978381", "title": "Build a GO program in Windows", "body": "<p>Your message line:</p>\n\n<blockquote>\n  <p>C:\\gonetwork\\src\\speedtest (from $GOPATH)</p>\n</blockquote>\n\n<p>suggests that your GOPATH is set to c:\\Gonetwork.</p>\n\n<p>Do it like this then, open a command prompt.</p>\n\n<pre><code>c:\ncd \\GoNetwork\\src\ngo get github.com/zpeters/speedtest\n</code></pre>\n\n<p>When it completes:</p>\n\n<pre><code>c:\\GoNetwork\\bin\\speedtest.exe\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9, "user_id": 6093091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bCXEL.jpg?s=128&g=1", "display_name": "Marc Guasch", "link": "https://stackoverflow.com/users/6093091/marc-guasch"}, "is_accepted": false, "score": 0, "last_activity_date": 1481046454, "creation_date": 1481046454, "answer_id": 41001662, "question_id": 40977960, "link": "https://stackoverflow.com/questions/40977960/build-a-go-program-in-windows/41001662#41001662", "title": "Build a GO program in Windows", "body": "<p>As far as you have been able to execute <code>go get github.com/zpeters/speedtest</code> with no error, you already have your code in your <code>$GOPATH</code> and the binary in $GOBIN, the only thing you need to modify it is go to its location, in your case, according to your output it should be something like:</p>\n\n<pre><code>cd C:\\gonetwork\\src\\speedtest\\github.com\\zpeters\\speedtest\n</code></pre>\n\n<p>Once you are there, and modified the code to your needs, you only need to run <code>go install github.com/zpeters/speedtest</code></p>\n"}], "owner": {"reputation": 13525, "user_id": 978461, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1d8513b3d982479f054d4640f5a626cb?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Varhegyi", "link": "https://stackoverflow.com/users/978461/adam-varhegyi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1253, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1481046454, "creation_date": 1480952587, "last_edit_date": 1480953447, "question_id": 40977960, "link": "https://stackoverflow.com/questions/40977960/build-a-go-program-in-windows", "title": "Build a GO program in Windows", "body": "<p>I have found an interesting program in the <strong>language of Go</strong>. This is the first time I work with this language and I dont know much of it.</p>\n\n<p>Basically <a href=\"https://github.com/zpeters/speedtest\" rel=\"nofollow noreferrer\">it is a network bandwidth speedtest.</a></p>\n\n<p><strong>The program works verry well</strong>, I just would like to modify its output a little. So I have to edit the source <strong>and rebuild the project</strong> to get the update .exe file.</p>\n\n<p><a href=\"https://github.com/zpeters/speedtest/wiki/Build-Instructions\" rel=\"nofollow noreferrer\">The wiki of the project says:</a></p>\n\n<p><strong>Building speedtest</strong></p>\n\n<ol>\n<li>Clone/build speedtest go get github.com/zpeters/speedtest</li>\n<li>cd ~/go/bin/code></li>\n<li>./speedtest</li>\n</ol>\n\n<p>I did step 1. but I don't know what to do with step 2. ? What is it ? What is \"~\" means and what is \"code>\" ? </p>\n\n<p>Also is \"./\" means running a shell script file? I work in Windows. Can somebody please help me to compile this Go program?</p>\n\n<p><strong>E D I T:</strong></p>\n\n<p>The <code>src</code> contains <strong>3 packages:</strong></p>\n\n<ul>\n<li>github.com </li>\n<li>golang.org </li>\n<li>gopkg.in</li>\n</ul>\n\n<p><strong>How should I compile?</strong></p>\n\n<p>If I try:</p>\n\n<pre><code>go install speedtest\n</code></pre>\n\n<p>I got </p>\n\n<blockquote>\n  <p>can't load package: package speedtest: cannot find package \"speedtest\" in any of:</p>\n  \n  <p>C:\\go\\src\\speedtest (from $GOROOT) </p>\n  \n  <p>C:\\gonetwork\\src\\speedtest (from $GOPATH)</p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1480950993, "post_id": 40977283, "comment_id": 69164209, "body": "Did you install Go from a package manager before? What does <code>go version</code> print? Old versions of Go used to look for stdlib in <code>src&#47;pkg</code>."}, {"owner": {"reputation": 557, "user_id": 3207230, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c3accb7961f15f3a907a8841783978cf?s=128&d=identicon&r=PG&f=1", "display_name": "user3207230", "link": "https://stackoverflow.com/users/3207230/user3207230"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1480951427, "post_id": 40977283, "comment_id": 69164524, "body": "Indeed I had an old version of go installed that I was not aware of. Removed it and now it works. Thanks!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1480951523, "post_id": 40977283, "comment_id": 69164602, "body": "@Ainar-G Add that as an answer."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1480951738, "post_id": 40977283, "comment_id": 69164732, "body": "Added the answer."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1480952305, "post_id": 40977283, "comment_id": 69165122, "body": "Also: Never set GOROOT, it is not needed to compile a Go program with the go tool."}, {"owner": {"reputation": 557, "user_id": 3207230, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c3accb7961f15f3a907a8841783978cf?s=128&d=identicon&r=PG&f=1", "display_name": "user3207230", "link": "https://stackoverflow.com/users/3207230/user3207230"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1480959328, "post_id": 40977283, "comment_id": 69169384, "body": "@Volker But if I installed go in my home directory, I have to set GOROOT, right? I tried unsetting it, but &#39;go install&#39; failed in that case."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1480964945, "post_id": 40977283, "comment_id": 69172454, "body": "@user3207230: yes, putting a precompiled go release in a non-standard path is the only case where you should set GOROOT. Just don&#39;t forget you have it set if you try running Go from another location, since that is a very common cause of beginner issues, and the reason the default advice is to not set GOROOT."}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 7, "last_activity_date": 1480951731, "creation_date": 1480951731, "answer_id": 40977676, "question_id": 40977283, "link": "https://stackoverflow.com/questions/40977283/go-install-will-not-find-package-fmt/40977676#40977676", "title": "&#39;go install&#39; will not find package &quot;fmt&quot;", "body": "<p>If you installed Go from a package manager before, you might have an old version. Check <code>go version</code> and remove the old version if needed.</p>\n"}, {"tags": [], "owner": {"reputation": 1643, "user_id": 984602, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/vIZgp.png?s=128&g=1", "display_name": "Ionoclast Brigham", "link": "https://stackoverflow.com/users/984602/ionoclast-brigham"}, "is_accepted": false, "score": 2, "last_activity_date": 1533591101, "creation_date": 1533591101, "answer_id": 51715920, "question_id": 40977283, "link": "https://stackoverflow.com/questions/40977283/go-install-will-not-find-package-fmt/51715920#51715920", "title": "&#39;go install&#39; will not find package &quot;fmt&quot;", "body": "<p>For MacPorts users with e.g. go 1.10.3 installed, it didn't seem to be correctly installed for me. The runtime standard packages were missing. I even tried uninstalling and reinstalling a clean copy. So I just removed it and got the official darwin binary package from google:</p>\n\n<p><a href=\"https://golang.org/dl/\" rel=\"nofollow noreferrer\">https://golang.org/dl/</a></p>\n"}], "owner": {"reputation": 557, "user_id": 3207230, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c3accb7961f15f3a907a8841783978cf?s=128&d=identicon&r=PG&f=1", "display_name": "user3207230", "link": "https://stackoverflow.com/users/3207230/user3207230"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4266, "favorite_count": 0, "accepted_answer_id": 40977676, "answer_count": 2, "score": 3, "last_activity_date": 1533591101, "creation_date": 1480950396, "last_edit_date": 1480965492, "question_id": 40977283, "link": "https://stackoverflow.com/questions/40977283/go-install-will-not-find-package-fmt", "title": "&#39;go install&#39; will not find package &quot;fmt&quot;", "body": "<p>I installed go 1.7.4 by untarring it into ~/go and setting GOROOT accordingly. I also created ~/work/src/github.com/user/hello and set GOPATH accordingly.</p>\n\n<p>When trying the hello world example from <a href=\"https://golang.org/doc/install#testing\" rel=\"nofollow noreferrer\">https://golang.org/doc/install#testing</a> I get the following error:</p>\n\n<pre><code>$ go install github.com/user/hello\n    ../work/src/github.com/user/hello/hello.go:3:8: cannot find package \"fmt\" in any of:\n    /home/user/go/src/pkg/fmt (from $GOROOT)\n    /home/user/work/src/fmt (from $GOPATH)\npackage github.com/user/hello\n    imports runtime: cannot find package \"runtime\" in any of:\n    /home/user/go/src/pkg/runtime (from $GOROOT)\n    /home/user/work/src/runtime (from $GOPATH)\n</code></pre>\n\n<p>Checking ~/go, I find fmt in ~/go/src/fmt and not ~/go/src/pkg/fmt</p>\n\n<p>It feels like I am missing something crucial. Thankful for assistance.</p>\n"}, {"tags": ["go", "apache-kafka", "kafka-consumer-api", "kafka-producer-api"], "answers": [{"tags": [], "owner": {"reputation": 9, "user_id": 6093091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bCXEL.jpg?s=128&g=1", "display_name": "Marc Guasch", "link": "https://stackoverflow.com/users/6093091/marc-guasch"}, "is_accepted": false, "score": 1, "last_activity_date": 1481045749, "creation_date": 1481045749, "answer_id": 41001468, "question_id": 40976189, "link": "https://stackoverflow.com/questions/40976189/golang-kafka-not-consuming-all-messages-offsetnewest/41001468#41001468", "title": "Golang Kafka not consuming all messages offsetnewest", "body": "<p>It is difficult to be able to tell something without any code or more in depth explanation about how kafka is configured (i.e.: topics, partitions, ...), so few quick checks come to my mind:</p>\n\n<ol>\n<li><p>Assuming you start consuming with the OffsetNewest set <strong>before</strong> you start producing, one thing that maybe happening is that you are not consuming from all partitions on that topic, regarding to sarama docs, you have to consume each partition explicitly by creating PartitionConsumers. From the example in <a href=\"https://godoc.org/github.com/Shopify/sarama#Consumer\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/Shopify/sarama#Consumer</a>:</p>\n\n<pre><code>partitionConsumer, err := consumer.ConsumePartition(\"my_topic\", 0, OffsetNewest)\nif err != nil {\n    panic(err)\n}\n\n...\n\nconsumed := 0\nConsumerLoop:\nfor {\n    select {\n    case msg := &lt;-partitionConsumer.Messages():\n        log.Printf(\"Consumed message offset %d\\n\", msg.Offset)\n        consumed++\n    case &lt;-signals:\n        break ConsumerLoop\n    }\n}\n</code></pre></li>\n<li><p>You, in fact, are starting the consuming <strong>after</strong> producing all the events, and so, the pointer to read them all is not OffsetNewest but OffsetOldest instead.</p></li>\n</ol>\n\n<p>I'm sorry to not be able to give you a more useful answer, but maybe if you paste some code or give more details we can help a but more.</p>\n"}], "owner": {"reputation": 8594, "user_id": 79631, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/0ad80e1a6248557d682c17b3cdcf5301?s=128&d=identicon&r=PG", "display_name": "web dunia", "link": "https://stackoverflow.com/users/79631/web-dunia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1273, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1539572935, "creation_date": 1480946971, "question_id": 40976189, "link": "https://stackoverflow.com/questions/40976189/golang-kafka-not-consuming-all-messages-offsetnewest", "title": "Golang Kafka not consuming all messages offsetnewest", "body": "<p>First Batch:-\nI am trying to pull data from 100 flat file and loading up into an array and inserting them to kafka producer one by one as byte array.</p>\n\n<p>Second Batch:-\nI am consuming from kafka consumer and then inserting them to NoSQL database.</p>\n\n<p>I use Offsetnewset in the config file of shopify sarama golang package for Kafka.</p>\n\n<p>I can receive and insert messages to kafka but while consuming I am getting only the first message. Since I gave Offset newest in the sarama config.\nhow can I get all the data here.</p>\n"}, {"tags": ["go", "redis", "redigo"], "answers": [{"comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1480946213, "post_id": 40975867, "comment_id": 69160928, "body": "the signature is <code>Send(cmd string, args ...interface{}) error</code>. so you need to convert to an interface{} slice first."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1480946465, "post_id": 40975867, "comment_id": 69161098, "body": "@Not_a_Golfer: oops, should have double-checked the docs ;)  will fix."}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1480946579, "post_id": 40975867, "comment_id": 69161172, "body": "Now in result I&#39;m getting  [&quot;val1&quot;, &quot;val2&quot;, &quot;val3&quot; ],   how do I get it in [ &quot;val:pair&quot; ]  format?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1480946808, "post_id": 40975867, "comment_id": 69161344, "body": "@AnkitDeshpande: do you want the <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#StringMap\" rel=\"nofollow noreferrer\">StringMap</a> function?"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1480946861, "post_id": 40975867, "comment_id": 69161380, "body": "@Not_a_Golfer so can I assume that the order of result is the same as that of input ?"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1480946863, "post_id": 40975867, "comment_id": 69161382, "body": "@JimB I tried using StringMap function but is says need even no of arguments"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1480946958, "post_id": 40975867, "comment_id": 69161444, "body": "@AnkitDeshpande: yes, that is for fetching the entire hash. If you just want specific fields, that you need to do it manually as Not_a_Golfer said."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1480946846, "last_edit_date": 1480946846, "creation_date": 1480946027, "answer_id": 40975867, "question_id": 40975589, "link": "https://stackoverflow.com/questions/40975589/hmget-empty-result-when-passing-params/40975867#40975867", "title": "HMGET: Empty result when passing params", "body": "<p>What you're sending is <code>HMGET r.HashName [1 2 3]</code></p>\n\n<p>Separate the arguments or add them the same slice and expand that slice as the variadic parameter. Since you're using type <code>[]string</code> you will need to convert that to an <code>[]interface{}</code> type as well:</p>\n\n<pre><code>func HMGET(c redis.Conn, field []string) {\n    args := make([]interface{}, len(field)+1)\n    args[0] = HashName\n    for i, v := range field {\n        args[i+1] = v\n    }\n\n    if err := c.Send(\"HMGET\", args...); err != nil {\n        return nil, err\n    }\n    //////\n</code></pre>\n"}], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1139, "favorite_count": 0, "accepted_answer_id": 40975867, "answer_count": 1, "score": 1, "last_activity_date": 1480946846, "creation_date": 1480945182, "question_id": 40975589, "link": "https://stackoverflow.com/questions/40975589/hmget-empty-result-when-passing-params", "title": "HMGET: Empty result when passing params", "body": "<p>Using redigo, I'm trying to use HMGET. I'm passing a string slice as param in field. It is not working, returning empty result. </p>\n\n<pre><code>func HMGET(c redis.Conn, field []string)(){\n        if err := c.Send(\"HMGET\", HashName, field); err != nil {\n            return nil, err\n        }\n        if err := c.Flush(); err != nil {\n            return nil, err\n        }\n        rval, err := c.Receive()\n        if err != nil {\n            return nil, err\n        }\n        return rval, nil\n}\n</code></pre>\n\n<p>This is working</p>\n\n<pre><code>c.Send(\"HMGET\", r.HashName, \"1\", \"2\", \"3\")\n</code></pre>\n\n<p>Any suggestions why field when passed as param is not working?</p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 3531663, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f2bce009bd2435cba00b2f9948c16209?s=128&d=identicon&r=PG&f=1", "display_name": "orkun1675", "link": "https://stackoverflow.com/users/3531663/orkun1675"}, "edited": false, "score": 1, "creation_date": 1501893927, "post_id": 40975308, "comment_id": 77995643, "body": "this does not compile because of the imports. could you update it please?"}], "tags": [], "owner": {"reputation": 664, "user_id": 935203, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/764e5f288b3534281b1fe7a1b95218ae?s=128&d=identicon&r=PG", "display_name": "Ramin Mir.", "link": "https://stackoverflow.com/users/935203/ramin-mir"}, "is_accepted": true, "score": 14, "last_activity_date": 1495708986, "last_edit_date": 1495708986, "creation_date": 1480944263, "answer_id": 40975308, "question_id": 40975307, "link": "https://stackoverflow.com/questions/40975307/how-to-watch-events-on-a-kubernetes-service-using-its-go-client/40975308#40975308", "title": "How to watch events on a kubernetes service using its go client", "body": "<p>this can be done like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"flag\"\n    \"time\"\n\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/pkg/api/v1\"\n    \"k8s.io/client-go/tools/clientcmd\"\n    \"k8s.io/client-go/tools/cache\"\n    \"k8s.io/client-go/pkg/fields\"\n)\n\nvar (\n    kubeconfig = flag.String(\"kubeconfig\", \"./config\", \"absolute path to the kubeconfig file\")\n)\n\nfunc main() {\n    flag.Parse()\n    config, err := clientcmd.BuildConfigFromFlags(\"\", *kubeconfig)\n    if err != nil {\n        panic(err.Error())\n    }\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    watchlist := cache.NewListWatchFromClient(clientset.Core().RESTClient(), \"services\", v1.NamespaceDefault,\n        fields.Everything())\n    _, controller := cache.NewInformer(\n        watchlist,\n        &amp;v1.Service{},\n        time.Second * 0,\n        cache.ResourceEventHandlerFuncs{\n            AddFunc: func(obj interface{}) {\n                fmt.Printf(\"service added: %s \\n\", obj)\n            },\n            DeleteFunc: func(obj interface{}) {\n                fmt.Printf(\"service deleted: %s \\n\", obj)\n            },\n            UpdateFunc:func(oldObj, newObj interface{}) {\n                fmt.Printf(\"service changed \\n\")\n            },\n        },\n    )\n    stop := make(chan struct{})\n    go controller.Run(stop)\n    for{\n        time.Sleep(time.Second)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 349, "user_id": 6403253, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wOwRz.jpg?s=128&g=1", "display_name": "Layne Liu", "link": "https://stackoverflow.com/users/6403253/layne-liu"}, "is_accepted": false, "score": 9, "last_activity_date": 1603162052, "last_edit_date": 1603162052, "creation_date": 1520845781, "answer_id": 49231503, "question_id": 40975307, "link": "https://stackoverflow.com/questions/40975307/how-to-watch-events-on-a-kubernetes-service-using-its-go-client/49231503#49231503", "title": "How to watch events on a kubernetes service using its go client", "body": "<p>This is the latest version client-go's usage example. According the above code.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>    package main\n\n    import (\n        &quot;fmt&quot;\n        &quot;time&quot;\n\n         &quot;github.com/golang/glog&quot;\n\n         &quot;k8s.io/api/core/v1&quot;\n         &quot;k8s.io/apimachinery/pkg/fields&quot;\n         &quot;k8s.io/client-go/kubernetes&quot;\n         &quot;k8s.io/client-go/tools/cache&quot;\n         &quot;k8s.io/client-go/tools/clientcmd&quot;\n    )\n\n    func main() {\n        config, err := clientcmd.BuildConfigFromFlags(&quot;&quot;, &quot;&quot;)\n        if err != nil {\n            glog.Errorln(err)\n        }\n        clientset, err := kubernetes.NewForConfig(config)\n        if err != nil {\n            glog.Errorln(err)\n        }\n\n        watchlist := cache.NewListWatchFromClient(\n            clientset.CoreV1().RESTClient(),\n            string(v1.ResourceServices),\n            v1.NamespaceAll,\n            fields.Everything(),\n        )\n        _, controller := cache.NewInformer( // also take a look at NewSharedIndexInformer\n            watchlist,\n            &amp;v1.Service{},\n            0, //Duration is int64\n            cache.ResourceEventHandlerFuncs{\n                AddFunc: func(obj interface{}) {\n                    fmt.Printf(&quot;service added: %s \\n&quot;, obj)\n                },\n                DeleteFunc: func(obj interface{}) {\n                    fmt.Printf(&quot;service deleted: %s \\n&quot;, obj)\n                },\n                UpdateFunc: func(oldObj, newObj interface{}) {\n                    fmt.Printf(&quot;service changed \\n&quot;)\n                },\n             },\n         )\n         // I found it in k8s scheduler module. Maybe it's help if you interested in.\n         // serviceInformer := cache.NewSharedIndexInformer(watchlist, &amp;v1.Service{}, 0, cache.Indexers{\n         //     cache.NamespaceIndex: cache.MetaNamespaceIndexFunc,\n         // })\n         // go serviceInformer.Run(stop)\n        stop := make(chan struct{})\n        defer close(stop)\n        go controller.Run(stop)\n        for {\n            time.Sleep(time.Second)\n        }\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 271, "user_id": 7845579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0cf92eb317149bdd748fafdf4976aff5?s=128&d=identicon&r=PG&f=1", "display_name": "Rui", "link": "https://stackoverflow.com/users/7845579/rui"}, "is_accepted": false, "score": 6, "last_activity_date": 1560598822, "last_edit_date": 1560598822, "creation_date": 1560507063, "answer_id": 56596009, "question_id": 40975307, "link": "https://stackoverflow.com/questions/40975307/how-to-watch-events-on-a-kubernetes-service-using-its-go-client/56596009#56596009", "title": "How to watch events on a kubernetes service using its go client", "body": "<p>This is a simple one using SharedInformerFactory.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"github.com/golang/glog\"\n\n    kubeinformers \"k8s.io/client-go/informers\"\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/tools/cache\"\n    \"k8s.io/client-go/tools/clientcmd\"\n)\n\nfunc main() {\n    config, err := clientcmd.BuildConfigFromFlags(\"\", \"\")\n    if err != nil {\n        glog.Errorln(err)\n    }\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        glog.Errorln(err)\n    }\n\n    kubeInformerFactory := kubeinformers.NewSharedInformerFactory(clientset, time.Second*30)\n    svcInformer := kubeInformerFactory.Core().V1().Services().Informer()\n\n    svcInformer.AddEventHandler(cache.ResourceEventHandlerFuncs{\n        AddFunc: func(obj interface{}) {\n            fmt.Printf(\"service added: %s \\n\", obj)\n        },\n        DeleteFunc: func(obj interface{}) {\n            fmt.Printf(\"service deleted: %s \\n\", obj)\n        },\n        UpdateFunc: func(oldObj, newObj interface{}) {\n            fmt.Printf(\"service changed: %s \\n\", newObj)\n        },\n    },)\n\n    stop := make(chan struct{})\n    defer close(stop)\n    kubeInformerFactory.Start(stop)\n    for {\n        time.Sleep(time.Second)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 664, "user_id": 935203, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/764e5f288b3534281b1fe7a1b95218ae?s=128&d=identicon&r=PG", "display_name": "Ramin Mir.", "link": "https://stackoverflow.com/users/935203/ramin-mir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13700, "favorite_count": 6, "accepted_answer_id": 40975308, "answer_count": 3, "score": 11, "last_activity_date": 1603162052, "creation_date": 1480944263, "question_id": 40975307, "link": "https://stackoverflow.com/questions/40975307/how-to-watch-events-on-a-kubernetes-service-using-its-go-client", "title": "How to watch events on a kubernetes service using its go client", "body": "<p>I would like to be informed when ever a service is changed on kubernetes using client-go.</p>\n"}, {"tags": ["json", "pointers", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1480932378, "post_id": 40971542, "comment_id": 69152302, "body": "I don&#39;t get it. If you need the value, why won&#39;t you just check the pointer against <code>nil</code> and then dereference it?"}, {"owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1480932451, "post_id": 40971542, "comment_id": 69152342, "body": "I am not sure the unmarshal is setting the value correctly.  Whatever I do I cannot get the 0 (or any other value) able to be read from <code>MissingInt</code> or <code>MissingString</code>"}, {"owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1480932529, "post_id": 40971542, "comment_id": 69152390, "body": "Maybe a better example is <a href=\"https://play.golang.org/p/RWKCFtlhMk\" rel=\"nofollow noreferrer\">play.golang.org/p/RWKCFtlhMk</a>, I can&#39;t get to print out/read the 555 or test"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1480932654, "post_id": 40971542, "comment_id": 69152449, "body": "Why just not this? <a href=\"https://play.golang.org/p/aQ7Jjzgfja\" rel=\"nofollow noreferrer\">play.golang.org/p/aQ7Jjzgfja</a>"}, {"owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1480932707, "post_id": 40971542, "comment_id": 69152489, "body": "Yes sorry, I feel really stupid now to not have checked that!"}], "answers": [{"comments": [{"owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "edited": false, "score": 0, "creation_date": 1480932656, "post_id": 40971741, "comment_id": 69152453, "body": "Ah yes sorry, I was missing that!  I feel like an idiot now!"}, {"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "reply_to_user": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "edited": false, "score": 1, "creation_date": 1480932733, "post_id": 40971741, "comment_id": 69152504, "body": "You should not. There is no such thing as a stupid question."}, {"owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "edited": false, "score": 0, "creation_date": 1480933063, "post_id": 40971741, "comment_id": 69152715, "body": "Thanks!  When using pointers there instead of values in the struct do I have to be careful with memory leaks at all or will GC still kick in for the whole struct when I am done with the object?"}, {"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "reply_to_user": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "edited": false, "score": 1, "creation_date": 1480933150, "post_id": 40971741, "comment_id": 69152763, "body": "GC will take care of that."}], "tags": [], "owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "is_accepted": true, "score": 3, "last_activity_date": 1480932553, "creation_date": 1480932553, "answer_id": 40971741, "question_id": 40971542, "link": "https://stackoverflow.com/questions/40971542/unmarshal-json-with-valid-zero-values/40971741#40971741", "title": "Unmarshal JSON with &quot;valid&quot; zero values", "body": "<p>Your code is correct. Test the pointer against nil and dereference the pointer if you want the value: </p>\n\n<pre><code>fmt.Printf(\"Should print the value of the int, not pointer... %d\", *o.ClientData.MissingInt)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "edited": false, "score": 0, "creation_date": 1480934109, "post_id": 40971916, "comment_id": 69153331, "body": "Thank you very much for taking the time to explain this.  That was very useful."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1480935807, "last_edit_date": 1480935807, "creation_date": 1480933242, "answer_id": 40971916, "question_id": 40971542, "link": "https://stackoverflow.com/questions/40971542/unmarshal-json-with-valid-zero-values/40971916#40971916", "title": "Unmarshal JSON with &quot;valid&quot; zero values", "body": "<p>Your confusion arises from the default formatting of the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code></a> package, which prints the hex value in case of pointer fields, and not the pointed value.</p>\n\n<p>If you're using the <code>%#v</code> verb for printing, you may implement the <a href=\"https://golang.org/pkg/fmt/#GoStringer\" rel=\"nofollow noreferrer\"><code>fmt.GoStringer</code></a> interface on your struct to override this \"behavior\":</p>\n\n<pre><code>func (c ClientData) GoString() string {\n    mi := \"&lt;missing&gt;\"\n    if c.MissingInt != nil {\n        mi = strconv.Itoa(*c.MissingInt)\n    }\n    ms := \"&lt;missing&gt;\"\n    if c.MissingString != nil {\n        ms = *c.MissingString\n    }\n\n    return fmt.Sprintf(\"{TestCode: %s, MissingInt: %s, DefaultInt: %d, MissingString: %s, DefaultString: %s}\",\n        c.TestCode, mi, c.DefaultInt, ms, c.DefaultString)\n}\n</code></pre>\n\n<p>And changing the last printing line to:</p>\n\n<pre><code>fmt.Printf(\"Should print the value of the int, not pointer... %d\",\n    *o.ClientData.MissingInt)\n</code></pre>\n\n<p>Your output becomes more readable (try it on the <a href=\"https://play.golang.org/p/RdEXV-DcTm\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>main.RawMessage{AlwaysString:\"AAAAAA\", ClientData:{TestCode: Sss, MissingInt: &lt;missing&gt;, DefaultInt: 0, MissingString: &lt;missing&gt;, DefaultString: }, ReceptionTime:123456}\nmain.RawMessage{AlwaysString:\"AAAAAA\", ClientData:{TestCode: Sss, MissingInt: 0, DefaultInt: 0, MissingString: , DefaultString: }, ReceptionTime:123456}\nShould print the value of the int, not pointer... 0\n</code></pre>\n\n<p>As you can see from the output above, the <code>MissingXX</code> fields have the static value <code>&lt;missing&gt;</code> displayed.</p>\n\n<p><strong>Note:</strong> If you were to use the <code>%v</code> verb, you'd have to implement the <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow noreferrer\"><code>fmt.Stringer</code></a> interface, which is basically the same, just the method name is not <code>GoString()</code> but simply <code>String()</code>.</p>\n"}], "owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 991, "favorite_count": 0, "accepted_answer_id": 40971741, "answer_count": 2, "score": 3, "last_activity_date": 1480935807, "creation_date": 1480931877, "last_edit_date": 1495541629, "question_id": 40971542, "link": "https://stackoverflow.com/questions/40971542/unmarshal-json-with-valid-zero-values", "title": "Unmarshal JSON with &quot;valid&quot; zero values", "body": "<p>I have some JSON that I am unmarshalling into various structs so that I can then process the data, seemingly this is turning into the hardest part of the project!!!</p>\n\n<p>The format of this JSON is that if the field is missing then it is essentially nil.  This is following on from <a href=\"https://stackoverflow.com/questions/40970422/default-struct-values\">Default struct values</a> but thought it deserved it's own question on SO.  </p>\n\n<p>A zero therefore is a valid value and I need to be able to discern this in my Go code.  Is there a way to get Go to unmarshal into this struct with pointers at all?</p>\n\n<p>In the example <a href=\"https://play.golang.org/p/B3-sos2FaH\" rel=\"nofollow noreferrer\">playground</a> you can see what I mean, it \"appears\" to work but when I come to print out one of the pointer values it always prints the pointer address and not the actual value.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"log\"\nimport \"encoding/json\"\n\nconst inputMissing = `\n[\"AAAAAA\", {\"testCode\" : \"Sss\"}, 123456]\n`\n\nconst inputZero = `\n[\"AAAAAA\", {\"testCode\" : \"Sss\", \"missingInt\" : 0, \"defaultInt\" : 0,\"missingString\" : \"\", \"defaultString\" : \"\"}, 123456]\n`\n\ntype RawMessage struct {\n    AlwaysString  string\n    ClientData    ClientData\n    ReceptionTime int\n}\n\ntype ClientData struct {\n    TestCode   string\n    MissingInt *int\n    DefaultInt int\n\n    MissingString *string\n    DefaultString string\n}\n\nfunc main() {\n\n    var n RawMessage\n    if err := json.Unmarshal([]byte(inputMissing), &amp;n); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%#v\\n\", n)\n\n    var o RawMessage\n    if err := json.Unmarshal([]byte(inputZero), &amp;o); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%#v\\n\", o)\n\n    fmt.Printf(\"Should print the value of the int, not pointer... %i\", o.ClientData.MissingInt)\n}\n\nfunc (n *RawMessage) UnmarshalJSON(buf []byte) error {\n    tmp := []interface{}{&amp;n.AlwaysString, &amp;n.ClientData, &amp;n.ReceptionTime}\n    wantLen := len(tmp)\n    if err := json.Unmarshal(buf, &amp;tmp); err != nil {\n        return err\n    }\n    if g, e := len(tmp), wantLen; g != e {\n        return fmt.Errorf(\"wrong number of fields in RawMessage: %d != %d\", g, e)\n    }\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 3, "creation_date": 1480933075, "post_id": 40971515, "comment_id": 69152722, "body": "You absolutely can operate on channels within a method. Your test fails because there is a t.Fail() at the end that is always executed. You need to fail conditionally."}, {"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "reply_to_user": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1480934390, "post_id": 40971515, "comment_id": 69153495, "body": "Only through t.Fail() can I let test print to console, the values sent through method was not received by receive end on the out side"}, {"owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "edited": false, "score": 2, "creation_date": 1480934577, "post_id": 40971515, "comment_id": 69153614, "body": "I think you have a race condition there. There is no guarantee the goroutine will print the message before your test ends"}, {"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480934919, "post_id": 40971515, "comment_id": 69153836, "body": "orderManagement.observers[&quot;123&quot;] &lt;- OrderMutation{order, &quot;w&quot;} why does this line works?"}, {"owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "edited": false, "score": 0, "creation_date": 1480941017, "post_id": 40971515, "comment_id": 69157665, "body": "verbose mode when testing <code>go test .&#47;... -v</code> this allows you to always print logs."}, {"owner": {"reputation": 179, "user_id": 680906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92d0acd7c48668139953457729851453?s=128&d=identicon&r=PG", "display_name": "whytheplatypus", "link": "https://stackoverflow.com/users/680906/whytheplatypus"}, "edited": false, "score": 0, "creation_date": 1480945421, "post_id": 40971515, "comment_id": 69160357, "body": "buffered channels only block when the buffer is <a href=\"https://tour.golang.org/concurrency/3\" rel=\"nofollow noreferrer\">full</a>. so uncommenting that line causes your test thread to block and wait for a read in the goroutine, allowing the prints in the goroutine to happen before the main thread hit&#39;s <code>t.Fail()</code>."}, {"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480989152, "post_id": 40971515, "comment_id": 69182306, "body": "I will try it, thanks!"}, {"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480992393, "post_id": 40971515, "comment_id": 69183175, "body": "I have resolved it sort of, is to add a resolve method to receive the signal, and call it from outside, still I want to know is there a way to receive it directly from outside"}, {"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480992439, "post_id": 40971515, "comment_id": 69183186, "body": "func (rx *RxOrder) resolve(key string) OrderMutation { \treturn &lt;-rx.observers[key] // This is the resolve method"}, {"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480992460, "post_id": 40971515, "comment_id": 69183191, "body": "go func() { \t\torderManagement.createOrder(order) \t}()  \tfor key := range orderManagement.observers { \t\tfmt.Println(orderManagement.resolve(key)) \t} // This is what&#39;s called from the outside"}], "answers": [{"comments": [{"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480989175, "post_id": 40975701, "comment_id": 69182312, "body": "No I have checked, even without any error, there are no values received."}, {"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480991352, "post_id": 40975701, "comment_id": 69182882, "body": "It always prints  fatal error: all goroutines are asleep - deadlock!"}, {"owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "reply_to_user": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480993421, "post_id": 40975701, "comment_id": 69183432, "body": "<code>go err := orderManagement.createOrder(order) if err != nil {     fmt.Println(&quot;orderManagement error:&quot;, err) } </code> add this to check the createOrder err, and you can print some log at here:   <code>go  for _, ch := range rx.observers {         ch &lt;- OrderMutation{order, &quot;create&quot;}  } </code>"}, {"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480993718, "post_id": 40975701, "comment_id": 69183505, "body": "Yes, this helps"}], "tags": [], "owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "is_accepted": false, "score": 0, "last_activity_date": 1480950480, "last_edit_date": 1480950480, "creation_date": 1480945497, "answer_id": 40975701, "question_id": 40971515, "link": "https://stackoverflow.com/questions/40971515/value-sent-to-channel-by-method-in-go-cannot-be-received-on-the-outside/40975701#40975701", "title": "Value sent to channel by method in go, cannot be received on the outside", "body": "<p>The situation depends on the following outputs\uff1a </p>\n\n<p>Does you <code>createOrder</code> return an error?</p>\n\n<p>If <code>createOrder</code> has any error\uff0cthen it will not send any message on the channel, so by commenting that line your main test function will exit without waiting. </p>\n\n<p>You have no output, if you add the mentioned line, your main  test function will wait on the channel operation until your coroutine receives the message and prints the output.</p>\n\n<p>If your <code>createOrder</code> has no error\uff0c you will face a race condition because the message sent on channel except \"123\" will block your main test function forever.</p>\n"}, {"comments": [{"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "edited": false, "score": 0, "creation_date": 1480993211, "post_id": 40987102, "comment_id": 69183381, "body": "However, I am still open to other options"}], "tags": [], "owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "is_accepted": false, "score": 0, "last_activity_date": 1480993193, "creation_date": 1480993193, "answer_id": 40987102, "question_id": 40971515, "link": "https://stackoverflow.com/questions/40971515/value-sent-to-channel-by-method-in-go-cannot-be-received-on-the-outside/40987102#40987102", "title": "Value sent to channel by method in go, cannot be received on the outside", "body": "<p>After I did this, everything works.</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>go func() {\n  for _, ch: = range rx.observers {\n    ch &lt;-OrderMutation {\n      order, \"create\"\n    }\n  }\n}()\n\n// create a goroutine to send message\n\n    func() {\n        orderManagement.createOrder(order)\n    }()\n\n    select {\n    case val := &lt;-orderManagement.observers[\"123\"]:\n        fmt.Println(val)\n    }\n\n// then receive on the outside like this\n</code></pre>\n\n<p>Even without resolve method everything works.</p>\n"}], "owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1480993193, "creation_date": 1480931811, "last_edit_date": 1480934586, "question_id": 40971515, "link": "https://stackoverflow.com/questions/40971515/value-sent-to-channel-by-method-in-go-cannot-be-received-on-the-outside", "title": "Value sent to channel by method in go, cannot be received on the outside", "body": "<p>I was trying to implement sort-of a reactive golang implementation. I have an array of observers. They are just a bunch of channels. Everything is encapsulated in a package where other code could subscribe and unsubscribe. When ever an order is created, the change will be pushed. But I have failed to register channel receive with in a method.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package rxOrder\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"errors\"\n\n    \"gopkg.in/mgo.v2/bson\"\n)\n\n// Order This is the sample data structure\ntype Order struct {\n    id        bson.ObjectId\n    moldID    bson.ObjectId\n    bomID     bson.ObjectId\n    deviceID  bson.ObjectId\n    userIds   []bson.ObjectId\n    name      string\n    orderType string // withOrder, noOrder, makeUp, test\n    startTime time.Time\n    deadline  time.Time\n    volume    int32\n}\n\n// OrderMutation This is the struct for sending\n// mutations to observers\ntype OrderMutation struct {\n    order  Order\n    action string\n}\n\n// RxOrder This is the node for reactive Order\n// management\ntype RxOrder struct {\n    orders    []Order\n    observers map[string]chan OrderMutation\n}\n\n// init This method initialize RxOrder, including\n// orders slice and subscriber map, user cannot\n// initialize a RxOrder object more than once\nfunc (rx *RxOrder) init() error {\n    if len(rx.orders) == 0 &amp;&amp; len(rx.observers) == 0 {\n        rx.orders = make([]Order, 1)\n        rx.observers = make(map[string]chan OrderMutation)\n        return nil\n    }\n\n    return errors.New(\"Cannot reinitialize orders\")\n}\n\n// subscribe, add observer to list\nfunc (rx *RxOrder) subscribe(key string, ch chan OrderMutation) error {\n    if _, ok := rx.observers[key]; ok {\n        return errors.New(\"Observer already existed\")\n    }\n\n    rx.observers[key] = ch\n\n    return nil\n}\n\n// unsubscribe, delete observer from list\nfunc (rx *RxOrder) unsubscribe(key string) error {\n    if _, ok := rx.observers[key]; !ok {\n        return errors.New(\"Observer does not exist\")\n    }\n\n    delete(rx.observers, key)\n\n    return nil\n}\n\n// createOrder The method for creating an order\nfunc (rx *RxOrder) createOrder(order Order) error {\n\n    if !order.id.Valid() {\n        return errors.New(\"Invalid order id\")\n    }\n\n    if !order.bomID.Valid() {\n        return errors.New(\"Invalid bom id\")\n    }\n\n    if !order.deviceID.Valid() {\n        return errors.New(\"Invalid device id\")\n    }\n\n    if !order.moldID.Valid() {\n        return errors.New(\"Invalid mold id\")\n    }\n\n    if len(order.userIds) &lt; 1 {\n        return errors.New(\"Empty users list\")\n    }\n\n    for index, userID := range order.userIds {\n        if !userID.Valid() {\n            return errors.New(fmt.Sprint(\"Invalid user id at index: \", index))\n        }\n    }\n\n    if len(order.name) &lt; 1 {\n        return errors.New(\"Empty order name\")\n    }\n\n    if order.orderType != \"withOrder\" &amp;&amp; order.orderType != \"noOrder\" &amp;&amp; order.orderType != \"makeUp\" &amp;&amp; order.orderType != \"test\" {\n        return errors.New(\"Wrong order type\")\n    }\n\n    if order.startTime.After(order.deadline) {\n        return errors.New(\"Deadline cannot come before start time\")\n    }\n\n    if order.volume &lt; 1 {\n        return errors.New(\"Empty order is not accepted\")\n    }\n\n    rx.orders = append(rx.orders, order)\n\n    for _, ch := range rx.observers {\n        ch &lt;- OrderMutation{order, \"create\"}\n    }\n\n    return nil\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestCreateOrder(t *testing.T) {\n    orderManagement := RxOrder{}\n\n    orderManagement.init()\n\n    orderManagement.subscribe(\"123\", make(chan OrderMutation))\n    orderManagement.subscribe(\"345\", make(chan OrderMutation))\n    orderManagement.subscribe(\"768\", make(chan OrderMutation))\n\n    order := Order{}\n    order.id = bson.NewObjectId()\n    order.bomID = bson.NewObjectId()\n    order.deviceID = bson.NewObjectId()\n    order.moldID = bson.NewObjectId()\n    order.name = \"iPhone 8+\"\n    order.orderType = \"withOrder\"\n    order.volume = 5\n    order.startTime = time.Now()\n    order.deadline = order.startTime.AddDate(0, 1, 1)\n    order.userIds = make([]bson.ObjectId, 1)\n    order.userIds = append(order.userIds, bson.NewObjectId())\n\n    go func(t *testing.T) {\n        fmt.Println(&lt;-orderManagement.observers[\"123\"])\n    }(t)\n\n    orderManagement.createOrder(order)\n    //orderManagement.observers[\"123\"] &lt;- OrderMutation{order, \"w\"}\n\n    t.Fail()\n}\n</code></pre>\n\n<p>when I do test, the above code prints nothing, but if I uncomment line:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>orderManagement.observers[\"123\"] &lt;- OrderMutation{order, \"w\"}\n</code></pre>\n\n<p>Everything works. It seems I cannot operate on channel within a method. How can I encapsulate channel operation with in package?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1480928714, "post_id": 40970422, "comment_id": 69150087, "body": "These two are totally the same and completely indistinguishable. Note that Go has formally no notion of &quot;default value&quot;: All values come to existence with their <i>zero</i> <i>value</i>. It makes absolutely no difference whether the compiler provides the zero value of <code>testIntOne</code> or if you do it yourself: You cannot tell. So: redesign."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1480928896, "last_edit_date": 1495542269, "creation_date": 1480928459, "answer_id": 40970490, "question_id": 40970422, "link": "https://stackoverflow.com/questions/40970422/default-struct-values/40970490#40970490", "title": "Default struct values", "body": "<p>You can't tell the difference, it is not tracked whether a field (or a variable) has been set or not.</p>\n\n<h3>Using a pointer</h3>\n\n<p>You may use a pointer which has a <code>nil</code> <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a>, so if not set, you can tell:</p>\n\n<pre><code>type test struct {\n    testIntOne *int\n    testIntTwo *int\n}\n\nfunc main() {\n    s := test{testIntOne: new(int)}\n\n    fmt.Println(\"testIntOne set:\", s.testIntOne != nil)\n    fmt.Println(\"testIntTwo set:\", s.testIntTwo != nil)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/MHiFGRvNaj\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>testIntOne set: true\ntestIntTwo set: false\n</code></pre>\n\n<p>Of course <code>new()</code> can only be used to obtain a pointer to an <code>int</code> value being <code>0</code>. See this question for more options: <a href=\"https://stackoverflow.com/questions/30716354/how-do-i-do-a-literal-int64-in-go/30716481#30716481\">How do I do a literal *int64 in Go?</a></p>\n\n<h3>Using a method</h3>\n\n<p>You may also use a method to set a field, which could take care of additionally tracking the \"isSet\" property. In this case you must always use the provided method to set the field. Best is to make fields unexported, so others (outside your package) won't have direct access to them.</p>\n\n<pre><code>type test struct {\n    testIntOne int\n    testIntTwo int\n\n    oneSet, twoSet bool\n}\n\nfunc (t *test) SetOne(i int) {\n    t.testIntOne, t.oneSet = i, true\n}\n\nfunc (t *test) SetTwo(i int) {\n    t.testIntTwo, t.twoSet = i, true\n}\n\nfunc main() {\n    s := test{}\n    s.SetOne(0)\n\n    fmt.Println(\"testIntOne set:\", s.oneSet)\n    fmt.Println(\"testIntTwo set:\", s.twoSet)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/Lj0vUkXkUS\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>testIntOne set: true\ntestIntTwo set: false\n</code></pre>\n"}], "owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 1, "accepted_answer_id": 40970490, "answer_count": 1, "score": 1, "last_activity_date": 1480928896, "creation_date": 1480928205, "question_id": 40970422, "link": "https://stackoverflow.com/questions/40970422/default-struct-values", "title": "Default struct values", "body": "<p>In Go I get that there are default values for types.  Take int in this case which is initialised as a 0.</p>\n\n<p>I have an issue where for me a 0 in an int can be a valid value so I need to check if it's been set by me or initialised as such.  Is there any way to tell the difference between them at all? </p>\n\n<p>Considering the <a href=\"https://play.golang.org/p/d2Eymq6NSz\" rel=\"nofollow noreferrer\">following code</a>... I need to be able to tell the difference between <code>testIntOne</code> and <code>testIntTwo</code> but they look the same!</p>\n\n<pre><code>package main\n\nimport \"log\"\n\ntype test struct {\n    testIntOne int\n    testIntTwo int\n}\n\nfunc main() {\n    s := test{testIntOne: 0}\n\n    log.Println(s)\n}\n</code></pre>\n"}, {"tags": ["go", "middleware"], "comments": [{"owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "edited": false, "score": 2, "creation_date": 1480929762, "post_id": 40970343, "comment_id": 69150670, "body": "you can&#39;t, the doc says the middleware func should have the form of <code>func (http.Handler) http.Handler</code>, you must to find out a different method like session data or other store mechanism."}, {"owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "edited": false, "score": 1, "creation_date": 1480968257, "post_id": 40970343, "comment_id": 69174329, "body": "Also want to add that using the Context is another option for this, that&#39;s what it&#39;s there for."}], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 2, "last_activity_date": 1480937886, "last_edit_date": 1480937886, "creation_date": 1480936056, "answer_id": 40972832, "question_id": 40970343, "link": "https://stackoverflow.com/questions/40970343/how-can-i-pass-parameters-to-a-alice-middleware-in-go/40972832#40972832", "title": "How can I pass parameters to a alice middleware in Go?", "body": "<p>As mentioned by <code>Motakjuq</code>, you can't directly write a middleware that takes in options as an argument since they need to be of the signature <code>func (http.Handler) http.Handler</code>.</p>\n\n<p>What you can do is make a function that generates your middleware function. </p>\n\n<pre><code>func middlewareGenerator(foo, foo2 string) (mw func(http.Handler) http.Handler) {\n\n    mw = func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            // Use foo1 &amp; foo2\n            h.ServeHTTP(w, r)\n        })\n    }\n    return\n}\n</code></pre>\n\n<p>Then you can do the following</p>\n\n<p><code>middlewareChain := alice.New(middlewareGenerator(\"foo\",\"foo2\"))</code></p>\n"}, {"tags": [], "owner": {"reputation": 1639, "user_id": 7187655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hvz9T.png?s=128&g=1", "display_name": "Motakjuq", "link": "https://stackoverflow.com/users/7187655/motakjuq"}, "is_accepted": false, "score": 1, "last_activity_date": 1480936167, "creation_date": 1480936167, "answer_id": 40972860, "question_id": 40970343, "link": "https://stackoverflow.com/questions/40970343/how-can-i-pass-parameters-to-a-alice-middleware-in-go/40972860#40972860", "title": "How can I pass parameters to a alice middleware in Go?", "body": "<p>Maybe I didn't understand your question, if your params in <code>Func1</code> change in every request, you can't pass the arguments to the function. If your function required some params when you register it with alice, you can return the required function, something like:</p>\n\n<pre><code>func Func1(foo, foo2, timeoutMessage string) alice.Constructor {\n    //... something to do with foo and foo2\n    return func(h http.Handler) http.Handler {\n        return http.TimeoutHandler(h, 1*time.Second, timeoutMessage)\n    }\n}\n</code></pre>\n\n<p>And if you want to use it</p>\n\n<pre><code>chain := alice.New(Func1(\"\", \"\", \"time out\"))....\n</code></pre>\n"}], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1503, "favorite_count": 0, "accepted_answer_id": 40972832, "answer_count": 2, "score": 0, "last_activity_date": 1480946083, "creation_date": 1480927895, "last_edit_date": 1480946083, "question_id": 40970343, "link": "https://stackoverflow.com/questions/40970343/how-can-i-pass-parameters-to-a-alice-middleware-in-go", "title": "How can I pass parameters to a alice middleware in Go?", "body": "<p>I am using <a href=\"https://github.com/justinas/alice\" rel=\"nofollow noreferrer\">justinas/alice</a> middleware in Go, and I want to pass arguments to the function used in the middleware. </p>\n\n<p>For example:</p>\n\n<pre><code>middlewareChain := alice.New(Func1(foo string,foo2 string))\n</code></pre>\n\n<p>How can I do that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1480925735, "post_id": 40969728, "comment_id": 69148561, "body": "You have to export the fields of the struct, start them with capital letter (<code>Id</code> and <code>Name</code>)."}, {"owner": {"reputation": 4227, "user_id": 496797, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/83f7b66c4dee7effbb3717027f99282b?s=128&d=identicon&r=PG", "display_name": "Sayanee", "link": "https://stackoverflow.com/users/496797/sayanee"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1480930149, "post_id": 40969728, "comment_id": 69150902, "body": "Thanks! Got it - the capitalisation."}], "owner": {"reputation": 4227, "user_id": 496797, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/83f7b66c4dee7effbb3717027f99282b?s=128&d=identicon&r=PG", "display_name": "Sayanee", "link": "https://stackoverflow.com/users/496797/sayanee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 867, "favorite_count": 0, "closed_date": 1480925689, "answer_count": 0, "score": 0, "last_activity_date": 1480925338, "creation_date": 1480925338, "question_id": 40969728, "link": "https://stackoverflow.com/questions/40969728/nested-json-response-in-go-lang-gin", "closed_reason": "Duplicate", "title": "nested json response in Go lang Gin", "body": "<p>I'm trying to make a response that looks a little like this with 2 nodes <code>channel</code> and <code>feeds</code> which is an array with Go Lang's <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">Gin</a> HTTP Web Framework:</p>\n\n<pre><code>{\n  \"channel\": {\n    \"id\": \"34HG34\",\n    \"name\": \"username\"\n  },\n  \"feeds\": [\n    {\n      \"timestamp\": 147911578000,\n      \"field1\": 29.89\n    },\n    {\n      \"timestamp\": 147911578030,\n      \"field1\": 32.01\n    }\n    ]\n}\n</code></pre>\n\n<p>I'm unable to display the <code>channel</code> node, but the <code>feeds</code> array list works. This is my code:</p>\n\n<pre><code>type Response struct {\n    Channel ChannelType `json:\"channel\"`\n    Feed []FeedType `json:\"feeds\"`\n}\n\ntype FeedType struct {\n  Timestamp int `json:\"timestamp\"`\n  Field1 float64 `json:\"field1\"`\n}\n\ntype ChannelType struct {\n    id string `json:\"id\"`\n    name string `json:\"name\"`\n}\n\nchannelA := ChannelType{\n        id: \"hello\",\n        name: \"Savanna\",\n}\n\nvar FeedListA []FeedType\nFeedListA = make([]FeedType, 0)\nFeedListB = append(FeedListB, feed) // feed is something\n\nrouter.GET(\"/hello\", func(c *gin.Context) {\n        c.JSON(200, gin.H{\n            \"channel\": channelA,\n            \"feeds\": FeedListA,\n        })\n    })\n</code></pre>\n\n<p>And this is the json output where the <code>channel</code> is blank:</p>\n\n<pre><code>{\n  \"channel\": {\n\n  },\n  \"feeds\": [\n    {\n      \"timestamp\": 147911578000,\n      \"field1\": 32\n    }\n  ]\n}\n</code></pre>\n\n<p>How can I display the <code>channel</code> node in the json response as well?</p>\n"}, {"tags": ["git", "go"], "comments": [{"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1480917739, "post_id": 40967859, "comment_id": 69145214, "body": "which version of go do you use ?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1480928423, "post_id": 40967859, "comment_id": 69149931, "body": "Unrelated to Go: A simple git problem."}, {"owner": {"reputation": 79, "user_id": 2417936, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/TG5R8.jpg?s=128&g=1", "display_name": "Bright", "link": "https://stackoverflow.com/users/2417936/bright"}, "edited": false, "score": 0, "creation_date": 1481117435, "post_id": 40967859, "comment_id": 69244590, "body": "I&#39;m using version 1.7.                                                                                          i wanted to add autocomplete plugin to Atom editor for GOLANG, and it requires gocode before the plugin can work."}], "answers": [{"tags": [], "owner": {"reputation": 3102, "user_id": 2518022, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/dyYFh.jpg?s=128&g=1", "display_name": "Gepser", "link": "https://stackoverflow.com/users/2518022/gepser"}, "is_accepted": false, "score": 2, "last_activity_date": 1480919928, "creation_date": 1480919928, "answer_id": 40968445, "question_id": 40967859, "link": "https://stackoverflow.com/questions/40967859/gocode-tool-error/40968445#40968445", "title": "Gocode tool error", "body": "<p>I am not sure why do you have changes on the <code>gocode</code> repository but you can do one of two things, depending of what you want.</p>\n\n<p><strong>You don't care about your local changes:</strong></p>\n\n<pre><code>cd $GOPATH/src/github.com/nsf/gocode\ngit checkout -- .\ngo get -u github.com/nsf/gocode\n</code></pre>\n\n<p>Here you are deleting your local changes and then updating <code>gocode</code>, so you don't have merge conflicts anymore.</p>\n\n<p><strong>You want to keep your local changes for some reason:</strong></p>\n\n<pre><code>cd $GOPATH/src/github.com/nsf/gocode\ngit stash\ngo get -u github.com/nsf/gocode\ngit stash apply\n</code></pre>\n\n<p>Here you are <a href=\"https://git-scm.com/docs/git-stash\" rel=\"nofollow noreferrer\">stashing</a> your changes and applying them again after updating the code.</p>\n"}], "owner": {"reputation": 79, "user_id": 2417936, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/TG5R8.jpg?s=128&g=1", "display_name": "Bright", "link": "https://stackoverflow.com/users/2417936/bright"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1480926771, "creation_date": 1480917016, "last_edit_date": 1480926771, "question_id": 40967859, "link": "https://stackoverflow.com/questions/40967859/gocode-tool-error", "title": "Gocode tool error", "body": "<p>I want to install gocode but whenever i try the command: go get -u github.com/nsf/gocode<br /><br/>\n    I get the error below:</p>\n\n<pre><code>error: Your local changes to the following files would be overwritten by merge:\nautocompletecontext.go\nautocompletefile.go\ndecl.go\nemacs-company/README.md\nemacs-company/company-go.el\npackage.go\npackage_bin.go\npackage_text.go\nutils.go\n\nPlease commit your changes or stash them before you merge.Aborting Updating 46e8fd2..5070dac package github.com/nsf/gocode: exit status 1\n</code></pre>\n\n<p>so how do i force merge or overwrite the listed files. Thanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1098, "user_id": 1751481, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh4.googleusercontent.com/-onO6tWUKzZQ/AAAAAAAAAAI/AAAAAAAAABg/T7_y-XIV7CU/photo.jpg?sz=128", "display_name": "GabeMeister", "link": "https://stackoverflow.com/users/1751481/gabemeister"}, "edited": false, "score": 0, "creation_date": 1480943661, "post_id": 40967689, "comment_id": 69159234, "body": "This is a pretty good solution, but how would I go about putting this into a wrapper function. For instance, what would the type be for myCustomList if I wanted to pass it to a function, along with the file path"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1480954205, "post_id": 40967689, "comment_id": 69166278, "body": "This doesn&#39;t work. You can&#39;t use <code>range</code> on something of type <code>interface{}</code>. It doesn&#39;t compile."}, {"owner": {"reputation": 1098, "user_id": 1751481, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh4.googleusercontent.com/-onO6tWUKzZQ/AAAAAAAAAAI/AAAAAAAAABg/T7_y-XIV7CU/photo.jpg?sz=128", "display_name": "GabeMeister", "link": "https://stackoverflow.com/users/1751481/gabemeister"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1481411116, "post_id": 40967689, "comment_id": 69368610, "body": "@Andy Schweig You&#39;re correct, this doesn&#39;t work. If I use a type assertion on value aka <code>value.(string)</code> then the function compiles, but then I can&#39;t pass in a slice of any type into the function without the compiler complaining. Looks like the most idiomatic solution is to just create helper functions for all the types I use."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1481502064, "last_edit_date": 1481502064, "creation_date": 1480916058, "answer_id": 40967689, "question_id": 40967282, "link": "https://stackoverflow.com/questions/40967282/write-a-slice-of-any-type-to-a-file-in-go/40967689#40967689", "title": "Write a slice of any type to a file in Go", "body": "<p>Use the <a href=\"https://godoc.org/fmt\" rel=\"nofollow noreferrer\">fmt</a> package format values as strings and print to a file:</p>\n\n<pre><code>func printLines(filePath string, values []interface{}) error {\n    f, err := os.Create(filePath)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n    for _, value := range values {\n       fmt.Fprintln(f, value)  // print values to f, one per line\n    }\n    return nil\n}\n</code></pre>\n\n<p><code>fmt.Fprintln</code> will call <code>Stringer()</code> on your struct type. It will also print <code>int</code> values and <code>string</code> values. </p>\n\n<p><a href=\"https://play.golang.org/p/QsPFwAlxyr\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p>Use the reflect package to write any slice type:</p>\n\n<pre><code>func printLines(filePath string, values interface{}) error {\n  f, err := os.Create(filePath)\n  if err != nil {\n    return err\n  }\n  defer f.Close()\n  rv := reflect.ValueOf(values)\n  if rv.Kind() != reflect.Slice {\n    return errors.New(\"Not a slice\")\n  }\n  for i := 0; i &lt; rv.Len(); i++ {\n    fmt.Fprintln(f, rv.Index(i).Interface())\n  }\n  return nil\n}\n</code></pre>\n\n<p>If you have variable <code>values</code> of type <code>myCustomList</code>, then you can call it like this: <code>err := printLines(filePath, values)</code></p>\n\n<p><a href=\"https://play.golang.org/p/rHTjmbQmqs\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 1098, "user_id": 1751481, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh4.googleusercontent.com/-onO6tWUKzZQ/AAAAAAAAAAI/AAAAAAAAABg/T7_y-XIV7CU/photo.jpg?sz=128", "display_name": "GabeMeister", "link": "https://stackoverflow.com/users/1751481/gabemeister"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4688, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1481502064, "creation_date": 1480913392, "last_edit_date": 1480916101, "question_id": 40967282, "link": "https://stackoverflow.com/questions/40967282/write-a-slice-of-any-type-to-a-file-in-go", "title": "Write a slice of any type to a file in Go", "body": "<p>For logging purposes I want to be able to quickly write a slice of any type, whether it be ints, strings, or custom structs, to a file in Go. For instance, in C#, I can do the following in 1 line:</p>\n\n<pre><code>File.WriteAllLines(filePath, myCustomTypeList.Select(x =&gt; x.ToString());\n</code></pre>\n\n<p>How would I go about doing this in Go? The structs implement the <code>Stringer</code> interface.</p>\n\n<p>Edit: I in particular would like the output to be printed to a file and one line per item in the slice </p>\n"}, {"tags": ["go", "rtti"], "comments": [{"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 3, "creation_date": 1480929099, "post_id": 40967130, "comment_id": 69150297, "body": "I&#39;ve passed hours reading docs and trying to find an answer to your question. But, hummm what i can say is i didn&#39;t found anything related to it. If you find any solution please update your question or answer it. It would be helpful. Thanks."}, {"owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "edited": false, "score": 0, "creation_date": 1480952108, "post_id": 40967130, "comment_id": 69164999, "body": "can you post a runnable example?"}, {"owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "reply_to_user": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 1, "creation_date": 1480954396, "post_id": 40967130, "comment_id": 69166399, "body": "@nexus66 XD so.. I haven&#39;t found any solution yet, what I did was write the name and argument manually for each function.. something like this: <code>ram_key := &quot;FunctionName&quot; + I.ToS(arg1) + &quot;_&quot; + I.ToS(arg2) + &quot;_&quot; + I.ToS(arg3)</code> // not using any reflection at all so it probably faster"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1480955921, "post_id": 40967130, "comment_id": 69167318, "body": "@Kokizzu: this can be done by pre-processing the source. See <a href=\"https://github.com/mailgun/godebug/\" rel=\"nofollow noreferrer\">godebug</a> or a simpler proof of concept <a href=\"https://github.com/jbardin/gotrace/\" rel=\"nofollow noreferrer\">gotrace</a>. There&#39;s definitely no &quot;safe&quot; way to do it at runtime."}], "answers": [{"tags": [], "owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "is_accepted": false, "score": 4, "last_activity_date": 1480941702, "creation_date": 1480941702, "answer_id": 40974542, "question_id": 40967130, "link": "https://stackoverflow.com/questions/40967130/getting-function-arguments-at-runtime-in-go/40974542#40974542", "title": "Getting function arguments at runtime in Go", "body": "<p>Not a full answer, but maybe this can help :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    fmt.Println(reflect.TypeOf(f1))\n    for index := 0; index &lt; reflect.TypeOf(f1).NumIn(); index++ {\n        fmt.Println(reflect.TypeOf(f1).In(index))\n    }\n}\n\nfunc f1(a int, b string) {}\n</code></pre>\n\n<p>prints : </p>\n\n<p><code>func(int, string)\n int\n string</code></p>\n"}], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 4, "answer_count": 1, "score": 5, "last_activity_date": 1480941702, "creation_date": 1480912217, "question_id": 40967130, "link": "https://stackoverflow.com/questions/40967130/getting-function-arguments-at-runtime-in-go", "title": "Getting function arguments at runtime in Go", "body": "<p>How to get function arguments in Go at runtime, all I know is only how to get function name:</p>\n\n<pre><code>pc, file, line, ok := runtime.Caller(2)\nrt := runtime.FuncForPC(pc)\nreturn rt.Name() // Foo\n</code></pre>\n\n<p>What I need is something like this:</p>\n\n<pre><code>Foo(1,2,3)\n// Foo_1_2_3\n</code></pre>\n"}, {"tags": ["api", "go", "reflection"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1480914770, "post_id": 40966289, "comment_id": 69144387, "body": "Because reflection is dangerous, slow and much too easy to abuse and misuse."}, {"owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1480950542, "post_id": 40966289, "comment_id": 69163893, "body": "But why does it help to hide it? Their examples in the book uses reflection, but hide it in unexported functions. And the exported functions call the unexported functions."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1480952239, "post_id": 40966289, "comment_id": 69165082, "body": "Because an unexported function is an implementation detail which you now can change. That&#39;s basically what they say. If you need to use reflection: At least keep it hidden from the user."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1547457382, "creation_date": 1547457382, "answer_id": 54178536, "question_id": 40966289, "link": "https://stackoverflow.com/questions/40966289/avoid-exposing-reflection-in-the-package-api/54178536#54178536", "title": "avoid exposing reflection in the package API", "body": "<h2>In the book's example</h2>\n\n<p>In the book's example, it is because the usage of reflection is an implementation detail. You should always try to hide the implementation details, so you may change the implementation at any time without breaking the \"public\" API of the package. If you export / add something to the API of your package, you have to carry that for the rest of your life (given you don't want to make backward-incompatible API changes, which is really bad in general).</p>\n\n<h2>In general</h2>\n\n<p><em>\"<code>interface{}</code> says nothing\"</em> \u2013 Rob Pike. Given that, <code>reflect.Value</code> says even less. Unless you have a good reason (can't think of any outside of the <code>reflect</code> package itself), you shouldn't create public functions that expect <code>reflect.Value</code> as their arguments.</p>\n\n<p>Even if you have a \"general\" function that must take a value of any type, <code>interface{}</code> is preferred as then at least the clients can pass what they have as-is, without having to wrap them in <code>reflect.Value</code>.</p>\n"}], "owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 54178536, "answer_count": 1, "score": 2, "last_activity_date": 1547457382, "creation_date": 1480905208, "last_edit_date": 1547134204, "question_id": 40966289, "link": "https://stackoverflow.com/questions/40966289/avoid-exposing-reflection-in-the-package-api", "title": "avoid exposing reflection in the package API", "body": "<p>In Alan Donovan and Brian Kernighan's \"The Go programming language\" book p333 (section 12.3 Display, a recursive value printer), it is mentioned that </p>\n\n<blockquote>\n  <p>Where possible, you should avoid exposing reflection in the API of a package. We'll define an unexported function <code>display</code> to do the real work of the recursion, and export <code>Display</code>, a simple wrapper around it that accepts an <code>interface{}</code> parameter.</p>\n</blockquote>\n\n<pre><code>func Display(name string, x interface{}) {\n    fmt.Printf(\"Display %s (%T):\\n\", name, x)\n    display(name, reflection.ValueOf(x))\n</code></pre>\n\n<p>And the <code>display</code> function prints different contents depending on the <code>Kind</code> of the input reflection value.</p>\n\n<p>I have two questions</p>\n\n<ol>\n<li>Why is it better to not expose the reflection in the package API?</li>\n<li>Why is using an unexposed <code>display</code> function considered as not exposing reflection in the API? Don't we still call <code>reflection.ValueOf()</code> in <code>Display</code>?</li>\n</ol>\n\n<p>I guess I don't know the definition of \"exposing reflection in the package API\". Does it just refer to the function arguments or both arguments and content? If it's the former case, then there seems no need to define <code>display</code> since the signature of <code>Display</code> is <code>x interface{}</code>. If it's the latter case, why is it better?</p>\n"}, {"tags": ["random", "go"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1480895615, "post_id": 40965044, "comment_id": 69139860, "body": "<code>math&#47;rand</code> is for pseudo-random numbers, but if you need real random numbers for crypto algorithms, password generation, session ids, etc. you must use <code>crypto&#47;rand</code>, not clear what&#39;s your issue ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1480896306, "post_id": 40965044, "comment_id": 69140008, "body": "@YandryPozo, math/rand can be a useful wrapper around any random source to get specific numeric outputs."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1484170648, "last_edit_date": 1484170648, "creation_date": 1480947754, "answer_id": 40976463, "question_id": 40965044, "link": "https://stackoverflow.com/questions/40965044/using-crypto-rand-for-generating-permutations-with-rand-perm/40976463#40976463", "title": "Using crypto/rand for generating permutations with rand.Perm", "body": "<p>That's basically what you need to do. It's not often that you need a cryptographically secure source of randomness for the common usage of <code>math/rand</code>, so there's no adaptor provided. You can make the implementation slightly more efficient by allocating the buffer space directly in the struct, rather than allocating a new slice on every call.</p>\n\n<pre><code>type cryptoSource struct {\n    buf [8]byte\n}\n\nfunc (s *cryptoSource) Int63() int64 {\n    cryptoRand.Read(s.buf[:])\n    return int64(binary.BigEndian.Uint64(s.buf[:]) &amp; (1&lt;&lt;63 - 1))\n}\n</code></pre>\n\n<p>Or just make the source a <code>[8]byte</code> itself</p>\n\n<pre><code>type cryptoSource [8]byte\n\nfunc (s *cryptoSource) Int63() int64 {\n    cryptoRand.Read(s[:])\n    return int64(binary.BigEndian.Uint64(s[:]) &amp; (1&lt;&lt;63 - 1))\n}\n</code></pre>\n"}], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 1, "accepted_answer_id": 40976463, "answer_count": 1, "score": 4, "last_activity_date": 1484170648, "creation_date": 1480894611, "last_edit_date": 1480896983, "question_id": 40965044, "link": "https://stackoverflow.com/questions/40965044/using-crypto-rand-for-generating-permutations-with-rand-perm", "title": "Using crypto/rand for generating permutations with rand.Perm", "body": "<p>Go has two packages for random numbers:</p>\n\n<ul>\n<li><code>crypto/rand</code>, which provides a way to get random bytes</li>\n<li><code>math/rand</code>, which has a nice algorithm for shuffling ints</li>\n</ul>\n\n<p>I want to use the <code>Perm</code> algorithm from <code>math/rand</code>, but provide it with high-quality random numbers.</p>\n\n<p>Since the two <code>rand</code> packages are part of the same standard library there should be a way to combine them in a way so that <code>crypto/rand</code> provides a good source of random numbers that is used by <code>math/rand.Perm</code> to generate a permutation.</p>\n\n<p>Here (and on the <a href=\"https://play.golang.org/p/l5X5hZx_MX\" rel=\"nofollow noreferrer\">Playground</a>) is the code I wrote to connect these two packages:</p>\n\n<pre><code>package main\n\nimport (\n    cryptoRand \"crypto/rand\"\n    \"encoding/binary\"\n    \"fmt\"\n    mathRand \"math/rand\"\n)\n\ntype cryptoSource struct{}\n\nfunc (s cryptoSource) Int63() int64 {\n    bytes := make([]byte, 8, 8)\n    cryptoRand.Read(bytes)\n    return int64(binary.BigEndian.Uint64(bytes) &gt;&gt; 1)\n}\n\nfunc (s cryptoSource) Seed(seed int64) {\n    panic(\"seed\")\n}\n\nfunc main() {\n    rnd := mathRand.New(&amp;cryptoSource{})\n    perm := rnd.Perm(52)\n    fmt.Println(perm)\n}\n</code></pre>\n\n<p>This code works. Ideally I don't want to define the <code>cryptoSource</code> type myself but just stick together the two <code>rand</code> packages so that they work together. So is there a predefined version of this <code>cryptoSource</code> type somewhere?</p>\n"}, {"tags": ["sorting", "for-loop", "go", "concurrency", "channel"], "answers": [{"comments": [{"owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "edited": false, "score": 0, "creation_date": 1480884199, "post_id": 40963287, "comment_id": 69136222, "body": "Ah, okay. That actually makes a lot of sense, thanks!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1480883673, "last_edit_date": 1480883673, "creation_date": 1480883357, "answer_id": 40963287, "question_id": 40963042, "link": "https://stackoverflow.com/questions/40963042/golang-sorting-on-fan-in/40963287#40963287", "title": "Golang - Sorting on fan in", "body": "<p>I think the error message is pretty self-explanatory. Look at this:</p>\n\n<pre><code>for i := range ch {\n    logs.Messages = append(logs.Messages, &lt;- i)\n}\n</code></pre>\n\n<p><code>ch</code> is of type <code>chan &lt;- *CommonLogFormat</code>. <code>ch</code> is a channel. The <code>for range</code> loop over the channel yields the values sent on the channel, which will be stored in the loop variable <code>i</code>. <code>i</code> is not a channel, but the values sent on the channel, so it will be of type <code>*CommonLogFormat</code>.</p>\n\n<p>So no need, and you actually can't receive from it, it is already what you would want to receive from it. Simply append <code>i</code>:</p>\n\n<pre><code>for i := range ch {\n    logs.Messages = append(logs.Messages, i)\n}\n</code></pre>\n\n<p>The <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">Spec: For statements</a> details what the loop variables are in case of <code>for range</code>:</p>\n\n<pre><code>Range expression                          1st value          2nd value\n\narray or slice  a  [n]E, *[n]E, or []E    index    i  int    a[i]       E\nstring          s  string type            index    i  int    see below  rune\nmap             m  map[K]V                key      k  K      m[k]       V\nchannel         c  chan E, &lt;-chan E       element  e  E\n</code></pre>\n\n<p>The last line applies in case of ranging over a channel, and the first iteration value is the element.</p>\n\n<blockquote>\n  <p>For channels, the iteration values produced are the successive values sent on the channel until the channel is <a href=\"https://golang.org/ref/spec#Close\" rel=\"nofollow noreferrer\">closed</a>. If the channel is <code>nil</code>, the range expression blocks forever.</p>\n</blockquote>\n"}], "owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 571, "favorite_count": 0, "accepted_answer_id": 40963287, "answer_count": 1, "score": 3, "last_activity_date": 1480884383, "creation_date": 1480881918, "last_edit_date": 1480884383, "question_id": 40963042, "link": "https://stackoverflow.com/questions/40963042/golang-sorting-on-fan-in", "title": "Golang - Sorting on fan in", "body": "<p>I am randomly generating a bunch of log messages, and after they have been generated, I need to sort them by timestamp before writing them to the logs. I'm utilising the <code>sort.Interface</code> aspect of the <code>sort</code> library so I can sort based on my timestamp. I'm using a fan-in concurrency design, so my sorting function aggregates all the log messages from the goroutines, then sorts them.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>type CommonLogFormat struct {\n    HostIP         string\n    UserIdent      string\n    User           string\n    Timestamp      string\n    Request        string\n    HttpStatusCode int\n    Size           int\n}\n\ntype Logs struct {\n    Messages []*CommonLogFormat\n}\n\nfunc sortByTimestamp(ch chan &lt;- *CommonLogFormat) *Logs {\n    logs := &amp;Logs{Messages: make([]*CommonLogFormat, 1)}\n\n    for i := range ch {\n        logs.Messages = append(logs.Messages, &lt;- i)\n    }\n\n    sort.Sort(logs)\n\n    return logs\n}\n\nfunc (l Logs) Len() int {\n    return len(l.Messages)\n}\n\nfunc (l Logs) Less(i,j int) bool {\n    return l.Messages[i].Timestamp &lt; l.Messages[j].Timestamp\n}\n\nfunc (l *Logs) Swap(i,j int) {\n    l.Messages[i], l.Messages[j] = l.Messages[j], l.Messages[i]\n}\n</code></pre>\n\n<p>However, when I go to receive a log message from the channel, I get this error:</p>\n\n<pre><code>invalid operation: &lt;-i (receive from non-chan type *CommonLogFormat)\n</code></pre>\n\n<p>Why can't I receive a value from the channel?</p>\n"}, {"tags": ["sql", "go", "filter"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1480882089, "post_id": 40960350, "comment_id": 69135493, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/39866503/go-get-all-fields-from-an-interface/39866671#39866671\">Go: Get all fields from an interface</a>."}], "answers": [{"comments": [{"owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "edited": false, "score": 0, "creation_date": 1480897839, "post_id": 40961913, "comment_id": 69140384, "body": "Why do you need <code>valField.Elem().Interface()</code> instead of <code>valField.Elem()</code>?"}, {"owner": {"reputation": 1837, "user_id": 381849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d44bcf5700e4fcb934221db2dab496?s=128&d=identicon&r=PG", "display_name": "KAdot", "link": "https://stackoverflow.com/users/381849/kadot"}, "reply_to_user": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "edited": false, "score": 0, "creation_date": 1480899416, "post_id": 40961913, "comment_id": 69140757, "body": "@nos I didn&#39;t realize <code>fmt.Sprintf</code> is able to handle <code>reflect.Value</code> type, you are right."}], "tags": [], "owner": {"reputation": 1837, "user_id": 381849, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82d44bcf5700e4fcb934221db2dab496?s=128&d=identicon&r=PG", "display_name": "KAdot", "link": "https://stackoverflow.com/users/381849/kadot"}, "is_accepted": true, "score": 2, "last_activity_date": 1480899950, "last_edit_date": 1480899950, "creation_date": 1480875211, "answer_id": 40961913, "question_id": 40960350, "link": "https://stackoverflow.com/questions/40960350/how-to-loop-over-fields-of-a-struct-for-query-filtering/40961913#40961913", "title": "how to loop over fields of a struct for query filtering", "body": "<p>You can use <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflect</a> package to enumerate your structure fields and values:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype item struct {\n    ItemID  *string `json:\"item_id\"`\n    OwnerID *string `json:\"owner_id\"`\n    Status  *string `json:\"status\"`\n}\n\nfunc FindItemsQuery(filter item) string {\n    query := `select * from item_table`\n    condition := \"\"\n    val := reflect.ValueOf(filter)\n    for i := 0; i &lt; val.NumField(); i++ {\n        valField := val.Field(i)\n        if !valField.IsNil() {\n            if condition != \"\" {\n                condition += \" and \"\n            } else {\n                condition += \" where \"\n            }\n            condition += fmt.Sprintf(\"%s=%v\", val.Type().Field(i).Tag.Get(\"json\"), valField.Elem())\n        }\n    }\n    return query + condition\n}\n\nfunc main() {\n    itemID := \"123\"\n    item := item{ItemID: &amp;itemID}\n    fmt.Println(FindItemsQuery(item)) // select * from item_table where item_id=123\n}\n</code></pre>\n\n<p>Keep in mind that using additional json tags like <code>json:\"item_id,omitempty\"</code> will break your query. You should consider using custom structure tags to define the names of SQL fields.</p>\n"}], "owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 40961913, "answer_count": 1, "score": 1, "last_activity_date": 1480899950, "creation_date": 1480866154, "last_edit_date": 1480882814, "question_id": 40960350, "link": "https://stackoverflow.com/questions/40960350/how-to-loop-over-fields-of-a-struct-for-query-filtering", "title": "how to loop over fields of a struct for query filtering", "body": "<p>I have a database where each row corresponds to a struct with the following fields</p>\n\n<pre><code>type item struct {\n    ItemId *string `json:\"item_id\"`\n    OwnerId *string `json:\"owner_id\"`\n    Status *string `json:\"status\"`\n    ... // many more\n}\n</code></pre>\n\n<p>Inside the database, all fields are filled for all rows. Now I would like to have a function that takes an <code>item</code> object whose fields may not be filled as input and return a SQL query string. For example</p>\n\n<pre><code>func FindItems(filter item) string\n</code></pre>\n\n<p>The input <code>item</code> serves as a filter. The logic is as follows (in kind of python style)</p>\n\n<pre><code>query = `select * from item_table`\ncondition = \"\"\nfor field, value in filter:\n    if value != nil:\n        condition = \" and \" if condition else \" where \"\n        condition += \" field=value\"\nquery += condition\n</code></pre>\n\n<p>How can I do this in go? Or is there a better way to do filter in go?</p>\n"}, {"tags": ["sockets", "go", "flooding"], "comments": [{"owner": {"reputation": 40613, "user_id": 4099593, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zweIW.png?s=128&g=1", "display_name": "Bhargav Rao", "link": "https://stackoverflow.com/users/4099593/bhargav-rao"}, "edited": false, "score": 0, "creation_date": 1480948406, "post_id": 40959277, "comment_id": 69162485, "body": "Comments are not for extended discussion; this conversation has been <a href=\"http://chat.stackoverflow.com/rooms/129810/discussion-on-question-by-s-denis-golang-http-server-app-have-many-socket-clos\">moved to chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 161, "user_id": 6594442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64e01d39d02d2a77e471dbaf210de114?s=128&d=identicon&r=PG&f=1", "display_name": "S. Denis", "link": "https://stackoverflow.com/users/6594442/s-denis"}, "edited": false, "score": 0, "creation_date": 1480902763, "post_id": 40964056, "comment_id": 69141576, "body": "I do not agree that the problem in the code. I close all that I open. I am sure."}, {"owner": {"reputation": 161, "user_id": 6594442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64e01d39d02d2a77e471dbaf210de114?s=128&d=identicon&r=PG&f=1", "display_name": "S. Denis", "link": "https://stackoverflow.com/users/6594442/s-denis"}, "edited": false, "score": 0, "creation_date": 1480902935, "post_id": 40964056, "comment_id": 69141623, "body": "I cannot close connection into http.Handler, app makes it for me. For everything else, I&#39;m sure."}, {"owner": {"reputation": 161, "user_id": 6594442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64e01d39d02d2a77e471dbaf210de114?s=128&d=identicon&r=PG&f=1", "display_name": "S. Denis", "link": "https://stackoverflow.com/users/6594442/s-denis"}, "edited": false, "score": 0, "creation_date": 1480903803, "post_id": 40964056, "comment_id": 69141848, "body": "I will try to emulate the problem.Thanks"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "reply_to_user": {"reputation": 161, "user_id": 6594442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64e01d39d02d2a77e471dbaf210de114?s=128&d=identicon&r=PG&f=1", "display_name": "S. Denis", "link": "https://stackoverflow.com/users/6594442/s-denis"}, "edited": false, "score": 0, "creation_date": 1480915053, "post_id": 40964056, "comment_id": 69144487, "body": "There is no other possibilty, whether you agree or not. That is the meaning of the state. The peer has closed: this end has not."}, {"owner": {"reputation": 161, "user_id": 6594442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64e01d39d02d2a77e471dbaf210de114?s=128&d=identicon&r=PG&f=1", "display_name": "S. Denis", "link": "https://stackoverflow.com/users/6594442/s-denis"}, "edited": false, "score": 0, "creation_date": 1480915984, "post_id": 40964056, "comment_id": 69144733, "body": "After code refactoring  (remove mutex), I do not see problem."}], "tags": [], "owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "is_accepted": true, "score": 3, "last_activity_date": 1480887955, "creation_date": 1480887955, "answer_id": 40964056, "question_id": 40959277, "link": "https://stackoverflow.com/questions/40959277/golang-http-server-app-have-many-socket-close-wait/40964056#40964056", "title": "Golang http server app have many Socket (CLOSE_WAIT)", "body": "<p>CLOSE-WAIT means that TCP is waiting for the local application to close the socket, having already received a close from the peer.</p>\n\n<blockquote>\n  <p>Maybe it is some kind of flooding(Example: Sync-flood)?</p>\n</blockquote>\n\n<p>No. It is a bug in your code. You aren't closing a socket somewhere.</p>\n\n<blockquote>\n  <p>The problem seems to be not in the code.</p>\n</blockquote>\n\n<p>The problem is in your code.</p>\n\n<blockquote>\n  <p>Code tested several times.</p>\n</blockquote>\n\n<p>But not for this condition, or under the conditions that produce this problem.</p>\n\n<blockquote>\n  <p>But yesterday I did not have this problem.</p>\n</blockquote>\n\n<p>So yesterday those condtiions did not occur.</p>\n\n<blockquote>\n  <p>(Code was not changed.)</p>\n</blockquote>\n\n<p>So the bug has always been there.</p>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 6594442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64e01d39d02d2a77e471dbaf210de114?s=128&d=identicon&r=PG&f=1", "display_name": "S. Denis", "link": "https://stackoverflow.com/users/6594442/s-denis"}, "is_accepted": false, "score": 0, "last_activity_date": 1480918056, "last_edit_date": 1480918056, "creation_date": 1480917323, "answer_id": 40967919, "question_id": 40959277, "link": "https://stackoverflow.com/questions/40959277/golang-http-server-app-have-many-socket-close-wait/40967919#40967919", "title": "Golang http server app have many Socket (CLOSE_WAIT)", "body": "<h2>Emulation of situation:</h2>\n\n<p>When client timeout works. Socket on server will not closed 15 sec.\nIn my case, when app have many request, I have > 10k socket in CLOSE_WAIT STATE.</p>\n\n<p>Emulation of mutex:</p>\n\n<pre><code>time.Sleep(30 * time.Second)\n</code></pre>\n\n<p>Server:</p>\n\n<pre><code>package main\n\nimport \"net/http\"\nimport \"time\";\n\nfunc main() {\n\n   http.ListenAndServe(\":81\", http.HandlerFunc(func (w http.ResponseWriter, r *http.Request) {\n        println(\"Sleep\")\n        time.Sleep(30 * time.Second)\n        println(\"After sleep\");\n   }));\n\n}\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>import java.io.IOException;\nimport java.net.HttpURLConnection;\nimport java.net.URL;\n\npublic class Main {\n\n    public static void main(String[] args) throws IOException, InterruptedException {\n        HttpURLConnection connection = (HttpURLConnection) new URL(\"http://link\").openConnection();\n        connection.setRequestMethod(\"GET\");\n        connection.setDoOutput(false);\n        connection.setDoInput(true);\n        connection.setReadTimeout(15000);\n        connection.getInputStream().read();\n        System.out.println(\"Close\");\n        connection.disconnect();\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 161, "user_id": 6594442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64e01d39d02d2a77e471dbaf210de114?s=128&d=identicon&r=PG&f=1", "display_name": "S. Denis", "link": "https://stackoverflow.com/users/6594442/s-denis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2251, "favorite_count": 0, "accepted_answer_id": 40964056, "answer_count": 2, "score": -2, "last_activity_date": 1480918056, "creation_date": 1480859247, "last_edit_date": 1480865050, "question_id": 40959277, "link": "https://stackoverflow.com/questions/40959277/golang-http-server-app-have-many-socket-close-wait", "title": "Golang http server app have many Socket (CLOSE_WAIT)", "body": "<p>App can works few days. But in some moment, app has many socket with CLOSE_WAIT state, and cannot receive new client.</p>\n\n<p>Maybe it is some kind of flooding(Example: Sync-flood)?</p>\n\n<h3>netstat -ant | grep CLOSE_WAIT | wc</h3>\n\n<h3>3258   19548  260640</h3>\n\n<p>3258 - socket in CLOSE_WAIT state</p>\n\n<p>Update:</p>\n\n<p>Code some handler:</p>\n\n<pre><code> func GetScore(mongo *mgo.Session, redisConn redis.Conn, renderer handlers.Render) http.Handler {\n\n         mutex := sync.Mutex{}\n\n         return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\n           id := bson.ObjectIdHex(r.FormValue(\"id\"))\n           banner := models.Banner{}\n           err := mongo.DB(\"db\").C(\"collection\").FindId(id).One(&amp;banner)\n           if err != nil {\n             log.Panicf(\"Banner selecting error: %s\", err);\n           }\n           mutex.Lock();\n           sports, _ := util.GetSports(redisConn)\n           mutex.Unlock();\n           sport, _ := sports.FindSport(banner.SportId)\n           comp, err := sport.FindCompetition(banner.CompetitionId)\n           if err != nil {\n               comp, _ = sport.FindCompetition(0);\n               log.Println(\"Competition not found\");\n           }\n           game, err := comp.FindGame(banner.GameId)\n\n           if err != nil {\n           game, _ = comp.FindGame(0)\n           }\n           mutex.Lock();\n           scores := util.GetScore(redisConn, game.ID)\n           mutex.Unlock();\n           game.Score1 = scores[0]\n           game.Score2 = scores[1]\n           w.Header().Set(\"Content-Type\", \"application/json;application/json;charset=utf-8\")\n           renderer.RenderJson(w, 200, &amp;game)\n       }\n\n\n\n       func GetScore(redisConn redis.Conn, gameId int) ([]float32) {\n\n         redisKey :=  fmt.Sprintf(\"game-%d\", gameId);\n         bBody, err := redis.Bytes(redisConn.Do(\"GET\", redisKey))\n\n         if err != nil || len(bBody) == 0 {\n           response, err := http.DefaultClient.Get(fmt.Sprintf(\"%s%d\", GameApi, gameId))\n\n           if err != nil {\n             log.Panicf(\"GetScore error: %s\", err)\n           }\n\n           bBody, _ = ioutil.ReadAll(response.Body);\n           redisConn.Send(\"SET\", redisKey, bBody)\n           redisConn.Send(\"EXPIRE\", redisKey, 60 * 5)\n           redisConn.Flush()\n         }\n         events := GameJson{};\n         err = json.Unmarshal(bBody, &amp;events)\n         if err != nil {\n           log.Panicf(\"GetScore json error: %s\", err)\n         }\n\n         var event []struct {\n           Name string `json:\"name\"`\n           Price float32 `json:\"price\"`\n}\n         if len(events.AllEvents.P1XP2) != 0 {\n           event = events.AllEvents.P1XP2[0].Events\n         } else {\n           event = events.AllEvents.Other[0].Events\n         }\n\n         return []float32{event[0].Price, event[1].Price}\n       }\n</code></pre>\n"}, {"tags": ["git", "go", "docker", "dependencies"], "comments": [{"owner": {"reputation": 246, "user_id": 3841898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17de7e68c52da24299105501c000c85c?s=128&d=identicon&r=PG&f=1", "display_name": "ahankendi", "link": "https://stackoverflow.com/users/3841898/ahankendi"}, "edited": false, "score": 0, "creation_date": 1480857316, "post_id": 40959005, "comment_id": 69127255, "body": "<a href=\"https://blog.golang.org/docker\" rel=\"nofollow noreferrer\">blog.golang.org/docker</a>  here is good article for packing the docker container.  you can define all of your required sub package and entry point of your application in DockerFile"}, {"owner": {"reputation": 63, "user_id": 1503624, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95ba445cd5871590b115edff86325006?s=128&d=identicon&r=PG", "display_name": "kubaj", "link": "https://stackoverflow.com/users/1503624/kubaj"}, "reply_to_user": {"reputation": 246, "user_id": 3841898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17de7e68c52da24299105501c000c85c?s=128&d=identicon&r=PG&f=1", "display_name": "ahankendi", "link": "https://stackoverflow.com/users/3841898/ahankendi"}, "edited": false, "score": 0, "creation_date": 1480862997, "post_id": 40959005, "comment_id": 69128922, "body": "This doesn&#39;t work due to private repositories that need to be cloned manually into GOPATH or using glide that supports ssh. Also I need dependencies version locked."}], "answers": [{"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": false, "score": 1, "last_activity_date": 1480885375, "last_edit_date": 1495540904, "creation_date": 1480885375, "answer_id": 40963628, "question_id": 40959005, "link": "https://stackoverflow.com/questions/40959005/resolving-go-dependencies-in-docker-container/40963628#40963628", "title": "Resolving Go dependencies in Docker container", "body": "<p>This isnt a Go question.  It's a Docker and Security question.</p>\n\n<p>First off, it isnt ideal to build Go apps as part of the build.  Typically you would build the binary locallly on ur machine targeting the Dockerfile <code>FROM</code> you have set.  There is zero reason not to, as there is a Go complier for every machine, and you can GOOS and GOARCH target any machine.</p>\n\n<p>But for your usecase, using a private repo, it is even more critical not to build within your container because regardless of how you get the code into your container to build, you'll have a container with private files or worse your ssh key.  A container that you have to upload and host and run somewhere.</p>\n\n<p>That is not ideal, however you look at it.</p>\n\n<p>However, if you are determined to leak your code and/or key, you only have two options:</p>\n\n<ul>\n<li><p><code>git clone</code> the private repo on your local/build machine yhat is authorized to access the private repo and use <code>COPY</code> within ur Dockerfile to copy it.</p></li>\n<li><p>Use Dockerfile <code>COPY</code> to copy your local machine's SSH key that you have authorized for your remote repo, into the container so that you can RUN git commands (which you'll also need git and ssh installed).</p></li>\n</ul>\n\n<p>Again, those are not ideal.  Build the Go app locally, target the container's type, and copy the binary over.  It really couldnt be easier.</p>\n\n<p>As for dependency management, i've never used glide; but, i wrote a popular answer about versioning dependencies with <code>/vendor</code>.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/37237036/how-should-i-use-vendor-in-go-1-6/37238226#37238226\">How should I use vendor in Go 1.6?</a></p>\n"}, {"tags": [], "owner": {"reputation": 9, "user_id": 6093091, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bCXEL.jpg?s=128&g=1", "display_name": "Marc Guasch", "link": "https://stackoverflow.com/users/6093091/marc-guasch"}, "is_accepted": false, "score": -1, "last_activity_date": 1481047054, "creation_date": 1481047054, "answer_id": 41001845, "question_id": 40959005, "link": "https://stackoverflow.com/questions/40959005/resolving-go-dependencies-in-docker-container/41001845#41001845", "title": "Resolving Go dependencies in Docker container", "body": "<p>If you only care about being able to <code>go get</code> your private repos from the docker container and do not mind to copy your id_rsa when building it, you can just add this to the beginning of your Dockerfile:</p>\n\n<pre><code>RUN echo \"[url \\\"git@github.com:\\\"]\\n\\tinsteadOf = https://github.com/\" &gt;&gt; /root/.gitconfig\nRUN mkdir /root/.ssh &amp;&amp; echo \"StrictHostKeyChecking no \" &gt; /root/.ssh/config\nCOPY id_rsa /root/.ssh/id_rsa\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 1503624, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/95ba445cd5871590b115edff86325006?s=128&d=identicon&r=PG", "display_name": "kubaj", "link": "https://stackoverflow.com/users/1503624/kubaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1051, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1481047054, "creation_date": 1480857042, "question_id": 40959005, "link": "https://stackoverflow.com/questions/40959005/resolving-go-dependencies-in-docker-container", "title": "Resolving Go dependencies in Docker container", "body": "<p>I want to build my Go application during the Docker image build and set image entrypoint to built Go application. Problem is that my Go application is subpackage of the main package and uses some other submodules from the main package. This main package is on Github as private repository so I cannot just <code>go get</code> inside the container.</p>\n\n<p>I've tried to setup Glide dependency manager and get all dependencies outside of the container into the <code>vendor/</code> directory but there is another problem - glide.lock would have to be updated after each commit in main private repository. This is not solution for me because I want to have other dependencies locked.</p>\n\n<p>Is there any way to build application with latest version of main package dependency and locked versions of other dependencies?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 0, "last_activity_date": 1480860662, "creation_date": 1480860662, "answer_id": 40959466, "question_id": 40958903, "link": "https://stackoverflow.com/questions/40958903/golang-os-exec-get-data-from-stdout-in-parts/40959466#40959466", "title": "golang os/exec: get data from stdout in parts", "body": "<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"sh\", \"-c\", \"echo 1;sleep 10;echo 2;\")\n\n    outPipe, _ := cmd.StdoutPipe()\n    scanner := bufio.NewScanner(outPipe)\n\n    go func() {\n        for scanner.Scan() {\n            log.Println(scanner.Text())\n        }\n    }()\n\n    cmd.Start()\n    cmd.Wait()\n\n    log.Println(\"Done\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2016/12/04 17:11:09 1\n2016/12/04 17:11:19 2\n2016/12/04 17:11:19 Done\n</code></pre>\n\n<p>Use channels to send data from the function instead of return.</p>\n"}], "owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 0, "accepted_answer_id": 40959466, "answer_count": 1, "score": 0, "last_activity_date": 1480860662, "creation_date": 1480856421, "question_id": 40958903, "link": "https://stackoverflow.com/questions/40958903/golang-os-exec-get-data-from-stdout-in-parts", "title": "golang os/exec: get data from stdout in parts", "body": "<p>I want to run an external application from my go code using <code>os/exec</code>. The application <code>my_external_script.sh</code> outputs data to <code>stdout</code> in two parts: the first part is quite fast (it writes \"A\" to stdout after three seconds) and the second part (\"B) is being written only after 10 seconds.</p>\n\n<p>For example:</p>\n\n<pre><code>./my_external_script.sh\n.....\n.....\nA (3 seconds elapsed)\n.....\n.....\n.....\n.....\n.....\n.....\nB (10 seconds elapsed)\n(program exits with 0 status code)\n</code></pre>\n\n<p>I'm currently executing this like so from my go code:</p>\n\n<pre><code>func execMyExternalCmd() (*string, error) {\n    cmd := exec.Command(\"my_external_script.sh\")\n    var out bytes.Buffer\n    cmd.Stdout = &amp;out\n    err := cmd.Run()\n    if err != nil {\n        return nil, err\n    }\n    var res = out.String()\n    return &amp;res, nil\n}\n</code></pre>\n\n<p>The problem is, <code>execMyExternalCmd</code> will only return after 10 seconds, where both \"A\" and \"B\" have been written and the program exited. I would like to use \"A\" as soon as it's available on the <code>stdout</code> (but also use \"B\" later on when it's available). How can I achieve this? </p>\n"}, {"tags": ["ubuntu", "go", "gogs"], "comments": [{"owner": {"reputation": 2577, "user_id": 4361832, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/D1tGu.jpg?s=128&g=1", "display_name": "mode777", "link": "https://stackoverflow.com/users/4361832/mode777"}, "edited": false, "score": 0, "creation_date": 1480853648, "post_id": 40957087, "comment_id": 69126215, "body": "If you downvote, please let me know in the comments so I can avoid this behaviour."}], "answers": [{"tags": [], "owner": {"reputation": 2577, "user_id": 4361832, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/D1tGu.jpg?s=128&g=1", "display_name": "mode777", "link": "https://stackoverflow.com/users/4361832/mode777"}, "is_accepted": false, "score": 1, "last_activity_date": 1480842677, "creation_date": 1480842677, "answer_id": 40957088, "question_id": 40957087, "link": "https://stackoverflow.com/questions/40957087/gogs-build-fails-with-no-buildable-go-source-files/40957088#40957088", "title": "Gogs build fails with &quot;no buildable Go source files&quot;", "body": "<p>I'll go ahead and answer my own question since I figured it out:</p>\n\n<p>cd to gogs directory</p>\n\n<pre><code>nano gogs.go\n</code></pre>\n\n<p>Look at the first line for me it was</p>\n\n<pre><code>// +build go1.5\n</code></pre>\n\n<p>This means you will at least need go 1.5 to build. Now look at your go version:</p>\n\n<pre><code>go --version\n</code></pre>\n\n<p>If this number is smaller, this is the reason your build won't even start.\nIn my case ubuntu was using an older version located at </p>\n\n<pre><code>whereis go\n</code></pre>\n\n<p>I deleted the old binary folder (probably something you shouldn't do) and reinstalled go from scratch, which gave me the corret version and the build worked fine.</p>\n"}], "owner": {"reputation": 2577, "user_id": 4361832, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/D1tGu.jpg?s=128&g=1", "display_name": "mode777", "link": "https://stackoverflow.com/users/4361832/mode777"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 545, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1480842677, "creation_date": 1480842677, "question_id": 40957087, "link": "https://stackoverflow.com/questions/40957087/gogs-build-fails-with-no-buildable-go-source-files", "title": "Gogs build fails with &quot;no buildable Go source files&quot;", "body": "<p>I was trying to install gogs from source following <a href=\"https://gogs.io/docs/installation/install_from_source\" rel=\"nofollow noreferrer\">this guide</a>.</p>\n\n<p>However once I navigated to the gogs directory and hit \"go build\" i got the following error \"no buildable Go source files in [PATH-TO-GOGS]\"</p>\n\n<p>However all required files seem to be there.</p>\n"}, {"tags": ["go", "amazon-s3"], "comments": [{"owner": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "edited": false, "score": 0, "creation_date": 1480856115, "post_id": 40956103, "comment_id": 69126892, "body": "Update. Did some experiments. Now I need to convert multipart.File to os.File"}, {"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 1, "creation_date": 1480896434, "post_id": 40956103, "comment_id": 69140048, "body": "Do you want an <code>*os.File</code> or really an <code>io.Reader</code>? The file is only for a file that is physically on disk, but you&#39;re also saying that you don&#39;t want the file to be on disk?"}, {"owner": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "reply_to_user": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1480933466, "post_id": 40956103, "comment_id": 69152936, "body": "Yes, I want io.Reader exactly"}], "answers": [{"comments": [{"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1480850249, "post_id": 40957984, "comment_id": 69125259, "body": "To add a little more <code>ParseMultipartForm</code> will let you control when to have the file in memory, and when they are written to temp. From the docs: a total of maxMemory bytes of its file parts are stored in memory, with the remainder stored on disk in temporary files."}, {"owner": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "edited": false, "score": 1, "creation_date": 1480853866, "post_id": 40957984, "comment_id": 69126277, "body": "how can avoid writing to disk(temp) and again taking from it?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "edited": false, "score": 0, "creation_date": 1480871716, "post_id": 40957984, "comment_id": 69131761, "body": "@RaviTejaBathula if you really need an *os.File, you need to write a file somewhere. However, there should be no reason to really require an *os.File."}, {"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "reply_to_user": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "edited": false, "score": 0, "creation_date": 1480896935, "post_id": 40957984, "comment_id": 69140167, "body": "@RaviTejaBathula if you want to prevent the files from hitting disk at all, you have two options. (1) set <code>maxMemory</code> to a sufficiently large value that it can hold the files in memory (you can use other parts of the <code>http</code> package to limit the size of the incoming request). (2) use <code>*http.Request.MultiPartReader</code> to access the part&#39;s directly."}, {"owner": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "edited": false, "score": 0, "creation_date": 1480933615, "post_id": 40957984, "comment_id": 69153032, "body": "@djd I succeeded. I turned incoming file data to bytes and passed to bytes.NewReader() which gave me io.Reader. Thank you for your time. I will optimize code with your idea now."}, {"owner": {"reputation": 1119, "user_id": 4932661, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qbwhz.jpg?s=128&g=1", "display_name": "Asad", "link": "https://stackoverflow.com/users/4932661/asad"}, "reply_to_user": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "edited": false, "score": 0, "creation_date": 1550746053, "post_id": 40957984, "comment_id": 96386720, "body": "@RTBathula I have the same problem. Can you please provide the exact code to turn file into bytes and then passed to bytes.NewReader()?"}], "tags": [], "owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "is_accepted": true, "score": 4, "last_activity_date": 1480849977, "creation_date": 1480849977, "answer_id": 40957984, "question_id": 40956103, "link": "https://stackoverflow.com/questions/40956103/how-to-convert-multipart-fileheader-file-type-to-os-file-in-golang/40957984#40957984", "title": "How to convert *multipart.FileHeader file type to *os.File in golang", "body": "<p>Call <a href=\"https://golang.org/pkg/mime/multipart/#FileHeader.Open\" rel=\"nofollow noreferrer\">Open</a> on the <code>multipart.FileHeader</code>. It will return a <code>multipart.File</code> which will provide a reader to the file (which will be held in memory).</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12277254, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mD7e__BeHMeymAY5BuPdAn0wQjiAWMZEXMaHSTtJA=k-s128", "display_name": "Bondril13", "link": "https://stackoverflow.com/users/12277254/bondril13"}, "is_accepted": false, "score": 0, "last_activity_date": 1588422007, "creation_date": 1588422007, "answer_id": 61559258, "question_id": 40956103, "link": "https://stackoverflow.com/questions/40956103/how-to-convert-multipart-fileheader-file-type-to-os-file-in-golang/61559258#61559258", "title": "How to convert *multipart.FileHeader file type to *os.File in golang", "body": "<p>you can use os.Open() to convert <strong><em>multipart.FileHeader</em></strong> to <strong>*(<em>os.File)</em></strong></p>\n\n<p>example</p>\n\n<pre><code>_, header , _ := c.Request.FormFile(\"upload\")\nout, _ := os.Open(header.Filename)\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7054, "favorite_count": 0, "accepted_answer_id": 40957984, "answer_count": 2, "score": 2, "last_activity_date": 1588422007, "creation_date": 1480833112, "question_id": 40956103, "link": "https://stackoverflow.com/questions/40956103/how-to-convert-multipart-fileheader-file-type-to-os-file-in-golang", "title": "How to convert *multipart.FileHeader file type to *os.File in golang", "body": "<p>I want to stream multipart file directly to AWSS3 instead of saving file to disk at first. Receiving file of type *multipart.FileHeader in my golang REST API. Now I want to stream this to AWSS3, using <a href=\"https://godoc.org/github.com/aws/aws-sdk-go/service/s3/s3manager\" rel=\"nofollow noreferrer\">s3manager</a> upload method where it's required to pass *bytes.Reader in body param. I have seen an example of <a href=\"https://www.nicolasmerouze.com/file-upload-web-service-golang-s3-aws/\" rel=\"nofollow noreferrer\">uploading file to AWSS3</a>, written in a way that opening a file <strong>os.Open(\"filepath\")</strong> of type *os.File from disk,getting *bytes.Reader out of it and passing to AWSS3. Now I am struggling to convert this *multipart.FileHeader to *os.File.</p>\n"}, {"tags": ["go", "intellij-idea", "build", "command", "intellij-14"], "answers": [{"tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": false, "score": 0, "last_activity_date": 1480886990, "creation_date": 1480886990, "answer_id": 40963893, "question_id": 40954896, "link": "https://stackoverflow.com/questions/40954896/http-servefile-can-not-get-the-static-sources-but-command-run-can-get/40963893#40963893", "title": "http.ServeFile can not get the static sources, but command run can get", "body": "<p>The path <code>\"./static/html/login.html\"</code> is a relative path. When you utilize <code>go run ...</code> you are probably currently in a directory that this relative path resolves to correctly. The IntelliJ binary may be executed in a different directory than your go source resulting this relative path being incorrect. </p>\n\n<p>You can either use an absolute path in your call to <code>ServeFile(...)</code>, configure your IDE to execute your go commands in the source directory as the working directory, or allow your application to be configured to use any given path as the root of your static content. The first two options will temporarily solve your problem. When you have to ship your binary it will be susceptible to the same problem you're experiencing now. The third option will allow your application to handle any environment because the path can be explicitly defined by the user.</p>\n"}], "owner": {"reputation": 31, "user_id": 6820927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/001b78b0ef8fe92a4ce084ef489a84bf?s=128&d=identicon&r=PG&f=1", "display_name": "Anteoy", "link": "https://stackoverflow.com/users/6820927/anteoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505299400, "creation_date": 1480820383, "last_edit_date": 1505299400, "question_id": 40954896, "link": "https://stackoverflow.com/questions/40954896/http-servefile-can-not-get-the-static-sources-but-command-run-can-get", "title": "http.ServeFile can not get the static sources, but command run can get", "body": "<p>I use the Intelj IDEA to develop golang, but when I use the debug to build my project, when debug to this line <code>http.ServeFile(w, r, \"./static/html/login.html\")</code>, I get <code>404 not found</code>, but in command run, I can get this static page.</p>\n"}, {"tags": ["go", "deferred-execution"], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 6, "last_activity_date": 1480812357, "last_edit_date": 1480812357, "creation_date": 1480809186, "answer_id": 40953867, "question_id": 40953241, "link": "https://stackoverflow.com/questions/40953241/go-is-it-possible-to-put-defer-in-sub-func/40953867#40953867", "title": "Go, is it possible to put defer in sub func", "body": "<p>I think I understand what you're asking. You want to know if a function can place a function on the defer stack of the caller. The answer to that is no. One possible solution to this is to have the function that wants to defer something return that function to the caller and have the caller do the <code>defer</code>. For example:</p>\n\n<pre><code>func test2() {\n    r, cleanup := subc()\n    defer cleanup()\n    r.Use()\n}\n\nfunc subc() (*Resource, func()) {\n    r, err := Open(\"a\")\n    if err != nil {\n        log.Fatalf(\"error opening 'a'\\n\")\n    }\n    return r, func() { r.Close() }\n}\n</code></pre>\n"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "accepted_answer_id": 40953867, "answer_count": 1, "score": 1, "last_activity_date": 1480812357, "creation_date": 1480804484, "last_edit_date": 1480804826, "question_id": 40953241, "link": "https://stackoverflow.com/questions/40953241/go-is-it-possible-to-put-defer-in-sub-func", "title": "Go, is it possible to put defer in sub func", "body": "<p>Is it possible to put <code>defer</code> in sub function?</p>\n\n<p>I.e., for line 12~16 of func <code>test1()</code> in\n<a href=\"https://play.golang.org/p/evabhcjvNs\" rel=\"nofollow noreferrer\">https://play.golang.org/p/evabhcjvNs</a> (enclosed below)</p>\n\n<p>Is there any possibility to put them in sub function?\nLike what I tried in <code>test2()</code> (but that behavior is different than <code>test1()</code>).</p>\n\n<p>The reason I'm asking is that, for line 12~16 of func <code>test1()</code>, my actual code is to restore the variable from persistent data, then use <code>defer</code> to save it when <code>test1()</code> is done. However, there are cases that the whole restore/save is not necessary, so I'm thinking a better way to control it. </p>\n\n<p>thanks</p>\n\n<pre><code>package main\n\nimport \"log\"\n\nfunc main() {\n    test1()\n    log.Printf(\"==== \\n\")\n    test2()\n}\n\nfunc test1() {\n    r, err := Open(\"a\")\n    if err != nil {\n        log.Fatalf(\"error opening 'a'\\n\")\n    }\n    defer r.Close()\n\n    r.Use()\n}\n\nfunc test2() {\n    r := subc()\n    r.Use()\n}\n\nfunc subc() *Resource {\n    r, err := Open(\"a\")\n    if err != nil {\n        log.Fatalf(\"error opening 'a'\\n\")\n    }\n    defer r.Close()\n    return r\n}\n\ntype Resource struct {\n    name string\n}\n\nfunc Open(name string) (*Resource, error) {\n    log.Printf(\"opening %s\\n\", name)\n    return &amp;Resource{name}, nil\n}\n\nfunc (r *Resource) Use() error {\n    log.Printf(\"using %s\\n\", r.name)\n    return nil\n}\n\nfunc (r *Resource) Close() error {\n    log.Printf(\"closing %s\\n\", r.name)\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 52, "user_id": 1156097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ed5c6378374316dfbc02c9d94829b8b?s=128&d=identicon&r=PG", "display_name": "Stephen", "link": "https://stackoverflow.com/users/1156097/stephen"}, "edited": false, "score": 0, "creation_date": 1480803495, "post_id": 40953064, "comment_id": 69115922, "body": "can&#39;t believe I missed that - thank you!  I should clearly stop coding and go to sleep."}], "tags": [], "owner": {"reputation": 2154, "user_id": 2312075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g2VYN.jpg?s=128&g=1", "display_name": "saarrrr", "link": "https://stackoverflow.com/users/2312075/saarrrr"}, "is_accepted": true, "score": 4, "last_activity_date": 1480803276, "creation_date": 1480803276, "answer_id": 40953064, "question_id": 40953040, "link": "https://stackoverflow.com/questions/40953040/why-does-the-setage-method-not-set-the-age-correctly/40953064#40953064", "title": "Why does the SetAge() method not set the age correctly?", "body": "<p>Your function receiver's are value types, so they are copied into your function scope.  To affect your received type past the lifetime of the function your receiver should be a pointer to your type.  See below.</p>\n\n<pre><code>type NamedThing interface {\n    GetName() string\n    GetAge()  int\n    SetAge(age int)\n}\n\ntype BaseThing struct {\n   name string\n   age  int\n}\n\nfunc (t *BaseThing) GetName() string {\n   return t.name\n}\n\nfunc (t *BaseThing) GetAge() int {\n   return t.age\n}\n\nfunc (t *BaseThing) SetAge(age int) {\n   t.age = age\n}\n\ntype Person struct {\n   BaseThing\n}\n\nfunc main() {\n    p := Person{}\n    p.BaseThing.name = \"fred\"\n    p.BaseThing.age = 21\n    fmt.Println(p)\n    p.SetAge(35)\n    fmt.Println(p)\n}\n</code></pre>\n"}], "owner": {"reputation": 52, "user_id": 1156097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ed5c6378374316dfbc02c9d94829b8b?s=128&d=identicon&r=PG", "display_name": "Stephen", "link": "https://stackoverflow.com/users/1156097/stephen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 40953064, "answer_count": 1, "score": 2, "last_activity_date": 1480803276, "creation_date": 1480803072, "question_id": 40953040, "link": "https://stackoverflow.com/questions/40953040/why-does-the-setage-method-not-set-the-age-correctly", "title": "Why does the SetAge() method not set the age correctly?", "body": "<p>I'm experimenting with GoLang and interfaces and struct inheritence.</p>\n\n<p>I've created a set of structures with the idea that I can keep common methods and values in a core structure an then just inherit this and add extra values as appropriate:</p>\n\n<pre><code>type NamedThing interface {\n    GetName() string\n    GetAge()  int\n    SetAge(age int)\n}\n\ntype BaseThing struct {\n   name string\n   age  int\n}\n\nfunc (t BaseThing) GetName() string {\n   return t.name\n}\n\nfunc (t BaseThing) GetAge() int {\n   return t.age\n}\n\nfunc (t BaseThing) SetAge(age int) {\n   t.age = age\n}\n\ntype Person struct {\n   BaseThing\n}\n\nfunc main() {\n    p := Person{}\n    p.BaseThing.name = \"fred\"\n    p.BaseThing.age = 21\n    fmt.Println(p)\n    p.SetAge(35)\n    fmt.Println(p)\n}\n</code></pre>\n\n<p>Which you can also find here in the go playground:</p>\n\n<p><a href=\"https://play.golang.org/p/OxzuaQkafj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OxzuaQkafj</a></p>\n\n<p>However when I run the main method, the age remains as \"21\" and isn't updated by the SetAge() method.</p>\n\n<p>I'm trying to understand why this is and what I'd need to do to make SetAge work correctly.</p>\n"}, {"tags": ["macos", "go", "sdl", "pkg-config"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480804140, "post_id": 40952744, "comment_id": 69116108, "body": "What is the &quot;Go version&quot; of pkg-config? That&#39;s likely not doing what you expect."}, {"owner": {"reputation": 41, "user_id": 1038432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e5351395b987bbd8c677163dc0fc060?s=128&d=identicon&r=PG", "display_name": "chuckshop", "link": "https://stackoverflow.com/users/1038432/chuckshop"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480813204, "post_id": 40952744, "comment_id": 69118195, "body": "@JimB : Good point, but I did <i>&quot;go get&quot;</i> it from <code>github.com&#47;rjeczalik&#47;pkgconfig</code>, it&#39;s compiled with my current go compiler (1.7.1)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1480814651, "post_id": 40952744, "comment_id": 69118450, "body": "That looks like a very incomplete attempt at a pkg-config replacement in Go. Just use the real &quot;pkg-config&quot;"}, {"owner": {"reputation": 41, "user_id": 1038432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e5351395b987bbd8c677163dc0fc060?s=128&d=identicon&r=PG", "display_name": "chuckshop", "link": "https://stackoverflow.com/users/1038432/chuckshop"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480906343, "post_id": 40952744, "comment_id": 69142443, "body": "@JimB You are so right, I was stupid and thought that the Go implementation was the real one because I was installing a Go module. I now works with pkg-config from <i>brew</i> on osx. Thanks a lot."}], "owner": {"reputation": 41, "user_id": 1038432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e5351395b987bbd8c677163dc0fc060?s=128&d=identicon&r=PG", "display_name": "chuckshop", "link": "https://stackoverflow.com/users/1038432/chuckshop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 407, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1480800993, "creation_date": 1480800993, "question_id": 40952744, "link": "https://stackoverflow.com/questions/40952744/error-building-installing-go-golang-packages-bound-to-sdl2-on-mac-os-x", "title": "Error building / installing Go (golang) packages bound to SDL2 on Mac OS X", "body": "<p>On OSX, when building (<code>go get</code>) any go package that links to SDL2, I always get the same error. (tried on four different Go packages that use SDL2)</p>\n\n<p>For example with the <em>tenema/amore packages</em>:</p>\n\n<pre><code>$ go get -u github.com/tanema/amore/...\n# pkg-config --cflags sdl2\nerror &lt;autogenerated&gt;: no library found in $GOPATH: sdl2\nerror $GOPATH: no library found in $GOPATH: sdl2\nerror github.com: PKG_CONDIF_GITHUB not exported, skipping github.com lookup\nerror $PKG_CONFIG_PATH: open sdl2.pc: no such file or directory\npkg-config: exit status 1\n</code></pre>\n\n<p>SDL2 was installed using <code>brew</code>, which is the suggested way to install it in any of the Go packages I've tried.</p>\n\n<pre><code>brew search sdl2\nsdl2 \u2714                     sdl2_image \u2714               sdl2_net \u2714               \nsdl2_gfx \u2714                 sdl2_mixer \u2714               sdl2_ttf \u2714               \n</code></pre>\n\n<p>The SDL2 libraries are where you expect them to be:</p>\n\n<pre><code>ls /usr/local/Cellar/ | grep sdl\nsdl2\nsdl2_gfx\nsdl2_image\nsdl2_mixer\nsdl2_net\nsdl2_ttf\n</code></pre>\n\n<p>The Go version of <code>pkg-config</code> is installed (and the original also).</p>\n\n<pre><code>$ which pkg-config\n/Users/myself/Go/bin/pkg-config\n</code></pre>\n\n<p>I've Googled for it, but to no avail, searching for <code>\"error $GOPATH: no library found in $GOPATH:\"</code> returns only 1 result, which doesn't seems to apply.</p>\n\n<p>I also have a pretty clean and sane Xcode and Go environment (compilers and all).</p>\n\n<p>I'll continue searching on my side, but if any of you have a clue on how to resolve that error, that would be appreciated.</p>\n"}, {"tags": ["go", "arguments"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1480883003, "post_id": 40950877, "comment_id": 69135807, "body": "Added more details, explanation (based on the spec) and links to the answer."}], "answers": [{"comments": [{"owner": {"reputation": 540, "user_id": 2555446, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b671f9946144fc886dfe8d4aa1893b56?s=128&d=identicon&r=PG", "display_name": "Jun", "link": "https://stackoverflow.com/users/2555446/jun"}, "edited": false, "score": 0, "creation_date": 1568161886, "post_id": 40951013, "comment_id": 102183755, "body": "Is naming the parameter for the interface method recommended? In your example, Write(p []byte) error, what is the p here for? Should we always ignore it?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 540, "user_id": 2555446, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b671f9946144fc886dfe8d4aa1893b56?s=128&d=identicon&r=PG", "display_name": "Jun", "link": "https://stackoverflow.com/users/2555446/jun"}, "edited": false, "score": 0, "creation_date": 1568186884, "post_id": 40951013, "comment_id": 102190711, "body": "@Jun Parameter names in interfaces have no real purpose other that documentation and improving legibility. Someone implementing the interface may use a different name or omit its name, it doesn&#39;t matter. The signatures match even if names are different."}, {"owner": {"reputation": 27359, "user_id": 1516286, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/36f74e0d3318a630af9ce0e356182040?s=128&d=identicon&r=PG", "display_name": "Vor", "link": "https://stackoverflow.com/users/1516286/vor"}, "edited": false, "score": 0, "creation_date": 1612481402, "post_id": 40951013, "comment_id": 116788145, "body": "Hi, I think this guy wanted to ask something <a href=\"https://stackoverflow.com/a/66053939/1516286\">stackoverflow.com/a/66053939/1516286</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 27, "last_activity_date": 1527499137, "last_edit_date": 1527499137, "creation_date": 1480789153, "answer_id": 40951013, "question_id": 40950877, "link": "https://stackoverflow.com/questions/40950877/is-unnamed-arguments-a-thing-in-go/40951013#40951013", "title": "Is unnamed arguments a thing in Go?", "body": "<p>Unnamed parameters are perfectly valid. The <a href=\"https://golang.org/ref/spec#ParameterDecl\" rel=\"noreferrer\">Parameter declaration</a> from the spec:</p>\n\n<pre><code>ParameterDecl  = [ IdentifierList ] [ \"...\" ] Type .\n</code></pre>\n\n<p>As you can see, the <code>IdentifierList</code> (the identifier name or names) is in square brackets, which means it's <em>optional</em>. Only the <code>Type</code> is required.</p>\n\n<p>The reason for this is because the names are not really important for someone calling a method or a function. What matters is the types of the parameters and their order. This is detailed in this answer: <a href=\"https://stackoverflow.com/questions/31377433/getting-method-parameter-names-in-golang/31377793#31377793\">Getting method parameter names in Golang</a></p>\n\n<p>Generally you name variables and parameters so that you can refer to them.</p>\n\n<p>When you don't name something, it's because you don't want to refer to it.</p>\n\n<p>So the question should rather be: <em>Why would I not want to refer to a parameter?</em></p>\n\n<p>For example because the parameter <em>\"is there\"</em> (it is passed), but you don't need it, you don't want to use it. Why would it be there if I don't need it?</p>\n\n<p>Because someone or something <em>dictates</em> for specific parameters to be there. For example you want to implement an interface, or you want to pass a function value whose signature is defined by the function type that is expected.</p>\n\n<p>Let's see an example. We have the following <code>MyWriter</code> interface:</p>\n\n<pre><code>type MyWriter interface {\n    Write(p []byte) error\n}\n</code></pre>\n\n<p>A simplified <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"noreferrer\"><code>io.Writer</code></a> which only returns an error, but does not report the number of bytes written. If you'd want to provide an implementation which just discards the data (similar to <a href=\"https://golang.org/pkg/io/ioutil/#Discard\" rel=\"noreferrer\"><code>ioutil.Discard</code></a>), then the implementation does not use (does not need to use) its argument:</p>\n\n<pre><code>type DiscardWriter struct{}\n\nfunc (DiscardWriter) Write([]byte) error { return nil }\n</code></pre>\n\n<p>And that's all: we don't use the receiver, we don't use the argument. Both can be unnamed. And the implementation does exactly what it should.</p>\n\n<p>Doing so (using unnamed parameters) also <em>documents</em> that the value is not used / referred to.</p>\n\n<p>Another reason can be to provide <em>forward</em> compatibility. If you release a library, you can't change or extend the parameter list without breaking backward compatibility (and in Go there is no function overloading: if you want 2 variants with different parameters, their names must be different too). So you may declare an exported function or method with additional parameters early, but since you don't use them yet, you may leave them unnamed. An example of this is detailed in this answer: <a href=\"https://stackoverflow.com/questions/22549228/why-does-go-allow-compilation-of-unused-function-parameters/33759531#33759531\">Why does Go allow compilation of unused function parameters?</a></p>\n\n<p>One thing to note here is that you can't mix named and unnamed parameters. If you name some, you must name all. If you don't need all, you may use the <a href=\"https://golang.org/ref/spec#Blank_identifier\" rel=\"noreferrer\">blank identifier</a> like in this example:</p>\n\n<p>A simple web server which responds with the <code>\"Hello\"</code> text to all requests:</p>\n\n<pre><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, _ *http.Request) {\n    io.WriteString(w, \"Hello\")\n})\npanic(http.ListenAndServe(\":8080\", nil))\n</code></pre>\n\n<p>The handler function sending back the <code>\"Hello\"</code> text only uses the response writer <code>w</code>, but not the request structure, so the blank identifier is used as its name.</p>\n\n<p>Another related question: </p>\n\n<p><a href=\"https://stackoverflow.com/questions/36152939/why-must-we-declare-a-variable-name-when-adding-a-method-to-a-struct-in-golang/36153205#36153205\">Why must we declare a variable name when adding a method to a struct in Golang?</a></p>\n\n<p>Also somewhat related, but regarding using / naming returned values:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/28487036/return-map-like-ok-in-golang-on-normal-functions/28487270#28487270\">Return map like &#39;ok&#39; in Golang on normal functions</a></p>\n\n<p>And regarding getting method / function parameter names:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/31377433/getting-method-parameter-names-in-golang/31377793#31377793\">Getting method parameter names in Golang</a></p>\n"}, {"tags": [], "owner": {"reputation": 2042, "user_id": 11424673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26ecf0fd0aa656482af8bc20d0d22c88?s=128&d=identicon&r=PG&f=1", "display_name": "Hymns For Disco", "link": "https://stackoverflow.com/users/11424673/hymns-for-disco"}, "is_accepted": false, "score": 1, "last_activity_date": 1570740067, "creation_date": 1570740067, "answer_id": 58330778, "question_id": 40950877, "link": "https://stackoverflow.com/questions/40950877/is-unnamed-arguments-a-thing-in-go/58330778#58330778", "title": "Is unnamed arguments a thing in Go?", "body": "<p>The purpose of unnamed function arguments is for arguments (which are local variables of the function) which are not referred to in the function's code, and therefore do not need a name.  An interesting note about anonymous variables is that they are actually used more commonly than you may think.  In Go, a function's return value(s) are usually listed as types, but actually they are also local variables of the function which can be named and manipulated.</p>\n\n<p>See this example in the \"Effective Go\" page on golang.org\n<a href=\"https://golang.org/doc/effective_go.html#named-results\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#named-results</a></p>\n\n<pre><code>func ReadFull(r Reader, buf []byte) (n int, err error) {\n    for len(buf) &gt; 0 &amp;&amp; err == nil {\n        var nr int\n        nr, err = r.Read(buf)\n        n += nr\n        buf = buf[nr:]\n    }\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1715, "user_id": 8712494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iWUnn1PqAuw/AAAAAAAAAAI/AAAAAAAAAGQ/2OslFo_DLk4/photo.jpg?sz=128", "display_name": "Amin Shojaei", "link": "https://stackoverflow.com/users/8712494/amin-shojaei"}, "is_accepted": false, "score": 2, "last_activity_date": 1610560004, "creation_date": 1610560004, "answer_id": 65707157, "question_id": 40950877, "link": "https://stackoverflow.com/questions/40950877/is-unnamed-arguments-a-thing-in-go/65707157#65707157", "title": "Is unnamed arguments a thing in Go?", "body": "<p>Unnamed parameters are valid but not referenceable.</p>\n<p>They're just for satisfaction of interfaces and signatures.</p>\n"}], "owner": {"reputation": 893, "user_id": 5016201, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/axdqP.jpg?s=128&g=1", "display_name": "aurelienC", "link": "https://stackoverflow.com/users/5016201/aurelienc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5818, "favorite_count": 6, "accepted_answer_id": 40951013, "answer_count": 3, "score": 19, "last_activity_date": 1612473491, "creation_date": 1480788370, "last_edit_date": 1480790314, "question_id": 40950877, "link": "https://stackoverflow.com/questions/40950877/is-unnamed-arguments-a-thing-in-go", "title": "Is unnamed arguments a thing in Go?", "body": "<p>I am writing a parser in Go for Go, and to test it I downloaded a bunch of files from github projects.<br>\nIn <a href=\"https://github.com/andlabs/ui\" rel=\"noreferrer\">https://github.com/andlabs/ui</a> I bumped into a file containing this piece of code:</p>\n\n<pre><code>func moveLabel(*Button) {\n    from := movingCurrent\n    to := 0\n    if from == 0 {\n        to = 1\n    }\n    movingBoxes[from].Delete(0)\n    movingBoxes[to].Append(movingLabel, false)\n    movingCurrent = to\n}\n</code></pre>\n\n<p>It confuse me a bit to see a pointer to a <code>Button</code> without a name as a function argument, which makes it impossible to reference from inside the function.<br>\nHowever, it seems to be syntactically correct given that the compiler doesn't complains.<br>\n<strong>What is the purpose of unamed functions arguments in Go?</strong></p>\n"}, {"tags": ["go", "data-structures", "queue", "slice"], "comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1480786745, "post_id": 40950452, "comment_id": 69110790, "body": "First off, if u want concurrency you&#39;ll need mutex locks in those methods, which already begins to smell.  I handle queues with Channels instead as channels are basically just stack copies. GC will clean them up after they are used."}, {"owner": {"reputation": 856, "user_id": 261111, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/plfYZ.jpg?s=128&g=1", "display_name": "Big Endian", "link": "https://stackoverflow.com/users/261111/big-endian"}, "reply_to_user": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1480789967, "post_id": 40950452, "comment_id": 69111875, "body": "not interested in thread safety, just memory management for this question. using channels to implement a queue is a bad idea from what I&#39;ve read as they are closely tied to go routine scheduling and can hang up the whole program. in the best case they&#39;re inefficient. this is the book I read this in: <a href=\"https://rads.stackoverflow.com/amzn/click/com/0134190440\" rel=\"nofollow noreferrer\" rel=\"nofollow noreferrer\">amazon.com/&hellip;</a>"}, {"owner": {"reputation": 856, "user_id": 261111, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/plfYZ.jpg?s=128&g=1", "display_name": "Big Endian", "link": "https://stackoverflow.com/users/261111/big-endian"}, "reply_to_user": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1480790021, "post_id": 40950452, "comment_id": 69111890, "body": "the code above is not an implementation, simply meant to illustrate my question"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1480797693, "post_id": 40950452, "comment_id": 69114257, "body": "The implementation&#39;s trade-offs are something you have to decide on. This example seems to purposely leak memory, so I not sure what it&#39;s trying to illustrate when you could just as easily slice off dequeued value. The std library heap is also often uses as a priority queue if you want to use that as an example."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1480807954, "post_id": 40950452, "comment_id": 69117123, "body": "If you&#39;re interested in memory management, you might take a look at <a href=\"http://stackoverflow.com/a/14582628/539810\">this answer</a> and its comments. Not sure how much it will actually help you, but that&#39;s usually a benefit since you usually don&#39;t want to incur an execution time penalty just to add a single value..."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480809378, "post_id": 40950452, "comment_id": 69117422, "body": "You might also see <a href=\"http://stackoverflow.com/a/33393554/539810\">this answer</a> and its comments by @JimB. To answer your question, you must reallocate the underlying array because it&#39;s simply a chunk of memory that Go asked the OS to reserve for your program. You can have Go ask the OS to release that memory of course, but beware of issues such as multiple slices using the same underlying array because it will be released at one time since it&#39;s a single block of memory, even if the OS stores it as multiple blocks or it&#39;s a discontinuous section of RAM on the hardware level."}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 2, "last_activity_date": 1480860670, "last_edit_date": 1592644375, "creation_date": 1480860670, "answer_id": 40959467, "question_id": 40950452, "link": "https://stackoverflow.com/questions/40950452/queue-implementation-using-slices-in-go/40959467#40959467", "title": "Queue implementation using slices in Go", "body": "<p>You can use a circular buffer. From <a href=\"https://en.wikipedia.org/wiki/Circular_buffer\" rel=\"nofollow noreferrer\">wikipedia</a>:</p>\n<blockquote>\n<p>A circular buffer, circular queue, cyclic buffer or ring buffer is a data structure that uses a single, fixed-size buffer as if it were connected end-to-end. This structure lends itself easily to buffering data streams.</p>\n<p>...</p>\n<p>Circular buffering makes a good implementation strategy for a queue that has fixed maximum size. Should a maximum size be adopted for a queue, then a circular buffer is a completely ideal implementation; all queue operations are constant time. However, expanding a circular buffer requires shifting memory, which is comparatively costly. For arbitrarily expanding queues, a linked list approach may be preferred instead.</p>\n</blockquote>\n<p>Here's a package that implements this: <a href=\"https://github.com/eapache/queue\" rel=\"nofollow noreferrer\">https://github.com/eapache/queue</a>.</p>\n<p>Depending on the use case, a channel is also a good way to implement a queue. It blocks, but using a select with a default you can avoid that behavior:</p>\n<pre><code>select {\ncase msg := &lt;-queue:\ndefault:\n}\n</code></pre>\n"}], "owner": {"reputation": 856, "user_id": 261111, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/plfYZ.jpg?s=128&g=1", "display_name": "Big Endian", "link": "https://stackoverflow.com/users/261111/big-endian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1221, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1480860670, "creation_date": 1480785810, "question_id": 40950452, "link": "https://stackoverflow.com/questions/40950452/queue-implementation-using-slices-in-go", "title": "Queue implementation using slices in Go", "body": "<p>I have seen some implementations of FIFO Queues using slices in Go. As items exit the queue can this memory be freed up without reallocating the underlying array? If this doesn't occur it would seem to me that the queue would leak a ton of memory. This is what I mean: </p>\n\n<pre><code>type queue\n{\n  []int\n  int head\n}\n\nfunc (q *queue) enqueue(val int) {\n   q = append(q, val)\n}\n\nfunc (q *queue) dequeue() int {\n   return (*q)[q.head++]\n}\n</code></pre>\n\n<p>After calling enqueue/dequeue a bunch of times, the low indexes of the array underying the slice are no longer usable but I am not sure how they can be freed either. Can someone point me to a proper queue implementation that does not use pointers, and doesn't leak memory like this or have performance issues? Alternatively a description of how this might work would also be appreciated. </p>\n\n<p>Thank you,\nPlamen</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 5306254, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6Yxde8XVfdo/AAAAAAAAAAI/AAAAAAAAAHg/xUhv1vDyd-A/photo.jpg?sz=128", "display_name": "multiversed", "link": "https://stackoverflow.com/users/5306254/multiversed"}, "edited": false, "score": 0, "creation_date": 1480792783, "post_id": 40950393, "comment_id": 69112708, "body": "Thank you for the quick response!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1480785729, "last_edit_date": 1480785729, "creation_date": 1480785422, "answer_id": 40950393, "question_id": 40950224, "link": "https://stackoverflow.com/questions/40950224/go-unexpected-end-of-json-input-and-json-unmarshal-returns-nil-values/40950393#40950393", "title": "Go: unexpected end of JSON input and json.Unmarshal returns nil values", "body": "<p>Your input JSON can be modeled with a simple <code>[]Obj</code> where <code>Obj</code> is your type:</p>\n\n<pre><code>type Obj struct {\n    Name  string  `json:\"name\"`\n    Value float32 `json:\"value\"`\n}\n</code></pre>\n\n<p>Nothing else is required, really:</p>\n\n<pre><code>body := []byte(`[\n    {\"name\":\"Name1\", \"value\":100.00},\n    {\"name\":\"Name2\", \"value\":200.00}]`)\n\nvar res []Obj\nerr := json.Unmarshal(body, &amp;res)\nfmt.Printf(\"%#v\\n%v\\n\", res, err)\n</code></pre>\n\n<p>Output contains the data from the input JSON (try it on the <a href=\"https://play.golang.org/p/K7tV07W5_i\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[]main.Obj{main.Obj{Name:\"Name1\", Value:100}, main.Obj{Name:\"Name2\", Value:200}}\n&lt;nil&gt;\n</code></pre>\n\n<p><strong>Back to your code:</strong></p>\n\n<p>Where you're going wrong is that you use this model:</p>\n\n<pre><code>type Obj struct {\n    Name string `json:\"name\"`\n    Value float32 `json:\"value\"`\n}\n\ntype Result struct {\n    Data json.RawMessage\n}\n\nvar res []Result\n</code></pre>\n\n<p>But this <code>res</code> variable would model the following JSON:</p>\n\n<pre><code>[\n    {\"Data\":{\"name\":\"Name1\", \"value\":100.00}},\n    {\"Data\":{\"name\":\"Name2\", \"value\":200.00}}\n]\n</code></pre>\n\n<p>I think you can see the difference: the elements of the array here are JSON Objects with a <code>\"Data\"</code> field, which then are modeled with your <code>Obj</code>. This input JSON is then properly parsed with your original parsing code, you can try it on the <a href=\"https://play.golang.org/p/Urn4QsdyBj\" rel=\"nofollow noreferrer\">Go Playground</a>:</p>\n\n<pre><code>[{{\"name\":\"Name1\", \"value\":100.00}} {{\"name\":\"Name2\", \"value\":200.00}}] \n&amp;main.Obj{Name:\"Name1\", Value:100} \n&amp;main.Obj{Name:\"Name2\", Value:200}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 5306254, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-6Yxde8XVfdo/AAAAAAAAAAI/AAAAAAAAAHg/xUhv1vDyd-A/photo.jpg?sz=128", "display_name": "multiversed", "link": "https://stackoverflow.com/users/5306254/multiversed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3609, "favorite_count": 0, "accepted_answer_id": 40950393, "answer_count": 1, "score": 3, "last_activity_date": 1480785729, "creation_date": 1480784460, "last_edit_date": 1495542845, "question_id": 40950224, "link": "https://stackoverflow.com/questions/40950224/go-unexpected-end-of-json-input-and-json-unmarshal-returns-nil-values", "title": "Go: unexpected end of JSON input and json.Unmarshal returns nil values", "body": "<p>I'm testing out how to unmarshal a json response from an API I'm using.</p>\n\n<p>The json looks something like the following;     </p>\n\n<pre><code>body := []byte(`[\n    {\"name\":\"Name1\", \"value\":100.00},\n    {\"name\":\"Name2\", \"value\":200.00}\n]`)\n</code></pre>\n\n<p>I've searched around for various ways to do this, but fail to get this to work. The unmarshal returns zero values. I also get an error \"unexpected end of JSON input\" (I've removed the error handling in the example). </p>\n\n<p>Full code example - <a href=\"https://play.golang.org/p/VMdWuAm6HS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VMdWuAm6HS</a></p>\n\n<p>Reference:</p>\n\n<ol>\n<li><a href=\"https://godoc.org/encoding/json#RawMessage\" rel=\"nofollow noreferrer\">https://godoc.org/encoding/json#RawMessage</a></li>\n<li><a href=\"https://stackoverflow.com/questions/27994327/golang-json-unmarshal-unexpected-end-of-json-input\">Golang json Unmarshal &quot;unexpected end of JSON input&quot;</a></li>\n<li><a href=\"https://stackoverflow.com/questions/28254102/how-to-unmarshal-json-into-interface-in-golang\">How to unmarshal json into interface{} in golang?</a></li>\n</ol>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1480779336, "post_id": 40949178, "comment_id": 69108569, "body": "If it&#39;s only for tests, in any <code>_test.go</code> file."}], "answers": [{"comments": [{"owner": {"reputation": 2587, "user_id": 2091399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeHSj.jpg?s=128&g=1", "display_name": "Peter Dotchev", "link": "https://stackoverflow.com/users/2091399/peter-dotchev"}, "edited": false, "score": 3, "creation_date": 1558424278, "post_id": 40949505, "comment_id": 99085666, "body": "What do you do if you want to reuse test code across packages? Go does not allow to import test code."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2587, "user_id": 2091399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeHSj.jpg?s=128&g=1", "display_name": "Peter Dotchev", "link": "https://stackoverflow.com/users/2091399/peter-dotchev"}, "edited": false, "score": 0, "creation_date": 1558425534, "post_id": 40949505, "comment_id": 99086237, "body": "@PeterDotchev You can&#39;t import code being part of a test package, but if you want to reuse code in multiple tests, put it in a non-test package, so you can import it from tests as well."}, {"owner": {"reputation": 2587, "user_id": 2091399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeHSj.jpg?s=128&g=1", "display_name": "Peter Dotchev", "link": "https://stackoverflow.com/users/2091399/peter-dotchev"}, "edited": false, "score": 0, "creation_date": 1558599689, "post_id": 40949505, "comment_id": 99156694, "body": "If I put test code in a non-test package, will it be included in my production binary?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2587, "user_id": 2091399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aeHSj.jpg?s=128&g=1", "display_name": "Peter Dotchev", "link": "https://stackoverflow.com/users/2091399/peter-dotchev"}, "edited": false, "score": 2, "creation_date": 1558600008, "post_id": 40949505, "comment_id": 99156885, "body": "@PeterDotchev Only if non-test packages also import it, else it won&#39;t."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1480798769, "last_edit_date": 1480798769, "creation_date": 1480779644, "answer_id": 40949505, "question_id": 40949178, "link": "https://stackoverflow.com/questions/40949178/where-to-put-shared-code-for-tests-in-a-go-package/40949505#40949505", "title": "Where to put shared code for tests in a Go package?", "body": "<p>You just put it in any of the test files and that's all. Test files using the same package clause belong to the same test package and can refer to each other's exported <em>and</em> unexported identifiers without any <code>import</code> statements.</p>\n\n<p>Also note that you're not required to create a separate <code>_test.go</code> file for each of the <code>.go</code> files; and you can have an <code>xx_test.go</code> file without having a \"matching\" <code>xx.go</code> file in the package.</p>\n\n<p>For example if you're writing package <code>a</code>, having the following files:</p>\n\n<pre><code>a/\n    a.go\n    b.go\n    a_test.go\n    b_test.go\n</code></pre>\n\n<p>For black-box testing you'd use the <code>package a_test</code> package clause in <code>a_test.go</code> and <code>b_test.go</code>. Having a <code>func util()</code> in file <code>a_test.go</code>, you can use it in <code>b_test.go</code> too.</p>\n\n<p>If you're writing white-box testing, you'd use <code>package a</code> in the test files, and again, you can refer any identifiers declared in <code>a_test.go</code> from <code>b_test.go</code> (and vice versa) without any imports.</p>\n\n<p>Note that however if the package clauses in <code>a_test.go</code> and <code>b_test.go</code> do not match (e.g. <code>a_test.go</code> uses <code>package a</code> and <code>b_test.go</code> uses <code>package a_test</code>), then they will belong to different test packages and then you can't use identifiers declared in one another.</p>\n"}], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2306, "favorite_count": 1, "closed_date": 1569220594, "accepted_answer_id": 40949505, "answer_count": 1, "score": 5, "last_activity_date": 1558538923, "creation_date": 1480777762, "question_id": 40949178, "link": "https://stackoverflow.com/questions/40949178/where-to-put-shared-code-for-tests-in-a-go-package", "closed_reason": "Duplicate", "title": "Where to put shared code for tests in a Go package?", "body": "<p>I have a Go package with multiple files. As of Go standard I am creating an associated test file for each source file in the package. </p>\n\n<p>In my case the different tests use the same test helping functions. I don't want these functions to be in the package source files because it is only used for testing purpose. I also would like avoiding replicating this code in each test file. </p>\n\n<p>Where should I put this code shared between all the test source files and not part of the package ?</p>\n"}, {"tags": ["go", "stdin", "reader"], "comments": [{"owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "edited": false, "score": 1, "creation_date": 1480781725, "post_id": 40947544, "comment_id": 69109316, "body": "I&#39;m not sure if this helps, but this answer suggests how to overwrite the previous line in a terminal <a href=\"http://stackoverflow.com/questions/15442292/golang-how-to-have-an-inplace-string-that-updates-at-stdout\" title=\"golang how to have an inplace string that updates at stdout\">stackoverflow.com/questions/15442292/&hellip;</a>"}, {"owner": {"reputation": 33, "user_id": 6089431, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9lmfQMJorQM/AAAAAAAAAAI/AAAAAAAAAHQ/uFZss15KckI/photo.jpg?sz=128", "display_name": "Vincent Rasquier", "link": "https://stackoverflow.com/users/6089431/vincent-rasquier"}, "reply_to_user": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "edited": false, "score": 0, "creation_date": 1480783618, "post_id": 40947544, "comment_id": 69109852, "body": "Thanks, It could be a part of the answer if I know how to listen a character and not a &quot;string&quot; like bufio.Reader do."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480785721, "post_id": 40947544, "comment_id": 69110457, "body": "You have to put the terminal into raw mode to do this. Why not do what most cli apps do, and display a default that will be used if the user presses enter with no input?"}], "owner": {"reputation": 33, "user_id": 6089431, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-9lmfQMJorQM/AAAAAAAAAAI/AAAAAAAAAHQ/uFZss15KckI/photo.jpg?sz=128", "display_name": "Vincent Rasquier", "link": "https://stackoverflow.com/users/6089431/vincent-rasquier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 545, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1480786172, "creation_date": 1480766632, "last_edit_date": 1480786172, "question_id": 40947544, "link": "https://stackoverflow.com/questions/40947544/put-a-default-value-to-stdin-while-reading-with-golang", "title": "Put a default value to stdin while reading with Golang", "body": "<p>I am coding a sort of configuration-editor.\nMy goal is to allow a user to edit a complicated config file with a cli.</p>\n\n<p>Every thing works well on creation but I have a little question on the edition part.</p>\n\n<p>When the user makes an edit, I want to read stdin to get the new value and I want the former result to appear in stdin and be editable directly from stdin.</p>\n\n<p>Little example:\n- user runs : ./my-tool edit \"NAME\"\n- We ask on stdout : \"Enter the new name :\"\n- I want that the former result appeared in the stdin and that the user can erase it or edit it. If the former result is \"test\" I want test to print on console so the user can press on \"del\" and change \"test\" to \"tes\" </p>\n\n<p>I hope I'm clear enough... Is it possible ? Thanks</p>\n\n<p>My actual code :</p>\n\n<pre><code>func getInput(txt, def string) string {\n    //def = former value/default value\n    reader := bufio.NewReader(os.Stdin)\n\n    fmt.Print(\"Enter '\" + txt + \"' of target: \")\n    os.Stdin.Write([]byte(def)) //Not working user can't edit this ...\n    tmp, err := reader.ReadString('\\n')\n\n    if err != nil {\n        fmt.Println(err)\n        return _getInput(txt, def)\n    }\n\n    tmp = strings.TrimSpace(tmp)\n    fmt.Println(tmp)\n\n    return tmp\n}\n</code></pre>\n"}, {"tags": ["vim", "go", "vim-syntax-highlighting"], "comments": [{"owner": {"reputation": 430, "user_id": 986597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0hCj.jpg?s=128&g=1", "display_name": "Graham Nicholls", "link": "https://stackoverflow.com/users/986597/graham-nicholls"}, "edited": false, "score": 0, "creation_date": 1514377689, "post_id": 40945136, "comment_id": 82952567, "body": "I find this astonishingly irritating behaviour (nearly as bad as SO underlining the word &quot;behaviour&quot; as if it&#39;s misspelled).  It hides where the cursor is - particularly if you have showmatch switched on to show matching parens."}], "answers": [{"comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1480801545, "post_id": 40945424, "comment_id": 69115430, "body": "It&#39;s also documented in <code>:help vim-go</code>."}, {"owner": {"reputation": 430, "user_id": 986597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0hCj.jpg?s=128&g=1", "display_name": "Graham Nicholls", "link": "https://stackoverflow.com/users/986597/graham-nicholls"}, "edited": false, "score": 1, "creation_date": 1514377801, "post_id": 40945424, "comment_id": 82952623, "body": "On my system, I get &quot;E149: Sorry, no help for vim-go&quot;.  Your terse comment is not just unhelpful, but wrong."}], "tags": [], "owner": {"reputation": 3557, "user_id": 5154907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0123b2acc91eae7a50b5cf298ba1908?s=128&d=identicon&r=PG&f=1", "display_name": "ryuichiro", "link": "https://stackoverflow.com/users/5154907/ryuichiro"}, "is_accepted": true, "score": 8, "last_activity_date": 1480751783, "last_edit_date": 1480751783, "creation_date": 1480750673, "answer_id": 40945424, "question_id": 40945136, "link": "https://stackoverflow.com/questions/40945136/stop-highlighting-trailing-whitespace-for-go-files-in-vim/40945424#40945424", "title": "Stop highlighting trailing whitespace for Go files in Vim", "body": "<p>From <code>go.vim</code> Vim syntax file:</p>\n\n<blockquote>\n<pre><code>\"   There are some options for customizing the highlighting; the recommended\n\"   settings are the default values, but you can write:\n\"     let OPTION_NAME = 0\n\"   in your ~/.vimrc file to disable particular options.\n</code></pre>\n</blockquote>\n\n<p>Put in your .vimrc</p>\n\n<pre><code>let g:go_highlight_trailing_whitespace_error=0\n</code></pre>\n\n<p>There are these other options:</p>\n\n<blockquote>\n<pre><code>\"   - g:go_highlight_array_whitespace_error\n\"     Highlights white space after \"[]\".\n\"   - g:go_highlight_chan_whitespace_error\n\"     Highlights white space around the communications operator that don't\n\"     follow the standard style.\n\"   - g:go_highlight_extra_types\n\"     Highlights commonly used library types (io.Reader, etc.).\n\"   - g:go_highlight_space_tab_error\n\"     Highlights instances of tabs following spaces.\n</code></pre>\n</blockquote>\n\n<p>If you still like the highlighting of trailing whitespaces but not during the typing, you can try</p>\n\n<pre><code>au InsertEnter *.go match goSpaceError /\\s\\+\\%#\\@&lt;!$/\nau InsertLeave *.go match goSpaceError /\\s\\+$/\n</code></pre>\n\n<p>Read more in <a href=\"http://vim.wikia.com/wiki/Highlight_unwanted_spaces\" rel=\"noreferrer\">Highlight unwanted spaces</a> from <a href=\"http://vim.wikia.com\" rel=\"noreferrer\">wikia</a>.</p>\n"}], "owner": {"reputation": 315, "user_id": 1478849, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/8d1b35ba9396549b2540434b8dea855c?s=128&d=identicon&r=PG", "display_name": "charlieshades", "link": "https://stackoverflow.com/users/1478849/charlieshades"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1854, "favorite_count": 2, "accepted_answer_id": 40945424, "answer_count": 1, "score": 7, "last_activity_date": 1480751783, "creation_date": 1480748152, "question_id": 40945136, "link": "https://stackoverflow.com/questions/40945136/stop-highlighting-trailing-whitespace-for-go-files-in-vim", "title": "Stop highlighting trailing whitespace for Go files in Vim", "body": "<p>For some reason it seems the default for vim with Go files is to highlight trailing whitespace in red. In a way this is nice, but mostly I find it annoying because every time I type a space it starts as a red highlight. Is there a way to stop this behavior? I've only experienced this with Go files. Below is my vimrc, but I don't think I put anything there that would affect it.</p>\n\n<pre><code>set nocompatible\nsyntax on\nset autoindent\nset tabstop=4 softtabstop=0\nautocmd FileType go set tabstop=8 softtabstop=0\nset formatoptions=tcroql\nset relativenumber\nset incsearch\nset hlsearch\nset smartindent\nfiletype indent on\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1480746180, "post_id": 40944907, "comment_id": 69100724, "body": "<code>[]</code> isn&#39;t necessarily only representing a one-dimensional matrix. A completely empty matrix with any number of dimensions will be <code>[]</code>."}, {"owner": {"reputation": 11, "user_id": 7244223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eca7f41550d19e8f05f43b237c782f8f?s=128&d=identicon&r=PG&f=1", "display_name": "supersnail", "link": "https://stackoverflow.com/users/7244223/supersnail"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 1, "creation_date": 1480749580, "post_id": 40944907, "comment_id": 69101315, "body": "thanks , I am wrong... Now it&#39;s accepted.<a href=\"https://leetcode.com/submissions/detail/84564934/\" rel=\"nofollow noreferrer\">leetcode.com/submissions/detail/84564934</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "is_accepted": false, "score": 1, "last_activity_date": 1576147974, "creation_date": 1576147974, "answer_id": 59302965, "question_id": 40944907, "link": "https://stackoverflow.com/questions/40944907/how-to-solve-spiral-matrix-in-go/59302965#59302965", "title": "How to solve Spiral Matrix in go", "body": "<pre><code>func spiralOrder(matrix [][]int) []int {\n    if len(matrix) == 0 || len(matrix[0]) == 0 {\n        return nil\n    }\n\n    m, n := len(matrix), len(matrix[0])\n\n    next := nextFunc(m, n)\n\n    res := make([]int, m*n)\n    for i := range res {\n        x, y := next()\n        res[i] = matrix[x][y]\n    }\n\n    return res\n}\n\nfunc nextFunc(m, n int) func() (int, int) {\n    top, down := 0, m-1\n    left, right := 0, n-1\n    x, y := 0, -1\n    dx, dy := 0, 1\n    return func() (int, int) {\n        x += dx\n        y += dy\n        switch { \n        case y+dy &gt; right:\n            top++\n            dx, dy = 1, 0\n        case x+dx &gt; down:\n            right--\n            dx, dy = 0, -1\n        case y+dy &lt; left:\n            down--\n            dx, dy = -1, 0\n        case x+dx &lt; top:\n            left++\n            dx, dy = 0, 1\n        }\n        return x, y\n    }\n}\n</code></pre>\n\n<p>Source: <a href=\"https://github.com/aQuaYi/LeetCode-in-Go/blob/master/Algorithms/0054.spiral-matrix/spiral-matrix.go\" rel=\"nofollow noreferrer\">https://github.com/aQuaYi/LeetCode-in-Go/blob/master/Algorithms/0054.spiral-matrix/spiral-matrix.go</a></p>\n\n<p>This repository has most of the solutions to LeetCode problems in a very optimal manner. Please do take a look. Hope it helps.</p>\n"}], "owner": {"reputation": 11, "user_id": 7244223, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eca7f41550d19e8f05f43b237c782f8f?s=128&d=identicon&r=PG&f=1", "display_name": "supersnail", "link": "https://stackoverflow.com/users/7244223/supersnail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 163, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1576147974, "creation_date": 1480746001, "last_edit_date": 1480853265, "question_id": 40944907, "link": "https://stackoverflow.com/questions/40944907/how-to-solve-spiral-matrix-in-go", "title": "How to solve Spiral Matrix in go", "body": "<p><a href=\"https://leetcode.com/problems/spiral-matrix/\" rel=\"nofollow noreferrer\">https://leetcode.com/problems/spiral-matrix/</a> \ngolang implement.\nthe result as follow:</p>\n\n<p>Run Code Status: Runtime Error</p>\n\n<p>Run Code Result: \u00d7</p>\n\n<p>Your input</p>\n\n<p>[]\nYour answer</p>\n\n<p>Expected answer</p>\n\n<p>[]\nShow Diff</p>\n\n<p>why [] is the test case ,it's just a one-dimensional slice ?</p>\n\n<p>my code is :</p>\n\n<pre><code>func sprial(begin_r, begin_c, row, col int, matrix [][]int) []int {\ns := make([]int, col*row, col*row+10)\nk := 0\nif row == 1 &amp;&amp; col == 1 {\n    s[k] = matrix[begin_r][begin_c]\n\n    return s\n} else if row == 1 {\n    return matrix[begin_r][begin_c : col-1]\n} else if col == 1 {\n    return matrix[begin_r : row-1][begin_c]\n} else {\n    for i := begin_c; i &lt; col; i++ {\n        s[k] = matrix[begin_r][i]\n        k++\n    }\n    for i := begin_r + 1; i &lt; row; i++ {\n        s[k] = matrix[i][col-1]\n        k++\n    }\n    for i := col - 2; i &gt;= begin_c; i-- {\n        s[k] = matrix[row-1][i]\n        k++\n    }\n    for i := row - 2; i &gt;= begin_r+1; i-- {\n        s[k] = matrix[i][begin_c]\n        k++\n    }\n\n    return s[:k-1]\n}\n}\n\nfunc spiralOrder(matrix [][]int) []int {\nm := len(matrix)\nn := len(matrix[0])\ni := 0\nj := 0\n//  var rS []int\nk := 0\n\n//s1 := make([]int, m*n, m*n)\n\nvar s1 = []int{}\nfor {\n    if m &lt;= 0 || n &lt;= 0 {\n        break\n    }\n    s := sprial(i, j, m, n, matrix)\n    if k == 0 {\n        s1 = s\n\n    } else {\n\n        s1 = append(s1, s...)\n\n    }\n\n    i++\n    j++\n    m -= 2\n    n -= 2\n    k++\n}\nreturn s1\n}\n</code></pre>\n"}, {"tags": ["random", "go", "time"], "answers": [{"tags": [], "owner": {"reputation": 15866, "user_id": 83144, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d23b2cf9de6548618d481fd39afd5d66?s=128&d=identicon&r=PG", "display_name": "mattmc3", "link": "https://stackoverflow.com/users/83144/mattmc3"}, "is_accepted": true, "score": 1, "last_activity_date": 1480741154, "last_edit_date": 1480741154, "creation_date": 1480739905, "answer_id": 40944286, "question_id": 40944233, "link": "https://stackoverflow.com/questions/40944233/generating-random-timestamps-in-go/40944286#40944286", "title": "Generating Random Timestamps in Go", "body": "<p>Don't use time.Parse. You have a Unix time, not a time string. Use the <code>Unix()</code> method instead. <a href=\"https://golang.org/pkg/time/#Unix\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#Unix</a>. You can also choose a minimum time value, say 1/1/1900 and add a random Duration of seconds to the time using the <code>Add</code> method on Time and passing a <code>Duration</code> you made with the Ticks() method. <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#Duration</a></p>\n\n<p>Here's a Go Playground link. Just remember that the Go Playground doesn't support actual randomness. <a href=\"https://play.golang.org/p/qYTpnbml_N\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qYTpnbml_N</a></p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"math/rand\"\n    \"fmt\"\n)\n\nfunc randomTimestamp() time.Time {\n    randomTime := rand.Int63n(time.Now().Unix() - 94608000) + 94608000\n\n    randomNow := time.Unix(randomTime, 0)\n\n    return randomNow\n}\n\nfunc main() {\n    fmt.Println(randomTimestamp().String())\n}\n</code></pre>\n"}], "owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2874, "favorite_count": 0, "accepted_answer_id": 40944286, "answer_count": 1, "score": 3, "last_activity_date": 1480741154, "creation_date": 1480739371, "question_id": 40944233, "link": "https://stackoverflow.com/questions/40944233/generating-random-timestamps-in-go", "title": "Generating Random Timestamps in Go", "body": "<p>I'd like to generate a random timestamp within the last relative 3 years and have it be printed out with this format: <code>%d/%b/%Y:%H:%M:%S %z</code></p>\n\n<p>Here is what I have right now:</p>\n\n<pre><code>package main\n\nimport (\n    \"strconv\"\n    \"time\"\n    \"math/rand\"\n    \"fmt\"\n)\n\nfunc randomTimestamp() time.Time {\n    randomTime := rand.Int63n(time.Now().Unix() - 94608000) + 94608000\n\n    randomNow, err := time.Parse(\"10/Oct/2000:13:55:36 -0700\", strconv.FormatInt(randomTime, 10))\n    if err != nil {\n        panic(err)\n    }\n\n    return randomNow\n}\n\nfunc main() {\n    fmt.Println(randomTimestamp().String())\n}\n</code></pre>\n\n<p>This always throws: <code>panic: parsing time \"...\": month out of range</code>. How can I generate a random timestamp for a given range, then convert it to the string format I want with the standard library?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1480733030, "post_id": 40943591, "comment_id": 69098569, "body": "An empty for loop is a programming error, there&#39;s never a need to use one. It blocks the runtime scheduler preventing the STW phase of the GC."}, {"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1480733375, "post_id": 40943591, "comment_id": 69098624, "body": "The empty for loop will do nothing but consume a lot of CPU. To avoid that you may add time.Sleep(1 * time.Second) in the for loop and then all the groutines will get chances to run. Without that, most probably some of the goroutines don&#39;t even get scheduled, no idea why."}, {"owner": {"reputation": 179, "user_id": 1137027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5be60fa7d99363836ef7628649b910b?s=128&d=identicon&r=PG", "display_name": "sydnash", "link": "https://stackoverflow.com/users/1137027/sydnash"}, "edited": false, "score": 0, "creation_date": 1480738537, "post_id": 40943591, "comment_id": 69099442, "body": "go schedule is not really preemptive ,it only set a flag when one goroutine is running a long time, and really schedule only hanppened at next function  call."}, {"owner": {"reputation": 789, "user_id": 1775669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0921d56a00fe6e510240426b132dc0?s=128&d=identicon&r=PG", "display_name": "andreycpp", "link": "https://stackoverflow.com/users/1775669/andreycpp"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480792344, "post_id": 40943591, "comment_id": 69112575, "body": "@JimB This is obviously an experiment and an attempt to understand how go scheduler works. There are a number of similar questions floating around that suggest that those for{} loops need to have either a call to Gosched() or any other function call. Now, this is quite confusing and looks more like a hack rather than what I&#39;d expect from language runtime. Plus I was not able to find where this would be documented other than these SO posts."}, {"owner": {"reputation": 789, "user_id": 1775669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0921d56a00fe6e510240426b132dc0?s=128&d=identicon&r=PG", "display_name": "andreycpp", "link": "https://stackoverflow.com/users/1775669/andreycpp"}, "reply_to_user": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1480792453, "post_id": 40943591, "comment_id": 69112605, "body": "@Nipun Talukdar &quot;no idea why&quot; - that&#39;s the part I want to demystify :) I could not find where this would be documented. Obviously this is just an experimental code, however similar case may happen in production code and as a developer I want full understanding and full control of what&#39;s going on."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480799176, "post_id": 40943591, "comment_id": 69114740, "body": "@AndreyTerentyev: The exact reason depends on implementation and version. It&#39;s not specified, because this isn&#39;t part of the language spec, its an implementation detail. IIRC the current gc runtime blocks when the GC can&#39;t STW due to the for loop which doesn&#39;t yield, which in turns blocks the scheduler."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 1523521, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M3iln.png?s=128&g=1", "display_name": "Povilas Versockas", "link": "https://stackoverflow.com/users/1523521/povilas-versockas"}, "is_accepted": false, "score": 0, "last_activity_date": 1493183962, "creation_date": 1493183962, "answer_id": 43625631, "question_id": 40943591, "link": "https://stackoverflow.com/questions/40943591/making-sense-of-golangs-scheduler-when-running-infinite-loop-goroutines-with-go/43625631#43625631", "title": "Making sense of golang&#39;s scheduler when running infinite-loop goroutines with GOMAXPROCS = 256", "body": "<p>I think it's because there is a limit of threads you can create on you machine. \nWhat <code>runtime.GOMAXPROCS(256)</code> does is creates 256 <strong>Logical Processors</strong>\n (also known as <strong>P</strong> = Proccesor) and tries to run them. Each <strong>P</strong> has it's own runqueue of goroutines named <strong>G</strong> and are executed by OS thread (called <strong>M</strong> as Machine). </p>\n\n<p>So what happens is that your 256 <strong>P's</strong> try to get an OS thread(<strong>M</strong>) to execute <strong>G</strong>, but your computer doesn't have that many resources to run 256 OS threads, so thats why you get only 143 ones.</p>\n\n<p>For me executing this command produces 143 ones and the number of running threads for this process is about 150.</p>\n\n<p>Because by default go scheduler won't preempt any goroutines you will only be running around 150 goroutines and all others will be starved of OS threads. Here is an <a href=\"https://github.com/golang/go/issues/11462\" rel=\"nofollow noreferrer\">issue</a> describing this behaviour. Calling <code>runtime.Gosched()</code> yields the processor(<strong>P</strong>), allowing other goroutines to run.</p>\n\n<p>To inspect what scheduler is doing you can add GODEBUG environment variable:</p>\n\n<pre><code>env GODEBUG=scheddetail=1,schedtrace=1000 ./cpu3\n</code></pre>\n\n<p>Here is output (Note that it uses <strong>P, M, G terminology</strong>):</p>\n\n<pre><code>SCHED 0ms: gomaxprocs=8 idleprocs=5 threads=5 spinningthreads=1 idlethreads=0 runqueue=0 gcwaiting=0 nmidlelocked=1 stopwait=0 sysmonwait=0\n  P0: status=1 schedtick=0 syscalltick=0 m=3 runqsize=0 gfreecnt=0\n  P1: status=1 schedtick=1 syscalltick=0 m=2 runqsize=0 gfreecnt=0\n  P2: status=1 schedtick=0 syscalltick=0 m=4 runqsize=0 gfreecnt=0\n  P3: status=0 schedtick=0 syscalltick=0 m=-1 runqsize=0 gfreecnt=0\n  P4: status=0 schedtick=0 syscalltick=0 m=-1 runqsize=0 gfreecnt=0\n  P5: status=0 schedtick=0 syscalltick=0 m=-1 runqsize=0 gfreecnt=0\n  P6: status=0 schedtick=0 syscalltick=0 m=-1 runqsize=0 gfreecnt=0\n  P7: status=0 schedtick=0 syscalltick=0 m=-1 runqsize=0 gfreecnt=0\n  M4: p=2 curg=-1 mallocing=0 throwing=0 preemptoff= locks=1 dying=0 helpgc=0 spinning=true blocked=false lockedg=-1\n  M3: p=0 curg=-1 mallocing=0 throwing=0 preemptoff= locks=1 dying=0 helpgc=0 spinning=false blocked=false lockedg=-1\n  M2: p=1 curg=-1 mallocing=0 throwing=0 preemptoff= locks=1 dying=0 helpgc=0 spinning=true blocked=false lockedg=-1\n  M1: p=-1 curg=-1 mallocing=0 throwing=0 preemptoff= locks=1 dying=0 helpgc=0 spinning=false blocked=false lockedg=-1\n  M0: p=-1 curg=-1 mallocing=0 throwing=0 preemptoff= locks=0 dying=0 helpgc=0 spinning=false blocked=true lockedg=1\n  G1: status=1(chan receive) m=-1 lockedm=0\n  G2: status=4(force gc (idle)) m=-1 lockedm=-1\n  G3: status=4(GC sweep wait) m=-1 lockedm=-1\n1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111SCHED 1004ms: gomaxprocs=256 idleprocs=0 threads=150 spinningthreads=0 idlethreads=5 runqueue=0 gcwaiting=1 nmidlelocked=0 stopwait=143 sysmonwait=0\n  P0: status=1 schedtick=1 syscalltick=3 m=0 runqsize=0 gfreecnt=0\n  P1: status=1 schedtick=3 syscalltick=1 m=2 runqsize=0 gfreecnt=0\n  ...\n  P141: status=1 schedtick=3 syscalltick=1 m=143 runqsize=0 gfreecnt=0\n  P142: status=1 schedtick=2 syscalltick=3 m=144 runqsize=0 gfreecnt=0\n  P143: status=3 schedtick=1 syscalltick=38 m=-1 runqsize=0 gfreecnt=0\n  ...\n  P255: status=3 schedtick=0 syscalltick=0 m=-1 runqsize=0 gfreecnt=0\n  M149: p=-1 curg=-1 mallocing=0 throwing=0 preemptoff= locks=0 dying=0 helpgc=0 spinning=false blocked=true lockedg=-1\n  ...\n  M144: p=142 curg=181 mallocing=0 throwing=0 preemptoff= locks=0 dying=0 helpgc=0 spinning=false blocked=false lockedg=-1\n  M143: p=141 curg=177 mallocing=0 throwing=0 preemptoff= locks=0 dying=0 helpgc=0 spinning=false blocked=false lockedg=-1\n  M142: p=140 curg=179 mallocing=0 throwing=0 preemptoff= locks=0 dying=0 helpgc=0 spinning=false blocked=false lockedg=-1\n  ...\n  M112: p=110 curg=186 mallocing=0 throwing=0 preemptoff= locks=0 dying=0 helpgc=0 spinning=false blocked=false lockedg=-1\n  ...\n</code></pre>\n"}], "owner": {"reputation": 789, "user_id": 1775669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0921d56a00fe6e510240426b132dc0?s=128&d=identicon&r=PG", "display_name": "andreycpp", "link": "https://stackoverflow.com/users/1775669/andreycpp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1183, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1546785863, "creation_date": 1480731568, "last_edit_date": 1546785863, "question_id": 40943591, "link": "https://stackoverflow.com/questions/40943591/making-sense-of-golangs-scheduler-when-running-infinite-loop-goroutines-with-go", "title": "Making sense of golang&#39;s scheduler when running infinite-loop goroutines with GOMAXPROCS = 256", "body": "<p>I'm playing with Go, running go 1.7.3 on my 2015 8-core MacBookPro.</p>\n\n<p>Trying to make sense of how go scheduler works when runtime.GOMAXPROCS is set to it's max value (256) and same amount of goroutines are started, each running an infinite loop.</p>\n\n<p>My assumption was that go runtime would spawn runtime.GOMAXPROCS number of OS threads (i.e. 256 threads) and run my goroutines in those threads.</p>\n\n<p>I was expecting the following code to print me 256 1's:</p>\n\n<pre><code>func main() {\n    procs := 256\n    runtime.GOMAXPROCS(procs)\n    for i := 0; i &lt; procs; i++ {\n        go func() {\n            fmt.Print(\"1\")\n            for {}\n        }()\n    }\n    for {}\n}\n</code></pre>\n\n<p>This code prints various number of 1's every time it runs. Most of the time it prints 142 1's.</p>\n\n<p>Now, there is runtime.Gosched() that manually invoked go scheduler. I was playing with it and found that I can get 256 1's printed only if I call runtime.Gosched() in <em>both</em> goroutines <em>and</em> main func:</p>\n\n<pre><code>func main() {\n    procs := 256\n    runtime.GOMAXPROCS(procs)\n    for i := 0; i &lt; procs; i++ {\n        go func() {\n            fmt.Print(\"1\")\n            for { runtime.Gosched() }\n        }()\n    }\n    for { runtime.Gosched() }\n}\n</code></pre>\n\n<p>Can someone explain why 256 1's are not printed by default and I need the runtime.Gosched()? Shouldn't we get 256 OS threads to run those 256 goroutines? And why do we need to call runtime.Gosched() in both places? </p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-sql"], "comments": [{"owner": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "edited": false, "score": 0, "creation_date": 1480736966, "post_id": 40943098, "comment_id": 69099168, "body": "You didn&#39;t say if you&#39;re connecting from App Engine Standard or App Engine Flex. I suspect you are connecting from App Engine Flex but reading App Engine Standard docs/posts. Please confirm."}, {"owner": {"reputation": 23, "user_id": 7227123, "user_type": "registered", "profile_image": "https://graph.facebook.com/712039678962600/picture?type=large", "display_name": "Corey Holton", "link": "https://stackoverflow.com/users/7227123/corey-holton"}, "reply_to_user": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "edited": false, "score": 0, "creation_date": 1480813546, "post_id": 40943098, "comment_id": 69118250, "body": "I am working in the Google Cloud Shell.   Make the program, build it, run it.   I do not yet have the option to use Flex until I deploy the solution and add that to the yaml.    I have been doing this cloud shell environment as I work thur all the GO examples.   Now I want to talk to cloud sql and  getting stuck.   I think now that I am battling against google cloud shell.   I will deploy my app and turn on flex tonight and post the results.   The connection strings below are not working in  cloud shell but at least the flex connection string gives me a new message... no such file directory"}, {"owner": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "edited": false, "score": 0, "creation_date": 1480813724, "post_id": 40943098, "comment_id": 69118281, "body": "You should make that more clear in your post. In that case you should <b>not</b> be following the App Engine instructions as they are for connecting from App Engine. Connecting from Cloud Shell is a bit more complicated, you would need to download and run the Cloud SQL Proxy in the shell in order to connect (using the same connection string I posted from App Engine Flex)"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 7227123, "user_type": "registered", "profile_image": "https://graph.facebook.com/712039678962600/picture?type=large", "display_name": "Corey Holton", "link": "https://stackoverflow.com/users/7227123/corey-holton"}, "edited": false, "score": 0, "creation_date": 1481060922, "post_id": 40944063, "comment_id": 69219689, "body": "Thank you Vadim, your guidance has helped and I have the unix connection string working on a deployed app engine flex environment.    I am still be blocked on Google Cloud Shell but I am happy to get this working.    This was the most helpful page in google docs which I got to by searching your example connection strings.   <a href=\"https://cloud.google.com/appengine/docs/flexible/go/using-cloud-sql\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/flexible/go/using-cloud-sql</a>"}], "tags": [], "owner": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "is_accepted": true, "score": 12, "last_activity_date": 1480737262, "creation_date": 1480737262, "answer_id": 40944063, "question_id": 40943098, "link": "https://stackoverflow.com/questions/40943098/connecting-to-cloudsql-from-app-engine-second-generation-cloudsql-go/40944063#40944063", "title": "Connecting to CloudSQL from App Engine (Second Generation CloudSQL) GO", "body": "<p>The following are the correct connection strings, but they differ depending on which version of App Engine you are connecting from.</p>\n\n<p>App Engine Standard:</p>\n\n<pre><code>user:password@cloudsql(INSTANCE_CONNECTION_NAME)/dbname\n</code></pre>\n\n<p>App Engine Flexible:</p>\n\n<pre><code>user:password@unix(/cloudsql/INSTANCE_CONNECTION_NAME)/dbname\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 23, "user_id": 7227123, "user_type": "registered", "profile_image": "https://graph.facebook.com/712039678962600/picture?type=large", "display_name": "Corey Holton", "link": "https://stackoverflow.com/users/7227123/corey-holton"}, "is_accepted": false, "score": 2, "last_activity_date": 1481062307, "last_edit_date": 1481062307, "creation_date": 1481061833, "answer_id": 41005779, "question_id": 40943098, "link": "https://stackoverflow.com/questions/40943098/connecting-to-cloudsql-from-app-engine-second-generation-cloudsql-go/41005779#41005779", "title": "Connecting to CloudSQL from App Engine (Second Generation CloudSQL) GO", "body": "<p><a href=\"https://cloud.google.com/appengine/docs/flexible/go/using-cloud-sql\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/flexible/go/using-cloud-sql</a></p>\n\n<p>For new people to GO, App Engine and CloudSQL just writing the simplest GO program to connect and communicate with your CloudSQL 2nd Gen database is frustrating!</p>\n\n<p>You have choices to make, App Eng or App Eng Flex, SQL 1st or 2nd Gen....   Depending on the combination connection strings are different.   All of google's documentation when you search drives you to first gen SQL and App Engine without flex because this is what is predominantly in production.  Make sure you are reading Flex documentation if you are doing that.  Make sure you are reading 2nd Gen docs if doing that.   Sometimes they are entirely different docs, sometimes the documentation is stacked on a page and you have to goto the bottom to see about the newer stuff  2nd gen sql and app eng flex.</p>\n\n<p>CloudShell is tricky, I still cannot compile GO and talk to SQL 2nd here.   I am successfully talking to cloud sql 2nd gen from a deployed app engine flex WITH A SQL PROXY RUNNING,  you have to use SQL PROXY.   You have to go thru the setup for this create users on appengine and SQL.</p>\n\n<p>This is my working program.</p>\n\n<pre><code>package main\n\nimport (\n\"database/sql\"\n_ \"github.com/go-sql-driver/mysql\"\n\"log\"\n\"fmt\"\n\"net/http\"\n)\n\nfunc healthCheckHandler(w http.ResponseWriter, r *http.Request) {\nfmt.Fprint(w, \"ok\")\n}\n\nfunc main() {\nhttp.HandleFunc(\"/\", handle)\nhttp.HandleFunc(\"/_cloudshellProxy/_ah/health\", healthCheckHandler)\nlog.Print(\"Listening on port 8080\")\nlog.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n\n\nfunc handle(w http.ResponseWriter, r *http.Request) {\n\nconst dbIP = \"104.xxx.xxx.x\"\nconst dbInstanceName =  \"projectname:us-central1:sqlinstance\"\nconst dbName = \"servxxx\"\nconst dbUserName = \"sqlproxysuser\"\nconst dbPassword = \"xxxRockxxx\"\n\n\nif r.URL.Path != \"/\" {\n    http.NotFound(w, r)\n    return\n}\nfmt.Fprint(w, \"Hello SQL!  Hello?\")\nfmt.Fprint(w, \"\\n\")\n\nconst dbOpenString = dbUserName + \":\" + dbPassword + \"@unix(/cloudsql/\" + dbInstanceName + \")/\" + dbName \n//const dbOpenString = dbUserName + \":\" + dbPassword + \"@cloudsql(\" + dbInstanceName + \")/\" + dbName \n\n//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-\n//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-\n//-=- SQL OPEN Statement,  per docs, DOES NOT return an error ever\n//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-\n//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-\ndb, err := sql.Open(\"mysql\", dbOpenString);\ndefer db.Close()\n\nerr = db.Ping()\nif err != nil {\n    fmt.Fprint(w, \"Failed Connection\" + \"  \" + dbOpenString)\n    fmt.Fprint(w, \"\\n\")\n    fmt.Fprint(w, err)\n    return\n} else {\n    fmt.Fprint(w, \"SUCCESSFUL CONNECTION\" + \"  \" + dbOpenString)\n    fmt.Fprint(w, \"\\n\")\n}\n\n_, err = db.Exec(\"CREATE TABLE IF NOT EXISTS exercisecloudsql101 (id INT NOT NULL AUTO_INCREMENT, name VARCHAR(100) NOT NULL, description TEXT, PRIMARY KEY (id))\")\nif err != nil {\n    fmt.Fprint(w, \"CREATE TABLE failed:\")\n    fmt.Fprint(w, \"\\n\")\n    fmt.Fprint(w, err) \n    fmt.Fprint(w, \"\\n\")\n} else {\n    fmt.Fprint(w, \"SUCCESSFUL CreateTable\" + \"  \" + dbOpenString)\n    fmt.Fprint(w, \"\\n\")\n}\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9810719, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/66bf47468e8a678f776f5bc2fc813c55?s=128&d=identicon&r=PG", "display_name": "Mattias", "link": "https://stackoverflow.com/users/9810719/mattias"}, "is_accepted": false, "score": 0, "last_activity_date": 1526634423, "creation_date": 1526634423, "answer_id": 50407679, "question_id": 40943098, "link": "https://stackoverflow.com/questions/40943098/connecting-to-cloudsql-from-app-engine-second-generation-cloudsql-go/50407679#50407679", "title": "Connecting to CloudSQL from App Engine (Second Generation CloudSQL) GO", "body": "<p>Have run in to the same problem of connecting to a cloud SQL instance. One variant that I got working on my windows localhost environment is below. The IP of my localhost needs to be added to Authorized networks for the db instance.</p>\n\n<p>Windows localhost connect over tcp:</p>\n\n<pre><code>user:password@tcp(104.xxx.xxx.xxx:3306)/dbname\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 959, "user_id": 1840370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/87fAc.png?s=128&g=1", "display_name": "Atish", "link": "https://stackoverflow.com/users/1840370/atish"}, "is_accepted": false, "score": 5, "last_activity_date": 1541613883, "creation_date": 1541613883, "answer_id": 53195237, "question_id": 40943098, "link": "https://stackoverflow.com/questions/40943098/connecting-to-cloudsql-from-app-engine-second-generation-cloudsql-go/53195237#53195237", "title": "Connecting to CloudSQL from App Engine (Second Generation CloudSQL) GO", "body": "<p>If you are migrating to the second generation Go App Engine (Golang 1.11) change your connection string from:</p>\n\n<p><code>user:password@cloudsql(instanceID)/db</code></p>\n\n<p>to</p>\n\n<p><code>user:password@unix(/cloudsql/instanceID)/db</code></p>\n"}], "owner": {"reputation": 23, "user_id": 7227123, "user_type": "registered", "profile_image": "https://graph.facebook.com/712039678962600/picture?type=large", "display_name": "Corey Holton", "link": "https://stackoverflow.com/users/7227123/corey-holton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2307, "favorite_count": 1, "accepted_answer_id": 40944063, "answer_count": 4, "score": 0, "last_activity_date": 1541613883, "creation_date": 1480726288, "last_edit_date": 1480785527, "question_id": 40943098, "link": "https://stackoverflow.com/questions/40943098/connecting-to-cloudsql-from-app-engine-second-generation-cloudsql-go", "title": "Connecting to CloudSQL from App Engine (Second Generation CloudSQL) GO", "body": "<p>Love the Stack, My first post out of complete frustration.   Thanks for you comments!</p>\n\n<ul>\n<li>Created App Engine Project</li>\n<li>Created Second Generation MySQL Instance in my App Engine Project</li>\n<li>Created Database in the MySQL Instance</li>\n<li>In App Engine, I activate the --> Google Cloud Shell &lt;--.  ( I am working at a command prompt in my console.cloud.google.com) </li>\n</ul>\n\n<p>I have copied this basic GO program to connect to my MySQL instance.</p>\n\n<p>I build it and run it.\ngo build mysqlexample.go\n./mysqlexample</p>\n\n<p>I have not been able to achieve a successful connection.  You can see all the various connection strings that I have tried and to the right of them is the response I get.</p>\n\n<p>I can connect from my local windows machine using mysql admin. </p>\n\n<p>Help?</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"log\"\n    )\n\nfunc main() {\n\n    const dbIP = \"104.xxx.xx.x\"\n    const dbInstanceName =  \"esp-1-dev:us-central1:espdev\"\n    const dbName = \"servpro\"\n    const dbUserName = \"root\"\n    const dbPassword = \"xxxxxxx\"\n\n    const dbOpenString = dbUserName + \":\" + dbPassword + \"@/\" + dbInstanceName + \"/\" + dbName  //GETS RESPONSE default addr for network 'AppEngine:Zone:Project' unknown\n    //const dbOpenString = dbUserName + \"@cloudsql(\" + dbInstanceName + \")/\" + dbName   //GETS RESPONSE  dial cloudsql: unknown network cloudsql\n    //const dbOpenString = dbUserName + \"@/\"  //+ \"?parseTime=true&amp;loc=UTC\"                 //GETS RESPONSE  getsockopt: connection refused\n    //const dbOpenString = dbUserName + \":\" + dbPassword + \"@tcp(\" + dbIP + \":3306)/\" + dbName  //GETS RESPONSE  dial tcp 104.xxx.xxx.x:3306: getsockopt: connection timed out\n\n    //  Got this from stack overflow.  GoDocs are not updated to reflect 2nd Gen databases.\n    //  http://stackoverflow.com/questions/38890022/tls-requested-but-server-does-not-support-tls-error-with-google-cloud-sql-2nd\n    //user:password@cloudsql(copiedPastedInstanceConnectionName)/d\u200c\u200batabaseName?charset=\u200c\u200bcharset&amp;collation=co\u200c\u200bllation&amp;tls=tlsConfi\u200c\u200bgName&amp;parseTime=true\n    //First Generation Connection String    \n        //username:password@cloudsql(appID:CloudSQLInstance)/databasename?parseTime=true&amp;loc=UTC\n\n    db, err := sql.Open(\"mysql\", dbOpenString);\n    defer db.Close()\n\n    log.Println(\"Attempting Ping of database....\")\n\n    err = db.Ping()\n\n    if err != nil {\n        log.Println(\"db.Ping() failed:  \" + dbOpenString)\n        log.Println(err)\n    } else {\n        log.Println(\"Success!\")\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1480726306, "post_id": 40943065, "comment_id": 69097515, "body": "&quot;The GOMAXPROCS variable limits the number of operating system threads that can execute user-level Go code simultaneously. There is no limit to the number of threads that can be blocked in system calls on behalf of Go code; those do not count against the GOMAXPROCS limit. This package&#39;s GOMAXPROCS function queries and changes the limit.&quot; from runtime docs. Writing a bit more in an answer."}], "answers": [{"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": false, "score": 4, "last_activity_date": 1480726825, "creation_date": 1480726825, "answer_id": 40943160, "question_id": 40943065, "link": "https://stackoverflow.com/questions/40943065/golang-why-runtime-gomaxprocs-is-limited-to-256/40943160#40943160", "title": "Golang: why runtime.GOMAXPROCS is limited to 256?", "body": "<p>The <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">package <code>runtime</code> docs</a> clarify how GOMAXPROCS relates to OS threads:</p>\n\n<blockquote>\n  <p>The GOMAXPROCS variable limits the number of operating system threads that can execute user-level Go code simultaneously. There is no limit to the number of threads that can be blocked in system calls on behalf of Go code; those do not count against the GOMAXPROCS limit. This package's GOMAXPROCS function queries and changes the limit.</p>\n</blockquote>\n\n<p>So you could see more than GOMAXPROCS OS threads (because some are blocked in system calls, and there's no limit to how many), or fewer (because GOMAXPROCS is only documented to <em>limit</em> the number of threads, not prescribe it exactly).</p>\n\n<p>I think capping GOMAXPROCS is consistent with the spirit of that documentation--you specified you were OK with 1000 OS threads running Go code, but the runtime decided to 'only' run 256. That doesn't limit the number of <em>goroutines</em> active because they're multiplexed onto OS threads--when one goroutine blocks (waiting for a network read to complete, say) Go's internal scheduler starts other work on the same OS thread. </p>\n\n<p>The Go team might have made this choice to minimize the chance that Go programs end up running many times more OS threads than most machines today have cores; that would cause more OS context switches, which can be slower than user-mode goroutine switches that would occur if GOMAXPROCS were kept down to the number of CPU cores present. Or it might just have been convenient for the design Go's internal scheduler to have an upper bound on GOMAXPROCS.</p>\n\n<p><a href=\"http://tleyden.github.io/blog/2014/10/30/goroutines-vs-threads/\" rel=\"nofollow noreferrer\">Goroutines vs Threads</a> is not perfect, e.g. goroutines don't have segmented stacks now, but it may help you understand what's going on here under the hood.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1506633052, "creation_date": 1506633052, "answer_id": 46478375, "question_id": 40943065, "link": "https://stackoverflow.com/questions/40943065/golang-why-runtime-gomaxprocs-is-limited-to-256/46478375#46478375", "title": "Golang: why runtime.GOMAXPROCS is limited to 256?", "body": "<p>Note that, starting the next Go 1.10 (Q1 2018), <code>GOMAXPROCS</code> will be limited by ... nothing.</p>\n\n<blockquote>\n  <p>The runtime no longer artificially limits <code>GOMAXPROCS</code> (previously it was limited to 1024).</p>\n</blockquote>\n\n<p>See <a href=\"https://github.com/golang/go/commit/ee55000f6c45d2f5c38d91679def933fdf27c029\" rel=\"nofollow noreferrer\">commit ee55000</a> by <a href=\"https://github.com/aclements\" rel=\"nofollow noreferrer\">Austin Clements (<code>aclements</code>)</a>, which fixes <a href=\"https://github.com/golang/go/issues/15131\" rel=\"nofollow noreferrer\">issue 15131</a>.</p>\n\n<blockquote>\n  <p>Now that <code>allp</code> is dynamically allocated, there's no need for a hard cap\n  on <code>GOMAXPROCS</code>.</p>\n</blockquote>\n\n<hr>\n\n<p><a href=\"https://github.com/golang/go/blob/a714470cce03b28321a9dbcdbf34a99ab59deb75/src/runtime/runtime2.go#L716-L720\" rel=\"nofollow noreferrer\"><code>allp</code> is defined here</a>.</p>\n\n<p>See also <a href=\"https://github.com/golang/go/commit/e900e275e8667fde18973cdebe94861353162b87\" rel=\"nofollow noreferrer\">commit e900e27</a>:</p>\n\n<blockquote>\n  <h2><code>runtime</code>: clean up loops over <code>allp</code></h2>\n  \n  <p><code>allp</code> now has length <code>gomaxprocs</code>, which means none of <code>allp[i]</code> are nil or in state <code>_Pdead</code>.<br>\n  This lets replace several different styles of loops over allp with normal range loops.</p>\n  \n  <p><code>for i := 0; i &lt; gomaxprocs; i++ { ... }</code> loops can simply range over\n  <code>allp</code>.<br>\n  Likewise, <code>range loops over allp[:gomaxprocs]</code> can just range over\n  <code>allp</code>.</p>\n  \n  <p>Loops that check for <code>p == nil || p.state == _Pdead</code> don't need to check\n  this any more.</p>\n  \n  <p>Loops that check for <code>p == nil</code> don't have to check this <em>if</em> dead Ps\n  don't affect them. I checked that all such loops are, in fact,\n  unaffected by dead Ps. One loop was potentially affected, which this\n  fixes by zeroing <code>p.gcAssistTime</code> in <code>procresize</code>.</p>\n</blockquote>\n"}], "owner": {"reputation": 789, "user_id": 1775669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0921d56a00fe6e510240426b132dc0?s=128&d=identicon&r=PG", "display_name": "andreycpp", "link": "https://stackoverflow.com/users/1775669/andreycpp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2167, "favorite_count": 4, "accepted_answer_id": 46478375, "answer_count": 2, "score": 3, "last_activity_date": 1506633052, "creation_date": 1480725989, "last_edit_date": 1480730004, "question_id": 40943065, "link": "https://stackoverflow.com/questions/40943065/golang-why-runtime-gomaxprocs-is-limited-to-256", "title": "Golang: why runtime.GOMAXPROCS is limited to 256?", "body": "<p>I was playing with golang 1.7.3 on MacBook and Ubuntu and found that runtime.GOMAXPROCS is limited to 256. Does anyone know where this limit comes from? Is this documented anywhere and why would there be a limit? Is this an implementation optimization?</p>\n\n<p>Only reference to 256 I could find is on this page that describes golang's runtime package: <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/runtime/</a>. The runtime.MemStats struct has a couple of stat arrays of size 256:</p>\n\n<pre><code>type MemStats struct {\n    ...\n    PauseNs       [256]uint64 // circular buffer of recent GC pause durations, most recent at [(NumGC+255)%256]\n    PauseEnd      [256]uint64 // circular buffer of recent GC pause end times\n</code></pre>\n\n<p>Here's example golang code I used:</p>\n\n<pre><code>func main() {\n    runtime.GOMAXPROCS(1000)\nlog.Printf(\"GOMAXPROCS %d\\n\", runtime.GOMAXPROCS(-1))\n</code></pre>\n\n<p>}</p>\n\n<p>Prints\n    GOMAXPROCS 256</p>\n\n<p>P.S. \nAlso, can someone point me to documentation on how this GOMAXPROCS relate to OS thread count used by golang scheduler (if at all). Shall we observe go-compiled code running GOMAXPROCS OS threads?</p>\n\n<p><strong>EDIT:</strong> Thanks @twotwotwo for pointing out how GOMAXPROCS relate to OS threads. Still it's interesting that documentation does not mention this 256 limit (other that in the MemStats struct which may or may not be related).</p>\n\n<p>I wonder if anyone is aware of the true reason for this 256 number.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": true, "score": 5, "last_activity_date": 1480724154, "creation_date": 1480724154, "answer_id": 40942815, "question_id": 40942784, "link": "https://stackoverflow.com/questions/40942784/in-go-is-this-line-creating-a-new-empty-map-with-string-as-key-and-value/40942815#40942815", "title": "In go, is this line creating a new empty map with string as key and value?", "body": "<p>No, that's creating an empty string slice.</p>\n\n<p>This is an empty map with string as key and value:</p>\n\n<pre><code>keys := map[string]string{}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "is_accepted": false, "score": 2, "last_activity_date": 1480725748, "last_edit_date": 1480725748, "creation_date": 1480725385, "answer_id": 40942980, "question_id": 40942784, "link": "https://stackoverflow.com/questions/40942784/in-go-is-this-line-creating-a-new-empty-map-with-string-as-key-and-value/40942980#40942980", "title": "In go, is this line creating a new empty map with string as key and value?", "body": "<p>If you don't know what is the type, you can always check using <a href=\"https://golang.org/pkg/reflect/#TypeOf\" rel=\"nofollow noreferrer\">reflect</a> package:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n     keys := []string{}\n     fmt.Println(reflect.TypeOf(keys))\n     fmt.Println(reflect.TypeOf(keys).Elem())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[]string\nstring\n</code></pre>\n\n<p>Which means an empty slice of string. </p>\n\n<p>Another eg to check the types inside the slice:</p>\n\n<pre><code>keys := []string{}\nanotherKeys := []map[string]string{}\n\nfmt.Println(\"keys: \", reflect.TypeOf(keys).Elem())\nfmt.Println(\"anotherKeys: \", reflect.TypeOf(anotherKeys).Elem())\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>keys: string\nanotherKeys: map[string]string\n</code></pre>\n\n<p>NB:\n<a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\">Elem()</a></p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "is_accepted": false, "score": 0, "last_activity_date": 1480731570, "creation_date": 1480731570, "answer_id": 40943592, "question_id": 40942784, "link": "https://stackoverflow.com/questions/40942784/in-go-is-this-line-creating-a-new-empty-map-with-string-as-key-and-value/40943592#40943592", "title": "In go, is this line creating a new empty map with string as key and value?", "body": "<p>No, <code>[]string</code> is a slice of strings.</p>\n\n<p>If you want an empty map with strings as the type for both keys and values, then <code>map[string]string</code> would be the correct type. <a href=\"https://play.golang.org/p/mukBMTGc2Y\" rel=\"nofollow noreferrer\">Try the following example code in the Playground</a> to see it for yourself:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc printKind(i interface{}) {\n    fmt.Printf(\"Kind of %#v: %s\\n\", i, reflect.TypeOf(i).Kind())\n}\n\nfunc main() {\n    emptySlice := []string{}\n    printKind(emptySlice)\n\n    emptyMap := map[string]string{}\n    printKind(emptyMap)\n}\n</code></pre>\n"}], "owner": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1874, "favorite_count": 0, "accepted_answer_id": 40942815, "answer_count": 3, "score": -2, "last_activity_date": 1480731570, "creation_date": 1480723828, "question_id": 40942784, "link": "https://stackoverflow.com/questions/40942784/in-go-is-this-line-creating-a-new-empty-map-with-string-as-key-and-value", "title": "In go, is this line creating a new empty map with string as key and value?", "body": "<pre><code>keys := []string{}\n</code></pre>\n\n<p>In go, is this line creating a new empty map with string as key and value?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2300, "user_id": 811922, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2adbe7f77f554b38362fd8969e22d5a9?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/811922/ram"}, "is_accepted": true, "score": 2, "last_activity_date": 1480718504, "creation_date": 1480718504, "answer_id": 40941963, "question_id": 40941918, "link": "https://stackoverflow.com/questions/40941918/golang-runtime-error-when-getting-file-absolute-path/40941963#40941963", "title": "Golang runtime error when getting file absolute path", "body": "<p>According to <a href=\"https://golang.org/pkg/path/filepath/#Abs\" rel=\"nofollow noreferrer\">documentation</a>, <code>Abs</code> function will return TWO values, one string and one error.</p>\n\n<p>So you can not have something like:</p>\n\n<pre><code>absolute_path := string(filepath.Abs(header.Filename))\n</code></pre>\n\n<p>instead, you should write:</p>\n\n<pre><code>absolute_path, err := filepath.Abs(header.Filename)\n</code></pre>\n\n<p>Also note that absolute_path is a string already.</p>\n"}, {"tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": false, "score": 2, "last_activity_date": 1480718550, "creation_date": 1480718550, "answer_id": 40941967, "question_id": 40941918, "link": "https://stackoverflow.com/questions/40941918/golang-runtime-error-when-getting-file-absolute-path/40941967#40941967", "title": "Golang runtime error when getting file absolute path", "body": "<p>The compiler error from this line of code (multiple-value filepath.Abs() in single-value context)</p>\n\n<pre><code> absolue_path := string(filepath.Abs(header.Filename))\n</code></pre>\n\n<p>is telling you that <code>filepath.Abs</code> is returning multiple arguments and <code>string</code> only takes one argument.</p>\n\n<p><code>filepath.Abs</code> returns a <code>string</code> and <code>error</code></p>\n\n<p>Code should be:</p>\n\n<pre><code>ap, err := filepath.Abs(header.Filename)\nif err != nil {\n    // handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 5066776, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7f159b2bc674852c4578481c27530f44?s=128&d=identicon&r=PG&f=1", "display_name": "Pablo prez", "link": "https://stackoverflow.com/users/5066776/pablo-prez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 866, "favorite_count": 0, "accepted_answer_id": 40941963, "answer_count": 2, "score": 0, "last_activity_date": 1480718550, "creation_date": 1480718190, "question_id": 40941918, "link": "https://stackoverflow.com/questions/40941918/golang-runtime-error-when-getting-file-absolute-path", "title": "Golang runtime error when getting file absolute path", "body": "<p>I am almost done with an issue that has stomped me as I am new to Golang, I am basically trying to get the absolute path of a file inside the <strong>os.open</strong> method. I have been trying all types of things but nothing works</p>\n\n<pre><code>  func UploadProfile(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm()\n    infile, header, err := r.FormFile(\"upload_file\")\n    if err != nil {\n        http.Error(w, \"Error parsing uploaded file: \"+err.Error(), http.StatusBadRequest)\n        return\n    }\n    defer infile.Close()\n\n\n       absolue_path := string(filepath.Abs(header.Filename))\n                  // I want to get the absolute path in os.Open\n    file, err :=  os.Open(absolute_path)\n    }\n</code></pre>\n\n<p>for instance if I hard code the string in the os.Open like\n<strong>/Users/Documents/pictures/cats.jpg</strong> then the file uploads successfully . When i try to get the absolute path and put it inside the os.Open I get this error on runtime <strong>multiple-value filepath.Abs() in single-value context</strong> . Is there any other way that I can get the path of the file so that I can put it inside that method ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": true, "score": 10, "last_activity_date": 1480717077, "creation_date": 1480717077, "answer_id": 40941705, "question_id": 40941627, "link": "https://stackoverflow.com/questions/40941627/in-go-dont-we-need-to-import-another-file-in-same-directory-if-we-want-to-use/40941705#40941705", "title": "in go, don&#39;t we need to import another file in same directory if we want to use function defined in that file?", "body": "<p>No. Just call a function. Please note:</p>\n\n<ul>\n<li>You are not including files in Go, you include packages. </li>\n<li>These files should share the package.</li>\n</ul>\n\n<p>Check this: <a href=\"https://blog.golang.org/organizing-go-code\" rel=\"noreferrer\">https://blog.golang.org/organizing-go-code</a></p>\n\n<p>And google is full of good info as well, ex. <a href=\"http://thenewstack.io/understanding-golang-packages/\" rel=\"noreferrer\">http://thenewstack.io/understanding-golang-packages/</a></p>\n"}, {"tags": [], "owner": {"reputation": 365, "user_id": 2130607, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6423be6ad9f861ddba9f1f1016cf2b4?s=128&d=identicon&r=PG", "display_name": "Kebeng", "link": "https://stackoverflow.com/users/2130607/kebeng"}, "is_accepted": false, "score": 4, "last_activity_date": 1575545433, "last_edit_date": 1575545433, "creation_date": 1480749094, "answer_id": 40945237, "question_id": 40941627, "link": "https://stackoverflow.com/questions/40941627/in-go-dont-we-need-to-import-another-file-in-same-directory-if-we-want-to-use/40945237#40945237", "title": "in go, don&#39;t we need to import another file in same directory if we want to use function defined in that file?", "body": "<p>No you don't need to import those files.\nGo treat all <code>.go</code>  file in one directory as one package  and directory under it as another package.\nyou can learn more from <a href=\"https://talks.golang.org/2014/organizeio.slide#1\" rel=\"nofollow noreferrer\">https://talks.golang.org/2014/organizeio.slide#1</a></p>\n\n<p>So you only need to import if you want to use another function that locate inside files in other directory.</p>\n\n<p>for example we have 2 files inside one <code>fruit</code> directory</p>\n\n<p>apple.go</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>package fruit\nimport(fmt)\n\nfunc ExportedMethod() {\n    fmt.Print(\"apple\")\n}\n\nfunc privateMethod() {}\n</code></pre>\n\n<p>banana.go</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>package fruit\nimport(fmt)\n\nfunc banana() {\n    fmt.Print(\"banana\")\n    ExportedMethod()\n    pivateMethod()\n}\n</code></pre>\n\n<p>those two files is treated as one package in Go and you can call method from another file even the method is unexported (using lowercase at first character)\nyou can learn more about exported and unexported here <a href=\"https://www.goinggo.net/2014/03/exportedunexported-identifiers-in-go.html\" rel=\"nofollow noreferrer\">https://www.goinggo.net/2014/03/exportedunexported-identifiers-in-go.html</a></p>\n\n<p>but <code>banana.go</code> need to import <code>fmt</code> package even thought <code>apple.go</code> is already import the <code>fmt</code> package because dependencies in package must be listed specific on each file that uses it.</p>\n"}, {"tags": [], "owner": {"reputation": 125, "user_id": 12107690, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAmNqN1LFfhuYcg8Pq2omVb8jHGrIWYPldxxTSC=k-s128", "display_name": "Ajay Thakur", "link": "https://stackoverflow.com/users/12107690/ajay-thakur"}, "is_accepted": false, "score": 1, "last_activity_date": 1575544719, "last_edit_date": 1575544719, "creation_date": 1575540298, "answer_id": 59192619, "question_id": 40941627, "link": "https://stackoverflow.com/questions/40941627/in-go-dont-we-need-to-import-another-file-in-same-directory-if-we-want-to-use/59192619#59192619", "title": "in go, don&#39;t we need to import another file in same directory if we want to use function defined in that file?", "body": "<p>No you don't have to import pakages just call your method. </p>\n\n<pre><code>    package test \n\n    import \"fmt\"\n\n    func main() {\n      foo()\n    }\n</code></pre>\n"}], "owner": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13354, "favorite_count": 1, "accepted_answer_id": 40941705, "answer_count": 3, "score": 8, "last_activity_date": 1575545433, "creation_date": 1480716690, "question_id": 40941627, "link": "https://stackoverflow.com/questions/40941627/in-go-dont-we-need-to-import-another-file-in-same-directory-if-we-want-to-use", "title": "in go, don&#39;t we need to import another file in same directory if we want to use function defined in that file?", "body": "<p>in go, don't we need to import another file in same directory if we want to use function defined in that file?\nFor example.</p>\n\n<pre><code>FolderA-\n-------- FileA.go\n---------FileB.go\n</code></pre>\n\n<p>In FileB.go, I define method Foo()</p>\n\n<p>In FileA.go, I want to call Foo() which defined in FileB.go.</p>\n\n<p>Do I need to import FileB in FileA.go like this?</p>\n\n<pre><code>import (\"FileB\")\n</code></pre>\n"}, {"tags": ["datetime", "go"], "answers": [{"comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1480707031, "post_id": 40939364, "comment_id": 69090712, "body": "Another &#39;main change&#39; would be swapping the <code>date</code> and <code>layout</code> arguments to <code>time.Parse</code>"}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 7, "last_activity_date": 1480707102, "last_edit_date": 1480707102, "creation_date": 1480705837, "answer_id": 40939364, "question_id": 40939261, "link": "https://stackoverflow.com/questions/40939261/golang-parse-strange-date-format/40939364#40939364", "title": "Golang parse strange date format", "body": "<p>Golang handle all date formatting in a unique way - it uses the reference time <code>Mon Jan 2 15:04:05 MST 2006</code> (01/02 03:04:05PM '06 -0700) to show the pattern with which to format/parse a given time/string.</p>\n\n<p>So, to read the format \"Wed Nov 23 23:26:10 2016\" you would put the reference date into that format:  \"Mon Jan 2 15:04:05 2006\", and then do:</p>\n\n<pre><code>t, _ := time.Parse(\"Mon Jan 2 15:04:05 2006\", \"Wed Nov 23 23:26:10 2016\")\n</code></pre>\n\n<p>Then, to output it in the given format, if you wanted the format <code>DD-MM-YYYY hh:mm:ss</code>, you would put the reference time into that format: <code>02-01-2006 15:04:05</code>, and then do:</p>\n\n<pre><code>t.Format(\"02-01-2006 15:04:05\")\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VO5413Z7-z\" rel=\"noreferrer\">https://play.golang.org/p/VO5413Z7-z</a></p>\n\n<p>So basically, the main change is</p>\n\n<pre><code>// Format mask for output\nlayout := \"DD-MM-YYYY hh:mm:ss\"\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>// Format mask for output\nlayout := \"02-01-2006 15:04:05\"\n</code></pre>\n\n<p>and</p>\n\n<pre><code>time.Parse(date, layout)\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>time.Parse(layout, date)\n</code></pre>\n"}], "owner": {"reputation": 3404, "user_id": 1020154, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/447741a9824ab4e51e71522d0549baf8?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/1020154/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6316, "favorite_count": 1, "accepted_answer_id": 40939364, "answer_count": 1, "score": 1, "last_activity_date": 1480707214, "creation_date": 1480705377, "last_edit_date": 1480707214, "question_id": 40939261, "link": "https://stackoverflow.com/questions/40939261/golang-parse-strange-date-format", "title": "Golang parse strange date format", "body": "<p>I'm working on a Parser which Parses log files from a game so I can do analysis on auctions made within the game, however the date format that's being written by the logger seems to be causing problems as the format seems to be custom written for the logger, an example datetime stamp looks like: <code>[Wed Nov 23 23:26:10 2016]</code> I try to Parse it with:</p>\n\n<pre><code>func (r *AuctionReader) extractSaleInformation(line string) {\n    fmt.Println(\"Extracting information from: \", line)\n\n    // Format mask for output\n    layout := \"DD-MM-YYYY hh:mm:ss\"\n\n    // Replace the square brackets so we're just left with the date-time string\n    date := strings.TrimSpace(strings.Replace((strings.Split(line, \"]\")[0]), \"[\", \"\", -1))\n\n    fmt.Println(time.Parse(date, layout))\n}\n</code></pre>\n\n<p>When I attempt to Parse the above date-time string I get the following error:</p>\n\n<blockquote>\n  <p>0001-01-01 00:00:00 +0000 UTC parsing time \"DD-MM-YYYY hh:mm:ss\" as \"Wed Nov 23 23:26:10 2016\": cannot parse \"DD-MM-YYYY hh:mm:ss\" as \"Wed Nov \"</p>\n</blockquote>\n\n<p>How am I able to get the parser to recognise this seemingly custom format, I will be saving this data to Mongo so I don't want to store the auction time as a string as I want to query the timestamps individually.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 9, "last_activity_date": 1480700480, "last_edit_date": 1480700480, "creation_date": 1480700367, "answer_id": 40938019, "question_id": 40937992, "link": "https://stackoverflow.com/questions/40937992/passing-go-embedded-struct-to-function/40938019#40938019", "title": "Passing go embedded struct to function", "body": "<p>Anonymous fields can be addressed by the name of the embedded type:</p>\n\n<pre><code>type Foo struct{}\n\ntype Bar struct {\n    *Foo\n}\n\nbar := Bar{&amp;Foo{}}\n\nfunc(f *Foo) {}(bar.Foo)\n</code></pre>\n\n<p>See the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"noreferrer\">Struct Types</a> section in the language spec.</p>\n"}], "owner": {"reputation": 357, "user_id": 7158113, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d4c730174f40b2631cddb8a67384afd1?s=128&d=identicon&r=PG&f=1", "display_name": "flooblebit", "link": "https://stackoverflow.com/users/7158113/flooblebit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1238, "favorite_count": 1, "accepted_answer_id": 40938019, "answer_count": 1, "score": 5, "last_activity_date": 1480700480, "creation_date": 1480700264, "last_edit_date": 1480700401, "question_id": 40937992, "link": "https://stackoverflow.com/questions/40937992/passing-go-embedded-struct-to-function", "title": "Passing go embedded struct to function", "body": "<p>I have something like this:</p>\n\n<pre><code>type Foo struct{}\nfunc NewFoo() *Foo { ... }\n\ntype Bar struct {\n    *Foo\n}\n</code></pre>\n\n<p>How can I pass an instance of Bar to a function that takes *Foo?</p>\n\n<pre><code>func DoStuff(f *Foo) {}\n\nfunc main() {\n    bar := Bar{NewFoo()}\n    DoStuff(bar) // &lt;- go doesn't like this, type mismatch\n}\n</code></pre>\n\n<p>Is it possible to get the embedded structure and pass it to the function?</p>\n\n<p>The only way I can get this to work is if I treated *Foo as a member of the structure and passed it as <code>bar.foo</code>. But this is kind of messy, is that the only way?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "edited": false, "score": 0, "creation_date": 1480694233, "post_id": 40936156, "comment_id": 69083685, "body": "Have you had a look at <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\"><code>sync</code></a>? It has primitives for waiting for a thread to terminate (although as I understand it this isn&#39;t the preferred way to work in Golang)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1781434"}, "reply_to_user": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "edited": false, "score": 0, "creation_date": 1480694300, "post_id": 40936156, "comment_id": 69083732, "body": "No I haven&#39;t. But anyway, I&#39;m asking a <i>why</i> question rather than <i>how</i>."}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "edited": false, "score": 0, "creation_date": 1480698503, "post_id": 40936156, "comment_id": 69086476, "body": "That would make your question moot if there is a way to do it, though."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1781434"}, "reply_to_user": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "edited": false, "score": 1, "creation_date": 1480700461, "post_id": 40936156, "comment_id": 69087486, "body": "Well, I was looking for an explanation like the one I did get and accepted as an answer. Honestly, the statement that the question would be moot seems reasonable on the surface, but there is a mismatch between a) You can fire goroutines out-of-the-box (without referencing any library at all), and b) You cannot wait/join a goroutine without referencing a library/package. The mismatch is because this is really a fundamental operation w.r.t. concurrent programs -- and you cannot do it without <i>&quot;some kind of hack!&quot;</i>"}, {"owner": {"reputation": 13379, "user_id": 1033027, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/b56ea1c43a4ecb1060ec8bcb8d2bce78?s=128&d=identicon&r=PG", "display_name": "Jules", "link": "https://stackoverflow.com/users/1033027/jules"}, "edited": false, "score": 1, "creation_date": 1480700991, "post_id": 40936156, "comment_id": 69087744, "body": "That&#39;s reasonable."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1781434"}, "edited": false, "score": 1, "creation_date": 1480694808, "post_id": 40936344, "comment_id": 69084071, "body": "Thank you for this. I&#39;ll accept this as an answer. (Can&#39;t believe I got down-voted 6 times by people who probably don&#39;t even know this.)"}, {"owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "edited": false, "score": 0, "creation_date": 1480695178, "post_id": 40936344, "comment_id": 69084338, "body": "This is in my opinion a perfectly acceptable and legitimate question that highlights a fundamental aspect of the language :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1480699145, "post_id": 40936344, "comment_id": 69086761, "body": "I would say that it has nothing really to do with goroutines not being threads, it&#39;s rooted in the fact that it was a design choice to make goroutines not identifiable or addressable. The runtime could theoretically provide a join, since it can can determine when a goroutine has returned, but you can&#39;t &quot;join&quot; something you can&#39;t get a reference to."}], "tags": [], "owner": {"reputation": 36166, "user_id": 393701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250889c646cd2a916920d9252f7c6f42?s=128&d=identicon&r=PG", "display_name": "SirDarius", "link": "https://stackoverflow.com/users/393701/sirdarius"}, "is_accepted": true, "score": 3, "last_activity_date": 1480694874, "last_edit_date": 1480694874, "creation_date": 1480694612, "answer_id": 40936344, "question_id": 40936156, "link": "https://stackoverflow.com/questions/40936156/why-is-there-no-join-operation-on-goroutines/40936344#40936344", "title": "Why is there no `.join` operation on goroutines?", "body": "<p>This is simply because <strong>goroutines are not threads</strong>. A given goroutine can be scheduled by the Go runtime to be associated to an Operating System thread, but for example in the case of blocking I/O operations, said threads can be associated to other goroutines while the other one is waiting.</p>\n\n<p>What does this mean?</p>\n\n<p>Joining needs a synchronization object in order to know when a thread is finished. As Go's goroutines are actually just very lightweight objects that only possess a stack, they do not provide such synchronization objects directly.</p>\n\n<p>Go's CSP premise is that you can instanciate thousands of goroutines very cheaply, and only use as many threads as you have physical CPU cores.\nIn the perspective of the OS, synchronization objects are expensive, therefore having such objects for each goroutine would be very inefficient.</p>\n\n<p>Instead, synchronization is attained by using channels or WaitGroup's from the sync package.</p>\n"}, {"tags": [], "owner": {"reputation": 2537, "user_id": 1720829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/e2DBe.png?s=128&g=1", "display_name": "Nathan F.", "link": "https://stackoverflow.com/users/1720829/nathan-f"}, "is_accepted": false, "score": 0, "last_activity_date": 1594398887, "creation_date": 1594398887, "answer_id": 62838670, "question_id": 40936156, "link": "https://stackoverflow.com/questions/40936156/why-is-there-no-join-operation-on-goroutines/62838670#62838670", "title": "Why is there no `.join` operation on goroutines?", "body": "<p>Following up on <a href=\"https://stackoverflow.com/a/40936344/1720829\">@SirDius' detailed explanation</a></p>\n<p>Here is a simple example demonstrating how to do this with a <code>sync.Mutex</code>. I chose a <code>sync.Mutex</code> over a <code>sync.WaitGroup</code> here since I only intended for each <code>Thread</code> object to wrap a single goroutine, and WaitGroups are intended to be used with multiple goroutines.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type Thread struct {\n    body func()\n    mux sync.Mutex\n}\n\nfunc NewThread(body func ()) *Thread {\n    return &amp;Thread{\n        body: body,\n    }\n}\n\nfunc (thread *Thread) Start() {\n    thread.mux.Lock()\n    go thread.run()\n}\n\nfunc (thread *Thread) Join() {\n    thread.mux.Lock()\n    thread.mux.Unlock()\n}\n\nfunc (thread *Thread) run() {\n    thread.body()\n    thread.mux.Unlock()\n}\n</code></pre>\n<p>You could use it as follows</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    t := NewThread(t1)\n    t.Start()\n    t.Join()\n    print(&quot;Thread 1: Joined\\n&quot;)\n}\n\nfunc t1() {\n    print(&quot;Thread 1: Started\\n&quot;)\n    time.Sleep(5 * time.Second)\n    print(&quot;Thread 1: Completed\\n&quot;)\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1781434"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1008, "favorite_count": 2, "accepted_answer_id": 40936344, "answer_count": 2, "score": 2, "last_activity_date": 1594398887, "creation_date": 1480694034, "last_edit_date": 1480694384, "question_id": 40936156, "link": "https://stackoverflow.com/questions/40936156/why-is-there-no-join-operation-on-goroutines", "title": "Why is there no `.join` operation on goroutines?", "body": "<p>Why is there no <code>.join</code> operation (i.e., block until finished) operation on goroutines? Instead of having to use channels to communicate when to proceed in the main goroutine?</p>\n\n<p>It feels like I'm missing something fundamental about the theory around CSP.</p>\n\n<p><strong>EDIT:</strong>\nI'm asking \"<em>why</em> is it so\", not \"<em>how</em> do I accomplish this\".</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "edited": false, "score": 0, "creation_date": 1480690450, "post_id": 40934943, "comment_id": 69081140, "body": "Ah yes of course! So something like...<a href=\"https://play.golang.org/p/Yb0I7X7Z_5\" rel=\"nofollow noreferrer\">play.golang.org/p/Yb0I7X7Z_5</a> and whenever I read the value I make sure I check it?"}, {"owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "reply_to_user": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "edited": false, "score": 0, "creation_date": 1480691343, "post_id": 40934943, "comment_id": 69081755, "body": "@LeeArmstrong, yes - you get it into interface{} and then assert wether its a string or a <i>number</i>. Keep in mind that Go won&#39;t differentiate between ints and floats on receive, it will just give you float64 for everything. So you may also need to convert to int if required."}], "tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": true, "score": 2, "last_activity_date": 1480698726, "last_edit_date": 1480698726, "creation_date": 1480690222, "answer_id": 40934943, "question_id": 40934108, "link": "https://stackoverflow.com/questions/40934108/unmarshalling-json-to-certain-type-string-always/40934943#40934943", "title": "Unmarshalling JSON to certain type (string) always", "body": "<p>You can create a universal receiver, i.e. of interface type, and then do a type assertion:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype RawMessage struct {\n    UnknownType interface{} `json:\"unknown_type\"`\n}\n\nconst inputString = `{\"unknown_type\" : \"a\"}`\n\nconst inputFloat = `{\"unknown_type\" : 123}` // Note: Unmarshals into a float64 by default!!!\n\nfunc main() {\n\n    var n RawMessage\n    if err := json.Unmarshal([]byte(inputFloat), &amp;n); err != nil {\n        println(err.Error())\n    }\n\n    switch v := n.UnknownType.(type) {\n    case string:\n        fmt.Printf(\"Received a string: %v\", v)\n    case float64:\n        fmt.Printf(\"Received a number: %v\", v)\n    default:\n        fmt.Printf(\"Unknown type: %v\", v)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "edited": false, "score": 0, "creation_date": 1480703982, "post_id": 40935219, "comment_id": 69089268, "body": "This is no different to above and it doesn&#39;t save as a string"}], "tags": [], "owner": {"reputation": 261, "user_id": 1732600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sNkL2.jpg?s=128&g=1", "display_name": "Brij", "link": "https://stackoverflow.com/users/1732600/brij"}, "is_accepted": false, "score": -1, "last_activity_date": 1480691101, "creation_date": 1480691101, "answer_id": 40935219, "question_id": 40934108, "link": "https://stackoverflow.com/questions/40934108/unmarshalling-json-to-certain-type-string-always/40935219#40935219", "title": "Unmarshalling JSON to certain type (string) always", "body": "<p>Try this if it resolve this issue, make a generic interface as user input is not defined</p>\n\n<pre><code>interface{} `json:\",string\"`\n</code></pre>\n\n<p>package main</p>\n\n<pre><code>import \"fmt\"\nimport \"log\"\nimport \"encoding/json\"\n\nconst inputWorking = `\n[\"AAAAAA\", {\"testcode\" : \"Sss\"}, 66666666]\n`\n\nconst inputBroken = `\n[111111, {\"testcode\" : \"Sss\"}, 66666666]\n`\n\ntype RawMessage struct {\n    AlwaysString        interface{} `json:\",string\"`\n    ClientData    ClientData\n    ReceptionTime int\n}\n\ntype ClientData struct {\n    testcode string\n}\n\nfunc main() {\n\n    var n RawMessage\n    if err := json.Unmarshal([]byte(inputWorking), &amp;n); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%#v\\n\", n)\n\n    var o RawMessage\n    if err := json.Unmarshal([]byte(inputBroken), &amp;o); err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1085, "user_id": 3169138, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wSAPm.jpg?s=128&g=1", "display_name": "byrnedo", "link": "https://stackoverflow.com/users/3169138/byrnedo"}, "is_accepted": false, "score": 1, "last_activity_date": 1521104740, "last_edit_date": 1521104740, "creation_date": 1521104396, "answer_id": 49295103, "question_id": 40934108, "link": "https://stackoverflow.com/questions/40934108/unmarshalling-json-to-certain-type-string-always/49295103#49295103", "title": "Unmarshalling JSON to certain type (string) always", "body": "<p>I had the same problem and so far the best I found was to make a type from string with a custom unmarshaller:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strconv\"\n)\n\n// Stringish exists because api send back integers unquoted even if underlying type is string\ntype StringIsh string\n\nfunc (f *StringIsh) UnmarshalJSON(data []byte) error {\n\n    var receiver string\n    if len(data) == 0 {\n        return nil\n    }\n    if data[0] != '\"' {\n        quoted := strconv.Quote(string(data))\n        data = []byte(quoted)\n    }\n\n    if err := json.Unmarshal(data, &amp;receiver); err != nil {\n        return err\n    }\n    *f = StringIsh(receiver)\n    return nil\n\n}\n\ntype Test struct {\n    Foo StringIsh\n}\n\nfunc main() {\n    dest := &amp;Test{}\n    _ = json.Unmarshal([]byte(`{\"foo\": \"bar\"}`), &amp;dest)\n    fmt.Println(dest)\n\n    dest = &amp;Test{}\n    _ = json.Unmarshal([]byte(`{\"foo\": 123}`), &amp;dest)\n    fmt.Println(dest)\n}\n</code></pre>\n\n<p>Try it yourself at <a href=\"https://goplay.space/#i0OVs9tnule\" rel=\"nofollow noreferrer\">https://goplay.space/#i0OVs9tnule</a></p>\n"}], "owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 606, "favorite_count": 1, "accepted_answer_id": 40934943, "answer_count": 3, "score": 1, "last_activity_date": 1521104740, "creation_date": 1480687705, "last_edit_date": 1480689319, "question_id": 40934108, "link": "https://stackoverflow.com/questions/40934108/unmarshalling-json-to-certain-type-string-always", "title": "Unmarshalling JSON to certain type (string) always", "body": "<p>I have some JSON that can have either a number or a string as the first element.  I always want to be able to store this as a string value but instead I get a crash as it is reading it as quite rightly so a number type. </p>\n\n<p>I tried to force the unmarshalling as a string but this was not successful.</p>\n\n<pre><code>string `json:\",string\"`\n</code></pre>\n\n<p>I am following this <a href=\"http://eagain.net/articles/go-json-array-to-struct/\" rel=\"nofollow noreferrer\">guide</a> which seems to fit my data nicely.</p>\n\n<p>How can I always get this element at [0] to always read and save as a string?</p>\n\n<p>Code &amp; Playground below...</p>\n\n<p><a href=\"https://play.golang.org/p/KP4_1xPJiZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KP4_1xPJiZ</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"log\"\nimport \"encoding/json\"\n\nconst inputWorking = `\n[\"AAAAAA\", {\"testcode\" : \"Sss\"}, 66666666]\n`\n\nconst inputBroken = `\n[111111, {\"testcode\" : \"Sss\"}, 66666666]\n`\n\ntype RawMessage struct {\n    AlwaysString        string `json:\",string\"`\n    ClientData    ClientData\n    ReceptionTime int\n}\n\ntype ClientData struct {\n    testcode string\n}\n\nfunc main() {\n\n    var n RawMessage\n    if err := json.Unmarshal([]byte(inputWorking), &amp;n); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%#v\\n\", n)\n\n    var o RawMessage\n    if err := json.Unmarshal([]byte(inputBroken), &amp;o); err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%#v\\n\", o)\n}\n\nfunc (n *RawMessage) UnmarshalJSON(buf []byte) error {\n    tmp := []interface{}{&amp;n.AlwaysString, &amp;n.ClientData, &amp;n.ReceptionTime}\n    wantLen := len(tmp)\n    if err := json.Unmarshal(buf, &amp;tmp); err != nil {\n        return err\n    }\n    if g, e := len(tmp), wantLen; g != e {\n        return fmt.Errorf(\"wrong number of fields in RawMessage: %d != %d\", g, e)\n    }\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "thread-safety"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1480684818, "post_id": 40931373, "comment_id": 69077302, "body": "Not sure I understand what you are trying to do, but the code you showed is totally broken: You <b>must</b> <b>not</b> copy a sync.Mutex. Use <code>*sync.Mutex</code> everywhere."}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1480685950, "post_id": 40931373, "comment_id": 69078031, "body": "thanks @Volker  , I edited (was pseudo code). so if I didn&#39;t have any constraint on my map of key -&gt; mutex I would not care, but what if I try to delete a key in that map and another thread is waiting on the mutex, is there a design pattern to do that effectively?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1480688525, "post_id": 40931373, "comment_id": 69079769, "body": "The line <code>delete(mutexes, key)</code> deletes something from a map. This is a write. All writes from different goroutines have to by synchronised to all other writes and reads to this map. It does not matter if the map entry is a sync.Mutex or an int. If the delete to the map is non-racy, then you can delete a mutex which is held by an other goroutine. I still have no real idea what you are trying to do."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1480688535, "post_id": 40931373, "comment_id": 69079780, "body": "Your map lookups for a particular key will race with operations on the mutex referenced by the key. Hence you might want to have another mutex which would guard accesses to the map. A goroutine dealing with a DB query would first lock the &quot;record&quot; mutex, then the map mutex, delete the map entry and unlock both mutexes. A goroutine which would want to know the result of a query would first lock the map&#39;s mutex and then to a lookup."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1480688730, "post_id": 40931373, "comment_id": 69079921, "body": "Still, I smell like having a dedicated goroutine listening on a channel for requests and mediating access to such map would be a better solution. See examples <a href=\"https://dave.cheney.net/2016/11/13/do-not-fear-first-class-functions\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 0, "creation_date": 1480689263, "post_id": 40931373, "comment_id": 69080311, "body": "@Thomas,   1. The idea to delete/GC a mutex, means that when deleting you&#39;ll need to check for a mutex state. Why would we want to delete a locked mutex on a state which is currently locked, right? However, from what I know, you cannot really check a mutex state.   2. What would be a benefit of having a global var with a map of mutexes as compared to using mutex lock/unlock inside cache.save() , i.e. linked to a context of specific operation? What are the expected benefits?"}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "reply_to_user": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 0, "creation_date": 1480689556, "post_id": 40931373, "comment_id": 69080517, "body": "@mpmlj 2. having the mutex before the call to database() saves the cost of calling the remote database more than once for hot keys. 1. yes that&#39;s why I ask :) I don&#39;t know how I could safely delete that key (haven&#39;t tried above suggestions yet)"}, {"owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "edited": false, "score": 0, "creation_date": 1480690782, "post_id": 40931373, "comment_id": 69081388, "body": "@Thomas, Well... I have an idea I don&#39;t really like, but can work. You can keep a state of a mutex in the same manner: in addition to mutexes[key]MutexObjHere you can have a separate map of states, mutex_states, and assign mutex_states[key] := struct{}{} on Lock, and delete(mutex_states, key) when you are doing mutexes[key].Unlock(). And then you can refer to this map to understand if you can delete a mutex during your GC pass. But frankly, I have a gut feeling there could be a cleaner and simpler solution on architectural level of your project."}], "answers": [{"comments": [{"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1524324884, "post_id": 49895067, "comment_id": 86930863, "body": "can you explain briefly how you achieve this?"}, {"owner": {"reputation": 471, "user_id": 1633004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52b4362c618a90c5601d79bf6c7e5502?s=128&d=identicon&r=PG", "display_name": "Eagle", "link": "https://stackoverflow.com/users/1633004/eagle"}, "reply_to_user": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1525082783, "post_id": 49895067, "comment_id": 87212877, "body": "1. Use a map A to store many &#39;locks&#39;. Say using &#39;user id&#39; as keys, <code>A[user-1] = true</code> means it&#39;s locked, <code>A[user-1] = false</code> or there is no key as <code>user-1</code> means the lock is released. In this way, each user doesn&#39;t affect others.  2. User a mutex to guard the map ( or just use sync.Map, the performance difference is related to the key access pattern ) to set some value to <code>true</code> (that is to lock) or to delete some key (that is to release the lock) @Thomas"}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1525093213, "post_id": 49895067, "comment_id": 87218700, "body": "And how do you achieve &quot;performance&quot; with the lock on one key not affecting other keys?"}, {"owner": {"reputation": 471, "user_id": 1633004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52b4362c618a90c5601d79bf6c7e5502?s=128&d=identicon&r=PG", "display_name": "Eagle", "link": "https://stackoverflow.com/users/1633004/eagle"}, "reply_to_user": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1525150806, "post_id": 49895067, "comment_id": 87240263, "body": "Say you want to do action A which is to change some DB records, it takes 2 seconds. If you use one &#39;lock&#39; for all users, then each user will affect others(because they need the same &#39;lock&#39;). If you use the &#39;map&#39; method I described above, when user B and user C both want to do action A, they just need to lock the same &#39;mutex&#39; to change the <code>map</code>(which is fast, say 0.1 seconds, and then the &#39;mutex&#39; is unlocked), and do action A at the same time. In this way, better performance is gained. @Thomas"}], "tags": [], "owner": {"reputation": 471, "user_id": 1633004, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52b4362c618a90c5601d79bf6c7e5502?s=128&d=identicon&r=PG", "display_name": "Eagle", "link": "https://stackoverflow.com/users/1633004/eagle"}, "is_accepted": false, "score": 2, "last_activity_date": 1524041015, "creation_date": 1524041015, "answer_id": 49895067, "question_id": 40931373, "link": "https://stackoverflow.com/questions/40931373/how-to-gc-a-map-of-mutexes-in-go/49895067#49895067", "title": "How to gc a map of mutexes in Go?", "body": "<p>I wrote a simple similar implementation: <a href=\"https://github.com/EagleChen/mapmutex\" rel=\"nofollow noreferrer\">mapmutex</a></p>\n\n<p>But instead of a map of mutexes, in this implementation, a mutex is used to guard the map and each item in the map is used like a 'lock'. The map itself is just simple ordinary map.</p>\n"}, {"comments": [{"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1593055834, "post_id": 62562831, "comment_id": 110647202, "body": "thanks but I&#39;m not sure to understand where you can limit the size of the map?"}, {"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "reply_to_user": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1593060087, "post_id": 62562831, "comment_id": 110648078, "body": "@Thomas map entires are only retained while a request is in progress, as soon as Unlock() is called, if that is the last one for the specified key, the entry is removed.  The map will always be as small as possible.  Does that answer it or do you actually need some separate limit? If so why?"}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "edited": false, "score": 0, "creation_date": 1593447944, "post_id": 62562831, "comment_id": 110778854, "body": "indeed that&#39;s the best approach"}, {"owner": {"reputation": 1261, "user_id": 469736, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/89f9a0a468b11d942e90e022722bebaf?s=128&d=identicon&r=PG", "display_name": "James Reategui", "link": "https://stackoverflow.com/users/469736/james-reategui"}, "edited": false, "score": 1, "creation_date": 1607465166, "post_id": 62562831, "comment_id": 115280505, "body": "Had a tremendous memory leak that was resolved by this approach - thx"}, {"owner": {"reputation": 121, "user_id": 4411057, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rsjna.jpg?s=128&g=1", "display_name": "Facundo Curti", "link": "https://stackoverflow.com/users/4411057/facundo-curti"}, "edited": false, "score": 0, "creation_date": 1613061021, "post_id": 62562831, "comment_id": 116965429, "body": "Can you explain to me plz why you make this asign? _ = m"}, {"owner": {"reputation": 121, "user_id": 4411057, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rsjna.jpg?s=128&g=1", "display_name": "Facundo Curti", "link": "https://stackoverflow.com/users/4411057/facundo-curti"}, "edited": false, "score": 0, "creation_date": 1613062081, "post_id": 62562831, "comment_id": 116965959, "body": "Is it because of the gorutines later? You make a call to the variable, so the compiler won&#39;t let the definition for later?"}], "tags": [], "owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "is_accepted": true, "score": 3, "last_activity_date": 1611351556, "last_edit_date": 1611351556, "creation_date": 1593027475, "answer_id": 62562831, "question_id": 40931373, "link": "https://stackoverflow.com/questions/40931373/how-to-gc-a-map-of-mutexes-in-go/62562831#62562831", "title": "How to gc a map of mutexes in Go?", "body": "<p>A map of mutexes is an efficient way to accomplish this, however the map itself must also be synchronized.  A reference count can be used to keep track of entries in concurrent use and remove them when no longer needed.  Here is a working map of mutexes complete with a test and benchmark.</p>\n<p>(UPDATE: This package provides similar functionality: <a href=\"https://pkg.go.dev/golang.org/x/sync/singleflight\" rel=\"nofollow noreferrer\">https://pkg.go.dev/golang.org/x/sync/singleflight</a> )</p>\n<p>mapofmu.go</p>\n<pre><code>// Package mapofmu provides locking per-key.\n// For example, you can acquire a lock for a specific user ID and all other requests for that user ID\n// will block until that entry is unlocked (effectively your work load will be run serially per-user ID),\n// and yet have work for separate user IDs happen concurrently.\npackage mapofmu\n\nimport (\n    &quot;fmt&quot;\n    &quot;sync&quot;\n)\n\n// M wraps a map of mutexes.  Each key locks separately.\ntype M struct {\n    ml sync.Mutex              // lock for entry map\n    ma map[interface{}]*mentry // entry map\n}\n\ntype mentry struct {\n    m   *M          // point back to M, so we can synchronize removing this mentry when cnt==0\n    el  sync.Mutex  // entry-specific lock\n    cnt int         // reference count\n    key interface{} // key in ma\n}\n\n// Unlocker provides an Unlock method to release the lock.\ntype Unlocker interface {\n    Unlock()\n}\n\n// New returns an initalized M.\nfunc New() *M {\n    return &amp;M{ma: make(map[interface{}]*mentry)}\n}\n\n// Lock acquires a lock corresponding to this key.\n// This method will never return nil and Unlock() must be called\n// to release the lock when done.\nfunc (m *M) Lock(key interface{}) Unlocker {\n\n    // read or create entry for this key atomically\n    m.ml.Lock()\n    e, ok := m.ma[key]\n    if !ok {\n        e = &amp;mentry{m: m, key: key}\n        m.ma[key] = e\n    }\n    e.cnt++ // ref count\n    m.ml.Unlock()\n\n    // acquire lock, will block here until e.cnt==1\n    e.el.Lock()\n\n    return e\n}\n\n// Unlock releases the lock for this entry.\nfunc (me *mentry) Unlock() {\n\n    m := me.m\n\n    // decrement and if needed remove entry atomically\n    m.ml.Lock()\n    e, ok := m.ma[me.key]\n    if !ok { // entry must exist\n        m.ml.Unlock()\n        panic(fmt.Errorf(&quot;Unlock requested for key=%v but no entry found&quot;, me.key))\n    }\n    e.cnt--        // ref count\n    if e.cnt &lt; 1 { // if it hits zero then we own it and remove from map\n        delete(m.ma, me.key)\n    }\n    m.ml.Unlock()\n\n    // now that map stuff is handled, we unlock and let\n    // anything else waiting on this key through\n    e.el.Unlock()\n\n}\n</code></pre>\n<p>mapofmu_test.go:</p>\n<pre><code>package mapofmu\n\nimport (\n    &quot;math/rand&quot;\n    &quot;strconv&quot;\n    &quot;strings&quot;\n    &quot;sync&quot;\n    &quot;testing&quot;\n    &quot;time&quot;\n)\n\nfunc TestM(t *testing.T) {\n\n    r := rand.New(rand.NewSource(42))\n\n    m := New()\n    _ = m\n\n    keyCount := 20\n    iCount := 10000\n    out := make(chan string, iCount*2)\n\n    // run a bunch of concurrent requests for various keys,\n    // the idea is to have a lot of lock contention\n    var wg sync.WaitGroup\n    wg.Add(iCount)\n    for i := 0; i &lt; iCount; i++ {\n        go func(rn int) {\n            defer wg.Done()\n            key := strconv.Itoa(rn)\n\n            // you can prove the test works by commenting the locking out and seeing it fail\n            l := m.Lock(key)\n            defer l.Unlock()\n\n            out &lt;- key + &quot; A&quot;\n            time.Sleep(time.Microsecond) // make 'em wait a mo'\n            out &lt;- key + &quot; B&quot;\n        }(r.Intn(keyCount))\n    }\n    wg.Wait()\n    close(out)\n\n    // verify the map is empty now\n    if l := len(m.ma); l != 0 {\n        t.Errorf(&quot;unexpected map length at test end: %v&quot;, l)\n    }\n\n    // confirm that the output always produced the correct sequence\n    outLists := make([][]string, keyCount)\n    for s := range out {\n        sParts := strings.Fields(s)\n        kn, err := strconv.Atoi(sParts[0])\n        if err != nil {\n            t.Fatal(err)\n        }\n        outLists[kn] = append(outLists[kn], sParts[1])\n    }\n    for kn := 0; kn &lt; keyCount; kn++ {\n        l := outLists[kn] // list of output for this particular key\n        for i := 0; i &lt; len(l); i += 2 {\n            if l[i] != &quot;A&quot; || l[i+1] != &quot;B&quot; {\n                t.Errorf(&quot;For key=%v and i=%v got unexpected values %v and %v&quot;, kn, i, l[i], l[i+1])\n                break\n            }\n        }\n    }\n    if t.Failed() {\n        t.Logf(&quot;Failed, outLists: %#v&quot;, outLists)\n    }\n\n}\n\nfunc BenchmarkM(b *testing.B) {\n\n    m := New()\n\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        // run uncontended lock/unlock - should be quite fast\n        m.Lock(i).Unlock()\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2605, "favorite_count": 2, "accepted_answer_id": 62562831, "answer_count": 2, "score": 5, "last_activity_date": 1611351556, "creation_date": 1480678763, "last_edit_date": 1495540906, "question_id": 40931373, "link": "https://stackoverflow.com/questions/40931373/how-to-gc-a-map-of-mutexes-in-go", "title": "How to gc a map of mutexes in Go?", "body": "<p>I am making a cache wrapper around a database. To account for possibly slow database calls, I was thinking of a mutex per key (pseudo Go code):</p>\n\n<pre><code>mutexes = map[string]*sync.Mutex // instance variable\n\nmutexes[key].Lock()\ndefer mutexes[key].Unlock()\n\nif value, ok := cache.find(key); ok {\n   return value\n}\nvalue = databaseCall(key)\ncache.save(key, value)\nreturn value\n</code></pre>\n\n<p>However I don't want my map to grow too much. <strong>My cache is an LRU</strong> and I want to have a fixed size for some other reasons not mentioned here. I would like to do something like</p>\n\n<pre><code>delete(mutexes, key)\n</code></pre>\n\n<p>when all the locks on the key are over but... that doesn't look <strong>thread safe</strong> to me... How should I do it?</p>\n\n<p>Note: I found this question\n<a href=\"https://stackoverflow.com/questions/40560007/in-go-can-we-synchronize-each-key-of-a-map-using-a-lock-per-key\">In Go, can we synchronize each key of a map using a lock per key?</a> but no answer</p>\n"}, {"tags": ["api", "go"], "comments": [{"owner": {"reputation": 4366, "user_id": 176478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a10b460f85d3d8b9702782bf6dd72307?s=128&d=identicon&r=PG", "display_name": "dmportella", "link": "https://stackoverflow.com/users/176478/dmportella"}, "edited": false, "score": 0, "creation_date": 1480674976, "post_id": 40930131, "comment_id": 69071127, "body": "please provide more specifics of what you are trying to do - code example etc"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1480676640, "creation_date": 1480676640, "answer_id": 40930727, "question_id": 40930131, "link": "https://stackoverflow.com/questions/40930131/retrieve-headers-http-data-from-client-go-language/40930727#40930727", "title": "Retrieve headers HTTP data from client Go Language", "body": "<p>According to the <a href=\"https://godoc.org/github.com/astaxie/beego/context#BeegoInput.Header\" rel=\"nofollow noreferrer\">docs</a>, you can do this:</p>\n\n<pre><code>log.Println(u.Ctx.Input.Header(\"X-My-Header\"))\n</code></pre>\n\n<p>All headers at once can be obtained from an <code>*http.Request</code>:</p>\n\n<pre><code>log.Println(u.Ctx.Request.Header)\n</code></pre>\n"}], "owner": {"reputation": 1462, "user_id": 4476788, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/100000129818719/picture?type=large", "display_name": "Muhamad Yulianto", "link": "https://stackoverflow.com/users/4476788/muhamad-yulianto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1139, "favorite_count": 0, "accepted_answer_id": 40930727, "answer_count": 1, "score": 3, "last_activity_date": 1480677151, "creation_date": 1480674917, "last_edit_date": 1480675875, "question_id": 40930131, "link": "https://stackoverflow.com/questions/40930131/retrieve-headers-http-data-from-client-go-language", "title": "Retrieve headers HTTP data from client Go Language", "body": "<p>How to retrieve headers data value from client <strong>API</strong> using Go language?</p>\n\n<p>I'm using beego framework (beego.me)</p>\n\n<p>and here is sample result to retrieve data from body</p>\n\n<pre><code>func (u *UserController) Post() {\n    var user models.User\n    json.Unmarshal(u.Ctx.Input.RequestBody, &amp;user)\n    uid := models.AddUser(user)\n    u.Data[\"json\"] = map[string]string{\"uid\": uid}\n    u.ServeJSON()\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "ssh"], "comments": [{"owner": {"reputation": 699, "user_id": 5215366, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AHxA6zWr1Ms/AAAAAAAAAAI/AAAAAAAACpA/LR6pkPJOeY4/photo.jpg?sz=128", "display_name": "Andrea Sessa", "link": "https://stackoverflow.com/users/5215366/andrea-sessa"}, "edited": false, "score": 1, "creation_date": 1480667947, "post_id": 40927577, "comment_id": 69066840, "body": "Can you post the file permissions on remote server ?"}, {"owner": {"reputation": 3232, "user_id": 342348, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d087287d971a900fb9772b65d6d93e2e?s=128&d=identicon&r=PG", "display_name": "coanor", "link": "https://stackoverflow.com/users/342348/coanor"}, "reply_to_user": {"reputation": 699, "user_id": 5215366, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AHxA6zWr1Ms/AAAAAAAAAAI/AAAAAAAACpA/LR6pkPJOeY4/photo.jpg?sz=128", "display_name": "Andrea Sessa", "link": "https://stackoverflow.com/users/5215366/andrea-sessa"}, "edited": false, "score": 0, "creation_date": 1480668774, "post_id": 40927577, "comment_id": 69067271, "body": "@AndreaSessa: I have chmod +x the file."}, {"owner": {"reputation": 708, "user_id": 4144758, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/cfea5e29717057a628f9363b652e5a9b?s=128&d=identicon&r=PG&f=1", "display_name": "Daniele D", "link": "https://stackoverflow.com/users/4144758/daniele-d"}, "edited": false, "score": 0, "creation_date": 1480673264, "post_id": 40927577, "comment_id": 69070022, "body": "Did you make sure to check case senitivity?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480681720, "post_id": 40927577, "comment_id": 69075306, "body": "It&#39;s probably <code>sh</code> that&#39;s not found. Use an absolute path. Notice the error is coming from bash, if the file is executable, just remove the <code>sh</code>"}, {"owner": {"reputation": 3232, "user_id": 342348, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d087287d971a900fb9772b65d6d93e2e?s=128&d=identicon&r=PG", "display_name": "coanor", "link": "https://stackoverflow.com/users/342348/coanor"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480682371, "post_id": 40927577, "comment_id": 69075768, "body": "@JimB: Whether the file is executable or not is not defined, the script is received from user end, so what I do is run them with <code>sh</code> or <code>bash</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480686956, "post_id": 40927577, "comment_id": 69078693, "body": "Show the exact string you&#39;re sending to be executed. If you&#39;re unnecessarily quoting the arguments, bash will look for a file literally named <code>&quot;sh &#47;abs&#47;path&#47;to&#47;xx.sh&quot;</code>. You can get the same error locally or running <code>ssh hostname &#39;&quot;sh &#47;abs&#47;path&#47;to&#47;xx.sh&quot;&#39;</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1480694961, "post_id": 40927577, "comment_id": 69084174, "body": "That&#39;s a slightly different error now. There should be no difference here between a default ubuntu and centos configuration. Try debugging with some other tests, like sending <code>ls &#47;home&#47;me&#47;try_ping.sh</code>, or do the equivalent using ssh on the command line."}], "answers": [{"tags": [], "owner": {"reputation": 3232, "user_id": 342348, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d087287d971a900fb9772b65d6d93e2e?s=128&d=identicon&r=PG", "display_name": "coanor", "link": "https://stackoverflow.com/users/342348/coanor"}, "is_accepted": false, "score": 1, "last_activity_date": 1480729886, "last_edit_date": 1480729886, "creation_date": 1480729528, "answer_id": 40943417, "question_id": 40927577, "link": "https://stackoverflow.com/questions/40927577/golang-ssh-running-remote-scripts-no-such-file-or-directory/40943417#40943417", "title": "Golang: ssh running remote scripts: No such file or directory", "body": "<p>I go the reason.  Normally, when we need to pass a long command to remote server via SSH, say <code>sh /path/to/script.sh</code>, we can run it via(single quote also works):</p>\n\n<pre><code>ssh user@1.2.3.4 \"sh /path/to/script.sh\"\n</code></pre>\n\n<p>here, we use double quote to disable shell parameter split.</p>\n\n<p>While in my true golang code (above code is cut from my project and use flags for testing.), I also used double quote, and the golang SSH package also send the tow double quote to remote SSH server, then remote SSH don't know how to locate files prefixed with double quote.</p>\n\n<p>The annoy things is that, the error message do not carry the double quote, blind me about the double quote.</p>\n\n<p>Thanks @JimB :)</p>\n"}], "owner": {"reputation": 3232, "user_id": 342348, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/d087287d971a900fb9772b65d6d93e2e?s=128&d=identicon&r=PG", "display_name": "coanor", "link": "https://stackoverflow.com/users/342348/coanor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1049, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1480729886, "creation_date": 1480666658, "last_edit_date": 1480692084, "question_id": 40927577, "link": "https://stackoverflow.com/questions/40927577/golang-ssh-running-remote-scripts-no-such-file-or-directory", "title": "Golang: ssh running remote scripts: No such file or directory", "body": "<p>I'm using ssh module to run shell scripts on remote machine:</p>\n\n<pre><code>// ssh-run.go\npackage main\nimport (\n    \"bytes\"\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"time\"\n\n    \"golang.org/x/crypto/ssh\"\n)\n\nvar (\n    flagUser = flag.String(\"user\", \"\", \"\")\n    flagPwd = flag.String(\"pwd\", \"\", \"\")\n    flagHost = flag.String(\"host\", \"\", \"\")\n    flagCmd = flag.String(\"cmd\", \"\", \"\")\n)\n\nfunc main() {\n    flag.Parse()\n    log.SetFlags(log.Lshortfile | log.LstdFlags)\n\n    cfg := ssh.ClientConfig {\n        User: *flagUser,\n        Auth: []ssh.AuthMethod(ssh.Password(*flagPwd)),\n    }\n\n    // skip err checking for short code\n    conn, _ := ssh.Dial(\"tcp\", fmt.Sprintf(\"%s:22\", *flagHost), &amp;cfg)\n    defer conn.Close()\n    ss, _ := conn.NewSession()\n    defer ss.Close()\n\n    var out bytes.Buffer\n    ss.Stdout = &amp;out\n    ss.Stderr = &amp;out\n    ss.Run(*flagCmd)\n    fmt.Printf(\"err: %v, out: %v\\n\", err, out.String())\n}\n</code></pre>\n\n<p>On a remote Centos server(<code>sshd</code> is running), I put a simple Ping script under home path, and I run the demo:</p>\n\n<pre><code>go run ssh-run.go -cmd \"/bin/bash /home/me/try_ping.sh\" -host 172.17.0.2 -pwd 123456 -user me\n</code></pre>\n\n<p>I got the error:</p>\n\n<pre><code>err: Process exited with status 127, out: /bin/bash: /home/me/try_ping.sh: No such file or directory\n</code></pre>\n\n<p>But when the remote server is a Ubuntu server, the Ping script works well. </p>\n\n<p>What is the difference between Centos and Ubuntu when facing remote script running? I need to run remote scripts under many UNIX-like OS, How to fix the gap between them?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 5630656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d860f6877c017ef64de1b3862a1fb029?s=128&d=identicon&r=PG&f=1", "display_name": "Redtakfeoh", "link": "https://stackoverflow.com/users/5630656/redtakfeoh"}, "edited": false, "score": 0, "creation_date": 1480667107, "post_id": 40927466, "comment_id": 69066488, "body": "Could not find this explanation anymore. Thanks for the reminder!"}], "tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": true, "score": 1, "last_activity_date": 1480666160, "last_edit_date": 1592644375, "creation_date": 1480666160, "answer_id": 40927466, "question_id": 40927309, "link": "https://stackoverflow.com/questions/40927309/type-declaration-importance-in-golang-nil-values/40927466#40927466", "title": "Type declaration importance in golang, nil values", "body": "<blockquote>\n<p>Under the covers, interfaces are implemented as two elements, a type and a value. The value, called the interface's dynamic value, is an arbitrary concrete value and the type is that of the value. For the <code>int</code> value 3, an interface value contains, schematically, <code>(int, 3)</code>.</p>\n<p>An interface value is <code>nil</code> only if the inner value and type are both unset, <code>(nil, nil)</code>. In particular, a <code>nil</code> interface will always hold a <code>nil</code> type. If we store a <code>nil</code> pointer of type <code>*int</code> inside an interface value, the inner type will be <code>*int</code> regardless of the value of the pointer: <code>(*int, nil)</code>. Such an interface value will therefore be non-<code>nil</code> <em>even when the pointer inside is</em> <code>nil</code>.</p>\n</blockquote>\n<p><a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#nil_error</a></p>\n"}], "owner": {"reputation": 9, "user_id": 5630656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d860f6877c017ef64de1b3862a1fb029?s=128&d=identicon&r=PG&f=1", "display_name": "Redtakfeoh", "link": "https://stackoverflow.com/users/5630656/redtakfeoh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2540, "favorite_count": 0, "closed_date": 1480669295, "accepted_answer_id": 40927466, "answer_count": 1, "score": -2, "last_activity_date": 1480666160, "creation_date": 1480665415, "last_edit_date": 1480665760, "question_id": 40927309, "link": "https://stackoverflow.com/questions/40927309/type-declaration-importance-in-golang-nil-values", "closed_reason": "Duplicate", "title": "Type declaration importance in golang, nil values", "body": "<p>I have this small golang test I cannot understand:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype myObj struct {\n}\n\nfunc nilObj() *myObj {\n    return nil\n}\n\nfunc nilInt() interface{} {\n    return nil\n}\n\nfunc main() {\n    var obj1 interface{}\n    fmt.Println(obj1 == nil)    // true\n    obj1 = nilObj()\n    fmt.Println(obj1 == nil)    // false\n\n    var obj2 *myObj\n    fmt.Println(obj2 == nil)    // true\n    obj2 = nilObj()\n    fmt.Println(obj2 == nil)    // true\n\n    var obj3 interface{}\n    fmt.Println(obj3 == nil)    // true\n    obj3 = nilInt()\n    fmt.Println(obj3 == nil)    // true\n}\n</code></pre>\n\n<p>Between obj1 and obj2, only the variable declaration changes, but the result is different.</p>\n\n<p>Between obj1 and obj3, the function call does not return the same type (struct pointer vs interface). I am not entirely sure I understand the result.</p>\n\n<p>Any help is welcome (<a href=\"https://play.golang.org/p/JcjsJ-_S8I\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JcjsJ-_S8I</a>)</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "is_accepted": true, "score": 4, "last_activity_date": 1480663450, "creation_date": 1480663450, "answer_id": 40926890, "question_id": 40926479, "link": "https://stackoverflow.com/questions/40926479/take-the-address-of-a-character-in-string/40926890#40926890", "title": "Take the address of a character in string", "body": "<p>Yes this is correct in Go Documentation you can see that</p>\n\n<blockquote>\n  <blockquote>\n    <p>A string type represents the set of string values. A string value is a\n    (possibly empty) sequence of bytes. Strings are immutable: once\n    created, it is impossible to change the contents of a string. The\n    predeclared string type is string.</p>\n    \n    <p>The length of a string s (its size in bytes) can be discovered using\n    the built-in function len. The length is a compile-time constant if\n    the string is a constant. A string's bytes can be accessed by integer\n    indices 0 through len(s)-1. It is illegal to take the address of such\n    an element; if s[i] is the i'th byte of a string, &amp;s[i] is invalid.</p>\n  </blockquote>\n</blockquote>\n\n<p>I hope this will solve your doubts</p>\n"}, {"tags": [], "owner": {"reputation": 804, "user_id": 6174302, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/58e83186008a31035bcb3525e794dbad?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Kao", "link": "https://stackoverflow.com/users/6174302/jason-kao"}, "is_accepted": false, "score": 1, "last_activity_date": 1519490717, "creation_date": 1519490717, "answer_id": 48965167, "question_id": 40926479, "link": "https://stackoverflow.com/questions/40926479/take-the-address-of-a-character-in-string/48965167#48965167", "title": "Take the address of a character in string", "body": "<p>To clarify the answer for future visitors to this question, accessing the address of the i-th byte of a string like <code>&amp;s[i]</code> is invalid because strings are immutable. If you could get the address, then the string can be mutated.</p>\n\n<p>The same logic applies to literal strings.</p>\n\n<pre><code>s := \"stack overflow\"\nfmt.Println(&amp;s) // works\n\nfmt.Println(&amp;\"hello, world\") // runtime error\n</code></pre>\n\n<p>This may seem strange, but it makes more sense if you think of it as a constant. For consistency, one would then have to allow taking the address of other constants, like <code>&amp;42</code> or <code>&amp;true</code>.</p>\n"}], "owner": {"reputation": 33, "user_id": 7235425, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13abb0f05edc865cc0e4e5baf0bff9cf?s=128&d=identicon&r=PG&f=1", "display_name": "Yorke", "link": "https://stackoverflow.com/users/7235425/yorke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1278, "favorite_count": 0, "accepted_answer_id": 40926890, "answer_count": 2, "score": 2, "last_activity_date": 1598424215, "creation_date": 1480661770, "last_edit_date": 1598424215, "question_id": 40926479, "link": "https://stackoverflow.com/questions/40926479/take-the-address-of-a-character-in-string", "title": "Take the address of a character in string", "body": "<pre><code>package main\nimport (\n    &quot;fmt&quot;\n)\nfunc main(){\n    var str string = &quot;hello,world&quot;\n    fmt.Println(&amp;str)\n    fmt.Println(&amp;str[0])\n}\n</code></pre>\n<p>I'm a complete rookie in golang. Just started learning for a few\ndays. Here is my problem:</p>\n<blockquote>\n<p>compiled error: cannot take the address of str[0]</p>\n</blockquote>\n<p>I searched &lt;&lt;the way to go&gt;&gt;. It says you cannot take the\naddress of a character in a string. Why is it not allowed?</p>\n<p>Another confusion is that once you create a string, you\ncannot modify it anymore. Does that mean the string is in constant\nspace?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1480659625, "post_id": 40925639, "comment_id": 69063304, "body": "one of the idiomatic ways is not using a framework <a href=\"https://www.nicolasmerouze.com/build-web-framework-golang/\" rel=\"nofollow noreferrer\">nicolasmerouze.com/build-web-framework-golang</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6315, "user_id": 472765, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/3f19cb804cac10c17908fe623d299e34?s=128&d=identicon&r=PG", "display_name": "AlexGad", "link": "https://stackoverflow.com/users/472765/alexgad"}, "edited": false, "score": 0, "creation_date": 1480678762, "post_id": 40926064, "comment_id": 69073551, "body": "Interesting, this was my initial approach.  I stored the additional info using the route method and path as the key for a lookup.  I decided to change it to the middleware approach I described because it seemed &quot;cleaner&quot; and kept the data closer to where it was needed (avoids the lookup cost each time?).  Is there a benefit to the singleton approach vs the middleware approach?"}, {"owner": {"reputation": 3589, "user_id": 337988, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a0929a98013283051149383445c2fad5?s=128&d=identicon&r=PG", "display_name": "philipjkim", "link": "https://stackoverflow.com/users/337988/philipjkim"}, "reply_to_user": {"reputation": 6315, "user_id": 472765, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/3f19cb804cac10c17908fe623d299e34?s=128&d=identicon&r=PG", "display_name": "AlexGad", "link": "https://stackoverflow.com/users/472765/alexgad"}, "edited": false, "score": 0, "creation_date": 1480924059, "post_id": 40926064, "comment_id": 69147816, "body": "I think it&#39;s a good pattern to use a singleton instance for getOperationMap (or other expensive functions)&#39;s return value whether you use middleware or not. And I agree that using middleware is fine in this situation. I don&#39;t think they are mutually exclusive (or versus) things."}], "tags": [], "owner": {"reputation": 3589, "user_id": 337988, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a0929a98013283051149383445c2fad5?s=128&d=identicon&r=PG", "display_name": "philipjkim", "link": "https://stackoverflow.com/users/337988/philipjkim"}, "is_accepted": true, "score": 0, "last_activity_date": 1480659870, "creation_date": 1480659870, "answer_id": 40926064, "question_id": 40925639, "link": "https://stackoverflow.com/questions/40925639/safe-to-refer-to-values-in-outer-function-from-inner-function/40926064#40926064", "title": "Safe to refer to values in outer function from inner function?", "body": "<p>If <code>operationMap</code> never changes after initialization, You can declare <code>operationMap</code> as a singleton instance like following:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar (\n    operationMapInst map[string]string // I don't know the exact type of map, so you should change the type.\n    operationMapOnce sync.Once\n)\n\nfunc getOperationMap() map[string]string {\n    // operationMapOnce.Do() runs only once\n    // when the first time getOperationMap() is called.\n    operationMapOnce.Do(func() {\n        // Initialize operationMapInst.\n        operationMapInst = map[string]string{\"/\": \"root\", \"/ver\": \"version\"}\n        fmt.Println(\"operaionMap has initialized!\")\n    })\n\n    return operationMapInst\n}\n\nfunc main() {\n    // The initialization logic runs only once.\n    // Because getOperationMap() returns map,\n    // syntax for the value for a path should be getOperationMap()[path],\n    // not getOperationMap(path).\n    rootOp, ok := getOperationMap()[\"/\"]\n    fmt.Println(rootOp, ok)\n\n    // repetition\n    rootOp, ok = getOperationMap()[\"/\"]\n    fmt.Println(rootOp, ok)\n    verOp, ok := getOperationMap()[\"/ver\"]\n    fmt.Println(verOp, ok)\n    verOp, ok = getOperationMap()[\"/ver\"]\n    fmt.Println(verOp, ok)\n}\n</code></pre>\n\n<p>You can run this code <a href=\"https://play.golang.org/p/fulBWgEovE\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>I recommend <a href=\"http://marcio.io/2015/07/singleton-pattern-in-go/\" rel=\"nofollow noreferrer\">http://marcio.io/2015/07/singleton-pattern-in-go/</a> for understanding singleton pattern in Go.</p>\n"}, {"comments": [{"owner": {"reputation": 6315, "user_id": 472765, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/3f19cb804cac10c17908fe623d299e34?s=128&d=identicon&r=PG", "display_name": "AlexGad", "link": "https://stackoverflow.com/users/472765/alexgad"}, "edited": false, "score": 0, "creation_date": 1480678884, "post_id": 40926068, "comment_id": 69073620, "body": "Do you see benefits to this approach vs. the singleton approach that philipjkim suggests?  Or is it really just a matter of preference?"}], "tags": [], "owner": {"reputation": 319196, "user_id": 34211, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/gfFlI.jpg?s=128&g=1", "display_name": "Andrew Hare", "link": "https://stackoverflow.com/users/34211/andrew-hare"}, "is_accepted": false, "score": 1, "last_activity_date": 1480659877, "creation_date": 1480659877, "answer_id": 40926068, "question_id": 40925639, "link": "https://stackoverflow.com/questions/40925639/safe-to-refer-to-values-in-outer-function-from-inner-function/40926068#40926068", "title": "Safe to refer to values in outer function from inner function?", "body": "<p>This code is safe, won't cause GC problems, and is a good, idiomatic pattern that can be used in Go. </p>\n\n<p>In your example, only one <code>operation</code> will be created, moved to the heap, and then shared by each request as they are handled by Echo.</p>\n\n<p>I often use this exact pattern myself when I need to initialize an expensive struct that will be used when handling all requests.</p>\n"}], "owner": {"reputation": 6315, "user_id": 472765, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/3f19cb804cac10c17908fe623d299e34?s=128&d=identicon&r=PG", "display_name": "AlexGad", "link": "https://stackoverflow.com/users/472765/alexgad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 40926064, "answer_count": 2, "score": 0, "last_activity_date": 1480659877, "creation_date": 1480657812, "question_id": 40925639, "link": "https://stackoverflow.com/questions/40925639/safe-to-refer-to-values-in-outer-function-from-inner-function", "title": "Safe to refer to values in outer function from inner function?", "body": "<p>I am moving to Go from Node.js and I am concerned whether a construct that I would use in Node is safe to do in Go and whether there is a more idiomatic way to accomplish the same thing.  I am using the Echo framework and want to set a route specific struct that will be available within the context object.  I could generate the struct for every call within middleware, but it's expensive to do so.  Instead, I set the struct once in an outer func that then returns an inner func that refers to the struct in the outer func.  My hope is that I then only incur the generation cost once and then have the correct struct associated with my route for every call. </p>\n\n<pre><code>e.POST(path, POST.GenericPostHandler, func(next echo.HandlerFunc)  echo.HandlerFunc {\n    operation := getOperationMap(path)\n    return func(c echo.Context) error {\n        c.Set(\"op\", operation)\n        return next(c)\n    }\n})\n</code></pre>\n\n<p>Are there any concerns with this code?  Will it cause problems with GC?  Is there a more efficient way to accomplish the same thing?  I assume a copy of the struct is made every time the middleware is called.  </p>\n"}, {"tags": ["sorting", "go"], "comments": [{"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 3, "creation_date": 1480648511, "post_id": 40923603, "comment_id": 69060057, "body": "What have you tried, what part are you stuck on? have you looked at the examples in the sort std library package ?"}, {"owner": {"reputation": 37, "user_id": 7239078, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/39a73253e39d7669f7ee20bb625f6c6c?s=128&d=identicon&r=PG&f=1", "display_name": "rajesh kumar", "link": "https://stackoverflow.com/users/7239078/rajesh-kumar"}, "reply_to_user": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 0, "creation_date": 1480649359, "post_id": 40923603, "comment_id": 69060292, "body": "I have tried the sort package to do this but the results are not what i expected.I will update what i did.Please correct me if i m wrong.Thanks..."}, {"owner": {"reputation": 373, "user_id": 1924721, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ba12cccb8e7b9f1da05f7226a25521d2?s=128&d=identicon&r=PG", "display_name": "neclepsio", "link": "https://stackoverflow.com/users/1924721/neclepsio"}, "edited": false, "score": 0, "creation_date": 1480665792, "post_id": 40923603, "comment_id": 69065963, "body": "Which is the sorting you&#39;re looking for?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1480669134, "post_id": 40923603, "comment_id": 69067493, "body": "Your output is properly sorted by Applieddate. So: What&#39;s wrong?"}, {"owner": {"reputation": 37, "user_id": 7239078, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/39a73253e39d7669f7ee20bb625f6c6c?s=128&d=identicon&r=PG&f=1", "display_name": "rajesh kumar", "link": "https://stackoverflow.com/users/7239078/rajesh-kumar"}, "edited": false, "score": 0, "creation_date": 1480910323, "post_id": 40923603, "comment_id": 69143253, "body": "As you can see the HRApproved is before the processing .What i need is Processing and HRProccessing must come first but sorted by applied date and then all other the leave states must come after these but sorted by applied date between them.Appreciate any help.Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "is_accepted": true, "score": 1, "last_activity_date": 1480692024, "creation_date": 1480692024, "answer_id": 40935527, "question_id": 40923603, "link": "https://stackoverflow.com/questions/40923603/sorting-in-golang/40935527#40935527", "title": "Sorting in golang", "body": "<p>You need to sort by Leavestatus first,then applieddate, but leavestatus is a set of enums rather than being alpha sorted, so you'll want to catogorize the status, see if they're they same if so, sort by date, otherwise sort by the status. something like</p>\n\n<pre><code>func (d leaveDetails) Less(i, j int) bool {\n    status := func(l Leave) int {\n        if l.Leavestatus == \"Processing\" || l.Leavestatus == \"HRProcessing\" {\n            return 1\n        }\n        return 2\n    }\n    a := status(d[i])\n    b := status(d[j])\n    if a == b {\n        return d[i].Applieddate.After(d[j].Applieddate)\n    }\n    return a&lt;b\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1652, "user_id": 218439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba2488c49a74ab94a7f2298dfb165304?s=128&d=identicon&r=PG", "display_name": "Song Gao", "link": "https://stackoverflow.com/users/218439/song-gao"}, "is_accepted": false, "score": 0, "last_activity_date": 1480745846, "creation_date": 1480745846, "answer_id": 40944885, "question_id": 40923603, "link": "https://stackoverflow.com/questions/40923603/sorting-in-golang/40944885#40944885", "title": "Sorting in golang", "body": "<p>Defining <code>Leavestatus</code> as a <code>string</code> seems pretty inefficient since you'd need to do string comparison and copying the struct involves copying the <code>Leavestatus</code> even though it's just a \"enum\"-like type. This also makes it easier to introduce typo-based bugs since compiler can't check if you typed strings right.</p>\n\n<p>I would make a int based type for <code>Leavestatus</code>, e.g. <code>LeaveStatus</code></p>\n\n<pre><code>type LeaveStatus int\n\nconst (\n    _ = iota\n    Processing\n    HRProcessing\n    HRApproved\n)\n</code></pre>\n\n<p>Then you can have <code>String()</code> method on the type:</p>\n\n<pre><code>func (s LeaveStatus) String() string {\n    switch(s) {\n        case Processing:\n            return \"Processing\"\n        case HRProcessing:\n            return \"HRProcessing\"\n        case Approved:\n            return \"Approved\"\n        default:\n            panic(\"O_O\")\n    }\n}\n</code></pre>\n\n<p>Since <code>LeaveStatus</code> is a number-based type now, you can just compare the field using <code>&lt;</code> and <code>&gt;</code> operators in your <code>Less()</code> implementation.</p>\n"}], "owner": {"reputation": 37, "user_id": 7239078, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/39a73253e39d7669f7ee20bb625f6c6c?s=128&d=identicon&r=PG&f=1", "display_name": "rajesh kumar", "link": "https://stackoverflow.com/users/7239078/rajesh-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 612, "favorite_count": 0, "accepted_answer_id": 40935527, "answer_count": 2, "score": 0, "last_activity_date": 1480745846, "creation_date": 1480644214, "last_edit_date": 1480651508, "question_id": 40923603, "link": "https://stackoverflow.com/questions/40923603/sorting-in-golang", "title": "Sorting in golang", "body": "<p>I am creating a leave application using go lang.My struct is as follows</p>\n\n<pre><code>Leave struct {\n        Leaveid     int\n        Name        string\n        EmployeeId  string\n        Applieddate time.Time\n        Leavestatus string\n    }\n</code></pre>\n\n<p>The Leave status varies between Processing ,Approved ,Denied, HRApproved, HrDenied, HrProcessing. <br>By general the leave sort order must be based on applied date.<br>I must be able to show the Processing and HRProcessing first  and other status types later.</p>\n\n<p>I want something like this </p>\n\n<pre><code>        [\n          {\n            \"Leaveid\": 4,\n            \"Name\": \"rajesh\",\n            \"EmployeeId\": \"rajesh\",\n            \"Applieddate\": \"2016-12-02T08:59:02.870882+08:00\",\n            \"Leavestatus\": \"HRProcessing\"\n          },\n          {\n            \"Leaveid\": 1,\n            \"Name\": \"rajesh\",\n            \"EmployeeId\": \"rajesh\",\n            \"Applieddate\": \"2016-12-02T07:30:01.679636+08:00\",\n            \"Leavestatus\": \"Processing\"\n          },\n{\n            \"Leaveid\": 3,\n            \"Name\": \"rajesh\",\n            \"EmployeeId\": \"rajesh\",\n            \"Applieddate\": \"2016-12-02T07:00:02.870882+08:00\",\n            \"Leavestatus\": \"HRProcessing\"\n          },\n         {\n            \"Leaveid\": 5,\n            \"Name\": \"rajesh\",\n            \"EmployeeId\": \"rajesh\",\n            \"Applieddate\": \"2016-12-02T10:00:11.139189+08:00\",\n            \"Leavestatus\": \"Approved\"\n          },\n          {\n            \"Leaveid\": 2,\n            \"Name\": \"rajesh\",\n            \"EmployeeId\": \"rajesh\",\n            \"Applieddate\": \"2016-12-02T07:58:41.837666+08:00\",\n            \"Leavestatus\": \"HRApproved\"\n          },\n\n        ]\n</code></pre>\n\n<blockquote>\n  <p>Update:This is what i have done using sort package</p>\n</blockquote>\n\n<pre><code>func (sortleave leaveDetails) Len() int {\n    return len(sortleave)\n}\nfunc (sortleave leaveDetails) Less(i, j int) bool {\n    if sortleave[i].Applieddate.After(sortleave[j].Applieddate) {\n        return true\n    }\n    if sortleave[i].Applieddate.Before(sortleave[j].Applieddate) {\n        return false\n    }\n    return sortleave[i].Leavestatus &gt; sortleave[j].Leavestatus\n}\nfunc (sortleave leaveDetails) Swap(i, j int) {\n    sortleave[i], sortleave[j] = sortleave[j], sortleave[i]\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[\n  {\n    \"Leaveid\": 2,\n    \"Name\": \"rajesh\",\n    \"EmployeeId\": \"rajesh\",\n    \"Applieddate\": \"2016-12-02T08:59:45.139189+08:00\",\n    \"Leavestatus\": \"HRProcessing\"\n  },\n  {\n    \"Leaveid\": 4,\n    \"Name\": \"rajesh\",\n    \"EmployeeId\": \"rajesh\",\n    \"Applieddate\": \"2016-12-02T08:59:02.870882+08:00\",\n    \"Leavestatus\": \"HRApproved\"\n  },\n  {\n    \"Leaveid\": 3,\n    \"Name\": \"rajesh\",\n    \"EmployeeId\": \"rajesh\",\n    \"Applieddate\": \"2016-12-02T08:58:41.837666+08:00\",\n    \"Leavestatus\": \"Processing\"\n  },\n  {\n    \"Leaveid\": 1,\n    \"Name\": \"rajesh\",\n    \"EmployeeId\": \"rajesh\",\n    \"Applieddate\": \"2016-12-01T18:10:01.679636+08:00\",\n    \"Leavestatus\": \"Processing\"\n  }\n]\n</code></pre>\n\n<p>Here Processing goes down and HRApproved goes up.But this is  not what i wanted.Please help me  to solve this problem.Thanks </p>\n"}, {"tags": ["sockets", "go", "ffmpeg", "video-streaming", "mp4"], "comments": [{"owner": {"reputation": 27067, "user_id": 210785, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a561cd4d29738e18d9e565a6265d86ac?s=128&d=identicon&r=PG", "display_name": "szatmary", "link": "https://stackoverflow.com/users/210785/szatmary"}, "edited": false, "score": 1, "creation_date": 1480648606, "post_id": 40922313, "comment_id": 69060076, "body": "You are telling ffmpeg to make an avi file, but then saving it as an mp4?"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 5233325, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e67e776d30536446604302b592fa80aa?s=128&d=identicon&r=PG&f=1", "display_name": "ThetraNetwork", "link": "https://stackoverflow.com/users/5233325/thetranetwork"}, "is_accepted": false, "score": 1, "last_activity_date": 1480652969, "creation_date": 1480652969, "answer_id": 40924815, "question_id": 40922313, "link": "https://stackoverflow.com/questions/40922313/how-to-read-ffmpeg-with-go/40924815#40924815", "title": "How to read FFMPEG with Go?", "body": "<p>The buffer size on the server was too small (512byte)</p>\n"}], "owner": {"reputation": 81, "user_id": 5233325, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e67e776d30536446604302b592fa80aa?s=128&d=identicon&r=PG&f=1", "display_name": "ThetraNetwork", "link": "https://stackoverflow.com/users/5233325/thetranetwork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1481137841, "creation_date": 1480635083, "last_edit_date": 1481137841, "question_id": 40922313, "link": "https://stackoverflow.com/questions/40922313/how-to-read-ffmpeg-with-go", "title": "How to read FFMPEG with Go?", "body": "<p>How can you read UDP sent from ffmpeg? </p>\n\n<p>I wrote a script to listen to UDP packets and write them into file, but the file is invalid and almost twice the size.</p>\n\n<p>This is how I send the data:</p>\n\n<pre><code>ffmpeg -i video.mp4 -c:a aac -ar 48000 -ab 196k \\\n -ac 2 -strict -2 -c:v libx264 -vb 500k -r 25 -s 320x240 \\\n -ss 00.000 -f mp4 -movflags frag_keyframe+empty_moov \\ udp://127.0.0.1:1936\n</code></pre>\n\n<p>This is the code in Go. It should simply write the video into a new video file:</p>\n\n<pre><code>package main\n\nimport (\n  \"net\"\n  \"os\"\n)\n\nfunc main(){\n  var buf []byte = make([]byte, 512)\n  addr, _ := net.ResolveUDPAddr(\"udp\", \":1936\")\n  conn, _ := net.ListenUDP(\"udp\", addr)\n  defer conn.Close()\n\n  os.Create(\"new_video.mp4\")\n  f, _ := os.OpenFile(\"new_video.mp4\", syscall.O_WRONLY, 0644)\n  defer f.Close()\n\n\n  for {\n    n, _ := conn.Read(buf)\n    f.Write(buf[0:n])\n    buf = make([]byte, 512)\n  }\n}\n</code></pre>\n\n<p>Thanks</p>\n\n<p><strong>Updated</strong></p>\n\n<p>I changed the format to mp4 but the file is still invalid.</p>\n"}, {"tags": ["go", "amazon-s3"], "answers": [{"tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": false, "score": -2, "last_activity_date": 1480635644, "creation_date": 1480635644, "answer_id": 40922382, "question_id": 40922172, "link": "https://stackoverflow.com/questions/40922172/golang-amazon-s3-environment-access-key-not-found/40922382#40922382", "title": "Golang amazon s3 environment access key not found", "body": "<p>@Pablo prez,</p>\n\n<p>Is <em>getting</em> credentials actually showing you the AWS keys from your env, i.e. if you run</p>\n\n<pre><code>creds := credentials.NewEnvCredentials()\ncredValue, err := creds.Get()\nif err != nil {\n    panic(err.Error())\n}\n\nfmt.Printf(\"%+v\", credValue)\n</code></pre>\n\n<p>will it print your keys out?</p>\n\n<p>You may want to check <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/</a> for more details.</p>\n"}], "owner": {"reputation": 141, "user_id": 5066776, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/7f159b2bc674852c4578481c27530f44?s=128&d=identicon&r=PG&f=1", "display_name": "Pablo prez", "link": "https://stackoverflow.com/users/5066776/pablo-prez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1085, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1480635644, "creation_date": 1480634257, "question_id": 40922172, "link": "https://stackoverflow.com/questions/40922172/golang-amazon-s3-environment-access-key-not-found", "title": "Golang amazon s3 environment access key not found", "body": "<p>I created a new I-AM user set that user permission to full access for S3 then I see the environment variable for the MacBook with the correct Key and Key-ID . I then followed the amazon docs <a href=\"http://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/common-examples.html#s3\" rel=\"nofollow noreferrer\">http://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/common-examples.html#s3</a> to list all of my buckets and I received the error \n<strong>Failed to list buckets EnvAccessKeyNotFound: AWS_ACCESS_KEY_ID or AWS_ACCESS_KEY not found in environment</strong></p>\n\n<p>I do not know why it is not recognizing my code which is this</p>\n\n<pre><code>func UploadProfile() {\n\n    svc := s3.New(session.New(&amp;aws.Config{Region: aws.String(\"us-west-2\"),Credentials:credentials.NewEnvCredentials()}))\n    result, err := svc.ListBuckets(&amp;s3.ListBucketsInput{})\n    if err != nil {\n        log.Println(\"Failed to list buckets\", err)\n        return\n    }\n\n    log.Println(\"Buckets:\")\n    for _, bucket := range result.Buckets {\n        log.Printf(\"%s : %s\\n\", aws.StringValue(bucket.Name), bucket.CreationDate)\n    }\n}\n</code></pre>\n\n<p>I had one of the variables before as <strong>AWS_SECRET_ACCESS_KEY</strong> but removed the secret portion because it still gave me the same error. Any suggestions on how to fix this\n<a href=\"https://i.stack.imgur.com/2m2EB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2m2EB.png\" alt=\"enter image description here\"></a> </p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 63390, "user_id": 2683814, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/16a4c2fb341c51388d5cdfcf0e956f6c?s=128&d=identicon&r=PG&f=1", "display_name": "s7vr", "link": "https://stackoverflow.com/users/2683814/s7vr"}, "edited": false, "score": 0, "creation_date": 1480635034, "post_id": 40922166, "comment_id": 69056685, "body": "This may help. <a href=\"http://stackoverflow.com/questions/18777130/mongodb-sorting-by-geonear-and-date\" title=\"mongodb sorting by geonear and date\">stackoverflow.com/questions/18777130/&hellip;</a> &amp; <a href=\"http://stackoverflow.com/questions/31475277/geonear-sort-by-distance-and-time\" title=\"geonear sort by distance and time\">stackoverflow.com/questions/31475277/&hellip;</a>"}, {"owner": {"reputation": 259, "user_id": 2501459, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/e7feac83fdcec43de8ad5a72466313e0?s=128&d=identicon&r=PG", "display_name": "Jyothish Jose", "link": "https://stackoverflow.com/users/2501459/jyothish-jose"}, "edited": false, "score": 0, "creation_date": 1508954866, "post_id": 40922166, "comment_id": 80825653, "body": "@user7227958 : did you get a solution. can you please share here?"}], "owner": {"reputation": 23, "user_id": 7227958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4f2b0731b81477ba7539301eaea0a4d?s=128&d=identicon&r=PG&f=1", "display_name": "user7227958", "link": "https://stackoverflow.com/users/7227958/user7227958"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 625, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1480634226, "creation_date": 1480634226, "question_id": 40922166, "link": "https://stackoverflow.com/questions/40922166/how-to-sort-by-distance-from-geo-location-and-last-active-time-in-mongodb", "title": "How to sort by distance from geo location and last active time in mongodb?", "body": "<p>I have a sore locator app which will display all stores which are in 300 meters of provided latitude and longitude value . \nThe store document contains active time and geo location . </p>\n\n<p>I want to first fetch all stores and then lets say there are 4 stores at 200 meters . So these 4 stores get sorted on the basis of their last active time. </p>\n\n<blockquote>\n  <p>basically what in mysql will look like is  <strong>order by distance asc ,</strong>\n  <strong>last_active desc</strong></p>\n</blockquote>\n\n<p>my go code looks like this : </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n    \"log\"\n)\n\ntype Store struct {\n    ID       string  `bson:\"_id,omitempty\" json:\"shopid\"`\n    Name     string  `bson:\"name\" json:\"name\"`\n    Location GeoJson `bson:\"location\" json:\"location\"`\n    Time    time.Time `bson:\"time\" json:\"time\"`\n}\n\ntype GeoJson struct {\n    Type        string    `json:\"-\"`\n    Coordinates []float64 `json:\"coordinates\"`\n}\n\nfunc main() {\n    cluster := \"localhost\" // mongodb host\n\n    // connect to mongo\n    session, err := mgo.Dial(cluster)\n    if err != nil {\n        log.Fatal(\"could not connect to db: \", err)\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true)\n\n    // search criteria\n    long := 39.6910592\n    lat := 35.6909623\n    scope := 3000 // max distance in metres\n\n    var results []Store // to hold the results\n\n    // query the database\n    c := session.DB(\"test\").C(\"stores\")\n\n    // insert\n    man := Store{}\n    man.ID = \"1\"\n    man.Name = \"vinka medical store\"\n    man.Location.Type = \"Point\"\n    man.Location.Coordinates = []float64{lat, long}\n\n    // insert\n    err = c.Insert(man)\n    fmt.Printf(\"%v\\n\", man)\n    if err != nil {\n        fmt.Println(\"There is insert error\")\n        panic(err)\n    }\n\n    // ensure\n    // Creating the indexes\n    index := mgo.Index{\n        Key:  []string{\"$2dsphere:location\"},\n        Bits: 26,\n    }\n    err = c.EnsureIndex(index)\n    if err != nil {\n        fmt.Println(\"There is index error\")\n        panic(err)\n    }\n\n    //find\n    err = c.Find(bson.M{\n        \"location\": bson.M{\n            \"$nearSphere\": bson.M{\n                \"$geometry\": bson.M{\n                    \"type\":        \"Point\",\n                    \"coordinates\": []float64{long, lat},\n                },\n                \"$maxDistance\": scope,\n            },\n        },\n    }).All(&amp;results)\n\n    //err = c.Find(bson.M{\"_id\": \"1\"}).All(&amp;results)\n    if err != nil {\n        panic(err)\n    }\n\n    //convert it to JSON so it can be displayed\n    formatter := json.MarshalIndent\n    response, err := formatter(results, \" \", \"   \")\n\n    fmt.Println(string(response))\n}\n</code></pre>\n\n<p><strong>How should i modify this part ?</strong></p>\n\n<pre><code>//find\nerr = c.Find(bson.M{\n    \"location\": bson.M{\n        \"$nearSphere\": bson.M{\n            \"$geometry\": bson.M{\n                \"type\":        \"Point\",\n                \"coordinates\": []float64{long, lat},\n            },\n            \"$maxDistance\": scope,\n        },\n    },\n}).All(&amp;results) \n</code></pre>\n"}, {"tags": ["go", "tail"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1480632709, "post_id": 40921832, "comment_id": 69055905, "body": "What wrong with the extra information from <code>hpcloud&#47;tail</code>? You still get the appended data."}, {"owner": {"reputation": 907, "user_id": 2515526, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cc2475efe2a90c898afa1efc62c57467?s=128&d=identicon&r=PG", "display_name": "tverghis", "link": "https://stackoverflow.com/users/2515526/tverghis"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480632848, "post_id": 40921832, "comment_id": 69055965, "body": "@JimB it&#39;s not ideal, but I can work around it. The main reason I cannot use <code>hpcloud&#47;tail</code> is because it does not output the last line if it is not followed by a newline."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480633122, "post_id": 40921832, "comment_id": 69056061, "body": "You can certainly use fsnotify then, you just read the file as needed depending on the notifications received. I don&#39;t know of a better complete &quot;tail -f&quot; package written in Go (but offsite recommendations are off topic anyway)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1480642621, "post_id": 40921832, "comment_id": 69058691, "body": "See <a href=\"https://stackoverflow.com/questions/31120987/go-tail-f-like-generator#answer-31122253\" title=\"go tail f like generator%23answer 31122253\">stackoverflow.com/questions/31120987/&hellip;</a> for a simple solution.  It works well when the app is monitoring a small number of files and can tolerate a little latency."}, {"owner": {"reputation": 907, "user_id": 2515526, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cc2475efe2a90c898afa1efc62c57467?s=128&d=identicon&r=PG", "display_name": "tverghis", "link": "https://stackoverflow.com/users/2515526/tverghis"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1480642889, "post_id": 40921832, "comment_id": 69058744, "body": "@JimB thanks for pointing me in the right direction. I ended up using <code>fsnotify</code> along with <a href=\"https://github.com/sergi/go-diff/\" rel=\"nofollow noreferrer\">go-diff</a> to get just the last line whenever <code>fsnotify</code> identified a change. If you&#39;d like to write your comment as an answer, I can accept it."}], "answers": [{"tags": [], "owner": {"reputation": 952, "user_id": 4555798, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/956224387724154/picture?type=large", "display_name": "oharlem", "link": "https://stackoverflow.com/users/4555798/oharlem"}, "is_accepted": false, "score": 0, "last_activity_date": 1480634264, "creation_date": 1480634264, "answer_id": 40922173, "question_id": 40921832, "link": "https://stackoverflow.com/questions/40921832/monitor-a-file-for-additions-and-get-last-added-line/40922173#40922173", "title": "Monitor A File For Additions And Get Last Added Line", "body": "<p>@user2515526,</p>\n\n<p>Usually changed diff is out of scope of file watchers' functionality, because, you know, you could change an image, and a watcher would need to keep a track several Mb of a diff in memory, and what if we have thousands of files?\nHowever, as bad as it sounds, this may be exactly the way you want to implement this (sure, depends on your app, etc. - could be fine for text files), i.e. - keeping a map of diffs (1 diff per file) since last modification. Cannot say I like it, but sounds like fsnotify has no support for changes/diffs that you need.</p>\n\n<p>Also, regarding your question about running in a loop, maybe you can get some hints here: <a href=\"https://github.com/kataras/iris/blob/8370d76910cdd8de043753ed81ae080eae8dc798/utils/file.go\" rel=\"nofollow noreferrer\">https://github.com/kataras/iris/blob/8370d76910cdd8de043753ed81ae080eae8dc798/utils/file.go</a>\nIts a framework that allows to build a server that watches for TypeScript file changes. So sounds similar to your case/question.</p>\n\n<p>Cheers,\n-D</p>\n"}], "owner": {"reputation": 907, "user_id": 2515526, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cc2475efe2a90c898afa1efc62c57467?s=128&d=identicon&r=PG", "display_name": "tverghis", "link": "https://stackoverflow.com/users/2515526/tverghis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 277, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1480634264, "creation_date": 1480632496, "last_edit_date": 1495540381, "question_id": 40921832, "link": "https://stackoverflow.com/questions/40921832/monitor-a-file-for-additions-and-get-last-added-line", "title": "Monitor A File For Additions And Get Last Added Line", "body": "<p>I'm having trouble monitoring a file for changes. I need to be able to know when a file changes, and when it does, I need the new line that was added. I intend to parse each line and find ones that match certain criteria, and act on information in those lines. I know the expected number of matching lines ahead of time, but I do not know how many lines in total will be added to the file, or where the matching lines will be.</p>\n\n<p>I've tried 2 packages so far, with no avail.</p>\n\n<p><strong><a href=\"https://github.com/fsnotify/fsnotify\" rel=\"nofollow noreferrer\">fsnotify/fsnotify</a></strong></p>\n\n<p>As fas as I can tell, <code>fsnotify</code> can only tell me <em>when</em> a file is modified, not what the details of the modification was. Since I need to know what exactly was added to the file, this is no good for me.</p>\n\n<p>(As a side-question, can this be run in a loop? The example that I tried exited after just one modification. I need to monitor for multiple modifications.)</p>\n\n<p><strong><a href=\"https://github.com/hpcloud/tail\" rel=\"nofollow noreferrer\">hpcloud/tail</a></strong></p>\n\n<p>This package tries to mimic the Unix <code>tail</code> command, but it seems to have its own issues. The output that I get includes timestamps and other data - I just want the added line, nothing else. Also, it seems to think a file has been modified multiple times, even when it's just one edit. Further, the deal breaker here is that it does not output the last line if the line was not followed by a newline character.</p>\n\n<p><strong>Delegating to <code>tail</code></strong></p>\n\n<p>I came across <a href=\"https://stackoverflow.com/a/8272924/2515526\">this</a> answer, which suggests to delegate this work to the <code>tail</code> command itself, but I need this to work cross-platform (specifically, macOS, Linux and Windows). I don't believe that an equivalent command exists on Windows.</p>\n\n<p>How do I go about tackling this?</p>\n"}, {"tags": ["arrays", "pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1480631204, "creation_date": 1480631204, "answer_id": 40921540, "question_id": 40921407, "link": "https://stackoverflow.com/questions/40921407/how-reslove-pointer-to-array-from-pointer-to-single-object/40921540#40921540", "title": "How reslove pointer to array from pointer to single object", "body": "<p>Use the <a href=\"https://golang.org/pkg/reflect/#Kind\" rel=\"nofollow noreferrer\"><code>reflect.Kind</code></a> to check the kind of value you have:</p>\n\n<pre><code>func object(i interface{}) {\n    v := reflect.ValueOf(i)\n    switch v.Kind() {\n    case reflect.Ptr:\n        fmt.Print(\"we have a pointer \")\n        switch v.Elem().Kind() {\n        case reflect.Slice:\n            fmt.Println(\"to a slice\")\n        case reflect.Array:\n            fmt.Println(\"to an array\")\n        case reflect.Struct:\n            fmt.Println(\"to a struct\")\n        default:\n            fmt.Println(\"to unexpected type \", v.Elem().Kind())\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/q32Cfz_dmF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/q32Cfz_dmF</a></p>\n"}], "owner": {"reputation": 1366, "user_id": 4931643, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/702807200eaef92e4d1c6896893d7888?s=128&d=identicon&r=PG&f=1", "display_name": "Mbded", "link": "https://stackoverflow.com/users/4931643/mbded"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "accepted_answer_id": 40921540, "answer_count": 1, "score": 0, "last_activity_date": 1480631204, "creation_date": 1480630630, "question_id": 40921407, "link": "https://stackoverflow.com/questions/40921407/how-reslove-pointer-to-array-from-pointer-to-single-object", "title": "How reslove pointer to array from pointer to single object", "body": "<p>I try in my porogram find way to resolve beetwen type pointer to array form pointer to single object using <code>interface{}</code> as argument in particular function. On this time i get this reslut using below way:</p>\n\n<pre><code>func object( v interface{}) {\n    if strings.HasPrefix(reflect.TypeOf(v).String(), \"*[]\") {\n        // pointer to array \n    } else {\n        //  pointer to single object\n    }\n}\n</code></pre>\n\n<p>Above way works, but for me this is not clean code. I think that exist some better way to solve this using golang package as type, reflect but now I don't no how so please Your suggestion.</p>\n\n<p>Ps. I don't want to use <code>switch</code> statemet for example:</p>\n\n<pre><code>switch v.(type){\ncase *[]someType:\n  // array\ndefault:\n  // single object\n}\n</code></pre>\n\n<p>This should be more universal does not depend on the type object of array</p>\n"}]