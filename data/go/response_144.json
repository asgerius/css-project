[{"tags": ["linux", "go", "udp"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507757760, "post_id": 46697799, "comment_id": 80343582, "body": "can you share how your server handle connections ? looks like it&#39;s getting blocked or something like that"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507758383, "post_id": 46697799, "comment_id": 80343840, "body": "Unless you have a requirement for one, it&#39;s generally advisable to avoid using a connected UDP socket."}, {"owner": {"reputation": 303, "user_id": 204204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5474ac01095dc18e731eddf9a17b204a?s=128&d=identicon&r=PG", "display_name": "selden", "link": "https://stackoverflow.com/users/204204/selden"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507758598, "post_id": 46697799, "comment_id": 80343908, "body": "@JimB What is this &quot;connected UDP socket&quot; I thought UDP was connectionless?  Where do they generally advise avoiding it?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507758957, "post_id": 46697799, "comment_id": 80344044, "body": "A &quot;connected UDP socket&quot; has a default destination address. From the Linux udp docs <code>When connect(2) is called on the socket, the default destination address is set and datagrams can now be sent using send(2) or write(2) without specifying a destination address</code>. It&#39;s mostly just a convenience, but there are other differences; like calling <code>recv</code> will only receive packets from the connected address, and the ICMP conditions like you see here."}, {"owner": {"reputation": 303, "user_id": 204204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5474ac01095dc18e731eddf9a17b204a?s=128&d=identicon&r=PG", "display_name": "selden", "link": "https://stackoverflow.com/users/204204/selden"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507759312, "post_id": 46697799, "comment_id": 80344149, "body": "@JimB I would rather use a non-connected UDP socket.  Does the PacketConn API do that?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507759412, "post_id": 46697799, "comment_id": 80344185, "body": "@selden: use <code>ListenUDP</code> to create the socket."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 10, "last_activity_date": 1507817219, "last_edit_date": 1507817219, "creation_date": 1507757831, "answer_id": 46697958, "question_id": 46697799, "link": "https://stackoverflow.com/questions/46697799/golang-udp-connection-refused-on-every-other-write/46697958#46697958", "title": "golang udp connection refused on every other write", "body": "<p>If you look more closely at the packet capture, you'll notice that it <em>is</em> replying to every packet with an ICMP unreachable, and you are only <em>sending</em> every other packet. If you inspect the return value from <code>Write</code>, you'll also see that no data was written on every other packet. </p>\n\n<p>Because UDP has no real connection and there is no ACK for any packets sent, the best a \"connected\" UDP socket can do to simulate a send failure is to save the ICMP response, and return it as an error on the next write. </p>\n\n<p>So the first packet is sent, an ICMP unreachable message is received, the second send operation fails and returns the error, so no packet is sent, and the cycle repeats.</p>\n"}, {"tags": [], "owner": {"reputation": 139, "user_id": 3310346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af4082fff872a770c6427baeea723fa3?s=128&d=identicon&r=PG", "display_name": "Pedro A. Aranda", "link": "https://stackoverflow.com/users/3310346/pedro-a-aranda"}, "is_accepted": false, "score": -3, "last_activity_date": 1545201470, "creation_date": 1545201470, "answer_id": 53845808, "question_id": 46697799, "link": "https://stackoverflow.com/questions/46697799/golang-udp-connection-refused-on-every-other-write/53845808#53845808", "title": "golang udp connection refused on every other write", "body": "<p>Try</p>\n\n<pre><code>LocalAddr, err := net.ResolveUDPAddr(\"udp\", \":0\")\n</code></pre>\n\n<p>or</p>\n\n<pre><code>LocalAddr, err := net.ResolveUDPAddr(\"udp\", \"&lt;ip address of outgoing interface&gt;:0\")\n</code></pre>\n\n<p>This should work</p>\n"}], "owner": {"reputation": 303, "user_id": 204204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5474ac01095dc18e731eddf9a17b204a?s=128&d=identicon&r=PG", "display_name": "selden", "link": "https://stackoverflow.com/users/204204/selden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2476, "favorite_count": 2, "accepted_answer_id": 46697958, "answer_count": 2, "score": 2, "last_activity_date": 1545201470, "creation_date": 1507757079, "last_edit_date": 1507759359, "question_id": 46697799, "link": "https://stackoverflow.com/questions/46697799/golang-udp-connection-refused-on-every-other-write", "title": "golang udp connection refused on every other write", "body": "<p>I ran this UDP client program on ubuntu linux 16.04:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"time\"\n    \"strconv\"\n)\n\nfunc CheckError(err error) {\n    if err  != nil {\n        fmt.Println(\"Error: \" , err)\n    }\n}\n\nfunc main() {\n    ServerAddr,err := net.ResolveUDPAddr(\"udp\",\"127.0.0.1:10001\")\n    CheckError(err)\n\n    LocalAddr, err := net.ResolveUDPAddr(\"udp\", \"127.0.0.1:0\")\n    CheckError(err)\n\n    Conn, err := net.DialUDP(\"udp\", LocalAddr, ServerAddr)\n    CheckError(err)\n\n    defer Conn.Close()\n    i := 0\n    for {\n        msg := strconv.Itoa(i)\n        i++\n        buf := []byte(msg)\n        _,err := Conn.Write(buf)\n        if err != nil {\n            fmt.Println(msg, err)\n        }\n        time.Sleep(time.Second * 1)\n    }\n}\n</code></pre>\n\n<p>It produces this output:</p>\n\n<pre><code>$ go run server.go \n1 write udp 127.0.0.1:58703-&gt;127.0.0.1:10001: write: connection refused\n3 write udp 127.0.0.1:58703-&gt;127.0.0.1:10001: write: connection refused\n5 write udp 127.0.0.1:58703-&gt;127.0.0.1:10001: write: connection refused\n</code></pre>\n\n<p>But I expected this output instead:</p>\n\n<pre><code>$ go run server.go \n1 write udp 127.0.0.1:58703-&gt;127.0.0.1:10001: write: connection refused\n2 write udp 127.0.0.1:58703-&gt;127.0.0.1:10001: write: connection refused\n3 write udp 127.0.0.1:58703-&gt;127.0.0.1:10001: write: connection refused\n4 write udp 127.0.0.1:58703-&gt;127.0.0.1:10001: write: connection refused\n5 write udp 127.0.0.1:58703-&gt;127.0.0.1:10001: write: connection refused\n</code></pre>\n\n<p>tcpdump says:</p>\n\n<pre><code>15:28:46.453313 IP localhost.47993 &gt; localhost.10001: UDP, length 1\n15:28:46.453338 IP localhost &gt; localhost: ICMP localhost udp port 10001 unreachable, length 37\n15:28:48.453821 IP localhost.47993 &gt; localhost.10001: UDP, length 1\n15:28:48.453852 IP localhost &gt; localhost: ICMP localhost udp port 10001 unreachable, length 37\n15:28:50.454242 IP localhost.47993 &gt; localhost.10001: UDP, length 1\n15:28:50.454271 IP localhost &gt; localhost: ICMP localhost udp port 10001 unreachable, length 37\n</code></pre>\n\n<p>Why does this happen every other time conn.Write writes instead of every time?  I'm not blaming go, I just want to learn why.</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1507796230, "post_id": 46698898, "comment_id": 80356080, "body": "It does not work. <code>ManufacturerName</code> gets create but it&#39;s not a foreign key. If you insert a new item with <code>ManufacturerName = &#39;test&#39;</code> and <code>Manufacturer</code> does not have any entry for <code>test</code> it does not throw any error. Also, using PGAdmin, it seems like not creating any foreign key constraint at all. Anyways you should edit your answer fixing <i>foriegn</i> to <i>foreign</i>."}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "reply_to_user": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 1, "creation_date": 1507826933, "post_id": 46698898, "comment_id": 80376074, "body": "It looks like gorm has some problems with actually creating the foreign key (per <a href=\"https://github.com/jinzhu/gorm/issues/23\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/issues/23</a>), but it seems like you can use the <code>sql</code> tags to create the actual key - you just have to be careful about the order that you automigrate so that the table it references already exists."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 2, "last_activity_date": 1507826686, "last_edit_date": 1507826686, "creation_date": 1507763423, "answer_id": 46698898, "question_id": 46697365, "link": "https://stackoverflow.com/questions/46697365/unable-to-set-foreign-key-using-gorm-postgresql/46698898#46698898", "title": "Unable to set foreign key using gorm Postgresql", "body": "<p>You have to do something like:</p>\n\n<pre><code>type Item struct {\n    gorm.Model\n    Item         string       `gorm:\"primary_key\"`\n    ManufacturerName string   `sql:\"type:varchar REFERENCES manufacturers(name)\"`\n    Manufacturer Manufacturer `gorm:\"ForeignKey:ManufacturerName;AssociationForeignKey:Name`\n}\n</code></pre>\n\n<p>To tell it to a) Use ManufacturerName as the foreign key, and B) use Name on the other table.</p>\n\n<p>Or you can just do:</p>\n\n<pre><code>type Item struct {\n    gorm.Model\n    Item         string       `gorm:\"primary_key\"`\n    ManufacturerID uint       `sql:\"type:uint REFERENCES manufacturers(id)\"`\n    Manufacturer Manufacturer `gorm:\"ForeignKey:Man;AssociationForeignKey:Name\"`\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1565, "user_id": 11277952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e4df745b0605bf8cda35a1c441c988e?s=128&d=identicon&r=PG&f=1", "display_name": "Amanda", "link": "https://stackoverflow.com/users/11277952/amanda"}, "edited": false, "score": 0, "creation_date": 1579598760, "post_id": 57012237, "comment_id": 105810231, "body": "Would you be able help me with a similar issue <a href=\"https://stackoverflow.com/questions/59836572/why-does-foreign-key-not-get-generated-with-gorm\" title=\"why does foreign key not get generated with gorm\">stackoverflow.com/questions/59836572/&hellip;</a> Foreign key is not being created with GORM"}], "tags": [], "owner": {"reputation": 607, "user_id": 6436709, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/72xqA.jpg?s=128&g=1", "display_name": "Mike Sallese", "link": "https://stackoverflow.com/users/6436709/mike-sallese"}, "is_accepted": false, "score": 1, "last_activity_date": 1567611606, "last_edit_date": 1567611606, "creation_date": 1562955598, "answer_id": 57012237, "question_id": 46697365, "link": "https://stackoverflow.com/questions/46697365/unable-to-set-foreign-key-using-gorm-postgresql/57012237#57012237", "title": "Unable to set foreign key using gorm Postgresql", "body": "<p>I couldn't get any of the solutions I found working for this while following gorm's documentation / googling / stack overflow.  Here's what worked for me:</p>\n\n<p>I have a Call object &amp; TranscriptItem object. </p>\n\n<p>A call can have many transcript items but a transcript item can only have one call.</p>\n\n<p>Call object</p>\n\n<pre><code>type Call struct {\n    gorm.Model\n    DialInNumber      string\n}\n</code></pre>\n\n<p>Transcript object</p>\n\n<pre><code>type TranscriptItem struct {\n    gorm.Model\n    Transcript string\n    CallID     uint\n}\n</code></pre>\n\n<p>I have my auto migration and a manual AddForeignKey migration</p>\n\n<pre><code>    db.AutoMigrate(&amp;Call{}, &amp;TranscriptItem{})\n    db.Model(&amp;TranscriptItem{}).AddForeignKey(\"call_id\", \"calls(id)\", \"RESTRICT\", \"RESTRICT\")\n</code></pre>\n\n<p>I would've preferred to use the mechanics outlined in gorm's documentation, but at the end of the day I just needed something that worked.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7988783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6e2fafd3201b71c38ff4d569609b494?s=128&d=identicon&r=PG", "display_name": "Bilal Ko&#231;o\u011flu", "link": "https://stackoverflow.com/users/7988783/bilal-ko%c3%a7o%c4%9flu"}, "is_accepted": false, "score": 0, "last_activity_date": 1603925240, "creation_date": 1603925240, "answer_id": 64582411, "question_id": 46697365, "link": "https://stackoverflow.com/questions/46697365/unable-to-set-foreign-key-using-gorm-postgresql/64582411#64582411", "title": "Unable to set foreign key using gorm Postgresql", "body": "<p>Try this please</p>\n<pre><code>    type Item struct {\n        Item             string       `gorm:&quot;primary_key&quot;`\n        Manufacturer     Manufacturer `gorm:&quot;foreignKey:ManufacturerID;references:id&quot;`\n        ManufacturerID   int\n    }\n    \n    type Manufacturer struct {\n        ID uint\n        Name string\n    }\n\n    DB.AutoMigrate(&amp;Item{},&amp;Manufacturer{})\n\n    item := Item{\n        Item:         &quot;item&quot;,\n        Manufacturer: Manufacturer{\n            Name:     &quot;name&quot;\n        },\n    }\n    \n    DB.Create(&amp;item)\n</code></pre>\n"}], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4777, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1603925240, "creation_date": 1507755197, "last_edit_date": 1527756828, "question_id": 46697365, "link": "https://stackoverflow.com/questions/46697365/unable-to-set-foreign-key-using-gorm-postgresql", "title": "Unable to set foreign key using gorm Postgresql", "body": "<p>I'm building a Golang backend using <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">jinzhu/gorm</a> and I'm having some troubles trying to set up a relation between two tables e.g. <em>Items</em> and <em>Manufacturers</em> using a foreign key.</p>\n\n<p>I'm following the steps at <a href=\"http://jinzhu.me/gorm/models.html\" rel=\"nofollow noreferrer\">jinzhu.me/gorm/models</a> but I'm honestly finding myself puzzled coming from a more straightforward approach of manually writing tables etc, for instance, using <a href=\"https://github.com/lib/pq\" rel=\"nofollow noreferrer\">go pq</a>.</p>\n\n<p><strong>item.go</strong>:</p>\n\n<pre><code>package model\n\nimport \"github.com/jinzhu/gorm\"\n\ntype Item struct {\n    gorm.Model\n    Item         string       `gorm:\"primary_key\"`\n    Manufacturer Manufacturer `gorm:\"ForeignKey:Name\"`\n}\n</code></pre>\n\n<p><strong>manufacturer.go</strong>:</p>\n\n<pre><code>package model\n\nimport \"github.com/jinzhu/gorm\"\n\ntype Manufacturer struct {\n    gorm.Model\n    Name string `gorm:\"primary_key\"`\n}\n</code></pre>\n\n<p>I get no errors nor warnings. Inspecting my tables I noticed no correlation was created. Item does not have Manufacturer field.</p>\n\n<p>What I tried so far:</p>\n\n<ul>\n<li>Not explicitly writing <code>gorm:\"ForeignKey:Name\"</code> since <code>Manufacturer</code> field is already a <code>Manufacturer</code></li>\n<li>Writing <code>gorm:\"ForeignKey:Name;AssociationForeignKey:Name\"</code></li>\n<li>Manually associating them with <code>db.Model(&amp;model.Item{}).Related(&amp;model.Manufacturer{})</code></li>\n<li>Manually associating them with <code>db.Model(&amp;model.Item{}).Related(&amp;model.Manufacturer{}, \"Manufacturer\")</code></li>\n<li>Manually associating them with <code>db.Model(\"items\").Related(\"manufacturers\")</code>. They get created with this name on Postgresql even though their model's name is singular.</li>\n</ul>\n\n<p><strong>EDIT</strong>:</p>\n\n<p>Trying something like</p>\n\n<pre><code>type Item struct {\n    Item             string       `gorm:\"primary_key\"`\n    Manufacturer     Manufacturer\n    ManufacturerID   int\n}\n\ntype Manufacturer struct {\n    ID uint\n    Name string\n}\n</code></pre>\n\n<p>Leads to the same result. No foreign key is created and I'm able to insert new items with a non-existent <code>Manufacturer</code>.</p>\n\n<p><strong>What Am I doing wrong? Am I missing something?</strong></p>\n"}, {"tags": ["pointers", "go", "struct", "constructor"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11937"}, "edited": false, "score": 0, "creation_date": 1507753425, "post_id": 46696618, "comment_id": 80341559, "body": "Please explain to me why this is a duplicate"}, {"owner": {"reputation": 37744, "user_id": 578411, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qj33e.png?s=128&g=1", "display_name": "rene", "link": "https://stackoverflow.com/users/578411/rene"}, "edited": false, "score": 1, "creation_date": 1507753939, "post_id": 46696618, "comment_id": 80341814, "body": "@JimB your dupe hammer is friendly challenged. I assume the both of you manage to work this out in an orderly manner?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507754908, "post_id": 46696618, "comment_id": 80342320, "body": "The actual determinant for returning a pointer or not is dependent on the context, and sometimes just personal preference. The <i>reasons</i> you may choose one over the other are clearly laid out in the duplicates. The reasons why you could always return a struct value <i>in this particular case</i>  are covered as well. Seeing how there are many cases where you need to use a pointer, the additional question of &quot;why can&#39;t I always not use a pointer&quot; doesn&#39;t seem to make sense."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507794425, "post_id": 46696618, "comment_id": 80355058, "body": "After reading the answers to the two duplicates, what questions remain?"}], "owner": {"user_type": "does_not_exist", "display_name": "user11937"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1886, "favorite_count": 0, "closed_date": 1507752878, "answer_count": 0, "score": 0, "last_activity_date": 1507754052, "creation_date": 1507752244, "last_edit_date": 1507752936, "question_id": 46696618, "link": "https://stackoverflow.com/questions/46696618/why-would-you-return-a-pointer-to-a-newly-created-struct-in-go", "closed_reason": "Duplicate", "title": "Why would you return a pointer to a newly created struct in Go?", "body": "<p>A lot of examples out there (like <a href=\"https://golang.org/doc/effective_go.html#composite_literals\" rel=\"nofollow noreferrer\">this</a>) show something like:</p>\n\n<pre><code>type person struct {\n    name string\n    age int\n}\n\nfunc NewPerson(n string, a int) *person {\n    p := person{n, a}\n    return &amp;p\n}\n</code></pre>\n\n<p>Whilst I'm comfortable with the mechanics of the above, there seems to be an idiom of always returning a pointer to the new struct.</p>\n\n<p>Why wouldn't you simply <strong>always</strong> return the actual struct itself, rather than a pointer to it?</p>\n\n<p>The struct is small, and future mutability doesn't come into it as mentioned in <a href=\"https://stackoverflow.com/questions/23542989\">this question</a>. Also, that question doesn't specifically address the constructor idiom. Is it all about perceived efficiency and memory?</p>\n"}, {"tags": ["go", "swagger"], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "edited": false, "score": 2, "creation_date": 1507793795, "post_id": 46696831, "comment_id": 80354723, "body": "@exebook: It follows the same rules as <code>encoding&#47;json</code> for the json key. That is to say, it uses the field struct name by default, and that default can be overridden with the json tag. If you&#39;re using <code>{id}</code> in the path definition, then yes, the json tag is probably necessary.  If you use <code>{ID}</code> in the path definition, then no json tag would be necessary. I would tend toward <code>{ID}</code> in the path in my own code, but you can of course use it however you want."}, {"owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "edited": false, "score": 1, "creation_date": 1507796026, "post_id": 46696831, "comment_id": 80355976, "body": "that would be great to have in the answer"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1507793854, "last_edit_date": 1507793854, "creation_date": 1507753053, "answer_id": 46696831, "question_id": 46696584, "link": "https://stackoverflow.com/questions/46696584/go-swagger-with-path-param/46696831#46696831", "title": "go-swagger with path param", "body": "<p>The struct field needs to be exported.  Try:</p>\n\n<pre><code>type DeleteRequest struct {\n    // ID of an item\n    //\n    // In: path\n    ID string `json:\"id\"`\n</code></pre>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1385, "favorite_count": 0, "accepted_answer_id": 46696831, "answer_count": 1, "score": 0, "last_activity_date": 1507793854, "creation_date": 1507752136, "question_id": 46696584, "link": "https://stackoverflow.com/questions/46696584/go-swagger-with-path-param", "title": "go-swagger with path param", "body": "<p>Route:</p>\n\n<pre><code>// swagger:route DELETE /v1/path/{id} api DeleteV1\n//\n// Deletes an item.\n//\n//     Schemes: https\n//\n//     Responses:\n//       202: AcceptedResponse\n//       401: UnauthorizedErrorResponse\n//       500: InternalServerErrorResponse\n\"/v1/path/{id}\": {\n    \"DELETE\":  Handle(DeleteRequest{}),\n    \"OPTIONS\": s.handleOptionsRequest,\n},\n</code></pre>\n\n<p>Params/response model:</p>\n\n<pre><code>// Description\n//\n// swagger:parameters DeleteV1\ntype DeleteRequest struct {\n    // id of an item\n    //\n    // In: path\n    id string `json:\"id\"`\n\n    cookies  []*http.Cookie\n}\n\n// Description\n//\n// swagger:response DeleteResponse\ntype DeleteResponse struct {\n}\n</code></pre>\n\n<p>I keep getting <code>- path param \"{id}\" has no parameter definition</code> whatever I try.</p>\n\n<p>The endpoint takes only path param \"id\", cookies (they are not visible in a swagger model) and returns an empty body and an HTTP status code.</p>\n\n<p>How to make go-swagger see the \"parameter definition\"for the \"{id}\"?</p>\n"}, {"tags": ["javascript", "go", "websocket"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 2, "creation_date": 1507755703, "post_id": 46696403, "comment_id": 80342700, "body": "At first look you&#39;re ignoring the error in this line: <code>*s, _ = reader.ReadString(&#39;\\n&#39;)</code> Also remember that each request will be handle for an individual goroutine so if you want to keep some global state you should use mutex or something to avoid race conditions."}, {"owner": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507756101, "post_id": 46696403, "comment_id": 80342883, "body": "I understand your point but i am trying to create a simple example which will help me later. I am planning to use channel or array of objects which are being changed dynamically."}], "answers": [{"tags": [], "owner": {"reputation": 867, "user_id": 6531129, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3741d495ced91c057769a904b8ee6c26?s=128&d=identicon&r=PG&f=1", "display_name": "AESTHETICS", "link": "https://stackoverflow.com/users/6531129/aesthetics"}, "is_accepted": true, "score": 2, "last_activity_date": 1507796703, "creation_date": 1507796703, "answer_id": 46704813, "question_id": 46696403, "link": "https://stackoverflow.com/questions/46696403/pushing-changes-to-client-using-websockets-golang/46704813#46704813", "title": "Pushing changes to client using websockets Golang", "body": "<p>Simply putting <code>websocket.Message.Receive</code> in the if statement fixes the problem.</p>\n\n<pre><code>package main\n\nimport (\n   \"golang.org/x/net/websocket\"\n   \"fmt\"\n   \"net/http\"\n   \"os\"\n   \"bufio\"\n)\n\ntype chat struct {\n   message string\n}\n\nfunc (ms *chat) Echo(ws *websocket.Conn) {\n   var reply string\n      for {\n         if reply !=  ms.message {\n            websocket.Message.Send(ws, ms.message)\n            websocket.Message.Receive(ws, &amp;reply)\n         }\n\n      }\n}\n\nfunc NewMessage(s *string){\nreader := bufio.NewReader(os.Stdin)\nfor {\n   fmt.Print(\"Enter text: \")\n   *s, _ = reader.ReadString('\\n')\n  }\n}\n\nfunc main() {\n   myString := chat{\"Welcome\"}\n   go NewMessage(&amp;myString.message)\n   http.Handle(\"/\", websocket.Handler(myString.Echo))\n   http.ListenAndServe(\":1234\", nil)\n}\n</code></pre>\n"}], "owner": {"reputation": 207, "user_id": 8761117, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/16acc432246d077441e7eeb7a2d116cb?s=128&d=identicon&r=PG&f=1", "display_name": "HowToGo", "link": "https://stackoverflow.com/users/8761117/howtogo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1190, "favorite_count": 1, "accepted_answer_id": 46704813, "answer_count": 1, "score": 2, "last_activity_date": 1507796703, "creation_date": 1507751456, "question_id": 46696403, "link": "https://stackoverflow.com/questions/46696403/pushing-changes-to-client-using-websockets-golang", "title": "Pushing changes to client using websockets Golang", "body": "<p>I have been trying to push changes done on server side using websockets in Golang.</p>\n\n<p>I have achived what i wanted by this code</p>\n\n<p>Server side code:</p>\n\n<pre><code>package main\n\nimport (\n   \"golang.org/x/net/websocket\"\n   \"fmt\"\n   \"net/http\"\n   \"os\"\n   \"bufio\"\n)\n\ntype chat struct {\n    message string\n}\n\nfunc (ms *chat) Echo(ws *websocket.Conn) {\n    var reply string\n    for {\n         if reply !=  ms.message {\n         websocket.Message.Send(ws, ms.message)\n         }\n         websocket.Message.Receive(ws, reply)\n    }\n}\n\nfunc NewMessage(s *string){\n   reader := bufio.NewReader(os.Stdin)\n   for {\n       fmt.Print(\"Enter text: \")\n       *s, _ = reader.ReadString('\\n')\n       }\n   }\n\nfunc main() {\n   myString := chat{\"Welcome\"}\n   go NewMessage(&amp;myString.message)\n   http.Handle(\"/\", websocket.Handler(myString.Echo))\n   http.ListenAndServe(\":1234\", nil)\n}\n</code></pre>\n\n<p>Client side code:</p>\n\n<pre><code>&lt;html&gt;\n&lt;body&gt;\n&lt;script type=\"text/javascript\"&gt;\n    var exampleSocket = new WebSocket(\"ws://127.0.0.1:1234\");\n\n    exampleSocket.onopen = function (event) {\n    console.log(\"connected\");\n    };\n\n    exampleSocket.onmessage = function (event) {\n        console.log(event.data);\n        exampleSocket.send(event.data)\n        document.getElementById(\"p1\").innerHTML = event.data;\n    }\n\n\n&lt;/script&gt;\n&lt;h1&gt;WebSockets&lt;/h1&gt;\n&lt;form&gt;\n    &lt;p id=\"p1\" value=\"Hello, world!\"/&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>\n</p>\n\n<p>The problem with above code is repeatedly sending ms.message as <code>if reply !=  ms.message</code> does not work. Simply <code>var reply string</code> value is not being changed by <code>websocket.Message.Receive(ws, reply)</code>.</p>\n\n<p>I have tried passing <code>reply</code> as a pointer but it does not update value on the client side dynamically.</p>\n\n<p>Here is how server side would look like after the change:</p>\n\n<pre><code>package main\n\nimport (\n   \"golang.org/x/net/websocket\"\n   \"fmt\"\n   \"net/http\"\n   \"os\"\n   \"bufio\"\n)\n\ntype chat struct {\n    message string\n}\n\nfunc (ms *chat) Echo(ws *websocket.Conn) {\n    var reply string\n    for {\n         if reply !=  ms.message {\n         websocket.Message.Send(ws, ms.message)\n         }\n         websocket.Message.Receive(ws, &amp;reply)\n    }\n}\n\nfunc NewMessage(s *string){\n   reader := bufio.NewReader(os.Stdin)\n   for {\n       fmt.Print(\"Enter text: \")\n       *s, _ = reader.ReadString('\\n')\n       }\n   }\n\nfunc main() {\n   myString := chat{\"Welcome\"}\n   go NewMessage(&amp;myString.message)\n   http.Handle(\"/\", websocket.Handler(myString.Echo))\n   http.ListenAndServe(\":1234\", nil)\n}\n</code></pre>\n\n<p>This code does not fit my expectations.</p>\n\n<p>Is it possible to dynamically update string on clients side without sending value multiple times as it is being done in the example number 1?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-sdk", "dev-appserver"], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 7836768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550083c73775e651fe894122315a87df?s=128&d=identicon&r=PG&f=1", "display_name": "Kieran W.", "link": "https://stackoverflow.com/users/7836768/kieran-w"}, "edited": false, "score": 1, "creation_date": 1507746320, "post_id": 46694946, "comment_id": 80337977, "body": "That&#39;s quite a surprise. Under google-cloud-sdk &gt; platform &gt; google_appengine I see both &quot;goroot1.6&quot; and &quot;goroot1.8&quot; so I assumed both was supported."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 107, "user_id": 7836768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550083c73775e651fe894122315a87df?s=128&d=identicon&r=PG&f=1", "display_name": "Kieran W.", "link": "https://stackoverflow.com/users/7836768/kieran-w"}, "edited": false, "score": 0, "creation_date": 1507747693, "post_id": 46694946, "comment_id": 80338737, "body": "@KieranW. No, thank YOU! I&#39;m glad you noticed this, now I can start migrating my own projects over to participate in the beta."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 1, "last_activity_date": 1507825922, "last_edit_date": 1507825922, "creation_date": 1507745575, "answer_id": 46694946, "question_id": 46694813, "link": "https://stackoverflow.com/questions/46694813/dev-appserver-using-goroot-1-6-instead-of-1-8/46694946#46694946", "title": "dev_appserver using goroot 1.6 instead of 1.8", "body": "<p><strike>The Go App Engine SDK uses 1.6, there is no way to run a higher Go version in App Engine.</strike> Their systems are finely tuned to work with a specific version and subset of features. A large production environment like App Engine has to go through an enormous amount of R&amp;D to push new SDK versions. You just have to wait for new versions to trickle out and use what is available. </p>\n\n<p>That said, if you really need to use a newer version of Go, you can always spin up a Compute Engine server, but you lose all the convenience of the standard or flex environments like auto scaling.</p>\n\n<p>EDIT: As of June 27, 2017 they have enabled Go 1.8 as BETA in the SDK. See info in the release notes here: <a href=\"https://cloud.google.com/appengine/docs/standard/go/release-notes\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/go/release-notes</a></p>\n\n<blockquote>\n  <p>June 27, 2017</p>\n  \n  <p>Go runtime notes</p>\n  \n  <p>Updated Go SDK to version 1.9.55 Enable the Go 1.8 beta This release\n  adds beta support for go1.8. To use Go 1.8, set api_version: go1.8 in\n  your app.yaml configuration file. You must also use App Engine SDK,\n  not Cloud SDK. To download the App Engine SDK, go to the Downloads\n  page and at the bottom of the page, expand the Or, you can download\n  the original App Engine SDK for Go section.</p>\n</blockquote>\n\n<p>But notice that even as of Oct 3, 2017 they still call 1.8 beta.</p>\n\n<blockquote>\n  <p>October 3, 2017</p>\n  \n  <p>Updated Go SDK to 1.9.59 Fixed bug in dev_appserver.py which used\n  incorrect build constraints for the Go 1.8 beta.</p>\n</blockquote>\n\n<p>EDIT2: After a little tinkering, don't be alarmed if <code>goapp version</code> still prints <code>1.6.4</code>, it defaults to this. You have to be in the directory with the <code>app.yaml</code> with <code>api_version: go1.8</code> or it won't show. The <code>goapp</code> in the base directory is a script that parses the <code>app.yaml</code> to determine which version to use.</p>\n"}], "owner": {"reputation": 107, "user_id": 7836768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/550083c73775e651fe894122315a87df?s=128&d=identicon&r=PG&f=1", "display_name": "Kieran W.", "link": "https://stackoverflow.com/users/7836768/kieran-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1507825922, "creation_date": 1507745104, "question_id": 46694813, "link": "https://stackoverflow.com/questions/46694813/dev-appserver-using-goroot-1-6-instead-of-1-8", "title": "dev_appserver using goroot 1.6 instead of 1.8", "body": "<p>I just updated google-cloud-sdk, and now dev_appserver is using goroot 1.6 instead of 1.8 so a bunch of stuff is not being recognised. Have looked all over the place, how do I tell dev_appserver to use goroot 1.8 instead of 1.6 ? It seems incredibly trivial.</p>\n"}, {"tags": ["go", "command-line-arguments"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 6, "last_activity_date": 1507799119, "last_edit_date": 1507799119, "creation_date": 1507744568, "answer_id": 46694673, "question_id": 46694638, "link": "https://stackoverflow.com/questions/46694638/how-to-document-the-rest-of-argv-in-golang-flags/46694673#46694673", "title": "How to document the rest of argv in golang flags?", "body": "<p>My preferred approach is just to set <a href=\"https://godoc.org/flag#pkg-variables\" rel=\"nofollow noreferrer\"><code>flag.Usage</code></a> to a function which prints the additional documentation.</p>\n\n<p>For example:</p>\n\n<pre><code>flag.Usage = func() {\n    fmt.Fprintf(os.Stderr, \"usage: %s [flags] &lt;paths...&gt;\\n\", os.Args[0])\n    flag.PrintDefaults()\n    fmt.Fprintf(os.Stderr, \"Argument documention goes here\\n\")\n}\n</code></pre>\n"}], "owner": {"reputation": 19178, "user_id": 350106, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/dfe88469b75efc87cbcbbbc2a975850a?s=128&d=identicon&r=PG", "display_name": "mcandre", "link": "https://stackoverflow.com/users/350106/mcandre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1507799119, "creation_date": 1507744444, "question_id": 46694638, "link": "https://stackoverflow.com/questions/46694638/how-to-document-the-rest-of-argv-in-golang-flags", "title": "How to document the rest of argv in golang flags?", "body": "<p>As a microservices author, I appreciate how powerful the standard library's flag pacakge is, providing a lightweight way to document command line flags. However, the built-in <code>-help</code> option appears to present documentation for only the flags themselves, while the rest of the command line arguments are often idiosyncratic, requiring documentation as well. What is a good way to document the rest of the CLI arguments, such as a Go application that accepts some flags, and then treats the rest of the arguments as file paths?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1507741023, "post_id": 46693653, "comment_id": 80335171, "body": "You have something wrong with your Go installation. Either you have GOROOT set when it shouldn&#39;t be, you are invoking the wrong <code>go</code> binary, or the source in <code>GOROOT</code> doesn&#39;t match the tools and they need to be recompiled."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507747839, "post_id": 46693653, "comment_id": 80338809, "body": "when you update Go remember delete <b>/usr/local/go</b> folder"}, {"owner": {"reputation": 331, "user_id": 2583075, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5f3Xp.png?s=128&g=1", "display_name": "Lomanic", "link": "https://stackoverflow.com/users/2583075/lomanic"}, "edited": false, "score": 1, "creation_date": 1507810990, "post_id": 46693653, "comment_id": 80365399, "body": "You should post the result of <code>go env</code>."}, {"owner": {"reputation": 33170, "user_id": 48136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f31c7fbcbb0766d0632d96fd7e74b649?s=128&d=identicon&r=PG", "display_name": "Brice", "link": "https://stackoverflow.com/users/48136/brice"}, "edited": false, "score": 2, "creation_date": 1518094100, "post_id": 46693653, "comment_id": 84369145, "body": "In my case IntelliJ IDEA / Golang IDE set <code>GOROOT</code> to a previous version of Go installed by homebrew."}], "answers": [{"comments": [{"owner": {"reputation": 858, "user_id": 2364774, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/IQ3Uc.jpg?s=128&g=1", "display_name": "Elton Garcia de Santana", "link": "https://stackoverflow.com/users/2364774/elton-garcia-de-santana"}, "edited": false, "score": 0, "creation_date": 1609193464, "post_id": 46695135, "comment_id": 115774490, "body": "I faced this problem after a brew update. To fix it I installed the old version using the command:  <code>brew link go@1.14</code> And after that a changed the <code>GOROOT</code> value to: <code>GOROOT=&#47;usr&#47;local&#47;opt&#47;go@1.14&#47;libexec</code>"}, {"owner": {"reputation": 440, "user_id": 6047557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f95e6e714cdc9f1c7d1df1d9398cad0e?s=128&d=identicon&r=PG&f=1", "display_name": "perennial_noob", "link": "https://stackoverflow.com/users/6047557/perennial-noob"}, "edited": false, "score": 0, "creation_date": 1610584415, "post_id": 46695135, "comment_id": 116183208, "body": "In my case I got a new laptop. I copied all my code and bashrc and other such files ontor my new laptop so that I could leverage the same aliases/vars etc. I think the go installation was done freshly on the new laptop and so this path didn&#39;t match up. This solution helped."}], "tags": [], "owner": {"reputation": 1157, "user_id": 1490379, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/6fa43f585a3ddf8c5909bd817086706d?s=128&d=identicon&r=PG", "display_name": "ksrb", "link": "https://stackoverflow.com/users/1490379/ksrb"}, "is_accepted": false, "score": 31, "last_activity_date": 1619074028, "last_edit_date": 1619074028, "creation_date": 1507746315, "answer_id": 46695135, "question_id": 46693653, "link": "https://stackoverflow.com/questions/46693653/compile-version-go1-9-does-not-match-go-tool-version-go1-9-1/46695135#46695135", "title": "compile: version &quot;go1.9&quot; does not match go tool version &quot;go1.9.1&quot;", "body": "<p>If you are installing using OSX homebrew you may need to set the <code>$GOROOT</code> in your <code>.bashrc</code>, <code>.zshrc</code>, etc:</p>\n<pre><code>export GOROOT=/usr/local/opt/go/libexec\n</code></pre>\n<p>I had the same error this morning when I updated from 1.9 -&gt; 1.9.1 though according to several post the <code>$GOROOT</code> shouldn't have to be set and I had not set it until today. <strike>This may be a bug?</strike></p>\n<p>Edit: not a bug, for more details see <a href=\"https://stackoverflow.com/a/53661370/1490379\">answer below</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "is_accepted": false, "score": 3, "last_activity_date": 1522949708, "creation_date": 1522949708, "answer_id": 49678284, "question_id": 46693653, "link": "https://stackoverflow.com/questions/46693653/compile-version-go1-9-does-not-match-go-tool-version-go1-9-1/49678284#49678284", "title": "compile: version &quot;go1.9&quot; does not match go tool version &quot;go1.9.1&quot;", "body": "<p>This error happens when you forgot to delete previous golang install ... just delete its directory ... so identify go install location ... on linux issue</p>\n\n<pre><code>type go\n</code></pre>\n\n<p>typical output is</p>\n\n<pre><code>go is hashed (/usr/local/go/bin/go)\n</code></pre>\n\n<p>so just remove its grandparent directory ( go install not just its binary )</p>\n\n<pre><code>sudo rm -rf /usr/local/go   #  NOTE this is not /usr/local/go/bin/go\n</code></pre>\n\n<p>now just install go and you'll be fine</p>\n"}, {"tags": [], "owner": {"reputation": 384, "user_id": 2148381, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NJ7WF.jpg?s=128&g=1", "display_name": "Han.Oliver", "link": "https://stackoverflow.com/users/2148381/han-oliver"}, "is_accepted": false, "score": 14, "last_activity_date": 1525491118, "creation_date": 1525491118, "answer_id": 50185453, "question_id": 46693653, "link": "https://stackoverflow.com/questions/46693653/compile-version-go1-9-does-not-match-go-tool-version-go1-9-1/50185453#50185453", "title": "compile: version &quot;go1.9&quot; does not match go tool version &quot;go1.9.1&quot;", "body": "<p>in case you are using mac with homebrew, just run:\n<code>\nbrew cleanup\n</code></p>\n\n<p>to clean all the legacy package, this fixed my problem.</p>\n"}, {"tags": [], "owner": {"reputation": 91, "user_id": 4417678, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh3.googleusercontent.com/-MrwklBTNP8g/AAAAAAAAAAI/AAAAAAAAAeQ/ezQ_9ZRH0K0/photo.jpg?sz=128", "display_name": "Mohammad", "link": "https://stackoverflow.com/users/4417678/mohammad"}, "is_accepted": false, "score": 1, "last_activity_date": 1537792210, "creation_date": 1537792210, "answer_id": 52479472, "question_id": 46693653, "link": "https://stackoverflow.com/questions/46693653/compile-version-go1-9-does-not-match-go-tool-version-go1-9-1/52479472#52479472", "title": "compile: version &quot;go1.9&quot; does not match go tool version &quot;go1.9.1&quot;", "body": "<p>In mac OS , if you downloaded and installed go package without brew, running brew update commands will cause this problem to occur\nfor fix this problem you can do :\nbrew uninstall --ignore-dependencies go\nuninstalling go from brew will fix problem</p>\n"}, {"tags": [], "owner": {"reputation": 1756, "user_id": 4382528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc7934e4513a44e0b0f0b138ace19ac8?s=128&d=identicon&r=PG", "display_name": "Yoruba", "link": "https://stackoverflow.com/users/4382528/yoruba"}, "is_accepted": false, "score": 0, "last_activity_date": 1542899828, "creation_date": 1542899828, "answer_id": 53433939, "question_id": 46693653, "link": "https://stackoverflow.com/questions/46693653/compile-version-go1-9-does-not-match-go-tool-version-go1-9-1/53433939#53433939", "title": "compile: version &quot;go1.9&quot; does not match go tool version &quot;go1.9.1&quot;", "body": "<p>For Windows delete the GOROOT System variables in the Enviroment Variables and restart the PC.</p>\n\n<p><a href=\"https://i.stack.imgur.com/L4hvx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/L4hvx.png\" alt=\"enter image description here\"></a></p>\n"}, {"comments": [{"owner": {"reputation": 1629, "user_id": 5839563, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k7Dvf.jpg?s=128&g=1", "display_name": "Zhenhua", "link": "https://stackoverflow.com/users/5839563/zhenhua"}, "edited": false, "score": 0, "creation_date": 1566599261, "post_id": 53661370, "comment_id": 101720454, "body": "The second option in macOS section worked for me and thanks for the good explanation as well."}], "tags": [], "owner": {"reputation": 319, "user_id": 2809232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da0df83f7732c5e47505ac0072308426?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Miller", "link": "https://stackoverflow.com/users/2809232/aaron-miller"}, "is_accepted": false, "score": 15, "last_activity_date": 1544140124, "creation_date": 1544140124, "answer_id": 53661370, "question_id": 46693653, "link": "https://stackoverflow.com/questions/46693653/compile-version-go1-9-does-not-match-go-tool-version-go1-9-1/53661370#53661370", "title": "compile: version &quot;go1.9&quot; does not match go tool version &quot;go1.9.1&quot;", "body": "<p>This is a mismatch between the <code>GOROOT</code> environment variable and the default path to your <code>go</code> command. One or the other needs to be changed; the one that needs to be changed depends on the specific setup on your computer. You could determine this by updating your Go to the latest version using your preferred method, running either <code>which go</code> (on Linux/macOS/BSD) or <code>where go</code> (on Windows), and then checking which of the files listed has the newer timestamp.</p>\n\n<h2>Linux/macOS/BSD</h2>\n\n<ul>\n<li>To change the <code>GOROOT</code> to match the default path of your <code>go</code> command, run <code>type go</code> and strip off the <code>/bin/go</code> part at the end to yield the directory path containing your Go installation. Then, add it to your <code>.bashrc</code> or other appropriate init file like this:</li>\n</ul>\n\n<p><code>export GOROOT=/path/to/go-installation\n</code></p>\n\n<ul>\n<li>To instead change the <code>go</code> command path to match your <code>GOROOT</code>, add this to the bottom of your init file:</li>\n</ul>\n\n<p><code>export PATH=\"${GOROOT}/bin:${PATH}\"\n</code></p>\n\n<h2>Windows</h2>\n\n<ul>\n<li><p>To change the <code>GOROOT</code> to match the default path of your <code>go</code> command, run <code>where go</code> take the first line of output, and strip off the <code>\\bin\\go.exe</code> part at the end. Then, go to \"Edit the system environment variables\" in Settings, click \"Environment Variables...\", find the \"GOROOT\" variable and edit to read the path you created earlier.</p></li>\n<li><p>To instead change the <code>go</code> command path to match your <code>GOROOT</code>, first save the output of <code>echo %GOROOT%\\bin</code>. Then, go to \"Edit the system environment variables\" in Settings, click \"Environment Variables...\", and find the \nfind the \"Path\" row in the bottom pane, click New, put in the path you created earlier, and finally click Move Up until it's at the top.</p></li>\n</ul>\n\n<h2>All</h2>\n\n<p>You'll need to open up a new command prompt to see the effects.</p>\n"}, {"tags": [], "owner": {"reputation": 354, "user_id": 2169951, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fecf52737a2b6902cd7e8e9abb4f0d7d?s=128&d=identicon&r=PG", "display_name": "M. Gopal", "link": "https://stackoverflow.com/users/2169951/m-gopal"}, "is_accepted": false, "score": -1, "last_activity_date": 1553341075, "creation_date": 1553341075, "answer_id": 55313335, "question_id": 46693653, "link": "https://stackoverflow.com/questions/46693653/compile-version-go1-9-does-not-match-go-tool-version-go1-9-1/55313335#55313335", "title": "compile: version &quot;go1.9&quot; does not match go tool version &quot;go1.9.1&quot;", "body": "<p>Took a simple approach(Linux),  I had different versions of Go installed in my system. </p>\n\n<blockquote>\n  <p>$ whereis go</p>\n</blockquote>\n\n<p>helped me to find the available go runnables, removed all, installed a fresh one and ensured to create a link for this new Go runnable in one of the $PATH folder to ensure below gives the correct version of what installed now.</p>\n\n<blockquote>\n  <p>$ go version</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 141, "user_id": 7544682, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/959e9880c00ffa0ab0b6027eb2bd1899?s=128&d=identicon&r=PG&f=1", "display_name": "Borkes", "link": "https://stackoverflow.com/users/7544682/borkes"}, "is_accepted": false, "score": 0, "last_activity_date": 1574428139, "creation_date": 1574428139, "answer_id": 58994965, "question_id": 46693653, "link": "https://stackoverflow.com/questions/46693653/compile-version-go1-9-does-not-match-go-tool-version-go1-9-1/58994965#58994965", "title": "compile: version &quot;go1.9&quot; does not match go tool version &quot;go1.9.1&quot;", "body": "<p>if you use VsCode, you just add this in setting.json.</p>\n\n<pre><code>\"go.goroot\": \"/usr/local/Cellar/go/1.x.x/libexec\",\n</code></pre>\n"}], "owner": {"reputation": 1354, "user_id": 6412942, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c8302ba86cf28126f773c6f40573c175?s=128&d=identicon&r=PG&f=1", "display_name": "leopoodle", "link": "https://stackoverflow.com/users/6412942/leopoodle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15984, "favorite_count": 6, "answer_count": 8, "score": 24, "last_activity_date": 1619074028, "creation_date": 1507740630, "last_edit_date": 1507750049, "question_id": 46693653, "link": "https://stackoverflow.com/questions/46693653/compile-version-go1-9-does-not-match-go-tool-version-go1-9-1", "title": "compile: version &quot;go1.9&quot; does not match go tool version &quot;go1.9.1&quot;", "body": "<p>I am getting this error when I tried to run an example helloworld code I got onlie.</p>\n\n<pre><code>compile: version \"go1.9\" does not match go tool version \"go1.9.1\"\n</code></pre>\n\n<p>My computer has go1.9.1. What does the error mean and how can I fix this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1507737077, "post_id": 46692603, "comment_id": 80332864, "body": "There&#39;s nothing concurrent here, so there can&#39;t be any race."}, {"owner": {"reputation": 6023, "user_id": 4236078, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/9959d878feda9f2bab4b43b554e09847?s=128&d=identicon&r=PG&f=1", "display_name": "ale64bit", "link": "https://stackoverflow.com/users/4236078/ale64bit"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507737788, "post_id": 46692603, "comment_id": 80333309, "body": "@JimB thanks. Is it idiomatic or there&#39;s a better way to do this?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1507737964, "post_id": 46692603, "comment_id": 80333406, "body": "To do what? What is the objective? There&#39;s no reason you can&#39;t set a variable in a defer statement, but whether it&#39;s idiomatic depends on your goal."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1507740710, "post_id": 46692603, "comment_id": 80334963, "body": "It definitely makes the code less readable and understandable to do it this way."}, {"owner": {"reputation": 6023, "user_id": 4236078, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/9959d878feda9f2bab4b43b554e09847?s=128&d=identicon&r=PG&f=1", "display_name": "ale64bit", "link": "https://stackoverflow.com/users/4236078/ale64bit"}, "edited": false, "score": 0, "creation_date": 1507743869, "post_id": 46692603, "comment_id": 80336646, "body": "Thanks all that commented. For those suggesting to close, may I ask what is unclear in the question? I&#39;m just asking if it&#39;s idiomatic to do that or to paste the <code>ret.bar = &quot;after&quot;</code> before every <code>return ret</code> in the function body."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1507744659, "post_id": 46692603, "comment_id": 80337130, "body": "It was a bit unclear because your example doesn&#39;t seem to do anything useful. It probably would have been more clear to add an <code>error</code> case return or something to the function to make it clear what you are doing and why. e.g. <a href=\"https://play.golang.org/p/U6dJw9Z7Cs\" rel=\"nofollow noreferrer\">play.golang.org/p/U6dJw9Z7Cs</a>"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507747912, "post_id": 46692603, "comment_id": 80338834, "body": "<a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">blog.golang.org/defer-panic-and-recover</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": true, "score": 1, "last_activity_date": 1507746119, "creation_date": 1507746119, "answer_id": 46695071, "question_id": 46692603, "link": "https://stackoverflow.com/questions/46692603/is-deferring-a-field-assignation-a-race-condition/46695071#46695071", "title": "Is deferring a field assignation a race condition?", "body": "<p>The main benefit of using <code>defer</code> statement versus invoking something before returning from a function or routine is <code>defer</code> will run the statement even when a panic occurs before returning. </p>\n\n<p>Thus it is commonly used to clean up resources (such as closing a file or network connection) rather than to set state.</p>\n\n<p>The function below will not print or return \"hello\" </p>\n\n<pre><code>func f() string {\n        panic(\"omg\")\n        fmt.Println(\"hello\")\n        return \"hello\"\n}\n</code></pre>\n\n<p>This code will print but won't return \"hello\"</p>\n\n<pre><code>func f() string {\n        defer fmt.Println(\"ello\")\n        panic(\"omg\")\n        return \"hello\"\n}\n</code></pre>\n\n<p>To answer your question: No, it won't result in a race. Apart from the above difference, it is equivalent to calling something before the <code>return</code> statement.</p>\n"}, {"tags": [], "owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "is_accepted": false, "score": 1, "last_activity_date": 1507751488, "last_edit_date": 1507751488, "creation_date": 1507750627, "answer_id": 46696202, "question_id": 46692603, "link": "https://stackoverflow.com/questions/46692603/is-deferring-a-field-assignation-a-race-condition/46696202#46696202", "title": "Is deferring a field assignation a race condition?", "body": "<p>You mention timestamping when a function completes. In that case you can use <code>defer</code> like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    foo()\n}\n\nfunc foo() {\n    defer trace(\"foo\")()\n    time.Sleep(1 * time.Second)\n}\n\nfunc trace(fn string) func() {\n    start := time.Now()\n    return func() { \n        layout := \"15:04:05.000\"\n        end := time.Now()\n        fmt.Printf(\"%s start at %s, end at %s, total %s\", fn, start.Format(layout), end.Format(layout), end.Sub(start))\n    }\n}\n</code></pre>\n\n<p>Output: <code>foo start at 23:00:00.000, end at 23:00:01.000, total 1s</code></p>\n"}], "owner": {"reputation": 6023, "user_id": 4236078, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/9959d878feda9f2bab4b43b554e09847?s=128&d=identicon&r=PG&f=1", "display_name": "ale64bit", "link": "https://stackoverflow.com/users/4236078/ale64bit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 46695071, "answer_count": 2, "score": 1, "last_activity_date": 1507751488, "creation_date": 1507737021, "question_id": 46692603, "link": "https://stackoverflow.com/questions/46692603/is-deferring-a-field-assignation-a-race-condition", "title": "Is deferring a field assignation a race condition?", "body": "<p>Consider the following code:</p>\n\n<pre><code>type foo struct {\n  bar string\n}\n\nfunc f() *foo {\n  ret := &amp;foo{\"before\"}\n  defer func() { ret.bar = \"after\" }()\n  return ret\n}\n\nfunc main() {\n  fmt.Println(f()) // prints \"&amp;{after}\"\n}\n</code></pre>\n\n<p>The motivation is having to return a struct but some of the fields need to be set only before returning (e.g. a timestamp of when the function completed).</p>\n\n<p>Is deferring the field assignation a race condition?\nIs it idiomatic?\nIs there a better way? </p>\n"}, {"tags": ["go", "rabbitmq"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1507738646, "post_id": 46692247, "comment_id": 80333781, "body": "Try to make a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>, otherwise no one can tell you what is wrong exactly. Receiving from a channel blocks until there is data to be received. This is explained in <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">the tour</a>."}, {"owner": {"reputation": 1276, "user_id": 6237232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/557d1078fe8ace9c1e6f88d275f5f32a?s=128&d=identicon&r=PG&f=1", "display_name": "RidgeA", "link": "https://stackoverflow.com/users/6237232/ridgea"}, "edited": false, "score": 0, "creation_date": 1507738691, "post_id": 46692247, "comment_id": 80333819, "body": "You need to wait for data from channel in separate goroutine. I believe you want to reconnect to RabbitMQ if connection was lost - in this case you can follow this post <a href=\"https://ninefinity.org/post/ensuring-rabbitmq-connection-in-golang/\" rel=\"nofollow noreferrer\">ninefinity.org/post/ensuring-rabbitmq-connection-in-golang</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1507740792, "post_id": 46692247, "comment_id": 80335022, "body": "You also should check errors rather than discarding them."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507784968, "post_id": 46692247, "comment_id": 80350675, "body": "Who sends messages to the channel <code>rabbitCloseError</code>? May be the problem on that side?"}, {"owner": {"reputation": 1, "user_id": 8414952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5e642e173cf0575103eaf9b19dc0002?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Liu", "link": "https://stackoverflow.com/users/8414952/alex-liu"}, "edited": false, "score": 0, "creation_date": 1507789041, "post_id": 46692247, "comment_id": 80352340, "body": "rabbitmq connection has method <code>notifyClose</code>, i did it as official doc says.@EugeneLisitsky"}, {"owner": {"reputation": 1, "user_id": 8414952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5e642e173cf0575103eaf9b19dc0002?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Liu", "link": "https://stackoverflow.com/users/8414952/alex-liu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507789238, "post_id": 46692247, "comment_id": 80352419, "body": "@Peter thanks for you help.yeah i should put more clear codes here.But i have a question now: what will happen if I put a channel reader into a for loop?will the code hang if the channel is empty?"}, {"owner": {"reputation": 1, "user_id": 8414952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5e642e173cf0575103eaf9b19dc0002?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Liu", "link": "https://stackoverflow.com/users/8414952/alex-liu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507795687, "post_id": 46692247, "comment_id": 80355790, "body": "@Peter @RidgeA @EugeneLisitsky, Finally i made it! thanks! i didn&#39;t put my listener into a separate goroutine, and not define <code>rabbitCloseError </code>"}], "owner": {"reputation": 1, "user_id": 8414952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5e642e173cf0575103eaf9b19dc0002?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Liu", "link": "https://stackoverflow.com/users/8414952/alex-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 266, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1507775761, "creation_date": 1507735910, "last_edit_date": 1507775761, "question_id": 46692247, "link": "https://stackoverflow.com/questions/46692247/golang-progress-hanging-when-reading-data-from-channel", "title": "golang progress hanging when reading data from channel", "body": "<p>I have to write a rabbitmq reconnector,and this is what I refrence to:\n<a href=\"https://gist.github.com/svcavallar/be2d40953eaf27842cba2d46de9c1fb1\" rel=\"nofollow noreferrer\">https://gist.github.com/svcavallar/be2d40953eaf27842cba2d46de9c1fb1</a></p>\n\n<p>But when I read data from channel <code>rabbitCloseError</code>, my progress hang on... i have no idea whats wrong.</p>\n\n<p>Here belows my codes:</p>\n\n<p>```</p>\n\n<pre><code>    logger.Infof(\"Starting message listenner...\")\n    var rabbitErr *amqp.Error\n    var ch *amqp.Channel\n\n    // setup a reconnector\n    for {\n            rabbitErr = &lt;-rabbitCloseError // hanging here!!\n            if rabbitErr != nil {\n                logger.Infof(\"Reconnecting\")\n                _ = l.rabbitClient.InitConn()\n            }\n            if ch == nil {\n                logger.Infof(\"Creating channel\")\n\n                ch, _ = l.rabbitClient.RabbitmqConn.Channel()\n                reportQ, err := ch.QueueDeclare(\n                    \"filereport\", // name\n                    true,         // durable\n                    false,        // delete when unused\n                    false,        // exclusive\n                    false,        // no-wait\n                    l.rabbitClient.QArguments, // arguments\n                )\n                if err != nil {\n                    logger.Errorf(\"Declare queue report failed, error: %+v\", err)\n                }\n                // set prefetch one\n                _ = ch.Qos(1, 0, false)\n                msgs, err := ch.Consume(\n                    reportQ.Name, // queue\n                    \"\",           // consumer\n                    false,        // auto-ack\n                    false,        // exclusive\n                    false,        // no-local\n                    false,        // no-wait\n                    nil,          // args\n                )\n                if err != nil {\n                    logger.Errorf(\"Decare consumer failed, error: %+v\", err)\n                }\n                go l.ConsumeMsgs(msgs)\n            }\n    }\n}\n</code></pre>\n\n<p>```</p>\n\n<p>Can anyone help me about this? thanks in advance!</p>\n"}, {"tags": ["xml", "go", "zip"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507734139, "post_id": 46691251, "comment_id": 80330830, "body": "The documentation examples show how to use a <a href=\"https://golang.org/pkg/archive/zip/#example_Reader\" rel=\"nofollow noreferrer\"><code>zip.Reader</code></a>. Just skip the files you don&#39;t want."}, {"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507734318, "post_id": 46691251, "comment_id": 80330949, "body": "So, no way it can be done without looping and checking the name?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507735001, "post_id": 46691251, "comment_id": 80331417, "body": "A zip file contains a list of the file names; how would you look for the name in a list without looping over that list? You don&#39;t have to extract every file, loop over the names just like in that example in the docs."}, {"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507735449, "post_id": 46691251, "comment_id": 80331720, "body": "ok, how about the unmarshalling part, I mean the usage of ReadCloser with encoding/xml&#39;s Unmarshal method"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507735909, "post_id": 46691251, "comment_id": 80332066, "body": "You can read it and use <code>xml.Unmarshal</code>, or use an <code>xml.Decoder</code>. This is no different from unmarshaling any other <code>io.Reader</code>. If you&#39;re having a problem using the <code>xml</code> package, I would make a specific question with an example of where you&#39;re having trouble."}], "answers": [{"tags": [], "owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "is_accepted": true, "score": 1, "last_activity_date": 1507810365, "last_edit_date": 1507810365, "creation_date": 1507809474, "answer_id": 46709023, "question_id": 46691251, "link": "https://stackoverflow.com/questions/46691251/unmarshal-a-specific-xml-file-from-zip-without-extracting/46709023#46709023", "title": "Unmarshal a specific XML file from zip without extracting", "body": "<p>Well, here is the answer I have found with the return type declaration added to the sample function:</p>\n\n<pre><code>func UnmarshalApps(zipPath string, fileName string) ApplicationRoot {\n    // Open a zip archive for reading.\n    reader, err := zip.OpenReader(zipFilePath)\n    if err != nil {\n        log.Fatal(`ERROR:`, err)\n    }\n\n    defer reader.Close()\n\n    /* \n     * START OF ANSWER\n     */\n    var appRoot ApplicationRoot\n    for _, file := range reader.File {\n        // check if the file matches the name for application portfolio xml\n        if file.Name == fileName {\n            rc, err := file.Open()\n            if err != nil {\n                log.Fatal(`ERROR:`, err)\n            }\n\n            // Prepare buffer\n            buf := new(bytes.Buffer)\n            buf.ReadFrom(rc)\n\n            // Unmarshal bytes\n            xml.Unmarshal(buf.Bytes(), &amp;appRoot)\n            rc.Close()\n        }\n    }   \n     /* \n     * END OF ANSWER\n     */     \n}\n</code></pre>\n"}], "owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "accepted_answer_id": 46709023, "answer_count": 1, "score": 0, "last_activity_date": 1507810365, "creation_date": 1507733171, "last_edit_date": 1507735607, "question_id": 46691251, "link": "https://stackoverflow.com/questions/46691251/unmarshal-a-specific-xml-file-from-zip-without-extracting", "title": "Unmarshal a specific XML file from zip without extracting", "body": "<p>I have a zip file having several xml files in it using <a href=\"https://golang.org/pkg/archive/zip/\" rel=\"nofollow noreferrer\">zip</a> and <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow noreferrer\">encoding/xml</a> packages from Go archive. The thing I want to do is unmarshalling <strong>only</strong> <code>a.xml</code> into a type -i.e. without looping over all files inside:</p>\n\n<pre><code>test.zip\n\u251c a.xml\n\u251c b.xml\n\u2514 ...\n</code></pre>\n\n<p><code>a.xml</code> would have a structure like:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;root&gt;\n    &lt;app&gt;\n        &lt;code&gt;0001&lt;/code&gt;\n        &lt;name&gt;Some Test App&lt;/name&gt;\n    &lt;/app&gt;\n    &lt;app&gt;\n        &lt;code&gt;0002&lt;/code&gt;\n        &lt;name&gt;Another Test App&lt;/name&gt;\n    &lt;/app&gt;\n&lt;/root&gt;\n</code></pre>\n\n<p>How to for select and unmarshal the file whose name is provided as a parameter in the commented out lines, for instance:</p>\n\n<pre><code>package marshalutils\n\nimport (\n    \"archive/zip\"\n    \"log\"\n    \"fmt\"\n    \"encoding/xml\"\n)\n\ntype ApplicationRoot struct {\n    XMLName xml.Name `xml:\"root\"`\n    Applications []Application `xml:\"app\"`\n}\n\ntype Application struct {\n    Code string `xml:\"code\"`\n    Name string `xml:\"name\"`\n}\n\nfunc UnmarshalApps(zipPath string, fileName string) {\n    // Open a zip archive for reading.\n    reader, err := zip.OpenReader(zipFilePath)\n    if err != nil {\n        log.Fatal(`ERROR:`, err)\n    }\n\n    defer reader.Close()\n\n    /* \n     * U N M A R S H A L   T H E   G I V E N   F I L E ...\n     * ... I N T O   T H E   T Y P E S   A B O V E\n     */\n}\n</code></pre>\n"}, {"tags": ["linux", "bash", "networking", "go"], "comments": [{"owner": {"reputation": 4323, "user_id": 2057091, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7kWv6.png?s=128&g=1", "display_name": "Aserre", "link": "https://stackoverflow.com/users/2057091/aserre"}, "edited": false, "score": 4, "creation_date": 1507729886, "post_id": 46689941, "comment_id": 80327720, "body": "Could you enlighten me as to what you mean by <code>BBBW</code> ? First results from a google search are a lot of pron sites :)"}, {"owner": {"reputation": 11, "user_id": 7958432, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SOg070X_3Y0/AAAAAAAAAAI/AAAAAAAAACA/ECMYPlVViX8/photo.jpg?sz=128", "display_name": "William Durocher", "link": "https://stackoverflow.com/users/7958432/william-durocher"}, "reply_to_user": {"reputation": 4323, "user_id": 2057091, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7kWv6.png?s=128&g=1", "display_name": "Aserre", "link": "https://stackoverflow.com/users/2057091/aserre"}, "edited": false, "score": 0, "creation_date": 1507733409, "post_id": 46689941, "comment_id": 80330307, "body": "That would be a Beaglebone Black Wireless :) and BBB is BeagleBone Black"}, {"owner": {"reputation": 11, "user_id": 7958432, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SOg070X_3Y0/AAAAAAAAAAI/AAAAAAAAACA/ECMYPlVViX8/photo.jpg?sz=128", "display_name": "William Durocher", "link": "https://stackoverflow.com/users/7958432/william-durocher"}, "reply_to_user": {"reputation": 4323, "user_id": 2057091, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7kWv6.png?s=128&g=1", "display_name": "Aserre", "link": "https://stackoverflow.com/users/2057091/aserre"}, "edited": false, "score": 0, "creation_date": 1509128886, "post_id": 46689941, "comment_id": 80910116, "body": "The original issue was on a Debian distribution. We also get the same issue with a Ubuntu 16.04 distribution. In both case connman is disabled or not present"}], "owner": {"reputation": 11, "user_id": 7958432, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SOg070X_3Y0/AAAAAAAAAAI/AAAAAAAAACA/ECMYPlVViX8/photo.jpg?sz=128", "display_name": "William Durocher", "link": "https://stackoverflow.com/users/7958432/william-durocher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 790, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1507740018, "creation_date": 1507729742, "last_edit_date": 1507740018, "question_id": 46689941, "link": "https://stackoverflow.com/questions/46689941/on-a-bbbw-how-to-change-primary-ethernet-interface-without-adding-secondary-int", "title": "On a BBBW, how to change primary Ethernet Interface without adding secondary interfaces from code or script", "body": "<p>The setup is a BBBW with a USB to ethernet dongle. The aim is to have both a wireless interface as well as a wired interface. For compatibility with other hardware code, we cannot use connman services as they are not available on all platforms. As these changes will be done from configuration files sent to the device. The solution must be done programatically. We are using GO for the interpretation of the configuration files. At this time, we chose to use the /etc/network/interfaces files to effect the changes. Since the device needs to be active at all times, no reboot is permitted.</p>\n\n<p>We can get the changes to be applied by a reboot (not what we want though), but a network restart does not work. The main problem we encounter is when trying to set a static address for an interface without rebooting the device.</p>\n\n<p>Example: Changing the wlan0 interface static IP\nInitially we have one IP on wlan0</p>\n\n<p>output from \"ip a s\":</p>\n\n<pre><code>4: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000\nlink/ether 50:65:83:dc:43:cc brd ff:ff:ff:ff:ff:ff\ninet 192.168.0.90/24 brd 192.168.0.255 scope global wlan0\n   valid_lft forever preferred_lft forever\ninet6 fe80::5265:83ff:fedc:43cc/64 scope link \n   valid_lft forever preferred_lft forever\n</code></pre>\n\n<p>ifconfig shows: </p>\n\n<pre><code>wlan0     Link encap:Ethernet  HWaddr 50:65:83:dc:43:cc  \n      inet addr:192.168.0.90  Bcast:192.168.0.255  Mask:255.255.255.0\n</code></pre>\n\n<p>We edit /etc/network/interfaces with :</p>\n\n<pre><code>iface wlan0 inet static\naddress 192.168.0.91\nnetmask 255.255.0.0\ngateway 192.168.0.1\nwpa-ssid SOME_SSID\nwpa-psk SOME_KEY\n</code></pre>\n\n<p>Then we issue :</p>\n\n<pre><code>sudo ifdown wlan0\nsudo ifup wlan0\nsudo service networking restart\n</code></pre>\n\n<p>And we see:</p>\n\n<pre><code>ip a s :\n4: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000\nlink/ether 50:65:83:dc:43:cc brd ff:ff:ff:ff:ff:ff\ninet 192.168.0.90/24 brd 192.168.0.255 scope global wlan0\n   valid_lft forever preferred_lft forever\ninet 192.168.0.91/24 brd 192.168.0.255 scope global secondary wlan0\n   valid_lft forever preferred_lft forever\ninet6 fe80::5265:83ff:fedc:43cc/64 scope link \n   valid_lft forever preferred_lft forever\n\nifconfig:\nwlan0     Link encap:Ethernet  HWaddr 50:65:83:dc:43:cc  \n      inet addr:192.168.0.90  Bcast:192.168.0.255  Mask:255.255.255.0\n</code></pre>\n\n<p>As you can see the new IP address is taken as a secondary IP. Ifconfig only shows the primary IP and not the secondary IP. We can connect to the device with both address but the presence of the old IP address is not acceptable.</p>\n\n<p>Is there a correct way to do this from system files edits or even system calls (bash commands)</p>\n\n<p>Is this secondary IP behaviour only a BBB thing or is this a Linux one ?</p>\n"}, {"tags": ["go", "atomic"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1507727259, "post_id": 46689003, "comment_id": 80325608, "body": "You are using the package incorrectly; you should not be directly assigning/accessing the <code>count</code> variable, like you are with <code>count = ...</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507727282, "post_id": 46689003, "comment_id": 80325630, "body": "Please show the actual code you&#39;re using. This example isn&#39;t a valid use of atomic, because the log line accesses the <code>count</code> value directly, and you assign the result back to <code>count</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507727397, "post_id": 46689003, "comment_id": 80325735, "body": "Always use the race detector, and <code>vet</code>. (also, <code>ab</code> is a poor tool to test your server, it&#39;s only http/1.0 and ins&#39;t even using keepalive here.)"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507758659, "post_id": 46689003, "comment_id": 80343937, "body": "try to build your server with -race flag like <code>go build -race</code> or running with <code>go run -race main.go</code>"}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 3, "last_activity_date": 1507729357, "creation_date": 1507729357, "answer_id": 46689791, "question_id": 46689003, "link": "https://stackoverflow.com/questions/46689003/golang-sync-atomic-package/46689791#46689791", "title": "golang sync/atomic package?", "body": "<p>You are using the <code>sync/atomic</code> package incorrectly. If you have an atomic variable, <strong>ALL</strong> reading and writing must be done using the atomic functions.</p>\n\n<p>Here is your code fixed so that the <code>count</code> variable is not written to or read from non-atomically:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"runtime\"\n    \"sync/atomic\"\n)\n\nvar count int32\n\nfunc test(w http.ResponseWriter, r *http.Request) {\n    currentCount := atomic.LoadInt32(&amp;count)\n    atomic.AddInt32(&amp;count, 1)\n    log.Println(\"count:\", currentCount)\n}\nfunc main() {\n    runtime.GOMAXPROCS(runtime.NumCPU() - 1)\n    http.HandleFunc(\"/\", test)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}], "owner": {"reputation": 403, "user_id": 7294974, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/B26Kl.jpg?s=128&g=1", "display_name": "salamander", "link": "https://stackoverflow.com/users/7294974/salamander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1956, "favorite_count": 0, "accepted_answer_id": 46689791, "answer_count": 1, "score": 1, "last_activity_date": 1507729357, "creation_date": 1507727130, "question_id": 46689003, "link": "https://stackoverflow.com/questions/46689003/golang-sync-atomic-package", "title": "golang sync/atomic package?", "body": "<p>I write a piece of code to record the num of request.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"runtime\"\n    \"sync/atomic\"\n)\n\nvar count int32 = 0\n\nfunc test(w http.ResponseWriter, r *http.Request) {\n    count = atomic.LoadInt32(&amp;count)\n    atomic.AddInt32(&amp;count, 1)\n    log.Println(\"count:\", count)\n}\nfunc main() {\n    runtime.GOMAXPROCS(runtime.NumCPU() - 1)\n    http.HandleFunc(\"/\", test)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>I have considered the condition of concurrency, so I use the atomic pacakge.\nI test the code via the apache ab tool</p>\n\n<pre><code>ab -c 400 -n 1000 http://localhost:8080/\n</code></pre>\n\n<p>the result is correct:\n<a href=\"https://i.stack.imgur.com/BsQ4W.png\" rel=\"nofollow noreferrer\">result</a>\nHowever, someone said he got the 1004 or other number on his computer, I have tested many times of the code, but the result is correct on my computer, is there wrong with my way? \nI am new to go, Thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507726924, "post_id": 46688738, "comment_id": 80325359, "body": "That&#39;s just trying to show how TCP connections are handled, it&#39;s not specific to go at all. The server has to accept the client connection, otherwise it does nothing."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507729006, "post_id": 46689312, "comment_id": 80327023, "body": "No, there are 2 sockets, the listening socket and the connected socket. From the accept(2) man page: <code>&quot;[accept] extracts the first connection request on the queue of pending connections for the listening socket, sockfd, creates a new connected socket&quot;</code>. It is a completely separate socket with new FD; but this isn&#39;t unique to Go, it&#39;s how TCP sockets work."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507812258, "post_id": 46689312, "comment_id": 80366293, "body": "Are you really using a micrium real-time OS? I mean the general concept is the same for TCP, but these syscalls are unique to that OS."}, {"owner": {"reputation": 4897, "user_id": 4573839, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-wLBU0P4GoTk/AAAAAAAAAAI/AAAAAAAAAPM/8Xy7C9d-XoU/photo.jpg?sz=128", "display_name": "yu yang Jian", "link": "https://stackoverflow.com/users/4573839/yu-yang-jian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507821254, "post_id": 46689312, "comment_id": 80372734, "body": "I didn&#39;t aware that it&#39;s specific OS when reading, and I find another seems more general instruction about TCP in Update2."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507821502, "post_id": 46689312, "comment_id": 80372900, "body": "You seem to be able to find the most obscure sources, that one is from IBM zSeries z/TPF. I mean, this is mostly generic information, but you should know that these sources may have details specific to their domain."}], "tags": [], "owner": {"reputation": 4897, "user_id": 4573839, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-wLBU0P4GoTk/AAAAAAAAAAI/AAAAAAAAAPM/8Xy7C9d-XoU/photo.jpg?sz=128", "display_name": "yu yang Jian", "link": "https://stackoverflow.com/users/4573839/yu-yang-jian"}, "is_accepted": true, "score": -1, "last_activity_date": 1507821934, "last_edit_date": 1507821934, "creation_date": 1507728017, "answer_id": 46689312, "question_id": 46688738, "link": "https://stackoverflow.com/questions/46688738/listensocket-clientsocket-go/46689312#46689312", "title": "ListenSocket ClientSocket Go", "body": "<p><del>Maybe I misunderstanding the graph or the graph isn't draw very well, possibly <code>Listen Socket</code>, <code>Client Socket</code> are same socket, if the socket hasn't accept connection from client, it's called <code>Listen Socket</code>, and after it accept the connection, it's renamed to <code>Client Socket</code>, there's only one socket with different stage and name.</del></p>\n\n<hr>\n\n<p><strong>UPDATE 1:</strong></p>\n\n<p>I find a better article and graph about Socket Working <strong><a href=\"https://www.micrium.com/setting-up-a-socket-in-uctcp-ip-part-2/\" rel=\"nofollow noreferrer\">Here</a></strong>.</p>\n\n<p>In the grpah of article, it's clear when there's new connection, TCP Server will \ncreate a new socket to handle the connection, and the <code>Listen Socket</code> continuing listening for other connections.</p>\n\n<p>Here's a paragraph in the article:</p>\n\n<blockquote>\n  <p>The first socket created by a TCP server, via <code>NetSock_Open()</code>, is typically designated a <code>listen socket</code> , and, after the call to <code>NetSock_Listen()</code>, remains open indefinitely, to allow the server to respond to various connection requests. Rather than using this socket to exchange data with requesting clients, the server will create a new socket for each request.</p>\n</blockquote>\n\n<p><img src=\"https://i.stack.imgur.com/sHDZy.png\" alt=\"\"></p>\n\n<hr>\n\n<p><strong>UPDATE 2</strong></p>\n\n<p>Since first update is working on Micrium, I find another seems more general TCP working instuction <strong><a href=\"https://www.ibm.com/support/knowledgecenter/en/SSB23S_1.1.0.9/com.ibm.ztpf-ztpfdf.doc_put.09/gtps5/s5tcpcf.html\" rel=\"nofollow noreferrer\">Here</a></strong>:</p>\n\n<blockquote>\n  <p>TCP connection flow The following sequence shows the flow of a TCP</p>\n  \n  <p>connection:</p>\n  \n  <ol>\n  <li><p>The server creates the listener socket that is waiting for remote clients to connect.</p></li>\n  <li><p>The client issues the connect() socket function to start the TCP handshake (SYN, SYN/ACK, ACK). The server issues the accept() socket\n  function to accept the connection request.</p></li>\n  <li><p>The client and server issue the read() and write() socket functions to exchange data over the socket.  </p></li>\n  </ol>\n  \n  <p>Note: There are several SSL APIs that you can use to send and receive data other than the read() and write() socket functions.</p>\n  \n  <ol start=\"4\">\n  <li><p>Either the server or the client decides to close the socket. This causes the TCP closure sequence (FINs and ACKs) to occur.</p></li>\n  <li><p>The server either closes the listener socket or repeats beginning with step 2 to accept another connection from a remote client.   </p></li>\n  </ol>\n  \n  <p><strong>Note: Normally after the accept() socket function ends, the server divides\n   into two processes (or threads). The first process handles the\n   connection with the client and the second process issues the next\n   accept() socket function. Figure 1 shows an example of a TCP\n   connection:</strong> </p>\n  \n  <p><img src=\"https://i.stack.imgur.com/L1pmV.png\" alt=\"\"></p>\n</blockquote>\n\n<p><br/> </p>\n\n<p>Note:</p>\n\n<ol>\n<li><p>I find another <strong><a href=\"http://www.csd.uoc.gr/~hy556/material/tutorials/cs556-3rd-tutorial.pdf\" rel=\"nofollow noreferrer\">Socker Programming Tutorial</a></strong> mention about working detail in TCP.</p></li>\n<li><p>And In <strong><a href=\"https://msdn.microsoft.com/en-us/library/system.net.sockets.socket.accept(v=vs.110).aspx\" rel=\"nofollow noreferrer\">.NET Framework MSDN</a></strong>, the explanation about <code>Socket.Accept Method()</code> says <code>Accept synchronously extracts the first pending connection request from the connection request queue of the listening socket, and then creates and returns a new Socket.</code></p></li>\n<li><p>I have skimmed <strong><a href=\"https://tools.ietf.org/html/rfc793\" rel=\"nofollow noreferrer\">RFC about TCP</a></strong> before Update 1, but I didn't see it mention the detail that Listen use one socket, and when Accept it'll create another new Socket.</p></li>\n<li><p>Maybe the  thorough way is to research the Source Code about Create Socket  and Connection in <code>Go</code>, but I'm not consiedring to do it now.</p></li>\n</ol>\n"}], "owner": {"reputation": 4897, "user_id": 4573839, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-wLBU0P4GoTk/AAAAAAAAAAI/AAAAAAAAAPM/8Xy7C9d-XoU/photo.jpg?sz=128", "display_name": "yu yang Jian", "link": "https://stackoverflow.com/users/4573839/yu-yang-jian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 46689312, "answer_count": 1, "score": -1, "last_activity_date": 1507821934, "creation_date": 1507726509, "last_edit_date": 1507788601, "question_id": 46688738, "link": "https://stackoverflow.com/questions/46688738/listensocket-clientsocket-go", "title": "ListenSocket ClientSocket Go", "body": "<p>In <strong><a href=\"https://github.com/astaxie/build-web-application-with-golang/blob/master/en/03.3.md\" rel=\"nofollow noreferrer\">this article</a></strong> about <code>Go Web Server</code>, there're <code>Listen Socket</code> and <code>Client Socket</code> in <code>Go</code>,</p>\n\n<p>I can't understand why GoLang need two sockets <code>Listen Socket, Client Socket</code> but not just one socket, can anyone explain its concept or give a metaphor?</p>\n\n<p><a href=\"https://i.stack.imgur.com/jDb9D.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jDb9D.png\" alt=\"\"></a></p>\n\n<p><strong>EDIT :</strong> I update my answer.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-dynamodb", "aws-sdk-go"], "comments": [{"owner": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "edited": false, "score": 0, "creation_date": 1507741411, "post_id": 46688165, "comment_id": 80335381, "body": "what is the data type of attribute destination in dynamodb table?"}, {"owner": {"reputation": 165, "user_id": 634577, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5b17138fd161ce97dc7e392c32dfd94a?s=128&d=identicon&r=PG", "display_name": "Pedro", "link": "https://stackoverflow.com/users/634577/pedro"}, "reply_to_user": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "edited": false, "score": 0, "creation_date": 1507748510, "post_id": 46688165, "comment_id": 80339149, "body": "String both of them, like the struct"}, {"owner": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "edited": false, "score": 0, "creation_date": 1507750761, "post_id": 46688165, "comment_id": 80340203, "body": "Did you try the below solution?"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507759070, "post_id": 46688165, "comment_id": 80344080, "body": "if you want to <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">Unmarshal</a> an <code>Item</code> instance you have to make public its attributes, just make first letter as upper case for each attribute"}], "answers": [{"tags": [], "owner": {"reputation": 165, "user_id": 634577, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5b17138fd161ce97dc7e392c32dfd94a?s=128&d=identicon&r=PG", "display_name": "Pedro", "link": "https://stackoverflow.com/users/634577/pedro"}, "is_accepted": false, "score": 1, "last_activity_date": 1507732701, "creation_date": 1507732701, "answer_id": 46691080, "question_id": 46688165, "link": "https://stackoverflow.com/questions/46688165/cant-unmarshall-dynamodb-attribute/46691080#46691080", "title": "Cant unmarshall dynamodb attribute", "body": "<p>I found this issue and seems to be related, unmarsheling a specific attribute of the struct seems to do it.</p>\n\n<p><a href=\"https://github.com/aws/aws-sdk-go/issues/850\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-sdk-go/issues/850</a></p>\n\n<p>Example</p>\n\n<pre><code>var item Item\nif err = dynamodbattribute.Unmarshal(result.Item[\"destination\"], &amp;item.destination); err != nil {\n    log.Printf(\"UnmarshalMap(GetItem response) err=%q\", err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "is_accepted": false, "score": 1, "last_activity_date": 1507742328, "creation_date": 1507742328, "answer_id": 46694107, "question_id": 46688165, "link": "https://stackoverflow.com/questions/46688165/cant-unmarshall-dynamodb-attribute/46694107#46694107", "title": "Cant unmarshall dynamodb attribute", "body": "<p>I am not sure whether you have tried this. I think if you can change the struct as mentioned below, it may resolve the problem.</p>\n\n<p>I assumed that both <code>slug</code> and <code>destination</code> are defined/saved as String attribute in DynamoDB table. </p>\n\n<pre><code>type Item struct {\n     Slug string`json:\"slug\"`\n     Destination string`json:\"destination\"`\n}\n</code></pre>\n\n<p>Change the print to:-</p>\n\n<pre><code>log.Printf(\"echo %s\", n.Slug)\nlog.Printf(\"echo %s\", n.Destination)\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 634577, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/5b17138fd161ce97dc7e392c32dfd94a?s=128&d=identicon&r=PG", "display_name": "Pedro", "link": "https://stackoverflow.com/users/634577/pedro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1760, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1507742328, "creation_date": 1507724674, "last_edit_date": 1507730357, "question_id": 46688165, "link": "https://stackoverflow.com/questions/46688165/cant-unmarshall-dynamodb-attribute", "title": "Cant unmarshall dynamodb attribute", "body": "<p>I'm experimenting with AWS-SDK-GO with the DynamoDB API...</p>\n\n<p>I'm trying to query the db and return a string. But I'm having some issues  unmarshelling the return value.... </p>\n\n<p>struct</p>\n\n<pre><code>type Item struct {\n     slug string\n     destination string\n}\n</code></pre>\n\n<p>query function</p>\n\n<pre><code>input := &amp;dynamodb.GetItemInput{\n    Key: map[string]*dynamodb.AttributeValue{\n        \"slug\": {\n            S: aws.String(slug),\n        },\n    },\n    TableName: db.TableName,\n}\n\nresult, err := db.dynamo.GetItem(input)\nif err != nil {\n    return \"\",  err\n}\n\nn := Item{}\nerr = dynamodbattribute.UnmarshalMap(result.Item, &amp;n)\n\nif err != nil {\n    log.Printf(\"Failed to unmarshal Record, %v\", err)\n    return \"\", err\n}\nlog.Printf(\"dump %+v\", n)\nlog.Printf(\"echo %s\", n.slug)\nlog.Printf(\"echo %s\", n.destination)\nlog.Printf(\"orig %v\", result.Item)\n</code></pre>\n\n<p>result</p>\n\n<pre><code>2017/10/11 14:21:34 dump {slug: destination:}\n2017/10/11 14:21:34 echo \n2017/10/11 14:21:34 echo \n2017/10/11 14:21:34 orig map[destination:{\n  S: \"http://example.com\"\n} slug:{\n  S: \"abcde\"\n}]\n</code></pre>\n\n<p>Why is Item being returned empty?</p>\n\n<p>I've tried to look everywhere but find no solution....</p>\n"}, {"tags": ["go", "httpclient"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 1, "creation_date": 1507723139, "post_id": 46686360, "comment_id": 80322724, "body": "when asking api specific questions like this you should include a link to the docs after reading them to tell us you have the baseline info"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507725001, "post_id": 46686360, "comment_id": 80323955, "body": "Yes, both of those are described in their documentation. What parts don\u2019t you understand exactly?"}, {"owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "edited": false, "score": 0, "creation_date": 1507725494, "post_id": 46686360, "comment_id": 80324293, "body": "KeepAlive: specifies the keep-alive period for an active network connection. ___ IdleConnTimeout: is the maximum amount of time an idle (keep-alive) connection will remain idle before closing itself.___       Still confused getting the difference."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1507726393, "post_id": 46686360, "comment_id": 80324930, "body": "They are completely unrelated, which is why this is a confusing question.  <code>KeepAlive</code> is the TCP keepalive interval, <code>IdleConnTimeout</code> is how long the transport keeps an unused idle http connection."}, {"owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "edited": false, "score": 0, "creation_date": 1507727674, "post_id": 46686360, "comment_id": 80325980, "body": "Maybe that was what confused me. And completely answered my question. Wasn&#39;t clear that one is TCP and the other HTTP. Thanks"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507728753, "post_id": 46686360, "comment_id": 80326849, "body": "@Subby: <code>KeepAlive</code> is a field on the <code>net.Dialer</code> struct in the <code>net</code> package, and not part of the <code>http</code> package. The <code>net</code> package knows nothing of the <code>http</code> package or protocol."}, {"owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "edited": false, "score": 0, "creation_date": 1538046334, "post_id": 46686360, "comment_id": 92010307, "body": "At least there is a comment in the documentation that clarifies this. <a href=\"https://github.com/golang/go/commit/cbce223da02bb198b9984c161c6cd6291a80b3d9\" rel=\"nofollow noreferrer\">github.com/golang/go/commit/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 1, "last_activity_date": 1582560908, "creation_date": 1582560908, "answer_id": 60379934, "question_id": 46686360, "link": "https://stackoverflow.com/questions/46686360/difference-of-dialcontext-keepalive-and-transport-idletimeout-of-go-http-client/60379934#60379934", "title": "Difference of DialContext KeepAlive and Transport IdleTimeout of go http.Client", "body": "<p>From the documentation:</p>\n\n<p><a href=\"https://github.com/golang/go/blob/go1.13.8/src/net/dial.go#L72\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/go1.13.8/src/net/dial.go#L72</a></p>\n\n<blockquote>\n  <p>KeepAlive specifies the interval between keep-alive probes for an active network connection. If zero, keep-alive probes are sent with a default value (currently 15 seconds), if supported by the protocol and operating system. Network protocols or operating systems that do not support keep-alives ignore this field. If negative, keep-alive probes are disabled.</p>\n</blockquote>\n\n<p>So, if you set the <code>KeepAlive</code> greater than 0, it will rappresent the time elapsed from the next probe in order to understand if the network connection is still active.</p>\n\n<p>From the other side, the <code>IdleConnTimeout</code>:<br>\n<a href=\"https://github.com/golang/go/blob/go1.13.8/src/net/dial.go#L72\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/go1.13.8/src/net/dial.go#L72</a></p>\n\n<blockquote>\n  <p>IdleConnTimeout is the maximum amount of time an idle (keep-alive) connection will remain idle before closing itself. Zero means no limit.</p>\n</blockquote>\n\n<p>So, if you set a <code>IdleConnTimeout</code> greater than 0, it rappresent the time that the connection is still open.</p>\n"}], "owner": {"reputation": 1747, "user_id": 1223777, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e5d57bacf254409375e9d7b28f2ee952?s=128&d=identicon&r=PG", "display_name": "Subby", "link": "https://stackoverflow.com/users/1223777/subby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1822, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1582560908, "creation_date": 1507719052, "question_id": 46686360, "link": "https://stackoverflow.com/questions/46686360/difference-of-dialcontext-keepalive-and-transport-idletimeout-of-go-http-client", "title": "Difference of DialContext KeepAlive and Transport IdleTimeout of go http.Client", "body": "<pre><code>client := &amp;http.Client{\n        Transport: &amp;http.Transport{\n            DialContext: (&amp;net.Dialer{\n                KeepAlive: 5 * time.Second,\n            }).DialContext,\n            IdleConnTimeout: 3 * time.Second,\n        },\n    }\n</code></pre>\n\n<p>What's the difference between KeepAlive and IdleConnTimeout?</p>\n\n<p>Which of them exactly does what?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1507717628, "post_id": 46685853, "comment_id": 80319222, "body": "I would recommend just using <code>bytes.Buffer</code> instead of implementing that method myself."}, {"owner": {"reputation": 335, "user_id": 7129790, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/391eb21f51ccabf989cd853a1e4cb339?s=128&d=identicon&r=PG", "display_name": "hshan", "link": "https://stackoverflow.com/users/7129790/hshan"}, "edited": false, "score": 0, "creation_date": 1584602847, "post_id": 46685853, "comment_id": 107487916, "body": "Don&#39;t forget w.Flush() like me."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 1, "last_activity_date": 1507718299, "last_edit_date": 1507718299, "creation_date": 1507717584, "answer_id": 46685853, "question_id": 46685039, "link": "https://stackoverflow.com/questions/46685039/how-to-check-response-returned-from-tabwriter-writer-in-golang/46685853#46685853", "title": "How to check response returned from tabwriter.Writer in golang", "body": "<p>You can implement your own <code>io.Writer</code>:</p>\n\n<pre><code>type W []byte\n\nfunc (w *W) Write(b []byte) (int, error) {\n    *w = append(*w, b...)\n    return len(b), nil\n}\n</code></pre>\n\n<p>You can then pass an instance of <code>*W</code> to <code>tabwriter.NewWriter</code>:</p>\n\n<pre><code>sw := &amp;W{}\nw := tabwriter.NewWriter(sw, 5, 1, 3, ' ', 0)\nfmt.Fprintf(w, \"%v\\t%v\\t\\n\", somevalue1, somevalue2)\n\n// get the string value from sw\nstr := string(*sw)\n</code></pre>\n\n<p>As sugested by @Tim, you should use <code>*bytes.Buffer</code> instead for better performance and it already implements <code>io.Writer</code>:</p>\n\n<pre><code>var b bytes.Buffer\nw := tabwriter.NewWriter(&amp;b, 0, 0, 1, '.', 0)\n// ...\nfmt.Println(b.String())\n</code></pre>\n"}], "owner": {"reputation": 29, "user_id": 8757991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34f6725d189c34e6d9aeb558e5572d17?s=128&d=identicon&r=PG&f=1", "display_name": "Supriya Singh", "link": "https://stackoverflow.com/users/8757991/supriya-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 523, "favorite_count": 0, "accepted_answer_id": 46685853, "answer_count": 1, "score": 0, "last_activity_date": 1507718299, "creation_date": 1507715296, "question_id": 46685039, "link": "https://stackoverflow.com/questions/46685039/how-to-check-response-returned-from-tabwriter-writer-in-golang", "title": "How to check response returned from tabwriter.Writer in golang", "body": "<p>I am writting something to tabwriter.Writer object,</p>\n\n<pre><code>    w := tabwriter.NewWriter(os.Stdout, 5, 1, 3, ' ', 0)\n    fmt.Fprintf(w, \"%v\\t%v\\t\\n\", somevalue1, somevalue2)\n</code></pre>\n\n<p>I can print the data in w in console using w.Flush()\nIs there any way so get values in w as string in one place and compare it with some value?</p>\n\n<p>I want to compare what I have in w with some data.</p>\n"}, {"tags": ["regex", "go", "subdomain", "wildcard"], "comments": [{"owner": {"reputation": 24853, "user_id": 446681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cBjgR.jpg?s=128&g=1", "display_name": "Hector Correa", "link": "https://stackoverflow.com/users/446681/hector-correa"}, "edited": false, "score": 0, "creation_date": 1507733780, "post_id": 46684021, "comment_id": 80330556, "body": "Your current implementation using the hash key will only allow for simple matches. You are going to need to write more code to handle wildcards (*.something) as John S Perayil has indicated."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1507739172, "post_id": 46684377, "comment_id": 80334095, "body": "As long as the map remains small, I&#39;d prefer <code>map[string]bool</code>, simply because you use the single-value lookup instead of the two-value variant. Only if it get&#39;s really big is the additional memory usage a concern to me."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507788863, "post_id": 46684377, "comment_id": 80352253, "body": "@Peter Agreed, As they say &quot;premature optimization is the root of all evil&quot;"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 2, "last_activity_date": 1508738742, "last_edit_date": 1508738742, "creation_date": 1507713361, "answer_id": 46684377, "question_id": 46684021, "link": "https://stackoverflow.com/questions/46684021/golang-match-domain-names-wild-card/46684377#46684377", "title": "Golang match domain names wild card", "body": "<p>You can store the keys of the map in the format *.domain.com</p>\n\n<p>The convert all the hostnames you get into that format using <a href=\"https://golang.org/pkg/strings/#SplitAfterN\" rel=\"nofollow noreferrer\"><code>strings.SplitAfterN</code></a> and <a href=\"https://golang.org/pkg/strings/#Join\" rel=\"nofollow noreferrer\"><code>strings.Join</code></a>.</p>\n\n<pre><code>split := strings.SplitAfterN(url.Hostname(),\".\",2)\nsplit[0] = \"*\"\nhostName := strings.Join(split,\".\")\n...\nhostnameWhitelist[hostName]\n...\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Rbtu8vQrEH\" rel=\"nofollow noreferrer\">Play Link</a></p>\n\n<p>Unrelated improvement</p>\n\n<p>If you are using the map purely as a whitelist you can use <code>map[string]struct{}</code> instead of <code>map[string]bool</code>. But as <code>Peter</code> mentioned in his comment, it might be relevant only if you have a very large whitelist. </p>\n"}, {"comments": [{"owner": {"reputation": 6750, "user_id": 2098614, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/cslmi.jpg?s=128&g=1", "display_name": "Ajey", "link": "https://stackoverflow.com/users/2098614/ajey"}, "edited": false, "score": 0, "creation_date": 1508760778, "post_id": 46698086, "comment_id": 80725236, "body": "well HasSuffix is the simplest solution. Thanks"}], "tags": [], "owner": {"reputation": 679, "user_id": 2888403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9ffa065886a8362661b8f85b2a7156a?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2888403/david"}, "is_accepted": true, "score": 3, "last_activity_date": 1507758546, "creation_date": 1507758546, "answer_id": 46698086, "question_id": 46684021, "link": "https://stackoverflow.com/questions/46684021/golang-match-domain-names-wild-card/46698086#46698086", "title": "Golang match domain names wild card", "body": "<p>Regex is the to go solution for your problem, map[string]bool may not work as expected as you are trying to match a regex with single value.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    if matched, _ := regexp.MatchString(\".*\\\\.?mydomain.*\", \"mydomaindev.com\"); matched {\n        fmt.Println(\"Valid domain\")\n    }\n}\n</code></pre>\n\n<p>This would match all domain with pattern mydomain, so www.mydomain.com www.mydomaindev.com would match byt test.com and hello.com will fail</p>\n\n<p>Other handy string ops are,</p>\n\n<pre><code>//This would match a.mydomain.com, b.mydomain.com etc.,\nif strings.HasSuffix(url1.Hostname(), \".mydomain.com\") {\n    fmt.Println(\"Valid domain allow access\")\n}\n\n//To match anything with mydomain - like mydomain.com, mydomaindev.com\nif strings.Contains(url2.Hostname(), \"mydomain.com\") {\n    fmt.Println(\"Valid domain allow access\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 333, "user_id": 995368, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hjdrh.png?s=128&g=1", "display_name": "Xavier Nicollet", "link": "https://stackoverflow.com/users/995368/xavier-nicollet"}, "is_accepted": false, "score": 1, "last_activity_date": 1508749489, "creation_date": 1508749489, "answer_id": 46885542, "question_id": 46684021, "link": "https://stackoverflow.com/questions/46684021/golang-match-domain-names-wild-card/46885542#46885542", "title": "Golang match domain names wild card", "body": "<p>If you want to be able to have several depth in your domains, eg:</p>\n\n<ul>\n<li>*.foo.example.org</li>\n<li>*.example.com</li>\n</ul>\n\n<p>Then I would add a second container for the wildcards:</p>\n\n<p><code>var wdomains = []string { \".foo.example.org\", \".example.com\"}</code></p>\n\n<p>Then just check if your domain to test ends with one of those entries:</p>\n\n<pre><code>func inWdomain(wdomains []string, domain string) bool {\n    for _, suffix := range wdomains {\n        if strings.HasSuffix(domain, suffix) {\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n\n<p><strong>Note:</strong> if you have more than hundreds of domains, you could use a radix tree.  </p>\n\n<p><a href=\"https://play.golang.org/p/-4n8mlGmpH\" rel=\"nofollow noreferrer\" title=\"playground\">https://play.golang.org/p/-4n8mlGmpH</a></p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 10142769, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ZjM9EHvNeaY/AAAAAAAAAAI/AAAAAAAAAWI/VVJq5he-LSk/photo.jpg?sz=128", "display_name": "Kjell Tore Fossbakk", "link": "https://stackoverflow.com/users/10142769/kjell-tore-fossbakk"}, "is_accepted": false, "score": 2, "last_activity_date": 1532674952, "creation_date": 1532674952, "answer_id": 51552437, "question_id": 46684021, "link": "https://stackoverflow.com/questions/46684021/golang-match-domain-names-wild-card/51552437#51552437", "title": "Golang match domain names wild card", "body": "<p>Doing a wildcard match with the wildcard at the start is highly expensive. Regex could be difficult with regards to performance, depending on the size of your dataset and the speed of evaluating against your dataset. You could try using a suffix tree, but I suspect the performance could become a problem (I havent tested it on our data).</p>\n\n<p>One approach we use is building a Radix Trie (compact prefix trie) with the signature  domainname's labels in reverse octet order. Your signature domain <code>*.foo.example.com</code> becomes <code>com.example.foo.*</code>, which puts the wildcard at the end. Your custom built Radix tree will then only need to stop matching if it reaches a wildcard node. Your Trie could support both exact string matching and wildcard matching. If you wish to allow the wildcard to sit in the middle of the domainname the performance could become a problem.</p>\n\n<p>One of the biggest challenges we'v had using Trie's to evaluate domainnames is not the searchtime but the memory consumption and as such how long it takes to start the program when you have a lot of signatures.</p>\n\n<p>We'v evaluated a few implementations (at start mainly without wildcard-support) testing loadtime, allocations, # of internal nodes, memoryconsumption, GC time and search/insert/remove time.</p>\n\n<p>Implementations we'v tested:</p>\n\n<ul>\n<li>golang maps</li>\n<li><a href=\"https://github.com/armon/go-radix\" rel=\"nofollow noreferrer\">https://github.com/armon/go-radix</a></li>\n<li><a href=\"https://github.com/tchap/go-patricia\" rel=\"nofollow noreferrer\">https://github.com/tchap/go-patricia</a></li>\n<li><a href=\"https://github.com/fanyang01/radix\" rel=\"nofollow noreferrer\">https://github.com/fanyang01/radix</a></li>\n<li>our own implementation</li>\n</ul>\n\n<p>Obviously, using a golang map will give best performance, but when one needs to retrieve (whence the word Trie) e.g. prefixed information from the dataset, golang maps doesn't give us the features we need.</p>\n\n<p>We keep an approximately 700 000 domainname signatures in our Trie. Buildtime is 2 seconds, 300MB memory, 5 million allocation, 2second GC and searching costs 150ns/op.</p>\n\n<p>If we use golang map for the same signatures (without wildcards) we get loadtime 0.5seconds, 50MB memory, negligible allocations, 1.6second GC and searching costs 25ns/op.</p>\n\n<p>In our initial implementation buildtime was 6seconds, 1GB memory, 60 million allocations, 5second GC and searching cost ~200 ns/op.</p>\n\n<p>As you can see from these results we managed to lower the memory consumption and loadtime, while the searching cost remained approximately the same.</p>\n\n<p>If your going to do CIDR matching, I would recommend checking out <a href=\"https://github.com/kentik/patricia\" rel=\"nofollow noreferrer\">https://github.com/kentik/patricia</a>. To lower the GC time it is implemented to avoid pointers.</p>\n\n<p>Good luck with your work!</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1618035550, "creation_date": 1618035550, "answer_id": 67031390, "question_id": 46684021, "link": "https://stackoverflow.com/questions/46684021/golang-match-domain-names-wild-card/67031390#67031390", "title": "Golang match domain names wild card", "body": "<p>You can use <code>fstest.MapFS</code> like a Set data structure, with the added benefit of\nGlob matching:</p>\n<pre><code>package main\nimport &quot;testing/fstest&quot;\n\nvar tests = []struct {\n   pat string\n   res int\n} {\n   {&quot;*.hello.com&quot;, 0},\n   {&quot;*.mydomain.com&quot;, 1},\n   {&quot;*.mydomaindev.com&quot;, 1},\n   {&quot;*.test.com&quot;, 0},\n}\n\nfunc main() {\n   m := fstest.MapFS{&quot;test.mydomain.com&quot;: nil, &quot;test12.mydomaindev.com&quot;: nil}\n   for _, test := range tests {\n      a, e := m.Glob(test.pat)\n      if e != nil {\n         panic(e)\n      }\n      if len(a) != test.res {\n         panic(len(a))\n      }\n   }\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/testing/fstest\" rel=\"nofollow noreferrer\">https://golang.org/pkg/testing/fstest</a></p>\n"}], "owner": {"reputation": 6750, "user_id": 2098614, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/cslmi.jpg?s=128&g=1", "display_name": "Ajey", "link": "https://stackoverflow.com/users/2098614/ajey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7317, "favorite_count": 1, "accepted_answer_id": 46698086, "answer_count": 5, "score": 2, "last_activity_date": 1618035550, "creation_date": 1507712305, "question_id": 46684021, "link": "https://stackoverflow.com/questions/46684021/golang-match-domain-names-wild-card", "title": "Golang match domain names wild card", "body": "<p>I have hostnameWhitelist map</p>\n\n<pre><code>var hostnameWhitelist = map[string] bool { \"test.mydomain.com\":true, \"test12.mydomaindev.com\":true}\n</code></pre>\n\n<p>And the way I check if incoming request's hostname is allowed or not is - </p>\n\n<pre><code>    url, errURL := url.Parse(\"test.mydomain.com\")\n    if errURL != nil {\n        fmt.Println(\"error during parsing URL\")\n        return false\n    }\n    fmt.Println(\"HOSTNAME = \" + url.Hostname())\n\n    if ok := hostnameWhitelist[url.Hostname()]; ok {\n        fmt.Println(\"valid domain, allow access\")\n    } else {\n        fmt.Println(\"NOT valid domain\")\n        return false\n    }\n</code></pre>\n\n<p>While this works great, how do I do a wild card match like - </p>\n\n<pre><code>*.mydomain.com \n*.mydomaindev.com \n</code></pre>\n\n<p>Both of these should pass.</p>\n\n<p>While,</p>\n\n<pre><code>*.test.com\n*.hello.com\n</code></pre>\n\n<p>should fail</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 5381, "user_id": 3958148, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/1d13082f7803e52dd98b2808509976c2?s=128&d=identicon&r=PG", "display_name": "Sung Cho", "link": "https://stackoverflow.com/users/3958148/sung-cho"}, "edited": false, "score": 0, "creation_date": 1507792729, "post_id": 46683834, "comment_id": 80354129, "body": "Thanks. I suggested an edit to make the answer a bit more relevant to the specificities of the question."}], "tags": [], "owner": {"reputation": 415, "user_id": 2851543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14ccf22c2997ad9d6512b4a0a5527e6a?s=128&d=identicon&r=PG&f=1", "display_name": "Jinzhu", "link": "https://stackoverflow.com/users/2851543/jinzhu"}, "is_accepted": true, "score": 1, "last_activity_date": 1508383280, "last_edit_date": 1508383280, "creation_date": 1507711787, "answer_id": 46683834, "question_id": 46683677, "link": "https://stackoverflow.com/questions/46683677/define-tsvector-type-column-for-a-model/46683834#46683834", "title": "Define tsvector type column for a model", "body": "<pre><code>type Address struct {\n    TSV string         `gorm:\"type:tsvector\"`\n}\n</code></pre>\n\n<p>Also refer  <a href=\"https://github.com/jinzhu/gorm/blob/master/dialects/postgres/postgres.go\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/blob/master/dialects/postgres/postgres.go</a>, it should works similar like hstore, jsonb</p>\n"}], "owner": {"reputation": 5381, "user_id": 3958148, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/1d13082f7803e52dd98b2808509976c2?s=128&d=identicon&r=PG", "display_name": "Sung Cho", "link": "https://stackoverflow.com/users/3958148/sung-cho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 46683834, "answer_count": 1, "score": 1, "last_activity_date": 1527756735, "creation_date": 1507711348, "last_edit_date": 1527756735, "question_id": 46683677, "link": "https://stackoverflow.com/questions/46683677/define-tsvector-type-column-for-a-model", "title": "Define tsvector type column for a model", "body": "<p>I would like to add a column of type <code>tsvector</code> in postgres by defining a field in a model struct. It would look sort of like:</p>\n\n<pre><code>type Issue struct {\n  ...\n  TSV tsvector `json:\"tsv\"`\n}\n</code></pre>\n\n<p>The reason is that I would like to use gorm's <code>AutoMigrate</code> to keep the tables up-to-date while developing. Any ideas?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 5, "creation_date": 1507708924, "post_id": 46682878, "comment_id": 80313485, "body": "<code>&quot;&quot;</code> is also a legitimate string. In Go, only pointer and interface values can be nil, so there really is no way to make a number nil."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 6, "creation_date": 1507709035, "post_id": 46682878, "comment_id": 80313562, "body": "Perhaps what you mean is <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\"><code>zero value</code></a> for number?"}, {"owner": {"reputation": 56338, "user_id": 4265352, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lzAUc5pYb24/AAAAAAAAAAI/AAAAAAAAAGQ/q3h7bZUnqrs/photo.jpg?sz=128", "display_name": "axiac", "link": "https://stackoverflow.com/users/4265352/axiac"}, "edited": false, "score": 2, "creation_date": 1507709949, "post_id": 46682878, "comment_id": 80314139, "body": "<code>nil</code> (or <code>null</code>/<code>NULL</code> in other languages) is not the same or a replacement of the empty string or of zero. It is a concept that represents the absence of any value, a value that is not known or a value that doesn&#39;t matter in the context. The empty string is an invalid person name but <code>nil</code> might be a perfectly valid value. It means the name is not known yet."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 8, "last_activity_date": 1507710803, "last_edit_date": 1507710803, "creation_date": 1507709717, "answer_id": 46683148, "question_id": 46682878, "link": "https://stackoverflow.com/questions/46682878/why-is-nil-value-for-numbers-0/46683148#46683148", "title": "Why is &quot;nil&quot; value for numbers 0?", "body": "<blockquote>\n  <p>The \"<code>nil</code>\" value for a string <code>\"\"</code> makes sense to me but <code>0</code> is a legitimate number.</p>\n</blockquote>\n\n<p>There are two obvious problems with your statement:</p>\n\n<ol>\n<li>There is no such thing as a <strong>\"<code>nil</code>\" value for a string</strong>.</li>\n<li><code>\"\"</code> is a perfectly legitimate string.</li>\n</ol>\n\n<p>You seem to be confusing Go's concept of a \"zero value\" with nil. These concepts are almost entirely unrelated.</p>\n\n<ul>\n<li>The zero value for a string is <code>\"\"</code>.</li>\n<li>The zero value for a number is <code>0</code>.</li>\n<li>The zero value for a pointer or interface is <code>nil</code>.  This is the only place where <code>nil</code> and \"zero values\" really relate to each other.</li>\n</ul>\n\n<p>Further strings, numbers, and other concrete types cannot ever be <code>nil</code> in Go.  (Pointers to these types can be, but that's obviously distinct).  So talking about a \"nil value for a string\" or \"nil value for a number\" doesn't even make sense.</p>\n\n<hr>\n\n<p>In response to your edit, this question has already been answered in various contexts. See <a href=\"https://stackoverflow.com/q/19633763/13860\">here</a> for an example relating to JSON unmarshaling. In short, though, you must use something other than a number/string type. Use a pointer, or a wrapper type (such as a <a href=\"https://golang.org/pkg/database/sql/#NullInt64\" rel=\"nofollow noreferrer\">sql.NullInt64</a>).</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1507721621, "last_edit_date": 1507721621, "creation_date": 1507710232, "answer_id": 46683301, "question_id": 46682878, "link": "https://stackoverflow.com/questions/46682878/why-is-nil-value-for-numbers-0/46683301#46683301", "title": "Why is &quot;nil&quot; value for numbers 0?", "body": "<p>A <em>designated</em> value from the set of <em>valid</em> values of the type have to be chosen. What else could qualify more for the position to be the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero-value</a>?</p>\n\n<p><code>nil</code> is not a valid value of numerical types (such as <code>int</code>, <code>uint</code>, <code>int32</code> etc.), so that's out of the question.</p>\n\n<p><code>0</code> has the benefit that in binary representation it's full zeros. It's name is also in line with <em>\"zero value\"</em>.</p>\n\n<p>Maybe <code>-1</code>? <code>-1</code> in binary representation is full ones (using <a href=\"https://en.wikipedia.org/wiki/Two%27s_complement\" rel=\"nofollow noreferrer\">2's complement</a> representation). <code>-1</code> is not any more special.</p>\n\n<p>Then maybe the min value? In case of <code>int32</code> that would be <code>-1 &lt;&lt; 31</code> which is <code>-2147483648</code>. But if the type is unsigned, e.g. <code>uint32</code>, that would again be <code>0</code>. Moreover, taking the type <code>int</code> the min value is not even a constant as it depends on the target architecture (may be <code>-1 &lt;&lt; 31</code> and <code>-1 &lt;&lt; 63</code>).</p>\n\n<p>If <code>0</code> is a value you use and you want to differentiate whether it has already been set (or if the value is just being the zero value), use a pointer (e.g. <code>*int</code>) which may have a <code>nil</code> value (the zero value) indicating it has not yet been set.</p>\n\n<p>Another option is to use a second variable (may be of type <code>bool</code>), it's <code>true</code> value indicating the number has been set.</p>\n\n<p>Also more techniques (choosing a clever, non-used valid value), check out <a href=\"https://stackoverflow.com/questions/30731687/how-do-i-represent-an-optional-string-in-go/30741287#30741287\">How do I represent an Optional String in Go?</a></p>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 5429860, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uJgVQdMge1s/AAAAAAAAAAI/AAAAAAAAABI/7KMbbfYvUrQ/photo.jpg?sz=128", "display_name": "\u591c\u9611\u542c\u98ce", "link": "https://stackoverflow.com/users/5429860/%e5%a4%9c%e9%98%91%e5%90%ac%e9%a3%8e"}, "is_accepted": false, "score": 3, "last_activity_date": 1507989561, "last_edit_date": 1507989561, "creation_date": 1507717638, "answer_id": 46685867, "question_id": 46682878, "link": "https://stackoverflow.com/questions/46682878/why-is-nil-value-for-numbers-0/46685867#46685867", "title": "Why is &quot;nil&quot; value for numbers 0?", "body": "<p>For <code>string</code>, the default value is <code>\"\"</code>; for <code>bool</code>, the default value is <code>false</code>; for <code>int</code>, the default value is <code>0</code>.</p>\n\n<p>You can use pointer.</p>\n\n<pre><code>var num *int\nif num == nil {\n    // num is not set\n} else {\n    // num is set\n    if *num == 0 {\n        // num is set to 0\n    } else {\n        // num is set to another integer\n    }\n}\n</code></pre>\n\n<p>In the same way, you can judge if a boolean value is set or not.</p>\n"}, {"tags": [], "owner": {"reputation": 24853, "user_id": 446681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cBjgR.jpg?s=128&g=1", "display_name": "Hector Correa", "link": "https://stackoverflow.com/users/446681/hector-correa"}, "is_accepted": false, "score": 0, "last_activity_date": 1507733476, "creation_date": 1507733476, "answer_id": 46691362, "question_id": 46682878, "link": "https://stackoverflow.com/questions/46682878/why-is-nil-value-for-numbers-0/46691362#46691362", "title": "Why is &quot;nil&quot; value for numbers 0?", "body": "<blockquote>\n  <p>Is there a typical way of working around this sort of occurrence in go?</p>\n</blockquote>\n\n<p>Whether an empty string or a zero is a valid/invalid value depends on the application. An empty name might be invalid for your application, but it might be valid in other cases. </p>\n\n<p>A way to handle this in Go is by creating a struct and in there represent whether you have the value or not. For example:</p>\n\n<pre><code>type Person struct {\n  Name    string\n  HasName bool\n  Age     int\n  HasAge  bool\n}\n</code></pre>\n\n<p>This seems a bit cumbersome for such a contrived example, but in more complex scenarios the overhead of having the extra field is minimal. </p>\n"}], "owner": {"reputation": 87, "user_id": 7523916, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/ReY6Q.jpg?s=128&g=1", "display_name": "Winston Guess", "link": "https://stackoverflow.com/users/7523916/winston-guess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2583, "favorite_count": 0, "accepted_answer_id": 46683148, "answer_count": 4, "score": 2, "last_activity_date": 1507989561, "creation_date": 1507708793, "last_edit_date": 1507710166, "question_id": 46682878, "link": "https://stackoverflow.com/questions/46682878/why-is-nil-value-for-numbers-0", "title": "Why is &quot;nil&quot; value for numbers 0?", "body": "<p>The \"<code>nil</code>\" value for a string <code>\"\"</code> makes sense to me but <code>0</code> is a legitimate number. For instance, the number of people in a room can be <code>0</code> but a person's name cannot be <code>\"\"</code>. What was the reasoning behind this convention?</p>\n\n<p><strong>(Edit) Additional info:</strong></p>\n\n<p>What I would like to do is have a way of testing if a value has been set for a number. Having someone's name set to <code>\"\"</code> is obviously not correct, whereas having an integer set to zero may have been legitimate. Is there a typical way of working around this sort of occurrence in go?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1508766092, "last_edit_date": 1508766092, "creation_date": 1507711199, "answer_id": 46683630, "question_id": 46682114, "link": "https://stackoverflow.com/questions/46682114/init-and-destroy-function/46683630#46683630", "title": "Init and destroy function", "body": "<p>This is documented at <a href=\"https://cloud.google.com/appengine/docs/standard/go/how-instances-are-managed\" rel=\"nofollow noreferrer\">Go - How Instances are Managed</a>.</p>\n\n<p>Unfortunately the Go doc is incomplete, here's the link to the Pyton version: <a href=\"https://cloud.google.com/appengine/docs/standard/python/how-instances-are-managed\" rel=\"nofollow noreferrer\">Python - How Instances are Managed</a>. The way it is implemented / supported is language-agnostic.</p>\n\n<p>When an instance is spin up, an HTTP GET request is sent to the <code>/_ah/start</code> path.</p>\n\n<p>Before an instance is taken down, an HTTP GET request is sent to the <code>/_ah/stop</code> path.</p>\n\n<p>You should use <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">package <code>init()</code> functions</a> for initialization purposes as that always runs, and only once. If a request is required for your init functions, then register a handler to the <code>_/ah/start</code> path.</p>\n\n<p>And you may register a handler to <code>/_ah/stop</code> and implement \"shutdown\" functionality like this:</p>\n\n<pre><code>func init() {\n    http.HandleFunc(\"/_ah/stop\", shutdownHandler)\n}\n\nfunc shutdownHandler(w http.ResponseWriter, r *http.Request) {\n    doSomeWork()\n    saveState()\n}\n</code></pre>\n\n<p>But you can't rely on this 100%:</p>\n\n<blockquote>\n  <p><strong>Note:</strong> It's important to recognize that the shutdown hook is not always able to run before an instance terminates. In rare cases, an outage can occur that prevents App Engine from providing 30 seconds of shutdown time. Thus, we recommend periodically checkpointing the state of your instance and using it primarily as an in-memory cache rather than a reliable data store.</p>\n</blockquote>\n"}], "owner": {"reputation": 13, "user_id": 8757123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dd8144bfe1d96a73cdd7d423de2532b9?s=128&d=identicon&r=PG&f=1", "display_name": "Oliver Glas", "link": "https://stackoverflow.com/users/8757123/oliver-glas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 0, "accepted_answer_id": 46683630, "answer_count": 1, "score": 1, "last_activity_date": 1508766092, "creation_date": 1507706332, "last_edit_date": 1507709944, "question_id": 46682114, "link": "https://stackoverflow.com/questions/46682114/init-and-destroy-function", "title": "Init and destroy function", "body": "<p>I am still beginner with golang in Google Cloud Appengine (standard).\nI want to use a function that is automatically call for the instance shutting down. \nThere is a function init called during startup.\nNow I am looking for the opposite part like a destroy function.\nSeems there is something like that for python, but could not find\nanything for golang.</p>\n\n<p>How could you realise such a destroy fuction in google appengine instances ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 3, "creation_date": 1507704036, "post_id": 46680975, "comment_id": 80310515, "body": "I don&#39;t think you can do that, godoc expects the packages to be under a src/ directory. If you placed your <code>test</code> package in <code>~&#47;my_packages&#47;src&#47;</code> , so there would be a <code>~&#47;my_packages&#47;src&#47;test</code> directory, you could run <code>GOROOT=~&#47;my_packages godoc test</code> though."}, {"owner": {"reputation": 303, "user_id": 2829757, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0231f62bf3e26f7d0585656f563b9a52?s=128&d=identicon&r=PG&f=1", "display_name": "jsc", "link": "https://stackoverflow.com/users/2829757/jsc"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1507704580, "post_id": 46680975, "comment_id": 80310847, "body": "@nos Good enough, thank you!"}], "owner": {"reputation": 303, "user_id": 2829757, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0231f62bf3e26f7d0585656f563b9a52?s=128&d=identicon&r=PG&f=1", "display_name": "jsc", "link": "https://stackoverflow.com/users/2829757/jsc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 892, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1507702309, "creation_date": 1507702309, "question_id": 46680975, "link": "https://stackoverflow.com/questions/46680975/how-can-go-documentation-be-generated-from-any-folder", "title": "How can Go Documentation be generated from any folder?", "body": "<p>I have a package with files called <code>test</code> which is in the folder <code>~/my_packages/test</code>.</p>\n\n<p>My GoPath is set to <code>~/go</code>, i.e</p>\n\n<pre><code>$ echo $GOPATH\n~/go\n</code></pre>\n\n<p>What arguments need to be passed to <code>godoc</code> in to view the documentation of files for the <code>test</code> package?</p>\n\n<p>I have tried:</p>\n\n<ul>\n<li><code>godoc -goroot=~/my_packages test</code>\n\n<ul>\n<li>Result: <code>cannot find package \".\" in: /src/test</code></li>\n</ul></li>\n<li><code>godoc -goroot=~/my_packages ./test</code>\n\n<ul>\n<li>Result: <code>cannot find package \".\" in: /target</code></li>\n</ul></li>\n<li><code>export GOPATH=$GOPATH:~/my_packages; godoc test</code>\n\n<ul>\n<li>Result: <code>cannot find package \".\" in: /src/test</code></li>\n</ul></li>\n</ul>\n\n<p>I can start the godoc HTTP server and see the folder, but only the code is visible. The expected package documentation is not available.</p>\n\n<pre><code>godoc -http=:6060 -goroot=/full/path/to/my_packages\n</code></pre>\n\n<p>What <code>godoc</code> command can be run to generate documentation for packages in folders in any directory?</p>\n\n<p>Thank you in advance for your help!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1507702287, "post_id": 46680755, "comment_id": 80309676, "body": "What is the point (use case) of declaring a <code>type</code> without any underlying representation (e.g. <code>type MyFloat</code> in your question)?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8217174"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1507703042, "post_id": 46680755, "comment_id": 80310028, "body": "@putu ok. Then how did the <code>run()</code> work?"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 3, "creation_date": 1507703559, "post_id": 46680755, "comment_id": 80310271, "body": "<code>run()</code> is a method not <i>a type declaration</i>, thus the <i>rule</i> is different. Method/function may not returning any value, e.g. <code>func main()</code> in the question. It is also possible to return value(s) having any type (not limited to <code>float64</code>), e.g. <code>string, float64, MyFloat</code>, etc... Note that <i>type declaration</i> <b>does not</b> return a type. It creates user defined type in which the underlying representation is given <i>after</i> the type name (<code>MyFloat</code>&#39;s underlying type is <code>float64</code>)."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1507708855, "last_edit_date": 1507708855, "creation_date": 1507707913, "answer_id": 46682599, "question_id": 46680755, "link": "https://stackoverflow.com/questions/46680755/method-ambiguity-when-declaring-a-type-in-go/46682599#46682599", "title": "method ambiguity when declaring a type in Go", "body": "<p>You are confusing types and methods. As putu already menitioned in a comment, types don't \"return\" anything. In a kind of handwavy way most types are just data structures that you can attach methods to*.</p>\n\n<p>Another way to write the methods in your example is this:</p>\n\n<pre><code>// func (f MyFloat) Abs() float64 {\nfunc Abs(f MyFloat) float64 {\n    if f &lt; 0 {\n        return float64(-f)\n    }\n    return float64(f)\n}\n\n// func (f MyFloat) run() string {\nfunc run(f MyFloat) string {\n    fmt.Println(\"This is called\")\n    return \"Hey there\"\n}\n</code></pre>\n\n<p>Note that the function bodies are no different at all. The difference is just in how you call these functions. Semantically they are equivalent. The receiver of a method becomes the implicit first argument to a function.</p>\n\n<p>[*] This ignores function types, which don't hold data. net/http.HandlerFunc is a prominent example in the standard library.</p>\n\n<pre><code>type HandlerFunc func(ResponseWriter, *Request)\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8217174"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1507708855, "creation_date": 1507701218, "last_edit_date": 1507703839, "question_id": 46680755, "link": "https://stackoverflow.com/questions/46680755/method-ambiguity-when-declaring-a-type-in-go", "title": "method ambiguity when declaring a type in Go", "body": "<p>I'm learning go and came across this piece of code on go tour:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\ntype MyFloat int\n\nfunc (f MyFloat) Abs() float64 {\n    if f &lt; 0 {\n        return float64(-f)\n    }\n    return float64(f)\n}\n\nfunc (f MyFloat) run() string{\n    fmt.Println(\"This is called\")\n    return \"Hey there\"\n    }\n\nfunc main() {\n    f := MyFloat(-math.Sqrt2)\n    fmt.Println(f.Abs())\n    fmt.Println(f.run())\n}\n</code></pre>\n\n<p>Here we declare a type named MyFloat and return type is float64. I was thinking that I can declare methods which only returns float64. I declared a method named <code>run()</code> in the above case which returns string. How is this possible? Why can't I just declare the type with no specific return type like this <code>type MyFloat</code>?</p>\n\n<p><a href=\"https://play.golang.org/p/K33MHexzlL\" rel=\"nofollow noreferrer\">Example in Playground</a></p>\n"}, {"tags": ["go", "docker-compose"], "owner": {"reputation": 251, "user_id": 4071961, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/727fbc3d44b047cc30e0db6e62009ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan  Bukharin", "link": "https://stackoverflow.com/users/4071961/ivan-bukharin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 282, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507695616, "creation_date": 1507695616, "question_id": 46679768, "link": "https://stackoverflow.com/questions/46679768/docker-compose-file-with-golang-template-vars", "title": "Docker Compose file with Golang Template vars", "body": "<p>I want to use something:</p>\n\n<pre><code>version: '3.3'\nservices:\n    nginx:\n        image: nginx:alpine\n        environment:\n           - TEMP123='{{ range $key, $value := . }}{{ $key }}{{end}}'\n</code></pre>\n\n<p>And I get result:</p>\n\n<pre><code>failed to create service nginx_nginx: Error response from daemon: rpc error: code = InvalidArgument desc = expanding env failed: expanding env \"TEMP123='{{ range ,  := . }}{{  }}{{end}}'\": template: expansion:1: unexpected \",\" in range\n</code></pre>\n\n<p>May be I need to shield symbol '$' ?</p>\n"}, {"tags": ["go", "aerospike"], "answers": [{"comments": [{"owner": {"reputation": 1520, "user_id": 4267030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BOrG6b-sscc/AAAAAAAAAAI/AAAAAAAAAWA/D2MY5eo53kU/photo.jpg?sz=128", "display_name": "Amir Rahimi Farahani", "link": "https://stackoverflow.com/users/4267030/amir-rahimi-farahani"}, "edited": false, "score": 0, "creation_date": 1508237210, "post_id": 46684746, "comment_id": 80522660, "body": "The question is not about replacing an item inside a slice in Go. The idea behind <code>ListSetOp</code> is to replace a single item in the list without writing the whole list back."}], "tags": [], "owner": {"reputation": 157, "user_id": 2853674, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001786755227/picture?type=large", "display_name": "Satyam Zode", "link": "https://stackoverflow.com/users/2853674/satyam-zode"}, "is_accepted": false, "score": 2, "last_activity_date": 1507714456, "creation_date": 1507714456, "answer_id": 46684746, "question_id": 46679631, "link": "https://stackoverflow.com/questions/46679631/how-to-iterate-through-the-list-in-aerospike-using-golang/46684746#46684746", "title": "How to iterate through the list in aerospike using golang?", "body": "<p>Assuming that you have the list called <code>List</code>. \nLet us say you want to replace element called <code>value</code> with <code>newItem</code> \nYou can do that like:  </p>\n\n<pre><code>...\n\nfor index, item := range List {\n     if item == value {\n             List[index] = newItem\n     }\n}\n\n...\n</code></pre>\n\n<p>In the above snippet, <code>index</code> is the index at which element <code>item</code> is present. By this way you can also replace element present on the particular index in the list with <code>value</code>. </p>\n\n<p>Sample example in playground: <a href=\"https://play.golang.org/p/qOmsY9fbL2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qOmsY9fbL2</a></p>\n"}, {"tags": [], "owner": {"reputation": 1520, "user_id": 4267030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BOrG6b-sscc/AAAAAAAAAAI/AAAAAAAAAWA/D2MY5eo53kU/photo.jpg?sz=128", "display_name": "Amir Rahimi Farahani", "link": "https://stackoverflow.com/users/4267030/amir-rahimi-farahani"}, "is_accepted": false, "score": 2, "last_activity_date": 1508237002, "creation_date": 1508237002, "answer_id": 46788234, "question_id": 46679631, "link": "https://stackoverflow.com/questions/46679631/how-to-iterate-through-the-list-in-aerospike-using-golang/46788234#46788234", "title": "How to iterate through the list in aerospike using golang?", "body": "<p>As usual, items in the list are indexed by their integer position starting from zero.\nAerospike also supports negative indexing to start backwards from end of list.</p>\n\n<p><a href=\"https://www.aerospike.com/docs/guide/cdt-list.html\" rel=\"nofollow noreferrer\">Lists documentation in the Aerospike</a>:</p>\n\n<blockquote>\n  <p>Elements are ordered by integer position.</p>\n</blockquote>\n\n<p><a href=\"https://www.aerospike.com/apidocs/nodejs/module-aerospike_lists.html\" rel=\"nofollow noreferrer\">Lists documentation in the Aerospike's Node.js client</a>:</p>\n\n<blockquote>\n  <p>List operations support negative indexing. If the index is negative, the resolved index starts backwards from end of list.</p>\n  \n  <p>Index/Range examples:</p>\n  \n  <ul>\n  <li>Index 0: First item in list.</li>\n  <li>Index 4: Fifth item in list.</li>\n  <li>Index -1: Last item in list.</li>\n  <li>Index -3: Third to last item in list.</li>\n  </ul>\n</blockquote>\n\n<p>Also mentioned in <a href=\"https://github.com/aerospike/aerospike-client-go/blob/dcec4388c832b931227afe511b7f047c6b1b53ce/cdt_list.go#L25\" rel=\"nofollow noreferrer\">Go client source</a>.  </p>\n\n<pre><code>list := []string{\u201ca\u201d, \u201cb\u201d, \u201cc\u201d, \u201cd\u201d, \u201ce\u201d}\nbin := aerospike.NewBin(\"listbin\", list)\nerr := client.PutBins(nil, key, bin)\n\n// to replace \u201cd\u201d:\nop := aerospike.ListSetOp(bin.Name, 3, \"replaced\")\n_, err = client.Operate(nil, key, op)\n</code></pre>\n"}], "owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1508237002, "creation_date": 1507694680, "question_id": 46679631, "link": "https://stackoverflow.com/questions/46679631/how-to-iterate-through-the-list-in-aerospike-using-golang", "title": "How to iterate through the list in aerospike using golang?", "body": "<p>I am using the list data type (<a href=\"http://www.aerospike.com/docs/guide/cdt-list.html\" rel=\"nofollow noreferrer\">http://www.aerospike.com/docs/guide/cdt-list.html</a>\n) in aerospike using a golang client. I can use the ListInsertOp (<a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go#ListInsertOp\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/aerospike/aerospike-client-go#ListInsertOp</a>) to insert values in the list of a given entry. </p>\n\n<p>However, I want to update/delete a given list value using the ListSetOp (<a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go#ListSetOp\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/aerospike/aerospike-client-go#ListSetOp</a>) or the ListRemoveOp (<a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go#ListRemoveOp\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/aerospike/aerospike-client-go#ListRemoveOp</a>)</p>\n\n<p>In order to do this, I need an index. How can I get this index ? Is there a way I can iterate through all the list values and get the index and then perform the update or delete operation ?</p>\n"}, {"tags": ["go", "struct", "types", "comparison"], "comments": [{"owner": {"reputation": 2358, "user_id": 1277637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/c2ADe.jpg?s=128&g=1", "display_name": "mattjegan", "link": "https://stackoverflow.com/users/1277637/mattjegan"}, "edited": false, "score": 0, "creation_date": 1507694416, "post_id": 46679484, "comment_id": 80307061, "body": "I&#39;m go expert (hence a comment), but I would guess that structs behave similar to strings in that they are untyped until they are required. That is, comparing some string constant to a named string type will work, but comparing two named string types will raise a compiler error. This would be caused by go being very type strict and hence sees 2 &quot;different&quot; named types and hence raises the error. Again, I&#39;m only just learning go myself so could be way off."}], "answers": [{"comments": [{"owner": {"reputation": 2358, "user_id": 1277637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/c2ADe.jpg?s=128&g=1", "display_name": "mattjegan", "link": "https://stackoverflow.com/users/1277637/mattjegan"}, "edited": false, "score": 1, "creation_date": 1507695167, "post_id": 46679644, "comment_id": 80307259, "body": "You stated that the structs would be comparable &quot;Even if the type names are different&quot;, could you explain why OP got a compiler error for <code>v1 == v2</code> please?"}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "reply_to_user": {"reputation": 2358, "user_id": 1277637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/c2ADe.jpg?s=128&g=1", "display_name": "mattjegan", "link": "https://stackoverflow.com/users/1277637/mattjegan"}, "edited": false, "score": 0, "creation_date": 1507695377, "post_id": 46679644, "comment_id": 80307317, "body": "Good catch @mattjegan - my error.  Updated the wording."}], "tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": true, "score": 5, "last_activity_date": 1507695490, "last_edit_date": 1507695490, "creation_date": 1507694726, "answer_id": 46679644, "question_id": 46679484, "link": "https://stackoverflow.com/questions/46679484/golang-why-named-and-non-named-struct-comparison-with-equal-result/46679644#46679644", "title": "golang why named and non-named struct comparison with equal result", "body": "<p>If you read that spec carefully, you can see that if the corresponding non-blank fields are equal then the two structs are equal.  If the type <em>name</em> is different the compiler will fail, but if one or both of the types are anonymous then they'll be comparable. The types <code>T1</code> or <code>T2</code>, and the anonymous structs are effectively the same type because they have the same fields.  When the field values are the same then they compare as the same.</p>\n\n<p>Looking at <a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow noreferrer\">type identity</a> in the spec may (or may not, ymmv) make it clearer.</p>\n\n<blockquote>\n  <p>Two struct types are identical if they have the same sequence of fields, and if corresponding fields have the same names, and identical types, and identical tags. Non-exported field names from different packages are always different.</p>\n</blockquote>\n\n<p>So, if you try the same experiment but change the types by adding field tags, or by putting the types in different packages, you may get the differences you expect.</p>\n"}, {"comments": [{"owner": {"reputation": 117, "user_id": 8573451, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c1edaa715157396aaef5efecb094e144?s=128&d=identicon&r=PG&f=1", "display_name": "Hui", "link": "https://stackoverflow.com/users/8573451/hui"}, "edited": false, "score": 0, "creation_date": 1507700245, "post_id": 46680376, "comment_id": 80308975, "body": "i am still confuse the spec &quot;In any comparison, the first operand must be assignable to the type of the second operand, or vice versa.&quot;; based on my understand, that if variable v1 and v2 is comparable, it means v1 is assignable to v2 or v2 is assignable to v1, but it does not mean &quot;if v1 is assignable to v2, or vice verse, v1 and v2 is comparable&quot;. so assignable is a necessary condition for comparable, not a sufficient condition for comparable. is this true ? thx"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 117, "user_id": 8573451, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c1edaa715157396aaef5efecb094e144?s=128&d=identicon&r=PG&f=1", "display_name": "Hui", "link": "https://stackoverflow.com/users/8573451/hui"}, "edited": false, "score": 0, "creation_date": 1507708671, "post_id": 46680376, "comment_id": 80313338, "body": "@Hui Your understanding is correct. See edited answer with example."}, {"owner": {"reputation": 117, "user_id": 8573451, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c1edaa715157396aaef5efecb094e144?s=128&d=identicon&r=PG&f=1", "display_name": "Hui", "link": "https://stackoverflow.com/users/8573451/hui"}, "edited": false, "score": 0, "creation_date": 1507712115, "post_id": 46680376, "comment_id": 80315400, "body": "with your nice explanation, i think i has understand the issue, i will update my question."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1507724951, "last_edit_date": 1592644375, "creation_date": 1507699162, "answer_id": 46680376, "question_id": 46679484, "link": "https://stackoverflow.com/questions/46679484/golang-why-named-and-non-named-struct-comparison-with-equal-result/46680376#46680376", "title": "golang why named and non-named struct comparison with equal result", "body": "<p>What you miss is that the (equality) comparison operator does not require its operands to be of the same type. The requirement is according to the <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">Spec: Comparison operators:</a></p>\n<blockquote>\n<p>In any comparison, the first operand must be <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\"><strong>assignable</strong></a> to the type of the second operand, or vice versa.</p>\n</blockquote>\n<p>Yes, type equality automatically gives the assignability attribute, but there are other cases:</p>\n<blockquote>\n<p>A value <code>x</code> is assignable to a variable of type <code>T</code> (&quot;<code>x</code> is assignable to <code>T</code>&quot;) in any of these cases:</p>\n<ul>\n<li><code>x</code>'s type is identical to <code>T</code>.</li>\n<li><strong><code>x</code>'s type <code>V</code> and <code>T</code> have identical <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">underlying types</a> and at least one of <code>V</code> or <code>T</code> is not a <a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"nofollow noreferrer\">defined</a> type.</strong></li>\n<li><code>T</code> is an interface type and <code>x</code> <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">implements</a> <code>T</code>.</li>\n<li><code>x</code> is a bidirectional channel value, <code>T</code> is a channel type, <code>x</code>'s type <code>V</code> and <code>T</code> have identical element types, and at least one of <code>V</code> or <code>T</code> is not a defined type.</li>\n<li><code>x</code> is the predeclared identifier <code>nil</code> and <code>T</code> is a pointer, function, slice, map, channel, or interface type.</li>\n<li><code>x</code> is an untyped <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">constant</a> representable by a value of type <code>T</code>.</li>\n</ul>\n</blockquote>\n<p>The highlighted rule applies here. <code>v1</code>, <code>v2</code> and <code>v3</code> all have the same underlying type (which is <code>struct { name string }</code>), and in the <code>v1 == v3</code> and <code>v2 == v3</code> comparisons only <code>v1</code>'s type is <a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"nofollow noreferrer\">defined</a>. So they are assignable, and from there, the comparison rule that applies to <code>struct</code> values you quoted clearly explains why the result is <code>true</code>:</p>\n<blockquote>\n<p>Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-blank fields are equal.</p>\n</blockquote>\n<p>There's nothing &quot;shocking&quot; about this if you think about it. You're not comparing the types, you're comparing the values. What may not be intuitive is when the comparison may be used, but the rules are listed clearly and cleanly at assignability.</p>\n<p>Another similar example (try it on the <a href=\"https://play.golang.org/p/vb1YJZMKed\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>var i interface{} = 3\nvar j int = 3\nfmt.Println(i == j) // Comparing interface{} with int: true\n</code></pre>\n<p>We're comparing values of <code>interface{}</code> and <code>int</code> types (even more &quot;distant&quot; that your struct types), yet this is valid and the result is <code>true</code> and there's nothing shocking about that either, on the contrary, we'd expect that. <code>int</code> is assignable to a variable of type <code>interface{}</code> (everything is assignable to <code>interface{}</code>). When comparing them, an implicit <code>interface{}</code> value will be created that wraps <code>j</code>, and those 2 interface values will be compared according to this rule:</p>\n<blockquote>\n<p>Interface values are comparable. Two interface values are equal if they have identical dynamic types and equal dynamic values or if both have value <code>nil</code>.</p>\n</blockquote>\n<p><strong>Notes:</strong></p>\n<p>Assignability is a <em>requirement</em> but not a <em>satisfactory</em> condition to comparability. Further requirements are outlined in the <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">Spec: Comparison operators</a> that also must be met, based on the types of the operands:</p>\n<blockquote>\n<p>The equality operators <code>==</code> and <code>!=</code> apply to operands that are <em>comparable</em>. The ordering operators <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, and <code>&gt;=</code> apply to operands that are <em>ordered</em>. These terms and the result of the comparisons are defined as follows:</p>\n<ul>\n<li>Boolean values are comparable. Two boolean values are equal if they are either both <code>true</code> or both <code>false</code>.</li>\n<li>Integer values are comparable and ordered, in the usual way.</li>\n<li>Floating-point values are comparable and ordered, as defined by the IEEE-754 standard.</li>\n<li>Complex values are comparable. Two complex values <code>u</code> and <code>v</code> are equal if both <code>real(u) == real(v)</code> and <code>imag(u) == imag(v)</code>.</li>\n<li>String values are comparable and ordered, lexically byte-wise.</li>\n<li>Pointer values are comparable. Two pointer values are equal if they point to the same variable or if both have value <code>nil</code>. Pointers to distinct <a href=\"https://golang.org/ref/spec#Size_and_alignment_guarantees\" rel=\"nofollow noreferrer\">zero-size</a> variables may or may not be equal.</li>\n<li>Channel values are comparable. Two channel values are equal if they were created by the same call to <a href=\"https://golang.org/ref/spec#Making_slices_maps_and_channels\" rel=\"nofollow noreferrer\">make</a> or if both have value <code>nil</code>.</li>\n<li>Interface values are comparable. Two interface values are equal if they have <a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow noreferrer\">identical</a> dynamic types and equal dynamic values or if both have value <code>nil</code>.</li>\n<li>A value <code>x</code> of non-interface type <code>X</code> and a value <code>t</code> of interface type <code>T</code> are comparable when values of type <code>X</code> are comparable and <code>X</code> implements <code>T</code>. They are equal if <code>t</code>'s dynamic type is identical to <code>X</code> and <code>t</code>'s dynamic value is equal to <code>x</code>.</li>\n<li>Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-<a href=\"https://golang.org/ref/spec#Blank_identifier\" rel=\"nofollow noreferrer\">blank</a> fields are equal.</li>\n<li>Array values are comparable if values of the array element type are comparable. Two array values are equal if their corresponding elements are equal.</li>\n</ul>\n<p>A comparison of two interface values with identical dynamic types causes a <a href=\"https://golang.org/ref/spec#Run_time_panics\" rel=\"nofollow noreferrer\">run-time panic</a> if values of that type are not comparable. This behavior applies not only to direct interface value comparisons but also when comparing arrays of interface values or structs with interface-valued fields.</p>\n<p>Slice, map, and function values are not comparable. However, as a special case, a slice, map, or function value may be compared to the predeclared identifier <code>nil</code>. Comparison of pointer, channel, and interface values to nil is also allowed and follows from the general rules above.</p>\n</blockquote>\n<p>As a trivial example the spec explicitly states slice values are not comparable:</p>\n<pre><code>i1, i2 := []int{1, 2}, []int{1, 2}\nfmt.Println(i1 == i2)\n// invalid operation: i1 == i2 (slice can only be compared to nil)\n</code></pre>\n<p>Even though <code>i1</code> and <code>i2</code> have identical types, and therefore <code>i1</code> is assignable to <code>i2</code> (and vice versa), comparison is still not allowed and therefore they are not comparable.</p>\n<p>Another less trivial example is that structs <em>may</em> be comparable <em>if</em> all their fields are comparable. So for example values of this struct are <strong>not</strong> comparable (because it has a field of slice type and slices are not comparable):</p>\n<pre><code>type Foo struct { Names []string }\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 8573451, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/c1edaa715157396aaef5efecb094e144?s=128&d=identicon&r=PG&f=1", "display_name": "Hui", "link": "https://stackoverflow.com/users/8573451/hui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 978, "favorite_count": 1, "accepted_answer_id": 46679644, "answer_count": 2, "score": 3, "last_activity_date": 1507724951, "creation_date": 1507693673, "last_edit_date": 1592644375, "question_id": 46679484, "link": "https://stackoverflow.com/questions/46679484/golang-why-named-and-non-named-struct-comparison-with-equal-result", "title": "golang why named and non-named struct comparison with equal result", "body": "<p>The Go Programming Language <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">Specification</a> said.</p>\n<blockquote>\n<p>Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-blank fields are equal.</p>\n</blockquote>\n<p>But as following code snippet, it seems variable v1, and v3 has different type, why they can get a true output:</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\nimport &quot;reflect&quot;\n\ntype T1 struct { name string }\ntype T2 struct { name string }\n\nfunc main() {\n    v1 := T1 { &quot;foo&quot; }\n    v2 := T2 { &quot;foo&quot; }\n    v3 := struct{ name string } {&quot;foo&quot;}\n    v4 := struct{ name string } {&quot;foo&quot;}\n\n    fmt.Println(&quot;v1: type=&quot;, reflect.TypeOf(v1), &quot;value=&quot;, reflect.ValueOf(v1)) // v1: type= main.T1 value= {foo}\n    fmt.Println(&quot;v2: type=&quot;, reflect.TypeOf(v2), &quot;value=&quot;, reflect.ValueOf(v2)) // v2: type= main.T2 value= {foo}\n    fmt.Println(&quot;v3: type=&quot;, reflect.TypeOf(v3), &quot;value=&quot;, reflect.ValueOf(v3)) // v3: type= struct { name string } value= {foo}\n    fmt.Println(&quot;v4: type=&quot;, reflect.TypeOf(v4), &quot;value=&quot;, reflect.ValueOf(v4)) // v4: type= struct { name string } value= {foo}\n\n    //fmt.Println(v1 == v2) // compiler error: invalid operation: v1 == v2 (mismatched types T1 and T2)\n    fmt.Println(v1 == v3)   // true, why? their type is different\n    fmt.Println(v2 == v3)   // true, why?\n    fmt.Println(v3 == v4)   // true\n}\n</code></pre>\n<p>It's reasonable that <code>v1 == v2</code> fails with compile error because they are different type, however how to explain the <code>v1 == v3</code> get a <code>true</code> result, since they also have different types, one with named struct type <code>T1</code>, and the other with anonymous struct.\nThanks.</p>\n<h2>Update Question based on feedback</h2>\n<p>Thanks @icza, @John Weldon for your explanation, I think this issue is resolved, I am now updating the question.</p>\n<p>In summary, a struct is comparable if it meet following 2 specs:</p>\n<blockquote>\n<ol>\n<li><p>Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-blank fields are equal.</p>\n</li>\n<li><p>In any comparison, the first operand must be assignable to the type of the second operand, or vice versa.</p>\n</li>\n</ol>\n</blockquote>\n<p>The 1st one is for struct type variable specific; and the 2nd one is for all types variable comparison, struct type variable is covered of course.</p>\n<p>In my sample, the comparison variable v1 and v3 meet these two specs definition.</p>\n<ol>\n<li>All fields are comparable; in fact, the first spec define the struct rule, it focus on fields, but not struct itself, so whatever a named struct or anonymous struct, they are same rule.</li>\n<li>Variable v1 and v3 is assignable. (according to the rule: x's type V and T have identical underlying types and at least one of V or T is not a defined type)</li>\n</ol>\n<p>So this is to explain why &quot;v1 == v3&quot; can get a true result.\nThanks all.</p>\n"}, {"tags": ["pointers", "go", "syntax", "interface"], "answers": [{"comments": [{"owner": {"reputation": 5730, "user_id": 2704500, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/100556a196f1f860a0b08e8c3519152f?s=128&d=identicon&r=PG&f=1", "display_name": "pandaadb", "link": "https://stackoverflow.com/users/2704500/pandaadb"}, "edited": false, "score": 0, "creation_date": 1575450187, "post_id": 46678266, "comment_id": 104566816, "body": "I like that blog post - it was nice and clear, thank you! This has been confusing me for a while now, too :)"}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 9, "last_activity_date": 1507684598, "creation_date": 1507684598, "answer_id": 46678266, "question_id": 46678088, "link": "https://stackoverflow.com/questions/46678088/golang-function-return-interface-pointer/46678266#46678266", "title": "golang function return interface pointer", "body": "<p>Ok, two thing:</p>\n\n<ol>\n<li>You cannot take the address of the result of a conversion directly, as it is not \"addressable\". See the <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"noreferrer\">section of the spec about the address-of operator</a> for more information.</li>\n<li>Why are you using a pointer to an interface at all? In all my projects I have only ever used an interface pointer once. An interface pointer is basically a pointer to a pointer, sometimes needed, but very rare. Internally interfaces are a type/pointer pair. So unless you need to modify the <em>interface value</em> instead of the <em>value the interface holds</em> then you do not need a pointer. <a href=\"https://medium.com/@agileseeker/go-interfaces-pointers-4d1d98d5c9c6\" rel=\"noreferrer\">This post</a> may be of interest to you.</li>\n</ol>\n"}], "owner": {"reputation": 21, "user_id": 8755739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/019f9a31232fce6a06b317ffee70003d?s=128&d=identicon&r=PG&f=1", "display_name": "Stephen Cheng", "link": "https://stackoverflow.com/users/8755739/stephen-cheng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2270, "favorite_count": 0, "accepted_answer_id": 46678266, "answer_count": 1, "score": 3, "last_activity_date": 1561804475, "creation_date": 1507683215, "last_edit_date": 1561804475, "question_id": 46678088, "link": "https://stackoverflow.com/questions/46678088/golang-function-return-interface-pointer", "title": "golang function return interface pointer", "body": "<p>Can some one help me understand why it's failing to use the syntax like [Error 1] and [Error 2]?, why [ok 1] is possible and working just fine.</p>\n\n<p>Is the basic design to use Animal as field to serve as generic type good? or any thing bad about it? or any better solution suggested?</p>\n\n<pre><code>package main\n\nimport (\n    pp \"github.com/davecgh/go-spew/spew\"\n)\n\ntype Cat struct {\n    Name string\n    Age  int\n}\n\ntype Animal interface{}\n\ntype House struct {\n    Name string\n    Pet  *Animal\n}\n\nfunc config() *Animal {\n\n    c := Cat{\"miao miao\", 12}\n    // return &amp;Animal(c) //fail to take address directly        [Error 1]\n    // return &amp;(Animal(c)) //fail to take address directly      [Error 2]\n    a := Animal(c)      //[Ok 1]\n    return &amp;a\n}\n\nfunc main() {\n    pp.Dump(config())\n    pp.Dump(*config())\n    pp.Dump((*config()).(Cat)) //&lt;-------- we want this\n    pp.Dump((*config()).(Cat).Name)\n    pp.Dump(\"---------------\")\n    cfg := config()\n    pp.Dump(&amp;cfg)\n    pp.Dump(*cfg)\n    pp.Dump((*cfg).(Cat)) //&lt;-------- we want this\n    pp.Dump((*cfg).(Cat).Name)\n    pp.Dump(\"---------------\")\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1507674044, "post_id": 46675984, "comment_id": 80302190, "body": "It seems that <code>COPY TO</code> isn&#39;t supported yet in <code>lib&#47;pq</code> and <code>jackc&#47;pgx</code>. How did you execute <code>COPY TO</code> in <code>go-pg</code> (query and code snippet) that causing <i>out of memory</i>? Looking at the source code of <code>go-pg</code>, it reads then write the data in chunk (no <i>buffers it all into memory first</i>)."}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1507675439, "post_id": 46675984, "comment_id": 80302609, "body": "Have you tried: <code>\\copy (SELECT json_agg(foo) FROM foo) TO &#39;&#47;tmp&#47;foo.json&#39;</code> Posgres <b>&gt;9.20</b> required."}, {"owner": {"reputation": 144, "user_id": 8075949, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeTbN.png?s=128&g=1", "display_name": "nk2ge5k", "link": "https://stackoverflow.com/users/8075949/nk2ge5k"}, "edited": false, "score": 1, "creation_date": 1507681496, "post_id": 46675984, "comment_id": 80304070, "body": "Sorry for my english but, why are you just dont <code>select row_to_json(foo) FROM (SELECT * FROM bar) foo</code> writing result into file?"}, {"owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "edited": false, "score": 0, "creation_date": 1507728231, "post_id": 46675984, "comment_id": 80326413, "body": "Updated my question with the code."}, {"owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "edited": false, "score": 0, "creation_date": 1507735045, "post_id": 46675984, "comment_id": 80331452, "body": "In response to nk2ge5k: because that would use up too much RAM."}], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 2, "last_activity_date": 1507774806, "last_edit_date": 1507774806, "creation_date": 1507746578, "answer_id": 46695203, "question_id": 46675984, "link": "https://stackoverflow.com/questions/46675984/golang-postgres-how-to-dump-tables-into-json/46695203#46695203", "title": "Golang Postgres How To Dump Tables Into JSON", "body": "<p>There are two approaches to export table(s) into json file using <code>COPY</code>.</p>\n\n<ol>\n<li><p>Using <a href=\"https://github.com/go-pg/pg\" rel=\"nofollow noreferrer\">go-pg</a>. To avoid <em>out of memory</em> issue, instead of writing the result to buffer, the result should be written  directly to a file. The snippets will be:</p>\n\n<pre><code>//open database connection first\ndb := pg.Connect(&amp;pg.Options{\n    User:     \"username\",\n    Password: \"password\",\n    Database: \"database\",\n    Addr:     \"192.168.1.2:5432\",   //database address\n})\ndefer db.Close()\n\n//open output file\nout, err := os.Create(\"/tmp/bar.json\")\nif err != nil {\n    panic(err)\n}\ndefer out.Close()\n\n//execute opy\ncopy := `COPY (SELECT row_to_json(foo) FROM (SELECT * FROM bar) foo ) TO STDOUT`\n_, err = db.CopyTo(out, copy)\nif err != nil {\n    panic(err)\n}\n</code></pre></li>\n<li><p>Using <a href=\"https://www.postgresql.org/docs/current/static/app-psql.html\" rel=\"nofollow noreferrer\">psql</a> and <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\">exec</a> package. Basically, this approach execute a <code>psql</code> command in the form of: <code>psql -c query1 -c query2 ... args</code>. Please note, this approach requires that <code>psql</code> is already installed. The snippets:</p>\n\n<pre><code>queries := []string{\n    `SET client_encoding='UTF8'`,\n    `\\COPY (SELECT row_to_json(foo) FROM (SELECT * FROM bar) foo ) TO '/tmp/bar.json'`,\n}\ndsn := \"postgresql://username:password@192.168.1.2/database\"\n\n//construct arguments\nargs := []string{}\nfor _, q := range queries {\n    args = append(args, \"-c\", q)\n}\nargs = append(args, dsn)\n\n//Execute psql command\ncmd := exec.Command(\"psql\", args...)\nstdoutStderr, err := cmd.CombinedOutput()\nif err != nil {\n    panic(err)\n}\nfmt.Printf(\"%s\\n\", stdoutStderr)\n</code></pre></li>\n</ol>\n\n<h2>Note</h2>\n\n<p>Adjust the value of connection parameters (<code>username</code>, <code>password</code>, <code>host/ip address</code>, etc) as needed. For the detail, please refer to <a href=\"https://www.postgresql.org/docs/current/static/libpq-connect.html#libpq-connstring\" rel=\"nofollow noreferrer\">the documentation</a>. </p>\n"}], "owner": {"reputation": 458, "user_id": 3066874, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/M5PLK.png?s=128&g=1", "display_name": "Chemdream", "link": "https://stackoverflow.com/users/3066874/chemdream"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1727, "favorite_count": 0, "accepted_answer_id": 46695203, "answer_count": 1, "score": 0, "last_activity_date": 1507774806, "creation_date": 1507669384, "last_edit_date": 1507728213, "question_id": 46675984, "link": "https://stackoverflow.com/questions/46675984/golang-postgres-how-to-dump-tables-into-json", "title": "Golang Postgres How To Dump Tables Into JSON", "body": "<p>I'm trying to run this command for many tables (one table at a time) in Go 1.9:</p>\n\n<pre><code>COPY (select row_to_json(foo) FROM (SELECT * FROM bar) foo ) TO '/tmp/bar.json';\n</code></pre>\n\n<p>Is this even possible? It seems with lib/pg, it is not. With go-pg, I keep running out of memory because it buffers it all into memory first.</p>\n\n<p>Doing this from the command prompt works fine. I'd rather use Go's PG libs than have it run it at command prompt.</p>\n\n<p>In short, I'm trying to dump entire tables into JSON in their own files.</p>\n\n<p>Has anyone done this successfully?</p>\n\n<p>Thank you!</p>\n\n<p>EDIT:</p>\n\n<p>Since lb/pg didn't support this at all, I'm using pg-go. Here is the code:</p>\n\n<pre><code>var buf bytes.Buffer\n    _, err := db.CopyTo(&amp;buf, \"COPY (select row_to_json(foo) FROM (SELECT * FROM bar) r ) TO '/tmp/bar.json'\")\n    if err != nil {\n        panic(err)\n    }\n</code></pre>\n"}, {"tags": ["templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1507706473, "post_id": 46676968, "comment_id": 80311966, "body": "Thanks, I\u2019ve ammended the above to sort keys first to get predictable order too."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1507706441, "last_edit_date": 1507706441, "creation_date": 1507674411, "answer_id": 46676968, "question_id": 46675185, "link": "https://stackoverflow.com/questions/46675185/get-all-keys-from-map-in-golang-template-without-use-vars/46676968#46676968", "title": "Get all keys from map in Golang Template without use vars", "body": "<p>Extract the keys and sort them, then feed them into the view, as iterating a map has indeterminate order anyway (which you don\u2019t want).  </p>\n\n<pre><code>import \"sort\"\n\nvar m map[int]string\nvar keys []int\nfor k := range m {\n    keys = append(keys, k)\n}\nsort.Ints(keys)\n</code></pre>\n\n<p>Within a range loop, use . to refer to the items being ranged. A new context is created for that loop. </p>\n\n<pre><code>{{ range . }}\n  {{ . }}\n{{ end }}\n</code></pre>\n\n<p>However I suggest you fix the problem with using the symbol $, you will want to use that. That sounds like the wrong use of Docker Compose files - you could put your golang templates into separate files, or into the go source files themselves if you want a single binary deploy. </p>\n"}], "owner": {"reputation": 251, "user_id": 4071961, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/727fbc3d44b047cc30e0db6e62009ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Ivan  Bukharin", "link": "https://stackoverflow.com/users/4071961/ivan-bukharin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 892, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1507706441, "creation_date": 1507666362, "question_id": 46675185, "link": "https://stackoverflow.com/questions/46675185/get-all-keys-from-map-in-golang-template-without-use-vars", "title": "Get all keys from map in Golang Template without use vars", "body": "<p>I have something map by . (point symbol) and I want to print just every key.\nI know we can use some:</p>\n\n<pre><code>{{ range $key, $value := . }}{{ $key }}{{end}}\n</code></pre>\n\n<p>But I cant use var, because I use Docker Compose file which problem withi symbol $.</p>\n\n<p>How I can print all keys without use vars?</p>\n"}, {"tags": ["c#", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1507665317, "post_id": 46674845, "comment_id": 80298151, "body": "You&#39;ll likely have to use syscalls to get this done, there is no native Go wrapper for this Windows-specific functionality."}, {"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 1, "creation_date": 1507681022, "post_id": 46674845, "comment_id": 80303977, "body": "Using <code>syscall</code> on .NET DLL&#39;s is not the same as the native C++ DLLs.  I haven&#39;t done this myself, but <a href=\"https://stackoverflow.com/a/44167406/102371\">this</a> answer points to a github project you may want to investigate. (For completeness <a href=\"https://github.com/matiasinsaurralde/go-dotnet\" rel=\"nofollow noreferrer\">here</a> is the github link)"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507681686, "post_id": 46674845, "comment_id": 80304123, "body": "other option is trying to find the equivalent of this Linux command <code>netstat -tulpn</code> on Windows"}], "answers": [{"tags": [], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "is_accepted": false, "score": 0, "last_activity_date": 1509177564, "creation_date": 1509177564, "answer_id": 46987535, "question_id": 46674845, "link": "https://stackoverflow.com/questions/46674845/golang-alternative-for-c-nets-ipglobalproperties-getipglobalproperties/46987535#46987535", "title": "Golang: alternative for C#(.Net&#39;s) IPGlobalProperties.GetIPGlobalProperties()", "body": "<p>In order to find the number of active connections, there is no equivalent wrapper similar to above-mentioned <code>C#</code> methods in <code>Golang</code>. </p>\n\n<p>Though we can achieve this using the syscalls for this we can use the following command if you are Linux user.</p>\n\n<pre><code>netstat -anp | grep :80 | grep ESTABLISHED | wc -l\n</code></pre>\n\n<p>However, in windows os, you might face some problem because <code>grep</code> and <code>wc</code> (word count) command will not work. I faced this problem when I ran it as a windows service. </p>\n\n<p>For Windows OS the following command worked.</p>\n\n<pre><code>netstat -nt | findstr :80  | findstr ESTABLISHED | find /v /c \"\"\n</code></pre>\n\n<p>For /v /c to work you might need to make the exe file execute as administrator \n.</p>\n"}], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1509177564, "creation_date": 1507665042, "question_id": 46674845, "link": "https://stackoverflow.com/questions/46674845/golang-alternative-for-c-nets-ipglobalproperties-getipglobalproperties", "title": "Golang: alternative for C#(.Net&#39;s) IPGlobalProperties.GetIPGlobalProperties()", "body": "<p>I am rewriting one of my windows service(C#) in Golang. I have almost figured out and rewrote the code in Go but got stuck at one place where I am not been able to figure out golang alternative.</p>\n\n<pre><code>public static int GetNumberOfLocalEstablishedConnectionsByPort(string IPAddress, int Port)\n    {\n        int Result = 0;\n        IPGlobalProperties ipProperties = IPGlobalProperties.GetIPGlobalProperties();\n        TcpConnectionInformation[] tcpConnections = ipProperties.GetActiveTcpConnections();\n\n        foreach (TcpConnectionInformation tcpInfo in tcpConnections)\n        {\n                if (tcpInfo.State == TcpState.Established &amp;&amp; tcpInfo.LocalEndPoint.Port == Port) \n                {\n                            Result++;\n                }\n        }\n\n        return Result;\n    }\n</code></pre>\n\n<p>Basically in this method I am finding out active number of connections based on a IP address and Port.</p>\n\n<p>I am seeking help in order to find out how can I rewrite this C# code into Golang. I am using windows OS and want a solution based on <strong>Windows OS</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 101, "user_id": 3898856, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4ba41455a288f3a09a706c4797615b76?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/3898856/ani"}, "edited": false, "score": 0, "creation_date": 1507661870, "post_id": 46674017, "comment_id": 80296473, "body": "Sorry missed out the error:   # command-line-arguments   ./uniq.go:5: syntax error: unexpected var, expecting )   Error: process exited with code 2."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1507661960, "post_id": 46674017, "comment_id": 80296519, "body": "That means, on line #5, the parser wasn&#39;t expecting the symbol <code>var</code>. that&#39;s not valid syntax."}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 3, "creation_date": 1507662460, "post_id": 46674017, "comment_id": 80296790, "body": "<code>func do_comp(var line string) {</code> should be <code>func do_comp(line string) {</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507663030, "post_id": 46674017, "comment_id": 80297083, "body": "Try going though the <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">Tour of Go</a> o get a feel for the syntax of the language. Also, <i>always</i> format the code, which will more easily highlight simple mistakes."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1507663584, "last_edit_date": 1507663584, "creation_date": 1507663209, "answer_id": 46674361, "question_id": 46674017, "link": "https://stackoverflow.com/questions/46674017/declaring-go-function-throws-unexpected/46674361#46674361", "title": "declaring go function throws unexpected (", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nvar m map[rune]bool\n\nfunc do_comp(line string) {\n    for i, c := range line {\n        _, ex := m[c]\n        if ex == true {\n            fmt.Printf(\"not unique character line, %c at position %v already exists\\n\", c, i)\n        } else {\n            m[c] = true\n        }\n\n    }\n    return\n\n}\n\nfunc main() {\n    st := \"abracadabra\"\n    m = make(map[rune]bool)\n    do_comp(st)\n}\n</code></pre>\n\n<p>Some comments:</p>\n\n<ol>\n<li><p>If you want to use string with strictly single char you may use <code>rune</code> - it's a special type to keep exactly 1 symbol. Also go iterates strings by runes rather than strings of 1 char length, so using runes here is more convenient.</p></li>\n<li><p>If you have not found a symbol first time, you may set flag in map, that you have seed that symbol. This way you will be able to find a duplicate char.</p></li>\n<li><p>To make <code>m</code> accessible from all functions you may define at top level</p></li>\n<li><p>Golang requires you to use all defined variables. If you have a variable which do not want to use later, use a reserved name <code>_</code> for it.</p></li>\n</ol>\n\n<p>You may try it on <a href=\"https://play.golang.org/p/u9g6VxjCHH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/u9g6VxjCHH</a></p>\n"}], "owner": {"reputation": 101, "user_id": 3898856, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4ba41455a288f3a09a706c4797615b76?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/3898856/ani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "closed_date": 1507666192, "answer_count": 1, "score": -1, "last_activity_date": 1507663584, "creation_date": 1507661846, "question_id": 46674017, "link": "https://stackoverflow.com/questions/46674017/declaring-go-function-throws-unexpected", "closed_reason": "Not suitable for this site", "title": "declaring go function throws unexpected (", "body": "<p>I keep seeing build error above while running my Go code below. How can I fix this ?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc do_comp(var line string) {\n    for i, c := range line {\n        c, ex := m[i]\n            if ex == true {\n                fmt.Printf(\"not unique character line, %c exists\", c)\n            }\n\n    }\n    return\n\n}\n\nfunc main() {\n    st := \"abracadabra\"\n        m := make(map[string]bool)\n        do_comp(st)\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "append"], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 1474784, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/yM7k1.jpg?s=128&g=1", "display_name": "afrikaan", "link": "https://stackoverflow.com/users/1474784/afrikaan"}, "edited": false, "score": 0, "creation_date": 1507702640, "post_id": 46673897, "comment_id": 80309826, "body": "yes thats true but all of them are slices so as far as i know slices are references to an underlying array, but in this case they are not referencing why is that?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 415, "user_id": 1474784, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/yM7k1.jpg?s=128&g=1", "display_name": "afrikaan", "link": "https://stackoverflow.com/users/1474784/afrikaan"}, "edited": false, "score": 0, "creation_date": 1507726651, "post_id": 46673897, "comment_id": 80325122, "body": "@kyur: It doesn&#39;t have anything to do with the pointer in the slice itself, you were copying the <code>TestCaseItem</code> values, which means you weren&#39;t writing to the same slice values."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1507661420, "creation_date": 1507661420, "answer_id": 46673897, "question_id": 46673797, "link": "https://stackoverflow.com/questions/46673797/append-value-to-slice-of-a-slice/46673897#46673897", "title": "append value to slice of a slice", "body": "<p>You're appending the bool values to copies of your TestCaseItems.</p>\n\n<p>You either need to use a pointer to the items:</p>\n\n<pre><code>func func1() []*TestCaseItem {\n    var tc = make([]*TestCaseItem, 0)\n\n    var item = &amp;TestCaseItem{}\n    item.Actual = append(item.Actual, \"test1\")\n    item.Actual = append(item.Actual, \"test2\")\n\n    tc = append(tc, item)\n\n    return tc\n}\n</code></pre>\n\n<p>Or you need to append to the <code>Status</code> field of the <code>TestCaseItem</code> value that's in the slice. </p>\n\n<pre><code>for i := range items {\n    items[i].Status = append(items[i].Status, false)\n}\n</code></pre>\n"}], "owner": {"reputation": 415, "user_id": 1474784, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/yM7k1.jpg?s=128&g=1", "display_name": "afrikaan", "link": "https://stackoverflow.com/users/1474784/afrikaan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 46673897, "answer_count": 1, "score": 0, "last_activity_date": 1507661420, "creation_date": 1507661060, "question_id": 46673797, "link": "https://stackoverflow.com/questions/46673797/append-value-to-slice-of-a-slice", "title": "append value to slice of a slice", "body": "<p>consider this piece of code:</p>\n\n<pre><code>func main() {\n    items := func1()\n\n    for _, v := range items {\n        v.Status = append(v.Status, false)\n    }\n\n    fmt.Println(items)\n\n}\n\n//TestCaseItem represents the test case\ntype TestCaseItem struct {\n    Actual   []string\n    Expected []string\n    Status   []bool\n}\n\nfunc func1() []TestCaseItem {\n    var tc = make([]TestCaseItem, 0)\n\n    var item = &amp;TestCaseItem{}\n    item.Actual = append(item.Actual, \"test1\")\n    item.Actual = append(item.Actual, \"test2\")\n\n    tc = append(tc, *item)\n\n    return tc\n}\n</code></pre>\n\n<p>i have an slice of type <code>TestCaseItem</code> struct. In that struct i have slice of string and bool properties. first i call <code>func1</code> function to grab some data and then iterate over that slice and try to append more data insdide, but the output of this code is <code>[{[test1 test2] [] []}]</code> where are the booleans ? </p>\n\n<p>i feel like the  problem is  <code>[]TestCaseItem</code> cuz its a slice that holds values rather than pointers and maybe i'll miss sth. can anybody explain this? </p>\n"}, {"tags": ["go", "command-line-interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507661108, "post_id": 46673690, "comment_id": 80296041, "body": "The limits are all operating system dependent. You can pass args any other way you want, via files, serialized on stdin, environment variables, etc."}, {"owner": {"reputation": 117, "user_id": 4006407, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d3KDU.jpg?s=128&g=1", "display_name": "doykle", "link": "https://stackoverflow.com/users/4006407/doykle"}, "edited": false, "score": 0, "creation_date": 1507675486, "post_id": 46673690, "comment_id": 80302617, "body": "Have you considered using a package to help manage your command line arguments? A package like <a href=\"https://github.com/urfave/cli\" rel=\"nofollow noreferrer\">urfave/cli</a> might be useful."}, {"owner": {"reputation": 2040, "user_id": 1342137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e75e480f97bb17342ac38c1edda19805?s=128&d=identicon&r=PG", "display_name": "Ajay M", "link": "https://stackoverflow.com/users/1342137/ajay-m"}, "edited": false, "score": 0, "creation_date": 1507689968, "post_id": 46673690, "comment_id": 80306055, "body": "Regarding Item 3 in your question, another way to achieve this -- I would suggest using a configuration file (something simple as yaml) should do. This way, you just pass one command-line argument, path to the config file."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1507661510, "post_id": 46673855, "comment_id": 80296268, "body": "1 &amp; 2 aren&#39;t necessarily true - they&#39;re platform and shell dependent. The rest is spot-on though."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507661702, "post_id": 46673855, "comment_id": 80296377, "body": "There always has to be a limit to the size of the arguments. ARG_MAX defines it on POSIX systems, mine happens to be <code>262144</code> right now."}, {"owner": {"reputation": 449, "user_id": 1299930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67005382b9156d5db68cc3bc4d78ed4e?s=128&d=identicon&r=PG", "display_name": "theeddieh", "link": "https://stackoverflow.com/users/1299930/theeddieh"}, "edited": false, "score": 0, "creation_date": 1507679184, "post_id": 46673855, "comment_id": 80303556, "body": "Yes, thank you Adrian and JimB. I&#39;ve added your clarifications to my answer."}, {"owner": {"reputation": 3725, "user_id": 582665, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/f3449b02be5eb3699bce192b67de74f8?s=128&d=identicon&r=PG", "display_name": "mixkat", "link": "https://stackoverflow.com/users/582665/mixkat"}, "edited": false, "score": 0, "creation_date": 1507713164, "post_id": 46673855, "comment_id": 80316149, "body": "Thank you all! Config files are not an option as the passed in params are dynamic but seems like even the default values would accommodate my needs here. <a href=\"https://www.in-ulm.de/~mascheck/various/argmax/\" rel=\"nofollow noreferrer\">in-ulm.de/~mascheck/various/argmax</a> for future reference"}], "tags": [], "owner": {"reputation": 449, "user_id": 1299930, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67005382b9156d5db68cc3bc4d78ed4e?s=128&d=identicon&r=PG", "display_name": "theeddieh", "link": "https://stackoverflow.com/users/1299930/theeddieh"}, "is_accepted": true, "score": 3, "last_activity_date": 1507679103, "last_edit_date": 1507679103, "creation_date": 1507661257, "answer_id": 46673855, "question_id": 46673690, "link": "https://stackoverflow.com/questions/46673690/best-way-to-pass-long-arguments-in-a-golang-cli-program-and-its-limitations/46673855#46673855", "title": "Best way to pass long arguments in a GoLang CLI program and its limitations", "body": "<ol>\n<li>No, as far as go is concerned. Command line args are parsed into a <a href=\"https://github.com/golang/go/blob/master/src/os/proc.go#L15\" rel=\"nofollow noreferrer\"><code>[]string</code></a>, so at this level it's just a matter of how much memory is available. But, the comments below are correct. Your system will have its own lower limits that you'll hit first.</li>\n<li>Same as above. </li>\n<li>If you find yourself passing <em>tons</em> for args for every run:\n\n<ul>\n<li>if they don't change much, do they make sense as sane defaults for your flags?</li>\n<li>if they don't make sense as defaults, consider moving to reading them from a config file. CSV, YAML, whatever. </li>\n</ul></li>\n</ol>\n\n<p>Without knowing more, I'd recommend a the config file. They make it easy to track different configs/runs, easier to edit than a long list of cmd line args, and you can always write it so that args on the cmd line overwrite values in the config. </p>\n\n<p>Check out <a href=\"https://github.com/avelino/awesome-go\" rel=\"nofollow noreferrer\">awesome-go</a> for libraries that already do this, specifically under the <a href=\"https://github.com/avelino/awesome-go#command-line\" rel=\"nofollow noreferrer\">command-line</a> and <a href=\"https://github.com/avelino/awesome-go#configuration\" rel=\"nofollow noreferrer\">configuration</a> sections.</p>\n"}], "owner": {"reputation": 3725, "user_id": 582665, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/f3449b02be5eb3699bce192b67de74f8?s=128&d=identicon&r=PG", "display_name": "mixkat", "link": "https://stackoverflow.com/users/582665/mixkat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 751, "favorite_count": 0, "accepted_answer_id": 46673855, "answer_count": 1, "score": 1, "last_activity_date": 1507679103, "creation_date": 1507660646, "question_id": 46673690, "link": "https://stackoverflow.com/questions/46673690/best-way-to-pass-long-arguments-in-a-golang-cli-program-and-its-limitations", "title": "Best way to pass long arguments in a GoLang CLI program and its limitations", "body": "<p>I am writing a CLI program in GO and need to be able to pass a rather long list of arguments to the main function. At the moment I am using the standard way of passing arguments (space separated values) and then \nretrieve 'em using os.Args[index].</p>\n\n<p>So my questions are: </p>\n\n<ol>\n<li>Is there a limit to the number of arguments one can pass?</li>\n<li>Is there a limit to the length of a string argument? </li>\n<li>Is there any other way of achieving this and if so how?</li>\n</ol>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507660604, "post_id": 46673566, "comment_id": 80295793, "body": "The <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">Go language spec</a> is relatively simple. That&#39;s the best place to check for these things. Searching for <code>.(</code> finds the &quot;Type Assertion&quot; specification quickly."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1507660606, "post_id": 46673621, "comment_id": 80295796, "body": "As a side note, the Go spec is worth reading. Unlike most modern languages, it&#39;s short - really short. 1/5 the size of the C# spec, and 1/10 the size of the Java spec. Thanks to Go&#39;s simplicity, you can read the entire raw language spec in a couple hours and gain a lot from it."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1507660425, "creation_date": 1507660425, "answer_id": 46673621, "question_id": 46673566, "link": "https://stackoverflow.com/questions/46673566/golang-semantic-meaning-of-a-property-wrapped-in-parenthesis/46673621#46673621", "title": "GoLang: Semantic Meaning of a Property Wrapped in Parenthesis?", "body": "<p>It's a type assertion. The returned values are 1) the object, converted to the given type; and 2) a boolean indicating if the conversion was successful. <code>ThingClasser</code> is the type being converted to. Documentation can be found here: <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Type_assertions</a></p>\n"}], "owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "closed_date": 1507660470, "accepted_answer_id": 46673621, "answer_count": 1, "score": 2, "last_activity_date": 1507660490, "creation_date": 1507660246, "question_id": 46673566, "link": "https://stackoverflow.com/questions/46673566/golang-semantic-meaning-of-a-property-wrapped-in-parenthesis", "closed_reason": "Duplicate", "title": "GoLang: Semantic Meaning of a Property Wrapped in Parenthesis?", "body": "<p>Go Newb here -- I've encountered the following bit of Go code that I didn't write</p>\n\n<pre><code>if tc, ok := tng.(ThingClasser); ok {\n    //... do some stuff ...\n}\n</code></pre>\n\n<p>I won't understand the semantics of <code>tng.(ThingClasser)</code>.  </p>\n\n<p>In some ways this looks like a method call -- i.e. there are two variables (<code>ec</code>, <code>ok</code>) sitting there ready to accept multiple return values.  </p>\n\n<p>However, <code>tng.(ThingClasser)</code> itself looks like its a property access, not a method call.  </p>\n\n<p>However however, the parens around <code>ThingClasser</code> are a wrinkle I've never seen before.  Also, if it matters, the <code>ThingClasser</code> symbol is defined elsewhere in this project as an interface, so I think maybe this is some syntactic sugar around an <em>does this implement an interface</em> -- but then the two return values confused me. </p>\n\n<p>Googling hasn't turned up anything concrete, but this is one of those hard things to google for.</p>\n\n<p>Does anyone here know what this call/syntax is in GoLang, and possible point me at the relevant manual pages so I can RTFM?</p>\n"}, {"tags": ["ios", "swift", "post", "go", "multipartform-data"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507681267, "post_id": 46673389, "comment_id": 80304030, "body": "not sure why are you calling <code>r.ParseMultipartForm()</code> first. this may help you: <a href=\"https://github.com/yanpozka/go-httprouter-upfiles-token/blob/master/handlers.go#L49\" rel=\"nofollow noreferrer\">github.com/yanpozka/go-httprouter-upfiles-token/blob/master/&zwnj;&#8203;&hellip;</a>  + it&#39;s not a good idea read the whole file in memory"}], "owner": {"reputation": 23, "user_id": 7870122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9037119a25595ad45ec8d8ef9d027a?s=128&d=identicon&r=PG&f=1", "display_name": "matzewagner", "link": "https://stackoverflow.com/users/7870122/matzewagner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 249, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507659585, "creation_date": 1507659585, "question_id": 46673389, "link": "https://stackoverflow.com/questions/46673389/parsing-request-with-file-attachment-from-ios-in-golang", "title": "Parsing request with file attachment from iOS in Golang", "body": "<p>I'm building an iOS extension in Swift, and want to upload a file from a background uploadTask to a Go server.\nI have managed to do this successfully with a dataTask, following <a href=\"https://stackoverflow.com/a/26163136/7870122\">this example</a> . Due to memory restrictions, I need to use a uploadTask(with:fromFile:) from  . On the iOS side, I can see that the file is uploading, and I confirmed with fiddler that the POST request has the file data attached. However, when I now try and parse the request in Go via FormFile, I get the following error message:</p>\n\n<blockquote>\n<pre><code>\"multipart: NextPart: bufio: buffer full\"\n</code></pre>\n</blockquote>\n\n<p>I have tried different sizes as the argument for ParseMutlipartForm, and also taking it out, since Formfile should call ParseMultipartForm, if it needs to. None of this had any effect. The error persists for calls to FormFile, as well.</p>\n\n<p>Upload request from iOS:</p>\n\n<pre><code>let config = URLSessionConfiguration.background(withIdentifier: \"\\(fileUrl)\")\nconfig.sharedContainerIdentifier = SHARED_CONTAINER_IDENTIFIER\nlet urlString = CLIENTURL + \"/saveFile\"\nlet postURL = URL(string: urlString)\n\nvar request = URLRequest(url: postURL!)\nrequest.httpMethod = \"POST\"\nlet boundary = \"Boundary-\\(UUID().uuidString)\"\nrequest.setValue(\"multipart/form-data; boundary=\\(boundary)\", forHTTPHeaderField: \"Content-Type\")\nrequest.setValue(\"Keep-Alive\", forHTTPHeaderField: \"Connection\")\n\nlet task = session.uploadTask(with: request, fromFile: fileUrl)\nsession.getTasksWithCompletionHandler{\n  (dataTasks, uploadTasks, downloadTasks) -&gt; Void in\n}\ntask.resume()\n</code></pre>\n\n<p>Go server:</p>\n\n<pre><code>func handleSaveFile(w http.ResponseWriter, r *http.Request, p hr.Params) {\n    log := config.Log(`api:iosfp`)\n\n    const _24K = (1 &lt;&lt; 10) * 24\n    if err := r.ParseMultipartForm(_24K); nil != err {\n        log.WithError(err).Error(`Error at ParseMultipartForm`)\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    file, _, err := r.FormFile(\"file\")\n    if nil != err {\n        log.WithError(err).Error(`Error at FormFile`)\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    var buff bytes.Buffer\n    fSize, err := buff.ReadFrom(file)\n    if nil != err {\n        log.WithError(err).Error(`Error reading file`)\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    log.Info(`fileSize: `, fSize)\n ...\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507657491, "post_id": 46672787, "comment_id": 80294063, "body": "The server is closing your connection. Do you control the endpoint, and can you check the logs there? Is this really the complete code you&#39;re using, because <code>fmt.Println(resp.Body)</code> doesn&#39;t print anything useful."}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507657743, "post_id": 46672787, "comment_id": 80294202, "body": "I receive an error from resp, err := client.Do(req) so the body is nil"}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507657772, "post_id": 46672787, "comment_id": 80294228, "body": "With curl I can do the request, the problem is the Go code"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507657834, "post_id": 46672787, "comment_id": 80294260, "body": "can you do a ping to that server ?"}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "edited": false, "score": 0, "creation_date": 1507657972, "post_id": 46672787, "comment_id": 80294338, "body": "Yes I can. I receive the response from the server with curl"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507658084, "post_id": 46672787, "comment_id": 80294412, "body": "Again, the server is closing the connection on you for <i>some</i> reason. Try creating a request that looks exactly like a curl request, and see if it&#39;s filtering out unexpected clients."}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "edited": false, "score": 0, "creation_date": 1507658227, "post_id": 46672787, "comment_id": 80294478, "body": "But i&#39;m doing this. My request in go is similar to curl. I read that go works open streams. I don&#39;t know if it can be the problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507658696, "post_id": 46672787, "comment_id": 80294739, "body": "Not a similar request, <i>exactly</i> the same request. That is assuming it&#39;s getting through the handshake at all. This doesn&#39;t look like a handshake error, but maybe that&#39;s being reset before it even starts. Trace the connection on the wire, or add some debugging to the handshake code. Does the server share a ciphersuite with Go? What does it support for TLS?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507659941, "post_id": 46672787, "comment_id": 80295418, "body": "Something is amiss here for sure. &quot;read tcp 1.2.3.4:1234-&gt;5.6.7.8:5678&quot; looks like some dummy example data just based on the IPs and ports. example.com does not resolve to either of those IPs. The code also does not show what is being assigned to <code>url</code>, so this is not a <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507660090, "post_id": 46672787, "comment_id": 80295501, "body": "When I run <a href=\"https://play.golang.org/p/APxGjTJcd9\" rel=\"nofollow noreferrer\">this</a> locally (since you can&#39;t dial out from playground), it works - I get <code>200 OK</code>. There&#39;s something wrong outside of the code shown."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1507661172, "post_id": 46672787, "comment_id": 80296071, "body": "Can you connect to your host in your local network? Check logs on it. There could be different settings. For example <code>curl</code> can be condifured to use some proxy by default, and <code>go</code> not."}], "answers": [{"tags": [], "owner": {"reputation": 24853, "user_id": 446681, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cBjgR.jpg?s=128&g=1", "display_name": "Hector Correa", "link": "https://stackoverflow.com/users/446681/hector-correa"}, "is_accepted": true, "score": 1, "last_activity_date": 1507667667, "creation_date": 1507667667, "answer_id": 46675526, "question_id": 46672787, "link": "https://stackoverflow.com/questions/46672787/connection-reset-by-peer-go/46675526#46675526", "title": "Connection reset by peer GO", "body": "<p>Your code works if I use it against a URL like <code>https://example.com</code>. Are  you sure you are passing it the correct URL?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc main() {\n    url := \"https://example.com\"\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Println(\"OK\")\n    defer resp.Body.Close()\n\n    bytes, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    str := string(bytes[:])\n    fmt.Printf(\"%s\", str)\n}\n</code></pre>\n"}], "owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1869, "favorite_count": 0, "accepted_answer_id": 46675526, "answer_count": 1, "score": -4, "last_activity_date": 1507667667, "creation_date": 1507657300, "question_id": 46672787, "link": "https://stackoverflow.com/questions/46672787/connection-reset-by-peer-go", "title": "Connection reset by peer GO", "body": "<p>I'm trying to do a request in GO but I always receive \"Connection reset by peer\" error. The following code shows how I'm doing the request:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", url, nil)\nif err != nil {\n    return nil, err\n}\nclient := = &amp;http.Client{}\nresp, err := client.Do(req)\n\nif err != nil {\n    return nil, err\n}\n\ndefer resp.Body.Close()\nfmt.Println(resp.Body)\n</code></pre>\n\n<p>...and I receive: </p>\n\n<pre><code>Get https://example.com: read tcp 1.2.3.4:1234-&gt;5.6.7.8:5678: read: connection reset by peer\n</code></pre>\n\n<p>When I do curl <a href=\"https://example.com\" rel=\"nofollow noreferrer\">https://example.com</a> I receive response form the server.\nWhy can't I do the request in GO?</p>\n"}, {"tags": ["go", "serialization", "encode", "gob"], "answers": [{"tags": [], "owner": {"reputation": 1567, "user_id": 810706, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7e50c2321b7235c53a46fee37497a98f?s=128&d=identicon&r=PG", "display_name": "Tyson", "link": "https://stackoverflow.com/users/810706/tyson"}, "is_accepted": true, "score": 9, "last_activity_date": 1507654605, "creation_date": 1507654605, "answer_id": 46672058, "question_id": 46671636, "link": "https://stackoverflow.com/questions/46671636/gob-decode-giving-decodevalue-of-unassignable-value-error/46672058#46672058", "title": "Gob Decode Giving &quot;DecodeValue of unassignable value&quot; Error", "body": "<p>Had a friend take a look at this and he pointed out that gob doesn't let you assign to a nil pointer. From the gob package <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"noreferrer\">docs</a>: \"Nil pointers are not permitted, as they have no value.\" It looks like gob reflects on the fields of the struct that is passed in and attempts to assign values from the encoded stream. Changing this:</p>\n\n<pre><code>var t2 *tester\n</code></pre>\n\n<p>To this:</p>\n\n<pre><code>t2 := &amp;tester{}\n</code></pre>\n\n<p>Makes the test pass.</p>\n"}], "owner": {"reputation": 1567, "user_id": 810706, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7e50c2321b7235c53a46fee37497a98f?s=128&d=identicon&r=PG", "display_name": "Tyson", "link": "https://stackoverflow.com/users/810706/tyson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1435, "favorite_count": 0, "accepted_answer_id": 46672058, "answer_count": 1, "score": 3, "last_activity_date": 1507654605, "creation_date": 1507653136, "question_id": 46671636, "link": "https://stackoverflow.com/questions/46671636/gob-decode-giving-decodevalue-of-unassignable-value-error", "title": "Gob Decode Giving &quot;DecodeValue of unassignable value&quot; Error", "body": "<p>I'm new-ish to Go and I'm having some trouble putting a gob on the wire. I wrote a quick test that I thought would pass, but the decode call is returning a \"DecodeValue of unassignable value\" error. Here's the code:</p>\n\n<pre><code>type tester struct {\n    Payload string\n}\n\nfunc newTester(payload string) *tester {\n    return &amp;tester {\n        Payload: payload,\n    }\n}\n\nfunc TestEncodeDecodeMessage(t *testing.T) {\n    uri := \"localhost:9090\"\n    s := \"the lunatics are in my head\"\n    t1 := newTester(s)\n    go func(){\n        ln, err := net.Listen(\"tcp\", uri)\n        assert.NoError(t, err)\n        conn, err := ln.Accept()\n        assert.NoError(t, err)\n\n        var t2 *tester\n        decoder := gob.NewDecoder(conn)\n        err = decoder.Decode(t2)\n        assert.NoError(t, err)\n        conn.Close()\n        assert.NotNil(t, t2)\n    }()\n\n    time.Sleep(time.Millisecond * 100)\n    conn, err := net.Dial(\"tcp\", uri)\n    assert.NoError(t, err)\n\n    gob.Register(t1)\n    encoder := gob.NewEncoder(conn)\n    err = encoder.Encode(t1)\n    assert.NoError(t, err)\n    conn.Close()\n    time.Sleep(time.Millisecond * 100)\n}\n</code></pre>\n\n<p>I suspect I'm missing something stupid here and appreciate any help that you're able to offer.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1507651960, "post_id": 46671181, "comment_id": 80291060, "body": "From a quick examination, it does not appear that you can. <code>TrapListener</code> should have exposed a <code>Close()</code> or <code>Shutdown()</code> method that closed the underlying network listener."}, {"owner": {"reputation": 8409, "user_id": 427306, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4053545a82f2cfd37b36fc7adf6d066d?s=128&d=identicon&r=PG&f=1", "display_name": "snoofkin", "link": "https://stackoverflow.com/users/427306/snoofkin"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1507652115, "post_id": 46671181, "comment_id": 80291148, "body": "Exactly! I thought though, that there is some way to do that. thanks"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1507652224, "post_id": 46671181, "comment_id": 80291204, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28240133/cancel-a-blocking-operation-in-go/28240299#28240299\">cancel a blocking operation in Go</a>; and <a href=\"https://stackoverflow.com/questions/31116870/goroutine-execution-inside-an-http-handler/31116947#31116947\">Goroutine execution inside an http handler</a>."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507656533, "post_id": 46671181, "comment_id": 80293554, "body": "this may help: <a href=\"https://rakyll.org/leakingctx/\" rel=\"nofollow noreferrer\">rakyll.org/leakingctx</a> <a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">blog.golang.org/context</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8409, "user_id": 427306, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4053545a82f2cfd37b36fc7adf6d066d?s=128&d=identicon&r=PG&f=1", "display_name": "snoofkin", "link": "https://stackoverflow.com/users/427306/snoofkin"}, "edited": false, "score": 0, "creation_date": 1507652095, "post_id": 46671322, "comment_id": 80291136, "body": "think i will need to add that then. Thanks!"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1507652004, "creation_date": 1507652004, "answer_id": 46671322, "question_id": 46671181, "link": "https://stackoverflow.com/questions/46671181/break-out-of-3rd-party-goroutine-that-has-an-infinite-loop/46671322#46671322", "title": "Break out of 3rd party goroutine that has an infinite loop", "body": "<p>Short answer: You can't.  There's no way to kill a goroutine (short of killing the entire program) from outside the goroutine.</p>\n\n<p>Long answer: A goroutine can listen for some sort of \"terminate\" signal (via channels, signals, or any other mechanism).  But ultimately, the goroutine must terminate <em>from within</em>.</p>\n\n<p>Looking at the library in your example, it appears this functionality is not provided.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1507665739, "last_edit_date": 1507665739, "creation_date": 1507665228, "answer_id": 46674900, "question_id": 46671181, "link": "https://stackoverflow.com/questions/46671181/break-out-of-3rd-party-goroutine-that-has-an-infinite-loop/46674900#46674900", "title": "Break out of 3rd party goroutine that has an infinite loop", "body": "<p>Standard <a href=\"https://golang.org/pkg/net/#Conn\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/#Conn</a> interface provides special methods <code>SetDeadline</code> (together with <code>SetReadDeadline</code> and <code>SetWriteDeadline</code>) to set a hard connection break time for staled connections. As I see in the <a href=\"https://github.com/soniah/gosnmp/blob/master/gosnmp.go#L39\" rel=\"nofollow noreferrer\">source</a> code: </p>\n\n<pre><code>type GoSNMP struct {\n    // Conn is net connection to use, typically established using GoSNMP.Connect()\n    Conn net.Conn\n     ...\n\n    // Timeout is the timeout for the SNMP Query\n    Timeout time.Duration\n    ...\n</code></pre>\n\n<p><code>net.Conn</code> interface is exported - so you may try to get direct access to it to set up a deadline.</p>\n\n<pre><code>type TrapListener struct {\n    OnNewTrap func(s *SnmpPacket, u *net.UDPAddr)\n    Params    *GoSNMP\n    ...\n}\n</code></pre>\n\n<p>In its turn <code>TrapListener</code> exports <code>GoSNMP</code> struct so you may have access to it. Try this:</p>\n\n<pre><code>tl := TrapListener{...}\ntl.Params.Conn.SetDeadline(time.Now().Add(1*time.Second))\ntl.Listen(...)\n</code></pre>\n\n<p>However <a href=\"https://github.com/soniah/gosnmp/blob/master/trap.go#L113\" rel=\"nofollow noreferrer\">this line</a> disensures me - looks like it doesn't use stored connection and its options:</p>\n\n<pre><code>func (t *TrapListener) Listen(addr string) (err error) {\n    ...\n    conn, err := net.ListenUDP(\"udp\", udpAddr)\n    ....\n}\n</code></pre>\n\n<p>But you may try :)</p>\n"}], "owner": {"reputation": 8409, "user_id": 427306, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4053545a82f2cfd37b36fc7adf6d066d?s=128&d=identicon&r=PG&f=1", "display_name": "snoofkin", "link": "https://stackoverflow.com/users/427306/snoofkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 46671322, "answer_count": 2, "score": 0, "last_activity_date": 1507665739, "creation_date": 1507651558, "question_id": 46671181, "link": "https://stackoverflow.com/questions/46671181/break-out-of-3rd-party-goroutine-that-has-an-infinite-loop", "title": "Break out of 3rd party goroutine that has an infinite loop", "body": "<p>I'm using this to receive SNMP traps: <a href=\"https://github.com/soniah/gosnmp\" rel=\"nofollow noreferrer\">https://github.com/soniah/gosnmp</a>\nNow, lets say I want to programmatically break out of the (taken from <a href=\"https://github.com/soniah/gosnmp/blob/master/examples/trapserver.go\" rel=\"nofollow noreferrer\">here</a>):</p>\n\n<blockquote>\n  <p>err := tl.Listen(\"0.0.0.0:9162\")</p>\n</blockquote>\n\n<p>What are my best approaches to this?</p>\n\n<p>I'm somewhat new to Golang and didnt find a way to break out of a goroutine that I have no way of modifying (\"3rd party\").</p>\n\n<p>Thanks,</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507647525, "post_id": 46669897, "comment_id": 80288302, "body": "What is your input data structure? What have you tried? What problems do you have? Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8753164"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507647863, "post_id": 46669897, "comment_id": 80288567, "body": "I have to send this kind of data to external api."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507647899, "post_id": 46669897, "comment_id": 80288589, "body": "That doesn&#39;t answer my questions."}], "answers": [{"comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1507650866, "post_id": 46670089, "comment_id": 80290390, "body": "While your answer is correct, I believe OP was more interested in starting out with typed data (ie values that aren&#39;t <code>interface{}</code>, and how to marshal those. You&#39;re unmarshaling to empty interfaces and directly marshalling back, leaving out that all values can be cast to &#236;nterface{}`"}], "tags": [], "owner": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "is_accepted": false, "score": 0, "last_activity_date": 1507648431, "last_edit_date": 1507648431, "creation_date": 1507647994, "answer_id": 46670089, "question_id": 46669897, "link": "https://stackoverflow.com/questions/46669897/how-to-marshal-array-with-one-element-with-different-type-into-json-with-go/46670089#46670089", "title": "How to marshal array with one element with different type into JSON with Go?", "body": "<p>You ca use a slice of <code>interface{}</code>, for example <a href=\"https://play.golang.org/p/c8dPRPK6mr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/c8dPRPK6mr</a></p>\n"}, {"tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 2, "last_activity_date": 1507651000, "last_edit_date": 1507651000, "creation_date": 1507648134, "answer_id": 46670149, "question_id": 46669897, "link": "https://stackoverflow.com/questions/46669897/how-to-marshal-array-with-one-element-with-different-type-into-json-with-go/46670149#46670149", "title": "How to marshal array with one element with different type into JSON with Go?", "body": "<p>The trick to creating a slice/array of mixed types is to use the empty interface type that go offers</p>\n\n<pre><code>inner := []string{\"c\", \"d\"}\nall := []interface{}{\"a\", \"b\", inner, \"e\"}\n</code></pre>\n\n<p>And then just <code>json.Marshal</code> the interface slice. This works because any and all values implement at least an empty interface. You can use the most bloated object as though it doesn't have any methods/receiver functions to call. That's why people sometimes refer to go's <code>interface{}</code> type as being a <em>\"generic\"</em> type. A lot of abstract stuff that packages do use <code>interface{}</code> arguments, and then reflection to work out what was actually passed. Just look at the source of the encoding/json package and see how it unmarshals values...</p>\n\n<p><a href=\"https://play.golang.org/p/96VVo2F1m7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/96VVo2F1m7</a></p>\n\n<p>Unmarshalling would work in pretty much the same way: you can unmarshal JSON strings into <code>interface{}</code> variables. You may need to use type-assertions and/or reflection to be able to work with the data though. That's why it's probably best to create types...</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8753164"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 46670149, "answer_count": 2, "score": -4, "last_activity_date": 1507651000, "creation_date": 1507647435, "question_id": 46669897, "link": "https://stackoverflow.com/questions/46669897/how-to-marshal-array-with-one-element-with-different-type-into-json-with-go", "title": "How to marshal array with one element with different type into JSON with Go?", "body": "<p>I need this result of JSON marshal:</p>\n\n<pre><code>[\"a\", \"b\", [\"c\", \"d\"], \"e\"]\n</code></pre>\n\n<p>How correctly to do this in Go?</p>\n"}, {"tags": ["string", "go", "base64", "slice"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1507648187, "post_id": 46669782, "comment_id": 80288777, "body": "looks like that handy site has a golang demo <a href=\"https://www.base64decode.net/golang-decodestring\" rel=\"nofollow noreferrer\">base64decode.net/golang-decodestring</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1507647233, "creation_date": 1507647233, "answer_id": 46669831, "question_id": 46669782, "link": "https://stackoverflow.com/questions/46669782/golang-decode-base64-data-to-string/46669831#46669831", "title": "Golang decode base64 data to string", "body": "<p><code>StdEncoding.DecodeString(data)</code> (which is <a href=\"https://golang.org/pkg/encoding/base64/#Encoding.DecodeString\" rel=\"noreferrer\"><code>base64.Encoding.DecodeString()</code></a>) returns you the decoded data as byte slice (<code>[]byte</code>), and this is what you see printed: the decimal representation of the individal bytes.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">Convert</a> the byte slice to <code>string</code> if you want to see it as a <code>string</code> value:</p>\n\n<pre><code>fmt.Println(string(sDec))\n</code></pre>\n\n<p>Or use a format string where you specify you want to print is as a <code>string</code>:</p>\n\n<pre><code>fmt.Printf(\"%s\\n\", sDec)\n</code></pre>\n\n<p>Then the output will be (try it on the <a href=\"https://play.golang.org/p/ZfbBnUMi8y\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>base64 encoded string\n</code></pre>\n"}], "owner": {"reputation": 6750, "user_id": 2098614, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/cslmi.jpg?s=128&g=1", "display_name": "Ajey", "link": "https://stackoverflow.com/users/2098614/ajey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4838, "favorite_count": 0, "accepted_answer_id": 46669831, "answer_count": 1, "score": 3, "last_activity_date": 1529927073, "creation_date": 1507647086, "last_edit_date": 1529927073, "question_id": 46669782, "link": "https://stackoverflow.com/questions/46669782/golang-decode-base64-data-to-string", "title": "Golang decode base64 data to string", "body": "<p>I am trying to decode a simple base64 encoded string in golang.</p>\n\n<pre><code>package main\nimport b64 \"encoding/base64\"\nimport fmt\n\nfunc main() {\n    data := \"YmFzZTY0IGVuY29kZWQgc3RyaW5n\"\n    sDec, err1 := b64.StdEncoding.DecodeString(data)\n    fmt.Println(sDec)\n    fmt.Println(err1)\n}\n</code></pre>\n\n<p>And the output I get is </p>\n\n<pre><code>[98 97 115 101 54 52 32 101 110 99 111 100 101 100 32 115 116 114 105 110 103] // this is the decoded data.\n&lt;nil&gt;\n</code></pre>\n\n<p>Where as <a href=\"https://www.base64decode.net/\" rel=\"nofollow noreferrer\">https://www.base64decode.net/</a> decodes and outputs as</p>\n\n<pre><code>base64 encoded string\n</code></pre>\n\n<p>How do I get the same result in golang?</p>\n"}, {"tags": ["sockets", "go", "bluetooth"], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 6180650, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-07SzfcwedjY/AAAAAAAAAAI/AAAAAAAAAEw/3nKSE0jfU1Y/photo.jpg?sz=128", "display_name": "Daniyal Guliev", "link": "https://stackoverflow.com/users/6180650/daniyal-guliev"}, "is_accepted": false, "score": 3, "last_activity_date": 1592729031, "creation_date": 1592729031, "answer_id": 62496344, "question_id": 46668308, "link": "https://stackoverflow.com/questions/46668308/bluetooth-rfcomm-socket-with-golang/62496344#62496344", "title": "Bluetooth RFCOMM socket with Golang", "body": "<p>I think that topicstarter already doesn't need this answer, but I needed it yesterday )) Kinda found right answer, so let me share the code that worked in my case (it was a HC06 bluetooth module for Arduino). I assume that module already was bt discovered and paired (e.g by means of bluetoothctl).</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;strconv&quot;\n    &quot;strings&quot;\n    &quot;syscall&quot;\n\n    &quot;github.com/sirupsen/logrus&quot;\n    &quot;golang.org/x/sys/unix&quot;\n)\n\nfunc main() {\n    mac := str2ba(&quot;00:19:10:08:FE:08&quot;) // YOUR BLUETOOTH MAC ADDRESS HERE\n\n    fd, err := unix.Socket(syscall.AF_BLUETOOTH, syscall.SOCK_STREAM, unix.BTPROTO_RFCOMM)\n    check(err)\n    addr := &amp;unix.SockaddrRFCOMM{Addr: mac, Channel: 1}\n\n    var data = make([]byte, 50)\n    logrus.Print(&quot;connecting...&quot;)\n    err = unix.Connect(fd, addr)\n    check(err)\n    defer unix.Close(fd)\n    logrus.Println(&quot;done&quot;)\n\n    for {\n        n, err := unix.Read(fd, data)\n        check(err)\n        if n &gt; 0 {\n            logrus.Infof(&quot;Received: %v\\n&quot;, string(data[:n]))\n        }\n    }\n}\n\nfunc check(err error) {\n    if err != nil {\n        logrus.Fatal(err)\n    }\n}\n\n// str2ba converts MAC address string representation to little-endian byte array\nfunc str2ba(addr string) [6]byte {\n    a := strings.Split(addr, &quot;:&quot;)\n    var b [6]byte\n    for i, tmp := range a {\n        u, _ := strconv.ParseUint(tmp, 16, 8)\n        b[len(b)-1-i] = byte(u)\n    }\n    return b\n}\n\n\n</code></pre>\n"}], "owner": {"reputation": 1055, "user_id": 4205792, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0297dc684ce4aad71243b4e66d9e9f13?s=128&d=identicon&r=PG&f=1", "display_name": "dangeroushobo", "link": "https://stackoverflow.com/users/4205792/dangeroushobo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1016, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1592729031, "creation_date": 1507642882, "last_edit_date": 1507651625, "question_id": 46668308, "link": "https://stackoverflow.com/questions/46668308/bluetooth-rfcomm-socket-with-golang", "title": "Bluetooth RFCOMM socket with Golang", "body": "<p>I'm trying to open an RFCOMM socket from Go. I have a test setup where the client connects to an echo server. The part that I'm stuck on is setting up the Bluetooth address. In C you have str2ba, which converts the MAC string to a byte array of six elements. In Go it appears it expects the device to be a uint16. I'm not sure how this would work.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"syscall\"\n\n    \"golang.org/x/sys/unix\"\n)\n\n\nfunc main() {\n    fd, err := unix.Socket(syscall.AF_BLUETOOTH, syscall.SOCK_STREAM, unix.BTPROTO_RFCOMM)\n    if err != nil {\n        log.Fatalf(\"%v\\n\", err)\n    }\n    addr := unix.SockaddrHCI{Dev: 1, Channel: 1}\n    unix.Connect(fd, addr)\n    unix.Write(fd, []byte(\"Hello\"))\n    var data []byte\n    unix.Read(fd, data)\n    fmt.Printf(\"Received: %v\\n\", string(data))\n}\n</code></pre>\n\n<p>The <code>Dev</code> member in <code>unix.SockaddrHCI</code> is a uint16 and I think this is to represent the Bluetooth MAC. Is this correct?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1507637833, "post_id": 46666455, "comment_id": 80281310, "body": "In short, if <code>Add()</code> may modify the receiver, the receiver must be a pointer: <code>func (ss *Strings) Add(s string) { *ss = append(*ss, s) }</code>. Try it on the <a href=\"https://play.golang.org/p/JZSewRx9al\" rel=\"nofollow noreferrer\">Go Playground</a>."}, {"owner": {"reputation": 71, "user_id": 4401473, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-m9NOHhWc2Og/AAAAAAAAAAI/AAAAAAAAAY0/VkBRepF4xNI/photo.jpg?sz=128", "display_name": "Bill Xiong", "link": "https://stackoverflow.com/users/4401473/bill-xiong"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507638054, "post_id": 46666455, "comment_id": 80281462, "body": "Thanks @icza , it works now."}], "owner": {"reputation": 71, "user_id": 4401473, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-m9NOHhWc2Og/AAAAAAAAAAI/AAAAAAAAAY0/VkBRepF4xNI/photo.jpg?sz=128", "display_name": "Bill Xiong", "link": "https://stackoverflow.com/users/4401473/bill-xiong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "closed_date": 1507637536, "answer_count": 0, "score": 0, "last_activity_date": 1507642773, "creation_date": 1507637460, "last_edit_date": 1507642773, "question_id": 46666455, "link": "https://stackoverflow.com/questions/46666455/how-can-i-insert-a-new-element-to-slice-when-the-method-is-self-defined", "closed_reason": "Duplicate", "title": "How can I insert a new element to slice when the method is self defined?", "body": "<p>When I tried to add a new method to an aliased type, <code>append</code> method not works.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n)\n    type Strings []string\n\nfunc (ss Strings) Add(s string) {\n    ss = append(ss, s)\n}\n\nfunc main() {\n    ss := make(Strings, 0)\n\n    ss = append(ss, \"haha\", \"h3h3\")\n    fmt.Println(ss) // got [haha h3h3]\n\n\n    ss.Add(\"lala\")\n    fmt.Println(ss) // also got [haha h3h3], and why ?\n}\n</code></pre>\n\n<p>Why doesn't \"lala\" get appended to <code>ss</code>?</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1580126358, "last_edit_date": 1580126358, "creation_date": 1507632779, "answer_id": 46664920, "question_id": 46664742, "link": "https://stackoverflow.com/questions/46664742/go-routine-not-collecting-all-objects-from-channel/46664920#46664920", "title": "go routine not collecting all objects from channel", "body": "<p>The problem is that the <code>updateWorker</code> goroutines all collect results from the <code>hits</code> channel (so far so good), and they all store the result into the <code>temp</code> local variable <strong>unsynchronized</strong>. This is not OK.</p>\n\n<p>Access to all variables from multiple goroutines (where at least one of them is a write) must be synchronized.</p>\n\n<p>If you run it with the race detector enabled, it screams about data races (<code>go run -race app.go</code>).</p>\n\n<p>It immediately yields valid results if you decrease the number of <code>updateWorker</code> goroutines to 1, because then we eliminate the single data race source of your app:</p>\n\n<pre><code>for updateWorker := 1; updateWorker &lt;= 1; updateWorker++ {\n    // ...\n}\n</code></pre>\n\n<p>If you want to keep multiple <code>updateWorker</code> goroutines, their access to the shared <code>temp</code> variable must be synchronized.</p>\n\n<p>With a <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\"><code>sync.Mutex</code></a>:</p>\n\n<pre><code>var (\n    mu   sync.Mutex\n    temp []string\n)\nfor updateWorker := 1; updateWorker &lt;= 4; updateWorker++ {\n    wg.Add(1)\n    go func() {\n        for hit := range hits {\n            mu.Lock()\n            temp = append(temp, hit)\n            mu.Unlock()\n        }\n        wg.Done()\n        return\n    }()\n}\n</code></pre>\n\n<p>Also note that in this simple example you gain nothing by using multiple <code>updateWorker</code> goroutines, adding the above synchronization (locking) even makes it less performant compared to having only one of them.</p>\n\n<p>For properly distributing work and collecting results, check out this answer: <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a></p>\n"}], "owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 46664920, "answer_count": 1, "score": 2, "last_activity_date": 1580126358, "creation_date": 1507632223, "last_edit_date": 1507647760, "question_id": 46664742, "link": "https://stackoverflow.com/questions/46664742/go-routine-not-collecting-all-objects-from-channel", "title": "go routine not collecting all objects from channel", "body": "<p>I have one <code>go-routine</code> to add the objects into channel and then I have 4 <code>go-routines</code> to process objects of channel. The processing is nothing but adding objects to an array. But at few times, the objects are missing from final array. So I am assuming that at some point channel stops to collect objects. I have following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"sync\"\n)\n\nfunc main() {\n    j := 0\n    for {\n        if j == 10 {\n            break\n        }\n        wg := sync.WaitGroup{}\n        months := []string{\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\"}\n        hits := make(chan string)\n        i := 0\n        wg.Add(1)\n        go func() {\n            defer close(hits)\n            for {\n                if i == 25 {\n                    wg.Done()\n                    return\n                }\n                for _, month := range months {\n                    hits &lt;- month\n                }\n                i++\n            }\n        }()\n\n        temp := []string{}\n        for updateWorker := 1; updateWorker &lt;= 4; updateWorker++ {\n            wg.Add(1)\n            go func() {\n                for hit := range hits {\n                    temp = append(temp, hit)\n                }\n                wg.Done()\n                return\n            }()\n        }\n\n        wg.Wait()\n\n        log.Printf(\"length of temp %+v\\n\", len(temp))\n        j++\n    }\n}\n</code></pre>\n\n<p>I am using <code>sync</code> library to synchronise routines. I am looping same process 10 times to test if output is consistent. I am expecting output like this:</p>\n\n<pre><code>length of temp 175\n</code></pre>\n\n<p>It is 175 because I am sending 7 month strings 25 times.\nBut sometimes the output is less than 175, I don't know why. I am bit beginner about go routines. So could anybody please help me here finding the reason? Thanks.</p>\n"}, {"tags": ["c", "go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "edited": false, "score": 0, "creation_date": 1507632232, "post_id": 46664505, "comment_id": 80277580, "body": "so what about this pure c question?<a href=\"https://stackoverflow.com/questions/46664685/how-to-dynamic-malloc-memory-in-function-in-c\" title=\"how to dynamic malloc memory in function in c\">stackoverflow.com/questions/46664685/&hellip;</a>"}, {"owner": {"reputation": 126, "user_id": 7519491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3af280e5dd08982a857f27915c08882?s=128&d=identicon&r=PG", "display_name": "Artur Augustyniak", "link": "https://stackoverflow.com/users/7519491/artur-augustyniak"}, "reply_to_user": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "edited": false, "score": 0, "creation_date": 1507632952, "post_id": 46664505, "comment_id": 80278089, "body": "Well, if I understood question well, most basic way. First you must malloc memory for array of N char  pointers: <code>char **str_arr = malloc(N * sizeof(char *));</code> then alloc for each string (at size M max +1 for null terminator):     <code>int i;     for (i = 0; i &lt; N; ++i) {         str_arr[i] = (char *)malloc(M+1);     }</code> I would do this outside my function that operates on allocated memory chunk and pass initialized pointer to this function (it looks clearer in terms of who is responsible for freeing this memory - in this case caller)."}], "tags": [], "owner": {"reputation": 126, "user_id": 7519491, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3af280e5dd08982a857f27915c08882?s=128&d=identicon&r=PG", "display_name": "Artur Augustyniak", "link": "https://stackoverflow.com/users/7519491/artur-augustyniak"}, "is_accepted": false, "score": 0, "last_activity_date": 1507631453, "creation_date": 1507631453, "answer_id": 46664505, "question_id": 46663024, "link": "https://stackoverflow.com/questions/46663024/how-to-make-cgo-return-array-to-c/46664505#46664505", "title": "How to make cgo return array to c?", "body": "<p>I think it's because you are responsible for memory management for all C-side data. \nIn C <code>GoSlice</code> is just <code>typedef struct { void *data; GoInt len; GoInt cap; } GoSlice;</code> and in your example you pass just uninitialized pointer to GoSlice:</p>\n\n<pre><code> GoSlice *segs, *tags; //here\n char* err;\n err = Seg(\"hahahhaha\", segs, tags);\n</code></pre>\n\n<p>So it's just pure luck that you can r/w at this memory location.\nWhile Go will not manage your memory chunks from c code it will also not set len field. While all above are just assumptions (i do not know a lot about Go) Some evidence supporting my hypothesis will be this modification:</p>\n\n<pre><code>int main(int argc, char *argv[])\n{\n\nGoInt data[10] = {77, 12, 5, 99, 28, 23, 33,33,33,33};\nGoSlice segs_d = {data, 10, 10};\nGoInt data2[10] = {77, 12, 5, 99, 28, 23, 33,33,33,33};\nGoSlice tags_d = {data2, 10, 10};\n\nGoSlice *segs, *tags;\n\nsegs= &amp;segs_d;\ntags= &amp;tags_d;\n\nchar* err;\nerr = Seg(\"hahahhaha\", segs, tags);\nif (err != NULL) {\n    fprintf(stderr, \"error: %s\\n\", err);\n    free(err);\n    return 1;\n}\nprintf(\"%llu\\n\", (*tags).len); // it should be 10, but it is not right now\n\nreturn 0;\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1507638436, "creation_date": 1507638436, "answer_id": 46666786, "question_id": 46663024, "link": "https://stackoverflow.com/questions/46663024/how-to-make-cgo-return-array-to-c/46666786#46666786", "title": "How to make cgo return array to c?", "body": "<p>This doesn't have anything to do with C, you're overwriting copies of the <code>tags</code> and <code>segs</code> pointer values, rather than assigning the new slice values; . Make an example in Go first so see exactly what you're doing. <a href=\"https://play.golang.org/p/EQWRiqVwqm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/EQWRiqVwqm</a></p>\n\n<p>In order to assign the <code>_tags</code> value to the pointer, the syntax should be</p>\n\n<pre><code>*tags = _tags\n</code></pre>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1192, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1507638436, "creation_date": 1507627148, "last_edit_date": 1507628237, "question_id": 46663024, "link": "https://stackoverflow.com/questions/46663024/how-to-make-cgo-return-array-to-c", "title": "How to make cgo return array to c?", "body": "<p>I am calling <code>golang</code> with <code>c</code>, I want to return a <code>string array</code> and a <code>int array</code>, I do it like this:</p>\n\n<pre><code>package main\n\nimport \"C\"\n//export Seg\nfunc Seg(input *C.char, segs *[]*C.char, tags *[]int) (errChars *C.char) {\n  count := 10\n  segs_ := make([]*C.char, 10, 10)\n  for i:=0; i&lt;count; i++ {\n    segs_[i] = C.CString(\"aaaaaa\")\n  }\n  segs = &amp;segs_\n  tags_ := make([]int, count)\n  for i:=0; i&lt;count; i++ {\n    tags_[i] = i\n  }\n  tags = &amp;tags_\n  return\n}\nfunc main() {}\n</code></pre>\n\n<p>Build with </p>\n\n<pre><code>go build -o libacrf.so -buildmode=c-shared clib.go\n</code></pre>\n\n<p>call it like this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#include \"libacrf.h\"\n\nint main(int argc, char *argv[])\n{\n    GoSlice *segs, *tags;\n    char* err;\n    err = Seg(\"hahahhaha\", segs, tags);\n    if (err != NULL) {\n        fprintf(stderr, \"error: %s\\n\", err);\n        free(err);\n        return 1;\n    }\n    printf(\"%llu\\n\", (*tags).len); // it should be 10, but it is not right now\n\n    return 0;\n}\n</code></pre>\n\n<p>But the problem is that I can not get the real result from golang.</p>\n"}, {"tags": ["go", "aerospike"], "answers": [{"comments": [{"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "edited": false, "score": 0, "creation_date": 1507634096, "post_id": 46665165, "comment_id": 80278828, "body": "Have u tried this ? I remember trying this and getting only one array entry in the list instead of 3 string entries. Btw, I tried the same with ListInsertOp (because I&#39;m trying to prepend values to list instead of append)"}, {"owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "edited": false, "score": 0, "creation_date": 1507635195, "post_id": 46665165, "comment_id": 80279488, "body": "Maybe the way I am confirming the same is wrong. Is there some aql query to get the number of values in the list ?"}], "tags": [], "owner": {"reputation": 1520, "user_id": 4267030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BOrG6b-sscc/AAAAAAAAAAI/AAAAAAAAAWA/D2MY5eo53kU/photo.jpg?sz=128", "display_name": "Amir Rahimi Farahani", "link": "https://stackoverflow.com/users/4267030/amir-rahimi-farahani"}, "is_accepted": true, "score": 3, "last_activity_date": 1507633470, "last_edit_date": 1592644375, "creation_date": 1507633470, "answer_id": 46665165, "question_id": 46662690, "link": "https://stackoverflow.com/questions/46662690/aerospike-golang-listinsertop-multiple-values/46665165#46665165", "title": "Aerospike golang ListInsertOp multiple values", "body": "<p><code>ListAppendOp</code> is a variadic function accepting arbitrary number of arguments of type <code>interface{}</code>. If you call it passing your array, it will receive a slice of <code>interface{}</code> (<code>[]interface{}</code>) with a single element which is your array.</p>\n<p>You need to convert your array to a slice of <code>interface{}</code> and expand it using <code>...</code> when passing it to the function:</p>\n<pre><code>a := []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}\n\ns := make([]interface{}, len(a))\nfor i, v := range a {\n  s[i] = v\n}\n\nListAppendOp(&quot;bin1&quot;, s...)\n</code></pre>\n<p>Example of passing an array to a variadic function:\n<a href=\"https://play.golang.org/p/541aJ6dY6D\" rel=\"nofollow noreferrer\">https://play.golang.org/p/541aJ6dY6D</a></p>\n<p>From the specs:\n<a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">Passing arguments to ... parameters</a></p>\n"}], "owner": {"reputation": 1705, "user_id": 2754724, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/0db5a1fac483a5c97d7084b35483c8b7?s=128&d=identicon&r=PG&f=1", "display_name": "Crusaderpyro", "link": "https://stackoverflow.com/users/2754724/crusaderpyro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 46665165, "answer_count": 1, "score": 2, "last_activity_date": 1507633470, "creation_date": 1507626259, "question_id": 46662690, "link": "https://stackoverflow.com/questions/46662690/aerospike-golang-listinsertop-multiple-values", "title": "Aerospike golang ListInsertOp multiple values", "body": "<p>Does the ListInsertOp in golang aerospike client support inserting an array of elements ?</p>\n\n<p>If I use <a href=\"https://godoc.org/github.com/aerospike/aerospike-client-go#ListAppendOp\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/aerospike/aerospike-client-go#ListAppendOp</a>, and pass an array ([]string), it just appends the whole array as one value in the list. Am I using it wrong or is there another way to do the same?</p>\n"}, {"tags": ["google-app-engine", "go", "datastore"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 1, "creation_date": 1507637324, "post_id": 46662579, "comment_id": 80280967, "body": "Do you want to get back the whole entity or specific  properties ?"}, {"owner": {"reputation": 646, "user_id": 1835337, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/1fbdc5186f28d5ad225812065c20723c?s=128&d=identicon&r=PG", "display_name": "user1835337", "link": "https://stackoverflow.com/users/1835337/user1835337"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1507649032, "post_id": 46662579, "comment_id": 80289293, "body": "The whole entity"}], "owner": {"reputation": 646, "user_id": 1835337, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/1fbdc5186f28d5ad225812065c20723c?s=128&d=identicon&r=PG", "display_name": "user1835337", "link": "https://stackoverflow.com/users/1835337/user1835337"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1507680835, "creation_date": 1507625925, "last_edit_date": 1507626940, "question_id": 46662579, "link": "https://stackoverflow.com/questions/46662579/how-to-query-from-datastore-if-the-value-is-in-the-array-struct-in-go", "title": "How to query from datastore if the value is in the array struct in go", "body": "<p>I have two structs</p>\n\n<pre><code>type Parent struct {\n    Text string\n    Childs []ChildValue\n}\n\ntype ChildValue struct {\n    Name  string\n    Value int32  `json:\"value\" datastore:\"value\" validate:\"required,min=1,max=5\"`\n}\n</code></pre>\n\n<p>The value in childValue can be from 1 to 5. \nI want to be able to filter if value in array is more than 2</p>\n\n<p><code>query = query.Filter(\"childs.value =&gt;\", \"2\")</code></p>\n\n<p>It there a simple way to do that?</p>\n"}, {"tags": ["oracle", "go", "oracle-call-interface", "oci8"], "comments": [{"owner": {"reputation": 25668, "user_id": 997660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Scxjl.png?s=128&g=1", "display_name": "Nick Krasnov", "link": "https://stackoverflow.com/users/997660/nick-krasnov"}, "edited": false, "score": 2, "creation_date": 1507621890, "post_id": 46661211, "comment_id": 80271057, "body": "<code>Here when i give db username...</code> where? Where is your code that fails and the error?"}, {"owner": {"reputation": 183, "user_id": 4903596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-l1la9rNAGIU/AAAAAAAAAAI/AAAAAAAAACk/m-VUMTDlbu0/photo.jpg?sz=128", "display_name": "vijay", "link": "https://stackoverflow.com/users/4903596/vijay"}, "reply_to_user": {"reputation": 25668, "user_id": 997660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Scxjl.png?s=128&g=1", "display_name": "Nick Krasnov", "link": "https://stackoverflow.com/users/997660/nick-krasnov"}, "edited": false, "score": 0, "creation_date": 1507623469, "post_id": 46661211, "comment_id": 80272046, "body": "@NicholasKrasnov i have updated my question with both code and output"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1507624365, "post_id": 46661211, "comment_id": 80272566, "body": "Are you sure that connection string is correct? <code>user&#47;pass@&#47;&#47;127.0.0.1</code> seems odd to me."}, {"owner": {"reputation": 183, "user_id": 4903596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-l1la9rNAGIU/AAAAAAAAAAI/AAAAAAAAACk/m-VUMTDlbu0/photo.jpg?sz=128", "display_name": "vijay", "link": "https://stackoverflow.com/users/4903596/vijay"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507624611, "post_id": 46661211, "comment_id": 80272708, "body": "@Peter yes user/pass@//127.0.01:1521/TEST_DATA it works for my local database...and when i try the same with remote database it fails and output i  have mentioned above"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1507624716, "post_id": 46661211, "comment_id": 80272760, "body": "Then you won&#39;t find much help here, I&#39;m afraid. Network timeouts can have many reasons, most of which don&#39;t have anything to do with your code. Start by verifying IP addresses and firewall configurations."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1507625756, "post_id": 46661211, "comment_id": 80273375, "body": "I&#39;m agree with @Peter, according to <a href=\"https://godoc.org/github.com/mattn/go-oci8#ParseDSN\" rel=\"nofollow noreferrer\">the doc</a>, the dsn should be in the form of <code>user:password@host:port&#47;sid?param1=value1&amp;param2=value2 </code>. Try this format."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1507648862, "post_id": 46661211, "comment_id": 80289194, "body": "JDBC is for Java (that&#39;s what the &quot;J&quot; stands for). Most Go DB drivers either directly implement database connectivity, or wrap a native DB driver library using cgo."}, {"owner": {"reputation": 183, "user_id": 4903596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-l1la9rNAGIU/AAAAAAAAAAI/AAAAAAAAACk/m-VUMTDlbu0/photo.jpg?sz=128", "display_name": "vijay", "link": "https://stackoverflow.com/users/4903596/vijay"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507707418, "post_id": 46661211, "comment_id": 80312524, "body": "@Peter it works fine for sid like xe but if sid is xe.DATA then it fails to connect"}, {"owner": {"reputation": 183, "user_id": 4903596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-l1la9rNAGIU/AAAAAAAAAAI/AAAAAAAAACk/m-VUMTDlbu0/photo.jpg?sz=128", "display_name": "vijay", "link": "https://stackoverflow.com/users/4903596/vijay"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507707452, "post_id": 46661211, "comment_id": 80312542, "body": "@Adrian thanks for the information"}], "answers": [{"comments": [{"owner": {"reputation": 183, "user_id": 4903596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-l1la9rNAGIU/AAAAAAAAAAI/AAAAAAAAACk/m-VUMTDlbu0/photo.jpg?sz=128", "display_name": "vijay", "link": "https://stackoverflow.com/users/4903596/vijay"}, "edited": false, "score": 0, "creation_date": 1507625942, "post_id": 46662366, "comment_id": 80273486, "body": "do i need to set NLS_LANG is this compulsory"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 183, "user_id": 4903596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-l1la9rNAGIU/AAAAAAAAAAI/AAAAAAAAACk/m-VUMTDlbu0/photo.jpg?sz=128", "display_name": "vijay", "link": "https://stackoverflow.com/users/4903596/vijay"}, "edited": false, "score": 0, "creation_date": 1507626264, "post_id": 46662366, "comment_id": 80273702, "body": "Best advice: first get it to work, then try without. My friend writing that package is an oracle specialist, I am more the go programmer. So I can not really answer that, sorry."}, {"owner": {"reputation": 183, "user_id": 4903596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-l1la9rNAGIU/AAAAAAAAAAI/AAAAAAAAACk/m-VUMTDlbu0/photo.jpg?sz=128", "display_name": "vijay", "link": "https://stackoverflow.com/users/4903596/vijay"}, "edited": false, "score": 0, "creation_date": 1507707610, "post_id": 46662366, "comment_id": 80312610, "body": "it works fine for sid like xe but if sid is xe.DATA then it fails to connect"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 1, "last_activity_date": 1507625322, "creation_date": 1507625322, "answer_id": 46662366, "question_id": 46661211, "link": "https://stackoverflow.com/questions/46661211/golang-uses-jdbc-or-odbc-or-what-connection-type/46662366#46662366", "title": "Golang uses JDBC or ODBC or what connection type", "body": "<p>I cannot tell you exactly why your code ist not working, but I can provide you with some sample code I am involved in in an advisory capacity:</p>\n\n<p><a href=\"https://github.com/odbaeu/oracledb_metricbeat/blob/master/oracledb.go\" rel=\"nofollow noreferrer\">https://github.com/odbaeu/oracledb_metricbeat/blob/master/oracledb.go</a></p>\n\n<p>Here the code fragment creating a new connection:</p>\n\n<pre><code>// NewDB returns a new oracle database handle. The dsn value (data source name)\n// must be valid, otherwise an error will be returned.\n//\n//   DSN Format: username/password@host:port/service_name\nfunc NewDB(ociURL string) (*sql.DB, error) {\n    // NLS_LANG is set to American format. At least NLS_NUMERIC_CHARACTERS has to be \".,\".\n    os.Setenv(\"NLS_LANG\", \"AMERICAN_AMERICA.AL32UTF8\")\n    os.Setenv(\"NLS_DATE_FORMAT\", \"YYYY-MM-DD\\\"T\\\"HH24:MI:SS\")\n\n    // Open DB connection\n    oConn, err := sql.Open(\"oci8\", ociURL)\n    if err != nil {\n        return oConn, errors.Wrap(err, \"sql open failed\")\n    }\n\n    return oConn, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 183, "user_id": 4903596, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-l1la9rNAGIU/AAAAAAAAAAI/AAAAAAAAACk/m-VUMTDlbu0/photo.jpg?sz=128", "display_name": "vijay", "link": "https://stackoverflow.com/users/4903596/vijay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3403, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507716387, "creation_date": 1507621475, "last_edit_date": 1507716387, "question_id": 46661211, "link": "https://stackoverflow.com/questions/46661211/golang-uses-jdbc-or-odbc-or-what-connection-type", "title": "Golang uses JDBC or ODBC or what connection type", "body": "<p>go version go1.8.1 windows/amd64 and I am importing</p>\n\n<pre><code>\"github.com/mattn/go-oci8\" \n\"database/sql\" \n</code></pre>\n\n<p>For connecting to my oracle database. Here when I give db username, password, port and table name in connection string </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func openAndConnectToDb(sbconfig ConnectorConfig) *sql.DB {\n    logger := sbgoclient.Log\n    logger.Println(\"Open the database\")\n    //  oraprop := LoadConfig(\"oraproperties.yml\")\n    fmt.Println(\"Load config complete\")\n    orrrr := sbconfig.DB_Username + \"/\" + sbconfig.DB_Password + \"@\" + \"//\" + sbconfig.DB_Ip + \":\" + sbconfig.DB_Port + \"/\" + sbconfig.DB_Schema\n    fmt.Println(\"orrr formed: \", orrrr)\n    db, err := sql.Open(sbconfig.DbType, orrrr)\n    if err != nil {\n        logger.Println(\"database connection failed...\")\n        logger.Fatal(err)\n    }\n\n    //Use a backoff/retry strategy - we can start this client before\n    //the database is started, and see it eventually connect and process\n    //queries\n    var dbError error\n    maxAttempts := 20\n    for attempts := 1; attempts &lt;= maxAttempts; attempts++ {\n        logger.Println(\"pinging database...\")\n        dbError = db.Ping()\n        if dbError == nil {\n            logger.Println(\"database ping successfull........\")\n            fmt.Println(\"database ping successfull........\")\n            break\n        }\n        logger.Println(\"Ping failed: \", dbError, \"retry in \", attempts, \" seconds.\")\n        time.Sleep(time.Duration(attempts) * time.Second)\n    }\n    if dbError != nil {\n        logger.Fatal(dbError)\n    }\n\n    return db\n}\n</code></pre>\n\n<p>It fails to connect, whereas in java if I specify username, password, port, servicename and tablename in JDBC connection string it connects successfully.</p>\n\n<p>The output is</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>time=\"2017-10-10T13:43:02+05:30\" level=info msg=\"Open the database\" \ntime=\"2017-10-10T13:43:02+05:30\" level=info msg=\"pinging database...\" \ntime=\"2017-10-10T13:43:24+05:30\" level=info msg=\"Ping failed:  ORA-12170: TNS:Connect timeout occurred\nretry in  1  seconds.\" \ntime=\"2017-10-10T13:43:25+05:30\" level=info msg=\"pinging database...\" \ntime=\"2017-10-10T13:43:46+05:30\" level=info msg=\"Ping failed:  ORA-12170: TNS:Connect timeout occurred \nretry in  2  seconds.\" \n</code></pre>\n"}, {"tags": ["http", "curl", "go"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507617800, "post_id": 46660105, "comment_id": 80268773, "body": "Show what have you tried so far."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1507618492, "post_id": 46660105, "comment_id": 80269137, "body": "This might be of use: <a href=\"https://mholt.github.io/curl-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/curl-to-go</a>"}, {"owner": {"reputation": 2119, "user_id": 4624236, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-YcZ9puA0zLE/AAAAAAAAAAI/AAAAAAAAAGU/5JSTNxNO9-A/photo.jpg?sz=128", "display_name": "Rutger Huijsmans", "link": "https://stackoverflow.com/users/4624236/rutger-huijsmans"}, "edited": false, "score": 0, "creation_date": 1507620610, "post_id": 46660105, "comment_id": 80270295, "body": "Thanks I&#39;ve added more code and tried that link but still haven&#39;t figured it out yet"}], "answers": [{"comments": [{"owner": {"reputation": 2119, "user_id": 4624236, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-YcZ9puA0zLE/AAAAAAAAAAI/AAAAAAAAAGU/5JSTNxNO9-A/photo.jpg?sz=128", "display_name": "Rutger Huijsmans", "link": "https://stackoverflow.com/users/4624236/rutger-huijsmans"}, "edited": false, "score": 0, "creation_date": 1507622524, "post_id": 46661483, "comment_id": 80271434, "body": "My CURL command however is a GET command. It works with the JSON body and returns me the expected result. I&#39;m 100% sure the vendor&#39;s documentation states a GET with the stated body."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2119, "user_id": 4624236, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-YcZ9puA0zLE/AAAAAAAAAAI/AAAAAAAAAGU/5JSTNxNO9-A/photo.jpg?sz=128", "display_name": "Rutger Huijsmans", "link": "https://stackoverflow.com/users/4624236/rutger-huijsmans"}, "edited": false, "score": 0, "creation_date": 1507623689, "post_id": 46661483, "comment_id": 80272178, "body": "@RutgerHuijsmans Added test to show differences. Beside some insignificant differences they are identical."}, {"owner": {"reputation": 2119, "user_id": 4624236, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-YcZ9puA0zLE/AAAAAAAAAAI/AAAAAAAAAGU/5JSTNxNO9-A/photo.jpg?sz=128", "display_name": "Rutger Huijsmans", "link": "https://stackoverflow.com/users/4624236/rutger-huijsmans"}, "edited": false, "score": 0, "creation_date": 1507624416, "post_id": 46661483, "comment_id": 80272591, "body": "Thanks icza! Makes complete sense now."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1507623744, "last_edit_date": 1507623744, "creation_date": 1507622399, "answer_id": 46661483, "question_id": 46660105, "link": "https://stackoverflow.com/questions/46660105/translating-curl-to-golang-code/46661483#46661483", "title": "Translating CURL to Golang code", "body": "<p>Your body is what you think it is, it is just printed in an unexpected format to you.</p>\n\n<p><a href=\"https://golang.org/pkg/bytes/#NewReader\" rel=\"nofollow noreferrer\"><code>bytes.NewReader()</code></a> returns a pointer to the struct type <a href=\"https://golang.org/pkg/bytes/#Reader\" rel=\"nofollow noreferrer\"><code>bytes.Reader</code></a>. When you print it using <a href=\"https://golang.org/pkg/log/#Printf\" rel=\"nofollow noreferrer\"><code>log.Printf()</code></a>, it uses the formatting rules defined in the package doc of <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code></a>, that is, pointers to struct are printed as <code>&amp;{}</code> and values of fields enumerated inside of it. This is what you see. <code>bytes.Reader</code> stores the data it provides in a byte slice:</p>\n\n<pre><code>[123 34 114 102 114 73 68 34 58 34 49 49 49 49 49 49 34 125]\n</code></pre>\n\n<p>And this byte slice is equivalent to the JSON string you expect. To verify:</p>\n\n<pre><code>data := []byte{123, 34, 114, 102, 114, 73, 68, 34, 58, 34, 49, 49, 49, 49, 49, 49, 34, 125}\nfmt.Println(string(data))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{\"rfrID\":\"111111\"}\n</code></pre>\n\n<p>Reading from this reader will provide this exact string, as you can see in this example:</p>\n\n<pre><code>r := bytes.NewReader(data)\nfmt.Println(r)\nreadData, err := ioutil.ReadAll(r)\nif err != nil {\n    panic(r)\n}\nfmt.Println(string(readData))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&amp;{[123 34 114 102 114 73 68 34 58 34 49 49 49 49 49 49 34 125] 0 -1}\n{\"rfrID\":\"111111\"}\n</code></pre>\n\n<p>Try these examples on the <a href=\"https://play.golang.org/p/1qUNAx8QtC\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h2>Differences</h2>\n\n<p>Let's examine the differences between the CURL command and the client you wrote, with this little app which will be the target:</p>\n\n<pre><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm()\n    log.Println(\"Method:\", r.Method)\n    log.Println(\"Headers:\", r.Header)\n    log.Println(\"Form:\", r.Form)\n    data, err := ioutil.ReadAll(r.Body)\n    log.Println(\"Body:\", data, err)\n    log.Println(\"Body string:\", string(data))\n})\npanic(http.ListenAndServe(\":8080\", nil))\n</code></pre>\n\n<p>CURL:</p>\n\n<pre><code>2017/10/10 10:17:26 Method: GET\n2017/10/10 10:17:26 Headers: map[Content-Length:[19] User-Agent:[curl/7.47.0] Accept:[*/*] Content-Type:[application/json] Web2py-User-Token:[token-string]]\n2017/10/10 10:17:26 Form: map[]\n2017/10/10 10:17:26 Body: [123 34 114 102 114 73 68 34 58 32 34 49 49 49 49 49 49 34 125] &lt;nil&gt;\n2017/10/10 10:17:26 Body string: {\"rfrID\": \"111111\"}\n</code></pre>\n\n<p>Go client:</p>\n\n<pre><code>2017/10/10 10:17:20 Method: GET\n2017/10/10 10:17:20 Headers: map[User-Agent:[Go-http-client/1.1] Content-Length:[18] Content-Type:[application/json] Web2py-User-Token:[token-string] Accept-Encoding:[gzip]]\n2017/10/10 10:17:20 Form: map[]\n2017/10/10 10:17:20 Body: [123 34 114 102 114 73 68 34 58 34 49 49 49 49 49 49 34 125] &lt;nil&gt;\n2017/10/10 10:17:20 Body string: {\"rfrID\":\"111111\"}\n</code></pre>\n\n<p>Despite some headers added automatically by the clients, and a space inside the JSON string (which has no effect just formatting), they are identical.</p>\n"}], "owner": {"reputation": 2119, "user_id": 4624236, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh6.googleusercontent.com/-YcZ9puA0zLE/AAAAAAAAAAI/AAAAAAAAAGU/5JSTNxNO9-A/photo.jpg?sz=128", "display_name": "Rutger Huijsmans", "link": "https://stackoverflow.com/users/4624236/rutger-huijsmans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 808, "favorite_count": 0, "accepted_answer_id": 46661483, "answer_count": 1, "score": -1, "last_activity_date": 1507623744, "creation_date": 1507617516, "last_edit_date": 1507620584, "question_id": 46660105, "link": "https://stackoverflow.com/questions/46660105/translating-curl-to-golang-code", "title": "Translating CURL to Golang code", "body": "<p>I'm trying to execute this exact CURL command in Golang:</p>\n\n<pre><code>curl -X GET -H \"Content-Type: application/json\" -H \"WEB2PY-USER-TOKEN: token-string\" -d '{\"rfrID\": \"111111\"}' 'url-string'\n</code></pre>\n\n<p>It's a little weird because it's a GET HTTP call with a JSON body. Our vendor however requires us to call the API like this though. I can't figure out how to make our Golang program execute this API. </p>\n\n<p>This is the Go code that I've tried so far: </p>\n\n<pre><code>data := Payload{\n    // fill struct\n    RfrID: \"111111\",\n}\npayloadBytes, err := json.Marshal(data)\nif err != nil {\n    // handle err\n}\nbody := bytes.NewReader(payloadBytes)\n\nlog.Printf(\"[INFO] Input body status: %v\\n\", body)\n\nreq, err := http.NewRequest(\"GET\", \"url-string\", body)\nif err != nil {\n    // handle err\n}\nreq.Header.Set(\"Content-Type\", \"application/json\")\nreq.Header.Set(\"Web2py-User-Token\", \"token-string\")\n\nresp, err := http.DefaultClient.Do(req)\nif err != nil {\n    // handle err\n}\n\nlog.Printf(\"[INFO] Artemis status: %v\\n\", resp)\n\ndefer resp.Body.Close()\n</code></pre>\n\n<p>In my logs the following gets printed: </p>\n\n<pre><code>2017/10/10 07:31:56 [INFO] Input body status: &amp;{[123 34 114 102 114 73 68 34 58 34 49 49 49 49 49 49 34 125] 0 -1}\n</code></pre>\n\n<p>I expect this body to be a JSON body like: </p>\n\n<pre><code>{\"rfrID\": \"111111\"}\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 1, "creation_date": 1507616423, "post_id": 46659685, "comment_id": 80268121, "body": "Please provide a <b>minimal</b> code example and also state your expected output. What you get as output is the standard way Go prints structs, in this case the Body."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507625008, "post_id": 46659685, "comment_id": 80272924, "body": "Make sure you&#39;re not trying to read the request body twice. That doesn&#39;t work."}, {"owner": {"reputation": 1037, "user_id": 662194, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/60c78c8f30fa96b0251a45f62c554885?s=128&d=identicon&r=PG", "display_name": "Kanishka", "link": "https://stackoverflow.com/users/662194/kanishka"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507625188, "post_id": 46659685, "comment_id": 80273035, "body": "@Peter I&#39;m not. I cleared out the method and tried what Cerise Lim&#243;n suggested in the answer below. Still no luck :/"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507625388, "post_id": 46659685, "comment_id": 80273148, "body": "Your client is sending incomplete data then (maybe even nothing at all)."}, {"owner": {"reputation": 1037, "user_id": 662194, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/60c78c8f30fa96b0251a45f62c554885?s=128&d=identicon&r=PG", "display_name": "Kanishka", "link": "https://stackoverflow.com/users/662194/kanishka"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507626079, "post_id": 46659685, "comment_id": 80273587, "body": "@Peter Please find the screenshot of the request here: <a href=\"https://ibb.co/jdwsFb\" rel=\"nofollow noreferrer\">ibb.co/jdwsFb</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 1, "last_activity_date": 1507626791, "creation_date": 1507626791, "answer_id": 46662886, "question_id": 46659685, "link": "https://stackoverflow.com/questions/46659685/strange-request-body-in-golang-api/46662886#46662886", "title": "Strange Request Body in Golang API", "body": "<p>After searching, I found <a href=\"https://github.com/revel/revel/issues/1011\" rel=\"nofollow noreferrer\">this issue #1011</a>. Quote to the response:</p>\n\n<blockquote>\n  <p>Revel automatically calls ParseForm, ParseMultipartForm or whatever function is needed for a request, so req.Body is parsed and all valuable information is stored to controller.Params.(Fixed, Route, Query, Form, Files).</p>\n</blockquote>\n\n<p>It means that, before calling your controller's method, the request body already being read by <code>revel</code>, so when you try to read it again the result will be <code>EOF</code>. From <a href=\"https://revel.github.io/manual/parameters.html\" rel=\"nofollow noreferrer\">the docs</a>, instead of using <code>json.Decoder</code> and request body, try the following:</p>\n\n<pre><code>c.Params.BindJSON(&amp;user)\n</code></pre>\n"}], "owner": {"reputation": 1037, "user_id": 662194, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/60c78c8f30fa96b0251a45f62c554885?s=128&d=identicon&r=PG", "display_name": "Kanishka", "link": "https://stackoverflow.com/users/662194/kanishka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 442, "favorite_count": 0, "accepted_answer_id": 46662886, "answer_count": 1, "score": 0, "last_activity_date": 1507626791, "creation_date": 1507615855, "last_edit_date": 1507616582, "question_id": 46659685, "link": "https://stackoverflow.com/questions/46659685/strange-request-body-in-golang-api", "title": "Strange Request Body in Golang API", "body": "<p>I have created an API server using golang and ravel. In one of the POST methods, I need to read the body and decode it to a model before saving it. But it is failing to do so. This is the guide I used <a href=\"https://medium.com/@kyawmyintthein/revel-mgo-restful-generator-for-revel-web-framework-mongodb-86209de3977e\" rel=\"nofollow noreferrer\">https://medium.com/@kyawmyintthein/revel-mgo-restful-generator-for-revel-web-framework-mongodb-86209de3977e</a></p>\n\n<p>The expected behaviour is to create the user object in the mongoDB. But I am getting an error response. Something is going wrong while Decoding it to user struct.</p>\n\n<p>Controller method:</p>\n\n<pre><code>func (c UserController) Create() revel.Result {\n\n    fmt.Print(\"Body: \")\n    fmt.Println(c.Request.Body)\n    var (\n        user models.User\n        err  error\n    )\n\n    err = json.NewDecoder(c.Request.Body).Decode(&amp;user)\n    if err != nil {\n        errResp := buildErrResponse(err, \"403\")\n        c.Response.Status = 403\n        return c.RenderJSON(errResp)\n    }\n\n    user, err = models.AddUser(user)\n    if err != nil {\n        errResp := buildErrResponse(err, \"500\")\n        c.Response.Status = 500\n        return c.RenderJSON(errResp)\n    }\n    c.Response.Status = 201\n    return c.RenderJSON(user)\n}\n</code></pre>\n\n<p>User Model:</p>\n\n<pre><code>package models\n\nimport (\n    \"gopkg.in/mgo.v2/bson\"\n    \"time\"\n    \"userAPI/app/models/mongodb\"\n)\n\ntype User struct {\n    ID        bson.ObjectId `json:\"id\" bson:\"_id\"`\n    Name      string        `json:\"name\" bson:\"name\"`\n    Email     string        `json:\"email\" bson:\"email\"`\n    Phone     string        `json:\"phone\" bson:\"phone\"`\n    Username  string        `json:\"username\" bson:\"username\"`\n    CreatedAt time.Time     `json:\"created_at\" bson:\"created_at\"`\n    UpdatedAt time.Time     `json:\"updated_at\" bson:\"updated_at\"`\n}\n</code></pre>\n\n<p>JSON body used in POST request</p>\n\n<pre><code>{\n    \"name\":\"kanishka\",\n    \"email\":\"kanishka@gmail.com\",\n    \"phone\":\"91238901238\",\n    \"username\":\"k\"\n}\n</code></pre>\n\n<p>This is the response I am getting</p>\n\n<pre><code>{\n    \"error_code\": \"403\",\n    \"error_message\": \"EOF\"\n}\n</code></pre>\n\n<p>The output of <code>println(c.Request.Body)</code> on top of the controller method shows</p>\n\n<blockquote>\n  <p>&amp;{0xc4202ffa80   false true {0 0} true false false\n  0x12a1430}</p>\n</blockquote>\n\n<p>This is my first attempt at golang. Kindly help me to proceed further. </p>\n"}, {"tags": ["go", "gomail"], "answers": [{"tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": true, "score": 3, "last_activity_date": 1507615063, "creation_date": 1507615063, "answer_id": 46659542, "question_id": 46658903, "link": "https://stackoverflow.com/questions/46658903/how-to-set-reply-to-email-address-using-gomail/46659542#46659542", "title": "How to set reply-to email address using gomail", "body": "<p>You can set the <code>Reply-To</code> header for that effect:</p>\n\n<pre><code>m.SetAddressHeader(\"Reply-To\", \"noreply@example.com\")\n</code></pre>\n"}], "owner": {"reputation": 340, "user_id": 6464746, "user_type": "registered", "accept_rate": 22, "profile_image": "https://lh6.googleusercontent.com/-75L-hYPbdcQ/AAAAAAAAAAI/AAAAAAAAAKo/siHtIEA6B0g/photo.jpg?sz=128", "display_name": "Yash Goel", "link": "https://stackoverflow.com/users/6464746/yash-goel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 764, "favorite_count": 0, "accepted_answer_id": 46659542, "answer_count": 1, "score": 3, "last_activity_date": 1591412363, "creation_date": 1507611668, "question_id": 46658903, "link": "https://stackoverflow.com/questions/46658903/how-to-set-reply-to-email-address-using-gomail", "title": "How to set reply-to email address using gomail", "body": "<p>I am trying to send email using <code>gomail</code>, need to set reply-to email address. Searched a lot but did not get any relevant link.</p>\n\n<pre><code>package main\n\nimport \"gopkg.in/gomail.v2\"\n\nfunc main() {\n   m := gomail.NewMessage()\n   m.SetAddressHeader(\"From\", \"sender@example.com\", \"Sandy Sender\")\n   m.SetAddressHeader(\"To\", \"recipient@example.com\")\n   m.SetHeader(\"Subject\", \"Hello!\")\n   m.SetBody(\"text/plain\", \"This is the body of the message.\")\n\n   d := gomail.NewPlainDialer(\"smtp.example.com\", 587, \"user\", \"123456\")\n\n   if err := d.DialAndSend(m); err != nil {\n    panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "intellij-idea"], "answers": [{"comments": [{"owner": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "edited": false, "score": 0, "creation_date": 1507646651, "post_id": 46658767, "comment_id": 80287647, "body": "Thanks! Also, I have my env setup this way:  Under <code>~&#47;go-projects</code>, I have <code>src&#47;</code>, <code>bin&#47;</code> and <code>pkg&#47;</code>.   Under <code>src&#47;</code> I have all my projects. Now, when I run <code>go get -t github.com&#47;gorilla&#47;mux</code> from inside <code>src&#47;project-1</code>, the package gets installed under <code>~&#47;go-projects&#47;src&#47;</code>. Is that how it should be? Or should it get installed under <code>~&#47;go-projects&#47;pkg&#47;</code> ?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "edited": false, "score": 1, "creation_date": 1507649935, "post_id": 46658767, "comment_id": 80289874, "body": "@NishantRoy a <code>go get</code> or <code>go get -u</code> should be enough to download the sources (in <code>src</code> as you mention), compile and install in <code>pkg</code> (<code>*.a</code> files)"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 3, "last_activity_date": 1507612768, "last_edit_date": 1507612768, "creation_date": 1507610849, "answer_id": 46658767, "question_id": 46658680, "link": "https://stackoverflow.com/questions/46658680/intellij-go-import-autocomplete/46658767#46658767", "title": "Intellij go import autocomplete", "body": "<blockquote>\n  <p>but I haven't run <code>go get</code> ... yet, is there anyway to have that be autocompleted?</p>\n</blockquote>\n\n<p>No: <a href=\"https://www.jetbrains.com/go/\" rel=\"nofollow noreferrer\">Gogland</a> should add the import automatically on save, but only if the package was installed first (present in a <code>pkg</code> folder of your workspace, for external packages)</p>\n\n<p>And even in that case, Gogland will not automatically import ambiguous packages (meaning if you have two <code>rand</code> packages, it will ask you which one to use, the <code>crypto/rand</code> or the <code>math/rand</code>). That should not be the case here.</p>\n"}], "owner": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 1, "accepted_answer_id": 46658767, "answer_count": 1, "score": 1, "last_activity_date": 1507612768, "creation_date": 1507610090, "question_id": 46658680, "link": "https://stackoverflow.com/questions/46658680/intellij-go-import-autocomplete", "title": "Intellij go import autocomplete", "body": "<p>Anyway to have Intellij autocomplete import statements for github projects?</p>\n\n<p>Like if I want to import <code>github.com/gorilla/mux</code> but I haven't run <code>go get ...</code> yet, is there anyway to have that be autocompleted?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 2, "last_activity_date": 1507618592, "last_edit_date": 1592644375, "creation_date": 1507615760, "answer_id": 46659663, "question_id": 46658461, "link": "https://stackoverflow.com/questions/46658461/how-do-i-apply-my-custom-unmarshaljson-method-to-an-embedded-struct/46659663#46659663", "title": "How do I apply my custom UnmarshalJSON method to an embedded struct?", "body": "<p>I don't know enough to explain all the reasons, I will just list what works and what doesn't. Someone more knowledgeable can fill you in on the reasons behind it.</p>\n<p>The following works when B is a <code>*struct</code>, not sure why.</p>\n<pre><code>type Embedded struct {\n    A struct {\n        B *struct {\n            P\n        } `json:&quot;b&quot;`\n    } `json:&quot;a&quot;`\n}\n</code></pre>\n<p>The following also works. I'm guessing that using an anonymous struct had some effect in the last one since a <code>*struct</code> is not required here.</p>\n<pre><code>type embedP struct {\n            P\n}\n\ntype Embedded struct {\n    A struct {\n        B embedP `json:&quot;b&quot;`\n    } `json:&quot;a&quot;`\n}\n</code></pre>\n<p>The following works if <code>*P</code> is initialised.</p>\n<pre><code>type embedP struct {\n            *P\n}\n\ntype intermediate struct {\n        B embedP `json:&quot;b&quot;`\n}\n\ntype Embedded struct {\n    A  intermediate `json:&quot;a&quot;`\n}\n\ne := &amp;Embedded{A:intermediate{embedP{P:&amp;P{}}}}\n</code></pre>\n<p>But the same thing doesn't work with anonymous structs.</p>\n<pre><code>type Embedded struct {\n    A struct {\n        B struct {\n            *P\n        } `json:&quot;b&quot;`\n    } `json:&quot;a&quot;`\n}\n\ne := &amp;Embedded{A : struct{B struct{*P}`json:&quot;b&quot;`}{B: struct{*P}{&amp;P{}}}}\n</code></pre>\n<p><a href=\"https://play.golang.org/p/nS_HmVx3kD\" rel=\"nofollow noreferrer\">Play link</a></p>\n<p>Other improvements</p>\n<p>If <code>p := &amp;P{}</code> is already a pointer you don't need to pass &amp;p in json.Unmarshal. <code>json.Unmarshal(b, p)</code> would suffice. Same with <code>e := &amp;Embedded{}</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": false, "score": 2, "last_activity_date": 1507624159, "creation_date": 1507624159, "answer_id": 46661998, "question_id": 46658461, "link": "https://stackoverflow.com/questions/46658461/how-do-i-apply-my-custom-unmarshaljson-method-to-an-embedded-struct/46661998#46661998", "title": "How do I apply my custom UnmarshalJSON method to an embedded struct?", "body": "<p>To extent @John's answer, take a look at the source code of json decoder, especially method <a href=\"https://golang.org/src/encoding/json/decode.go?s=3976:4024#L460\" rel=\"nofollow noreferrer\"><code>indirect(v reflect.Value, decodingNull bool)</code></a> line 442-483. </p>\n\n<blockquote>\n  <p>// indirect walks down v allocating pointers as needed,<br>\n  // until it gets to a non-pointer.<br>\n  // if it encounters an Unmarshaler, indirect stops and returns that.<br>\n  // if decodingNull is true, indirect stops at the last pointer so it can be set to nil.</p>\n</blockquote>\n\n<p>The method returns, <code>json.Unmarshaler</code>, <code>encoding.TextUnmarshaler</code> and the value of <code>v</code>. <strong>In current implementation</strong>, inside the method, basically the following <em>steps</em> were executed</p>\n\n<ol>\n<li>If argument <code>v</code> is <strong>not a pointer</strong>, it will return immediately without checking whether <code>v</code> implements <code>json.Unmarshaler/encoding.TextUnmarshaler</code> or not. The method assigns <code>nil</code> for both unmarshaller regardless <code>B</code> implements custom unmarshaller or not.</li>\n<li>If argument <code>v</code> <strong>is a pointer</strong>, it will check whether <code>v</code> implements <code>json.Unmarshaler/encoding.TextUnmarshaler</code> or not. In this case, if <code>v</code> is nil, a new value will be assigned to <code>v</code>.</li>\n</ol>\n\n<p>If <code>Embedded</code> is defined as</p>\n\n<pre><code>type Embedded struct {\n    A struct {\n        B struct {\n            *P\n        } `json:\"b\"`\n    } `json:\"a\"`\n}\n</code></pre>\n\n<p>when, decoding <code>\"b\":{\"name\":\"bob\"}</code> to field <code>B</code>, since <code>B</code> is not a pointer, (1) is applicable. As the result, custom unmarshaller is returned as <code>nil</code>, thus never being called. The json decoder uses default unmarshaller to decode json value to <code>B</code>'s fields. </p>\n\n<p>If <code>Embedded</code> is defined as</p>\n\n<pre><code>type Embedded struct {\n    A struct {\n        *B struct {\n            P\n        } `json:\"b\"`\n    } `json:\"a\"`\n}\n</code></pre>\n\n<p>since field <code>B</code> is a pointer, (2) is applicable. The decoder allocates new <code>struct{*P}</code> to <code>B</code>, detects that <code>B</code> implements custom unmarshaller, then call it as expected. The following declaration </p>\n\n<pre><code>type Embedded struct {\n    A struct {\n        *B struct {\n            *P\n        } `json:\"b\"`\n    } `json:\"a\"`\n}\n</code></pre>\n\n<p>also works, if <code>P</code> is preallocated, i.e.</p>\n\n<pre><code>//...\ne := Embedded{}\ne.A.B = &amp;struct{ *P }{P: &amp;P{}}\n//...\n</code></pre>\n\n<p>If it's not preallocated, in (2) the decoder will assign <code>&amp;struct{*P}{}</code> to <code>B</code>, then call the custom unmarshaller with <code>B.P == nil</code>. As the result, json value can't be captured by <code>B.P</code> during unmarshall. </p>\n\n<p><strong>Note</strong>:<br>\nI'm not sure whether it is desired behavior or not, and I can't find a clear documentation related to embedded struct. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 657, "favorite_count": 1, "accepted_answer_id": 46659663, "answer_count": 2, "score": 4, "last_activity_date": 1507624159, "creation_date": 1507608451, "question_id": 46658461, "link": "https://stackoverflow.com/questions/46658461/how-do-i-apply-my-custom-unmarshaljson-method-to-an-embedded-struct", "title": "How do I apply my custom UnmarshalJSON method to an embedded struct?", "body": "<p>So, I have struct P. I need to unmarshal some json data into P but sometimes it comes embedded struct, Embedded. In either case, I unmarshal the json from the API and need to format the \"Formatted\" field. It seems in the Embedded case my unmarshaller doesn't get called.</p>\n\n<p>I <a href=\"https://play.golang.org/p/7-GLx01-pl\" rel=\"nofollow noreferrer\">have the following code</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype P struct {\n    Name      string `json:\"name\"`\n    Formatted string `json:\"formatted\"`\n}\n\ntype Embedded struct {\n    A struct {\n        B struct {\n            *P\n        } `json:\"b\"`\n    } `json:\"a\"`\n}\n\nfunc (p *P) UnmarshalJSON(b []byte) error {\n    type Alias P\n\n    a := &amp;struct {\n        *Alias\n    }{\n        Alias: (*Alias)(p),\n    }\n\n    if err := json.Unmarshal(b, &amp;a); err != nil {\n        return err\n    }\n\n    a.Formatted = fmt.Sprintf(\"Hi, my name is %v\", a.Name)\n\n    return nil\n}\n\nfunc simple() {\n    b := []byte(`{\"name\":\"bob\"}`)\n\n    p := &amp;P{}\n    if err := json.Unmarshal(b, &amp;p); err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"normal: %+v\\n\", p)\n}\n\nfunc embedded() {\n    b := []byte(`{\"a\":{\"b\":{\"name\":\"bob\"}}}`)\n\n    e := &amp;Embedded{}\n    if err := json.Unmarshal(b, &amp;e); err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"embedded: %+v\\n\", e.A.B.P)\n}\n\nfunc main() {\n    simple()\n\n    embedded()\n\n}\n</code></pre>\n\n<p>(I realize I can get rid of the custom unmarshaller and create a method to format the name but wanted to see if this way was possible.)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507603396, "post_id": 46657841, "comment_id": 80264572, "body": "You can&#39;t cancel a goroutine in general, but here you could simply close the connection to interrupt the Read call. Can you show an example of the problem you&#39;re actually trying to solve?"}, {"owner": {"reputation": 6606, "user_id": 4135670, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/mArsS.jpg?s=128&g=1", "display_name": "Rafael", "link": "https://stackoverflow.com/users/4135670/rafael"}, "edited": false, "score": 0, "creation_date": 1507603526, "post_id": 46657841, "comment_id": 80264600, "body": "You could always set a timer upcall, and send an EOF signal in the handler."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507603908, "post_id": 46657841, "comment_id": 80264667, "body": "If you only want to wait for a certain amount of time, you should set a read deadline on the connection."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507606816, "post_id": 46657841, "comment_id": 80265298, "body": "maybe this helps you: <a href=\"https://rakyll.org/leakingctx/\" rel=\"nofollow noreferrer\">rakyll.org/leakingctx</a>"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507642948, "post_id": 46663107, "comment_id": 80285010, "body": "While contexts are useful, this doesn&#39;t have anything to do with cancelling a blocking Read call."}], "tags": [], "owner": {"reputation": 1137, "user_id": 2660766, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/qiIdj.png?s=128&g=1", "display_name": "maksadbek", "link": "https://stackoverflow.com/users/2660766/maksadbek"}, "is_accepted": false, "score": 1, "last_activity_date": 1507719292, "last_edit_date": 1507719292, "creation_date": 1507627401, "answer_id": 46663107, "question_id": 46657841, "link": "https://stackoverflow.com/questions/46657841/cancel-go-func/46663107#46663107", "title": "Cancel go func()", "body": "<p>EDIT: Context can't do anything with blocking Read function, that is this is not the correct solution for the question. Better to set idle timeout to the connection in this situation.</p>\n\n<p>You can use <code>context</code> package to control goroutines. Context is mostly used to stop the goroutine in case it is cancelled, timeout, etc. To use it, you must receive one more argument <code>ctx context</code>, and run select in your goroutine.</p>\n\n<p>Example from Godoc:</p>\n\n<pre><code>package main\n\nimport (\n\"context\"\n\"fmt\"\n\"time\"\n)\n\nfunc main() {\n// Pass a context with a timeout to tell a blocking function that it\n// should abandon its work after the timeout elapses.\nctx, cancel := context.WithTimeout(context.Background(), 50*time.Millisecond)\ndefer cancel()\n\nselect {\ncase &lt;-time.After(1 * time.Second):\n    fmt.Println(\"overslept\")\ncase &lt;-ctx.Done():\n    fmt.Println(ctx.Err()) // prints \"context deadline exceeded\"\n}\n\n}\n</code></pre>\n\n<p>Read more about context use cases in official blog post:\n<a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">https://blog.golang.org/context</a></p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1507659523, "creation_date": 1507659523, "answer_id": 46673377, "question_id": 46657841, "link": "https://stackoverflow.com/questions/46657841/cancel-go-func/46673377#46673377", "title": "Cancel go func()", "body": "<p><a href=\"https://golang.org/pkg/net/#Conn\" rel=\"nofollow noreferrer\"><code>Conn</code></a> interface provides a method <code>SetReadDeadline</code> to interrupt staled operation at specific time:</p>\n\n<pre><code>for {\n    // Set a deadline for reading. Read operation will fail if no data\n    // is received after deadline.\n    conn.SetReadDeadline(time.Now().Add(timeoutDuration))\n\n    // Read tokens delimited by newline\n    bytes, err := bufReader.ReadBytes('\\n')\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Printf(\"%s\", bytes)\n}\n</code></pre>\n\n<p><a href=\"http://www.mrleong.net/post/130329994134/go-tcp-connection-listening-and-timeout\" rel=\"nofollow noreferrer\">http://www.mrleong.net/post/130329994134/go-tcp-connection-listening-and-timeout</a></p>\n"}], "owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 574, "favorite_count": 0, "accepted_answer_id": 46673377, "answer_count": 2, "score": 0, "last_activity_date": 1507719292, "creation_date": 1507602944, "last_edit_date": 1507603472, "question_id": 46657841, "link": "https://stackoverflow.com/questions/46657841/cancel-go-func", "title": "Cancel go func()", "body": "<p>Let's say I have a golang function that goes something like:</p>\n\n<pre><code>conn, _ := ln.Accept()\nr := bufio.NewReader(conn)\n\nfunc waiter(r *bufio.Reader) {\n    r.ReadString('\\n')\n}\n\ngo waiter(r)\ntime.Sleep(time.Second)\nfmt.Println(\"hello\")\n</code></pre>\n\n<p>Is there a way for me to cancel the waiter so it's not hung waiting for a string input if it never comes?  The issue is the bufio reader is blocking, and I want to have it wait for two seconds on a ticker, and if it doesn't read in any data to the buffer to escape the goroutine.</p>\n"}, {"tags": ["go", "system-calls", "libc"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1507602405, "post_id": 46657611, "comment_id": 80264358, "body": "It is just a guess but one big golang&#39;s sales point is that it can do static build easily, and build execution binary which does not depend on libc, so maybe they decided not to rely on libc."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1507603102, "post_id": 46657611, "comment_id": 80264513, "body": "Besides the easy ability to do static builds, another point is that Go uses a different calling convention, which isn&#39;t compatible with C. Implementing the syscalls directly saves a lot of overhead."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 6, "creation_date": 1507648583, "post_id": 46657611, "comment_id": 80289014, "body": "This is a question for the Go team, not StackOverflow. Try the Go mailing lists."}], "answers": [{"tags": [], "owner": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "is_accepted": false, "score": 0, "last_activity_date": 1557995154, "last_edit_date": 1557995154, "creation_date": 1552574330, "answer_id": 55165292, "question_id": 46657611, "link": "https://stackoverflow.com/questions/46657611/why-golang-chose-syscall-rather-than-libc/55165292#55165292", "title": "why golang chose syscall rather than libc", "body": "<p>Because Go manages its processes in goroutines managed by the Go Runtime which is written in C and statically linked to the compiled user code during the linking phase. Since go manages its syscall with its own runtime not directly in the OS, that is why it implemented its own syscall package.</p>\n"}], "owner": {"reputation": 73, "user_id": 2181168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfd7cd1259610060e15ed5a8cf0994d2?s=128&d=identicon&r=PG", "display_name": "Huitse Tai", "link": "https://stackoverflow.com/users/2181168/huitse-tai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1334, "favorite_count": 3, "closed_date": 1579289492, "answer_count": 1, "score": 4, "last_activity_date": 1557995154, "creation_date": 1507601248, "last_edit_date": 1507637867, "question_id": 46657611, "link": "https://stackoverflow.com/questions/46657611/why-golang-chose-syscall-rather-than-libc", "closed_reason": "Opinion-based", "title": "why golang chose syscall rather than libc", "body": "<p>Go wraps all syscall-s in package syscall, just like what libc does if I understand them right.</p>\n\n<p>I've researched a few languages,</p>\n\n<ul>\n<li><p>Haskell, using libc in compiler and the libraries normally use it too, although there is a few libraries wrapping syscall for users.</p></li>\n<li><p>Java and almost all JVM languages choosing libc.</p></li>\n</ul>\n\n<p>No need mention script languages, such as lua, ruby or python, they need portable, so they need libc as an implementation of POSIX.</p>\n\n<p>I didn't use rust recently, but there are some people just said rust using libc too.</p>\n\n<p>So, why golang decided to implement a syscall package at first. It's not portable, cost more people to port to each kernel, even each major version of the same kernel.</p>\n"}, {"tags": ["firebase", "go", "firebase-realtime-database"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1507593325, "post_id": 46656371, "comment_id": 80262332, "body": "How did you store the query result? Is it in a variable defined as <code>map[string]interface{}</code>?"}, {"owner": {"reputation": 78, "user_id": 8560592, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qDkh8xXJ3SA/AAAAAAAAAAI/AAAAAAAAABc/7TINy6lMntQ/photo.jpg?sz=128", "display_name": "Ethan", "link": "https://stackoverflow.com/users/8560592/ethan"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1507596181, "post_id": 46656371, "comment_id": 80263039, "body": "Yes exactly like that"}], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 0, "last_activity_date": 1507608011, "creation_date": 1507608011, "answer_id": 46658411, "question_id": 46656371, "link": "https://stackoverflow.com/questions/46656371/how-to-print-specific-fields-from-firebase-database/46658411#46658411", "title": "How to print specific fields from firebase database", "body": "<p>If the query result is stored as <code>map[string]interface{}</code> then iterate over the results as:</p>\n\n<pre><code>//queryResults := ...\nfor _, val := range queryResults {\n    //test whether vmap is an object/not\n    vmap, ok := val.(map[string]interface{})\n    if !ok {\n        continue\n    }\n\n    //vmap contains {\"date\":..., \"data\":...}\n    field := \"date\"\n    if v, ok := vmap[field]; ok {\n        fmt.Printf(\"%s: %v\\n\", field, v)\n    }       \n}\n</code></pre>\n\n<p>If you don't know the object's hierarchy, you can implement a kind of <code>find</code> function to search for a specific <code>key/field</code> from <code>queryResults</code>. See <a href=\"https://stackoverflow.com/a/45757396/6207052\">https://stackoverflow.com/a/45757396/6207052</a>. </p>\n"}], "owner": {"reputation": 78, "user_id": 8560592, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qDkh8xXJ3SA/AAAAAAAAAAI/AAAAAAAAABc/7TINy6lMntQ/photo.jpg?sz=128", "display_name": "Ethan", "link": "https://stackoverflow.com/users/8560592/ethan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 46658411, "answer_count": 1, "score": 1, "last_activity_date": 1507608011, "creation_date": 1507591050, "question_id": 46656371, "link": "https://stackoverflow.com/questions/46656371/how-to-print-specific-fields-from-firebase-database", "title": "How to print specific fields from firebase database", "body": "<p>I am a complete firebase newbie, but basically my situation is this I am collecting weather data and storing it in firebase like so: </p>\n\n<pre><code>{\n    \"-Kw2H2dbJKZbbg-6LA6b\": {\n        \"date\": \"10/9/2017\",\n        \"data\": \"filler test data\",\n    }\n}\n</code></pre>\n\n<p>And then I will display this info to my website. I am using Go with firego as my backend and I am wondering how could I query my db and print any individual field. For example I wish to display the date </p>\n\n<pre><code>\"date\": \"10/9/2017\"\n</code></pre>\n\n<p>Just in general how can this be done. Any help is much appreciated!</p>\n"}, {"tags": ["go", "package", "vendoring"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1507584980, "post_id": 46655280, "comment_id": 80259820, "body": "You can&#39;t have nested vendor directories. You need to use a vendoring tool to flatten these into your top-level vendor directory (or do it manually if you choose)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1507648624, "post_id": 46655280, "comment_id": 80289043, "body": "And open an issue with the library maintainer! Libraries should not vendor their dependencies for exactly this reason."}], "owner": {"reputation": 63413, "user_id": 193619, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/11e74c6cb64be4d24fdee076ddb374b0?s=128&d=identicon&r=PG", "display_name": "Nathan Osman", "link": "https://stackoverflow.com/users/193619/nathan-osman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 220, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507636919, "creation_date": 1507584684, "last_edit_date": 1507636919, "question_id": 46655280, "link": "https://stackoverflow.com/questions/46655280/how-do-i-vendor-a-package-which-itself-vendors-another-package", "title": "How do I vendor a package which itself vendors another package?", "body": "<p>I am trying to write an application that uses <a href=\"https://github.com/ChimeraCoder/anaconda\" rel=\"nofollow noreferrer\">this package</a>. I have the following snippet:</p>\n\n<pre><code>import (\n    \"github.com/ChimeraCoder/anaconda\"\n    \"github.com/garyburd/go-oauth/oauth\"\n)\n\nc, _, err := anaconda.GetCredentials(&amp;oauth.Credentials{}, \"...\")\n</code></pre>\n\n<p>This results in the following compilation error:</p>\n\n<pre><code>app.go:40:9: cannot use \"github.com/garyburd/go-oauth/oauth\".Credentials literal\n  (type *\"github.com/garyburd/go-oauth/oauth\".Credentials) as type\n  *\"github.com/ChimeraCoder/anaconda/vendor/github.com/garyburd/go-oauth/oauth\".Credentials\n  in argument to anaconda.GetCredentials\n</code></pre>\n\n<p>This is because <code>github.com/ChimeraCoder/anaconda</code> is using vendoring.</p>\n\n<p>How then can I create an instance of <code>*oauth.Credentials</code>?</p>\n"}, {"tags": ["html", "mysql", "go"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 0, "last_activity_date": 1507585109, "last_edit_date": 1507585109, "creation_date": 1507584746, "answer_id": 46655296, "question_id": 46655138, "link": "https://stackoverflow.com/questions/46655138/golang-print-html-lines-dynamically/46655296#46655296", "title": "Golang print html lines dynamically", "body": "<p>It is possible but not a good idea. The template package is useful for escaping things which might have touched user input, and not hard to use. Just make a slice of things, and range over them in the template.</p>\n\n<p>This is safer than trying to build html in code because the context package knows about escaping urls or js for example, as opposed to html, and takes the location of variables into account.  </p>\n\n<p><a href=\"https://play.golang.org/p/JEIjPT5ayP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JEIjPT5ayP</a></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"text/template\"\n)\n\nvar t = `\n&lt;html&gt;\n&lt;head&gt;\n...\n&lt;/head&gt;\n&lt;body&gt;\n{{range . }}\n  &lt;a href = \"{{.URL}}\"&gt;{{.Name}}&lt;/a&gt;\n{{end}}\n&lt;/body&gt;\n&lt;/html&gt; \n`\n\ntype Location struct {\n    Name string\n    URL  string\n}\n\nfunc main() {\n\n    // Insert read data code here\n    data := []Location{{Name: \"example\", URL: \"https://example.com\"}}\n\n    tmpl, err := template.New(\"foo\").Parse(t)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = tmpl.Execute(os.Stdout, data)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 7487799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6020a403c5ab2d7d3dfb2cd1a6d66dd?s=128&d=identicon&r=PG&f=1", "display_name": "utinum", "link": "https://stackoverflow.com/users/7487799/utinum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 529, "favorite_count": 0, "accepted_answer_id": 46655296, "answer_count": 1, "score": 0, "last_activity_date": 1507585109, "creation_date": 1507583861, "question_id": 46655138, "link": "https://stackoverflow.com/questions/46655138/golang-print-html-lines-dynamically", "title": "Golang print html lines dynamically", "body": "<p>I would like to print out rows from a mysql db as html.\nThis is what I want to achieve:</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n...\n&lt;/head&gt;\n&lt;body&gt;\n&lt;a href = \"url1\"&gt;name1&lt;/a&gt;\n&lt;a href = \"url2\"&gt;name2&lt;/a&gt;\n...\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>My go code:</p>\n\n<pre><code>for rows.Next() {\n    var name string\n    var url string\n\n    err = rows.Scan(&amp;name, &amp;url)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>I thought that I could put the items into a slice and write them out with a for loop in a template, but instead of this is it possible to write out each line with the for loop in the go code?</p>\n"}, {"tags": ["go", "variadic-functions", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 2, "last_activity_date": 1507582637, "creation_date": 1507582637, "answer_id": 46654864, "question_id": 46654132, "link": "https://stackoverflow.com/questions/46654132/go-gorm-db-automigrate/46654864#46654864", "title": "Go GORM db.Automigrate", "body": "<p>Pretty sure you just need to do:</p>\n\n<pre><code>err := db.AutoMigrate(models...).Error\n</code></pre>\n\n<p>Variadic functions receive the arguments as a slice of the type. In this case your function receives a  <code>[]interface{}</code> named <code>models</code>. When you pass that argument to <code>db.AutoMigrate</code>, you are passing it as a single argument of type <code>[]interface{}</code>. </p>\n\n<p>What you really want is to pass each value in args as a separate argument (the same way you received them). To do this you must use the <code>...</code> syntax.</p>\n"}, {"tags": [], "owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "is_accepted": false, "score": 0, "last_activity_date": 1507602086, "creation_date": 1507602086, "answer_id": 46657739, "question_id": 46654132, "link": "https://stackoverflow.com/questions/46654132/go-gorm-db-automigrate/46657739#46657739", "title": "Go GORM db.Automigrate", "body": "<p>You just need to pass the models as a variadic arg to your automigrate call. Automigrate accepts multiple model parameters (as in <code>db.AutoMigrate(model1{}, model2{}, model3{})</code>), not an array.</p>\n\n<p>I threw together an analog example printing strings in the playground here:\n<a href=\"https://play.golang.org/p/qPTLqBvsen\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qPTLqBvsen</a></p>\n"}, {"tags": [], "owner": {"reputation": 491, "user_id": 2488609, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9dop.jpg?s=128&g=1", "display_name": "Abdelaziz Elrashed", "link": "https://stackoverflow.com/users/2488609/abdelaziz-elrashed"}, "is_accepted": false, "score": 0, "last_activity_date": 1568183414, "creation_date": 1568183414, "answer_id": 57883303, "question_id": 46654132, "link": "https://stackoverflow.com/questions/46654132/go-gorm-db-automigrate/57883303#57883303", "title": "Go GORM db.Automigrate", "body": "<p>You need to make this modification:</p>\n\n<pre><code>// HandleMigrate ...\nfunc HandleMigrate(db *gorm.DB, models ...interface{}) error {\n\n// this need to be checked\nerr := db.AutoMigrate(models...).Error\nif err != nil {\n    fmt.Println(\"Error HandleMigrate:\" + err.Error())\n    return err\n}\n\nreturn nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1303, "user_id": 1990524, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/d1b7da006e44f2492030e9ad17d15d23?s=128&d=identicon&r=PG", "display_name": "jjuser19jj", "link": "https://stackoverflow.com/users/1990524/jjuser19jj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1035, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1568183414, "creation_date": 1507579309, "question_id": 46654132, "link": "https://stackoverflow.com/questions/46654132/go-gorm-db-automigrate", "title": "Go GORM db.Automigrate", "body": "<p>I use Go-GORM to connect to a cockrouch DB cluster. I wrote a helper function to handle the connection and auto migrate part. Everything works fine, except when I want to auto migrate more than 1 model.</p>\n\n<pre><code>err = helperdb.HandleMigrate(db, models.Resource{}, models.Right{})\nif err != nil {\n    helperlog.Log(\"Clavem\", \"HandleMigrate\", \"Error migrating resource:\"+err.Error())\n    return\n}\n</code></pre>\n\n<p>This is the helper function:</p>\n\n<pre><code>// HandleMigrate ...\nfunc HandleMigrate(db *gorm.DB, models ...interface{}) error {\n\n// this need to be checked\nerr := db.AutoMigrate(models).Error\nif err != nil {\n    fmt.Println(\"Error HandleMigrate:\" + err.Error())\n    return err\n}\n\nreturn nil\n</code></pre>\n\n<p>}</p>\n\n<p>I get the following error:</p>\n\n<pre><code>pq: empty table name: \"\\\"\\\"\"\n</code></pre>\n\n<p>When I call <code>gorm.DB.AutoMigrate(&amp;models.Resurce{}, models.Right{})</code> directly I get no error.</p>\n\n<p>I realise that I do not need a helper function, but I would like to know why the helper functions does not work, especially since it is my first time working my variadic functions.</p>\n\n<p>Thanks :) </p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507578299, "post_id": 46653880, "comment_id": 80257134, "body": "Every variable is written to its own memory. If you want a variable to persist outside a loop&#39;s scope (or any block), declare the variable outside that block."}, {"owner": {"reputation": 673, "user_id": 363042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d158e0063c0d368abbca8e7f99a153af?s=128&d=identicon&r=PG", "display_name": "Brent", "link": "https://stackoverflow.com/users/363042/brent"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507578522, "post_id": 46653880, "comment_id": 80257227, "body": "Yes. I think that&#39;s what I&#39;m doing, unless I&#39;m misunderstanding your solution. I set the pointer slice variable outside the loop scope, only to watch it get rewritten at each iteration."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507579376, "post_id": 46653880, "comment_id": 80257605, "body": "Which variable is getting overwritten?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507579382, "post_id": 46653880, "comment_id": 80257607, "body": "I really cannot figure out what you intend for this example to do. I would suggest to stop trying to share data between scopes, and refactor into some functions that return the data your interested in."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1507579529, "post_id": 46653880, "comment_id": 80257683, "body": "OK after re-reading I think I misunderstood the original question... based on the psuedocode it looks basically correct I think, but it&#39;s psuedocode which tells us little. If you can post a <a href=\"https://stackoverflow.com/help/mcve\">MCVE</a> we might be able to offer more insight."}], "answers": [{"comments": [{"owner": {"reputation": 673, "user_id": 363042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d158e0063c0d368abbca8e7f99a153af?s=128&d=identicon&r=PG", "display_name": "Brent", "link": "https://stackoverflow.com/users/363042/brent"}, "edited": false, "score": 0, "creation_date": 1507580757, "post_id": 46654277, "comment_id": 80258165, "body": "Thanks for this. In the playground example, I didn&#39;t capture the issue that I&#39;m trying to gather more than one RSVP for a user. I need some way to define a slice before the loop, then collect together all the RSVPs for a user during the loop, and then assign the collected RSVPs to the user when the loop hits a new user."}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 0, "last_activity_date": 1507579988, "creation_date": 1507579988, "answer_id": 46654277, "question_id": 46653880, "link": "https://stackoverflow.com/questions/46653880/resetting-pointers-in-loops/46654277#46654277", "title": "Resetting pointers in loops", "body": "<p>How about you do the following:</p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n    )\n\n    type User struct {\n        ID    int\n        Rsvps []*Rsvp\n    }\n\n    type Rsvp struct {\n        Response string\n    }\n\n    func main() {\n        users := []int{1, 2, 3}\n        responses := []string{\"Yes\", \"No\", \"Maybe\"}\n        var results []*User\n        for _, i := range users {\n            r := Rsvp{Response: responses[i-1]} // create new variable\n            u := User{ID: i}\n            u.Rsvps = append(u.Rsvps, &amp;r)\n            results = append(results, &amp;u)\n        }\n        for _, r := range results {\n            fmt.Println(r.ID, r.Rsvps[0].Response)\n        }\n\n    }\n</code></pre>\n\n<p>I have taken your playground example, stripped the comments and changed the code to get your desired output. The main change is that I do not re-use <code>r</code>. Originally you were always appending <code>&amp;r</code> but changing <code>r</code> at the start of the loop. Of course this changes the memory that r points to, making everything a <code>Maybe</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 673, "user_id": 363042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d158e0063c0d368abbca8e7f99a153af?s=128&d=identicon&r=PG", "display_name": "Brent", "link": "https://stackoverflow.com/users/363042/brent"}, "edited": false, "score": 0, "creation_date": 1507594298, "post_id": 46656573, "comment_id": 80262583, "body": "Good heavens, what a &quot;simple&quot; answer. Thank you! Just set the variable equal to another, &quot;fresh&quot; variable to preserve it, and then append that one to the slice. Brilliant!"}, {"owner": {"reputation": 673, "user_id": 363042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d158e0063c0d368abbca8e7f99a153af?s=128&d=identicon&r=PG", "display_name": "Brent", "link": "https://stackoverflow.com/users/363042/brent"}, "edited": false, "score": 0, "creation_date": 1507594381, "post_id": 46656573, "comment_id": 80262608, "body": "Meanwhile, I had just gone about preparing an MCVE, in case anyone has a (now) academic interest: <a href=\"https://play.golang.org/p/yx_SUVXaRe\" rel=\"nofollow noreferrer\">play.golang.org/p/yx_SUVXaRe</a>"}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 1, "last_activity_date": 1507592501, "creation_date": 1507592501, "answer_id": 46656573, "question_id": 46653880, "link": "https://stackoverflow.com/questions/46653880/resetting-pointers-in-loops/46656573#46656573", "title": "Resetting pointers in loops", "body": "<p>The problem is not caused by a pointer to <code>Rsvp</code> but the following statement(s):</p>\n\n<pre><code>user := User{} //hold onto a user while iterating\n\n//... omitted for clarity\nfor _, record := range dataset{\n    //...   \n    if lastUserID != thisUserID &amp;&amp; lastUserID &gt; 0{\n        //... \n\n        /*--- The problem is here ---*/\n        result = append(result, &amp;user)\n\n        //...\n    }\n    //...       \n    user = getUser(record) //defined elsewhere\n    //...\n}\n</code></pre>\n\n<p>During each iteration, the value of variable <code>user</code> is overwritten, but since variable <code>user</code> is defined outside the loop, address to variable <code>user</code> (i.e. <code>&amp;user</code>) will remain the same. As a result, the elements in <code>result</code> slice will be the same, i.e. <strong>address to single <code>user</code> variable</strong>, in which its value is captured from last record. Change the <code>append</code> statement to:</p>\n\n<pre><code>//result = append(result, &amp;user)\nu := user\nresult = append(result, &amp;u)\n</code></pre>\n\n<p>A minimum example to demonstrate the issue can be found at <a href=\"https://play.golang.org/p/xikBYQMHZE\" rel=\"nofollow noreferrer\">The Go Playground</a>.</p>\n"}], "owner": {"reputation": 673, "user_id": 363042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d158e0063c0d368abbca8e7f99a153af?s=128&d=identicon&r=PG", "display_name": "Brent", "link": "https://stackoverflow.com/users/363042/brent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 860, "favorite_count": 0, "accepted_answer_id": 46656573, "answer_count": 2, "score": 1, "last_activity_date": 1507592501, "creation_date": 1507578176, "last_edit_date": 1507582801, "question_id": 46653880, "link": "https://stackoverflow.com/questions/46653880/resetting-pointers-in-loops", "title": "Resetting pointers in loops", "body": "<p>This question betrays my basic lack of understanding of Golang pointers (or any pointer, really), so please bear with me. I've also put a similar, working example on Go Playground if it's helpful:</p>\n\n<p><a href=\"https://play.golang.org/p/Xe-ZRdFWGp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Xe-ZRdFWGp</a></p>\n\n<p>Suppose that I have a basic parent/child relationship with two structs:</p>\n\n<pre><code>//Parent\ntype User struct{\n     ID int\n     Rsvps []*Rsvp\n}   \n\n//Child\ntype Rsvp struct{\n   Response string\n}\n</code></pre>\n\n<p>At some point, a bunch of users and RSVPs is created, and the information stored in a database. At some point, it will come time to extract information from that database and write it back into these structs. When using a relational database, I'll typically try to do it with a single query, in a pattern I've been using for many years, but which may not be the right way any more. I'll to set up a loop to extract the data. Here's some pseudocode with many comments:</p>\n\n<pre><code>func getUsersAndRsvps() []*User{\n\n    sql := \"SELECT * FROM users LEFT JOIN rsvps ON users.field1 = rsvps.field1 ORDER BY user.ID;\"\n\n    dataset := getDataset(sql)\n\n    result = []*User{}\n\n    rsvps = []*Rsvp{}\n    //Oh, but you already see the problem here, don't you! I'm defining\n    //rsvps outside of the loop, and the values contained at its address\n    //will become values for all users, instead of per user. Yet, how\n    //else can I collect together rsvps while iterating?\n\n    user = User{} //hold onto a user while iterating\n\n    lastUserID := int64(0) //track when we move from one user to the next\n\n    for _, record := range dataset{\n\n         thisUserID := record.ID\n\n         //When this user is different from last user\n         //take the collected rsvps and write them into \n         //the (old) user, then continue iterating...\n\n         if lastUserID != thisUserID &amp;&amp; lastUserID &gt; 0{\n\n             //So, right here is the big problem. I'm writing\n             //the address of collected rsvps into the previous user record. \n             //However, on each iteration, that address gets all\n             //new info, such that at the end of the readout,\n             //all users have the same rsvps.\n             user.Rsvps = rsvps\n\n             result = append(result, &amp;user)\n\n             //So, yes, I \"blank out\" the rsvps, but that only goes \n             //to make the last user's rsvps be those shared among all\n             rsvps = []*Rsvp{} \n         }\n\n         //Gather rsvps\n         rsvp = getRsvp(rsvp) //defined elsewhere\n         rsvps = append(rsvps, &amp;rsvp)\n\n         user = getUser(record) //defined elsewhere\n\n         lastUserID := thisUserID\n    }\n\n    //Capture last record\n    user.Rsvps = rsvps\n    result = append(result, &amp;user)\n\n}\n</code></pre>\n\n<p>To make the question succinct and hopefully clear, how do I iterate through a dataset, collecting items into a slice, and then write that slice into a unique memory point such that the next set of iterations won't overwrite it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1507571443, "post_id": 46652216, "comment_id": 80253427, "body": "Use the first example; it makes the reader think less. Reevaluate if/when you have data of that being a bottleneck in your application."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507571652, "post_id": 46652216, "comment_id": 80253544, "body": "Your second example is incorrect, as it&#39;s going to return a slice with a length of <code>2*b</code> (even after you add the missing <code>...</code>). Probably a great example of why trying to write it in as little code as possible may make it harder to understand or lead to needless bugs."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1507571818, "post_id": 46652216, "comment_id": 80253624, "body": "Your second example does not compile, and it will do the wrong thing when the &quot;...&quot; is added to fix the compilation error."}, {"owner": {"reputation": 789, "user_id": 4926126, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/48vo2.jpg?s=128&g=1", "display_name": "jiaweizhang", "link": "https://stackoverflow.com/users/4926126/jiaweizhang"}, "edited": false, "score": 0, "creation_date": 1507572971, "post_id": 46652216, "comment_id": 80254249, "body": "Makes me wonder why it was even mentioned... Figured there was no more efficient way than the simple copy they provided."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1507573104, "post_id": 46652216, "comment_id": 80254331, "body": "@jiaweizhang: it&#39;s mentioned simply because it&#39;s possible. &quot;Abusing&quot; <code>append</code> in this manner isn&#39;t uncommon, but it&#39;s often surprising to see something like <code>return append([]byte(nil), b...)</code>, and you have to stop and think a second what that does. I&#39;d rather just have it spelled out in code, especially since they <i>should</i> compile to the same thing."}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507595621, "post_id": 46652216, "comment_id": 80262910, "body": "@JimB and what  about <code>b = digitRegexp.Find(b)</code> and then <code>return b</code>? I would expect that bytes cutted of will be released to garbage collector.."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 1, "creation_date": 1507596328, "post_id": 46652216, "comment_id": 80263069, "body": "@bigless: No, the entire point of this exercise was to demonstrate how to allow the original slice to be garbage collected. There are no bytes &quot;cut off&quot;; <code>b</code> is a sub-slice of the full slice returned by <code>ReadFile</code> and points at the same backing array."}], "owner": {"reputation": 789, "user_id": 4926126, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/48vo2.jpg?s=128&g=1", "display_name": "jiaweizhang", "link": "https://stackoverflow.com/users/4926126/jiaweizhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1507572922, "creation_date": 1507571330, "last_edit_date": 1507572922, "question_id": 46652216, "link": "https://stackoverflow.com/questions/46652216/most-concise-way-to-copy-portion-of-large-slice", "title": "Most concise way to copy portion of large slice", "body": "<p>I was reading <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">this</a> blog article (last section on \"A possible gotcha\"), which discusses how to copy a part of a large slice into a new smaller slice so the large slice can be garbage collected. </p>\n\n<p>The code they provide is:</p>\n\n<pre><code>func CopyDigits(filename string) []byte {\n    b, _ := ioutil.ReadFile(filename)\n    b = digitRegexp.Find(b)\n    c := make([]byte, len(b))\n    copy(c, b)\n    return c\n}\n</code></pre>\n\n<p>The article suggests that there is a more concise way this function can be constructed using an <code>append</code>. I'm assuming something like this, but I don't see the point of doing it this way:</p>\n\n<pre><code>func CopyDigits(filename string) []byte {\n    b, _ := ioutil.ReadFile(filename)\n    b = digitRegexp.Find(b)\n    return append(make([]byte, len(b)), b...)\n}\n</code></pre>\n\n<p>This would also make the code less efficient since it appears that <code>append</code> is implemented using <code>copy</code>. Since this copying into a new slice is a fairly common operation, what's the best way to do it?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1507568519, "post_id": 46651435, "comment_id": 80252037, "body": "You&#39;re not handling errors, you&#39;re just printing them out."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1507568718, "post_id": 46651435, "comment_id": 80252113, "body": "<code>http.ListenAndServe</code> blocks. None of the code afterwards actually runs."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1507568999, "post_id": 46651435, "comment_id": 80252221, "body": "Also, in some cases <code>http.ListenAndServe</code> can return an error. You should check for that. But JimB is correct, you are printing errors, but not handling them properly. My guess is that something returns <code>nil, error</code>, and you print the error and then blithely assume that the data value (which is nil) is good anyway. Without seeing more of your program&#39;s output we can&#39;t really say for sure."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1507570066, "post_id": 46651435, "comment_id": 80252735, "body": "The stack trace shows the line number where the panic happened. Look for a line in <code>Group</code>. That will probably point to the problem."}, {"owner": {"reputation": 23, "user_id": 8350355, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-A4z1scxNCG0/AAAAAAAAAAI/AAAAAAAAAYk/Na1axHyXRFA/photo.jpg?sz=128", "display_name": "Behrooz Ahadian", "link": "https://stackoverflow.com/users/8350355/behrooz-ahadian"}, "edited": false, "score": 0, "creation_date": 1507576329, "post_id": 46651435, "comment_id": 80256099, "body": "I tried to print out the errors to see if any thing appears in out put instead of panic. The http.ListenAndServe works fine, I tested it without using database related codes and also the query works fine if i put it in main function. I think the error comes from sharing db *sql.DB ..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507581810, "post_id": 46651435, "comment_id": 80258636, "body": "@BehroozAhadian: no, Peter&#39;s comment describe the problem precisely. If <code>ListenAndServe</code> didn&#39;t block your problem would just exit, and you can&#39;t initialize <code>db</code> if you don&#39;t execute that code. Your program will still likely crash later however unless you start handling the errors too."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1507585227, "post_id": 46651435, "comment_id": 80259910, "body": "Somehow I missed that the DB wasn&#39;t initalized until after the call to <code>ListenAndServe</code>... Oops. The error handling issues will certainly come back go bite you later though, exactly as described in my earlier comment."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 8350355, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-A4z1scxNCG0/AAAAAAAAAAI/AAAAAAAAAYk/Na1axHyXRFA/photo.jpg?sz=128", "display_name": "Behrooz Ahadian", "link": "https://stackoverflow.com/users/8350355/behrooz-ahadian"}, "edited": false, "score": 0, "creation_date": 1507618756, "post_id": 46655175, "comment_id": 80269269, "body": "Thank you every one, your answers gave me insight. Finally I replaced the http.ListenAndServe to the bottom of the code to escape the block."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 2, "last_activity_date": 1507584088, "creation_date": 1507584088, "answer_id": 46655175, "question_id": 46651435, "link": "https://stackoverflow.com/questions/46651435/invalid-memory-address-or-nil-pointer-dereference-golang-database/46655175#46655175", "title": "invalid memory address or nil pointer dereference golang database", "body": "<p>So the crash is caused by the db pointer being nil. This means code which tries to use that connection on line 40 causes a panic. </p>\n\n<pre><code>rows, errrows := db.Query(...\n</code></pre>\n\n<p>The db pointer is nil because, as Peter pointed out, http.ListenAndServe is blocking, which means <strong>nothing</strong> after it will run.  </p>\n\n<p>Try running this example locally to see the problem:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n)\n\nfunc Group(res http.ResponseWriter, req *http.Request) {\n    println(\"group handler\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/group/\", Group)\n    err := http.ListenAndServe(\":9001\", nil)\n    if err != nil {\n      panic(err)\n    }\n    println(\"Running code after ListenAndServe (only happens when server shuts down)\")\n}\n</code></pre>\n\n<p>You won't see the Running code message.</p>\n"}], "owner": {"reputation": 23, "user_id": 8350355, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-A4z1scxNCG0/AAAAAAAAAAI/AAAAAAAAAYk/Na1axHyXRFA/photo.jpg?sz=128", "display_name": "Behrooz Ahadian", "link": "https://stackoverflow.com/users/8350355/behrooz-ahadian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6227, "favorite_count": 0, "accepted_answer_id": 46655175, "answer_count": 1, "score": -3, "last_activity_date": 1507584088, "creation_date": 1507568175, "last_edit_date": 1507576934, "question_id": 46651435, "link": "https://stackoverflow.com/questions/46651435/invalid-memory-address-or-nil-pointer-dereference-golang-database", "title": "invalid memory address or nil pointer dereference golang database", "body": "<p>I searched a lot to find solution for this error, but nothing worked. when I use the query inside main function it works fine, but when I pass it to the Group function it panics. here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n    \"strconv\"\n    \"strings\"\n)\n\nvar db *sql.DB\nvar err error\n\ntype Row struct {\n    Id         int\n    Title      string `json:\"title,omitempty\"`\n    Adress     string `json:\"adress,omitempty\"`\n    Tozihat    string `json:\"tozihat,omitempty\"`\n    Mobile     string `json:\"mobile,omitempty\"`\n    Phone      string `json:\"phone,omitempty\"`\n    Mapid      string `json:\"mapid,omitempty\"`\n    Location   string `json:\"location,omitempty\"`\n    Keywords   string `json:\"keyword,omitempty\"`\n    Imagepath1 string `json:\"imagepath1,omitempty\"`\n    Imagepath2 string `json:\"imagepath2,omitempty\"`\n    Category   string `json:\"category,omitempty\"`\n    Catid      int    `json:\"catid,omitempty\"`\n}\n\nfunc Group(res http.ResponseWriter, req *http.Request) {\n    u := req.URL.RequestURI()\n    Id := strings.Split(u, \"/\")[2]\n    catId, errconv := strconv.Atoi(Id)\n    if errconv != nil {\n            fmt.Println(errconv)\n    }\n    rows, errrows := db.Query(\"select title, location, category from Total where catID=(?)\", catId)\n    if errrows != nil {\n            fmt.Println(errrows)\n\n    }\n\n    defer rows.Close()\n    var results []Row\n    var result Row\n\n    for rows.Next() {\n\n            errr := rows.Scan(&amp;result.Title, &amp;result.Location, &amp;result.Category)\n            if errr != nil {\n                    fmt.Println(errr)\n\n            }\n\n            results = append(results, result)\n    }\n    fmt.Println(results)\n    jsonresults, errj := json.Marshal(results)\n    if errj != nil {\n            fmt.Print(\"error marshaling results\", errj)\n    }\n    res.Header().Set(\"Content-Type\", \"application/json\")\n\n    res.Write(jsonresults)\n\n}\n\nfunc main() {\n    http.HandleFunc(\"/group/\", Group)\n\n    http.ListenAndServe(\":9001\", nil)\n\n    db, err = sql.Open(\"mysql\", \"root:456852@/bartarinha\")\n    if err != nil {\n            fmt.Println(err)\n    }\n    defer db.Close()\n    errPing := db.Ping()\n    if errPing != nil {\n            fmt.Println(errPing)\n    }\n}\n</code></pre>\n\n<p>any help is appreciated. the error looks like this: \n    2017/10/09 22:43:44 http: panic serving [::1]:41618: runtime error: \n    invalid memory address or nil pointer dereference\n    goroutine 7 [running]:\n    net/http.(*conn).serve.func1(0xc420088820)\n        /usr/local/go/src/net/http/server.go:1721 +0xd0</p>\n\n<pre><code>panic(0x688060, 0x81fc40)\n    /usr/local/go/src/runtime/panic.go:489 +0x2cf\ndatabase/sql.(*DB).conn(0x0, 0x7fe580, 0xc4200102b0, 0x1, 0x6dac6a, \n0xd10000000000000e, 0xe)\n    /usr/local/go/src/database/sql/sql.go:896 +0x3a\ndatabase/sql.(*DB).query(0x0, 0x7fe580, 0xc4200102b0, 0x6e7aff, 0x3b,                 \n0xc420047aa8, 0x1, 0x1, 0x1, 0xc42002cc00, ...)\n    /usr/local/go/src/database/sql/sql.go:1245 +0x5b\ndatabase/sql.(*DB).QueryContext(0x0, 0x7fe580, 0xc4200102b0, 0x6e7aff, \n0x3b, 0xc420047aa8, 0x1, 0x1, 0xc4200e01a0, 0xc42003ca40, ...)\n    /usr/local/go/src/database/sql/sql.go:1227 +0xb8\ndatabase/sql.(*DB).Query(0x0, 0x6e7aff, 0x3b, 0xc42003caa8, 0x1, 0x1, \n0x8, 0xc4200d8038, 0xc420016e40)\n    /usr/local/go/src/database/sql/sql.go:1241 +0x82\nmain.Group(0x7fe080, 0xc4200f82a0, 0xc42000a900)\n    /home/behrooz/gp_projects/src/samples/kabootar/main.go:40 +0x230\nnet/http.HandlerFunc.ServeHTTP(0x6e9d38, 0x7fe080, 0xc4200f82a0, \n0xc42000a900)\n    /usr/local/go/src/net/http/server.go:1942 +0x44\nnet/http.(*ServeMux).ServeHTTP(0x8293c0, 0x7fe080, 0xc4200f82a0, \n0xc42000a900)\n    /usr/local/go/src/net/http/server.go:2238 +0x130\nnet/http.serverHandler.ServeHTTP(0xc4200942c0, 0x7fe080, 0xc4200f82a0, \n0xc42000a900)\n    /usr/local/go/src/net/http/server.go:2568 +0x92\nnet/http.(*conn).serve(0xc420088820, 0x7fe540, 0xc420014940)\n    /usr/local/go/src/net/http/server.go:1825 +0x612\ncreated by net/http.(*Server).Serve\n    /usr/local/go/src/net/http/server.go:2668 +0x2ce\n</code></pre>\n"}, {"tags": ["regex", "go", "regex-group"], "comments": [{"owner": {"reputation": 109, "user_id": 6303169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ef5f622f9906108bbc136d53da0b14e1?s=128&d=identicon&r=PG&f=1", "display_name": "V. Korovin", "link": "https://stackoverflow.com/users/6303169/v-korovin"}, "reply_to_user": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1507569342, "post_id": 46651391, "comment_id": 80252375, "body": "@akond yes, this is exactly what i need! Thank you."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "edited": false, "score": 1, "creation_date": 1507569642, "post_id": 46651739, "comment_id": 80252531, "body": "Any way to do this without matching empty string ?"}, {"owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1507569782, "post_id": 46651739, "comment_id": 80252587, "body": "It is easier to check for an empty string in a separate condition."}], "tags": [], "owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "is_accepted": true, "score": 1, "last_activity_date": 1507569369, "creation_date": 1507569369, "answer_id": 46651739, "question_id": 46651391, "link": "https://stackoverflow.com/questions/46651391/exclude-symbol-from-capturing-and-get-only-required-data/46651739#46651739", "title": "Exclude symbol from capturing and get only required data?", "body": "<p>Try:</p>\n\n<pre><code>(?:(?P&lt;days&gt;\\d+) d.)?\\s*(?:(?P&lt;hours&gt;\\d+) h.)?\\s*(?:(?P&lt;minutes&gt;\\d+) m.)?\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5979, "user_id": 8534588, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/63d016df9eac3cc0a70b1fb1683dc62b?s=128&d=identicon&r=PG&f=1", "display_name": "Josh Withee", "link": "https://stackoverflow.com/users/8534588/josh-withee"}, "is_accepted": false, "score": 0, "last_activity_date": 1507572560, "creation_date": 1507572560, "answer_id": 46652537, "question_id": 46651391, "link": "https://stackoverflow.com/questions/46651391/exclude-symbol-from-capturing-and-get-only-required-data/46652537#46652537", "title": "Exclude symbol from capturing and get only required data?", "body": "<p>akond's solution works if you are ok with matching empty string. Adding a positive lookahead at the beginning will prevent matching empty string:</p>\n\n<pre><code>(?=\\d+\\s[dhm]\\.)(?:(?P&lt;days&gt;\\d+) d.)?\\s*(?:(?P&lt;hours&gt;\\d+) h.)?\\s*(?:(?P&lt;minutes&gt;\\d+) m.)?\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 6303169, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/ef5f622f9906108bbc136d53da0b14e1?s=128&d=identicon&r=PG&f=1", "display_name": "V. Korovin", "link": "https://stackoverflow.com/users/6303169/v-korovin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 46651739, "answer_count": 2, "score": 0, "last_activity_date": 1507572560, "creation_date": 1507567991, "question_id": 46651391, "link": "https://stackoverflow.com/questions/46651391/exclude-symbol-from-capturing-and-get-only-required-data", "title": "Exclude symbol from capturing and get only required data?", "body": "<p>I have text with days, hours, minutes, in following format:</p>\n\n<pre><code>4 d. 12 h. 32 m.\n7 h. 22 m.\n3 d. 14 h.\n</code></pre>\n\n<p>Notice, that some of them may be apsent (e.g.: <code>3 d. 14 h.</code> doesnt contains minutes)</p>\n\n<p>I want to capture digit in named groups, but do not capture the characters (d. h. m.). So finally i need to get result something like this map:</p>\n\n<pre><code>[\n    'days' =&gt; 4,\n    'hours' =&gt; 12,\n    'minutes' =&gt; 32,\n]\n</code></pre>\n\n<p>This what i wrote: <code>(?P&lt;days&gt;(\\d+) d.)?(?P&lt;hours&gt;(\\d+) h.)?(?P&lt;minutes&gt;(\\d+) m.)?</code></p>\n\n<p>Link: <a href=\"https://regex101.com/r/FERRnd/1\" rel=\"nofollow noreferrer\">https://regex101.com/r/FERRnd/1</a></p>\n\n<p>But it seems that there is some empty elements, and i have feeling that this is not best regular expression for this task. Is there any way to recieve only named params as digits and nothing else (no empty fields, no text like <code>12 h.</code> etc.)?</p>\n\n<p>Many thanks!</p>\n"}, {"tags": ["go", "ffmpeg", "google-cloud-platform", "google-speech-api"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1508087661, "post_id": 46650835, "comment_id": 80460737, "body": "This is a totaly random though, but have you tried running it with the race detector? It probably won&#39;t show anything, but you never know..."}, {"owner": {"reputation": 3270, "user_id": 862410, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9945fb55767debfe2e7a4267a2e16bdc?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/862410/josh"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508148553, "post_id": 46650835, "comment_id": 80480750, "body": "@MiloChristiansen good call! There is a race condition. I tried to create a thread-safe version of <code>bufio.Writer</code> but the library uses <code>ReadFrom</code> which continuously reads from the reader. It only releases the lock when everything has been read :-/"}], "answers": [{"tags": [], "owner": {"reputation": 3270, "user_id": 862410, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9945fb55767debfe2e7a4267a2e16bdc?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/862410/josh"}, "is_accepted": true, "score": 7, "last_activity_date": 1508170547, "creation_date": 1508170547, "answer_id": 46774717, "question_id": 46650835, "link": "https://stackoverflow.com/questions/46650835/google-speech-streaming-request-returns-eof-error/46774717#46774717", "title": "Google Speech - Streaming Request Returns EOF Error", "body": "<p>So, it turns out there's a way of getting more information about the status of the stream, so we don't just have to rely on the returned error.</p>\n\n<pre><code>if err := stream.Send(&amp;speechpb.StreamingRecognizeRequest{\n    StreamingRequest: &amp;speechpb.StreamingRecognizeRequest_AudioContent{\n        AudioContent: data,\n    },\n}); err != nil {\n    resp, err := stream.Recv()\n    log.Printf(\"Could not send audio: %v\", resp.GetError())\n}\n</code></pre>\n\n<p>This prints:</p>\n\n<pre><code>2017/10/16 17:14:53 Could not send audio: code:3 message:\"Invalid audio content: too long.\"\n</code></pre>\n\n<p>Which is a far more helpful error message!</p>\n"}], "owner": {"reputation": 3270, "user_id": 862410, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9945fb55767debfe2e7a4267a2e16bdc?s=128&d=identicon&r=PG", "display_name": "Josh", "link": "https://stackoverflow.com/users/862410/josh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 390, "favorite_count": 2, "accepted_answer_id": 46774717, "answer_count": 1, "score": 8, "last_activity_date": 1508170547, "creation_date": 1507565824, "last_edit_date": 1507625159, "question_id": 46650835, "link": "https://stackoverflow.com/questions/46650835/google-speech-streaming-request-returns-eof-error", "title": "Google Speech - Streaming Request Returns EOF Error", "body": "<p>Using Go, I'm taking a RTMP stream, transcoding it to FLAC (using ffmpeg) and attempting to stream to Google's Speech API to transcribe the audio. However, I keep getting <code>EOF</code> errors when sending the data. I can't find any information on this error in the docs so I'm not exactly sure what's causing it.</p>\n\n<p>I'm chunking the received data into 3s clips (length isn't relevant as long as it's less than the maximum length of a streaming recognition request).</p>\n\n<p>Here is the core of my code:</p>\n\n<pre><code>func main() {\n\n    done := make(chan os.Signal)\n    received := make(chan []byte)\n\n    go receive(received)\n    go transcribe(received)\n\n    signal.Notify(done, os.Interrupt, syscall.SIGTERM)\n\n    select {\n    case &lt;-done:\n        os.Exit(0)\n    }\n}\n\nfunc receive(received chan&lt;- []byte) {\n    var b bytes.Buffer\n    stdout := bufio.NewWriter(&amp;b)\n\n    cmd := exec.Command(\"ffmpeg\", \"-i\", \"rtmp://127.0.0.1:1935/live/key\", \"-f\", \"flac\", \"-ar\", \"16000\", \"-\")\n    cmd.Stdout = stdout\n\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    duration, _ := time.ParseDuration(\"3s\")\n    ticker := time.NewTicker(duration)\n\n    for {\n        select {\n        case &lt;-ticker.C:\n            stdout.Flush()\n            log.Printf(\"Received %d bytes\", b.Len())\n            received &lt;- b.Bytes()\n            b.Reset()\n        }\n    }\n}\n\nfunc transcribe(received &lt;-chan []byte) {\n    ctx := context.TODO()\n\n    client, err := speech.NewClient(ctx)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    stream, err := client.StreamingRecognize(ctx)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Send the initial configuration message.\n    if err = stream.Send(&amp;speechpb.StreamingRecognizeRequest{\n        StreamingRequest: &amp;speechpb.StreamingRecognizeRequest_StreamingConfig{\n            StreamingConfig: &amp;speechpb.StreamingRecognitionConfig{\n                Config: &amp;speechpb.RecognitionConfig{\n                    Encoding:        speechpb.RecognitionConfig_FLAC,\n                    LanguageCode:    \"en-GB\",\n                    SampleRateHertz: 16000,\n                },\n            },\n        },\n    }); err != nil {\n        log.Fatal(err)\n    }\n\n    for {\n        select {\n        case data := &lt;-received:\n            if len(data) &gt; 0 {\n                log.Printf(\"Sending %d bytes\", len(data))\n                if err := stream.Send(&amp;speechpb.StreamingRecognizeRequest{\n                    StreamingRequest: &amp;speechpb.StreamingRecognizeRequest_AudioContent{\n                        AudioContent: data,\n                    },\n                }); err != nil {\n                    log.Printf(\"Could not send audio: %v\", err)\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Running this code gives this output:</p>\n\n<pre><code>2017/10/09 16:05:00 Received 191704 bytes\n2017/10/09 16:05:00 Saving 191704 bytes\n2017/10/09 16:05:00 Sending 191704 bytes\n2017/10/09 16:05:00 Could not send audio: EOF\n\n2017/10/09 16:05:03 Received 193192 bytes\n2017/10/09 16:05:03 Saving 193192 bytes\n2017/10/09 16:05:03 Sending 193192 bytes\n2017/10/09 16:05:03 Could not send audio: EOF\n\n2017/10/09 16:05:06 Received 193188 bytes\n2017/10/09 16:05:06 Saving 193188 bytes\n2017/10/09 16:05:06 Sending 193188 bytes // Notice that this doesn't error\n\n2017/10/09 16:05:09 Received 191704 bytes\n2017/10/09 16:05:09 Saving 191704 bytes\n2017/10/09 16:05:09 Sending 191704 bytes\n2017/10/09 16:05:09 Could not send audio: EOF\n</code></pre>\n\n<p>Notice that not all of the <code>Send</code>s fail. </p>\n\n<p>Could anyone point me in the right direction here? Is it something to do with the FLAC headers or something? I also wonder if maybe resetting the buffer causes some of the data to be dropped (i.e. it's a non-trivial operation that actually takes some time to complete) and it doesn't like this missing information?</p>\n\n<p>Any help would be really appreciated. </p>\n"}, {"tags": ["facebook", "facebook-graph-api", "go"], "answers": [{"comments": [{"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1507557314, "post_id": 46648068, "comment_id": 80245474, "body": "My $GOPATH is set to $HOME/go and $GOROOT is set to /usr/lib/go-1.6 and it works well for other packages."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 1, "creation_date": 1507557400, "post_id": 46648068, "comment_id": 80245530, "body": "@Amandeepkaur: go1.6 is out of date. Update your go version, and do not set GOROOT."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1741222"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507561161, "post_id": 46648068, "comment_id": 80247935, "body": "Agreed with @JimB, your <code>$GOROOT</code> looks suspicious. <a href=\"https://stackoverflow.com/questions/7970390/what-should-be-the-values-of-gopath-and-goroot#10847122\">Look at this answer.</a>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1741222"}, "is_accepted": false, "score": 0, "last_activity_date": 1507556901, "creation_date": 1507556901, "answer_id": 46648068, "question_id": 46647895, "link": "https://stackoverflow.com/questions/46647895/golang-facebook-package-error/46648068#46648068", "title": "Golang Facebook Package Error", "body": "<p>Ensure that your Go environment is setup correctly, especially your <code>$GOPATH</code> and <code>$GOROOT</code>.</p>\n\n<p><a href=\"https://golang.org/doc/code.html#GOPATH\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html#GOPATH</a></p>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 102, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1507556901, "creation_date": 1507556346, "question_id": 46647895, "link": "https://stackoverflow.com/questions/46647895/golang-facebook-package-error", "title": "Golang Facebook Package Error", "body": "<p>I am trying to get friendlist from Facebook Messenger in golang using REST API. For this, I tried to import package <code>github.com/huandu/facebook</code>. But while running the code it gave an error: </p>\n\n<p><code>package context: unrecognized import path \"context\" (import path does not begin with hostname)\n</code></p>\n\n<p>Here is the import statement (as mentioned in godoc <a href=\"https://godoc.org/github.com/huandu/facebook\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/huandu/facebook</a>):</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"github.com/huandu/facebook\"\n)\n</code></pre>\n\n<p>Can anyone tell me what I am doing Wrong ?</p>\n"}, {"tags": ["go", "microservices", "prometheus", "exporter"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1507564924, "post_id": 46647028, "comment_id": 80250195, "body": "Yes, you should implement a collector for the /service endpoint (your program assumes the role of an exporter for the API). First, check if one is already available at <a href=\"https://prometheus.io/docs/instrumenting/exporters/\" rel=\"nofollow noreferrer\">prometheus.io/docs/instrumenting/exporters</a>. Then read <a href=\"https://prometheus.io/docs/instrumenting/writing_exporters/\" rel=\"nofollow noreferrer\">prometheus.io/docs/instrumenting/writing_exporters</a>."}, {"owner": {"reputation": 45, "user_id": 6450189, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GIOPe.jpg?s=128&g=1", "display_name": "iwilltry42", "link": "https://stackoverflow.com/users/6450189/iwilltry42"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507623203, "post_id": 46647028, "comment_id": 80271886, "body": "Thanks @Peter , that&#39;s all I wanted to know... even though I hoped there was a different possibility without writing additional code... :D"}], "answers": [{"tags": [], "owner": {"reputation": 46, "user_id": 838381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/295cb24f5cb82f60936cd5b14962a96f?s=128&d=identicon&r=PG", "display_name": "Xiaojie Fan", "link": "https://stackoverflow.com/users/838381/xiaojie-fan"}, "is_accepted": true, "score": 2, "last_activity_date": 1552455458, "creation_date": 1552455458, "answer_id": 55135076, "question_id": 46647028, "link": "https://stackoverflow.com/questions/46647028/multiple-endpoints-for-prometheus-in-go/55135076#55135076", "title": "Multiple Endpoints for Prometheus in Go", "body": "<p>You can use <code>prometheus.NewRegistry</code> to create a custom collector, and expose it to some endpoint you want by using <code>promhttp.HandlerFor</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var (\n        // custom collector\n        reg = prometheus.NewRegistry()\n        // some metrics\n        myGauge = prometheus.NewGaugeVec(\n                prometheus.GaugeOpts{\n                        Name: \"gauge_name\",\n                        Help: \"guage_help\",\n                },\n                []string{\"l\"},\n        )\n)\n\nfunc init() {\n        // register metrics to my collector\n        reg.MustRegister(myGauge)\n}\n\nfunc main() {\n        // instrument\n        myGauge.WithLabelValues(\"l\").Set(123)\n\n        // expose endpoint\n        http.Handle(\"/service\", promhttp.HandlerFor(reg, promhttp.HandlerOpts{}))\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 6450189, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GIOPe.jpg?s=128&g=1", "display_name": "iwilltry42", "link": "https://stackoverflow.com/users/6450189/iwilltry42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1190, "favorite_count": 0, "accepted_answer_id": 55135076, "answer_count": 1, "score": 1, "last_activity_date": 1552455458, "creation_date": 1507553700, "last_edit_date": 1507623240, "question_id": 46647028, "link": "https://stackoverflow.com/questions/46647028/multiple-endpoints-for-prometheus-in-go", "title": "Multiple Endpoints for Prometheus in Go", "body": "<p>I'm currently working on a program written in <code>Go (golang)</code> that is monitored by Prometheus.</p>\n\n<p>Now the program should serve two endpoints <code>/metrics</code> and <code>/service</code>.\nWhen scraped by Prometheus on <code>/metrics</code>, it should expose it's own metrics (e.g. requests made, request latency, ...) and when scraped on <code>/service</code>, it should query an API, get metrics from there and expose them to Prometheus.</p>\n\n<p>For the first part I create e.g. a Counter via </p>\n\n<pre><code>requestCount := kitprometheus.NewCounterFrom(stdprometheus.CounterOpts{\n    Namespace: \"SERVICE\",\n    Subsystem: \"service_metrics\",\n    Name:      \"request_count\",\n    Help:      \"Number of requests received.\",\n}, fieldKeys)\n</code></pre>\n\n<p>and serve the stuff via:</p>\n\n<pre><code>http.Handle(\"/metrics\", promhttp.Handler())\nhttp.ListenAndServe(\":8090\", nil)\n</code></pre>\n\n<p>for the <code>/service</code> part, I query the API, extract a value and update a different Gauge via <code>Gauge.Set(value)</code></p>\n\n<ul>\n<li>How do I expose this last Gauge on the different endpoint without\nfiring up another server (different port)?</li>\n<li>Do I have to create my own Collector (I have no custom metrics, so\nno, right?)?</li>\n</ul>\n"}, {"tags": ["linux", "go", "dll", "system-calls"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 2, "creation_date": 1507554118, "post_id": 46646826, "comment_id": 80243205, "body": "You cannot use DLLs on Linux, they are Windows only. You could use Wine instead, it emulates Windows and can run code written for Windows."}], "answers": [{"tags": [], "owner": {"reputation": 152, "user_id": 8656476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/945b1c30e3fef71ac52c1748e94a8555?s=128&d=identicon&r=PG", "display_name": "Quirinux", "link": "https://stackoverflow.com/users/8656476/quirinux"}, "is_accepted": false, "score": 0, "last_activity_date": 1507559479, "creation_date": 1507559479, "answer_id": 46648891, "question_id": 46646826, "link": "https://stackoverflow.com/questions/46646826/golang-load-windows-dll-in-linux/46648891#46648891", "title": "Golang, load Windows DLL in Linux", "body": "<p>I'm afraid not because the windows DLLs do different kernel calls than Linux shared object, both has this fancy name for system library objects</p>\n\n<p>But if you need to run a windows native app on linux I would recommend give Wine a try, I doubt it works properly, and a second worthy try is dosbox, once I doubt this works too</p>\n\n<p>But there is a little hope if those DLLs are written in .net framework, you could wrap them up on a nice c# code and use mono on linux side, not sure if this enables you to import those DLLs to golang, but I don't think so either </p>\n\n<p>In the and with that amount of tricks to have everything working you will get some performance issues, just saying </p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 3, "last_activity_date": 1546936681, "last_edit_date": 1546936681, "creation_date": 1507559761, "answer_id": 46648962, "question_id": 46646826, "link": "https://stackoverflow.com/questions/46646826/golang-load-windows-dll-in-linux/46648962#46648962", "title": "Golang, load Windows DLL in Linux", "body": "<p>The short answer is \"no\": when you \"load\" a dynamic-linked library, it's not only actually loaded (as in read from the file) but <em>linked into</em> the address space of your running program \u2014 by the special means provided by the OS (on Linux-based systems, at least on x86/amd64 platforms that's an external process; on Windows, it's an in-kernel facility, AFAIK).\nIn other words, loading a dynamic-linked library involves quite a lot of complexity happening behind your back.</p>\n\n<p>Another complication, is whether the DLL is \"self-contained\" in the sense it only contains \"pure\" functions \u2014 which only perform computations on their input data to provide their output data, \u2014 or they call out to the operating system to perform activities such as I/O on files.\nThe way operating systems provide ways to do these kinds of activities to the running processes are drastically different between Windows and Linux.</p>\n\n<p>The last complication I can think of is dependency of this library on others.\nIf the library's code is written in C or C++, it quite likely depends on the C library used by the compiler which compiled the library (on Windows, it's typically that <code>MSVCRxx.DLL</code> thing). (A simple example is calling <code>malloc()</code> or <code>printf()</code> or something like this in a library's code.)</p>\n\n<p>All this means that most of a DLL written on Windows for Windows depends both on Windows and the C or C++ standard library associated with the compiler used to build that library.</p>\n\n<p>That's not to mention that Windows DLL uses PE (Portable Executable) format for its modules while GNU/Linux-based systems natively use the ELF format for its shared object files.</p>\n"}], "owner": {"reputation": 53, "user_id": 8713562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db8cb7224289f3519097ba6a820723f0?s=128&d=identicon&r=PG&f=1", "display_name": "Daniyar Baitursynov", "link": "https://stackoverflow.com/users/8713562/daniyar-baitursynov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1050, "favorite_count": 0, "accepted_answer_id": 46648962, "answer_count": 2, "score": -1, "last_activity_date": 1546936681, "creation_date": 1507553122, "question_id": 46646826, "link": "https://stackoverflow.com/questions/46646826/golang-load-windows-dll-in-linux", "title": "Golang, load Windows DLL in Linux", "body": "<p>Our vendor provides DLL, which works on Windows. Is this possible to load custom <strong>xxx.dll</strong> file and use its functions in <strong>Linux</strong> using Go?</p>\n\n<p>Like this: <a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/WindowsDLLs</a></p>\n"}, {"tags": ["go", "gopath"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 8, "creation_date": 1507552462, "post_id": 46646559, "comment_id": 80242107, "body": "What your book is probably describing is the tree of the GOPATH directory."}, {"owner": {"reputation": 246, "user_id": 2006577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VwtY6.jpg?s=128&g=1", "display_name": "goosman.lei", "link": "https://stackoverflow.com/users/2006577/goosman-lei"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1507552860, "post_id": 46646559, "comment_id": 80242354, "body": "Thank you very much, I&#39;m foolish"}, {"owner": {"user_type": "does_not_exist", "display_name": "user3845133"}, "edited": false, "score": 0, "creation_date": 1516995746, "post_id": 46646559, "comment_id": 83930518, "body": "Probably late but another great example for go project boilerplate is qiangxue&#39;s starter kit - <a href=\"https://github.com/qiangxue/golang-restful-starter-kit\" rel=\"nofollow noreferrer\">github.com/qiangxue/golang-restful-starter-kit</a>"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507557922, "post_id": 46646960, "comment_id": 80245862, "body": "bin and pkg should be in the root of <code>GOPATH</code>, they shouldn&#39;t be in the project directory at all, just like src."}, {"owner": {"reputation": 71, "user_id": 7821513, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lV1RW.jpg?s=128&g=1", "display_name": "Compree", "link": "https://stackoverflow.com/users/7821513/compree"}, "edited": false, "score": 0, "creation_date": 1594303184, "post_id": 46646960, "comment_id": 111083905, "body": "The golang standards <code>golang-standards&#47;project-layout</code> on <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">github</a> agrees on the <code>src</code> directory."}, {"owner": {"reputation": 720, "user_id": 3431636, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/x1Vlv.jpg?s=128&g=1", "display_name": "Seraf", "link": "https://stackoverflow.com/users/3431636/seraf"}, "reply_to_user": {"reputation": 71, "user_id": 7821513, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lV1RW.jpg?s=128&g=1", "display_name": "Compree", "link": "https://stackoverflow.com/users/7821513/compree"}, "edited": false, "score": 0, "creation_date": 1619006528, "post_id": 46646960, "comment_id": 118773523, "body": "@Compree You mean disagrees? There&#39;s an explicit section named <a href=\"https://github.com/golang-standards/project-layout#directories-you-shouldnt-have\" rel=\"nofollow noreferrer\">Directories You Shouldn&#39;t Have</a> which includes <code>&#47;src</code>"}], "tags": [], "owner": {"reputation": 1649, "user_id": 1011824, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/0OcmR.jpg?s=128&g=1", "display_name": "Frozendragon", "link": "https://stackoverflow.com/users/1011824/frozendragon"}, "is_accepted": false, "score": 1, "last_activity_date": 1507553516, "creation_date": 1507553516, "answer_id": 46646960, "question_id": 46646559, "link": "https://stackoverflow.com/questions/46646559/golang-project-directory-structure/46646960#46646960", "title": "Golang project directory structure", "body": "<p>The src directory is not needed and in fact a lot of public repositories do not use this structure.</p>\n\n<p>There is a few different way of organizing your project. If you plan on having your project used by an other repository, like lib. I would recommend using a cmd struct something like this. This would also be the recommended way of doing it if there would be more then one way of starting the application. (multipliable main.go files)</p>\n\n<pre><code>\u251c\u2500\u2500cmd/\n|  \u251c\u2500\u2500(application name)\n|  |  \u251c\u2500\u2500main.go\n\u2514\u2500\u2500say/\n   \u251c\u2500\u2500say.go\n   \u2514\u2500\u2500say_test.go\n</code></pre>\n\n<p>Otherwise for example if it is a standalone application. You can place the main.go in the root of the repository.</p>\n\n<p>bin and pkg you can keep in the root and add this to .gitignore. (assuming you are using git)</p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1507565603, "creation_date": 1507565603, "answer_id": 46650781, "question_id": 46646559, "link": "https://stackoverflow.com/questions/46646559/golang-project-directory-structure/46650781#46650781", "title": "Golang project directory structure", "body": "<p>The book describes the directory structure after checkout. It would have been helpful if the book included the .git directory. </p>\n\n<p>$GOPATH/src is required for imports to work.</p>\n\n<pre><code>    \u251c\u2500\u2500src/\n    |  \u251c\u2500\u2500.git\n    |  |  \u251c\u2500\u2500...\n    |  \u251c\u2500\u2500main.go\n    |  \u251c\u2500\u2500say/\n    |  |  \u251c\u2500\u2500say.go\n    |  |  \u251c\u2500\u2500say_test.go\n    \u251c\u2500\u2500bin/\n    |  \u251c\u2500\u2500say\n    \u2514\u2500\u2500pkg/\n       \u2514\u2500\u2500linux_amd64/\n          \u2514\u2500\u2500say.a\n</code></pre>\n\n<p>In practice, main.go would actually be in a path that reflects the remote git repository, for instance</p>\n\n<pre><code>.   \n\u251c\u2500\u2500 bin\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 say\n\u251c\u2500\u2500 pkg\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 linux_amd64\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 github.com\n\u2502\u00a0\u00a0      \u00a0\u00a0 \u2514\u2500\u2500 pschultz\n\u2502\u00a0\u00a0      \u00a0\u00a0     \u2514\u2500\u2500 hello-world\n\u2502\u00a0\u00a0                 \u2514\u2500\u2500 say.a\n\u2514\u2500\u2500 src\n \u00a0\u00a0 \u2514\u2500\u2500 github.com\n \u00a0\u00a0     \u2514\u2500\u2500 pschultz\n \u00a0\u00a0         \u2514\u2500\u2500 hello-world\n \u00a0\u00a0             \u251c\u2500\u2500 .git\n \u00a0\u00a0             \u2502   \u2514\u2500\u2500 ...\n \u00a0\u00a0             \u251c\u2500\u2500 main.go\n \u00a0\u00a0             \u2514\u2500\u2500 say\n \u00a0\u00a0                 \u251c\u2500\u2500 say.go\n \u00a0\u00a0                 \u2514\u2500\u2500 say_test.go\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "is_accepted": false, "score": 18, "last_activity_date": 1523934861, "last_edit_date": 1523934861, "creation_date": 1507628459, "answer_id": 46663495, "question_id": 46646559, "link": "https://stackoverflow.com/questions/46646559/golang-project-directory-structure/46663495#46663495", "title": "Golang project directory structure", "body": "<p><a href=\"https://medium.com/@benbjohnson/structuring-applications-in-go-3b04be4ff091\" rel=\"noreferrer\">This</a> article by <em>Ben Johnson</em> have guided me on this when I was starting with Go.</p>\n\n<p>It's generally good to start with something like this (assuming you are inside your project directory like <code>$GOPATH/src/myproject</code>:</p>\n\n<pre><code>\u251c\u2500\u2500cmd/ -- this is where you compose several packages in to main package\n|  \u251c\u2500\u2500foo -- an example would be `foo`\n|  |  \u251c\u2500\u2500main.go\n\u251c\u2500\u2500pkg/ -- this is where put your reusable packages \n|  \u251c\u2500\u2500pkg1 -- reusable package 1\n|  \u251c\u2500\u2500pkg2 -- reusable package 2\n\u251c\u2500\u2500otherpackage1\n|  \u251c\u2500\u2500 ...\n\u251c\u2500\u2500otherpackage2\n|  \u251c\u2500\u2500 ...\n</code></pre>\n\n<p>You can have a look at <a href=\"https://github.com/go-kit/kit/tree/master/examples/addsvc\" rel=\"noreferrer\">this</a> example from <a href=\"https://github.com/go-kit/kit\" rel=\"noreferrer\"><code>go-kit</code></a> for this kind of project structure.</p>\n\n<p>Sometimes it will depend on your needs. On our workflow, we are using a hot code reload tool called <a href=\"https://github.com/pilu/fresh\" rel=\"noreferrer\">fresh</a>, so we needed to put the <code>main.go</code> on the project root so that the tool can detect all the file changes and rebuild the source code.</p>\n\n<pre><code>\u251c\u2500\u2500app/\n|  \u251c\u2500\u2500app.go\n\u251c\u2500\u2500model/ -- \n|  \u251c\u2500\u2500model.go\n\u251c\u2500\u2500store\n|  \u251c\u2500\u2500store.go\n\u251c\u2500\u2500main.go -- this is where the app starts\n\u251c\u2500\u2500...\n</code></pre>\n\n<p>On the <code>app.go</code> package, I have something like <code>func Run() error</code> which starts the application. On the <code>main.go</code>, I am just calling the function:</p>\n\n<pre><code>...\nfunc main(){\n    log.Fatal(app.Run())\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 384, "user_id": 5282647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/440bcd6dd3218f85f2619d31b5e549eb?s=128&d=identicon&r=PG&f=1", "display_name": "The Ancient", "link": "https://stackoverflow.com/users/5282647/the-ancient"}, "edited": false, "score": 3, "creation_date": 1538645067, "post_id": 49732445, "comment_id": 92218743, "body": "Although the repo contains a couple of interesting points, it seems to be <i>not</i> an official guidance by golang. In other words, it is just &quot;yet another&quot; opinion on the topic, so I would not position it as a &quot;new way&quot; as &quot;new way&quot; sounds like an ultimate guidance that overrules existing ones."}], "tags": [], "owner": {"reputation": 6515, "user_id": 3034932, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/d8ZYg.jpg?s=128&g=1", "display_name": "Radonirina Maminiaina", "link": "https://stackoverflow.com/users/3034932/radonirina-maminiaina"}, "is_accepted": false, "score": 6, "last_activity_date": 1523275148, "creation_date": 1523275148, "answer_id": 49732445, "question_id": 46646559, "link": "https://stackoverflow.com/questions/46646559/golang-project-directory-structure/49732445#49732445", "title": "Golang project directory structure", "body": "<p>Now there are <a href=\"https://github.com/golang-standards/project-layout\" rel=\"noreferrer\">new way</a> to organized golang project.\nInto the github for <a href=\"https://github.com/golang-standards/project-layout\" rel=\"noreferrer\">golang-standards</a>, it is said:</p>\n\n<blockquote>\n  <p>This is a basic layout for Go application projects. It represents the\n  most common directory structure with a number of small enhancements\n  along with several supporting directories common to any real world\n  application.</p>\n  \n  <p>This project layout is intentionally generic and it doesn't try to\n  impose a specific Go package structure.</p>\n</blockquote>\n\n<p>Or you can follow this <a href=\"https://talks.golang.org/2014/organizeio.slide#9\" rel=\"noreferrer\">slides</a>:</p>\n\n<pre><code>$GOPATH/\n    src/\n        github.com/user/repo/\n            mypkg/\n                mysrc1.go\n                mysrc2.go\n            cmd/mycmd/\n                main.go\n    bin/\n        mycmd\n</code></pre>\n"}], "owner": {"reputation": 246, "user_id": 2006577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VwtY6.jpg?s=128&g=1", "display_name": "goosman.lei", "link": "https://stackoverflow.com/users/2006577/goosman-lei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17062, "favorite_count": 7, "answer_count": 4, "score": 16, "last_activity_date": 1523934861, "creation_date": 1507552364, "last_edit_date": 1507631984, "question_id": 46646559, "link": "https://stackoverflow.com/questions/46646559/golang-project-directory-structure", "title": "Golang project directory structure", "body": "<p>I have some confusion regarding Golang directory structure.</p>\n\n<p>Base on the book called &lt;The way to go&gt;, project code should be placed into <code>src</code>, and recommends the following directory structure.</p>\n\n<pre><code>    \u251c\u2500\u2500src/\n    |  \u251c\u2500\u2500main.go\n    |  \u251c\u2500\u2500say/\n    |  |  \u251c\u2500\u2500say.go\n    |  |  \u251c\u2500\u2500say_test.go\n    \u251c\u2500\u2500bin/\n    |  \u251c\u2500\u2500say\n    \u2514\u2500\u2500pkg/\n       \u2514\u2500\u2500linux_amd64/\n          \u2514\u2500\u2500say.a\n</code></pre>\n\n<p>but I found that many packages in <code>github.com</code>, have no <code>src</code> directory.</p>\n\n<p>For example:</p>\n\n<p><a href=\"https://github.com/facebookgo/grace\" rel=\"noreferrer\">https://github.com/facebookgo/grace</a></p>\n\n<p><a href=\"https://github.com/astaxie/beego\" rel=\"noreferrer\">https://github.com/astaxie/beego</a></p>\n\n<p>So, I don't know whether <code>src</code> directory is needed.</p>\n\n<p>I have some project, their have inter-dependency.\nThey are managed in a private GitLab repository.</p>\n\n<p>How can I organized them?</p>\n"}, {"tags": ["go", "stream", "deadlock", "bytestream"], "answers": [{"comments": [{"owner": {"reputation": 3773, "user_id": 5232122, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/87ae151f27d7e84ac4f08d35f12a9d67?s=128&d=identicon&r=PG&f=1", "display_name": "Velidan", "link": "https://stackoverflow.com/users/5232122/velidan"}, "edited": false, "score": 0, "creation_date": 1507626844, "post_id": 46646064, "comment_id": 80274080, "body": "Thank you for your answer!"}], "tags": [], "owner": {"reputation": 355, "user_id": 1283658, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3bc0d9019c71a5620e823caaee1edbb0?s=128&d=identicon&r=PG", "display_name": "P.An", "link": "https://stackoverflow.com/users/1283658/p-an"}, "is_accepted": false, "score": 0, "last_activity_date": 1507551052, "last_edit_date": 1507551052, "creation_date": 1507550782, "answer_id": 46646064, "question_id": 46645981, "link": "https://stackoverflow.com/questions/46645981/a-basic-golang-streamchannel-deadlock/46646064#46646064", "title": "A basic Golang stream(channel) deadlock", "body": "<blockquote>\n  <p>1 - why this code shows 1 and 2 at the new line ?</p>\n</blockquote>\n\n<p>Answer: because you use Println() method. If you want them on one line use Print()</p>\n\n<blockquote>\n  <p>2 I have tried to play with this code to understand how it works and I have removed the byte rande and I have got the deadlock error. Why it happens?</p>\n</blockquote>\n\n<p>As far as the code shows, you are never firing up a concurrent reader for the channel you create. Because it is unbuffered, any writes to it, will block until someone, somewhere reads from the other end.</p>\n"}, {"comments": [{"owner": {"reputation": 3773, "user_id": 5232122, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/87ae151f27d7e84ac4f08d35f12a9d67?s=128&d=identicon&r=PG&f=1", "display_name": "Velidan", "link": "https://stackoverflow.com/users/5232122/velidan"}, "edited": false, "score": 0, "creation_date": 1507626878, "post_id": 46653154, "comment_id": 80274106, "body": "Thank you for your answer! It helped me a lot"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1507575064, "creation_date": 1507575064, "answer_id": 46653154, "question_id": 46645981, "link": "https://stackoverflow.com/questions/46645981/a-basic-golang-streamchannel-deadlock/46653154#46653154", "title": "A basic Golang stream(channel) deadlock", "body": "<p>Because channel operator <code>&lt;-</code> takes only 1 element from the channel. If you want them printed together try: <code>fmt.Println(\"%v%v\", &lt;-c, &lt;-c)\"</code></p>\n\n<p>Last number in channel creation <code>make(chan int, 2)</code> means channel buffer - its capacity to store items. So you can easily push 2 items to channel. But what happens if you try to push one more item? The operation would be blocked because there's no space until another goroutine will read from the channel and free space. </p>\n\n<p>The same applies to all channels - unbuffeted ones get blocked at first element writing. Until some goroutine reads from the channel. </p>\n\n<p>Because there's no goroutine to read, writing one locks forever. You may solve it starting a reading goroutine before. </p>\n\n<pre><code> c := make(chan int)\ngo func () {\n    fmt.Println(&lt;-c)\n    fmt.Println(&lt;-c)\n}()\nch &lt;- 1\nch &lt;- 2\n</code></pre>\n\n<p>This way would not get locked but start transmitting items.  </p>\n"}], "owner": {"reputation": 3773, "user_id": 5232122, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/87ae151f27d7e84ac4f08d35f12a9d67?s=128&d=identicon&r=PG&f=1", "display_name": "Velidan", "link": "https://stackoverflow.com/users/5232122/velidan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 46653154, "answer_count": 2, "score": 0, "last_activity_date": 1507575064, "creation_date": 1507550495, "last_edit_date": 1507555682, "question_id": 46645981, "link": "https://stackoverflow.com/questions/46645981/a-basic-golang-streamchannel-deadlock", "title": "A basic Golang stream(channel) deadlock", "body": "<p>I am trying to work with go streams and I have a few \"stupid\" question.</p>\n\n<p>I have done a primitive stream example with the byte limit range and here is the working code and here are my questions.</p>\n\n<p>1 - why this code shows 1 and 2 at the new line? Why doesn't it show 12 at the one? Does the first peace of bytes removed from the byte-limited stream? (But how we can push the 2 number into the stream when we have already pushed the 1 number?) I just can't understand it</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    ch := make(chan int, 2)\n    ch &lt;- 1\n    ch &lt;- 2\n    fmt.Println(&lt;-ch)\n    fmt.Println(&lt;-ch)\n}\nIt shows:\n1\n2\n</code></pre>\n\n<p>2 question - I have tried to play with this code to understand how it works and I have removed the byte range and I have got the deadlock error. Why does it happen? Thanks!</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\nmain.main()\n    /tmp/sandbox557775903/main.go:7 +0x60\n</code></pre>\n\n<p>The deadlock error code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    ch := make(chan int)\n    ch &lt;- 1\n    ch &lt;- 2\n    fmt.Println(&lt;-ch)\n    fmt.Println(&lt;-ch)\n}\n</code></pre>\n\n<p>Thanks for any help! Sorry for the primitive questions.</p>\n"}, {"tags": ["go", "tcp", "keep-alive"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507554587, "post_id": 46645173, "comment_id": 80243540, "body": "If the request has timed out, it means it hasn&#39;t &quot;completed&quot; in some sense, so it&#39;s in an undefined state. You can&#39;t reuse that."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1507558341, "post_id": 46645173, "comment_id": 80246132, "body": "You also need to ensure you&#39;re reading the entire response body if you want the connection to be reused. In your code, any non-200 response code will result in the response body not being read, so the connection will not be reused."}, {"owner": {"reputation": 826, "user_id": 173136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34ce173f5cb8f6a8415e2b63d02ea2e2?s=128&d=identicon&r=PG", "display_name": "Aman", "link": "https://stackoverflow.com/users/173136/aman"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507644301, "post_id": 46645173, "comment_id": 80286011, "body": "@Adrian In my current understanding defer response.Body.Close() should read response body as well and discard it. Let me know if its not correct with any reference."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1507645012, "post_id": 46645173, "comment_id": 80286506, "body": "<code>Close</code> closes the stream, it does not read any unread body content."}, {"owner": {"reputation": 826, "user_id": 173136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34ce173f5cb8f6a8415e2b63d02ea2e2?s=128&d=identicon&r=PG", "display_name": "Aman", "link": "https://stackoverflow.com/users/173136/aman"}, "edited": false, "score": 0, "creation_date": 1507817086, "post_id": 46645173, "comment_id": 80369725, "body": "I tried that as well but when observed in Wireshark Still RST is sent."}], "owner": {"reputation": 826, "user_id": 173136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34ce173f5cb8f6a8415e2b63d02ea2e2?s=128&d=identicon&r=PG", "display_name": "Aman", "link": "https://stackoverflow.com/users/173136/aman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1329, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1507550867, "creation_date": 1507547875, "last_edit_date": 1507550867, "question_id": 46645173, "link": "https://stackoverflow.com/questions/46645173/reusing-keep-alive-connection-in-case-of-timeout-in-golang", "title": "Reusing Keep-Alive Connection in case of Timeout in Golang", "body": "<pre><code>/* Keep Alive Client*/\nHttpClient{\n        Client: &amp;http.Client{\n            Transport: &amp;http.Transport{\n                Dial: (&amp;net.Dialer{\n                    Timeout:   dialTimeout,\n                    KeepAlive: dialTimeout * 60,\n                }).Dial,\n                DisableKeepAlives:   false,\n                MaxIdleConnsPerHost: idleConnectionsPerHost,\n            },\n        },\n        Timeout: 5 * time.Second,\n    }\n\n/* Execute Request */\n        timeoutContext, cancelFunction := context.WithTimeout(context.Background(), self.Timeout)\n\n            defer cancelFunction()\n            if response, err = self.Client.Do(request.WithContext(timeoutContext)); err == nil {\n                defer response.Body.Close()\n\n                /* Check If Request was Successful */\n                statusCode = response.StatusCode\n                if response.StatusCode == http.StatusOK {\n                    /* Read Body &amp; Decode if Response came &amp; unmarshal entity is supplied */\n                    if responseBytes, err = ioutil.ReadAll(response.Body); err == nil &amp;&amp; unmarshalledResponse != nil {\n                        //Process Response\n                    }\n                } else {\n                    err = errors.New(fmt.Sprintf(\"Non 200 Response. Status Code: %v\", response.StatusCode))\n                }\n            }\n</code></pre>\n\n<p>In Golang whenever a request times out in a Keep-Alive connection that connection is lost and is Reset. For the above code incase of timeout Seeing Packets in Wireshark reveals that RST is sent by the client hence connection is no longer reused.</p>\n\n<p>Event tried using Timeout of Httpclient rather than ContextWithTimeout but having similar findings where connection gets reset.</p>\n\n<p>Anyway we can retain established keep-alive connection even in case of a Timeout of request.</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507548848, "post_id": 46645172, "comment_id": 80239845, "body": "What the point if an array of <code>id</code> if you&#39;re using only first item? Why no add a method to <code>ExampleStruct</code> and fetch first item."}, {"owner": {"reputation": 443, "user_id": 5158845, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2eff4c21679d34a45c335d91940215c9?s=128&d=identicon&r=PG&f=1", "display_name": "gogofan", "link": "https://stackoverflow.com/users/5158845/gogofan"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507548968, "post_id": 46645172, "comment_id": 80239924, "body": "There&#39;s a possibility that there&#39;s more than one <code>id</code> that could be added from the API call. I just added one for brevity."}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507549103, "post_id": 46645172, "comment_id": 80240029, "body": "<b>more than one id that could be added</b> and then if you call  <code>ExampleStruct.Added</code> you still get the first item?"}, {"owner": {"reputation": 443, "user_id": 5158845, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2eff4c21679d34a45c335d91940215c9?s=128&d=identicon&r=PG&f=1", "display_name": "gogofan", "link": "https://stackoverflow.com/users/5158845/gogofan"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1507549393, "post_id": 46645172, "comment_id": 80240193, "body": "I have edited my question a little bit. If you see now, when I call <code>ExampleStruct.Added</code>, I should get a slice of strings in this format: <code>[&quot;1234ABCD&quot;, &quot;5678EFGH&quot;]</code>"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1507549638, "post_id": 46645172, "comment_id": 80240343, "body": "But <code>Added</code> is not a function, you cannot call it."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1507550191, "post_id": 46645172, "comment_id": 80240655, "body": "In my answer I have added a function <code>Added</code> that returns <code>[&quot;1234ABCD&quot;, &quot;5678EFGH&quot;]</code> from your example data. Hope this helps."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507608092, "post_id": 46645172, "comment_id": 80265561, "body": "you can use this <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a> just copy your JSON and it&#39;ll tell you the Go struct"}], "answers": [{"comments": [{"owner": {"reputation": 443, "user_id": 5158845, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2eff4c21679d34a45c335d91940215c9?s=128&d=identicon&r=PG&f=1", "display_name": "gogofan", "link": "https://stackoverflow.com/users/5158845/gogofan"}, "edited": false, "score": 0, "creation_date": 1507548580, "post_id": 46645262, "comment_id": 80239694, "body": "No I tried that but it doesn&#39;t work because <code>id</code> is contained in the object which is contained in an array, and the array is the value of the <code>add</code> key of the JSON object."}], "tags": [], "owner": {"reputation": 140, "user_id": 8717964, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2db4a437478d572e46f96e4b383b7a2c?s=128&d=identicon&r=PG&f=1", "display_name": "mangeshbhuskute", "link": "https://stackoverflow.com/users/8717964/mangeshbhuskute"}, "is_accepted": false, "score": 0, "last_activity_date": 1507548169, "creation_date": 1507548169, "answer_id": 46645262, "question_id": 46645172, "link": "https://stackoverflow.com/questions/46645172/json-tag-to-decode-into-a-struct-in-golang/46645262#46645262", "title": "JSON tag to decode into a struct in Golang", "body": "<p>have you tried to obtain its key by adding 'id', like this</p>\n\n<p>type ExampleStruct struct {\n    Added   []string <code>json:\"add.id\"</code>\n}</p>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 1, "last_activity_date": 1507550142, "last_edit_date": 1507550142, "creation_date": 1507549166, "answer_id": 46645552, "question_id": 46645172, "link": "https://stackoverflow.com/questions/46645172/json-tag-to-decode-into-a-struct-in-golang/46645552#46645552", "title": "JSON tag to decode into a struct in Golang", "body": "<p>Use a slice of maps instead of strings, as you have key-value pairs of strings.</p>\n\n<pre><code>    type ExampleStruct struct {\n        Added []map[string]string `json:\"add\"`\n    }\n</code></pre>\n\n<p>Here is a full example:</p>\n\n<pre><code>    package main\n\n    import (\n        \"bytes\"\n        \"encoding/json\"\n        \"fmt\"\n    )\n\n    func main() {\n        const code = `{\n    \"add\":[{\"id\": \"1234ABCD\"}]\n    }`\n        type ExampleStruct struct {\n            Added []map[string]string `json:\"add\"`\n        }\n        var data ExampleStruct\n        json.NewDecoder(bytes.NewReader([]byte(code))).Decode(&amp;data)\n        fmt.Println(data)\n    }\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>Since you want to have only the values of the maps, here is a complete example where <code>Added</code> is a function that can be called on the <code>ExampleStruct</code>. It assumes that each map only contains two strings (id and value):</p>\n\n<pre><code>    package main\n\n    import (\n        \"bytes\"\n        \"encoding/json\"\n        \"fmt\"\n    )\n\n    func main() {\n        const code = `{\n    \"add\":[{\"id\": \"1234ABCD\"}, {\"id\": \"5678EFGH\"}]\n    }`\n        var data ExampleStruct\n        json.NewDecoder(bytes.NewReader([]byte(code))).Decode(&amp;data)\n        fmt.Println(data)\n        fmt.Println(data.Added())\n    }\n\n    type ExampleStruct struct {\n        Add []map[string]string `json:\"add\"`\n    }\n\n    func (e ExampleStruct) Added() []string {\n        values := make([]string, len(e.Add))\n        for i := range e.Add {\n            for _, v := range e.Add[i] {\n                values[i] = v\n            }\n        }\n        return values\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 157, "user_id": 2853674, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001786755227/picture?type=large", "display_name": "Satyam Zode", "link": "https://stackoverflow.com/users/2853674/satyam-zode"}, "is_accepted": false, "score": 0, "last_activity_date": 1507570035, "creation_date": 1507570035, "answer_id": 46651911, "question_id": 46645172, "link": "https://stackoverflow.com/questions/46645172/json-tag-to-decode-into-a-struct-in-golang/46651911#46651911", "title": "JSON tag to decode into a struct in Golang", "body": "<p>You need to arrange your <code>json</code> such a way that elements of the struct should be accessible directly (without over-engineering it). </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype ExampleStruct struct {\n    Add []struct {\n        ID string `json:\"id\"`\n    } `json:\"add\"`\n}\n\nfunc main() {\n\n    const code = `{\n     \"add\":[{\"id\": \"1234ABCD\"}, {\"id\": \"5678EFGH\"}]\n    }`\n\n     var data ExampleStruct\n     json.NewDecoder(bytes.NewReader([]byte(code))).Decode(&amp;data)\n     fmt.Println(data)           //Get all ids: {[{1234ABCD} {5678EFGH}]}\n     fmt.Println(data.Add[0].ID) //Get 1st ID : 1234ABCD\n     fmt.Println(data.Add[1].ID) //Get 2nd ID ... and so on.: 5678EFGH\n}\n</code></pre>\n\n<p>You can find the code here <a href=\"https://play.golang.org/p/7tD4fLBewp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7tD4fLBewp</a> .</p>\n\n<p>If you have many <code>ids</code> in an array then you can also write a function to loop over the array i.e <code>data.Add</code>and get ids from that. </p>\n"}], "owner": {"reputation": 443, "user_id": 5158845, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/2eff4c21679d34a45c335d91940215c9?s=128&d=identicon&r=PG&f=1", "display_name": "gogofan", "link": "https://stackoverflow.com/users/5158845/gogofan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1555, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1507570035, "creation_date": 1507547858, "last_edit_date": 1507550194, "question_id": 46645172, "link": "https://stackoverflow.com/questions/46645172/json-tag-to-decode-into-a-struct-in-golang", "title": "JSON tag to decode into a struct in Golang", "body": "<p>I have a JSON like this: </p>\n\n<pre><code>{\n\"add\":[{\"id\": \"1234ABCD\"}, {\"id\": \"5678EFGH\"}]\n}\n</code></pre>\n\n<p>And I have a struct like this: </p>\n\n<pre><code>type ExampleStruct struct {\n    Added   []string\n}\n</code></pre>\n\n<p>I am wondering what JSON tag I should put in my struct so that after I do the JSON decoding (code not shown here) and then call <code>exampleStruct := &amp;ExampleStruct</code> followed by <code>exampleStruct.Added</code>, how can I get <code>[\"1234ABCD\", \"5678EFGH\"]</code>?</p>\n\n<p>I tried doing this:</p>\n\n<pre><code>type ExampleStruct struct {\n    Added   []string `json:\"add\"`\n}\n</code></pre>\n\n<p>But it didn't work.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1507547608, "post_id": 46645078, "comment_id": 80239092, "body": "Sounds like you&#39;re asking about the <a href=\"https://godoc.org/encoding/json#Marshal\" rel=\"nofollow noreferrer\"><code>omitempty</code> struct field tag</a>."}, {"owner": {"reputation": 57, "user_id": 1719754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/036e3b4937e546ef0e8b7e191dbf4cc0?s=128&d=identicon&r=PG", "display_name": "ycuk", "link": "https://stackoverflow.com/users/1719754/ycuk"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1507547840, "post_id": 46645078, "comment_id": 80239230, "body": "No no. I need to make sctruct object first and then do marshal."}, {"owner": {"reputation": 57, "user_id": 1719754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/036e3b4937e546ef0e8b7e191dbf4cc0?s=128&d=identicon&r=PG", "display_name": "ycuk", "link": "https://stackoverflow.com/users/1719754/ycuk"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1507548150, "post_id": 46645078, "comment_id": 80239398, "body": "Or I can change the omitempty (on/off) option programmatically?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1507548436, "post_id": 46645078, "comment_id": 80239600, "body": "Prepare your JSON object in a <code>map[string]interface{}</code> then: don&#39;t add map entries for items you don&#39;t want to appear in the marshaled JSON."}], "owner": {"reputation": 57, "user_id": 1719754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/036e3b4937e546ef0e8b7e191dbf4cc0?s=128&d=identicon&r=PG", "display_name": "ycuk", "link": "https://stackoverflow.com/users/1719754/ycuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 911, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1507547530, "creation_date": 1507547530, "question_id": 46645078, "link": "https://stackoverflow.com/questions/46645078/golang-optional-json-fields", "title": "Golang optional json fields", "body": "<p>In Python I do like this to make dict and return in json:</p>\n\n<pre><code>class Thing:\n    id = 1\n    name = 'name'\n    user = User()\n    obj = Obj()\n    upd = time\n    def to_dict(this, user=False, obj=False):\n        return {\n            'id': self.id,\n            'name': self.name,\n            'upd': self.upd.strftime('%Y-%m-%d %H:%M:%S'),\n            'user': self.user.to_dict() if opt else None,\n            'obj': self.obj.to_dict() if obj else None,\n        }\n</code></pre>\n\n<p>and then <code>json.dumps(thing.to_dict(**opts))</code>. <code>opts</code> goes from web request.\nOfcourse in real project the fields a lot more. And some fields should be either in dict or not.</p>\n\n<p>Is any solution to don't make different structs only for json response? Or add optional to <code>MarshalJSON()</code></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7660, "user_id": 2350684, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yuQa5.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2350684/oliver"}, "is_accepted": true, "score": 8, "last_activity_date": 1507547752, "creation_date": 1507547752, "answer_id": 46645145, "question_id": 46645061, "link": "https://stackoverflow.com/questions/46645061/go-undefined-function-in-same-package/46645145#46645145", "title": "Go: undefined function in same package", "body": "<p>When you run your program via <code>go run</code> you need to add all source files to the command.</p>\n\n<p>In your case, you only have <code>wattagebazooka.go</code> but are missing <code>router.go</code> and <code>handler.go</code>.</p>\n"}], "owner": {"reputation": 8343, "user_id": 1073606, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c59b51140566aaa3ce6c1de634cd9c4?s=128&d=identicon&r=PG", "display_name": "Thomas Schw&#228;rzl", "link": "https://stackoverflow.com/users/1073606/thomas-schw%c3%a4rzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4467, "favorite_count": 0, "closed_date": 1507547809, "accepted_answer_id": 46645145, "answer_count": 1, "score": 1, "last_activity_date": 1507547752, "creation_date": 1507547444, "question_id": 46645061, "link": "https://stackoverflow.com/questions/46645061/go-undefined-function-in-same-package", "closed_reason": "Duplicate", "title": "Go: undefined function in same package", "body": "<p>I've started Go and am trying to follow this <a href=\"https://www.activestate.com/blog/2017/04/creating-web-app-using-golang-gorilla-web-toolkit\" rel=\"nofollow noreferrer\">tutorial</a>. Everything builds correct but as I try to run it, I get the error that <code>makeRouter()</code> could not be found.</p>\n\n<p>I had a look at some other questions, <a href=\"https://stackoverflow.com/questions/25171409/function-in-same-package-undefined\">like this one</a>, and checked the docs, but I couldn't find out whats wrong with my setup.</p>\n\n<h3>My folder structure:</h3>\n\n<pre><code>.../wattagebazooka/\n  |- wattagebazooka.go\n  |- router.go\n  |- handler.go\n</code></pre>\n\n<h3>Code</h3>\n\nwattagebazooka.go\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"runtime\"\n\n    _ \"github.com/lib/pq\"\n)\n\n// init sets runtime settings.\nfunc init() {\n    // Verbose logging with file name and line number\n    log.SetFlags(log.Lshortfile)\n\n    // Use all CPU cores\n    runtime.GOMAXPROCS(runtime.NumCPU())\n}\n\nvar db *sql.DB\n\nfunc main() {\n    db = openDB()\n    defer db.Close()\n\n    r := makeRouter()\n    http.Handle(\"/\", r)\n}\n\nfunc openDB() *sql.DB {\n    dbName := \"wattagebazooka\"\n\n    db, err := sql.Open(\"postgres\", fmt.Sprintf(\"user=ts password= dbname=%s host=127.0.0.1\", dbName))\n    if err != nil {\n        log.Fatalf(\"Error connecting to the %s database as user ts: %v\", dbName, err)\n    }\n\n    return db\n}\n</code></pre>\n\nrouter.go\n\n<pre><code>package main\n\nimport \"github.com/gorilla/mux\"\n\nfunc makeRouter() *mux.Router {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/user/me\", wrapHandler(userHandler)).Methods(\"GET\")\n    r.HandleFunc(\"/text\", wrapHandler(textHandler)).Methods(\"POST\")\n    r.HandleFunc(\"/text/{hash}\", wrapHandler(textHashHandler)).Methods(\"GET\")\n    return r\n}\n</code></pre>\n\n<h3>Build</h3>\n\n<pre><code>&gt; Environment:\n&gt;   GOROOT=/usr/local/go\n&gt;   GOPATH=/Users/ts/Developments/gocode\n&gt; Directory: /Users/ts/Developments/gocode/src/github.com/wattagebazooka/wattagebazooka\n&gt; Command: /usr/local/go/bin/go build -v\n&gt; Output:\ngithub.com/wattagebazooka/wattagebazooka\n&gt; Elapsed: 0.708s\n&gt; Result: Success\n</code></pre>\n\n<h3>Run</h3>\n\n<pre><code>&gt; Environment:\n&gt;   GOROOT=/usr/local/go\n&gt;   GOPATH=/Users/ts/Developments/gocode\n&gt; Directory: /Users/ts/Developments/gocode/src/github.com/wattagebazooka/wattagebazooka\n&gt; Command: /usr/local/go/bin/go run -v /Users/ts/Developments/gocode/src/github.com/wattagebazooka/wattagebazooka/wattagebazooka.go\n&gt; Output:\ncommand-line-arguments\n# command-line-arguments\n./wattagebazooka.go:28:7: undefined: makeRouter\n&gt; Elapsed: 0.244s\n&gt; Result: Error\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-ec2", "aws-sdk"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1507546745, "post_id": 46644745, "comment_id": 80238572, "body": "You can\u2019t handle SIGKILL."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1507558162, "creation_date": 1507558162, "answer_id": 46648472, "question_id": 46644745, "link": "https://stackoverflow.com/questions/46644745/golang-sigtem-sigkill-callback-not-getting-executed-on-stopping-ec2/46648472#46648472", "title": "Golang SIGTEM SIGKILL callback not getting executed on stopping EC2", "body": "<p>As JimB noted, and per <a href=\"https://golang.org/pkg/os/signal/\" rel=\"nofollow noreferrer\">the documentation</a>, you cannot handle SIGKILL or SIGSTOP. These are likely what is being sent at shutdown. If you're managing processes with something like init.d, you may be getting whatever your init.d script sends when it's called with <code>stop</code> (probably SIGTERM), which you may be able to catch, but you have very limited time between when that is called and when the machine shuts down completely. Any processing that takes more than a second or two is not likely to finish in time. If you want to make sure something is done before the machine shuts down, you should do it regularly rather than waiting to do it at shutdown time.</p>\n"}], "owner": {"reputation": 9, "user_id": 8101446, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e3def78c83701f1bc3dac82b5b6fdbe?s=128&d=identicon&r=PG&f=1", "display_name": "Gurleen Kaur", "link": "https://stackoverflow.com/users/8101446/gurleen-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 408, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507558857, "creation_date": 1507546454, "last_edit_date": 1507558857, "question_id": 46644745, "link": "https://stackoverflow.com/questions/46644745/golang-sigtem-sigkill-callback-not-getting-executed-on-stopping-ec2", "title": "Golang SIGTEM SIGKILL callback not getting executed on stopping EC2", "body": "<p>I have a program in golang in EC2.</p>\n\n<p>The requirements are to perform clean up on EC2 termination. I am trying to achieve this by the below code in which I have created a channel listening to os signals:</p>\n\n<pre><code>func InitTermination(){\n    signal.Notify(c, os.Interrupt, syscall.SIGTERM, syscall.SIGKILL) //listen to termination signals (ctrl+c)\n    go func() {\n        &lt;-c\n        log.Println(\"Calling uploadLogFiles on system/program termination\")\n        *termination = true\n        for {\n            if !(*lock) {\n                err := uploadCompletedLogs()\n                if err != nil {\n                    log.Fatalf(\"Error: %v\", err)\n                }\n                break\n            } else {\n                time.Sleep(100 * time.Millisecond)\n            }\n        }\n        if !(os.Getenv(\"TEST\") == \"true\") {\n            os.Exit(1)\n        }\n    }()\n}\n</code></pre>\n\n<p>On instance termination or stopping I want method <em>uploadCompletedLogs()</em> to be executed, which performs some cleanup, but  I am not able to achieve the desired behavior. </p>\n\n<p>Can some one guide me how can i achieve this?</p>\n"}, {"tags": ["sockets", "go", "tcp"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1507541396, "post_id": 46642990, "comment_id": 80235306, "body": "You are engaged in one infinite loop that accepts TCP connections, and you are expecting it to magically exit and fall into your second infinite loop that handles incoming UDP. It won&#39;t work. Unclear why you think it should."}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1507541402, "post_id": 46642990, "comment_id": 80235311, "body": "Typically binding two protocols into one port is not feasible in networking."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1507541608, "post_id": 46642990, "comment_id": 80235453, "body": "<code>I want to use UDP and TCP with each other.</code> no way. TCP does not communicate with UDP."}, {"owner": {"reputation": 71, "user_id": 1872206, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/jI298.jpg?s=128&g=1", "display_name": "Farzad Mohebbi", "link": "https://stackoverflow.com/users/1872206/farzad-mohebbi"}, "edited": false, "score": 0, "creation_date": 1507542251, "post_id": 46642990, "comment_id": 80235858, "body": "OK , IF I knew it, I wouldn&#39;t ask it. I use both TCP and UDP in node.js but in golang I&#39;m new"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1507542519, "post_id": 46642990, "comment_id": 80236027, "body": "@jeevatkm DNS is a rather prominent counter-example. TCP and UDP ports occupy distinct namespaces. There is no problem binding the same port to both protocols."}, {"owner": {"reputation": 71, "user_id": 1872206, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/jI298.jpg?s=128&g=1", "display_name": "Farzad Mohebbi", "link": "https://stackoverflow.com/users/1872206/farzad-mohebbi"}, "edited": false, "score": 0, "creation_date": 1507542717, "post_id": 46642990, "comment_id": 80236158, "body": "we can use the same port for UDP and TCP.UDP and TCP port are different in server side"}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1507543373, "post_id": 46642990, "comment_id": 80236565, "body": "@EJP yes you\u2019re right about DNS. Let me give it try. Thanks"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1507544048, "post_id": 46642990, "comment_id": 80236987, "body": "@jeevatkm DNS is merely a counterexample to your claim. What I&#39;m right about is TCP and UDP ports occupying different namespaces."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 2, "creation_date": 1507544712, "post_id": 46642990, "comment_id": 80237379, "body": "As pointed by @EJP, UDP related code is unreachable due to infinite loop. The simplest solution will be: move the TCP related code from <code>main</code> function to a new function (say <code>serveTCP</code>) then in <code>main</code> function, before UDP related codes,  use goroutine to start serving TCP i.e. <code>go serveTCP()</code>."}, {"owner": {"reputation": 71, "user_id": 1872206, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/jI298.jpg?s=128&g=1", "display_name": "Farzad Mohebbi", "link": "https://stackoverflow.com/users/1872206/farzad-mohebbi"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1507545487, "post_id": 46642990, "comment_id": 80237814, "body": "@putu thank you so much it&#39;s work"}], "answers": [{"tags": [], "owner": {"reputation": 152, "user_id": 8656476, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/945b1c30e3fef71ac52c1748e94a8555?s=128&d=identicon&r=PG", "display_name": "Quirinux", "link": "https://stackoverflow.com/users/8656476/quirinux"}, "is_accepted": false, "score": 1, "last_activity_date": 1543018325, "last_edit_date": 1543018325, "creation_date": 1507561936, "answer_id": 46649686, "question_id": 46642990, "link": "https://stackoverflow.com/questions/46642990/golang-udp-and-tcp-beside-each-other/46649686#46649686", "title": "Golang UDP and TCP beside each other", "body": "<p>As noted by putu you need some concurrency to get it working properly.</p>\n\n<p>NodeJS works with callbacks by default, which means that once you pass a function as a parameter to a function it will release the main loop to the next instruction. This is why NodeJS apps have the <code>object.method(function(){})</code> pattern. To achieve something similar to this in Go, you need to wrap the TCP and UDP portion of the program in a separate goroutine with a infinite loop each.</p>\n\n<p>For a simple proof the concept, do something like this:</p>\n\n<pre><code>...\ngo func(){\n  // paste your tcp code here \n}()\n...\ngo func(){\n  // paste your udp code here\n}()\n</code></pre>\n\n<p>That \"go\" instruction says to the compiler that a portion of code should run concurrently. In a real-world project, you will put that portion of code in a proper function and just call it by name from your main function:</p>\n\n<pre><code>...\ngo serveTCP();\ngo serve UDP();\n...\n</code></pre>\n\n<p>More about concurrency in go here => <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/1</a></p>\n"}], "owner": {"reputation": 71, "user_id": 1872206, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/jI298.jpg?s=128&g=1", "display_name": "Farzad Mohebbi", "link": "https://stackoverflow.com/users/1872206/farzad-mohebbi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 787, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1543018325, "creation_date": 1507540992, "last_edit_date": 1537026253, "question_id": 46642990, "link": "https://stackoverflow.com/questions/46642990/golang-udp-and-tcp-beside-each-other", "title": "Golang UDP and TCP beside each other", "body": "<p>is it possible to use TCP and UDP with each other in a single script? I need some of my packages to send and receive with TCP and some of them with UDP</p>\n\n<pre><code>func main() {\n\n//\n// \u2500\u2500\u2500 TCP \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n//\n\n// Listen for incoming connections.\nl, err := net.Listen(\"tcp\", \"localhost\"+\":\"+\"3000\")\nif err != nil {\n    fmt.Println(\"Error listening:\", err.Error())\n    os.Exit(1)\n}\n\n// Close the listener when the application closes.\ndefer l.Close()\nfmt.Println(\"Listening on \" + \"localhost\" + \":\" + \"3000\")\nfor {\n    // Listen for an incoming connection.\n    conn, err := l.Accept()\n    if err != nil {\n        fmt.Println(\"Error accepting: \", err.Error())\n        os.Exit(1)\n    }\n    // Handle connections in a new goroutine.\n    go gotcp.HandleRequest(conn)\n    //go handler(conn)\n}\n\n//\n// \u2500\u2500\u2500 UDP \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n//\n\n// then we should check which struct is empty and fill them\n\n/* Lets prepare a address at any address at port 10001*/\nServerAddr, err := net.ResolveUDPAddr(\"udp\", \":3000\")\ngoudp.CheckError(err)\n\n/* Now listen at selected port */\nServerConn, err := net.ListenUDP(\"udp\", ServerAddr)\ngoudp.CheckError(err)\ndefer ServerConn.Close()\n\nbuf := make([]byte, 1024)\n\nfor {\n    n, addr, err := ServerConn.ReadFromUDP(buf)\n    //fmt.Println(\"Received \", string(buf[0:n]), \" from \", addr)\n    if err != nil {\n        fmt.Println(\"Error: \", err)\n    }\n\n    // *** broadcasting\n    //start := time.Now()\n    if v, ok := goudp.RRoom()[djr]; ok {\n        //fmt.Println(\"get room name \", v)\n        go goudp.BroadCast(string(buf[0:n]), djr, ServerConn, v)\n        //delete(R, \"x\")\n        //go sendResponse(ServerConn, v.UserAddr1)\n    }\n    //elapsed := time.Since(start)\n    //log.Printf(\"Binomial took %s\", elapsed)\n}\n\n}\n</code></pre>\n\n<p><strong>EDIT:</strong>\nBy passing tcp part or udp part in a function and call it like go tcpServer() we can use Both UDP and TCP with each other</p>\n"}, {"tags": ["python", "go", "deferred"], "answers": [{"tags": [], "owner": {"reputation": 4294, "user_id": 804409, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/52840f12b18e63af6e43815f5c678075?s=128&d=identicon&r=PG", "display_name": "omu_negru", "link": "https://stackoverflow.com/users/804409/omu-negru"}, "is_accepted": false, "score": 2, "last_activity_date": 1507539197, "creation_date": 1507539197, "answer_id": 46642372, "question_id": 46642260, "link": "https://stackoverflow.com/questions/46642260/how-exactly-deferred-functions-are-useful-in-go-and-what-alternative-is-availabl/46642372#46642372", "title": "How exactly Deferred functions are useful in Go and what alternative is available in other languages?", "body": "<p><code>defer</code> as the name suggests, will delay execution of the deferred function until the calling function body exits, <strong>no matter the exit point and conditions</strong>. Thus , your function <code>f1</code> deffering <code>f2</code> will make sure that <code>f2</code> is called even if something inside <code>f1</code> fails with an exception. I think of it as the <code>finally</code> clause from a try/catch block. </p>\n\n<p>In python, the closest thing i can think of that's like <code>defer</code> are <a href=\"http://book.pythontips.com/en/latest/context_managers.html\" rel=\"nofollow noreferrer\">context managers</a> . Notice how i say closest and not identical, since their purposes overlap a bit , but only a bit</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1507541043, "last_edit_date": 1592644375, "creation_date": 1507539310, "answer_id": 46642414, "question_id": 46642260, "link": "https://stackoverflow.com/questions/46642260/how-exactly-deferred-functions-are-useful-in-go-and-what-alternative-is-availabl/46642414#46642414", "title": "How exactly Deferred functions are useful in Go and what alternative is available in other languages?", "body": "<p>Go's <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">defer statement</a> is just another approach, it has its pros and cons (not necessarily is the best). Other languages do offer alternatives to handle proper resource closes. For example Java offers Exceptions and <code>try-catch</code> blocks.</p>\n<p>Quoting from <a href=\"https://golang.org/doc/faq#exceptions\" rel=\"nofollow noreferrer\">Go FAQ: Why does Go not have exceptions?</a></p>\n<blockquote>\n<p>We believe that coupling exceptions to a control structure, as in the <code>try-catch-finally</code> idiom, results in convoluted code. It also tends to encourage programmers to label too many ordinary errors, such as failing to open a file, as exceptional.</p>\n<p>Go takes a different approach. For plain error handling, Go's multi-value returns make it easy to report an error without overloading the return value. <a href=\"https://golang.org/doc/articles/error_handling.html\" rel=\"nofollow noreferrer\">A canonical error type, coupled with Go's other features</a>, makes error handling pleasant but quite different from that in other languages.</p>\n<p>Go also has a couple of built-in functions to signal and recover from truly exceptional conditions. The recovery mechanism is executed only as part of a function's state being torn down after an error, which is sufficient to handle catastrophe but requires no extra control structures and, when used well, can result in clean error-handling code.</p>\n<p>See the <a href=\"https://golang.org/doc/articles/defer_panic_recover.html\" rel=\"nofollow noreferrer\">Defer, Panic, and Recover</a> article for details.</p>\n</blockquote>\n<p>The advantage of using <code>defer</code> compared to Java's <code>try-catch</code> for example is that the code  that handles the closing or disposing of an opened resource is <em>right next to the code that opened it</em>.</p>\n<p>For example:</p>\n<pre><code>f, err := os.Open(&quot;file.txt&quot;)\nif err != nil {\n    log.Printf(&quot;Failed to open file: %v&quot;, err)\n    return\n}\ndefer f.Close()\n\n// f is open you may read from it\n...\n</code></pre>\n<p>If other languages where disposing of resources is moved to another code block, it is harder to follow where and if you actually took care of disposing it.</p>\n"}, {"tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": false, "score": 1, "last_activity_date": 1507546326, "last_edit_date": 1507546326, "creation_date": 1507541884, "answer_id": 46643277, "question_id": 46642260, "link": "https://stackoverflow.com/questions/46642260/how-exactly-deferred-functions-are-useful-in-go-and-what-alternative-is-availabl/46643277#46643277", "title": "How exactly Deferred functions are useful in Go and what alternative is available in other languages?", "body": "<p>To understand defer, you need to understand the alternative.</p>\n\n<p>In complex code dealing with many resources you end up doing things like this (pseudo code):</p>\n\n<pre><code>mtx.Lock()\nfile1, err := os.Open(...)\nif err != nil {\n    mtx.Unlock()\n    return err\n}\nconn, err := net.Dial(...)\nif err != nil {\n    file1.Close()\n    mtx.Unlock()\n    return err\n}\nfile2, err := os.Open(...)\nif err != nil {\n    conn.Close()\n    file1.Close()\n    mtx.Unlock()\n    return err\n}\ndo_things()\nfile2.Close()\nconn.Close()\nfile1.Close()\nmtx.Unlock()\nreturn nil\n</code></pre>\n\n<p>This gets verbose fast. Also, it's error-prone in the long term since someone editing code and maybe moving the opening of the network connection to before opening file1 might not correctly update all the error handling paths.</p>\n\n<p>In C, a common idiom here is to collect all the cleanup of resources at the end of the function and do something like this:</p>\n\n<pre><code>    ret = ERROR;\n    lock(mtx);\n    fd1 = open(...);\n    if (fd1 == -1)\n        goto err1;\n    conn = net_conn(...);\n    if (conn == -1)\n        goto err2;\n    fd2 = open(...);\n    if (fd2 == -1)\n        goto err3;\n    do_things();\n\n    ret = 0;\n    close(fd2);\nerr3:\n    close(conn);\nerr2:\n    close(fd1);\nerr1:\n    unlock(mtx);\n    return ret;\n</code></pre>\n\n<p>This is not pretty either and it's quite easy to get this wrong too.</p>\n\n<p>As a comparison doing the same thing with defer we get:</p>\n\n<pre><code>mtx.Lock()\ndefer mtx.Unlock()\nfile1, err := os.Open(...)\nif err != nil {\n    return err\n}\ndefer file1.Close()\nconn, err := net.Dial(...)\nif err != nil {\n    return err\n}\ndefer conn.Close()\nfile2, err := os.Open(...)\nif err != nil {\n    return err\n}\ndefer file2.Close()\n.... do things ...\nreturn nil\n</code></pre>\n\n<p>It's clear, concise, anyone who knows Go will understand what happens and it's very hard to get wrong or break in the future.</p>\n"}], "owner": {"reputation": 11647, "user_id": 275002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/fe80cff5f1586741e1f03d02168d882f?s=128&d=identicon&r=PG", "display_name": "Volatil3", "link": "https://stackoverflow.com/users/275002/volatil3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1507546326, "creation_date": 1507538869, "last_edit_date": 1507539095, "question_id": 46642260, "link": "https://stackoverflow.com/questions/46642260/how-exactly-deferred-functions-are-useful-in-go-and-what-alternative-is-availabl", "title": "How exactly Deferred functions are useful in Go and what alternative is available in other languages?", "body": "<p>I know it's to deferred a process. I also read examples like it's good to use when dealing with File and other resources. My question is, is it something not being handled in other languages like Python etc? If yes how Go provides some distinctive feature?</p>\n\n<p>Say there are two functions <code>f1</code> and <code>f2</code> and I want to call <code>f2</code> when <code>f1</code> is done. I can do something like:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>def f1():\n  done = False\n  print('I am doing extensive work')\n  done = True\n  return done\n\ndef f2():\n  print('here we go')\n\nif f1():\n  f2()\n</code></pre>\n\n<p>Is defer doing same thing by minimizing coding efforts?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133, "user_id": 2904875, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Pfrxp.jpg?s=128&g=1", "display_name": "johnjerrico", "link": "https://stackoverflow.com/users/2904875/johnjerrico"}, "edited": false, "score": 0, "creation_date": 1507534202, "post_id": 46640714, "comment_id": 80231121, "body": "most of the optimization may not be required, however at our office, since we are handling lots of data; we use nosql to store various updates from various clients, then we do some sort of analytical with our data continue with some sort of summary with our data; thus we put a little concern on how client update, and more about what the update itself"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1507536413, "post_id": 46640714, "comment_id": 80232304, "body": "Define &quot;the same person&quot;."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1507536813, "post_id": 46640714, "comment_id": 80232512, "body": "@zerkms maybe &quot;same device&quot; is a better term. Should prevent a person from increasing the view counter by simply refreshing the page"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1507536907, "post_id": 46640714, "comment_id": 80232557, "body": "@fisker HTTP does not have a &quot;device&quot; notion. Just set a cookie with the last counted visit time."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1507537400, "post_id": 46640714, "comment_id": 80232806, "body": "@zerkms But I think comparing both IP and UserAgent will achieve same result. It may not be 100% accurate (and could potentially be abused by Tor users?) but I&#39;d like to think that it would have 99+% accuracy assuming the website target a similar user base as reddit/imgur/twitchtv/youtube/etc"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1507537673, "post_id": 46640714, "comment_id": 80232943, "body": "@fisker you need to remember IP and UserAgent server-side. And the cookie solution is entirely stateless. While provides the same (low) level of protection."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1507538034, "post_id": 46640714, "comment_id": 80233138, "body": "@zerkms but I think a cookie based solution can easily be abused compared to a server-side IP + UA solution. When I think cookie/localstorage based solution, then I think that if said cookie/localstorage entity doesn&#39;t exist, then it must be a new visitor. So what would prevent someone from simply deleting the cookie/localstorage entity and refresh the page? (I assume it&#39;s also possible to simply block a website from setting cookie/loclastorage)"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1507538122, "post_id": 46640714, "comment_id": 80233180, "body": "Any of those can easily be abused, I don&#39;t see the difference. But the cookie solution is much cheaper and easier to implement/maintain. Now consider whether you want to invest more to a solution that provides effectively the same low level of protection. I&#39;m not insisting, decide yourself."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507538680, "post_id": 46640714, "comment_id": 80233512, "body": "How would you abuse a server side solution that relied on <code>req.Header.Get(&quot;x-forwarded-for&quot;)</code> and <code>req.UserAgent()</code>? You may say by using Tor (which as far as I remember requires restarting the browser whenever you want a new IP, so very troublesome) but I guess could just ignore all visitors coming from Tor."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507566276, "post_id": 46640714, "comment_id": 80250935, "body": "The User-Agent is set by the client, so you cannot trust it. At all. <code>curl -H user-agent:whatever-I-want ...</code>. Some browser extensions randomize the User-Agent in an attempt to increase privacy. Btw, the mutex field should be a pointer (*sync.Mutex). Run go vet."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507572033, "post_id": 46640714, "comment_id": 80253747, "body": "@Peter I would say with UA solution then can compare the string with all popular browser UA strings (although I admit it might be a pain to always update such a package), but yeah, didn&#39;t really consider browser extensions randomizing the UA. Thanks for the <code>go vet</code> tip (not sure how I&#39;ve never heard about that before..), I can never seem to grasp pointers no matter how much I read about it :("}], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507543290, "post_id": 46641458, "comment_id": 80236512, "body": "Hmm, been reading a bit up on Bloom filters - it sounds quite complex. If I understand correctly, then the bloom filter would be part of the page struct? But the bloom filter needs to be initialized with N amount of items, where each item was a combined IP+UA string. But let&#39;s say I want to be very optimistic (to put it mildly) and assume one page may one day obtain 1 billion unique visitors. This means that every single page would have to be initialized with 1 billion items since it&#39;s impossible to increase it once it&#39;s first set?"}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507545548, "post_id": 46641458, "comment_id": 80237849, "body": "I&#39;ve been thinking some more, maybe one solution would be to have a bloom filters slice, where the initial item size was 1000, if it got filled up, then could append a new filter with a size of 50.000, then 100.000, etc. Not sure if that makes sense or if it&#39;s efficient/inefficient (or even possible).."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507545623, "post_id": 46641458, "comment_id": 80237896, "body": "Another option would perhaps be to simply delete and replace the bloomfilter when it reached 1000. That way it would still be possible for the same visitor to account for multiple views (which is not a bad thing), but he wouldn&#39;t be able to abuse it since it would require 999 other views before his new view would be counted."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507566180, "post_id": 46641458, "comment_id": 80250885, "body": "Bloom filter can be separate structure before the main one. There&#39;re several realisations on github thou I haven&#39;t look through them. One good feature of BF is its possibility to be tuned in terms of required memory - false positive probability - number of unique keys. Here&#39;s a calculator - <a href=\"https://hur.st/bloomfilter?n=1000000000&amp;p=0.01\" rel=\"nofollow noreferrer\">hur.st/bloomfilter?n=1000000000&amp;p=0.01</a> You need about 1.12GB space for 1B keys with false positive probability of 1%."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507566299, "post_id": 46641458, "comment_id": 80250943, "body": "You may have 3 filters keeping values for 3 last hours with shift 1 hour. So every time, you use first filter, but write to all 3. At the beginning of every hour you throw off fest filter and shift them 2-&gt;1, 3-&gt;2. Also you add one more clean filter for 3rd place."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507566369, "post_id": 46641458, "comment_id": 80250987, "body": "You allocate memory for the filter once on creation. Then it doesn&#39;t grow."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507566486, "post_id": 46641458, "comment_id": 80251041, "body": "Space requirements: 3x1.Gb ~ 4GB. Keeping on disk all keys will take 1B * sizeof (IP + UserAgent). I think this can help save memory."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 1, "creation_date": 1507566703, "post_id": 46641458, "comment_id": 80251170, "body": "Little easier idea: hash (ip+ua) then map take only last 30-bits and put data into 125M memory - just set corresponding bit. I have not tested this. I think this will give more false positive but will work faster and use less space."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507572313, "post_id": 46641458, "comment_id": 80253880, "body": "Thanks a lot, especially love the last tip. I think one thing to keep in mind is that each page should have their own bloom filter, so if 1B keys would require 1.12GB space then imagine if 1000 different pages had been visited within the last 2 hours (at least if I understand correctly, then what you propose would only allow one page count for the entire website rather than a single page of the website)"}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507572607, "post_id": 46641458, "comment_id": 80254051, "body": "I do think that for me, the ideal solution would be bloom filters with 1000 keys, and whenever all keys were used up then could reset the bloom filter. This way then it will also be possible for the same user to have multiple page visit counts when returning after 2 hours (or after 1000 other people have visited the page) which I think gives a very good protection against abuse (and there would be no need to store the bloom filter data in a file/database/etc). I&#39;ll accept this answer tomorrow if there&#39;s no better solution by then"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1507594915, "post_id": 46641458, "comment_id": 80262744, "body": "I think you do not need 1000 maps: one for every page. Just try to add URL to hash - and if user is visiting same page hash won&#39;t be unique."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1507536079, "creation_date": 1507536079, "answer_id": 46641458, "question_id": 46640714, "link": "https://stackoverflow.com/questions/46640714/making-sure-my-go-page-view-counter-isnt-abused/46641458#46641458", "title": "Making sure my Go page view counter isn&#39;t abused", "body": "<p>One of optimization ways is to add a Bloom filter before this map. Bloom filter is a probabilistic structure which can say one of these:</p>\n\n<ul>\n<li><p>this user is definitely new</p></li>\n<li><p>and this user possibly was here</p></li>\n</ul>\n\n<p>This is a way to cut off computation on early stage. If many of your users are new then you save requests to database to check all of them. \nWhat if structure says \"user is possibly non-unique\"? Then you go the database and check it. \nHere's one more optimization: if you do not need very accurate information and can agree with mistake about several percent, you may use the sole bloom filter. I guess many large sites use this technique for estimation. </p>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 1, "accepted_answer_id": 46641458, "answer_count": 1, "score": 0, "last_activity_date": 1507536079, "creation_date": 1507533493, "question_id": 46640714, "link": "https://stackoverflow.com/questions/46640714/making-sure-my-go-page-view-counter-isnt-abused", "title": "Making sure my Go page view counter isn&#39;t abused", "body": "<p>I believe I have a found a very good and fast solution for efficiently counting page views:</p>\n\n<p>Working example in go playground here: <a href=\"https://play.golang.org/p/q_mYEYLa1h\" rel=\"nofollow noreferrer\">https://play.golang.org/p/q_mYEYLa1h</a></p>\n\n<p>My idea is to push this to the database every X minutes, and after pushing a key then delete it from the page map.</p>\n\n<p>My question now is, what would be the optimal way to ensure that this isn't abused? Ideally, I would only want to increase page count from the same person if there was a time interval of 2 hours since last visiting the page.\nAs far as I know, it would be ideal to store and compare both IP and user agent (I don't want to rely on cookie/localstorage), but I'm not quite sure how to efficiently store and compare this information.</p>\n\n<p>I'd likely get both the IP (<code>req.Header.Get(\"x-forwarded-for\")</code>) and UserAgent (<code>req.UserAgent()</code>) from http.Request.</p>\n\n<p>I was thinking making a visitor struct similar to my page struct that would look like this:</p>\n\n<pre><code>type visitor struct {\n    mutex          sync.Mutex\n    urlIPUAAndTime map[string]time\n}\n</code></pre>\n\n<p>This way should make it possible to do something similar to before. However, imagine if the website had so many requests that there would be hundreds of millions of unique visitor maps being stored, and each of these could only be deleted after 2 (or more) hours. I therefore think this is not a good solution.</p>\n\n<p>I guess it would be ideal/necessary to write to and read from some file, but not sure how this should be done efficiently. Help would be greatly appreciated</p>\n"}, {"tags": ["go", "cql", "gocql"], "comments": [{"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1507546200, "post_id": 46640544, "comment_id": 80238268, "body": "can you try to print the type of <code>m[&quot;time&quot;]</code> using this<code>fmt.Println(reflect.TypeOf(m[&quot;time&quot;])</code>?"}, {"owner": {"reputation": 217, "user_id": 1222902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f8f3cb4361e45655964a3471617d6eba?s=128&d=identicon&r=PG", "display_name": "mcfongtw", "link": "https://stackoverflow.com/users/1222902/mcfongtw"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1507638676, "post_id": 46640544, "comment_id": 80281932, "body": "It is of type time.Time."}, {"owner": {"reputation": 217, "user_id": 1222902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f8f3cb4361e45655964a3471617d6eba?s=128&d=identicon&r=PG", "display_name": "mcfongtw", "link": "https://stackoverflow.com/users/1222902/mcfongtw"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1507638789, "post_id": 46640544, "comment_id": 80282030, "body": "I have solved the problem. It seems the timestamp needs to be the type of time.Time, which it currently uses string literal. After I transform the string to time.Time and feed into the function, everything works."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1507686356, "post_id": 46640544, "comment_id": 80305193, "body": "glad you fixed it :)"}], "answers": [{"tags": [], "owner": {"reputation": 217, "user_id": 1222902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f8f3cb4361e45655964a3471617d6eba?s=128&d=identicon&r=PG", "display_name": "mcfongtw", "link": "https://stackoverflow.com/users/1222902/mcfongtw"}, "is_accepted": true, "score": 1, "last_activity_date": 1507638903, "creation_date": 1507638903, "answer_id": 46666948, "question_id": 46640544, "link": "https://stackoverflow.com/questions/46640544/gocql-marshal-string-into-timestamp/46666948#46666948", "title": "GoCQL : Marshal string into timestamp", "body": "<p>Here is how I end up solving this by transforming string literal (of timestamp) to type time.Time</p>\n\n<pre><code>timestamp = \"2017-10-09T13:25:00.000Z\"\ntsAfter,err = time.Parse(model.TimeLayout, timestamp)\nif err != nil {\n    errs = append(errs, err.Error())\n}\n\nlog.Printf(\"GET param [id = %s]\", idStr)\nlog.Printf(\"GET param [after = %s]\", tsAfter.String())\n\nm := map[string]interface{}{}\nquery := \"SELECT id, time, type, val FROM events WHERE id = ? AND time &gt;= ?\"\niterable := cql.Session.Query(query, idStr, tsAfter).Consistency(gocql.One).Iter()\n\nfor iterable.MapScan(m) {\n    eventList = append(eventList, model.Event{\n        ID:         m[\"id\"].(string),\n        Time:       m[\"time\"].(time.Time),\n        Type:       m[\"type\"].(string),\n        Val:        m[\"val\"].(float64),\n    })\n    m = map[string]interface{}{}\n}\n</code></pre>\n"}], "owner": {"reputation": 217, "user_id": 1222902, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f8f3cb4361e45655964a3471617d6eba?s=128&d=identicon&r=PG", "display_name": "mcfongtw", "link": "https://stackoverflow.com/users/1222902/mcfongtw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1439, "favorite_count": 1, "accepted_answer_id": 46666948, "answer_count": 1, "score": 2, "last_activity_date": 1507638903, "creation_date": 1507532794, "last_edit_date": 1507545448, "question_id": 46640544, "link": "https://stackoverflow.com/questions/46640544/gocql-marshal-string-into-timestamp", "title": "GoCQL : Marshal string into timestamp", "body": "<p>I am developing a time series data model with clustering column i.e. </p>\n\n<pre><code>CREATE TABLE events (\n    id text,\n    time timestamp,\n    type text,\n    val double,\n    PRIMARY KEY (id, time)\n) WITH CLUSTERING ORDER BY (time DESC)\n</code></pre>\n\n<p>I wish to perform a select against the partition column 'id' and clustering column 'time'. For example, id:='1', timestamp:='2017-10-09'</p>\n\n<pre><code>query := \"SELECT id, time, type, val FROM events WHERE id=? AND time&gt;=?\"\niterable := Cassandra.Session.Query(query, id, timestamp).Consistency(gocql.One).Iter()\nfor iterable.MapScan(m) {\n        found = true\n        event = Event{\n                ID:       m[\"id\"].(string),\n                Time:     m[\"time\"].(time.Time),\n                Type:     m[\"type\"].(string),\n                Val:      m[\"val\"].(float64),\n        }\n}\n</code></pre>\n\n<p>After checking err on iterable.Close(), found an error in marshalling</p>\n\n<p>{\"errors\":[\"can not marshal string into timestamp\"]}</p>\n\n<p>How could I fix this?</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 6384391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c5209f557798e03f6acb69a1ec7a86a?s=128&d=identicon&r=PG&f=1", "display_name": "shx", "link": "https://stackoverflow.com/users/6384391/shx"}, "edited": false, "score": 0, "creation_date": 1507534856, "post_id": 46640773, "comment_id": 80231470, "body": "channel doc says it blocked when there is no receiver. in this case  the statement <b>fmt.Println(order, a)</b> is before channel send. the first goroutine is blocked after print statement , is it right?"}, {"owner": {"reputation": 45, "user_id": 6384391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c5209f557798e03f6acb69a1ec7a86a?s=128&d=identicon&r=PG&f=1", "display_name": "shx", "link": "https://stackoverflow.com/users/6384391/shx"}, "edited": false, "score": 0, "creation_date": 1507535221, "post_id": 46640773, "comment_id": 80231644, "body": "is it run goroutine randomly in the same scope? or i can&#39;t understand why the 2rd is exec before 1st"}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 1, "creation_date": 1507536064, "post_id": 46640773, "comment_id": 80232105, "body": "Goroutines go parallel (or we could think that) - that means it is no guarantee whether routine 1 or 2 finish first. Only synchronization points are sending/receiving from channels, but no one could said whether first g1 or g2 tries send result to channel c."}, {"owner": {"reputation": 321, "user_id": 4959097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa2af5dbbd09d7749149049c9df96369?s=128&d=identicon&r=PG&f=1", "display_name": "Farrukh Okhunov", "link": "https://stackoverflow.com/users/4959097/farrukh-okhunov"}, "edited": false, "score": 0, "creation_date": 1507545626, "post_id": 46640773, "comment_id": 80237898, "body": "shx, if you used javaScript so it&#39;s like ajax request. You can make multiple ajax requests but you don&#39;t know which return result first."}], "tags": [], "owner": {"reputation": 321, "user_id": 4959097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa2af5dbbd09d7749149049c9df96369?s=128&d=identicon&r=PG&f=1", "display_name": "Farrukh Okhunov", "link": "https://stackoverflow.com/users/4959097/farrukh-okhunov"}, "is_accepted": false, "score": 0, "last_activity_date": 1507533692, "creation_date": 1507533692, "answer_id": 46640773, "question_id": 46640390, "link": "https://stackoverflow.com/questions/46640390/two-goroutine-in-the-same-channel-how-are-they-executed/46640773#46640773", "title": "Two goroutine in the same Channel - how are they executed?", "body": "<p>let me help you with that.</p>\n\n<p>in your second scenario:</p>\n\n<pre><code>2 [-9 4 0] \n1 [7 2 8]\n-5 17 12\n</code></pre>\n\n<p>As you can see second goroutine executes faster than first one and in result we have x = result of second goroutine (-5).</p>\n\n<p>When you do run function/method with <strong>go</strong> keyword it runs in concurrency which means main function doesn't wait it execution (if do not use <strong>sync.WaitGroup{}</strong> or <strong>select{}</strong>).</p>\n\n<p>you can find more details from docs:\n<a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">https://golang.org/pkg/sync/#WaitGroup</a></p>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 6384391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c5209f557798e03f6acb69a1ec7a86a?s=128&d=identicon&r=PG&f=1", "display_name": "shx", "link": "https://stackoverflow.com/users/6384391/shx"}, "edited": false, "score": 0, "creation_date": 1507538761, "post_id": 46642156, "comment_id": 80233563, "body": "yes, but online Playground always run 2rd before 1st,make me confuse,and i run it locally two goroutines go randomly"}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": true, "score": 4, "last_activity_date": 1507538509, "creation_date": 1507538509, "answer_id": 46642156, "question_id": 46640390, "link": "https://stackoverflow.com/questions/46640390/two-goroutine-in-the-same-channel-how-are-they-executed/46642156#46642156", "title": "Two goroutine in the same Channel - how are they executed?", "body": "<p>the thing is u've missed the concept of concurrency\nthere is no guarantee in executing functions in exact order of calling them with go</p>\n\n<p>the reason first code snippet works orderly is the <code>x := &lt;-c</code> part\nthis line force your app to wait until c channel is filled with data so second goroutine wont be called</p>\n"}], "owner": {"reputation": 45, "user_id": 6384391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c5209f557798e03f6acb69a1ec7a86a?s=128&d=identicon&r=PG&f=1", "display_name": "shx", "link": "https://stackoverflow.com/users/6384391/shx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 46642156, "answer_count": 2, "score": 2, "last_activity_date": 1507566601, "creation_date": 1507532081, "last_edit_date": 1507566601, "question_id": 46640390, "link": "https://stackoverflow.com/questions/46640390/two-goroutine-in-the-same-channel-how-are-they-executed", "title": "Two goroutine in the same Channel - how are they executed?", "body": "<p>When I take the tour of Golang from golang.org, there's one code snippet I don't understand:</p>\n\n<pre><code>func sum(a []int, c chan int, order int) {\n    sum := 0\n    for _, v := range a {\n        sum += v\n    }\n    fmt.Println(order, a)\n    c &lt;- sum // \u5c06\u548c\u9001\u5165 c\n}\n\nfunc main() {\n    a := []int{7, 2, 8, -9, 4, 0}\n\n    c := make(chan int)\n    a1, a2 := a[:len(a)/2], a[len(a)/2:]\n\n    go sum(a1, c, 1)\n    x := &lt;-c\n    go sum(a2, c, 2)\n    y := &lt;-c\n    //x := &lt;-c\n    //y := &lt;-c\n    // x, y := &lt;-c, &lt;-c // \u4ece c \u4e2d\u83b7\u53d6\n\n    fmt.Println(x, y, x+y)\n}\n</code></pre>\n\n<p><strong>This is the output I expected:</strong></p>\n\n<pre><code>1 [7 2 8]\n2 [-9 4 0]\n17 -5 12\n</code></pre>\n\n<p>and when I changed the code:</p>\n\n<pre><code>func main() {\n    a := []int{7, 2, 8, -9, 4, 0}\n\n    c := make(chan int)\n    a1, a2 := a[:len(a)/2], a[len(a)/2:]\n\n    go sum(a1, c, 1)\n    //x := &lt;-c\n    go sum(a2, c, 2)\n    //y := &lt;-c\n    x := &lt;-c\n    y := &lt;-c\n    // x, y := &lt;-c, &lt;-c // \u4ece c \u4e2d\u83b7\u53d6\n\n    fmt.Println(x, y, x+y)\n}\n</code></pre>\n\n<p><strong>Why is the output like this:</strong></p>\n\n<pre><code>2 [-9 4 0] \n1 [7 2 8]\n-5 17 12\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 855, "user_id": 1323552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8c998581e1504213b9a0fab4a846df?s=128&d=identicon&r=PG", "display_name": "Johnny Wong", "link": "https://stackoverflow.com/users/1323552/johnny-wong"}, "edited": false, "score": 1, "creation_date": 1507534245, "post_id": 46639328, "comment_id": 80231144, "body": "Remark:  I am seeking some general solution, e.g. a practical method signature for copying;  not some specific solution, like always deep-copy everything."}, {"owner": {"reputation": 855, "user_id": 1323552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8c998581e1504213b9a0fab4a846df?s=128&d=identicon&r=PG", "display_name": "Johnny Wong", "link": "https://stackoverflow.com/users/1323552/johnny-wong"}, "edited": false, "score": 1, "creation_date": 1507601115, "post_id": 46639328, "comment_id": 80264091, "body": "Reason for downvote?  I think Go community should have paradigm to such so-common programming problem.  It is just copy constructor in C++, clone in Java, etc.  Do anyone agree?"}], "answers": [{"comments": [{"owner": {"reputation": 855, "user_id": 1323552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8c998581e1504213b9a0fab4a846df?s=128&d=identicon&r=PG", "display_name": "Johnny Wong", "link": "https://stackoverflow.com/users/1323552/johnny-wong"}, "edited": false, "score": 0, "creation_date": 1507534586, "post_id": 46639486, "comment_id": 80231336, "body": "Thanks, but my concern is not on copy&#39;s implementation (I can hardcode the object&#39;s copy), but focus on a convention/interface (e.g. method signature, plus how to call &amp; use). Just like if the community has some popular projects/packages that have this copy mechanism to follow, I want to follow it"}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 0, "last_activity_date": 1507527715, "creation_date": 1507527715, "answer_id": 46639486, "question_id": 46639328, "link": "https://stackoverflow.com/questions/46639328/could-anybody-provide-your-own-standard-convention-of-clone-method-that-work-w/46639486#46639486", "title": "Could anybody provide your-own/standard convention of &quot;clone method&quot; that work well for my/our reference?", "body": "<p><a href=\"https://stackoverflow.com/a/28579297/6276385\">This answer</a> to a similar question regarding maps suggests to use <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\">the gob package</a>. The documentation states:</p>\n\n<blockquote>\n  <p>A stream of gobs is self-describing. Each data item in the stream is preceded by a specification of its type, expressed in terms of a small set of predefined types. Pointers are not transmitted, but the things they point to are transmitted; that is, the values are flattened. Nil pointers are not permitted, as they have no value. Recursive types work fine, but recursive values (data with cycles) are problematic. This may change.</p>\n</blockquote>\n\n<p>so it may not be suitable for your use case.</p>\n\n<p>That said, your question largely depends on your actual use-case. You do not need a generic way to deep-copy things usually, you can usually either get away with the built-in copy mechanics or write concrete copy functions for the types that actually need it.</p>\n\n<p>An alternative might be <a href=\"https://godoc.org/github.com/getlantern/deepcopy\" rel=\"nofollow noreferrer\">the deepcopy package</a> but I have no experience with it myself, I just found it on Goolge.</p>\n"}, {"tags": [], "owner": {"reputation": 855, "user_id": 1323552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8c998581e1504213b9a0fab4a846df?s=128&d=identicon&r=PG", "display_name": "Johnny Wong", "link": "https://stackoverflow.com/users/1323552/johnny-wong"}, "is_accepted": true, "score": 0, "last_activity_date": 1507779483, "creation_date": 1507779483, "answer_id": 46701008, "question_id": 46639328, "link": "https://stackoverflow.com/questions/46639328/could-anybody-provide-your-own-standard-convention-of-clone-method-that-work-w/46701008#46701008", "title": "Could anybody provide your-own/standard convention of &quot;clone method&quot; that work well for my/our reference?", "body": "<p>Ok, having some while no one else give me proper reference, I have found out some reference example how to clone in Go myself and want to share.</p>\n\n<p>(Only upvote me a few if this answer is useful to you.  I'm not for earning votes.  Welcome other better answers and comments)</p>\n\n<p>I found this protoype in package \"github.com/jinzhu/gorm\" (Database's ORM library) for reference:</p>\n\n<pre><code>func (s *DB) clone() *DB {\n    db := &amp;DB{\n        ...\n    }\n    ...\n    return db\n}\n</code></pre>\n\n<p>And similar pattern in package \"golang.org/x/net/html/atom\":</p>\n\n<pre><code>func (n *Node) clone() *Node {\n    m := &amp;Node{\n        Type:     n.Type,\n        ...\n    }\n    ...\n    return m\n}\n</code></pre>\n\n<p>The above prototype is enough if the Clone()'s caller always know your object type when cloning.  (and you need uppercase <code>Clone()</code> to make the method to be \"public\")</p>\n\n<p>However, if you want advanced feature that a variable may hold any object of similar base interface, here is my sample:</p>\n\n<pre><code>func (t *T) Clone() YourBaseInterface\n</code></pre>\n\n<p>Where YourBaseInterface is:</p>\n\n<pre><code>type YourBaseInterface interface {\n    Clone() YourBaseInterface\n    OtherMethod1()\n    ...\n}\n</code></pre>\n\n<p>Or can merely use <code>interface{}</code> instead of <code>YourBaseInterface</code> in the return, and do a typecast like <code>obj2 := obj.Clone().(*YourBaseType)</code> after clone.</p>\n\n<h2>CAUTION</h2>\n\n<p>There is one drawback with this prototype.  Becase Golang doesn't support this prototype as build-in, the <code>Clone()</code> method won't be called in some language's feature, e.g. when you <code>copy(dest, src)</code> a <code>[]YourTypeWithClone</code> slice.  Instead, it still do plain <code>*elem2 = *elem1</code> struct copying.  Solutions maybe either don't use those build-in, or you may flaw back to design the class struct members so that doing plain copy is enough for its copy purpose if possible.</p>\n"}], "owner": {"reputation": 855, "user_id": 1323552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d8c998581e1504213b9a0fab4a846df?s=128&d=identicon&r=PG", "display_name": "Johnny Wong", "link": "https://stackoverflow.com/users/1323552/johnny-wong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 46701008, "answer_count": 2, "score": 2, "last_activity_date": 1507779483, "creation_date": 1507526655, "last_edit_date": 1507527755, "question_id": 46639328, "link": "https://stackoverflow.com/questions/46639328/could-anybody-provide-your-own-standard-convention-of-clone-method-that-work-w", "title": "Could anybody provide your-own/standard convention of &quot;clone method&quot; that work well for my/our reference?", "body": "<p>I can't find a \"clone\" method convention in Golang, but it seems necessary to have one.</p>\n\n<p>I only saw the built-in way <code>*clonedObj = *obj</code>, but it is too low-level, and can't handle (when-necessary) deep copy of case like <code>struct { member *CompositionObj }</code></p>\n\n<p>I doubt whether \"func (obj ClassA) Clone() interface{}\" prototype will work, because calling <code>obj2 := obj.Clone()</code> will \"loose\" the method set for ClassA, and need explicit code like <code>obj2.(*ClassA)</code> afterwards.</p>\n\n<p>Please advice a working direction.</p>\n"}, {"tags": ["go", "server", "package"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507523204, "post_id": 46638715, "comment_id": 80226673, "body": "is your book telling you to do that import <b>&quot;./lissajous&quot;</b> ? well if that&#39;s the case, it isn&#39;t recommended. <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1507523221, "post_id": 46638715, "comment_id": 80226678, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/15049903/how-to-use-custom-packages-in-golang\">How to use custom packages in golang?</a>"}, {"owner": {"reputation": 11, "user_id": 7904496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bd850055bf4f7b5d95418dc28169281?s=128&d=identicon&r=PG&f=1", "display_name": "Zachary Schiff", "link": "https://stackoverflow.com/users/7904496/zachary-schiff"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507635016, "post_id": 46638715, "comment_id": 80279372, "body": "the book doesn&#39;y say to import the module, but to add the line :                handler := func(w http.ResponseWriter, r *http.Request) {         lissajous(w)      }"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7904496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bd850055bf4f7b5d95418dc28169281?s=128&d=identicon&r=PG&f=1", "display_name": "Zachary Schiff", "link": "https://stackoverflow.com/users/7904496/zachary-schiff"}, "edited": false, "score": 0, "creation_date": 1507635169, "post_id": 46638947, "comment_id": 80279472, "body": "I was attempting to add the line    <code>handler := func(w http.ResponseWriter, r *http.Request) {         lissajous(w)    }</code> which i assume would require in import if the package"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1507523938, "creation_date": 1507523938, "answer_id": 46638947, "question_id": 46638715, "link": "https://stackoverflow.com/questions/46638715/package-selection-error-in-for-a-go-function/46638947#46638947", "title": "package selection error in for a go function", "body": "<p>Here are 2 things:</p>\n\n<ul>\n<li><p>Go doesn't allow unused imports - if you import module you should use it, or temporarily comment out </p></li>\n<li><p>another way of custom module creation and import recommended. Think like once you will publish it and treat it as being already published. Choose an unique URL for it like <code>github.com/login/repo/super-package/package</code>. However if you are not obliged to publish it right now neither in open source nor private repo. It's recommended to keep it like this in your system. It'lll be easier to start sharing it with colleagues and possibly publish if you wish. </p></li>\n</ul>\n"}], "owner": {"reputation": 11, "user_id": 7904496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bd850055bf4f7b5d95418dc28169281?s=128&d=identicon&r=PG&f=1", "display_name": "Zachary Schiff", "link": "https://stackoverflow.com/users/7904496/zachary-schiff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 382, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507523938, "creation_date": 1507522014, "question_id": 46638715, "link": "https://stackoverflow.com/questions/46638715/package-selection-error-in-for-a-go-function", "title": "package selection error in for a go function", "body": "<p>I am learning from a book the book says to add a couple lines of code, but it throws an error</p>\n\n<pre><code>package main\n\nimport (\n   \"./lissajous\"\n   \"log\"\n   \"net/http\" \n)\n\nfunc main() {\n\n   handler := func(w http.ResponseWriter, r *http.Request) {\n        lissajous(w)\n   }\n   http.HandleFunc(\"/\", handler) // each request calls handler\n   log.Fatal(http.ListenAndServe(\"localhost:8000\", nil))\n}\n</code></pre>\n\n<p>it throws this error</p>\n\n<pre><code>./server.go:6: imported and not used:\n\"_/home/zach/Dropbox/Personal/Go_Programming\n         /The_Go_Programming_Language/ch01/web/lissajous\"\n./server.go:14: use of package lissajous without selector\n</code></pre>\n\n<p>the package directory I think is correct, but can't seem to call functions, the set up for the handler is just like that in the book am I missing something?</p>\n\n<p>any help appreciated?</p>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1507519908, "post_id": 46638401, "comment_id": 80226022, "body": "Did you specify a port number in the URL? If not, the error is with the server. It should have either refused the connection on port 80, or returned an HTTP response describing the issue."}, {"owner": {"reputation": 427, "user_id": 5207361, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e981f92abd1fd56336edb779e2cefa04?s=128&d=identicon&r=PG&f=1", "display_name": "Chuque", "link": "https://stackoverflow.com/users/5207361/chuque"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1507536574, "post_id": 46638401, "comment_id": 80232385, "body": "I did specify the port in the URL, but when I debug inside the Dial function, I notice that the server response is nil at some point and that&#39;s where the error occurs."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1507559419, "post_id": 46638401, "comment_id": 80246787, "body": "Don&#39;t include the port if it&#39;s :443.   The <a href=\"https://github.com/gorilla/websocket/blob/c908dc801cef474e686e478694c8f9f32e233901/client.go#L348-L351\" rel=\"nofollow noreferrer\">call to http.ReadResponse</a> is probably returning <code>nil, io.UnexpectedEOF</code> because the server is closing the connection because of missing TLS handshake."}], "owner": {"reputation": 427, "user_id": 5207361, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e981f92abd1fd56336edb779e2cefa04?s=128&d=identicon&r=PG&f=1", "display_name": "Chuque", "link": "https://stackoverflow.com/users/5207361/chuque"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1067, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1507519531, "creation_date": 1507519531, "question_id": 46638401, "link": "https://stackoverflow.com/questions/46638401/using-wrong-websocket-protocol-returns-an-unexpected-eof-error-in-gorilla-webs", "title": "Using wrong WebSocket protocol returns an &quot;unexpected EOF&quot; error in gorilla/websocket/client.go&#39;s Dial function", "body": "<p>I was trying to connect to a server in Go by using <a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">gorilla/websocket</a>\nand I kept getting the error \"unexpected EOF\". It took me way too long to find out it was because I needed to use the secure WebSocket protocol to connect to that server (\"wss://\" instead of \"ws://\" in my url).</p>\n\n<p>How can I verify that I'm using the wrong protocol for a given endpoint so that I can log a helpful error message instead of \"unexpected EOF\"?</p>\n"}, {"tags": ["go", "return"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 2, "creation_date": 1507504719, "post_id": 46635576, "comment_id": 80223136, "body": "inside of a function scope variable names must be unique, that&#39;s why"}, {"owner": {"reputation": 355, "user_id": 4937780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-2ENA7NgCBBM/AAAAAAAAAAI/AAAAAAAAAd0/mZD2vCbvmnQ/photo.jpg?sz=128", "display_name": "V&#237;ctor R. Escobar", "link": "https://stackoverflow.com/users/4937780/v%c3%adctor-r-escobar"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507624061, "post_id": 46635576, "comment_id": 80272386, "body": "Where does the &quot;scope&quot; of a function begin? In other languages my understanding is that between &quot;func&quot; and &quot;{&quot; is the function signature and the scope is between &quot;{&quot; and &quot;}&quot; . Could be a design error in the language?"}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 3, "last_activity_date": 1507493756, "creation_date": 1507493756, "answer_id": 46635604, "question_id": 46635576, "link": "https://stackoverflow.com/questions/46635576/return-input-variables-in-golang/46635604#46635604", "title": "Return input variables in golang", "body": "<p>I guess problem is not in returning input argument, but in names duplication: <code>y</code> and <code>z</code> are declared twice on the same level and compiler cannot distinguish.</p>\n"}, {"tags": [], "owner": {"reputation": 11366, "user_id": 3922954, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/76ba47d2fdd24ab56b0b273cce2075e5?s=128&d=identicon&r=PG&f=1", "display_name": "AJF", "link": "https://stackoverflow.com/users/3922954/ajf"}, "is_accepted": false, "score": 6, "last_activity_date": 1507495614, "last_edit_date": 1507495614, "creation_date": 1507494336, "answer_id": 46635698, "question_id": 46635576, "link": "https://stackoverflow.com/questions/46635576/return-input-variables-in-golang/46635698#46635698", "title": "Return input variables in golang", "body": "<p>I'm also a Golang beginner. Here's what I managed to find out.</p>\n\n<p>The problem is essentially, that you declare two variables named <code>z</code>, then expect them to be unified. This is not supported, and in fact would go against the main goal of named return types, which is to document the meaning of the values returned.</p>\n\n<p>To explain in more detail, this is a bit like writing the following code:</p>\n\n<pre><code>func badFunction(a int) int {\n    var a int = 0\n    return a\n}\n</code></pre>\n\n<p>A variable is declared twice, and this is confusing for Go. If we look at what the <a href=\"https://tour.golang.org/basics/7\" rel=\"noreferrer\">'tour of go'</a> has to say about named return values, we can see the issue. It's not the greatest source, but it's a source nonetheless:</p>\n\n<blockquote>\n  <p>Go's return values may be named. If so, <strong>they are treated as variables defined at the top of the function.</strong></p>\n</blockquote>\n\n<p>That is to say, your example is almost exactly like <code>badFunction</code>. To the compiler, it looks a bit like this:</p>\n\n<pre><code>func swap(a, b int) (int, int) {\n    var a int = 0\n    var b int = 0\n    return b, a\n}\n</code></pre>\n\n<p>Naturally, the compiler complains about <code>a redeclared in block</code>, which is a related though admittedly not equal error. The error message you receive there appears to essentially be a pre-check to prevent the user from seeing the code produced when desugared.</p>\n\n<hr>\n\n<p>As <a href=\"https://stackoverflow.com/questions/15089726/why-should-return-parameters-be-named\">this Stackoverflow question</a> reports, named return values should essentially be for documentation only. However, it does mention the possibility of accidental shadowing. It may be that an earlier Go version supported this, but has since been changed to prevent bugs due to this kind of name collision, however I have not found anything pertaining to this.</p>\n\n<p>The <a href=\"https://golang.org/doc/effective_go.html#named-results\" rel=\"noreferrer\">effective go section</a> on the topic also has something to say:</p>\n\n<blockquote>\n  <p>The return or result \"parameters\" of a Go function can be given names and used as regular variables, just like the incoming parameters. When named, <strong>they are initialized to the zero values for their types when the function begins;</strong> if the function executes a return statement with no arguments, the current values of the result parameters are used as the returned values.</p>\n  \n  <p>The names are not mandatory but they can make code shorter and clearer: <strong>they're documentation.</strong></p>\n</blockquote>\n\n<hr>\n\n<p><strong>TL;DR:</strong> The compiler doesn't unify names in the way you might expect. This kind of implicit shadowing not supported, and should be actively avoided to prevent certain easily avoidable bugs.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6092611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84b802f221c7a3e02d2720b68716d8ac?s=128&d=identicon&r=PG&f=1", "display_name": "Sega", "link": "https://stackoverflow.com/users/6092611/sega"}, "is_accepted": false, "score": 0, "last_activity_date": 1585924766, "last_edit_date": 1585924766, "creation_date": 1585910846, "answer_id": 61010147, "question_id": 46635576, "link": "https://stackoverflow.com/questions/46635576/return-input-variables-in-golang/61010147#61010147", "title": "Return input variables in golang", "body": "<p>When you declare a variable in return type, Go compiler would consider that, you are declaring the variable there for future use. </p>\n\n<p>Now when the compiler sees the same variable name in both input &amp; return part, it will report a duplicate argument issue.</p>\n\n<p>You can try the working example below, if you want to</p>\n\n<pre><code>func swap(x, y string) (a string, b string) {\n    a = y\n    b = x\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1108, "user_id": 5732720, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M7Jmt.jpg?s=128&g=1", "display_name": "Gabriel Wu", "link": "https://stackoverflow.com/users/5732720/gabriel-wu"}, "is_accepted": false, "score": 0, "last_activity_date": 1594542013, "creation_date": 1594542013, "answer_id": 62858764, "question_id": 46635576, "link": "https://stackoverflow.com/questions/46635576/return-input-variables-in-golang/62858764#62858764", "title": "Return input variables in golang", "body": "<p>You can do this way</p>\n<pre><code>func checkError(err *error) (bool, *error) {\n    if err != nil {\n        return false, err\n    } else {\n        return false, nil\n    }\n}\n</code></pre>\n<p>or if you really want to use variable, this way</p>\n<pre><code>func checkError(err *error) (result bool, err_msg *error) {\n    if err != nil {\n        return false, err\n    } else {\n        return false, nil\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 355, "user_id": 4937780, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh6.googleusercontent.com/-2ENA7NgCBBM/AAAAAAAAAAI/AAAAAAAAAd0/mZD2vCbvmnQ/photo.jpg?sz=128", "display_name": "V&#237;ctor R. Escobar", "link": "https://stackoverflow.com/users/4937780/v%c3%adctor-r-escobar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1658, "favorite_count": 1, "answer_count": 4, "score": 6, "last_activity_date": 1594542013, "creation_date": 1507493540, "last_edit_date": 1507531081, "question_id": 46635576, "link": "https://stackoverflow.com/questions/46635576/return-input-variables-in-golang", "title": "Return input variables in golang", "body": "<p>I just got started with Golang, and I saw the typical swap function example:</p>\n\n<pre><code>func swap(x, y string) (string, string) {\n    return y, x\n}\n</code></pre>\n\n<p>I automatically thought that the named returns could have solved it and that it was a sweeter example, so I tried the shorter version:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc swap(z, y int) (z, y int) {\n    return\n}\n\nfunc main() {\n    fmt.Println(swap(2, 3))\n}\n</code></pre>\n\n<p>But to by my surprise it didn't compile complaining about a duplicate argument. Why is not possible to return an input argument? Am I doing something wrong or it is just not supported?</p>\n\n<p>I thought this was a totally valid use case and that it could have been many other examples for this usage.</p>\n"}, {"tags": ["go", "vim", "indentation", "gofmt"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507489865, "post_id": 46634910, "comment_id": 80219289, "body": "sorry if that &quot;freaks you out&quot;, but that&#39;s how vim works. Normal mode the cursor is shown <i>on</i> the character, and in insert mode the curser is indexed <i>between</i> the characters."}, {"owner": {"reputation": 1519, "user_id": 2972348, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6f9edd3f6213aca1c54edefed5796033?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Khare", "link": "https://stackoverflow.com/users/2972348/ishan-khare"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507490806, "post_id": 46634910, "comment_id": 80219590, "body": "I understand, but i should still be able to navigate to <code>0th</code> index using arrow keys? Why does this only happen in case of <code>noexpandtab</code>. Why can I navigate to <code>0th</code> index when there are leading <code>4-space</code> and not when there is a leading tab?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1507492014, "post_id": 46634910, "comment_id": 80219896, "body": "Because your tabs are displayed as 4 spaces wide. You are on the 0th character, but the width is 4, so the cursor in shown in the 4th visual column. Inserting before it will move to the start of the line, and inserting after will move after the tab."}, {"owner": {"reputation": 1519, "user_id": 2972348, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6f9edd3f6213aca1c54edefed5796033?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Khare", "link": "https://stackoverflow.com/users/2972348/ishan-khare"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507533842, "post_id": 46634910, "comment_id": 80230923, "body": "is there a way i can <code>display</code> the tabs as 4 spaces wide, but still don&#39;t convert to 4 spaces on write-out?"}, {"owner": {"reputation": 4930, "user_id": 5276188, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N2sAW.jpg?s=128&g=1", "display_name": "Doktor OSwaldo", "link": "https://stackoverflow.com/users/5276188/doktor-oswaldo"}, "edited": false, "score": 0, "creation_date": 1507541312, "post_id": 46634910, "comment_id": 80235251, "body": "sure, that would maybe be another question, but the essence is, you can set and unset expandtab before/after saving with autocmds"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1507569477, "post_id": 46634910, "comment_id": 80252453, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/46608910/gofmt-producing-mix-indent-file-for-vim\">gofmt producing mix-indent-file for vim</a>"}], "answers": [{"tags": [], "owner": {"reputation": 153428, "user_id": 813602, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e1844cebf36374d83a83c0e69003cd42?s=128&d=identicon&r=PG", "display_name": "Ingo Karkat", "link": "https://stackoverflow.com/users/813602/ingo-karkat"}, "is_accepted": true, "score": 2, "last_activity_date": 1507541454, "creation_date": 1507541454, "answer_id": 46643135, "question_id": 46634910, "link": "https://stackoverflow.com/questions/46634910/vim-normal-mode-shows-tabs-as-1-char-wide-not-aligned-to-left-margin/46643135#46643135", "title": "Vim normal mode shows tabs as 1 char wide, not aligned to left margin", "body": "<p>What you see is normal Vim behavior. On a line that starts with a <code>&lt;Tab&gt;</code> character, the cursor is shown <em>on</em> the character; as a tab occupies multiply (default 8) screen cells, Vim puts the cursor at the end of the character (for double-width characters, Vim also double the character, but a 8-char wide cursor probably would look bad, and may not technically be possible in the terminal) in <em>normal mode</em>. In <em>insert mode</em>, the cursor is between characters, so you can position the cursor before (e.g. with <code>gI</code>) and after (<code>I</code>) the tab.</p>\n\n<h3>Remedies</h3>\n\n<p>It would be best to accept this behavior; if you really can't stand it, here are some options that change the behavior. Unfortunately, each comes with caveats and downsides:</p>\n\n<ul>\n<li>With <code>:set list</code>, Vim puts the cursor at the front, as you want. But you'll see whitespace highlighted, too. You could fiddle with the <code>'listchars'</code> option to reduce the visual noise, but then you'll lose that helpful feature.</li>\n<li>With <code>:set virtualedit=all</code>, you can position the cursor anywhere inside a tab. Starting editing in the middle of it breaks the tab character into space before and after. Also, you can position the cursor anywhere behind physical text.</li>\n<li>With <code>:autocmd</code>s, you could convert tabs to spaces on reading the buffer, and back on writing. (See <code>:help retab-example</code>)</li>\n</ul>\n"}], "owner": {"reputation": 1519, "user_id": 2972348, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/6f9edd3f6213aca1c54edefed5796033?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Khare", "link": "https://stackoverflow.com/users/2972348/ishan-khare"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 46643135, "answer_count": 1, "score": 0, "last_activity_date": 1507541454, "creation_date": 1507489081, "question_id": 46634910, "link": "https://stackoverflow.com/questions/46634910/vim-normal-mode-shows-tabs-as-1-char-wide-not-aligned-to-left-margin", "title": "Vim normal mode shows tabs as 1 char wide, not aligned to left margin", "body": "<p><a href=\"https://i.stack.imgur.com/8tQwa.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/8tQwa.png\" alt=\"enter image description here\"></a>\nThis is the leftmost my cursor goes in normal mode.</p>\n\n<p><a href=\"https://i.stack.imgur.com/IqGyf.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/IqGyf.png\" alt=\"enter image description here\"></a>\nThis is how it looks in insert mode.</p>\n\n<p>I have the following filetype settings</p>\n\n<pre><code>au BufNewFile,BufRead *.py\n     \\ set tabstop=4 |\n     \\ set softtabstop=4 |\n     \\ set shiftwidth=4 |\n     \\ set textwidth=79 |\n     \\ set expandtab |\n     \\ set autoindent |\n     \\ set fileformat=unix |\n\n au BufNewFile,BufRead *.js, *.html, *.css\n     \\ set tabstop=2 |\n     \\ set softtabstop=2 |\n     \\ set shiftwidth=2 |\n\n au BufNewFile,BufRead *.go\n     \\ set tabstop=4 |\n     \\ set softtabstop=4 |\n     \\ set shiftwidth=4 |\n     \\ set noexpandtab |\n     \\ set smarttab\n</code></pre>\n\n<blockquote>\n  <p>This typically happens with <code>.go</code> files as I guess I have <code>noexpandtab</code>. But the cursor not going to column-0 in normal mode freaks me out.</p>\n</blockquote>\n"}, {"tags": ["go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507534655, "post_id": 46634906, "comment_id": 80231367, "body": "What is <code>Entity</code> and <code>input</code>? Please post them and what you want to achieve exactly."}, {"owner": {"reputation": 63, "user_id": 8474221, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Jspl-W-nts0/AAAAAAAAAAI/AAAAAAAAAr0/7LuoyizSM74/photo.jpg?sz=128", "display_name": "vindl", "link": "https://stackoverflow.com/users/8474221/vindl"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507537932, "post_id": 46634906, "comment_id": 80233078, "body": "Entity is struct &amp; input is string. <i>type Entity struct { \tValue string }  input := r.URL.Query().Get(&quot;input&quot;)</i>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507538170, "post_id": 46634906, "comment_id": 80233210, "body": "And what do you want to &quot;append&quot;? What do you want to achieve?"}, {"owner": {"reputation": 63, "user_id": 8474221, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Jspl-W-nts0/AAAAAAAAAAI/AAAAAAAAAr0/7LuoyizSM74/photo.jpg?sz=128", "display_name": "vindl", "link": "https://stackoverflow.com/users/8474221/vindl"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1507538655, "post_id": 46634906, "comment_id": 80233497, "body": "First Run -&gt; input -&gt; i will drive value &quot;abc&quot;, after that in second run, i ll drive &quot;efg&quot; and so on... i want to store all these in same entity. currently &quot;efg&quot; is overwriting on &quot;abc&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 8474221, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Jspl-W-nts0/AAAAAAAAAAI/AAAAAAAAAr0/7LuoyizSM74/photo.jpg?sz=128", "display_name": "vindl", "link": "https://stackoverflow.com/users/8474221/vindl"}, "edited": false, "score": 0, "creation_date": 1507528407, "post_id": 46637210, "comment_id": 80228297, "body": "I used below code. I just curious why below code doesnt work(append).k := datastore.NameKey(&quot;Entity&quot;, &quot;stringID&quot;, nil) \t \te := Entity{input} \tif _, err = client.Put(ctx, k, &amp;e); err != nil {  \t}"}, {"owner": {"reputation": 63, "user_id": 8474221, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Jspl-W-nts0/AAAAAAAAAAI/AAAAAAAAAr0/7LuoyizSM74/photo.jpg?sz=128", "display_name": "vindl", "link": "https://stackoverflow.com/users/8474221/vindl"}, "edited": false, "score": 0, "creation_date": 1507534399, "post_id": 46637210, "comment_id": 80231231, "body": "I updated query as per your suggestion, but still no success."}], "tags": [], "owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "is_accepted": false, "score": 1, "last_activity_date": 1507507083, "creation_date": 1507507083, "answer_id": 46637210, "question_id": 46634906, "link": "https://stackoverflow.com/questions/46634906/how-to-append-an-entity-to-a-datastore-in-go-lang/46637210#46637210", "title": "How to append an entity to a datastore in Go Lang", "body": "<p>You should:</p>\n\n<ul>\n<li>get an entity first, </li>\n<li>then change a value </li>\n<li>and after that update the entity in the datastore.</li>\n</ul>\n\n<p>Please consult with docs: <a href=\"https://cloud.google.com/datastore/docs/concepts/entities#updating_an_entity\" rel=\"nofollow noreferrer\">https://cloud.google.com/datastore/docs/concepts/entities#updating_an_entity</a>:</p>\n\n<blockquote>\n  <p>To update an existing entity, modify the properties of the entity\n  previously retrieved and store it using the key:</p>\n\n<pre><code>tx, err := client.NewTransaction(ctx)\nif err != nil {\n        log.Fatalf(\"client.NewTransaction: %v\", err)\n}\nvar task Task\nif err := tx.Get(taskKey, &amp;task); err != nil {\n        log.Fatalf(\"tx.Get: %v\", err)\n}\ntask.Priority = 5\nif _, err := tx.Put(taskKey, task); err != nil {\n        log.Fatalf(\"tx.Put: %v\", err)\n}\nif _, err := tx.Commit(); err != nil {\n        log.Fatalf(\"tx.Commit: %v\", err)\n}\n</code></pre>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 63, "user_id": 8474221, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Jspl-W-nts0/AAAAAAAAAAI/AAAAAAAAAr0/7LuoyizSM74/photo.jpg?sz=128", "display_name": "vindl", "link": "https://stackoverflow.com/users/8474221/vindl"}, "edited": false, "score": 0, "creation_date": 1507540387, "post_id": 46642293, "comment_id": 80234610, "body": "Thanks for suggestion. Double thumbs up. :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1507538975, "creation_date": 1507538975, "answer_id": 46642293, "question_id": 46634906, "link": "https://stackoverflow.com/questions/46634906/how-to-append-an-entity-to-a-datastore-in-go-lang/46642293#46642293", "title": "How to append an entity to a datastore in Go Lang", "body": "<p>There can be only one instance, only one entity bound / denoted by the same datastore key.</p>\n\n<p>And entities (bound to a key) can only be overwritten, not updated / extended / appended gradually.</p>\n\n<p>So if you already have an entity saved, to update/  modify it, you have to first load it, then modify the entity in memory, and write out (save) the modified entity. This save will overwrite the existing entity in the datastore.</p>\n\n<p>If for a property you want to store multiple values, the type of that property must support storing multiple values. <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">Slices</a> in Go are such types.</p>\n\n<p>So in your example your entity should look like this:</p>\n\n<pre><code>type Entity struct {\n    Values []string \n}\n</code></pre>\n\n<p>When you load an existing <code>Entity</code>, you have to append the new value to its <code>Values</code> field, something like this (in pseudo code):</p>\n\n<pre><code>e := ... // load existing entity\ne.Values = append(e.Values, input) // Append new data to Values\n// And now save Entity (e) with the same key\n</code></pre>\n\n<p>In code:</p>\n\n<pre><code>client, err := datastore.NewClient(ctx, projectID)\ntx, err := client.NewTransaction(ctx)\nif err != nil {\n    log.Fatalf(\"Failed to create client: %v\", err)\n}\n\nfmt.Fprint(w, input)\ntaskKey := datastore.NameKey(\"Entity\", \"stringID\", nil)\nvar task Entity\nif err := tx.Get(taskKey, &amp;task); err != nil {\n    log.Fatalf(\"tx.Get: %v\", err)\n}\ntask.Values = append(task.Values, input)\nif _, err := tx.Put(taskKey, &amp;task); err != nil {\n    log.Fatalf(\"tx.Put: %v\", err)\n}\nif _, err := tx.Commit(); err != nil {\n    log.Fatalf(\"tx.Commit: %v\", err)\n}\n</code></pre>\n\n<p>If you need to index by this <code>Values</code> property, you might run into troubles if it contains many values. See this possible duplicate for more details: <a href=\"https://stackoverflow.com/questions/29859001/app-engine-datastore-how-to-set-multiple-values-on-a-property-using-golang/29870246#29870246\">App Engine Datastore: How to set multiple values on a property using golang?</a></p>\n\n<p>If you run into this problem, you should consider modeling and storing your data in a different format, e.g. saving in multiple entities, where one entity would only store a single <code>input</code>, connected with the key it belongs to.</p>\n"}], "owner": {"reputation": 63, "user_id": 8474221, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Jspl-W-nts0/AAAAAAAAAAI/AAAAAAAAAr0/7LuoyizSM74/photo.jpg?sz=128", "display_name": "vindl", "link": "https://stackoverflow.com/users/8474221/vindl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 46642293, "answer_count": 2, "score": 1, "last_activity_date": 1507538975, "creation_date": 1507489049, "last_edit_date": 1507534365, "question_id": 46634906, "link": "https://stackoverflow.com/questions/46634906/how-to-append-an-entity-to-a-datastore-in-go-lang", "title": "How to append an entity to a datastore in Go Lang", "body": "<p>Need info on how to append an entity in Google cloud data store.</p>\n\n<p>Put function is always overwritten with new values.</p>\n\n<p>Any suggestions would be helpful.</p>\n\n<p>09-OCT-2017:</p>\n\n<p><strong>I Used below code, but still updating entity instead of appending.(its erasing old &amp; updated with new value, but i want to retain both values)</strong></p>\n\n<pre><code>client, err := datastore.NewClient(ctx, projectID)\ntx, err := client.NewTransaction(ctx)\nif err != nil {\n    log.Fatalf(\"Failed to create client: %v\", err)\n}\n\nfmt.Fprint(w, input)\ntaskKey := datastore.NameKey(\"Entity\", \"stringID\", nil)\nvar task Entity\nif err := tx.Get(taskKey, &amp;task); err != nil {\n    log.Fatalf(\"tx.Get: %v\", err)\n}\ntask.Value = input\nif _, err := tx.Put(taskKey, &amp;task); err != nil {\n    log.Fatalf(\"tx.Put: %v\", err)\n}\nif _, err := tx.Commit(); err != nil {\n    log.Fatalf(\"tx.Commit: %v\", err)\n}\n</code></pre>\n"}, {"tags": ["rest", "go"], "answers": [{"comments": [{"owner": {"reputation": 4635, "user_id": 1411589, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2a6b1a1c31198db776d76af7f04c1bbd?s=128&d=identicon&r=PG", "display_name": "deepakssn", "link": "https://stackoverflow.com/users/1411589/deepakssn"}, "edited": false, "score": 0, "creation_date": 1521689808, "post_id": 46634216, "comment_id": 85841509, "body": "Thanks @tim-cooper I understand and implemented this.  Can this be written as a re-usable function as multiple APIs fall with similar structure?"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 1, "last_activity_date": 1507508187, "last_edit_date": 1507508187, "creation_date": 1507485165, "answer_id": 46634216, "question_id": 46634104, "link": "https://stackoverflow.com/questions/46634104/implementing-rest-multiple-resource-and-identifier-using-http-package/46634216#46634216", "title": "Implementing REST multiple Resource and Identifier using http package", "body": "<p>The following should give you a starting point to work from:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"strconv\"\n    \"net/http\"\n    \"strings\"\n)\n\nfunc AddProduct(w http.ResponseWriter, r *http.Request) {\n    c := strings.Split(strings.Trim(r.URL.Path, \"/\"), \"/\")\n    switch {\n    case len(c) == 2:\n        // GET product/{id}\n        if r.Method != \"GET\" &amp;&amp; r.Method != \"HEAD\" {\n            http.Error(w, http.StatusText(http.StatusMethodNotAllowed), http.StatusMethodNotAllowed)\n            return\n        }\n        id, err := strconv.Atoi(c[1])\n        if err != nil {\n            break\n        }\n        // implementation\n        return\n\n    case len(c) == 3 &amp;&amp; c[2] == \"item\":\n        // POST product/{id}/item\n        if r.Method != \"POST\" {\n            http.Error(w, http.StatusText(http.StatusMethodNotAllowed), http.StatusMethodNotAllowed)\n            return\n        }\n        id, err := strconv.Atoi(c[1])\n        if err != nil {\n            break\n        }\n        // implementation\n        return\n\n    case len(c) == 4 &amp;&amp; c[2] == \"item\":\n        // GET product/{id}/item/{itemID}\n        if r.Method != \"GET\" &amp;&amp; r.Method != \"HEAD\" {\n            http.Error(w, http.StatusText(http.StatusMethodNotAllowed), http.StatusMethodNotAllowed)\n            return\n        }\n        id, err := strconv.Atoi(c[1])\n        if err != nil {\n            break\n        }\n\n        itemID, err := strconv.Atoi(c[3])\n        if err != nil {\n            break\n        }\n        // implementation\n        return\n    }\n    http.Error(w, http.StatusText(http.StatusNotFound), http.StatusNotFound)\n}\n\nfunc main() {\n    http.HandleFunc(\"/product/\", AddProduct)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}], "owner": {"reputation": 4635, "user_id": 1411589, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2a6b1a1c31198db776d76af7f04c1bbd?s=128&d=identicon&r=PG", "display_name": "deepakssn", "link": "https://stackoverflow.com/users/1411589/deepakssn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "accepted_answer_id": 46634216, "answer_count": 1, "score": 0, "last_activity_date": 1507508187, "creation_date": 1507484468, "last_edit_date": 1507486470, "question_id": 46634104, "link": "https://stackoverflow.com/questions/46634104/implementing-rest-multiple-resource-and-identifier-using-http-package", "title": "Implementing REST multiple Resource and Identifier using http package", "body": "<p>I have Products and Items in my application. Products is a collection of items. For example, T-Shirt is a product and it has attributes like size and color. Sizes are S, M, L, XL and colors are Red, Green and Blue. </p>\n\n<p>I want to build REST services using <strong>http package only</strong>. (No Gorilla Mux, Goji, etc).</p>\n\n<p>POST Api to add a product</p>\n\n<pre><code>http://localhost/product\n</code></pre>\n\n<p>For the above, I use    </p>\n\n<pre><code>http.HandleFunc(\"/product\", AddProduct)\n\nfunc AddProduct(w http.ResponseWriter, r *http.Request) {\n  if r.Method == \"POST\" {\n   // My code\n  }\n}\n</code></pre>\n\n<p><strong>I want to know how to implement the following:</strong></p>\n\n<p>GET API to get list of items for a particular Product</p>\n\n<pre><code>http://localhost/product/23\n</code></pre>\n\n<p>POST API to add an item within a product</p>\n\n<pre><code>http://localhost/product/23/item\n</code></pre>\n\n<p>GET API to return Item details</p>\n\n<pre><code>http://localhost/product/23/item/4\n</code></pre>\n\n<p>Note: I've been searching stack overflow for more than 2 hours and not able to find relevant answer. If this is already asked, I'm really sorry... please provide the link in comments.</p>\n"}, {"tags": ["go", "inotify"], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 1, "last_activity_date": 1507479392, "creation_date": 1507479392, "answer_id": 46633268, "question_id": 46632469, "link": "https://stackoverflow.com/questions/46632469/convert-byte-array-into-syscall-inotifyevent-struct-in-golang/46633268#46633268", "title": "convert byte array into syscall.InotifyEvent struct in Golang", "body": "<p>You can use the <code>unsafe</code> package for that:</p>\n\n<pre><code>    info := *((*syscall.InotifyEvent)(unsafe.Pointer(&amp;buff[0])))\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 3578744, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eec258dde99a78e0ad7baf1e6078dd6f?s=128&d=identicon&r=PG&f=1", "display_name": "halherta", "link": "https://stackoverflow.com/users/3578744/halherta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 454, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1507479392, "creation_date": 1507474555, "question_id": 46632469, "link": "https://stackoverflow.com/questions/46632469/convert-byte-array-into-syscall-inotifyevent-struct-in-golang", "title": "convert byte array into syscall.InotifyEvent struct in Golang", "body": "<p>I'm playing around with the inotify functionality in golang's syscall library. I'm able to setup the inotify functionality with <code>InotifyInit</code>, add a file to watch with <code>InotifyAddWatch</code> and detect file changes with the <code>Read</code> function. The problem that I'm having is that the <code>Read</code> function only reads into a byte array containing info about the inotify events. I'd like to convert/cast that byte array into an <code>InotifyEvent</code> structure so that I can access information about the inotify events properly</p>\n\n<p>Below is what I have so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n)\n\nfunc main() {\n    buff := make([]byte, 64)\n    inotefd, err := syscall.InotifyInit()\n    if err != nil {\n        fmt.Println(err)\n    }\n    _, err = syscall.InotifyAddWatch(inotefd, \"/home/me/foo\", syscall.IN_MODIFY)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    for {\n        n, err := syscall.Read(inotefd, buff)\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n\n        if n &lt; 0 {\n            fmt.Println(\"Read Error\")\n            return\n        }\n\n        fmt.Printf(\"Buffer: %v\\n\", buff)\n        //can't cast []buff into InotifyEvent struct\n        fmt.Printf(\"Cookie: %v\\n\", buff[0:4])\n        fmt.Printf(\"Len: %v\\n\", buff[4:8])\n        fmt.Printf(\"Mask: %v\\n\", buff[8:12])\n        fmt.Printf(\"Name: %v\\n\", buff[12:13])\n        fmt.Printf(\"Wd: %v\\n\", buff[13:17])\n    }\n}\n</code></pre>\n\n<p>Thanks for your help !</p>\n"}, {"tags": ["pointers", "go", "interface"], "comments": [{"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1507474393, "post_id": 46632423, "comment_id": 80214117, "body": "using the reflection package"}, {"owner": {"reputation": 1421, "user_id": 706521, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gj7QH.jpg?s=128&g=1", "display_name": "Adrian Forsius", "link": "https://stackoverflow.com/users/706521/adrian-forsius"}, "edited": false, "score": 0, "creation_date": 1507474826, "post_id": 46632423, "comment_id": 80214271, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/6372474/how-to-determine-an-interface-values-real-type\">How to determine an interface{} value&#39;s &quot;real&quot; type?</a>"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 1, "creation_date": 1507479636, "post_id": 46632423, "comment_id": 80215839, "body": "Why don&#39;t you just put the method <code>Tt</code> in the interface and be done? Without using any reflection?"}, {"owner": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 0, "creation_date": 1507489565, "post_id": 46632423, "comment_id": 80219180, "body": "please provide an example where this would be justified. Even intend here seems wrong to me"}, {"owner": {"reputation": 31, "user_id": 1895011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddcd235fc989a9fdd84a9d43c124fd4a?s=128&d=identicon&r=PG", "display_name": "user1895011", "link": "https://stackoverflow.com/users/1895011/user1895011"}, "reply_to_user": {"reputation": 1887, "user_id": 1597656, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/22f0d3352b38fd97b8d86992c5dde179?s=128&d=identicon&r=PG", "display_name": "Yerken", "link": "https://stackoverflow.com/users/1597656/yerken"}, "edited": false, "score": 0, "creation_date": 1507514468, "post_id": 46632423, "comment_id": 80224958, "body": "@Yerken, I have edit to give a more detailed example. I want the function <code>DoSomething</code> accepts both <code>SomeStruct</code> and <code>*SomeStruct</code>"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 1895011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddcd235fc989a9fdd84a9d43c124fd4a?s=128&d=identicon&r=PG", "display_name": "user1895011", "link": "https://stackoverflow.com/users/1895011/user1895011"}, "edited": false, "score": 0, "creation_date": 1507514581, "post_id": 46632940, "comment_id": 80224978, "body": "Yes, that works. But I do think it&#39;s weird that <code>reflect.ValueOf(v)</code> gives <code>A</code> while <code>reflect.ValueOf(&amp;v)</code> gives <code>* interface{}</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 31, "user_id": 1895011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddcd235fc989a9fdd84a9d43c124fd4a?s=128&d=identicon&r=PG", "display_name": "user1895011", "link": "https://stackoverflow.com/users/1895011/user1895011"}, "edited": false, "score": 0, "creation_date": 1507516838, "post_id": 46632940, "comment_id": 80225422, "body": "I added more explanation to the answer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1507516773, "last_edit_date": 1507516773, "creation_date": 1507477329, "answer_id": 46632940, "question_id": 46632423, "link": "https://stackoverflow.com/questions/46632423/how-to-get-the-pointer-to-a-struct-passed-through-interface-in-golang/46632940#46632940", "title": "How to get the pointer to a struct passed through interface{} in golang?", "body": "<p>To call the pointer method <code>Tt()</code>, you must have an <code>*A</code> (or take the address of an <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a> <code>A</code> value).  The <code>A</code> value in variable <code>b</code> is not <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a>, and therefore the <code>A</code> pointer methods are not accessible through <code>b</code>. </p>\n\n<p>The fix is to start with the address of <code>a</code>:</p>\n\n<pre><code>var a A\nvar b interface{}\nb = &amp;a // Note change on this line\nswitch v := b.(type) {\ndefault:\n    reflect.ValueOf(v).MethodByName(\"Tt\").Call(nil)\n}\n</code></pre>\n\n<p>In the call <code>reflect.ValueOf(v)</code>, the value in <code>v</code> is passed as the argument. The <code>ValueOf</code> function unpacks the empty interface to recover a value of type <code>A</code>.</p>\n\n<p>In the call <code>reflect.ValueOf(&amp;v)</code>, an <code>*interface{}</code> is stored in the empty interface, which is then passed as the argument. The <code>ValueOf</code> function unpacks the empty interface to recover a value of type <code>*interface{}</code>. This is the address of the variable <code>v</code>, not the address of the variable <code>a</code>.</p>\n\n<p>Reflection is not required in this specific example:</p>\n\n<pre><code>var a A\nvar b interface{}\nb = &amp;a\nswitch v := b.(type) {\ncase interface {\n    Tt()\n}:\n    v.Tt()\ndefault:\n    fmt.Println(\"not handled\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8879545, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/cb7980cdf39f14c1c849c59d686e780e?s=128&d=identicon&r=PG", "display_name": "user11", "link": "https://stackoverflow.com/users/8879545/user11"}, "is_accepted": false, "score": 0, "last_activity_date": 1509699777, "creation_date": 1509699777, "answer_id": 47091855, "question_id": 46632423, "link": "https://stackoverflow.com/questions/46632423/how-to-get-the-pointer-to-a-struct-passed-through-interface-in-golang/47091855#47091855", "title": "How to get the pointer to a struct passed through interface{} in golang?", "body": "<p>You need just type cast.\nExample:</p>\n\n<pre><code>type SomeStruct1 struct{\n    someList []string\n}\n\nfunc (s *SomeStruct1) print() {\n    fmt.Printf(\"%v\\n\", s.someList)\n...\n\nfunc Call(T interface{}){\n    switch T.(type){\n    case *SomeStruct1:\n        t := T.(*SomeStruct1) // cast as pointer to struct\n        t.print()\n    ...\n    }\n}\n\nfunc main() {\n    a := SomeStruct{\n        someList: []string{\"a\", \"b\"}\n    }\n    Call(&amp;a) // pass a as ptr\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3820, "user_id": 4754037, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-EpB-u9D7emI/AAAAAAAAAAI/AAAAAAAAAAA/LsS3R-k2AUY/photo.jpg?sz=128", "display_name": "shawn", "link": "https://stackoverflow.com/users/4754037/shawn"}, "is_accepted": false, "score": 4, "last_activity_date": 1530929063, "creation_date": 1530929063, "answer_id": 51219342, "question_id": 46632423, "link": "https://stackoverflow.com/questions/46632423/how-to-get-the-pointer-to-a-struct-passed-through-interface-in-golang/51219342#51219342", "title": "How to get the pointer to a struct passed through interface{} in golang?", "body": "<p>Use reflection:</p>\n\n<pre><code>//\n// Return a pointer to the supplied struct via interface{}\n//\nfunc to_struct_ptr(obj interface{}) interface{} {\n    vp := reflect.New(reflect.TypeOf(obj))\n    vp.Elem().Set(reflect.ValueOf(obj))\n    return vp.Interface()\n}\n</code></pre>\n\n<p>Pass in an <code>interface</code> with <code>T</code>, then you can get an <code>interface</code> with <code>*T</code></p>\n"}], "owner": {"reputation": 31, "user_id": 1895011, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddcd235fc989a9fdd84a9d43c124fd4a?s=128&d=identicon&r=PG", "display_name": "user1895011", "link": "https://stackoverflow.com/users/1895011/user1895011"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2579, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1530929063, "creation_date": 1507474256, "last_edit_date": 1507514266, "question_id": 46632423, "link": "https://stackoverflow.com/questions/46632423/how-to-get-the-pointer-to-a-struct-passed-through-interface-in-golang", "title": "How to get the pointer to a struct passed through interface{} in golang?", "body": "<blockquote>\n  <p>No, I don't think this is a duplicate of \n   <a href=\"https://stackoverflow.com/questions/6372474/how-to-determine-an-interface-values-real-type\">How to determine an interface{} value&#39;s &quot;real&quot; type?</a>. I know how to get the Type of an interface variable, but I can't find a way to get the pointer to an interface{}'s real type.</p>\n</blockquote>\n\n<p>Recently, I got into trouble with <code>interface{}</code>. I have a variable with type A been passed through <code>interface{}</code>, a method <code>Tt</code> is defined with *A as the receiver.</p>\n\n<p>I want to call the method <code>Tt</code> but failed because the variable is in an <code>interface{}</code> and I can't get the pointer to the variable.</p>\n\n<p>As you can see, <code>reflect.TypeOf(v)</code> gives the correct type <code>A</code>, but <code>reflect.TypeOf(&amp;v)</code> gives <code>*interface {}</code> instead of <code>*A</code>.</p>\n\n<p>Is there any way to get <code>*A</code>?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype SomeStruct1 struct{\n}\n\ntype SomeStruct2 struct{\n}\n\ntype SomeStruct3 struct{\n}\netc...\n\nfunc (*SomeStruct1) SomeMethod(){\n    fmt.Println(\"hello\")\n}\nfunc (*SomeStruct2) SomeMethod(){\n    fmt.Println(\"hello\")\n}\nfunc (*SomeStruct3) SomeMethod(){\n    fmt.Println(\"hello\")\n}\netc...\n\nfunc DoSomething(arg interface{}){\n    switch v:=b.(type){\n        []byte:{\n            dosomething for []byte\n        }\n        default:{\n            var m reflect.Value\n            if value.Kind() != reflect.Ptr {\n                m = reflect.ValueOf(&amp;v).MethodByName(\"SomeMethod\")\n            } else {\n                m = reflect.ValueOf(v).MethodByName(\"SomeMethod\")\n            }\n            m.Call(nil)\n        }\n}\n\nfunc main() {\n    DoSomething([]byte{...})\n    DoSomething(SomeStruct1{})\n    DoSomething(&amp;SomeStruct1{})\n    etc..\n}\n</code></pre>\n"}, {"tags": ["go", "static-libraries", "dependency-management", "libtool"], "answers": [{"tags": [], "owner": {"reputation": 14789, "user_id": 425738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58622287beb9cbbd6a1faff38c1c6ab3?s=128&d=identicon&r=PG", "display_name": "ldav1s", "link": "https://stackoverflow.com/users/425738/ldav1s"}, "is_accepted": true, "score": 1, "last_activity_date": 1507512810, "creation_date": 1507512810, "answer_id": 46637716, "question_id": 46632362, "link": "https://stackoverflow.com/questions/46632362/can-i-use-libtool-output-in-cgo/46637716#46637716", "title": "Can I use libtool output in cgo?", "body": "<blockquote>\n  <p>can I make use of libfoo.la when I build golang?</p>\n</blockquote>\n\n<p>No.  Go has it's own build system that doesn't know about libtool archives, only the standard static/shared libraries available on the system.</p>\n\n<blockquote>\n  <p>Now I am calling libfoo.a in golang, but the dependencies can be complicated. </p>\n</blockquote>\n\n<p>That's how it is with static libs.  Which is one reason for using shared libs instead.  Shared libs are also not trouble-free in Go, but are somewhat manageable.  </p>\n\n<blockquote>\n  <p>libfoo.a depends on libbar.a ,libbar.a depends on libhaha.a.</p>\n</blockquote>\n\n<p>Doesn't something like:</p>\n\n<pre><code>package foo\n\n\n// #cgo CFLAGS: -I...\n// #cgo LDFLAGS: -L... -lfoo -lbar -lhaha -lm\n// #include ...\nimport \"C\"\n...\n</code></pre>\n\n<p>work?</p>\n\n<blockquote>\n  <p>or some way make libfoo.a and all its dependencies into one lib file?</p>\n</blockquote>\n\n<p>Yes, that's possible but another question.</p>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 46637716, "answer_count": 1, "score": 1, "last_activity_date": 1507512810, "creation_date": 1507473877, "question_id": 46632362, "link": "https://stackoverflow.com/questions/46632362/can-i-use-libtool-output-in-cgo", "title": "Can I use libtool output in cgo?", "body": "<p>I am call static library which is compiled from c++ source. But It is tiring to write dependency libs and I find that libtool just do very well, for example, my <code>libfoo.la</code> will have something like this:</p>\n\n<pre><code>dependency_libs=\u2018 /Users/roger/example/lib/bar/libbar.la -lm\u2019\n</code></pre>\n\n<p>Now I am calling <code>libfoo.a</code> in golang, but the dependencies can be complicated. <code>libfoo.a</code>depends on <code>libbar.a</code> ,<code>libbar.a</code> depends on <code>libhaha.a</code>. <strong>can I make use of <code>libfoo.la</code> when I build golang?</strong>(or some way make <code>libfoo.a</code> and all its dependencies into one lib file?)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507470205, "post_id": 46630837, "comment_id": 80212850, "body": "And though you should prefer build constraints, there are also the <code>runtime.GOOS</code> and <code>runtime.GOARCH</code> constants: <a href=\"https://golang.org/pkg/runtime/#pkg-constants\" rel=\"nofollow noreferrer\">golang.org/pkg/runtime/#pkg-constants</a>"}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 6, "last_activity_date": 1507464978, "last_edit_date": 1507464978, "creation_date": 1507464669, "answer_id": 46630969, "question_id": 46630837, "link": "https://stackoverflow.com/questions/46630837/compiler-time-code-blocks/46630969#46630969", "title": "Compiler time code blocks", "body": "<p>Go resolves this automatically in build-time. All you need to place the code in corresponding files:</p>\n\n<ul>\n<li><code>file_linux.go</code> - code for linux version</li>\n<li><code>file_windows.go</code> - code for windows version.</li>\n</ul>\n\n<blockquote>\n  <p>If a file's name, after stripping the extension and a possible <code>_test</code> suffix, matches any of the following patterns:</p>\n  \n  <p>*_GOOS</p>\n  \n  <p>*_GOARCH</p>\n  \n  <p>*_GOOS_GOARCH \n  (example: <code>source_windows_amd64.go</code>) </p>\n  \n  <p>where GOOS and GOARCH represent any known operating system and architecture values\n  respectively, then the file is considered to have an implicit build\n  constraint requiring those terms (in addition to any explicit\n  constraints in the file).</p>\n  \n  <p>Naming a file <code>dns_windows.go</code> will cause it to be included only when\n  building the package for Windows; similarly, <code>math_386.s</code> will be\n  included only when building the package for 32-bit x86.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"noreferrer\">https://golang.org/pkg/go/build/#hdr-Build_Constraints</a></p>\n"}], "owner": {"reputation": 6743, "user_id": 1432751, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e80f2b22b8c98730708ad3842c11604b?s=128&d=identicon&r=PG", "display_name": "Dmitry Bubnenkov", "link": "https://stackoverflow.com/users/1432751/dmitry-bubnenkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507464978, "creation_date": 1507463862, "question_id": 46630837, "link": "https://stackoverflow.com/questions/46630837/compiler-time-code-blocks", "title": "Compiler time code blocks", "body": "<p>Is it possible to detect for example OS name at compiler time and compiler specified code block like:</p>\n\n<pre><code>version(windows)\n{\n}\n\nversion(linux)\n{\n}\n</code></pre>\n"}, {"tags": ["go", "google-speech-api"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507460851, "post_id": 46629130, "comment_id": 80210347, "body": "<a href=\"https://rakyll.org/grpc-streaming/\" rel=\"nofollow noreferrer\">rakyll.org/grpc-streaming</a>"}, {"owner": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507528719, "post_id": 46629130, "comment_id": 80228416, "body": "@Pozo Sample given on the provided link same as livecaption sample <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/speech/livecaption/livecaption.go\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/golang-samples/blob/master/&hellip;</a> where voice stream read from Stdin. but in my case voice is streamed from browser"}, {"owner": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507906396, "post_id": 46629130, "comment_id": 80411689, "body": "I got the the issue. issue with the Single-Utterance. If I pause then steaming get closed. We need to re-initialize.  In the GetResult Function added the below code section      &#39;defer func() { \t\tif r := recover(); r != nil { \t\t\tlog.Println(&quot;In getResults got panic: &quot;, r) \t\t\tInitAudio(&amp;ctx, &amp;client, stream) \t\t} \t }()&#39;"}], "owner": {"reputation": 387, "user_id": 2432174, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/ioAZo.jpg?s=128&g=1", "display_name": "dinu0101", "link": "https://stackoverflow.com/users/2432174/dinu0101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 284, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1507452034, "creation_date": 1507452034, "question_id": 46629130, "link": "https://stackoverflow.com/questions/46629130/go-app-server-speech-response-only-3-4-seconds", "title": "Go App server Speech Response only 3-4 seconds", "body": "<p>I want to make Speech-to-Text application with Google speech engine and Go lang HTTP server.\nEverything is working as per expected but one issue I am facing and unable to find where I am doing wrong. \nProblem is that, when am start speaking Google speech engine response only 3-4 seconds, after that I need to start again or 1 min expire then start.\nI am beginner to GO-lang And I spend 2 days only on debugging. Please help me out here. I need your help.</p>\n\n<p>Thanks in Advance</p>\n\n<p>Go-Lang source: main.go , recognize package </p>\n\n<pre><code>package main\nimport(\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n    \"vrecognize\"\n\n    gmux \"github.com/gorilla/mux\"\n    \"github.com/gorilla/websocket\"\n     speechpb \"google.golang.org/genproto/googleapis/cloud/speech/v1\"\n)\n var upgrader = websocket.Upgrader{} // use default options\n var voiceRecognize = new(vrecognize.VoiceRecognize)\n var voiceStream vrecognize.VoiceStream\n\nfunc main() {\n   mux := gmux.NewRouter().StrictSlash(true)\n\n   mux.HandleFunc(\"/echo\", echo)\n   mux.PathPrefix(\"/\").Handler(http.FileServer(http.Dir(\"./public\")))\n   http.ListenAndServe(\":8080\", mux)\n}\n\nfunc echo(w http.ResponseWriter, r *http.Request) {\nconn, err := upgrader.Upgrade(w, r, nil)\nif err != nil {\n    log.Print(\"upgrade:\", err)\n    return\n}\ndefer conn.Close()\n\nvoiceRecognize := voiceRecognize.NewRecongnize(1, 48000, \"en_US\")\nvar stream speechpb.Speech_StreamingRecognizeClient\n\nvar msgStr string\nfor {\n    mt, message, err := conn.ReadMessage()\n    if err != nil {\n        log.Println(\"read:\", err)\n        return\n    }\n    // Message received as Text\n    if mt == websocket.TextMessage {\n        //Convert byte to string\n        msgStr = string(message)\n        //is received msg if command of text\n        isEcho := strings.HasPrefix(msgStr, \"echo\")\n        //if text, will remove echo\n        if isEcho {\n            msgStr = msgStr[4:len(msgStr)]\n        }\n        //start Audio, will initalize Audio\n        if msgStr == \"start\" {\n            stream = voiceStream.InitAudio(voiceRecognize.Encoding, voiceRecognize.SampleRateHertz, voiceRecognize.LanguageCode)\n            if stream == nil {\n                fmt.Println(\"initAudio failed!!!\")\n                conn.WriteMessage(websocket.TextMessage, []byte(\"speechInitFail\"))\n                break\n            } else {\n                //Routine will listen the result\n                go voiceStream.GetResults(&amp;stream, conn, voiceRecognize)\n            }\n        } else if msgStr == \"stop\" { //on stop will close the stream conn\n            if err := stream.CloseSend(); err != nil {\n                log.Printf(\"Could not close stream: %v\", err)\n                break\n            }\n        } else if isEcho { //echo message\n            log.Printf(\"recv: %s\", msgStr)\n            err = conn.WriteMessage(mt, []byte(msgStr))\n            if err != nil {\n                log.Println(\"write: \", err)\n                break\n            }\n        } else {\n            fmt.Println(\"no handling for: \", string(message))\n        }\n    } else if mt == websocket.BinaryMessage {\n        //Send voice to process\n        voiceStream.SendData(&amp;stream, &amp;message)\n    }\n  }\n}\n---------------------------\npackage vrecognize\n\nimport (\n\"io\"\n\"log\"\n\n\"cloud.google.com/go/speech/apiv1\"\n\"github.com/gorilla/websocket\"\n\"golang.org/x/net/context\"\nspeechpb \"google.golang.org/genproto/googleapis/cloud/speech/v1\"\n)\n\n//VoiceStream : Voice related configuratin\n type VoiceStream struct {\n }\n\n //GetResults : Take the stream result whenever available\n func (vs VoiceStream) GetResults(stream \n   *speechpb.Speech_StreamingRecognizeClient, conn *websocket.Conn, vr \n   *VoiceRecognize) {\n\n  defer func() {\n    if r := recover(); r != nil {\n        log.Println(\"In getResults got panic: \", r)\n        *stream = vs.InitAudio(vr.Encoding, vr.SampleRateHertz, vr.LanguageCode)\n    }\n}()\nfor {\n    resp, err := (*stream).Recv()\n    if err == io.EOF {\n        log.Printf(\"Reciever EOF: %v\", err)\n        conn.WriteMessage(websocket.TextMessage, []byte(\"MinuteDone\"))\n    }\n\n    if err != nil {\n        log.Printf(\"Cannot stream results: %v\", err)\n        conn.WriteMessage(websocket.TextMessage, []byte(\"VoiceInterrupted\"))\n    }\n    if err := resp.Error; err != nil {\n        log.Printf(\"Could not recognize: %v\", err)\n        conn.WriteMessage(websocket.TextMessage, []byte(\"NotRecognize\"))\n    }\n\n    for _, result := range resp.Results {\n\n        for _, altr := range result.GetAlternatives() {\n            msg := altr.GetTranscript()\n            log.Printf(\"Result: %+v\\n\", msg)\n            conn.WriteMessage(websocket.TextMessage, []byte(msg))\n        }\n    }\n    //log.Printf(\"Loop last...\")\n}\n\n}\n\n//InitAudio - This will initalize the Audio and will listen the incomming audio\n func (vs VoiceStream) InitAudio(audioEnco speechpb.RecognitionConfig_AudioEncoding, sampleRate int32, lang string) speechpb.Speech_StreamingRecognizeClient {\n//log.Printf(\"Speech Init strat...\")\nctx := context.Background()\nclient, err := speech.NewClient(ctx)\nif err != nil {\n    log.Fatal(err)\n    return nil\n}\nstream, err2 := client.StreamingRecognize(ctx)\nif err2 != nil {\n    log.Fatal(err2)\n    return nil\n}\n//Send 1st send configuration\nerr = stream.Send(&amp;speechpb.StreamingRecognizeRequest{\n    StreamingRequest: &amp;speechpb.StreamingRecognizeRequest_StreamingConfig{\n        StreamingConfig: &amp;speechpb.StreamingRecognitionConfig{\n            Config: &amp;speechpb.RecognitionConfig{\n                Encoding:        audioEnco, \n                SampleRateHertz: sampleRate,\n                LanguageCode:    lang,\n            },\n            InterimResults:  true,\n            SingleUtterance: true,\n        },\n    },\n})\nif err != nil {\n    log.Fatal(err)\n    return nil\n}\n//log.Printf(\"Speech Init finished...\")\nreturn stream\n}\n\n //SendData This will send the data to Speech API\nfunc (vs VoiceStream) SendData(stream *speechpb.Speech_StreamingRecognizeClient, message *[]byte) {\n//log.Printf(\"SendData Called ...\")\nif err := (*stream).Send(&amp;speechpb.StreamingRecognizeRequest{\n    StreamingRequest: &amp;speechpb.StreamingRecognizeRequest_AudioContent{\n        AudioContent: *message,\n    },\n}); err != nil {\n    log.Printf(\"Could not send audio: %v\", err)\n}\n  return\n}\n\n//VoiceRecognize Class\ntype VoiceRecognize struct {\nEncoding        speechpb.RecognitionConfig_AudioEncoding\nSampleRateHertz int32\nLanguageCode    string\n}\n\n//NewRecongnize : pass parameters\nfunc (vr VoiceRecognize) NewRecongnize(audioencoding, HertzRate int32, \n  language string) *VoiceRecognize {\n  var Encoding speechpb.RecognitionConfig_AudioEncoding\n  switch audioencoding {\n    case 0:\n    // Not specified. Will return result [google.rpc.Code.INVALID_ARGUMENT]\n   [google.rpc.Code.INVALID_ARGUMENT].\n    Encoding = speechpb.RecognitionConfig_ENCODING_UNSPECIFIED\ncase 1:\n    // Uncompressed 16-bit signed little-endian samples (Linear PCM).\n    Encoding = speechpb.RecognitionConfig_LINEAR16\ncase 2:\n    // [`FLAC`](https://xiph.org/flac/documentation.html) (Free Lossless Audio\n    // Codec) is the recommended encoding because it is\n    // lossless--therefore recognition is not compromised--and\n    // requires only about half the bandwidth of `LINEAR16`.\n    Encoding = speechpb.RecognitionConfig_FLAC\ncase 3:\n    // 8-bit samples that compand 14-bit audio samples using G.711 PCMU/mu-law.\n    Encoding = speechpb.RecognitionConfig_MULAW\ncase 4:\n    // Adaptive Multi-Rate Narrowband codec. `sample_rate_hertz` must be 8000.\n    Encoding = speechpb.RecognitionConfig_AMR\ncase 5:\n    // Adaptive Multi-Rate Wideband codec. `sample_rate_hertz` must be 16000.\n    Encoding = speechpb.RecognitionConfig_AMR_WB\ncase 6:\n    // Opus encoded audio frames in Ogg container\n    // ([OggOpus](https://wiki.xiph.org/OggOpus)).\n    // `sample_rate_hertz` must be 16000.\n    Encoding = speechpb.RecognitionConfig_OGG_OPUS\ndefault:\n    // Uncompressed 16-bit signed little-endian samples (Linear PCM).\n    Encoding = speechpb.RecognitionConfig_LINEAR16\n}\nreturn &amp;VoiceRecognize{Encoding, HertzRate, language}\n}\n</code></pre>\n\n<p>And index.html code:</p>\n\n<pre><code> &lt;!DOCTYPE html&gt;\n  &lt;html&gt;\n   &lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Golang WebSocket&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n  &lt;form&gt;\n   &lt;input id=\"message\" type=\"text\" value=\"What are you doing\"&gt;\n   &lt;input onclick=\"wsConnect();\" id=\"connectBtn\" value=\"Connect\" \n     type=\"button\"/&gt;\n   &lt;input onclick=\"wsSendMessage();\" id=\"echoBtn\" value=\"Echo\" type=\"button\"/&gt;\n&lt;br/&gt;\n&lt;input onclick=\"startAudio();\" id=\"startBtn\" value=\"Start Audio\" type=\"button\"/&gt;\n &lt;/form&gt;\n &lt;br/&gt;\n &lt;h2&gt;Log&lt;/h2&gt;\n &lt;pre id=\"log\"&gt;&lt;/pre&gt;\n &lt;h2&gt;Server Response&lt;/h2&gt;\n &lt;pre id=\"serResp\"&gt;&lt;/pre&gt;\n &lt;script type=\"text/javascript\"&gt;\n   var webSocket = null;\n   var audioStream = null;\n   var context = null;\n   function __log(e, data) {\n    if(e.type !=\"error\"){\n        log.innerHTML += \"\\n\" + e + \" \" + (data || '');\n    }\n  }\n  function serverResponse(e, data){\n    serResp.innerHTML = \"\\n\" + e + \" \" + (data || '');\n  }\n  function wsConnect() {\n    webSocket = new WebSocket(\"ws://\"+window.location.host+\"/echo\");\n\n    var message = document.getElementById(\"message\");\n    webSocket.onopen = function (message) {\n        wsOpen(message);\n    };\n    webSocket.onmessage = function (message) {\n        wsGetMessage(message);\n    };\n    webSocket.onclose = function (message) {\n        wsClose(message);\n    };\n    webSocket.onerror = function (message) {\n        wsError(message);\n    };\n }\n\n function wsError(message) {\n    console.log(message);\n    __log(message);\n }\n\n function wsOpen(message) {\n    __log(\"Connected ...\");\n    if(message.type === \"open\"){\n        document.getElementById(\"connectBtn\").disabled = true;\n        document.getElementById(\"startBtn\").disabled = false;\n        document.getElementById(\"echoBtn\").disabled = false;\n        if(document.getElementById(\"stopBtn\") != undefined){\n            document.getElementById(\"stopBtn\").disabled = false;   \n        }\n    }\n }\n\n function wsSendMessage() {\n    __log(\"From Browser: \"+ message.value);\n    webSocket.send(\"echo\"+message.value);\n    document.getElementById(\"message\").value = \"\"; \n }\n\n function wsCloseConnection() {\n    webSocket.close();\n }\n\n function wsGetMessage(message) {\n    console.log(\"Server: \"+ message.data);\n    msg = message.data;\n    if(msg == \"VoiceInterrupted\" || msg == \"MinuteDone\" || msg == \n  \"NotRecognize\" || msg == \"speechInitFail\"){\n        stopAudio();\n        startAudio();\n    }else{\n        serverResponse(\"Server: \" + message.data);\n    }   \n }\n\nfunction wsClose(message) {\n    __log(\"Disconnect ... \");\n    if(message.type === \"close\"){\n    document.getElementById(\"connectBtn\").disabled = false;\n    document.getElementById(\"startBtn\").disabled = true;\n    document.getElementById(\"echoBtn\").disabled = true;\n    }\n }\n\n function wserror(message) {\n    __log(\"Error ...\"+ message);\n }\n\n function sendStart() {\n    webSocket.send(\"start\")\n }\n\n function startAudio() {\n    var session = {\n        audio: true,\n        video: false\n    };\n    sendStart();\n    var isMediaReady = true;\n    navigator.mediaDevices.getUserMedia(session).then(function (stream) {\n        initializeRecorder(stream);\n    }).catch(function (err) {\n        onError(err);\n        document.getElementById(\"startBtn\").disabled = false;\n    });\n    document.getElementById(\"startBtn\").disabled = true;\n    setTimeout(stopAudio,55*1000);\n }\n\n function onError(err) {\n    __log(\"Error while calling getUserMedia:\" + err);\n }\n\n function initializeRecorder(stream) {\n    __log(\"initializeRecorder called...\");\n    audioStream = stream;\n    var audioContext = window.AudioContext;\n    context = new audioContext();\n    var audioInput = context.createMediaStreamSource(stream);\n    var bufferSize = 1*4*1024;\n    // create a javascript node\n    var recorder = context.createScriptProcessor(bufferSize, 1, 1);\n    // specify the processing function\n    recorder.onaudioprocess = recorderProcess;\n    // connect stream to our recorder\n    audioInput.connect(recorder);\n    // connect our recorder to the previous destination\n    recorder.connect(context.destination);\n }\n\n function convertFloat32ToInt16(buffer) {\n    l = buffer.length;\n    buf = new Int16Array(l);\n    while (l--) {\n        buf[l] = Math.min(1, buffer[l]) * 0x7FFF;\n    }\n    return buf.buffer;\n }\n\n function recorderProcess(e) {\n    var left = e.inputBuffer.getChannelData(0);\n    webSocket.send(convertFloat32ToInt16(left));\n }\n\n function stopAudio() {\n    __log(\"stop audio called...\");\n    document.getElementById(\"startBtn\").disabled = false;\n    context.close();\n    context = null;\n    webSocket.send(\"stop\")\n    var audioTrack = audioStream.getAudioTracks();\n    var i = 0;\n\n    for (i = 0; i &lt; audioTrack.length; i++) {\n        var track = audioTrack[i];\n        track.stop();\n        audioStream.removeTrack(track);\n    }\n    audioStream = null;\n }\n &lt;/script&gt;\n &lt;/body&gt;\n &lt;/html&gt;\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "is_accepted": false, "score": 9, "last_activity_date": 1507454052, "last_edit_date": 1507454052, "creation_date": 1507450713, "answer_id": 46628964, "question_id": 46628683, "link": "https://stackoverflow.com/questions/46628683/extend-slice-length-on-the-left/46628964#46628964", "title": "Extend slice length on the left", "body": "<p>When you make a new slice from the 2nd index in the underlying array, like you do with <code>s = s[1:4]</code>, then you have lost the reference to the first element in the underlying array. </p>\n\n<p>And since the slice operator <code>s[i:j]</code> requires <code>i &gt;= 0</code>, you can no longer access the first element in the original array by further slicing your existing slice.</p>\n\n<p>You could keep the original array around, however:</p>\n\n<pre><code>func main() {\n    a := [...]int{2, 3, 5, 7, 11, 13}\n\n    s := a[1:4]\n    fmt.Println(s)      // [3 5 7]\n    fmt.Println(len(s)) // 3\n\n    s = s[:4]\n    fmt.Println(s)      // [3 5 7 11]\n    fmt.Println(len(s)) // 4\n\n    s = a[:]\n    fmt.Println(s) // [2 3 5 7 11 13]\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4398, "user_id": 192798, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f274e5923df2500d276fba5c824bb326?s=128&d=identicon&r=PG", "display_name": "Jayen", "link": "https://stackoverflow.com/users/192798/jayen"}, "edited": false, "score": 0, "creation_date": 1557653854, "post_id": 46635129, "comment_id": 98830962, "body": "isn&#39;t the upper index bound cap(b) (cap(a) minus the start of b)? in this case, 5 not 6?"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 4398, "user_id": 192798, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f274e5923df2500d276fba5c824bb326?s=128&d=identicon&r=PG", "display_name": "Jayen", "link": "https://stackoverflow.com/users/192798/jayen"}, "edited": false, "score": 0, "creation_date": 1562155214, "post_id": 46635129, "comment_id": 100287829, "body": "The quote is verbatim from the spec, it doesn&#39;t refer to the examples I gave above, just a generic example array a, so say that for a slice based on array a, the upper index bound is capacity of a, not length."}, {"owner": {"reputation": 4398, "user_id": 192798, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f274e5923df2500d276fba5c824bb326?s=128&d=identicon&r=PG", "display_name": "Jayen", "link": "https://stackoverflow.com/users/192798/jayen"}, "edited": false, "score": 0, "creation_date": 1562668805, "post_id": 46635129, "comment_id": 100440014, "body": "Do you mean it&#39;s a generic example slice <code>a</code> and the upper index bound is the capacity of the slice, not the array on which is based?  The spec is really confusing me as it has <code>a</code> as an array and then a slice, and then your comment also confuses me as it talks about an array <code>a</code> instead of a slice <code>a</code> of an array."}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 4398, "user_id": 192798, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f274e5923df2500d276fba5c824bb326?s=128&d=identicon&r=PG", "display_name": "Jayen", "link": "https://stackoverflow.com/users/192798/jayen"}, "edited": false, "score": 0, "creation_date": 1562679885, "post_id": 46635129, "comment_id": 100446371, "body": "Ah yes I see what you mean, I think really the spec should be consistent and stick with s for slice. I&#39;m not sure I understand the index section in the spec, but I think it&#39;s talking about slice expressions specifically (NOT indexing as in [0] but [1:2]), for those you are allowed to go beyond the official bounds of the slice to the right, but not to the left (which is weird and icky, as discussed above). I think it&#39;s just a wart caused by them not wanting to rebuild array backing unnecessarily."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 16, "last_activity_date": 1507490878, "last_edit_date": 1507490878, "creation_date": 1507490471, "answer_id": 46635129, "question_id": 46628683, "link": "https://stackoverflow.com/questions/46628683/extend-slice-length-on-the-left/46635129#46635129", "title": "Extend slice length on the left", "body": "<p>Firstly, to answer your question, no it's not possible to use negative indices or access that data except by keeping a copy of the original slice. </p>\n\n<p>However this is an interesting question, as there is an inconsistency here that you've pointed out, which is probably more what you're asking about. If you start with a slice as <a href=\"https://play.golang.org/p/fIIuxCn4gs\" rel=\"noreferrer\">here</a>:</p>\n\n<pre><code>a := []int{2, 3, 5, 7, 11, 13}\nfmt.Println(a,len(a),cap(a)) \n</code></pre>\n\n<blockquote>\n  <p>[2 3 5 7 11 13] 6 6</p>\n</blockquote>\n\n<p>And take a slice of just the middle</p>\n\n<pre><code>b := a[1:2]\nfmt.Println(b,len(b),cap(b)) \n</code></pre>\n\n<blockquote>\n  <p>[3] 1 5</p>\n</blockquote>\n\n<p>You are not allowed to access indexes in the original data past that slice len, as you'd expect:</p>\n\n<pre><code>fmt.Println(b[3]) \n</code></pre>\n\n<blockquote>\n  <p>panic: runtime error: index out of range</p>\n</blockquote>\n\n<p>You are not allowed to reslice to include that data again from before the start index:</p>\n\n<pre><code>d := b[-1:]\n</code></pre>\n\n<blockquote>\n  <p>invalid slice index -1 (index must be non-negative)</p>\n</blockquote>\n\n<p>But you <strong>are</strong> allowed to reslice to include that data again after the len up to cap, which is a little odd:</p>\n\n<pre><code>// This is beyond the length of b, you can't index those, \n// but you can access them by reslicing \nc := b[:5]\n</code></pre>\n\n<blockquote>\n  <p>[3 5 7 11 13] 5 5</p>\n</blockquote>\n\n<p>This is a bit inconsistent as most other operations on slice data are bounded by the offset into the data and the len, not the cap and original data length. However, this is explicitly stated in the spec and is probably just an artefact of how slices represent the view onto the original array rather than an intentional design decision to provide access to that data. It might be nice if you could get back to the original storage, since it is still in memory, but it seems you can only see the end of the array up to cap, not the start after you have sliced once. From the <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"noreferrer\">spec</a> about limits on slicing indexes: </p>\n\n<blockquote>\n  <p>For arrays or strings, the indices are in range if 0 &lt;= low &lt;= high &lt;=\n  len(a), otherwise they are out of range. <strong>For slices, the upper index\n  bound is the slice capacity cap(a) rather than the length</strong>. A constant\n  index must be non-negative and representable by a value of type int;\n  for arrays or constant strings, constant indices must also be in\n  range. If both indices are constant, they must satisfy low &lt;= high. If\n  the indices are out of range at run time, a run-time panic occurs.</p>\n</blockquote>\n\n<p>It would probably be better to be safe and use the original slice to create different views on the data, rather than relying on this behaviour. </p>\n"}, {"tags": [], "owner": {"reputation": 358, "user_id": 6267238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b53d46b675ae20a5956ccc01ec32faa6?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Carlson", "link": "https://stackoverflow.com/users/6267238/jason-carlson"}, "is_accepted": false, "score": 3, "last_activity_date": 1536858430, "last_edit_date": 1592644375, "creation_date": 1536802968, "answer_id": 52305520, "question_id": 46628683, "link": "https://stackoverflow.com/questions/46628683/extend-slice-length-on-the-left/52305520#52305520", "title": "Extend slice length on the left", "body": "<p>Let's look at the type definition of the slice header <a href=\"https://golang.org/src/runtime/slice.go\" rel=\"nofollow noreferrer\">from the Go source code</a>.</p>\n<pre><code>type slice struct {\n    array unsafe.Pointer\n    len   int\n    cap   int\n}\n</code></pre>\n<p>The name of the &quot;array&quot; field is slightly misleading, as it's not a reference to an array type like you would get from a statement <code>a := [10]int{}; p := &amp;a</code>, but rather a pointer to a specific element within an array (the element which is the first element of the slice).</p>\n<p>Now, if you look at the <code>unsafe</code> <a href=\"https://golang.org/pkg/unsafe/#Pointer\" rel=\"nofollow noreferrer\">package documentation</a>, you might notice that incrementing an <code>unsafe.Pointer</code> into memory that is not allocated is an invalid operation:</p>\n<blockquote>\n<p>It is valid both to add and to subtract offsets from a pointer in this way. It is also valid to use &amp;^ to round pointers, usually for alignment. In all cases, the result must continue to point into the original allocated object.</p>\n<p>Unlike in C, it is not valid to advance a pointer just beyond the end of its original allocation...</p>\n</blockquote>\n<p>Despite this, there is no guarantee that this will actually be checked at runtime, so it's often perfectly possible and trivial to end up with an <code>unsafe.Pointer</code> that points to unallocated memory, as in the following example:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;unsafe&quot;\n)\n\nfunc main() {\n\n    a := [10]int{}\n    for i := range a {\n        a[i] = i + 1\n    }\n    fmt.Printf(&quot;a: %v\\n&quot;, a)\n\n    s := a[2:5]\n\n    p := unsafe.Pointer(&amp;s[0])\n    fmt.Printf(&quot;p initially points at the 3rd element of a...\\n&quot;)\n\n    // Let's break the rules!\n    for i := 0; i &lt; 15; i++ {\n        if i == len(s) {\n            fmt.Printf(&quot;We've hit the end of slice s, but there is still memory allocated past this in the backing array a...\\n&quot;)\n        }\n        if i == cap(s) {\n            fmt.Printf(&quot;We're in invalid/undefined territory now...\\n&quot;)\n        }\n        fmt.Printf(&quot;addr: %v    val: %v\\n&quot;, uintptr(p), *(*int)(p))\n        p = unsafe.Pointer(uintptr(p) + unsafe.Sizeof(s[0]))\n    }\n}\n</code></pre>\n<p><a href=\"https://play.golang.org/p/4vF-7z45PP5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4vF-7z45PP5</a></p>\n<p>So, what does all this mean for extending a slice? Lets say you reslice a slice <code>s</code> like so:</p>\n<pre><code>t = s[a:b]\n</code></pre>\n<p>Then calculating the new slice header for <code>t</code> is trivial, given the header for <code>s</code>:</p>\n<pre><code>t.array = unsafe.Pointer(uintptr(s.array) + a * unsafe.Sizeof(s[0]))\nt.len = b - a\nt.cap = s.cap - a\n</code></pre>\n<p>Notably, this will work for both negative and non-negative values of <code>a</code> and <code>b</code>, assuming the backing array has the capacity.</p>\n<p>More importantly, validating that <code>t</code> doesn't extend beyond it's allocated capacity is also trivial, given the above:</p>\n<pre><code>if t.len &lt; 0 || t.len &gt; t.cap {\n    panic(&quot;invalid slice!&quot;)\n}\n</code></pre>\n<p>Unfortunately, the above assumption only holds if <code>a</code> and <code>b</code> are non-negative. <strong>There is no way to check if a re-slice has extended beyond the allocation of its backing array if negative slice indices are allowed, given the type definition of the slice header above.</strong> Because of this, negative indices are unsafe under the current slice implementation and not allowed.</p>\n<p>That being said, it would be pretty simple to also track the capacity available in <strong>front</strong> of the pointer by adding another <code>int</code> field to the slice header, and then you could very easily check to ensure the slice is within its allocation for negative indices, but as of now the language authors haven't deemed it necessary.</p>\n"}], "owner": {"reputation": 736, "user_id": 4873087, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/94cad0cadff0fe469f77a0a8993a290a?s=128&d=identicon&r=PG", "display_name": "Pay C.", "link": "https://stackoverflow.com/users/4873087/pay-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1637, "favorite_count": 2, "accepted_answer_id": 46635129, "answer_count": 3, "score": 19, "last_activity_date": 1536858430, "creation_date": 1507448699, "question_id": 46628683, "link": "https://stackoverflow.com/questions/46628683/extend-slice-length-on-the-left", "title": "Extend slice length on the left", "body": "<p>I just started going through gotour, and encountered a question regarding slice defaults chapter.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := []int{2, 3, 5, 7, 11, 13}\n\n    s = s[1:4]\n    fmt.Println(s) // [3 5 7]\n    fmt.Println(len(s)) // 3\n\n    s = s[:4]  \n   fmt.Println(s) // [3 5 7 11]\n   fmt.Println(len(s)) // 4\n\n}\n</code></pre>\n\n<p>I can extend the length of slice on the right by picking an index greater than or equal to previous slice length. e.g. <code>s[:4]</code> so I can reach entry <code>11</code>. But when I use<code>s[-1:]</code> to extend on the left and reach entry <code>2</code>, compiler gives me error <code>invalid slice index -1 (index must be non-negative)</code>.\nIs it possible to extend the slice length on the left to reach entry <code>2</code> after <code>s=s[1:4]</code> executed?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 1385, "user_id": 1261232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e25f53bf53e2fc0b8976846d15c9256?s=128&d=identicon&r=PG", "display_name": "Alex Kapustin", "link": "https://stackoverflow.com/users/1261232/alex-kapustin"}, "edited": false, "score": 0, "creation_date": 1507443952, "post_id": 46628088, "comment_id": 80206333, "body": "What&#39;s the library are you using to access MySQL ?  Anyway, named parameters usually are written like:  ... values(:name, :email)&quot;)  @variable - it&#39;s variable, not named parameter"}, {"owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "reply_to_user": {"reputation": 1385, "user_id": 1261232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e25f53bf53e2fc0b8976846d15c9256?s=128&d=identicon&r=PG", "display_name": "Alex Kapustin", "link": "https://stackoverflow.com/users/1261232/alex-kapustin"}, "edited": false, "score": 0, "creation_date": 1507444330, "post_id": 46628088, "comment_id": 80206392, "body": "github.com/go-sql-driver/mysql"}, {"owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "reply_to_user": {"reputation": 1385, "user_id": 1261232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e25f53bf53e2fc0b8976846d15c9256?s=128&d=identicon&r=PG", "display_name": "Alex Kapustin", "link": "https://stackoverflow.com/users/1261232/alex-kapustin"}, "edited": false, "score": 0, "creation_date": 1507444440, "post_id": 46628088, "comment_id": 80206412, "body": "Using :name, :email gives SQL syntax error."}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1507444746, "post_id": 46628088, "comment_id": 80206472, "body": "can you try  db.Exec(&quot;INSERT INTO users(name, email) VALUES(?, ?)&quot;, name, email) without the Prepare  block"}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "edited": false, "score": 0, "creation_date": 1507445027, "post_id": 46628088, "comment_id": 80206520, "body": "What version of Go are you using? My understanding is that support for <code>sql.Named</code> was new in Go 1.8."}, {"owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "edited": false, "score": 0, "creation_date": 1507446447, "post_id": 46628088, "comment_id": 80206800, "body": "go version go1.9 darwin/amd64"}, {"owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1507446700, "post_id": 46628088, "comment_id": 80206835, "body": "@MIkCode I want to use named parameters. &quot;?&quot; become unwieldy if there are lot of parameters."}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "edited": false, "score": 0, "creation_date": 1533066887, "post_id": 46628088, "comment_id": 90207622, "body": "Has this problem been solved yet?  I also have problems with really large complex queries that are dynamically generated.  Trying to debug incorrect position binds for 20+ variables is very tedious/time consuming.  Named arguments will be so much quicker, but if it doesn&#39;t look like we&#39;ll get that support within 6 months from now, I&#39;ll build my own."}, {"owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "reply_to_user": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "edited": false, "score": 0, "creation_date": 1533165556, "post_id": 46628088, "comment_id": 90251263, "body": "@John I don&#39;t think so. I am sticking to PHP for the time being :-)"}], "answers": [{"tags": [], "owner": {"reputation": 1421, "user_id": 706521, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/gj7QH.jpg?s=128&g=1", "display_name": "Adrian Forsius", "link": "https://stackoverflow.com/users/706521/adrian-forsius"}, "is_accepted": false, "score": 4, "last_activity_date": 1507484418, "creation_date": 1507484418, "answer_id": 46634096, "question_id": 46628088, "link": "https://stackoverflow.com/questions/46628088/golang-sql-named-parameter-query/46634096#46634096", "title": "Golang sql named parameter query", "body": "<p>Go needs to support every kind of SQL server - and not all SQL servers support named parameters. The servers that do support them do it with a variety of quirks and \"gotchas\". But they all support positional parameters just fine.</p>\n\n<p>However there is an open issue for it for the mysql-driver:\n<a href=\"https://github.com/go-sql-driver/mysql/issues/561\" rel=\"nofollow noreferrer\">https://github.com/go-sql-driver/mysql/issues/561</a></p>\n"}], "owner": {"reputation": 315, "user_id": 1926351, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/101a618d128a23b36b1052a52be1e8d1?s=128&d=identicon&r=PG", "display_name": "kargirwar", "link": "https://stackoverflow.com/users/1926351/kargirwar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8005, "favorite_count": 1, "answer_count": 1, "score": 7, "last_activity_date": 1588097200, "creation_date": 1507443260, "last_edit_date": 1507443839, "question_id": 46628088, "link": "https://stackoverflow.com/questions/46628088/golang-sql-named-parameter-query", "title": "Golang sql named parameter query", "body": "<p>I am trying to use named parameter query in golang as follows:</p>\n\n<pre><code>stmt, err := db.Prepare(\"insert into users(name, email) values(@name, @email)\")\nif err != nil {\n    //error handling\n}\n\nres, err := stmt.Exec(sql.Named(\"name\", name), sql.Named(\"email\", email))\n\nif err != nil {\n        //error: sql: expected 0 arguments, got 2 \n}\n</code></pre>\n\n<p>I get the following error: \"sql: expected 0 arguments, got 2\".</p>\n\n<p>What is correct way to write this query?              </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6076171"}, "edited": false, "score": 0, "creation_date": 1507445196, "post_id": 46628084, "comment_id": 80206551, "body": "I sent the error because am in dev environment. <i>Of course</i> i will remove the error reporting in production. But thanks for answer! :)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1507443663, "last_edit_date": 1507443663, "creation_date": 1507443213, "answer_id": 46628084, "question_id": 46628054, "link": "https://stackoverflow.com/questions/46628054/panic-serving-146738-runtime-error-invalid-memory-address-or-nil-pointer/46628084#46628084", "title": "panic serving [::1]:46738: runtime error: invalid memory address or nil pointer dereference", "body": "<p>The call to <a href=\"https://github.com/vikramdurai/blog-app-go/blob/master/main.go#L182\" rel=\"noreferrer\">ParseFiles</a> returns nil and an error. The call to <code>t.Execute</code> panics because <code>t</code> is nil.</p>\n\n<p>To avoid the panic, return from the handler after calling <code>http.Error</code>.</p>\n\n<pre><code>...\nt, err := template.ParseFiles(\"index.html\")\n\nif err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return  \n}\n...\n</code></pre>\n\n<p>It's not a good idea to send error messages with possible implementation details to the client. I suggest the following:</p>\n\n<pre><code>...\nt, err := template.ParseFiles(\"index.html\")\n\nif err != nil {\n    log.Println(err)\n    http.Error(w, \"Internal server error\", http.StatusInternalServerError)\n    return  \n}\n...\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6076171"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3538, "favorite_count": 0, "accepted_answer_id": 46628084, "answer_count": 1, "score": 3, "last_activity_date": 1507443663, "creation_date": 1507442926, "last_edit_date": 1507443381, "question_id": 46628054, "link": "https://stackoverflow.com/questions/46628054/panic-serving-146738-runtime-error-invalid-memory-address-or-nil-pointer", "title": "panic serving [::1]:46738: runtime error: invalid memory address or nil pointer dereference", "body": "<p>Can someone explain what's happening? Is there something I might be missing? I am new to Go. I am making a simple CRUD application, it compiles ok, but when I start the server, it gives me an runtime error.</p>\n\n<pre><code>2017/10/08 11:11:59 http: multiple response.WriteHeader calls\n2017/10/08 11:11:59 http: panic serving [::1]:46828: runtime error: invalid memory address or nil pointer dereference\ngoroutine 19 [running]:\nnet/http.(*conn).serve.func1(0xc42008ce60)\n    /home/vikram/go/src/net/http/server.go:1697 +0xd0\npanic(0x740160, 0x97cc10)\n    /home/vikram/go/src/runtime/panic.go:491 +0x283\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n    /home/vikram/go/src/html/template/template.go:95 +0x38\nhtml/template.(*Template).Execute(0x0, 0x94d920, 0xc420186000, 0x719e00, 0x9ab500, 0xc4201820c0, 0x0)\n    /home/vikram/go/src/html/template/template.go:119 +0x2f\nmain.indexHandler(0x9519e0, 0xc420186000, 0xc420160100)\n    /home/vikram/Projects/golang/src/github.com/vikramdurai/blog-app-go/main.go:188 +0x185\nnet/http.HandlerFunc.ServeHTTP(0x7b8da8, 0x9519e0, 0xc420186000, 0xc420160100)\n    /home/vikram/go/src/net/http/server.go:1918 +0x44\nnet/http.(*ServeMux).ServeHTTP(0x98ad20, 0x9519e0, 0xc420186000, 0xc420160100)\n    /home/vikram/go/src/net/http/server.go:2254 +0x130\nnet/http.serverHandler.ServeHTTP(0xc420087110, 0x9519e0, 0xc420186000, 0xc420160100)\n    /home/vikram/go/src/net/http/server.go:2619 +0xb4\nnet/http.(*conn).serve(0xc42008ce60, 0x9520a0, 0xc42007c280)\n    /home/vikram/go/src/net/http/server.go:1801 +0x71d\ncreated by net/http.(*Server).Serve\n    /home/vikram/go/src/net/http/server.go:2720 +0x288\n</code></pre>\n\n<p>my <code>main.go</code> file is on <a href=\"https://github.com/vikramdurai/blog-app-go/blob/master/main.go\" rel=\"nofollow noreferrer\">github</a>.</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1507444208, "post_id": 46628053, "comment_id": 80206372, "body": "<a href=\"http://blog.alexnesterov.com/post/coroutines-part-1/\" rel=\"nofollow noreferrer\">blog.alexnesterov.com/post/coroutines-part-1</a> is also an interesting read (for Kotlin, but does mention Go)"}], "answers": [{"tags": [], "owner": {"reputation": 15599, "user_id": 73831, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4813b578ef6e0ca5ba25a77f57fdb5f1?s=128&d=identicon&r=PG", "display_name": "Sudhir Jonathan", "link": "https://stackoverflow.com/users/73831/sudhir-jonathan"}, "is_accepted": false, "score": 1, "last_activity_date": 1507443770, "creation_date": 1507443770, "answer_id": 46628132, "question_id": 46628053, "link": "https://stackoverflow.com/questions/46628053/how-go-runtime-checks-if-goroutine-is-blocked/46628132#46628132", "title": "How Go runtime checks if goroutine is blocked?", "body": "<p>Blocking in this context usually happens when a goroutine has asked the runtime to do work, usually via a system call. Listening on a socket, for instance \u2014 the goroutine tells the kqueue/epoll part of the system to wake it up when data arrives, at which point it is very obviously blocked. </p>\n\n<p>Goroutines are also blocked when waiting for a message on a channel - here the goroutine has explicitly told the runtime that it's not going to be doing anything else until it receives a message, so the runtime knows very clearly that the goroutine is blocked. </p>\n\n<p>Most operations that of the form \"do this and give me a result\" or \"give me this when it's ready\" are all verifiably blocking operations, and are put to sleep until ready. </p>\n"}, {"comments": [{"owner": {"reputation": 6743, "user_id": 1432751, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e80f2b22b8c98730708ad3842c11604b?s=128&d=identicon&r=PG", "display_name": "Dmitry Bubnenkov", "link": "https://stackoverflow.com/users/1432751/dmitry-bubnenkov"}, "edited": false, "score": 0, "creation_date": 1507453701, "post_id": 46628148, "comment_id": 80208450, "body": "what happens with CPU registers when blocking operation is happen? Current thread is blocking by goroutines, Go scheduler create new system thread and migrate all other threads there?"}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "reply_to_user": {"reputation": 6743, "user_id": 1432751, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e80f2b22b8c98730708ad3842c11604b?s=128&d=identicon&r=PG", "display_name": "Dmitry Bubnenkov", "link": "https://stackoverflow.com/users/1432751/dmitry-bubnenkov"}, "edited": false, "score": 0, "creation_date": 1507468362, "post_id": 46628148, "comment_id": 80212334, "body": "I answered your comment in my answer to the question."}], "tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 3, "last_activity_date": 1507468695, "last_edit_date": 1507468695, "creation_date": 1507443897, "answer_id": 46628148, "question_id": 46628053, "link": "https://stackoverflow.com/questions/46628053/how-go-runtime-checks-if-goroutine-is-blocked/46628148#46628148", "title": "How Go runtime checks if goroutine is blocked?", "body": "<p>This ticket is relevant to the questions:</p>\n\n<p><a href=\"https://github.com/golang/go/issues/11462\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/11462</a></p>\n\n<p>Each blocking call you could do, will be served by the runtime. So the runtime knows if something happens which could block.</p>\n\n<p>For example:</p>\n\n<ol>\n<li><p>If you call <code>Lock()</code> on a <code>sync.Mutex</code> the runtime will handle that and checks wether that would block or not and act accordingly.</p></li>\n<li><p>If you call <code>Run()</code> or <code>Output()</code> (or the like) on a <code>exec.Cmd</code> the runtime notices that and assumes, that this call will block. It can't know wether the program you are running will block, so it has to assume the worst.</p></li>\n</ol>\n\n<p>To the best of my knowledge, there are two principle mechanisms, how a goroutine could block and the examples above are examples for each one.</p>\n\n<ol>\n<li><p>Is an example for things the runtime provides to you without \"external\" help.</p></li>\n<li><p>Is an example for things were a syscall is involved. Golang on linux for example doesn't use gnu libc and implements the syscalls it needs directly by calling the os. All those calls are going through package <code>syscall</code> (to the best of my knowledge) and here the runtime has a single hook to get notified of what happens.</p></li>\n</ol>\n\n<p>Of course the picture is a bit muddy as it might be, that golang needs a mutex from the os for cross os thread synchronization even for 1. and then it is also somehow a bit of example 2.</p>\n\n<p>Regarding the code in the question: No. Go doesn't understand that f might take a lot of time, if the loops aren't optimised away by the compiler. And in such a tight loop, the go scheduler can't \"stop\" the goroutine and set another as running, as there is no preemption point in the loop. So if you have mulitple of such goroutines doing tight loops\nwithout preemption points, they might eat up your cpus and all other goroutines have to wait, until at least one of the tight loops is done.\nBut only calling a different function in that loop changes that picture,\nas a function call is a preemption point.</p>\n\n<p>user1432751 asked in a comment:</p>\n\n<blockquote>\n  <p>what happens with CPU registers when blocking operation is happen?\n  Current thread is blocking by goroutines, Go scheduler create new\n  system thread and migrate all other threads there? \u2013</p>\n</blockquote>\n\n<p>The go schedule isn't preemptive (at least that was the state last time I checked) but schedules at certain preemption points. For example syscalls, sends and waits on channels and if I remember correctly function calls. So at those points an internal function is called and the cpu registers relevent to the code executing in the goroutine are already on the stack, when the scheduler decides what to do.</p>\n\n<p>And yes, if a syscall is done and therefore there is the danger of a blocked os thread, the goroutine doing the syscall gets its own os thread, that doesn't even count to GOMAXPROCS.</p>\n"}, {"tags": [], "owner": {"reputation": 1288, "user_id": 7225929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa26a9a36b086d9872cbe4c70355dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "omotto", "link": "https://stackoverflow.com/users/7225929/omotto"}, "is_accepted": false, "score": 0, "last_activity_date": 1549436867, "last_edit_date": 1549436867, "creation_date": 1549380027, "answer_id": 54537643, "question_id": 46628053, "link": "https://stackoverflow.com/questions/46628053/how-go-runtime-checks-if-goroutine-is-blocked/54537643#54537643", "title": "How Go runtime checks if goroutine is blocked?", "body": "<p>I had the same question few months ago and I solved it adding a channel that should be updated in less of certain time, like a watchdog:</p>\n\n<pre><code>out := make(chan bool)      \ngo func() {             \n    for {\n        // Do some stuff here\n        time.Sleep(10 * time.Millisecond) // leaves CPU free for 10ms\n        out &lt;- true             \n    }\n}()     \n// main loop\nfor { \n    select {            \n        case &lt;-out: // Jump here when out channel is filled             \n        case &lt;-time.After(10 * time.Second): // Jump here if there is no channel activity for 10s\n    }       \n}\n</code></pre>\n\n<p>I hope it would be useful for you.</p>\n"}], "owner": {"reputation": 6743, "user_id": 1432751, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e80f2b22b8c98730708ad3842c11604b?s=128&d=identicon&r=PG", "display_name": "Dmitry Bubnenkov", "link": "https://stackoverflow.com/users/1432751/dmitry-bubnenkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2021, "favorite_count": 1, "accepted_answer_id": 46628148, "answer_count": 3, "score": 4, "last_activity_date": 1549436867, "creation_date": 1507442921, "last_edit_date": 1507467498, "question_id": 46628053, "link": "https://stackoverflow.com/questions/46628053/how-go-runtime-checks-if-goroutine-is-blocked", "title": "How Go runtime checks if goroutine is blocked?", "body": "<p>Go docs says that:</p>\n\n<blockquote>\n  <p>When a coroutine blocks, such as by calling a blocking system call, the run-time automatically moves other coroutines on the same operating system thread to a different, runnable thread so they won't be blocked</p>\n</blockquote>\n\n<p>But how does runtime detect that goroutine is blocked?</p>\n\n<p>For example if I will run calculation in one of go-routine will it be evaluated as blocking operation?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n)\n\nfunc f(from string, score int) {\n    for i := 0; i &lt; score; i++ {\n            for z := 0; z &lt; score; z++ {\n        }\n    }\n\n    fmt.Println(from, \" Done\")\n}   \n\nfunc main() {\nruntime.GOMAXPROCS(1)\nf(\"direct\", 300000)\ngo f(\"foo\", 200000)\ngo f(\"bar\", 20000)\ngo f(\"baz\", 2000)\n\n go func(msg string) {\n        fmt.Println(msg)\n    }(\"going without loop\")\n\n       var input string\n    fmt.Scanln(&amp;input)\n    fmt.Println(\"done\")\n}\n</code></pre>\n\n<p>I am getting result: baz, boo bar. But why? Does Go understand that <code>foo</code> is blocking?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 2806237, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6b2f58581a45e62c09d1aaa3e1dba0d?s=128&d=identicon&r=PG&f=1", "display_name": "Lehtia", "link": "https://stackoverflow.com/users/2806237/lehtia"}, "edited": false, "score": 1, "creation_date": 1507445761, "post_id": 46627631, "comment_id": 80206666, "body": "Thx for the help. This works!"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 9, "last_activity_date": 1507438318, "creation_date": 1507438318, "answer_id": 46627631, "question_id": 46627602, "link": "https://stackoverflow.com/questions/46627602/making-http-responses-with-json/46627631#46627631", "title": "Making HTTP responses with JSON", "body": "<p>The main difference is that the variable in the struct are public (exported) </p>\n\n<pre><code>type Profile struct {\n  Name    string\n  Hobbies []string\n}\n</code></pre>\n\n<p>In your case, they are not (lowercase).</p>\n\n<pre><code>type ResponseCommands struct {\n    key   string\n    value bool\n}\n</code></pre>\n\n<p>See \"<a href=\"https://stackoverflow.com/a/11694255/6309\">Lowercase JSON key names with JSON Marshal in Go</a>\".</p>\n"}, {"tags": [], "owner": {"reputation": 321, "user_id": 4959097, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa2af5dbbd09d7749149049c9df96369?s=128&d=identicon&r=PG&f=1", "display_name": "Farrukh Okhunov", "link": "https://stackoverflow.com/users/4959097/farrukh-okhunov"}, "is_accepted": false, "score": 0, "last_activity_date": 1507534074, "creation_date": 1507534074, "answer_id": 46640879, "question_id": 46627602, "link": "https://stackoverflow.com/questions/46627602/making-http-responses-with-json/46640879#46640879", "title": "Making HTTP responses with JSON", "body": "<p>As <strong>VonC</strong> already answered correct. Just want to add that IDEA can help with such 'small' problems.\nI'm using Gogland and it let me know that <code>json</code> tag cannot be applied to lowercase field.</p>\n"}], "owner": {"reputation": 149, "user_id": 2806237, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6b2f58581a45e62c09d1aaa3e1dba0d?s=128&d=identicon&r=PG&f=1", "display_name": "Lehtia", "link": "https://stackoverflow.com/users/2806237/lehtia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6609, "favorite_count": 2, "closed_date": 1566115688, "accepted_answer_id": 46627631, "answer_count": 2, "score": 8, "last_activity_date": 1565265893, "creation_date": 1507438142, "last_edit_date": 1565265893, "question_id": 46627602, "link": "https://stackoverflow.com/questions/46627602/making-http-responses-with-json", "closed_reason": "Duplicate", "title": "Making HTTP responses with JSON", "body": "<p>I am new to Go, and I am trying to practice with building a simple HTTP server. However I met some problems with JSON responses. I wrote following code, then try postman to send some JSON data. However, my postman always gets an empty response and the <code>content-type</code> is <code>text/plain; charset=utf-8</code>. Then I checked a sample in <a href=\"http://www.alexedwards.net/blog/golang-response-snippets#json\" rel=\"nofollow noreferrer\">http://www.alexedwards.net/blog/golang-response-snippets#json</a>. I copied and pasted the sample, and it was working well. But I cannot see any difference between mine and the sample. Can someone give some help?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n)\n\ntype ResponseCommands struct {\n    key   string\n    value bool\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    http.ListenAndServe(\":5432\", nil)\n}\n\nfunc handler(rw http.ResponseWriter, req *http.Request) {\n    responseBody := ResponseCommands{\"BackOff\", false}\n\n    data, err := json.Marshal(responseBody)\n    if err != nil {\n        http.Error(rw, err.Error(), http.StatusInternalServerError)\n        return\n    }\n    rw.WriteHeader(200)\n    rw.Header().Set(\"Content-Type\", \"application/json\")\n    rw.Write(data)\n}\n</code></pre>\n"}, {"tags": ["http", "go", "x509certificate", "x509", "ocsp"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507431661, "post_id": 46626963, "comment_id": 80204651, "body": "did you test that certificate with other tools ?"}, {"owner": {"reputation": 53, "user_id": 8713562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db8cb7224289f3519097ba6a820723f0?s=128&d=identicon&r=PG&f=1", "display_name": "Daniyar Baitursynov", "link": "https://stackoverflow.com/users/8713562/daniyar-baitursynov"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507456857, "post_id": 46626963, "comment_id": 80209302, "body": "yes, it is correct. Not revoked and valid. Is there any example of request to OCSP in Go?"}], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 5527254, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/766f97e5728d68fe8f57292e77d66339?s=128&d=identicon&r=PG&f=1", "display_name": "EricJ", "link": "https://stackoverflow.com/users/5527254/ericj"}, "is_accepted": false, "score": 3, "last_activity_date": 1531925709, "creation_date": 1531925709, "answer_id": 51405141, "question_id": 46626963, "link": "https://stackoverflow.com/questions/46626963/golang-sending-ocsp-request-returns/51405141#51405141", "title": "Golang, sending OCSP request returns", "body": "<p>The standard allows for requests to made via GET or POST.  See the code below for an example that works with the POST method. This example works in my company's corporate PKI and almost works with the NIST PIV test cards (<a href=\"https://csrc.nist.gov/projects/piv/nist-personal-identity-verification-test-cards\" rel=\"nofollow noreferrer\">https://csrc.nist.gov/projects/piv/nist-personal-identity-verification-test-cards</a>), but trips over a bug in Go that may have been resolved in 1.11 (see <a href=\"https://github.com/golang/go/issues/21527\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/21527</a>)</p>\n\n<p>Note that some OCSP responders require the host header.  Also, both of the OSCP responders in my environment want SHA1 for the hash algorithm and fail when SHA256 is used.</p>\n\n<pre><code>func isCertificateRevokedByOCSP(commonName string, clientCert, issuerCert *x509.Certificate, ocspServer string) bool {\n    opts := &amp;ocsp.RequestOptions{Hash: crypto.SHA1}\n    buffer, err := ocsp.CreateRequest(clientCert, issuerCert, opts)\n    if err != nil {\n        return false\n    }\n    httpRequest, err := http.NewRequest(http.MethodPost, ocspServer, bytes.NewBuffer(buffer))\n    if err != nil {\n        return false\n    }\n    ocspUrl, err := url.Parse(ocspServer)\n    if err != nil {\n        return false\n    }\n    httpRequest.Header.Add(\"Content-Type\", \"application/ocsp-request\")\n    httpRequest.Header.Add(\"Accept\", \"application/ocsp-response\")\n    httpRequest.Header.Add(\"host\", ocspUrl.Host)\n    httpClient := &amp;http.Client{}\n    httpResponse, err := httpClient.Do(httpRequest)\n    if err != nil {\n        return false\n    }\n    defer httpResponse.Body.Close()\n    output, err := ioutil.ReadAll(httpResponse.Body)\n    if err != nil {\n        return false\n    }\n    ocspResponse, err := ocsp.ParseResponse(output, issuerCert)\n    if err != nil {\n        return false\n    }\n    if ocspResponse.Status == ocsp.Revoked {\n        logger.GetLogger().Warnf(\"certificate '%s' has been revoked by OCSP server %s, refusing connection\", commonName, ocspServer)\n        return true\n    } else {\n        return false\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 8713562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db8cb7224289f3519097ba6a820723f0?s=128&d=identicon&r=PG&f=1", "display_name": "Daniyar Baitursynov", "link": "https://stackoverflow.com/users/8713562/daniyar-baitursynov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1651, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1531925709, "creation_date": 1507429336, "last_edit_date": 1507457316, "question_id": 46626963, "link": "https://stackoverflow.com/questions/46626963/golang-sending-ocsp-request-returns", "title": "Golang, sending OCSP request returns", "body": "<p>I'm writing certificate revocation validation using OCSP request to get actual status. I send request, but getting error. <strong>ERROR:</strong> ocsp: error from server: <strong>malformed</strong>. I found error return in source: <code>MalformedRequestErrorResponse = []byte{0x30, 0x03, 0x0A, 0x01, 0x01}</code>, but don't understand what causes error??</p>\n\n<pre><code>func CheckRevocation(cert *x509.Certificate) error {\n    var (\n        buffer       []byte\n        output       []byte\n        OCSPResponse *ocsp.Response\n        OCSPURL      string\n        IssuerURL    string\n        httpRequest  *http.Request\n        httpResponse *http.Response\n    )\n    if len(cert.OCSPServer) &gt; 0 {\n        OCSPURL = cert.OCSPServer[0]\n    }\n    if len(cert.IssuingCertificateURL) &gt; 0 {\n        IssuerURL = cert.IssuingCertificateURL[0]\n    }\n    issuer, err := DownloadCert(IssuerURL) // return *x509.Certificate, err\n    if err != nil {\n        return err\n    }\n    opts := &amp;ocsp.RequestOptions{\n        Hash: crypto.SHA256,\n    }\n    buffer, err = ocsp.CreateRequest(cert, issuer, opts)\n    if err != nil {\n        return err\n    }\n    httpRequest, err = http.NewRequest(\"GET\", OCSPURL, nil)\n    if err != nil {\n        return err\n    }\n    httpRequest.Header.Add(\"Content-Type\", \"application/ocsp-request\")\n    httpRequest.Header.Add(\"Accept\", \"application/ocsp-response\")\n    writer := bytes.NewBuffer(buffer)\n    httpRequest.Write(writer)\n    httpClient := &amp;http.Client{}\n    httpResponse, err = httpClient.Do(httpRequest)\n    if err != nil {\n        return err\n    }\n    defer httpResponse.Body.Close()\n    output, err = ioutil.ReadAll(httpResponse.Body)\n    if err != nil {\n        return err\n    }\n    OCSPResponse, err = ocsp.ParseResponse(output, issuer)\n    if err != nil {\n        return err\n    }\n    debugPrint(\"OCSP\", \"result: %d\", OCSPResponse.Status)\n    return nil\n}\n</code></pre>\n\n<p><strong>EXAMPLE OF CERTIFICATE:</strong></p>\n\n<pre><code>...\n&lt;ds:X509Certificate&gt;\nMIIG9DCCBNygAwIBAgIUTFVCYjrFFRdWjgJW0G8fUs6LLk4wDQYJKoZIhvcNAQELBQAwgc4xCzAJ\nBgNVBAYTAktaMRUwEwYDVQQHDAzQkNCh0KLQkNCd0JAxFTATBgNVBAgMDNCQ0KHQotCQ0J3QkDFM\nMEoGA1UECgxD0KDQnNCaIMKr0JzQldCc0JvQldCa0JXQotCi0IbQmiDQotCV0KXQndCY0JrQkNCb\n0KvSmiDSmtCr0JfQnNCV0KLCuzFDMEEGA1UEAww60rDQm9Ci0KLQq9KaINCa0KPTmNCb0JDQndCU\n0KvQoNCj0KjQqyDQntCg0KLQkNCb0KvSmiAoUlNBKTAeFw0xNzA3MjcwMzU1MDZaFw0xODA3Mjcw\nMzU1MDZaMIHJMSwwKgYDVQQDDCPQkdCQ0JnQotCj0KDQodCr0J3QntCSINCU0JDQndCY0K/QoDEf\nMB0GA1UEBAwW0JHQkNCZ0KLQo9Cg0KHQq9Cd0J7QkjEYMBYGA1UEBRMPSUlOOTIwNzI3MzAwMDQ0\nMQswCQYDVQQGEwJLWjEVMBMGA1UEBwwM0JDQm9Cc0JDQotCrMRUwEwYDVQQIDAzQkNCb0JzQkNCi\n0KsxIzAhBgNVBCoMGtCh0JXQmdCi0JrQkNCh0KvQnNCe0JLQmNCnMIIBIjANBgkqhkiG9w0BAQEF\nAAOCAQ8AMIIBCgKCAQEAvW0Lyoex/kkhq5Xb5uCOtEpp4zjc34M5UGftcgmY6FXvlCaPm4415cmk\nKyaz6M+vmsK3T/wH3S2Up5cLKo022BgpBTYg6+lPUQgigYM7PPc20aLySrMg+Gu4HitokrdWgA/H\nhjr14HAOFNiEZm7UpeLAhBfuAz/S9TeCct0C/dp75X8K7zOdXX1n/npnMZKMStPVJ94Cbdpprz/O\nlNWzk+MGUB5+2yy4k4zBUamyEk8QzsJZID4Hva8ZIwqSXe4gyCe46iPxPZ8EKiwR4Pn6BXj0k7G1\na8A1jYEqc91QMX+L4CCS5M+BeUvbrcdMjNEoy71YG6m9qgNsBGl7WueMawIDAQABo4IByzCCAccw\nDgYDVR0PAQH/BAQDAgWgMB0GA1UdJQQWMBQGCCsGAQUFBwMCBggqgw4DAwQBATAPBgNVHSMECDAG\ngARVtbTiMB0GA1UdDgQWBBQKnKaePX9Y74pplb7yI5ql8zxiJDBeBgNVHSAEVzBVMFMGByqDDgMD\nAgQwSDAhBggrBgEFBQcCARYVaHR0cDovL3BraS5nb3Yua3ovY3BzMCMGCCsGAQUFBwICMBcMFWh0\ndHA6Ly9wa2kuZ292Lmt6L2NwczBOBgNVHR8ERzBFMEOgQaA/hh1odHRwOi8vY3JsLnBraS5nb3Yu\na3ovcnNhLmNybIYeaHR0cDovL2NybDEucGtpLmdvdi5rei9yc2EuY3JsMFIGA1UdLgRLMEkwR6BF\noEOGH2h0dHA6Ly9jcmwucGtpLmdvdi5rei9kX3JzYS5jcmyGIGh0dHA6Ly9jcmwxLnBraS5nb3Yu\na3ovZF9yc2EuY3JsMGIGCCsGAQUFBwEBBFYwVDAuBggrBgEFBQcwAoYiaHR0cDovL3BraS5nb3Yu\na3ovY2VydC9wa2lfcnNhLmNlcjAiBggrBgEFBQcwAYYWaHR0cDovL29jc3AucGtpLmdvdi5rejAN\nBgkqhkiG9w0BAQsFAAOCAgEAColZth/p4wVdcPU1AHTMhNeyLtSJI4K5A7/NoOsqYsH5qpE89gPI\nmxB4NAvtmHD49f/lHLvzeIBh+snO+lfJZYXaWcYwU1+dJRyB/bE+W6vcEa5N79eihSyl9fsQTYcz\njBsXzUx0Sv2vAiZH+RIowSsg/m9+UZDt5eNcL7eqkr/JDs0I5VVYXFKwNP1rPam4jfuJKB9w/bEg\n6G6RM0/DGaXxLAimVB6gLQzT1hdQzgG8YOERJxjlTeRUICUiEqFz5mZzlJ6zb2+N7lUCzRu385o1\nDeWjRJZaTxFKM9JJv8a6zPjcuFA+PIsDy9GSLby1OfZaJJo/7w4iLtJiYDuyMTXisnOknmVr5LC6\nfft4AXOq7zOTn7t5r3T9lb5VmorfnqdqSXrep6c/dlkSlyP2mYhUE3JOSQTraJQH/jjcWH5hfewb\n/9kPWqDlTpBnok9pcciRSYOgzqkpe0CJ3ZNyj+YNuL58O+TkV9MOwe8wWrWe8rVYV61E597WJZJ/\nm6qKBPYUy+zoRVK/XdYYAMsBC2zHrz8n7Z8k6s9FQo4YLgprMQh6Hcq42PgnCZZGxxJ4wU44STUj\nHCtohHNYjhz+sZfKg6KEFPzGJN1O7rYd8q0Gl9vQtKMjIsETZ7BRYbXxuzMVA2CMhxiXJS929qH2\nce48JWaAdMkyzyjcF8t3tVY=\n&lt;/ds:X509Certificate&gt;\n</code></pre>\n\n<p>This certificate is valid, but cannot call OCSP to check it's status. May be my call is incorrect. Does anyone have ideas?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 6, "creation_date": 1507427046, "post_id": 46626773, "comment_id": 80204020, "body": "The <a href=\"https://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\">documentation</a> explains the usage for those. What additional information do you need about them?"}], "answers": [{"tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": false, "score": 2, "last_activity_date": 1507428221, "last_edit_date": 1507428221, "creation_date": 1507427715, "answer_id": 46626842, "question_id": 46626773, "link": "https://stackoverflow.com/questions/46626773/why-go-package-unsafe-source-code-only-six-lines/46626842#46626842", "title": "Why go package unsafe source code only six lines?", "body": "<p>Usually just having a function signature without an implementations means that the implementation is elsewhere. Usually in a separate assembly file.</p>\n\n<p>In this case, you have stumbled upon one of two situations in the standard library where it is not implemented in assembly: <a href=\"https://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\">unsafe</a> and <a href=\"https://golang.org/pkg/builtin/\" rel=\"nofollow noreferrer\">builtin</a>.</p>\n\n<p>The Go implementation of those packages are only there to provide documentation inside godoc. Their use is defined in the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">Go language specification</a> and because of that are implemented in a way that would be impossible to implement in Go. In the case of unsafe, \"ArbitraryType\" really means that it accepts all possible types. This would normally be impossible to do without implicit interface conversion. But the functions are implemented by the compiler as they are needed and get to ignore the normal restrictions on Go code.</p>\n\n<hr>\n\n<p>But what is the unsafe package? It is a package that provides various tools for doing low level work. Its main use is in doing direct syscalls or cgo. Using unsafe gives you a great amount of power but also doesn't stop you from using that power to shoot yourself in the foot. If at all possible, I recommend avoiding it.</p>\n\n<hr>\n\n<p>Further reading:</p>\n\n<ul>\n<li><a href=\"https://golang.org/pkg/unsafe/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/unsafe/</a></li>\n<li><a href=\"https://golang.org/ref/spec#Package_unsafe\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Package_unsafe</a></li>\n</ul>\n"}], "owner": {"reputation": 1, "user_id": 8662958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c9919a358f2baff02d63dfc789597b0?s=128&d=identicon&r=PG&f=1", "display_name": "Konica", "link": "https://stackoverflow.com/users/8662958/konica"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 1, "answer_count": 1, "score": -5, "last_activity_date": 1507428221, "creation_date": 1507426894, "last_edit_date": 1507427002, "question_id": 46626773, "link": "https://stackoverflow.com/questions/46626773/why-go-package-unsafe-source-code-only-six-lines", "title": "Why go package unsafe source code only six lines?", "body": "<pre><code>package unsafe\ntype ArbitraryType int\ntype Pointer *ArbitraryType\nfunc Sizeof(x ArbitraryType) uintptr\nfunc Offsetof(x ArbitraryType) uintptr\nfunc Alignof(x ArbitraryType) uintptr\n</code></pre>\n\n<p>What's the principle of Sizeof, Offsetof, Alignof?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1507424820, "post_id": 46626592, "comment_id": 80203712, "body": "Where does the go tour say that this should work with <code>*IPAddr</code> receiver?"}, {"owner": {"reputation": 123, "user_id": 5796825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e604357955a5b5723a3f7c97b4a0ab2?s=128&d=identicon&r=PG&f=1", "display_name": "Tejas", "link": "https://stackoverflow.com/users/5796825/tejas"}, "reply_to_user": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1507425010, "post_id": 46626592, "comment_id": 80203733, "body": "Right <a href=\"http://tour.golang.org/methods/6\" rel=\"nofollow noreferrer\">here</a> and <a href=\"http://tour.golang.org/methods/7\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1507437798, "post_id": 46626592, "comment_id": 80205434, "body": "note that a function with a receiver is <b>not</b> the same as method receiver"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 5796825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e604357955a5b5723a3f7c97b4a0ab2?s=128&d=identicon&r=PG&f=1", "display_name": "Tejas", "link": "https://stackoverflow.com/users/5796825/tejas"}, "edited": false, "score": 0, "creation_date": 1507497831, "post_id": 46626661, "comment_id": 80221533, "body": "I don&#39;t think this is correct, could you please elaborate?"}], "tags": [], "owner": {"reputation": 4318, "user_id": 2078664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae30229985a7f88705639de070dbe1a1?s=128&d=identicon&r=PG", "display_name": "Mike Rapadas", "link": "https://stackoverflow.com/users/2078664/mike-rapadas"}, "is_accepted": false, "score": 2, "last_activity_date": 1507425450, "creation_date": 1507425450, "answer_id": 46626661, "question_id": 46626592, "link": "https://stackoverflow.com/questions/46626592/go-receiver-implicit-pointer-conversion-not-working/46626661#46626661", "title": "Go receiver implicit pointer conversion not working", "body": "<p>Implementing <code>func (ip IPAddr) String()</code> will work for both <code>IPAddr</code> and <code>*IPAddr</code> types.</p>\n\n<p>Implementing <code>func (ip *IPAddr) String</code> will only work for <code>*IPAddr</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "edited": false, "score": 0, "creation_date": 1507426305, "post_id": 46626664, "comment_id": 80203904, "body": "To further explain - in order to satisfy an interface in Go, a type must explicitly implement all of the interface functions. <code>Type</code> and <code>*Type</code> are fundamentally different things (which may need to handle the interface function in different ways). Go does some handy magic that lets you call functions on a <code>Type</code> even if they have a <code>*Type</code> receiver - but that does not <i>explicitly</i> implement the interface.."}], "tags": [], "owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "is_accepted": true, "score": 2, "last_activity_date": 1507425478, "creation_date": 1507425478, "answer_id": 46626664, "question_id": 46626592, "link": "https://stackoverflow.com/questions/46626592/go-receiver-implicit-pointer-conversion-not-working/46626664#46626664", "title": "Go receiver implicit pointer conversion not working", "body": "<p>The implicit conversion means that you can call the function on either a value, or pointer, but it does not satisfy the implementation of an interface. If you implement an interface with a pointer receiver, the pointer must be used in the function call.</p>\n\n<p>The code below shows the <code>*IPAddr</code> used with the Stringer interface, and an <code>IPAddr</code> used with the new <code>foo()</code> function (also implemented with a pointer receiver):</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype IPAddr [4]byte\n\n// TODO: Add a \"String() string\" method to IPAddr.\nfunc (ip *IPAddr) String() string {\n    return fmt.Sprintf(\"%v.%v.%v.%v\", ip[0], ip[1], ip[2], ip[3])\n}\n\nfunc (ip *IPAddr) foo() string {\n    return \"bar\"\n}\n\nfunc main() {\n    hosts := map[string]IPAddr{\n        \"loopback\":  {127, 0, 0, 1},\n        \"googleDNS\": {8, 8, 8, 8},\n    }\n    for name, ip := range hosts {\n        fmt.Printf(\"%v: %v\\n\", name, &amp;ip)\n\n    fmt.Println(ip.foo())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 5796825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e604357955a5b5723a3f7c97b4a0ab2?s=128&d=identicon&r=PG&f=1", "display_name": "Tejas", "link": "https://stackoverflow.com/users/5796825/tejas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 46626664, "answer_count": 2, "score": 3, "last_activity_date": 1507425478, "creation_date": 1507424554, "question_id": 46626592, "link": "https://stackoverflow.com/questions/46626592/go-receiver-implicit-pointer-conversion-not-working", "title": "Go receiver implicit pointer conversion not working", "body": "<p>I'm learning Go, and I was following the go tour.</p>\n\n<p>In the exercise about Stringer, <a href=\"http://tour.golang.org/methods/18\" rel=\"nofollow noreferrer\">here</a>, Implementing the function with a *IPAddr receiver doesn't seem to work, which the go tour describes as should work. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype IPAddr [4]byte\n\n// TODO: Add a \"String() string\" method to IPAddr.\nfunc (ip *IPAddr) String() string {\n    return fmt.Sprintf(\"%v.%v.%v.%v\", ip[0], ip[1], ip[2], ip[3])\n}\nfunc main() {\n    hosts := map[string]IPAddr{\n        \"loopback\":  {127, 0, 0, 1},\n        \"googleDNS\": {8, 8, 8, 8},\n    }\n    for name, ip := range hosts {\n        fmt.Printf(\"%v: %v\\n\", name, ip)\n    }\n}\n</code></pre>\n\n<p>Output is: </p>\n\n<pre><code>loopback: [127 0 0 1]\ngoogleDNS: [8 8 8 8]\n</code></pre>\n\n<p>But changing <code>String() string</code> to <code>func (ip IPAddr)</code> from <code>func (ip *IPAddr)</code> gives the correct output:</p>\n\n<pre><code>loopback: 127.0.0.1\ngoogleDNS: 8.8.8.8\n</code></pre>\n\n<p>Why is that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1507419603, "post_id": 46626072, "comment_id": 80202826, "body": "Don\u2019t use <code>go run</code>. Just install the package normally."}, {"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507421997, "post_id": 46626072, "comment_id": 80203251, "body": "@JimB I can&#39;t, Delve debugger expetcs the main.go file on the input"}, {"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507422429, "post_id": 46626072, "comment_id": 80203340, "body": "@JimB Executing <code>dlv debug github.com&#47;ethereum&#47;go-ethereum&#47;cmd&#47;geth&#47;main.go </code> gives me the same error"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1507424750, "post_id": 46626072, "comment_id": 80203702, "body": "try <code>go run  github.com&#47;ethereum&#47;go-ethereum&#47;cmd&#47;geth&#47;*go...</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507464326, "post_id": 46626072, "comment_id": 80211212, "body": "<code>dlv debug</code> can take a package name as an argument."}], "owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 242, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1539412532, "creation_date": 1507418760, "question_id": 46626072, "link": "https://stackoverflow.com/questions/46626072/problems-building-go-code-from-sources", "title": "Problems building go code from sources", "body": "<p>I am building Ethereum from sources (because I need to feed sources into debugger, to trace how it works) and I have an error during build:</p>\n\n<pre><code>[niko@localhost sources]$  go run  github.com/ethereum/go-ethereum/cmd/geth/main.go ---verbosity 5 --ipcdisable --port 40401 --rpc --rpcport 9101 --pprof --datadir=/home/niko/saved-niko-home/myeth/ --networkid=15 console \n# command-line-arguments\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:115: undefined: configFileFlag\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:146: undefined: initCommand\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:147: undefined: importCommand\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:148: undefined: exportCommand\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:149: undefined: removedbCommand\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:150: undefined: dumpCommand\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:152: undefined: monitorCommand\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:154: undefined: accountCommand\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:155: undefined: walletCommand\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:157: undefined: consoleCommand\ngithub.com/ethereum/go-ethereum/cmd/geth/main.go:157: too many errors\n[niko@localhost sources]$ \n</code></pre>\n\n<p>All the undefined symbols are contained in these files:</p>\n\n<pre><code>[niko@localhost sources]$ ls -l github.com/ethereum/go-ethereum/cmd/geth/config.go  github.com/ethereum/go-ethereum/cmd/geth/chaincmd.go github.com/ethereum/go-ethereum/cmd/geth/monitorcmd.go github.com/ethereum/go-ethereum/cmd/geth/accountcmd.go\n-rw-rw-r--. 1 niko niko 11843 Sep 12 09:10 github.com/ethereum/go-ethereum/cmd/geth/accountcmd.go\n-rw-rw-r--. 1 niko niko 10036 Sep 12 09:10 github.com/ethereum/go-ethereum/cmd/geth/chaincmd.go\n-rw-rw-r--. 1 niko niko  5881 Sep 12 09:10 github.com/ethereum/go-ethereum/cmd/geth/config.go\n-rw-rw-r--. 1 niko niko 11362 Sep 12 09:10 github.com/ethereum/go-ethereum/cmd/geth/monitorcmd.go\n[niko@localhost sources]$ \n</code></pre>\n\n<p>However, if I add these files to the command line, I will get another error (symbols get duplicated), which I submitted in another question: <a href=\"https://stackoverflow.com/questions/46619887/can-not-use-function-as-type-in-go\">can not use function as type in Go</a></p>\n\n<p>So, somehow, with automatic build process Ethereum is compiled to include these variables (configFileFlag,initCommand, etc) but when I am trying to do it manually I am missing some stuff. But which stuff? </p>\n"}, {"tags": ["go", "azure-cosmosdb"], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 4, "last_activity_date": 1507419943, "creation_date": 1507419943, "answer_id": 46626185, "question_id": 46625098, "link": "https://stackoverflow.com/questions/46625098/generating-a-cosmosdb-authentication-token-in-golang/46626185#46626185", "title": "Generating a CosmosDB authentication token in GoLang", "body": "<p>This took me longer to find than I would have hoped.  There is one obvious problem, you are not base64 decoding the key on this line</p>\n\n<pre><code>hasher := hmac.New(sha256.New, []byte(base64Key))\n</code></pre>\n\n<p>You should do something like</p>\n\n<pre><code>hmacKey, _ := base64.StdEncoding.DecodeString(base64Key)\n// handle error\nhasher := hmac.New(sha256.New, hmacKey)\n</code></pre>\n\n<p>But even that didn't fix it.  Not until I finally figured out this discrepancy</p>\n\n<pre><code>C# \"thu, 27 apri 2017 00:51:12 gmt\"\nGo \"thu, 27 apr 2017 00:51:12 gmt\" \n</code></pre>\n\n<p>This works</p>\n\n<pre><code>func generateAuthToken(\n    verb string,\n    resourceType string,\n    resourceId string,\n    date string,\n    base64Key string) string {\n\n    msg := fmt.Sprintf(\"%s\\n%s\\n%s\\n%s\\n%s\\n\",\n        verb,\n        resourceType,\n        resourceId,\n        date,\n        \"\")\n\n    hmacKey, _ := base64.StdEncoding.DecodeString(base64Key)\n    // handle error\n    hasher := hmac.New(sha256.New, hmacKey)\n    hasher.Write([]byte(msg))\n    signature := base64.StdEncoding.EncodeToString(hasher.Sum(nil))\n\n    authHeader := fmt.Sprintf(\"type=master&amp;ver=1.0&amp;sig=%s\", signature)\n    return url.QueryEscape(authHeader)\n}\n</code></pre>\n\n<p>And here is a <a href=\"https://play.golang.org/p/lEwjaS2eMV\" rel=\"nofollow noreferrer\">Go Playground Link</a></p>\n\n<p>So, the Go version was nearly right (except for the key) and the C# part was almost right (except for the non-RFC1123 format).</p>\n"}], "owner": {"reputation": 562, "user_id": 1066063, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31VvD.jpg?s=128&g=1", "display_name": "nciao", "link": "https://stackoverflow.com/users/1066063/nciao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 46626185, "answer_count": 1, "score": 1, "last_activity_date": 1507419943, "creation_date": 1507410247, "question_id": 46625098, "link": "https://stackoverflow.com/questions/46625098/generating-a-cosmosdb-authentication-token-in-golang", "title": "Generating a CosmosDB authentication token in GoLang", "body": "<p>I'm trying to generate a CosmosDb Auth token by following the instructions here: \n<a href=\"https://docs.microsoft.com/en-us/rest/api/documentdb/access-control-on-documentdb-resources\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/rest/api/documentdb/access-control-on-documentdb-resources</a>.</p>\n\n<p>Here's my implementation in GoLang (I replaced all the parameters with literal values found in the \"Example Encoding\" section from the doc above):</p>\n\n<pre><code>import(\n    \"crypto/hmac\"\n    \"crypto/sha256\"\n    \"encoding/base64\"\n    \"net/url\")\n\nfunc generateAuthToken(\n    verb string,\n    resourceType string,\n    resourceId string,\n    date string,\n    base64Key string) string {\n\n    // Example Key\n    base64Key := \"dsZQi3KtZmCv1ljt3VNWNm7sQUF1y5rJfC6kv5JiwvW0EndXdDku/dkKBp8/ufDToSxLzR4y+O/0H/t4bQtVNw==\"\n    msg := fmt.Sprintf(\"%s\\n%s\\n%s\\n%s\\n%s\\n\",\n        \"get\",                            //verb\n        \"dbs\",                            //resourceId\n        \"dbs/todolist\",                   //resourceLink\n        \"thu, 27 apr 2017 00:51:12 gmt\",  //RFC1123 date\n        \"\")\n\n    hasher := hmac.New(sha256.New, []byte(base64Key))\n    hasher.Write([]byte(msg))\n    signature := base64.StdEncoding.EncodeToString(hasher.Sum(nil))\n\n    authHeader := fmt.Sprintf(\"type=master&amp;ver=1.0&amp;sig=%s\", signature)\n    return url.QueryEscape(authHeader)\n}\n</code></pre>\n\n<p>I also took the C# example from the link and ran it with the same parameters as a reference.</p>\n\n<p><strong>This is what I get from the C# implementation (the reference):</strong></p>\n\n<pre><code>\"type%3Dmaster%26ver%3D1.0%26sig%3DSGWmGNFZlBH%2Bt9QCvuMy%2FVsbBAOKLbxsgy3Z7aG0PdA%3D\"\n</code></pre>\n\n<p><strong>And this is what I get from my GoLang implementation:</strong></p>\n\n<pre><code>\"type%3Dmaster%26ver%3D1.0%26sig%3Dwst1NDxfOeoYMurn69DgZtJUQOrgxFz%2Bp6A2vKnXxEI%3D\"\n</code></pre>\n\n<p>Clearly I'm doing something wrong in the GoLang implementation since the two aren't identical (maybe mis-using the hashing libraries?) </p>\n\n<p>For easy reference, here's the C# implementation:</p>\n\n<pre><code>static void Main(string[] args) {\n      string token = GenerateAuthToken(\n             \"get\",\n             \"dbs\",\n             \"dbs/todolist\",\n             \"thu, 27 apri 2017 00:51:12 gmt\", \n             \"dsZQi3KtZmCv1ljt3VNWNm7sQUF1y5rJfC6kv5JiwvW0EndXdDku/dkKBp8/ufDToSxLzR4y+O/0H/t4bQtVNw==\",\n             \"master\",\n             \"1.0\");\n}\n\nstatic string GenerateAuthToken(string verb, string resourceType, string resourceId, string date, string key, string keyType, string tokenVersion)\n{\n      var hmacSha256 = new System.Security.Cryptography.HMACSHA256 { Key = Convert.FromBase64String(key) };\n\n      verb = verb ?? \"\";\n      resourceType = resourceType ?? \"\";\n      resourceId = resourceId ?? \"\";\n\n      string payLoad = string.Format(System.Globalization.CultureInfo.InvariantCulture, \"{0}\\n{1}\\n{2}\\n{3}\\n{4}\\n\",\n            verb.ToLowerInvariant(),\n            resourceType.ToLowerInvariant(),\n            resourceId,\n            date.ToLowerInvariant(),\n            \"\");\n\n      byte[] hashPayLoad = hmacSha256.ComputeHash(System.Text.Encoding.UTF8.GetBytes(payLoad));\n      string signature = Convert.ToBase64String(hashPayLoad);\n\n      return System.Net.WebUtility.UrlEncode(String.Format(System.Globalization.CultureInfo.InvariantCulture, \"type={0}&amp;ver={1}&amp;sig={2}\",\n            keyType,\n            tokenVersion,\n            signature));\n}\n</code></pre>\n"}]