[{"tags": ["types", "go", "embedding"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1430343853, "post_id": 29955093, "comment_id": 48031043, "body": "Have you tried <code>it.Impl.Nifty()</code>?"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1430344185, "post_id": 29955093, "comment_id": 48031185, "body": "I did.  The problem is my actual &quot;Impl&quot; is really named something like &quot;name.withADot&quot; so the parse tells me the equivalent of <code>(type ImplToo has no field or method name)</code>   That seemed to make me think &quot;OK, parens then&quot;, but it.(name.withADot).Nifty is parsed as an interface conversion, and back to the <code>non-interface type on left</code> error."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1430344306, "post_id": 29955093, "comment_id": 48031235, "body": "I don&#39;t understand. An identifier cannot contain a dot character. Please post your code."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1430344479, "post_id": 29955093, "comment_id": 48031298, "body": "But types do, since they are qualified by package name.  The dot is both a selector and package qualifier.   I&#39;ve edited above to reflect what I&#39;m talking about.  (And when you embed, the /type name is the field name/.   So how do you select it?  etc.)"}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430344801, "post_id": 29955327, "comment_id": 48031434, "body": "Please take note of my edit with the package prefix above.   Your ImplToo is not a valid declaration of a struct, because Impl is not defined.  It&#39;s pkg.Impl in the local package.  If it&#39;s pkg.Impl, I get <code>(type ImplToo has no field or method name pkg)</code>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 1, "creation_date": 1430344850, "post_id": 29955327, "comment_id": 48031458, "body": "@BadZen ok, I addressed your concern about the package. It doesn&#39;t effect the body of Nifty, only the stucts declaration."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345064, "post_id": 29955327, "comment_id": 48031547, "body": "Creating a new type that does not have an embed does not help - there are functions with the type&#39;s receiver that are /not/ &#39;overloaded&#39; in this way, and I want to able to call those from the same expression.  You&#39;re basically saying &quot;don&#39;t use embeds, compose everything&quot;.   That&#39;s great until I need to pass my type to some already-existing function that expects a BaseInterface.   Also consider having to call myImpl.In.A.Really.Long.Chain.Of.Subclasses()...."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345277, "post_id": 29955327, "comment_id": 48031629, "body": "Put another way:  The ImplNotEmbed /won&#39;t even compile/ unless I provide &quot;plumbing code&quot; that maps other methods of the interface through to it&#39;s Impl.   That&#39;s unacceptable for large interfaces..."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345286, "post_id": 29955327, "comment_id": 48031635, "body": "@BadZen ImplNotEmbed was just supposed to show you the difference in how you access the property of an embedded type vs a non embedded one. There isn&#39;t composition happening here. Just like in OOP if you want to override a method in a derived class AND use the base classes implementation you&#39;ll have to explicitly state that.... If you weren&#39;t overriding <code>Nifty</code> in <code>ImplToo</code> you could always just call <code>Nifty()</code> directly from an instance... It&#39;s called &quot;ImplNotEmbed&quot; because I&#39;m not using embedding..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345331, "post_id": 29955327, "comment_id": 48031653, "body": "Huh?  Ok, I&#39;ve edited the original post again to show you what I think is the problem with the second solution.  ImplNotEmbed needs to provide a ton of little funcs like <code>func (ine ImplNotEmbed) Other4() { ine.impl.Other4() }</code> just to compile.   See what I&#39;m saying?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345428, "post_id": 29955327, "comment_id": 48031699, "body": "@BadZen I just deleted that code sample because it&#39;s confusing you... It was just supposed to illustrate the difference between accessing the method on an embedded type vs a normal property... the <code>ImplNotEmbed</code> example did not use the language feature &#39;embedding&#39; at all. I&#39;m quite sure the remaining code sample does what you&#39;re looking for. It is the closest thing to overriding a method in a derived class that Go has to offer. Take what you want from it, I assure you it works fine and is the correct way to accomplish things of this nature in Go."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345520, "post_id": 29955327, "comment_id": 48031732, "body": "Thanks, I understand how to not use embedding though.  I&#39;m looking for an answer to my actual question, which does involve using embedding, as per the title of this thread.  I think it&#39;s a pretty clear question - you&#39;re offering me a way to not have to do what I want - ie. a workaround."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345665, "post_id": 29955327, "comment_id": 48031782, "body": "If the answer to my actual question is &quot;you can&#39;t do that in Go&quot;, then that&#39;s fine, perfectly acceptable answer."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345670, "post_id": 29955327, "comment_id": 48031788, "body": "@BadZen again, your question is answered by my remaining code sample. It embeds the type <code>Impl</code> from the package <code>pkg</code> into the type <code>ImplToo</code> and then implements <code>Nifty()</code> with for a receiver of type <code>ImplToo</code> which simply calls <code>Impl</code>&#39;s implementation of <code>Nifty()</code>. Read my comment above. If this doesn&#39;t make sense to you then you should re-think what you&#39;re trying to do. If you use my code above and <code>Impl</code> implements <code>BaseInterface</code> then I assure you <code>ImplToo</code> will do the same."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345917, "post_id": 29955327, "comment_id": 48031880, "body": "Well, now you&#39;ve edited again and changed the answer.   Now you&#39;re removing my pointer (which is no bueno, since different &quot;subclass instances&quot; share a &quot;super&quot;), but it looks like this compiles even when it /is/ a pointer?  No need for reference/dereference?"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430345941, "post_id": 29955327, "comment_id": 48031888, "body": "Which totally works, but now I wonder - what happens if you have pkg1.Impl and pkg2.Impl?  Can&#39;t embed them both?    (I don&#39;t have that situation, but it&#39;s plausible)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430347265, "post_id": 29955327, "comment_id": 48032433, "body": "@BadZen I think it works the same with or without the embed being a pointer. I just removed it because I suspected it might cause an error. You could probably embed from two different packages without compiler errors. I know for example, embedding types can have method name collisions and there are some rules for which is executed that you can find in the spec."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430347327, "post_id": 29955327, "comment_id": 48032459, "body": "Cool, OK, calling this an answer then, TYVM"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1430345369, "last_edit_date": 1430345369, "creation_date": 1430344659, "answer_id": 29955327, "question_id": 29955093, "link": "https://stackoverflow.com/questions/29955093/proper-way-to-call-overloaded-method-of-embedded-type-in-go/29955327#29955327", "title": "Proper way to call overloaded method of embedded type in Go", "body": "<p>You're looking for;</p>\n\n<pre><code> type ImplToo struct {\n     pkg.Impl\n }\n\nfunc (it ImplToo) Nifty() bool { return it.Impl.Nifty() }\n</code></pre>\n\n<p>Your use of pointers isn't consistent which is probably (not positive) part of your problem. If you want to make the embedded type a pointer then make your methods receiving type a pointer as well to avoid this problem.</p>\n\n<p>If you want to explicitly use a method in the embedded type you reference it using the type where you would normally have a property name.</p>\n"}, {"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430346267, "post_id": 29955608, "comment_id": 48032010, "body": "It&#39;s working just fine now with a pointer in the embed and not in the receiver, I think.   Does that mean there is an extra copy of the receiving interface going on?  It doesn&#39;t compile when both are pointers:  <code>ImplToo does not implement pkg.BaseInterface (Nifty method has pointer receiver)</code>"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 1, "last_activity_date": 1430346088, "creation_date": 1430346088, "answer_id": 29955608, "question_id": 29955093, "link": "https://stackoverflow.com/questions/29955093/proper-way-to-call-overloaded-method-of-embedded-type-in-go/29955608#29955608", "title": "Proper way to call overloaded method of embedded type in Go", "body": "<p>What @evanmcdonnal said.  Your Nifty either need to take a pointer or not.  If you embed the pointer to <code>pkg.Impl</code> then your Nifty function needs to accept a struct pointer.  If your Nifty function doesn't take a pointer then your embeded type should not be a pointer.</p>\n\n<p>Here is an embedded pointer that works.</p>\n\n<p>\u00b7> cat main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"cs/pkg\"\n    \"fmt\"\n)\n\ntype ImplToo struct {\n    *pkg.Impl\n}\n\nfunc (it *ImplToo) Nifty() bool {\n    fmt.Printf(\"Impl.Nifty() is %t\\n\", it.Impl.Nifty())\n    return false\n}\n\nfunc main() {\n    i := new(ImplToo)\n    fmt.Println(i.Nifty())\n}\n</code></pre>\n\n<p>\u00b7> cat cs/pkg/test.go</p>\n\n<pre><code>package pkg\n\ntype BaseInterface interface {\n    Nifty() bool\n}\n\ntype Impl struct{}\n\nfunc (i *Impl) Nifty() bool {\n    return true\n}\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>Impl.Nifty() is true\nfalse\n</code></pre>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 543, "favorite_count": 0, "accepted_answer_id": 29955327, "answer_count": 2, "score": 0, "last_activity_date": 1430346088, "creation_date": 1430343646, "last_edit_date": 1430345370, "question_id": 29955093, "link": "https://stackoverflow.com/questions/29955093/proper-way-to-call-overloaded-method-of-embedded-type-in-go", "title": "Proper way to call overloaded method of embedded type in Go", "body": "<p>I have an interface: </p>\n\n<pre><code> package pkg\n type BaseInterface interface {\n     func Nifty() bool\n     func Other1() \n     func Other2()\n     ...\n     func Other34123()\n }\n</code></pre>\n\n<p>and a struct that implements it:</p>\n\n<pre><code> package pkg\n type Impl struct {}\n func (Impl) Nifty() bool { ... }\n</code></pre>\n\n<p>Then along comes another struct which wants to embed the first and do it's own Nifty():</p>\n\n<pre><code> package myOtherPackage\n import \"pkg\"\n type ImplToo struct {\n     *pkg.Impl\n }\n func (it ImplToo) Nifty() bool { ... something else ... }\n</code></pre>\n\n<p>This is sort of like class inheretance with method override in an OOP language.   I want to know how to do the equivalent of implToo.super().Nifty() - that is, from the ImplToo Nifty() implementation, call the pkg.Impl Nifty() implementation.</p>\n\n<p>What is the proper conversion to use on <code>it</code> so that  I can accomplish this?  Everything I try yields either unbounded recursion on ImplToo's Nifty(), or some compiler error such as:</p>\n\n<p><code>invalid type assertion: (&amp;it).(BaseInterface) (non-interface type *it on left)</code></p>\n\n<p>... or many variations on that.</p>\n"}, {"tags": ["sql", "postgresql", "go", "constraints"], "comments": [{"owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "edited": false, "score": 0, "creation_date": 1430334081, "post_id": 29951615, "comment_id": 48025471, "body": "What do you mean by &quot;in my application&quot;? Do you need to validate the model data before it is saved into the database?"}, {"owner": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "reply_to_user": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "edited": false, "score": 0, "creation_date": 1430334345, "post_id": 29951615, "comment_id": 48025624, "body": "@andybalholm Yes, or utilize the constraint error in some way."}, {"owner": {"reputation": 886, "user_id": 3556052, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/DjFtN.jpg?s=128&g=1", "display_name": "miracle_the_V", "link": "https://stackoverflow.com/users/3556052/miracle-the-v"}, "edited": false, "score": 0, "creation_date": 1430334723, "post_id": 29951615, "comment_id": 48025838, "body": "What for? This will duplicate database logic, doing the double work."}, {"owner": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "edited": false, "score": 0, "creation_date": 1430334926, "post_id": 29951615, "comment_id": 48025950, "body": "That&#39;s the question, how do I parse the error as a constraint error on <code>email</code>, from the example above? I suppose I should write this as two questions. One for constraint errors, post query and the other for data types, pre query."}, {"owner": {"reputation": 48635, "user_id": 6742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xPawo.png?s=128&g=1", "display_name": "David Aldridge", "link": "https://stackoverflow.com/users/6742/david-aldridge"}, "edited": false, "score": 0, "creation_date": 1430336721, "post_id": 29951615, "comment_id": 48027051, "body": "So is your question, &quot;How do I interpret PostgreSQL error messages from within Go in order to determine the cause of the problem?&quot;?"}, {"owner": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "reply_to_user": {"reputation": 48635, "user_id": 6742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xPawo.png?s=128&g=1", "display_name": "David Aldridge", "link": "https://stackoverflow.com/users/6742/david-aldridge"}, "edited": false, "score": 0, "creation_date": 1430337881, "post_id": 29951615, "comment_id": 48027681, "body": "@DavidAldridge Yes, I&#39;ve updated the question. Separating the validation and error checking questions makes much more sense. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "is_accepted": true, "score": 4, "last_activity_date": 1430345877, "creation_date": 1430345877, "answer_id": 29955564, "question_id": 29951615, "link": "https://stackoverflow.com/questions/29951615/how-do-i-interpret-postgresql-error-messages-from-within-go/29955564#29955564", "title": "How do I interpret PostgreSQL error messages from within Go?", "body": "<p>For information about how to interpret errors from github.com/lib/pq, see <a href=\"http://godoc.org/github.com/lib/pq#Error\" rel=\"nofollow\">http://godoc.org/github.com/lib/pq#Error</a>.</p>\n\n<p>Here is what I do:</p>\n\n<pre><code>// ShowError sends an appropriate error message.\nfunc ShowError(w http.ResponseWriter, r *http.Request, err error) {\n    switch e := err.(type) {\n    case *pq.Error:\n        switch e.Code {\n        case \"23502\":\n            // not-null constraint violation\n            http.Error(w, fmt.Sprint(\"Some required data was left out:\\n\\n\", e.Message), http.StatusForbidden)\n            return\n\n        case \"23503\":\n            // foreign key violation\n            switch r.Method {\n            case \"DELETE\":\n                http.Error(w, fmt.Sprint(\"This record can\u2019t be deleted because another record refers to it:\\n\\n\", e.Detail), http.StatusForbidden)\n                return\n            }\n\n        case \"23505\":\n            // unique constraint violation\n            http.Error(w, fmt.Sprint(\"This record contains duplicated data that conflicts with what is already in the database:\\n\\n\", e.Detail), http.StatusForbidden)\n            return\n\n        case \"23514\":\n            // check constraint violation\n            http.Error(w, fmt.Sprint(\"This record contains inconsistent or out-of-range data:\\n\\n\", e.Message), http.StatusForbidden)\n            return\n\n        default:\n            msg := e.Message\n            if d := e.Detail; d != \"\" {\n                msg += \"\\n\\n\" + d\n            }\n            if h := e.Hint; h != \"\" {\n                msg += \"\\n\\n\" + h\n            }\n            http.Error(w, msg, http.StatusInternalServerError)\n            return\n        }\n\n    case *strconv.NumError:\n        http.Error(w, fmt.Sprintf(`\"%s\" is not a valid number.`, e.Num), http.StatusBadRequest)\n        return\n\n    default:\n        switch err {\n        case sql.ErrNoRows:\n            http.NotFound(w, r)\n            return\n        }\n    }\n\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n}\n</code></pre>\n"}], "owner": {"reputation": 1587, "user_id": 2692578, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/422308f27d72a059a020981097da6589?s=128&d=identicon&r=PG", "display_name": "paulkon", "link": "https://stackoverflow.com/users/2692578/paulkon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 596, "favorite_count": 2, "accepted_answer_id": 29955564, "answer_count": 1, "score": 3, "last_activity_date": 1430364599, "creation_date": 1430331888, "last_edit_date": 1430364599, "question_id": 29951615, "link": "https://stackoverflow.com/questions/29951615/how-do-i-interpret-postgresql-error-messages-from-within-go", "title": "How do I interpret PostgreSQL error messages from within Go?", "body": "<p>How can I parse SQL constraint errors, in particular resulting from constraints such as <code>UNIQUE</code>, <code>FOREIGN KEY</code>, <code>NOT NULL</code>, <code>ON DELETE RESTRICT</code> within Go?</p>\n\n<p>e.g. Insert a new user that may have the same email which is defined as a <code>UNIQUE</code> field in the database. Parse constraint error in Go, return error to browser client.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1430325933, "post_id": 29949777, "comment_id": 48020291, "body": "I can&#39;t either until you tell me what output you expect."}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1430326012, "post_id": 29949777, "comment_id": 48020349, "body": "What I get is <code>{  0}</code>, and what I expected is an instance of the struct ApiParams populated with the json in variable <code>data</code>."}], "answers": [{"comments": [{"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1430326157, "post_id": 29949811, "comment_id": 48020443, "body": "Thanks, it works. But why? I have another camel cased, as opposed to this underscored one. that one works without the double quotes."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 3, "creation_date": 1430326951, "post_id": 29949811, "comment_id": 48020983, "body": "@ElgsQianChen: it needs quotes, because that&#39;s the defined syntax. The CamelCase example works, because Go will map the names to lowercase while decoding if there is no tag defined."}, {"owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "edited": false, "score": 0, "creation_date": 1430327329, "post_id": 29949811, "comment_id": 48021256, "body": "Thanks @rightfold, I need to clarify when I talked about camel case, I meant the tag is in camel."}], "tags": [], "owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "is_accepted": true, "score": 2, "last_activity_date": 1430325976, "creation_date": 1430325976, "answer_id": 29949811, "question_id": 29949777, "link": "https://stackoverflow.com/questions/29949777/decoding-json-in-golang/29949811#29949811", "title": "Decoding json in Golang", "body": "<p>Add double quotes to the tags:</p>\n\n<pre><code>type ApiParams struct {\n    AccessToken string `json:\"access_token\"`\n    TokenType   string `json:\"token_type\"`\n    ExpiresIn   int64  `json:\"expires_in\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1430326029, "creation_date": 1430326029, "answer_id": 29949827, "question_id": 29949777, "link": "https://stackoverflow.com/questions/29949777/decoding-json-in-golang/29949827#29949827", "title": "Decoding json in Golang", "body": "<p>Your annotations are wrong.. You need quotes around the json property names like;</p>\n\n<pre><code>type ApiParams struct {\n    AccessToken string `json:\"access_token\"`\n    TokenType   string `json:\"token_type\"`\n    ExpiresIn   int64  `json:\"expires_in\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 12745, "user_id": 1663023, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/fc43a735e2c498f450a9908a5bd9ebf4?s=128&d=identicon&r=PG", "display_name": "Qian Chen", "link": "https://stackoverflow.com/users/1663023/qian-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "closed_date": 1430515793, "accepted_answer_id": 29949811, "answer_count": 2, "score": 0, "last_activity_date": 1430326029, "creation_date": 1430325867, "question_id": 29949777, "link": "https://stackoverflow.com/questions/29949777/decoding-json-in-golang", "closed_reason": "Not suitable for this site", "title": "Decoding json in Golang", "body": "<p>I cannot figure out what's wrong in my code to decode this json. It returns an empty struct. Go playground here: <a href=\"http://play.golang.org/p/K8WznLT5M0\" rel=\"nofollow\">http://play.golang.org/p/K8WznLT5M0</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype ApiParams struct {\n    AccessToken string `json:access_token`\n    TokenType   string `json:token_type`\n    ExpiresIn   int64  `json:expires_in`\n}\n\nfunc main() {\n    data := `{\n            \"access_token\": \"asdfasdf\",\n            \"token_type\": \"bearer\",\n            \"expires_in\": 5173885\n    }`\n\n    var apiParams ApiParams\n    err := json.Unmarshal([]byte(data), &amp;apiParams)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(apiParams)\n}\n</code></pre>\n"}, {"tags": ["tcp", "concurrency", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1430322312, "post_id": 29948497, "comment_id": 48017940, "body": "goroutines aren&#39;t threads. They are however the proper way to handle concurrent actions in the language, e.g. waiting on Accept from multiple sockets."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 3, "creation_date": 1430322362, "post_id": 29948497, "comment_id": 48017979, "body": "You should maybe watch this video <a href=\"https://www.youtube.com/watch?v=cN_DpYBzKso\" rel=\"nofollow noreferrer\">youtube.com/watch?v=cN_DpYBzKso</a> and generally try to rethink channels because you don&#39;t get their purpose or how to use them to control the flow of your program...  Channels can serve as a blocking mechanism in addition to their primary use which is to pass data into and out of goroutines. Passing connections into channels makes no sense. A more sensible application would be to pass a channel into a method you call in a goroutine, open the connection there and send data back to the caller on the channel. Maybe you have a blocking select there..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1430324576, "post_id": 29948497, "comment_id": 48019464, "body": "@evanmcdonnal -  Can you show me an example of the approach you suggest?   I don&#39;t understand what you are talking about.   I&#39;m trying to multiplex accept() from multiple sockets with other channel recvs."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430325145, "post_id": 29948497, "comment_id": 48019793, "body": "Also please see my comment below on @tomasz answer for a clear use case for passing connections on channels.   Whatever you&#39;re suggesting has to accomplish the same as that."}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 1, "creation_date": 1430325733, "post_id": 29948497, "comment_id": 48020173, "body": "Go isn&#39;t Node.js. You can spawn 50k goroutines just fine and blocking I/O is implemented in terms of async I/O."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1430330904, "post_id": 29948497, "comment_id": 48023463, "body": "For future reference, instead of expressing incredulity about how language X doesn&#39;t work the way you think it should; you&#39;ll get a better response simply explaining <i>what</i> you want to do, and asking <i>how</i> to it in language X."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430331174, "post_id": 29948497, "comment_id": 48023635, "body": "By &quot;better response&quot; I assume you mean &quot;I won&#39;t popularity-contest downvote bomb you&quot;.   Or maybe you don&#39;t.  I don&#39;t know.   In any case I got a proper answer to my (legitimate, site-appropriate) question which is what I wanted.  I&#39;m still incredulous, though.   Accept() as channel is obvious and a huge pain to work around not having, as we&#39;ve seen here."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1452702227, "post_id": 29948497, "comment_id": 57288525, "body": "You can actually make <code>accept</code> non blocking by using <code>SetDeadline</code>. That way <code>accept</code> will timeout giving you ability to check for abort condition or something else. Yes, it not an ideal way and you will have to wait for a timeout to occur but it works. I agree with you on that one - <code>accept</code> doesn&#39;t work very well with everything else in the language and implementing it as a channel would be great"}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430324792, "post_id": 29948954, "comment_id": 48019609, "body": "The goal of this is not to spawn a connection for each connection here.  That will of course happen, just like it would in any accept/handle net server with a concurrent model in any language.  The goal is to be able to treat all blocking operations consistently.   For example, I might want to be able to multiplex accept() in with a timer goroutine that signals with a channel - if an accept in any of these N server sockets has not happened in timeMillis seconds, execute this code..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430324825, "post_id": 29948954, "comment_id": 48019629, "body": "That&#39;s simply not possible with using Accept() the way it is, or with spawning off a handler immediately on accept as you suggest.  With traditional concurrency you&#39;d use the &quot;normal&quot; kind of select() on the socket fds with a timed wait.  But that&#39;s not available in Go, because channels are favored.  So I&#39;m trying to wrap the accept() in a channel. Make sense?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430325173, "post_id": 29948954, "comment_id": 48019811, "body": "@BadZen The way to do that is in a select after the go routine. You use a timer and send on a channel when it expires. In select you call your method in the case that receives on the channel. So no matter what after some Duration d you will send on channel &#39;doCleanUp&#39; and that will call your method &#39;doCleanUp&#39; which could for example kill all your go routines and write some status to disk then exit. If I have time today I&#39;ll code up some contrived example but basically you should select in the async method and after you invoke it. In both cases you need an exit/abort channel you listen/send on"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430325462, "post_id": 29948954, "comment_id": 48020012, "body": "Yes, I understand how to multiplex a timer channel with a single &quot;join point&quot; in a goroutine.   Listen to what I&#39;m saying:  &quot;if an accept in <i>any of these N server sockets</i> has not happened in timeMillis seconds, execute &lt;default branch code&gt;&quot;   The N server sockets correspond to N instances of the goroutine in my code."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430325528, "post_id": 29948954, "comment_id": 48020052, "body": "If you really are proposing something that will execute some code any time a select has not happened in any of those goroutines for a (shared among all, reset-on-any-single-select) interval of time, I apologize for not understanding, but I&#39;m not seeing what you are suggesting."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430326281, "post_id": 29948954, "comment_id": 48020531, "body": "@BadZen: you don&#39;t have a traditional select, but your example is still easily doable. You can have a timer and every acceptor can call <code>timer.Reset</code> to prevent calling the &quot;default branch&quot; etc. Or you can send all the accepted sockets into one channel and multiplex with the timer, as per your example. That&#39;s fine and easy to implement. You don&#39;t want the accept to be called when the default branch is being executed? Add a mutex or use yet another channel. And so on and so on. You just need to do this differently than with traditional select. Am I wrong?"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1430326524, "post_id": 29948954, "comment_id": 48020690, "body": "Oh, sure, yeah - I&#39;m not saying your answer doesn&#39;t address my use case (didn&#39;t think of the &quot;spawn and reset timer /w mutex&quot; option, though that seems less clean to me) - I was addressing @evanmcdonnal in the last two comments.   Sorry, should&#39;ve tagged.  Was really just looking for &quot;is what I wrote here sane relative to Go, or is there a Better Way&quot;..."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1430326818, "post_id": 29948954, "comment_id": 48020890, "body": "No worries, no misunderstanding here, I was simply addressing your problem. The mutex idea wasn&#39;t particularly good anyway \u2013 your code sample is basically solving the problem: you&#39;re sending all the events from acceptor to one routine, which is multiplexing this channel with a timer, calling some default branch on timeout (acceptors are then blocked, no need to mutex anything, sorry for the crazy idea). So yes, basically you can&#39;t do a traditional select and your sample code seem the most idiomatic for me. And I really think is easily readable."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 1, "creation_date": 1430327937, "post_id": 29948954, "comment_id": 48021652, "body": "@BadZen, I&#39;ve added a fuller example, it might be similar to what you already have, but it will make my response clearer."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430328136, "post_id": 29948954, "comment_id": 48021787, "body": "Awesome.  Yeah, that&#39;s what I was intending (only with multiple select channels, possibly constructed reflectively, so ack messy left it out) but I should&#39;ve included in the original."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430328209, "post_id": 29948954, "comment_id": 48021825, "body": "Calling this answered, since at least one person wasn&#39;t like &quot;OMG you&#39;re doing it wrong&quot;, and no better suggestions..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430328429, "post_id": 29948954, "comment_id": 48021954, "body": "Actually one thing:   any real problem (philosophical or pragmatic) with defer/recover in the accept goroutines to deal with the closing-channel panic you point out?  ( If the listener is closed, I&#39;d expect the pending Accept() to exit, but then there&#39;s still a race condition from listener close to accept channel close...)"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 1, "creation_date": 1430329419, "post_id": 29948954, "comment_id": 48022547, "body": "My example was more for multiple listeners with one acceptor routine each, so one accept failure wouldn&#39;t indicate the failure in another. Are you suggesting multiple acceptors for a single listener? This wouldn&#39;t be very useful in this use case I think, one is enough. Anyway, regarding recovering, I don&#39;t think it&#39;s a nice solution when you know it might happen due to a race condition and you would implement it for a very specific use case (e.g. one and only one listener). There&#39;s no reason to if you can easily do it the right way."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430329785, "post_id": 29948954, "comment_id": 48022757, "body": "Yeah, 1:1 listener acceptor, of course.   I was just thinking that maybe you could avoid the panic by closing the Listener (causing Accept() to unblock)  before closing the channel.  There&#39;s no race condition, disregard that - my bad.  The acceptor goroutines would error-exit on listener close and not try to write.   I think this all works now, TYVM."}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": true, "score": 3, "last_activity_date": 1430327901, "last_edit_date": 1430327901, "creation_date": 1430323329, "answer_id": 29948954, "question_id": 29948497, "link": "https://stackoverflow.com/questions/29948497/tcp-accept-and-go-concurrency-model/29948954#29948954", "title": "TCP accept and Go concurrency model", "body": "<p>Your code is just fine. You could even go further and replace:</p>\n\n<pre><code>s.acceptChannel &lt;-&amp;Connection{tcpConn: rw, .... }\n</code></pre>\n\n<p>with:</p>\n\n<pre><code>go handleConnection(&amp;Connection{tcpConn: rw, .... })\n</code></pre>\n\n<p>As mentioned in the comments, routines are not system threads, they are lightweight threads managed by Go runtime. When you create a routine for every connection, you can easily use blocking operations, which are easier to implement. Go runtime is then <em>selecting</em> the routines for you, so the behaviour you're looking for is simply somewhere else, buried into the language. You can't see it, but it's everywhere.</p>\n\n<p>Now, if you need something more sophisticated and, per our conversation, implement something similar to select with a timeout, you would do exactly what you're suggesting: push all the new connection to a channel and multiplex it with a timer. This seems the way to go in Go.</p>\n\n<p>Take a note you can't close the accept channel if <em>one</em> of you acceptors fails as another one would panic while writing to it.</p>\n\n<p>My (fuller) example:</p>\n\n<pre><code>newConns := make(chan net.Conn)\n\n// For every listener spawn the following routine\ngo func(l net.Listener) {\n    for {\n        c, err := l.Accept()\n        if err != nil {\n            // handle error (and then for example indicate acceptor is down)\n            newConns &lt;- nil\n            return\n        }\n        newConns &lt;- c\n    }\n}(listener)\n\nfor {\n    select {\n    case c := &lt;-newConns:\n        // new connection or nil if acceptor is down, in which case we should\n        // do something (respawn, stop when everyone is down or just explode)\n    case &lt;-time.After(time.Minute):\n        // timeout branch, no connection for a minute\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5710, "favorite_count": 0, "accepted_answer_id": 29948954, "answer_count": 1, "score": 4, "last_activity_date": 1430328946, "creation_date": 1430322045, "last_edit_date": 1430328946, "question_id": 29948497, "link": "https://stackoverflow.com/questions/29948497/tcp-accept-and-go-concurrency-model", "title": "TCP accept and Go concurrency model", "body": "<p>Looking at <code>net.TCPListener</code>.   One would expect, given the Go concurrency paradigm, for this system functionality to be implemented as a channel, so that you got a <code>chan *net.Conn</code> from a <code>Listen()</code> function, or something similar to that.</p>\n\n<p>But it seems Accept() is the way, and that just blocks, just like the system accept.  Except it's crippled, because:</p>\n\n<ul>\n<li>There is no proper select() you can use with it, because go prefers channels</li>\n<li>There is no way to set the blocking options for the server sockets.</li>\n</ul>\n\n<p>So I'm doing something like:</p>\n\n<pre><code>    acceptChannel = make(chan *Connection)\n    go func() {\n      for {\n       rw, err := listener.Accept()\n       if err != nil { ... handle error ... close(acceptChannel) ... return }\n       s.acceptChannel &lt;-&amp;Connection{tcpConn: rw, .... }\n      }\n    }()\n</code></pre>\n\n<p>Just so that I can use multiple server sockets in a select, or multiplex the wait on Accept() with other channels.  Am I missing something?   I'm new to Go, so I might be overlooking things - but did Go really not implement its own blocking system functions with its own concurrency paradigm?  Do I really need a separate goroutine for every socket (possibly hundreds or thousands) I want to listen with?  Is this the correct idiom to be using, or is there a better way?</p>\n"}, {"tags": ["logging", "go"], "comments": [{"owner": {"reputation": 332764, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1430317904, "post_id": 29946675, "comment_id": 48014458, "body": "Without resorting to macros a solution could be to change the <code>log</code> variable in one point : it could be either a real log function or a noop. Note also that the go compiler would remove the whole <code>if (someconstantwhichisfalse) { log(...) }</code> block."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1430318969, "post_id": 29946675, "comment_id": 48015342, "body": "Small functions will usually be inlined by <code>gc</code> (the Go compiler), so calling a function which checks a <code>bool</code> and forwards will <i>usually</i> be equaly fast as checking a bool around a the log-call."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1430320964, "post_id": 29946675, "comment_id": 48017015, "body": "If you have a <code>someStringFn</code> to format a value of type <code>Thing</code>, why don&#39;t you just define a <code>String</code> method on it? That would be more idiomatic and would also solve your problem."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430325230, "post_id": 29947507, "comment_id": 48019846, "body": "I think in your <code>type Log bool</code> example you might be missing an <code>if l {\u2026}</code>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430325555, "post_id": 29947507, "comment_id": 48020072, "body": "@DaveC, Since you need to wrap the call in an <code>if</code> anyway to prevent the args from being evaluated, you technically don&#39;t need to check it again in the method call. I think having it still print if you forget the check is more helpful since it enforces the <code>if</code> check idiom, but neither way would be <i>wrong</i>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430327309, "post_id": 29947507, "comment_id": 48021238, "body": "Oh, sorry, I thought you were trying to make it like <code>glog</code> supporting one line use (and rely on the compiler to inline the boolean comparison and forwarding function call). Although, <code>glog</code> provides both ways since the inlining would still evaluate arguments."}, {"owner": {"reputation": 186, "user_id": 4846435, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AQQye2-d0e4/AAAAAAAAAAI/AAAAAAAABig/uprMuwHLDjA/photo.jpg?sz=128", "display_name": "Alan Conway", "link": "https://stackoverflow.com/users/4846435/alan-conway"}, "edited": false, "score": 0, "creation_date": 1430408196, "post_id": 29947507, "comment_id": 48063618, "body": "I would like to allow the one liner since most of the time log messages do have simple args. It relies on people not to forget the if when they do something more complex. I&#39;ve done things like that before even in C++, if you need to do something more than just a function call you put an explicit if around the lot. I think that&#39;s what I&#39;ll go for. Thanks all!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1430325792, "last_edit_date": 1430325792, "creation_date": 1430319617, "answer_id": 29947507, "question_id": 29946675, "link": "https://stackoverflow.com/questions/29946675/how-to-do-trace-logging-in-go-with-very-low-cost-for-disabled-log-statements/29947507#29947507", "title": "How to do trace logging in Go with very low cost for disabled log statements", "body": "<p>All arguments in Go are guaranteed to be evaluated, and there's no defined preprocessor macros in the language, so there's only a couple things you can do.</p>\n\n<p>To avoid expensive function calls in the logging arguments, make use of the <code>fmt.Stringer</code> and <code>fmt.GoStringer</code> interfaces to delay formatting until the function is executed. That way you can still pass the plain types to <code>Printf</code> functions. You can extend this pattern yourself with a custom logger that checks for various interfaces as well. This is what you're using in your <code>Stringify</code> example, and you can only really enforce it with code review and unit tests.</p>\n\n<pre><code>type LogFormatter interface {\n    LogFormat() string\n}\n\n// inside the logger\nif i, ok := i.(LogFormatter); ok {\n    fmt.Println(i.LogFormat())\n}\n</code></pre>\n\n<p>You can also swap out the entire logger out at runtime via a logger interface, or replace it entirely at build time using <a href=\"http://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow\">build constraints</a>, but still requires ensuring no expensive calls are inserted into the logging arguments.</p>\n\n<p>Another pattern used by some packages like glog is to make the Logger itself a bool. This doesn't eliminate the verbosity completely, but it makes it a little more terse.</p>\n\n<pre><code>type Log bool\nfunc (l Log) Println(args ...interface{}) {\n    fmt.Println(args...)\n}\n\nvar debug Log = false\n\nif debug {\n    debug.Println(\"DEBUGGING\")\n}\n</code></pre>\n\n<p>The closest you can get to a macro pre-processing in go is to use code generation. This isn't going to work for runtime configurable tracing, but could at least provide a separate debug build that can be dropped into place when needed. It can be as simple as <code>gofmt -r</code>, building a file using <code>text/template</code>, or full generation by parsing the code and building an AST.</p>\n"}, {"comments": [{"owner": {"reputation": 186, "user_id": 4846435, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AQQye2-d0e4/AAAAAAAAAAI/AAAAAAAABig/uprMuwHLDjA/photo.jpg?sz=128", "display_name": "Alan Conway", "link": "https://stackoverflow.com/users/4846435/alan-conway"}, "edited": false, "score": 1, "creation_date": 1430323018, "post_id": 29948378, "comment_id": 48018459, "body": "Clever! But more verbose than the if. I guess a simple boolean flag and explicit if is the way to go."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1430321769, "creation_date": 1430321769, "answer_id": 29948378, "question_id": 29946675, "link": "https://stackoverflow.com/questions/29946675/how-to-do-trace-logging-in-go-with-very-low-cost-for-disabled-log-statements/29948378#29948378", "title": "How to do trace logging in Go with very low cost for disabled log statements", "body": "<p>First of all, I should say that I personally would go with the simplest solution and just use an <code>if</code>. But if you really want to do it reliably, you can use anonymous functions:</p>\n\n<pre><code>type verbose bool\n\nfunc (v verbose) Run(f func()) {\n    if v {\n        f()\n    }\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>v := verbose(false)\nv.Run(func() {\n    log.Println(\"No Print\")\n})\n</code></pre>\n\n<p>Playground example with expensive calls: <a href=\"http://play.golang.org/p/9pm2HoQQ8A\" rel=\"nofollow\">http://play.golang.org/p/9pm2HoQQ8A</a>.</p>\n"}], "owner": {"reputation": 186, "user_id": 4846435, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AQQye2-d0e4/AAAAAAAAAAI/AAAAAAAABig/uprMuwHLDjA/photo.jpg?sz=128", "display_name": "Alan Conway", "link": "https://stackoverflow.com/users/4846435/alan-conway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1570, "favorite_count": 1, "answer_count": 2, "score": 12, "last_activity_date": 1430325792, "creation_date": 1430317691, "question_id": 29946675, "link": "https://stackoverflow.com/questions/29946675/how-to-do-trace-logging-in-go-with-very-low-cost-for-disabled-log-statements", "title": "How to do trace logging in Go with very low cost for disabled log statements", "body": "<p>It is useful to leave low-level debug/trace logging statements in critical paths so that they can be enabled by runtime configuration. The idea is you never turn such logging on in production (it would cripple performance) but you <em>can</em> turn it on in a production <em>environment</em> (e.g. production system taken offline for debugging or a test system that is set up exactly like the production system.)</p>\n\n<p>This type of logging has a special requirement: the cost of hitting a <em>disabled</em> log statement on a critical path must be <em>very</em> low: ideally a single boolean test.</p>\n\n<p>In C/C++ I would do this with a LOG macro that does not evaluate any of its arguments until it has checked a flag. Only if enabled do we call some helper function to format &amp; deliver the log message.</p>\n\n<p>So how to do this in Go?</p>\n\n<p>Using io.Discard with log.Logger is a non starter: it completely formats the log message every time before throwing it away if disabled.</p>\n\n<p>My first thought is </p>\n\n<pre><code>type EnabledLogger struct { Enabled bool; delegate *log.Logger;... }\n// Implement the log.Logger interface methods as:\nfunc (e EnabledLogger) Print(...) { if e.Enabled { e.delegate.Output(...) } }\n</code></pre>\n\n<p>This is close. If I say:</p>\n\n<pre><code>myEnabledLogger.Printf(\"foo %v: %v\", x, y)\n</code></pre>\n\n<p>It won't format or log anything if disabled but it <em>will</em> evaluate the arguments x and y. That's OK for basic types or pointers, not OK for arbitrary function calls - e.g. to stringify values that don't have a String() method.</p>\n\n<p>I see two ways around that:</p>\n\n<p>Wrapper types to defer the call:</p>\n\n<pre><code>type Stringify { x *Thing }\nfunc (s Stringify) String() { return someStringFn(s.x) }\nenabledLogger.Printf(\"foo %v\", Stringify{&amp;aThing})\n</code></pre>\n\n<p>Wrap the whole thing in a manual enabled check:</p>\n\n<pre><code>if enabledLog.Enabled {\n     enabledLog.Printf(\"foo %v\", someStringFn(x))\n}\n</code></pre>\n\n<p>Both are verbose and error prone, it is too easy for someone to forget a step and quietly introduce a nasty performance regression.</p>\n\n<p>I'm starting to like Go. Please tell me it can solve this problem :)</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1430303858, "post_id": 29940968, "comment_id": 48003200, "body": "And btw it&#39;s not the compiler that complains: it&#39;s the runtime (<code>panic: runtime error: ...</code>)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1430304987, "post_id": 29940968, "comment_id": 48003993, "body": "Really helpful on all these types of issues is taking the whole Go Tour tour.golang.org and reading the blog."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1430304167, "last_edit_date": 1430304167, "creation_date": 1430303306, "answer_id": 29941029, "question_id": 29940968, "link": "https://stackoverflow.com/questions/29940968/slice-index-out-of-range-but-one-space-is-free/29941029#29941029", "title": "Slice index out of range but one space is free", "body": "<p>The index is only valid in the range of <code>0..len(b)-1</code>. Quoting from the <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow\">spec</a>:</p>\n\n<blockquote>\n  <p>The elements can be addressed by integer indices <code>0</code> through <code>len(s)-1</code>.</p>\n</blockquote>\n\n<p>Elements beyond the length (but within the capacity) are unavailable through indexing. You can only access those elements if you <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow\">reslice</a> the slice to include those elements (but within the capacity).</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 29941029, "answer_count": 1, "score": 0, "last_activity_date": 1430304167, "creation_date": 1430303161, "last_edit_date": 1430303781, "question_id": 29940968, "link": "https://stackoverflow.com/questions/29940968/slice-index-out-of-range-but-one-space-is-free", "title": "Slice index out of range but one space is free", "body": "<p>I am trying to figure out how slice resizing works and I have the following sample:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    s := []byte{'A', 'W', 'T', 'Q', 'X'}\n    b := s[2:4]\n    fmt.Println(s, len(s), cap(s))\n    fmt.Println(string(b), len(b), cap(b))\n    b[1] = 'H'\n    b[2] = 'V'\n    fmt.Println(string(b))\n\n}\n</code></pre>\n\n<p>The compiler complains:</p>\n\n<pre><code>panic: runtime error: index out of range\n</code></pre>\n\n<p><code>b</code> has capacity of <code>3</code>, why can I not assign like </p>\n\n<pre><code>b[2] = 'V'\n</code></pre>\n"}, {"tags": ["regex", "string", "go"], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 951018, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/rnFgc.jpg?s=128&g=1", "display_name": "grotos", "link": "https://stackoverflow.com/users/951018/grotos"}, "edited": false, "score": 0, "creation_date": 1430296896, "post_id": 29938325, "comment_id": 47998248, "body": "I did it, but the reason I use FindAllSubmatch because it takes byte as input. If I download a file the result is bytes, should I convert it at this stage to string?"}], "tags": [], "owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "is_accepted": true, "score": 3, "last_activity_date": 1430297266, "last_edit_date": 1592644375, "creation_date": 1430296258, "answer_id": 29938325, "question_id": 29937787, "link": "https://stackoverflow.com/questions/29937787/golang-regex-findallstringsubmatch-to-string/29938325#29938325", "title": "Golang Regex: FindAllStringSubmatch to []string", "body": "<p>It's all explained extensively in the <a href=\"https://golang.org/pkg/regexp/\" rel=\"nofollow noreferrer\">package's documentation</a>.<br />\nRead the parapgraph which explains :</p>\n<blockquote>\n<p>There are 16 methods of Regexp that match a regular expression and identify the matched text. Their names are matched by this regular expression:</p>\n<p>Find(All)?(String)?(Submatch)?(Index)?</p>\n</blockquote>\n<p>In your case, you probably want to use <code>FindAllStringSubmatch</code>.</p>\n<hr />\n<p>In <code>Go</code>, a <code>string</code> is just a read-only <code>[]byte</code>.<br />\nYou can choose to either keep passing <code>[]byte</code> variables around,<br />\nor cast the <code>[]byte</code> values to <code>string</code> :</p>\n<pre><code>var byteSlice = []byte{'F','o','o'}\nvar str string\n\nstr = string(byteSlice)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 587, "user_id": 3587115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/veo3Q.jpg?s=128&g=1", "display_name": "Sundrique", "link": "https://stackoverflow.com/users/3587115/sundrique"}, "is_accepted": false, "score": 1, "last_activity_date": 1430301334, "creation_date": 1430301334, "answer_id": 29940266, "question_id": 29937787, "link": "https://stackoverflow.com/questions/29937787/golang-regex-findallstringsubmatch-to-string/29940266#29940266", "title": "Golang Regex: FindAllStringSubmatch to []string", "body": "<p>You can simply iterate through the bytes result as you would do for strings result using two nested loop, and just convert slice of bytes to a string in the second loop:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    f := [][][]byte{{{'a', 'b', 'c'}}}\n    for _, line := range f {\n        for _, match := range line { // match is a type of []byte\n            fmt.Println(string(match))\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/vINSF5yCF_\" rel=\"nofollow\">Playground</a></p>\n"}], "owner": {"reputation": 393, "user_id": 951018, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/rnFgc.jpg?s=128&g=1", "display_name": "grotos", "link": "https://stackoverflow.com/users/951018/grotos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1681, "favorite_count": 0, "accepted_answer_id": 29938325, "answer_count": 2, "score": 0, "last_activity_date": 1430301334, "creation_date": 1430294737, "question_id": 29937787, "link": "https://stackoverflow.com/questions/29937787/golang-regex-findallstringsubmatch-to-string", "title": "Golang Regex: FindAllStringSubmatch to []string", "body": "<p>I download a multiline file from Amazon S3 in format like:</p>\n\n<pre><code>ColumnAv1 ColumnBv1 ColumnCv1 ...\nColumnAv2 ColumnBv2 ColumnCv2 ...\n</code></pre>\n\n<p>the file is of type byte. Then I want to parse this with regex:</p>\n\n<pre><code>matches := re.FindAllSubmatch(file,-1)\n</code></pre>\n\n<p>then I want to feed result row by row to function which takes <code>[]string</code> as input (<code>string[0]</code> is <code>ColumnAv1</code>, <code>string[1]</code> is <code>ColumnBv2</code>, ...).</p>\n\n<p>How should I convert result of <code>[][][]byte</code> to <code>[]string</code> containing first, second, etc row? I suppose I should do it in a loop, but I cannot get this working:</p>\n\n<pre><code>for i:=0;i&lt;len(len(matches);i++{\n    tmp:=myfunction(???)\n}\n</code></pre>\n\n<p>BTW, Why does function <code>FindAllSubmatch</code> return <code>[][][]byte</code> whereas <code>FindAllStringSubmatch</code> return <code>[][]string</code>?</p>\n\n<p>(Sorry I don't have right now access to my real example, so the syntax may not be proper)</p>\n"}, {"tags": ["go", "slice", "reader"], "answers": [{"tags": [], "owner": {"reputation": 59918, "user_id": 694331, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/gxxid.png?s=128&g=1", "display_name": "ANisus", "link": "https://stackoverflow.com/users/694331/anisus"}, "is_accepted": false, "score": 1, "last_activity_date": 1430291846, "creation_date": 1430291846, "answer_id": 29936798, "question_id": 29936700, "link": "https://stackoverflow.com/questions/29936700/the-reader-interface-change-value/29936798#29936798", "title": "The Reader interface change value", "body": "<p>The slice header in Go contains in itself a pointer to the underlaying array.</p>\n\n<p>You can read from the official blog post: <a href=\"https://blog.golang.org/slices\" rel=\"nofollow\">https://blog.golang.org/slices</a></p>\n\n<blockquote>\n  <p>Even though the slice header is passed by value, the header includes a pointer to elements of an array, so both the original slice header and the copy of the header passed to the function describe the same array. Therefore, when the function returns, the modified elements can be seen through the original slice variable.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1430292191, "post_id": 29936818, "comment_id": 47995440, "body": "A slice is exactly not a reference type. It&#39;s a value type, which contains a reference to the underlying array."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1430292411, "post_id": 29936818, "comment_id": 47995571, "body": "@Anonymous By <i>reference</i> I don&#39;t mean the same as <i>pointer</i>. But edited to make it unambigous. Thanks."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1430293918, "post_id": 29936818, "comment_id": 47996538, "body": "@Anonymous <i>Reference</i> type is not the same as <i>Pointer</i> type. Please check blog article <a href=\"http://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">Go maps in action</a>: <i>&quot;Map types are <b>reference</b> types, like pointers or <b>slices</b>&quot;</i>"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1430303877, "post_id": 29936818, "comment_id": 48003220, "body": "I think it&#39;s an error in that article that it describes slices as a reference type."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1430318988, "last_edit_date": 1430318988, "creation_date": 1430291881, "answer_id": 29936818, "question_id": 29936700, "link": "https://stackoverflow.com/questions/29936700/the-reader-interface-change-value/29936818#29936818", "title": "The Reader interface change value", "body": "<p>Everything is passed by value (by creating a copy of the value being passed).</p>\n\n<p>But since slices in Go are just <em>descriptors</em> for a contiguous segment of an underlying array, the descriptor will be copied which will refer to the same underlying array, so if you modify the <em>contents</em> of the slice, the same underlying array is modified.</p>\n\n<p>If you modify the slice value itself in the function, that is not reflected at the calling place, because the slice value is just a copy and the copy will be modified (not the original slice descriptor value).</p>\n\n<p>If you pass a pointer, the value of the pointer is also passed by value (the pointer value will be copied), but in this case if you modify the <em>pointed</em> value, that will be the same as at the calling place (the copy of the pointer and the original pointer points to the same object/value).</p>\n\n<p>Related blog articles:</p>\n\n<p><a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow\">Go Slices: usage and internals</a></p>\n\n<p><a href=\"http://blog.golang.org/slices\" rel=\"nofollow\">Arrays, slices (and strings): The mechanics of 'append'</a></p>\n"}, {"tags": [], "owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "is_accepted": false, "score": 0, "last_activity_date": 1430294894, "creation_date": 1430294894, "answer_id": 29937852, "question_id": 29936700, "link": "https://stackoverflow.com/questions/29936700/the-reader-interface-change-value/29937852#29937852", "title": "The Reader interface change value", "body": "<p>It is the exact same behaviour as passing a pointer in <code>C</code> :</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n// p is passed by value ; however, this function does not modify p,\n// it modifies the values pointed by p.\nvoid read(int* p) {\n    int i;\n    for( i=0; i&lt;10; i++) {\n        p[i] = i+1;\n    }\n}\n\n// p is passed by value, so changing p itself has no effect out\n// of the function's scope\nvoid passAsValue(int*p) {\n   int* c = (int*)malloc(3*sizeof(int));\n\n   c[0] = 15; // 'F' in hex is 15 ...\n   c[1] = 0;\n   c[2] = 0;\n\n   p = c;\n}\n\nint main() {\n    int* p = (int*)malloc(10*sizeof(int));\n    int i;\n    for( i=0; i&lt;10; i++) {\n        p[i] = 0;\n    }\n\n    printf(\"             init : p[0] = %d\\n\", p[0]);\n\n    read(p);\n    printf(\"       after read : p[0] = %d\\n\", p[0]);\n\n    passAsValue(p);\n    printf(\"after passAsValue : p[0] = %d\\n\", p[0]);\n\n    return 0;\n}\n</code></pre>\n\n<p>output :</p>\n\n<pre><code>//             init : p[0] = 0\n//       after read : p[0] = 1\n//after passAsValue : p[0] = 1 // &lt;- not 15, the modification from\n//                             //    within passAsValue is not persistent\n</code></pre>\n\n<p>(for the record : this C program leaks the <code>int* c</code> array)</p>\n\n<p>A <code>Go</code> slice contains more info than just the pointer : it is a small struct, which contains the pointer, the length, and the max capacity of the allocated array (see the link mentioned in other answers : <a href=\"https://blog.golang.org/slices\" rel=\"nofollow\">https://blog.golang.org/slices</a> ).<br>\nBut from the code's perspective, it behaves exactly like the <code>C</code> pointer.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 29936818, "answer_count": 3, "score": -2, "last_activity_date": 1475314113, "creation_date": 1430291583, "last_edit_date": 1475314113, "question_id": 29936700, "link": "https://stackoverflow.com/questions/29936700/the-reader-interface-change-value", "title": "The Reader interface change value", "body": "<p>I have a question about the reader interface, the definition looks like:</p>\n\n<pre><code>type Reader interface {\n    Read(p []byte) (n int, err error)\n}\n</code></pre>\n\n<p>I have following code that use the reader interface:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\n// Reading files requires checking most calls for errors.\n// This helper will streamline our error checks below.\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc main() {\n\n    // You'll often want more control over how and what\n    // parts of a file are read. For these tasks, start\n    // by `Open`ing a file to obtain an `os.File` value.\n    f, err := os.Open(\"configuration.ini\")\n    check(err)\n\n    // Read some bytes from the beginning of the file.\n    // Allow up to 5 to be read but also note how many\n    // actually were read.\n    b1 := make([]byte, 10)\n    n1, err := f.Read(b1)\n    check(err)\n    fmt.Printf(\"%d bytes: %s\\n\", n1, string(b1))\n\n    f.Close()\n\n}\n</code></pre>\n\n<p>As you can see the code above, <code>b1</code> is defined as byte slice and it passed to the <code>Read</code> method as value argument. After the <code>Read</code> method, the <code>b1</code> contains the first 10 letters from file.   </p>\n\n<p>What for me very confusing about the code above is, why does <code>b1</code> contains suddenly values after the <code>Read</code> method.  </p>\n\n<p>In Golang, when I pass a value to the method, it will be passed as value and not as reference. To clarify, what I talking about, I made a sample application:</p>\n\n<pre><code>package main\n\n\nimport (\n    \"fmt\"\n)\n\nfunc passAsValue(p []byte) {\n    c := []byte(\"Foo\")\n    p = c\n}\n\nfunc main() {\n\n    b := make([]byte, 10)\n    passAsValue(b)\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>After <code>passAsValue</code> function, <code>b</code> does not contain any values and that what I expected in golang, arguments will be pass as value to the function or method.  </p>\n\n<p>Why then, the first code snippet can change the content of the passed argument? If the <code>Read</code> method expects a pointer of <code>[]byte</code> slice, then I would be agreed, but on this case not.  </p>\n"}, {"tags": ["ajax", "post", "curl", "go", "polymer"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1430290257, "post_id": 29936106, "comment_id": 47994303, "body": "Browsers usually also send headers like &quot;User-Agent&quot; and &quot;Referer&quot; and those are not listed as allowed headers in your CORS middelware - perhaps thats the problem?"}, {"owner": {"reputation": 5733, "user_id": 3858196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nzf18.jpg?s=128&g=1", "display_name": "Kushal Sharma", "link": "https://stackoverflow.com/users/3858196/kushal-sharma"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1430291721, "post_id": 29936106, "comment_id": 47995175, "body": "@ain i added &quot;User-Agent&quot; and &quot;Referer&quot; as AllowedHeaders but still get a 500 in response :("}, {"owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "edited": false, "score": 0, "creation_date": 1430303165, "post_id": 29936106, "comment_id": 48002709, "body": "What go packages do you use ?  Try dumping (in the Go server) the complete request (e.g : all Headers and content) to inspect what is different between your <code>curl</code> request and your polymer request."}, {"owner": {"reputation": 779, "user_id": 842569, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8e9c825a0cbaad377d920617e99532d2?s=128&d=identicon&r=PG&f=1", "display_name": "zunder", "link": "https://stackoverflow.com/users/842569/zunder"}, "edited": false, "score": 1, "creation_date": 1430324922, "post_id": 29936106, "comment_id": 48019670, "body": "Did you try setting &#39;Access-Control-Allow-Origin&#39; header to &#39;*&#39;?"}, {"owner": {"reputation": 482, "user_id": 1094516, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wHenq.jpg?s=128&g=1", "display_name": "Niels", "link": "https://stackoverflow.com/users/1094516/niels"}, "edited": false, "score": 0, "creation_date": 1430436867, "post_id": 29936106, "comment_id": 48078594, "body": "Does it help setting the headers?this.$.ajax.headers=&#39;{&quot;X-Requested-With&quot;: &quot;XMLHttpRequest&quot;&#39;};"}, {"owner": {"reputation": 5733, "user_id": 3858196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nzf18.jpg?s=128&g=1", "display_name": "Kushal Sharma", "link": "https://stackoverflow.com/users/3858196/kushal-sharma"}, "reply_to_user": {"reputation": 482, "user_id": 1094516, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wHenq.jpg?s=128&g=1", "display_name": "Niels", "link": "https://stackoverflow.com/users/1094516/niels"}, "edited": false, "score": 0, "creation_date": 1430448954, "post_id": 29936106, "comment_id": 48081502, "body": "@Niels Drost  I&#39;m away from computer, will try that and get back here asap."}], "answers": [{"comments": [{"owner": {"reputation": 5733, "user_id": 3858196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nzf18.jpg?s=128&g=1", "display_name": "Kushal Sharma", "link": "https://stackoverflow.com/users/3858196/kushal-sharma"}, "edited": false, "score": 0, "creation_date": 1430946427, "post_id": 29981647, "comment_id": 48288309, "body": "Thanks, that worked! i had to work around CORS though (moved my polymer code on same domain)"}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 2, "last_activity_date": 1430454877, "last_edit_date": 1495540878, "creation_date": 1430454877, "answer_id": 29981647, "question_id": 29936106, "link": "https://stackoverflow.com/questions/29936106/post-request-to-golang-server-using-polymer-core-ajax/29981647#29981647", "title": "Post request to golang server using polymer core-ajax?", "body": "<p>I think CORS is a red herring. The problem may be that you are sending the data form-encoded and not as json. I found a bug from a user with a <a href=\"https://github.com/ant0ine/go-json-rest/issues/105\" rel=\"nofollow noreferrer\">similar problem</a>.</p>\n\n<pre><code>HTTP/1.1 500 Internal Server Error\nContent-Type: application/json\nX-Powered-By: go-json-rest\nDate: Fri, 12 Dec 2014 04:29:59 GMT\nContent-Length: 71\n\n{\n  \"Error\": \"invalid character '\\\\'' looking for beginning of value\"\n}\n</code></pre>\n\n<p>Perhaps you should use <code>.body</code> instead of <code>.data</code>? See <a href=\"https://stackoverflow.com/questions/24898357/polymer-core-ajax-wont-post-json?answertab=votes#24898458\">this answer</a>. </p>\n\n<p>From the polymer <a href=\"https://www.polymer-project.org/0.5/docs/elements/core-ajax.html\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>body: Optional raw body content to send when method === \"POST\".</p>\n  \n  <p>Example:</p>\n</blockquote>\n\n<pre><code>&lt;core-ajax method=\"POST\" auto url=\"http://somesite.com\"\n    body='{\"foo\":1, \"bar\":2}'&gt;\n&lt;/core-ajax&gt;\n</code></pre>\n"}], "owner": {"reputation": 5733, "user_id": 3858196, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nzf18.jpg?s=128&g=1", "display_name": "Kushal Sharma", "link": "https://stackoverflow.com/users/3858196/kushal-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 600, "favorite_count": 0, "accepted_answer_id": 29981647, "answer_count": 1, "score": 0, "last_activity_date": 1430454877, "creation_date": 1430289676, "last_edit_date": 1430324954, "question_id": 29936106, "link": "https://stackoverflow.com/questions/29936106/post-request-to-golang-server-using-polymer-core-ajax", "title": "Post request to golang server using polymer core-ajax?", "body": "<p>I am trying to make a POST request using polymer core-ajax to server runnung golang. After a lot of search (because i am new to this stuff) i ended up with the following code. Also, GET request is working perfect. POST parameters i dont understand how to pass using core-ajax. </p>\n\n<pre><code>&lt;polymer-element name=\"register-user\" attributes=\"url\"&gt;\n    &lt;template&gt;\n        &lt;core-ajax id=\"ajaxSubmit\" url=\"{{url}}\" contentType=\"application/json\" handleAs=\"json\" method=\"post\" on-core-response=\"{{response}}\"&gt;&lt;/core-ajax&gt;\n        &lt;style type=\"text/css\"&gt;\n        &lt;/style&gt;\n    &lt;/template&gt;\n    &lt;script&gt;\n    Polymer({\n        buttonListener: function() {\n            var data = '{\"Name\":\"'+ this.name +'\", \"Email\":\"'+ this.email +'\"}';\n            this.$.ajaxSubmit.data = data;\n            this.$.ajaxSubmit.go();\n            console.log(data);\n        },\n        response: function(oldValue){\n            console.log(this.response);\n        }\n    });\n    &lt;/script&gt;\n&lt;/polymer-element&gt;\n</code></pre>\n\n<p>above code returns <code>500 (Internal Server Error)</code> however when i make a POST request using curl i.e </p>\n\n<pre><code>curl -i -H 'Content-Type: application/json' -d '{\"Name\":\"Batman\",    \n     \"Email\":\"batman@gmail.com\"}' http://so.me.ip.ad:8080/register\n</code></pre>\n\n<p>it works as it should and returns </p>\n\n<pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\nX-Powered-By: go-json-rest\nDate: Wed, 29 Apr 2015 05:40:15 GMT\nContent-Length: 117\n\n{\n  \"id\": 3,\n  \"name\": \"Batman\",\n  \"email\": \"batman@gmail.com\",\n  \"createdAt\": \"2015-04-29T05:40:15.073491143Z\"\n}\n</code></pre>\n\n<p>also, i have a CORS middleware set up on server i.e</p>\n\n<pre><code>api.Use(&amp;rest.CorsMiddleware{\n    RejectNonCorsRequests: false,\n    OriginValidator: func(origin string, request *rest.Request) bool {\n        return origin == \"http://0.0.0.0:8000\"\n    },\n    AllowedMethods: []string{\"GET\", \"POST\", \"PUT\"},\n    AllowedHeaders: []string{\n        \"Accept\", \"Content-Type\", \"X-Custom-Header\", \"Origin\"},\n    AccessControlAllowCredentials: true,\n    AccessControlMaxAge:           3600,\n})\n</code></pre>\n\n<p>What am i doing wrong? Any feedback will be of great help! Thanks ^.^</p>\n\n<p>Edit : here is a little more info if it can help.. <img src=\"https://i.stack.imgur.com/IMhuE.png\" alt=\"screenshot\"></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12277, "user_id": 25844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65696762785acc1a7c92726e68cd935c?s=128&d=identicon&r=PG", "display_name": "mkb", "link": "https://stackoverflow.com/users/25844/mkb"}, "edited": false, "score": 0, "creation_date": 1430277064, "post_id": 29933547, "comment_id": 47989403, "body": "This is not an answer to your actual question, but why do you iterate through the map of types to handlers in <code>GetHandler</code>? You can return <code>bus.handlers[t]</code> and that will return <code>nil</code> for undefined handlers."}, {"owner": {"reputation": 8858, "user_id": 728241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6b74da9a3777793f2b48e20de23760bc?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/728241/david"}, "reply_to_user": {"reputation": 12277, "user_id": 25844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65696762785acc1a7c92726e68cd935c?s=128&d=identicon&r=PG", "display_name": "mkb", "link": "https://stackoverflow.com/users/25844/mkb"}, "edited": false, "score": 0, "creation_date": 1430277143, "post_id": 29933547, "comment_id": 47989424, "body": "@mkb because i&#39;m dumb haha"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430277579, "post_id": 29933547, "comment_id": 47989535, "body": "possibly related to <a href=\"http://stackoverflow.com/questions/9643205/how-do-i-compare-two-functions-for-pointer-equality-in-the-latest-go-weekly\" title=\"how do i compare two functions for pointer equality in the latest go weekly\">stackoverflow.com/questions/9643205/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 4, "last_activity_date": 1430276905, "creation_date": 1430276905, "answer_id": 29933640, "question_id": 29933547, "link": "https://stackoverflow.com/questions/29933547/how-to-compare-funcs-in-golang/29933640#29933640", "title": "how to compare funcs in golang", "body": "<p>Given that you can't compare functions, you can write your test in a different way. You can make <code>handler</code> set a boolean value in your test and check that you've got the right function by calling it and seeing if the boolean changes.</p>\n\n<p>Here's an example:</p>\n\n<pre><code>func main() {\n    bus := New()\n    called := false\n    handler := func (cmd interface{}) { called = true }\n\n    bus.RegisterHandler(&amp;RegisterUserCommand{}, handler)\n    bus.GetHandler(&amp;RegisterUserCommand{})(nil)\n\n    if called {\n        fmt.Println(\"We got the right handler!\")\n        return\n    }\n\n    fmt.Println(\"We didn't get the right handler\")\n}\n</code></pre>\n"}], "owner": {"reputation": 8858, "user_id": 728241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/6b74da9a3777793f2b48e20de23760bc?s=128&d=identicon&r=PG", "display_name": "David", "link": "https://stackoverflow.com/users/728241/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430276905, "creation_date": 1430276398, "question_id": 29933547, "link": "https://stackoverflow.com/questions/29933547/how-to-compare-funcs-in-golang", "title": "how to compare funcs in golang", "body": "<p>I'm attempting write a test for my package and failing at comparing funcs. Here's essentially what i'm doing.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype HandlerFunc func(cmd interface{})\n\ntype Bus struct {\n    handlers map[reflect.Type]HandlerFunc\n}\n\nfunc (bus *Bus) RegisterHandler(cmd interface{}, handler HandlerFunc) {\n    bus.handlers[reflect.TypeOf(cmd)] = handler\n}\n\nfunc (bus *Bus) GetHandler(cmd interface{}) HandlerFunc {\n    t := reflect.TypeOf(cmd)\n\n    for kind, handler := range bus.handlers {\n        if t == kind {\n            return handler\n        }\n    }\n\n    return nil\n}\n\nfunc New() *Bus {\n    return &amp;Bus{\n        handlers:    make(map[reflect.Type]HandlerFunc),\n    }\n}\n\ntype RegisterUserCommand struct {}\n\nfunc main() {\n    bus := New()\n    handler := func (cmd interface{}) {}\n\n    bus.RegisterHandler(&amp;RegisterUserCommand{}, handler)\n\n    retrieved := bus.GetHandler(&amp;RegisterUserCommand{})\n\n    if retrieved != handler {\n        fmt.Println(\"Not the same!\")\n        return\n    }\n\n    fmt.Println(\"Same!\")\n}\n</code></pre>\n\n<p>Comparing <code>retrieved</code> with <code>handler</code> causes the following error</p>\n\n<pre><code>invalid operation: (func(interface {}))(retrieved) != handler (func can only be compared to nil)\n</code></pre>\n\n<p>How can i properly test the function i'm retrieving is the same one added previously?</p>\n"}, {"tags": ["multithreading", "concurrency", "go"], "comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430268519, "post_id": 29932360, "comment_id": 47987177, "body": "(The accepted answer in the previous post solves OP&#39;s specific use case - sidestepping the issue by allowing the race condition to strike in specific circumstance.  Therefore, it is useful to him but does not literally answer his question.   My question here is for the literal answer to his question.  Please note the difference and see my comment there before flagging dup)"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1430279985, "post_id": 29932360, "comment_id": 47990273, "body": "From your question and link, it looks like you&#39;re putting real effort in, so may be worth working through the Tour (which covers default select at <a href=\"http://tour.golang.org/concurrency/6\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/6</a>), <a href=\"http://golang.org/ref/spec\" rel=\"nofollow noreferrer\">the spec</a> (section &quot;Select statements&quot; covers this), or <a href=\"http://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">Effective Go</a> (where this comes up in an example in the section headed &quot;A leaky buffer&quot;)."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1430280143, "post_id": 29932360, "comment_id": 47990324, "body": "Yeah, I&#39;m looking at those, thanks.  I kind of &quot;dumbed down&quot; my use case in these couple of posts such that the answers were correct but not directly useful.   What I&#39;m really trying to do might be described as &quot;transparent all-or-nothing channel multiplexing&quot;, ie. fan-outs that only send to any receivers if they can all receive.   I&#39;ve accomplished what I needed to combining the default case thing (yes, I&#39;m new to Go! :p ) with the reflect version of Select, and having a weird kind of &quot;pump&quot; goroutine collecting from input and sending to output..."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1430280216, "post_id": 29932360, "comment_id": 47990347, "body": "There&#39;s also a lot on concurrency specifically in the <a href=\"https://talks.golang.org/2012/concurrency.slide#1\" rel=\"nofollow noreferrer\">Go Concurrency Patterns</a> and <a href=\"http://talks.golang.org/2012/waza.slide\" rel=\"nofollow noreferrer\">Concurrency is not parallelism</a> talks. (That wasn&#39;t in response to your last comment, started writing before I saw it.)"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1430280925, "post_id": 29932360, "comment_id": 47990563, "body": "A question describing your use case for checking the blocking status of a set of channels might shake out an alternative approach. Maybe you want a <code>WaitGroup</code> for waiting until all workers are ready, or maybe there&#39;s just an entirely different way to approach the overall problem that fits more easily with what Go provides."}], "answers": [{"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 9, "last_activity_date": 1430268852, "creation_date": 1430268852, "answer_id": 29932520, "question_id": 29932360, "link": "https://stackoverflow.com/questions/29932360/is-there-a-reliable-way-to-ensure-a-go-channel-does-not-block-on-read/29932520#29932520", "title": "Is there a reliable way to ensure a Go channel does not block on read?", "body": "<p>This is exactly what default cases in <code>select</code> are for:</p>\n\n<pre><code>var elm myType\nselect {\ncase elm = &lt;-myChannel:\ndefault:\n}\nreturn elm\n</code></pre>\n\n<p>This assigns <code>elm</code> if it can, and otherwise returns a zero value. See \"A leaky buffer\" from <a href=\"http://golang.org/doc/effective_go.html\">Effective Go</a> for a somewhat more extensive example.</p>\n"}, {"tags": [], "owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "is_accepted": false, "score": 2, "last_activity_date": 1430405250, "creation_date": 1430405250, "answer_id": 29970861, "question_id": 29932360, "link": "https://stackoverflow.com/questions/29932360/is-there-a-reliable-way-to-ensure-a-go-channel-does-not-block-on-read/29970861#29970861", "title": "Is there a reliable way to ensure a Go channel does not block on read?", "body": "<p>Rob Napier's answer is correct.</p>\n\n<p>However, you are possibly trying too hard to achieve non-blocking behaviour, assuming that it is an anti-pattern.</p>\n\n<p>With Go, you <em>don't</em> have to worry about blocking. Go ahead, block without guilt. It can make code much easier to write, especially when dealing with i/o.</p>\n\n<p>CSP allows you to design data-driven concurrent programs that can scale very well (because of not using mutexes too much). Small groups of goroutines communicating via channels can behave like a component of a larger system; these components (also communicating via channels) can be grouped into larger components; this pattern repeats at increasing scales.</p>\n\n<p>Conventionally, people start with sequential code and then try to add concurrency by adding goroutines, channels, mutexes etc. As an exercise, try something different: try designing a system to be <em>maximally concurrent</em> - use goroutines and channels as deeply as you possibly can. You might be unimpressed with the performance you achieve ... so then perhaps try to consider how to improve it by <em>combining</em> (rather than <em>dividing</em>) blocks, reducing the total number of goroutines and so achieving a more optimal concurrency.</p>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 211, "favorite_count": 0, "accepted_answer_id": 29932520, "answer_count": 2, "score": 0, "last_activity_date": 1430405250, "creation_date": 1430267786, "last_edit_date": 1495542513, "question_id": 29932360, "link": "https://stackoverflow.com/questions/29932360/is-there-a-reliable-way-to-ensure-a-go-channel-does-not-block-on-read", "title": "Is there a reliable way to ensure a Go channel does not block on read?", "body": "<p>This is a followup to <a href=\"https://stackoverflow.com/questions/27687114/reliable-way-to-ensure-a-go-channel-does-not-block\">a previous thread with a similar name</a>.</p>\n\n<p>It has an accepted answer, but that answer does not really answer the question.   From that thread, here is the use-case:</p>\n\n<pre><code>if len(myChannel) &gt; 0 {\n   // Possible issue here: length could have changed to 0 making this blocking\n   elm := &lt;- myChannel\n   return elm\n }\n</code></pre>\n\n<p>The OP calls it a \"Possible issue\", but it's a Definite Issue:  a race condition in which another consumer may have pulled a value from the channel between the evaluation of the if condition and execution of the two statements. </p>\n\n<p>Now, we are told the Go Way is to favor channels over mutex, but here it seems we can not acheive even basic non-blocking read (by polling length and reading atomically) without pairing a mutex and a channel together, and using our new concurrency data type instead of a channel.</p>\n\n<p>Can that be right?  Is there really no way to reliably ensure a recv does not block by checking ahead for space?  (Compare with BlockingQueue.poll() in Java, or similar facilities in other queue-based messaging IPC facilities...)</p>\n"}, {"tags": ["shell", "go", "port", "pid"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430270200, "post_id": 29932291, "comment_id": 47987653, "body": "If you want this information from within your program, just use the <code>Addr()</code> method on the <a href=\"https://golang.org/pkg/net/#Listener\" rel=\"nofollow noreferrer\"><code>net.Listener</code></a>. If you want it outside, you could either do something like <code>netstat</code> or you could have your program save the address/port being used somewhere (just like how many daemon write a pidfile)."}], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 4, "last_activity_date": 1430269355, "creation_date": 1430269355, "answer_id": 29932589, "question_id": 29932291, "link": "https://stackoverflow.com/questions/29932291/how-to-find-the-ports-that-is-being-used-by-a-process-in-golang-or-in-general/29932589#29932589", "title": "How to find the ports that is being used by a process in golang or in general?", "body": "<p>It's OS specific, but on linux you can do </p>\n\n<p><code>netstat -npl</code></p>\n\n<p>that will list which programs are listening on which ports</p>\n\n<p>If you just want to print it out from your app, you can use the alternative form of starting the http server by creating your own tcp listener and then call http.Serve</p>\n\n<p>example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    lsnr, err := net.Listen(\"tcp\", \":0\")\n    if err != nil {\n        fmt.Println(\"Error listening:\", err)\n        os.Exit(1)\n    }\n    fmt.Println(\"Listening on:\", lsnr.Addr())\n    err = http.Serve(lsnr, nil)\n    fmt.Println(\"Server exited with:\", err)\n    os.Exit(1)\n}\n</code></pre>\n\n<p>outputs:</p>\n\n<pre><code>Listening on: [::]:53939\n</code></pre>\n"}], "owner": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2152, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1430269355, "creation_date": 1430267356, "question_id": 29932291, "link": "https://stackoverflow.com/questions/29932291/how-to-find-the-ports-that-is-being-used-by-a-process-in-golang-or-in-general", "title": "How to find the ports that is being used by a process in golang or in general?", "body": "<p>My binary takes a port parameter and starts a http server. If pass a 0 to the -port, it will find a free port and start on it.</p>\n\n<p>After this, how do I find which port is this if I have the command object with me and can get the process id? I am trying to write my application in golang. I am also curious how this is done in general.</p>\n"}, {"tags": ["concurrency", "go"], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430263698, "post_id": 29931569, "comment_id": 47985697, "body": "This comes pretty close to what I actually need  - the limitation is that I can only get a single bit of information across (yes, I know that&#39;s all I asked for - hard to explain my actual use case precisely in terms of common stuff) say now instead of &quot;server is finished&quot; we have &quot;server has taken on a new state from a discrete, known set of possible states&quot;.   If I could do one of (acquire a mutex atomically when recv from channel (posix style) | receive from n channels all-or-nothing (windows style) | receive only certain kinds of messages (oldschool OO languages-style), we&#39;d be golden."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430263713, "post_id": 29931569, "comment_id": 47985700, "body": "Will go ahead and mark answered though since it&#39;s helpful and does answer what I asked."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430268099, "post_id": 29931569, "comment_id": 47987044, "body": "Yeah, that works I think.   It&#39;s like using a channel close as a replacement for a (one-shot) condition variable broadcast, though, and not as a channel.  Feels hackish.   But hey, will def take it.  I started implementing something like that based on this answer (had close() semantics wrong in my head!)  and I&#39;m now trying to wrap it so that the send can be to a &quot;broadcast channel&quot; instead of a specialized function (ie.  Go-like).   TYVM."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430268238, "post_id": 29931569, "comment_id": 47987089, "body": "Why the downvote, by the way?   Something wrong with the question?  Please leave feedback."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430297747, "post_id": 29931569, "comment_id": 47998781, "body": "@BadZen I actually upvoted your question, but if you want a bit of constructive criticism, your question was a bit long and your problem was a bit hard to understand, I wasn&#39;t even sure my solution is what you were looking for, you could have made it a bit more abstract and clear. Perhaps someone didn&#39;t like that. But it&#39;s a good question and I&#39;m glad I could help with that close() trick, it saved my ass in this situation a couple of times :)"}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 2, "last_activity_date": 1430263386, "last_edit_date": 1430263386, "creation_date": 1430262906, "answer_id": 29931569, "question_id": 29930861, "link": "https://stackoverflow.com/questions/29930861/how-to-synchronize-multiple-goroutines-to-the-termination-of-a-selected-goroutin/29931569#29931569", "title": "How to synchronize multiple goroutines to the termination of a selected goroutine (ie. Thread.join())", "body": "<p>I think what you want can be done by selecting on a single shared channel, and then having the server close it when it's done. </p>\n\n<p>Say we create a global \"Exit channel\", that's shared across all goroutines. It can be created before the \"server\" goroutine is created. The important part is that the server goroutine never sends anything down the channel, but simply closes it.</p>\n\n<p>Now the client goroutines, simply do this:</p>\n\n<pre><code>select {\n    case &lt;- ch:\n    fmt.Println(\"Channel closed, server is done!\")\n    case &lt;-time.After(time.Second):\n    fmt.Println(\"Timed out. do recovery stuff\")\n\n}\n</code></pre>\n\n<p>and the server goroutine just does:</p>\n\n<pre><code>close(ch)\n</code></pre>\n\n<p>More complete example:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"time\"\n\n)\n\n\nfunc waiter(ch chan struct{}) {\n    fmt.Println(\"Doing stuff\")\n\n    fmt.Println(\"Waiting...\")\n\n    select {\n        case &lt;- ch:\n        fmt.Println(\"Channel closed\")\n        case &lt;-time.After(time.Second):\n        fmt.Println(\"Timed out. do recovery stuff\")\n\n    }\n}\n\n\nfunc main(){\n\n    ch := make(chan struct{})\n\n    go waiter(ch)\n    go waiter(ch)\n    time.Sleep(100*time.Millisecond)\n    fmt.Println(\"Closing channel\")\n    close(ch)\n\n    time.Sleep(time.Second)\n\n}\n</code></pre>\n\n<p>This can be abstracted as the following utility API:</p>\n\n<pre><code>type TimedCondition struct {\n    ch chan struct{}\n}\n\nfunc NewTimedCondition()*TimedCondition {\n    return &amp;TimedCondition {\n        ch: make(chan struct{}),\n    }\n}\n\nfunc (c *TimedCondition)Broadcast() {\n    close(c.ch)\n}\n\nfunc (c *TimedCondition)Wait(t time.Duration) error {\n    select {\n        // channel closed, meaning broadcast was called\n        case &lt;- c.ch:\n            return nil\n        case &lt;-time.After(t):\n            return errors.New(\"Time out\")   \n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 0, "accepted_answer_id": 29931569, "answer_count": 1, "score": 0, "last_activity_date": 1430263386, "creation_date": 1430259031, "last_edit_date": 1430262631, "question_id": 29930861, "link": "https://stackoverflow.com/questions/29930861/how-to-synchronize-multiple-goroutines-to-the-termination-of-a-selected-goroutin", "title": "How to synchronize multiple goroutines to the termination of a selected goroutine (ie. Thread.join())", "body": "<p>I asked this in a previous question, but some people felt that my original question was not detailed enough (\"Why would you ever want a timed condition wait??\")  so here is a more specific one.</p>\n\n<p>I have a goroutine running, call it server.  It is already started, will execute for some amount of time, and do its thing.  Then, it will exit since it is done.  </p>\n\n<p>During its execution some large number of other goroutines start.  Call them \"client\" threads if you like.   They run step A, and step B.   Then, they must wait for the \"server\" goroutine to finish for a specified amount of time, and exit with status  if \"server is not finished, and say run step C if it finishes.</p>\n\n<p>(Please do not tell me how to restructure this workflow.  It is hypothetical and a given.   It cannot be changed.)</p>\n\n<p>A normal, sane way to do this is to have the server thread signal a condition variable with a selectAll or Broadcast function, and have the other threads in a timed wait state monitoring the condition variable.  </p>\n\n<pre><code>func (s *Server) Join(timeMillis int) error {\n  s.mux.Lock()\n  defer s.mux.Unlock()\n  while !s.isFinished {\n     err = s.cond.Wait(timeMillis)\n     if err != nil {\n        stepC()\n     }\n  }\n  return err\n}\n</code></pre>\n\n<p>Where the server will enter a state where isFinished becomes true and broadcast signal the condition variable atomically with respect to the mutex.  Except this is impoosible, since Go does not support timed condition waits. (But there is a Broadcast()) </p>\n\n<p>So, what is the \"Go-centric\" way to do this?  I've reall all of the Go blogs and documentation, and this pattern or its equivalent, despite its obviousness, never comes up, nor any equivalent \"reframing\" of the basic problem - which is that IPC style channels are between one routine and one other routine.   Yes, there is fan-in/fan-out, but remember these threads are constantly appearing and vanishing.   This should be simple - and crucially /not leave thousands of \"wait-state\" goroutines hanging around waiting for the server to die when the other \"branch\" of the mux channel (the timer) has signalled/.</p>\n\n<p>Note that some of the \"client\" above might be started before the server goroutine has started (this is when channel is usually created), some might appear during, and some might appear after...  in all cases they should run stepC if and only if the server has run and exited after timeMillis milliseconds post entering the Join() function...</p>\n\n<p>In general the channels facility seems sorely lacking when there's more than one consumer.  \"First build a registry of channels to which listeners are mapped\" and \"there's this really nifty recursive data structure which sends itself over a channel it holds as field\" are so.not.ok as replacements to the nice, reliable, friendly, obvious:  wait(forSomeTime)</p>\n"}, {"tags": ["go", "bigint"], "answers": [{"tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 6, "last_activity_date": 1430284875, "last_edit_date": 1430284875, "creation_date": 1430257769, "answer_id": 29930553, "question_id": 29930501, "link": "https://stackoverflow.com/questions/29930501/big-int-ranges-in-go/29930553#29930553", "title": "Big int ranges in Go", "body": "<p>Working with big numbers can be kind of clunky because you need to create a big.Int for constants. Other than that, it is a straight forward replacement of each segment of the for statement to one made to deal with big ints.</p>\n\n<p><a href=\"http://play.golang.org/p/pLSd8yf9Lz\" rel=\"nofollow\">http://play.golang.org/p/pLSd8yf9Lz</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nvar one = big.NewInt(1)\n\nfunc main() {\n    start := big.NewInt(1)\n    end := big.NewInt(5)\n    // i must be a new int so that it does not overwrite start\n    for i := new(big.Int).Set(start); i.Cmp(end) &lt; 0; i.Add(i, one) {\n        fmt.Println(i)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1216, "user_id": 1627968, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4568c8ef9068eada35e5ed74ee4d471b?s=128&d=identicon&r=PG", "display_name": "Benjamin Rowell", "link": "https://stackoverflow.com/users/1627968/benjamin-rowell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1103, "favorite_count": 0, "accepted_answer_id": 29930553, "answer_count": 1, "score": 0, "last_activity_date": 1430284875, "creation_date": 1430257504, "question_id": 29930501, "link": "https://stackoverflow.com/questions/29930501/big-int-ranges-in-go", "title": "Big int ranges in Go", "body": "<p>Is there a way to loop over intervals between two <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow\">big</a> int values, x and y, in Go?</p>\n\n<pre><code>for i: = x; i &lt; y; i++ {\n    // do something\n}\n</code></pre>\n"}, {"tags": ["go", "gnupg", "pgp", "openpgp"], "answers": [{"tags": [], "owner": {"reputation": 1344, "user_id": 1445077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0f377e9263784a0036c5417d0a18aef?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/1445077/matt"}, "is_accepted": true, "score": 3, "last_activity_date": 1430322965, "creation_date": 1430322965, "answer_id": 29948833, "question_id": 29929750, "link": "https://stackoverflow.com/questions/29929750/go-golang-openpg-create-key-pair-and-create-signature/29948833#29948833", "title": "Go - Golang openpg - Create Key pair and create signature", "body": "<p>Maybe this will do what you want. Disclaimer: I am not an expert in openpgp; I don't know whether this is correct or not. But it does work with gpg --import.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"os\"\n\n        \"golang.org/x/crypto/openpgp\"\n        \"golang.org/x/crypto/openpgp/armor\"\n)\n\nfunc main() {\n        var e *openpgp.Entity\n        e, err := openpgp.NewEntity(\"itis\", \"test\", \"itis@itis3.com\", nil)\n        if err != nil {\n                fmt.Println(err)\n                return\n        }\n\n        // Add more identities here if you wish\n\n        // Sign all the identities\n        for _, id := range e.Identities {\n                err := id.SelfSignature.SignUserId(id.UserId.Id, e.PrimaryKey, e.PrivateKey, nil)\n                if err != nil {\n                        fmt.Println(err)\n                        return\n                }\n        }\n\n        w, err := armor.Encode(os.Stdout, openpgp.PublicKeyType, nil)\n        if err != nil {\n                fmt.Println(err)\n                return\n        }\n        defer w.Close()\n\n        e.Serialize(w)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3575, "user_id": 111866, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e742e21c1b64a037eaa90aea1fdf7874?s=128&d=identicon&r=PG", "display_name": "Ross Light", "link": "https://stackoverflow.com/users/111866/ross-light"}, "is_accepted": false, "score": 2, "last_activity_date": 1446612007, "creation_date": 1446612007, "answer_id": 33513828, "question_id": 29929750, "link": "https://stackoverflow.com/questions/29929750/go-golang-openpg-create-key-pair-and-create-signature/33513828#33513828", "title": "Go - Golang openpg - Create Key pair and create signature", "body": "<p>This seems to be a known issue: <a href=\"https://github.com/golang/go/issues/6483\" rel=\"nofollow\">https://github.com/golang/go/issues/6483</a>.  The workaround is to call <code>SerializePrivate</code> first, even if you don't use the result.</p>\n"}, {"comments": [{"owner": {"reputation": 2174, "user_id": 2369389, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/f3URs.jpg?s=128&g=1", "display_name": "madduci", "link": "https://stackoverflow.com/users/2369389/madduci"}, "edited": false, "score": 0, "creation_date": 1578848372, "post_id": 39626592, "comment_id": 105564585, "body": "what about using a SmartCard as cryptographic generator? Do you think would be possible with Go?"}], "tags": [], "owner": {"reputation": 2976, "user_id": 2217509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LlNg0.jpg?s=128&g=1", "display_name": "Alok", "link": "https://stackoverflow.com/users/2217509/alok"}, "is_accepted": false, "score": 3, "last_activity_date": 1474499510, "last_edit_date": 1474499510, "creation_date": 1474491966, "answer_id": 39626592, "question_id": 29929750, "link": "https://stackoverflow.com/questions/29929750/go-golang-openpg-create-key-pair-and-create-signature/39626592#39626592", "title": "Go - Golang openpg - Create Key pair and create signature", "body": "<p>I wrote <a href=\"https://github.com/alokmenghrajani/gpgeez\" rel=\"nofollow\">https://github.com/alokmenghrajani/gpgeez</a> for exactly this purpose. It's a Go library which makes things like key creating or exporting a key as an armored string easier.</p>\n\n<p>Here is the gist of it, without any error checking:</p>\n\n<pre><code>func CreateKey() *openpgp.Entity {\n  key, _ := openpgp.NewEntity(name, comment, email, nil)\n\n  for _, id := range key.Identities {\n    id.SelfSignature.PreferredSymmetric = []uint8{...}    \n    id.SelfSignature.PreferredHash = []uint8{...}    \n    id.SelfSignature.PreferredCompression = []uint8{...}\n\n    id.SelfSignature.SignUserId(id.UserId.Id, key.PrimaryKey, key.PrivateKey, nil)\n  }\n\n  // Self-sign the Subkeys\n  for _, subkey := range key.Subkeys {\n    subkey.Sig.SignKey(subkey.PublicKey, key.PrivateKey, nil)\n  }\n\n  return r\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 2312668, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cd8b91faad0583852d6e8dac2228536?s=128&d=identicon&r=PG", "display_name": "Thea Queen", "link": "https://stackoverflow.com/users/2312668/thea-queen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3623, "favorite_count": 1, "accepted_answer_id": 29948833, "answer_count": 3, "score": 4, "last_activity_date": 1474499510, "creation_date": 1430254516, "last_edit_date": 1430298118, "question_id": 29929750, "link": "https://stackoverflow.com/questions/29929750/go-golang-openpg-create-key-pair-and-create-signature", "title": "Go - Golang openpg - Create Key pair and create signature", "body": "<p>I'm currently working on openpgp in combination with golang. I use the following code to generate a new keypair and create a self-signature on the resulting public key:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"crypto\"\n    \"time\"\n    \"golang.org/x/crypto/openpgp\"\n    \"golang.org/x/crypto/openpgp/armor\"\n    \"golang.org/x/crypto/openpgp/packet\"\n    \"fmt\"\n)\n\n//Create ASscii Armor from openpgp.Entity\nfunc PubEntToAsciiArmor(pubEnt *openpgp.Entity) (asciiEntity string) {\n    gotWriter := bytes.NewBuffer(nil)\n    wr, errEncode := armor.Encode(gotWriter, openpgp.PublicKeyType, nil)\n    if errEncode != nil {\n        fmt.Println(\"Encoding Armor \", errEncode.Error())\n        return\n    }\n    errSerial := pubEnt.Serialize(wr)\n    if errSerial != nil {\n        fmt.Println(\"Serializing PubKey \", errSerial.Error())\n    }\n    errClosing := wr.Close()\n    if errClosing != nil {\n        fmt.Println(\"Closing writer \", errClosing.Error())\n    }\n    asciiEntity = gotWriter.String()\n    return\n}\n\n\nfunc main() {\n\n    var entity *openpgp.Entity\n    entity, err := openpgp.NewEntity(\"itis\", \"test\", \"itis@itis3.com\", nil)\n    if err != nil {\n        fmt.Println(\"ERROR\")\n    }\n\n    usrIdstring := \"\"\n    for _, uIds := range entity.Identities {\n        usrIdstring = uIds.Name\n\n    }\n\n    var priKey = entity.PrivateKey\n    var sig = new(packet.Signature)    \n    //Prepare sign with our configs/////IS IT A MUST ??\n    sig.Hash = crypto.SHA1\n    sig.PubKeyAlgo = priKey.PubKeyAlgo\n    sig.CreationTime = time.Now()\n    dur := new(uint32)\n    *dur = uint32(365 * 24 * 60 * 60)\n    sig.SigLifetimeSecs = dur //a year\n    issuerUint := new(uint64)\n    *issuerUint = priKey.KeyId\n    sig.IssuerKeyId = issuerUint\n    sig.SigType = packet.SigTypeGenericCert\n\n\n    err = sig.SignKey(entity.PrimaryKey, entity.PrivateKey, nil)\n    if err != nil {\n        fmt.Println(\"ERROR\")\n    }\n    err = sig.SignUserId(usrIdstring, entity.PrimaryKey, entity.PrivateKey, nil)\n    if err != nil {\n        fmt.Println(\"ERROR\")\n    }\n\n    entity.SignIdentity(usrIdstring, entity, nil)\n\n    var copy = entity\n    var asciiSignedKey = PubEntToAsciiArmor(copy)\n    fmt.Println(asciiSignedKey)\n}\n</code></pre>\n\n<p>1.) When I serialize the public key (to get an armored version of it), I get the following error message: </p>\n\n<blockquote>\n  <p>Serializing PubKey  openpgp: invalid argument: Signature: need to call Sign, SignUserId or SignKey before Serialize</p>\n</blockquote>\n\n<p>I thought I just used every possible way to create a signature on that key?</p>\n\n<p>2.) I still receive an output from problem 1, when I upload the key to a keyserver, than the available information are incomplete. Only the key-id and the creation date are listed. All additional information like, self-signature, user-id-string and so on are missing (example: <a href=\"https://pgp.mit.edu/pks/lookup?search=0xbe6ee21e94a73ba5&amp;op=index\" rel=\"nofollow\">https://pgp.mit.edu/pks/lookup?search=0xbe6ee21e94a73ba5&amp;op=index</a>). What went wrong? Is it related to error 1?</p>\n\n<p>PS: I am new to golang, started today.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430248924, "post_id": 29928033, "comment_id": 47978001, "body": "Possibly unrelated, but the start of your loop can decode the header repeatedly, you likely need something like a <code>if bodyLen == 0 &amp;&amp; len(body) &gt;= 4</code> before decoding <code>bodyLen</code>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430249154, "post_id": 29928033, "comment_id": 47978135, "body": "You may want to look at <a href=\"https://golang.org/pkg/net/#Conn\" rel=\"nofollow noreferrer\"><code>SetReadDeadline</code></a> for doing your timeout, you shouldn&#39;t need a sleep in there either."}, {"owner": {"reputation": 10777, "user_id": 1507139, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/efa15e463560953d4ee5943bd427846d?s=128&d=identicon&r=PG", "display_name": "eatonphil", "link": "https://stackoverflow.com/users/1507139/eatonphil"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430249198, "post_id": 29928033, "comment_id": 47978148, "body": "SetReadDeadline would only set the deadline per each Read call. However, I still want to keep track of the total amount of time across all Read calls, right?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430249335, "post_id": 29928033, "comment_id": 47978255, "body": "check the docs, it takes an absolute <code>time.Time</code> so you&#39;d just figure out before the loop when you want it to abort/timeout and you&#39;ll get a timeout error on read when appropriate."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430249395, "post_id": 29928033, "comment_id": 47978283, "body": "Shouldn&#39;t you have an <code>if err == io.EOF {break}</code> in the somewhere? Possibly with a check that you got sufficient data before decompressing."}, {"owner": {"reputation": 10777, "user_id": 1507139, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/efa15e463560953d4ee5943bd427846d?s=128&d=identicon&r=PG", "display_name": "eatonphil", "link": "https://stackoverflow.com/users/1507139/eatonphil"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430249519, "post_id": 29928033, "comment_id": 47978351, "body": "I do check for io.EOF. However, I&#39;m not even sure what EOF means in this context. I want to keep reading until I&#39;ve read as many bytes as I need. Before I ignored the EOF, I would get 0 bytes and an EOF immediately... Maybe that is important though. But as I said, this endpoint with the same payload worked with my python client."}, {"owner": {"reputation": 10777, "user_id": 1507139, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/efa15e463560953d4ee5943bd427846d?s=128&d=identicon&r=PG", "display_name": "eatonphil", "link": "https://stackoverflow.com/users/1507139/eatonphil"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430249848, "post_id": 29928033, "comment_id": 47978600, "body": "And by &quot;worked&quot;, I mean I actually got a response."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1430252226, "last_edit_date": 1430252226, "creation_date": 1430251767, "answer_id": 29928950, "question_id": 29928033, "link": "https://stackoverflow.com/questions/29928033/getting-eof-from-server-as-client-in-go/29928950#29928950", "title": "Getting EOF from server as client in Go", "body": "<p>You have a number of issues with the server code. Without a full reproducing case, it's hard to tell if these will fix everything.</p>\n\n<pre><code>    for bodyLen == 0 || len(body) &lt; bodyLen {\n        if len(body) &gt; 4 {\n            header := body[:4]\n            body = body[:4]\n            bodyLen = int(unpack(header))\n        }\n</code></pre>\n\n<p>every iteration, if <code>len(body) &gt; 4</code>, you slice body back to the first 4 bytes. Body might never get to be >= bodyLen.</p>\n\n<pre><code>        n, err := conn.Read(buf[:])\n</code></pre>\n\n<p>You don't need to re-slice buf here, use <code>conn.Read(buf)</code></p>\n\n<pre><code>        if err != nil {\n            if err != io.EOF {\n                return body, err\n            }\n        }\n</code></pre>\n\n<p><code>io.EOF</code> is the end of the stream, and you need to handle it. Note that n might still be > 0 when you get an EOF. Check after processing the body for <code>io.EOF</code> or you could loop indefinitely.</p>\n\n<pre><code>        body = append(body, buf[0:n]...)\n\n        now := time.Now()\n        if now.Sub(start) &gt; time.Duration(readTimeout) * time.Millisecond     {\n            return body, fmt.Errorf(\"Timed-out while reading from socket.\")\n</code></pre>\n\n<p>you would be better off using <code>conn.SetReadDeadline</code> before each read, so a stalled Read could be interrupted.</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430252659, "post_id": 29928995, "comment_id": 47980479, "body": "BTW, you may want to also check that the decoded length is less than some generous maximum to avoid a malicious (or just faulty) server form making you try to read up to 2^31-1 bytes."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430254289, "post_id": 29928995, "comment_id": 47981479, "body": "You may also need/want to limit the buf size used for each read call so you don&#39;t read past the expected response (depending on the details of the protocol used)."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 1, "last_activity_date": 1430253389, "last_edit_date": 1430253389, "creation_date": 1430251925, "answer_id": 29928995, "question_id": 29928033, "link": "https://stackoverflow.com/questions/29928033/getting-eof-from-server-as-client-in-go/29928995#29928995", "title": "Getting EOF from server as client in Go", "body": "<p>[JimB just beat me to an answer but here goes anyway.]</p>\n\n<p>The root issue is that you did <code>body = body[:4]</code>\nwhen you wanted <code>body = body[4:]</code>.\nThe former keeps only the first four header bytes\nwhile the latter tosses\nthe four header bytes just decoded.</p>\n\n<p>Here is a self contained version with some debug logs\nthat works.\nIt has some of the other changes I mentioned.\n(I guessed at various things that you didn't include, like the lz4 package used, the timeout, <code>unpack</code>, etc.)</p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/binary\"\n        \"errors\"\n        \"fmt\"\n        \"io\"\n        \"log\"\n        \"net\"\n        \"time\"\n\n        \"github.com/bkaradzic/go-lz4\"\n)\n\nconst readTimeout = 30 * time.Second // XXX guess\n\nfunc ReceiveMessage(conn net.Conn) ([]byte, error) {\n        bodyLen := 0\n        body := make([]byte, 0, 4096)\n        var buf [256]byte\n\n        conn.SetDeadline(time.Now().Add(readTimeout))\n        defer conn.SetDeadline(time.Time{}) // disable deadline\n        for bodyLen == 0 || len(body) &lt; bodyLen {\n                if bodyLen == 0 &amp;&amp; len(body) &gt;= 4 {\n                        bodyLen = int(unpack(body[:4]))\n                        body = body[4:]\n                        if bodyLen &lt;= 0 {\n                                return nil, errors.New(\"invalid body length\")\n                        }\n                        log.Println(\"read bodyLen:\", bodyLen)\n                        continue\n                }\n\n                n, err := conn.Read(buf[:])\n                body = append(body, buf[:n]...)\n                log.Printf(\"appended %d bytes, len(body) now %d\", n, len(body))\n                // Note, this is checked *after* handing any n bytes.\n                // An io.Reader is allowed to return data with an error.\n                if err != nil {\n                        if err != io.EOF {\n                                return nil, err\n                        }\n                        break\n                }\n        }\n        if len(body) != bodyLen {\n                return nil, fmt.Errorf(\"got %d bytes, expected %d\",\n                        len(body), bodyLen)\n        }\n\n        return lz4.Decode(nil, body)\n}\n\nconst address = \":5678\"\n\nvar msg = []byte(`{\"foo\":\"bar\"}`)\n\nfunc main() {\n        //address := os.Args[1]\n        //msg := []byte(os.Args[2])\n\n        fmt.Printf(\"Sending %s to %s\\n\", msg, address)\n\n        conn, err := net.Dial(\"tcp\", address)\n        if err != nil {\n                fmt.Printf(\"%v\\n\", err)\n                return\n        }\n\n        // Another library call\n        _, err = SendMessage(conn, msg)\n        if err != nil {\n                fmt.Printf(\"%v\\n\", err)\n                return\n        }\n\n        response, err := ReceiveMessage(conn)\n        conn.Close()\n\n        if err != nil {\n                fmt.Printf(\"%v\\n\", err)\n                return\n        }\n\n        fmt.Printf(\"Response: %s\\n\", response)\n}\n\n// a guess at what your `unpack` does\nfunc unpack(b []byte) uint32 {\n        return binary.LittleEndian.Uint32(b)\n}\n\nfunc SendMessage(net.Conn, []byte) (int, error) {\n        // stub\n        return 0, nil\n}\n\nfunc init() {\n        // start a simple test server in the same process as a go-routine.\n        ln, err := net.Listen(\"tcp\", address)\n        if err != nil {\n                log.Fatal(err)\n        }\n        go func() {\n                defer ln.Close()\n                for {\n                        conn, err := ln.Accept()\n                        if err != nil {\n                                log.Fatalln(\"accept:\", err)\n                        }\n                        go Serve(conn)\n                }\n        }()\n}\n\nfunc Serve(c net.Conn) {\n        defer c.Close()\n        // skip readding the initial request/message and just respond\n        const response = `{\"somefield\": \"someval\"}`\n        // normally (de)compression in Go is done streaming via\n        // an io.Reader or io.Writer but we need the final length.\n        data, err := lz4.Encode(nil, []byte(response))\n        if err != nil {\n                log.Println(\"lz4 encode:\", err)\n                return\n        }\n        log.Println(\"sending len:\", len(data))\n        if err = binary.Write(c, binary.LittleEndian, uint32(len(data))); err != nil {\n                log.Println(\"writing len:\", err)\n                return\n        }\n        log.Println(\"sending data\")\n        if _, err = c.Write(data); err != nil {\n                log.Println(\"writing compressed response:\", err)\n                return\n        }\n        log.Println(\"Serve done, closing connection\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lTHhMHV315\" rel=\"nofollow\"><kbd>Playground</kbd></a> (but not runnable there).</p>\n"}], "owner": {"reputation": 10777, "user_id": 1507139, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/efa15e463560953d4ee5943bd427846d?s=128&d=identicon&r=PG", "display_name": "eatonphil", "link": "https://stackoverflow.com/users/1507139/eatonphil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 540, "favorite_count": 0, "accepted_answer_id": 29928995, "answer_count": 2, "score": 0, "last_activity_date": 1430253389, "creation_date": 1430248659, "question_id": 29928033, "link": "https://stackoverflow.com/questions/29928033/getting-eof-from-server-as-client-in-go", "title": "Getting EOF from server as client in Go", "body": "<p>I have some a Go client for a custom protocol. The protocol is lz4-compressed JSON-RPC with a four byte header giving the length of the compressed JSON.</p>\n\n<pre><code>func ReceiveMessage(conn net.Conn) ([]byte, error) {\n    start := time.Now()\n    bodyLen := 0\n    body := make([]byte, 0, 4096)\n    buf := make([]byte, 0, 256)\n\n    for bodyLen == 0 || len(body) &lt; bodyLen {\n        if len(body) &gt; 4 {\n            header := body[:4]\n            body = body[:4]\n            bodyLen = int(unpack(header))\n        }\n\n        n, err := conn.Read(buf[:])\n        if err != nil {\n            if err != io.EOF {\n                return body, err\n            }\n        }\n        body = append(body, buf[0:n]...)\n\n        now := time.Now()\n        if now.Sub(start) &gt; time.Duration(readTimeout) * time.Millisecond     {\n            return body, fmt.Errorf(\"Timed-out while reading from socket.\")\n        }\n        time.Sleep(time.Duration(1) * time.Millisecond)\n    }\n\n    return lz4.Decode(nil, body)\n}\n</code></pre>\n\n<p>The client:</p>\n\n<pre><code>func main() {\n    address := os.Args[1]\n    msg := []byte(os.Args[2])\n\n    fmt.Printf(\"Sending %s to %s\\n\", msg, address)\n\n    conn, err := net.Dial(address)\n    if err != nil {\n        fmt.Printf(\"%v\\n\", err)\n        return\n    }\n\n    // Another library call\n    _, err = SendMessage(conn, []byte(msg))\n    if err != nil {\n        fmt.Printf(\"%v\\n\", err)\n        return\n    }\n\n    response, err := ReceiveMessage(conn)\n    conn.Close()\n\n    if err != nil {\n        fmt.Printf(\"%v\\n\", err)\n        return\n    }\n\n    fmt.Printf(\"Response: %s\\n\", response)\n}\n</code></pre>\n\n<p>When I call it, I get no response and it just times out. (If I do not explicitly ignore the EOF, it returns there with io.EOF error.) I have another library for this written in Python that also works against the same endpoint with the same payload. Do you see anything immediately?</p>\n"}, {"tags": ["tcp", "go", "port", "httpserver"], "comments": [{"owner": {"reputation": 3201, "user_id": 2616179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb90669caa64288bdb5767f736152bbe?s=128&d=identicon&r=PG", "display_name": "Makpoc", "link": "https://stackoverflow.com/users/2616179/makpoc"}, "edited": false, "score": 0, "creation_date": 1430240945, "post_id": 29924910, "comment_id": 47973030, "body": "It might not matter at all but what OS are you using? Some OSs might have a limit on the amount of open sockets and with you could have hit it. For example see <a href=\"https://support2.microsoft.com/default.aspx?scid=kb;en-us;196271\" rel=\"nofollow noreferrer\">this</a> post&#39;s solution - apperantly on some versions of Windows the maximum number of ephemeral TCP ports is 5000."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430243482, "post_id": 29924910, "comment_id": 47974698, "body": "if you get <code>address already in use</code>, it&#39;s in use. You need to determine why, not assume the OS is wrong."}, {"owner": {"reputation": 3201, "user_id": 2616179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb90669caa64288bdb5767f736152bbe?s=128&d=identicon&r=PG", "display_name": "Makpoc", "link": "https://stackoverflow.com/users/2616179/makpoc"}, "edited": false, "score": 0, "creation_date": 1430248639, "post_id": 29924910, "comment_id": 47977814, "body": "JimB if the number of ports that can be used is limitted in some way and the OS keeps the sockets in TIME_WAIT he will see exactly this error. Aila, see if <a href=\"http://stackoverflow.com/questions/5106674/error-address-already-in-use-while-binding-socket-with-address-but-the-port-num\">the solutions here</a> help and also check if there are sockets in TIME_WAIT on the port that fails."}], "answers": [{"comments": [{"owner": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "edited": false, "score": 0, "creation_date": 1430245882, "post_id": 29925591, "comment_id": 47976218, "body": "Thanks for you comment. What you said makes sense. But how do I avoid this? The port actually goes as an input param to one of the my binaries that starts up as a command. I need to determine the port before hand. But how can I avoid this race condition? I tried using mutex lock. But I still see the same issue."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "edited": false, "score": 0, "creation_date": 1430246723, "post_id": 29925591, "comment_id": 47976711, "body": "@Aila, if you need to spawn a server as separate binary and know the (random) port in your main application, than the binary would need to start a server using port <code>0</code> and communicate the assigned port back. That&#39;s the only safe way I can think of. You could send it back on stdout or write it to some predefined file (if you spawn many binaries like this, you could attach a pid to the filename \u2013 this is something both child and parent processes know)."}, {"owner": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "edited": false, "score": 0, "creation_date": 1430252717, "post_id": 29925591, "comment_id": 47980510, "body": "Although, I agree on your prediction of a race condition. When I notice, the free ports that are generated, they are consistently incremental. and the one it is erroring was never a port that was generated before. Is possible there could be something else happening that Close() on listener did not happen on time before the next listener is opened on the same port?"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "edited": false, "score": 0, "creation_date": 1430313615, "post_id": 29925591, "comment_id": 48010777, "body": "@Aila, I can see the ports are incremental and they&#39;re unique <i>within your process</i>, but there&#39;re also other processes creating sockets. You can&#39;t be sure OS won&#39;t give out port which you have just <i>released</i>. Because there&#39;s a period of time when the port is free to use, you will always have a risk of failing to bind the server. I wouldn&#39;t dig deeper into the problem, just implement it without the race condition."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "edited": false, "score": 1, "creation_date": 1430320714, "post_id": 29925591, "comment_id": 48016819, "body": "@Aila, I&#39;ve updated the response with some more information explaining why you might be seeing it. Unfortunately, you still don&#39;t have a choice but do it properly :)"}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 7, "last_activity_date": 1430321431, "last_edit_date": 1495542834, "creation_date": 1430240483, "answer_id": 29925591, "question_id": 29924910, "link": "https://stackoverflow.com/questions/29924910/golang-errors-with-bind-address-already-in-use-even-though-nothing-is-running-on/29925591#29925591", "title": "golang errors with bind address already in use even though nothing is running on the port", "body": "<p>What you do is checking whether the port is free at one point and then you try to use it basing on the fact it was free in the past. This is not going to work.</p>\n\n<p>What happens: with every iteration of a for loop, you generate a port number and make sure it's free. Then you spawn a routine with intention of using this port (which is already released back to the pool of free ports). You don't really know when the routine kicks in. It might be activated while the main routine (the for loop) has just generated another free port \u2013 maybe the same one again? Or maybe another process has taken this port in a meantime. Essentially you can have a race condition on a single port.</p>\n\n<p><strong>After some more research:</strong></p>\n\n<p>There's a small caveat though. Two different sockets can be bound to the same ip+port as long as the local+remote pair is unique. I've once written a <a href=\"https://stackoverflow.com/a/28800221/847869\">response</a> about it. So when I've been creating listener with <code>:0</code> I was able to get a \"collision\"; proved by <code>netstat -an</code>:</p>\n\n<pre><code>10.0.1.11.65245        *.*                    LISTEN\n10.0.1.11.65245        17.143.164.101.5223    ESTABLISHED\n</code></pre>\n\n<p>Now, the thing is that if you want to explicitly bind the socket the port being used, this is not possible. Probably because you would be able to specify local address only and remote address wouldn't be known until call to listen or connect (we're talking about syscalls now, not the Go interface). In other words, when you leave port unspecified, OS has a wider choice. So if it happens you got a local address that is also being used by another socket, you're unable to bind to it manually.</p>\n\n<p><strong>How to sovle it:</strong></p>\n\n<p>As I've mentioned in the comments, your server process should be using <code>:0</code> notation in order to be able to choose available resource from OS. Once it's listening, the address should be announced to interested processes. You can do it, for example, through a file or a standard output.</p>\n"}, {"tags": [], "owner": {"reputation": 15, "user_id": 6745062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9c68c48ae4cb3f0b71d5898411e7d57?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan Alex Martin", "link": "https://stackoverflow.com/users/6745062/ryan-alex-martin"}, "is_accepted": false, "score": 0, "last_activity_date": 1614557035, "creation_date": 1614557035, "answer_id": 66415121, "question_id": 29924910, "link": "https://stackoverflow.com/questions/29924910/golang-errors-with-bind-address-already-in-use-even-though-nothing-is-running-on/66415121#66415121", "title": "golang errors with bind address already in use even though nothing is running on the port", "body": "<p>It is possible you were previously running or debugging an application on this port, and it did not shut down cleanly. The process might still be hanging out in your system's memory. Kill that process completely, and any other network daemons that might be lurking in the shadows, and try to run your application again.</p>\n<p>If you haven't checked for this already, you can use (if using Linux) <code>top</code>, <code>htop</code>, or any GUI system monitor like Windows' <code>Task Manager</code>, Gnome3's <code>System Monitor</code> or KDE's <code>KSysGuard</code> to search for the offending process.</p>\n<p>For an example, I have observed that Visual Studio Code's debugger/runner utility (F5/Ctrl+F5) does not always clean up the process, especially if you hit F5 too quickly and the old debugger did not shut down.</p>\n"}], "owner": {"reputation": 229, "user_id": 4842898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89ff72b366029393507d50d546176425?s=128&d=identicon&r=PG&f=1", "display_name": "Aila", "link": "https://stackoverflow.com/users/4842898/aila"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12171, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1614557035, "creation_date": 1430238462, "question_id": 29924910, "link": "https://stackoverflow.com/questions/29924910/golang-errors-with-bind-address-already-in-use-even-though-nothing-is-running-on", "title": "golang errors with bind address already in use even though nothing is running on the port", "body": "<p>I have a setup in golang which basically gets a free port from OS and then starts a http sever on it. It started to give random errors with port signup failures. I simplified it into the following program which seems to error after grabbing a few free ports. It happens very randomly and there is no real process running on the port it errors. Doesn't make sense at all to me on why this has to error. Any help would be appreciated.</p>\n\n<p>Output of the program:</p>\n\n<p>..<br/>\n..<br/>\n58479<br/>\n..<br/>\n..<br/>\n58867<br/>\n58868<br/>\n58869<br/>\n..<br/>\nbound well!  58867<br/>\nbound well!  58868<br/>\nbound well!  58869<br/>\n..<br/>\n..<br/>\n..<br/>\n2015/04/28 09:05:09 Error while binding port: listen tcp :58479: bind: address already in use<br/></p>\n\n<p>I made sure to check that the free port that came out never repeated.</p>\n\n<pre><code>package main\n\n import (\n    \"net\"\n    \"net/http\"\n    \"log\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    for {\n        l, _ := net.Listen(\"tcp\", \":0\")\n        var port = l.Addr().String()[5:]\n        l.Close()\n        fmt.Println(port)\n        go func() {\n                l1, err := net.Listen(\"tcp\", \":\"+port)\n                if (err != nil) {\n                    log.Fatal(\"Error while binding port: \", err.Error())\n                } else {\n                    fmt.Println(\"bound well! \", port)\n                }\n                http.Serve(l1, nil)\n            }()\n    }\n}\n</code></pre>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430237898, "post_id": 29923956, "comment_id": 47970929, "body": "Side note, you almost never want to use a pointer to a slice (i.e. your <code>coll *Regions</code> which is effectively <code>*[]Region</code>). <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">Slices</a> are small and already contain a pointer to the data. The only time you&#39;d want to use a pointer receiver for <code>Regions</code> is if you needed to change the length and/or capacity within the method."}], "answers": [{"comments": [{"owner": {"reputation": 3064, "user_id": 245837, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fc0571c15487ff32f4a6ce17113d8eba?s=128&d=identicon&r=PG", "display_name": "jnadro52", "link": "https://stackoverflow.com/users/245837/jnadro52"}, "edited": false, "score": 1, "creation_date": 1430236561, "post_id": 29924126, "comment_id": 47969961, "body": "I was under the impression that since I was storing a reference to the pointer in the list, that Go shouldn&#39;t reuse that memory address.  Am I mistaken in thinking that?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3064, "user_id": 245837, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fc0571c15487ff32f4a6ce17113d8eba?s=128&d=identicon&r=PG", "display_name": "jnadro52", "link": "https://stackoverflow.com/users/245837/jnadro52"}, "edited": false, "score": 1, "creation_date": 1430236685, "post_id": 29924126, "comment_id": 47970056, "body": "@jnadro52 give me a few to code up an example. The problem is you&#39;re taking the address of item, it&#39;s just the loop variable. You actually want to assign it&#39;s value since item itself is already a pointer."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1430236694, "post_id": 29924126, "comment_id": 47970062, "body": "There is no concept of &quot;reference&quot; in Go. There is not and thinking in terms of references results in bugs."}, {"owner": {"reputation": 3064, "user_id": 245837, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fc0571c15487ff32f4a6ce17113d8eba?s=128&d=identicon&r=PG", "display_name": "jnadro52", "link": "https://stackoverflow.com/users/245837/jnadro52"}, "edited": false, "score": 0, "creation_date": 1430236840, "post_id": 29924126, "comment_id": 47970168, "body": "@evanmcdonnal - That makes sense.  The reason that I was taking the pointer was that the pointer reciever implements the model interface, so I have to actually use the pointer or the compiler yells at me."}, {"owner": {"reputation": 3064, "user_id": 245837, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fc0571c15487ff32f4a6ce17113d8eba?s=128&d=identicon&r=PG", "display_name": "jnadro52", "link": "https://stackoverflow.com/users/245837/jnadro52"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1430236942, "post_id": 29924126, "comment_id": 47970259, "body": "@Volker - I think I have to do some more research on how the GC is working, and how Go uses these memory addresses.  I&#39;m assuming that you mean it simply stores pointers as memory addresses, but doesn&#39;t consider them as referenced memory. Do you have any good links explaining it?"}, {"owner": {"reputation": 3064, "user_id": 245837, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fc0571c15487ff32f4a6ce17113d8eba?s=128&d=identicon&r=PG", "display_name": "jnadro52", "link": "https://stackoverflow.com/users/245837/jnadro52"}, "edited": false, "score": 0, "creation_date": 1430237077, "post_id": 29924126, "comment_id": 47970356, "body": "@evanmcdonnal - Thank you for the example.  This makes more sense to me now.  I was referencing the temporary variable, just as you had said.  I actually had to reference where the data was stored!  Thanks for all your help."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 3064, "user_id": 245837, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fc0571c15487ff32f4a6ce17113d8eba?s=128&d=identicon&r=PG", "display_name": "jnadro52", "link": "https://stackoverflow.com/users/245837/jnadro52"}, "edited": false, "score": 0, "creation_date": 1430237238, "post_id": 29924126, "comment_id": 47970487, "body": "@jnadro52 np, glad I can help."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 11, "last_activity_date": 1430268271, "last_edit_date": 1430268271, "creation_date": 1430236394, "answer_id": 29924126, "question_id": 29923956, "link": "https://stackoverflow.com/questions/29923956/golang-reusing-memory-address-copying-from-slice/29924126#29924126", "title": "Golang Reusing Memory Address Copying from slice?", "body": "<p>In your first (non working) example <code>item</code> is the loop variable. Its address is not changing, only its value. That's why you get the same address in output <code>idx</code> times.</p>\n\n<p>Run this code to see the mechanics in action;</p>\n\n<pre><code>func main() {\n\n    coll := []int{5, 10, 15}\n\n    for i, v := range coll {\n       fmt.Printf(\"This one is always the same; %v\\n\", &amp;v)\n       fmt.Println(\"This one is 4 bytes larger each iteration; %v\\n\", &amp;coll[i])\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3064, "user_id": 245837, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fc0571c15487ff32f4a6ce17113d8eba?s=128&d=identicon&r=PG", "display_name": "jnadro52", "link": "https://stackoverflow.com/users/245837/jnadro52"}, "edited": false, "score": 0, "creation_date": 1430319835, "post_id": 29936029, "comment_id": 48016103, "body": "This is a very concise easy to understand description, thanks.  Its worth noting that creating a new variable and assigning it to the pointer to the item doesn&#39;t work as well.  I tried that too :-)"}], "tags": [], "owner": {"reputation": 109950, "user_id": 86989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd262de5d82a235eeb64f71e4058198?s=128&d=identicon&r=PG", "display_name": "newacct", "link": "https://stackoverflow.com/users/86989/newacct"}, "is_accepted": false, "score": 2, "last_activity_date": 1430289336, "creation_date": 1430289336, "answer_id": 29936029, "question_id": 29923956, "link": "https://stackoverflow.com/questions/29923956/golang-reusing-memory-address-copying-from-slice/29936029#29936029", "title": "Golang Reusing Memory Address Copying from slice?", "body": "<p>There is just one <code>item</code> variable for the entire loop, which is assigned the corresponding value during each iteration of the loop. You do not get a new <code>item</code> variable in each iteration. So you are just repeatedly taking the address of the same variable, which will of course be the same.</p>\n\n<p>On the other hand, if you declared a local variable inside the loop, it will be a new variable in each iteration, and the addresses will be different:</p>\n\n<pre><code>for idx, item := range *coll {\n    temp := item\n    output[idx] = &amp;temp\n}\n</code></pre>\n"}], "owner": {"reputation": 3064, "user_id": 245837, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/fc0571c15487ff32f4a6ce17113d8eba?s=128&d=identicon&r=PG", "display_name": "jnadro52", "link": "https://stackoverflow.com/users/245837/jnadro52"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1688, "favorite_count": 1, "accepted_answer_id": 29924126, "answer_count": 2, "score": 5, "last_activity_date": 1430289336, "creation_date": 1430235959, "last_edit_date": 1430236292, "question_id": 29923956, "link": "https://stackoverflow.com/questions/29923956/golang-reusing-memory-address-copying-from-slice", "title": "Golang Reusing Memory Address Copying from slice?", "body": "<p>I was hitting an issue in a project I'm working on.  I found a way around it, but I wasn't sure why my solution worked.  I'm hoping that someone more experience with how Go pointers work could help me.</p>\n\n<p>I have a Model interface and a Region struct that implements the interface.  The Model interface is implemented on the pointer of the Region struct.  I also have a Regions collection which is a slice of Region objects.  I have a method that can turn a Regions object into a []Model:</p>\n\n<pre><code>// Regions is the collection of the Region model\ntype Regions []Region\n\n// Returns the model collection as a list of models\nfunc (coll *Regions) ToModelList() []Model {\n    output := make([]Model, len(*coll))\n    for idx, item := range *coll {\n        output[idx] = &amp;item\n    }\n    return output\n}\n</code></pre>\n\n<p>When I run this code, I end up with the first pointer to the Region outputted multiple times.  So, if the Regions collection has two distinct items, I will get the same address duplicated twice.  When I print the variables before I set them in the slice, they have the proper data.</p>\n\n<p>I messed with it a little bit, thinking Go might be reusing the memory address between loops.  This solution is currently working for me in my tests:</p>\n\n<pre><code>// Returns the model collection as a list of models\nfunc (coll *Regions) ToModelList() []Model {\n    output := make([]Model, len(*coll))\n    for idx, _ := range *coll {\n        i := (*coll)[idx]\n        output[idx] = &amp;i\n    }\n    return output\n}\n</code></pre>\n\n<p>This gives the expected output of two distinct addresses in the output slice.</p>\n\n<p>This honestly seems like a bug with the range function reusing the same memory address between runs, but I always assume I'm missing something in cases like this.</p>\n\n<p>I hope I explained this well enough for you.  I'm surprised that the original solution did not work.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "sync"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1430235617, "post_id": 29923666, "comment_id": 47969285, "body": "Worth reading: <a href=\"https://github.com/golang/go/issues/9578\" rel=\"nofollow noreferrer\">sync: add WaitTimeout method to Cond</a>"}, {"owner": {"reputation": 753, "user_id": 3541152, "user_type": "registered", "profile_image": "https://graph.facebook.com/1070274946/picture?type=large", "display_name": "yakob abada", "link": "https://stackoverflow.com/users/3541152/yakob-abada"}, "edited": false, "score": 0, "creation_date": 1430235685, "post_id": 29923666, "comment_id": 47969338, "body": "are you using appengine ??"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1430237403, "post_id": 29923666, "comment_id": 47970584, "body": "In particular , on the link Tim Cooper gave, note Ian Lance Taylor&#39;s comment of &quot;Condition variables are generally not the right thing to use in Go&quot;. Don&#39;t try to write Go the way you&#39;d write Java."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1430240572, "post_id": 29923666, "comment_id": 47972780, "body": "@TimCooper - Interesting, thanks for the link.  But what I see there is &quot;this is the wrong way to deal with your use case&quot; and &lt;conspicuous absence of any reasonable alternative&gt;...   Both channels and &quot;side-timers&quot; (goroutine /w timer) won&#39;t work for the OP in that thread (or me).   And they just shut him down and closed his ticket. =/"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430240753, "post_id": 29923666, "comment_id": 47972899, "body": "@DaveC - It&#39;s not a Java thing, but a fairly standard idiom when doing systems threading / concurrency where you have a mutex/cond pair, as the sync package provides.   Again, can you provide an alternative that works and is &quot;Go-like&quot;?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430241423, "post_id": 29923666, "comment_id": 47973359, "body": "@BadZen, read up on <a href=\"https://golang.org/doc/effective_go.html#concurrency\" rel=\"nofollow noreferrer\">concurrency and communication in Go</a>. The preferred Go approach is summarized by <a href=\"https://blog.golang.org/share-memory-by-communicating\" rel=\"nofollow noreferrer\">&quot;Do not communicate by sharing memory; instead, share memory by communicating.&quot;</a>"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430241933, "post_id": 29923666, "comment_id": 47973708, "body": "@DaveC - I have read that, before post.  It&#39;s a nice maxim, but how does it apply to my example or the OP&#39;s in the link above?   Neither is sharing any kind of memory.  IPC or inter-task signaling is a very different sort of facility than a condition variable.  Yes, either facility can provide the other, but both &#39;emulations&#39; are non-optimal - the forward direction because (as OP notes) many objects must be created to do it - it is not performant in very tight loops, and the reverse direction because of the principle outlined in your link, which is a general one, not just for Go..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430242026, "post_id": 29923666, "comment_id": 47973770, "body": "By the way, if the actual answer to my question is &quot;that cannot be done, the Go Czars do not approve of your timed condition wait&quot;, then that is definitely a valid answer to my question here - don&#39;t want to get hung up on SE philosophy, etc, ITT.  (Been doing this stuff for decades before Go was invented...)"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430242210, "post_id": 29923666, "comment_id": 47973895, "body": "&quot;How does it apply to my example&quot;: You didn&#39;t give an example! You asked for a specific feature/function without any context whatsoever, so I assumed it was likely (based on the poor level of questions here that contain &quot;how to do &lt;language X&#39;s Y&gt; in Go?&quot;) the context itself was likely a design that is better done a different way in Go. Without any context as to why you feel you need a condition variable it&#39;s impossible to say more."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430242511, "post_id": 29923666, "comment_id": 47974069, "body": "@DaveC - refer to Tim&#39;s link which contains a full use case, if you want to be concrete.  I said &quot;my example&quot;, but I meant &quot;that guy in Tim&#39;s link&#39;s example&quot;.   Also note my question was not &quot;hey Internet why might I need a condition variable&quot; (Ben-Ari has a good text on concurrent programming and design if you really need to know that answer), but &quot;is there a timed condition wait in Go that works like Java&#39;s monitor wait, or an easy way to accomplish the same?&quot;  Please stay OT."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430248825, "post_id": 29923666, "comment_id": 47977937, "body": "And, let me additionally draw your attention to: <a href=\"http://talks.golang.org/2012/concurrency.slide#54\" rel=\"nofollow noreferrer\">talks.golang.org/2012/concurrency.slide#54</a>"}, {"owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "edited": false, "score": 0, "creation_date": 1430299863, "post_id": 29923666, "comment_id": 48000205, "body": "How tight is your loop ?"}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430462173, "post_id": 29982057, "comment_id": 48084561, "body": "Caleb - The same trick I used to work around the blocking tcp Accept() call in this question: <a href=\"http://stackoverflow.com/questions/29948497/tcp-accept-and-go-concurrency-model\" title=\"tcp accept and go concurrency model\">stackoverflow.com/questions/29948497/&hellip;</a> will absolutely work for condition variables as well (the listener close gets replaced with a condition signal to cycle the blocking goroutine).   I&#39;ll write up a code example later to answer this question if no one else does by the time I get to it.  (I guess that&#39;s &quot;roll your own Cond&quot;, though, on second read!)"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430462319, "post_id": 29982057, "comment_id": 48084599, "body": "(I&#39;m actually seeing the need for a package that wraps all the &quot;traditional&quot; blocking functions in the API that aren&#39;t properly selectable in channels as futures...)"}, {"owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430492563, "post_id": 29982057, "comment_id": 48098029, "body": "You said in your question that we couldn&#39;t use a goroutine or channel. You also didn&#39;t provide an example to work with."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430492747, "post_id": 29982057, "comment_id": 48098137, "body": "Yeah, you&#39;re right.   I actually wasn&#39;t aware of non-blocking select syntax / default when I wrote that, which seems much less &quot;heavy&quot; - and also not as desperate to just get some solutions together as I am now..."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 1, "last_activity_date": 1430458227, "creation_date": 1430458227, "answer_id": 29982057, "question_id": 29923666, "link": "https://stackoverflow.com/questions/29923666/waiting-on-a-sync-cond-with-a-timeout/29982057#29982057", "title": "Waiting on a sync.Cond with a timeout", "body": "<p>No. There is no easy way to do this and based on that thread they aren't going to add one. (though perhaps discussing it with them may get you somewhere)</p>\n\n<p>But there's always a hard way. 2 options:</p>\n\n<ol>\n<li>Roll your own <code>Cond</code> that has this capability. (see <a href=\"https://golang.org/src/sync/cond.go\" rel=\"nofollow\">https://golang.org/src/sync/cond.go</a>)</li>\n<li>Use OS-level capabilities via a syscall. (maybe a <a href=\"http://man7.org/linux/man-pages/man2/futex.2.html\" rel=\"nofollow\">futex</a>?)</li>\n</ol>\n\n<p>The challenge here - and the reason why it's not trivial - is that goroutines aren't threads. Go has it's own custom scheduler. Creating your own <code>Cond</code> will involve tinkering with parts of runtime that aren't really meant to be tinkered with. (but, like I said, it's possible)</p>\n\n<p>Sorry if that's limiting. Most of go is pretty straightforward - you can often jump down into the lower layer without too much trouble. But the scheduler is not like that. It's magic. </p>\n\n<p>The magic works for most things, and they added the stuff in <code>sync</code> to cover some known cases where it doesn't. If you feel like you found another, maybe you can convince them to add it. (but it's not just a matter of reproducing an API from another programming language, or exposing an underlying API)</p>\n"}, {"comments": [{"owner": {"reputation": 483, "user_id": 4280035, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e442215473aa322da127ee74c79c7477?s=128&d=identicon&r=PG&f=1", "display_name": "hellcatv", "link": "https://stackoverflow.com/users/4280035/hellcatv"}, "edited": false, "score": 0, "creation_date": 1504911280, "post_id": 41731499, "comment_id": 79213607, "body": "This code unlocks the lock before listening on the channel. This means that the signal may never come through since the Signal may happen after WaitOrTimeout does the unlock but before it pulls from the channel, and then the default case on the signal may happen, returning false."}], "tags": [], "owner": {"reputation": 45, "user_id": 7384816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4913caa0e80e11fdf44b865fcc50b236?s=128&d=identicon&r=PG&f=1", "display_name": "njswede", "link": "https://stackoverflow.com/users/7384816/njswede"}, "is_accepted": false, "score": -2, "last_activity_date": 1484837177, "last_edit_date": 1484837177, "creation_date": 1484783484, "answer_id": 41731499, "question_id": 29923666, "link": "https://stackoverflow.com/questions/29923666/waiting-on-a-sync-cond-with-a-timeout/41731499#41731499", "title": "Waiting on a sync.Cond with a timeout", "body": "<p>I ran into the same issue and it turned out to be pretty easy to solve using a channel.</p>\n\n<ul>\n<li>A signal is a send on a channel </li>\n<li>A wait is simply waiting for a message on a channel.  </li>\n<li>A wait with timeout is just a select on a timer and the message.</li>\n<li>A broadcast is a loop sending messages until there's no one left who listens.</li>\n</ul>\n\n<p>As with any condition variable, it's required to hold the mutex when you wait and highly recommended to hold it when you're signaling. </p>\n\n<p>I wrote a in implementation that follows the Cond protocol and adds a WaitOrTimeout. It returns true if successful, false if timed out.</p>\n\n<p>Here's my code along with some test cases! <strong>DISCLAIMER: This seems to work fine but hasn't been thoroughly tested. Also, fairness is not guaranteed. Threads waiting are released in the order the scheduler sees fit and not necessarily first come/first serve.</strong></p>\n\n<p><a href=\"https://play.golang.org/p/K1veAOGbWZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/K1veAOGbWZ</a></p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n    \"fmt\"\n)\n\ntype TMOCond struct {\n    L    sync.Locker\n    ch      chan bool\n}\n\nfunc NewTMOCond(l sync.Locker) *TMOCond {\n    return &amp;TMOCond{ ch: make(chan bool), L: l }\n}\n\nfunc (t *TMOCond) Wait() {\n    t.L.Unlock()\n    &lt;-t.ch\n    t.L.Lock()\n}\n\nfunc (t *TMOCond) WaitOrTimeout(d time.Duration) bool {\n    tmo := time.NewTimer(d)\n    t.L.Unlock()\n    var r bool\n    select {\n    case &lt;-tmo.C:\n    r = false\n    case &lt;-t.ch:\n        r = true\n    }\n    if !tmo.Stop() {\n        select {\n        case &lt;- tmo.C:\n        default:\n        }\n    }\n    t.L.Lock()\n    return r\n}\n\nfunc (t *TMOCond) Signal() {\n    t.signal()\n}\n\nfunc (t *TMOCond) Broadcast() {\n    for {\n        // Stop when we run out of waiters\n        //\n        if !t.signal() {\n            return\n        }\n    }\n}\n\nfunc (t *TMOCond) signal() bool {\n    select {\n    case t.ch &lt;- true:\n        return true\n    default:\n        return false\n    }\n}\n\n// **** TEST CASES ****\nfunc lockAndSignal(t *TMOCond) {\n    t.L.Lock()\n    t.Signal()\n    t.L.Unlock()\n}\n\nfunc waitAndPrint(t *TMOCond, i int) {\n    t.L.Lock()\n    fmt.Println(\"Goroutine\", i, \"waiting...\")\n    ok := t.WaitOrTimeout(10 * time.Second)\n    t.L.Unlock()\n    fmt.Println(\"This is goroutine\", i, \"ok:\", ok)\n}\n\nfunc main() {\n    var m sync.Mutex\n    t := NewTMOCond(&amp;m)\n\n    // Simple wait\n    //\n    t.L.Lock()\n    go lockAndSignal(t)\n    t.Wait()\n    t.L.Unlock()\n    fmt.Println(\"Simple wait finished.\")\n\n    // Wait that times out\n    //\n    t.L.Lock()\n    ok := t.WaitOrTimeout(100 * time.Millisecond)\n    t.L.Unlock()\n    fmt.Println(\"Timeout wait finished. Timeout:\", !ok)\n\n\n    // Broadcast. All threads should finish.\n    //\n    for i := 0; i &lt; 10; i++ {\n        go waitAndPrint(t, i)\n    }\n    time.Sleep(1 * time.Second) \n    t.L.Lock()\n    fmt.Println(\"About to signal\")\n    t.Broadcast()\n    t.L.Unlock()\n    time.Sleep(10 * time.Second)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 139, "user_id": 240057, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d8f49c94c7dd014c3922503081ecb05?s=128&d=identicon&r=PG", "display_name": "Spasski", "link": "https://stackoverflow.com/users/240057/spasski"}, "edited": false, "score": 0, "creation_date": 1607120561, "post_id": 48219050, "comment_id": 115182408, "body": "Can you explain the last bit on using weighted semaphore?"}, {"owner": {"reputation": 139, "user_id": 240057, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8d8f49c94c7dd014c3922503081ecb05?s=128&d=identicon&r=PG", "display_name": "Spasski", "link": "https://stackoverflow.com/users/240057/spasski"}, "edited": false, "score": 0, "creation_date": 1607124190, "post_id": 48219050, "comment_id": 115183449, "body": "In particular, how do you keep track of how many waiters to release?"}], "tags": [], "owner": {"reputation": 1025, "user_id": 607203, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd4dbb8cb1054b15e6795bbbc7f86fff?s=128&d=identicon&r=PG", "display_name": "zviadm", "link": "https://stackoverflow.com/users/607203/zviadm"}, "is_accepted": false, "score": 9, "last_activity_date": 1515726869, "creation_date": 1515726869, "answer_id": 48219050, "question_id": 29923666, "link": "https://stackoverflow.com/questions/29923666/waiting-on-a-sync-cond-with-a-timeout/48219050#48219050", "title": "Waiting on a sync.Cond with a timeout", "body": "<p>You can implement a condition variable that supports Broadcast only (no Signal), with a channel. Here is a quick Gist of it:\n<a href=\"https://gist.github.com/zviadm/c234426882bfc8acba88f3503edaaa36#file-cond2-go\" rel=\"noreferrer\">https://gist.github.com/zviadm/c234426882bfc8acba88f3503edaaa36#file-cond2-go</a></p>\n\n<p>You can also just utilize this technique of replacing a channel and closing the old one within your code. The code in Gist is using unsafe.Pointer and atomic operations to allow calling 'Broadcast' without acquiring the main sync.Locker. However in your own code, more often than not, you should be Broadcasting from within the acquire lock anyways so you don't need to do any of the unsafe/atomic stuff.</p>\n\n<p>While this method works, you might want to also checkout: <a href=\"https://godoc.org/golang.org/x/sync/semaphore\" rel=\"noreferrer\">https://godoc.org/golang.org/x/sync/semaphore</a>. If you make a weighted semaphore with a limit of 1, that will also give you all the abilities you need and it will also be fair.</p>\n"}, {"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 0, "last_activity_date": 1536249051, "creation_date": 1536249051, "answer_id": 52207950, "question_id": 29923666, "link": "https://stackoverflow.com/questions/29923666/waiting-on-a-sync-cond-with-a-timeout/52207950#52207950", "title": "Waiting on a sync.Cond with a timeout", "body": "<p>I sketched out a couple of possible alternatives in my GopherCon talk this year (see <a href=\"https://drive.google.com/file/d/1nPdvhB0PutEJzdCq5ms6UI58dp50fcAN/view\" rel=\"nofollow noreferrer\">https://drive.google.com/file/d/1nPdvhB0PutEJzdCq5ms6UI58dp50fcAN/view</a>). The \u201cCondition Variables\u201d section starts at slide 37, but this particular pattern is covered in more detail in the backup slides (101-105).</p>\n\n<p>As zviadm notes, one option (<a href=\"https://play.golang.org/p/tWVvXOs87HX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tWVvXOs87HX</a>) is to close a channel.</p>\n\n<p>Another option (<a href=\"https://play.golang.org/p/uRwV_i0v13T\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uRwV_i0v13T</a>) is to have each waiter allocate a 1-buffered channel, and have the broadcaster send a token into the buffer to broadcast.</p>\n\n<p>If the event is a persistent condition, such as \u201cthe queue is empty\u201d, a third option (<a href=\"https://play.golang.org/p/uvx8vFSQ2f0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uvx8vFSQ2f0</a>) is to use a 1-buffered channel and have each receiver refill the buffer as long as the condition persists.</p>\n"}, {"tags": [], "owner": {"reputation": 3247, "user_id": 625521, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/f75ea35d0ffa8468c61f1fb2347a8000?s=128&d=identicon&r=PG", "display_name": "Jonas", "link": "https://stackoverflow.com/users/625521/jonas"}, "is_accepted": false, "score": 0, "last_activity_date": 1548693262, "creation_date": 1548693262, "answer_id": 54406429, "question_id": 29923666, "link": "https://stackoverflow.com/questions/29923666/waiting-on-a-sync-cond-with-a-timeout/54406429#54406429", "title": "Waiting on a sync.Cond with a timeout", "body": "<p><a href=\"https://gitlab.com/jonas.jasas/condchan\" rel=\"nofollow noreferrer\">https://gitlab.com/jonas.jasas/condchan</a> makes it possible to timeout on wait. Please see an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n    \"gitlab.com/jonas.jasas/condchan\"\n)\n\nfunc main() {\n    cc := condchan.New(&amp;sync.Mutex{})\n    timeoutChan := time.After(time.Second)\n\n    cc.L.Lock()\n    // Passing func that gets channel c that signals when\n    // Signal or Broadcast is called on CondChan\n    cc.Select(func(c &lt;-chan struct{}) { // Waiting with select\n        select {\n        case &lt;-c: // Never ending wait\n        case &lt;-timeoutChan:\n            fmt.Println(\"Hooray! Just escaped from eternal wait.\")\n        }\n    })\n    cc.L.Unlock()\n}\n</code></pre>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3853, "favorite_count": 3, "answer_count": 5, "score": 12, "last_activity_date": 1548693262, "creation_date": 1430235160, "last_edit_date": 1430243534, "question_id": 29923666, "link": "https://stackoverflow.com/questions/29923666/waiting-on-a-sync-cond-with-a-timeout", "title": "Waiting on a sync.Cond with a timeout", "body": "<p>Is it possible in some easy way to do the equivalent of Java's</p>\n\n<pre><code>wait(long timeMillis)\n</code></pre>\n\n<p>which waits on a monitor (mutex+cond, roughly) for a specified amount of time, and returns if it is not signalled?</p>\n\n<p>I can't find anything in the docs or googling around on this, and although it's of course possible to play some games with making a WaitGroup and having a timer goroutine pop, that seems tedious/annoying/inefficient to just get this simple functionality (which is by the way directly supported by any underlying systems thread library I've ever encountered)</p>\n\n<p>Edit:  Yes we have all read <a href=\"http://www.golang-book.com/10/index.htm\" rel=\"noreferrer\">http://www.golang-book.com/10/index.htm</a> as well as <a href=\"https://blog.golang.org/pipelines\" rel=\"noreferrer\">https://blog.golang.org/pipelines</a> - again, creating more threads is a \"bad\" (non-performant) solution to this, and channels are also not well suited to this.  Imagine for a use case a typical concurrent server Join() method...  (Please do not tell me to invert the control and use a Listener pattern instead.  You don't always have the luxury to change the API you are working with...)</p>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1430220487, "post_id": 29918098, "comment_id": 47957394, "body": "Your inner template is executed with <code>nil</code> data. You have to pass a value to it e.g. <code>{{template &quot;insideit&quot; .}}</code> (note the <b>dot</b>). See the linked question+answer for details."}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1430220920, "post_id": 29918098, "comment_id": 47957733, "body": "Thank you very much for pointing it out."}], "owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "closed_date": 1430362068, "answer_count": 0, "score": 0, "last_activity_date": 1430243848, "creation_date": 1430220144, "last_edit_date": 1430243848, "question_id": 29918098, "link": "https://stackoverflow.com/questions/29918098/variable-in-sub-template-not-output-value", "closed_reason": "Duplicate", "title": "Variable in sub-template not output value", "body": "<p>I'm trying to output variable through sub-template.<br>\nIt output <code>My name is Mary and I'm &lt;no value&gt; years old.</code><br>instead of <code>My name is Mary and I'm 35 years old.</code></p>\n\n<p>Below is the codes:</p>\n\n<p><code>server.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"text/template\"\n)\n\ntype Person struct {\n    Name, Age string\n}\n\nfunc main() {\n\n    p := Person{Name: \"Mary\", Age: \"35\"}\n\n    templatestuff, _ := template.ParseFiles(\"t1.tmpl\", \"t2.tmpl\")\n\n    templatestuff.ExecuteTemplate(os.Stdout, \"basetemplate\", p) //execute basetemplate\n    fmt.Println()\n    templatestuff.Execute(os.Stdout, p)\n}\n</code></pre>\n\n<p><code>t1.tmpl</code>:</p>\n\n<pre><code>{{define \"basetemplate\"}}My name is {{.Name}} and {{template \"insideit\"}}years old.{{end}}\n</code></pre>\n\n<p><code>t2.tmpl</code>:</p>\n\n<pre><code>{{define \"insideit\"}}I'm {{.Age}} {{end}}\n</code></pre>\n\n<p>It looks like I missed something.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 22, "last_activity_date": 1471847438, "last_edit_date": 1471847438, "creation_date": 1430211183, "answer_id": 29914705, "question_id": 29914662, "link": "https://stackoverflow.com/questions/29914662/equivalent-of-pythons-ord-chr-in-go/29914705#29914705", "title": "Equivalent of python&#39;s ord(), chr() in go?", "body": "<p>They are supported as simple <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"noreferrer\">conversions</a>:</p>\n\n<pre><code>ch := rune(97)\nn := int('a')\nfmt.Printf(\"char: %c\\n\", ch)\nfmt.Printf(\"code: %d\\n\", n)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/FMqjMMRW0z\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>char: a\ncode: 97\n</code></pre>\n\n<p>Note: you can also convert an <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"noreferrer\">integer numeric value to a <code>string</code></a> which basically interprets the integer value as the UTF-8 encoded value:</p>\n\n<pre><code>s := string(97)\nfmt.Printf(\"text: %s\\n\", s) // Output: text: a\n</code></pre>\n\n<blockquote>\n  <p>Converting a signed or unsigned integer value to a string type yields a string containing the UTF-8 representation of the integer. Values outside the range of valid Unicode code points are converted to <code>\"\\uFFFD\"</code>.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1430211204, "creation_date": 1430211204, "answer_id": 29914710, "question_id": 29914662, "link": "https://stackoverflow.com/questions/29914662/equivalent-of-pythons-ord-chr-in-go/29914710#29914710", "title": "Equivalent of python&#39;s ord(), chr() in go?", "body": "<p>It appears that a simple <code>uint8('a')</code> will produce a correct output. To convert from integer to string <code>string(98)</code> will suffice:</p>\n\n<pre><code>uint8('g') // 103\nstring(112) // p\n</code></pre>\n"}], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7408, "favorite_count": 0, "accepted_answer_id": 29914705, "answer_count": 2, "score": 14, "last_activity_date": 1471847438, "creation_date": 1430211054, "question_id": 29914662, "link": "https://stackoverflow.com/questions/29914662/equivalent-of-pythons-ord-chr-in-go", "title": "Equivalent of python&#39;s ord(), chr() in go?", "body": "<p>What is the equivalent of python's <a href=\"https://docs.python.org/2/library/functions.html#chr\" rel=\"noreferrer\">chr()</a> and <a href=\"https://docs.python.org/2/library/functions.html#ord\" rel=\"noreferrer\">ord()</a> functions in golang?</p>\n\n<pre><code>chr(97) = 'a'\nord('a') = 97\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "spreadsheet", "mux"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1430208107, "post_id": 29912318, "comment_id": 47949144, "body": "<i>&quot;... but its argument is an http router...&quot;</i> It&#39;s not an http router, it&#39;s an <code>*http.Request</code> so obviously you can&#39;t pass a <code>*mux.Router</code> value."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 4840681, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152999844949160/picture?type=large", "display_name": "Eli Dylan Lorimer", "link": "https://stackoverflow.com/users/4840681/eli-dylan-lorimer"}, "edited": false, "score": 0, "creation_date": 1430290088, "post_id": 29914121, "comment_id": 47994217, "body": "Rock on, thanks Icza ! Super helpful, Warmup requests are right on the money."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1430243777, "last_edit_date": 1430243777, "creation_date": 1430209406, "answer_id": 29914121, "question_id": 29912318, "link": "https://stackoverflow.com/questions/29912318/fetching-a-url-from-the-init-func-in-go-on-appengine/29914121#29914121", "title": "Fetching a URL From the init() func in Go on AppEngine", "body": "<p>You can't use AppEngine services that require a <a href=\"https://cloud.google.com/appengine/docs/go/reference#Context\" rel=\"nofollow\"><code>Context</code></a> outside of handlers (because the creation of a <code>Context</code> requires an <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow\"><code>*http.Request</code></a> value). This by nature means you can't use them in package <code>init()</code> functions either.<br>\n<sub>Note that you can use them from cron jobs and tasks added to task queues, because tasks and cron jobs are executed by issuing HTTP GET requests.</sub></p>\n\n<p>You have to restructure your code so that the service (urlFetch in your case) gets called from a handler.</p>\n\n<p>A possible solution is to check if init completed in handlers that serve user requests. If not, perform the initialization function you would otherwise put in <code>init()</code> before proceeding to serve the request.</p>\n\n<p>Yes, this may cause first requests to take considerably longer to serve. For this purpose (to avoid this) I recommend you to utilize <a href=\"https://cloud.google.com/appengine/docs/go/config/appconfig#Go_app_yaml_Warmup_requests\" rel=\"nofollow\">Warmup requests</a>. A warmup request is issued to a new instance before it goes \"live\", before it starts serving user requests. In your <code>app.yaml</code> config file you can enable warmup requests by adding <code>-warmup</code> to the <code>inbound_services</code> directive:</p>\n\n<pre><code>inbound_services:\n  - warmup\n</code></pre>\n\n<p>This will cause the App Engine infrastructure to first issue a <code>GET</code> request to <code>/_ah/warmup</code>. You can register a handler to this URL and perform initialization tasks. As with any other request, you will have an <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow\"><code>http.Request</code></a> in the warmup handler.</p>\n\n<p>But please note that:</p>\n\n<blockquote>\n  <p>..you may encounter <a href=\"https://cloud.google.com/appengine/docs/adminconsole/instances#Loading_Requests\" rel=\"nofollow\">loading requests</a>, even if warmup requests are enabled in your app.</p>\n</blockquote>\n\n<p>Which means that in rare cases it may happen a new instance will not receive a warmup request, so its best to check initialization state in user handlers too.</p>\n"}], "owner": {"reputation": 21, "user_id": 4840681, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152999844949160/picture?type=large", "display_name": "Eli Dylan Lorimer", "link": "https://stackoverflow.com/users/4840681/eli-dylan-lorimer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 552, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1430243777, "creation_date": 1430204074, "question_id": 29912318, "link": "https://stackoverflow.com/questions/29912318/fetching-a-url-from-the-init-func-in-go-on-appengine", "title": "Fetching a URL From the init() func in Go on AppEngine", "body": "<p><strong>Background</strong>: I'm running Go on GAE and using Mux for my router. In order to fetch a URL GAE requires that I use its built in urlFetch capability. I want to make this URL fetch happen during my modules init() but as far as I can tell I can only use urlFetch when invoked via a handler.</p>\n\n<pre><code>func init() {\n  r := mux.NewRouter()\n  r.HandleFunc(\"/\", homeHandler)\n  r.HandleFunc(\"/about\", anotherHandler)\n  http.Handle(\"/\", r)\n}\n</code></pre>\n\n<p>GAE suggests the following code for making a urlFetch:</p>\n\n<pre><code>c := appengine.NewContext(r)\nclient := urlfetch.Client(c)\n</code></pre>\n\n<p>... but its argument is an http router, and it doesn't want to work if I pass my mux router. So I'm out of ideas of how to make this urlFetch happen outside the scope of a URL handler.</p>\n\n<p>Error when passing the mux router: \"cannot use r (type *mux.Router) as type *http.Request in argument to \"appengine\".NewContext\"</p>\n"}, {"tags": ["go", "pow", "godoc"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 13, "last_activity_date": 1430204091, "creation_date": 1430204091, "answer_id": 29912325, "question_id": 29912249, "link": "https://stackoverflow.com/questions/29912249/what-is-the-equivalent-for-bigint-powa-in-go/29912325#29912325", "title": "What is the equivalent for bigint.pow(a) in Go?", "body": "<p>Use <a href=\"http://golang.org/pkg/math/big/#Int.Exp\"><code>Exp</code></a> with <code>m</code> set to <code>nil</code>.</p>\n\n<pre><code>var i, e = big.NewInt(16), big.NewInt(2)\ni.Exp(i, e, nil)\nfmt.Println(i) // Prints 256\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/0QFbNHEsn5\">http://play.golang.org/p/0QFbNHEsn5</a></p>\n"}], "owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3944, "favorite_count": 1, "accepted_answer_id": 29912325, "answer_count": 1, "score": 6, "last_activity_date": 1430227549, "creation_date": 1430203845, "last_edit_date": 1430227549, "question_id": 29912249, "link": "https://stackoverflow.com/questions/29912249/what-is-the-equivalent-for-bigint-powa-in-go", "title": "What is the equivalent for bigint.pow(a) in Go?", "body": "<p>In my use case, I would like to know how the following Java code would be implemented in Go</p>\n\n<pre><code>BigInteger base = new BigInteger(\"16\");\nint exponent = 1;\nBigInteger a = base.pow(exponent); //16^1 = 16\n</code></pre>\n\n<p>I am able to import the <code>math/big</code> package and create big integers, but not able to do <code>Pow()</code> function in Go. Also I don't find the function in the Go <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow\">doc</a>.</p>\n\n<p>Do I have to implement my own version of <code>Pow()</code> for bigint? Could anyone help me on this?</p>\n"}, {"tags": ["mysql", "testing", "go", "integration-testing"], "answers": [{"comments": [{"owner": {"reputation": 493, "user_id": 367079, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/4607bf9f84b4c1f507de6ffc4acc606e?s=128&d=identicon&r=PG", "display_name": "Filip", "link": "https://stackoverflow.com/users/367079/filip"}, "edited": false, "score": 0, "creation_date": 1430220295, "post_id": 29917165, "comment_id": 47957211, "body": "Let me clarify. The way you solve this is that you run a mysql docker container in test setup and points your code to it. Is my understanding correct?"}, {"owner": {"reputation": 9800, "user_id": 51647, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e6561bb97c523ab562712796828c9e05?s=128&d=identicon&r=PG", "display_name": "Joakim Lundborg", "link": "https://stackoverflow.com/users/51647/joakim-lundborg"}, "reply_to_user": {"reputation": 493, "user_id": 367079, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/4607bf9f84b4c1f507de6ffc4acc606e?s=128&d=identicon&r=PG", "display_name": "Filip", "link": "https://stackoverflow.com/users/367079/filip"}, "edited": false, "score": 0, "creation_date": 1430222586, "post_id": 29917165, "comment_id": 47958948, "body": "Yes, but you probably want to do this outside of your code. What we are doing here is putting the docker setup in a Rakefile target, and then configure the database connection string with an env variable. Of course your development environment might be different, and this means that you can&#39;t just run go test to test it."}, {"owner": {"reputation": 9800, "user_id": 51647, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e6561bb97c523ab562712796828c9e05?s=128&d=identicon&r=PG", "display_name": "Joakim Lundborg", "link": "https://stackoverflow.com/users/51647/joakim-lundborg"}, "reply_to_user": {"reputation": 493, "user_id": 367079, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/4607bf9f84b4c1f507de6ffc4acc606e?s=128&d=identicon&r=PG", "display_name": "Filip", "link": "https://stackoverflow.com/users/367079/filip"}, "edited": false, "score": 0, "creation_date": 1432568423, "post_id": 29917165, "comment_id": 48965648, "body": "Shameless plug: I wrote a small lib to make it easier to do do this with docker+go: <a href=\"https://github.com/wrapp/dockfix\" rel=\"nofollow noreferrer\">github.com/wrapp/dockfix</a>"}], "tags": [], "owner": {"reputation": 9800, "user_id": 51647, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/e6561bb97c523ab562712796828c9e05?s=128&d=identicon&r=PG", "display_name": "Joakim Lundborg", "link": "https://stackoverflow.com/users/51647/joakim-lundborg"}, "is_accepted": true, "score": 5, "last_activity_date": 1430217705, "creation_date": 1430217705, "answer_id": 29917165, "question_id": 29910793, "link": "https://stackoverflow.com/questions/29910793/how-to-write-golang-integration-test-with-mysql/29917165#29917165", "title": "How to write golang integration test with MySQL", "body": "<p>If you really want to have an embedded MySQL, you can use golangs C bindings to integrate with: <a href=\"https://dev.mysql.com/doc/refman/5.1/en/libmysqld.html\" rel=\"noreferrer\">https://dev.mysql.com/doc/refman/5.1/en/libmysqld.html</a>. I haven't seen any project packing up the bindings for this in a nice Go package, that would be an interesting small project.</p>\n\n<p>Otherwise you can use Docker to set up a throwaway MySQL server, this requires some setup/teardown steps before you run go test though. This is what we are doing where I work.</p>\n\n<p>In both cases, you will need to write setup/teardown methods that creates and drops tables as needed for your tests. These are just normal SQL statements, DROP DATABASE, CREATE TABLE etc. </p>\n\n<p>Testify <a href=\"https://github.com/stretchr/testify\" rel=\"noreferrer\">https://github.com/stretchr/testify</a> has tooling for setup/teardown, but just writing a helper function for this works just fine.</p>\n"}], "owner": {"reputation": 493, "user_id": 367079, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/4607bf9f84b4c1f507de6ffc4acc606e?s=128&d=identicon&r=PG", "display_name": "Filip", "link": "https://stackoverflow.com/users/367079/filip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3127, "favorite_count": 0, "accepted_answer_id": 29917165, "answer_count": 1, "score": 6, "last_activity_date": 1430217705, "creation_date": 1430197899, "question_id": 29910793, "link": "https://stackoverflow.com/questions/29910793/how-to-write-golang-integration-test-with-mysql", "title": "How to write golang integration test with MySQL", "body": "<p>I want to write an integration test that uses MySQL to test my queries. How to do this in golang?</p>\n\n<p>This contains few questions:</p>\n\n<ol>\n<li>How to setup MySQL (in-memory?) server in golang test?</li>\n<li>How to clean/recreate data model before/after each test so that they do not leave garbage behind?</li>\n<li>How to tear down mysql after all the tests are done?</li>\n</ol>\n"}, {"tags": ["ruby-on-rails", "express", "go", "distributed"], "comments": [{"owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "edited": false, "score": 0, "creation_date": 1430231612, "post_id": 29910745, "comment_id": 47966253, "body": "It looks like you would benefit from exposing an API and having a web app consuming this API. That way, the client side (html, css and JS) is all in one place (the web app), and the server side can talk JSON, or any other data format"}], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 4811562, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-v3Bog3Qbbnw/AAAAAAAAAAI/AAAAAAAAGCg/DjFnp4C7OpA/photo.jpg?sz=128", "display_name": "Qian Qiao", "link": "https://stackoverflow.com/users/4811562/qian-qiao"}, "is_accepted": false, "score": 1, "last_activity_date": 1430246441, "creation_date": 1430246441, "answer_id": 29927372, "question_id": 29910745, "link": "https://stackoverflow.com/questions/29910745/packaging-an-html-template-javascript-and-css-to-be-consumed-by-multiple-platfo/29927372#29927372", "title": "Packaging an html template, javascript and css to be consumed by multiple platforms", "body": "<p>Sounds like the technology in common is HTML/JS/CSS.</p>\n\n<p>Wouldn't it be better to export the mast and footer as a self contained JS library, or more precisely, as widgets?</p>\n\n<p>So whatever the application server tech stack would be, you could always generate the HTML in the form of:</p>\n\n<pre><code>&lt;script src=\"your_widgets.js\"&gt;&lt;/script&gt;\n&lt;script&gt;new Footer.render('id_of_dom_element_to_render_to');&lt;/script&gt;\n</code></pre>\n\n<p>By doing so, whether you want the widget library to load the template or you want to embed the template into the widget library or whether you want to simply just construct it using HTMLFragment will not be limited by the server tech choice.</p>\n"}], "owner": {"reputation": 4991, "user_id": 441935, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/24e14a302cb155b103f4f203f06a65a4?s=128&d=identicon&r=PG", "display_name": "Daniel Nill", "link": "https://stackoverflow.com/users/441935/daniel-nill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1430246441, "creation_date": 1430197654, "question_id": 29910745, "link": "https://stackoverflow.com/questions/29910745/packaging-an-html-template-javascript-and-css-to-be-consumed-by-multiple-platfo", "title": "Packaging an html template, javascript and css to be consumed by multiple platforms", "body": "<p>I have a large rails application that I am wanting to split out into smaller applications.  The one piece of this application that will be universal to all smaller applications is the mast and footer.  I would like to extract the html, javascript and css for the mast and footer into it's own package that each app can load and render.</p>\n\n<p>The main issue I'm running into is that the apps will likely not all be written in rails. Some will be rails, some will be expressjs, some written in Go, and some may end up being written in other languages, so my solution needs to be language agnostic.  </p>\n\n<p>My thought is that I can extract the html, css and javascript into it's own git repo, use mustache templates for the html, and then use grunt or a similar build tool to build a gem, a package.json structure and a golang module.  Possibly each in it's own git submodule.  </p>\n\n<p>I'm curious if there is a more standardized way of doing this. Or if anyone knows of a simpler way of achieving this goal.</p>\n"}, {"tags": ["windows", "go", "libxml2"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1430166191, "post_id": 29901728, "comment_id": 47933163, "body": "You&#39;ve verified that a subsection of your path + <code>&#47;libxml&#47;tree.h|xpath.h</code> exists? The error is simply saying those files aren&#39;t there so if they exist then the problem is almost certainly your path. As far as providing your utility to other people goes, you&#39;re probably gonna want a batch script."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1430166764, "post_id": 29901728, "comment_id": 47933474, "body": "yes, I was afraid about that batch script, too much efforts...  may be I just rewrite with go html standard library... Or even regex it all... I will check once more the PATH tomorrow..."}], "answers": [{"tags": [], "owner": {"reputation": 351, "user_id": 3008483, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/2339c1c2806b833afd9d857253fa83cb?s=128&d=identicon&r=PG&f=1", "display_name": "Zia ur Rehman", "link": "https://stackoverflow.com/users/3008483/zia-ur-rehman"}, "is_accepted": false, "score": 0, "last_activity_date": 1431686559, "creation_date": 1431686559, "answer_id": 30257496, "question_id": 29901728, "link": "https://stackoverflow.com/questions/29901728/go-lang-how-to-install-libxml2-gokogiri-on-windows/30257496#30257496", "title": "Go lang: how to install libxml2/gokogiri on windows", "body": "<p>If you are using visual studio and want to add dependency to your project then just install it using NuGet Package Manager it's easiest method.\nInstall command: Install-Package libxml2 </p>\n"}, {"comments": [{"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1434919137, "post_id": 30967521, "comment_id": 49969642, "body": "Hey, thanks a lot! I will definitely use MINGW when I @ windows! As for thsi question, I have decided that I am not going to use libxml, as there some issues either with libxml or with Go, which leads to huge memory consumption when you libxmling thouthands of docs, no matter how do you closing, defering and even forcing garbage collect... anything..."}], "tags": [], "owner": {"reputation": 70793, "user_id": 28128, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4e974a514f0764fdfe99a8915f192002?s=128&d=identicon&r=PG", "display_name": "David Grayson", "link": "https://stackoverflow.com/users/28128/david-grayson"}, "is_accepted": true, "score": 2, "last_activity_date": 1434948108, "last_edit_date": 1434948108, "creation_date": 1434908877, "answer_id": 30967521, "question_id": 29901728, "link": "https://stackoverflow.com/questions/29901728/go-lang-how-to-install-libxml2-gokogiri-on-windows/30967521#30967521", "title": "Go lang: how to install libxml2/gokogiri on windows", "body": "<p>You are struggling because it is hard to combine packages that were built by different people for different purposes and get your environment set up correctly.  I think it is best to use <a href=\"http://msys2.github.io/\" rel=\"nofollow\">MSYS2</a>, an environment for Windows that provides a consistent set of packages for things like gcc, go, libxml2, and iconv.  MSYS2 has a package manager (pacman) that helps you easily install them and keep them updated.</p>\n\n<p>I don't do much programming with Go, but I am familiar with MSYS2 and it seems like I was able to get gokogiri installed using MSYS2.  You should open MSYS2's \"MinGW-w64 Win64 Shell\" from the Start menu (mingw64_shell.bat), and try running these commands:</p>\n\n<pre><code>pacman -S mingw-w64-x86_64-{gcc,go,libxml2,iconv}\nexport GOROOT=/mingw64/\nexport GOPATH=/c/Users/David/Documents/goproj/\nmkdir -p $GOPATH\ngo git github.com/moovweb/gokogiri\n</code></pre>\n\n<p>I think GOPATH should be set to the directory of your project.  If you run into an error, it might be because some pacman package is required that I didn't list here.</p>\n\n<p>The string <code>mingw-w64-x86_64-{gcc,go,libxml2,iconv}</code> gets expanded by Bash into the following list of packages:</p>\n\n<pre><code>mingw-w64-x86_64-gcc\nmingw-w64-x86_64-go\nmingw-w64-x86_64-libxml2\nmingw-w64-x86_64-iconv\n</code></pre>\n\n<p>If you are actually using 32-bit Windows, replace <code>x86_64</code> with <code>i686</code> in the instructions above.</p>\n\n<p>If you are curious, the scripts for building those packages are here: <a href=\"https://github.com/Alexpux/MINGW-packages\" rel=\"nofollow\">https://github.com/Alexpux/MINGW-packages</a></p>\n\n<p>As a disclaimer, I haven't actually compiled any go programs in MSYS2, so there could be big problems I am unaware of.</p>\n\n<p>Also, one of the main developers of MSYS2 (alexpux) said this in the #msys2 IRC chat on 2015-06-21:</p>\n\n<blockquote>\n  <p>We not build go for a long time.\n  This package in very WIP state\n  Also see\n  <a href=\"https://github.com/Alexpux/MINGW-packages/issues/421\" rel=\"nofollow\">https://github.com/Alexpux/MINGW-packages/issues/421</a></p>\n</blockquote>\n\n<p>So you might need to fix some issues with the MSYS2 Go package and recompile it yourself to really make this work.  But you have the PKGBUILD script that was used to build it, so maybe that will be less hard than what you are trying to do right now, which involves compiling/collecting every dependency of gokogiri.</p>\n\n<p>MSYS2 would make your other installation of go, libxml2, and iconv obsolete.  You can delete those things once you get your MSYS2 environment working.</p>\n"}], "owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1667, "favorite_count": 1, "accepted_answer_id": 30967521, "answer_count": 2, "score": 0, "last_activity_date": 1434948108, "creation_date": 1430153881, "last_edit_date": 1430162106, "question_id": 29901728, "link": "https://stackoverflow.com/questions/29901728/go-lang-how-to-install-libxml2-gokogiri-on-windows", "title": "Go lang: how to install libxml2/gokogiri on windows", "body": "<p>If there a relatively simple way to make go + libxml2 + gokogiri work on windows?</p>\n\n<p>I mean that I may be can install it (but at the moment I can not, stuck with <code>Package libxml-2.0 was not found in the pkg-config search path</code>), but then I need to provide my utilite to other people, who will never be able (or would wish ) to install lall libxml2 dependencies, modify PATH etc on windows... </p>\n\n<p>It work flawless on Ubuntu... </p>\n\n<p>I found this <a href=\"https://github.com/moovweb/gokogiri/issues/49\" rel=\"nofollow\">https://github.com/moovweb/gokogiri/issues/49</a> thats funny with installation of Gimp 2 (what?!), but I still cannot make it run with such error, I guess might be issue with PATH, but all PATH are set</p>\n\n<pre><code>$ go get github.com/moovweb/gokogiri\n# github.com/moovweb/gokogiri/help\nDocuments\\go\\src\\github.com\\moovweb\\gokogiri\\help\\help.go:6:25: fatal error: lib\nxml/tree.h: No such file or directory\n #include &lt;libxml/tree.h&gt;\n                         ^\ncompilation terminated.\n# github.com/moovweb/gokogiri/xpath\nDocuments\\go\\src\\github.com\\moovweb\\gokogiri\\xpath\\expression.go:4:26: fatal err\nor: libxml/xpath.h: No such file or directory\n #include &lt;libxml/xpath.h&gt;\n                          ^\ncompilation terminated.\n</code></pre>\n"}, {"tags": ["javascript", "web", "go", "dart", "angular-dart"], "answers": [{"comments": [{"owner": {"reputation": 7, "user_id": 1302879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48bfb1a0a7783a987fdea0cab2f26970?s=128&d=identicon&r=PG&f=1", "display_name": "Maddy", "link": "https://stackoverflow.com/users/1302879/maddy"}, "edited": false, "score": 0, "creation_date": 1430236988, "post_id": 29900370, "comment_id": 47970289, "body": "Thank you for the answer. This is the expected answer."}], "tags": [], "owner": {"reputation": 16340, "user_id": 505810, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/76df8d243d91e68ef15e5fde3474bf90?s=128&d=identicon&r=PG", "display_name": "Pacane", "link": "https://stackoverflow.com/users/505810/pacane"}, "is_accepted": false, "score": 2, "last_activity_date": 1430149825, "creation_date": 1430149825, "answer_id": 29900370, "question_id": 29900290, "link": "https://stackoverflow.com/questions/29900290/client-server-model-using-dart-as-client-and-go-language-as-server/29900370#29900370", "title": "Client - Server model using Dart as Client and Go language as Server", "body": "<p>I think you got it right! So for example you compile your dart app using <code>dart2js</code> to produce javascript code. Then you can serve this code through a web server (like Apache or Nginx).</p>\n\n<p>This code gets downloaded by clients as Javascript. Your Javascript code may connect to a backend written in Go through HttpRequests or WebSockets.</p>\n\n<p>You can exchange data through both layers with JSON, XML, whatever you want.</p>\n\n<p>Go will most likely run as a process, and embed its own \"listening to HttpRequests\" mechanism for the API.</p>\n"}], "owner": {"reputation": 7, "user_id": 1302879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48bfb1a0a7783a987fdea0cab2f26970?s=128&d=identicon&r=PG&f=1", "display_name": "Maddy", "link": "https://stackoverflow.com/users/1302879/maddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "closed_date": 1430149999, "answer_count": 1, "score": 0, "last_activity_date": 1430149825, "creation_date": 1430149577, "question_id": 29900290, "link": "https://stackoverflow.com/questions/29900290/client-server-model-using-dart-as-client-and-go-language-as-server", "closed_reason": "Needs details or clarity", "title": "Client - Server model using Dart as Client and Go language as Server", "body": "<p>I am trying to understand google two programing language.</p>\n\n<p>Dart --> Produce Javascript</p>\n\n<p>Go   --> Produce machine code</p>\n\n<p>If I need to combine Client - Server model. I am wondering how the architecture works.</p>\n\n<p>How does it work. Is there any example/sample.</p>\n\n<p>Example : Please explain this.....</p>\n\n<p>I type www.learnlang.com. I expect WEB UI is served using Dart and It is calling REST API developed in GO language.</p>\n\n<p>Note : Please don't relate google app engine. I am trying to understand the model in individual servers.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "dns"], "comments": [{"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 1, "creation_date": 1430148934, "post_id": 29899971, "comment_id": 47922695, "body": "I don&#39;t know / don&#39;t think so...  Maybe, <a href=\"https://github.com/miekg/dns\" rel=\"nofollow noreferrer\">github.com/miekg/dns</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430175779, "post_id": 29899971, "comment_id": 47937395, "body": "<a href=\"https://godoc.org/?q=dns\" rel=\"nofollow noreferrer\">godoc.org/?q=dns</a>"}], "answers": [{"tags": [], "owner": {"reputation": 549, "user_id": 3040816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43fdb4f835d35ff0f78867a4d2007b4f?s=128&d=identicon&r=PG&f=1", "display_name": "smnpl", "link": "https://stackoverflow.com/users/3040816/smnpl"}, "is_accepted": true, "score": 0, "last_activity_date": 1430149589, "creation_date": 1430149589, "answer_id": 29900293, "question_id": 29899971, "link": "https://stackoverflow.com/questions/29899971/does-go-have-built-in-package-to-create-dns-server/29900293#29900293", "title": "Does Go have built-in package to create DNS-server?", "body": "<p>As the search on the language reference doesn't find something, I'd agree that there is no dns in the standard library <a href=\"https://golang.org/search?q=dns\" rel=\"nofollow\">(Search on golang reference)</a>.\nThough I've already seen libraries on github.</p>\n"}], "owner": {"reputation": 13460, "user_id": 1349754, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/QoNQ4.jpg?s=128&g=1", "display_name": "Timur Fayzrakhmanov", "link": "https://stackoverflow.com/users/1349754/timur-fayzrakhmanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "closed_date": 1430162614, "accepted_answer_id": 29900293, "answer_count": 1, "score": 0, "last_activity_date": 1430187320, "creation_date": 1430148743, "last_edit_date": 1430187320, "question_id": 29899971, "link": "https://stackoverflow.com/questions/29899971/does-go-have-built-in-package-to-create-dns-server", "closed_reason": "Not suitable for this site", "title": "Does Go have built-in package to create DNS-server?", "body": "<p>I don't know much about building DNS servers, but still.. Does Go have built-in packages to create DNS-server?</p>\n"}, {"tags": ["go", "docker"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1430145235, "post_id": 29898620, "comment_id": 47919964, "body": "user db access requires cgo on linux."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1430146041, "post_id": 29898620, "comment_id": 47920588, "body": "also, what do you want to do with <code>user.Current</code>? You can use <code>os.Getuid</code> if you don&#39;t need to lookup user information."}, {"owner": {"reputation": 2127, "user_id": 198415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/564697e239aec4bd3f002f69396d9229?s=128&d=identicon&r=PG", "display_name": "Dima Stopel", "link": "https://stackoverflow.com/users/198415/dima-stopel"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430233401, "post_id": 29898620, "comment_id": 47967503, "body": "Thanks Jim. Will try with os.Getuid and report back."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430233903, "post_id": 29898620, "comment_id": 47967867, "body": "You may also be able to get what you need simply using the <code>$USER</code> environment variable."}], "answers": [{"comments": [{"owner": {"reputation": 2127, "user_id": 198415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/564697e239aec4bd3f002f69396d9229?s=128&d=identicon&r=PG", "display_name": "Dima Stopel", "link": "https://stackoverflow.com/users/198415/dima-stopel"}, "edited": false, "score": 0, "creation_date": 1430233294, "post_id": 29899712, "comment_id": 47967427, "body": "Thank you James. My end goal is to create a small container for my golang app. AFAIU from your answer this can be achieved by statically linking with C library. Is this correct? If so, can you please share a pointer to how to do it?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2127, "user_id": 198415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/564697e239aec4bd3f002f69396d9229?s=128&d=identicon&r=PG", "display_name": "Dima Stopel", "link": "https://stackoverflow.com/users/198415/dima-stopel"}, "edited": false, "score": 0, "creation_date": 1430234638, "post_id": 29899712, "comment_id": 47968469, "body": "@DimaStopel: statically linking glibc is not a good idea (you&#39;ll get warnings from the linker indicating this), as the runtime glibc still has to match the exact version."}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1430292031, "post_id": 29899712, "comment_id": 47995350, "body": "Like @JimB, I wouldn&#39;t recommend statically linking with libc.  If you need it, just include it in your container.  With that said, if your app is the only thing in the container, what do you actually need <code>user.Current()</code> for?"}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 4, "last_activity_date": 1430148896, "last_edit_date": 1430148896, "creation_date": 1430148036, "answer_id": 29899712, "question_id": 29898620, "link": "https://stackoverflow.com/questions/29898620/user-current-not-implemented-on-linux-amd64-with-golang-using-docker-scratch/29899712#29899712", "title": "user: Current not implemented on linux/amd64 with golang using docker scratch", "body": "<p>The <code>os/user</code> package's user info lookup on Linux is implemented using the <code>getpwuid_r</code> system call, so will not work when compiled with <code>CGO_ENABLED=0</code>.</p>\n\n<p>While implementing a <code>/etc/passwd</code> parser in Go sounds simple, the <code>getpwuid</code> function may retrieve the user information from a different source.  For instance, on some systems it might use an LDAP directory.  So the only way to get parity is to delegate to the C library.</p>\n"}], "owner": {"reputation": 2127, "user_id": 198415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/564697e239aec4bd3f002f69396d9229?s=128&d=identicon&r=PG", "display_name": "Dima Stopel", "link": "https://stackoverflow.com/users/198415/dima-stopel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1237, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1501247638, "creation_date": 1430145109, "last_edit_date": 1501247638, "question_id": 29898620, "link": "https://stackoverflow.com/questions/29898620/user-current-not-implemented-on-linux-amd64-with-golang-using-docker-scratch", "title": "user: Current not implemented on linux/amd64 with golang using docker scratch", "body": "<p>I have used <a href=\"https://blog.codeship.com/building-minimal-docker-containers-for-go-applications/\" rel=\"nofollow\">this</a> tutorial to compile my go app to run on container derived from scratch. </p>\n\n<p>My go code uses <code>user.Current()</code> from <code>os/user</code>. When I use the technique from the blog post I get the following error when running the container:</p>\n\n<pre><code>user: Current not implemented on linux/amd64\n</code></pre>\n\n<p>To elaborate more:</p>\n\n<p>This is the command used to compile:</p>\n\n<pre><code>CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .\n</code></pre>\n\n<p>This is the Dockerfile used to create the image (<code>scratch</code> based):</p>\n\n<pre><code>FROM scratch\nADD ca-certificates.crt /etc/ssl/certs/\nADD main /\nENTRYPOINT [\"/main\"]\n</code></pre>\n\n<p>This is the command used to run the container:</p>\n\n<pre><code>sudo docker run -it -v /var/run/docker.sock:/var/run/docker.sock --rm 813\n</code></pre>\n\n<p>Did anyone encounter this? Any solution?</p>\n"}, {"tags": ["struct", "go", "package"], "comments": [{"owner": {"reputation": 530, "user_id": 3625638, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LJhSE.png?s=128&g=1", "display_name": "smartDonkey", "link": "https://stackoverflow.com/users/3625638/smartdonkey"}, "edited": false, "score": 0, "creation_date": 1430145162, "post_id": 29898400, "comment_id": 47919913, "body": "Why wouldn&#39;t you just copy the struct to your package?"}, {"owner": {"reputation": 530, "user_id": 3625638, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LJhSE.png?s=128&g=1", "display_name": "smartDonkey", "link": "https://stackoverflow.com/users/3625638/smartdonkey"}, "edited": false, "score": 1, "creation_date": 1430145211, "post_id": 29898400, "comment_id": 47919945, "body": "Or import the package?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 3, "creation_date": 1430145213, "post_id": 29898400, "comment_id": 47919947, "body": "Qualify it. <code>pq := &amp;mypkg.PriorityQueue{}</code>."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1430145479, "post_id": 29898400, "comment_id": 47920169, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/18256391/how-do-i-use-my-import-packages-struct-as-a-type-in-go\">how do I use my import package&#39;s struct as a type in go</a>"}, {"owner": {"reputation": 3197, "user_id": 3750381, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f3203f61c9d9e29b6ab0491c5727eec6?s=128&d=identicon&r=PG&f=1", "display_name": "Vasantha Ganesh", "link": "https://stackoverflow.com/users/3750381/vasantha-ganesh"}, "edited": false, "score": 0, "creation_date": 1557312411, "post_id": 29898400, "comment_id": 98720072, "body": "I faced the same problem, The fix is to use caps not just for the struct name but the variables inside struct as well for them to be exported."}], "answers": [{"comments": [{"owner": {"reputation": 696, "user_id": 1364759, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/3b01238f289cc93432a681999f9e07d8?s=128&d=identicon&r=PG", "display_name": "Shadoninja", "link": "https://stackoverflow.com/users/1364759/shadoninja"}, "edited": false, "score": 0, "creation_date": 1487020201, "post_id": 29898669, "comment_id": 71588529, "body": "I have also made the mistake where I create a new project outside of the GOPATH. Local imports failing may be the first sign that this has been done."}, {"owner": {"reputation": 1389, "user_id": 3831478, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/jhJdG.jpg?s=128&g=1", "display_name": "gary", "link": "https://stackoverflow.com/users/3831478/gary"}, "edited": false, "score": 1, "creation_date": 1522220024, "post_id": 29898669, "comment_id": 86061318, "body": "It&#39;s awesome to use <code>import .</code> for leaving out the package name completely!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 70, "last_activity_date": 1430145598, "last_edit_date": 1430145598, "creation_date": 1430145226, "answer_id": 29898669, "question_id": 29898400, "link": "https://stackoverflow.com/questions/29898400/import-struct-from-another-package-and-file-golang/29898669#29898669", "title": "Import struct from another package and file golang", "body": "<p>In Go you don't import types or functions, you import <a href=\"https://golang.org/ref/spec#Packages\" rel=\"noreferrer\"><em>packages</em></a> (see <a href=\"https://golang.org/ref/spec#Import_declarations\" rel=\"noreferrer\">Spec: Import declarations</a>).</p>\n\n<p>An example import declaration:</p>\n\n<pre><code>import \"container/list\"\n</code></pre>\n\n<p>And by importing a package you get access to all of its <em>exported</em> identifiers and you can refer to them as <code>packagename.Identifiername</code>, for example:</p>\n\n<pre><code>var mylist *list.List = list.New()\n\n// Or simply:\nl := list.New()\n</code></pre>\n\n<p>There are some tricks in import declaration, for example by doing:</p>\n\n<pre><code>import m \"container/list\"\n</code></pre>\n\n<p>You could refer to the exported identifiers with <code>\"m.Identifiername\"</code>, e.g.</p>\n\n<pre><code>l := m.New()\n</code></pre>\n\n<p>Also by doing:</p>\n\n<pre><code>import . \"container/list\"\n</code></pre>\n\n<p>You can leave out the package name completely:</p>\n\n<pre><code>l := New()\n</code></pre>\n\n<p>But only use these \"in emergency\" or when there are name collisions (which are rare).</p>\n"}, {"comments": [{"owner": {"reputation": 114, "user_id": 8296461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aee2fcc9ebbee078c749f33fbb1bf795?s=128&d=identicon&r=PG&f=1", "display_name": "Sumukha Pk", "link": "https://stackoverflow.com/users/8296461/sumukha-pk"}, "edited": false, "score": 3, "creation_date": 1556773487, "post_id": 53474756, "comment_id": 98544432, "body": "How do I access &#39;X&#39; from myTypes? Because, in a similar scenario, myTypes.A.X doesnt seem to work."}, {"owner": {"reputation": 115, "user_id": 6795773, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/yfah2.jpg?s=128&g=1", "display_name": "Gaurav", "link": "https://stackoverflow.com/users/6795773/gaurav"}, "edited": false, "score": 0, "creation_date": 1603874874, "post_id": 53474756, "comment_id": 114171442, "body": "To access the variable inside struct simply do myTypes.X and make sure X is global variable(first letter should be in capital)"}], "tags": [], "owner": {"reputation": 4532, "user_id": 366864, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yP664.jpg?s=128&g=1", "display_name": "ddotsenko", "link": "https://stackoverflow.com/users/366864/ddotsenko"}, "is_accepted": false, "score": 5, "last_activity_date": 1609865814, "last_edit_date": 1609865814, "creation_date": 1543206222, "answer_id": 53474756, "question_id": 29898400, "link": "https://stackoverflow.com/questions/29898400/import-struct-from-another-package-and-file-golang/53474756#53474756", "title": "Import struct from another package and file golang", "body": "<p>What @icza said above plus:</p>\n<p>With Go 1.9 there are type aliases that allow you to import types from packages and alias them into what look like <strong>local</strong> types:</p>\n<p><code>package.go</code> contents:</p>\n<pre><code>type A struct {\n    X, Y int\n}\n</code></pre>\n<p><code>main.go</code> contents:</p>\n<pre><code>...\n\nimport myTypes &quot;path/to/package&quot;\n\n// Note the equal sign (not empty space)\n// It does NOT create a new &quot;subclass&quot;\n// It's an actual alias that is local.\n// Allows you to avoid whole-sale `import . &quot;path/to/package&quot;` which imports all objects from there into local scope.\ntype A = myTypes.A\n\n...\n</code></pre>\n"}], "owner": {"reputation": 3615, "user_id": 4725175, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/10206540408857078/picture?type=large", "display_name": "Jakob Svenningsson", "link": "https://stackoverflow.com/users/4725175/jakob-svenningsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69770, "favorite_count": 14, "accepted_answer_id": 29898669, "answer_count": 2, "score": 45, "last_activity_date": 1609865814, "creation_date": 1430144556, "last_edit_date": 1447984533, "question_id": 29898400, "link": "https://stackoverflow.com/questions/29898400/import-struct-from-another-package-and-file-golang", "title": "Import struct from another package and file golang", "body": "<p>I have a problem trying to import a type from another package and file. The struct that I'm trying to import is the one underneath.</p>\n\n<pre><code>type PriorityQueue []*Item\n\ntype Item struct {\n   value string\n   priority int   \n   index int \n}\n</code></pre>\n\n<p>If I would put the PriorityQueue alongside with all of its methods in the same file I'd declare it with</p>\n\n<pre><code>pq:= &amp;PriorityQueue{}\n</code></pre>\n\n<p>I've been searching the internet like a madman for an answer on this simple question but I have not found an answer. I usually program in java and import classes is so elementary. </p>\n"}, {"tags": ["macos", "go"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1430141580, "post_id": 29897220, "comment_id": 47917090, "body": "I would also recommend to subscribe to the <a href=\"https://groups.google.com/forum/#!forum/golang-nuts/\" rel=\"nofollow noreferrer\"><code>go-nuts</code> mailing list</a> and post your question there, linking to this your SO question.  That&#39;s because your problem IMO suggests a more extensive solution than you have supposedly envisioned."}, {"owner": {"reputation": 13, "user_id": 4837693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9427b39a281756f9fffd4a52263e07f9?s=128&d=identicon&r=PG&f=1", "display_name": "Leo", "link": "https://stackoverflow.com/users/4837693/leo"}, "edited": false, "score": 0, "creation_date": 1430205379, "post_id": 29897220, "comment_id": 47947486, "body": "Thank you for these hints! It looks as the solution is a bit more complicated than I was hoping ;-)."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 1, "last_activity_date": 1430141493, "last_edit_date": 1495541181, "creation_date": 1430141493, "answer_id": 29897220, "question_id": 29896408, "link": "https://stackoverflow.com/questions/29896408/open-with-application-how-to-detect-filename-in-go/29897220#29897220", "title": "Open With Application: How to detect filename in go", "body": "<p>Looks like a program started via \"Open With\" does not receive the name of the file it has been invoked on but rather has to obtain it using \"Apple events\" as described <a href=\"https://stackoverflow.com/questions/3664124/macosx-open-file-with-an-application-where-does-it-go-to\">in the accepted answer here</a>.</p>\n\n<p>I am thereby afraid currently the only way to solve the problem would be to use <a href=\"http://blog.golang.org/c-go-cgo\" rel=\"nofollow noreferrer\"><code>cgo</code></a>; may be along <a href=\"https://gist.github.com/kavu/6740536\" rel=\"nofollow noreferrer\">these lines</a>.</p>\n"}], "owner": {"reputation": 13, "user_id": 4837693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9427b39a281756f9fffd4a52263e07f9?s=128&d=identicon&r=PG&f=1", "display_name": "Leo", "link": "https://stackoverflow.com/users/4837693/leo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 29897220, "answer_count": 1, "score": 1, "last_activity_date": 1430141493, "creation_date": 1430139264, "question_id": 29896408, "link": "https://stackoverflow.com/questions/29896408/open-with-application-how-to-detect-filename-in-go", "title": "Open With Application: How to detect filename in go", "body": "<p>I have created a go application on my mac that reads/writes from files *.myext. The executable was packed into an a Bundle called \"MyApp\".</p>\n\n<p>I can start MyApp and then read/write *.myext files, that works. </p>\n\n<p>My question is: how to detect the filename if I am opening e.g. test.myext by Open With > MyApp (usually right mouse button)? </p>\n\n<p>I have tried to read the file name from os.Args, but the file name is not in there.</p>\n\n<p>Is there a way?</p>\n\n<p>Thank you for your help!</p>\n\n<p>Leo</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1430138411, "post_id": 29895951, "comment_id": 47914629, "body": "It&#39;s working for me. May you have network issues. :("}, {"owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1430138473, "post_id": 29895951, "comment_id": 47914686, "body": "Here is the result: <a href=\"https://gist.github.com/diatmpravin/2fa442eb37b1d34476a5\" rel=\"nofollow noreferrer\">gist.github.com/diatmpravin/2fa442eb37b1d34476a5</a>"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1430138493, "post_id": 29895951, "comment_id": 47914700, "body": "Same as @PravinMishra, I can get it just fine. Check your connection."}, {"owner": {"reputation": 39460, "user_id": 13009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6cc09155d4a43cc770bf1e77fd87867a?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/13009/greg"}, "edited": false, "score": 0, "creation_date": 1430139185, "post_id": 29895951, "comment_id": 47915238, "body": "Thanks guys.  I&#39;m suspecting network issues, I guess my question is more how to track down the issue, and ideally fix it :-)"}, {"owner": {"reputation": 39460, "user_id": 13009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6cc09155d4a43cc770bf1e77fd87867a?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/13009/greg"}, "reply_to_user": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1430139218, "post_id": 29895951, "comment_id": 47915274, "body": "@PravinMishra thanks, can I use that result somehow in place of the go get call?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430141898, "post_id": 29895951, "comment_id": 47917336, "body": "You may have an old version of <code>git</code> which had some issues dealing with the meta tags. Try updating git first. (also, if you&#39;re ever stuck using &#39;go get&#39; you can also just checkout the code directly into your GOPATH)"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1430141927, "post_id": 29895951, "comment_id": 47917362, "body": "You can always manually clone to the appropriate directory"}, {"owner": {"reputation": 39460, "user_id": 13009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6cc09155d4a43cc770bf1e77fd87867a?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/13009/greg"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430142300, "post_id": 29895951, "comment_id": 47917696, "body": "@JimB thanks for the ideas.  I&#39;m on git 1.7.1.  Is that potentially too old?  I&#39;ll give the direct checkout a try."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430142568, "post_id": 29895951, "comment_id": 47917905, "body": "@Greg: IIRC 1.7.1 is a buggy version, and quite old now."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430143169, "post_id": 29895951, "comment_id": 47918401, "body": "It&#39;s <a href=\"https://stackoverflow.com/questions/tagged/go\">go</a>, not &quot;Golang&quot;, and it is undesirable to <a href=\"http://meta.stackexchange.com/a/130208/150469\">manually insert tags into question titles</a>."}, {"owner": {"reputation": 39460, "user_id": 13009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6cc09155d4a43cc770bf1e77fd87867a?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/13009/greg"}, "edited": false, "score": 0, "creation_date": 1430143670, "post_id": 29895951, "comment_id": 47918781, "body": "I used &quot;go get&quot; in the title because that&#39;s the command I&#39;m running.  I just deleted the tag though, and put &quot;go get&quot; in quotes.  I hope that helps."}], "answers": [{"tags": [], "owner": {"reputation": 39460, "user_id": 13009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6cc09155d4a43cc770bf1e77fd87867a?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/13009/greg"}, "is_accepted": true, "score": 4, "last_activity_date": 1430143709, "creation_date": 1430143709, "answer_id": 29898088, "question_id": 29895951, "link": "https://stackoverflow.com/questions/29895951/go-get-hanging-on-certain-library/29898088#29898088", "title": "&quot;go get&quot; hanging on certain library", "body": "<p>Thanks @Jimb.  Upgrading git to a newer version fixed the issue.</p>\n"}], "owner": {"reputation": 39460, "user_id": 13009, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6cc09155d4a43cc770bf1e77fd87867a?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/13009/greg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4843, "favorite_count": 2, "accepted_answer_id": 29898088, "answer_count": 1, "score": 8, "last_activity_date": 1484605432, "creation_date": 1430138093, "last_edit_date": 1484605432, "question_id": 29895951, "link": "https://stackoverflow.com/questions/29895951/go-get-hanging-on-certain-library", "title": "&quot;go get&quot; hanging on certain library", "body": "<p>I'm trying to get this lumberjack library and it always hangs on the download step.</p>\n\n<p>I hit the same issue Friday and today. other Go packages install fine.  I'm on Scientific Linux.  Any ideas what could be going on?</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>&gt;go get -u -v  gopkg.in/natefinch/lumberjack.v2\nFetching https://gopkg.in/natefinch/lumberjack.v2?go-get=1\nParsing meta tags from https://gopkg.in/natefinch/lumberjack.v2?go-get=1 (status code 200)\nget \"gopkg.in/natefinch/lumberjack.v2\": found meta tag main.metaImport{Prefix:\"gopkg.in/natefinch/lumberjack.v2\", VCS:\"git\", RepoRoot:\"https://gopkg.in/natefinch/lumberjack.v2\"} at https://gopkg.in/natefinch/lumberjack.v2?go-get=1\ngopkg.in/natefinch/lumberjack.v2 (download)\n</code></pre>\n\n<p>(It hangs on last line, I've let it run for 20 minutes so far.)</p>\n"}, {"tags": ["go", "permissions", "directory"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1430136424, "post_id": 29894924, "comment_id": 47913239, "body": "Check your umask :-)"}, {"owner": {"reputation": 3201, "user_id": 2616179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb90669caa64288bdb5767f736152bbe?s=128&d=identicon&r=PG", "display_name": "Makpoc", "link": "https://stackoverflow.com/users/2616179/makpoc"}, "edited": false, "score": 1, "creation_date": 1430137018, "post_id": 29894924, "comment_id": 47913647, "body": "You can do this by typing <code>umask</code> (or <code>umask -S</code>) in your terminal. You can also experiment with setting a temporary one using <code>umask 077</code>"}, {"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1430138637, "post_id": 29894924, "comment_id": 47914799, "body": "Read about how umasks works. Set the umask to 0 for the \u201cexpected\u201d behaviour."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1430137429, "post_id": 29895320, "comment_id": 47913920, "body": "Peter, please be sure to read the <a href=\"http://linux.die.net/man/2/umask\" rel=\"nofollow noreferrer\"><code>umask(2)</code> manual page</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1430139438, "last_edit_date": 1430139438, "creation_date": 1430136437, "answer_id": 29895320, "question_id": 29894924, "link": "https://stackoverflow.com/questions/29894924/a-folder-created-with-os-mkdir-has-incorrect-permissions/29895320#29895320", "title": "A folder created with os.Mkdir() has incorrect permissions", "body": "<p>The actual permission that the created folder will get is the result of the permission you specify (<code>0777</code>) and the active <code>umask</code> of your process (the running Go program).</p>\n\n<p>This is most likely why the created folder lacks write permission for group and other access.</p>\n\n<p>You can read more about <code>umask</code> on <a href=\"http://en.wikipedia.org/wiki/Umask\" rel=\"nofollow\">Wikipedia</a>.</p>\n"}], "owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 617, "favorite_count": 1, "accepted_answer_id": 29895320, "answer_count": 1, "score": 1, "last_activity_date": 1430139438, "creation_date": 1430135451, "last_edit_date": 1430137260, "question_id": 29894924, "link": "https://stackoverflow.com/questions/29894924/a-folder-created-with-os-mkdir-has-incorrect-permissions", "title": "A folder created with os.Mkdir() has incorrect permissions", "body": "<p>I am creating a folder in go using os.Mkdir(). While it does get created, it does not possess the permissions I expected it to.</p>\n\n<p>Here is the code I used to create the directory:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    err := os.Mkdir(\"/var/run/testdir\", 0777)\n    if err != nil {\n        fmt.Println(\"could not create dir: %s\", err.Error())\n        err = nil\n    }\n}\n</code></pre>\n\n<p>As I have given \"0777\" as parameter, I am excpecting the created dir to have full permissions for everybody. It however has:</p>\n\n<pre><code>drwxr-xr-x  2 root       root         40 Apr 27 11:43 testdir/\n</code></pre>\n\n<p>What am I getting wrong here?</p>\n"}, {"tags": ["go", "operator-keyword"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1430132250, "post_id": 29893723, "comment_id": 47910496, "body": "What is it you want exactly? Get the index of an element in the array (which is a slice in your case)? Or remove an element from the array/slice?"}, {"owner": {"reputation": 2297, "user_id": 661378, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/853372c681dc96b95f42adcb88b0cb3f?s=128&d=identicon&r=PG", "display_name": "qwertmax", "link": "https://stackoverflow.com/users/661378/qwertmax"}, "edited": false, "score": 0, "creation_date": 1430133300, "post_id": 29893723, "comment_id": 47911244, "body": "you have to ask a more detailed question"}], "answers": [{"tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 2, "last_activity_date": 1430132568, "creation_date": 1430132568, "answer_id": 29893949, "question_id": 29893723, "link": "https://stackoverflow.com/questions/29893723/invalid-operation-operator-not-defined-on-string/29893949#29893949", "title": "invalid operation: (operator - not defined on string)", "body": "<p>How would you define operator <code>-</code> on strings? What result would you expect after calling <code>\"Hello\"-\"World\"</code>?</p>\n\n<p>Are you trying to operate on single characters? This is well defined and you can probably expect <code>'c'-'a'</code> to equal <code>2</code> indeed. Consider:</p>\n\n<pre><code>arrayAll := []byte{'a', 'b', 'c'} (or simply \"abc\")\nx := p[arrayAll[2] - 'a']\n</code></pre>\n\n<p>One way or another you most probably don't want to subtract strings, but integer representations of characters.</p>\n"}], "owner": {"reputation": 345, "user_id": 4473797, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rrXjj.jpg?s=128&g=1", "display_name": "Francis Shi", "link": "https://stackoverflow.com/users/4473797/francis-shi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3002, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1430133568, "creation_date": 1430131965, "last_edit_date": 1430133568, "question_id": 29893723, "link": "https://stackoverflow.com/questions/29893723/invalid-operation-operator-not-defined-on-string", "title": "invalid operation: (operator - not defined on string)", "body": "<pre><code>arrayAll := []string{\"a\", \"b\", \"c\", \"d\", \"e\"}\n\nx := p[arrayAll[i]-\"a\"]\n</code></pre>\n\n<p>go does not support operators \"-\"\uff0c\nso how can I get the index of array\uff1aarrayAll[i]-\"a\"</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1430132524, "last_edit_date": 1430132524, "creation_date": 1430130423, "answer_id": 29893160, "question_id": 29892950, "link": "https://stackoverflow.com/questions/29892950/why-goroutine-leaks/29893160#29893160", "title": "Why goroutine leaks", "body": "<p>One problem I see is that inside <code>broadcastMsg()</code> after goroutines have started:</p>\n\n<pre><code>for _ = range addrs {\n    if err := &lt;-errc; err != nil {\n        return err\n    }\n}\n</code></pre>\n\n<p>If a non-<code>nil</code> <code>error</code> is received from <code>errc</code>, <code>broadcastMsg()</code> returns immediately with that error and does not receive futher values from the channel, which means further goroutines will never get unblocked because <code>errc</code> is unbuffered.</p>\n\n<h3>Possible Fixes</h3>\n\n<p>A possible fix would be to use a buffered channel, big enough to not block any of the goroutines, in this case:</p>\n\n<pre><code>errc := make(chan error, len(addrs))\n</code></pre>\n\n<p>Or even if a non-<code>nil</code> <code>error</code> is received from the channel, still proceed to receive as many times as many goroutines send on it:</p>\n\n<pre><code>var errRec error\nfor _ = range addrs {\n    if err := &lt;-errc; err != nil {\n        if errRec == nil {\n            errRec = err\n        }\n    }\n}\nreturn errRec\n</code></pre>\n\n<p>Or as mentioned in the linked talk on <a href=\"https://talks.golang.org/2013/bestpractices.slide#33\">slide #33</a>: use a \"quit\" channel to prevent the started goroutines to remain blocked after <code>broadcastMsg()</code> has completed/returned.</p>\n"}, {"tags": [], "owner": {"reputation": 204, "user_id": 2876682, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb81fb6d695c0fce238b7f09faf07796?s=128&d=identicon&r=PG", "display_name": "frostschutz", "link": "https://stackoverflow.com/users/2876682/frostschutz"}, "is_accepted": false, "score": 5, "last_activity_date": 1430130451, "creation_date": 1430130451, "answer_id": 29893166, "question_id": 29892950, "link": "https://stackoverflow.com/questions/29892950/why-goroutine-leaks/29893166#29893166", "title": "Why goroutine leaks", "body": "<p>You have a list of two addresses (localhost, google). To each of these you're sending a message (hi), using one goroutine per address. And the goroutine sends error (which may be nil) to errc channel.</p>\n\n<p>If you send something to a channel, you also need something that reads the values from that channel, otherwise it will block (unless it's a buffered channel, but even buffered channels block once their buffer is full).</p>\n\n<p>So your reading loop looks like this:</p>\n\n<pre><code>for _ = range addrs {\n    if err := &lt;-errc; err != nil {\n        return err\n    }\n}\n</code></pre>\n\n<p>If the first address returns an error which is not nil, the loop returns. The subsequent error values are never read from the channel thus it blocks.</p>\n"}], "owner": {"reputation": 25967, "user_id": 1743843, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8ea2c1d9051e40332376a07bc166d9d5?s=128&d=identicon&r=PG&f=1", "display_name": "softshipper", "link": "https://stackoverflow.com/users/1743843/softshipper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3827, "favorite_count": 3, "accepted_answer_id": 29893160, "answer_count": 2, "score": 5, "last_activity_date": 1430132524, "creation_date": 1430129783, "last_edit_date": 1430130854, "question_id": 29892950, "link": "https://stackoverflow.com/questions/29892950/why-goroutine-leaks", "title": "Why goroutine leaks", "body": "<p>I read <a href=\"https://talks.golang.org/2013/bestpractices.slide#30\" rel=\"nofollow\">Twelve Go Best Practices</a> and encounter and interesting example on page 30.</p>\n\n<pre><code>func sendMsg(msg, addr string) error {\n    conn, err := net.Dial(\"tcp\", addr)\n    if err != nil {\n        return err\n    }\n    defer conn.Close()\n    _, err = fmt.Fprint(conn, msg)\n    return err\n} \n\nfunc broadcastMsg(msg string, addrs []string) error {\n    errc := make(chan error)\n    for _, addr := range addrs {\n        go func(addr string) {\n            errc &lt;- sendMsg(msg, addr)\n            fmt.Println(\"done\")\n        }(addr)\n    }\n\n    for _ = range addrs {\n        if err := &lt;-errc; err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\nfunc main() {\n    addr := []string{\"localhost:8080\", \"http://google.com\"}\n    err := broadcastMsg(\"hi\", addr)\n\n    time.Sleep(time.Second)\n\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Println(\"everything went fine\")\n}\n</code></pre>\n\n<p>The programmer mentioned, that happens to the code above:</p>\n\n<pre><code>the goroutine is blocked on the chan write\nthe goroutine holds a reference to the chan\nthe chan will never be garbage collected\n</code></pre>\n\n<p>Why the goroutine is blocked here? The main thread is blocked, until it receive data from goroutine. After it continues the for loop. Not?</p>\n\n<p>Why the errc chan will be never garbage collected? Because I do not close the channel, after goroutine is finished?  </p>\n"}, {"tags": ["go", "naming-conventions"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430142384, "post_id": 29891677, "comment_id": 47917766, "body": "No special meaning, but don&#39;t do it yourself. It&#39;s not idiomatic."}], "answers": [{"tags": [], "owner": {"reputation": 1611, "user_id": 2450813, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/331e96ef9f95dbd3fe84e45f7f58aade?s=128&d=identicon&r=PG", "display_name": "Cedric Morent", "link": "https://stackoverflow.com/users/2450813/cedric-morent"}, "is_accepted": false, "score": 3, "last_activity_date": 1430127390, "creation_date": 1430127390, "answer_id": 29892042, "question_id": 29891677, "link": "https://stackoverflow.com/questions/29891677/when-to-use-leading-underscore-in-variable-names-in-go/29892042#29892042", "title": "When to use leading underscore in variable names in Go", "body": "<p>It seems that there is nothing regarding the _ in a variable name in the naming convetions. \nFrom here: <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow\">effective go</a></p>\n"}, {"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 8, "last_activity_date": 1430129411, "creation_date": 1430129411, "answer_id": 29892825, "question_id": 29891677, "link": "https://stackoverflow.com/questions/29891677/when-to-use-leading-underscore-in-variable-names-in-go/29892825#29892825", "title": "When to use leading underscore in variable names in Go", "body": "<p>There is no special meaning defined for a leading underscore in an identifier name in the <a href=\"https://golang.org/ref/spec#Identifiers\" rel=\"noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <p><strong>Identifiers</strong></p>\n  \n  <p>Identifiers name program entities such as variables and types. An\n  identifier is a sequence of one or more letters and digits. The first\n  character in an identifier must be a letter.</p>\n  \n  <p><code>identifier = letter { letter | unicode_digit } .</code></p>\n\n<pre><code>a\n_x9 \nThisVariableIsExported \n\u03b1\u03b2\n</code></pre>\n</blockquote>\n\n<p>Your sample is generated code from <a href=\"https://github.com/rafrombrc/gomock/blob/master/mockgen/mockgen.go\" rel=\"noreferrer\">mockgen.go</a>. </p>\n\n<p>In the package you linked you'll see things like:</p>\n\n<pre><code>// Recorder for MockTracker (not exported)\ntype _MockTrackerRecorder struct {\n    mock *MockTracker\n}\n</code></pre>\n\n<p>The sanitize function in the mockgen package prepends an underscore to package names and it seems that it's otherwise used for consistency and to ensure that identifier names remain private (i.e. not exported because they start with a capital letter). But it's not something that is defined in the Go spec.</p>\n\n<pre><code>// sanitize cleans up a string to make a suitable package name.\nfunc sanitize(s string) string {\n    t := \"\"\n    for _, r := range s {\n        if t == \"\" {\n            if unicode.IsLetter(r) || r == '_' {\n                t += string(r)\n                continue\n            }\n        } else {\n            if unicode.IsLetter(r) || unicode.IsDigit(r) || r == '_' {\n                t += string(r)\n                continue\n            }\n        }\n        t += \"_\"\n    }\n    if t == \"_\" {\n        t = \"x\"\n    }\n    return t\n}\n</code></pre>\n"}], "owner": {"reputation": 4236, "user_id": 2231905, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/0d4a1b6ef81bd93c9dd8896880995b77?s=128&d=identicon&r=PG", "display_name": "Fallen", "link": "https://stackoverflow.com/users/2231905/fallen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7347, "favorite_count": 1, "accepted_answer_id": 29892825, "answer_count": 2, "score": 6, "last_activity_date": 1430129411, "creation_date": 1430126445, "question_id": 29891677, "link": "https://stackoverflow.com/questions/29891677/when-to-use-leading-underscore-in-variable-names-in-go", "title": "When to use leading underscore in variable names in Go", "body": "<p>Is there any special purpose of leading <code>_</code> in a variable's name?</p>\n\n<p>Example:\n<code>func (_m *MockTracker)...</code> </p>\n\n<p>from <a href=\"https://github.com/fluffle/goirc/blob/master/state/mock_tracker.go\" rel=\"noreferrer\">here</a>. </p>\n"}, {"tags": ["sql", "postgresql", "go", "pq"], "comments": [{"owner": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 3, "creation_date": 1430109099, "post_id": 29887094, "comment_id": 47898313, "body": "The reason you get that particular error is that <code>=?</code> would be a valid PostgreSQL operator name. Use <code>id = ?</code>. But as mu says, it&#39;s likely also that Go doesn&#39;t use <code>?</code> as a placeholder."}], "answers": [{"comments": [{"owner": {"reputation": 1409, "user_id": 1461381, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/7e18406a6dc90f04bcc268cd12a9b222?s=128&d=identicon&r=PG", "display_name": "umezo", "link": "https://stackoverflow.com/users/1461381/umezo"}, "edited": false, "score": 1, "creation_date": 1430109580, "post_id": 29887236, "comment_id": 47898426, "body": "got it, thanks.  I didn&#39;t realize this, as the go docs for database/sql use the question mark. <a href=\"http://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#NullString</a>"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 3, "creation_date": 1430128768, "post_id": 29887236, "comment_id": 47908230, "body": "umezo: I&#39;m sure you&#39;ve already been there, but it&#39;s worth reading the documentation for your postgresql driver as well (and not only for the dollar issue): <a href=\"http://godoc.org/github.com/lib/pq\" rel=\"nofollow noreferrer\">godoc.org/github.com/lib/pq</a>"}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 18, "last_activity_date": 1430153250, "last_edit_date": 1430153250, "creation_date": 1430109036, "answer_id": 29887236, "question_id": 29887094, "link": "https://stackoverflow.com/questions/29887094/operator-does-not-exist-integer-when-using-postgres/29887236#29887236", "title": "&quot;Operator does not exist: integer =?&quot; when using Postgres", "body": "<p>PostgreSQL works with numbered placeholders (<code>$1</code>, <code>$2</code>, ...) natively rather than the usual positional question marks. The <a href=\"http://godoc.org/github.com/lib/pq\" rel=\"noreferrer\">documentation for the Go interface</a> also uses numbered placeholders in its examples:</p>\n\n<pre><code>rows, err := db.Query(\"SELECT name FROM users WHERE age = $1\", age)\n</code></pre>\n\n<p>Seems that the Go interface isn't translating the question marks to numbered placeholders the way many interfaces do so the question mark is getting all the way to the database and confusing everything.</p>\n\n<p>You should be able to switch to numbered placeholders instead of question marks:</p>\n\n<pre><code> row := db.QueryRow(\n    \"SELECT name FROM users WHERE id = $1\", id)\n</code></pre>\n"}], "owner": {"reputation": 1409, "user_id": 1461381, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/7e18406a6dc90f04bcc268cd12a9b222?s=128&d=identicon&r=PG", "display_name": "umezo", "link": "https://stackoverflow.com/users/1461381/umezo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6052, "favorite_count": 1, "accepted_answer_id": 29887236, "answer_count": 1, "score": 7, "last_activity_date": 1569139827, "creation_date": 1430108098, "last_edit_date": 1569139827, "question_id": 29887094, "link": "https://stackoverflow.com/questions/29887094/operator-does-not-exist-integer-when-using-postgres", "title": "&quot;Operator does not exist: integer =?&quot; when using Postgres", "body": "<p>I have a simple SQL query called within the QueryRow method provided by go's database/sql package.  </p>\n\n<pre><code>import (\n  \"github.com/codegangsta/martini\"\n  \"github.com/martini-contrib/render\"\n  \"net/http\"\n  \"database/sql\"\n  \"fmt\"\n  _ \"github.com/lib/pq\")\n)\n\ntype User struct {\n  Name string\n}\n\nfunc Show(db *sql.DB, params martini.Params) {\n  id := params[\"id\"]\n  row := db.QueryRow(\n    \"SELECT name FROM users WHERE id=?\", id)\n  u := User{}\n  err := row.Scan(&amp;u.Name)\n  fmt.Println(err)\n}\n</code></pre>\n\n<p>However, I'm getting the error <code>pq: operator does not exist: integer =?</code> It looks like the code doesn't understand that the <code>?</code> is just a placeholder. How can I fix this?</p>\n"}, {"tags": ["struct", "go"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1430105696, "post_id": 29886723, "comment_id": 47897396, "body": "Where is your implementation of <code>String()</code> ? Note that each time you alias a type it is a brand new type. Also, your struct and the interface have no relationship here - it appears you&#39;re trying to have your <code>Users</code> type implement the interface."}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1430106129, "post_id": 29886723, "comment_id": 47897507, "body": "Thanks for updating the question - your <code>String()</code> method is applied to the struct <code>User</code> ... not the type <code>Users</code> (plural ..)."}, {"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1430106338, "post_id": 29886723, "comment_id": 47897552, "body": "I fixed some goofs with my formatting and added a key additional method. Does it then make sense to implement my interface on Users? I guess I can see that but I am still not following why it doesn&#39;t work implementing this on User and having a collection of them."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430140769, "post_id": 29886723, "comment_id": 47916473, "body": "<a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">See the FAQ</a> &quot;Can I convert a []T to an []interface{}?&quot; (Just substitute your <code>[]users</code> and <code>[]Datatype</code> for the FAQ&#39;s <code>[]T</code> and <code>[]interface{}</code> and it&#39;s the same question.)"}], "answers": [{"comments": [{"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "edited": false, "score": 0, "creation_date": 1430106553, "post_id": 29886830, "comment_id": 47897618, "body": "Ah, ok. So that makes some sense now. So, how would you go about creating a single function that can return collections of different, but related, types? It is a fairly common scenario (basic polymorphism) that I am having trouble &quot;getting&quot; in go."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1430109021, "post_id": 29886830, "comment_id": 47898283, "body": "Just have your functions return a <code>[]Datatype</code>."}, {"owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "reply_to_user": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "edited": false, "score": 0, "creation_date": 1430149034, "post_id": 29886830, "comment_id": 47922774, "body": "@RockyMountainHigh: I don&#39;t know if covariance falls under &quot;basic polymorphism&quot;; there are many languages that have restrictions on covariance. Regardless . . . I&#39;d suggest simply returning a <code>[]Datatype</code> in all cases. (The <i>elements</i> of the <code>[]Datatype</code>, of course, can be <code>User</code>s.) In addition, you can also have a <i>separate</i>, type-specific method, that returns a slice of the narrower type."}], "tags": [], "owner": {"reputation": 155397, "user_id": 978917, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/92d059913eace78a868a3e87f98e0a57?s=128&d=identicon&r=PG", "display_name": "ruakh", "link": "https://stackoverflow.com/users/978917/ruakh"}, "is_accepted": true, "score": 8, "last_activity_date": 1430148897, "last_edit_date": 1495539813, "creation_date": 1430106303, "answer_id": 29886830, "question_id": 29886723, "link": "https://stackoverflow.com/questions/29886723/having-trouble-understanding-interface-struct-relationship/29886830#29886830", "title": "Having trouble understanding interface/struct relationship", "body": "<p>Slices are not covariant; even though <code>User</code> implements <code>Datatype</code>, <code>[]User</code> does not implement <code>[]Datatype</code> (because <em>nothing</em> implements <code>[]Datatype</code>: it itself is not an interface type, it's just a slice type whose element type is an interface type).</p>\n\n<hr>\n\n<p><strong>Edited to add:</strong> As <a href=\"https://stackoverflow.com/users/55504/dave-c\">Dave C</a> points out in a comment above, a closely-related question appears in the Go FAQ. [<a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">link</a>] The Go FAQ is licensed in a way that's compatible with Stack Exchange content, so, here's the question in its entirety:</p>\n\n<blockquote>\n  <p><strong>Can I convert a []T to an []interface{}?</strong></p>\n  \n  <p>Not directly, because they do not have the same representation in memory. It is necessary to copy the elements individually to the destination slice. This example converts a slice of <code>int</code> to a slice of <code>interface{}</code>:</p>\n\n<pre><code>t := []int{1, 2, 3, 4}\ns := make([]interface{}, len(t))\nfor i, v := range t {\n    s[i] = v\n}\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 0, "accepted_answer_id": 29886830, "answer_count": 1, "score": 2, "last_activity_date": 1541000747, "creation_date": 1430105552, "last_edit_date": 1541000747, "question_id": 29886723, "link": "https://stackoverflow.com/questions/29886723/having-trouble-understanding-interface-struct-relationship", "title": "Having trouble understanding interface/struct relationship", "body": "<p>I am having difficulty understanding the relationship between interfaces and structs in go. I have declared an interface called <code>Datatype</code> as follows:</p>\n\n<pre><code>package main\n\ntype Datatype interface {\n    Unmarshal(record []string) error\n    String() string\n}\n</code></pre>\n\n<p>I have also created several structs that implement this interface. Here is one simple example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"gopkg.in/validator.v2\"\n    \"reflect\"\n    \"strconv\"\n    \"time\"\n)\n\ntype User struct {\n    Username      string `validate:\"nonzero\"`\n    UserId        string `validate:\"nonzero\"`\n    GivenName     string `validate:\"nonzero\"`\n    FamilyName    string `validate:\"nonzero\"`\n    Email         string `validate:\"regexp=^[0-9a-zA-Z]+@[0-9a-zA-Z]+(\\\\.[0-9a-zA-Z]+)+$\"`\n    SMS           string `validate:\"nonzero\"`\n    Phone         string `validate:\"min=10\"`\n    DateOfBirth   time.Time\n}\n\ntype Users []User\n\nfunc (u *User) Unmarshal(record []string) error {\n    s := reflect.ValueOf(u).Elem()\n    if s.NumField() != len(record) {\n        return &amp;FieldMismatch{s.NumField(), len(record)}\n    }\n    for i := 0; i &amp;gt; s.NumField(); i++ {\n        f := s.Field(i)\n        switch f.Type().String() {\n        case \"string\":\n            f.SetString(record[i])\n        case \"int\", \"int64\":\n            ival, err := strconv.ParseInt(record[i], 10, 0)\n            if err != nil {\n                return err\n            }\n            f.SetInt(ival)\n        default:\n            return &amp;UnsupportedType{f.Type().String()}\n        }\n    }\n    return nil\n}\n\nfunc (u *User) String() string {\n    return fmt.Sprintf(\"%#v\", u)\n}\n\nfunc (u *User) populateFrom(reader *csv.Reader) (Users, error) {\n    var users Users\n    for {\n        record, err := reader.Read()\n        check(err)\n        err = u.Unmarshal(record)\n        check(err)\n        valid := validator.Validate(u)\n        if valid == nil {\n            user := *u\n            users = append(users, user)\n        } else {\n            fmt.Println(\"Validation error?: \", valid)\n        }\n    }\n    return users, nil\n}\n</code></pre>\n\n<p><strong>Problem:</strong></p>\n\n<p>As you can see, I also have a type called <code>Users</code> which is just <code>[]User</code>. When I try to return this type from a function that has a return type of <code>[]Datatype</code>, I get the following error message:</p>\n\n<blockquote>\n  <p>cannot use results (type Users) as type []Datatype in return argument</p>\n</blockquote>\n\n<p>I'm sure I'm missing something obvious but it seems to me that this should work. </p>\n\n<p><strong>Question:</strong></p>\n\n<p>Could someone please explain why it does not work? Is there a better (more idiomatic) way to achieve this end result?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1470645667, "post_id": 29888449, "comment_id": 65015362, "body": "Why channels? In the docs the <code>PropertyLoadSaver</code> interface operates with slices?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1470646102, "post_id": 29888449, "comment_id": 65015582, "body": "@AlexanderTrakhimenok There are 2 APIs. The one with import path <code>appengine&#47;datastore</code> uses channels as arguments. The other with import path <code>google.golang.org&#47;appengine&#47;datastore</code> uses slices. Adjust the example above to your case. Edited the answer."}, {"owner": {"reputation": 736, "user_id": 399891, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fef945ce32f1f052bdd5f7f771429208?s=128&d=identicon&r=PG", "display_name": "Gubbi", "link": "https://stackoverflow.com/users/399891/gubbi"}, "edited": false, "score": 0, "creation_date": 1481779667, "post_id": 29888449, "comment_id": 69515453, "body": "Will this handle nested objects? i.e., can p.Value be another DynEnt?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 736, "user_id": 399891, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fef945ce32f1f052bdd5f7f771429208?s=128&d=identicon&r=PG", "display_name": "Gubbi", "link": "https://stackoverflow.com/users/399891/gubbi"}, "edited": false, "score": 0, "creation_date": 1481794852, "post_id": 29888449, "comment_id": 69522640, "body": "@Gubbi The datastore entities are &quot;flat&quot; (no nesting), so there is no point trying to save a nested <code>DynEnt</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1556884985, "last_edit_date": 1556884985, "creation_date": 1430115284, "answer_id": 29888449, "question_id": 29885431, "link": "https://stackoverflow.com/questions/29885431/how-can-i-have-dynamic-properties-in-go-on-the-google-app-engine-datastore/29888449#29888449", "title": "How can I have dynamic properties in go on the google app engine datastore", "body": "<p><strong>Note beforehand:</strong></p>\n\n<p>There are 2 APIs. The one with import path <code>appengine/datastore</code> uses channels as arguments. The other with import path <code>google.golang.org/appengine/datastore</code> uses slices. Adjust the example below to your case. See this question for details: <a href=\"https://stackoverflow.com/questions/32271148/how-to-correctly-import-golang-appengine\">How to correctly import Golang appengine?</a></p>\n\n<hr>\n\n<p>The key to an entity with dynamic properties is the <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#PropertyLoadSaver\" rel=\"nofollow noreferrer\"><code>PropertyLoadSaver</code></a> interface. By implementing this interface you can dynamically - at save time - construct the properties of the entity to be saved.</p>\n\n<p>Also to not have to do this yourself the Go AppEngine platform provides a <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#PropertyList\" rel=\"nofollow noreferrer\"><code>PropertyList</code></a> type which is basically a list (a slice) of properties <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#Property\" rel=\"nofollow noreferrer\"><code>Property</code></a> and it also implements <code>PropertyLoadSaver</code>.</p>\n\n<p>So the Expando model in Go is <code>PropertyList</code>. Just add the properties you want your entity to have, and save this <code>PropertyList</code> value.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>c := appengine.NewContext(r)\n\nprops := datastore.PropertyList{\n    datastore.Property{Name: \"time\", Value: time.Now()},\n    datastore.Property{Name: \"email\", Value: \"me@myhost.com\"},\n}\n\nk := datastore.NewIncompleteKey(c, \"DynEntity\", nil)\nkey, err := datastore.Put(c, k, &amp;props)\nc.Infof(\"%v %v\", key, err)\n</code></pre>\n\n<p>This example saves an entity named <code>\"DynEntity\"</code> with 2 dynamic properties: <code>\"time\"</code> and <code>\"email\"</code>.</p>\n\n<p>As the <code>PropertyList</code> type is a slice, you can also use the builtin <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\"><code>append()</code></a> function to add properties to it, so you could also initialize <code>props</code> like this:</p>\n\n<pre><code>var props datastore.PropertyList\nprops = append(props, datastore.Property{Name:\"time\", Value: time.Now()})\nprops = append(props, datastore.Property{Name:\"email\", Value: \"me@myhost.com\"})\n</code></pre>\n\n<h2>Turning a <code>map</code> into a dynamic entity</h2>\n\n<p>The <code>PropertyLoadSaver</code> interface is not complicated, we can implement it ourselves. In the following example I implement it on a custom type which is a simple <code>map</code>:</p>\n\n<pre><code>type DynEnt map[string]interface{}\n\nfunc (d *DynEnt) Load(props []datastore.Property) error {\n    // Note: you might want to clear current values from the map or create a new map\n    for _, p := range props {\n        (*d)[p.Name] = p.Value\n    }\n    return nil\n}\n\nfunc (d *DynEnt) Save() (props []datastore.Property, err error) {\n    for k, v := range *d {\n        props = append(props, datastore.Property{Name: k, Value: v})\n    }\n    return\n}\n</code></pre>\n\n<p>Here's how the implementation would look like with the \"old\" interface that used channels instead of slices:</p>\n\n<pre><code>type DynEnt map[string]interface{}\n\nfunc (d *DynEnt) Load(ch &lt;-chan datastore.Property) error {\n    // Note: you might want to clear current values from the map or create a new map\n    for p := range ch { // Read until channel is closed\n        (*d)[p.Name] = p.Value\n    }\n    return nil\n}\n\nfunc (d *DynEnt) Save(ch chan&lt;- datastore.Property) error {\n    defer close(ch) // Channel must be closed\n    for k, v := range *d {\n        ch &lt;- datastore.Property{Name: k, Value: v}\n    }\n    return nil\n}\n</code></pre>\n\n<p>Now we can use our <code>DynEnt</code> type just like any other maps in Go, and since it implements <code>PropertyLoadSaver</code>, it can be saved as an entity (and <em>any</em> entities can be loaded into it):</p>\n\n<pre><code>c := appengine.NewContext(r)\n\nd := DynEnt{\"email\": \"me@myhost.com\", \"time\": time.Now()}\n\nk := datastore.NewIncompleteKey(c, \"DynEntity\", nil)\nkey, err := datastore.Put(c, k, &amp;d)\nc.Infof(\"%v %v\", key, err)\n</code></pre>\n"}], "owner": {"reputation": 10167, "user_id": 46505, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d3c1b61ef7ad0da5162130ca0f3a8aea?s=128&d=identicon&r=PG", "display_name": "jshen", "link": "https://stackoverflow.com/users/46505/jshen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1542, "favorite_count": 3, "accepted_answer_id": 29888449, "answer_count": 1, "score": 4, "last_activity_date": 1556884985, "creation_date": 1430095444, "last_edit_date": 1475280648, "question_id": 29885431, "link": "https://stackoverflow.com/questions/29885431/how-can-i-have-dynamic-properties-in-go-on-the-google-app-engine-datastore", "title": "How can I have dynamic properties in go on the google app engine datastore", "body": "<p>I want to do something like the <a href=\"https://developers.google.com/appengine/docs/python/ndb/entities#expando\" rel=\"nofollow\">Expando Model</a> that python supports on app engine. </p>\n\n<blockquote>\n  <p>Sometimes you don't want to declare your properties ahead of time. A\n  special model subclass, Expando, changes the behavior of its entities\n  so that any attribute assigned (as long as it doesn't start with an\n  underscore) is saved to the Datastore.</p>\n</blockquote>\n\n<p>How can I do this in Go?</p>\n"}, {"tags": ["go", "profiling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430094263, "post_id": 29885199, "comment_id": 47894629, "body": "are you using osx? <a href=\"https://godoc.org/rsc.io/pprof_mac_fix\" rel=\"nofollow noreferrer\">godoc.org/rsc.io/pprof_mac_fix</a>"}, {"owner": {"reputation": 777, "user_id": 227168, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/58c7e3f8e966e0a1ed220dd2edef71b7?s=128&d=identicon&r=PG&f=1", "display_name": "Dieter_be", "link": "https://stackoverflow.com/users/227168/dieter-be"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430096290, "post_id": 29885199, "comment_id": 47895094, "body": "No, Arch Linux 3.18 64bit"}], "answers": [{"tags": [], "owner": {"reputation": 20642, "user_id": 51233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c92da37f356622a97ff8a2bfe3d4d962?s=128&d=identicon&r=PG", "display_name": "Jeremy Wall", "link": "https://stackoverflow.com/users/51233/jeremy-wall"}, "is_accepted": false, "score": 7, "last_activity_date": 1430105185, "creation_date": 1430105185, "answer_id": 29886670, "question_id": 29885199, "link": "https://stackoverflow.com/questions/29885199/how-can-i-see-where-runtime-futex-is-coming-from-it-only-has-system-as-parent/29886670#29886670", "title": "How can I see where runtime.futex is coming from? It only has &quot;System&quot; as parent", "body": "<p>A futex or \"Fast user space mutex\" is a linux system call that is used for basic locking. I imagine the go runtime uses it quite a bit under the hood.</p>\n\n<p>Without seeing some of the code it's hard to say for sure but for highly concurrent code with a lot of coordination using channels it's possible that the futex calls really are coming from System and no particular function.</p>\n"}, {"comments": [{"owner": {"reputation": 51, "user_id": 4240999, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001967622581/picture?type=large", "display_name": "Thiago Ruiz", "link": "https://stackoverflow.com/users/4240999/thiago-ruiz"}, "edited": false, "score": 0, "creation_date": 1609188761, "post_id": 59242611, "comment_id": 115773003, "body": "That was exactly my problem. Thank you"}], "tags": [], "owner": {"reputation": 7907, "user_id": 1592008, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e208220f7cb95e6854adb653663736a?s=128&d=identicon&r=PG", "display_name": "Oleg Neumyvakin", "link": "https://stackoverflow.com/users/1592008/oleg-neumyvakin"}, "is_accepted": false, "score": 3, "last_activity_date": 1610193369, "last_edit_date": 1610193369, "creation_date": 1575866336, "answer_id": 59242611, "question_id": 29885199, "link": "https://stackoverflow.com/questions/29885199/how-can-i-see-where-runtime-futex-is-coming-from-it-only-has-system-as-parent/59242611#59242611", "title": "How can I see where runtime.futex is coming from? It only has &quot;System&quot; as parent", "body": "<p>When I've faced with such issue I've used <code>runtime/trace</code> where I've see that some function was called very often and this function creates new ticker by</p>\n<pre><code>ticker := time.NewTicker()\n</code></pre>\n<p>but does not stop it by</p>\n<pre><code>defer ticker.Stop()\n</code></pre>\n<p>Also, don't forget to stop timers as well:</p>\n<pre><code>timer := time.NewTimer(duration)\ndefer timer.Stop()\n</code></pre>\n"}], "owner": {"reputation": 777, "user_id": 227168, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/58c7e3f8e966e0a1ed220dd2edef71b7?s=128&d=identicon&r=PG&f=1", "display_name": "Dieter_be", "link": "https://stackoverflow.com/users/227168/dieter-be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5933, "favorite_count": 1, "answer_count": 2, "score": 10, "last_activity_date": 1610193369, "creation_date": 1430093467, "last_edit_date": 1540252380, "question_id": 29885199, "link": "https://stackoverflow.com/questions/29885199/how-can-i-see-where-runtime-futex-is-coming-from-it-only-has-system-as-parent", "title": "How can I see where runtime.futex is coming from? It only has &quot;System&quot; as parent", "body": "<p>Running <code>go tool pprof</code> with a cpu profile for <a href=\"https://github.com/vimeo/statsdaemon\" rel=\"noreferrer\">https://github.com/vimeo/statsdaemon</a> and typing \"<em>web</em>\" I get an svg profile with extensive use of \"<em>runtime.futex</em>\". But I can't see where it's coming from, it just says \"<em>System</em>\".</p>\n\n<p>I want to know which code my program invokes, that causes so much time spent in <code>runtime.futex</code>.</p>\n\n<p><img src=\"https://i.stack.imgur.com/VFYBY.png\" alt=\"profile screenshot\"></p>\n\n<p>To be sure I passed <code>'-nodefraction=0'</code> which makes it not drop nodes in the web svg view, though it says \"<em>showing top 80 nodes out of 246 (cum >= 0.11s)</em>\", maybe this is related.</p>\n\n<p>I tried <a href=\"https://code.google.com/p/gperftools/\" rel=\"noreferrer\">https://code.google.com/p/gperftools/</a> and it shows the same.\nThe viz drops no nodes or edges, but still \"runtime.futex\" just shows up under \"<em>System</em>\" and that's the root node?</p>\n"}, {"tags": ["xml", "go", "xml-parsing"], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "edited": false, "score": 0, "creation_date": 1430178360, "post_id": 29884478, "comment_id": 47938160, "body": "Thank you @kjhughes, that&#39;s a very comprehensive answer."}, {"owner": {"reputation": 597, "user_id": 5950152, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bc7fc6d1853966d6c782b11d344ea51e?s=128&d=identicon&r=PG&f=1", "display_name": "Weckar E.", "link": "https://stackoverflow.com/users/5950152/weckar-e"}, "edited": false, "score": 0, "creation_date": 1499945487, "post_id": 29884478, "comment_id": 77130961, "body": "Does this mean an XSD that allows &#39;no content&#39; but is typed will allow an empty element tag?"}, {"owner": {"reputation": 88945, "user_id": 290085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306077a2fb7af6587f470214a1b337ff?s=128&d=identicon&r=PG", "display_name": "kjhughes", "link": "https://stackoverflow.com/users/290085/kjhughes"}, "reply_to_user": {"reputation": 597, "user_id": 5950152, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bc7fc6d1853966d6c782b11d344ea51e?s=128&d=identicon&r=PG&f=1", "display_name": "Weckar E.", "link": "https://stackoverflow.com/users/5950152/weckar-e"}, "edited": false, "score": 1, "creation_date": 1499949071, "post_id": 29884478, "comment_id": 77133755, "body": "@WeckarE., it means that an XSD cannot impose a constraint that differentiates between an empty element (<code>&lt;e&#47;&gt;</code>) and one with no content and an end tag (<code>&lt;e&gt;&lt;&#47;e&gt;</code>)."}], "tags": [], "owner": {"reputation": 88945, "user_id": 290085, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/306077a2fb7af6587f470214a1b337ff?s=128&d=identicon&r=PG", "display_name": "kjhughes", "link": "https://stackoverflow.com/users/290085/kjhughes"}, "is_accepted": true, "score": 4, "last_activity_date": 1430134356, "last_edit_date": 1430134356, "creation_date": 1430088230, "answer_id": 29884478, "question_id": 29884177, "link": "https://stackoverflow.com/questions/29884177/create-xml-element-without-closing-tag/29884478#29884478", "title": "Create XML element without closing tag", "body": "<p>There is no difference at the XML level between an <strong><em>element with no content and an <a href=\"http://www.w3.org/TR/xml/#NT-ETag\" rel=\"nofollow\">end-tag</a></em></strong>:</p>\n\n<pre><code>&lt;soapenv:Header&gt;&lt;/soapenv:Header&gt;\n</code></pre>\n\n<p>and an <strong><em><a href=\"http://www.w3.org/TR/xml/#NT-EmptyElemTag\" rel=\"nofollow\">empty element tag</a></em></strong>:</p>\n\n<pre><code>&lt;soapenv:Header/&gt;\n</code></pre>\n\n<p><strong>To control which form is used, you'd have to treat the data as text rather than as XML, but better not to worry about a difference that makes no difference.</strong></p>\n\n<hr>\n\n<p>[Added for completeness]</p>\n\n<p>...other than an obscure and antiquated <a href=\"http://www.w3.org/TR/xml/#d0e2480\" rel=\"nofollow\">recommendation</a></p>\n\n<blockquote>\n  <p><a href=\"http://www.w3.org/TR/xml/#dt-interop\" rel=\"nofollow\">For interoperability</a>, the empty-element tag should be used, and should\n  only be used, for elements which are declared EMPTY.</p>\n</blockquote>\n\n<p>regarding interoperability with SGML:</p>\n\n<blockquote>\n  <p><strong>for interoperability</strong></p>\n  \n  <p>[Definition: Marks a sentence describing a non-binding recommendation\n  included to increase the chances that XML documents can be processed\n  by the existing installed base of SGML processors which predate the\n  WebSGML Adaptations Annex to ISO 8879.]</p>\n</blockquote>\n"}], "owner": {"reputation": 105, "user_id": 4351140, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/495033571f7143f953f6a3935ba86756?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian J", "link": "https://stackoverflow.com/users/4351140/sebastian-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2035, "favorite_count": 1, "accepted_answer_id": 29884478, "answer_count": 1, "score": 1, "last_activity_date": 1430134356, "creation_date": 1430086189, "last_edit_date": 1430134195, "question_id": 29884177, "link": "https://stackoverflow.com/questions/29884177/create-xml-element-without-closing-tag", "title": "Create XML element without closing tag", "body": "<p>I have this nested golang struct:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>// TierRequest is the outer most XML envelope of soap request\ntype TierRequest struct {\n    XMLName   xml.Name `xml:\"soapenv:Envelope\"`\n    NsEnv     string   `xml:\"xmlns:soapenv,attr\"`\n    NsType    string   `xml:\"xmlns:typ,attr\"`\n    Header    string   `xml:\"soapenv:Header\"`\n\n// TierBody is an emtpy container with the GetCollectorProfile struct\ntype TierBody struct {\n    GetCollectorProfiles GetCollectorProfile `Collectorxml:\"typ:GetCollectorProfileRequest\"`\n}\n\n// GetCollectorProfile struct has the context and collector number\ntype GetCollectorProfile struct {\n    Contexts CollectorContext `xml:\"typ:Context\"`\n    Number   int              `xml:\"typ:CollectorNumber\"`\n}\n\n// CollectorContext contanins a few variables as attributes\ntype CollectorContext struct {\n    Channel  string `xml:\"Channel,attr\"`\n    Source   string `xml:\"Source,attr\"`\n    Language string `xml:\"LanguageCode,attr\"`\n}\n</code></pre>\n\n<p>When I initialize it with values and marshal with <code>encoding/xml</code> it comes to look like this:</p>\n\n<pre><code>&lt;soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\n                  xmlns:typ=\"http:/www.yahoo.com/tp/ets/2008/04/01/collector/types\"&gt;\n  &lt;soapenv:Header&gt;&lt;/soapenv:Header&gt;\n  &lt;soapenv:Body&gt;\n    &lt;GetCollectorProfiles&gt;\n      &lt;typ:Context Channel=\"WEB\" Source=\"WEB\" LanguageCode=\"en-CA\"&gt;&lt;/typ:Context&gt;\n      &lt;typ:CollectorNumber&gt;50000&lt;/typ:CollectorNumber&gt;\n    &lt;/GetCollectorProfiles&gt;\n  &lt;/soapenv:Body&gt;\n&lt;/soapenv:Envelope&gt;\n</code></pre>\n\n<p>How I can get rid of the closing tags for <code>soapenv:Header</code> and <code>typ:Context</code>, so it just looks like <code>&lt;soapenv:Header/&gt;</code>?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3615, "user_id": 4725175, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/10206540408857078/picture?type=large", "display_name": "Jakob Svenningsson", "link": "https://stackoverflow.com/users/4725175/jakob-svenningsson"}, "edited": false, "score": 0, "creation_date": 1430076999, "post_id": 29882299, "comment_id": 47889037, "body": "The thing is. My for loop is dependent on that an EOF will happen eventually. Thats how i tell my loop that the entire document has been scanned."}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "reply_to_user": {"reputation": 3615, "user_id": 4725175, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/10206540408857078/picture?type=large", "display_name": "Jakob Svenningsson", "link": "https://stackoverflow.com/users/4725175/jakob-svenningsson"}, "edited": false, "score": 0, "creation_date": 1430079997, "post_id": 29882299, "comment_id": 47890156, "body": "The second option I provided will (now that it&#39;s edited) do that - print the last line and then exit the loop."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 0, "last_activity_date": 1430079919, "last_edit_date": 1430079919, "creation_date": 1430075746, "answer_id": 29882299, "question_id": 29882117, "link": "https://stackoverflow.com/questions/29882117/read-lines-from-text-file-in-go-with-bufio-reader/29882299#29882299", "title": "Read lines from text file in go, with bufio.reader", "body": "<p>From the <a href=\"https://golang.org/pkg/bufio/#Reader.Read\" rel=\"nofollow\">bufio docs</a>:</p>\n\n<blockquote>\n  <p>At EOF, the count will be zero and err will be io.EOF</p>\n</blockquote>\n\n<p>So you can simply test for that. Like change your <code>if err != nil</code> to <code>if err != nil &amp;&amp; err != io.EOF</code></p>\n\n<p>or </p>\n\n<pre><code>if err == io.EOF {\n    fmt.Println(v, w, cost)\n    break\n}\nif err != nil {\n    break\n}\nfmt.Println(v, w, cost)\n</code></pre>\n\n<p>Though you really should do something with the error and not just ignore it.</p>\n"}, {"tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 1, "last_activity_date": 1430112372, "creation_date": 1430112372, "answer_id": 29887820, "question_id": 29882117, "link": "https://stackoverflow.com/questions/29882117/read-lines-from-text-file-in-go-with-bufio-reader/29887820#29887820", "title": "Read lines from text file in go, with bufio.reader", "body": "<p>I guess there is no new line in the last row in your file and it's simply ending with <code>EOF</code>. It his correct? As a result, the very last column is not being parsed correctly, as it doesn't end with an expected character (<code>\\n</code>).</p>\n\n<p>You didn't show us exactly how you're using <code>bufio.Reader</code>, but either way you will need to account for missing new line at the end of file (it's up to you whether treat it as an error or not). Using methods like <code>bufio.Reader.ReadString</code> with <code>\\n</code> delimiter won't treat <code>EOF</code> as the end-of-line automatically, but will return you a valid content along with <code>EOF</code> (i.e. you can get both data and error at the same call \u2013 note this is a different behaviour than in <code>bufio.Reader.Read</code>).</p>\n\n<p>Saying this, it might be beneficial for you to use the <a href=\"http://golang.org/pkg/encoding/csv/\" rel=\"nofollow\"><code>csv</code></a> package instead. It will solve the <code>EOF</code> problem and you could also benefit from some nicer error messages on unexpected number of columns. The additional features like comments or quotes might be good or bad for your purposes.</p>\n\n<p><a href=\"https://play.golang.org/p/emFblKknGu\" rel=\"nofollow\">Example:</a></p>\n\n<pre><code>// No line break at the end, pure EOF (still works)\ndata := \"one 1\\ntwo 2\\nthree 3\\nfour 4\"\n\n// You can wrap your file reader with bufio.Reader here\ncr := csv.NewReader(bytes.NewReader([]byte(data)))\ncr.Comma = ' '\ncr.FieldsPerRecord = 2\n\nvar err error\nfor err == nil {\n    var columns []string\n    if columns, err = cr.Read(); err == nil {\n        fmt.Println(columns)\n        // err = processRow(columns)\n    }\n}\nif err != io.EOF {\n    // Parse error\n    panic(err)\n}   \n</code></pre>\n"}], "owner": {"reputation": 3615, "user_id": 4725175, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/10206540408857078/picture?type=large", "display_name": "Jakob Svenningsson", "link": "https://stackoverflow.com/users/4725175/jakob-svenningsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 625, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1430112372, "creation_date": 1430074897, "last_edit_date": 1430074945, "question_id": 29882117, "link": "https://stackoverflow.com/questions/29882117/read-lines-from-text-file-in-go-with-bufio-reader", "title": "Read lines from text file in go, with bufio.reader", "body": "<pre><code>for {\n    v, err = nextNum(reader, ' ')\n    if err != nil {\n        break\n    }\n    w, err = nextNum(reader, ' ')\n    if err != nil {\n        break\n    }\n    cost, err = nextNum(reader, '\\n')\n    if err != nil {\n        break\n    }\n    fmt.Println(v, w, cost)\n}\n</code></pre>\n\n<p>My text file consists of three coloumns and n rows. The first time nextNum is called the number in the first row and first column will be returned, next time the number in the second column and first row, and so on. My problem is when i get to the end and i call nextNum for the last time then i will recieve an EOF error and the last line will never get printed out, becuase break will be called before. Any suggestions on how to solve the problem?</p>\n\n<p>CHeers</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "edited": false, "score": 0, "creation_date": 1430078205, "post_id": 29882044, "comment_id": 47889518, "body": "How are you writing your geopoints to the database?  Are you using <code>binary.Write</code>?  Hard to tell what&#39;s going on without this.  The code of <code>GeoPoint.Value()</code> suggests that you&#39;re using some kind of arbitrary human-friendly string representation.  If that&#39;s the case, then <code>binary.Read</code> won&#39;t be an appropriate way to deserialize that representation."}, {"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "reply_to_user": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "edited": false, "score": 0, "creation_date": 1430079542, "post_id": 29882044, "comment_id": 47889986, "body": "That makes sense and after just casting the []byte array to a string it works.   This is what happens when you blindly follow someone else&#39;s example.  If you want to add your comment as an answer that would be awesome.  Thanks for the help."}, {"owner": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "edited": false, "score": 0, "creation_date": 1430079612, "post_id": 29882044, "comment_id": 47890008, "body": "Uh... please add test cases.  If all you&#39;ve done is add some arbitrary casts from bytes to strings, you&#39;ve made a huge conceptual mistake."}], "answers": [{"comments": [{"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "edited": false, "score": 1, "creation_date": 1430105588, "post_id": 29883027, "comment_id": 47897368, "body": "You are right that the Valuer and Scanner were incompatible.  However from the postgres[1] docs it accepts (x, y) and the format for points, so I don&#39;t think I want to save the whole GeoPoint struct, but rather just the (x, y) coords. When using this approach the Scan method seems a little dirty since it has to parse out the lat, lng values from a &quot;(lat,lng)&quot; string, but it does work.  When trying to implement what you suggested point values of (0,0) were always saved.  1. <a href=\"http://www.postgresql.org/docs/8.4/static/datatype-geometric.html\" rel=\"nofollow noreferrer\">postgresql.org/docs/8.4/static/datatype-geometric.html</a>"}, {"owner": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "reply_to_user": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "edited": false, "score": 0, "creation_date": 1430114552, "post_id": 29883027, "comment_id": 47900243, "body": "Sure, yes.  That&#39;s related to your database schema.  If the type of <code>accounts.location</code> is of postgres type <code>point</code>, then yes, what you&#39;re doing sounds reasonable.  Without the schema in hand, all I could say was that <code>Value</code> and <code>Scan</code> needed to match.  If the underlying type in the database were  a binary data type, like <code>bytea</code>, that&#39;d be a factor."}], "tags": [], "owner": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "is_accepted": false, "score": 1, "last_activity_date": 1430081095, "last_edit_date": 1430081095, "creation_date": 1430079545, "answer_id": 29883027, "question_id": 29882044, "link": "https://stackoverflow.com/questions/29882044/sqlx-postgres-scan-method-fail/29883027#29883027", "title": "sqlx postgres scan method fail", "body": "<p>The GeoPoint implementation of <code>Scanner</code> and <code>Valuer</code> interfaces looks questionable.  They should be symmetric, but in one case, it represents the GeoPoint as a arbitrary-variable-length string of the form:</p>\n\n<pre><code>\"(&lt;latitude&gt;, &lt;longitude&gt;)\"\n</code></pre>\n\n<p>but in the other direction, expects a representation of exactly 16 bytes (two 64-bit floats in big-endian byte order).  This does not seem compatible.</p>\n\n<p>Have you tested that the output value of <code>Value()</code> can be fed back into <code>Scan()</code> to get the same value?  Essentially, you should be able to do:</p>\n\n<pre><code>p1 := GeoPoint{3.1415926, 2.71828}\nbs, _ := p1.Value()\np2 := GeoPoint{}\np2.Scan(bs)\nfmt.Printf(\"%#v\\n\", p2) \n</code></pre>\n\n<p>and see the same value in <code>p2</code> as in <code>p1</code>.</p>\n\n<p>For example, something like:</p>\n\n<pre><code>// Value of the geoPoint to be stored in the db\nfunc (g *GeoPoint) Value() (driver.Value, error) {\n    var buf bytes.Buffer\n    binary.Write(&amp;buf, binary.BigEndian, g)\n    return buf.Bytes(), nil\n}\n\n// Scan converts the db []byte array value to the geoPoint value\nfunc (g *GeoPoint) Scan(src interface{}) error {\n    var source []byte\n    switch src.(type) {\n    case []byte:\n        source = src.([]byte)\n    default:\n        return errors.New(\"Unable to perform geopoint conversion\")\n    }\n    reader := bytes.NewReader(source)\n    return binary.Read(reader, binary.BigEndian, g)\n}\n</code></pre>\n\n<p>should satisfy this property.  <code>Scan()</code> and <code>Value()</code> have to be conceptually consistent: otherwise, they wouldn't be useful.</p>\n"}], "owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1430081095, "creation_date": 1430074556, "question_id": 29882044, "link": "https://stackoverflow.com/questions/29882044/sqlx-postgres-scan-method-fail", "title": "sqlx postgres scan method fail", "body": "<p>I am trying to perform a postgres query that contains a custom geoPoint type but get a Unexpected EOF error.  Any ideas to what I am doing wrong? </p>\n\n<pre><code>type Account struct {\n    Id             uint   `json:\"id\" db:\"id\"`\n    RegistrationId string `json:\"registration_id\" db:\"registration_id\"`\n    PhoneNumber    string `json:\"phone_number\" db:\"phone_number\"`\n    AuthToken      string `json:\"auth_token\" db:\"auth_token\"`\n    // Role           string `json:\"-\" db:\"role\"`\n    CreatedAt   time.Time `json:\"-\" db:\"created_at\"`\n    ActivatedAt time.Time `json:\"-\" db:\"activated_at\"`\n\n    Location GeoPoint `json:\"location\" db:\"location\"`\n}\n\n// THE FAILING FUNCTION\nfunc FindAccountByToken(db *sqlx.DB, token string) (Account, error) {\n    var account Account\n    log.Println(\"FindAcountByToken\", token)\n    err := db.Get(&amp;account, \"select * from accounts where auth_token = $1\", token)\n    return account, err\n}\n\ntype GeoPoint struct {\n    Latitude  float64 `json:\"latitude\" db:\"latitude\"`\n    Longitude float64 `json:\"longitude\" db:\"longitude\"`\n}\n\n// String value\nfunc (g *GeoPoint) String() string {\n    return fmt.Sprintf(\"(%v, %v)\", g.Latitude, g.Longitude)\n}\n\n// Value of the geoPoint to be stored in the db based on the .String() method\nfunc (g GeoPoint) Value() (driver.Value, error) {\n    return g.String(), nil\n}\n\n// Scan converts the db []byte array value to the geoPoint value\nfunc (g *GeoPoint) Scan(src interface{}) error {\n    var source []byte\n    var gp GeoPoint\n\n    switch src.(type) {\n    case []byte:\n        source = src.([]byte)\n    default:\n        return errors.New(\"Unable to perform geopoint conversion\")\n    }\n\n    log.Println(\"bytes -&gt; \", source)\n\n    reader := bytes.NewReader(source)\n    if err := binary.Read(reader, binary.BigEndian, &amp;gp); err != nil {\n        log.Println(\"BinaryRead Error\", err)\n        return err\n    }\n\n    *g = gp\n\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "overflow"], "comments": [{"owner": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 1, "creation_date": 1430064582, "post_id": 29880038, "comment_id": 47884232, "body": "I have a hacky solution for you, instead of iterating up to <code>max</code> inclusive, iterate up to <code>max</code> exclusive. This way an overflow is never reached."}, {"owner": {"reputation": 3563, "user_id": 836097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e0fa7cc4752b302df71ac7fa7de9188?s=128&d=identicon&r=PG", "display_name": "Vlad Didenko", "link": "https://stackoverflow.com/users/836097/vlad-didenko"}, "reply_to_user": {"reputation": 245145, "user_id": 1348195, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f6dca2295546af21e1cde8e68f2d49bd?s=128&d=identicon&r=PG", "display_name": "Benjamin Gruenbaum", "link": "https://stackoverflow.com/users/1348195/benjamin-gruenbaum"}, "edited": false, "score": 0, "creation_date": 1430077453, "post_id": 29880038, "comment_id": 47889214, "body": "I gather this is the style you suggest? <a href=\"https://gist.githubusercontent.com/didenko/ed5144f6349656c683dc/raw/3a4b2d1c565819f54604a97409e6b6b0d0fe50b8/max_special.go\" rel=\"nofollow noreferrer\">gist.githubusercontent.com/didenko/ed5144f6349656c683dc/raw/&zwnj;&#8203;&hellip;</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1430080312, "post_id": 29880038, "comment_id": 47890254, "body": "@VladDidenko: What output do you get for <code>iter(42, 7)</code>? <a href=\"https://gist.githubusercontent.com/didenko/ed5144f6349656c683dc/raw/3a4b2d1c565819f54604a97409e6b6b0d0fe50b8/max_special.go\" rel=\"nofollow noreferrer\">gist.githubusercontent.com/didenko/ed5144f6349656c683dc/raw/&zwnj;&#8203;&hellip;</a>"}, {"owner": {"reputation": 3563, "user_id": 836097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e0fa7cc4752b302df71ac7fa7de9188?s=128&d=identicon&r=PG", "display_name": "Vlad Didenko", "link": "https://stackoverflow.com/users/836097/vlad-didenko"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1430080785, "post_id": 29880038, "comment_id": 47890401, "body": "@peterSO argh you are right, more cruft to get rid of the hanging max run. Not worth it."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1430141379, "post_id": 29880038, "comment_id": 47916961, "body": "BTW, as mentioned in the answers below, the cleanest (for <code>uint8</code> or <code>uint16</code> inputs) is to just convert to <code>uint</code> (instead of <code>uint32</code>!, if you&#39;re going to convert you may as well use the native integer size). Especially if you don&#39;t need to use the index the as an <code>uint8</code> within the loop that will probably also be the fastest."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430073416, "post_id": 29880389, "comment_id": 47887670, "body": "Note in the later case you need to make sure not to use <code>continue</code> before the conditional. Also the <code>for</code> condition becomes redundant so just <code>for i := min; ; i++ {</code> if you like."}, {"owner": {"reputation": 3563, "user_id": 836097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e0fa7cc4752b302df71ac7fa7de9188?s=128&d=identicon&r=PG", "display_name": "Vlad Didenko", "link": "https://stackoverflow.com/users/836097/vlad-didenko"}, "edited": false, "score": 0, "creation_date": 1430077691, "post_id": 29880389, "comment_id": 47889319, "body": "Is there a significant difference between the first version in the answer and the one suggested in the question? The second one, after Dave&#39;s suggestion may look like this: <a href=\"https://gist.githubusercontent.com/didenko/ed5144f6349656c683dc/raw/e8d14b04700d9a26a4c5140219c811ec4ccb7a5c/check_in_body.go\" rel=\"nofollow noreferrer\">gist.githubusercontent.com/didenko/ed5144f6349656c683dc/raw/&zwnj;&#8203;&hellip;</a> I am concerned about the need to memorize the danger of &quot;continue&quot; before the test, so if a function call is not an issue the a version in the question comments looks somewhat preferable. Do I miss something?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430077902, "post_id": 29880389, "comment_id": 47889394, "body": "@DaveC: Whenever you change code you must be sure that you don&#39;t introduce bugs. You can do that in many ways. For example, by introducing an errant <code>continue</code> or by following your suggestion about removing the <code>for</code> statement <code>i &lt;= max</code> condition, which  will change the behavior of the <code>iter</code> function whenever <code>min &gt; max</code>."}, {"owner": {"reputation": 3563, "user_id": 836097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e0fa7cc4752b302df71ac7fa7de9188?s=128&d=identicon&r=PG", "display_name": "Vlad Didenko", "link": "https://stackoverflow.com/users/836097/vlad-didenko"}, "edited": false, "score": 0, "creation_date": 1430078128, "post_id": 29880389, "comment_id": 47889486, "body": "@peterSO note about the min &gt; max case makes sense. I like special-case of max processing from Benjamin Gruenbaum even more after these considerations."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430078836, "post_id": 29880389, "comment_id": 47889741, "body": "@peterSO, gah, you are absolutely right, I completely forgot about <code>min &gt; max</code>! I was too focused on not doing two comparisons each loop. If that was a concern, it might make more sense to have an <code>if min &gt; max {return}</code> at the start to correctly eliminate the double compare. Your original is cleaner/nicer though. It&#39;s a trade off between simplicity and efficiency I think."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1430141661, "post_id": 29880389, "comment_id": 47917145, "body": "BTW, <a href=\"https://play.golang.org/p/lSJFw2Tje_\" rel=\"nofollow noreferrer\">here</a> is simple (put perhaps hard to read) way to avoid the extra comparisons and yet &quot;do the right thing&quot;, including allowing <code>continue</code> anywhere after the first line of the loop."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430144620, "post_id": 29880389, "comment_id": 47919512, "body": "@DaveC: Nice. I would simplify it. See my revised answer."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430174964, "post_id": 29880389, "comment_id": 47937118, "body": "BTW, if anyone is wondering about that <code>%\u2026[1]x</code>, it was a left over from when I was doing something like <code>Printf(&quot;%d = %[1]x&quot;, i)</code>. It should probably be removed now, sorry. (And I only used hex since I the decimal of maxUint64 doesn&#39;t mean much to me :)."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1430144556, "last_edit_date": 1495541170, "creation_date": 1430066236, "answer_id": 29880389, "question_id": 29880038, "link": "https://stackoverflow.com/questions/29880038/iteration-boundaries-same-as-data-types/29880389#29880389", "title": "Iteration boundaries same as data type&#39;s", "body": "<p>For example, for <code>uint8</code>,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc iter(min, max uint8) {\n    {\n        min, max := uint(min), uint(max)\n        for i := min; i &lt;= max; i++ {\n            fmt.Printf(\"%d, \", i)\n        }\n    }\n}\n\nfunc main() {\n    iter(0, 255)\n}\n</code></pre>\n\n<p>For <code>uint64</code>,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc iter(min, max uint64) {\n    for i := min; i &lt;= max; i++ {\n        fmt.Printf(\"%d, \", i)\n        if i == max {\n            break\n        }\n    }\n}\n\nfunc main() {\n    iter(^uint64(0)-2, ^uint64(0))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>18446744073709551613, 18446744073709551614, 18446744073709551615\n</code></pre>\n\n<p><strong>Addendum</strong>:</p>\n\n<p>Here's my version of <a href=\"https://stackoverflow.com/users/55504/dave-c\">Dave C</a>'s <a href=\"https://play.golang.org/p/lSJFw2Tje_\" rel=\"nofollow noreferrer\">suggestion</a>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc iter(min, max uint64) {\n    for i, next := min, min &lt;= max; next; i, next = i+1, i &lt; max {\n        fmt.Printf(\"%#016[1]x \", i)\n    }\n    fmt.Println()\n}\n\nfunc main() {\n    const maxUint64 = ^uint64(0)\n    iter(0, 3)\n    iter(10, 9)\n    iter(maxUint64-2, maxUint64)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0x0000000000000000 0x0000000000000001 0x0000000000000002 0x0000000000000003 \n0xfffffffffffffffd 0xfffffffffffffffe 0xffffffffffffffff \n</code></pre>\n"}], "owner": {"reputation": 3563, "user_id": 836097, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2e0fa7cc4752b302df71ac7fa7de9188?s=128&d=identicon&r=PG", "display_name": "Vlad Didenko", "link": "https://stackoverflow.com/users/836097/vlad-didenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 2, "accepted_answer_id": 29880389, "answer_count": 1, "score": 3, "last_activity_date": 1430144556, "creation_date": 1430064416, "last_edit_date": 1495540679, "question_id": 29880038, "link": "https://stackoverflow.com/questions/29880038/iteration-boundaries-same-as-data-types", "title": "Iteration boundaries same as data type&#39;s", "body": "<p>A function I have takes <em>min</em>, <em>max</em> <code>uint16</code> parameters and at some point iterates over the numeric range. However, if <em>max</em> happens to be <strong>2^16-1</strong> (and it is a valid use case), then overflow breaks the loop logic. Here is an example code demonstrating the problem with <code>uint8</code>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc iter(min, max uint8) {\n    for i := min; i &lt;= max; i++ {\n        fmt.Printf(\"%d, \", i)\n    }\n}\n\nfunc main() {\n    iter(0, 255)\n}\n</code></pre>\n\n<p>As you can see, the program never ends. A similar question was asked at <a href=\"https://stackoverflow.com/questions/21950244\">another question</a> but the solution exactly exhibits the same problem I have.</p>\n\n<p>My thinking for now is to convert the loop variable to <code>uint32</code>, similar to this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc iter(min, max uint8) {\n    for i := uint16(min); i &lt;= uint16(max); i++ {\n        fmt.Printf(\"%d, \", i)\n    }\n}\n\nfunc main() {\n    iter(0, 255)\n}\n</code></pre>\n\n<p>However, this seems to be a clumsy solution, which is not going to work for <code>uint64</code> or whatever biggest <code>uintN</code> type. Feels like I am missing something very basic. Guidance?</p>\n\n<p>I am aware of <a href=\"https://github.com/bradfitz/iter/blob/master/iter.go\" rel=\"nofollow noreferrer\">Brad Fitz's Iter solution</a>, but it seems to add unneeded overhead. Is that true as well?</p>\n"}, {"tags": ["go", "websocket", "server"], "comments": [{"owner": {"reputation": 574451, "user_id": 816620, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/Xu7hp.jpg?s=128&g=1", "display_name": "jfriend00", "link": "https://stackoverflow.com/users/816620/jfriend00"}, "edited": false, "score": 0, "creation_date": 1430065004, "post_id": 29879036, "comment_id": 47884409, "body": "What version of Go are you running and on what platform?  There are many reports of something like this in the Go issue tracking system (and likely several different causes).  One <a href=\"https://github.com/golang/go/issues/4914\" rel=\"nofollow noreferrer\">issue here</a> looks like it has been fixed post v1.02 and someone else that had the issue reported it fixed when they switched to v1.2.  There could also be other causes including logic error in your own code."}, {"owner": {"reputation": 23, "user_id": 4833033, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_7T_XribeGs/AAAAAAAAAAI/AAAAAAAAAQY/YQeEXFQQiH0/photo.jpg?sz=128", "display_name": "Iegor Azuaga", "link": "https://stackoverflow.com/users/4833033/iegor-azuaga"}, "edited": false, "score": 0, "creation_date": 1430065648, "post_id": 29879036, "comment_id": 47884662, "body": "Thanks for answering, I run Go 1.4.2 on windows. I think it&#39;s a logic error because sometimes in the client side i receive the message sent by the server but immediately the connection closes. Before asking this, I searched that can be causing this but I couldn&#39;t find anything in my code that can be causing this error."}, {"owner": {"reputation": 23, "user_id": 4833033, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_7T_XribeGs/AAAAAAAAAAI/AAAAAAAAAQY/YQeEXFQQiH0/photo.jpg?sz=128", "display_name": "Iegor Azuaga", "link": "https://stackoverflow.com/users/4833033/iegor-azuaga"}, "edited": false, "score": 0, "creation_date": 1430066889, "post_id": 29879036, "comment_id": 47885116, "body": "It is definitely an error in my code but i don&#39;t know how to solve it correctly. If i put a for loop under the &quot;connection.AssignToUser(user) connection.txChan &lt;- authPacket&quot; the server don&#39;t closes the connection but above i call the function NewConnection() and it does that already with &quot;go connection.ReceivePoller() go connection.SendPoller()&quot;"}, {"owner": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "edited": false, "score": 2, "creation_date": 1430089430, "post_id": 29879036, "comment_id": 47893314, "body": "The websocket server closes the connection when the handler function <code>clientConnection</code> returns. I skimmed the code and didn&#39;t see anything that prevents the handler function from returning before the pollers are done. You should use the x/net package with caution as it does not fully implement the websocket protocol. Consider using Gorilla."}, {"owner": {"reputation": 23, "user_id": 4833033, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_7T_XribeGs/AAAAAAAAAAI/AAAAAAAAAQY/YQeEXFQQiH0/photo.jpg?sz=128", "display_name": "Iegor Azuaga", "link": "https://stackoverflow.com/users/4833033/iegor-azuaga"}, "reply_to_user": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "edited": false, "score": 0, "creation_date": 1430142324, "post_id": 29879036, "comment_id": 47917719, "body": "@tvblah Thanks for the info. I couldn&#39;t fix what was causing the error so finally i will switch to Gorilla."}, {"owner": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "edited": false, "score": 1, "creation_date": 1430169015, "post_id": 29879036, "comment_id": 47934691, "body": "The Gorilla not close the connection on return from handler. Should be easier for you."}, {"owner": {"reputation": 23, "user_id": 4833033, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_7T_XribeGs/AAAAAAAAAAI/AAAAAAAAAQY/YQeEXFQQiH0/photo.jpg?sz=128", "display_name": "Iegor Azuaga", "link": "https://stackoverflow.com/users/4833033/iegor-azuaga"}, "reply_to_user": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "edited": false, "score": 0, "creation_date": 1430171017, "post_id": 29879036, "comment_id": 47935633, "body": "@tvblah It&#39;s done! Thanks for the help."}], "owner": {"reputation": 23, "user_id": 4833033, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_7T_XribeGs/AAAAAAAAAAI/AAAAAAAAAQY/YQeEXFQQiH0/photo.jpg?sz=128", "display_name": "Iegor Azuaga", "link": "https://stackoverflow.com/users/4833033/iegor-azuaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 8959, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1430064292, "creation_date": 1430059232, "last_edit_date": 1430064292, "question_id": 29879036, "link": "https://stackoverflow.com/questions/29879036/use-of-closed-network-connection", "title": "Use of closed network connection", "body": "<p>I'm working on a websocket server and for some reason it outputs: </p>\n\n<blockquote>\n  <p>\"WSARecv tcp 127.0.0.1:8080: Use of closed network connection.\"</p>\n</blockquote>\n\n<p>I don't know why it says that because i haven't closed the connection any time...</p>\n\n<p>Here are some files of the server (if need the full source code: <a href=\"http://github.com/Kekocity/kekocity-go\" rel=\"nofollow\">github</a>)</p>\n\n<p><strong>connection.go</strong></p>\n\n<pre><code>package net\n\nimport (\n  \"log\"\n\n  \"golang.org/x/net/websocket\"\n\n  pnet \"kekocity/misc/packet\"\n  \"kekocity/interfaces\"\n)\n\ntype Connection struct {\n  socket *websocket.Conn\n\n  txChan chan pnet.INetMessageWriter\n    rxChan chan pnet.INetMessageReader\n\n  user interfaces.IUser\n}\n\nfunc NewConnection(_socket *websocket.Conn) *Connection {\n  // The pointer allow us to modify connection struct from outside\n  connection := &amp;Connection{\n    socket: _socket,\n    txChan: make(chan pnet.INetMessageWriter),\n    rxChan: make(chan pnet.INetMessageReader),\n  }\n\n  go connection.ReceivePoller()\n  go connection.SendPoller()\n\n  return connection\n}\n\nfunc (c *Connection) AssignToUser(_user interfaces.IUser) {\n  if _user == nil {\n    panic(\"net.connection: the user interface can not be nil!\")\n    return\n  }\n\n  c.user = _user\n  _user.SetNetworkChans(c.rxChan, c.txChan)\n}\n\n/*\n * ReceivePoller and SendPoller starts listening when the first packet is verified and the new connection is started\n */\nfunc (c *Connection) ReceivePoller() {\n  for {\n    packet := pnet.NewPacket()\n\n    var buffer []uint8\n        err := websocket.Message.Receive(c.socket, &amp;buffer)\n\n        if err == nil {\n            copy(packet.Buffer[0:len(buffer)], buffer[0:len(buffer)])\n\n            c.parsePacket(packet)\n        } else {\n            println(err.Error())\n            break\n        }\n  }\n}\n\nfunc (c *Connection) SendPoller() {\n  for {\n    // Read messages from transmit channel\n    message := &lt;-c.txChan\n\n    if message == nil {\n      log.Println(\"SenPoller\", \"The message is nil, break the loop\")\n      break\n    }\n\n    // Convert netmessage to packet\n    packet := message.WritePacket()\n    packet.SetHeader()\n\n    // Create byte buffer\n    buffer := packet.GetBuffer()\n    data := buffer[0:packet.GetMsgSize()]\n\n    // Send bytes off to the internetz\n    websocket.Message.Send(c.socket, data)\n  }\n}\n\nfunc (c *Connection) parsePacket(_packet pnet.IPacket) {\n  log.Println(\"net.connection:\", \"Received new packet!\")\n}\n\nfunc (c *Connection) Close() {\n  // Close channels\n  close(c.txChan)\n  close(c.rxChan)\n\n  // Close the socket\n  c.socket.Close()\n\n  c.user = nil\n}\n</code></pre>\n\n<p><strong>server.go</strong></p>\n\n<pre><code>package net\n\n// &lt;imports&gt;\nimport (\n  \"log\"\n  \"fmt\"\n  \"net/http\"\n\n  \"golang.org/x/net/websocket\"\n\n  pnet \"kekocity/misc/packet\"\n  cmap \"kekocity/misc/concurrentmap\"\n  \"kekocity/data/helpers\"\n  \"kekocity/net/message\"\n)\n\nvar server *Server\n\ntype Server struct {\n  port int\n\n  connectedUsers *cmap.ConcurrentMap\n}\n\nfunc init() {\n    server = newServer()\n}\n\nfunc newServer() *Server {\n    return &amp;Server{\n    port: 8080,\n    connectedUsers: cmap.New(),\n  }\n}\n\nfunc Listen(_port int) {\n  server.port = _port\n\n  log.Printf(\"Listening for connections on port %d!\", _port)\n\n  http.Handle(\"/ws\", websocket.Handler(clientConnection))\n\n    err := http.ListenAndServe(fmt.Sprintf(\":%d\", _port), nil)\n    if err != nil {\n        panic(\"ListenAndServe: \" + err.Error())\n    }\n}\n\nfunc clientConnection(clientsock *websocket.Conn) {\n  packet := pnet.NewPacket()\n  buffer := make([]uint8, pnet.PACKET_MAXSIZE)\n\n  recv, err := clientsock.Read(buffer)\n\n  if err == nil {\n    copy(packet.Buffer[0:recv], buffer[0:recv])\n\n    parseFirstMessage(clientsock, packet)\n  } else {\n    if err.Error() != \"EOF\" {\n      log.Println(\"net.server\", \"Client connection error:\", err.Error())\n    }\n  }\n}\n\nfunc parseFirstMessage(_conn *websocket.Conn, _packet *pnet.Packet) {\n  _message := _packet.ToString()\n\n  // If the first packet length is &lt; 1 close the socket\n  if len(_message) &lt; 1 {\n    _conn.Close()\n    return\n  }\n\n  // Create the connection\n  connection := NewConnection(_conn)\n\n  // Authentication wrapper\n  authPacket := &amp;message.AuthMessage{}\n  user, err := helpers.AuthHelper.AuthenticateUsingCredentials(_message)\n\n  if err != nil {\n    log.Fatal(\"Invalid credentials!\")\n    authPacket.Status = \"error\"\n  } else {\n    // Need to check if its already logged\n\n    authPacket.Status = \"success\"\n\n    connection.AssignToUser(user)\n      connection.txChan &lt;- authPacket\n\n    return\n  }\n\n  // Send bad auth message and close\n  connection.txChan &lt;- authPacket\n  connection.Close()\n}\n</code></pre>\n\n<p>Full source code: <a href=\"http://github.com/Kekocity/kekocity-go\" rel=\"nofollow\">github</a></p>\n"}, {"tags": ["tcp", "error-handling", "go", "server", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1430048231, "post_id": 29877003, "comment_id": 47878407, "body": "That&#39;s not how TCP keepalive works. You turn it on, and will receive an error from the TCP stack. You don&#39;t need another goroutine to do anything."}], "answers": [{"comments": [{"owner": {"reputation": 443, "user_id": 3798217, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000005594798/picture?type=large", "display_name": "Md. Abu Nafee Ibna Zahid", "link": "https://stackoverflow.com/users/3798217/md-abu-nafee-ibna-zahid"}, "edited": false, "score": 0, "creation_date": 1578291695, "post_id": 29877555, "comment_id": 105378658, "body": "Hi @Prabhu, Seems <code>net</code> doesn&#39;t have any public function like <code>SetKeepAlive</code> ."}], "tags": [], "owner": {"reputation": 3265, "user_id": 2606938, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7gIUB.jpg?s=128&g=1", "display_name": "Prabhu", "link": "https://stackoverflow.com/users/2606938/prabhu"}, "is_accepted": true, "score": 4, "last_activity_date": 1430050890, "creation_date": 1430050890, "answer_id": 29877555, "question_id": 29877003, "link": "https://stackoverflow.com/questions/29877003/keeping-a-tcp-connection-alive-in-a-goroutine-and-check-if-it-timesout-if-the-co/29877555#29877555", "title": "Keeping a TCP connection alive in a goroutine and check if it timesout if the connection is lost", "body": "<p>To keep a check on the established TCP connections, one can do <code>keep-alive</code> mechanism in two ways.</p>\n\n<p>At application level:\n  In idle conditions both client and server agree on  a protocol to send pre-determined packets to each other. Lack of a message from peer with in certain time can signal a problem in the connection. </p>\n\n<p>At TCP layer:\nEnable the TCP stack to check the connection status. The TCP layer at which this mechanism is enabled will send <code>keep-alive</code> messages at regular determined interval. It would expect that the peer TCP stack send <code>keep-alive-ack</code>. Absence of ACK after needed re-transmission signals connection problem and the application would be duly notified. </p>\n\n<p>I think <code>net.SetKeepAlive(true)</code> is a <code>go</code> way of informing the TCP to do keep-alive. You need not do any thing special constructs in go routine. </p>\n\n<p>TCP <code>keep-alive</code> works well. Application need not be burdened to check for connection status</p>\n"}], "owner": {"reputation": 121, "user_id": 3756875, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0d39ae99e5fb40f82bc9745635fc6ebc?s=128&d=identicon&r=PG&f=1", "display_name": "user123577", "link": "https://stackoverflow.com/users/3756875/user123577"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1007, "favorite_count": 0, "accepted_answer_id": 29877555, "answer_count": 1, "score": 1, "last_activity_date": 1430050890, "creation_date": 1430047631, "question_id": 29877003, "link": "https://stackoverflow.com/questions/29877003/keeping-a-tcp-connection-alive-in-a-goroutine-and-check-if-it-timesout-if-the-co", "title": "Keeping a TCP connection alive in a goroutine and check if it timesout if the connection is lost", "body": "<p>I have a TCP server up and running listetning to a port and a go routine for handeling the connections. I wonder if it's possible to have a go routine running for every connection keeping them alive with <code>net.SetKeepAlive(true)</code>. Also with error handling so that if the connection times out it will execute cleanup functions like removing the connection from a list?</p>\n\n<p>Handle routine:</p>\n\n<pre><code>func handleConnection(conn net.Conn, rec chan string) {\n   var item QueItem\n   buf := make([]byte, bufSize)\n   l, err := conn.Read(buf)\n   if err != nil || l &lt; 0 {\n    fmt.Println(\"Error reading from conn: \", conn)\n    fmt.Println(\"Error reading: \", err)\n   }\n\n   err = json.Unmarshal(buf[:l], &amp;item)\n   if err != nil {\n     fmt.Println(\"Error converting to JSON\", jErr)\n   }\n\n  fmt.Printf(\"Received : %+v\\n\", item)\n  fmt.Println(\"recived from:\", conn.RemoteAddr())\n  rec &lt;- item.IP\n}\n</code></pre>\n\n<p>TCPserver:</p>\n\n<pre><code>for {\n    conn, err := ln.Accept()\n    if err != nil {\n        fmt.Println(\"No accept\", err)\n        log.Println(\"Unable to accept connection\", err)\n    }\n    go handleConnection(conn, recived)\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 121, "user_id": 2562301, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0d6794c700fe42f7d2c95543f8a50092?s=128&d=identicon&r=PG", "display_name": "user2562301", "link": "https://stackoverflow.com/users/2562301/user2562301"}, "edited": false, "score": 0, "creation_date": 1430005106, "post_id": 29871954, "comment_id": 47868876, "body": "I&#39;m trying to make a GET request to orientDB"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1430018333, "post_id": 29871954, "comment_id": 47871649, "body": "Show some example code. Go&#39;s net/http package allows you to add custom headers."}, {"owner": {"reputation": 121, "user_id": 2562301, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0d6794c700fe42f7d2c95543f8a50092?s=128&d=identicon&r=PG", "display_name": "user2562301", "link": "https://stackoverflow.com/users/2562301/user2562301"}, "edited": false, "score": 1, "creation_date": 1445950689, "post_id": 29871954, "comment_id": 54531734, "body": "Jesus christ Dave, I know its Go, and I know that it&#39;s golang for search engines. WTF is wrong with you?"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 2, "last_activity_date": 1430096451, "creation_date": 1430096451, "answer_id": 29885554, "question_id": 29871954, "link": "https://stackoverflow.com/questions/29871954/golang-http-basic-auth-with-google-app-engine-urlfetch/29885554#29885554", "title": "GOLANG HTTP Basic-Auth with Google App Engine URLFetch", "body": "<p><code>urlfetch.Client(ctx)</code> returns an HTTP client (<a href=\"http://godoc.org/google.golang.org/appengine/urlfetch#Client\" rel=\"nofollow\">http://godoc.org/google.golang.org/appengine/urlfetch#Client</a>)</p>\n\n<p>The <code>http.Client</code> has methods for <code>Get</code>, <code>Post</code>, etc... It also has <code>Do</code> which you can hand an arbitrary request. Create a request using <code>http.NewRequest</code>:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"http://www.google.com\", nil)\n</code></pre>\n\n<p>Then you can add a header like this:</p>\n\n<pre><code>req.Header.Set(\"Authorization\", \"whatever\")\n</code></pre>\n\n<p>And call <code>Do</code>:</p>\n\n<pre><code>res, err := client.Do(req)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 662, "user_id": 528821, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe6fcd9348efe1432edfe086d82a359b?s=128&d=identicon&r=PG", "display_name": "Good Lux", "link": "https://stackoverflow.com/users/528821/good-lux"}, "is_accepted": false, "score": 2, "last_activity_date": 1445837708, "last_edit_date": 1445837708, "creation_date": 1445837238, "answer_id": 33338989, "question_id": 29871954, "link": "https://stackoverflow.com/questions/29871954/golang-http-basic-auth-with-google-app-engine-urlfetch/33338989#33338989", "title": "GOLANG HTTP Basic-Auth with Google App Engine URLFetch", "body": "<p>I'm new to Go, please excuse this code for being ugly/malformed/just plain wrong.</p>\n\n<p>I've been working my way though this and ran across the same problem on appengine. </p>\n\n<p>@Caleb's answer above was a big help. I've just added some detail to that to help someone who might come across a similar problem.</p>\n\n<p>Here's what my import statement looks like:</p>\n\n<pre><code>Import {\n    \"appengine\"\n    \"appengine/urlfetch\"\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"golang.org/x/oauth2\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"net/url\"\n}\n</code></pre>\n\n<p>This is a function that receives and incoming authentication callback request, then replies with a request for an access token from the authentication server. In this case, fitbit, which needs an Authentication header set to \"Basic\" with some extra information. I couldn't figure out how to do this with the stock Oauth2 library, which doesn't seem to easily allow changing the request headers. </p>\n\n<p>As you can see we the context of the incoming request (r). From that context, we get the http.Client from urlfetch. </p>\n\n<p>Then we pack up and send a request back, with some authorization information. </p>\n\n<p>After we get a response we print the results to the browser. </p>\n\n<p>Hope this helps!</p>\n\n<pre><code>func authCallbackHandler(w http.ResponseWriter, r *http.Request) {\n\n    data := url.Values{}\n    data.Set(\"client_id\", \"231343\")\n    data.Add(\"grant_type\", \"authorization_code\")\n    data.Add(\"redirect_uri\", \"http://localhost:8080/callmebacklaterok\")\n    data.Add(\"code\", \"authcode123132\")\n\n    encodedData := data.Encode()\n\n    c := appengine.NewContext(r)\n    client := urlfetch.Client(c)\n\n    urlStr := \"https://api.fitbit.com/oauth2/token\"\n    req, _ := http.NewRequest(\"POST\", urlStr,bytes.NewBufferString(encodedData))\n    req.Header.Add(\"Authorization\", \"Basic RmFuY3kgbWVldGluZyB5b3UgaGVyZSEg\")\n    resp, _ := client.Do(req)\n    defer resp.Body.Close()\n\n    fmt.Fprint(w, resp)\n\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n       panic(err.Error())\n    }\n\n    var bodydata interface{} \n    err = json.Unmarshal(body, &amp;bodydata)\n    if err != nil {\n        panic(err.Error())\n    }\n    fmt.Fprint(w, bodydata)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 2562301, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0d6794c700fe42f7d2c95543f8a50092?s=128&d=identicon&r=PG", "display_name": "user2562301", "link": "https://stackoverflow.com/users/2562301/user2562301"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1800, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1445837708, "creation_date": 1430005060, "last_edit_date": 1430140101, "question_id": 29871954, "link": "https://stackoverflow.com/questions/29871954/golang-http-basic-auth-with-google-app-engine-urlfetch", "title": "GOLANG HTTP Basic-Auth with Google App Engine URLFetch", "body": "<p>How can I add an <code>Authorization</code> header to <code>urlfetch</code> client with Go?</p>\n\n<p>There is a similar question answered for <code>java</code> and <code>python</code>, but not <code>Go</code>.</p>\n"}, {"tags": ["function", "reflection", "go", "trace"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 2, "creation_date": 1430004215, "post_id": 29871585, "comment_id": 47868636, "body": "what do you plan to use this on?"}, {"owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1430006423, "post_id": 29871585, "comment_id": 47869197, "body": "what do you mean? It&#39;s generic."}, {"owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1430013726, "post_id": 29871585, "comment_id": 47870802, "body": "the equivalent question for c#: <a href=\"http://stackoverflow.com/questions/7393778/log-function-calls-parameter-values-return-values-in-c-sharp\">link</a>. They are using a runtime. Perhaps there is a way to use the Go runtime to generate trace output without requiring the programmer to do any instrumentation."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1430047073, "post_id": 29871585, "comment_id": 47878068, "body": "even when it is generic you still plan to use it for something. Debugging per chance?"}, {"owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1430057509, "post_id": 29871585, "comment_id": 47881414, "body": "my immediate need is just for offline debugging/sanity checking."}, {"owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1430160185, "post_id": 29871585, "comment_id": 47929705, "body": "perhaps of interest to some: <a href=\"http://googletesting.blogspot.com/2013/06/optimal-logging.html\" rel=\"nofollow noreferrer\">optimal logging</a>"}], "answers": [{"comments": [{"owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "edited": false, "score": 0, "creation_date": 1430019775, "post_id": 29873144, "comment_id": 47871872, "body": "Thanks One. It&#39;s a nice addition to the toolset.   There are also <a href=\"http://stackoverflow.com/questions/311840/tool-to-trace-local-function-calls-in-linux#311912\">options at the DWARF level</a>. It seems one of the GCC 4.8+ releases with built-in Go support might be usable. There is also a <a href=\"https://github.com/sbinet/go-clang\" rel=\"nofollow noreferrer\">recent clang port</a>."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1430060774, "post_id": 29873144, "comment_id": 47882690, "body": "Be aware that although this is promising stuff it is currently also very immature. I was able to get some interesting insights with this, but the installation also killed the dependencies in my gopath. Do not use (yet) in a production gopath."}, {"owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "edited": false, "score": 0, "creation_date": 1430067387, "post_id": 29873144, "comment_id": 47885311, "body": "Yes.. my experience as well. As you know, OSX has recently dropped GCC in favour of LLVM and homebrew has problems doing a clean install of GCC 4.9 on Yosemite. For now i&#39;ve just slightly modded the Tracey lib to print output values.. i don&#39;t have a lot of calls to monitor.  I think the go runtime has sufficient metadata to do automatic tracing, but i don&#39;t think the necessary interface is exposed. If a standard interface was available it might also be useful in event sourcing."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 2, "last_activity_date": 1430016612, "creation_date": 1430016612, "answer_id": 29873144, "question_id": 29871585, "link": "https://stackoverflow.com/questions/29871585/how-do-you-log-function-call-return-values-in-golang/29873144#29873144", "title": "how do you log function call return values in golang", "body": "<p>The closest thing you will get to do it without adding a lot of <code>printf</code>'s is using <a href=\"https://github.com/mailgun/godebug\" rel=\"nofollow\">godebug</a>, which pretty much adds the <code>printfs</code> for you.</p>\n"}, {"comments": [{"owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "edited": false, "score": 0, "creation_date": 1430029839, "post_id": 29873754, "comment_id": 47873709, "body": "Thanks captn. I am beginning to think that there should be a way to do this  via function entry/exit hooks at the debug level. I don&#39;t think the go runtime exposes the required hooks, but could be wrong. I suspect you can retrieve the trace info in GDB without digging heavily into golang specifics. Golang has c underpinnings and there is a lot of existing, relatively fast, unobtrusive tooling there."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "edited": false, "score": 0, "creation_date": 1430096910, "post_id": 29873754, "comment_id": 47895251, "body": "@DavidAiken I think a lot of tools do that kind of thing by generating code that inserts debug code."}, {"owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "edited": false, "score": 0, "creation_date": 1430166751, "post_id": 29873754, "comment_id": 47933467, "body": "i think the disadvantage is that often the customer has a non-debug build and a debug build is too slow for heisenbugs. Ideally you would be able to get them to create logs with their current build to help you to troubleshoot and even reproduce the problem in your environment. I think the Go runtime has the data. Perhaps an option could enable trace logging at different levels of detail without incurring a heavy cost during normal operation. Such an option would avoid the need for custom instrumentation code in the app and the log could be processed using standard tools."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "edited": false, "score": 0, "creation_date": 1430168455, "post_id": 29873754, "comment_id": 47934399, "body": "@DavidAiken I have used this approach more for runtime instrumentation than for debugging. Things like metrics / logging / etc. If you want debugging, use a debugger. Printfs get me most of what I need."}, {"owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "edited": false, "score": 0, "creation_date": 1430177098, "post_id": 29873754, "comment_id": 47937806, "body": "thanks captn.. I&#39;m on Yosemite, which has gone exclusively to LLVM now, but i may revisit it later.   Different strokes for different folks.. there are a few c macros out there for capturing nested function entry/exit traces. A fast facility in the runtime which made use of the reflection data might also be helpful when supporting production code in the field, but that&#39;s just an opinion."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 3, "last_activity_date": 1430022489, "creation_date": 1430022489, "answer_id": 29873754, "question_id": 29871585, "link": "https://stackoverflow.com/questions/29871585/how-do-you-log-function-call-return-values-in-golang/29873754#29873754", "title": "how do you log function call return values in golang", "body": "<p>You are correct in assesing that the arguments to a deferred function are evaluated at the point the defer is queued, not when it is executed. </p>\n\n<p>Your method of making an anonymous function that refers to named returns is valid. Another approach is to pass in the <strong>address</strong> of the return values:</p>\n\n<pre><code>func try() (i int) {\n    defer printReturns(time.Now(), &amp;i)\n    time.Sleep(10 * time.Millisecond)\n    i = 10\n    return i + 1\n}\n\nfunc printReturns(start time.Time, rets ...interface{}) {\n    fmt.Println(time.Now().Sub(start))\n    for _,ret := range rets{\n        fmt.Println(ret)\n    }\n}\n</code></pre>\n\n<p>The problem with this approach is that your logging function now has a pointer instead of the real type and must unwrap the pointers to do anything with them. But if you are using <code>reflect</code>, that is not horribly difficult.</p>\n"}], "owner": {"reputation": 194, "user_id": 4233608, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/a11fa93ab5083fda91dc98704f728c93?s=128&d=identicon&r=PG", "display_name": "David Aiken", "link": "https://stackoverflow.com/users/4233608/david-aiken"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1189, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1430022489, "creation_date": 1430002073, "question_id": 29871585, "link": "https://stackoverflow.com/questions/29871585/how-do-you-log-function-call-return-values-in-golang", "title": "how do you log function call return values in golang", "body": "<p>I want to know the return values at time of exit from a golang function. The golang defer mechanism is helpful, but it evaluates arguments at the time the defer statement is registered rather than when it is executed. I can work with this using an anonymous function which accesses the return values:</p>\n\n<pre><code>func try() (int i) {\n  defer func() {fmt.Printf(\"%d\", i)}()\n  i = 10\n  return i+1\n}\n\nfunc main() {\n  try()\n}\n</code></pre>\n\n<p>This would work ok, i think, but I would like to handle this in a generic manner, perhaps something like:</p>\n\n<pre><code>func try(in string) (out int) {\n  enter(\"%s\", in);exit(\"%d\", out)\n}\n</code></pre>\n\n<p>or, even better, use reflection to output the arguments/return values at time of entry/exit. I'm assuming runtime performance isn't critical :). </p>\n\n<p>Is there a good way to do this? <a href=\"http://sabhiram.com/go/2015/01/21/golang_trace_fns_part_1.html\" rel=\"nofollow\">Shaba Abhiram's handy Tracey lib</a> does go a long way towards this but stops short of printing the return values.</p>\n"}, {"tags": ["struct", "types", "go"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 4833033, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_7T_XribeGs/AAAAAAAAAAI/AAAAAAAAAQY/YQeEXFQQiH0/photo.jpg?sz=128", "display_name": "Iegor Azuaga", "link": "https://stackoverflow.com/users/4833033/iegor-azuaga"}, "edited": false, "score": 0, "creation_date": 1430006155, "post_id": 29871909, "comment_id": 47869131, "body": "Thanks for answering. It still outputs a &quot;Expected pointer to struct slice *[]struct&quot;. The repository for the full source code: <a href=\"http://github.com/Kekocity/kekocity-go\" rel=\"nofollow noreferrer\">github.com/Kekocity/kekocity-go</a>"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "reply_to_user": {"reputation": 23, "user_id": 4833033, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_7T_XribeGs/AAAAAAAAAAI/AAAAAAAAAQY/YQeEXFQQiH0/photo.jpg?sz=128", "display_name": "Iegor Azuaga", "link": "https://stackoverflow.com/users/4833033/iegor-azuaga"}, "edited": false, "score": 0, "creation_date": 1430046887, "post_id": 29871909, "comment_id": 47878028, "body": "@IegorAzuaga: ah, I misread. I updated the answer to a pointer of an slice of structs."}], "tags": [], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "is_accepted": true, "score": 0, "last_activity_date": 1430046815, "last_edit_date": 1430046815, "creation_date": 1430004677, "answer_id": 29871909, "question_id": 29871354, "link": "https://stackoverflow.com/questions/29871354/expected-pointer-to-struct-slice/29871909#29871909", "title": "Expected pointer to struct slice", "body": "<p>Something like this should work.</p>\n\n<pre><code>func (ah *authHelper) AuthenticateUsingCredentials(_token string) (interfaces.IUser, error) {\n  var result *[]entities.User\n  err := db.Where(\"Token\", \"=\", _token).Find(result)\n  if err != nil {\n    return nil, err\n  }\n  if len(result) &lt;= 0 {\n    return nil, fmt.Errorf(\"Player '%s' not found\", _token)\n  }\n\n  playerModel, err := ah.userEntityToModel(&amp;(*result)[0])\n  if err != nil {\n    return nil, err\n  }\n\n  return playerModel, nil\n}\n</code></pre>\n\n<p>you are trying to put an slice of users in a function that takes a pointer to a single user.</p>\n"}], "owner": {"reputation": 23, "user_id": 4833033, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_7T_XribeGs/AAAAAAAAAAI/AAAAAAAAAQY/YQeEXFQQiH0/photo.jpg?sz=128", "display_name": "Iegor Azuaga", "link": "https://stackoverflow.com/users/4833033/iegor-azuaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 459, "favorite_count": 0, "accepted_answer_id": 29871909, "answer_count": 1, "score": 1, "last_activity_date": 1430046815, "creation_date": 1430000273, "question_id": 29871354, "link": "https://stackoverflow.com/questions/29871354/expected-pointer-to-struct-slice", "title": "Expected pointer to struct slice", "body": "<p>I'm working on a server in golang.</p>\n\n<p>I have an auth-helper that authenticates the user with a secure token <em>(its a test)</em>. The error comes when i make a query <em>(I'm using this <a href=\"https://github.com/eaigner/hood\" rel=\"nofollow\">dep</a>)</em> in the AuthUsingCredentials function, it outputs the following error: </p>\n\n<blockquote>\n  <p>\"Expected pointer to struct slice *[]struct\"</p>\n</blockquote>\n\n<p>If I change the <code>var result *entities.User</code> for <code>var result []entities.User</code> and then print result[0] it works but then it outputs: </p>\n\n<blockquote>\n  <p>\"cannot use result[0] (type entities.User) as type *entities.User in\n  argument to ah.userEntityToModel\"</p>\n</blockquote>\n\n<p>The auth helper code:</p>\n\n<p><strong>auth.go</strong></p>\n\n<pre><code>package helpers\n\nimport (\n  \"fmt\"\n\n  \"server/data/entities\"\n  \"server/data/models\"\n  \"server/interfaces\"\n)\n\nvar AuthHelper *authHelper\n\ntype authHelper struct{}\n\nfunc init() {\n    AuthHelper = &amp;authHelper{}\n}\n\nfunc (ah *authHelper) userEntityToModel(_entity *entities.User) (*models.User, error) {\n  u := models.NewUser(_entity, db)\n    u.Username = _entity.Username\n\n  return u, nil\n}\n\nfunc (ah *authHelper) AuthenticateUsingCredentials(_token string) (interfaces.IUser, error) {\n  var result *entities.User\n  err := db.Where(\"Token\", \"=\", _token).Find(result)\n  if err != nil {\n    return nil, err\n  }\n  if result == nil {\n    return nil, fmt.Errorf(\"Player '%s' not found\", _token)\n  }\n\n  playerModel, err := ah.userEntityToModel(result)\n  if err != nil {\n    return nil, err\n  }\n\n  return playerModel, nil\n}\n</code></pre>\n"}, {"tags": ["go", "beego"], "answers": [{"comments": [{"owner": {"reputation": 830, "user_id": 770719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/Z6Bzq.jpg?s=128&g=1", "display_name": "jjude", "link": "https://stackoverflow.com/users/770719/jjude"}, "edited": false, "score": 0, "creation_date": 1430028175, "post_id": 29869610, "comment_id": 47873395, "body": "Exact syntax is: <code>goop exec bee pack -ba &quot;-tags prod&quot; -exr=&quot;^(?:userfiles|deploy|tests|docs)$&quot;</code>"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 830, "user_id": 770719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/Z6Bzq.jpg?s=128&g=1", "display_name": "jjude", "link": "https://stackoverflow.com/users/770719/jjude"}, "edited": false, "score": 0, "creation_date": 1430034676, "post_id": 29869610, "comment_id": 47874761, "body": "@Joseph Great, it worked! I have included your comment in the answer for more visibility."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 2, "last_activity_date": 1430034650, "last_edit_date": 1495541966, "creation_date": 1429989636, "answer_id": 29869610, "question_id": 29869580, "link": "https://stackoverflow.com/questions/29869580/how-to-exclude-multiple-directories-from-bee-pack/29869610#29869610", "title": "How to exclude multiple directories from bee pack", "body": "<p>Since exr is a regexp, you could try and use (using the <a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"nofollow noreferrer\">re2 syntax</a>) a composite:</p>\n\n<pre><code>-exr=^(?:userfile|deploy|docs)$\n</code></pre>\n\n<p>The <a href=\"https://stackoverflow.com/users/770719/joseph\">OP Joseph</a> confirms the idea <a href=\"https://stackoverflow.com/questions/29869580/how-to-exclude-multiple-directories-from-bee-pack/29869610#comment47873395_29869610\">in the comments</a>:</p>\n\n<pre><code>goop exec bee pack -ba \"-tags prod\" -exr=\"^(?:userfiles|deploy|tests|docs)$\"\n</code></pre>\n"}], "owner": {"reputation": 830, "user_id": 770719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/Z6Bzq.jpg?s=128&g=1", "display_name": "jjude", "link": "https://stackoverflow.com/users/770719/jjude"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 2, "accepted_answer_id": 29869610, "answer_count": 1, "score": 1, "last_activity_date": 1430034650, "creation_date": 1429989387, "question_id": 29869580, "link": "https://stackoverflow.com/questions/29869580/how-to-exclude-multiple-directories-from-bee-pack", "title": "How to exclude multiple directories from bee pack", "body": "<p>How do I exclude multiple directories from bee pack tool?</p>\n\n<p><code>bee pack -ba \"-tags prod\" -exr=^userfiles$</code></p>\n\n<p>this excludes this particular directory. But I want to exclude directories named as userfiles, deploy, docs. I tried </p>\n\n<p><code>-exr=[^userfiles$,^deploy$,^docs$]</code><br>\n<code>-exr=[\"^userfiles$\",\"^deploy$\",\"^docs$\"]</code></p>\n\n<p>both of these didn't work.</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 36371, "user_id": 1180785, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/UjU0z.png?s=128&g=1", "display_name": "Dave", "link": "https://stackoverflow.com/users/1180785/dave"}, "edited": false, "score": 1, "creation_date": 1429982416, "post_id": 29868239, "comment_id": 47861639, "body": "I&#39;m not knowledgeable on go specifically, but my immediate thought is that this would make rebalancing the map (if necessary) a more costly operation (would require moving more memory). Getting and setting data would also become more costly for the same reason (requires copying the full struct, instead of a pointer to the struct)"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1429987716, "post_id": 29868656, "comment_id": 47863653, "body": "In particular, with a small struct like this, <i>not</i> using a pointer will perform better. As always, if/when performance is a concern, don&#39;t guess, benchmark."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1430013612, "post_id": 29868656, "comment_id": 47870783, "body": "Only caveat is that you can&#39;t directly assign to the value without a pointer (<code>store2[&quot;country1&quot;].Name = &quot;X&quot;</code>)."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 3, "last_activity_date": 1429984200, "creation_date": 1429984200, "answer_id": 29868656, "question_id": 29868239, "link": "https://stackoverflow.com/questions/29868239/go-map-key-is-string-value-is-pointer-to-a-struct/29868656#29868656", "title": "go map, key is string, value is pointer to a struct", "body": "<p>You can achieve the same behavior using either pointer or value.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Country struct {\n    Code string\n    Name string\n}\n\nfunc main() {\n    var store = make(map[string]*Country)\n    var store2 = make(map[string]Country)\n\n    c1 := Country{\"US\", \"United States\"}\n\n    store[\"country1\"] = &amp;c1\n    store2[\"country1\"] = c1\n\n    fmt.Println(store[\"country1\"].Name)  // prints \"United States\"\n    fmt.Println(store2[\"country1\"].Name) // prints \"United States\"\n\n}\n</code></pre>\n\n<p>Using a pointer will store the address of the struct in the map instead of a copy of the entire struct. With small structs like in your example this won't make much of a difference. With larger structs it might impact performance.</p>\n"}], "owner": {"reputation": 6557, "user_id": 2495795, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/13606de0b736d7191e2cf2bfea1d4fda?s=128&d=identicon&r=PG", "display_name": "BufBills", "link": "https://stackoverflow.com/users/2495795/bufbills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2110, "favorite_count": 1, "accepted_answer_id": 29868656, "answer_count": 1, "score": 0, "last_activity_date": 1429984200, "creation_date": 1429981809, "question_id": 29868239, "link": "https://stackoverflow.com/questions/29868239/go-map-key-is-string-value-is-pointer-to-a-struct", "title": "go map, key is string, value is pointer to a struct", "body": "<pre><code>type Country struct {\n    Code string\n    Name string\n}\n\nvar store = map[string]*Country{}\n</code></pre>\n\n<p>in this go code piece, key is string, value is pointer to a struct.\nWhat's the benefit to use pointer of Contry here?\nCan I remove the \"*\" and achieve the same behaviour?\nSuch as:</p>\n\n<pre><code> var store = map[string]Country\n</code></pre>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1429974381, "post_id": 29866808, "comment_id": 47858530, "body": "Remove the <code>&amp;</code> before <code>cl.Start</code>."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1429975092, "post_id": 29866808, "comment_id": 47858788, "body": "But I would like to use a pointer as the struct is bigger than in the example. Do I need a new identifier with the pointer? e.g clpointer := &amp;cl"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429987344, "post_id": 29866808, "comment_id": 47863499, "body": "If you explicitly want to use a pointer to the struct I&#39;d just have done <code>cl := &amp;Some{}</code>."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430075492, "post_id": 29866808, "comment_id": 47888482, "body": "@DaveC Well there are several operations on Some{} before to actually call Start thus the reason why it&#39;s not a pointer from the beginning."}], "answers": [{"comments": [{"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1429977174, "post_id": 29867141, "comment_id": 47859556, "body": "The first explanation is pointless because I clearly tried to use a pointer value on a pointer method not a value on pointer method. <code>(&amp;x).m()</code> works though &amp;.m() felt more natural to me. Any idea why &amp;x.m() is not working? I mean what does the compiler see on <code>&amp;x.m()</code>."}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1429979202, "post_id": 29867141, "comment_id": 47860347, "body": "I haven&#39;t been able to find anything in the spec that explainsthis behaviour, however the error indicates that <code>cl.Start(&quot;&quot;) </code> runs before the address operator is applied seeing that Start() returns 2 values. If you change it return a single value you will get <code>cannot take the address of cl.Start(&quot;&quot;)</code> as an error which further confirms this."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1429992931, "post_id": 29867141, "comment_id": 47865373, "body": "@Theuserwithnohat the first explanation isn&#39;t pointless, because that&#39;s how Go works. Your value is addressable, so it&#39;s automatically referenced for pointer receiver method calls. You almost never need to explicitly use the <code>&amp;</code> for a method."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 1, "last_activity_date": 1429975885, "creation_date": 1429975885, "answer_id": 29867141, "question_id": 29866808, "link": "https://stackoverflow.com/questions/29866808/multiple-value-in-single-value-context-go/29867141#29867141", "title": "multiple-value in single-value context (go)", "body": "<p>As already stated in the comment, remove the &amp; from &amp;cl.Start(\"\") and it will work - though you'l then get an error about err being declared and not used.</p>\n\n<p>Or you can write it as <code>(&amp;cl).Start(\"\")</code> and that too will work.</p>\n\n<p>The explanation is <a href=\"https://golang.org/doc/effective_go.html#methods\" rel=\"nofollow\">here</a>:</p>\n\n<blockquote>\n  <p>The rule about pointers vs. values for receivers is that value methods can be invoked on pointers and values, but pointer methods can only be invoked on pointers.</p>\n  \n  <p>This rule arises because pointer methods can modify the receiver;\n  invoking them on a value would cause the method to receive a copy of\n  the value, so any modifications would be discarded. The language\n  therefore disallows this mistake. <strong>There is a handy exception, though.\n  When the value is addressable, the language takes care of the common\n  case of invoking a pointer method on a value by inserting the address\n  operator automatically.</strong></p>\n</blockquote>\n\n<p>and also <a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow\">here</a>:</p>\n\n<blockquote>\n  <p>A method call x.m() is valid if the method set of (the type of) x contains m and the argument list can be assigned to the parameter list of m. If x is addressable and &amp;x's method set contains m, x.m() is shorthand for (&amp;x).m()</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 183, "user_id": 2442282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70e2ccc2b68213ec050b5ea239fc3fd6?s=128&d=identicon&r=PG", "display_name": "Jon Molnar", "link": "https://stackoverflow.com/users/2442282/jon-molnar"}, "is_accepted": true, "score": 1, "last_activity_date": 1430242882, "creation_date": 1430242882, "answer_id": 29926311, "question_id": 29866808, "link": "https://stackoverflow.com/questions/29866808/multiple-value-in-single-value-context-go/29926311#29926311", "title": "multiple-value in single-value context (go)", "body": "<p>It's an operator precedence thing. <code>&amp;cl.Start()</code> is the same as <code>&amp;(cl.Start())</code>, which isn't what you want.</p>\n\n<p>Use parentheses to clarify that what you want is <code>(&amp;cl).Start()</code>.</p>\n\n<p>Or you could just use a pointer variable.</p>\n\n<pre><code>func main() {\n    cl := &amp;Some{}\n    r, err := cl.Start(\"\")\n    fmt.Println(r)\n}\n</code></pre>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3021, "favorite_count": 1, "accepted_answer_id": 29926311, "answer_count": 2, "score": -2, "last_activity_date": 1430242882, "creation_date": 1429974058, "question_id": 29866808, "link": "https://stackoverflow.com/questions/29866808/multiple-value-in-single-value-context-go", "title": "multiple-value in single-value context (go)", "body": "<p>The code below returns the error <code>multiple-value  in single-value context</code>. I fail to understand why because it can't be more clear that the function has one argument ( I pass an empty string \"\"), and returns a string and an error (I assign it to <code>r</code> and <code>err</code>).</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Some struct{}\n\nfunc main() {\n\n    cl := Some{}\n    r, err := &amp;cl.Start(\"\")\n    fmt.Println(r)\n}\n\nfunc (cs *Some) Start(sg string) (string, error) {\n    return sg, nil\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo", "martini"], "answers": [{"comments": [{"owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "edited": false, "score": 0, "creation_date": 1430306379, "post_id": 29936147, "comment_id": 48005009, "body": "I use this connection for every request: <code>sessionPerRequest = mainSessionForSave.Copy()</code>, so I don&#39;t need to close it before all site will be terminated. All nodes are available."}], "tags": [], "owner": {"reputation": 415, "user_id": 2981904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/08200a764edc239f888b61e027aca04e?s=128&d=identicon&r=PG", "display_name": "makhov", "link": "https://stackoverflow.com/users/2981904/makhov"}, "is_accepted": false, "score": 0, "last_activity_date": 1430289795, "creation_date": 1430289795, "answer_id": 29936147, "question_id": 29865895, "link": "https://stackoverflow.com/questions/29865895/read-from-secondary-with-mgo-monotonic/29936147#29936147", "title": "read from secondary with mgo.Monotonic", "body": "<p>You forget to close connections after use it:</p>\n\n<pre><code>defer mainSessionForSave.Close()\n</code></pre>\n\n<p>Probably, it may be a reason.</p>\n\n<p>P.S. make sure that all your nodes is available :)</p>\n"}, {"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 5, "last_activity_date": 1442980737, "last_edit_date": 1442980737, "creation_date": 1430535243, "answer_id": 29997869, "question_id": 29865895, "link": "https://stackoverflow.com/questions/29865895/read-from-secondary-with-mgo-monotonic/29997869#29997869", "title": "read from secondary with mgo.Monotonic", "body": "<p>The <code>sessionPerRequest</code> is only created once: <code>prepareMartini</code> is called at server startup, and <code>sessionPerRequest</code> is set then. The closures passed to <code>m.Get()</code> access that variable. Then, after the first write (during your test setup), <a href=\"https://labix.org/mgo\" rel=\"nofollow\"><code>mgo</code> will only access the primary</a>:</p>\n\n<blockquote>\n  <p>Monotonic consistency will start reading from a slave if possible, so that the load is better distributed, and <em>once the first write happens the connection is switched to the master</em>.</p>\n</blockquote>\n\n<p>(If <code>mgo</code> just continued reading from the secondary after writing to the primary, a read wouldn't necessarily reflect a write you just made, which could be a pain. And switching to the primary should only get you <em>newer</em> data than you were getting from the secondary, never older, which preserves monotonicity. That's how it should ideally work, anyway; see the \"open issues\" link below for more.) </p>\n\n<p>The solution is to push creating the session down into your handlers, e.g., remove <code>sessionPerRequest</code> and put something explicit atop each handler, like</p>\n\n<pre><code>coll := mainSessionForSave.Copy().DB(dbName).Collection(collName)\n</code></pre>\n\n<p>All consistency promises should be read in light of <a href=\"https://aphyr.com/posts/322-call-me-maybe-mongodb-stale-reads\" rel=\"nofollow\">open issues with MongoDB consistency</a>: right now, during network partitions, reads can see old data and writes that will later be rolled back, even when <code>mgo</code> is trying to read from the primary. (Compare-and-set doesn't have this issue, but of course that's a larger slower operation.) It's also worth perusing that post just for the discussion of the consistency levels and the descriptions of how different database behaviors might manifest for an app's end-users.</p>\n"}], "owner": {"reputation": 11529, "user_id": 1024794, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/8237daabaa73dc7fc573fc224d0f1b54?s=128&d=identicon&r=PG", "display_name": "Maxim Yefremov", "link": "https://stackoverflow.com/users/1024794/maxim-yefremov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2847, "favorite_count": 1, "accepted_answer_id": 29997869, "answer_count": 2, "score": 5, "last_activity_date": 1442980737, "creation_date": 1429968916, "last_edit_date": 1592644375, "question_id": 29865895, "link": "https://stackoverflow.com/questions/29865895/read-from-secondary-with-mgo-monotonic", "title": "read from secondary with mgo.Monotonic", "body": "<p>I am trying to configure reading from primary and two secondary nodes of mongo replica set to provide better load balancing. Each of 3 nodes are on different machines with IP addresses: ip1, ip2, ip3.</p>\n<p>My <code>GoLang</code> site, which is the <code>martini</code> web server with two urls <code>/insert</code> and <code>/get</code>:</p>\n<pre><code>package main\n\nimport (\n    &quot;github.com/go-martini/martini&quot;\n    &quot;gopkg.in/mgo.v2&quot;\n    &quot;gopkg.in/mgo.v2/bson&quot;\n    &quot;net/http&quot;\n)\n\nconst (\n    dialStr        = &quot;ip1:port1,ip2:port2,ip3:port3&quot;\n    dbName         = &quot;test&quot;\n    collectionName = &quot;test&quot;\n    elementsCount  = 1000\n)\n\nvar mainSessionForSave *mgo.Session\n\nfunc ConnectToMongo() {\n    var err error\n    mainSessionForSave, err = mgo.Dial(dialStr)\n    mainSessionForSave.SetMode(mgo.Monotonic, true)\n    if err != nil {\n        panic(err)\n    }\n}\n\nfunc GetMgoSessionPerRequest() *mgo.Session {\n    var sessionPerRequest *mgo.Session\n    sessionPerRequest = mainSessionForSave.Copy()\n    return sessionPerRequest\n}\n\nfunc main() {\n    ConnectToMongo()\n    prepareMartini().Run()\n}\n\ntype Element struct {\n    I int `bson:&quot;I&quot;`\n}\n\nfunc prepareMartini() *martini.ClassicMartini {\n    m := martini.Classic()\n    sessionPerRequest := GetMgoSessionPerRequest()\n    m.Get(&quot;/insert&quot;, func(w http.ResponseWriter, r *http.Request) {\n        for i := 0; i &lt; elementsCount; i++ {\n            e := Element{I: i}\n            err := collection(sessionPerRequest).Insert(&amp;e)\n            if err != nil {\n                panic(err)\n            }\n        }\n        w.Write([]byte(&quot;data inserted successfully&quot;))\n    })\n    m.Get(&quot;/get&quot;, func(w http.ResponseWriter, r *http.Request) {\n        var element Element\n        const findI = 500\n        err := collection(sessionPerRequest).Find(bson.M{&quot;I&quot;: findI}).One(&amp;element)\n        if err != nil {\n            panic(err)\n        }\n        w.Write([]byte(&quot;get data successfully&quot;))\n\n    })\n\n    return m\n}\n\nfunc collection(s *mgo.Session) *mgo.Collection {\n    return s.DB(dbName).C(collectionName)\n}\n</code></pre>\n<p>I run this <code>GoLang</code> site with the command <code>go run site.go</code> and to prepare my experiment requested <code>http://localhost:3000/insert</code> - after about a minute my test data was inserted.</p>\n<p>Then I started to test reading from secondary and primary nodes\nin <code>attacker.go</code>:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;time&quot;\n\n    vegeta &quot;github.com/tsenart/vegeta/lib&quot;\n)\n\nfunc main() {\n\n    rate := uint64(4000) // per second\n    duration := 4 * time.Second\n    targeter := vegeta.NewStaticTargeter(&amp;vegeta.Target{\n        Method: &quot;GET&quot;,\n        URL:    &quot;http://localhost:3000/get&quot;,\n    })\n    attacker := vegeta.NewAttacker()\n\n    var results vegeta.Results\n    for res := range attacker.Attack(targeter, rate, duration) {\n        results = append(results, res)\n    }\n\n    metrics := vegeta.NewMetrics(results)\n    fmt.Printf(&quot;99th percentile: %s\\n&quot;, metrics.Latencies.P99)\n}\n</code></pre>\n<p>Running it <code>go run attacker.go</code> I just requested URL <code>http://localhost:3000/get</code> <strong>4000</strong> times per second. While attacker was working I opened all my 3 servers and run <code>htop</code> command to watch resources consumption. The PRIMARY node shows that it is under high load with CPU about 80%. The SECONDARIES were calm.</p>\n<h2>Why?</h2>\n<p>As I used <code>mgo.Monotonic</code> ...</p>\n<pre><code>mainSessionForSave.SetMode(mgo.Monotonic, true)\n</code></pre>\n<p>... I expected to read from all nodes: <code>ip1, ip2, ip3</code> and I expected to watch all the nodes under equal load and  with equal CPU consumption. But it is not so. What did I configure wrong? In fact <code>mgo.Monotonic</code> is not working in my case and I read only from the <strong>PRIMARY</strong> node.</p>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 68230, "user_id": 1426056, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3ac815b6fca201737db888a28efd7248?s=128&d=identicon&r=PG", "display_name": "waitingkuo", "link": "https://stackoverflow.com/users/1426056/waitingkuo"}, "edited": false, "score": 1, "creation_date": 1430024489, "post_id": 29866050, "comment_id": 47872754, "body": "To set cookies and check the redirect status number"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1429969959, "creation_date": 1429969959, "answer_id": 29866050, "question_id": 29865691, "link": "https://stackoverflow.com/questions/29865691/can-i-check-response-when-the-request-is-redirected/29866050#29866050", "title": "Can I check response when the request is redirected?", "body": "<p>What do you want to do with the first response? It will be pretty boring.</p>\n\n<p>I think the most sensible thing would be to disable automatically following redirects (always return a non-nil error from <code>CheckRedirect</code>) and handle the redirection yourself in which case you have full access to all requests/responses.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 2, "last_activity_date": 1429970032, "creation_date": 1429970032, "answer_id": 29866064, "question_id": 29865691, "link": "https://stackoverflow.com/questions/29865691/can-i-check-response-when-the-request-is-redirected/29866064#29866064", "title": "Can I check response when the request is redirected?", "body": "<p>The way it is currently implemented, it doesn't seem possible to have a look at the response by default (unless you implement yourself what <code>Do()</code> does).<br>\nSee <a href=\"https://github.com/golang/go/blob/debe12cfcf9e0672bce0972cc22ff093f215ac59/src/net/http/client.go#L384-L399\" rel=\"nofollow\"><code>src/net/http/client.go#L384-L399</code></a>:</p>\n\n<pre><code>if shouldRedirect(resp.StatusCode) {\n        // Read the body if small so underlying TCP connection will be re-used.\n        // No need to check for errors: if it fails, Transport won't reuse it anyway.\n        const maxBodySlurpSize = 2 &lt;&lt; 10\n        if resp.ContentLength == -1 || resp.ContentLength &lt;= maxBodySlurpSize {\n            io.CopyN(ioutil.Discard, resp.Body, maxBodySlurpSize)\n        }\n        resp.Body.Close()\n        if urlStr = resp.Header.Get(\"Location\"); urlStr == \"\" {\n            err = fmt.Errorf(\"%d response missing Location header\", resp.StatusCode)\n            break\n        }\n        base = req.URL\n        via = append(via, req)\n        continue\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 906, "user_id": 5072722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/607ed64cbd8e7a4cc2035a865b6cb5b2?s=128&d=identicon&r=PG", "display_name": "Arnie97", "link": "https://stackoverflow.com/users/5072722/arnie97"}, "is_accepted": false, "score": 0, "last_activity_date": 1609965121, "creation_date": 1609965121, "answer_id": 65602994, "question_id": 29865691, "link": "https://stackoverflow.com/questions/29865691/can-i-check-response-when-the-request-is-redirected/65602994#65602994", "title": "Can I check response when the request is redirected?", "body": "<p>My workaround for this:</p>\n<p>Any http request / response could be patched within a custom <code>RoundTripper</code>, including redirects:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type RedirectChecker struct{}\n\nfunc (RedirectChecker) RoundTrip(req *http.Request) (*http.Response, error) {\n    // e.g. patch the request before send it\n    req.Header.Set(&quot;user-agent&quot;, &quot;curl/7.64.1&quot;)\n\n    resp, err := http.DefaultTransport.RoundTrip(req)\n\n    if err == nil &amp;&amp; resp != nil {\n        switch resp.StatusCode {\n        case\n            http.StatusMovedPermanently,\n            http.StatusFound,\n            http.StatusTemporaryRedirect,\n            http.StatusPermanentRedirect:\n\n            // e.g. stop further redirections\n            // roughly equivalent to http.ErrUseLastResponse\n            resp.StatusCode = http.StatusOK\n\n            // e.g. read the Set-Cookie headers\n            // unfortunately cookie jars do not handle redirects in a proper manner\n            // and that's why I came to this question...\n            fmt.Printf(&quot;%+v&quot;, resp.Cookies())\n        }\n    }\n}\n</code></pre>\n<pre><code>httpClient := &amp;http.Client{Transport: RedirectChecker{}}\nhttpClient.Do(...)\n</code></pre>\n"}], "owner": {"reputation": 68230, "user_id": 1426056, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/3ac815b6fca201737db888a28efd7248?s=128&d=identicon&r=PG", "display_name": "waitingkuo", "link": "https://stackoverflow.com/users/1426056/waitingkuo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1609965121, "creation_date": 1429967826, "last_edit_date": 1573288015, "question_id": 29865691, "link": "https://stackoverflow.com/questions/29865691/can-i-check-response-when-the-request-is-redirected", "title": "Can I check response when the request is redirected?", "body": "<p>We can register <a href=\"http://golang.org/pkg/net/http/#Client\" rel=\"nofollow\">CheckRedirect</a> to check the next request when the request is redirected. Is there a way that I can get the response for the first request when it's redirected?</p>\n"}, {"tags": ["json", "go", "marshalling", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "edited": false, "score": 0, "creation_date": 1430007207, "post_id": 29859693, "comment_id": 47869381, "body": "Have to disagree strongly with this answer.  Iterator order does not explain the difference: <code>reflect.DeepEqual</code> is perfectly capable of comparing maps.  The implementation starting in <a href=\"http://golang.org/src/reflect/deepequal.go#L101\" rel=\"nofollow noreferrer\">golang.org/src/reflect/deepequal.go#L101</a> to around line 116 shows that the map comparison isn&#39;t affected by iteration order.  lossleader&#39;s answer is correct."}, {"owner": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "edited": false, "score": 0, "creation_date": 1430008106, "post_id": 29859693, "comment_id": 47869571, "body": "That is, this is encouraging the mistaken assumption that the original questioner had over the behavior of <code>reflect.DeepEqual</code>.  The questioner is attributing the inequality to the observation that the two values are printing differently.  In actuality, it is the difference in numeric <i>type</i> that&#39;s significant.  <code>reflect.DeepEqual</code> doesn&#39;t care how a value gets printed."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1429922373, "creation_date": 1429922373, "answer_id": 29859693, "question_id": 29859625, "link": "https://stackoverflow.com/questions/29859625/how-do-you-unmarshall-into-the-correct-order-in-go/29859693#29859693", "title": "How do you Unmarshall into the correct order in Go?", "body": "<blockquote>\n  <p><a href=\"http://golang.org/ref/spec\" rel=\"nofollow\">The Go Programming Language\n  Specification</a></p>\n  \n  <p><a href=\"http://golang.org/ref/spec#For_statements\" rel=\"nofollow\">For statements</a></p>\n  \n  <p>The iteration order over maps is not specified and is not guaranteed\n  to be the same from one iteration to the next.</p>\n</blockquote>\n\n<p>By design, the iteration order over maps is pseudorandom.</p>\n"}, {"comments": [{"owner": {"reputation": 729, "user_id": 2588765, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/663445966/picture?type=large", "display_name": "Scott Daniel", "link": "https://stackoverflow.com/users/2588765/scott-daniel"}, "edited": false, "score": 0, "creation_date": 1430087212, "post_id": 29859919, "comment_id": 47892641, "body": "I&#39;ve tested with the change you suggested and it does indeed pass the DeepEqual despite the fact that the displayed map order is different. Thanks for your help.  An interesting note is that although the display is out of order, if you Marshal back to a string, the order is always restored. In other words, internally the data must be in the original order. Only the println display is out of order."}, {"owner": {"reputation": 12177, "user_id": 1269466, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JYgWN.png?s=128&g=1", "display_name": "lossleader", "link": "https://stackoverflow.com/users/1269466/lossleader"}, "reply_to_user": {"reputation": 729, "user_id": 2588765, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/663445966/picture?type=large", "display_name": "Scott Daniel", "link": "https://stackoverflow.com/users/2588765/scott-daniel"}, "edited": false, "score": 0, "creation_date": 1430090956, "post_id": 29859919, "comment_id": 47893716, "body": "I had to look to be sure, but really go is sorting to canonicalize json format when marshalling: <a href=\"http://golang.org/src/encoding/json/encode.go#L612\" rel=\"nofollow noreferrer\">golang.org/src/encoding/json/encode.go#L612</a> so quite a few go structs (in terms of types) map to a particular json representation which can then be unmarshalled to a specific go struct (in terms of types) that still has randomly ordered maps during runtime iteration.. A fun interface between strong typing + loose ordering and strong ordering + loose typing."}], "tags": [], "owner": {"reputation": 12177, "user_id": 1269466, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JYgWN.png?s=128&g=1", "display_name": "lossleader", "link": "https://stackoverflow.com/users/1269466/lossleader"}, "is_accepted": false, "score": 3, "last_activity_date": 1429924789, "creation_date": 1429924789, "answer_id": 29859919, "question_id": 29859625, "link": "https://stackoverflow.com/questions/29859625/how-do-you-unmarshall-into-the-correct-order-in-go/29859919#29859919", "title": "How do you Unmarshall into the correct order in Go?", "body": "<p>The order of the map isn't why it is not equal. (If you unmarshall twice you will get two deeply equal maps that still differ randomly in order.)</p>\n\n<p><a href=\"http://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow\">Unmarshalling a json number is float64</a>:</p>\n\n<pre><code>float64, for JSON numbers\n</code></pre>\n\n<p>It will work if you change your code as follows:</p>\n\n<pre><code>var num float64 = 0;\nj := map[string]interface{}{\n    \"A\": map[string]interface{}{\"a\": num+1, \"b\": num+2, \"c\": num+3},\n    \"B\": map[string]interface{}{\"a\": num+1, \"b\": num+2, \"c\": num+3},\n    \"C\": map[string]interface{}{\n        \"a\": map[string]interface{}{\"a\": num+1, \"b\": num+2, \"c\": num+3},\n        \"b\": map[string]interface{}{\"a\": num+1, \"b\": num+2, \"c\": num+3},\n        \"c\": map[string]interface{}{\"a\": num+1, \"b\": num+2, \"c\": num+3},\n    },\n}\n</code></pre>\n\n<p>You can then change the type of num to anything else and it will fail.</p>\n"}], "owner": {"reputation": 729, "user_id": 2588765, "user_type": "registered", "accept_rate": 0, "profile_image": "https://graph.facebook.com/663445966/picture?type=large", "display_name": "Scott Daniel", "link": "https://stackoverflow.com/users/2588765/scott-daniel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 931, "favorite_count": 2, "answer_count": 2, "score": 2, "last_activity_date": 1429924789, "creation_date": 1429921748, "last_edit_date": 1429922142, "question_id": 29859625, "link": "https://stackoverflow.com/questions/29859625/how-do-you-unmarshall-into-the-correct-order-in-go", "title": "How do you Unmarshall into the correct order in Go?", "body": "<p>It seems that if I have an interface{} in Go in a particular order and I Marshal it into a []byte and then Unmarshal it back into an interface{}, it should retain the original order. It does not. The result is that DeepEqual fails to match the two as you can see in the program below.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    var jd interface{}\n\n    j := map[string]interface{}{\n        \"A\": map[string]interface{}{\"a\": 1, \"b\": 2, \"c\": 3},\n        \"B\": map[string]interface{}{\"a\": 1, \"b\": 2, \"c\": 3},\n        \"C\": map[string]interface{}{\n            \"a\": map[string]interface{}{\"a\": 1, \"b\": 2, \"c\": 3},\n            \"b\": map[string]interface{}{\"a\": 1, \"b\": 2, \"c\": 3},\n            \"c\": map[string]interface{}{\"a\": 1, \"b\": 2, \"c\": 3},\n        },\n    }\n\n    s, _ := json.Marshal(j)\n    _ = json.Unmarshal(s, &amp;jd)\n\n    fmt.Println(string(s))\n    fmt.Println(j)\n    fmt.Println(jd)\n    if !reflect.DeepEqual(j, jd) {\n        fmt.Println(\"Fail!\")\n    }\n}\n</code></pre>\n\n<p>The results from this program are random, but this is a typical result:</p>\n\n<pre><code>{\"A\":{\"a\":1,\"b\":2,\"c\":3},\"B\":{\"a\":1,\"b\":2,\"c\":3},\"C\":{\"a\":{\"a\":1,\"b\":2,\"c\":3},\"b\":{\"a\":1,\"b\":2,\"c\":3},\"c\":{\"a\":1,\"b\":2,\"c\":3}}}\n\nmap[B:map[a:1 b:2 c:3] C:map[c:map[a:1 b:2 c:3] a:map[b:2 c:3 a:1] b:map[a:1 b:2 c:3]] A:map[c:3 a:1 b:2]]\n\nmap[A:map[a:1 b:2 c:3] B:map[a:1 b:2 c:3] C:map[b:map[c:3 a:1 b:2] c:map[a:1 b:2 c:3] a:map[a:1 b:2 c:3]]]\n\nFail!\n</code></pre>\n\n<p>As you can see, the values Marshal into the original order, but Unmarshal into a random order (multiple runs of this program will produce different results). The result is that the DeepEqual comparison fails every time (so far).</p>\n\n<p>Is this a bug in Go? Does anyone have a workaround that they can suggest?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1429923774, "post_id": 29859453, "comment_id": 47845467, "body": "Omit the trailing slash in &quot;/static/&quot;? Other than that, you could try adding some Printfs into the router module to see what&#39;s going on."}], "answers": [{"comments": [{"owner": {"reputation": 1652, "user_id": 4743327, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/9FOL2.jpg?s=128&g=1", "display_name": "Croaton", "link": "https://stackoverflow.com/users/4743327/croaton"}, "edited": false, "score": 1, "creation_date": 1429974089, "post_id": 29863746, "comment_id": 47858440, "body": "<code>panic: path must end with &#47;*filepath in path &#39;*filepath&#39;</code> if &quot;/*filepath&quot; than <code>panic: path segment &#39;&#47;&#39; conflicts with existing wildcard &#39;&#47;*filepath&#39; in path &#39;&#47;&#39;</code>"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 1652, "user_id": 4743327, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/9FOL2.jpg?s=128&g=1", "display_name": "Croaton", "link": "https://stackoverflow.com/users/4743327/croaton"}, "edited": false, "score": 0, "creation_date": 1429975923, "post_id": 29863746, "comment_id": 47859110, "body": "Can you try router.ServeFiles(&quot;static/*filepath&quot;, http.Dir(&quot;/&quot;)) or  maybe router.ServeFiles(&quot;/static/*filepath&quot;, http.Dir(&quot;&quot;)) to be more coherent with template. Any way don&#39;t mention /static/ twice because /reminder/path appends with  /root"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 2, "last_activity_date": 1429956149, "creation_date": 1429956149, "answer_id": 29863746, "question_id": 29859453, "link": "https://stackoverflow.com/questions/29859453/httprouter-trouble-with-static-files/29863746#29863746", "title": "Httprouter trouble with static files", "body": "<p>In call <code>router.ServeFiles(\"/static/*filepath\", http.Dir(\"/static/\"))</code> second argument provide root and first arg define the path <strong>from that root</strong>. So , try</p>\n\n<pre><code>router.ServeFiles(\"*filepath\", http.Dir(\"/static\"))\n</code></pre>\n\n<p>without mentioning <em>/static/</em> twice.</p>\n"}, {"tags": [], "owner": {"reputation": 3201, "user_id": 2616179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb90669caa64288bdb5767f736152bbe?s=128&d=identicon&r=PG", "display_name": "Makpoc", "link": "https://stackoverflow.com/users/2616179/makpoc"}, "is_accepted": true, "score": 5, "last_activity_date": 1430151698, "last_edit_date": 1592644375, "creation_date": 1430151054, "answer_id": 29900833, "question_id": 29859453, "link": "https://stackoverflow.com/questions/29859453/httprouter-trouble-with-static-files/29900833#29900833", "title": "Httprouter trouble with static files", "body": "<p>Try to replace <code>http.Dir(&quot;/static/&quot;)</code> with <code>http.Dir(&quot;static&quot;)</code> (which will be the relative path to your static dir) or with <code>http.Dir(&quot;/absolute/path/to/static&quot;)</code>. Your example with this single change works for me.</p>\n<p>Also see httprouter's ServeFiles documentation:</p>\n<blockquote>\n<p><a href=\"http://godoc.org/github.com/julienschmidt/httprouter#Router.ServeFiles\" rel=\"nofollow noreferrer\">func (r *Router) ServeFiles(path string, root http.FileSystem)</a></p>\n<p>ServeFiles serves files from the given file system root. The path must   end with &quot;/*filepath&quot;, files are then served from the local path /defined/root/dir/*filepath. For example if root is &quot;/etc&quot; and *filepath is &quot;passwd&quot;, the local file &quot;/etc/passwd&quot; would be served. Internally a http.FileServer is used, therefore http.NotFound is used instead of the Router's NotFound handler. To use the operating system's file system implementation, use http.Dir:</p>\n<p>router.ServeFiles(&quot;/src/*filepath&quot;, http.Dir(&quot;/var/www&quot;))</p>\n</blockquote>\n<p>This might also be of help - <a href=\"https://stackoverflow.com/questions/24849844/third-party-router-and-static-files\">Third-party router and static files</a></p>\n<p>I must admit that it's unclear to me why 'static' is needed twice. If I set http.Dir to &quot;.&quot; it all works with the single difference that I need to navigate to localhost:3001/static/static/style.css</p>\n"}, {"tags": [], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "is_accepted": false, "score": 0, "last_activity_date": 1528747225, "creation_date": 1528747225, "answer_id": 50805189, "question_id": 29859453, "link": "https://stackoverflow.com/questions/29859453/httprouter-trouble-with-static-files/50805189#50805189", "title": "Httprouter trouble with static files", "body": "<p>This is how I got it working:</p>\n\n<pre><code>func main() {\n    router := httprouter.New()\n    router.GET(\"/\", Index)\n    router.ServeFiles(\"/static/*filepath\",http.Dir(\"static\"))\n\n    log.Fatal(http.ListenAndServe(\":3001\", router))\n}\n</code></pre>\n"}], "owner": {"reputation": 1652, "user_id": 4743327, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/9FOL2.jpg?s=128&g=1", "display_name": "Croaton", "link": "https://stackoverflow.com/users/4743327/croaton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3101, "favorite_count": 2, "accepted_answer_id": 29900833, "answer_count": 3, "score": 2, "last_activity_date": 1614272292, "creation_date": 1429920310, "last_edit_date": 1430430698, "question_id": 29859453, "link": "https://stackoverflow.com/questions/29859453/httprouter-trouble-with-static-files", "title": "Httprouter trouble with static files", "body": "<p>I'm using a router (<a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow\">httprouter</a>) and would like to serve static files from root.</p>\n\n<p><em>css file in</em> </p>\n\n<p><code>static/style.css</code></p>\n\n<p><em>in template</em> </p>\n\n<p><code>&lt;link href=\"./static/style.css\" rel=\"stylesheet\"&gt;</code></p>\n\n<p><em>main.go</em> </p>\n\n<pre><code>router := httprouter.New()\nrouter.ServeFiles(\"/static/*filepath\", http.Dir(\"/static/\"))\nrouter.GET(\"/\", Index)\n</code></pre>\n\n<p>But <a href=\"http://localhost:3001/static/style.css\" rel=\"nofollow\">http://localhost:3001/static/style.css</a> gives me an 404 error and style in render page doesn't work too. </p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 10925, "user_id": 723947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8b898a5dde625380e861e3719e50a4c?s=128&d=identicon&r=PG", "display_name": "dyoo", "link": "https://stackoverflow.com/users/723947/dyoo"}, "is_accepted": false, "score": -1, "last_activity_date": 1429992055, "last_edit_date": 1429992055, "creation_date": 1429991753, "answer_id": 29870020, "question_id": 29859001, "link": "https://stackoverflow.com/questions/29859001/app-engine-datastore-how-to-set-multiple-values-on-a-property-using-golang/29870020#29870020", "title": "App Engine Datastore: How to set multiple values on a property using golang?", "body": "<p>Your program is syntactically malformed.</p>\n\n<p>Are you sure you're running the code you think you're running?  For example, your <code>Post</code> doesn't have necessary commas that delimit the key/value pairs.</p>\n\n<p>A <code>go fmt</code> should be reporting syntax errors.</p>\n\n<p>Also, <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#Put\" rel=\"nofollow\"><code>datastore.Put()</code></a> returns multiple values (the key and the error), and the code is only expecting a single value.  You <em>should</em> be getting compile-time errors at this point.</p>\n\n<p>Correct those issues first: there no point chasing after phantom semantic errors when the program doesn't compile.  Here is a version of your program that doesn't raise compile-time errors.</p>\n\n<pre><code>package hello\n\nimport (\n    \"appengine\"\n    \"appengine/datastore\"\n    \"fmt\"\n    \"net/http\"\n)\n\ntype Post struct {\n    Title     string\n    UpVotes   []int64 `json:\"-\" xml:\"-\" datastore:\",multiple\"`\n    DownVotes []int64 `json:\"-\" xml:\"-\" datastore:\",multiple\"`\n}\n\nfunc init() {\n    http.HandleFunc(\"/\", handler)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n    p := &amp;Post{\n        Title:     \"name\",\n        UpVotes:   []int64{23, 45, 67, 89, 10},\n        DownVotes: []int64{90, 87, 65, 43, 21, 123},\n    }\n    k := datastore.NewIncompleteKey(c, \"Post\", nil)\n    key, err := datastore.Put(c, k, p)\n\n    fmt.Fprintln(w, \"hello world\")\n    fmt.Fprintln(w, key)\n    fmt.Fprintln(w, err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1430047015, "last_edit_date": 1430047015, "creation_date": 1429992978, "answer_id": 29870246, "question_id": 29859001, "link": "https://stackoverflow.com/questions/29859001/app-engine-datastore-how-to-set-multiple-values-on-a-property-using-golang/29870246#29870246", "title": "App Engine Datastore: How to set multiple values on a property using golang?", "body": "<p>Multi-valued properties are supported by AppEngine by default, you don't need to do anything special to make it work. You don't need to implement the <code>PropertyLoadSaver</code> interface, and you don't need any special tag value.</p>\n\n<p>If a struct field is of a slice type, it will automatically be a multi-valued property. This code works:</p>\n\n<pre><code>type Post struct {\n    Title         string\n    UpVotes       []int64\n    DownVotes     []int64\n}\n\nc := appengine.NewContext(r)\np := &amp;Post{\n    Title: \"name\",\n    UpVotes: []int64{23, 45, 67, 89, 10},\n    DownVotes: []int64{90, 87, 65, 43, 21, 123},\n}\nk := datastore.NewIncompleteKey(c, \"Post\", nil)\nkey, err := datastore.Put(c, k, p)\nc.Infof(\"Result: key: %v, err: %v\", key, err)\n</code></pre>\n\n<p>Of course if you want you can specify tag value for json and xml:</p>\n\n<pre><code>type Post struct {\n    Title         string\n    UpVotes       []int64 `json:\"-\" xml:\"-\"`\n    DownVotes     []int64 `json:\"-\" xml:\"-\"`\n}\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<p>But please note that multi-valued properties are not suitable to store a large number of values if the property is indexed. Doing so would require many indices (many writes) to store and modify the entity, and potentially you could hit the index limit for an entity (see <a href=\"https://cloud.google.com/appengine/docs/go/datastore/indexes#Go_Index_limits\" rel=\"nofollow\">Index limits and Exploding indexes</a> for more details).</p>\n\n<p>So for example you can't use a multi-valued property to store hundreds of up- and downvotes for a <code>Post</code>. For that you should store votes as separate/different entities linking to the <code>Post</code> e.g. by the <code>Key</code> of the <code>Post</code> or preferably just its <code>IntID</code>.</p>\n"}], "owner": {"reputation": 95, "user_id": 4306158, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-wUDz-f3lGzo/AAAAAAAAAAI/AAAAAAAAMyo/4BLbNFoaae4/photo.jpg?sz=128", "display_name": "EVILoptimist", "link": "https://stackoverflow.com/users/4306158/eviloptimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1025, "favorite_count": 1, "accepted_answer_id": 29870246, "answer_count": 2, "score": 0, "last_activity_date": 1474081813, "creation_date": 1429917114, "last_edit_date": 1474081813, "question_id": 29859001, "link": "https://stackoverflow.com/questions/29859001/app-engine-datastore-how-to-set-multiple-values-on-a-property-using-golang", "title": "App Engine Datastore: How to set multiple values on a property using golang?", "body": "<p>I am trying to save multiple values for a single property in Google's Datastore using Golang.</p>\n\n<p>I have a slice of int64 that I would like to be able to store and retrieve. From the documentation I can see that there is support for this by implementing the PropertyLoadSaver{} interface. But I cannot seem to come up with a correct implementation.</p>\n\n<p>Essentially, this is what I'd like to accomplish:</p>\n\n<pre><code>type Post struct {\n    Title         string\n    UpVotes       []int64 `json:\"-\" xml:\"-\" datastore:\",multiple\"`\n    DownVotes     []int64 `json:\"-\" xml:\"-\" datastore:\",multiple\"`\n}\n\nc := appengine.NewContext(r)\np := &amp;Post{\n    Title: \"name\"\n    UpVotes: []int64{23, 45, 67, 89, 10}\n    DownVotes: []int64{90, 87, 65, 43, 21, 123}\n}\nk := datastore.NewIncompleteKey(c, \"Post\", nil)\nerr := datastore.Put(c, k, p)\n</code></pre>\n\n<p>But without the \"datastore: invalid entity type\" error.</p>\n"}, {"tags": ["multithreading", "go", "thread-safety", "atomic"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1429918107, "last_edit_date": 1429918107, "creation_date": 1429916365, "answer_id": 29858886, "question_id": 29858774, "link": "https://stackoverflow.com/questions/29858774/atomic-operations-on-memory-mapped-files/29858886#29858886", "title": "Atomic operations on memory mapped files", "body": "<p>It's safe. For example, on <code>amd64</code>, it uses the <code>XCHG</code> instruction.</p>\n\n<blockquote>\n  <p><a href=\"http://golang.org/pkg/sync/atomic/#StoreUint64\" rel=\"nofollow\"><code>func StoreUint64</code></a></p>\n\n<pre><code>    func StoreUint64(addr *uint64, val uint64)\n</code></pre>\n  \n  <p><code>StoreUint64</code> atomically stores <code>val</code> into <code>*addr</code>.</p>\n</blockquote>\n\n<p><a href=\"http://golang.org/src/sync/atomic/asm_amd64.s\" rel=\"nofollow\"><code>src/sync/atomic/asm_amd64.s</code></a>;</p>\n\n<pre><code>TEXT \u00b7StoreUint64(SB),NOSPLIT,$0-16\n    MOVQ    addr+0(FP), BP\n    MOVQ    val+8(FP), AX\n    XCHGQ   AX, 0(BP)\n    RET\n</code></pre>\n\n<blockquote>\n  <p><strong>Intel 64 and IA-32 Architectures Software Developer's Manual</strong></p>\n  \n  <p><code>XCHG</code>\u2014Exchange Register/Memory with Register</p>\n  \n  <p>Description </p>\n  \n  <p>Exchanges the contents of the destination (first) and\n  source (second) operands. The operands can be two general-purpose\n  registers or a register and a memory location. If a memory operand is\n  referenced, the processor\u2019s locking protocol is automatically\n  implemented for the duration of the exchange operation, regardless of\n  the presence or absence of the LOCK prefix or of the value of the\n  IOPL.</p>\n</blockquote>\n"}], "owner": {"reputation": 755, "user_id": 939530, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a30a8d2393b01d10f87da492038d30f3?s=128&d=identicon&r=PG", "display_name": "dv1729", "link": "https://stackoverflow.com/users/939530/dv1729"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 323, "favorite_count": 1, "accepted_answer_id": 29858886, "answer_count": 1, "score": 3, "last_activity_date": 1429918412, "creation_date": 1429915696, "last_edit_date": 1429918412, "question_id": 29858774, "link": "https://stackoverflow.com/questions/29858774/atomic-operations-on-memory-mapped-files", "title": "Atomic operations on memory mapped files", "body": "<p>I'm using a memory mapped file and I need to use an atomic store on Go. I would use StoreUint64() if I were working on regularly allocated memory. However, I'm not sure how atomic operations work on memory mapped files.</p>\n\n<p>Is it safe to use StoreUint64() on memory mapped files?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1429911633, "post_id": 29857939, "comment_id": 47841876, "body": "The 404 that url gives is a pretty good indicator that it moved..."}, {"owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429914868, "post_id": 29857939, "comment_id": 47843153, "body": "But to where? I&#39;m not able to find it"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429915033, "post_id": 29857939, "comment_id": 47843205, "body": "It&#39;s been gone a long time. Maybe it&#39;s part of GoSublime?  Why not ask DisposaBoy if GoSublime is missing something."}], "answers": [{"comments": [{"owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "edited": false, "score": 0, "creation_date": 1430002997, "post_id": 29858695, "comment_id": 47868339, "body": "Hello Peter, sorry what do you mean by Command margo ?  I tried to access it but it gives me 404"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "edited": false, "score": 0, "creation_date": 1430004199, "post_id": 29858695, "comment_id": 47868629, "body": "@Marin: I&#39;ve added a direct link to the source code."}, {"owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "edited": false, "score": 0, "creation_date": 1430004489, "post_id": 29858695, "comment_id": 47868699, "body": "Thanks for the link. I was wondering if I need MarGo or not , seems that it is part of GoSublime which I have installed already."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1430004121, "last_edit_date": 1430004121, "creation_date": 1429915217, "answer_id": 29858695, "question_id": 29857939, "link": "https://stackoverflow.com/questions/29857939/margo-for-sublime/29858695#29858695", "title": "MarGo for Sublime", "body": "<p><a href=\"http://godoc.org/github.com/DisposaBoy/GoSublime/src/gosubli.me/margo\" rel=\"nofollow\">Command margo</a>: <code>github.com/DisposaBoy/GoSublime/src/gosubli.me/margo</code></p>\n\n<p><a href=\"https://github.com/DisposaBoy/GoSublime/tree/master/src/gosubli.me/margo\" rel=\"nofollow\">GoSublime/src/gosubli.me/margo</a>: <code>github.com/DisposaBoy/GoSublime/tree/master/src/gosubli.me/margo</code></p>\n"}], "owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1509, "favorite_count": 1, "closed_date": 1431711664, "accepted_answer_id": 29858695, "answer_count": 1, "score": 0, "last_activity_date": 1430004121, "creation_date": 1429911478, "last_edit_date": 1429915033, "question_id": 29857939, "link": "https://stackoverflow.com/questions/29857939/margo-for-sublime", "closed_reason": "Not suitable for this site", "title": "MarGo for Sublime", "body": "<p>I tried to install MarGo for GoSublime</p>\n\n<pre><code>go get github.com/DisposaBoy/MarGo\n</code></pre>\n\n<p>However it appears that the path is not correct. Has MarGo moved, or it's not needed anymore for GoSublime ?</p>\n\n<p><strong>Update</strong> MarGo is part of GoSublime apparently.</p>\n"}, {"tags": ["json", "struct", "go", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 965, "user_id": 4031602, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Colin Murphy", "link": "https://stackoverflow.com/users/4031602/colin-murphy"}, "edited": false, "score": 0, "creation_date": 1429908245, "post_id": 29857031, "comment_id": 47840122, "body": "That got it, thank you. Sorry for the accidental duplicate, I had no idea how common this issue was."}], "tags": [], "owner": {"reputation": 14981, "user_id": 2679935, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/wU0qy.jpg?s=128&g=1", "display_name": "julienc", "link": "https://stackoverflow.com/users/2679935/julienc"}, "is_accepted": true, "score": 3, "last_activity_date": 1429907823, "creation_date": 1429907823, "answer_id": 29857031, "question_id": 29856890, "link": "https://stackoverflow.com/questions/29856890/golang-struct-wont-marshal-to-json/29857031#29857031", "title": "Golang Struct Won&#39;t Marshal to JSON", "body": "<p>This is a common mistake: you did not export values in the <code>PodsCondensed</code> and <code>PodCondensed</code> structures, so the json package was not able to use it. Use a capital letter in the variable name to do so:</p>\n\n<pre><code>type PodsCondensed struct {\n    Pods    []PodCondensed  `json:\"pods\"`\n}\n\ntype PodCondensed struct {\n    Name    string      `json:\"name\"`\n    Colors  []string    `json:\"colors\"`\n}\n</code></pre>\n\n<ul>\n<li>Working example: <a href=\"http://play.golang.org/p/Lg3cTO7DVk\" rel=\"nofollow\">http://play.golang.org/p/Lg3cTO7DVk</a></li>\n<li>Documentation: <a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\">http://golang.org/pkg/encoding/json/#Marshal</a></li>\n</ul>\n"}], "owner": {"reputation": 965, "user_id": 4031602, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Colin Murphy", "link": "https://stackoverflow.com/users/4031602/colin-murphy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1233, "favorite_count": 0, "closed_date": 1429908598, "accepted_answer_id": 29857031, "answer_count": 1, "score": 2, "last_activity_date": 1429907823, "creation_date": 1429907278, "question_id": 29856890, "link": "https://stackoverflow.com/questions/29856890/golang-struct-wont-marshal-to-json", "closed_reason": "Duplicate", "title": "Golang Struct Won&#39;t Marshal to JSON", "body": "<p>I'm trying to marshal a struct in Go to JSON but it won't marshal and I can't understand why. </p>\n\n<p>My struct definitions</p>\n\n<pre><code>type PodsCondensed struct {\n    pods    []PodCondensed  `json:\"pods\"`\n}\n\nfunc (p *PodsCondensed) AddPod(pod PodCondensed) {\n    p.pods = append(p.pods, pod)\n}\n\ntype PodCondensed struct {\n    name    string      `json:\"name\"`\n    colors  []string    `json:\"colors\"`\n}\n</code></pre>\n\n<p>Creating and marshaling a test struct</p>\n\n<pre><code>fake_pods := PodsCondensed{}\n\nfake_pod := PodCondensed {\n    name: \"tier2\",\n    colors: []string{\"blue\", \"green\"},\n}\n\nfake_pods.AddPod(fake_pod)\nfmt.Println(fake_pods.pods)\n\njPods, _ := json.Marshal(fake_pods)\nfmt.Println(string(jPods))\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>[{tier2 [blue green]}]\n{}\n</code></pre>\n\n<p>I'm not sure what the issue is here, I export json data for all my structs, the data is being stored correctly and is available to print. It just wont marshal which is odd because everything contained in the struct can be marshaled to JSON on its own.</p>\n"}, {"tags": ["linux", "go", "gnu"], "answers": [{"comments": [{"owner": {"reputation": 40934, "user_id": 121687, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/359b919642638c5b67555a1bc89dfd3e?s=128&d=identicon&r=PG", "display_name": "fabrizioM", "link": "https://stackoverflow.com/users/121687/fabriziom"}, "edited": false, "score": 0, "creation_date": 1429919432, "post_id": 29857645, "comment_id": 47844507, "body": "Kudos for the exemplar explanation. So this would be used mainly by distribution package builders. Currently I use -X options to add identifier strings to the go application."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 7, "last_activity_date": 1429910202, "last_edit_date": 1495540708, "creation_date": 1429910202, "answer_id": 29857645, "question_id": 29856780, "link": "https://stackoverflow.com/questions/29856780/what-is-nt-gnu-build-id-used-for/29857645#29857645", "title": "What is NT_GNU_BUILD_ID used for?", "body": "<p>This comes from the <a href=\"https://github.com/golang/go/commit/1f9dbb60ef5cf8b0027c1149fdb1d6f08c41cfed\" rel=\"nofollow noreferrer\">massive conversion from C to Go of <code>cmd/new5l</code></a> (Feb. 2015), translated from <a href=\"https://github.com/golang/go/blob/30e36983f381e366e470d6c92e62e5804cbb9712/src/cmd/ld/pobj.c#L83\" rel=\"nofollow noreferrer\"><code>src/cmd/ld/pobj.c</code></a></p>\n\n<p>That information was introduced in <a href=\"https://github.com/golang/go/commit/7d507dc6e608e800bc26a5850259bbdb05abdf65\" rel=\"nofollow noreferrer\">commit 7d507dc6e</a> (Dec. 2013, for Go 1.3), a preparation for the new linker structure</p>\n\n<p><code>NT_GNU_BUILD_ID</code> is <a href=\"https://stackoverflow.com/a/9416478/6309\">mentioned here</a> as a unique build ID bitstring.<br>\nYou see it employed for instance in <a href=\"https://fedoraproject.org/wiki/Releases/FeatureBuildId\" rel=\"nofollow noreferrer\">Fedora release build</a></p>\n\n<blockquote>\n  <p>To embed an ID into both the stripped object and its <code>.debug</code> file, I've chosen to use an ELF note section.<br>\n  <code>strip</code> et al can keep the section intact in both files when its type is <code>SHT_NOTE</code>. </p>\n  \n  <p>The new section is canonically called <code>.note.gnu.build-id</code>, but the name is not normative, and the section can be merged with other <code>SHT_NOTE</code> sections.<br>\n  The ELF note headers give name \"<code>GNU</code>\" and type 3 (<code>NT_GNU_BUILD_ID</code>) for a build ID note, of which there can be only one in a linked object (or an <code>ET_REL</code> file of the <code>.ko</code> style).</p>\n</blockquote>\n\n<p>You can see it <a href=\"http://sourceware.org/ml/binutils/2007-07/msg00012.html\" rel=\"nofollow noreferrer\">introduced in this patch in 2007</a>:</p>\n\n<blockquote>\n  <p>This patch adds a new option to <code>ld</code> for ELF targets, <code>--build-id</code>.<br>\n  It generates a synthetic ELF note section containing \"<code>unique build ID</code>\" bits\n  chosen by <code>ld</code>.</p>\n  \n  <p>This is done as an <code>ld</code> option to be efficient and foolproof to enable for\n  every compilation (vs some script adding a generated object into the link).<br>\n  It's done the way it is so it can use no more and no less than the exact\n  final ELF bits of the output to contribute to selecting a unique ID.  </p>\n  \n  <p>This is the best way to ensure that deterministic styles of ID generation\n  (i.e. cryptographic hash) will always yield identical results for repeated\n  builds reproduced precisely.</p>\n</blockquote>\n"}], "owner": {"reputation": 40934, "user_id": 121687, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/359b919642638c5b67555a1bc89dfd3e?s=128&d=identicon&r=PG", "display_name": "fabrizioM", "link": "https://stackoverflow.com/users/121687/fabriziom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1897, "favorite_count": 2, "accepted_answer_id": 29857645, "answer_count": 1, "score": 6, "last_activity_date": 1429910202, "creation_date": 1429906879, "question_id": 29856780, "link": "https://stackoverflow.com/questions/29856780/what-is-nt-gnu-build-id-used-for", "title": "What is NT_GNU_BUILD_ID used for?", "body": "<p>I was reading the help guide for <a href=\"https://golang.org/cmd/ld/\" rel=\"noreferrer\">golang ld</a> and one of the options is </p>\n\n<pre><code>-B value\n    Add a NT_GNU_BUILD_ID note when using ELF.  The value\n    should start with 0x and be an even number of hex digits.\n</code></pre>\n\n<p>Does anyone knows why one would use that flag ? </p>\n\n<p>searching for <code>NT_GNU_BUILD_ID</code> does not provide any insightful answer.</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 11357, "user_id": 584846, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/uD1uQ.jpg?s=128&g=1", "display_name": "Brent Washburne", "link": "https://stackoverflow.com/users/584846/brent-washburne"}, "edited": false, "score": 0, "creation_date": 1429892953, "post_id": 29852719, "comment_id": 47831343, "body": "Is there a blobstore viewer so you can at least see them?"}, {"owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "reply_to_user": {"reputation": 11357, "user_id": 584846, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/uD1uQ.jpg?s=128&g=1", "display_name": "Brent Washburne", "link": "https://stackoverflow.com/users/584846/brent-washburne"}, "edited": false, "score": 0, "creation_date": 1429893222, "post_id": 29852719, "comment_id": 47831525, "body": "In the AppEngine dashboard it shows you a list of stuff.  But it doesn&#39;t tell you what is being used or not.   So that&#39;s why I need to write a piece of code to iterate over them all and do some data store queries to check if they are being used... but first I need to iterate."}, {"owner": {"reputation": 11357, "user_id": 584846, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/uD1uQ.jpg?s=128&g=1", "display_name": "Brent Washburne", "link": "https://stackoverflow.com/users/584846/brent-washburne"}, "edited": false, "score": 0, "creation_date": 1429894341, "post_id": 29852719, "comment_id": 47832171, "body": "Where is the list of blobs found in the dashboard?"}, {"owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "reply_to_user": {"reputation": 11357, "user_id": 584846, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/uD1uQ.jpg?s=128&g=1", "display_name": "Brent Washburne", "link": "https://stackoverflow.com/users/584846/brent-washburne"}, "edited": false, "score": 0, "creation_date": 1429902190, "post_id": 29852719, "comment_id": 47836850, "body": "In the old interview under &quot;Blob Viewer.&quot;  Doesn&#39;t look like the new interface has it.  <a href=\"https://appengine.google.com\" rel=\"nofollow noreferrer\">appengine.google.com</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11357, "user_id": 584846, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/uD1uQ.jpg?s=128&g=1", "display_name": "Brent Washburne", "link": "https://stackoverflow.com/users/584846/brent-washburne"}, "edited": false, "score": 0, "creation_date": 1429896294, "post_id": 29853312, "comment_id": 47833359, "body": "From that page: <code>NOTE: The Files API was deprecated on June 11, 2013 (v1.8.1) and will be shut down soon, at which point these functions will no longer work. Use Google Cloud Storage instead (https:&#47;&#47;cloud.google.com&#47;storage&#47;).</code>"}, {"owner": {"reputation": 11357, "user_id": 584846, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/uD1uQ.jpg?s=128&g=1", "display_name": "Brent Washburne", "link": "https://stackoverflow.com/users/584846/brent-washburne"}, "edited": false, "score": 0, "creation_date": 1429896331, "post_id": 29853312, "comment_id": 47833387, "body": "I guess that&#39;s why Google is making it hard to work with the Blobstore."}, {"owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "edited": false, "score": 0, "creation_date": 1429902449, "post_id": 29853312, "comment_id": 47836994, "body": "Thanks so much!  Here is some GQL that works: &quot;SELECT * FROM <b>BlobInfo</b>&quot;  &lt;-- sorry doesn&#39;t display right but add 3 underscores before and after."}], "tags": [], "owner": {"reputation": 1051, "user_id": 3277582, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0acf1c02112eb07e52b816734c861af6?s=128&d=identicon&r=PG&f=1", "display_name": "ozarov", "link": "https://stackoverflow.com/users/3277582/ozarov"}, "is_accepted": true, "score": 1, "last_activity_date": 1429894732, "creation_date": 1429894732, "answer_id": 29853312, "question_id": 29852719, "link": "https://stackoverflow.com/questions/29852719/cleaning-up-the-appengine-blobstore/29853312#29853312", "title": "Cleaning up the AppEngine BlobStore", "body": "<p>You can list the <a href=\"https://cloud.google.com/appengine/docs/go/blobstore/reference#BlobInfo\" rel=\"nofollow\">https://cloud.google.com/appengine/docs/go/blobstore/reference#BlobInfo</a> via a datastore query (though such query is eventually consistent).</p>\n"}, {"tags": [], "owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "is_accepted": false, "score": 0, "last_activity_date": 1429905168, "creation_date": 1429905168, "answer_id": 29856299, "question_id": 29852719, "link": "https://stackoverflow.com/questions/29852719/cleaning-up-the-appengine-blobstore/29856299#29856299", "title": "Cleaning up the AppEngine BlobStore", "body": "<p>Here is a code solution for iterating over blobs in golang:</p>\n\n<pre><code>c.Infof(\"Iterating over blobs\")\nq := datastore.NewQuery(\"__BlobInfo__\")\n\n// Iterate over the results.\ntotal := 0\nt := q.Run(c)\nfor {\n        var bi blobstore.BlobInfo\n        _, err := t.Next(&amp;bi)\n        if err == datastore.Done {\n                break\n        }\n        if err != nil &amp;&amp; isErrFieldMismatch(err) == false {\n                c.Errorf(\"Error fetching next Blob: %v\", err)\n                break\n        }\n        // Do something with the Blob bi\n        c.Infof(\"Got blob [%v] of size [%v]\", bi.ContentType, bi.Size)\n        total++\n        if total &gt; 100 { break }\n}\nc.Infof(\"Iterating Done\")\n</code></pre>\n\n<p>You'll also need to use this function to ignore field mismatch errors:</p>\n\n<pre><code>func isErrFieldMismatch(err error) bool {\n    _, ok := err.(*datastore.ErrFieldMismatch)\n    return ok\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "accepted_answer_id": 29853312, "answer_count": 2, "score": 3, "last_activity_date": 1429905168, "creation_date": 1429892771, "question_id": 29852719, "link": "https://stackoverflow.com/questions/29852719/cleaning-up-the-appengine-blobstore", "title": "Cleaning up the AppEngine BlobStore", "body": "<p>My AppEngine server has a lot of orphaned blobs not used in the BlobStore.  I'd like to write code to iterate over all the blobs and check if they are not being used and then delete.  I can't find a way to iterate over the BlobStore.  Is this possible?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "edited": false, "score": 0, "creation_date": 1437742923, "post_id": 29981157, "comment_id": 51171948, "body": "I&#39;ll accept this as answer because I think Google has been changing the Files API while it was deprecated and it caused weird IO errors."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 2, "last_activity_date": 1430449955, "creation_date": 1430449955, "answer_id": 29981157, "question_id": 29850760, "link": "https://stackoverflow.com/questions/29850760/appengine-io-copy-issue-results-in-api-error-10-file-file-not-opened/29981157#29981157", "title": "AppEngine IO Copy issue results in &quot;API error 10 (file: FILE_NOT_OPENED)&quot;", "body": "<p>This error is because your request is timing out. <code>Create</code> makes a protocol buffer request that looks like <a href=\"https://code.google.com/p/appengine-go/source/browse/appengine/blobstore/blobstore.go#334\" rel=\"nofollow\">this</a>: </p>\n\n<pre><code>oreq := &amp;filepb.OpenRequest{\n    Filename:      res.Filename,\n    ContentType:   filepb.FileContentType_RAW.Enum(),\n    OpenMode:      filepb.OpenRequest_APPEND.Enum(),\n    ExclusiveLock: proto.Bool(true),\n}\n</code></pre>\n\n<p>The corresponding <a href=\"https://code.google.com/p/appengine-go/source/browse/appengine_internal/files/file_service.pb.go#648\" rel=\"nofollow\">definition</a>:</p>\n\n<pre><code>type OpenRequest struct {\n    Filename             *string                      `protobuf:\"bytes,1,req,name=filename\" json:\"filename,omitempty\"`\n    ContentType          *FileContentType_ContentType `protobuf:\"varint,2,req,name=content_type,enum=files.FileContentType_ContentType\" json:\"content_type,omitempty\"`\n    OpenMode             *OpenRequest_OpenMode        `protobuf:\"varint,3,req,name=open_mode,enum=files.OpenRequest_OpenMode\" json:\"open_mode,omitempty\"`\n    ExclusiveLock        *bool                        `protobuf:\"varint,4,opt,name=exclusive_lock,def=0\" json:\"exclusive_lock,omitempty\"`\n    BufferedOutput       *bool                        `protobuf:\"varint,5,opt,name=buffered_output,def=0\" json:\"buffered_output,omitempty\"`\n    OpenLeaseTimeSeconds *int32                       `protobuf:\"varint,6,opt,name=open_lease_time_seconds,def=30\" json:\"open_lease_time_seconds,omitempty\"`\n    XXX_unrecognized     []byte                       `json:\"-\"`\n}\n</code></pre>\n\n<p>Notice <code>OpenLeaseTimeSeconds</code> is unset. It will default to 30 seconds:</p>\n\n<pre><code>const Default_OpenRequest_OpenLeaseTimeSeconds int32 = 30\n</code></pre>\n\n<p>So it's probably closing the connection underneath you.</p>\n\n<p>You have two options:</p>\n\n<ol>\n<li><p>Write your own <code>Create</code> method which sets the lease time to something greater than 30 seconds. The most you can do is 60 seconds since then your request <a href=\"https://cloud.google.com/appengine/docs/go/requests#Go_The_request_timer\" rel=\"nofollow\">will be killed</a>, in which case you will need to use a <a href=\"https://cloud.google.com/appengine/docs/go/taskqueue/\" rel=\"nofollow\">Task Queue</a>.</p></li>\n<li><p>The API is deprecated:</p>\n\n<blockquote>\n  <p>Warning: The Files API feature used here to write files to Blobstore has been deprecated and is going to be removed at some time in the future, in favor of writing files to Google Cloud Storage and using Blobstore to serve them. For more information, please visit Google Cloud Storage.</p>\n</blockquote>\n\n<p>So maybe you should try google storage instead.</p></li>\n</ol>\n"}], "owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 2, "accepted_answer_id": 29981157, "answer_count": 1, "score": 3, "last_activity_date": 1430449955, "creation_date": 1429887333, "last_edit_date": 1429889189, "question_id": 29850760, "link": "https://stackoverflow.com/questions/29850760/appengine-io-copy-issue-results-in-api-error-10-file-file-not-opened", "title": "AppEngine IO Copy issue results in &quot;API error 10 (file: FILE_NOT_OPENED)&quot;", "body": "<p>My GoLang AppEngine code is uncompressing a ZIP file and then saving off each file as BlobStore content.  I've seen it take over 30 seconds to save the data and then it fails with \"API error 10 (file: FILE_NOT_OPENED).\"  The size of the uncompressed file being written is about 1.5 megabytes.  Here is the code that does the copy to a new BlogStore item from the Zip reader:</p>\n\n<pre><code>func storeBlob(c appengine.Context, rc io.Reader, mimeType string) (appengine.BlobKey, error) {\n\nc.Infof(\"Creating new blob of type: [%v]\", mimeType)\nvar key appengine.BlobKey\nw, err := blobstore.Create(c, mimeType)\nif err != nil {\n    return \"\", err\n}\n\nc.Infof(\"Copying blob data\")\n_, err = io.Copy(w, rc)\nif err != nil {\n    return \"\", err\n}\n\nc.Infof(\"Closing Blob\")\nerr = w.Close()\nif err != nil {\n    return \"\", err\n}\n\nc.Infof(\"Getting Blob Key\")\nkey, err = w.Key()\nif err != nil {\n    return \"\", err\n}\nreturn key, nil\n</code></pre>\n\n<p>}</p>\n\n<p>The production appengine server locks up for 30 seconds and then reports the error on the io.Copy call. Any thoughts on how to troubleshoot this?</p>\n"}, {"tags": ["mongodb", "go", "mongodb-query"], "answers": [{"comments": [{"owner": {"reputation": 7017, "user_id": 2018812, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/69c00f983bf2d1256d91ef5b459b913c?s=128&d=identicon&r=PG&f=1", "display_name": "Yogesh", "link": "https://stackoverflow.com/users/2018812/yogesh"}, "edited": false, "score": 0, "creation_date": 1429883591, "post_id": 29848845, "comment_id": 47824626, "body": "OP states mentioned <code>if same record_id exists then get highest backup_no</code>"}, {"owner": {"reputation": 1272, "user_id": 3194438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/966b70ced98ea6e0072ed109db097e15?s=128&d=identicon&r=PG", "display_name": "Shawn Jacobson", "link": "https://stackoverflow.com/users/3194438/shawn-jacobson"}, "reply_to_user": {"reputation": 7017, "user_id": 2018812, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/69c00f983bf2d1256d91ef5b459b913c?s=128&d=identicon&r=PG&f=1", "display_name": "Yogesh", "link": "https://stackoverflow.com/users/2018812/yogesh"}, "edited": false, "score": 0, "creation_date": 1429883839, "post_id": 29848845, "comment_id": 47824829, "body": "Added clarification to 2nd option, was there something else you saw that didn&#39;t answer the question fully?"}, {"owner": {"reputation": 311, "user_id": 3481046, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/76ca1ada418b4a060f96ac0f87a79cc0?s=128&d=identicon&r=PG&f=1", "display_name": "Abinash Kumar", "link": "https://stackoverflow.com/users/3481046/abinash-kumar"}, "edited": false, "score": 0, "creation_date": 1429937347, "post_id": 29848845, "comment_id": 47848079, "body": "Yeah i get the second option but how to ignore all the records with record_id&#39;s which are not distinct except the first occurrence of the record with the record_id. Do i need to do processing in the back-end?"}], "tags": [], "owner": {"reputation": 1272, "user_id": 3194438, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/966b70ced98ea6e0072ed109db097e15?s=128&d=identicon&r=PG", "display_name": "Shawn Jacobson", "link": "https://stackoverflow.com/users/3194438/shawn-jacobson"}, "is_accepted": false, "score": 0, "last_activity_date": 1429883784, "last_edit_date": 1429883784, "creation_date": 1429882254, "answer_id": 29848845, "question_id": 29848716, "link": "https://stackoverflow.com/questions/29848716/find-latest-object-in-mongodb/29848845#29848845", "title": "Find Latest Object in MongoDB", "body": "<pre><code>db.collection.aggregate([{\n  $group: {\n    _id: \"$record_id\",\n    user_id: {\n      $last: \"$user_id\"\n    },\n    userName: {\n      $last: \"$userName\"\n    },\n    backup_no: {\n      $max: \"$backup_no\"\n    }\n  }\n}])\n</code></pre>\n\n<p>or</p>\n\n<p>You could simply sort descending by backup_no and then ignore all but the first record for each distinct record_id?<br>\n<a href=\"http://docs.mongodb.org/manual/reference/operator/meta/orderby/\" rel=\"nofollow\">MongoDB $orderby</a></p>\n\n<pre><code>db.users.find( { } ).sort( { backup_no: -1 } );\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 311, "user_id": 3481046, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/76ca1ada418b4a060f96ac0f87a79cc0?s=128&d=identicon&r=PG&f=1", "display_name": "Abinash Kumar", "link": "https://stackoverflow.com/users/3481046/abinash-kumar"}, "edited": false, "score": 0, "creation_date": 1429938344, "post_id": 29849212, "comment_id": 47848274, "body": "Thanks a lot for saving my day.. :)"}], "tags": [], "owner": {"reputation": 7017, "user_id": 2018812, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/69c00f983bf2d1256d91ef5b459b913c?s=128&d=identicon&r=PG&f=1", "display_name": "Yogesh", "link": "https://stackoverflow.com/users/2018812/yogesh"}, "is_accepted": true, "score": 1, "last_activity_date": 1429883227, "creation_date": 1429883227, "answer_id": 29849212, "question_id": 29848716, "link": "https://stackoverflow.com/questions/29848716/find-latest-object-in-mongodb/29849212#29849212", "title": "Find Latest Object in MongoDB", "body": "<p>Using mongo <code>aggregation</code> you can get your results check below query : </p>\n\n<pre><code>db.collectionName.aggregate({\n  \"$sort\": {\n    \"backup_no\": -1 //first sort by backup_no \n  }\n}, {\n  \"$group\": {\n    \"_id\": \"$record_id\", // group by record_id so here only get distinct record_id\n    \"userId\": {\n      \"$first\": \"$user_id\"\n    },\n    \"userName\": {\n      \"$first\": \"$userName\"\n    },\n    \"backup_no\": {\n      \"$first\": \"$backup_no\"\n    }\n  }\n}, {\n  \"$project\": {\n    \"_id\": 0,\n    \"record_id\": \"$_id\",\n    \"user_id\": \"$user_id\",\n    \"userName\": \"$userName\",\n    \"backup_no\": \"$backup_no\"\n  }\n})\n</code></pre>\n"}], "owner": {"reputation": 311, "user_id": 3481046, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/76ca1ada418b4a060f96ac0f87a79cc0?s=128&d=identicon&r=PG&f=1", "display_name": "Abinash Kumar", "link": "https://stackoverflow.com/users/3481046/abinash-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 29849212, "answer_count": 2, "score": 0, "last_activity_date": 1429883784, "creation_date": 1429881887, "question_id": 29848716, "link": "https://stackoverflow.com/questions/29848716/find-latest-object-in-mongodb", "title": "Find Latest Object in MongoDB", "body": "<p>I have data in MongoDB in the form of :</p>\n\n<pre><code> {\n            \"_id\" : 154,\n            \"record_id\" : \"001280000033x54AAA\",\n            \"jsonData\" : \"\",\n            \"user_id\" : 1,\n            \"userName\" : \"abc@xyz.com\",\n            \"backup_no\" : 1\n }\n\n\n {\n            \"_id\" : 155,\n            \"record_id\" : \"001280000033x54AAA\",\n            \"jsonData\" : \"\",\n            \"user_id\" : 1,\n            \"userName\" : \"abc@xyz.com\",\n            \"backup_no\" : 2\n }\n  ...\n</code></pre>\n\n<p>I want to retrieve data based on 'user_id','userName', but if a record with same record_id exists in lower 'backup_no' then i need to choose record with highest backup_no.</p>\n\n<p>I have tried to aggregate record_id's and then query but i am unable to find a solution. </p>\n\n<p>Thanks</p>\n"}, {"tags": ["html", "architecture", "go", "websocket"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1429883007, "post_id": 29847717, "comment_id": 47824154, "body": "What does a &quot;server frontend&quot; mean in this situation? Are you talking about something running in a browser on the same amchine as the &quot;desktop application&quot;?"}, {"owner": {"reputation": 2762, "user_id": 357937, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cec99ad76b136c8e5c8002370499365e?s=128&d=identicon&r=PG", "display_name": "Ondra", "link": "https://stackoverflow.com/users/357937/ondra"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1429883479, "post_id": 29847717, "comment_id": 47824536, "body": "&quot;Same armchair scenario&quot; (browser and application on same machine) would cover most usecases, but not all of them. Any suggestion is welcomed."}, {"owner": {"reputation": 3036, "user_id": 1938828, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/k0jyQ.jpg?s=128&g=1", "display_name": "Guanxi", "link": "https://stackoverflow.com/users/1938828/guanxi"}, "edited": false, "score": 0, "creation_date": 1429887787, "post_id": 29847717, "comment_id": 47827875, "body": "backend resources aren&#39;t wasted -- what important thing backend resources are doing other than fulfilling requests of your frontend?"}, {"owner": {"reputation": 2762, "user_id": 357937, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cec99ad76b136c8e5c8002370499365e?s=128&d=identicon&r=PG", "display_name": "Ondra", "link": "https://stackoverflow.com/users/357937/ondra"}, "edited": false, "score": 0, "creation_date": 1429963205, "post_id": 29847717, "comment_id": 47854781, "body": "Guanxi: in this case I need backend just for authentication/authorization, no real work is done on server side, so its not just server resources, but also lag when communicating application-frontend through backend."}], "answers": [{"tags": [], "owner": {"reputation": 17526, "user_id": 711902, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/36a9e6931ec4828c293156c50ac339ec?s=128&d=identicon&r=PG", "display_name": "Trevor Dixon", "link": "https://stackoverflow.com/users/711902/trevor-dixon"}, "is_accepted": false, "score": 1, "last_activity_date": 1429901802, "creation_date": 1429901802, "answer_id": 29855386, "question_id": 29847717, "link": "https://stackoverflow.com/questions/29847717/communication-between-desktop-application-and-web-frontend/29855386#29855386", "title": "Communication between desktop application and web frontend", "body": "<p>This might work, but may take quite a bit of extra thought to do securely:</p>\n\n<p>Have your desktop program run a web(socket) server on some arbitrary port <em>p</em>, then try to talk to localhost:<em>p</em> from your frontend.</p>\n\n<p>Or you could try to do WebRTC between the browser and desktop app. A quick search turned up <a href=\"https://github.com/coreos/go-webrtc-datachannel\" rel=\"nofollow\">https://github.com/coreos/go-webrtc-datachannel</a>, which is just a planning document at this time.</p>\n"}, {"comments": [{"owner": {"reputation": 2762, "user_id": 357937, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cec99ad76b136c8e5c8002370499365e?s=128&d=identicon&r=PG", "display_name": "Ondra", "link": "https://stackoverflow.com/users/357937/ondra"}, "edited": false, "score": 0, "creation_date": 1429963070, "post_id": 29858006, "comment_id": 47854745, "body": "I am interested especially in last solution. I can make local server in desktop application and take care about security, but I think I will have often problems with some firewalls... Just curious, how often do you think I will have these kind of problems? And how can I solve them?"}, {"owner": {"reputation": 111, "user_id": 4811562, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-v3Bog3Qbbnw/AAAAAAAAAAI/AAAAAAAAGCg/DjFnp4C7OpA/photo.jpg?sz=128", "display_name": "Qian Qiao", "link": "https://stackoverflow.com/users/4811562/qian-qiao"}, "reply_to_user": {"reputation": 2762, "user_id": 357937, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cec99ad76b136c8e5c8002370499365e?s=128&d=identicon&r=PG", "display_name": "Ondra", "link": "https://stackoverflow.com/users/357937/ondra"}, "edited": false, "score": 1, "creation_date": 1430176751, "post_id": 29858006, "comment_id": 47937692, "body": "If you are connecting to localhost, firewalls usually don&#39;t make too much of a fuss about it, however, you will need to sort out the cross domain issues too in this case: if your app runs on <a href=\"http://www.domain.com\" rel=\"nofollow noreferrer\">domain.com</a>, then connecting to <a href=\"http://localhost\" rel=\"nofollow noreferrer\">localhost</a> will be considered cross domain. JSONP solves this issue. However, if you use https, it would become impossible, since you will not be able to issue a certificate to localhost. That&#39;s why I didn&#39;t mention this method as one of the bullet points, because it is actually a hack rather than a solution."}, {"owner": {"reputation": 17526, "user_id": 711902, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/36a9e6931ec4828c293156c50ac339ec?s=128&d=identicon&r=PG", "display_name": "Trevor Dixon", "link": "https://stackoverflow.com/users/711902/trevor-dixon"}, "edited": false, "score": 0, "creation_date": 1430236944, "post_id": 29858006, "comment_id": 47970260, "body": "@QianQiao WebRTC would be nice, but a quick Google search didn&#39;t turn up any Go WebRTC client. Am I overlooking something, or are you suggesting he do WebRTC from scratch? I assume it&#39;s not trivial to implement a WebRTC client."}, {"owner": {"reputation": 111, "user_id": 4811562, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-v3Bog3Qbbnw/AAAAAAAAAAI/AAAAAAAAGCg/DjFnp4C7OpA/photo.jpg?sz=128", "display_name": "Qian Qiao", "link": "https://stackoverflow.com/users/4811562/qian-qiao"}, "reply_to_user": {"reputation": 17526, "user_id": 711902, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/36a9e6931ec4828c293156c50ac339ec?s=128&d=identicon&r=PG", "display_name": "Trevor Dixon", "link": "https://stackoverflow.com/users/711902/trevor-dixon"}, "edited": false, "score": 0, "creation_date": 1430245877, "post_id": 29858006, "comment_id": 47976216, "body": "@TrevorDixon the WebRTC connection is between the desktop application and the web frontend, I&#39;d imagine the desktop application is written C# or C++ or similar languages, there are WebRTC implementations in all of those languages available freely."}, {"owner": {"reputation": 17526, "user_id": 711902, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/36a9e6931ec4828c293156c50ac339ec?s=128&d=identicon&r=PG", "display_name": "Trevor Dixon", "link": "https://stackoverflow.com/users/711902/trevor-dixon"}, "edited": false, "score": 0, "creation_date": 1430256328, "post_id": 29858006, "comment_id": 47982637, "body": "@QianQiao He says, &quot;PS: I am using Go for both backend and application\u2026&quot; I take that to mean his desktop app is written in Go (CLI?).  Regarding, &quot;However, if you use https, it would become impossible, since you will not be able to issue a certificate to localhost,&quot; couldn&#39;t he set up a domain or subdomain that resolves to 127.0.0.1, then get a certificate for that domain?"}], "tags": [], "owner": {"reputation": 111, "user_id": 4811562, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-v3Bog3Qbbnw/AAAAAAAAAAI/AAAAAAAAGCg/DjFnp4C7OpA/photo.jpg?sz=128", "display_name": "Qian Qiao", "link": "https://stackoverflow.com/users/4811562/qian-qiao"}, "is_accepted": true, "score": 3, "last_activity_date": 1429911760, "creation_date": 1429911760, "answer_id": 29858006, "question_id": 29847717, "link": "https://stackoverflow.com/questions/29847717/communication-between-desktop-application-and-web-frontend/29858006#29858006", "title": "Communication between desktop application and web frontend", "body": "<p>Are you trying to connect to the JavaScript Frontend from your desktop application? If so, I can think of the following options</p>\n\n<ol>\n<li>WebRTC. It's supported by Chrome (and Opera) and Firefox.</li>\n<li>Chrome Native Messaging, this only works for chrome obviously, sends/receives info from stdin/out of your desktop application.</li>\n</ol>\n\n<p>Overall I think WebRTC might be a better solution. Both of the solutions require you to run your web frontend in a modern browser though, Chrome/Firefox.</p>\n\n<p>If you have to deal with IE, I can only think of having your desktop application to run a local web server, and have your web application poll/post to it. Even then, you have to work around cross domain issues, and you probably want to implement some level of security around it, so it gets fairly messy.</p>\n"}], "owner": {"reputation": 2762, "user_id": 357937, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cec99ad76b136c8e5c8002370499365e?s=128&d=identicon&r=PG", "display_name": "Ondra", "link": "https://stackoverflow.com/users/357937/ondra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1969, "favorite_count": 1, "accepted_answer_id": 29858006, "answer_count": 2, "score": 4, "last_activity_date": 1429911760, "creation_date": 1429878969, "question_id": 29847717, "link": "https://stackoverflow.com/questions/29847717/communication-between-desktop-application-and-web-frontend", "title": "Communication between desktop application and web frontend", "body": "<p>My project can be divided into 3 components: Desktop application, Server backend, Server frontend. I am using websockets application-backend and backend-frontend communication. Frontend is single page application. Whole looks like this:</p>\n\n<p><img src=\"https://i.stack.imgur.com/Ux3Q1.png\" alt=\"application-backend and backend-frontend communication\"></p>\n\n<p>I need to implement communication between frontend and application (dotted arrow in the picture above). I am able to use backend server as a proxy, but it would be more useful to have direct communication between frontend and application so that backend resources aren't wasted.</p>\n\n<p>Is there any way how I can establish direct connection between local app and web frontend?</p>\n\n<p>PS: I am using Go for both backend and application, JavaScript for frontend and WebSockets for communication, but general architecture answers are welcomed.</p>\n"}, {"tags": ["google-app-engine", "go", "redislabs"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1429880096, "post_id": 29846815, "comment_id": 47821973, "body": "Check each returned <code>error</code>. Currently in the code you posted you check none."}], "answers": [{"comments": [{"owner": {"reputation": 3234, "user_id": 2067919, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ee20c28be7254efecd50ce7a471b4876?s=128&d=identicon&r=PG", "display_name": "Karthic Rao", "link": "https://stackoverflow.com/users/2067919/karthic-rao"}, "edited": false, "score": 0, "creation_date": 1429881534, "post_id": 29848404, "comment_id": 47823020, "body": "Yes , you are right .. Its the restriction by app engine to not to allow outgoing socket calls by standard net package"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1429881053, "creation_date": 1429881053, "answer_id": 29848404, "question_id": 29846815, "link": "https://stackoverflow.com/questions/29846815/google-app-engine-redislabs-go-runtime-production-error-invalid-memory-address/29848404#29848404", "title": "Google App engine-Redislabs Go runtime production error - invalid memory address or nil pointer dereference", "body": "<p>On AppEngine your application (webapp) runs in a sandboxed environment where you can't use the standard <a href=\"https://golang.org/pkg/net/\" rel=\"nofollow\"><code>net</code></a> package for sockets (which I assume redislabs use).</p>\n\n<p>You have to use the <a href=\"https://cloud.google.com/appengine/docs/go/sockets/reference\" rel=\"nofollow\"><code>appengine/socket</code></a> package for outbound network sockets.</p>\n\n<p>It most likely works locally because the restriction only applies in production environment.</p>\n\n<p>Always check returned <code>error</code> values. Currently in the code you posted you check none. Should you have checked it, you would see the cause from the error.</p>\n\n<p>You get <code>invalid memory address or nil pointer dereference</code> error because your first call fails:</p>\n\n<pre><code>c, err := redis.Dial(\"tcp\", \"pub-redis-myredis:&lt;myport&gt;\")\n</code></pre>\n\n<p><code>err</code> will be a non-<code>nil</code> value and <code>c</code> is <code>nil</code> which means you can't call it's <code>Do()</code> method.</p>\n"}], "owner": {"reputation": 3234, "user_id": 2067919, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/ee20c28be7254efecd50ce7a471b4876?s=128&d=identicon&r=PG", "display_name": "Karthic Rao", "link": "https://stackoverflow.com/users/2067919/karthic-rao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 29848404, "answer_count": 1, "score": 0, "last_activity_date": 1429912189, "creation_date": 1429876302, "last_edit_date": 1429912189, "question_id": 29846815, "link": "https://stackoverflow.com/questions/29846815/google-app-engine-redislabs-go-runtime-production-error-invalid-memory-address", "title": "Google App engine-Redislabs Go runtime production error - invalid memory address or nil pointer dereference", "body": "<p>I'm using the Redis Cloud service (from Redis Labs) on Google App engine Go Runtime , and I get the above mentioned error when I try getting a key that doesn't exist. The code works fine on the local test server, but  panics in production.   </p>\n\n<pre><code> c, err := redis.Dial(\"tcp\", \"pub-redis-myredis:&lt;myport&gt;\")\n_, err = c.Do(\"AUTH\", \"password\") \nvalue, err := c.Do(\"GET\", \"foo4\")\n\nif value == nil {\n    log.Infof(contextOfAppEngineWhereServerIsRunning, \"value not found in redislabs\")\n\n} \n</code></pre>\n\n<p>The log shows that the panic is in the line <code>_, err = c.Do(\"AUTH\", \"password\")</code></p>\n"}, {"tags": ["go", "package", "revel"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1429884161, "post_id": 29843116, "comment_id": 47825063, "body": "Don&#39;t set GOROOT if you have. What is the output of <code>go env</code>? You also may have an old version of git (or maybe go). What is the output of <code>git version</code> and <code>go version</code>?"}, {"owner": {"reputation": 37, "user_id": 4827655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d108448d361a9dac3e474f7168dc142?s=128&d=identicon&r=PG&f=1", "display_name": "Neat Head", "link": "https://stackoverflow.com/users/4827655/neat-head"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430210042, "post_id": 29843116, "comment_id": 47950313, "body": "I deleted GOROOT but I still have the same problem. Here is the output of go env:  C:\\windows\\system32&gt;go env set GOARCH=386 set GOBIN= set GOCHAR=8 set GOEXE=.exe set GOHOSTARCH=386 set GOHOSTOS=windows set GOOS=windows set GOPATH=C:\\Users\\MixaMo\\Documents\\Go set GORACE= set GOROOT=C:\\Go set GOTOOLDIR=C:\\Go\\pkg\\tool\\windows_386 set CC=gcc set GOGCCFLAGS=-m32 -mthreads -fmessage-length=0 set CXX=g++ set CGO_ENABLED=1  -The output of git version: git version 1.9.5.msysgit.1 -Te output of go version go version go1.4.2 windows/386"}, {"owner": {"reputation": 2854, "user_id": 41292, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/939e50606775eea4b7589dd7aebbd8b3?s=128&d=identicon&r=PG", "display_name": "LenW", "link": "https://stackoverflow.com/users/41292/lenw"}, "edited": false, "score": 0, "creation_date": 1434988974, "post_id": 29843116, "comment_id": 49999344, "body": "Try setting the GOBIN ? Also your GOROOT is still set and does not match what you mentioned above ?"}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 3686026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/myy5v.jpg?s=128&g=1", "display_name": "ggerman", "link": "https://stackoverflow.com/users/3686026/ggerman"}, "is_accepted": false, "score": 2, "last_activity_date": 1436814577, "creation_date": 1436814577, "answer_id": 31391502, "question_id": 29843116, "link": "https://stackoverflow.com/questions/29843116/cant-install-revel-unrecognized-import-path/31391502#31391502", "title": "Can&#39;t install Revel (Unrecognized import path)", "body": "<p>For instalation of GO into your home folder you need this environment variables:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 bin\n\u251c\u2500\u2500 go (GO)\n\u2514\u2500\u2500 src\n    \u251c\u2500\u2500 revel.project\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 app\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 controllers\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 models\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 routes\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 tmp\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 views\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 admin\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 App\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u251c\u2500\u2500 errors\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 users\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 conf\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 messages\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 public\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 css\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 administrator\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 img\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 js\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 uploads\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 1\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 resources\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 scripts\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 test-results\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 tests\n    \u251c\u2500\u2500 code.google.com\n    \u251c\u2500\u2500 github.com\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 revel\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 cmd\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 modules\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 revel\n</code></pre>\n\n<p>run this in your prompt path or modify if your folders are differents.</p>\n\n<pre><code>  export GOARCH=amd64\n  export GOPATH=~/go\n  export GOBIN=~/go/go/bin\n  export GOROOT=~/go/go\n  export PATH=$PATH:$GOPATH/go/bin\n  export GOTOOLDIR=~/go/go/pkg/tool/linux_amd64\n  export CC=\"gcc\"\n  export GOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\n  export CXX=g++\n  export CGO_ENABLED=1\n</code></pre>\n\n<p>Where ~ is the name of you personal folder in the system (Bash Gnu Linux)</p>\n"}], "owner": {"reputation": 37, "user_id": 4827655, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d108448d361a9dac3e474f7168dc142?s=128&d=identicon&r=PG&f=1", "display_name": "Neat Head", "link": "https://stackoverflow.com/users/4827655/neat-head"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1716, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1436814577, "creation_date": 1429866225, "question_id": 29843116, "link": "https://stackoverflow.com/questions/29843116/cant-install-revel-unrecognized-import-path", "title": "Can&#39;t install Revel (Unrecognized import path)", "body": "<p>I'm a beginner in Go and I would like to use the Revel web framework.\nI installed: Git; Mercurial and even: Bazaar and CVS.</p>\n\n<p>I checked my environment variables. I set environment variable GOPATH to D:\\Go and added D:\\Go\\bin to PATH.But I still get these errors when I <strong><em>go get The Revel Framework</em></strong> (<em>go get github.com/revel/revel</em>)</p>\n\n<p>**</p>\n\n<ul>\n<li><p>package golang.org/x/net/websocket: unrecognized import path \"golang.org/x/net/websocket\"</p></li>\n<li><p>package gopkg.in/fsnotify.v1: unrecognized import path \"gopkg.in/fsnotify.v1\"**</p></li>\n</ul>\n"}, {"tags": ["go", "http.client"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 2, "creation_date": 1429857701, "post_id": 29840375, "comment_id": 47807046, "body": "What is the exact error message, including line number, and what line does that correspond to in your code?"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 3, "creation_date": 1429857785, "post_id": 29840375, "comment_id": 47807086, "body": "One thing for sure is you should not be checking for <code>if err != nil</code> <b>after</b>  you call <code>defer res.Body.Close()</code>... the error check should come first."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1429857800, "post_id": 29840375, "comment_id": 47807094, "body": "Is it necessary to post all stack, in the beginning it just says <code>panic: runtime error: invalid memory address or nil pointer dereference [signal 0xb code=0x1 addr=0x0 pc=0x408762]</code> Then it follows up with a long list of other information.."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1429858026, "post_id": 29840375, "comment_id": 47807185, "body": "Post the beginning of the stack trace.  Near the top it will have the line number, but since that will likely not match your code posted I need to now the line corresponding to that number."}], "answers": [{"comments": [{"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1429858184, "post_id": 29840479, "comment_id": 47807271, "body": "So simple... My brains got almost damaged, I made dozens of various things, but never thought about that the defer must be certainly after error check...  Thank you very much!"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "edited": false, "score": 0, "creation_date": 1429858607, "post_id": 29840479, "comment_id": 47807509, "body": "@MikeKlemin: No problem.  Happy gophering!"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 5, "last_activity_date": 1429857889, "creation_date": 1429857889, "answer_id": 29840479, "question_id": 29840375, "link": "https://stackoverflow.com/questions/29840375/figure-source-of-invalid-memory-address-with-http-client/29840479#29840479", "title": "Figure source of &quot;invalid memory address ... &quot; with http.client", "body": "<p>Until I see more information, this is simply a guess based on what I could gather from the code you posted.</p>\n\n<p>The call</p>\n\n<pre><code>res.Body.Close()\n</code></pre>\n\n<p>should come after your check for error, not before.  So change:</p>\n\n<pre><code> res, err := httpClient.Do(req)\n defer res.Body.Close()\n if err != nil {\n     ...\n }\n</code></pre>\n\n<p>to </p>\n\n<pre><code> res, err := httpClient.Do(req)\n if err != nil {\n     ...\n }\n defer res.Body.Close()\n</code></pre>\n"}], "owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 0, "accepted_answer_id": 29840479, "answer_count": 1, "score": 0, "last_activity_date": 1429857889, "creation_date": 1429857534, "question_id": 29840375, "link": "https://stackoverflow.com/questions/29840375/figure-source-of-invalid-memory-address-with-http-client", "title": "Figure source of &quot;invalid memory address ... &quot; with http.client", "body": "<p>I learning the go and struggling with this panic error... it working for some time, but soon end up with such exception <code>panic: runtime error: invalid memory address or nil pointer dereference</code></p>\n\n<p>The function simply iterate over map of proxies until it successfully get the content of the \"address\". It must be not very idiomatic, especially using map instead of slice and the last return, but I hope that is not the reason of panic crush... \nif I omitted something possible important please, let me know, I will update the post, I just do not want to flood it with unnecessary info. \nproxies is a struct with map field with methods for concurrent safe read/delete. </p>\n\n<pre><code>func getContent(address string) string {\nlocalProxies := proxies.Get()\nfor proxy := range localProxies {\n    proxyUrl, _ := url.Parse(\"http://\" + proxy)\n\n    transport := http.Transport{\n        Dial:  dialTimeout,\n        Proxy: http.ProxyURL(proxyUrl),\n    }\n    httpClient := http.Client{Transport: &amp;transport, Timeout: timeout}\n    req, err := http.NewRequest(\"GET\", address, nil)\n    if err != nil {\n        fmt.Println(\"Request error: \", err.Error())\n    }\n    req.Header.Set(\"User-Agent\", \"Mozilla/5.0 (Windows NT 6.1; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0\")\n    res, err := httpClient.Do(req)\n    defer res.Body.Close()\n\n    if err != nil {\n        //          fmt.Println(\"Broken \", proxy)\n        fmt.Println(\"Response error: \", err.Error())\n        proxies.Del(proxy)\n        continue\n    }\n    if res.StatusCode != 200 {\n        //          fmt.Println(\"Status error: \", res.Status)\n        proxies.Del(proxy)\n        continue\n    }\n    out, err := ioutil.ReadAll(res.Body)\n    if err != nil {\n        fmt.Println(\"Read error: \", err.Error())\n        proxies.Del(proxy)\n        continue\n    }\n    return string(out)\n}\nreturn \"error\"\n</code></pre>\n\n<p>}</p>\n\n<p><code>go version go1.4.2 linux/amd64</code></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 7, "last_activity_date": 1429863627, "last_edit_date": 1429863627, "creation_date": 1429851043, "answer_id": 29838962, "question_id": 29838240, "link": "https://stackoverflow.com/questions/29838240/pointer-and-slice-reference-type-receiver/29838962#29838962", "title": "Pointer and slice reference type - receiver", "body": "<p>See this <a href=\"http://blog.golang.org/slices\" rel=\"nofollow\">article on the Go blog</a>. It explains in detail what is happening and fully answers your question. </p>\n\n<p>From the section <strong>Passing slices to functions</strong>:</p>\n\n<blockquote>\n  <p>It's important to understand that even though a slice contains a pointer, it is itself a value. Under the covers, it is a struct value holding a pointer and a length. It is not a pointer to a struct.</p>\n</blockquote>\n\n<p>As a result you either need a pointer receiver or you need to return the slice as a value if you want to modify it with <code>append</code>. </p>\n\n<p>If you just want to modify the contents of a slice you can simply pass the slice by value:</p>\n\n<blockquote>\n  <p>Even though the slice header is passed by value, the header includes a\n  pointer to elements of an array, so both the original slice header and\n  the copy of the header passed to the function describe the same array.\n  Therefore, when the function returns, the modified elements can be\n  seen through the original slice variable.</p>\n</blockquote>\n\n<p>With <code>append</code> you are modifying the slice header. And</p>\n\n<blockquote>\n  <p>Thus if we want to write a function that modifies the header, we must\n  return it as a result parameter</p>\n</blockquote>\n\n<p>Or:</p>\n\n<blockquote>\n  <p>Another way to have a function modify the slice header is to pass a pointer to it.</p>\n</blockquote>\n\n<p>You also seem to have a confusion on the use of pointers. See the <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow\">spec</a>:</p>\n\n<blockquote>\n  <p>For an operand x of type T, the address operation &amp;x generates a pointer of type *T to x.</p>\n</blockquote>\n\n<p>And:</p>\n\n<blockquote>\n  <p>For an operand x of pointer type *T, the pointer indirection *x denotes the variable of type T pointed to by x.</p>\n</blockquote>\n\n<p>Thus your example <code>*stack = append(*stack, x)</code> doesn't mean that you are passing a pointer to <code>append</code>, quite the opposite - you are dereferencing the pointer to pass the value it's pointing to.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1429861121, "post_id": 29838966, "comment_id": 47808987, "body": "The <code>struct</code> makes it easier to understand, but the <code>size</code> field here is completely redundant and requires unnecessary work to maintain it, as you can just get it by <code>len(data)</code>."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1429889786, "post_id": 29838966, "comment_id": 47829280, "body": "I agree. It was mostly to demonstrate the advantage over a raw slice in that you can add additional data as you need."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 2, "last_activity_date": 1429851072, "creation_date": 1429851072, "answer_id": 29838966, "question_id": 29838240, "link": "https://stackoverflow.com/questions/29838240/pointer-and-slice-reference-type-receiver/29838966#29838966", "title": "Pointer and slice reference type - receiver", "body": "<p>The problem you are having is that <code>append</code> returns a reference to the new slice. You cannot change the value of the function's receiver unless it is a pointer.</p>\n\n<p>What I would recommend rather is making a wrapper struct:</p>\n\n<pre><code>type Stack struct{\n   data []interface{}\n   size int\n}\nfunc (s *Stack) Push(i interface{}){\n   s.data = append(s.data,i)\n   s.size++\n}\n</code></pre>\n"}], "owner": {"reputation": 1239, "user_id": 854951, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/301fd62e0d28d0cec2b520267572eaf6?s=128&d=identicon&r=PG", "display_name": "Patrick Wolf", "link": "https://stackoverflow.com/users/854951/patrick-wolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2179, "favorite_count": 1, "accepted_answer_id": 29838962, "answer_count": 2, "score": 6, "last_activity_date": 1584889839, "creation_date": 1429846331, "last_edit_date": 1584889839, "question_id": 29838240, "link": "https://stackoverflow.com/questions/29838240/pointer-and-slice-reference-type-receiver", "title": "Pointer and slice reference type - receiver", "body": "<p>I think this will be a bit obvious once it's called out to me, but right now the following isn't clicking.</p>\n\n<pre><code>type Stack []interface{}\n\nfunc (stack *Stack) Push(x interface{}) {\n    *stack = append(*stack, x)\n}\n</code></pre>\n\n<p>I have a type called Stack that is a slice of empty interfaces.  Given that it's empty, the Push method satisfies the interface.  Given that a slice is a reference type, why can't the 'stack' receiver just be passed in by value?  Furthermore, in the example above the receiver is passed as a pointer why does the append built-in need to be passed by pointer again?</p>\n\n<p>IE why wouldn't this work, given that the slice is a reference pointer to an underlying array?</p>\n\n<pre><code>func (stack Stack) Push(x interface{}) {\n    stack = append(stack, x)\n}\n</code></pre>\n"}, {"tags": ["go", "mime-types", "detection"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1429846035, "post_id": 29838185, "comment_id": 47802793, "body": "<a href=\"https://golang.org/pkg/mime/\" rel=\"nofollow noreferrer\">golang.org/pkg/mime</a>"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1429848542, "post_id": 29838185, "comment_id": 47803371, "body": "@SalvadorDali The mime package is useful, but the question specifically asks about detection based on content, not extension."}], "answers": [{"comments": [{"owner": {"reputation": 1170, "user_id": 4732633, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh6.googleusercontent.com/-3EqkwkKBaTo/AAAAAAAAAAI/AAAAAAAAAAA/hhuYb3A-0qo/photo.jpg?sz=128", "display_name": "Rahul Ganguly", "link": "https://stackoverflow.com/users/4732633/rahul-ganguly"}, "edited": false, "score": 0, "creation_date": 1530956705, "post_id": 29842344, "comment_id": 89424294, "body": "any tips on how to get started with this?"}], "tags": [], "owner": {"reputation": 94, "user_id": 758900, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b12cca0069c2481e6ca81cb77cc3ef5?s=128&d=identicon&r=PG", "display_name": "pzinovkin", "link": "https://stackoverflow.com/users/758900/pzinovkin"}, "is_accepted": false, "score": 2, "last_activity_date": 1429864049, "creation_date": 1429864049, "answer_id": 29842344, "question_id": 29838185, "link": "https://stackoverflow.com/questions/29838185/how-to-detect-additional-mime-type-in-golang/29842344#29842344", "title": "How to detect additional mime type in Golang", "body": "<p>For files with <code>x</code> at the end are relatively easy to detect. Just unzip it and read <code>.rels/_rels</code> file. It contains path to the main file in document. It denoted by namespace <code>http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument</code>. Just check its name. It's <code>document.xml</code> for docx, <code>workbook.xml</code> for xlsx and <code>presentation.xml</code> for pptx.</p>\n\n<p>More info here can be found here <a href=\"http://www.ecma-international.org/publications/standards/Ecma-376.htm\" rel=\"nofollow\">ECMA-376</a>.</p>\n\n<p>Binary formats harder to detect. Basically you need to read <a href=\"https://msdn.microsoft.com/en-us/library/dd942138.aspx\" rel=\"nofollow\">MS-CFB</a> filesystem and check for entries:</p>\n\n<ul>\n<li><code>WordDocument</code> for doc</li>\n<li><code>Workbook</code> or <code>Book</code> for xls</li>\n<li><code>PowerPoint Document</code> for ppt</li>\n<li><code>EncryptedPackage</code> means file is encrypted.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": false, "score": 1, "last_activity_date": 1429864548, "creation_date": 1429864548, "answer_id": 29842508, "question_id": 29838185, "link": "https://stackoverflow.com/questions/29838185/how-to-detect-additional-mime-type-in-golang/29842508#29842508", "title": "How to detect additional mime type in Golang", "body": "<p>There's currently no way to extend <code>http.DetectContentType</code> as it uses a fixed, unexported slice of \"sniffers\": <a href=\"https://golang.org/src/net/http/sniff.go\" rel=\"nofollow\">https://golang.org/src/net/http/sniff.go</a> (<code>sniffSignatures</code> on line 49 at the time of writing).</p>\n\n<p>Also, I looked quickly through godoc.org in search of a better package but didn't find any that is extensible and content-oriented as you require.</p>\n\n<p>My advice would be: build your own package, guided by Go's content sniffer implementation (which follows <a href=\"https://mimesniff.spec.whatwg.org/\" rel=\"nofollow\">https://mimesniff.spec.whatwg.org/</a>).</p>\n\n<p>Edit: If you're willing to use CGO and you're on nix, you could use libmagic bindings like for example <a href=\"https://github.com/jteeuwen/magic\" rel=\"nofollow\">https://github.com/jteeuwen/magic</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 669, "user_id": 202648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a3c77049e188b4334bf7d589d438b9f?s=128&d=identicon&r=PG", "display_name": "ptman", "link": "https://stackoverflow.com/users/202648/ptman"}, "is_accepted": false, "score": 1, "last_activity_date": 1431940201, "creation_date": 1431940201, "answer_id": 30299131, "question_id": 29838185, "link": "https://stackoverflow.com/questions/29838185/how-to-detect-additional-mime-type-in-golang/30299131#30299131", "title": "How to detect additional mime type in Golang", "body": "<p>I found <a href=\"https://bitbucket.org/taruti/mimemagic\" rel=\"nofollow\">mimemagic</a>, which I find preferable to <a href=\"https://github.com/rakyll/magicmime\" rel=\"nofollow\">magicmime</a> since it doesn't use cgo. But magicmime is better at differentiating between application/zip and office file types.</p>\n"}, {"tags": [], "owner": {"reputation": 310, "user_id": 6449978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ca0eb06337b8757ce6d13a6bf369a1c?s=128&d=identicon&r=PG&f=1", "display_name": "GabrielVasile", "link": "https://stackoverflow.com/users/6449978/gabrielvasile"}, "is_accepted": true, "score": 6, "last_activity_date": 1570712355, "last_edit_date": 1570712355, "creation_date": 1536618533, "answer_id": 52266327, "question_id": 29838185, "link": "https://stackoverflow.com/questions/29838185/how-to-detect-additional-mime-type-in-golang/52266327#52266327", "title": "How to detect additional mime type in Golang", "body": "<p>Disclaimer: I'm the author of <a href=\"https://github.com/gabriel-vasile/mimetype\" rel=\"nofollow noreferrer\">mimetype</a>.</p>\n\n<p>For anyone having the same problem 3 years later, nowadays the packages for mime type detection based on the content are the following:</p>\n\n<ul>\n<li><p><a href=\"https://github.com/h2non/filetype\" rel=\"nofollow noreferrer\">filetype</a></p>\n\n<ul>\n<li>pure go, no c bindings</li>\n<li>can be extented to detect new mime types</li>\n<li>has issues with files which pass as more than one mime type (ex: xlsx and docx passing as zip) because it stores matching functions in a map, thus it does not guarantee the order of traversal</li>\n<li>limited number of detected mime types</li>\n</ul></li>\n<li><p><a href=\"https://github.com/rakyll/magicmime\" rel=\"nofollow noreferrer\">magicmime</a></p>\n\n<ul>\n<li>needs libmagic-dev installed</li>\n<li>of the 3, it has highest number of detected mime types </li>\n<li>can be extended, albeit harder... <code>man magic</code></li>\n<li>libmagic is not thread safe </li>\n</ul></li>\n<li><p><a href=\"https://github.com/gabriel-vasile/mimetype\" rel=\"nofollow noreferrer\">mimetype</a> </p>\n\n<ul>\n<li>pure go, no c bindings</li>\n<li>higher number of detected mime types than <code>filetype</code></li>\n<li>is thread safe</li>\n</ul></li>\n</ul>\n"}], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8839, "favorite_count": 1, "accepted_answer_id": 52266327, "answer_count": 4, "score": 4, "last_activity_date": 1570712355, "creation_date": 1429845870, "last_edit_date": 1429846219, "question_id": 29838185, "link": "https://stackoverflow.com/questions/29838185/how-to-detect-additional-mime-type-in-golang", "title": "How to detect additional mime type in Golang", "body": "<p>There are <code>http.DetectContentType([]byte)</code> function in <code>net/http</code> package. But only limited number of types are supported. How to add support of <code>docx</code>, <code>doc</code>, <code>xls</code>, <code>xlsx</code>, <code>ppt</code>, <code>pps</code>, <code>odt</code>, <code>ods</code>, <code>odp</code> files not by extension, but by the content.\nAs far as I know, there are some problems, because <code>docx</code>/<code>xlsx</code>/<code>pptx</code>/<code>odp</code>/<code>odt</code> files has the same signature as the <code>zip</code> file (50 4B 03 04).</p>\n"}, {"tags": ["jquery", "http", "file-upload", "go"], "answers": [{"tags": [], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "is_accepted": true, "score": 0, "last_activity_date": 1429843145, "last_edit_date": 1429843145, "creation_date": 1429842814, "answer_id": 29837753, "question_id": 29837646, "link": "https://stackoverflow.com/questions/29837646/how-to-receive-posted-parameter-with-multipart-form-data-boundary-in-go/29837753#29837753", "title": "How to receive POSTed parameter with multipart/form-data boundary in Go", "body": "<p>Ah, we should parse <code>MultipartForm</code> first, for example:</p>\n\n<pre><code>err := request.ParseMultipartForm(1024 * 1024 * 16) // max 16 MB\n// then we could access using:\nrequest.MultipartForm.Value[`a`][0]\nrequest.MultipartForm.Value[`key`][0]\nrequest.MultipartForm.Value[`id`][0]\nrequest.MultipartForm.File[`file`]\n</code></pre>\n"}], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1112, "favorite_count": 0, "accepted_answer_id": 29837753, "answer_count": 1, "score": 0, "last_activity_date": 1429843145, "creation_date": 1429842101, "question_id": 29837646, "link": "https://stackoverflow.com/questions/29837646/how-to-receive-posted-parameter-with-multipart-form-data-boundary-in-go", "title": "How to receive POSTed parameter with multipart/form-data boundary in Go", "body": "<p>I'm using <a href=\"http://hayageek.com/docs/jquery-upload-file.php\" rel=\"nofollow\">HayaGeek's jQuery file upload</a> plugin, and successfully post a request that can be seen on the chrome's developer tool:</p>\n\n<pre><code>/* General */\nRemote Address:127.0.0.1:80\nRequest URL:http://127.0.0.1/profile/edit\nRequest Method:POST\nStatus Code:200 OK\n\n/* Response Headers */\nConnection:keep-alive\nContent-Length:101\nContent-Type:application/json\nDate:Fri, 24 Apr 2015 02:04:51 GMT\nServer:nginx/1.6.2\nSet-Cookie:SK=A; Path=/; Expires=Fri, 24 Apr 2015 04:04:51 UTC\n\n/* Request Headers */\nAccept:*/*\nAccept-Encoding:gzip, deflate\nAccept-Language:en-US,en;q=0.8,id;q=0.6\nConnection:keep-alive\nContent-Length:12855\nContent-Type:multipart/form-data; boundary=----WebKitFormBoundarydlN4BAQWeDyF512h\nCookie:SK=A\nHost:127.0.0.1\nOrigin:http://127.0.0.1\nReferer:http://127.0.0.1/profile/edit\nUser-Agent:Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.90 Safari/537.36\nX-Requested-With:XMLHttpRequest\n\n/* Request Payload */\n------WebKitFormBoundarydlN4BAQWeDyF512h\nContent-Disposition: form-data; name=\"file\"; filename=\"screen-2015-04-23-21-01-51.png\"\nContent-Type: image/png\n\n\n------WebKitFormBoundarydlN4BAQWeDyF512h\nContent-Disposition: form-data; name=\"a\"\n\nfile_upload\n------WebKitFormBoundarydlN4BAQWeDyF512h\nContent-Disposition: form-data; name=\"key\"\n\ntranscript\n------WebKitFormBoundarydlN4BAQWeDyF512h\nContent-Disposition: form-data; name=\"id\"\n\n379\n------WebKitFormBoundarydlN4BAQWeDyF512h\nContent-Disposition: form-data; name=\"\"\n\nundefined\n------WebKitFormBoundarydlN4BAQWeDyF512h--\n</code></pre>\n\n<p>There are no problem getting the uploaded <code>file</code>, using this command:</p>\n\n<pre><code>file, header, err := request.FormFile(`file`) \n// `request` is `*http.Request`\n</code></pre>\n\n<p>But I'm getting trouble getting the rest of the <code>POST</code>ed parameters, I've tried these but get no luck:</p>\n\n<pre><code> a := request.FormValue(`a`) // should be: `file_upload`\n id := request.FormValue(`id`) // should be: `transcript`\n key := request.FormValue(`key`) // should be: `379`\n // normally it's works fine, but for this plugin it doesn't work\n</code></pre>\n\n<p>A normal post request (without <code>boundary</code>, without that plugin) would give something like this, that the <code>POST</code>ed parameter can be retrieved normally using the command above:</p>\n\n<pre><code>/* General */\nRemote Address:127.0.0.1:80\nRequest URL:http://127.0.0.1/profile/edit\nRequest Method:POST\nStatus Code:200 OK\n\n/* Response Headers */\nConnection:keep-alive\nContent-Length:297\nContent-Type:application/json\nDate:Fri, 24 Apr 2015 02:17:31 GMT\nServer:nginx/1.6.2\nSet-Cookie:SK=A; Path=/; Expires=Fri, 24 Apr 2015 04:17:31 UTC\n\n- Request Headers\nAccept:*/*\nAccept-Encoding:gzip, deflate\nAccept-Language:en-US,en;q=0.8,id;q=0.6\nConnection:keep-alive\nContent-Length:23\nContent-Type:application/x-www-form-urlencoded; charset=UTF-8\nCookie:SK=A\nHost:127.0.0.1\nOrigin:http://127.0.0.1\nReferer:http://127.0.0.1/profile/edit\nUser-Agent:Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.90 Safari/537.36\nX-Requested-With:XMLHttpRequest\n\n/* Form Data */\na:show\nid:379\nkey:transcript\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1429835600, "creation_date": 1429835600, "answer_id": 29836730, "question_id": 29836620, "link": "https://stackoverflow.com/questions/29836620/passing-objects-that-implement-an-interface-with-a-pointer-receiver/29836730#29836730", "title": "Passing objects that implement an interface with a pointer receiver", "body": "<p>Just pass by reference</p>\n\n<pre><code>PrintArea(&amp;s)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1429836146, "post_id": 29836757, "comment_id": 47800253, "body": "The 2nd example will not work, the original <code>s.edge</code> will stay the same after calling Scale."}, {"owner": {"reputation": 8703, "user_id": 1540902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bd56d726b8dd8e6d9b1dd67cef2ee02?s=128&d=identicon&r=PG", "display_name": "dethtron5000", "link": "https://stackoverflow.com/users/1540902/dethtron5000"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1429836753, "post_id": 29836757, "comment_id": 47800407, "body": "@OneOfOne - right - the compile error goes away, but the application logic isn&#39;t correct.  I&#39;ll update the answer."}], "tags": [], "owner": {"reputation": 8703, "user_id": 1540902, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bd56d726b8dd8e6d9b1dd67cef2ee02?s=128&d=identicon&r=PG", "display_name": "dethtron5000", "link": "https://stackoverflow.com/users/1540902/dethtron5000"}, "is_accepted": true, "score": 2, "last_activity_date": 1429836780, "last_edit_date": 1429836780, "creation_date": 1429835807, "answer_id": 29836757, "question_id": 29836620, "link": "https://stackoverflow.com/questions/29836620/passing-objects-that-implement-an-interface-with-a-pointer-receiver/29836757#29836757", "title": "Passing objects that implement an interface with a pointer receiver", "body": "<p>The <code>Shape</code> interface requires that the receiver has two methods - <code>Scale</code> and <code>Area</code>.  Pointers to a type and the types themselves are considered different types in Go (so <code>*Square</code> and <code>Square</code> are different types). </p>\n\n<p>To implement the interface, the <code>Area</code> and <code>Scale</code> functions must be on either the type or the pointer (or both if you want).  So either</p>\n\n<pre><code>func (s *Square) Scale(num float64) {\n    s.edge *= num\n}\n\nfunc (s *Square) Area() float64 {\n    return s.edge * s.edge\n}\n\nfunc main() {\n    s := Square{10}\n    PrintArea(&amp;s)\n}\n</code></pre>\n"}], "owner": {"reputation": 318, "user_id": 1243445, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e36771d913002133adb85055ac189e07?s=128&d=identicon&r=PG", "display_name": "azani", "link": "https://stackoverflow.com/users/1243445/azani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 29836757, "answer_count": 2, "score": 0, "last_activity_date": 1429836780, "creation_date": 1429834753, "question_id": 29836620, "link": "https://stackoverflow.com/questions/29836620/passing-objects-that-implement-an-interface-with-a-pointer-receiver", "title": "Passing objects that implement an interface with a pointer receiver", "body": "<p>I understand that this has to do with the fact that Scale takes a pointer receiver. But I don't understand how I need to write PrintArea so this works.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n)\n\ntype Shape interface {\n        Scale(num float64)\n        Area() float64\n}\n\ntype Square struct {\n        edge float64\n}\n\nfunc (s *Square) Scale(num float64) {\n        s.edge *= num\n}\n\nfunc (s Square) Area() float64 {\n        return s.edge * s.edge\n}\n\nfunc PrintArea(s Shape) {\n        fmt.Println(s.Area())\n}\n\nfunc main() {\n        s := Square{10}\n        PrintArea(s)\n}\n</code></pre>\n\n<p>Here is the error I get as is.</p>\n\n<pre><code># command-line-arguments\n/tmp/sandbox126043885/main.go:30: cannot use s (type Square) as type Shape in argument to PrintArea:\n    Square does not implement Shape (Scale method has pointer receiver)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8533, "user_id": 11792, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/057dba7b6fe7b933e5ee23f7dc64dcb5?s=128&d=identicon&r=PG", "display_name": "Pavel Nikolov", "link": "https://stackoverflow.com/users/11792/pavel-nikolov"}, "edited": false, "score": 0, "creation_date": 1429833994, "post_id": 29836433, "comment_id": 47799612, "body": "I&#39;m not sure I understand your question? How did you try to add leading zeros? What causes problems?"}, {"owner": {"reputation": 618, "user_id": 1753923, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/pg8Ic.png?s=128&g=1", "display_name": "Tompina", "link": "https://stackoverflow.com/users/1753923/tompina"}, "reply_to_user": {"reputation": 8533, "user_id": 11792, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/057dba7b6fe7b933e5ee23f7dc64dcb5?s=128&d=identicon&r=PG", "display_name": "Pavel Nikolov", "link": "https://stackoverflow.com/users/11792/pavel-nikolov"}, "edited": false, "score": 0, "creation_date": 1429834184, "post_id": 29836433, "comment_id": 47799665, "body": "Oh sorry, forgot to mention that.  I did not add any code regarding adding the number because all my attempts failed."}], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 2, "last_activity_date": 1429834380, "creation_date": 1429834380, "answer_id": 29836571, "question_id": 29836433, "link": "https://stackoverflow.com/questions/29836433/golang-add-int-to-end-of-byte-array/29836571#29836571", "title": "Golang - Add int to end of byte array", "body": "<p>You want a space-padded ascii representation of a number as bytes? <code>fmt.Sprintf</code> produces a string, which you can then convert to bytes.</p>\n\n<p>Here's some code, or <a href=\"http://play.golang.org/p/WVNe4QsNMH\" rel=\"nofollow\">run it on the playground.</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    bs := []byte(fmt.Sprintf(\"%2d\", 7))\n    fmt.Println(bs)\n}\n</code></pre>\n"}], "owner": {"reputation": 618, "user_id": 1753923, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/pg8Ic.png?s=128&g=1", "display_name": "Tompina", "link": "https://stackoverflow.com/users/1753923/tompina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1309, "favorite_count": 0, "accepted_answer_id": 29836571, "answer_count": 1, "score": -3, "last_activity_date": 1429834380, "creation_date": 1429833564, "question_id": 29836433, "link": "https://stackoverflow.com/questions/29836433/golang-add-int-to-end-of-byte-array", "title": "Golang - Add int to end of byte array", "body": "<p>I am trying to add an int to the end of a byte array in Golang.<br>\nThis is my current code:  </p>\n\n<pre><code>nameLengthBytes := []byte{32, 32}\nnameLength := len(name)\n</code></pre>\n\n<p>The <strong>nameLengthBytes</strong> creates 2 spaces, and what I'm looking for is a way to add the <strong>nameLength</strong> to the end of the <strong>nameLengthBytes</strong>.  </p>\n\n<p><em>Examples:</em><br>\nif name length is 7, I want the array to be: {32, 55}<br>\nIf name length is 12, I want the array to be {49, 50}</p>\n\n<p>The problem is that sometimes the name is shorter than 10 so I need to fill up with a leading zero.  </p>\n"}, {"tags": ["variables", "go", "sqlite"], "comments": [{"owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "edited": false, "score": 1, "creation_date": 1429813946, "post_id": 29831469, "comment_id": 47789749, "body": "Have you studied the example in <a href=\"http://golang.org/pkg/database/sql/#example_DB_Query\" rel=\"nofollow noreferrer\"><code>DB.Query(...)</code></a>?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429819105, "post_id": 29831469, "comment_id": 47792909, "body": "Side note/nit: move the <code>sql.Open</code> elsewhere and re-use the returned <code>db</code> value. Similarly you can re-use your prepared statement. <a href=\"https://golang.org/pkg/database/sql/#Open\" rel=\"nofollow noreferrer\">The docs</a>: &quot;The returned DB is safe for concurrent use by multiple goroutines and maintains its own pool of idle connections. Thus, the Open function should be called just once. It is rarely necessary to close a DB.&quot;"}, {"owner": {"reputation": 33, "user_id": 2401132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/96mss.jpg?s=128&g=1", "display_name": "Sayajin", "link": "https://stackoverflow.com/users/2401132/sayajin"}, "edited": false, "score": 0, "creation_date": 1430348464, "post_id": 29831469, "comment_id": 48032961, "body": "@evanmcdonnal ok posted my full script above as an edit"}, {"owner": {"reputation": 33, "user_id": 2401132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/96mss.jpg?s=128&g=1", "display_name": "Sayajin", "link": "https://stackoverflow.com/users/2401132/sayajin"}, "edited": false, "score": 0, "creation_date": 1431526235, "post_id": 29831469, "comment_id": 48538529, "body": "<i>bump</i> <i>bump</i> <i>bump</i>"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 2401132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/96mss.jpg?s=128&g=1", "display_name": "Sayajin", "link": "https://stackoverflow.com/users/2401132/sayajin"}, "edited": false, "score": 0, "creation_date": 1430029631, "post_id": 29833021, "comment_id": 47873664, "body": "If I try the simpler less robust option 1 I get the error: too many arguments to return"}, {"owner": {"reputation": 33, "user_id": 2401132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/96mss.jpg?s=128&g=1", "display_name": "Sayajin", "link": "https://stackoverflow.com/users/2401132/sayajin"}, "edited": false, "score": 0, "creation_date": 1430029650, "post_id": 29833021, "comment_id": 47873672, "body": "If I use the 2nd option I get error: cannot use p (type *Player) as type Player in append"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 33, "user_id": 2401132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/96mss.jpg?s=128&g=1", "display_name": "Sayajin", "link": "https://stackoverflow.com/users/2401132/sayajin"}, "edited": false, "score": 0, "creation_date": 1430149052, "post_id": 29833021, "comment_id": 47922788, "body": "@Sayajin the first error is because your method has no return type, if you&#39;re using option one the method containing that code should return at least a string (convention would probably be to return <code>(string, error)</code>). In the second case it&#39;s because the collection needs to be <code>[]*Player</code>, I&#39;ll edit with that. You could also change the code in the loop to use a <code>Player</code> value type but I prefer the pointer implementation."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1430149062, "last_edit_date": 1495539914, "creation_date": 1429818675, "answer_id": 29833021, "question_id": 29831469, "link": "https://stackoverflow.com/questions/29831469/golang-sqlite3-database-output-into-varible/29833021#29833021", "title": "Golang sqlite3 database output into varible", "body": "<p>I think what you're failing to understand is how to model the data in your Go app (after it's returned from the db). The variables you're using to store the values you read are only scoped for the loop and are singletons, how would you return a collection? Well by using a collection of course!</p>\n\n<p>So here are the two options I would consider; </p>\n\n<p>1) just concat everything into one big string. If you're going to dump the output to the console soon after his and you don't have any real processing to do, it's probably simplest to just declare a string before the loop, keep your scan as it is, append the results into the string in some common format like comma delimited then pass that to the function/write it to IRC or whatever.</p>\n\n<p>2) use an actual collection. In any serious program you're probably going to do more with data coming from a db than print just print it. A more realistic implementation would be to create Player struct which has teamName and playerName fields. Before the loop you'd initialize a slice of Players or an array if you know how many results will be coming back. In the loop you would create a new instance and add it to the slice with the append function. After the loop you pass the slice/array to whatever needs to use the data next.</p>\n\n<p>Here are couple samples. Note that these are both untested and I am not considering performance. For example if performance were a concern you should probably be using something like this for string concatenation <a href=\"https://stackoverflow.com/questions/1760757/how-to-efficiently-concatenate-strings-in-go\">How to efficiently concatenate strings in Go?</a></p>\n\n<pre><code>type Player struct {\n    TeamName string\n    PlayerName string\n}\n\nvar Players []*Player\nfor rows.Next() {\n        p := &amp;Player{}\n        if err := rows.Scan(p.TeamName, p.PlayerName); err != nil{\n             // handle error\n        }\n        Players = append(Players, p)\n}\n// pass Players to next function/return it whatever\n\n\n// simpler less robust option 1\n\nlineUp := \"\"\nfor rows.Next() {\n            var team string\n            var player string\n            rows.Scan(&amp;team, &amp;player)\n            lineUp += team + \":\" + player \"\\n\"\n    }\nreturn lineUp\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 2401132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/96mss.jpg?s=128&g=1", "display_name": "Sayajin", "link": "https://stackoverflow.com/users/2401132/sayajin"}, "edited": false, "score": 0, "creation_date": 1430029940, "post_id": 29833030, "comment_id": 47873726, "body": "If i try this way I get the errors: 121: undefined: tplist 123: undefined: tplist 123: too many arguments to return"}, {"owner": {"reputation": 261, "user_id": 3203010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4126be72c1d98520261d7fc84c02db7?s=128&d=identicon&r=PG&f=1", "display_name": "user3203010", "link": "https://stackoverflow.com/users/3203010/user3203010"}, "reply_to_user": {"reputation": 33, "user_id": 2401132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/96mss.jpg?s=128&g=1", "display_name": "Sayajin", "link": "https://stackoverflow.com/users/2401132/sayajin"}, "edited": false, "score": 0, "creation_date": 1430150828, "post_id": 29833030, "comment_id": 47924063, "body": "Can you post your new code and function, have you declared you are going to return type tpList? cannot correlate the error lines you have posted without the code"}, {"owner": {"reputation": 33, "user_id": 2401132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/96mss.jpg?s=128&g=1", "display_name": "Sayajin", "link": "https://stackoverflow.com/users/2401132/sayajin"}, "edited": false, "score": 0, "creation_date": 1430208606, "post_id": 29833030, "comment_id": 47949453, "body": "I will paste my script here soon, then at least then some1 can point me in the correct direction, as I said I am a total golang newb but i learn best by doing, and starting a project is the best way for me."}], "tags": [], "owner": {"reputation": 261, "user_id": 3203010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4126be72c1d98520261d7fc84c02db7?s=128&d=identicon&r=PG&f=1", "display_name": "user3203010", "link": "https://stackoverflow.com/users/3203010/user3203010"}, "is_accepted": false, "score": 0, "last_activity_date": 1429818714, "creation_date": 1429818714, "answer_id": 29833030, "question_id": 29831469, "link": "https://stackoverflow.com/questions/29831469/golang-sqlite3-database-output-into-varible/29833030#29833030", "title": "Golang sqlite3 database output into varible", "body": "<p>try putting your team and player in a struct</p>\n\n<pre><code>type teamplayer struct {\n   team string\n   player string\n</code></pre>\n\n<p>}</p>\n\n<p>Now in your function where you will query the db, create a list of teamplayer</p>\n\n<pre><code>var tpList []teamplayer\nfor rows.Next() {\n        var tp teamplayer\n        if err := rows.Scan(&amp;tp.team, &amp;tp.player); err != nil{\n             //process what to do in case of error\n        }\n        tplist = append (tplist, tp)\n}//end of for loop\nreturn tplist\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 2401132, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/96mss.jpg?s=128&g=1", "display_name": "Sayajin", "link": "https://stackoverflow.com/users/2401132/sayajin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1823, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1430245043, "creation_date": 1429813420, "last_edit_date": 1430245043, "question_id": 29831469, "link": "https://stackoverflow.com/questions/29831469/golang-sqlite3-database-output-into-varible", "title": "Golang sqlite3 database output into varible", "body": "<p>I have just recently started faffing with golang.\nI taught myself php &amp; jquery pretty easily &amp; by creating a project to do so.</p>\n\n<p>I am trying the same atm to teach myself golang, but I have gotten to a point\nnow which either im missing the point or just searching incorrectly.</p>\n\n<p>....</p>\n\n<p>Ok so what I am trying to do is make a IRC bot.\nThe one function listens to channel chatter &amp; if certain commands are picked up\nit then will add relevant information to a sqlite3 database.</p>\n\n<p>The problem is that one of the commands queries the database &amp; will return multiple rows, which then need to be passed back to the original function &amp; outputted into the IRC channel.</p>\n\n<p>Where I am getting stuck is returning the queries output to the original function since it is multiple rows of data</p>\n\n<p>Im importing the below libraries\n<code>fmt</code>\n<code>net/textproto</code>\n<code>regexp</code>\n<code>strings</code>\n<code>os</code>\n<code>database/sql</code>\n<code>_ github.com/mattn/go-sqlite3</code></p>\n\n<pre><code>func getLineup() {\n    // Open Database\n    db, err := sql.Open(\"sqlite3\", \"./database.db\")\n    if err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n    }\n    defer db.Close()\n\n    // Prepare Query\n    statement, err := db.Prepare(\"SELECT team, player FROM lineup ORDER BY team DESC;\")\n    if err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n    }\n\n    // Execute Statement\n    rows, err := statement.Query()\n    defer rows.Close()\n\n\n    fmt.Println(\"Lineup:\")\n\n    for rows.Next() {\n            var team string\n            var player string\n            rows.Scan(&amp;team, &amp;player)\n            fmt.Printf(\"%v %v\\n\", team, player)\n    }\n\n}\n</code></pre>\n\n<p>So I can print it, but I need to pass it to another function which is where im lost</p>\n\n<p><code>================================UPDATE====================================</code></p>\n\n<p>Ok so here is my full code...\n@evanmcdonnal With the updated code you gave above I now get the error\n<code>\nbot.go:70: cannot use p (type Player) as type *Player in append\n</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/textproto\"\n    \"regexp\"\n    \"log\"\n    \"strings\"\n    \"database/sql\"\n    // SQLite3\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\n\ntype PrivMsg struct {\n    nick, channel, text string\n}\n\nvar (\n    conn *textproto.Conn\n    err  error\n\n    ping    = regexp.MustCompile(\"^PING :([a-zA-Z0-9\\\\.]+)$\")\n    motd    = regexp.MustCompile(\":End of /MOTD command\\\\.$\")\n    privmsg = regexp.MustCompile(\"^:([a-zA-Z0-9`_\\\\-]+)![a-zA-Z0-9/\\\\\\\\\\\\.\\\\-]+@[a-zA-Z0-9/\\\\\\\\\\\\.\\\\-]+ PRIVMSG (#[a-zA-Z0-9]+) :(.*)$\")\n)\n\n\nfunc talk(channel, msg string) {\n    conn.Cmd(\"PRIVMSG \" + channel + \" :\" + msg)\n}\n\n\nfunc handlePing(auth string) {\n    conn.Cmd(\"PONG :\" + auth)\n    fmt.Printf(\"PONG :%s\\n\", auth)\n}\n\ntype Player struct {\n    TeamName string\n    PlayerName string\n}\n\nfunc getLineup() {\n    // Open Database\n    db, err := sql.Open(\"sqlite3\", \"./database.db\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Prepare Query\n    statement, err := db.Prepare(\"SELECT team, player FROM lineup ORDER BY team DESC;\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Execute Statement\n    rows, err := statement.Query()\n    defer rows.Close()\n\n\n// Output Code\n    var Players []*Player\n    for rows.Next() {\n        p := &amp;Player{}\n        if err := rows.Scan(p.TeamName, p.PlayerName); err != nil{\n            log.Fatal(err)\n        }\n        //Players = append(Players, p)\n        return p.TeamName, p.PlayerName\n    }\n    // pass Players to next function/return it whatever\n\n    fmt.Println(Players)\n}\n\n\n\n\nfunc handlePrivmsg(pm *PrivMsg) {\n    if strings.Contains(pm.text, \"!add t\") {\n        talk(pm.channel, pm.nick + \" added to Terrorists\")\n        saveLineup(\"T\", pm.nick)\n    }\n    if strings.Contains(pm.text, \"!add ct\") {\n        talk(pm.channel, pm.nick + \" added to Counter-Terrorists\")\n        saveLineup(\"CT\", pm.nick)\n    }\n    if strings.Contains(pm.text, \"!rem\") {\n        talk(pm.channel, pm.nick + \" has been removed from the current lineup\")\n    }\n    if strings.Contains(pm.text, \"!votemap\") {\n        talk(pm.channel, pm.nick + \" map vote code\")\n    }\n    if strings.Contains(pm.text, \"!moveme\") {\n        talk(pm.channel, pm.nick + \" has been moved to Counter-Terrorists\")\n    }\n    if strings.Contains(pm.text, \"!teams\") {\n        getLineup()\n        //fmt.Println(*tpList)\n        talk(pm.channel, pm.nick + \" will show the current teams\")\n    }\n    if strings.Contains(pm.text, \"!add ct\") {\n        talk(pm.channel, pm.nick + \" added to Counter-Terrorists\")\n    }\n    if strings.Contains(pm.text, \"pug-bot\") {\n        talk(pm.channel, \"Hello, \" + pm.nick + \"!\")\n    }\n}\n\n\nfunc saveLineup(Team, Player string) {\n\n    // Open Database\n    db, err := sql.Open(\"sqlite3\", \"./database.db\")\n    if err != nil {\n        //log.Fatal(err)\n        fmt.Printf(\"%s\", err)\n    }\n\n    // Get Current Lineup\n    rows, err := db.Query(\"SELECT team, player FROM lineup WHERE player = ?;\", Player)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n\n    if Player == Player {\n        fmt.Println(\"You have already added yourself\")\n    } else {\n        // Insert new Player\n        db.Exec(\n            \"INSERT INTO lineup (team, player) VALUES (?, ?);\",\n            Team,\n            Player,\n        )\n    }\n\n}\n\n\nfunc handleMotd() {\n    conn.Cmd(\"JOIN #ircchannel\")\n    fmt.Println(\"JOIN #ircchannel\")\n}\n\n\nfunc parseLine(line string) {\n    // Channel activity\n    if match := privmsg.FindStringSubmatch(line); match != nil {\n        pm := new(PrivMsg)\n        pm.nick, pm.channel, pm.text = match[1], match[2], match[3]\n        handlePrivmsg(pm)\n        return\n    }\n\n    // Server PING\n    if match := ping.FindStringSubmatch(line); match != nil {\n        handlePing(match[1])\n        return\n    }\n\n    // End of MOTD (successful login to IRC server)\n    if match := motd.FindString(line); match != \"\" {\n        handleMotd()\n        return\n    }\n}\n\nfunc main() {\n    conn, err = textproto.Dial(\"tcp\", \"irc.server.org:6667\")\n    if err != nil {\n        fmt.Printf(\"%s\", err)\n        return\n    }\n\n    conn.Cmd(\"NICK pug-bot\\n\\rUSER pug-bot 8 * :pAsSwOrD\")\n\n    for {\n        text, err := conn.ReadLine()\n        if err != nil {\n            fmt.Printf(\"%s\", err)\n            return\n        }\n\n        go parseLine(text)\n\n        fmt.Println(text)\n    }\n\n\n}\n</code></pre>\n\n<p>Essentially I would like to pass the result of the sql query back into the <code>talk(pm.channel, pm.nick + \" SQL QUERY RESULT\")</code> irc talk section</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 3, "creation_date": 1429803279, "post_id": 29827896, "comment_id": 47782527, "body": "I recommend elaborating on what you&#39;re trying to do. You use &quot;fun in&quot; - one &quot;fun out&quot; behavior as if it&#39;s a term every programmer does/should know when it&#39;s not at all."}, {"owner": {"reputation": 437, "user_id": 2952763, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a368475adb5b26f532180d2b4a383aed?s=128&d=identicon&r=PG&f=1", "display_name": "Oleg", "link": "https://stackoverflow.com/users/2952763/oleg"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1429803694, "post_id": 29827896, "comment_id": 47782861, "body": "Ok @evanmcdonnal I specified it. &quot;A function can read from multiple inputs and proceed until all are closed by multiplexing the input channels onto a single channel that&#39;s closed when all the inputs are closed. This is called fan-in.&quot; (<a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">blog.golang.org/pipelines</a>)"}, {"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 1, "creation_date": 1429803878, "post_id": 29827896, "comment_id": 47783016, "body": "Doesn&#39;t it mean that <code>MergeByGoRoutines</code> just works in parallel? Probably <code>select</code> adds some overhead, too?"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 1, "creation_date": 1429805346, "post_id": 29827896, "comment_id": 47784099, "body": "The correct terms are &quot;<i>fan</i> in&quot; and &quot;<i>fan</i> out&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": false, "score": 3, "last_activity_date": 1429813340, "last_edit_date": 1429813340, "creation_date": 1429812737, "answer_id": 29831277, "question_id": 29827896, "link": "https://stackoverflow.com/questions/29827896/fan-in-one-fan-out-behavior/29831277#29831277", "title": "&quot;fan in&quot; - one &quot;fan out&quot; behavior", "body": "<p>Here is a preliminary remark. The channels in your examples are all unbuffered, meaning they will likely block at put or get time.</p>\n\n<p>In this example, there is almost no processing except channel management. The performance is therefore dominated by synchronization primitives. Actually, there is very little of this code that can be parallelized.</p>\n\n<p>In the MergeByReflection and MergeByCode functions, select is used to listen to multiple input channels, but nothing is done to take in account the output channel (which may therefore block, while some event could be available on one of the input channels). </p>\n\n<p>In the MergeByGoRoutines function, this situation cannot happen: when the output channel blocks, it does not prevent an other input channel to be read by another goroutine. There are therefore better opportunities for the runtime to parallelize the goroutines, and less contention on the input channels.</p>\n\n<p>The MergeByReflection code is the slowest because it has the overhead of reflection, and almost nothing can be parallelized.</p>\n\n<p>The MergeByGoRoutines function is the fastest because it reduces the contention (less synchronization is needed), and because output contention has a lesser impact on the input performance. It can therefore benefit of a small improvement when running with multiple cores (contrary to the two other methods).</p>\n\n<p>There is so much synchronization activity with MergeByReflection and MergeByCode, that running on multiple cores negatively impacts the performance. You could have different performance by using buffered channels though.</p>\n"}], "owner": {"reputation": 437, "user_id": 2952763, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a368475adb5b26f532180d2b4a383aed?s=128&d=identicon&r=PG&f=1", "display_name": "Oleg", "link": "https://stackoverflow.com/users/2952763/oleg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 596, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1429813340, "creation_date": 1429802768, "last_edit_date": 1429808073, "question_id": 29827896, "link": "https://stackoverflow.com/questions/29827896/fan-in-one-fan-out-behavior", "title": "&quot;fan in&quot; - one &quot;fan out&quot; behavior", "body": "<p>Say, we have three methods to implement \"fan in\" behavior </p>\n\n<pre><code>func MakeChannel(tries int) chan int {\n    ch := make(chan int)\n\n    go func() {\n        for i := 0; i &lt; tries; i++ {\n            ch &lt;- i\n        }\n        close(ch)\n    }()\n\n    return ch\n}\n\nfunc MergeByReflection(channels ...chan int) chan int {\n    length := len(channels)\n    out := make(chan int)\n    cases := make([]reflect.SelectCase, length)\n    for i, ch := range channels {\n        cases[i] = reflect.SelectCase{Dir: reflect.SelectRecv, Chan: reflect.ValueOf(ch)}\n    }\n    go func() {\n        for length &gt; 0 {\n            i, line, opened := reflect.Select(cases)\n            if !opened {\n                cases[i].Chan = reflect.ValueOf(nil)\n                length -= 1\n            } else {\n                out &lt;- int(line.Int())\n            }\n        }\n        close(out)\n    }()\n    return out\n}\n\nfunc MergeByCode(channels ...chan int) chan int {\n    length := len(channels)\n    out := make(chan int)\n    go func() {\n        var i int\n        var ok bool\n\n        for length &gt; 0 {\n            select {\n            case i, ok = &lt;-channels[0]:\n                out &lt;- i\n                if !ok {\n                    channels[0] = nil\n                    length -= 1\n                }\n            case i, ok = &lt;-channels[1]:\n                out &lt;- i\n                if !ok {\n                    channels[1] = nil\n                    length -= 1\n                }\n            case i, ok = &lt;-channels[2]:\n                out &lt;- i\n                if !ok {\n                    channels[2] = nil\n                    length -= 1\n                }\n            case i, ok = &lt;-channels[3]:\n                out &lt;- i\n                if !ok {\n                    channels[3] = nil\n                    length -= 1\n                }\n            case i, ok = &lt;-channels[4]:\n                out &lt;- i\n                if !ok {\n                    channels[4] = nil\n                    length -= 1\n                }\n            }\n        }\n        close(out)\n    }()\n    return out\n}\n\nfunc MergeByGoRoutines(channels ...chan int) chan int {\n    var group sync.WaitGroup\n\n    out := make(chan int)\n    for _, ch := range channels {\n        go func(ch chan int) {\n            for i := range ch {\n                out &lt;- i\n            }\n            group.Done()\n        }(ch)\n    }\n    group.Add(len(channels))\n    go func() {\n        group.Wait()\n        close(out)\n    }()\n    return out\n}\n\ntype MergeFn func(...chan int) chan int\n\nfunc main() {\n    length := 5\n    tries := 1000000\n    channels := make([]chan int, length)\n    fns := []MergeFn{MergeByReflection, MergeByCode, MergeByGoRoutines}\n\n    for _, fn := range fns {\n        sum := 0\n        t := time.Now()\n        for i := 0; i &lt; length; i++ {\n            channels[i] = MakeChannel(tries)\n        }\n        for i := range fn(channels...) {\n            sum += i\n        }\n        fmt.Println(time.Since(t))\n        fmt.Println(sum)\n    }\n}\n</code></pre>\n\n<p>Results are (at 1 CPU, I have used runtime.GOMAXPROCS(1)):<br>\n<strong>19.869s (MergeByReflection)</strong><br>\n2499997500000<br>\n<strong>8.483s (MergeByCode)</strong><br>\n2499997500000<br>\n<strong>4.977s (MergeByGoRoutines)</strong><br>\n2499997500000  </p>\n\n<p>Results are (at 2 CPU, I have used runtime.GOMAXPROCS(2)):<br>\n<strong>44.94s</strong><br>\n2499997500000<br>\n<strong>10.853s</strong><br>\n2499997500000<br>\n<strong>3.728s</strong><br>\n2499997500000</p>\n\n<ul>\n<li>I understand the reason why MergeByReflection is slowest, but what is about the difference between MergeByCode and MergeByGoRoutines?  </li>\n<li>And when we increase the CPU number why \"select\" clause (used MergeByReflection directly and in MergeByCode indirectly) becomes slower?  </li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "edited": false, "score": 0, "creation_date": 1429796059, "post_id": 29824802, "comment_id": 47776472, "body": "I&#39;m betting it&#39;s being changed somewhere else. Try running <code>source .bash_profile</code> and then <code>go env</code> again."}, {"owner": {"reputation": 11, "user_id": 4824359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a26169ceca7cf80716a3221359dd2d02?s=128&d=identicon&r=PG&f=1", "display_name": "jiang jingwei", "link": "https://stackoverflow.com/users/4824359/jiang-jingwei"}, "reply_to_user": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "edited": false, "score": 0, "creation_date": 1429797006, "post_id": 29824802, "comment_id": 47777297, "body": "I run it again, but result is the same."}, {"owner": {"reputation": 11, "user_id": 4824359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a26169ceca7cf80716a3221359dd2d02?s=128&d=identicon&r=PG&f=1", "display_name": "jiang jingwei", "link": "https://stackoverflow.com/users/4824359/jiang-jingwei"}, "reply_to_user": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "edited": false, "score": 0, "creation_date": 1429797035, "post_id": 29824802, "comment_id": 47777323, "body": "I run the command &quot;go env GOPATH&quot;, the output is correct &quot;/Users/jjw/gocode&quot;"}, {"owner": {"reputation": 11, "user_id": 4824359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a26169ceca7cf80716a3221359dd2d02?s=128&d=identicon&r=PG&f=1", "display_name": "jiang jingwei", "link": "https://stackoverflow.com/users/4824359/jiang-jingwei"}, "reply_to_user": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "edited": false, "score": 0, "creation_date": 1429797397, "post_id": 29824802, "comment_id": 47777634, "body": "if I run  <code>export GOPATH=&#47;Users&#47;jjw&#47;gocode </code> in command line,  the result will correct, I don&#39;t know what&#39;s the difference with <code>source .bash_profile</code> ."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1429798852, "post_id": 29824802, "comment_id": 47778763, "body": "Hidden, non-printable character?  Try adding that line to a file on its own (by retying, not copy/paste) and source it instead.  See if that works and if so, just retype in .bash_profile."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1429802487, "post_id": 29824802, "comment_id": 47781917, "body": "show your .bash_profile. Otherwise it&#39;s only wild guessing."}, {"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1429805088, "post_id": 29824802, "comment_id": 47783902, "body": "Why is &quot;go env&quot; picking up OPATH?  I would reinstall / update Go.  I don&#39;t think it has anything to do with you bash profile."}, {"owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "edited": false, "score": 0, "creation_date": 1429805514, "post_id": 29824802, "comment_id": 47784221, "body": "What shell are you using?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429810026, "post_id": 29824802, "comment_id": 47787330, "body": "It&#39;s almost certainly an embedded carriage return &#39;\\r&#39; at the end. <code>go env</code> is printing GOPATH=&quot;/Users/jjw/gocode\\r&quot;. Find and remove the errant character."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "edited": false, "score": 0, "creation_date": 1429810249, "post_id": 29824802, "comment_id": 47787459, "body": "@openwonk, reinstall?? That&#39;s would almost certainly be an unproductive waste of time in this case."}], "answers": [{"tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": false, "score": 3, "last_activity_date": 1429810105, "creation_date": 1429810105, "answer_id": 29830467, "question_id": 29824802, "link": "https://stackoverflow.com/questions/29824802/why-gopath-turned-to-opath-in-go-env/29830467#29830467", "title": "Why GOPATH turned to &quot;OPATH in go env", "body": "<p>I suppose your export GOPATH line terminates by \\r\\n (a la Windows) instead of just \\n (a la Unix).</p>\n\n<p>The \\r is the carriage return character. It just resets the column number. So that's why the \" character is displayed on top of the G character.</p>\n\n<p>You can check this point by using the od or hexdump command on your .bash_profile file.</p>\n"}], "owner": {"reputation": 11, "user_id": 4824359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a26169ceca7cf80716a3221359dd2d02?s=128&d=identicon&r=PG&f=1", "display_name": "jiang jingwei", "link": "https://stackoverflow.com/users/4824359/jiang-jingwei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1429810105, "creation_date": 1429795359, "last_edit_date": 1429796603, "question_id": 29824802, "link": "https://stackoverflow.com/questions/29824802/why-gopath-turned-to-opath-in-go-env", "title": "Why GOPATH turned to &quot;OPATH in go env", "body": "<pre><code>localhost:~ jjw$ cat .bash_profile\nexport GOPATH=\"/Users/jjw/gocode\"\nlocalhost:~ jjw$\nlocalhost:~ jjw$ source .bash_profile\nlocalhost:~ jjw$ go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOCHAR=\"6\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\n\"OPATH=\"/Users/jjw/gocode \nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-    arguments -fmessage-length=0 -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>I am confused as to why GOPATH turned to \"OPATH.</p>\n"}, {"tags": ["go", "zeromq"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429810603, "post_id": 29824285, "comment_id": 47787686, "body": "Image screen shots are <b>not</b> a good way to present text information. In the future please learn how to cut-n-paste <i>text</i> that is then easier to read, searchable, and easily cut-n-pasted further."}, {"owner": {"reputation": 599, "user_id": 2177545, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/fcb01192b105f8a31e4531a228050023?s=128&d=identicon&r=PG", "display_name": "mmarques", "link": "https://stackoverflow.com/users/2177545/mmarques"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429869119, "post_id": 29824285, "comment_id": 47814476, "body": "Thanks for the advice, I edited the post to be more readable"}], "answers": [{"comments": [{"owner": {"reputation": 206, "user_id": 4824870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713f8db8763a5352eca7d85e67859e6f?s=128&d=identicon&r=PG&f=1", "display_name": "alex mullins", "link": "https://stackoverflow.com/users/4824870/alex-mullins"}, "edited": false, "score": 0, "creation_date": 1429802194, "post_id": 29827547, "comment_id": 47781667, "body": "EDIT: Also I found this issue on the zmq4 github repo: <a href=\"https://github.com/pebbe/zmq4/issues/3\" rel=\"nofollow noreferrer\">github.com/pebbe/zmq4/issues/3</a>. There is an explanation on how to get zmq and zmq4 working together."}], "tags": [], "owner": {"reputation": 206, "user_id": 4824870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713f8db8763a5352eca7d85e67859e6f?s=128&d=identicon&r=PG&f=1", "display_name": "alex mullins", "link": "https://stackoverflow.com/users/4824870/alex-mullins"}, "is_accepted": false, "score": 1, "last_activity_date": 1429801789, "creation_date": 1429801789, "answer_id": 29827547, "question_id": 29824285, "link": "https://stackoverflow.com/questions/29824285/zeromq-golang-binding-cannot-build-on-windows/29827547#29827547", "title": "ZeroMq Golang binding cannot build on Windows", "body": "<p>Make sure that you have the MinGW gcc toolchain installed. Go needs it to be able to call C code from Go code which zmq4 is doing. If you check out the zmq4 repo you can see the .h header file. See: <a href=\"https://golang.org/doc/install\" rel=\"nofollow\">https://golang.org/doc/install</a> and <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow\">https://golang.org/cmd/cgo/</a>.</p>\n"}], "owner": {"reputation": 599, "user_id": 2177545, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/fcb01192b105f8a31e4531a228050023?s=128&d=identicon&r=PG", "display_name": "mmarques", "link": "https://stackoverflow.com/users/2177545/mmarques"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 980, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1429869053, "creation_date": 1429794201, "last_edit_date": 1429869053, "question_id": 29824285, "link": "https://stackoverflow.com/questions/29824285/zeromq-golang-binding-cannot-build-on-windows", "title": "ZeroMq Golang binding cannot build on Windows", "body": "<p>I'm trying to get Go ZMQ4 binding to work on windows.\nUnfortunately, i'm not able to build the zmq library neither Gozmq software and get the following errors:</p>\n\n<pre><code>*** Since this library must not contain undefined symbols,\n</code></pre>\n\n<p><strong>* because either the platform does not support them or\n<em></strong> it was explicitly requested with -no-undefined,\n<strong></em> libtool will only create a static version of it.\nmake[2]: Leaving directory <code>/e/Users/mmarques/Desktop/zeromq-4.0.5/src'\nmake[1]: Leaving directory</code>/e/Users/mmarques/Desktop/zeromq-4.0.5/src'\nMaking all in doc\nmake[1]: Entering directory <code>/e/Users/mmarques/Desktop/zeromq-4.0.5/doc'\nmake[1]: Nothing to be done for</code>all'.\nmake[1]: Leaving directory <code>/e/Users/mmarques/Desktop/zeromq-4.0.5/doc'\nMaking all in perf\nmake[1]: Entering directory</code>/e/Users/mmarques/Desktop/zeromq-4.0.5/perf'\n  CXX    local_lat.o\n  CXXLD  local_lat.exe\nlocal_lat.o: In function <code>main':\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:45: undefined referenc\ne to</code>__imp_zmq_init'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:51: undefined referenc\ne to <code>__imp_zmq_socket'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:57: undefined referenc\ne to</code>__imp_zmq_bind'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:63: undefined referenc\ne to <code>__imp_zmq_msg_init'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:69: undefined referenc\ne to</code>__imp_zmq_recvmsg'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:75: undefined referenc\ne to <code>__imp_zmq_msg_size'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:79: undefined referenc\ne to</code>__imp_zmq_sendmsg'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:72: undefined referenc\ne to <code>__imp_zmq_strerror'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:86: undefined referenc\ne to</code>__imp_zmq_msg_close'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:92: undefined referenc\ne to <code>__imp_zmq_sleep'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:94: undefined referenc\ne to</code>__imp_zmq_close'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:100: undefined referen\nce to <code>__imp_zmq_term'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:102: undefined referen\nce to</code>__imp_zmq_strerror'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:81: undefined referenc\ne to <code>__imp_zmq_strerror'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:59: undefined referenc\ne to</code>__imp_zmq_strerror'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:65: undefined referenc\ne to <code>__imp_zmq_strerror'\ne:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:96: undefined referenc\ne to</code>__imp_zmq_strerror'\nlocal_lat.o:e:\\Users\\mmarques\\Desktop\\zeromq-4.0.5\\perf/local_lat.cpp:88: more u\nndefined references to <code>__imp_zmq_strerror' follow\ncollect2.exe: error: ld returned 1 exit status\nmake[1]: *** [local_lat.exe] Error 1\nmake[1]: Leaving directory</code>/e/Users/mmarques/Desktop/zeromq-4.0.5/perf'\nmake: *</strong> [all-recursive] Error 1</p>\n\n<p>What I've done was download Zmq Sources and perform a </p>\n\n<blockquote>\n  <p>sh configure</p>\n  \n  <p>make</p>\n</blockquote>\n\n<p>Can anyone help me figure out how to solve this, and setup up a Zmq Go Binding on Windows environment?</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1429808963, "post_id": 29817535, "comment_id": 47786637, "body": "There is no need to <a href=\"http://meta.stackexchange.com/questions/19190/should-questions-include-tags-in-their-titles\">prefix question titles with their tags</a>, please edit the title. Also, please do not abuse <b>bold</b> markup."}], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 2278893, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Et28N.jpg?s=128&g=1", "display_name": "Akash Shinde", "link": "https://stackoverflow.com/users/2278893/akash-shinde"}, "edited": false, "score": 0, "creation_date": 1429780033, "post_id": 29818130, "comment_id": 47764052, "body": "thanx for clarified ans"}, {"owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "reply_to_user": {"reputation": 825, "user_id": 2278893, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Et28N.jpg?s=128&g=1", "display_name": "Akash Shinde", "link": "https://stackoverflow.com/users/2278893/akash-shinde"}, "edited": false, "score": 0, "creation_date": 1429780057, "post_id": 29818130, "comment_id": 47764065, "body": "@AkashShinde No worries :-)"}, {"owner": {"reputation": 825, "user_id": 2278893, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Et28N.jpg?s=128&g=1", "display_name": "Akash Shinde", "link": "https://stackoverflow.com/users/2278893/akash-shinde"}, "edited": false, "score": 0, "creation_date": 1430292309, "post_id": 29818130, "comment_id": 47995506, "body": "above method is adding element as array"}, {"owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "reply_to_user": {"reputation": 825, "user_id": 2278893, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Et28N.jpg?s=128&g=1", "display_name": "Akash Shinde", "link": "https://stackoverflow.com/users/2278893/akash-shinde"}, "edited": false, "score": 0, "creation_date": 1430293860, "post_id": 29818130, "comment_id": 47996506, "body": "@AkashShinde I thought in your question that&#39;s the update you wanted. The <a href=\"http://docs.mongodb.org/manual/reference/operator/update/push/\" rel=\"nofollow noreferrer\"><b><code>$push</code></b></a> operator appends a specified value to an array. Consider using the <a href=\"http://docs.mongodb.org/manual/reference/operator/update/addToSet/\" rel=\"nofollow noreferrer\"><b><code>$addToSet</code></b></a> operator, it adds a value to an array unless the value is already present, in which case <a href=\"http://docs.mongodb.org/manual/reference/operator/update/addToSet/\" rel=\"nofollow noreferrer\"><b><code>$addToSet</code></b></a> does nothing to that array."}, {"owner": {"reputation": 825, "user_id": 2278893, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Et28N.jpg?s=128&g=1", "display_name": "Akash Shinde", "link": "https://stackoverflow.com/users/2278893/akash-shinde"}, "edited": false, "score": 0, "creation_date": 1430295039, "post_id": 29818130, "comment_id": 47997154, "body": "sorry your code working fine, i did mistake , i was appending array to array"}], "tags": [], "owner": {"reputation": 87200, "user_id": 122005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/MX2CF.jpg?s=128&g=1", "display_name": "chridam", "link": "https://stackoverflow.com/users/122005/chridam"}, "is_accepted": true, "score": 2, "last_activity_date": 1473790890, "last_edit_date": 1473790890, "creation_date": 1429778623, "answer_id": 29818130, "question_id": 29817535, "link": "https://stackoverflow.com/questions/29817535/mongodb-how-to-insert-additional-object-into-object-collection-in-golang/29818130#29818130", "title": "MongoDb : How to insert additional object into object collection in golang?", "body": "<p>Try the following:</p>\n\n<pre><code>session, err := mgo.Dial(\"127.0.0.1\")\nif err != nil {\n    panic(err)\n}\n\ndefer session.Close()\n\nsession.SetMode(mgo.Monotonic, true)\n\n// Drop Database\nif IsDrop {\n    err = session.DB(\"test\").DropDatabase()\n    if err != nil {\n        panic(err)\n    }\n}\n\n// Collection Stack\nc := session.DB(\"test\").C(\"stack\")\n\n// Query\nquery := bson.M{\"ownerEmail\": \"john.smith@gmail.com\"}\nupdate := bson.M{\"$push\": bson.M{\"camps\": bson.M{\"name\": \"cubs-killeen\", \"location\": \"some other Place\"}}}\n\n// Update\nerr = c.Update(query, update)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11486905, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7GyrM.gif?s=128&g=1", "display_name": "Jyotsna Gupta", "link": "https://stackoverflow.com/users/11486905/jyotsna-gupta"}, "is_accepted": false, "score": 0, "last_activity_date": 1557621978, "last_edit_date": 1557621978, "creation_date": 1557621598, "answer_id": 56095340, "question_id": 29817535, "link": "https://stackoverflow.com/questions/29817535/mongodb-how-to-insert-additional-object-into-object-collection-in-golang/56095340#56095340", "title": "MongoDb : How to insert additional object into object collection in golang?", "body": "<p>I assume your codebase has <strong>Camps</strong> struct similar to:</p>\n\n<pre><code>type Camps struct {\n    Name     string   `json:\"name,omitempty\"`\n    Location string   `json:\"location,omitempty\"`\n }\n</code></pre>\n\n<p>Golang code:</p>\n\n<pre><code>database := \"yourDatabaseName\"  \ncollection := \"stack\"\n\nsession, err := mgo.Dial(\"127.0.0.1\")\nif err != nil {\n    panic(err)\n }\ndefer session.Close()\n\nsession.SetMode(mgo.Monotonic, true)\nc := session.DB(database).C(collection)\n\ndata := model.Camps{\n        Name:       \"cubs-killeen\",\n        Location:   \"some other Place\",\n   }\nselector := bson.M{\"ownerEmail\": \"john.smith@gmail.com\"}\nchanges := bson.M{\"$push\": bson.M{\"camps\": bson.M{\"$each\": []model.Camps{data}}}}\nerr = c.Update(selector, changes)\n\nif err != nil {\n    panic(err)\n }\n</code></pre>\n"}], "owner": {"reputation": 825, "user_id": 2278893, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Et28N.jpg?s=128&g=1", "display_name": "Akash Shinde", "link": "https://stackoverflow.com/users/2278893/akash-shinde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3686, "favorite_count": 2, "accepted_answer_id": 29818130, "answer_count": 2, "score": 1, "last_activity_date": 1557621978, "creation_date": 1429777015, "last_edit_date": 1429809875, "question_id": 29817535, "link": "https://stackoverflow.com/questions/29817535/mongodb-how-to-insert-additional-object-into-object-collection-in-golang", "title": "MongoDb : How to insert additional object into object collection in golang?", "body": "<p><strong>I want just push object into array of objects in mongodb</strong></p>\n\n<pre><code> {\n    \"_id\" : ObjectId(\"51c9cf2b206dfb73d666ae07\"),\n    \"firstName\" : \"john\",\n    \"lastName\" : \"smith\",\n    \"ownerEmail\" : \"john.smith@gmail.com\",\n    \"camps\" : [\n            {\n                    \"name\" : \"cubs-killeen\",\n                    \"location\" : \"killeen\"\n            },\n            {\n                    \"name\" : \"cubs-temple\",\n                    \"location\" : \"temple\"\n            }\n    ],\n    \"instructors\" : [\n            {\n                    \"firstName\" : \"joe\",\n                    \"lastName\" : \"black\"\n            },\n            {\n                    \"firstName\" : \"will\",\n                    \"lastName\" : \"smith\"\n            }\n    ]\n}\n</code></pre>\n\n<p>and to push object into above document in need to do</p>\n\n<pre><code>db.stack.update({\"ownerEmail\":\"john.smith@gmail.com\"}, \n             {$push: { \n                        \"camps\":{ \"name\":\"cubs-killeen\",\"location\":\"some other Place\" } \n                      }\n             }\n             )\n</code></pre>\n\n<p>So how can i implement same functionality using <strong>mgo driver</strong></p>\n"}, {"tags": ["go", "erlang", "erlang-ports"], "comments": [{"owner": {"reputation": 20220, "user_id": 77617, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2bb6871244c6652b66bd5e875e6a519?s=128&d=identicon&r=PG", "display_name": "rvirding", "link": "https://stackoverflow.com/users/77617/rvirding"}, "edited": false, "score": 4, "creation_date": 1429793071, "post_id": 29817331, "comment_id": 47773911, "body": "<code>ping&#47;0</code> uses <code>call_port&#47;1</code> to send a tuple into the port process as the message which is then sent to the port. The actual data sent to a port can only be a list of bytes."}, {"owner": {"reputation": 1036, "user_id": 1737204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2851ca9622b504c85b92fc3e93d87b1f?s=128&d=identicon&r=PG", "display_name": "wldsvc", "link": "https://stackoverflow.com/users/1737204/wldsvc"}, "edited": false, "score": 4, "creation_date": 1429796620, "post_id": 29817331, "comment_id": 47776953, "body": "also `fmt.Print(&quot;Enter text: &quot;)`` writes to stdout. The written text is unexpected by the erlang process."}, {"owner": {"reputation": 4183, "user_id": 124179, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/977471a7792cba5ccfbd569f77d805b8?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/124179/justin"}, "reply_to_user": {"reputation": 20220, "user_id": 77617, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2bb6871244c6652b66bd5e875e6a519?s=128&d=identicon&r=PG", "display_name": "rvirding", "link": "https://stackoverflow.com/users/77617/rvirding"}, "edited": false, "score": 0, "creation_date": 1429805758, "post_id": 29817331, "comment_id": 47784409, "body": "@rvirding should have spotted that; transposed the C example incorrectly. Works. Thank you."}, {"owner": {"reputation": 1261, "user_id": 22079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a07336bf2b6ecaca5e87cda7b99b9253?s=128&d=identicon&r=PG", "display_name": "Jeff Allen", "link": "https://stackoverflow.com/users/22079/jeff-allen"}, "edited": false, "score": 2, "creation_date": 1432113196, "post_id": 29817331, "comment_id": 48783354, "body": "Please mark this question answered."}, {"owner": {"reputation": 6282, "user_id": 625540, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/r279R.jpg?s=128&g=1", "display_name": "codefreak", "link": "https://stackoverflow.com/users/625540/codefreak"}, "edited": false, "score": 5, "creation_date": 1444807035, "post_id": 29817331, "comment_id": 54051168, "body": "@Justin can you post working code as answer and mark it as answer. That may help others in future."}, {"owner": {"reputation": 4092, "user_id": 24, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f60f50af4f1cfe183d09bd1c3b4316af?s=128&d=identicon&r=PG", "display_name": "sanmiguel", "link": "https://stackoverflow.com/users/24/sanmiguel"}, "edited": false, "score": 0, "creation_date": 1453466323, "post_id": 29817331, "comment_id": 57625037, "body": "Follow-up with working example: <a href=\"http://stackoverflow.com/questions/32200352/buffer-size-in-erlang-golang-port-example\" title=\"buffer size in erlang golang port example\">stackoverflow.com/questions/32200352/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4092, "user_id": 24, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f60f50af4f1cfe183d09bd1c3b4316af?s=128&d=identicon&r=PG", "display_name": "sanmiguel", "link": "https://stackoverflow.com/users/24/sanmiguel"}, "is_accepted": true, "score": 6, "last_activity_date": 1453466679, "last_edit_date": 1495541270, "creation_date": 1453466679, "answer_id": 34947048, "question_id": 29817331, "link": "https://stackoverflow.com/questions/29817331/converting-erlang-c-port-example-to-erlang-golang/34947048#34947048", "title": "Converting Erlang-C port example to Erlang-Golang", "body": "<p>Posting this answer based on @Justin's follow-up question <a href=\"https://stackoverflow.com/questions/32200352/buffer-size-in-erlang-golang-port-example\">here</a>, which contains a slightly different but working answer.</p>\n\n<p><code>echo.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"os\"\n)\n\nfunc main() {\n    for{\n        reader := bufio.NewReader(os.Stdin)\n        bytes, _ := reader.ReadBytes('\\n')\n        os.Stdout.Write(bytes)\n    }\n}\n</code></pre>\n\n<p><code>complex1.erl</code>:</p>\n\n<pre><code>-module(complex1).\n-export([start/1, stop/0, init/1]).\n-export([send/1]).\n\nstart(ExtPrg) -&gt;\n    spawn_link(?MODULE, init, [ExtPrg]).\nstop() -&gt;\n    complex ! stop.\n\nsend(Y) -&gt; call_port({msg, Y}).\ncall_port({msg, Msg}) -&gt;\n    complex ! {call, self(), Msg},\n    receive\n    {complex, Result} -&gt;\n        Result\n    end.\n\ninit(ExtPrg) -&gt;\n    register(complex, self()),\n    process_flag(trap_exit, true),\n    Port = open_port({spawn, ExtPrg}, []),\n    loop(Port).\n\nloop(Port) -&gt;\n    receive\n    {call, Caller, Msg} -&gt;\n        Port ! {self(), {command, Msg++[10]}},\n        Data = receive_all(Port, 100),\n        Caller ! {complex, Data},\n        loop(Port);\n    stop -&gt;\n        Port ! {self(), close},\n        receive {Port, closed} -&gt;\n            exit(normal)\n        end;\n    {'EXIT', Port, Reason} -&gt;\n        exit({port_terminated, Reason})\n    end.\n\nreceive_all(Port, Timeout) -&gt; receive_all(Port, Timeout, []).\nreceive_all(Port, Timeout, Buffer) -&gt;\n    receive\n        {Port, {data, Data}} -&gt;\n            receive_all(Port, Timeout, [Data | Buffer])\n        after Timeout -&gt;\n            lists:flatten(lists:reverse(Buffer))\n    end.\n</code></pre>\n\n<p><code>$ erl</code></p>\n\n<pre><code>Erlang R16B02_basho8 (erts-5.10.3) [source] [64-bit] [smp:4:4] [async-threads:10] [hipe] [kernel-poll:false]\n\nEshell V5.10.3  (abort with ^G)\n1&gt; c(complex1).\n{ok,complex1}\n2&gt; complex1:start(\"go run echo.go\").\n&lt;0.40.0&gt;\n3&gt; complex1:send(\"asdhadlsjahdslahjdlhd\").\n\"asdhadlsjahdslahjdlhd\"\n4&gt; complex1:send(\"aksdghjakdsgalkdgaldsagdlkagdlkadg\").\n\"aksdghjakdsgalkdgaldsagdlkagdlkadg\"\n</code></pre>\n"}], "owner": {"reputation": 4183, "user_id": 124179, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/977471a7792cba5ccfbd569f77d805b8?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/124179/justin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1542, "favorite_count": 1, "accepted_answer_id": 34947048, "answer_count": 1, "score": 17, "last_activity_date": 1453466679, "creation_date": 1429776464, "question_id": 29817331, "link": "https://stackoverflow.com/questions/29817331/converting-erlang-c-port-example-to-erlang-golang", "title": "Converting Erlang-C port example to Erlang-Golang", "body": "<p>I'm trying to write a Golang driver for Erlang, accesible via an Erlang port.</p>\n\n<p>I've started with the Erlang C port example, which works fine:</p>\n\n<p><a href=\"http://www.erlang.org/doc/tutorial/c_port.html\">http://www.erlang.org/doc/tutorial/c_port.html</a></p>\n\n<p>Now I'm trying to port the C code to Golang; just trying to echo a simple 'Hello World\\n' message, using '\\n' as the delimiter.</p>\n\n<p>So my Golang code is as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Enter text: \")\n    bytes, _ := reader.ReadBytes('\\n')\n    os.Stdout.Write(bytes)\n}\n</code></pre>\n\n<p>And I can compile it and run it from the command line as follows:</p>\n\n<pre><code>justin@justin-ThinkPad-X240:~/work/erlang_golang_port$ go build -o tmp/echo echo.go\njustin@justin-ThinkPad-X240:~/work/erlang_golang_port$ ./tmp/echo\nEnter text: hello\nhello\n</code></pre>\n\n<p>However when I try to call the driver from the Erlang side (Erlang code below) I get the following:</p>\n\n<pre><code>justin@justin-ThinkPad-X240:~/work/erlang_golang_port$ erl\nErlang R16B03 (erts-5.10.4) [source] [64-bit] [smp:4:4] [async-threads:10] [kernel-poll:false]\n\nEshell V5.10.4  (abort with ^G)\n1&gt; c(complex1).\n{ok,complex1}\n2&gt; complex1:start(\"./tmp/echo\").\n&lt;0.41.0&gt;\n3&gt; complex1:ping().\n\n=ERROR REPORT==== 23-Apr-2015::08:56:47 ===\nBad value on output port './tmp/echo'\n</code></pre>\n\n<p>I have the sense that the message is being passed OK to the driver, but that I am somehow returning the response incorrectly.</p>\n\n<p>TIA.</p>\n\n<p>Erlang port code:</p>\n\n<pre><code>-module(complex1).\n\n-export([start/1, stop/0, init/1]).\n\n-export([ping/0]).\n\n-define(HELLO_WORLD, [72, 101, 108, 108, 111, 44, 32, 119, 111, 114, 108, 100, 46]).\n\nstart(ExtPrg) -&gt;\n    spawn(?MODULE, init, [ExtPrg]).\n\nstop() -&gt;\n    complex ! stop.\n\nping() -&gt;\n    call_port({ping, ?HELLO_WORLD++[10]}).\n\ncall_port(Msg) -&gt;\n    complex ! {call, self(), Msg},\n    receive\n    {complex, Result} -&gt;\n        Result\n    end.\n\ninit(ExtPrg) -&gt;\n    register(complex, self()),\n    process_flag(trap_exit, true),\n    Port = open_port({spawn, ExtPrg}, [{packet, 2}]),\n    loop(Port).\n\nloop(Port) -&gt;\n    receive\n    {call, Caller, Msg} -&gt;\n        Port ! {self(), {command, Msg}},\n        receive\n        {Port, {data, Data}} -&gt;\n            Caller ! {complex, Data}\n        end,\n        loop(Port);\n    stop -&gt;\n        Port ! {self(), close},\n        receive\n        {Port, closed} -&gt;\n            exit(normal)\n        end;\n    {'EXIT', Port, _Reason} -&gt;\n        exit(port_terminated)\n    end.\n</code></pre>\n"}, {"tags": ["mongodb", "go", "attributes", "partial", "mgo"], "comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1429775221, "post_id": 29816755, "comment_id": 47760831, "body": "Well, one odd thing I see in the code is that it doesn&#39;t compile since <code>&#39;foo&#39;</code> results in a syntax error."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1429776903, "post_id": 29816755, "comment_id": 47761883, "body": "<code>Not found</code> may be the result of misspelling the name of the collection, or that you don&#39;t have any documents matching the criteria (e.g. you misspelled the attribute value, or you already deleted all that would match it). Can you confirm these are not the case?"}, {"owner": {"reputation": 1457, "user_id": 1402745, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/60f2d43e4fa314427bbc586922a1ef0a?s=128&d=identicon&r=PG", "display_name": "ThisIsErico", "link": "https://stackoverflow.com/users/1402745/thisiserico"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1429777890, "post_id": 29816755, "comment_id": 47762551, "body": "@rightfold, as you can guess, this is just an example that you don&#39;t need to execute ;)"}, {"owner": {"reputation": 1457, "user_id": 1402745, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/60f2d43e4fa314427bbc586922a1ef0a?s=128&d=identicon&r=PG", "display_name": "ThisIsErico", "link": "https://stackoverflow.com/users/1402745/thisiserico"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1429777938, "post_id": 29816755, "comment_id": 47762577, "body": "@icza, I already checked that. I&#39;m querying the proper collection that do have matching criteria :)"}], "answers": [{"comments": [{"owner": {"reputation": 1457, "user_id": 1402745, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/60f2d43e4fa314427bbc586922a1ef0a?s=128&d=identicon&r=PG", "display_name": "ThisIsErico", "link": "https://stackoverflow.com/users/1402745/thisiserico"}, "edited": false, "score": 0, "creation_date": 1429786445, "post_id": 29821047, "comment_id": 47768770, "body": "Thank&#39;s a lot Didier. I know about the matching in mongo, that&#39;s how I was querying my documents on the console. The doubt was when I needed to write that behaviour using mgo.  Following what you&#39;re saying, I better start using the bson.M notation. Again, thank&#39;s a lot!"}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 1, "last_activity_date": 1429785725, "creation_date": 1429785725, "answer_id": 29821047, "question_id": 29816755, "link": "https://stackoverflow.com/questions/29816755/not-finding-documents-using-golangs-mgo-with-partial-attributes/29821047#29821047", "title": "Not finding documents using golang&#39;s mgo with partial attributes", "body": "<p>This is just a consequence of the way MongoDB handles exact match and partial match. It can be quickly demonstrated using the mongo shell:</p>\n\n<pre><code># Here are my documents\n&gt; db.docs.find()\n{ \"_id\" : { \"attr1\" : \"one\", \"attr2\" : \"two\" }, \"attr3\" : \"three\" }\n{ \"_id\" : { \"attr1\" : \"four\", \"attr2\" : \"five\" }, \"attr3\" : \"six\" }\n{ \"_id\" : { \"attr1\" : \"seven\", \"attr2\" : \"eight\" }, \"attr3\" : \"nine\" }\n\n# Test an exact match: it works fine\n&gt; db.docs.find({_id:{attr1:\"one\",attr2:\"two\"}})\n{ \"_id\" : { \"attr1\" : \"one\", \"attr2\" : \"two\" }, \"attr3\" : \"three\" }\n\n# Now let's remove attr2 from the query: nothing matches anymore,\n# because MongoDB still thinks the query requires an exact match\n&gt; db.docs.find({_id:{attr1:\"one\"}})\n... nothing returns ...\n\n# And this is the proper way to query with a partial match: it now works fine.\n&gt; db.docs.find({\"_id.attr1\":\"one\"})\n{ \"_id\" : { \"attr1\" : \"one\", \"attr2\" : \"two\" }, \"attr3\" : \"three\" }\n</code></pre>\n\n<p>You will find more information about this topic in the <a href=\"http://docs.mongodb.org/manual/tutorial/query-documents/\" rel=\"nofollow\">documentation</a>.</p>\n\n<p>In your Go program, I would suggest to use the following line:</p>\n\n<pre><code>err = collection.Remove(bson.M{\"_id.attr1\": \"foo\"})\n</code></pre>\n\n<p>Do not forget to test errors after each roundtrip to MongoDB.</p>\n"}], "owner": {"reputation": 1457, "user_id": 1402745, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/60f2d43e4fa314427bbc586922a1ef0a?s=128&d=identicon&r=PG", "display_name": "ThisIsErico", "link": "https://stackoverflow.com/users/1402745/thisiserico"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1267, "favorite_count": 1, "accepted_answer_id": 29821047, "answer_count": 1, "score": 3, "last_activity_date": 1429793178, "creation_date": 1429774687, "last_edit_date": 1429793178, "question_id": 29816755, "link": "https://stackoverflow.com/questions/29816755/not-finding-documents-using-golangs-mgo-with-partial-attributes", "title": "Not finding documents using golang&#39;s mgo with partial attributes", "body": "<p>I'm trying to remove a bunch of documents that have a common attribute. This is what a document looks like:</p>\n\n<pre><code>{\n    _id : {\n        attr1 : 'foo',\n        attr2 : 'bar'\n    },\n    attr3 : 'baz',\n}\n</code></pre>\n\n<p>More than one document will have the same 'foo' value in the attr1 entry. I'm trying to remove all of those. For that I've got something similar to this:</p>\n\n<pre><code>type DocId struct {\n    Attr1 string `bson:\"attr1,omitempty\"`\n    Attr2 string `bson:\"attr2,omitempty\"`\n}\n\ntype Doc struct {\n    Id DocId `bson:\"_id,omitempty\"`\n    Attr3 string `bson:\"attr3,omitempty\"`\n}\n\n\ndoc := Doc{\n    Id : DocId{ Attr1 : 'foo' },\n}\n\ncollection := session.DB(\"db\").C(\"collection\")\ncollection.Remove(doc)\n</code></pre>\n\n<p>The problem here is that I'm getting a <code>Not found</code> error in the remove call.\nCan you see anything odd in the code?</p>\n\n<p>Thanks a lot!</p>\n"}]