[{"tags": ["heroku", "go"], "answers": [{"tags": [], "owner": {"reputation": 950, "user_id": 4955829, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5774190157eeea1436c4b5f70565ffc0?s=128&d=identicon&r=PG&f=1", "display_name": "silvergasp", "link": "https://stackoverflow.com/users/4955829/silvergasp"}, "is_accepted": false, "score": 2, "last_activity_date": 1486612133, "creation_date": 1486612133, "answer_id": 42127860, "question_id": 42125319, "link": "https://stackoverflow.com/questions/42125319/deploying-go-app-with-heroku/42127860#42127860", "title": "Deploying Go App with Heroku", "body": "<p>Am going to be quoting the heroku documentation a lot.</p>\n\n<p><strong>Procfile</strong></p>\n\n<blockquote>\n  <p><strong>Define a Procfile</strong></p>\n  \n  <p>Use a Procfile, a text file in the root directory of your application, to explicitly declare what command should be executed to start your app.\n  The Procfile in the example app you deployed looks like this:</p>\n  \n  <p><code>web: go-getting-started</code></p>\n  \n  <p>This declares a single process type, web, and the command needed to run it. The name web is important here. It declares that this process type will be attached to the HTTP routing stack of Heroku, and receive web traffic when deployed. The command used here, go-getting-started is the compiled binary of the getting started app.\n  Procfiles can contain additional process types. For example, you might declare one for a background worker process that processes items off of a queue.</p>\n</blockquote>\n\n<p><a href=\"https://devcenter.heroku.com/articles/getting-started-with-go#define-a-procfile\" rel=\"nofollow noreferrer\">Define a Procfile</a></p>\n\n<p>So in your example you would have a file named 'Procfile' in your root directory with contents being:</p>\n\n<pre><code>web: fileserver\n</code></pre>\n\n<p><strong>.godir</strong></p>\n\n<p>The <code>.godir</code> file is simply a file that simply specifies the root directory of your go project. This is useful when you say have a number of modules for a web app in different languages. So for example given a repo with the following tree.</p>\n\n<pre><code>github.com\n    \u2514\u2500\u2500someuser\n       \u2514\u2500\u2500 somerepo\n           \u251c\u2500\u2500 .godir\n           \u251c\u2500\u2500 go_module\n           \u2514\u2500\u2500 node_module\n</code></pre>\n\n<p>Where the contents of your <code>.godir</code> file would be:</p>\n\n<pre><code>github.com/someuser/somerepo/go_module\n</code></pre>\n\n<p>A more verbose explanation of what <code>.godir</code> is for and when it is used can be found <a href=\"https://packager.io/documentation/golang/\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 1124, "user_id": 5199096, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/7121c9c8b95b9b4ba519af1d02515dff?s=128&d=identicon&r=PG&f=1", "display_name": "mk8efz", "link": "https://stackoverflow.com/users/5199096/mk8efz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 668, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1486612133, "creation_date": 1486595062, "question_id": 42125319, "link": "https://stackoverflow.com/questions/42125319/deploying-go-app-with-heroku", "title": "Deploying Go App with Heroku", "body": "<p>I'm using this guide to build a small Go app:</p>\n\n<p><a href=\"https://codegangsta.gitbooks.io/building-web-apps-with-go/index.html\" rel=\"nofollow noreferrer\">https://codegangsta.gitbooks.io/building-web-apps-with-go/index.html</a></p>\n\n<p>Folder structure looks like this:</p>\n\n<pre><code>go/src/fileserver/\n                 main.go\n                 fileserver.exe\n                 public/\n                       index.html\n                       css/\n                          bootstrap.min.css\n</code></pre>\n\n<p>The deployment instructions mention a \"procfile\" and a \".godir\" file but it's a bit unclear what these are supposed to contain or where they are to be implemented. I'm not quite sure if my folder structure is correct either. </p>\n\n<p>The error I'm getting is:</p>\n\n<pre><code> Failed to detect set buildpack https://github.com/kr/heroku-buildpack-go.git\n</code></pre>\n"}, {"tags": ["ssl", "go", "https", "server", "client"], "answers": [{"comments": [{"owner": {"reputation": 1419, "user_id": 146032, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1TQf1.jpg?s=128&g=1", "display_name": "bithavoc", "link": "https://stackoverflow.com/users/146032/bithavoc"}, "edited": false, "score": 2, "creation_date": 1546655761, "post_id": 42123799, "comment_id": 94932263, "body": "FYI, this requests the client to present a certificate, that doesn&#39;t mean it&#39;s a valid certificate. you probably need <code>RequireAndVerifyClientCert</code>, here&#39;s a full example: <a href=\"https://gist.github.com/xjdrew/97be3811966c8300b724deabc10e38e2\" rel=\"nofollow noreferrer\">gist.github.com/xjdrew/97be3811966c8300b724deabc10e38e2</a>"}, {"owner": {"reputation": 2994, "user_id": 4175647, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/cdc00400f3017caba1581296dc6c4f01?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Roz", "link": "https://stackoverflow.com/users/4175647/nick-roz"}, "edited": false, "score": 0, "creation_date": 1605802071, "post_id": 42123799, "comment_id": 114769407, "body": "what about mtls?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2994, "user_id": 4175647, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/cdc00400f3017caba1581296dc6c4f01?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Roz", "link": "https://stackoverflow.com/users/4175647/nick-roz"}, "edited": false, "score": 0, "creation_date": 1605802758, "post_id": 42123799, "comment_id": 114769691, "body": "@NickRoz: what is the question about mTLS? There are multiple <code>ClientAuthType</code> values, and there is a <code>ClientCAs</code> field in the <code>tls.Config</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1486590080, "last_edit_date": 1486590080, "creation_date": 1486588764, "answer_id": 42123799, "question_id": 42123532, "link": "https://stackoverflow.com/questions/42123532/how-to-get-client-certificates-in-go-https-server/42123799#42123799", "title": "How to get client certificates in Go HTTPS server", "body": "<p>The client shouldn't send a certificate unless requested. Set <code>ClientAuth</code> in the <a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"noreferrer\"><code>tls.Config</code></a> to an appropriate <a href=\"https://golang.org/pkg/crypto/tls/#ClientAuthType\" rel=\"noreferrer\"><code>tls.ClientAuthType</code></a>.</p>\n\n<p>For example, to only request that a client send a certificate, you can use:</p>\n\n<pre><code>server := &amp;http.Server{\n    Addr: \":8080\",\n    TLSConfig: &amp;tls.Config{\n        ClientAuth: tls.RequestClientCert,\n    },\n}\n\nserver.ListenAndServeTLS(\"server.crt\", \"server.key\")\n</code></pre>\n"}], "owner": {"reputation": 954, "user_id": 779856, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e5060ea49d244015fab26fba9c118046?s=128&d=identicon&r=PG", "display_name": "Valentin", "link": "https://stackoverflow.com/users/779856/valentin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9645, "favorite_count": 1, "accepted_answer_id": 42123799, "answer_count": 1, "score": 4, "last_activity_date": 1486590080, "creation_date": 1486587745, "question_id": 42123532, "link": "https://stackoverflow.com/questions/42123532/how-to-get-client-certificates-in-go-https-server", "title": "How to get client certificates in Go HTTPS server", "body": "<p>I'm trying to understand how to get client's certificates in Go web server. Here is a server code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n)\n\nfunc defaultHandler(w http.ResponseWriter, r *http.Request) {\n    dump, err := httputil.DumpRequest(r, true)\n    log.Println(\"HTTP request\", r, string(dump), err)\n    log.Println(\"HTTP TLS\", r.TLS, string(r.TLS.TLSUnique))\n    certs := r.TLS.PeerCertificates\n    log.Println(\"HTTP CERTS\", certs)\n    w.WriteHeader(http.StatusMethodNotAllowed)\n    w.Write([]byte(\"Hello\"))\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", defaultHandler)\n    http.ListenAndServeTLS(\":8080\", \"server.crt\", \"server.key\", nil)\n}\n</code></pre>\n\n<p>and here is client code</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc HttpClient() (client *http.Client) {\n    uckey := os.Getenv(\"X509_USER_KEY\")\n    ucert := os.Getenv(\"X509_USER_CERT\")\n    x509cert, err := tls.LoadX509KeyPair(ucert, uckey)\n    if err != nil {\n        panic(err.Error())\n    }\n    certs := []tls.Certificate{x509cert}\n    if len(certs) == 0 {\n       client = &amp;http.Client{}\n       return\n    }\n    tr := &amp;http.Transport{\n        TLSClientConfig: &amp;tls.Config{Certificates: certs,\n        InsecureSkipVerify: true},\n    }\n    client = &amp;http.Client{Transport: tr}\n    return\n}\n\nfunc main() {\n    rurl := \"https://localhost:8080\"\n    client := HttpClient()\n    req, err := http.NewRequest(\"GET\", rurl, nil)\n    if err != nil {\n       log.Println(\"Unable to make GET request\", err)\n       os.Exit(1)\n    }\n    req.Header.Add(\"Accept\", \"*/*\")\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Println(err)\n        os.Exit(1)\n    }\n    defer resp.Body.Close()\n    data, err := ioutil.ReadAll(resp.Body)\n    log.Println(string(data))\n}\n</code></pre>\n\n<p>If I run both server and a client I see the following on a server side:</p>\n\n<pre><code>2017/02/08 15:46:49 HTTP request &amp;{GET / HTTP/1.1 1 1 map[User-Agent:[Go-http-client/1.1] Accept:[*/*] Accept-Encoding:[gzip]] {} 0 [] false localhost:8080 map[] map[] &lt;nil&gt; map[] 127.0.0.1:58941 / 0xc4204ef080 &lt;nil&gt; &lt;nil&gt; 0xc420014d40} GET / HTTP/1.1\nHost: localhost:8080\nAccept: */*\nAccept-Encoding: gzip\nUser-Agent: Go-http-client/1.1\n\n &lt;nil&gt;\n2017/02/08 15:46:49 HTTP TLS &amp;{771 true false 49195  true localhost [] [] []   [] [203 144 196 105 155 216 89 105 83 90 93 4]} \u02d0iSZ]\n2017/02/08 15:46:49 HTTP CERTS []\n</code></pre>\n\n<p>As you can see the client's certificates are empty.</p>\n\n<p>While if I invoke curl call to a server providing my certificates, then I can see server certificates:</p>\n\n<pre><code>curl -L -k --key mykey.key --cert mycert.pem -vvv https://localhost:8080\n*   Trying 127.0.0.1...\n* TCP_NODELAY set\n* Connected to localhost (127.0.0.1) port 8080 (#0)\n* ALPN, offering http/1.1\n* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH\n* successfully set certificate verify locations:\n*   CAfile: /opt/local/share/curl/curl-ca-bundle.crt\n    CApath: none\n* TLSv1.2 (OUT), TLS header, Certificate Status (22):\n* TLSv1.2 (OUT), TLS handshake, Client hello (1):\n* TLSv1.2 (IN), TLS handshake, Server hello (2):\n* TLSv1.2 (IN), TLS handshake, Certificate (11):\n* TLSv1.2 (IN), TLS handshake, Server key exchange (12):\n* TLSv1.2 (IN), TLS handshake, Server finished (14):\n* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\n* TLSv1.2 (OUT), TLS change cipher, Client hello (1):\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\n* TLSv1.2 (IN), TLS change cipher, Client hello (1):\n* TLSv1.2 (IN), TLS handshake, Finished (20):\n* SSL connection using TLSv1.2 / ECDHE-ECDSA-AES128-GCM-SHA256\n* ALPN, server accepted to use http/1.1\n* Server certificate:\n*  subject: C=US; ST=NY; L=Town; O=Bla-Bla\n*  start date: Feb  8 14:12:06 2017 GMT\n*  expire date: Feb  6 14:12:06 2027 GMT\n*  issuer: C=US; ST=NY; L=Ithaca; O=Cornell\n*  SSL certificate verify result: self signed certificate (18), continuing anyway.\n&gt; GET / HTTP/1.1\n&gt; Host: localhost:8080\n&gt; User-Agent: curl/7.52.1\n&gt; Accept: */*\n</code></pre>\n\n<p>As you can see SSL negotiation is in place and curl client successfully reports server certificate. What I need is to access client's certificate on a <strong>server side</strong> to do proper authentication. But so far I can't see any client's certificate.</p>\n\n<p>Any help is really welcome.\nThanks,\nValentin.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 1, "creation_date": 1486587908, "post_id": 42123515, "comment_id": 71415251, "body": "<code>sort.Ints</code> (and indeed <code>sort.Sort</code>) expect a slice and you gave it an array."}], "answers": [{"comments": [{"owner": {"reputation": 630, "user_id": 6789315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1c753c5b8334484d933e978a7343c43?s=128&d=identicon&r=PG&f=1", "display_name": "Kaylined", "link": "https://stackoverflow.com/users/6789315/kaylined"}, "edited": false, "score": 0, "creation_date": 1486588107, "post_id": 42123575, "comment_id": 71415346, "body": "Cheers, it worked. I&#39;ll read some more on slices to figure out the why. Thanks. I fixed my redundancy as well. Why does the second error message occur?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 630, "user_id": 6789315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1c753c5b8334484d933e978a7343c43?s=128&d=identicon&r=PG&f=1", "display_name": "Kaylined", "link": "https://stackoverflow.com/users/6789315/kaylined"}, "edited": false, "score": 1, "creation_date": 1486588209, "post_id": 42123575, "comment_id": 71415403, "body": "@Kaylined: The second error message is because you&#39;re trying to pass <code>sort.Ints</code> as an argument to <code>sort.Sort</code>. <code>sort.Ints</code> doesn&#39;t have a return value, and you don&#39;t need to call <code>sort.Sort</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1486587896, "creation_date": 1486587896, "answer_id": 42123575, "question_id": 42123515, "link": "https://stackoverflow.com/questions/42123515/sorting-array-of-ints/42123575#42123575", "title": "Sorting array of Ints", "body": "<p>You can sort an array by taking a slice of the entire array</p>\n\n<pre><code>sort.Ints(array[:])\n</code></pre>\n\n<p>You probably don't want an array in the first place however, and should be using a slice of <code>[]int</code>.</p>\n\n<p>Also, your <code>sortedArray</code> is the same value as <code>array</code>, so there is no reason to create the second variable. </p>\n"}], "owner": {"reputation": 630, "user_id": 6789315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1c753c5b8334484d933e978a7343c43?s=128&d=identicon&r=PG&f=1", "display_name": "Kaylined", "link": "https://stackoverflow.com/users/6789315/kaylined"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1696, "favorite_count": 0, "accepted_answer_id": 42123575, "answer_count": 1, "score": 2, "last_activity_date": 1486587896, "creation_date": 1486587667, "question_id": 42123515, "link": "https://stackoverflow.com/questions/42123515/sorting-array-of-ints", "title": "Sorting array of Ints", "body": "<p>I'm attempting to sort an array of Ints using the following function</p>\n\n<pre><code>func sortArray(array [100]int) [100]int {\n    var sortedArray = array\n    sort.Sort(sort.Ints(sortedArray))\n\n    return sortedArray\n}\n</code></pre>\n\n<p>and getting the following error:</p>\n\n<blockquote>\n  <p>.\\helloworld.go:22: cannot use sortedArray (type [100]int) as type []int in argument to sort.Ints\n  .\\helloworld.go:22: sort.Ints(sortedArray) used as value</p>\n</blockquote>\n\n<p>I'm trying to figure out Go and I'm getting stuck on this one.</p>\n"}, {"tags": ["html", "xpath", "go", "xml-parsing", "selector"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 5, "last_activity_date": 1486583996, "creation_date": 1486583996, "answer_id": 42122516, "question_id": 42118194, "link": "https://stackoverflow.com/questions/42118194/golang-xmlpath-selectors-with-html/42122516#42122516", "title": "GoLang - XmlPath Selectors with HTML", "body": "<p>XPath does not seem suitable here; you should be using <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"noreferrer\">goquery</a>, which is designed for HTML.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/PuerkitoBio/goquery\"\n)\n\nfunc main() {\n    doc, err := goquery.NewDocument(\"https://example.com\")\n    if err != nil {\n        panic(err)\n    }\n    s := doc.Find(`html &gt; head &gt; meta[name=\"viewport\"]`)\n    if s.Length() == 0 {\n        fmt.Println(\"could not find viewpoint\")\n        return\n    }\n    fmt.Println(s.Eq(0).AttrOr(\"content\", \"\"))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1143, "user_id": 370213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PH4vL.jpg?s=128&g=1", "display_name": "zhengchun", "link": "https://stackoverflow.com/users/370213/zhengchun"}, "is_accepted": false, "score": 5, "last_activity_date": 1544323680, "creation_date": 1544323680, "answer_id": 53688944, "question_id": 42118194, "link": "https://stackoverflow.com/questions/42118194/golang-xmlpath-selectors-with-html/53688944#53688944", "title": "GoLang - XmlPath Selectors with HTML", "body": "<p>I know this answer is late, but I still want to recommend an <em><a href=\"https://github.com/antchfx/htmlquery\" rel=\"noreferrer\">htmlquery</a></em> package that is simple and powerful, based on XPath expressions*.</p>\n\n<p>The below code based on @Time-Cooper example.\n</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/antchfx/htmlquery\"\n)\n\nfunc main() {\n    doc, err := htmlquery.LoadURL(\"https://example.com\")\n    if err != nil {\n        panic(err)\n    }\n    s := htmlquery.Find(doc, \"//meta[@name='viewport']\")\n    if len(s) == 0 {\n        fmt.Println(\"could not find viewpoint\")\n        return\n    }\n    fmt.Println(htmlquery.SelectAttr(s[0], \"content\"))\n\n    // alternative method,but simple more.\n    s2 := htmlquery.FindOne(doc, \"//meta[@name='viewport']/@content\")\n    fmt.Println(htmlquery.InnerText(s2))\n}\n</code></pre>\n"}], "owner": {"reputation": 333, "user_id": 1679669, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8a5bcb97d53e14ecbe480c43bf2538d0?s=128&d=identicon&r=PG", "display_name": "user1679669", "link": "https://stackoverflow.com/users/1679669/user1679669"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3279, "favorite_count": 1, "accepted_answer_id": 42122516, "answer_count": 2, "score": 3, "last_activity_date": 1544323680, "creation_date": 1486570405, "last_edit_date": 1486571759, "question_id": 42118194, "link": "https://stackoverflow.com/questions/42118194/golang-xmlpath-selectors-with-html", "title": "GoLang - XmlPath Selectors with HTML", "body": "<p>I am looking at the documented example <a href=\"https://godoc.org/gopkg.in/xmlpath.v2\" rel=\"nofollow noreferrer\">here</a>, but it is iterating purely over an XML tree, and not HTML. Therefore, I am still partly confused.</p>\n\n<p>For example, if I wanted to find a specific <strong>meta</strong> tag within the <strong>head</strong> tag by name, it seems I cannot? Instead, I need to find it by the order it is in the <strong>head</strong> tag. In this case, I want the 8th meta tag, which I assume is:</p>\n\n<blockquote>\n  <p>headTag, err := getByID(xmlroot, \"/head/meta[8]/\")</p>\n</blockquote>\n\n<p>But of course, this is using a getByID function for a tag name - which I don't believe will work. <strong>What is the full list of \"getBy...\" commands?</strong></p>\n\n<p>Then, the problem is, how do I access the meta tag's contents? The documentation only provides examples for the inner tag node content. However, will this example work?:</p>\n\n<blockquote>\n  <p>resp.Query = extractValue(headTag, <code>@content</code>)</p>\n</blockquote>\n\n<p>The @ selector confuses me, is this appropriate for this case?</p>\n\n<p>In other words:</p>\n\n<ol>\n<li>Is there a proper HTML example available?</li>\n<li>Is there a list of correct selectors for IDs, Tags, etc?</li>\n<li>Can Tags be found by name, and content extracted from its inner content tag?</li>\n</ol>\n\n<p>Thank you very much!</p>\n"}, {"tags": ["go", "cross-platform"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1486570236, "post_id": 42117934, "comment_id": 71404543, "body": "I think you don&#39;t need the third command, just installing the std (ie <code>go install std</code>) is enough."}], "answers": [{"comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1486570081, "post_id": 42117998, "comment_id": 71404433, "body": "I believe that when cross-compiling you still have to have the standard lib for the target platform installed. I use ie <code>sudo env GOOS=windows GOARCH=amd64 &#47;usr&#47;local&#47;go&#47;bin&#47;go install std</code> to enable cross-compiling for win64 on my Ubuntu."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 4, "creation_date": 1486570216, "post_id": 42117998, "comment_id": 71404525, "body": "@ain No, it doesn&#39;t. In Linux, all you need to do is run <code>GOOS=windows GOARCH=amd64 go build</code> in the folder of the main package (just verified it)."}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1486570365, "post_id": 42117998, "comment_id": 71404654, "body": "Could it be that you have already the std installed? I sure had to use the command in my first comment in order to be able to cross compile after I last time upgraded go (to 1.7). Of couse, once you have it installed you can just build from then on..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 4, "creation_date": 1486574542, "post_id": 42117998, "comment_id": 71407561, "body": "@ain No, just the &quot;bare&quot; binary Go distribution, from the official <a href=\"https://golang.org/dl/\" rel=\"nofollow noreferrer\">Downloads</a> page. The go tool will recompile everything needed from the standard lib (from source) to the target os/arch, that&#39;s why it takes longer."}, {"owner": {"reputation": 376, "user_id": 2348705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13a37cab3b0733af5c7829aa1d8278b1?s=128&d=identicon&r=PG", "display_name": "Igor Dubinskiy", "link": "https://stackoverflow.com/users/2348705/igor-dubinskiy"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 2, "creation_date": 1486591998, "post_id": 42117998, "comment_id": 71417325, "body": "@ain To add, you can always run <code>go tool dist list</code> to list the OS/ARCH combinations that your install of Go supports."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 9, "last_activity_date": 1486574983, "last_edit_date": 1495540471, "creation_date": 1486569881, "answer_id": 42117998, "question_id": 42117934, "link": "https://stackoverflow.com/questions/42117934/go-1-7-cross-compilation-from-windows-to-linux-ubuntu/42117998#42117998", "title": "Go 1.7 Cross Compilation from Windows to Linux/Ubuntu", "body": "<p>That other question is a bit old (from 2013).</p>\n\n<p>Cross-platform support evolved a lot, all you need to do is change the environment variables (<code>GOARCH</code> and <code>GOOS</code>) and run <code>go build</code>.</p>\n\n<p>Navigate to the folder of the <code>main</code> package, then:</p>\n\n<pre><code>set GOARCH=amd64\nset GOOS=linux\ngo build\n</code></pre>\n\n<p>You may change the name of the result binary like this:</p>\n\n<pre><code>go build -o \"myapp\"\n</code></pre>\n\n<p>Note that in Linux to compile the app for Windows amd64, a single command is enough (in the folder of the <code>main</code> package):</p>\n\n<pre><code>GOOS=windows GOARCH=amd64 go build\n</code></pre>\n\n<p>This is also confirmed in blog post: <a href=\"https://dave.cheney.net/2015/08/22/cross-compilation-with-go-1-5\" rel=\"noreferrer\">Dave Cheney: Cross compilation with Go 1.5</a>:</p>\n\n<blockquote>\n  <p>To cross compile a Go program using Go 1.5 the process is as follows:</p>\n  \n  <ol>\n  <li><p>set <code>GOOS</code> and <code>GOARCH</code> to be the values for the target <a href=\"https://golang.org/doc/install/source#environment\" rel=\"noreferrer\">operating system and architecture</a>.</p></li>\n  <li><p>run <code>go build -v YOURPACKAGE</code></p></li>\n  </ol>\n</blockquote>\n\n<h3>Notes</h3>\n\n<p>You don't have to, and you shouldn't run <code>go install</code>, as that will compile and install the packages in your <code>GOPATH</code>, which is often not wanted. Doing cross compilation is not for developing / testing your app and packages. It is to produce a single binary which you will run on another system / computer.</p>\n\n<p><code>go build</code> will not install anything, it will just produce the executable binary. For details, see <a href=\"https://stackoverflow.com/questions/30612611/what-does-go-build-build\">What does go build build?</a></p>\n\n<p>Also confirmed in blog post: <a href=\"https://dave.cheney.net/2015/08/22/cross-compilation-with-go-1-5\" rel=\"noreferrer\">Dave Cheney: Cross compilation with Go 1.5</a>:</p>\n\n<blockquote>\n  <p>When cross compiling, you should use <code>go build</code>, not <code>go install</code>. This is the one of the few cases where <code>go build</code> is preferable to <code>go install</code>.</p>\n  \n  <p>The reason for this is <code>go install</code> always caches compiled packages, <code>.a</code> files, into the <code>pkg/</code> directory that matches the root of the source code.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1486747101, "post_id": 42161630, "comment_id": 71494972, "body": "<i>&quot;The <code>SET</code> command did realy nothing!&quot;</i> The <code>SET</code> command does not set the environment variable system-wide, only in the current command shell. So to other shells and apps it has no effect, this is no secret."}, {"owner": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1486762229, "post_id": 42161630, "comment_id": 71502930, "body": "But this even did not for current command shell. I set it, make build, copy my file to my linux container, run &quot;file&quot; comand and see that file is build for windows. Only when I do it to whole system the way I described, it works. I do not know why but it&#39;s like this for my windows 10"}], "tags": [], "owner": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "is_accepted": true, "score": 6, "last_activity_date": 1487930988, "last_edit_date": 1487930988, "creation_date": 1486736421, "answer_id": 42161630, "question_id": 42117934, "link": "https://stackoverflow.com/questions/42117934/go-1-7-cross-compilation-from-windows-to-linux-ubuntu/42161630#42161630", "title": "Go 1.7 Cross Compilation from Windows to Linux/Ubuntu", "body": "<p>I found a problem and a solution of it.</p>\n\n<p>In my Windows 10 these commands</p>\n\n<pre><code>set GOARCH=amd64\nset GOOS=linux\n</code></pre>\n\n<p>in cmd and also in powershell console did really nothing! Only the way it works is that I need to open Control Panel -> System -> System Advanced Settings -> Environment Variables and add them there manually. </p>\n\n<p><a href=\"https://i.stack.imgur.com/WaCsx.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/WaCsx.png\" alt=\"enter image description here\"></a></p>\n\n<p>If you use Visual Studio Code for development, do not forget to restart it.</p>\n\n<p><strong>UPDATE 24/02/2017</strong></p>\n\n<p>Instead all above you can set variable in windows powershell like this</p>\n\n<blockquote>\n  <p>$env:GOOS = \"linux\"</p>\n</blockquote>\n\n<p>and read it to console</p>\n\n<blockquote>\n  <p>$env:GOOS</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 5726053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ZapU.jpg?s=128&g=1", "display_name": "ivanbgd", "link": "https://stackoverflow.com/users/5726053/ivanbgd"}, "is_accepted": false, "score": 0, "last_activity_date": 1586729577, "creation_date": 1586729577, "answer_id": 61178895, "question_id": 42117934, "link": "https://stackoverflow.com/questions/42117934/go-1-7-cross-compilation-from-windows-to-linux-ubuntu/61178895#61178895", "title": "Go 1.7 Cross Compilation from Windows to Linux/Ubuntu", "body": "<p>What worked for me, on Windows 10 with Go 1.14, is the following:</p>\n\n<pre><code>go env -w GOARCH=amd64\ngo env -w GOOS=linux\ngo build -o test-linux test.go\n</code></pre>\n\n<p>That's it.</p>\n\n<p>I tried this in both Windows command prompt and Windows PowerShell. There's no difference in results.</p>\n\n<p>If you open the binary file in a text editor, you should see that it begins with ELF (Linux), and not MZ (Windows).</p>\n\n<p>I ran it on a Linux machine (RHEL 7.3) with the given architecture, and it worked properly. It gave correct output.</p>\n\n<p>After copying the file to the Linux machine, I had to make it executable:</p>\n\n<pre><code>$ chmod +x test-linux\n</code></pre>\n\n<p>Then I was able to run it:</p>\n\n<pre><code>$ ./test-linux\n</code></pre>\n\n<p>You can also run the following command on Linux, to get more detail about the file:</p>\n\n<pre><code>$ file test-linux\ntest-linux: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, not stripped\n</code></pre>\n\n<p>Of course, if your architecture is <code>amd64</code> already, then you don't have to set it again. You can just set the <code>GOOS</code>.</p>\n\n<p>You can also revert <code>GOOS</code> to <code>windows</code> after you're done with cross-compiling. When I closed the Windows command prompt and PowerShell, and ran <code>go env</code> to see the list of Go environment variables, and <code>GOOS</code> kept  the <code>linux</code> value. I didn't try with restarting  Windows. So, if you now want to compile for Windows again:</p>\n\n<pre><code>go env -w GOOS=windows\n</code></pre>\n\n<p>You need to use the correct casing, as shown here. For example, <code>Windows</code> or <code>Linux</code> won't work.</p>\n"}], "owner": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10140, "favorite_count": 4, "accepted_answer_id": 42161630, "answer_count": 3, "score": 10, "last_activity_date": 1586729577, "creation_date": 1486569725, "last_edit_date": 1495541394, "question_id": 42117934, "link": "https://stackoverflow.com/questions/42117934/go-1-7-cross-compilation-from-windows-to-linux-ubuntu", "title": "Go 1.7 Cross Compilation from Windows to Linux/Ubuntu", "body": "<p>I have GO 1.7 installed on my Windows 10. I created test program and it works perfectly in Windows. Next step is to try to run it on my docker virtual machine with Ubuntu. </p>\n\n<p>I found <a href=\"https://stackoverflow.com/questions/20829155/how-to-cross-compile-from-windows-to-linux\">here</a> some info about the way to do it</p>\n\n<pre><code>set GOARCH=amd64\nset GOOS=linux\ngo tool dist install -v pkg/runtime\ngo install -v -a std\n</code></pre>\n\n<p>I run line 1 and 2 in cmd and there is no problem. At line 3 I have an error</p>\n\n<pre><code>go tool dist: open C:\\Go\\src\\pkg\\runtime: The system cannot find the path specified.\n</code></pre>\n\n<p>I check manually this folder and there is a runtime only for windows</p>\n\n<p><a href=\"https://i.stack.imgur.com/GcWrW.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/GcWrW.png\" alt=\"enter image description here\"></a></p>\n\n<p>The question is where and how can I download it for linux? Or maybe thats I'm doing is completely wrong way...</p>\n\n<p><strong>UPDATE 09/02/2017</strong></p>\n\n<p>I ran like it was suggested </p>\n\n<pre><code>set GOARCH=amd64\nset GOOS=linux\ngo build -o \"myapp\"\n</code></pre>\n\n<p>After I copied this file to shared folder, copied form there to another not shared folder (to avoid an issue described <a href=\"https://askubuntu.com/questions/648555/bash-program-cannot-execute-binary-file-exec-format-error/697757#697757\">here</a>) and executed</p>\n\n<pre><code>root@7dd1655ae5db:/__notshared# ./myapp\nbash: ./myapp: cannot execute binary file: Exec format error\n</code></pre>\n\n<p>After I downloaded file package checked my file</p>\n\n<pre><code>root@7dd1655ae5db:/__notshared# file myapp\nmyapp: PE32+ executable (console) x86-64 (stripped to external PDB), for MS Windows\n</code></pre>\n\n<p>It seems that during build not linux executable was created.</p>\n"}, {"tags": ["go", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 1071, "user_id": 31993, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cc7aa1876a5cb85902904e9a0acd2f6f?s=128&d=identicon&r=PG", "display_name": "Maxim Vladimirsky", "link": "https://stackoverflow.com/users/31993/maxim-vladimirsky"}, "edited": false, "score": 9, "creation_date": 1549030501, "post_id": 42121891, "comment_id": 95769412, "body": "In later gRPC versions it is <code>metadata.FromIncomingContext</code>"}, {"owner": {"reputation": 191, "user_id": 3566647, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wVj86.jpg?s=128&g=1", "display_name": "freitas", "link": "https://stackoverflow.com/users/3566647/freitas"}, "edited": false, "score": 0, "creation_date": 1614197204, "post_id": 42121891, "comment_id": 117315388, "body": "what is the difference between incoming and outgoing context?"}], "tags": [], "owner": {"reputation": 946, "user_id": 1549380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e48782f786b9d3f34b3cb86e514aad4?s=128&d=identicon&r=PG", "display_name": "Zack Butcher", "link": "https://stackoverflow.com/users/1549380/zack-butcher"}, "is_accepted": false, "score": 31, "last_activity_date": 1486581822, "creation_date": 1486581822, "answer_id": 42121891, "question_id": 42116642, "link": "https://stackoverflow.com/questions/42116642/how-to-read-metadata-in-grpc-on-the-server-side-golang-example/42121891#42121891", "title": "how to read metadata in grpc on the server side? (golang example)", "body": "<p>You have to insert your metadata into the client's context before calling the server.</p>\n\n<p>For an unary RPC the client side looks like:</p>\n\n<pre><code>conn, _ := grpc.Dial(address, opts...)\nclient := NewMyClient(conn) // generated from your proto with the grpc protoc option\n\nheader := metadata.New(map[string]string{\"authorization\": \"\", \"space\":  \"\", \"org\": \"\", \"limit\": \"\", \"offset\": \"\"})\n// this is the critical step that includes your headers\nctx := metadata.NewContext(context.Background(), header)\n\nrequest := // construct a request for your service\nresponse, err := client.MyMethod(ctx, request)\n</code></pre>\n\n<p>For a stream, it looks almost the same:</p>\n\n<pre><code>conn, _ := grpc.Dial(address, opts...)\nclient := NewMyClient(conn) // generated from your proto with the grpc protoc option\n\nheader := metadata.New(map[string]string{\"authorization\": \"\", \"space\":  \"\", \"org\": \"\", \"limit\": \"\", \"offset\": \"\"})\n// this is the critical step that includes your headers\nctx := metadata.NewContext(context.Background(), header)\nstream, err := client.MyMethodStream(ctx)\n\nfor {\n    request :=  // construct a request for your service\n    err := stream.Send(request)\n    response := new(Response)\n    err = stream.RecvMsg(response)\n}\n</code></pre>\n\n<hr>\n\n<p>On the server side for an unary RPC:</p>\n\n<pre><code>func (s myServer) MyMethod(context.Context, *Request) (*Response, error) {\n    headers, ok := metadata.FromContext(ctx)\n    token := headers[\"authorization\"]\n}\n</code></pre>\n\n<p>and for a streaming RPC:</p>\n\n<pre><code>func (s myServer) MyMethodStream(stream MyMethod_MyServiceStreamServer) error {\n    headers, ok := metadata.FromContext(stream.Context())\n    token := headers[\"authorization\"]\n    for {\n        request := new(Request)\n        err := stream.RecvMsg(request)\n        // do work\n        err := stream.SendMsg(response)\n    }\n}\n</code></pre>\n\n<hr>\n\n<p>Note that for a stream there are only three times that headers can be sent: in the context used to open the initial stream, via <a href=\"https://godoc.org/google.golang.org/grpc#SendHeader\" rel=\"noreferrer\">grpc.SendHeader</a>, and <a href=\"https://godoc.org/google.golang.org/grpc#SetTrailer\" rel=\"noreferrer\">grpc.SetTrailer</a>. It is not possible to set headers on arbitrary messages in a stream. For an unary RPC header are sent with every message and can be set in the initial context, with grpc.SendHeader and <a href=\"https://godoc.org/google.golang.org/grpc#SetHeader\" rel=\"noreferrer\">grpc.SetHeader</a>, and grpc.SetTrailer.</p>\n"}], "owner": {"reputation": 161, "user_id": 3818395, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/81736896cefe216a62806083cc220bb8?s=128&d=identicon&r=PG&f=1", "display_name": "Sanket", "link": "https://stackoverflow.com/users/3818395/sanket"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16175, "favorite_count": 7, "answer_count": 1, "score": 9, "last_activity_date": 1486581822, "creation_date": 1486566240, "last_edit_date": 1486570427, "question_id": 42116642, "link": "https://stackoverflow.com/questions/42116642/how-to-read-metadata-in-grpc-on-the-server-side-golang-example", "title": "how to read metadata in grpc on the server side? (golang example)", "body": "<p>How to read metadata (passed as a header) on the server side in grpc? Any example in golang?</p>\n\n<p>I am writing something like this:</p>\n\n<pre><code>// this should be passed from the client side as a context and needs to accessed on server side to read the metadata\nvar headers = metadata.New(map[string]string{\"authorization\": \"\", \"space\":  \"\", \"org\": \"\", \"limit\": \"\", \"offset\": \"\"})\n</code></pre>\n\n<p>I want to pass the Authorization token to my validation function to validate the received token.</p>\n\n<pre><code>func validate_token(ctx context.Context, md *metadata.MD) (context.Context, error){\n    token := headers[\"authorization\"]\n}\n</code></pre>\n"}, {"tags": ["go", "icmp"], "comments": [{"owner": {"reputation": 55, "user_id": 7534870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecb32ab57092e812260eac1e8251eacd?s=128&d=identicon&r=PG&f=1", "display_name": "user123", "link": "https://stackoverflow.com/users/7534870/user123"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1486566708, "post_id": 42115989, "comment_id": 71402034, "body": "No, I set <code>Dst</code> to <code>3.3.3.3</code> on purpose to pretend the time exceed message is caused by the echo request sent by <code>192.168.2.100</code> to <code>3.3.3.3</code>."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1486567707, "post_id": 42115989, "comment_id": 71402741, "body": "Ok. Your code works for me. The server prints &quot;ttl exceeded&quot;. Are you sure there is connectivity between your machine at 192.168.1.100 and 192.168.2.100 ? Those machines sounds like they might be on different subnets, so make sure you can route between them and there&#39;s no firewalls messing things up. Try to debug with tcpdump on both the client and the server, you&#39;ll see if the packet appears, and looks like it should."}, {"owner": {"reputation": 55, "user_id": 7534870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecb32ab57092e812260eac1e8251eacd?s=128&d=identicon&r=PG&f=1", "display_name": "user123", "link": "https://stackoverflow.com/users/7534870/user123"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1486571783, "post_id": 42115989, "comment_id": 71405724, "body": "thanks for the reply. There is connection between the two subnets. It seems the router discards the packet from wireshark."}], "answers": [{"tags": [], "owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "is_accepted": true, "score": 2, "last_activity_date": 1487241726, "last_edit_date": 1495540397, "creation_date": 1486568316, "answer_id": 42117396, "question_id": 42115989, "link": "https://stackoverflow.com/questions/42115989/cannot-receive-time-exceeded-message/42117396#42117396", "title": "cannot receive time exceeded message", "body": "<p>Your code has no problem. If you run your code in the same network(I mean no NAT/router involvement), the program will receive time exceeded message as expected. The reason is the theory pwnat uses doesn't work nowadays.  </p>\n\n<ul>\n<li><p>First, you didn't get the identifier of the echo request sent by\n<code>192.168.2.100</code> to <code>3.3.3.3</code>, the identifier will be uniquely\nmapped to an external query ID by NAPT(if any) so that it can route\nfuture ICMP Echo Replies with the same query ID to the sender. According to <a href=\"https://tools.ietf.org/html/rfc3022#section-4.3\" rel=\"nofollow noreferrer\">rfc 3022 ICMP error packet modifications section</a>, </p>\n\n<blockquote>\n  <p>In a NAPT setup, if the IP message embedded within ICMP happens to be\n  a TCP, UDP or ICMP Query packet, you will also need to modify the\n  appropriate TU port number within the TCP/UDP header or the Query\n  Identifier field in the ICMP Query header.</p>\n</blockquote></li>\n<li><p>Second, according to rfc 5508:</p>\n\n<blockquote>\n  <p>If a NAT device receives an ICMP Error packet from the private realm,\n  and the NAT does not have an active mapping for the embedded payload,\n  the NAT SHOULD silently drop the ICMP Error packet.</p>\n</blockquote></li>\n</ul>\n\n<p>So the forged time exceeded message wouldn't get through. <a href=\"https://stackoverflow.com/questions/22985793/is-pwnat-still-working/38223370#38223370\">Here</a> is more details about this.</p>\n"}], "owner": {"reputation": 55, "user_id": 7534870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecb32ab57092e812260eac1e8251eacd?s=128&d=identicon&r=PG&f=1", "display_name": "user123", "link": "https://stackoverflow.com/users/7534870/user123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 520, "favorite_count": 0, "accepted_answer_id": 42117396, "answer_count": 1, "score": 3, "last_activity_date": 1487241726, "creation_date": 1486564575, "last_edit_date": 1486566440, "question_id": 42115989, "link": "https://stackoverflow.com/questions/42115989/cannot-receive-time-exceeded-message", "title": "cannot receive time exceeded message", "body": "<p>I'm doing some tests based on the idea of <a href=\"http://samy.pl/pwnat/\" rel=\"nofollow noreferrer\">pwnat</a>, it introduced a method for NAT traversal without 3rd party: the server sends ICMP echo request packets to the fixed address(for example, <code>3.3.3.3</code>) where no echo replies won't be returned from, the client, pretending to be a hop on the Internet, sends an ICMP Time Exceeded packet to the server, expect the NAT in the front of the server to forward the ICMP time exceeded message to the server.<br>\nAfter I pinged to <code>3.3.3.3</code>, then I run the code below in <code>192.168.1.100</code> to listen ICMP messages in Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/net/icmp\"\n    \"golang.org/x/net/ipv4\"\n)\n\nfunc main() {\n    c, err := icmp.ListenPacket(\"ip4:icmp\", \"0.0.0.0\")\n    if err != nil {\n        fmt.Println(\"listen error\", err)\n    }\n    rb := make([]byte, 1500)\n\n    for {\n        n, _, err := c.ReadFrom(rb)\n        if err != nil {\n            fmt.Printf(\"read err: %s\\n\", err)\n        }\n        reply, err := icmp.ParseMessage(1, rb[:n])\n        if err != nil {\n            fmt.Println(\"parse icmp err:\", err)\n            return\n        }\n\n        switch reply.Type {\n        case ipv4.ICMPTypeTimeExceeded:\n            if _, ok := reply.Body.(*icmp.TimeExceeded); ok {\n                // internet header(20 bytes) plus the first 64 bits of the original datagram's data\n                //fmt.Println(\"recv id \", binary.BigEndian.Uint16(timeExceed.Data[22:24]))\n                fmt.Printf(\"ttl exceeded\\n\")\n            }\n        default:\n        }\n    }\n}\n</code></pre>\n\n<p>and a program which runs in <code>192.168.2.100</code> to send forged time exceeded message to <code>192.168.1.100</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"golang.org/x/net/icmp\"\n    \"golang.org/x/net/ipv4\"\n    \"net\"\n    \"os\"\n)\n\nfunc sendTtle(host string) error {\n    conn, err := net.Dial(\"ip4:icmp\", host)\n\n    if err != nil {\n        return err\n    }\n\n    // original IP header\n    h := ipv4.Header{\n        Version:  4,\n        Len:      20,\n        TotalLen: 20 + 8,\n        TTL:      64,\n        Protocol: 1,\n    }\n    h.Src = net.ParseIP(host)\n    h.Dst = net.ParseIP(\"3.3.3.3\")\n    iph, err := h.Marshal()\n    if err != nil {\n        fmt.Println(\"ip header error\", err)\n        return err\n    }\n\n    // 8 bytes of original datagram's data\n    echo := icmp.Message{\n        Type: ipv4.ICMPTypeEcho, Code: 0,\n        Body: &amp;icmp.Echo{\n            ID: 3456, Seq: 1,\n        }}\n\n    oriReq, err := echo.Marshal(nil)\n    if err != nil {\n        return errors.New(\"Marshal error\")\n    }\n    data := append(iph, oriReq...)\n\n    te := icmp.Message{\n        Type: ipv4.ICMPTypeTimeExceeded,\n        Code: 0,\n        Body: &amp;icmp.TimeExceeded{\n            Data: data,\n        }}\n\n    if buf, err := te.Marshal(nil); err == nil {\n        fmt.Println(\"sent\")\n        if _, err := conn.Write(buf); err != nil {\n            return errors.New(\"write error\")\n        }\n    } else {\n        return errors.New(\"Marshal error\")\n    }\n\n    return nil\n}\n\nfunc main() {\n    argc := len(os.Args)\n    if argc &lt; 2 {\n        fmt.Println(\"usage: prpgram + host\")\n        return\n    }\n    if err := sendTtle(os.Args[1]); err != nil {\n        fmt.Println(\"failed to send TTL exceeded message: \", err)\n    }\n}\n</code></pre>\n\n<p>the problem is <code>192.168.1.100</code> cannot receive the message. What're the possible reasons?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1486566164, "last_edit_date": 1486566164, "creation_date": 1486560949, "answer_id": 42114616, "question_id": 42114198, "link": "https://stackoverflow.com/questions/42114198/golang-implementation-of-unknown-number-of-datastore-filters-need-function-to-a/42114616#42114616", "title": "Golang implementation of unknown number of datastore filters (need function to append filters)", "body": "<p>The <a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#Query.Filter\" rel=\"nofollow noreferrer\"><code>Query.Filter()</code></a> method returns a derivative query that will contain all filters of the query it was called on, plus the one you specify in its arguments. So if you plan to build the final query in multiple steps, you need to store its return value.</p>\n\n<p>So your <code>appendFilter()</code> is unnecessary, you can just do:</p>\n\n<pre><code>q := datastore.NewQuery(\"AppStoreApp\")\n\n// Append a filter:\nq = q.Filter(\"filter1\", value1)\n\n// Append another filter:\nq = q.Filter(\"filter2\", value2)\n</code></pre>\n\n<p>To optimize your \"stars\" filter, it may be done like this:</p>\n\n<pre><code>func applyStarFilter(q *datastore.Query, minStars int) *Query {\n    if minStars &gt; 1 {\n        q = q.Filter(fmt.Sprintf(\"Stars%dUp =\", minStars-1), false)\n    }\n    return q.Filter(fmt.Sprintf(\"Stars%dUp =\", minStars), true)\n}\n</code></pre>\n\n<h3>Taking advantage of fields having enumerated values</h3>\n\n<p>Your <code>UpdatedWithinXXYY</code> fields are very similar to stars: have fixed, enumerated values, and to filter by it, you need to set 2 filter fields (one <code>true</code> and one <code>false</code>).</p>\n\n<p>If you enumerate these in advance, you can automate setting those 2 fields. For example:</p>\n\n<pre><code>func applyUpdatedWithin(q *datastore.Query, updateIdx int) *Query {\n    q = q.Filter(updatedValues[updateIdx], true)\n    if updateIdx+1 &lt; len(updatedValues) {\n        q = q.Filter(updatedValues[updateIdx+1], false)\n    }\n    return q\n}\n\nvar updatedValues = []string{\n    \"UpdatedWithin1Day =\",\n    \"UpdatedWithin1Week =\",\n    \"UpdatedWithin1Month =\",\n    \"UpdatedWithin1Year =\",\n}\n</code></pre>\n\n<p>So an example to apply min 3 stars and <code>UpdatedWithin6Months</code>:</p>\n\n<pre><code>q := datastore.NewQuery(\"AppStoreApp\")\nq = applyStarFilter(q, 3)\nq = applyUpdatedWithin(q, 2)\n</code></pre>\n\n<hr>\n\n<p>Relevant to your case, for planning your Datastore indices, I highly recommend to read this article:</p>\n\n<p><strong><a href=\"https://cloud.google.com/appengine/articles/indexselection\" rel=\"nofollow noreferrer\">Index Selection and Advanced Search</a></strong></p>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 42114616, "answer_count": 1, "score": 1, "last_activity_date": 1486566164, "creation_date": 1486559686, "question_id": 42114198, "link": "https://stackoverflow.com/questions/42114198/golang-implementation-of-unknown-number-of-datastore-filters-need-function-to-a", "title": "Golang implementation of unknown number of datastore filters (need function to append filters)", "body": "<p>I'm working on a web app where users can select different options, such as app price, number of stars, update time, etc.</p>\n\n<p>The problem is that with Datastore then it's only possible to make 1 inequality filter, so I cannot say:</p>\n\n<pre><code>query = datastore.NewQuery(\"iOSApp\").Filter(\"StarRatings &gt;=\", stars).Filter(\"MinimumAge &gt;=\", age).Filter(\"Price &gt;=\", price)\n</code></pre>\n\n<p>Instead, I added several bool/int entities, so that if I want to say StarRatings is greater than 3 (maximum is 5), then I can say:</p>\n\n<pre><code>query = datastore.NewQuery(\"iOSApp\").Filter(\"Stars2Up =\", false).Filter(\"Stars3Up =\", true)\n</code></pre>\n\n<p>This solution seems to be working great (and I believe it's a good/fast solution, although I may be wrong)</p>\n\n<p>The problem I have now is that the function that performs this query have to perform so many checks.. the code below is only checking the StarRating filter, but I also want to filter age, price, downloads, update time, etc.</p>\n\n<pre><code>var query *datastore.Query\nswitch stars {\ncase 1:\n    query = datastore.NewQuery(\"AppStoreApp\").Filter(\"Stars1Up =\", true)\ncase 2:\n    query = datastore.NewQuery(\"AppStoreApp\").Filter(\"Stars1Up =\", false).Filter(\"Stars2Up =\", true)\ncase 3:\n    query = datastore.NewQuery(\"AppStoreApp\").Filter(\"Stars2Up =\", false).Filter(\"Stars3Up =\", true)\ncase 4:\n    query = datastore.NewQuery(\"AppStoreApp\").Filter(\"Stars3Up =\", false).Filter(\"Stars4Up =\", true)\ncase 5:\n    query = datastore.NewQuery(\"AppStoreApp\").Filter(\"Stars3Up =\", false).Filter(\"Stars4Up =\", true)\ndefault:\n    log.Println(\"error...\")\n}\nvar app []iOSApp\nif _, err := db.client.GetAll(ctx, query, &amp;app); err != nil {\n    log.Fatalf(\"err: \", err)\n}\nreturn &amp;app, nil\n</code></pre>\n\n<p>If I try to do this using if/else or switch cases then I will quickly end up with a thousand different if/else/switch scenarios.. so I was thinking that I could add a function that took the query and the property as input, and then as output it would return the query containing it's new filter..</p>\n\n<p>For example</p>\n\n<pre><code>// query before\nquery = datastore.NewQuery(\"AppStoreApp\").Filter(\"Stars1Up =\", false).Filter(\"Stars2Up =\", true)\n\nquery, err = appendFilter(query, updatetime) // in this case updatetime = within 6 months as an example\n\n// query after\nquery = datastore.NewQuery(\"AppStoreApp\").Filter(\"Stars1Up =\", false).Filter(\"Stars2Up =\", true).Filter(\"UpdatedWithin6Months =\", true).Filter(\"UpdatedWithin1Year =\", false)\n</code></pre>\n\n<p>I would greatly appreciate help with how this <code>appendFilter</code> function could be implemented</p>\n"}, {"tags": ["ember.js", "go", "promise", "handlebars.js"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1486585212, "post_id": 42113898, "comment_id": 71413718, "body": "What do you see in developers console of a browser?"}, {"owner": {"reputation": 261, "user_id": 6475068, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/890a7f1c9238806d74cb9ecfa981757a?s=128&d=identicon&r=PG&f=1", "display_name": "Kerhael", "link": "https://stackoverflow.com/users/6475068/kerhael"}, "reply_to_user": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1486628790, "post_id": 42113898, "comment_id": 71429974, "body": "Nothing, the console is blank"}, {"owner": {"reputation": 2553, "user_id": 1706831, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/34b7c15de97dd917f6159feb72a3a5a8?s=128&d=identicon&r=PG", "display_name": "Kori John Roys", "link": "https://stackoverflow.com/users/1706831/kori-john-roys"}, "edited": false, "score": 0, "creation_date": 1486634701, "post_id": 42113898, "comment_id": 71433772, "body": "(I&#39;m assuming &lt;address&gt; is a placeholder to not show your real code). How have you verified the service is working?"}, {"owner": {"reputation": 261, "user_id": 6475068, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/890a7f1c9238806d74cb9ecfa981757a?s=128&d=identicon&r=PG&f=1", "display_name": "Kerhael", "link": "https://stackoverflow.com/users/6475068/kerhael"}, "edited": false, "score": 0, "creation_date": 1486634852, "post_id": 42113898, "comment_id": 71433869, "body": "I have tested <code>let res = commands; debugger;</code> and seen the result is fine and <code>res</code> does have the map with all keys and values"}, {"owner": {"reputation": 2553, "user_id": 1706831, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/34b7c15de97dd917f6159feb72a3a5a8?s=128&d=identicon&r=PG", "display_name": "Kori John Roys", "link": "https://stackoverflow.com/users/1706831/kori-john-roys"}, "edited": false, "score": 0, "creation_date": 1486635600, "post_id": 42113898, "comment_id": 71434352, "body": "I think the issue is that #each doesn&#39;t know what to do with a promise. See this article: <a href=\"https://emberigniter.com/guide-promises-computed-properties/\" rel=\"nofollow noreferrer\">emberigniter.com/guide-promises-computed-properties</a>"}], "answers": [{"comments": [{"owner": {"reputation": 261, "user_id": 6475068, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/890a7f1c9238806d74cb9ecfa981757a?s=128&d=identicon&r=PG&f=1", "display_name": "Kerhael", "link": "https://stackoverflow.com/users/6475068/kerhael"}, "edited": false, "score": 0, "creation_date": 1486643617, "post_id": 42134221, "comment_id": 71439737, "body": "Thanks for your help. Unfortunately, we get &quot;regeneratorRuntime&quot; error and the app crashes"}], "tags": [], "owner": {"reputation": 2553, "user_id": 1706831, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/34b7c15de97dd917f6159feb72a3a5a8?s=128&d=identicon&r=PG", "display_name": "Kori John Roys", "link": "https://stackoverflow.com/users/1706831/kori-john-roys"}, "is_accepted": false, "score": 0, "last_activity_date": 1486636207, "creation_date": 1486636207, "answer_id": 42134221, "question_id": 42113898, "link": "https://stackoverflow.com/questions/42113898/display-map-from-promise-with-emberjs-and-handlebars/42134221#42134221", "title": "Display map from promise with emberJS and handlebars", "body": "<p>I think with Ember Concurrency, your service will pause until your promise resolves, then return the results you want, rather than a promise object that <code>#each</code> doesn't know how to iterate over.</p>\n\n<p>Your service code would end up looking like this:</p>\n\n<pre><code>commands: task(function*() {\n  const allCommands = yield this.get('ajax').request('&lt;address&gt;/command');\n  return allCommands;\n}),\ncommandActions: computed.alias('commands.actions'),\ncommandKeys: computed.alias('commands.commandKeys')\n</code></pre>\n\n<p>and your template would be happy again.</p>\n"}, {"comments": [{"owner": {"reputation": 2553, "user_id": 1706831, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/34b7c15de97dd917f6159feb72a3a5a8?s=128&d=identicon&r=PG", "display_name": "Kori John Roys", "link": "https://stackoverflow.com/users/1706831/kori-john-roys"}, "edited": false, "score": 0, "creation_date": 1486722813, "post_id": 42137019, "comment_id": 71479511, "body": "Glad you got something working with a promise array and tweaking your response."}], "tags": [], "owner": {"reputation": 261, "user_id": 6475068, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/890a7f1c9238806d74cb9ecfa981757a?s=128&d=identicon&r=PG&f=1", "display_name": "Kerhael", "link": "https://stackoverflow.com/users/6475068/kerhael"}, "is_accepted": true, "score": 0, "last_activity_date": 1486644053, "creation_date": 1486644053, "answer_id": 42137019, "question_id": 42113898, "link": "https://stackoverflow.com/questions/42113898/display-map-from-promise-with-emberjs-and-handlebars/42137019#42137019", "title": "Display map from promise with emberJS and handlebars", "body": "<p>Thank you all for the help you provided.</p>\n\n<p>We finally managed to get what we wanted by doing the following:</p>\n\n<p>In config.js service:</p>\n\n<pre><code>commands: computed(function () {\n    return this.get('ajax').request('&lt;address&gt;/command').then(result =&gt; {\n        return result;\n    });\n}),\n</code></pre>\n\n<p>In command.js controller:</p>\n\n<pre><code>import DS from 'ember-data';\n\nactions: computed(function() {\n    return DS.PromiseArray.create({\n        promise: this.get('config.commands').then((allCommands) =&gt; {\n            let result = [];\n            let actions = allCommands['actions'];\n\n            for (var name in actions) {\n                let cmd = Ember.Object.create({\n                    'name': name,\n                    'code': actions[name],\n                });\n\n                result.pushObject(cmd);\n            }\n\n            return result;\n        })\n    });\n}),\n</code></pre>\n\n<p>Same code to get keys.</p>\n\n<p>And in commands.hbs:</p>\n\n<pre><code>&lt;tbody&gt;\n  {{#each actions as |action|}}\n    &lt;tr&gt;\n      &lt;td&gt;{{action.name}}&lt;/td&gt;\n      &lt;td&gt;\n        {{#power-select\n          options=keys\n          selected=selectedKey\n          allowClear=false\n          onchange=(action 'selectKey' action)\n          searchEnabled=false\n          as |key|\n        }}\n          {{key.name}}\n        {{/power-select}}\n      &lt;/td&gt;\n    &lt;/tr&gt;\n  {{/each}}\n&lt;/tbody&gt;\n</code></pre>\n\n<p>Thanks again</p>\n"}], "owner": {"reputation": 261, "user_id": 6475068, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/890a7f1c9238806d74cb9ecfa981757a?s=128&d=identicon&r=PG&f=1", "display_name": "Kerhael", "link": "https://stackoverflow.com/users/6475068/kerhael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 42137019, "answer_count": 2, "score": 0, "last_activity_date": 1486644053, "creation_date": 1486558894, "last_edit_date": 1486633212, "question_id": 42113898, "link": "https://stackoverflow.com/questions/42113898/display-map-from-promise-with-emberjs-and-handlebars", "title": "Display map from promise with emberJS and handlebars", "body": "<p>I am currently struggling to display maps in emberJS/handlebars (which is new for me).</p>\n\n<p>Server side, I have a command.go file with:</p>\n\n<pre><code>var Actions = map[string]string{\n    \"EAT\": \"EAT.\",\n    \"DRINK\": \"DRNK\",\n    \"SLEEP\": \"SLP.\"\n}\nvar Keys = map[string]int{\n    \"KEY_q\": 0,\n    \"KEY_w\": 1,\n    \"KEY_e\": 2,\n    ...\n}\n</code></pre>\n\n<p>Each action and key have a string constant identifier and are associated to a string or int code.</p>\n\n<p>I would like to display a 2 columns table in which:\n- column 1 shows actions (like eat, drink, sleep, ...)\n- column 2 shows a dropdown list with available keyboard keys (like Q, W, E, ...), their int code being the id of the  tag</p>\n\n<p>I have a controller returning these maps as JSON object:</p>\n\n<pre><code>ctx.JSON(http.StatusOK, gin.H{\n    \"actions\":      models.Actions,\n    \"keys\": models.Keys,\n})\n</code></pre>\n\n<p>Then I a an emberJS service, config.js, as follows:</p>\n\n<pre><code>commands: computed(function () {\n    return this.get('ajax').request('&lt;address&gt;/command').then(result =&gt; {\n        return result;\n    });\n}),\ncommandActions: computed('commands', function() {\n    return this.get('commands').then((commands) =&gt; {\n        return commands.actions;\n    });\n}),\ncommandKeys: computed('commands', function() {\n    return this.get('commands').then((commands) =&gt; {\n        return commands.keys;\n    });\n}),\n</code></pre>\n\n<p>The controller commands.js is as follows:</p>\n\n<pre><code>import Ember from 'ember';\n\nconst { computed, inject: { service } } = Ember;\n\nexport default Ember.Controller.extend({\n    config: service(),\n\n    selectedKey: '',\n\n    actions: {\n        selectKey(value) {\n\n        },\n    }\n});\n</code></pre>\n\n<p>And finally in commands.hbs I have</p>\n\n<pre><code>&lt;div class=\"table-responsive\"&gt;\n  &lt;table class=\"table\"&gt;\n    &lt;thead&gt;\n      &lt;tr&gt;\n        &lt;th&gt;Actions&lt;/th&gt;\n        &lt;th&gt;Associated key&lt;/th&gt;\n      &lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n      {{#each-in config.commandActions as |key value|}}\n        &lt;tr&gt;\n          &lt;td&gt;{{command}}&lt;/td&gt;\n          &lt;td&gt;\n            {{#power-select\n            options=config.commandKeys\n            selected=selectedKey\n            allowClear=false\n            searchEnabled=false\n            onchange=(action \"selectKey\")\n            as |key|\n            }}\n              {{key}}\n            {{/power-select}}\n          &lt;/td&gt;\n        &lt;/tr&gt;\n      {{/each-in}}\n    &lt;/tbody&gt;\n  &lt;/table&gt;\n&lt;/div&gt;\n</code></pre>\n\n<p>But nothing is displayed :(.\nThe service works well but then in the hbs file nothing appears. I have tried different combinations of each or each-in with no success.</p>\n\n<p>Could someone please help?\nDo I need to set variables in the controller somehow then use those variables in the hbs?</p>\n\n<p>I'm using ember 2.5.</p>\n\n<p>Thanks in advance</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>The problem may come from the fact that I am trying to display a promise object before it is resolved. Any idea about that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486557554, "post_id": 42113153, "comment_id": 71395343, "body": "Could you provide a much <i>smaller</i> and standalone snippet which demonstrates the problem? Most probably the problem is hidden in a lot of noise."}, {"owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486557732, "post_id": 42113153, "comment_id": 71395470, "body": "@Volker unfortunately as I explained I have no idea what&#39;s going on so I can&#39;t condense it."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486557924, "post_id": 42113153, "comment_id": 71395603, "body": "Do you think this is a good question for SO? Will an answer be helpful for others too?"}, {"owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486558010, "post_id": 42113153, "comment_id": 71395658, "body": "@Volker Definitely. The issue was using looping over <code>for _, category := range *categories</code> and passing a reference to <code>&amp;category</code>. This was passing a reference to the variable used in the generator, rather than the underlying element. Changing it to loop over <code>for i := 0; i &lt; len(*categories); i++</code> has fixed the issue."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486563062, "post_id": 42113153, "comment_id": 71399291, "body": "Note that the underlying problem was using &quot;pointer to slice&quot; which is wrong in most cases and definitively in your case: Don&#39;t do that."}], "answers": [{"tags": [], "owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "is_accepted": true, "score": 0, "last_activity_date": 1486558143, "creation_date": 1486558143, "answer_id": 42113591, "question_id": 42113153, "link": "https://stackoverflow.com/questions/42113153/objects-in-go-getting-replaced/42113591#42113591", "title": "Objects in go getting replaced", "body": "<p>Looping over:</p>\n\n<pre><code>            for _, category := range *categories {\n                    numRequests += 1\n                    downloadChannel &lt;- &amp;category\n            }\n</code></pre>\n\n<p>meant I was sending a reference to the temporary variable <code>category</code> to the channel, instead of the actual memory address of that value.</p>\n\n<p>I've fixed this by using a different loop:</p>\n\n<pre><code>    for i := 0; i &lt; len(*categories); i++ {\n        fmt.Printf(\"Queuing category: %v (%p)\", categoriesValues[i], categoriesValues[i])\n\n        downloadChannel &lt;- &amp;categoriesValues[i]\n    }\n</code></pre>\n"}], "owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 42113591, "answer_count": 1, "score": -1, "last_activity_date": 1486558143, "creation_date": 1486556901, "last_edit_date": 1486558063, "question_id": 42113153, "link": "https://stackoverflow.com/questions/42113153/objects-in-go-getting-replaced", "title": "Objects in go getting replaced", "body": "<p>I'm learning go by writing a web spider. I'm trying to get a list of all the business categories from <code>allpages.com</code>.</p>\n\n<p>Below is my entire program. Unfortunately I can't isolate the issue so I've pasted it all.</p>\n\n<p>If you run this program, you'll see that first of all it correctly downloads the first page, and adds all the extracted categories to the list of categories.</p>\n\n<p>However, when it then downloads subsequent pages, it seems to mess up the reference to the parent category. E.g. it incorrectly calculates the URL <code>http://www.allpages.com/travel-tourism/political-ideological-organizations/</code>, when in fact <code>political-ideological-organizations/</code> is not a subcategory of <code>travel-tourism/</code>. Digging through the logs it seems to overwrite the data in the <code>parent</code> object. The error is more pronounced the more workers there are. </p>\n\n<p>This was working a bit better before I started passing data by reference to the goroutine, but I had essentially the same issue.</p>\n\n<p>I've got several questions:</p>\n\n<ol>\n<li>How can I debug this without resorting to picking through log lines?</li>\n<li><p>What's wrong/why isn't it working and how can it be fixed?</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"github.com/PuerkitoBio/goquery\"\n        \"log\"\n        \"strconv\"\n        \"strings\"\n        \"regexp\"\n)\n\nconst domain = \"http://www.allpages.com/\"\nconst categoryPage = \"category.html\"\n\ntype Category struct {\n        url string\n        level uint\n        name string\n        entries int\n        parent *Category\n}\n\ntype DownloadResult struct {\n        doc *goquery.Document\n        category *Category\n}\n\nconst WORKERS = 2\nconst SEPARATOR = \"\u00a7\u00a7\u00a7\"\n\nfunc main() {\n\n        allCategories := make([]Category, 0)\n\n        downloadChannel := make(chan *Category)\n        resultsChannel := make(chan *DownloadResult, 100)\n\n        for w := 1; w &lt;= WORKERS; w++ {\n                go worker(downloadChannel, resultsChannel)\n        }\n\n        numRequests := 1\n        downloadChannel &lt;- &amp;Category{ domain + categoryPage, 0, \"root\", 0, nil }\n\n        for result := range resultsChannel {\n                var extractor func(doc *goquery.Document) []string\n\n                if result.category.level == 0 {\n                        extractor = topLevelExtractor\n                } else if result.category.level == 1 {\n                        extractor = secondLevelExtractor\n                } else {\n                        extractor = thirdLevelExtractor\n                }\n\n                categories := extractCategories(result.doc, result.category, extractor)\n                allCategories = append(allCategories, *categories...)\n\n                //fmt.Printf(\"Appending categories: %v\", *categories)\n\n                fmt.Printf(\"total categories = %d, total requests = %d\\n\", len(allCategories), numRequests)\n\n                for _, category := range *categories {\n                        numRequests += 1\n                        downloadChannel &lt;- &amp;category\n                }\n\n                // close the channels when there are no more jobs\n                if len(allCategories) &gt; numRequests {\n                        close(downloadChannel)\n                        close(resultsChannel)\n                }\n        }\n\n        fmt.Println(\"Done\")\n}\n\nfunc worker(downloadChannel &lt;-chan *Category, results chan&lt;- *DownloadResult) {\n        for target := range downloadChannel {\n                fmt.Printf(\"Downloading %v (addr %p) ...\", target, &amp;target)\n\n                doc, err := goquery.NewDocument(target.url)\n                if err != nil {\n                        log.Fatal(err)\n                        panic(err)\n                }\n\n                fmt.Print(\"done \\n\")\n\n                results &lt;- &amp;DownloadResult{doc, target}\n        }\n}\n\nfunc extractCategories(doc *goquery.Document, parent *Category, extractor func(doc *goquery.Document) []string) *[]Category {\n\n        numberRegex, _ := regexp.Compile(\"[0-9,]+\")\n\n        log.Printf(\"Extracting subcategories for page %s\\n\", parent)\n\n        subCategories := extractor(doc)\n\n        categories := make([]Category, 0)\n\n        for _, subCategory := range subCategories {\n                log.Printf(\"Got subcategory=%s from parent=%s\", subCategory, parent)\n                extracted := strings.Split(subCategory, SEPARATOR)\n\n                numberWithComma := numberRegex.FindString(extracted[2])\n                number := strings.Replace(numberWithComma, \",\", \"\", -1)\n\n                numRecords, err := strconv.Atoi(number)\n                if err != nil {\n                        log.Fatal(err)\n                        panic(err)\n                }\n\n                var category Category\n\n                level := parent.level + 1\n\n                if parent.level == 0 {\n                        category = Category{ domain + extracted[1], level, extracted[0], numRecords, parent }\n                } else {\n                        log.Printf(\"category URL=%s, parent=%s, parent=%v\", extracted[1], parent.url, parent)\n                        category = Category{ parent.url + extracted[1], level, extracted[0], numRecords, parent }\n                }\n\n                log.Printf(\"Appending category=%v (pointer=%p)\", category, &amp;category)\n\n                categories = append(categories, category)\n        }\n\n        return &amp;categories\n}\n\nfunc topLevelExtractor(doc *goquery.Document) []string {\n        return doc.Find(\".cat-listings-td .c-1s-2m-1-td1\").Map(func(i int, s *goquery.Selection) string {\n                title := s.Find(\"a\").Text()\n                url := s.Find(\"a\").Map(func(x int, a *goquery.Selection) string {\n                        v, _ := a.Attr(\"href\")\n                        return v\n                })\n                records := s.Clone().Children().Remove().End().Text()\n\n                //log.Printf(\"Item %d: %s, %s - %s\\n\", i, title, records, url)\n\n                res := []string{title, url[0], records}\n                return strings.Join(res, SEPARATOR)\n        })\n}\n\nfunc secondLevelExtractor(doc *goquery.Document) []string {\n        return doc.Find(\".c-2m-3c-1-table .c-2m-3c-1-td1\").Map(func(i int, s *goquery.Selection) string {\n                title := s.Find(\"a\").Text()\n                url := s.Find(\"a\").Map(func(x int, a *goquery.Selection) string {\n                        v, _ := a.Attr(\"href\")\n                        return v\n                })\n                records := s.Clone().Children().Remove().End().Text()\n\n                //log.Printf(\"Item %d: %s, %s - %s\\n\", i, title, records, url)\n\n                res := []string{title, url[0], records}\n                return strings.Join(res, SEPARATOR)\n        })\n}\n\nfunc thirdLevelExtractor(doc *goquery.Document) []string {\n        return doc.Find(\".c-2m-3c-1-table .c-2m-3c-1-td1\").Map(func(i int, s *goquery.Selection) string {\n                title := s.Find(\"a\").Text()\n                url := s.Find(\"a\").Map(func(x int, a *goquery.Selection) string {\n                        v, _ := a.Attr(\"href\")\n                        return v\n                })\n                records := s.Clone().Children().Remove().End().Text()\n\n                //log.Printf(\"Item %d: %s, %s - %s\\n\", i, title, records, url)\n\n                res := []string{title, url[0], records}\n                return strings.Join(res, SEPARATOR)\n        })\n}\n</code></pre></li>\n</ol>\n\n<p><strong>Update</strong>\nFixed - see comment below. </p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1486557853, "post_id": 42112907, "comment_id": 71395556, "body": "See <a href=\"https://golang.org/pkg/regexp/\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 4, "last_activity_date": 1486558286, "creation_date": 1486558286, "answer_id": 42113639, "question_id": 42112907, "link": "https://stackoverflow.com/questions/42112907/how-do-i-create-a-go-type-derived-from-string-that-matches-a-pattern/42113639#42113639", "title": "How do I create a Go type derived from string that matches a pattern?", "body": "<p>Use a struct type:</p>\n\n<pre><code>type SlackUser struct {\n    username string\n}\n</code></pre>\n\n<p>Compile the regular expression:</p>\n\n<pre><code>var (\n    pattern = regexp.MustCompile(\"^@[a-z0-9][a-z0-9._-]*$\")\n)\n</code></pre>\n\n<p>Constructor:</p>\n\n<pre><code>func NewSlackUser(username string) (*SlackUser, error) {\n    if !pattern.MatchString(username) {\n        return nil, errors.New(\"Invalid username.\")\n    }\n    return &amp;SlackUser{ username }, nil\n}\n</code></pre>\n\n<p>Stringer:</p>\n\n<pre><code>func (s *SlackUser) String() string {\n    return s.username\n}\n</code></pre>\n\n<p>Full <a href=\"https://play.golang.org/p/pGLHsTcSyU\" rel=\"nofollow noreferrer\">example</a></p>\n"}], "owner": {"reputation": 29738, "user_id": 166258, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6a71349baca79ffabcda02ee4b284bef?s=128&d=identicon&r=PG", "display_name": "Ben McCormack", "link": "https://stackoverflow.com/users/166258/ben-mccormack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486558286, "creation_date": 1486556198, "question_id": 42112907, "link": "https://stackoverflow.com/questions/42112907/how-do-i-create-a-go-type-derived-from-string-that-matches-a-pattern", "title": "How do I create a Go type derived from string that matches a pattern?", "body": "<p>I'm trying to create a new Go type that's based on <code>string</code> but is required to match a pattern (Slack username, e.g. <code>@ben</code>).</p>\n\n<p>When used, the type would look something like:</p>\n\n<pre><code>var user SlackUser\nuser = SlackUser(\"@ben\")\n\nfmt.Println(user) //This should print: @ben\n</code></pre>\n\n<p>If it matches the pattern, <code>NewSlackUser</code> will work. If it doesn't, it will throw an error.</p>\n\n<p>The pattern to match, which is based on <a href=\"https://gist.github.com/gswalden/27ac96e497c3aa1f3230\" rel=\"nofollow noreferrer\">this</a>, is:</p>\n\n<p><code>^@[a-z0-9][a-z0-9._-]*$</code></p>\n\n<p>(I'm very new to Go, so any correction to my approach is much appreciated)</p>\n"}, {"tags": ["go", "active-directory", "ldap"], "comments": [{"owner": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 0, "creation_date": 1486548649, "post_id": 42109853, "comment_id": 71389243, "body": "You can just call <code>GetLDAPEmail</code> in your <code>mainHandler</code> if you send it a username and password"}, {"owner": {"reputation": 53, "user_id": 2357858, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/041f22c68268923df604f9c521bcb8cf?s=128&d=identicon&r=PG", "display_name": "user2357858", "link": "https://stackoverflow.com/users/2357858/user2357858"}, "reply_to_user": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 0, "creation_date": 1486548974, "post_id": 42109853, "comment_id": 71389477, "body": "How can I get username and password to pass to GetLDAPEmail()?"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 2357858, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/041f22c68268923df604f9c521bcb8cf?s=128&d=identicon&r=PG", "display_name": "user2357858", "link": "https://stackoverflow.com/users/2357858/user2357858"}, "edited": false, "score": 0, "creation_date": 1486635372, "post_id": 42116880, "comment_id": 71434206, "body": "Thanks. Today I discovered that I can also get auth data from r.Header[&quot;Authorization&quot;] :)"}], "tags": [], "owner": {"reputation": 36, "user_id": 3056512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00e00d6316d600b22d61669aa7c785ea?s=128&d=identicon&r=PG&f=1", "display_name": "rbh", "link": "https://stackoverflow.com/users/3056512/rbh"}, "is_accepted": true, "score": 1, "last_activity_date": 1486566830, "creation_date": 1486566830, "answer_id": 42116880, "question_id": 42109853, "link": "https://stackoverflow.com/questions/42109853/golang-webapp-with-ldap/42116880#42116880", "title": "golang webapp with LDAP", "body": "<p>The way your functions and handlers are wired, I do not see a whole lot of \"clean\" options to pass state back from <code>BasicAuth()</code> to the <code>mainHandler()</code> per request.</p>\n\n<p>If you are open to the idea of changing the way you setup your handlers, here is a skeleton structure which you can expand to fit your needs:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\ntype User struct {\n    Name     string\n    Password string\n}\n\nfunc main() {\n    mux := http.NewServeMux()\n    mux.Handle(\"/\", &amp;User{})\n    s := &amp;http.Server{Addr: \"localhost:8080\", Handler: mux}\n    log.Fatal(s.ListenAndServe())\n}\n\nfunc (u *User) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    //Pull out the username and password\n    u.BasicAuth()\n    fmt.Println(u.Name)\n    fmt.Println(u.Password)\n    //The rest of your main handler\n}\n\nfunc (u *User) BasicAuth() {\n    //This is to demonstrate the ability to pass state\n    //Edit this to fit your needs\n    u.Name = \"user\"\n    u.Password = \"pass\"\n}\n</code></pre>\n\n<p>The <code>User</code> struct implements the ServeHTTP function, effectively implementing the <code>http.Handler</code> <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\">interface</a> which opens up the option of adding it to a multiplexer which in turn helps maintain the username and password per request. Although the methods receive a pointer type you could change it to better suit your needs.</p>\n"}], "owner": {"reputation": 53, "user_id": 2357858, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/041f22c68268923df604f9c521bcb8cf?s=128&d=identicon&r=PG", "display_name": "user2357858", "link": "https://stackoverflow.com/users/2357858/user2357858"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1731, "favorite_count": 1, "accepted_answer_id": 42116880, "answer_count": 1, "score": 1, "last_activity_date": 1486566830, "creation_date": 1486547810, "question_id": 42109853, "link": "https://stackoverflow.com/questions/42109853/golang-webapp-with-ldap", "title": "golang webapp with LDAP", "body": "<p>I try to build web application using Active Directory authentication. I also need to get email address of a user. I have a function that can get email  address.\nWhere and how should I use the function to get email in mainHandler()? </p>\n\n<p>main.go</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/\", auth.BasicAuth(mainHandler))\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc mainHandler(w http.ResponseWriter, r *http.Request) {\n    tmpl, err := template.ParseFiles(\"templates/main.html\")\n    if err == nil {\n        tmpl.Execute(w, nil)\n    }\n}\n</code></pre>\n\n<p>auth.go</p>\n\n<pre><code>type Handler func(w http.ResponseWriter, r *http.Request)\n\n// BasicAuth - handler wrapper for authentication\nfunc BasicAuth(pass Handler) Handler {\n\n    return func(w http.ResponseWriter, r *http.Request) {\n        username, password, ok := r.BasicAuth()\n        err := ValidateAD(username, password)\n        if err != nil || !ok {\n            realm := \"Please enter your corporate key and password\"\n            w.Header().Set(\"WWW-Authenticate\", `Basic realm=\"`+realm+`\"`)\n            // w.WriteHeader(401)\n            http.Error(w, \"authorization failed\", http.StatusUnauthorized)\n            return\n        }\n        pass(w, r)\n    }\n}\n\nvar ErrEmptyUserOrPass = errors.New(\"Username or password cannot be empty\")\nvar conn *ldap.Conn\n\n\n// ValidateAD validation based on Active Directory\nfunc ValidateAD(user, passwd string) error {\n    if user == \"\" || passwd == \"\" {\n        return ErrEmptyUserOrPass\n    }\n    tlsConfig := &amp;tls.Config{InsecureSkipVerify: true}\n    var err error\n    conn, err = ldap.DialTLS(\"tcp\", \"ad.something.com:636\", tlsConfig)\n    if err != nil {\n        return err\n    }\n    defer conn.Close()\n    domainPrefix := \"ad\\\\\"\n    err = conn.Bind(domainPrefix+user, passwd)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n\n// GetLDAPEmail returns email address for given username and password\nfunc GetLDAPEmail(user, password string) (string, error) {\n    if err := ValidateAD(user, password); err != nil {\n        return \"\", err\n    }\n    searchBase := \"CN=\" + user + \",OU=OU1,OU=OU2,OU=OU3,DC=ad,DC=something,DC=com\"\n    searchFilter := \"(&amp;(samAccountName=\" + user + \"))\"\n    searchRequest := ldap.NewSearchRequest(\n        searchBase, // The base dn to search\n        ldap.ScopeWholeSubtree, ldap.NeverDerefAliases, 0, 0, false,\n        searchFilter,     // The filter to apply\n        []string{\"mail\"}, // A list attributes to retrieve\n        nil,\n    )\n    sr, err := conn.Search(searchRequest)\n    if err != nil {\n        return \"\", err\n    }\n    email := sr.Entries[0].GetAttributeValue(\"mail\")\n    return strings.ToLower(email), nil\n}\n</code></pre>\n"}, {"tags": ["go", "lambda", "interface", "type-assertion"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1486551361, "last_edit_date": 1486551361, "creation_date": 1486541093, "answer_id": 42107690, "question_id": 42107579, "link": "https://stackoverflow.com/questions/42107579/use-function-that-accepts-io-writer-as-handlefunc/42107690#42107690", "title": "Use function that accepts io.Writer as HandleFunc", "body": "<p><a href=\"https://golang.org/ref/spec#Function_types\" rel=\"nofollow noreferrer\">Spec: Function types:</a></p>\n\n<blockquote>\n  <p>A function type denotes the set of all functions with the same parameter and result types.</p>\n</blockquote>\n\n<p>Your <code>doit()</code> function does not qualify to be an <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow noreferrer\"><code>http.HandlerFunc</code></a> because parameter types do not match. The types <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a> and <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\"><code>http.ResponseWriter</code></a> are 2 completely different types, so the function types taking these types are also different.</p>\n\n<h3>Using an anonymous function value</h3>\n\n<p>However, since the <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">method set</a> of the interface type <code>io.Writer</code> is a subset of the method set of <code>http.ResponseWriter</code>, a value of the latter type can be <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assigned</a> to the variable of the former type.</p>\n\n<p>You may wrap it in an anonymous function of type <code>http.HandlerFunc</code> which may simply call <code>doit()</code>, and then you may use it as an <code>http.HandlerFunc</code>:</p>\n\n<pre><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    doit(w, r)\n})\n</code></pre>\n\n<h3>Anonymous function value with helper function</h3>\n\n<p>If you need this many times, you may create a helper function to produce the <code>http.HandlerFunc</code> function value:</p>\n\n<pre><code>func wrap(f func(w io.Writer, r *http.Request)) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        f(w, r)\n    }\n}\n</code></pre>\n\n<p>And then using it is simply:</p>\n\n<pre><code>http.HandleFunc(\"/\", wrap(doit))\n</code></pre>\n\n<h3>With custom <code>Handler</code> type</h3>\n\n<p>Another option would be to define your own function type, to which you can attach a simple method to implement <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow noreferrer\"><code>http.Handler</code></a> (namely <code>ServeHTTP()</code>), and that way with a simple type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a> you can register your function as a handler:</p>\n\n<pre><code>type SimpleHandler func(io.Writer, *http.Request)\n\nfunc (sh SimpleHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    sh(w, r)\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>http.Handle(\"/\", SimpleHandler(doit))\n</code></pre>\n\n<p>Note that the expression <code>SimpleHandler(doit)</code> is simply a type conversion, it's not a function call. So there are no new values or anonymous functions created here in the background, this solution is the most efficient.</p>\n"}], "owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 957, "favorite_count": 0, "accepted_answer_id": 42107690, "answer_count": 1, "score": 2, "last_activity_date": 1486551361, "creation_date": 1486540645, "question_id": 42107579, "link": "https://stackoverflow.com/questions/42107579/use-function-that-accepts-io-writer-as-handlefunc", "title": "Use function that accepts io.Writer as HandleFunc", "body": "<p>I would like to make a function that can be a HandleFunc for <code>http</code> but also be called with another writer.</p>\n\n<p>Since <code>http.ResponseWriter</code> implements <code>io.Writer</code> and my function does not need to set HTTP headers, I thought it might be possible:</p>\n\n<pre><code>func doit(w io.Writer, r *http.Request) {\n  w.Write([]byte(\"Hello\"))\n}\n\nhttp.HandleFunc(\"/\", doit)\n</code></pre>\n\n<p>But no:</p>\n\n<blockquote>\n  <p>cannot use doit (type func(io.Writer, *http.Request)) as type func(http.ResponseWriter, *http.Request) in argument to http.HandleFunc</p>\n</blockquote>\n\n<p>That makes sense, because it would require a type assertion to make an io.Writer compatible with an expected http.ResponseWriter.</p>\n\n<p>Is something like that possible with functions?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1486546499, "post_id": 42107477, "comment_id": 71387592, "body": "Are you asking where in the spec this behavior is required or what exactly is your question?"}, {"owner": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486585154, "post_id": 42107477, "comment_id": 71413692, "body": "I&#39;m asking if this behavior is specified in the spec or not. Because this has implication to the program. I would know that lots of memory allocation/de-allocation will be done if I do frequent map lookup of big value objects"}, {"owner": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486585379, "post_id": 42107477, "comment_id": 71413813, "body": "Ok. My question is explained by Not_a_Golfer. &quot;Go does not pass references, ever&#39;."}], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 8, "last_activity_date": 1486542241, "last_edit_date": 1486542241, "creation_date": 1486540460, "answer_id": 42107529, "question_id": 42107477, "link": "https://stackoverflow.com/questions/42107477/go-map-lookup-returns-copy-of-the-element/42107529#42107529", "title": "Go map lookup returns copy of the element?", "body": "<p>Go does not pass references, ever. It either passes values, making copies on assignment, or these values can be pointers, in which case the copy is of a pointer, which is practically a reference.</p>\n\n<p>So let's say we have </p>\n\n<pre><code>type Foo struct {\n   Bar string\n}\n</code></pre>\n\n<p>if we make a map of values, i.e.</p>\n\n<pre><code>m := map[string]Foo{}\n</code></pre>\n\n<p>then map accesses return a copy of a Foo, or a zero valued Foo:</p>\n\n<pre><code>m[\"x\"] = Foo{\"hello\"}\n\ny := m[\"x\"]\n</code></pre>\n\n<p><code>y</code> is now a different object than what's in the map, so changing its <code>Bar</code> won't affect the object in the map.</p>\n\n<p>But, if we make the map a map of pointers:</p>\n\n<pre><code>m := map[string]*Foo{}\n</code></pre>\n\n<p>and then access it:</p>\n\n<pre><code>m[\"x\"] = &amp;Foo{\"bar\"}\ny := m[\"x\"]\n</code></pre>\n\n<p>y is now a pointer to the same object as in the map. We can change its <code>Bar</code> and it will affect the map:</p>\n\n<pre><code>y.Bar = \"wat\"\nfmt.Println(m[\"x\"].Bar)\n\n// Will print \"wat\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MAoa2ALEjY\" rel=\"noreferrer\">Playground example.</a></p>\n"}], "owner": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 624, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1486542241, "creation_date": 1486540288, "question_id": 42107477, "link": "https://stackoverflow.com/questions/42107477/go-map-lookup-returns-copy-of-the-element", "title": "Go map lookup returns copy of the element?", "body": "<p>It seems like Go's map lookup returns a copy of the element. Can't seem to find this described in the language spec. I wrote a <a href=\"https://play.golang.org/p/jjlLo6WGUv\" rel=\"nofollow noreferrer\">program</a> as below:</p>\n\n<p>type T struct { n int }</p>\n\n<pre><code>m := make(map[string]T)\nt := T{123}\nm[\"123\"] = t\nt0 := m[\"123\"]\nt1 := m[\"123\"]\nt0.n = 456\nt1.n = 789\nfmt.Println(t, t0, t1)\n</code></pre>\n\n<p>I got the output as: {123} {456} {789}. Looks like every time a copy of the element is returned?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 2, "creation_date": 1486540201, "post_id": 42106534, "comment_id": 71383866, "body": "Refrase your problem. Hard to understand."}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 1, "creation_date": 1486541352, "post_id": 42106534, "comment_id": 71384425, "body": "Check your imports. I&#39;ve had cases where the IDE (IntelliJ or similar) had decided it knows better what to import &quot;on the fly&quot; and so I ended up with having imported absolutely wrong packages..."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486546559, "post_id": 42106534, "comment_id": 71387639, "body": "Here aliases would be handy :-)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486558795, "post_id": 42106534, "comment_id": 71396192, "body": "You should not import libraries with vendor directories. You need to move the vendored packages into your project. Any of the vendoring tools can do this for you."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1486568817, "post_id": 42106534, "comment_id": 71403522, "body": "@Volker: this particular case is where aliases actually shouldn&#39;t be used (i.e. docker should not create an alias for its vendored copy of x/net/context). The type mismatch is because of a library dependency which has a vendor directory. &quot;Library&quot; packages with a vendor directory have to be address specifically if you share any transitive dependencies. Hopefully there will be a consensus on dependency management tools soon, and this can be better documented. Though if you need to use the stdlib <code>context</code> and <code>x&#47;net&#47;context</code>, that is going to be painful without type aliases :/"}, {"owner": {"reputation": 45, "user_id": 404524, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c14eb006f0d30a0e53d17b5ba5314a36?s=128&d=identicon&r=PG", "display_name": "rohit singh", "link": "https://stackoverflow.com/users/404524/rohit-singh"}, "edited": false, "score": 0, "creation_date": 1486616927, "post_id": 42106534, "comment_id": 71424708, "body": "Agree with Jim, I have tried aliasing also , but it gives an error saying that using vendor library is not allowed. &quot;golang.org/x/net/context&quot;, . One thing which i tried was renaming the  context directory of docker and it worked. But wonder if this is the right approach"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486656782, "post_id": 42106534, "comment_id": 71449318, "body": "@rohitsingh: no the right approach is to properly vendor the package. Because you&#39;re using the docker package as a dependency, and it is vendoring dependencies itself, it requires you to use the same technique."}], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 6583697, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/199f4621c63498fa92211505a29e1104?s=128&d=identicon&r=PG&f=1", "display_name": "A B", "link": "https://stackoverflow.com/users/6583697/a-b"}, "is_accepted": false, "score": -1, "last_activity_date": 1486547009, "creation_date": 1486547009, "answer_id": 42109562, "question_id": 42106534, "link": "https://stackoverflow.com/questions/42106534/recieving-following-error/42109562#42109562", "title": "Recieving following error", "body": "<p>Two options I can think of:</p>\n\n<ol>\n<li><p>Add an alias for the context import, e.g. </p>\n\n<p>goContext golang.org/x/net/context\ndocContext github.com/docker/docker/vendor/golang.org/x/net/context</p></li>\n<li><p>Break the context dependencies into two files, or packages</p></li>\n</ol>\n"}], "owner": {"reputation": 45, "user_id": 404524, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/c14eb006f0d30a0e53d17b5ba5314a36?s=128&d=identicon&r=PG", "display_name": "rohit singh", "link": "https://stackoverflow.com/users/404524/rohit-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1486547009, "creation_date": 1486536750, "last_edit_date": 1486543428, "question_id": 42106534, "link": "https://stackoverflow.com/questions/42106534/recieving-following-error", "title": "Recieving following error", "body": "<p>I am recieving an error while compilation. </p>\n\n<p>Root cause is the file has import of <code>context</code> package, but however during compilation <code>github.com/docker/docker/vendor/golang.org/x/net/context</code> is getting referred a, any pointers on as how to make it to refer to <code>context</code> import instead of docker's <code>vendor</code> package</p>\n\n<p>Summarizing the issue, \nimport in the file is as follows</p>\n\n<pre><code>import \"golang.org/x/net/context\"\n</code></pre>\n\n<p>there is a method call which takes context object as an argument, however, there are two repositories which have context , </p>\n\n<ul>\n<li>golang.org/x/net/context</li>\n<li>github.com/docker/docker/vendor/golang.org/x/net/context</li>\n</ul>\n\n<p>During compilation based on length go is selecting the 2 repository. But method needs the 1st one  golang.org/x/net/context. hence the type error in code snippet is recieved</p>\n\n<pre><code>    \"-X main.version=dev-49-gc8cc01b -X main.commit=c8cc01b -X     main.branch=master\" ./...\n github.com/influxdata/telegraf/plugins/inputs/docker\n plugins/inputs/docker/docker.go:103: cannot use c (type *client.Client) as     type DockerClient in assignment:\n    *client.Client does not implement DockerClient (wrong type for  ContainerList method)\n            have ContainerList(\"github.com/docker/docker/vendor/golang.org/x/net/context\".Context, types.ContainerListOptions) ([]types.Container, error)\n            want ContainerList(\"context\".Context, types.ContainerListOptions) ([]types.Container, error) make: *** [build] Error 2  sh-4.2# vi plugins/inputs/docker/docker.go\n</code></pre>\n"}, {"tags": ["go", "ssh", "x509"], "answers": [{"comments": [{"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1486617651, "post_id": 42117261, "comment_id": 71424912, "body": "Awesome. Thank you very much!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 10, "last_activity_date": 1486567988, "creation_date": 1486567988, "answer_id": 42117261, "question_id": 42105432, "link": "https://stackoverflow.com/questions/42105432/how-to-use-an-encrypted-private-key-with-golang-ssh/42117261#42117261", "title": "How to use an encrypted private key with golang ssh", "body": "<p>If you have the DER block with an RSA private key, you use <code>x509.ParsePKCS1PrivateKey</code> to parse the key, and <code>ssh.NewSignerFromKey</code> to get the <code>ssh.Signer</code></p>\n\n<pre><code>key, err := x509.ParsePKCS1PrivateKey(der)\nif err != nil {\n    log.Fatal(err)\n}\nsigner := ssh.NewSignerFromKey(key)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "edited": false, "score": 1, "creation_date": 1500552034, "post_id": 44248679, "comment_id": 77394043, "body": "I&#39;d change the hardcoded {Type: &quot;RSA PRIVATE KEY&quot;, ...} to {Type: block.Type, ...} because this code snippet will accidentally change the PEM block type if the input block is not of type &quot;RSA PRIVATE KEY&quot;."}, {"owner": {"reputation": 71, "user_id": 3774173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5393979f0ffd732bf3f28955d1f7e114?s=128&d=identicon&r=PG&f=1", "display_name": "Madis", "link": "https://stackoverflow.com/users/3774173/madis"}, "reply_to_user": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "edited": false, "score": 1, "creation_date": 1500974937, "post_id": 44248679, "comment_id": 77559861, "body": "Thanks! Made changes to the answer."}], "tags": [], "owner": {"reputation": 71, "user_id": 3774173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5393979f0ffd732bf3f28955d1f7e114?s=128&d=identicon&r=PG&f=1", "display_name": "Madis", "link": "https://stackoverflow.com/users/3774173/madis"}, "is_accepted": false, "score": 7, "last_activity_date": 1500974770, "last_edit_date": 1500974770, "creation_date": 1496083052, "answer_id": 44248679, "question_id": 42105432, "link": "https://stackoverflow.com/questions/42105432/how-to-use-an-encrypted-private-key-with-golang-ssh/44248679#44248679", "title": "How to use an encrypted private key with golang ssh", "body": "<p>I'm just going to provide an alternative here, which allows to reuse the <code>ssh.ParsePrivateKey(key)</code>. I've modified the <code>decrypt</code> function to decrypt and encode the private key, if it is encrypted, and return it, so that the returned <code>key</code> can be used directly in <code>ssh.ParsePrivateKey(key)</code>. It utilizes <code>pem.EncodeToMemory</code> to get the key from decrypted PEM block.</p>\n\n<pre><code>func decrypt(key []byte, password []byte) []byte {\n    block, rest := pem.Decode(key)\n    if len(rest) &gt; 0 {\n        log.Fatalf(\"Extra data included in key\")\n    }\n\n    if x509.IsEncryptedPEMBlock(block) {\n        der, err := x509.DecryptPEMBlock(block, password)\n        if err != nil {\n            log.Fatalf(\"Decrypt failed: %v\", err)\n        }\n        return pem.EncodeToMemory(&amp;pem.Block{Type: block.Type, Bytes: der})\n    }\n    return key\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1188, "user_id": 2690448, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0037da493fb4842d30effa9a9e76860?s=128&d=identicon&r=PG&f=1", "display_name": "jaeheung", "link": "https://stackoverflow.com/users/2690448/jaeheung"}, "edited": false, "score": 0, "creation_date": 1529106038, "post_id": 50833593, "comment_id": 88769620, "body": "Maybe ParsePrivateKeyWithPassphrase() is a new addition to the package. This works if you use the correct package name &quot;ssh&quot; instead of &quot;ssh2&quot;."}], "tags": [], "owner": {"reputation": 131, "user_id": 8023505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1099679696c99f4f76ca273ae6abc96a?s=128&d=identicon&r=PG&f=1", "display_name": "\u0141ukasz", "link": "https://stackoverflow.com/users/8023505/%c5%81ukasz"}, "is_accepted": false, "score": 13, "last_activity_date": 1529220206, "last_edit_date": 1529220206, "creation_date": 1528881747, "answer_id": 50833593, "question_id": 42105432, "link": "https://stackoverflow.com/questions/42105432/how-to-use-an-encrypted-private-key-with-golang-ssh/50833593#50833593", "title": "How to use an encrypted private key with golang ssh", "body": "<pre><code>import \"golang.org/x/crypto/ssh\"\n</code></pre>\n\n<p>With unencrypted key:</p>\n\n<pre><code>signer, err := ssh.ParsePrivateKey(key)\n</code></pre>\n\n<p>With encrypted key:</p>\n\n<pre><code>signer, err := ssh.ParsePrivateKeyWithPassphrase(key, []byte(\"password\"))\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>config := &amp;ssh.ClientConfig{\n    User: username,\n    Auth: []ssh.AuthMethod{\n        ssh.PublicKeys(signer),\n    },\n}\n</code></pre>\n"}], "owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10853, "favorite_count": 5, "accepted_answer_id": 42117261, "answer_count": 3, "score": 15, "last_activity_date": 1529220206, "creation_date": 1486531964, "question_id": 42105432, "link": "https://stackoverflow.com/questions/42105432/how-to-use-an-encrypted-private-key-with-golang-ssh", "title": "How to use an encrypted private key with golang ssh", "body": "<p>I would appreciate pointers because I cannot work out how to decrypt an encrypted key in order to use it with golang ssh. I'm attempting to mash together two other sources of code (including <a href=\"http://kukuruku.co/hub/golang/ssh-commands-execution-on-hundreds-of-servers-via-go\" rel=\"noreferrer\">this</a> one) but unable to get this to work.</p>\n\n<p>I think I'm getting to a DER but need to marshall this back to PEM in order to use it with crypto/ssh</p>\n\n<pre><code>-----BEGIN RSA PRIVATE KEY-----\nProc-Type: 4,ENCRYPTED\nDEK-Info: AES-128-CBC,D7C72273BE168626E5B2D1BC72E56326\n...\n-----END RSA PRIVATE KEY-----\n</code></pre>\n\n<p>I read it:</p>\n\n<pre><code>key, err := ioutil.ReadFile(privateKey)\nif err != nil {\n    log.Fatalf(\"Unable to read private key: %v\", err)\n}\n</code></pre>\n\n<p>With an unencrypted (!) key, I can then:</p>\n\n<pre><code>signer, err := ssh.ParsePrivateKey(key)\nif err != nil {\n    log.Fatalf(\"Unable to parse private key: %v\", err)\n}\n\nconfig := &amp;ssh.ClientConfig{\n    User: username,\n    Auth: []ssh.AuthMethod{\n        ssh.PublicKeys(signer),\n    },\n}\n</code></pre>\n\n<p>And this would work.</p>\n\n<p>I reused some code that I think gets me the decrypted PEM as a DER:</p>\n\n<pre><code>func decrypt(key []byte, password []byte) []byte {\n    block, rest := pem.Decode(key)\n    if len(rest) &gt; 0 {\n        log.Fatalf(\"Extra data included in key\")\n    }\n    der, err := x509.DecryptPEMBlock(block, password)\n    if err != nil {\n        log.Fatalf(\"Decrypt failed: %v\", err)\n    }\n    return der\n}\n</code></pre>\n\n<p>But, how do I get from the DER to a signer?</p>\n\n<p>Or, what's the best way to solve this?</p>\n"}, {"tags": ["unit-testing", "testing", "go"], "comments": [{"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 3, "creation_date": 1486543841, "post_id": 42104451, "comment_id": 71385819, "body": "What are the obstacles you came across? What is the error?"}, {"owner": {"reputation": 1907, "user_id": 3625843, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sXmwj.png?s=128&g=1", "display_name": "Evan Conrad", "link": "https://stackoverflow.com/users/3625843/evan-conrad"}, "reply_to_user": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1486587205, "post_id": 42104451, "comment_id": 71414830, "body": "The error will break my test, but I would like my test to pass when it errors."}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "edited": false, "score": 0, "creation_date": 1486588195, "post_id": 42104451, "comment_id": 71415394, "body": "It seems you want something that is not supported by the test tool. I don&#39;t think you are going to achieve it."}], "answers": [{"tags": [], "owner": {"reputation": 1907, "user_id": 3625843, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sXmwj.png?s=128&g=1", "display_name": "Evan Conrad", "link": "https://stackoverflow.com/users/3625843/evan-conrad"}, "is_accepted": true, "score": 1, "last_activity_date": 1486596577, "creation_date": 1486596577, "answer_id": 42125568, "question_id": 42104451, "link": "https://stackoverflow.com/questions/42104451/how-do-i-test-gos-testing-package-functions/42125568#42125568", "title": "How do I test Go&#39;s &quot;testing&quot; package functions?", "body": "<p>I figured it out! </p>\n\n<p>I just needed to create a separate instance of <code>testing.T</code>. </p>\n\n<pre><code>func TestIsShwifty(t *testing.T) {\n  newT := testing.T{}\n  IsShwifty(newT)\n  if newT.Failed() == false {\n    t.Error(\"Test should have failed\")\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 1907, "user_id": 3625843, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sXmwj.png?s=128&g=1", "display_name": "Evan Conrad", "link": "https://stackoverflow.com/users/3625843/evan-conrad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 42125568, "answer_count": 1, "score": 1, "last_activity_date": 1486596663, "creation_date": 1486526432, "last_edit_date": 1486596663, "question_id": 42104451, "link": "https://stackoverflow.com/questions/42104451/how-do-i-test-gos-testing-package-functions", "title": "How do I test Go&#39;s &quot;testing&quot; package functions?", "body": "<p>I'm writing a library of testing utility functions and I would like them to be themselves tested. </p>\n\n<p>An example of one such function is:</p>\n\n<pre><code>func IsShwifty(t *testing.T, foo string) bool {\n    result, err := bar.MyFunction(string)\n    if err != nil {\n      t.Error(\"Failed to get shwifty: \" + foo, err)\n    }\n    return result == \"shwifty\"\n}\n</code></pre>\n\n<p>I would like to write a <code>TestIsShwifty</code> that feeds in something to make <code>MyFunction</code> return an error and then make <code>t.Error</code>. Then, I want to have the <code>TestIsShwifty</code> pass with something like:</p>\n\n<pre><code>func TestIsShwifty(t *testing.T) {\n  if doesError(t, IsShwifty(t)) == false {\n    t.Error(\"Oh know! We didn't error!\")\n  }\n}\n</code></pre>\n\n<p>Is this possible in Go? </p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1486534040, "post_id": 42104348, "comment_id": 71380928, "body": "will race-detector help? <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">blog.golang.org/race-detector</a>"}, {"owner": {"reputation": 47, "user_id": 7165868, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh6.googleusercontent.com/-5pCTSdM2SPY/AAAAAAAAAAI/AAAAAAAAABE/svWvDoyQc0Q/photo.jpg?sz=128", "display_name": "Bling", "link": "https://stackoverflow.com/users/7165868/bling"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1486535321, "post_id": 42104348, "comment_id": 71381450, "body": "Thanks for your help. I build kube-apiserver with -race option and then run it, nothing happened, there isn&#39;t &quot;DATA RACE&quot; bla bla."}, {"owner": {"reputation": 47, "user_id": 7165868, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh6.googleusercontent.com/-5pCTSdM2SPY/AAAAAAAAAAI/AAAAAAAAABE/svWvDoyQc0Q/photo.jpg?sz=128", "display_name": "Bling", "link": "https://stackoverflow.com/users/7165868/bling"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1486535935, "post_id": 42104348, "comment_id": 71381734, "body": "\u201cBecause of its design, the race detector can detect race conditions only when they are actually triggered by running code, which means it&#39;s important to run race-enabled binaries under realistic workloads.\u201d Sorry to note that just now.  That panic just happened once in our &quot;performance test env&quot; and not easily to reproduce."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1486540775, "post_id": 42104348, "comment_id": 71384131, "body": "I guess there is some bug in <code>glog</code> implementation."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1486541163, "post_id": 42104348, "comment_id": 71384331, "body": "And a <code>fatal error</code> is not a panic. panic controls the flow, but fatal make executable crash."}, {"owner": {"reputation": 47, "user_id": 7165868, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh6.googleusercontent.com/-5pCTSdM2SPY/AAAAAAAAAAI/AAAAAAAAABE/svWvDoyQc0Q/photo.jpg?sz=128", "display_name": "Bling", "link": "https://stackoverflow.com/users/7165868/bling"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1486541945, "post_id": 42104348, "comment_id": 71384734, "body": "so &quot;map concurrent read and write&quot; can&#39;t be recovered ?"}, {"owner": {"reputation": 47, "user_id": 7165868, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh6.googleusercontent.com/-5pCTSdM2SPY/AAAAAAAAAAI/AAAAAAAAABE/svWvDoyQc0Q/photo.jpg?sz=128", "display_name": "Bling", "link": "https://stackoverflow.com/users/7165868/bling"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1486544443, "post_id": 42104348, "comment_id": 71386187, "body": "write a sample code with recover and concurrent map read and write, find that &quot;concurrent map read and map write&quot; can not be recovered."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 7165868, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh6.googleusercontent.com/-5pCTSdM2SPY/AAAAAAAAAAI/AAAAAAAAABE/svWvDoyQc0Q/photo.jpg?sz=128", "display_name": "Bling", "link": "https://stackoverflow.com/users/7165868/bling"}, "edited": false, "score": 0, "creation_date": 1486709845, "post_id": 42148017, "comment_id": 71472502, "body": "Thanks for your help. But In global timeout handler, when timeout happens, it doesn&#39;t read or change request header. And the place where &quot;concurrent map read write&quot; happened just have &quot;read&quot; operation."}, {"owner": {"reputation": 47, "user_id": 7165868, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh6.googleusercontent.com/-5pCTSdM2SPY/AAAAAAAAAAI/AAAAAAAAABE/svWvDoyQc0Q/photo.jpg?sz=128", "display_name": "Bling", "link": "https://stackoverflow.com/users/7165868/bling"}, "edited": false, "score": 0, "creation_date": 1486710371, "post_id": 42148017, "comment_id": 71472721, "body": "In resthandler.go, i add self-defined header to request when work on it.   req.Request.Header[&quot;Detailed-Method&quot;] = []string{&quot;GET-&quot; + scope.Resource.Resource}  It&#39;s for Operational convenience, because the method printed in log is http-standard instead of k8s standard. But i don&#39;t think that is the reason(they are in serial).   And maybe i shouldn&#39;t change request in handler, it might cause trivial problems."}], "tags": [], "owner": {"reputation": 399, "user_id": 3935563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c13653d8c738e8fb478d4142af59d0b?s=128&d=identicon&r=PG&f=1", "display_name": "lavalamp", "link": "https://stackoverflow.com/users/3935563/lavalamp"}, "is_accepted": false, "score": 0, "last_activity_date": 1486679055, "creation_date": 1486679055, "answer_id": 42148017, "question_id": 42104348, "link": "https://stackoverflow.com/questions/42104348/golang-request-header-concurrent-read-and-write/42148017#42148017", "title": "golang request header concurrent read and write", "body": "<p>My guess is that you've stepped on the fact that the global timeout handler can't actually stop the goroutines working on the request. So when the connection times out (1m unless you've changed it), it returns an error. If the goroutine actually completes at the same time, it could also attempt to write to the connection. I thought we had added a lock to prevent this from causing a problem, but perhaps the headers are not always protected by the lock. If you can reproduce this in a clean source tree, then please file an issue at the Kubernetes github repo.</p>\n"}], "owner": {"reputation": 47, "user_id": 7165868, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh6.googleusercontent.com/-5pCTSdM2SPY/AAAAAAAAAAI/AAAAAAAAABE/svWvDoyQc0Q/photo.jpg?sz=128", "display_name": "Bling", "link": "https://stackoverflow.com/users/7165868/bling"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1090, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486679055, "creation_date": 1486525754, "last_edit_date": 1592644375, "question_id": 42104348, "link": "https://stackoverflow.com/questions/42104348/golang-request-header-concurrent-read-and-write", "title": "golang request header concurrent read and write", "body": "<p><strong>Go env:</strong></p>\n<blockquote>\n<p>GOARCH=&quot;amd64&quot;</p>\n<p>GOBIN=&quot;/root/&quot;</p>\n<p>GOEXE=&quot;&quot;</p>\n<p>GOHOSTARCH=&quot;amd64&quot;</p>\n<p>GOHOSTOS=&quot;linux&quot;</p>\n<p>GOOS=&quot;linux&quot;</p>\n<p>GOPATH=&quot;/data/workspace/kubernetes&quot;</p>\n<p>GORACE=&quot;&quot;</p>\n<p>GOROOT=&quot;/usr/local/go&quot;</p>\n<p>GOTOOLDIR=&quot;/usr/local/go/pkg/tool/linux_amd64&quot;</p>\n<p>GO15VENDOREXPERIMENT=&quot;1&quot;</p>\n<p>CC=&quot;gcc&quot;</p>\n<p>GOGCCFLAGS=&quot;-fPIC -m64 -pthread -fmessage-length=0&quot;</p>\n<p>CXX=&quot;g++&quot;</p>\n<p>CGO_ENABLED=&quot;1&quot;</p>\n</blockquote>\n<p><strong>Go version:</strong></p>\n<blockquote>\n<p>go version go1.6.3 linux/amd64</p>\n</blockquote>\n<p>This issues is happend on a \u201cperformance test env\u201d kube-apiserver with high load. kube-apiserver panic and exit:</p>\n<pre><code>fatal error: concurrent map read and map write\n\ngoroutine 77930636 [running]:\nruntime.throw(0x2f4c4c0, 0x21)\n    /root/.gvm/gos/go1.6.3/src/runtime/panic.go:547 +0x90 fp=0xca67b477f0     sp=0xca67b477d8\nruntime.mapaccess1_faststr(0x2a8e520, 0xc9e29000f0, 0x2c11220, 0xa, 0x433e360)\n    /root/.gvm/gos/go1.6.3/src/runtime/hashmap_fast.go:202 +0x5b fp=0xca67b47850 sp=0xca67b477f0\nk8s.io/kubernetes/pkg/httplog.(*respLogger).Log(0xcbddf2ae70)\n       /data/gerrit/src/k8s.io/kubernetes/_output/local/go/src/k8s.io/kubernetes/pkg/httplog/log.go:180 +0x43d fp=0xca67b47af8 sp=0xca67b47850\nk8s.io/kubernetes/pkg/apiserver.RecoverPanics.func1(0x7f099f157090, 0xcbddf2ae70, 0xcd7569e380)\n     /data/gerrit/src/k8s.io/kubernetes/_output/local/go/src/k8s.io/kubernetes/pkg/apiserver/handlers.go:174 +0x15d fp=0xca67b47b50 sp=0xca67b47af8\n    net/http.HandlerFunc.ServeHTTP(0xc821a4eac0, 0x7f099f157058, 0xca0f4eb450, 0xcd7569e380)\n    /root/.gvm/gos/go1.6.3/src/net/http/server.go:1618 +0x3a fp=0xca67b47b70 sp=0xca67b47b50\nnet/http.serverHandler.ServeHTTP(0xc8215a7b80, 0x7f099f157058, 0xca0f4eb450, 0xcd7569e380)\n    /root/.gvm/gos/go1.6.3/src/net/http/server.go:2081 +0x19e fp=0xca67b47bd0 sp=0xca67b47b70\nnet/http.(*conn).serve(0xc8b5d6b980)\n    /root/.gvm/gos/go1.6.3/src/net/http/server.go:1472 +0xf2e fp=0xca67b47f98 sp=0xca67b47bd0\nruntime.goexit()\n    /root/.gvm/gos/go1.6.3/src/runtime/asm_amd64.s:1998 +0x1 fp=0xca67b47fa0 sp=0xca67b47f98\ncreated by net/http.(*Server).Serve\n    /root/.gvm/gos/go1.6.3/src/net/http/server.go:2137 +0x44e\n</code></pre>\n<p>corresponding source code:</p>\n<p>pkg/apiserver/handlers.go</p>\n<pre><code>145 func RecoverPanics(handler http.Handler) http.Handler {\n146 return http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n147 defer func() {\n148     if x := recover(); x != nil {\n149         http.Error(w, &quot;apis panic. Look in log for details.&quot;, http.StatusInternalServerError)\n150         glog.Errorf(&quot;APIServer panic'd on %v %v: %v\\n%s\\n&quot;, req.Method, req.RequestURI, x, debug.Stack())\n151     }\n152 }()\n153 defer httplog.NewLogged(req, &amp;w).StacktraceWhen(\n        httplog.StatusIsNot(\n            http.StatusOK,\n            http.StatusCreated,\n            http.StatusAccepted,\n            http.StatusBadRequest,\n            http.StatusMovedPermanently,\n            http.StatusTemporaryRedirect,\n            http.StatusConflict,\n            http.StatusNotFound,\n            http.StatusUnauthorized,\n            http.StatusForbidden,\n            errors.StatusUnprocessableEntity,\n            http.StatusSwitchingProtocols,\n            http.StatusRequestTimeout,\n            errors.StatusTooManyRequests,\n        ),\n170 ).Log()\n\n    // Dispatch to the internal handler\n    handler.ServeHTTP(w, req)\n174 })\n}\n</code></pre>\n<p>pkg/httplog/log.go:</p>\n<pre><code>159 func (rl *respLogger) Log() {\n160 latency := time.Since(rl.startTime)\n161 if glog.V(2) {\n162     extraInfo := &quot;&quot;\n163     if latency &gt;= time.Millisecond*200 &amp;&amp; latency &lt; time.Second {\n        extraInfo = fmt.Sprintf(&quot;%d00.Millisecond&quot;, latency/(time.Millisecond*100))\n    } else if latency &gt;= time.Second &amp;&amp; latency &lt; time.Minute { // Warning\n        extraInfo = fmt.Sprintf(&quot;%d.Second&quot;, latency/(time.Second))\n    } else if latency &gt;= time.Minute { // nce will timeout\n        extraInfo = fmt.Sprintf(&quot;%d.Minutes&quot;, latency/(time.Minute))\n    }\n    method := rl.req.Method\n    if len(rl.req.Header[&quot;Detailed-Method&quot;]) &gt; 0 {\n        method = rl.req.Header[&quot;Detailed-Method&quot;][0]\n    }\n\n    remoteIP := rl.getXForwardIPAdress(rl.req)\n\n\n    if !rl.hijacked {\n        //glog.InfoDepth(1, fmt.Sprintf(&quot;%s %s: (%v) %v%v%v [%s %s]&quot;, rl.req.Method, rl.req.RequestURI, latency, rl.status, rl.statusStack, rl.addedInfo, rl.req.Header[&quot;User-Agent&quot;], rl.req.RemoteAddr))\n180         glog.InfoDepth(1, fmt.Sprintf(&quot;%v %s %s: (%sms) %v%v [%s %s]-%s %v&quot;, rl.req.Header[&quot;X-Requestid&quot;], method, rl.req.RequestURI, GetMilliLatency(latency), rl.status, rl.addedInfo, rl.req.Header[&quot;User-Agent&quot;], remoteIP, extraInfo, rl.statusStack))\n    } else {\n        //glog.InfoDepth(1, fmt.Sprintf(&quot;%s %s: (%v) hijacked [%s %s]&quot;, rl.req.Method, rl.req.RequestURI, latency, rl.req.Header[&quot;User-Agent&quot;], rl.req.RemoteAddr))\n        glog.InfoDepth(1, fmt.Sprintf(&quot;%v %s %s: (%sms) hijacked [%s %s]-%s&quot;, rl.req.Header[&quot;X-Requestid&quot;], method, rl.req.RequestURI, GetMilliLatency(latency), rl.req.Header[&quot;User-Agent&quot;], remoteIP, extraInfo))\n    }\n}\n</code></pre>\n<p>}</p>\n<p>In handler.ServeHTTP, I changed request.Header. I cann't find the reason:</p>\n<p>(1) &quot;serveHTTP&quot; and &quot;defer log&quot; works in a serial manner. So  not exist &quot;concurrent read and write&quot;</p>\n<p>(2) Even if exist &quot;concurrent read and write&quot;, there exist &quot;recover&quot; func to deal with panics, so the kube-apiserver shoud  not exit.</p>\n<p>The question has cost me lots of time, who can help me? Thanks</p>\n"}, {"tags": ["arrays", "go", "slice"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "edited": false, "score": 0, "creation_date": 1486521566, "post_id": 42103693, "comment_id": 71377312, "body": "Even though there are only 2 arguments in the creation of the struct, I still have to put a comma after MultiLogicAdapter? wow, it worked, but it&#39;s strange"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1486521898, "post_id": 42103693, "comment_id": 71377400, "body": "You should probably run your code through <code>gofmt</code> or <code>goimports</code>, either of which will catch these things and reformat your code to match the standard. It&#39;s useful to set your editor to automatically do that whenever you save a Go file."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 1, "last_activity_date": 1486521568, "last_edit_date": 1486521568, "creation_date": 1486521396, "answer_id": 42103693, "question_id": 42103654, "link": "https://stackoverflow.com/questions/42103654/no-anonymous-array-in-go/42103693#42103693", "title": "No anonymous array in go?", "body": "<p>You just need a comma at the end of <code>&amp;ExampleAdapter{0.8}</code> and after the closing braces that end the other elements.. Go syntax is pretty strict. If you don't have the closing brace on the same line, you need to end the line with a comma, even if it's the last element. That's what the error message is saying. Your code should look like this:</p>\n\n<pre><code>bot := ChatterBot{\n    \"Charlie\",\n    MultiLogicAdapter{\n        []LogicAdapter{\n            &amp;ExampleAdapter{0.9},\n            &amp;ExampleAdapter{0.8},\n        },\n    },\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1338, "favorite_count": 0, "accepted_answer_id": 42103693, "answer_count": 1, "score": -2, "last_activity_date": 1486521568, "creation_date": 1486521066, "question_id": 42103654, "link": "https://stackoverflow.com/questions/42103654/no-anonymous-array-in-go", "title": "No anonymous array in go?", "body": "<p>Instead of doing:</p>\n\n<pre><code>var adapters[]LogicAdapter\nadapter1 := &amp;ExampleAdapter{0.9}\nadapter2 := &amp;ExampleAdapter{0.8}\nadapters = append(adapters, adapter1, adapter2)\nbot := ChatterBot{\"Charlie\", MultiLogicAdapter{adapters}}\n</code></pre>\n\n<p>I tried:</p>\n\n<pre><code>bot := ChatterBot{\n    \"Charlie\", \n    MultiLogicAdapter{\n        []LogicAdapter{\n            &amp;ExampleAdapter{0.9},\n            &amp;ExampleAdapter{0.8}\n        }\n    }\n}\n</code></pre>\n\n<p>But why this won't work? I cannot see any problems with the syntax, it's like I were creating a new slice and putting it into there. Here are the errors:</p>\n\n<pre><code>./main.go:16: syntax error: unexpected semicolon or newline, expecting comma or }\n./main.go:21: syntax error: unexpected semicolon or newline, expecting comma or }\n./main.go:22: syntax error: unexpected semicolon or newline, expecting comma or }\n</code></pre>\n"}, {"tags": ["go", "phantomjs", "agouti"], "owner": {"reputation": 21, "user_id": 3800614, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41f7e32b3c1c5203ac320b38316816d3?s=128&d=identicon&r=PG&f=1", "display_name": "hagetak", "link": "https://stackoverflow.com/users/3800614/hagetak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 741, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1486521869, "creation_date": 1486518215, "last_edit_date": 1486521869, "question_id": 42103238, "link": "https://stackoverflow.com/questions/42103238/how-can-i-active-javascript-use-golang-phantomjsagouti", "title": "How can i active Javascript? Use golang, PhantomJS(agouti)", "body": "<p>How can i active Javascript? Use golang, PhantomJS(agouti).</p>\n\n<p>Hi.</p>\n\n<p>I'm scraping (eg. hulu.com) to use golang and phantomjs(use: <a href=\"https://github.com/sclevine/agouti\" rel=\"nofollow noreferrer\">https://github.com/sclevine/agouti</a>). \nBut, PhantomJS is blocking Javascript.</p>\n\n<p>How can i active Javascipt?</p>\n\n<p>Please tell me.</p>\n\nExample Code\n\n<pre><code>// main.go\npackage main\n\nimport (\n    \"github.com/sclevine/agouti\"\n    \"log\"\n)\n\n// Exclude =&gt; Exception handling\nfunc main() {\n\n    driver := agouti.PhantomJS()\n    driver.Start();\n\n    page, _ := driver.NewPage()\n\n    page.Navigate(\"http://www.hulu.jp/24\")\n\n    log.Println(page.HTML())\n}\n</code></pre>\n\n<blockquote>\n  <p>go run main.go</p>\n</blockquote>\n\n<p>Include Text => 'It appears that software on your computer is blocking JavaScript.  To enjoy Hulu.com, you'll need to enable JavaScript in your web browser.  Please configure your security software or browser plugins to allow Hulu.com to load JavaScript.'</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 4498, "user_id": 58768, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9bbffd2d873441279b4661070e8add4b?s=128&d=identicon&r=PG", "display_name": "bohdan_trotsenko", "link": "https://stackoverflow.com/users/58768/bohdan-trotsenko"}, "edited": false, "score": 1, "creation_date": 1520346190, "post_id": 42102496, "comment_id": 85270714, "body": "as a sidenote: mind the default 4MiB limit"}, {"owner": {"reputation": 125, "user_id": 1204922, "user_type": "registered", "profile_image": "https://graph.facebook.com/1753268600/picture?type=large", "display_name": "Sougata Pal", "link": "https://stackoverflow.com/users/1204922/sougata-pal"}, "edited": false, "score": 0, "creation_date": 1614671509, "post_id": 42102496, "comment_id": 117448981, "body": "For gRPC, i generally use <a href=\"https://grpc.techunits.com/\" rel=\"nofollow noreferrer\">grpc.techunits.com</a> and sConnector for my interfaces. sConnector is not yet fully fetaured and good to start I think."}], "answers": [{"comments": [{"owner": {"reputation": 34200, "user_id": 995862, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d5efb6c1054808f7a79aaefbc64cce76?s=128&d=identicon&r=PG", "display_name": "Kurt Peek", "link": "https://stackoverflow.com/users/995862/kurt-peek"}, "edited": false, "score": 3, "creation_date": 1595365538, "post_id": 42102497, "comment_id": 111448405, "body": "Incidentally, instead of defining <code>port</code> and <code>address</code> variables, you can also leave the port empty, like <code>net.Listen(&quot;tcp&quot;, &quot;:&quot;)</code>, and use <code>lis.Addr().String()</code> to get the automatically chosen address (cf. <a href=\"https://godoc.org/net#Listen\" rel=\"nofollow noreferrer\">godoc.org/net#Listen</a>). This precludes the test failing because the address is already in use."}], "tags": [], "owner": {"reputation": 6681, "user_id": 1691515, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/f7184d0e8d258b9552d0f69a9cff699d?s=128&d=identicon&r=PG", "display_name": "joscas", "link": "https://stackoverflow.com/users/1691515/joscas"}, "is_accepted": false, "score": 12, "last_activity_date": 1486513349, "creation_date": 1486513349, "answer_id": 42102497, "question_id": 42102496, "link": "https://stackoverflow.com/questions/42102496/testing-a-grpc-service/42102497#42102497", "title": "Testing a gRPC service", "body": "<p>I came up with the following implementation which may not be the best way of doing it. Mainly using the <code>TestMain</code> function to spin up the server using a <em>goroutine</em> like that:</p>\n\n<pre><code>const (\n    port = \":50051\"\n)\n\nfunc Server() {\n    lis, err := net.Listen(\"tcp\", port)\n    if err != nil {\n        log.Fatalf(\"failed to listen: %v\", err)\n    }\n    s := grpc.NewServer()\n    pb.RegisterGreeterServer(s, &amp;server{})\n    if err := s.Serve(lis); err != nil {\n        log.Fatalf(\"failed to serve: %v\", err)\n    }\n}\nfunc TestMain(m *testing.M) {\n    go Server()\n    os.Exit(m.Run())\n}\n</code></pre>\n\n<p>and then implement the client in the rest of the tests:</p>\n\n<pre><code>func TestMessages(t *testing.T) {\n\n    // Set up a connection to the Server.\n    const address = \"localhost:50051\"\n    conn, err := grpc.Dial(address, grpc.WithInsecure())\n    if err != nil {\n        t.Fatalf(\"did not connect: %v\", err)\n    }\n    defer conn.Close()\n    c := pb.NewGreeterClient(conn)\n\n    // Test SayHello\n    t.Run(\"SayHello\", func(t *testing.T) {\n        name := \"world\"\n        r, err := c.SayHello(context.Background(), &amp;pb.HelloRequest{Name: name})\n        if err != nil {\n            t.Fatalf(\"could not greet: %v\", err)\n        }\n        t.Logf(\"Greeting: %s\", r.Message)\n        if r.Message != \"Hello \"+name {\n            t.Error(\"Expected 'Hello world', got \", r.Message)\n        }\n\n    })\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 573, "user_id": 6328514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yae7F.jpg?s=128&g=1", "display_name": "Lewis Chan", "link": "https://stackoverflow.com/users/6328514/lewis-chan"}, "edited": false, "score": 2, "creation_date": 1563516385, "post_id": 42103776, "comment_id": 100732887, "body": "I don&#39;t think this is good for testing rpc code. We should make the code of rpc client and rpc server all run to verify end-to-end request&amp;response is working."}, {"owner": {"reputation": 3706, "user_id": 4369952, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/0b7dbb42e75923692e28d756ed3a207c?s=128&d=identicon&r=PG&f=1", "display_name": "Kennet Celeste", "link": "https://stackoverflow.com/users/4369952/kennet-celeste"}, "reply_to_user": {"reputation": 573, "user_id": 6328514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yae7F.jpg?s=128&g=1", "display_name": "Lewis Chan", "link": "https://stackoverflow.com/users/6328514/lewis-chan"}, "edited": false, "score": 0, "creation_date": 1596804812, "post_id": 42103776, "comment_id": 111936367, "body": "@LewisChan this is good for running the business logic"}, {"owner": {"reputation": 527, "user_id": 1583519, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Wz2px.jpg?s=128&g=1", "display_name": "Yasser Sinjab", "link": "https://stackoverflow.com/users/1583519/yasser-sinjab"}, "edited": false, "score": 0, "creation_date": 1598448984, "post_id": 42103776, "comment_id": 112462599, "body": "sometimes we need to test service behavior with interceptors"}], "tags": [], "owner": {"reputation": 964, "user_id": 3184079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/819c77c230e755f43bfbbbb87429c046?s=128&d=identicon&r=PG&f=1", "display_name": "Omar", "link": "https://stackoverflow.com/users/3184079/omar"}, "is_accepted": false, "score": 48, "last_activity_date": 1486542239, "last_edit_date": 1486542239, "creation_date": 1486522038, "answer_id": 42103776, "question_id": 42102496, "link": "https://stackoverflow.com/questions/42102496/testing-a-grpc-service/42103776#42103776", "title": "Testing a gRPC service", "body": "<p>If you want to verify that the implementation of the gRPC service does what you expect, then you can just write standard unit tests and ignore networking completely.</p>\n\n<p>For example, make <code>greeter_server_test.go</code>:</p>\n\n<pre><code>func HelloTest(t *testing.T) {\n    s := server{}\n\n    // set up test cases\n    tests := []struct{\n        name string\n        want string\n    } {\n        {\n            name: \"world\",\n            want: \"Hello world\",\n        },\n        {\n            name: \"123\",\n            want: \"Hello 123\",\n        },\n    }\n\n    for _, tt := range tests {\n        req := &amp;pb.HelloRequest{Name: tt.name}\n        resp, err := s.SayHello(context.Background(), req)\n        if err != nil {\n            t.Errorf(\"HelloTest(%v) got unexpected error\")\n        }\n        if resp.Message != tt.want {\n            t.Errorf(\"HelloText(%v)=%v, wanted %v\", tt.name, resp.Message, tt.want)\n        }\n    }\n}\n</code></pre>\n\n<p>I might've messed up the proto syntax a bit doing it from memory, but that's the idea.</p>\n"}, {"tags": [], "owner": {"reputation": 1971, "user_id": 1420881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1dc24f3e9583bd1b318d6d91cf515af?s=128&d=identicon&r=PG", "display_name": "mmccabe", "link": "https://stackoverflow.com/users/1420881/mmccabe"}, "is_accepted": false, "score": 8, "last_activity_date": 1493076253, "creation_date": 1493076253, "answer_id": 43599183, "question_id": 42102496, "link": "https://stackoverflow.com/questions/42102496/testing-a-grpc-service/43599183#43599183", "title": "Testing a gRPC service", "body": "<p>BTW: as a new contributor, I cannot add to comments. So I am adding a new answer here.</p>\n\n<p>I can confirm that the @Omar approach works for testing a non-streaming gRPC service by testing via the interface without a running service.</p>\n\n<p>However this approach will not work for streams. Since gRPC supports bidirectional streams, it is necessary to fire-up the service and connected to it via the network layer to do testing for streams.</p>\n\n<p>The approach that @joscas takes works for gRPC streams (even though the helloworld sample code does not use streams) using a goroutine to start the service. However, I noticed that on Mac OS X 10.11.6 that it does not release the port used by the service consistently when called from a goroutine (As I understand, the service will block the goroutine and perhaps does not exit cleanly). By firing up a separate process for the service to run in, using 'exec.Command', and killing it before finishing, the port is released consistently.</p>\n\n<p>I uploaded a working test file for a gRPC service using streams to github: <a href=\"https://github.com/mmcc007/go/blob/master/examples/route_guide/server/server_test.go\" rel=\"noreferrer\">https://github.com/mmcc007/go/blob/master/examples/route_guide/server/server_test.go</a></p>\n\n<p>You can see the tests running on travis: <a href=\"https://travis-ci.org/mmcc007/go\" rel=\"noreferrer\">https://travis-ci.org/mmcc007/go</a></p>\n\n<p>Please let me know if any suggestions on how to improve testing for gRPC services.</p>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 8180129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43cb2c8b5522bb4c204089347f045133?s=128&d=identicon&r=PG&f=1", "display_name": "Simon B", "link": "https://stackoverflow.com/users/8180129/simon-b"}, "is_accepted": false, "score": 16, "last_activity_date": 1497821307, "creation_date": 1497821307, "answer_id": 44619697, "question_id": 42102496, "link": "https://stackoverflow.com/questions/42102496/testing-a-grpc-service/44619697#44619697", "title": "Testing a gRPC service", "body": "<p>Here is possibly a simpler way of just testing a streaming service. Apologies if there are any typo's as I am adapting this from some running code.</p>\n\n<p>Given the following definition.</p>\n\n<pre><code>rpc ListSites(Filter) returns(stream sites) \n</code></pre>\n\n<p>With the following server side code.</p>\n\n<pre><code>// ListSites ...\nfunc (s *SitesService) ListSites(filter *pb.SiteFilter, stream pb.SitesService_ListSitesServer) error {\n    for _, site := range s.sites {\n        if err := stream.Send(site); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Now all you have to do is mock the <strong>pb.SitesService_ListSitesServer</strong> in your tests file.</p>\n\n<pre><code>type mockSiteService_ListSitesServer struct {\n    grpc.ServerStream\n    Results []*pb.Site\n}\n\nfunc (_m *mockSiteService_ListSitesServer) Send(site *pb.Site) error {\n    _m.Results = append(_m.Results, site)\n    return nil\n}\n</code></pre>\n\n<p>This responds to the <strong>.send</strong> event and records the sent objects in .Results which you can then use in your assert statements.</p>\n\n<p>Finally you call the server code with the mocked immplementation of <strong>pb.SitesService_ListSitesServer</strong>.</p>\n\n<pre><code>func TestListSites(t *testing.T) {\n    s := SiteService.NewSiteService()\n    filter := &amp;pb.SiteFilter{}\n\n    mock := &amp;mockSiteService_ListSitesServer{}\n    s.ListSites(filter, mock)\n\n    assert.Equal(t, 1, len(mock.Results), \"Sites expected to contain 1 item\")\n}\n</code></pre>\n\n<p>No it doesn't test the entire stack but it does allow you to sanity check your server side code without the hassle of running up a full gRPC service either for real or in mock form.</p>\n"}, {"comments": [{"owner": {"reputation": 6681, "user_id": 1691515, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/f7184d0e8d258b9552d0f69a9cff699d?s=128&d=identicon&r=PG", "display_name": "joscas", "link": "https://stackoverflow.com/users/1691515/joscas"}, "edited": false, "score": 2, "creation_date": 1591349683, "post_id": 52080545, "comment_id": 110027829, "body": "Note this package wasn&#39;t available at the time of the question. That&#39;s why @omar &#39;s answer was accepted initially."}], "tags": [], "owner": {"reputation": 1106, "user_id": 2760151, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13c9d0a33e3b3d665f1101bf86e80312?s=128&d=identicon&r=PG&f=1", "display_name": "shiblon", "link": "https://stackoverflow.com/users/2760151/shiblon"}, "is_accepted": true, "score": 86, "last_activity_date": 1584022921, "last_edit_date": 1584022921, "creation_date": 1535554568, "answer_id": 52080545, "question_id": 42102496, "link": "https://stackoverflow.com/questions/42102496/testing-a-grpc-service/52080545#52080545", "title": "Testing a gRPC service", "body": "<p>I think you're looking for the <code>google.golang.org/grpc/test/bufconn</code> package to help you avoid starting up a service with a real port number, but still allowing testing of streaming RPCs.</p>\n\n<pre><code>import \"google.golang.org/grpc/test/bufconn\"\n\nconst bufSize = 1024 * 1024\n\nvar lis *bufconn.Listener\n\nfunc init() {\n    lis = bufconn.Listen(bufSize)\n    s := grpc.NewServer()\n    pb.RegisterGreeterServer(s, &amp;server{})\n    go func() {\n        if err := s.Serve(lis); err != nil {\n            log.Fatalf(\"Server exited with error: %v\", err)\n        }\n    }()\n}\n\nfunc bufDialer(context.Context, string) (net.Conn, error) {\n    return lis.Dial()\n}\n\nfunc TestSayHello(t *testing.T) {\n    ctx := context.Background()\n    conn, err := grpc.DialContext(ctx, \"bufnet\", grpc.WithContextDialer(bufDialer), grpc.WithInsecure())\n    if err != nil {\n        t.Fatalf(\"Failed to dial bufnet: %v\", err)\n    }\n    defer conn.Close()\n    client := pb.NewGreeterClient(conn)\n    resp, err := client.SayHello(ctx, &amp;pb.HelloRequest{\"Dr. Seuss\"})\n    if err != nil {\n        t.Fatalf(\"SayHello failed: %v\", err)\n    }\n    log.Printf(\"Response: %+v\", resp)\n    // Test for output here.\n}\n</code></pre>\n\n<p>The benefit of this approach is that you're still getting network behavior, but over an in-memory connection without using OS-level resources like ports that may or may not clean up quickly. And it allows you to test it the way it's actually used, and it gives you proper streaming behavior.</p>\n\n<p>I don't have a streaming example off the top of my head, but the magic sauce is all above. It gives you all of the expected behaviors of a normal network connection. The trick is setting the WithDialer option as shown, using the bufconn package to create a listener that exposes its own dialer. I use this technique all the time for testing gRPC services and it works great.</p>\n"}, {"tags": [], "owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "is_accepted": false, "score": -1, "last_activity_date": 1539165205, "creation_date": 1539165205, "answer_id": 52737428, "question_id": 42102496, "link": "https://stackoverflow.com/questions/42102496/testing-a-grpc-service/52737428#52737428", "title": "Testing a gRPC service", "body": "<p>you can use <code>karate-grpc</code> to test grpc service, you only need to post your proto jar and grpc server ip/port. <code>karate-grpc</code> build based on karate and polyglot.</p>\n\n<p>One hello-world example:</p>\n\n<pre><code>Feature: grpc helloworld example by grpc dynamic client\n\n  Background:\n    * def Client = Java.type('com.github.thinkerou.karate.GrpcClient')\n    * def client = Client.create('localhost', 50051)\n\n  Scenario: do it\n    * def payload = read('helloworld.json')\n    * def response = client.call('helloworld.Greeter/SayHello', payload)\n    * def response = JSON.parse(response)\n    * print response\n    * match response[0].message == 'Hello thinkerou'\n    * def message = response[0].message\n\n    * def payload = read('again-helloworld.json')\n    * def response = client.call('helloworld.Greeter/AgainSayHello', payload)\n    * def response = JSON.parse(response)\n    * match response[0].details == 'Details Hello thinkerou in BeiJing'\n</code></pre>\n\n<p>About the example of karate-grpc comment:</p>\n\n<p><a href=\"https://i.stack.imgur.com/zUctT.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zUctT.png\" alt=\"enter image description here\"></a></p>\n\n<p>And it will generate beautiful report, like:</p>\n\n<p><a href=\"https://i.stack.imgur.com/d3LBI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/d3LBI.png\" alt=\"enter image description here\"></a></p>\n\n<p>More details please see: <a href=\"https://thinkerou.com/karate-grpc/\" rel=\"nofollow noreferrer\">https://thinkerou.com/karate-grpc/</a></p>\n"}, {"tags": [], "owner": {"reputation": 556, "user_id": 1086679, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b09ea7eb109e638784b24aaaf0f6224c?s=128&d=identicon&r=PG", "display_name": "Liam Williams", "link": "https://stackoverflow.com/users/1086679/liam-williams"}, "is_accepted": false, "score": 11, "last_activity_date": 1550061968, "last_edit_date": 1550061968, "creation_date": 1550061390, "answer_id": 54670356, "question_id": 42102496, "link": "https://stackoverflow.com/questions/42102496/testing-a-grpc-service/54670356#54670356", "title": "Testing a gRPC service", "body": "<p>There are many ways you can choose to test a gRPC service. You may choose to test in different ways depending on the kind of confidence you would like to achieve. Here are three cases that illustrate some common scenarios.</p>\n\n<h1>Case #1: I want to test my business logic</h1>\n\n<p>In this case you are interested in the logic in the service and how it interacts with other components. The best thing to do here is write some unit tests.</p>\n\n<p>There is a good <a href=\"https://blog.alexellis.io/golang-writing-unit-tests/\" rel=\"noreferrer\">introduction to unit testing in Go</a> by Alex Ellis.\n If you need to test interactions then <a href=\"https://github.com/golang/mock\" rel=\"noreferrer\">GoMock</a> is the way to go. Sergey Grebenshchikov wrote a nice <a href=\"https://blog.codecentric.de/en/2017/08/gomock-tutorial/\" rel=\"noreferrer\">GoMock tutorial</a>.</p>\n\n<p>The <a href=\"https://stackoverflow.com/questions/42102496/testing-a-grpc-service/44619697#answer-42103776\">answer from Omar</a> shows how you could approach unit testing this particular <code>SayHello</code> example.</p>\n\n<h1>Case #2: I want to manually test the API of my live service over the wire</h1>\n\n<p>In this case you are interested in doing manually exploratory testing of your API. Typically this is done to explore the implementation, check edge cases and gain confidence that your API behaves as expected.</p>\n\n<p>You will need to:</p>\n\n<ol>\n<li>Start your <a href=\"https://grpc.io/docs/tutorials/basic/go.html#starting-the-server\" rel=\"noreferrer\">gRPC server</a></li>\n<li>Use an over the wire mocking solution to mock any dependencies you have e.g. if your gRPC service under test makes a gRPC call to another service. For example you can use <a href=\"https://trafficparrot.com/tutorials/mocking-and-simulating-grpc.html\" rel=\"noreferrer\">Traffic Parrot</a>.</li>\n<li>Use a gRPC API testing tool. For example you can use a <a href=\"https://github.com/njpatel/grpcc\" rel=\"noreferrer\">gRPC CLI</a>.</li>\n</ol>\n\n<p>Now you can use your mocking solution to simulate real and hypothetical situations while observing the behaviour on the service under test by using the API testing tool.</p>\n\n<h1>Case #3: I want automated over the wire testing of my API</h1>\n\n<p>In this case you are interested in writing automated BDD style acceptance tests that interact with the system under test via the over the wire gRPC API. These tests are expensive to write, run and maintain and should be used sparingly, keeping in mind the <a href=\"https://martinfowler.com/articles/practical-test-pyramid.html\" rel=\"noreferrer\">testing pyramid</a>.</p>\n\n<p>The <a href=\"https://stackoverflow.com/questions/42102496/testing-a-grpc-service/44619697#answer-52737428\">answer from thinkerou</a> shows how you can use <a href=\"https://github.com/thinkerou/karate-grpc\" rel=\"noreferrer\">karate-grpc</a> to write those API tests in Java. You can combine this with the <a href=\"https://trafficparrot.com/documentation/4.4.x/user_guide.html#maven-plugin\" rel=\"noreferrer\">Traffic Parrot Maven plugin</a> to mock any over the wire dependencies.</p>\n"}, {"tags": [], "owner": {"reputation": 478, "user_id": 2317248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b1df05ff6a1868824ebd2a9eced3e67?s=128&d=identicon&r=PG", "display_name": "Alexsandro Souza", "link": "https://stackoverflow.com/users/2317248/alexsandro-souza"}, "is_accepted": false, "score": 0, "last_activity_date": 1596564020, "last_edit_date": 1596564020, "creation_date": 1596562842, "answer_id": 63252323, "question_id": 42102496, "link": "https://stackoverflow.com/questions/42102496/testing-a-grpc-service/63252323#63252323", "title": "Testing a gRPC service", "body": "<p>As a new contributor, I can not comment so I am adding here as an answer.</p>\n<p>The @shiblon answer is the best way to test your service.  I am the maintainer of the <em><a href=\"https://github.com/apssouza22/grpc-production-go/\" rel=\"nofollow noreferrer\">grpc-for-production</a></em> and one of the features is an in processing server which makes it easier to work with bufconn.</p>\n<p>Here one example of testing the greeter service</p>\n<pre><code>var server GrpcInProcessingServer\n\nfunc serverStart() {\n    builder := GrpcInProcessingServerBuilder{}\n    builder.SetUnaryInterceptors(util.GetDefaultUnaryServerInterceptors())\n    server = builder.Build()\n    server.RegisterService(func(server *grpc.Server) {\n        helloworld.RegisterGreeterServer(server, &amp;testdata.MockedService{})\n    })\n    server.Start()\n}\n\n//TestSayHello will test the HelloWorld service using A in memory data transfer instead of the normal networking\nfunc TestSayHello(t *testing.T) {\n    serverStart()\n    ctx := context.Background()\n    clientConn, err := GetInProcessingClientConn(ctx, server.GetListener(), []grpc.DialOption{})\n    if err != nil {\n        t.Fatalf(&quot;Failed to dial bufnet: %v&quot;, err)\n    }\n    defer clientConn.Close()\n    client := helloworld.NewGreeterClient(clientConn)\n    request := &amp;helloworld.HelloRequest{Name: &quot;test&quot;}\n    resp, err := client.SayHello(ctx, request)\n    if err != nil {\n        t.Fatalf(&quot;SayHello failed: %v&quot;, err)\n    }\n    server.Cleanup()\n    clientConn.Close()\n    assert.Equal(t, resp.Message, &quot;This is a mocked service test&quot;)\n}\n</code></pre>\n<p>You can find this example <a href=\"https://github.com/apssouza22/grpc-production-go/blob/master/testing/process_test.go\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 6681, "user_id": 1691515, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/f7184d0e8d258b9552d0f69a9cff699d?s=128&d=identicon&r=PG", "display_name": "joscas", "link": "https://stackoverflow.com/users/1691515/joscas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75166, "favorite_count": 27, "accepted_answer_id": 52080545, "answer_count": 8, "score": 61, "last_activity_date": 1596564020, "creation_date": 1486513349, "question_id": 42102496, "link": "https://stackoverflow.com/questions/42102496/testing-a-grpc-service", "title": "Testing a gRPC service", "body": "<p>I'd like to test a gRPC service written in Go. The example I'm using is the Hello World server example from the <a href=\"https://github.com/grpc/grpc-go/blob/master/examples/helloworld/greeter_server/main.go\" rel=\"noreferrer\">grpc-go repo</a>.</p>\n\n<p>The protobuf definition is as follows:</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage helloworld;\n\n// The greeting service definition.\nservice Greeter {\n  // Sends a greeting\n  rpc SayHello (HelloRequest) returns (HelloReply) {}\n}\n\n// The request message containing the user's name.\nmessage HelloRequest {\n  string name = 1;\n}\n\n// The response message containing the greetings\nmessage HelloReply {\n  string message = 1;\n}\n</code></pre>\n\n<p>And the type in the <code>greeter_server</code> main is:</p>\n\n<pre><code>// server is used to implement helloworld.GreeterServer.\ntype server struct{}\n\n// SayHello implements helloworld.GreeterServer\nfunc (s *server) SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) {\n    return &amp;pb.HelloReply{Message: \"Hello \" + in.Name}, nil\n}\n</code></pre>\n\n<p>I've looked for examples but I couldn't find any on how to implement tests for a gRPC service in Go.</p>\n"}, {"tags": ["go", "gradle", "build.gradle"], "answers": [{"tags": [], "owner": {"reputation": 8652, "user_id": 1667977, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/HwWRy.jpg?s=128&g=1", "display_name": "MartinTeeVarga", "link": "https://stackoverflow.com/users/1667977/martinteevarga"}, "is_accepted": true, "score": 1, "last_activity_date": 1486505579, "creation_date": 1486505579, "answer_id": 42101018, "question_id": 42100482, "link": "https://stackoverflow.com/questions/42100482/global-variable-declaration-on-gradle/42101018#42101018", "title": "Global variable declaration on Gradle", "body": "<p>You can set the environmental property for all tasks of type Exec:</p>\n\n<pre><code>tasks.withType(Exec) {\n    environment 'GOPATH', 'hello'\n}\n\ntask first(type:Exec) {\n    commandLine 'CMD', '/C', 'echo', \"%GOPATH%\"\n}\n\ntask second(type:Exec) {\n    commandLine 'CMD', '/C', 'echo', \"%GOPATH%\"\n}\n</code></pre>\n"}], "owner": {"reputation": 983, "user_id": 1623765, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/c0d6d0a84591bfb64bd401f213b8c88b?s=128&d=identicon&r=PG", "display_name": "Kumaran Senapathy", "link": "https://stackoverflow.com/users/1623765/kumaran-senapathy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "accepted_answer_id": 42101018, "answer_count": 1, "score": 0, "last_activity_date": 1486505579, "creation_date": 1486503473, "question_id": 42100482, "link": "https://stackoverflow.com/questions/42100482/global-variable-declaration-on-gradle", "title": "Global variable declaration on Gradle", "body": "<p>I have a gradle task as follows. Setting the GOPATH before I start the build. When I run the second task, that is runUnitTest and GOPATH is not set inside that block and I see this error \"$GOPATH not set\".</p>\n\n<pre><code>task goBuild(type:Exec) {\n  environment 'GOPATH', projectDir.toString().split(\"/src\")[0]\n  commandLine \"go\", \"build\", \"main.go\"\n}\n\ntask runUnitTest(type:Exec) {\n  dependsOn goBuild\n  commandLine \"go\", \"get\", \"github.com/AlekSi/gocov-xml\"\n  commandLine \"go\", \"test\", \"-v\"\n\n}\n</code></pre>\n\n<p>I can of course, set the GOPATH again inside the second task. But, I am curious on how to have globally set in gradle.</p>\n"}, {"tags": ["go", "ftp", "ftp-client"], "comments": [{"owner": {"reputation": 2682, "user_id": 4072843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tKkUM.jpg?s=128&g=1", "display_name": "Castaglia", "link": "https://stackoverflow.com/users/4072843/castaglia"}, "edited": false, "score": 0, "creation_date": 1486573870, "post_id": 42097737, "comment_id": 71407184, "body": "Is your client reading <i>all</i> of the lines of the multi-line <code>FEAT</code> response?  That fact that the message &quot;error reading response: short response:  EPRT&quot; is logged <i>after</i> sending <code>TYPE I</code> suggests that your client code <i>assumes</i> just a single line FTP response for all commands, which is not the case for <code>FEAT</code>..."}, {"owner": {"reputation": 351, "user_id": 644826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/807ab5edd9c33f669adedfd4aeccb72b?s=128&d=identicon&r=PG", "display_name": "Tony", "link": "https://stackoverflow.com/users/644826/tony"}, "reply_to_user": {"reputation": 2682, "user_id": 4072843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tKkUM.jpg?s=128&g=1", "display_name": "Castaglia", "link": "https://stackoverflow.com/users/4072843/castaglia"}, "edited": false, "score": 0, "creation_date": 1486661786, "post_id": 42097737, "comment_id": 71452729, "body": "Good question.  I&#39;m not sure I have any option to set or anyway to tell the client otherwise.  I&#39;m also not telling it to set the transfer type, as it seems to be inferred when I issue the call to store.  Any ideas on what I could look at to validate or verify this?"}, {"owner": {"reputation": 2682, "user_id": 4072843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tKkUM.jpg?s=128&g=1", "display_name": "Castaglia", "link": "https://stackoverflow.com/users/4072843/castaglia"}, "edited": false, "score": 0, "creation_date": 1486662044, "post_id": 42097737, "comment_id": 71452897, "body": "I just took a look at the <code>goftp</code> client code; I&#39;m not sure it&#39;s <a href=\"https://github.com/secsy/goftp/blob/master/persistent_connection.go#L207\" rel=\"nofollow noreferrer\">doing the right thing</a>; multi-line FTP responses end with &quot;\\r\\n&quot;, not just &quot;\\n&quot;.  Will try to find some time to reproduce this issue locally."}], "owner": {"reputation": 351, "user_id": 644826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/807ab5edd9c33f669adedfd4aeccb72b?s=128&d=identicon&r=PG", "display_name": "Tony", "link": "https://stackoverflow.com/users/644826/tony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 535, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1486493803, "creation_date": 1486493803, "question_id": 42097737, "link": "https://stackoverflow.com/questions/42097737/golang-ftp-eprt-error", "title": "Golang FTP EPRT Error", "body": "<p>I'm currently trying to send a file to an FTP server in Go utilizing the github.com/secsy/goftp library.  I'm able to connect/authenticate against the server without issue, but I'm having trouble sending the file.  There is not much context around the the error that I could find.  I've tried manually forcing the client to use active and passive transfers without any success.  Any ideas?</p>\n\n<pre><code>config := goftp.Config{\n    User:               \"username\",\n    Password:           \"password\",\n    ConnectionsPerHost: 1,\n    Timeout:            10 * time.Second,\n    IPv6Lookup:         false,\n    ActiveTransfers:    false,\n    Logger:             os.Stderr,\n}\n\nclient, err := goftp.DialConfig(config, \"server_hostname:2121\")\nif err != nil {\n    fmt.Println(\"Error connecting to FTP\")\n    fmt.Println(err.Error())\n    os.Exit(1)\n}\n\nuploadFile, err := os.Open(fileLocation)\nif err != nil {\n    fmt.Println(\"Error opening file for FTP\")\n    fmt.Println(err.Error())\n    os.Exit(1)\n}\n\nerr = client.Store(ftpPath, uploadFile)\nif err != nil {\n    fmt.Println(\"Error FTP'ing File\")\n    fmt.Println(err.Error())\n    os.Exit(1)\n}\n</code></pre>\n\n<p>Here are the messages posted from the client:</p>\n\n<pre><code>goftp: 0.000 #1 opening control connection to [server]:2121\ngoftp: 0.056 #1 sending command USER username\ngoftp: 0.084 #1 got 331-User name ok, password required\ngoftp: 0.084 #1 sending command PASS ******\ngoftp: 0.111 #1 got 230-Password ok, continue\ngoftp: 0.112 #1 sending command FEAT\ngoftp: 0.137 #1 got 211-211-Extensions supported:\ngoftp: 0.137 #1 was ready\ngoftp: 0.137 #1 sending command TYPE I\ngoftp: 0.137 #1 error reading response: short response:  EPRT\nError FTP'ing File\nerror reading response: short response:  EPRT\nexit status 1\n</code></pre>\n\n<p>Here are the messages posted from the server:</p>\n\n<pre><code>2017/02/07 13:14:26 3c2634d4f643fe779c9a: Connection Established\n2017/02/07 13:14:26 3c2634d4f643fe779c9a: 220 Welcome to the Go FTP Server\n2017/02/07 13:14:26 3c2634d4f643fe779c9a: USER username\n2017/02/07 13:14:26 3c2634d4f643fe779c9a: 331 User name ok, password required\n2017/02/07 13:14:26 3c2634d4f643fe779c9a: PASS ****\n2017/02/07 13:14:26 3c2634d4f643fe779c9a: 230 Password ok, continue\n2017/02/07 13:14:27 3c2634d4f643fe779c9a: FEAT \n2017/02/07 13:14:27 3c2634d4f643fe779c9a: 211 211-Extensions supported:\n EPRT\n EPSV\n211 END\n2017/02/07 13:14:27 3c2634d4f643fe779c9a: TYPE I\n2017/02/07 13:14:27 3c2634d4f643fe779c9a: 200 Type set to binary\n2017/02/07 13:14:27 3c2634d4f643fe779c9a: Connection Terminated\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "apache-zookeeper"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486517808, "post_id": 42096675, "comment_id": 71376399, "body": "Your referenced solution in java is not actually a mock, but running real instance of Zookeeper. Since Zookeeper is written in Java, the only way doing the same thing in go is maybe using <code>os&#47;exec</code> package to run Zookeeper instance."}], "answers": [{"tags": [], "owner": {"reputation": 479, "user_id": 3394031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96f26b579880b353ee545849404e399a?s=128&d=identicon&r=PG&f=1", "display_name": "Ben Echols", "link": "https://stackoverflow.com/users/3394031/ben-echols"}, "is_accepted": false, "score": 2, "last_activity_date": 1486535162, "creation_date": 1486535162, "answer_id": 42106119, "question_id": 42096675, "link": "https://stackoverflow.com/questions/42096675/how-to-mock-a-zookeeper-server-for-unit-test-in-golang/42106119#42106119", "title": "How to mock a Zookeeper server for unit test in golang?", "body": "<p>I would recommend making the code of yours that calls zookeeper become an interface. </p>\n\n<p>Then during testing you sub in a 'mockZookeeperConn' object that just returns values as though it was really connecting to the server (but the return values are hardcoded)</p>\n"}, {"comments": [{"owner": {"reputation": 1627, "user_id": 2893839, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/A1yFr.jpg?s=128&g=1", "display_name": "Lorenzo Belli", "link": "https://stackoverflow.com/users/2893839/lorenzo-belli"}, "edited": false, "score": 0, "creation_date": 1486569795, "post_id": 42113561, "comment_id": 71404231, "body": "Yep! Thank for the hint. I ended up using this technique to enable automatic zk unit test only when a serve instance is available."}], "tags": [], "owner": {"reputation": 303, "user_id": 2806281, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L34mH.jpg?s=128&g=1", "display_name": "cnby", "link": "https://stackoverflow.com/users/2806281/cnby"}, "is_accepted": false, "score": 0, "last_activity_date": 1486558050, "creation_date": 1486558050, "answer_id": 42113561, "question_id": 42096675, "link": "https://stackoverflow.com/questions/42096675/how-to-mock-a-zookeeper-server-for-unit-test-in-golang/42113561#42113561", "title": "How to mock a Zookeeper server for unit test in golang?", "body": "<p>@Ben Echols 's answer is very good.</p>\n\n<p>As further, you can try \"<a href=\"https://golang.org/pkg/go/build/#hdr-Build_Constraints\" rel=\"nofollow noreferrer\">build constraints</a>\".</p>\n\n<p>You can configure different build tags on real-zk and mock-zk code. </p>\n\n<p>For example, we configure \"product\" for real-zk code and \"mock\" for mock-zk code.</p>\n\n<p>Thus there are two ways to run unittests: </p>\n\n<ul>\n<li><code>go test -tags mock</code> if there isn't a zk env. </li>\n<li><code>go test -tags product</code> if there is an available zk env. </li>\n</ul>\n"}], "owner": {"reputation": 1627, "user_id": 2893839, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/A1yFr.jpg?s=128&g=1", "display_name": "Lorenzo Belli", "link": "https://stackoverflow.com/users/2893839/lorenzo-belli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1122, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1486558050, "creation_date": 1486490039, "last_edit_date": 1495541345, "question_id": 42096675, "link": "https://stackoverflow.com/questions/42096675/how-to-mock-a-zookeeper-server-for-unit-test-in-golang", "title": "How to mock a Zookeeper server for unit test in golang?", "body": "<p>I am using the library <a href=\"https://godoc.org/launchpad.net/gozk/zookeeper\" rel=\"nofollow noreferrer\">gozk</a> to interface my application with a production zookeeper server. I'd like to test that the application create the correct nodes, that they contain the correct content for various cases, and that the DataWatch and NodeWatch are set properly: </p>\n\n<p><strong>i.e.</strong> the application performs exactly what should based on the node and data updates.</p>\n\n<p>Can I have a mock zookeeper server to be created and destroyed during unit tests only, with capability to artificially create new node and set node contents?\nIs there a different way than to manually create a zookeeper server and use it?</p>\n\n<p>A solution already exists for <a href=\"https://stackoverflow.com/questions/9286054/is-it-possible-to-start-a-zookeeper-server-instance-in-process-say-for-unit-tes\">java</a></p>\n"}, {"tags": ["go", "ibm-cloud", "cloud-foundry"], "comments": [{"owner": {"reputation": 20588, "user_id": 1033422, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/I6uGA.png?s=128&g=1", "display_name": "Chris Snow", "link": "https://stackoverflow.com/users/1033422/chris-snow"}, "edited": false, "score": 0, "creation_date": 1486501847, "post_id": 42096526, "comment_id": 71370295, "body": "I&#39;m not familiar with the go library, but it looks like it accepts a Password attribute.  Maybe that should be used instead of Token?"}, {"owner": {"reputation": 14264, "user_id": 4923755, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1sCUT.jpg?s=128&g=1", "display_name": "data_henrik", "link": "https://stackoverflow.com/users/4923755/data-henrik"}, "reply_to_user": {"reputation": 20588, "user_id": 1033422, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/I6uGA.png?s=128&g=1", "display_name": "Chris Snow", "link": "https://stackoverflow.com/users/1033422/chris-snow"}, "edited": false, "score": 0, "creation_date": 1486535378, "post_id": 42096526, "comment_id": 71381478, "body": "Sorry, it is <code>Password</code>, not the token. I had experimented with both to see whether the oauth token could be passed in. I corrected the code above."}], "answers": [{"comments": [{"owner": {"reputation": 14264, "user_id": 4923755, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1sCUT.jpg?s=128&g=1", "display_name": "data_henrik", "link": "https://stackoverflow.com/users/4923755/data-henrik"}, "edited": false, "score": 0, "creation_date": 1486535501, "post_id": 42104902, "comment_id": 71381536, "body": "Assuming that the example works, it will help to understand the flow. I am also looking into trace. However, the real problem would be how to use the <code>go-cfclient</code> library."}, {"owner": {"reputation": 2458, "user_id": 6145796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ITS0u.jpg?s=128&g=1", "display_name": "joe", "link": "https://stackoverflow.com/users/6145796/joe"}, "reply_to_user": {"reputation": 14264, "user_id": 4923755, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1sCUT.jpg?s=128&g=1", "display_name": "data_henrik", "link": "https://stackoverflow.com/users/4923755/data-henrik"}, "edited": false, "score": 0, "creation_date": 1486706773, "post_id": 42104902, "comment_id": 71471168, "body": "Well, from looking at this library, it looks like it&#39;s trying to get the token from <code>https:&#47;&#47;uaa.ng.bluemix.net&#47;oauth&#47;token</code> rather than <code>https:&#47;&#47;login.ng.bluemix.net&#47;UAALoginServerWAR&#47;oauth&#47;token</code> which is the reason why it&#39;s failing authentication."}, {"owner": {"reputation": 14264, "user_id": 4923755, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1sCUT.jpg?s=128&g=1", "display_name": "data_henrik", "link": "https://stackoverflow.com/users/4923755/data-henrik"}, "edited": false, "score": 0, "creation_date": 1486708078, "post_id": 42104902, "comment_id": 71471731, "body": "Yup. That&#39;s what I also found out so far. See here <a href=\"https://github.com/cloudfoundry-community/go-cfclient/issues/32\" rel=\"nofollow noreferrer\">github.com/cloudfoundry-community/go-cfclient/issues/32</a> The question is now why it is using that URI"}], "tags": [], "owner": {"reputation": 2458, "user_id": 6145796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ITS0u.jpg?s=128&g=1", "display_name": "joe", "link": "https://stackoverflow.com/users/6145796/joe"}, "is_accepted": true, "score": 1, "last_activity_date": 1486531509, "last_edit_date": 1486531509, "creation_date": 1486529107, "answer_id": 42104902, "question_id": 42096526, "link": "https://stackoverflow.com/questions/42096526/how-to-log-into-ibm-bluemix-using-rest-api/42104902#42104902", "title": "How to log into IBM Bluemix using REST API?", "body": "<p><a href=\"https://github.com/ibm-bluemix-mobile-services/bluemix-generator/blob/master/modules/bluemix-api-client.js#L34\" rel=\"nofollow noreferrer\">Here is an example</a> of logging into Bluemix using the REST API (in JavaScript).</p>\n\n<p>You make a call to the login endpoint and request a token with your username and password from Bluemix.</p>\n\n<p><a href=\"https://i.stack.imgur.com/Nudnv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Nudnv.png\" alt=\"body of request\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/soSPv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/soSPv.png\" alt=\"headers of request\"></a></p>\n"}], "owner": {"reputation": 14264, "user_id": 4923755, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1sCUT.jpg?s=128&g=1", "display_name": "data_henrik", "link": "https://stackoverflow.com/users/4923755/data-henrik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 537, "favorite_count": 0, "accepted_answer_id": 42104902, "answer_count": 1, "score": 0, "last_activity_date": 1486535321, "creation_date": 1486489564, "last_edit_date": 1486535321, "question_id": 42096526, "link": "https://stackoverflow.com/questions/42096526/how-to-log-into-ibm-bluemix-using-rest-api", "title": "How to log into IBM Bluemix using REST API?", "body": "<p>I am trying to use the Cloud Foundry <a href=\"https://github.com/cloudfoundry-community/go-cfclient\" rel=\"nofollow noreferrer\">go-cfclient</a> to work with IBM Bluemix and the REST API in Go. I already fail with the login process. I am using the following sample code and invoke the program by passing in the Bluemix endpoint \"<a href=\"https://api.ng.bluemix.net\" rel=\"nofollow noreferrer\">https://api.ng.bluemix.net</a>\" and my userid/password info.</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n\n    cfclient \"github.com/cloudfoundry-community/go-cfclient\"\n)\n\nfunc main() {\n    api := flag.String(\"api\", \"\", \"API endpoint\")\n    username := flag.String(\"username\", \"\", \"User name\")\n    password := flag.String(\"password\", \"\", \"password\")\n    help := flag.Bool(\"help\", false, \"help\")\n\n    flag.Parse()\n\n    if *help || len(*api) == 0 || len(*username) == 0 || len(*password) == 0 {\n        flag.Usage()\n        os.Exit(1)\n    }\n\n    config := &amp;cfclient.Config{\n        ApiAddress: *api,\n        Username:   *username,\n        Password:   *password}\n\n    fmt.Println(\"user %v\\n\",*username)\n    var (\n        client *cfclient.Client\n        err    error\n    )\n\n    if client, err = cfclient.NewClient(config); err != nil {\n        panic(err)\n    }\n    fmt.Println(client)\n\n    apps, err := client.ListApps()\n\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(apps)\n}\n</code></pre>\n\n<p>The error returned is:</p>\n\n<blockquote>\n  <p>panic: Error getting token: oauth2: cannot fetch token: 401\n  Unauthorized Response:\n  {\"error\":\"unauthorized\",\"error_description\":\"Bad credentials\"}</p>\n</blockquote>\n\n<p>What information needs to be provided? How can I log into Bluemix using the REST API?</p>\n"}, {"tags": ["unit-testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 303, "user_id": 2806281, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L34mH.jpg?s=128&g=1", "display_name": "cnby", "link": "https://stackoverflow.com/users/2806281/cnby"}, "is_accepted": false, "score": 0, "last_activity_date": 1486560560, "creation_date": 1486560560, "answer_id": 42114474, "question_id": 42096238, "link": "https://stackoverflow.com/questions/42096238/how-can-i-unit-test-that-a-text-will-appear-in-the-center-of-the-screen/42114474#42114474", "title": "How can I unit test that a text will appear in the center of the screen?", "body": "<p>What means \"test\" ? </p>\n\n<p>I think \"test\" need have effect on output of a function. </p>\n\n<p>Your function's output is Stdout, so we need get the output first.</p>\n\n<p>We can do this simply: </p>\n\n<pre><code>func TestCenter(*testing.T) {\n    stdoutBak := os.Stdout\n    r, w, _ := os.Pipe()\n    os.Stdout = w\n\n    Center(\"hello\")\n    w.Close()\n    os.Stdout = stdoutBak\n\n    // Check output as a byte array\n    outstr, _ := ioutil.ReadAll(r)\n    fmt.Printf(\"%s\", outstr)\n}\n</code></pre>\n\n<p>Thus, you can check output format, spelling, etc.</p>\n"}], "owner": {"reputation": 15582, "user_id": 1420625, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wJ6T0.png?s=128&g=1", "display_name": "sensorario", "link": "https://stackoverflow.com/users/1420625/sensorario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486560560, "creation_date": 1486488557, "last_edit_date": 1486497868, "question_id": 42096238, "link": "https://stackoverflow.com/questions/42096238/how-can-i-unit-test-that-a-text-will-appear-in-the-center-of-the-screen", "title": "How can I unit test that a text will appear in the center of the screen?", "body": "<p>This is a little script in go.</p>\n\n<pre><code>package bashutil\n\nimport (\n    \"fmt\"\n    \"github.com/nsf/termbox-go\"\n)\n\nfunc Center(s string) {\n    if err := termbox.Init(); err != nil {\n        panic(err)\n    }\n    w, _ := termbox.Size()\n    termbox.Close()\n    fmt.Printf(\n        fmt.Sprintf(\"%%-%ds\", w/2),\n        fmt.Sprintf(fmt.Sprintf(\"%%%ds\", w/2+len(s)/2), s),\n    )\n}\n</code></pre>\n\n<p>Can I unit test it? How can I test it? I think is a nonsense test a snippet so little. But, ... What if I would test this code? How can I test that an output is equals as I expect?</p>\n\n<p>Can I test that fmt prints something like I expect?</p>\n"}, {"tags": ["json", "node.js", "go", "zeromq"], "comments": [{"owner": {"reputation": 13817, "user_id": 1005215, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/33a92149e35c60382fa24bcc2b20722e?s=128&d=identicon&r=PG", "display_name": "Nehal J Wani", "link": "https://stackoverflow.com/users/1005215/nehal-j-wani"}, "edited": false, "score": 0, "creation_date": 1486490760, "post_id": 42096226, "comment_id": 71364211, "body": "Try <code>goczmq</code>. <a href=\"https://godoc.org/github.com/zeromq/goczmq#Sock.RecvMessage\" rel=\"nofollow noreferrer\">godoc.org/github.com/zeromq/goczmq#Sock.RecvMessage</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "reply_to_user": {"reputation": 13817, "user_id": 1005215, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/33a92149e35c60382fa24bcc2b20722e?s=128&d=identicon&r=PG", "display_name": "Nehal J Wani", "link": "https://stackoverflow.com/users/1005215/nehal-j-wani"}, "edited": false, "score": 0, "creation_date": 1486495824, "post_id": 42096226, "comment_id": 71367051, "body": "@NehalJWani I updated the code, would you mind taking a look?"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "edited": false, "score": 0, "creation_date": 1486506063, "post_id": 42099353, "comment_id": 71372476, "body": "Why you provided the full address for the nodejs but not for the go? Is there any difference? I&#39;m trying tcp://*:5557 for both and I&#39;m gettind address already in use"}, {"owner": {"reputation": 13817, "user_id": 1005215, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/33a92149e35c60382fa24bcc2b20722e?s=128&d=identicon&r=PG", "display_name": "Nehal J Wani", "link": "https://stackoverflow.com/users/1005215/nehal-j-wani"}, "edited": false, "score": 0, "creation_date": 1486529455, "post_id": 42099353, "comment_id": 71379368, "body": "The <code>pull</code> code is going to <i>listen</i> on all interfaces for incoming tcp connections on port 5557, hence: <code>tcp:&#47;&#47;*:5557</code>. The <code>push</code> code is going to  <i>connect</i> to the port 5557 over tcp on a particular interface, in this case being <code>127.0.0.1</code> aka <code>localhost</code>."}], "tags": [], "owner": {"reputation": 13817, "user_id": 1005215, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/33a92149e35c60382fa24bcc2b20722e?s=128&d=identicon&r=PG", "display_name": "Nehal J Wani", "link": "https://stackoverflow.com/users/1005215/nehal-j-wani"}, "is_accepted": true, "score": 0, "last_activity_date": 1486499284, "creation_date": 1486499284, "answer_id": 42099353, "question_id": 42096226, "link": "https://stackoverflow.com/questions/42096226/zeromq-in-go-wont-print-my-json-message-bytes-received-from-pull-socket/42099353#42099353", "title": "ZeroMQ in go won&#39;t print my json message bytes received from PULL socket", "body": "<p>Server in go:</p>\n\n<pre><code>import (\n    \"fmt\"\n    zmq \"gopkg.in/zeromq/goczmq.v4\"\n)\n\nfunc main() {\n    //  Socket to receive messages on\n    receiver, err := zmq.NewPull(\"tcp://*:5557\")\n    if err != nil {\n        panic(err)\n    }\n\n    defer receiver.Destroy()\n\n    //  Process tasks forever\n    for {\n        request, err := receiver.RecvMessage()\n        if err != nil {\n            panic(err)\n        }\n        fmt.Printf(\"Received: '%s'\\n\", request)\n    }\n}\n</code></pre>\n\n<p>Client in Node.js:</p>\n\n<pre><code>var zmq = require('zmq')\n  , sock = zmq.socket('push');\n\nsock.connect('tcp://127.0.0.1:5557');\nsetInterval(function(){\n   console.log('Sending data');\n   sock.send(JSON.stringify({'msg': 'Hi There!'}));\n}, 500);\n</code></pre>\n\n<p>Server Side:</p>\n\n<pre><code>$ go run a.go\nReceived: '[{\"msg\":\"Hi There!\"}]'\nReceived: '[{\"msg\":\"Hi There!\"}]'\n...\n</code></pre>\n\n<p>Client Side:</p>\n\n<pre><code>$ node a.js \nSending data\nSending data\n...\n</code></pre>\n\n<p>RecvMessage Documentation: <a href=\"https://godoc.org/github.com/zeromq/goczmq#Sock.RecvMessage\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/zeromq/goczmq#Sock.RecvMessage</a></p>\n\n<p>Node.js package: <a href=\"https://github.com/JustinTulloss/zeromq.node\" rel=\"nofollow noreferrer\">https://github.com/JustinTulloss/zeromq.node</a></p>\n\n<p>Excellent zmq examples in go: <a href=\"https://github.com/booksbyus/zguide/tree/master/examples/Go\" rel=\"nofollow noreferrer\">https://github.com/booksbyus/zguide/tree/master/examples/Go</a></p>\n\n<p>Nice getting started tutorial: <a href=\"http://taotetek.github.io/oldschool.systems/post/goczmq1/\" rel=\"nofollow noreferrer\">http://taotetek.github.io/oldschool.systems/post/goczmq1/</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "accepted_answer_id": 42099353, "answer_count": 1, "score": 0, "last_activity_date": 1486499284, "creation_date": 1486488541, "last_edit_date": 1486495807, "question_id": 42096226, "link": "https://stackoverflow.com/questions/42096226/zeromq-in-go-wont-print-my-json-message-bytes-received-from-pull-socket", "title": "ZeroMQ in go won&#39;t print my json message bytes received from PULL socket", "body": "<p>I'm trying a simple code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    zmq \"github.com/alecthomas/gozmq\"\n)\n\nfunc main() {\n    context, _ := zmq.NewContext()\n    defer context.Close()\n\n    //  Socket to receive messages on\n    receiver, _ := context.NewSocket(zmq.PULL)\n    defer receiver.Close()\n    receiver.Connect(\"tcp://localhost:5557\")\n\n    //  Process tasks forever\n    for {\n        msgbytes, _ := receiver.Recv(0)\n    fmt.Println(\"received\")\n        fmt.Println(string(msgbytes))\n    }\n}\n</code></pre>\n\n<p>In NodeJS I send messages like this:</p>\n\n<pre><code>console.log(payload);\nsender.send(JSON.stringify(payload));\n</code></pre>\n\n<p>I can see the json in the console, so <code>sender.sen()</code> is actually sending things. Also, the output from the <code>.go</code> program for each payload is:</p>\n\n<pre><code>received\n[]\nreceived\n[]\n</code></pre>\n\n<p>There's no output. I've searched the <a href=\"https://godoc.org/github.com/zeromq/goczmq\" rel=\"nofollow noreferrer\">GoDocs</a> for the <code>Recv</code> method and there's no separation like <code>recv_json, recv_message, etc</code> like in other languages, it's all bytes. So what's happening? I'm sending a string because it's sent as stringfy, right? </p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>As Nehal said below, I changed the import statement to the official rep, and this is the new code:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    zmq \"gopkg.in/zeromq/goczmq.v4\"\n)\n\nfunc main() {\n    //  Socket to receive messages on\n    receiver, _ := zmq.NewPull(\"tcp://*:5557\")\n    defer receiver.Destroy()\n\n    //  Process tasks forever\n    for {\n        request, _ := receiver.RecvMessage()\n    fmt.Println(\"received\")\n        fmt.Println(request)\n    }\n}\n</code></pre>\n\n<p>But this time 'received' isn't even printed, it seems that no message is being received at all</p>\n"}, {"tags": ["html", "go", "pagination"], "answers": [{"comments": [{"owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1486535638, "post_id": 42094374, "comment_id": 71381601, "body": "Yep. Fixed it. Added bound checks."}], "tags": [], "owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "is_accepted": true, "score": 2, "last_activity_date": 1486542695, "last_edit_date": 1486542695, "creation_date": 1486483096, "answer_id": 42094374, "question_id": 42093811, "link": "https://stackoverflow.com/questions/42093811/procedurally-generating-pagination/42094374#42094374", "title": "Procedurally generating pagination", "body": "<p>Break down your problem and you will get it.</p>\n\n<p>What you want is to compute the neighbors.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    pages(8, 2, 13)\n}\n\nfunc pages(n int, around int, count int) {\n    first := n - around\n    if first &lt; 1 {\n        first = 1\n    }\n    last := n + around\n    if last &gt; count {\n        last = count\n    }\n\n    if first &gt; 1 {\n        for i := 1; i &lt;= 2 &amp;&amp; i &lt; first; i++ {\n            fmt.Println(i)\n        }\n        if 3 &lt; first {\n            fmt.Println(\"...\")\n        }\n    }\n\n    for i := first; i &lt;= last; i++ {\n        fmt.Println(i)\n    }\n\n    if last &lt; count {\n        if last &lt;= count-3 {\n            fmt.Println(\"...\")\n        }\n        end := count - 1\n        if end &lt;= last {\n            end = last + 1\n        }\n        for i := end; i &lt;= count; i++ {\n            fmt.Println(i)\n        }\n\n    }\n}\n</code></pre>\n\n<p>Improvement : Make number of \"prefix\" and \"suffix\" pages variable ;-)</p>\n\n<p>See: <a href=\"https://play.golang.org/p/wOOO9GmpNV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wOOO9GmpNV</a></p>\n\n<p>Added a shortened version :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    pages(10, 3, 20)\n}\n\nfunc pages(n int, around int, count int) {\n    var i int\n    for i = 1; i &lt;= 2 &amp;&amp; i&lt;=count; i++ {\n        fmt.Println(i)\n    }\n\n    if i &lt; n-around {\n        fmt.Println(\"...\")\n        i = n - around\n    }\n\n    for ; i &lt;= n+around &amp;&amp; i&lt;=count; i++ {\n        fmt.Println(i)\n    }\n\n    if i &lt; count-1 {\n        fmt.Println(\"...\")\n        i = count - 1\n    }\n\n    for ; i &lt;= count; i++ {\n        fmt.Println(i)\n    }\n}\n</code></pre>\n\n<p>We can easily wrap things around by providing a callback. Note that channels are very slow.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    pages(10, 3, 20, func(i int) {\n        if i &lt; 0 {\n            fmt.Println(\"...\")\n            return\n        }\n        fmt.Println(i)\n    })\n}\n\nfunc pages(n int, around int, count int, render func(int)) {\n    var i int\n    for i = 1; i &lt;= 2 &amp;&amp; i &lt;= count; i++ {\n        render(i)\n    }\n\n    if i &lt; n-around {\n        render(-1)\n        i = n - around\n    }\n\n    for ; i &lt;= n+around &amp;&amp; i &lt;= count; i++ {\n        render(i)\n    }\n\n    if i &lt; count-1 {\n        render(-1)\n        i = count - 1\n    }\n\n    for ; i &lt;= count; i++ {\n        render(i)\n    }\n}\n</code></pre>\n\n<p>Last version (unless bugs) which includes everything :</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\nfunc main() {\n    pages(10, 3, 21,4,4, func(i int) {\n        if i &lt; 0 {\n            fmt.Println(\"...\")\n            return\n        }\n        fmt.Println(i)\n    })\n}\n\nfunc pages(n int, around int, count int,start int, end int, render func(int)) {\n    var i int\n    for i = 1; i &lt;= start &amp;&amp; i &lt;= count; i++ {\n        render(i)\n    }\n\n    if i &lt; n-around {\n        render(-1)\n        i = n - around\n    }\n\n    for ; i &lt;= n+around &amp;&amp; i &lt;= count; i++ {\n        render(i)\n    }\n\n    if i &lt; count-end+1 {\n        render(-1)\n        i = count - end+1\n    }\n\n    for ; i &lt;= count; i++ {\n        render(i)\n    }\n}\n</code></pre>\n\n<p>See: <a href=\"https://play.golang.org/p/KfTORNuHY_\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KfTORNuHY_</a></p>\n\n<p>How good is this ?</p>\n\n<ul>\n<li>Take no more memory than required for parameters and current page.</li>\n<li>Each check is done once.</li>\n<li>It follows what a human would do if asked to write down pagination. (natural logic)</li>\n<li>Caller side only has to focus on rendering of current page or separator.</li>\n<li>Fast ! The bottleneck is the callback.</li>\n</ul>\n\n<p>Note, if an array is needed, one can do it through a closure. Same with channels.</p>\n"}, {"comments": [{"owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486501885, "post_id": 42097269, "comment_id": 71370319, "body": "10 lines gained, &quot;if&quot; in the loops, sort. Was it worth ?"}, {"owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486503206, "post_id": 42097269, "comment_id": 71370992, "body": "And now, only 1 line of difference."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486505743, "post_id": 42097269, "comment_id": 71372307, "body": "@programaths My variant is easier to understand for me (could be it&#39;s just me, but that&#39;s okay). Using sort was just an attempt in an iteration, and it was eliminated without increasing complexity. 2nd, my solution separates the logic that selects page numbers from the logic using it, so it&#39;s more usable. And 3rd, your solution produces wrong output to at least 1 valid input combination (including your 2nd version too). To be able to compare our solutions, first make them working right."}, {"owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486536630, "post_id": 42097269, "comment_id": 71382067, "body": "You didn&#39;t check the first version has it was corrected. Now bound check has been added."}, {"owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486537079, "post_id": 42097269, "comment_id": 71382250, "body": "Also, why create arrays when it&#39;s not needed ? Why double checking ? Plus, the call site has to handle the &quot;...&quot; while it is possible to simplify usage. Add &quot;prefix&quot; param and see."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486542521, "post_id": 42097269, "comment_id": 71385068, "body": "@programaths Yes, the code you included works now, but I was checking it via the provided playground link, which still links to the wrong code.  Producing a slice has the advantage that the client will know in advance how many links it has to render, which may be useful for planning layout."}, {"owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486543004, "post_id": 42097269, "comment_id": 71385328, "body": "I could provide this info though it can be quickly computed. Can you add the extra params ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486543125, "post_id": 42097269, "comment_id": 71385403, "body": "@programaths What extra param? <code>start</code> and <code>end</code>? I used <code>around</code> for that too. Or you mean <code>-1</code> numbers in the result to indicate <code>...</code>?"}, {"owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486543207, "post_id": 42097269, "comment_id": 71385457, "body": "Yes, start and end. You may need to two first and two last and a context of 3 pages around."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486543304, "post_id": 42097269, "comment_id": 71385509, "body": "@programaths For simplicity I&#39;ll leave it as-is, and use <code>around</code> for first and last pages too. If someone needs a different behavior, it can be added and used in the 2nd loop."}, {"owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486543360, "post_id": 42097269, "comment_id": 71385549, "body": "Yep, not that easily though ^^"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486547819, "post_id": 42097269, "comment_id": 71388645, "body": "@programaths Added a variant which takes number of pages at the ends. 0 complexity added."}, {"owner": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486548157, "post_id": 42097269, "comment_id": 71388908, "body": "I guess <code>len(r)+4</code> should read <code>len(r)+2*edge</code> ? (Though it works)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 868, "user_id": 1295333, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/13a79d6225a02815f7fd219fa2c03e3e?s=128&d=identicon&r=PG", "display_name": "programaths", "link": "https://stackoverflow.com/users/1295333/programaths"}, "edited": false, "score": 0, "creation_date": 1486548266, "post_id": 42097269, "comment_id": 71388975, "body": "@programaths Yes, you&#39;re right. Thanks for pointing  that out. (And it works as that number is only the capacity to avoid reallocation.)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1486548222, "last_edit_date": 1486548222, "creation_date": 1486492061, "answer_id": 42097269, "question_id": 42093811, "link": "https://stackoverflow.com/questions/42093811/procedurally-generating-pagination/42097269#42097269", "title": "Procedurally generating pagination", "body": "<p>Here's a short implementation, which returns the page numbers you need to render:</p>\n\n<pre><code>func pages(cur, max, around int) (r []int) {\n    for i := cur - around; i &lt;= cur+around; i++ {\n        if i &gt;= 1 &amp;&amp; i &lt;= max {\n            r = append(r, i)\n        }\n    }\n    for i := 1; i &lt;= around; i++ {\n        if i &lt; cur-around {\n            r = append(r, i)\n        }\n        if max+1-i &gt; cur+around {\n            r = append(r, max+1-i)\n        }\n    }\n    sort.Ints(r)\n    return\n}\n</code></pre>\n\n<p>You need to pass the current page (<code>cur</code>), the max page number (<code>max</code>), and how many neighbors (<code>around</code>) you want to list around current and at the ends of the list</p>\n\n<p>If 2 page numbers next to each other have difference > 1, you also need to render <code>...</code> between them.</p>\n\n<p>Testing it:</p>\n\n<pre><code>fmt.Println(pages(1, 1, 2))\nfmt.Println(pages(1, 2, 2))\nfmt.Println(pages(1, 3, 2))\nfmt.Println(pages(1, 4, 2))\nfmt.Println(pages(1, 5, 2))\nfmt.Println(pages(1, 9, 3))\nfmt.Println(pages(25, 201, 2))\n\nps := pages(25, 201, 3)\nfor i, page := range ps {\n    if i &gt; 0 &amp;&amp; ps[i-1]+1 &lt; page {\n        fmt.Print(\"... \")\n    }\n    fmt.Print(page, \" \")\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/b4ANxqpvOR\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[1]\n[1 2]\n[1 2 3]\n[1 2 3 4]\n[1 2 3 4 5]\n[1 2 3 4 7 8 9]\n[1 2 23 24 25 26 27 200 201]\n1 2 3 ... 22 23 24 25 26 27 28 ... 199 200 201 \n</code></pre>\n\n<h3>Eliminating <code>sort.Ints()</code></h3>\n\n<p>The purpose of <code>sort.Ints()</code> is to return page numbers in increasing order. It is needed because the 2nd loop adds numbers out of order.</p>\n\n<p>If we can change it so that the 2nd loop keeps the order, sorting won't be needed anymore.</p>\n\n<p>The 2nd loop is responsible to add page numbers from the ends of the list (beginning and end). Appending end is fine (just have to go upward), and we'll add the beginning to another slice, to which the rest will be appended.</p>\n\n<p>Here it is:</p>\n\n<pre><code>func pages(cur, max, around int) (r []int) {\n    for i := cur - around; i &lt;= cur+around; i++ {\n        if i &gt;= 1 &amp;&amp; i &lt;= max {\n            r = append(r, i)\n        }\n    }\n    r2 := make([]int, 0, len(r)+4)\n    for i := 1; i &lt;= around; i++ {\n        if i &lt; cur-around {\n            r2 = append(r2, i)\n        }\n        if max-around+i &gt; cur+around {\n            r = append(r, max-around+i)\n        }\n    }\n    return append(r2, r...)\n}\n</code></pre>\n\n<p>Testing and output is the same. Try this variant on the <a href=\"https://play.golang.org/p/h0cOTm2Plk\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>Also specifying number of pages at the ends</h3>\n\n<p>If you want different number of pages at the ends, you can add 1 additional parameter and use it with 0 complexity added:</p>\n\n<pre><code>func pages(cur, max, around, edge int) (r []int) {\n    for i := cur - around; i &lt;= cur+around; i++ {\n        if i &gt;= 1 &amp;&amp; i &lt;= max {\n            r = append(r, i)\n        }\n    }\n    r2 := make([]int, 0, len(r)+2*edge)\n    for i := 1; i &lt;= edge; i++ {\n        if i &lt; cur-around {\n            r2 = append(r2, i)\n        }\n        if max-around+i &gt; cur+around {\n            r = append(r, max-around+i)\n        }\n    }\n    return append(r2, r...)\n}\n</code></pre>\n\n<p>Try this variant on the <a href=\"https://play.golang.org/p/1_fDfY0nr5\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 42094374, "answer_count": 2, "score": 2, "last_activity_date": 1486548222, "creation_date": 1486481688, "last_edit_date": 1486482114, "question_id": 42093811, "link": "https://stackoverflow.com/questions/42093811/procedurally-generating-pagination", "title": "Procedurally generating pagination", "body": "<p>I'm trying to create pagination with Go but I'm a bit confused. It's my first time to creating pagination as I used to use laravel's helper class when I was still using PHP.</p>\n\n<p>I tried doing something like:</p>\n\n<pre><code>var totalPages = int(math.Ceil(float64(totalRecords) / float64(recordsPerPage)))\n\nfor i := 0; i &lt; totalPages; i++ {\n    pages[i] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, i+1, limit, i+1)\n}\n</code></pre>\n\n<p>And that shows all the pages, I want to create something that would look like:</p>\n\n<pre><code>&lt; 1 2 ... 20 24 25 26 27 ... 200 201 &gt;\n</code></pre>\n\n<p>25 being current page and 201 being the last page.</p>\n\n<p>I also experimented with something like the following but was quirky on some cases like if the page is close to the start or the end:</p>\n\n<pre><code>// pages[0] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, 1, limit, 1)\n// pages[1] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, 2, limit, 2)\n// pages[2] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, 3, limit, 3)\n// pages[3] = `&lt;li&gt;&lt;a class=\"more\"&gt;&amp;hellip;&lt;/a&gt;&lt;/li&gt;`\n// pages[4] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, page, limit, page)\n// pages[5] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, page+1, limit, page+1)\n// pages[6] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, page+2, limit, page+2)\n// pages[7] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, page+3, limit, page+3)\n// pages[8] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, page+4, limit, page+4)\n// pages[9] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, page+5, limit, page+5)\n// pages[10] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, page+6, limit, page+6)\n// pages[11] = `&lt;li&gt;&lt;a class=\"more\"&gt;&amp;hellip;&lt;/a&gt;&lt;/li&gt;`\n// pages[12] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, totalPages-1, limit, totalPages-1)\n// pages[13] = fmt.Sprintf(`&lt;li&gt;&lt;a href=\"?page=%d&amp;limit=%d\"&gt;%d&lt;/a&gt;&lt;/li&gt;`, totalPages, limit, totalPages)\n</code></pre>\n\n<p>So the question is, how do I achieve this? Is there a library? What is the correct logic?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486481466, "post_id": 42093495, "comment_id": 71357763, "body": "You&#39;re not closing the <code>ch</code> channel"}, {"owner": {"reputation": 1682, "user_id": 1977535, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/NK9Et.jpg?s=128&g=1", "display_name": "firelyu", "link": "https://stackoverflow.com/users/1977535/firelyu"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486492891, "post_id": 42093495, "comment_id": 71365382, "body": "The <code>Walk</code> is recursive. It seems I can&#39;t <code>close(ch)</code> inside <code>Walk</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486493348, "post_id": 42093495, "comment_id": 71365649, "body": "so close it outside of Walk. <a href=\"https://play.golang.org/p/xCWBf9BA6y\" rel=\"nofollow noreferrer\">play.golang.org/p/xCWBf9BA6y</a>"}], "owner": {"reputation": 1682, "user_id": 1977535, "user_type": "registered", "accept_rate": 8, "profile_image": "https://i.stack.imgur.com/NK9Et.jpg?s=128&g=1", "display_name": "firelyu", "link": "https://stackoverflow.com/users/1977535/firelyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "closed_date": 1486481519, "answer_count": 0, "score": 0, "last_activity_date": 1486481552, "creation_date": 1486480883, "question_id": 42093495, "link": "https://stackoverflow.com/questions/42093495/use-range-channel-in-go-error-fatal", "closed_reason": "Duplicate", "title": "Use range channel in go error fatal", "body": "<p>I am coding the <a href=\"https://tour.golang.org/concurrency/8\" rel=\"nofollow noreferrer\">golang tour execise</a>. I can get all the value from channel with <code>for i := 0 i &lt; 10; i++</code>. But get fatal with <code>for v := range</code>.</p>\n\n<pre><code>package main\n\nimport (\n  \"golang.org/x/tour/tree\"\n  \"fmt\"\n)\n\n// Walk walks the tree t sending all values\n// from the tree to the channel ch.\nfunc Walk(t *tree.Tree, ch chan int) {\n  if t.Left != nil {\n    // Walk left tree\n    Walk(t.Left, ch)\n  }\n\n  ch &lt;- t.Value\n\n  if t.Right != nil {\n    // Walk right tree\n    Walk(t.Right, ch)\n  }\n}\n\nfunc main() {\n  ch := make(chan int)\n\n  go Walk(tree.New(5), ch)\n\n  for i := 0; i &lt; 10; i++ {\n    fmt.Println(&lt;-ch)\n  }\n}\n</code></pre>\n\n<p>The output is right. It is 5, 10, 15 ... 50.</p>\n\n<p>When I use the <code>for v := range ch</code>. It error falal.</p>\n\n<pre><code>func main() {\n  ch := make(chan int)\n\n  go Walk(tree.New(5), ch)\n\n  for v := range ch {\n    fmt.Println(v)\n  }\n}\n</code></pre>\n\n<p>The output is the following. I think it is related I don't close the ch.</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\ngoroutine 1 [chan receive]:\nmain.main()\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1486478290, "post_id": 42092420, "comment_id": 71355328, "body": "Probably you completely botch up your GOPATH. /usr/local/go is you Go installation and should <b>never</b> contain any non-stdlib packages, especially not something you &quot;go get&quot;ed. Show <code>go env</code>."}, {"owner": {"reputation": 105, "user_id": 6234785, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f015f58840e153f5a33ccee1bfce4e9b?s=128&d=identicon&r=PG&f=1", "display_name": "Yuri Danilov", "link": "https://stackoverflow.com/users/6234785/yuri-danilov"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486482691, "post_id": 42092420, "comment_id": 71358693, "body": "GOOS=&quot;linux&quot;  GOPATH=&quot;/home/itcoder/go&quot;  GORACE=&quot;&quot; GOROOT=&quot;/usr/local/go&quot; GOTOOLDIR=&quot;/usr/local/go/pkg/tool/linux_amd64&quot;"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1486485886, "post_id": 42092420, "comment_id": 71361092, "body": "Did you do unnecessary <code>sudo</code> stuff? Try deleting /usr/local/go/pkg/linux_amd64 and run <code>go get</code> with the  <code>-v</code> flag."}, {"owner": {"reputation": 105, "user_id": 6234785, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f015f58840e153f5a33ccee1bfce4e9b?s=128&d=identicon&r=PG&f=1", "display_name": "Yuri Danilov", "link": "https://stackoverflow.com/users/6234785/yuri-danilov"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486519493, "post_id": 42092420, "comment_id": 71376820, "body": "It is not helpme.  I running command, but files not created But i Found /go/pkg/linux_amd64/gopkg.in this direcotry if I moved filed to /usr/local/go/pkg/linux_amd64 all ok"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486539834, "post_id": 42092420, "comment_id": 71383690, "body": "Glad to hear you found a solution!"}, {"owner": {"reputation": 105, "user_id": 6234785, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f015f58840e153f5a33ccee1bfce4e9b?s=128&d=identicon&r=PG&f=1", "display_name": "Yuri Danilov", "link": "https://stackoverflow.com/users/6234785/yuri-danilov"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486557624, "post_id": 42092420, "comment_id": 71395392, "body": "Thank you very much"}], "owner": {"reputation": 105, "user_id": 6234785, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f015f58840e153f5a33ccee1bfce4e9b?s=128&d=identicon&r=PG&f=1", "display_name": "Yuri Danilov", "link": "https://stackoverflow.com/users/6234785/yuri-danilov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 118, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1486484827, "creation_date": 1486477886, "last_edit_date": 1486484827, "question_id": 42092420, "link": "https://stackoverflow.com/questions/42092420/install-redis-v5-on-go-1-7-5", "title": "Install redis.v5 on Go 1.7.5", "body": "<p>In my project has dependence \"gopkg.in/redis.v5\"</p>\n\n<p>and I get message:</p>\n\n<pre><code>/usr/local/go/pkg/tool/linux_amd64/link: cannot open file \n\n/usr/local/go/pkg/linux_amd64/gopkg.in/redis.v5.a: open\n/usr/local/go/pkg/linux_amd64/gopkg.in/redis.v5.a: no such file or directory\n</code></pre>\n\n<p>I do command: <code>go get gopkg.in/redis.v5</code></p>\n\n<p>but directory <code>/usr/local/go/pkg/linux_amd64/gopkg.in/</code>is not created:\nWhats is the problem?</p>\n\n<p><strong>updated</strong></p>\n\n<pre><code>GOPATH=\"/home/itcoder/go\"\n\nGOROOT=\"/usr/local/go\"\n\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\n</code></pre>\n"}, {"tags": ["bash", "go", "environment-variables", "sh"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1486478085, "post_id": 42092069, "comment_id": 71355180, "body": "Environment variables are <i>not</i> &quot;get [...] from [...] file&quot;. Never. These are environment variables and if the environment contains the variable than you can access it. You&#39;ll have to make sure your Go executable runs in an environment where TEST_ENV is set. If TEST_ENV is set in your local bash and you execute your Go binary from that bash the environment <i>will</i> be propagated to your binary and you <i>will</i> have access to it. Show how you execute your binary. Note that this problem is totally unrelated to Go: You are simply invoking your binary without a proper environment."}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 3, "last_activity_date": 1486485115, "creation_date": 1486485115, "answer_id": 42095128, "question_id": 42092069, "link": "https://stackoverflow.com/questions/42092069/cant-get-environment-variable-from-etc-profile-in-golang/42095128#42095128", "title": "Can&#39;t get environment variable from /etc/profile in GoLang", "body": "<p>When you set an environment variable in bash, by default it isn't exported. Only exported environment variables are passed along to processes created by the shell (i.e., programs that you run). Try <code>export TEST_ENV=test_me</code>.</p>\n"}], "owner": {"reputation": 1191, "user_id": 4371822, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/1aec2ad8a78096d1e07d02a3b0ea6bc6?s=128&d=identicon&r=PG&f=1", "display_name": "Bence Gedai", "link": "https://stackoverflow.com/users/4371822/bence-gedai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1354, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1510856352, "creation_date": 1486476839, "question_id": 42092069, "link": "https://stackoverflow.com/questions/42092069/cant-get-environment-variable-from-etc-profile-in-golang", "title": "Can&#39;t get environment variable from /etc/profile in GoLang", "body": "<p>I've set some environment variables in /etc/profile, I can access them from bash, but for some reason I cant get them from Go.</p>\n\n<p>/etc/profile:</p>\n\n<pre><code>...\nTEST_ENV=test_me\n</code></pre>\n\n<p>I can access it from bash:</p>\n\n<pre><code>echo $TEST_ENV\ntest_me\n</code></pre>\n\n<p>I can't access this variable from GO</p>\n\n<pre><code>os.Getenv(\"TEST_ENV\") // returns \"\"\n</code></pre>\n\n<p>If I list the available environment variables with</p>\n\n<pre><code>os.Environ()\n</code></pre>\n\n<p>I don't see the variable I'm looking for, but there a few variables that might help:</p>\n\n<pre><code>SHELL=/bin/sh\nUSER=root\nLOGNAME=root\n</code></pre>\n\n<p>I guess my problem is related to different sessions and shells, so I even tried running</p>\n\n<pre><code>exec.Command(\"source /etc/profile\")\n</code></pre>\n\n<p>and get the variables after, but it still returns nothing.</p>\n\n<p>Can you give me some tips how to get environment variables if they're set in /etc/profile? I'd prefer getting them from that file, but if necessary, I can put the variables in a different place as well.</p>\n"}, {"tags": ["api", "unit-testing", "go", "automated-tests"], "comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1486480803, "post_id": 42091720, "comment_id": 71357266, "body": "Keep reading about GoLang&#39;s stdlib testing: <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/httptest</a>"}], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 7237151, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-aLbPAfiyZho/AAAAAAAAAAI/AAAAAAAAAcM/yvNR0N9JjBg/photo.jpg?sz=128", "display_name": "Spikey", "link": "https://stackoverflow.com/users/7237151/spikey"}, "edited": false, "score": 1, "creation_date": 1486560673, "post_id": 42102492, "comment_id": 71397521, "body": "Niko - it sounds like you are saying that the Golang built-in testing package is sufficient/robust/and easy enough for all types of tests and that I have no use in looking at any other solutions?"}, {"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "reply_to_user": {"reputation": 315, "user_id": 7237151, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-aLbPAfiyZho/AAAAAAAAAAI/AAAAAAAAAcM/yvNR0N9JjBg/photo.jpg?sz=128", "display_name": "Spikey", "link": "https://stackoverflow.com/users/7237151/spikey"}, "edited": false, "score": 0, "creation_date": 1486650934, "post_id": 42102492, "comment_id": 71444998, "body": "Yes - it has worked well for me as far as API testing is concerned."}, {"owner": {"reputation": 5127, "user_id": 1253025, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/fc95a5a827a781f1924c3f5e88b23278?s=128&d=identicon&r=PG", "display_name": "Renra", "link": "https://stackoverflow.com/users/1253025/renra"}, "edited": false, "score": 2, "creation_date": 1551169747, "post_id": 42102492, "comment_id": 96531549, "body": "Testing handlers is fine, but that does not test that the handlers are actually used by the final application, nor does it test that the routing works well."}, {"owner": {"reputation": 2345, "user_id": 1459079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6affa4807c0ffe5466edb2ad3458c8e1?s=128&d=identicon&r=PG", "display_name": "Marcello Romani", "link": "https://stackoverflow.com/users/1459079/marcello-romani"}, "edited": false, "score": 1, "creation_date": 1551865243, "post_id": 42102492, "comment_id": 96793281, "body": "While I found this answer interesting, I&#39;d argue that testing the handler can be conveniently bypassed by structuring the API-called code in so that the handler itself is just a very tiny integration layer. The actual code will be unit tested the usual way."}], "tags": [], "owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "is_accepted": false, "score": 5, "last_activity_date": 1486513333, "creation_date": 1486513333, "answer_id": 42102492, "question_id": 42091720, "link": "https://stackoverflow.com/questions/42091720/api-testing-in-golang/42102492#42102492", "title": "API Testing In Golang", "body": "<p>I agree with the comment by @eduncan911. More specifically you can design your API with testing in mind by making sure that your handlers accept an</p>\n\n<pre><code>http.ResponseWriter\n</code></pre>\n\n<p>as a parameter in addition to the appropriate request. At that point you will be set to declare a new request:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"http://example.com\", nil)\n</code></pre>\n\n<p>as well as a new httptest recorder:</p>\n\n<pre><code>recorder := httptest.NewRecorder()\n</code></pre>\n\n<p>and then issue the new test request to your handler:</p>\n\n<pre><code>yourHandler(recorder, req)\n</code></pre>\n\n<p>so that you can finally check for errors/etc. in the recorder:</p>\n\n<pre><code>if recorder.Code != 200 {\n  //do something\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 306, "user_id": 9993851, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lN_nkSZvtuE/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2lPYQvVpp_KL6ABn5tRJArw2u-YQ/mo/photo.jpg?sz=128", "display_name": "Nikta Jn", "link": "https://stackoverflow.com/users/9993851/nikta-jn"}, "is_accepted": false, "score": 2, "last_activity_date": 1530184302, "last_edit_date": 1530184302, "creation_date": 1530181319, "answer_id": 51080425, "question_id": 42091720, "link": "https://stackoverflow.com/questions/42091720/api-testing-in-golang/51080425#51080425", "title": "API Testing In Golang", "body": "<p>For making a dummy request, you have to first initialise the router and then set the server and after that make request.\n    Steps to be follow:</p>\n\n<pre><code>1. router := mux.NewRouter() //initialise the router\n2. testServer := httptest.NewServer(router) //setup the testing server\n3. request,error := http.NewRequest(\"METHOD\",\"URL\",Body)\n4. // We create a ResponseRecorder (which satisfies http.ResponseWriter) to record the response.\n        resp := httptest.NewRecorder()\n5. handler := http.HandlerFunc(functionname)\n// Our handlers satisfy http.Handler, so we can call their ServeHTTP method\n// directly and pass in our Request and ResponseRecorder.\n        handler.ServeHTTP(resp, req)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2828, "user_id": 158119, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c45b21d940a6c5b78da7205268b60604?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/158119/tom"}, "is_accepted": false, "score": 0, "last_activity_date": 1555426226, "creation_date": 1555426226, "answer_id": 55711007, "question_id": 42091720, "link": "https://stackoverflow.com/questions/42091720/api-testing-in-golang/55711007#55711007", "title": "API Testing In Golang", "body": "<p>I use smartystreets goconvey and assertions packages regularly. While the stdlib offers most everything you need, one thing I think it lacks is \"quality of life\" features.</p>\n\n<p>The goconvey package will provide you with a nice web browser interface with hot reload. Everytime you update, it re-runs. You can also selectively choose what runs. So I typically open another console with it running which pops open a browser tab, as I code. It also makes looking at code coverage easy and convenient.</p>\n\n<p>Organizing and nesting your test cases is also made easy and then renders nicely in your web browser.</p>\n\n<p>Then of course the assertions package just provides you with some shortcuts.</p>\n\n<p>What I've found is that this saves a lot of boilerplate and time. I'd be writing all the same stuff for each project otherwise.</p>\n\n<p>It also makes your tests more consistent. If you have a library of assertions and tools, you will reach for one there first before building a custom pattern that you then deviate from in another test. It's not hard to end up with messy, hard to read tests.</p>\n\n<p>There's other packages that help with testing APIs and HTTP requests as well. So like others said, you can do it from scratch, or you can use a package that takes care of the boilerplate. It could leave your tests shorter and cleaner.</p>\n\n<p>So \"what kind of tests?\" All of them pretty much in my experience. I've always benefitted from other packages. Though the important thing to keep in mind is that all this is still built on top of the already awesome testing available in Golang. One reason why I like Golang over other languages is because it has most everything baked in already. I'm not bolting on something that's missing, I'm simply enhancing it for my work flow and preferences. Then the next person who comes along to run tests for my package is actually free to use just the CLI of they want. No need to run goconvey in their browser. So the preference parts stay preferential. This is not quite so common elsewhere.</p>\n"}, {"comments": [{"owner": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "edited": false, "score": 0, "creation_date": 1570192400, "post_id": 55752676, "comment_id": 102845874, "body": "Link is invalid"}, {"owner": {"reputation": 529, "user_id": 8915234, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210933076376525/picture?type=large", "display_name": "Cyro Dubeux", "link": "https://stackoverflow.com/users/8915234/cyro-dubeux"}, "reply_to_user": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "edited": false, "score": 1, "creation_date": 1570369246, "post_id": 55752676, "comment_id": 102884354, "body": "Link fixed. You can access now."}], "tags": [], "owner": {"reputation": 529, "user_id": 8915234, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210933076376525/picture?type=large", "display_name": "Cyro Dubeux", "link": "https://stackoverflow.com/users/8915234/cyro-dubeux"}, "is_accepted": false, "score": -1, "last_activity_date": 1614617197, "last_edit_date": 1614617197, "creation_date": 1555616076, "answer_id": 55752676, "question_id": 42091720, "link": "https://stackoverflow.com/questions/42091720/api-testing-in-golang/55752676#55752676", "title": "API Testing In Golang", "body": "<p>Here's how I tested my API: <a href=\"https://github.com/cyruzin/feelthemovies/blob/master/internal/app/controllers/controller_test.go\" rel=\"nofollow noreferrer\">https://github.com/cyruzin/feelthemovies/blob/master/internal/app/controllers/controller_test.go</a>. Digging around I found a interesting func called &quot;func TestMain(m *testing.M) {}&quot; that create a main routine for tests. You can use to setup your dependencies and teardown.</p>\n"}], "owner": {"reputation": 315, "user_id": 7237151, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-aLbPAfiyZho/AAAAAAAAAAI/AAAAAAAAAcM/yvNR0N9JjBg/photo.jpg?sz=128", "display_name": "Spikey", "link": "https://stackoverflow.com/users/7237151/spikey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9901, "favorite_count": 3, "protected_date": 1560927967, "answer_count": 4, "score": 13, "last_activity_date": 1614617197, "creation_date": 1486475872, "question_id": 42091720, "link": "https://stackoverflow.com/questions/42091720/api-testing-in-golang", "title": "API Testing In Golang", "body": "<p>I know that Golang has a <a href=\"https://www.golang-book.com/books/intro/12\" rel=\"noreferrer\">testing package</a> that allows for running unit tests. This seems to work well for internally calling Golang functions for unit tests but it seems that some people were trying to adapt it for <a href=\"http://dennissuratna.com/testing-in-go/\" rel=\"noreferrer\">API testing</a> as well.</p>\n\n<p>Given to the great flexibility of automated testing frameworks like Node.js' Mocha with the Chai assertion library, for what kind of tests does it make sense to use Golang's testing package vs. something else?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["ruby-on-rails", "go", "devise", "bcrypt", "beego"], "comments": [{"owner": {"reputation": 5966, "user_id": 2477691, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DaiPF.jpg?s=128&g=1", "display_name": "chumakoff", "link": "https://stackoverflow.com/users/2477691/chumakoff"}, "edited": false, "score": 0, "creation_date": 1486486073, "post_id": 42090742, "comment_id": 71361238, "body": "What do you exactly want?"}, {"owner": {"reputation": 977, "user_id": 3150093, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4fd13f999326b458f21e8e0b15d0752?s=128&d=identicon&r=PG", "display_name": "kurenn", "link": "https://stackoverflow.com/users/3150093/kurenn"}, "edited": false, "score": 1, "creation_date": 1486490637, "post_id": 42090742, "comment_id": 71364145, "body": "Are you trying to encrypt the password using bcrypt? or you men from a view perspective?"}, {"owner": {"reputation": 4355, "user_id": 1392154, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/61e860048a2e2226ea2726fe3d29451a?s=128&d=identicon&r=PG", "display_name": "Elmor", "link": "https://stackoverflow.com/users/1392154/elmor"}, "edited": false, "score": 0, "creation_date": 1486540690, "post_id": 42090742, "comment_id": 71384103, "body": "I want to check is provided email &amp; password valid on golang side. so  I&#39;ve to encrypt password the same way <code>devise</code>  does it."}], "answers": [{"tags": [], "owner": {"reputation": 4355, "user_id": 1392154, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/61e860048a2e2226ea2726fe3d29451a?s=128&d=identicon&r=PG", "display_name": "Elmor", "link": "https://stackoverflow.com/users/1392154/elmor"}, "is_accepted": true, "score": 1, "last_activity_date": 1486545179, "creation_date": 1486545179, "answer_id": 42108934, "question_id": 42090742, "link": "https://stackoverflow.com/questions/42090742/golang-duplicate-rails-devise-gem-password-encryption/42108934#42108934", "title": "Golang duplicate rails Devise gem password encryption", "body": "<p>I found out <a href=\"https://github.com/consyse/go-devise-encryptor\" rel=\"nofollow noreferrer\">https://github.com/consyse/go-devise-encryptor</a> exactly for doing this task</p>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 5563810, "user_type": "registered", "profile_image": "https://graph.facebook.com/1652363971700300/picture?type=large", "display_name": "Abhishek Chauhan", "link": "https://stackoverflow.com/users/5563810/abhishek-chauhan"}, "is_accepted": false, "score": 0, "last_activity_date": 1582892739, "creation_date": 1582892739, "answer_id": 60451688, "question_id": 42090742, "link": "https://stackoverflow.com/questions/42090742/golang-duplicate-rails-devise-gem-password-encryption/60451688#60451688", "title": "Golang duplicate rails Devise gem password encryption", "body": "<p>This devise encryptor doing same thing as bcrypt auth in golang, also i dont see Rails Devise hash and go-devise-encryptor password hash equal. </p>\n"}], "owner": {"reputation": 4355, "user_id": 1392154, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/61e860048a2e2226ea2726fe3d29451a?s=128&d=identicon&r=PG", "display_name": "Elmor", "link": "https://stackoverflow.com/users/1392154/elmor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 883, "favorite_count": 0, "accepted_answer_id": 42108934, "answer_count": 2, "score": 0, "last_activity_date": 1582892739, "creation_date": 1486473006, "last_edit_date": 1486544653, "question_id": 42090742, "link": "https://stackoverflow.com/questions/42090742/golang-duplicate-rails-devise-gem-password-encryption", "title": "Golang duplicate rails Devise gem password encryption", "body": "<p>I have to authenticate user in a new app which uses <code>Beego</code> framework for <code>Golang</code>, twist is that DB is from Rails application where authentication is implemented using <code>gem Devise</code> .<br>\nI've looked at <code>gem Bcrypt</code> implementation<br>\n <a href=\"https://github.com/codahale/bcrypt-ruby/blob/master/lib/bcrypt/password.rb\" rel=\"nofollow noreferrer\">https://github.com/codahale/bcrypt-ruby/blob/master/lib/bcrypt/password.rb</a><br>\nBut can't  quite grasp how to replicate <code>encrypted_password</code> to validate user...<br>\nCan you please help me ?</p>\n\n<p><strong><em>UPDATE1</em></strong><br>\nusing <code>bcrypt</code>  didn't help</p>\n\n<blockquote>\n  <p>b_password := []byte(password)<br>\n    hashedPassword, err := bcrypt.GenerateFromPassword(b_password, bcrypt.DefaultCost)  </p>\n</blockquote>\n\n<p>I get different passwords.</p>\n"}, {"tags": ["postgresql", "go", "migration", "sqlx"], "comments": [{"owner": {"reputation": 4436, "user_id": 1025130, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/JaQcI.jpg?s=128&g=1", "display_name": "ARIF MAHMUD RANA", "link": "https://stackoverflow.com/users/1025130/arif-mahmud-rana"}, "edited": false, "score": 0, "creation_date": 1486472538, "post_id": 42088562, "comment_id": 71351124, "body": "What is directory structure where is you migration resides?"}, {"owner": {"reputation": 551, "user_id": 1400741, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c5033c88121a8fb1e5e091195fb5a1f7?s=128&d=identicon&r=PG", "display_name": "Arnaud H", "link": "https://stackoverflow.com/users/1400741/arnaud-h"}, "reply_to_user": {"reputation": 4436, "user_id": 1025130, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/JaQcI.jpg?s=128&g=1", "display_name": "ARIF MAHMUD RANA", "link": "https://stackoverflow.com/users/1025130/arif-mahmud-rana"}, "edited": false, "score": 0, "creation_date": 1486478151, "post_id": 42088562, "comment_id": 71355237, "body": "In an empty folder &quot;migrations&quot; within the database folder where the first code snippet resides: app/database/migrations. The schema is in another folder: app/example/model/example.go"}], "answers": [{"comments": [{"owner": {"reputation": 551, "user_id": 1400741, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c5033c88121a8fb1e5e091195fb5a1f7?s=128&d=identicon&r=PG", "display_name": "Arnaud H", "link": "https://stackoverflow.com/users/1400741/arnaud-h"}, "edited": false, "score": 0, "creation_date": 1486478406, "post_id": 42090681, "comment_id": 71355414, "body": "There isn&#39;t an error, that&#39;s the problem. The error reporting works as it had thrown when I had a typo in the database url and it couldn&#39;t find the migrations folder at first. Now it doesn&#39;t have any errors, yet still doesn&#39;t do anything. Aren&#39;t I supposed to declare my schemas to mattes/migrate or something instead so it can keep track of changes?"}], "tags": [], "owner": {"reputation": 4436, "user_id": 1025130, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/JaQcI.jpg?s=128&g=1", "display_name": "ARIF MAHMUD RANA", "link": "https://stackoverflow.com/users/1025130/arif-mahmud-rana"}, "is_accepted": false, "score": 0, "last_activity_date": 1486472833, "creation_date": 1486472833, "answer_id": 42090681, "question_id": 42088562, "link": "https://stackoverflow.com/questions/42088562/how-to-use-mattes-migrate-in-golang/42090681#42090681", "title": "How to use mattes/migrate in golang?", "body": "<p>One suggestion in whenever you code in Golang is to <strong><code>check the errors</code></strong> do it in this way</p>\n\n<pre><code>if allErrors, ok := migrate.UpSync(\"postgres://&lt;my_url_string&gt;\", \"./migrations\"); !ok {\n  fmt.Println(\"Oh no ...\", ok)\n  // do sth with allErrors slice\n}\n</code></pre>\n\n<p>As I don't know what is your error at least in this way you can check what your error is.</p>\n"}], "owner": {"reputation": 551, "user_id": 1400741, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/c5033c88121a8fb1e5e091195fb5a1f7?s=128&d=identicon&r=PG", "display_name": "Arnaud H", "link": "https://stackoverflow.com/users/1400741/arnaud-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3472, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1486478449, "creation_date": 1486466494, "last_edit_date": 1486478449, "question_id": 42088562, "link": "https://stackoverflow.com/questions/42088562/how-to-use-mattes-migrate-in-golang", "title": "How to use mattes/migrate in golang?", "body": "<p>I've been trying to use the <a href=\"https://github.com/mattes/migrate\" rel=\"nofollow noreferrer\" title=\"mattes/migrate\">mattes/migrate</a> package but I can't seem to get it to actually do anything. The database runs on postgres and I interact with it through <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\" title=\"sqlx\">sqlx</a>.</p>\n\n<p>I've gone through the readme on github, and applied the following code:</p>\n\n<pre><code>// use synchronous versions of migration functions ...\nallErrors, ok := migrate.UpSync(\"postgres://&lt;my_url_string&gt;\", \"./app/database/migrations\")\nif !ok {\n  fmt.Println(\"Oh no ...\")\n  // do sth with allErrors slice\n}\n</code></pre>\n\n<p>My schema is initiated like this:</p>\n\n<pre><code>//sqlx's initiated DB is imported in the database package\n\nfunc SyncSchemas() {\n  database.DB.MustExec(schema)\n}\n\nvar schema =\n  `CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n\n   CREATE TABLE IF NOT EXISTS examples (\n     created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT NOW(),\n     deleted_at text DEFAULT NULL,\n     id UUID PRIMARY KEY UNIQUE NOT NULL DEFAULT uuid_generate_v4()\n   );`\n\ntype Example struct {\n  ID            string      `json:\"id\" db:\"id\"`\n  CreatedAt     time.Time   `json:\"created_at\" db:\"created_at\"`\n  DeletedAt     *time.Time  `json:\"deleted_at\" db:\"deleted_at\"` \n}\n</code></pre>\n\n<p>It runs without error, but that's all it seems to be doing at the moment. Shouldn't it keep track of my schemas or something? I previously used <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\" title=\"gorm\">gorm</a> as my ORM, and there I just had to run autoMigrate() on a schema and it automatically created and applied migrations as I changed the schema. I would like the same functionality with mattes/migrate, but I can't seem to find an example or tutorial which shows how to use it.</p>\n\n<p>How am I supposed to do this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 726, "user_id": 171350, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/3e0d9324ffd018b49167dc01bbbf5629?s=128&d=identicon&r=PG", "display_name": "oivoodoo", "link": "https://stackoverflow.com/users/171350/oivoodoo"}, "edited": false, "score": 0, "creation_date": 1486464014, "post_id": 42087504, "comment_id": 71345444, "body": "it would great to have such examples to reproduce using <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">play.golang.org</a> otherwise it would be harder to understand the process."}, {"owner": {"reputation": 84157, "user_id": 238978, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/a633afaf19e6d4bb53ee50b62e3b5397?s=128&d=identicon&r=PG", "display_name": "Emil Vikstr&#246;m", "link": "https://stackoverflow.com/users/238978/emil-vikstr%c3%b6m"}, "edited": false, "score": 0, "creation_date": 1486464434, "post_id": 42087504, "comment_id": 71345682, "body": "Make sure your recursion have a base case and that every recursive call  brings you closer to the base case."}, {"owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "edited": false, "score": 0, "creation_date": 1486464631, "post_id": 42087504, "comment_id": 71345833, "body": "Playground needed."}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 1, "last_activity_date": 1486469195, "last_edit_date": 1486469195, "creation_date": 1486464992, "answer_id": 42088016, "question_id": 42087504, "link": "https://stackoverflow.com/questions/42087504/not-sure-why-this-is-deadlock-in-golang/42088016#42088016", "title": "not sure why this is deadlock in golang?", "body": "<p>Main gorouting is trying to write multiple times to a channel in <code>doSomething</code> function. The <code>read</code> function is reading the channel only once. Therefore the write operation will wait until some other party reads from the channel. This will deadlock as the main goroutine is blocked.</p>\n\n<p>If the blocking operations were not in main goroutine, the program would finish as the Go program ends whenever main goroutine ends. There would be no deadlock if main function could come to an end.</p>\n"}, {"tags": [], "owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "is_accepted": false, "score": 1, "last_activity_date": 1486473018, "last_edit_date": 1486473018, "creation_date": 1486465499, "answer_id": 42088198, "question_id": 42087504, "link": "https://stackoverflow.com/questions/42087504/not-sure-why-this-is-deadlock-in-golang/42088198#42088198", "title": "not sure why this is deadlock in golang?", "body": "<p>You are trying to read from an empty channel because <code>reads</code> executed concurrently and <code>doSomething</code> didn't. It is possible to solve the problem in several ways. Note, it is not about correct architecture or efficient approaches. An examples below solve \"deadlock\" issue of the original snippet, not more.</p>\n\n<p><strong>Read and write concurrently:</strong></p>\n\n<pre><code>package main\n\nfunc doSomething(c chan&lt;- string) { // recursive function does something\n    c &lt;- \"result\"\n    doSomething(c)\n}\n\nfunc reads(c &lt;-chan string) {\n    results := &lt;-c\n    fmt.Println(\"Boo\", results)\n}\n\nfunc main() {\n    c := make(chan string)\n    go reads(c)\n    go doSomething(c) // Write concurrentely\n}\n</code></pre>\n\n<p><strong>Use <code>select</code> to handle channels read operation:</strong></p>\n\n<pre><code>func reads(c &lt;-chan string) {\n    // Use select\n    select {\n    case res := &lt;-c:\n        fmt.Println(\"received message\", res)\n    default:\n        fmt.Println(\"no results received\")\n    }\n}\n</code></pre>\n\n<p><em>I'd rather prefer combination of the first and second approaches.</em></p>\n\n<p><strong>Read after write (it is far from correct design as hell):</strong></p>\n\n<pre><code>func main() {\n    c := make(chan string)\n\n    go doSomething(c)\n    reads(c) // Read after write\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7518125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60d5ebdc13ee6e0222712d637bd17ff6?s=128&d=identicon&r=PG&f=1", "display_name": "milk", "link": "https://stackoverflow.com/users/7518125/milk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 271, "favorite_count": 0, "accepted_answer_id": 42088016, "answer_count": 2, "score": -1, "last_activity_date": 1486473018, "creation_date": 1486463581, "last_edit_date": 1486464366, "question_id": 42087504, "link": "https://stackoverflow.com/questions/42087504/not-sure-why-this-is-deadlock-in-golang", "title": "not sure why this is deadlock in golang?", "body": "<p>i'm new to Go not sure why this is deadlock ? i want to constantly be reading results from doSomething and storing it in the function read without using  a for loop</p>\n\n<pre><code>func doSomething(c chan&lt;- string){ // recursive function does something\n    c &lt;- result \n    return dosomething(c)  }\n\nfunc reads(c &lt;-chan string){\n    results := \"\"   \n    temp := &lt;-c         \n    results = results + \"\\n\" + temp      \n    return results\n}\n\nfunc main(){     \n    go reads(c)\n    doSomething(c)\n}\n</code></pre>\n"}, {"tags": ["file", "go", "tcp", "io", "server"], "answers": [{"tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": true, "score": 1, "last_activity_date": 1486462220, "creation_date": 1486462220, "answer_id": 42087037, "question_id": 42086859, "link": "https://stackoverflow.com/questions/42086859/go-connection-writer-and-reader-not-behaving-properly-reading-2-write-in-one-re/42087037#42087037", "title": "Go connection.Writer and reader not behaving properly, reading 2 write in one read operation", "body": "<p>TCP is a stream protocol. It doesn't have messages. The network is (within some limits we don't need to concern us about) free to send your data one byte at a time or everything at once. And even if you get lucky and the network sends your data in packets like you want them there's nothing that prevents the receive side from concatenating the packets into one buffer.</p>\n\n<p>In other words: there is nothing that will make each <code>Read</code> call return as many bytes as you wrote with some specific <code>Write</code> calls. You sometimes get lucky, sometimes, as you noticed, you don't get lucky. If there are no errors, all the reads you do from the stream will return all the bytes you wrote, that's the only guarantee you have.</p>\n\n<p>You need to define a proper protocol.</p>\n\n<p>This is not related to Go. Every programming language will behave this way.</p>\n"}], "owner": {"reputation": 77, "user_id": 4224311, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1594330aaf87d4790e20873fd53e1172?s=128&d=identicon&r=PG&f=1", "display_name": "vc25", "link": "https://stackoverflow.com/users/4224311/vc25"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 42087037, "answer_count": 1, "score": 0, "last_activity_date": 1486468448, "creation_date": 1486461716, "last_edit_date": 1486468448, "question_id": 42086859, "link": "https://stackoverflow.com/questions/42086859/go-connection-writer-and-reader-not-behaving-properly-reading-2-write-in-one-re", "title": "Go connection.Writer and reader not behaving properly, reading 2 write in one read operation", "body": "<p>I am trying to read a file from client and then send it to server.</p>\n\n<p>It goes like this, you input <code>send &lt;fileName&gt;</code> in the client program, then <code>&lt;fileName&gt;</code> will be sent to server. The server read 2 things from the client via TCP connection, first the command <code>send &lt;fileName&gt;</code> and second the content of the file.</p>\n\n<p>However, sometimes my program will randomly include the file content in the <code>&lt;fileName&gt;</code> string. For example, say I have a text file called xyz.txt, the content of which is \"Hellow world\". The server sometimes receive <code>send xyz.txtHellow world</code>. Sometimes it doesn't and it works just fine.</p>\n\n<p>I think that it is the problem of synchronization or not flushing reader/writer buffer. But I am not quite sure.\nThanks in advance!</p>\n\n<p>Client code:</p>\n\n<pre><code>func sendFileToServer(fileName string, connection net.Conn) {\n\n    fileBuffer := make([]byte, BUFFER_SIZE)\n    var err error\n\n    file, err := os.Open(fileName) // For read access.\n\n    lock := make(chan int)\n    w := bufio.NewWriter(connection)\n\n    go func(){\n        w.Write([]byte(\"send \" + fileName))\n        w.Flush()\n        lock &lt;- 1\n    }()\n\n    &lt;-lock\n    // make a read buffer\n    r := bufio.NewReader(file)\n\n    //read file until there is an error\n    for err == nil || err != io.EOF {\n        //read a chunk\n        n, err := r.Read(fileBuffer)\n        if err != nil &amp;&amp; err != io.EOF {\n            panic(err)\n        }\n        if n == 0 {\n            break\n        }\n        // write a chunk\n        if _, err := w.Write(fileBuffer[:n]); err != nil {\n            panic(err)\n        }\n    }\n    file.Close()\n    connection.Close()\n    fmt.Println(\"Finished sending.\")\n}\n</code></pre>\n\n<p>Server code: (connectionHandler is a goroutine that is invoked for every TCP connection request from client)</p>\n\n<pre><code>func connectionHandler(connection net.Conn, bufferChan chan []byte, stringChan chan string) {\n    buffer := make([]byte, 1024)\n\n    _, error := connection.Read(buffer)\n    if error != nil {\n        fmt.Println(\"There is an error reading from connection\", error.Error())\n        stringChan&lt;-\"failed\"\n        return \n    }\n    fmt.Println(\"command recieved: \" + string(buffer))\n    if(\"-1\"==strings.Trim(string(buffer), \"\\x00\")){\n        stringChan&lt;-\"failed\"\n        return\n    }\n\n    arrayOfCommands := strings.Split(string(buffer),\" \")\n    arrayOfCommands[1] = strings.Replace(arrayOfCommands[1],\"\\n\",\"\",-1)\n    fileName := strings.Trim(arrayOfCommands[1], \"\\x00\")    \n\n    if arrayOfCommands[0] == \"get\" {\n        fmt.Println(\"Sending a file \" + arrayOfCommands[1])\n        sendFileToClient(fileName, connection, bufferChan, stringChan)\n    } else if arrayOfCommands[0] == \"send\" {\n        fmt.Println(\"Getting a file \" + arrayOfCommands[1])\n        getFileFromClient(fileName, connection, bufferChan, stringChan)\n    } else {\n        _, error = connection.Write([]byte(\"bad command\"))\n    }\n    fmt.Println(\"connectionHandler finished\")\n}\n\n\nfunc getFileFromClient(fileName string, connection net.Conn,bufferChan chan []byte, stringChan chan string) { //put the file in memory\n    stringChan&lt;-\"send\"\n    fileBuffer := make([]byte, BUFFER_SIZE)\n\n    var err error\n    r := bufio.NewReader(connection)\n\n    for err == nil || err != io.EOF {\n        //read a chunk\n        n, err := r.Read(fileBuffer)\n        if err != nil &amp;&amp; err != io.EOF {\n            panic(err)\n        }\n        if n == 0 {\n            break\n        }\n        bufferChan&lt;-fileBuffer[:n]\n        stringChan&lt;-fileName\n    }\n\n    connection.Close()\n    return \n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4764, "user_id": 2419922, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/41e095cca8abbfde0f1f52d73a1efcd7?s=128&d=identicon&r=PG", "display_name": "cshu", "link": "https://stackoverflow.com/users/2419922/cshu"}, "edited": false, "score": 2, "creation_date": 1486461111, "post_id": 42086547, "comment_id": 71343453, "body": "remove the <code>[]</code> in <code>var queue []Queue</code>, you&#39;ll still get runtime error though."}], "answers": [{"comments": [{"owner": {"reputation": 1154, "user_id": 2719045, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/hxQo1.jpg?s=128&g=1", "display_name": "bthe0", "link": "https://stackoverflow.com/users/2719045/bthe0"}, "edited": false, "score": 0, "creation_date": 1486461290, "post_id": 42086642, "comment_id": 71343592, "body": "You are right, but now it&#39;s throwing: panic: runtime error: index out of range . I added queue = append(queue, job) and it&#39;s now working with the above modification. Thank you."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 1154, "user_id": 2719045, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/hxQo1.jpg?s=128&g=1", "display_name": "bthe0", "link": "https://stackoverflow.com/users/2719045/bthe0"}, "edited": false, "score": 0, "creation_date": 1486461441, "post_id": 42086642, "comment_id": 71343692, "body": "@TheodorB, quite right, because <code>queue</code> was just created and has no zeroth element. Using <code>append</code> add such element. Have you checked <code>len</code> and <code>cap</code> functions for slice?"}, {"owner": {"reputation": 1154, "user_id": 2719045, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/hxQo1.jpg?s=128&g=1", "display_name": "bthe0", "link": "https://stackoverflow.com/users/2719045/bthe0"}, "edited": false, "score": 0, "creation_date": 1486461556, "post_id": 42086642, "comment_id": 71343776, "body": "Not yet but I will have a look. Thank you once again for the answer."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 3, "last_activity_date": 1486461311, "last_edit_date": 1486461311, "creation_date": 1486461143, "answer_id": 42086642, "question_id": 42086547, "link": "https://stackoverflow.com/questions/42086547/golang-type-array-containing-structs/42086642#42086642", "title": "golang type array containing structs", "body": "<p>I think problem is here:</p>\n\n<pre><code>var queue []Queue\n</code></pre>\n\n<p>Here <code>queue</code> is a slice of <code>Queue</code> or slice of slice of <code>Job</code>. So it's impossible to assign first its element value of <code>Job</code>. </p>\n\n<p>Try:</p>\n\n<pre><code>var queue Queue\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 4, "last_activity_date": 1486462046, "creation_date": 1486462046, "answer_id": 42086976, "question_id": 42086547, "link": "https://stackoverflow.com/questions/42086547/golang-type-array-containing-structs/42086976#42086976", "title": "golang type array containing structs", "body": "<p>You don't need a slice of queues, and you should not index an empty slice.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Job struct {\n    Type string\n    Url string\n}\n\ntype Queue []Job\n\nfunc main() {\n    var q Queue\n    job := Job{\"test\", \"http://google.com\"}\n    q = append(q, job)\n    fmt.Println(q)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "is_accepted": false, "score": 0, "last_activity_date": 1486464296, "creation_date": 1486464296, "answer_id": 42087766, "question_id": 42086547, "link": "https://stackoverflow.com/questions/42086547/golang-type-array-containing-structs/42087766#42087766", "title": "golang type array containing structs", "body": "<p><code>[]TypeName</code> is definition of slice of <code>TypeName</code> type.</p>\n\n<p>Just as it said:</p>\n\n<p><code>var queue []Queue</code> is a slice of instances of type <code>Queue</code>.</p>\n\n<pre><code>q := Queue{Job{\"test\", \"http://google.com\"}, Job{\"test\", \"http://google.com\"}}\n</code></pre>\n\n<p>Definitely it is not what you want. Instead of it you should declare <code>var queue Queue</code>:</p>\n\n<pre><code>var queue Queue\nq := append(queue, Job{\"test\", \"http://google.com\"}, Job{\"test\", \"http://google.com\"})\n</code></pre>\n"}], "owner": {"reputation": 1154, "user_id": 2719045, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/hxQo1.jpg?s=128&g=1", "display_name": "bthe0", "link": "https://stackoverflow.com/users/2719045/bthe0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9639, "favorite_count": 0, "accepted_answer_id": 42086642, "answer_count": 3, "score": 0, "last_activity_date": 1486464296, "creation_date": 1486460917, "last_edit_date": 1486462811, "question_id": 42086547, "link": "https://stackoverflow.com/questions/42086547/golang-type-array-containing-structs", "title": "golang type array containing structs", "body": "<p>I am trying to create a pseudo queue structure and insert jobs structs inside it. What am I doing wrong ?</p>\n\n<pre><code>import \"fmt\"\n\ntype Job struct {\n    Type string\n    Url string\n}\n\ntype Queue [] Job\n\nfunc main() {\n    var queue []Queue\n    job   := Job{\"test\", \"http://google.com\"}\n\n    queue[0] = job\n    fmt.Println(queue)\n}\n</code></pre>\n\n<p>The code above is throwing:</p>\n\n<blockquote>\n  <p>cannot use job (type Job) as type Queue in assignment</p>\n</blockquote>\n"}, {"tags": ["go", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1486461078, "post_id": 42086583, "comment_id": 71343420, "body": "Thank you very much! That worked! :)"}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": true, "score": 3, "last_activity_date": 1486461010, "creation_date": 1486461010, "answer_id": 42086583, "question_id": 42086340, "link": "https://stackoverflow.com/questions/42086340/golang-accessing-template-variables-from-included-templates/42086583#42086583", "title": "Golang Accessing Template Variables From Included Templates", "body": "<p>You can pass the data to the nested template as an argument like this: <code>{{ template \"nav\" . }}</code>\nNow the dot will be accessible within the <code>define \"nav\"</code> block.</p>\n"}], "owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1022, "favorite_count": 0, "closed_date": 1486461052, "accepted_answer_id": 42086583, "answer_count": 1, "score": 1, "last_activity_date": 1486461010, "creation_date": 1486460295, "question_id": 42086340, "link": "https://stackoverflow.com/questions/42086340/golang-accessing-template-variables-from-included-templates", "closed_reason": "Duplicate", "title": "Golang Accessing Template Variables From Included Templates", "body": "<p><strong>In golang, I am working with three files:</strong> index.html, nav.html and main.go</p>\n\n<p><strong>nav.html contains the following:</strong></p>\n\n<pre><code>{{ define \"nav\" }}\n  &lt;nav class=\"nav-container\"&gt;\n    &lt;h1&gt;{{ .path }}&lt;/h1&gt;\n  &lt;/nav&gt;\n{{ end }}\n</code></pre>\n\n<p><strong>index.html contains the following:</strong></p>\n\n<pre><code>{{ define \"index\" }}\n  {{ template \"nav\" }} &lt;!-- Includes the nav.html file --&gt;\n\n  &lt;h1&gt;Welcome to my website. You are visiting {{ .path }}.&lt;/h1&gt;\n{{ end }}\n</code></pre>\n\n<p>I am using Golang's <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">template</a> package along with <a href=\"https://github.com/go-martini/martini\" rel=\"nofollow noreferrer\">Martini</a> which is not too important in this case.</p>\n\n<p><strong>My main.go file contains:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/go-martini/martini\"\n    \"github.com/martini-contrib/render\"\n)\n\nfunc main() {\n    m := martiniSetup()\n\n    m.Get(\"/\", func(res http.ResponseWriter, req *http.Request, ren render.Render, params martini.Params) {\n        parse := make(map[string]interface{})\n        parse[\"path\"] = req.URL.Path\n\n        ren.HTML(http.StatusOK, \"index\", parse)\n    })\n\n    m.Run()\n}\n</code></pre>\n\n<hr>\n\n<p><strong>My problem:</strong></p>\n\n<p>The <code>.path</code> variable being parsed into the <code>index</code> template is only accessable by the <code>index</code> template itself.</p>\n\n<p>I include the <code>nav</code> template using <code>{{ template \"nav\" }}</code> inside <code>index.html</code>. The issue is, <code>nav.html</code> cannot access the .path variable. It is only accessable by the index template.</p>\n\n<p>Is there any way to make the <code>.path</code> variable accessable to all included template files, in my case <code>index.html</code> and <code>nav.html</code>?</p>\n"}, {"tags": ["json", "go", "struct", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1486466583, "last_edit_date": 1486466583, "creation_date": 1486462538, "answer_id": 42087149, "question_id": 42086071, "link": "https://stackoverflow.com/questions/42086071/how-to-skip-json-fields-in-struct-on-input-and-display-them-on-output-and-accep/42087149#42087149", "title": "How to skip JSON fields in Struct on input and display them on output, and accept certain fields in input and skip them in output in Golang?", "body": "<p>I extend your example by making it more general, and I show an elegant solution to the more general problem.</p>\n\n<p>Let's assume that in <code>User</code> there are:</p>\n\n<ul>\n<li>some fields that must be parsed only from the input</li>\n<li>some fields that must appear only in the output</li>\n<li>and there are some fields that must be parsed from input <em>and</em> must also appear in output</li>\n</ul>\n\n<p>Your example is a \"subset\" of this (as in your example there are no common fields).</p>\n\n<p>This can be elegantly solved without repeating fields using <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">embedding</a>. You may create 3 separate types; one for the common fields <code>UserBoth</code>, one for the input-only fields <code>UserIn</code>, and one for the output-only fields <code>UserOut</code>:</p>\n\n<pre><code>type UserBoth struct {\n    Name string `json:\"name\"`\n    Age  int    `json:\"age\"`\n}\n\ntype UserIn struct {\n    *UserBoth\n    Email string `json:\"email\"`\n}\n\ntype UserOut struct {\n    *UserBoth\n    ID uint `json:\"id\"`\n}\n</code></pre>\n\n<p>Note that <code>UserBoth</code> (or rather <code>*UserBoth</code> to avoid duplicating the struct value) is embedded in both <code>UserIn</code> and <code>UserOut</code>, because we want those fields in both.</p>\n\n<p>Now if you have an input that contains all fields (even though we don't want all):</p>\n\n<pre><code>const in = `{\"name\":\"Bob\",\"age\":23,\"Email\":\"as@as.com\",\"id\":123}`\n</code></pre>\n\n<p>Unmarshaling into a value of <code>UserIn</code> will only parse what you want:</p>\n\n<pre><code>uin := UserIn{UserBoth: &amp;UserBoth{}}\nerr := json.Unmarshal([]byte(in), &amp;uin)\nfmt.Printf(\"%+v %+v %v\\n\", uin, uin.UserBoth, err)\n</code></pre>\n\n<p>Output (note that the <code>Email</code> field is parsed but <code>ID</code> isn't):</p>\n\n<pre><code>{UserBoth:0x1050e150 Email:as@as.com} &amp;{Name:Bob Age:23} &lt;nil&gt;\n</code></pre>\n\n<p>And when you want to generate output:</p>\n\n<pre><code>uout := UserOut{UserBoth: uin.UserBoth}\n// Fetch / set ID from db:\nuout.ID = 456\nout, err := json.Marshal(uout)\nfmt.Println(string(out), err)\n</code></pre>\n\n<p>Output (note that the <code>ID</code> field is present but <code>Email</code> isn't):</p>\n\n<pre><code>{\"name\":\"Bob\",\"age\":23,\"id\":456} &lt;nil&gt;\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/JTRKmIt3Oe\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<h3>Having a \"unified\" <code>User</code></h3>\n\n<p>The above example used 2 different structs: <code>UserIn</code> for parsing and <code>UserOut</code> to generate the output.</p>\n\n<p>If inside your code you want to use a \"unified\" <code>User</code> struct, this is how it can be done:</p>\n\n<pre><code>type User struct {\n    UserIn\n    UserOut\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>uboth := &amp;UserBoth{}\nu := User{UserIn{UserBoth: uboth}, UserOut{UserBoth: uboth}}\nerr := json.Unmarshal([]byte(in), &amp;u.UserIn)\nfmt.Printf(\"%+v %+v %v\\n\", u, u.UserIn.UserBoth, err)\n\n// Fetch / set ID from db:\nu.ID = 456\nout, err := json.Marshal(u.UserOut)\nfmt.Println(string(out), err)\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/DN_-0XPhKv\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 2, "last_activity_date": 1486582074, "creation_date": 1486582074, "answer_id": 42121971, "question_id": 42086071, "link": "https://stackoverflow.com/questions/42086071/how-to-skip-json-fields-in-struct-on-input-and-display-them-on-output-and-accep/42121971#42121971", "title": "How to skip JSON fields in Struct on input and display them on output, and accept certain fields in input and skip them in output in Golang?", "body": "<p>While icza's answer proposes a nice solution, you could also employ JSON marshaling auxiliary methods <code>MarshalJSON/UnmarshalJSON</code>:</p>\n\n<pre><code>func main() {\n    // employing auxiliary json methods MarshalJSON/UnmarshalJSON\n    user := User{ID: 123, Email: `abc@xyz.com`}\n    js, _ := json.Marshal(&amp;user)\n    log.Printf(\"%s\", js)\n\n    input := UserInput(user)\n    js, _ = json.Marshal(&amp;input)\n    log.Printf(\"%s\", js)\n\n    output := UserOutput(user)\n    js, _ = json.Marshal(&amp;output)\n    log.Printf(\"%s\", js)\n}\n\ntype User struct {\n    ID    uint   `json:\"user_id\"`\n    Email string `json:\"email_address,omitempty\" validate:\"required,email\"`\n}\n\ntype UserInput User\n\nfunc (x *UserInput) MarshalJSON() ([]byte, error) {\n    return json.Marshal(&amp;struct {\n        Email string `json:\"email_address,omitempty\" validate:\"required,email\"`\n    }{\n        Email: x.Email,\n    })\n}\n\ntype UserOutput User\n\nfunc (x *UserOutput) MarshalJSON() ([]byte, error) {\n    return json.Marshal(&amp;struct {\n        ID uint `json:\"user_id\"`\n    }{\n        ID: x.ID,\n    })\n}\n</code></pre>\n\n<p>Which gives us:</p>\n\n<pre><code>[  info ] main.go:25: {\"user_id\":123,\"email_address\":\"abc@xyz.com\"}\n[  info ] main.go:29: {\"email_address\":\"abc@xyz.com\"}\n[  info ] main.go:33: {\"user_id\":123}\n</code></pre>\n\n<p>On <a href=\"https://play.golang.org/p/1uCW9jj_p4\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 1376, "user_id": 2446073, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1826329082/picture?type=large", "display_name": "Vladimir Mikhaylovskiy", "link": "https://stackoverflow.com/users/2446073/vladimir-mikhaylovskiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 641, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1486582074, "creation_date": 1486459553, "last_edit_date": 1486473668, "question_id": 42086071, "link": "https://stackoverflow.com/questions/42086071/how-to-skip-json-fields-in-struct-on-input-and-display-them-on-output-and-accep", "title": "How to skip JSON fields in Struct on input and display them on output, and accept certain fields in input and skip them in output in Golang?", "body": "<p>I'm writing a webservice in Go using Echo framework and Gorm.\nI have a <code>User</code> struct that looks like this:</p>\n\n<pre><code>type User struct {\n    ID    uint   `json:\"user_id\"`\n    Email string `json:\"email_address,omitempty\" validate:\"required,email\"`\n}\n</code></pre>\n\n<p>I'm accepting <code>POST</code> requests with a <code>Content-type: application/json</code>.\nI want my input to be <code>{\"email_address\": \"email@email.com\"}</code> and my output to be <code>{\"user_id\": 1}</code></p>\n\n<p>How can I forbid users from submitting <code>ID</code> in the request (so they can't create records with certain <code>ID</code>s), but keep <code>ID</code> in the response?\nRight now I'm doing <code>user.ID = 0</code> right before save, but I wonder if there's a better way to do it?</p>\n\n<p>I also want to skip <code>Email</code> in output. Right now I'm doing <code>user.Email = \"\"</code> right before the output. Is there a better way for that also?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 587, "user_id": 1144896, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/852a0c261ea9ff7ec2fda5ed437bde26?s=128&d=identicon&r=PG", "display_name": "tabiul", "link": "https://stackoverflow.com/users/1144896/tabiul"}, "is_accepted": false, "score": 0, "last_activity_date": 1486457162, "creation_date": 1486457162, "answer_id": 42085292, "question_id": 42085173, "link": "https://stackoverflow.com/questions/42085173/channel-deadlock-in-go/42085292#42085292", "title": "Channel Deadlock in Go", "body": "<p>I found the problem. Actually two problems</p>\n\n<ol>\n<li><p>The size of the channel and wg should be 3</p></li>\n<li><p>I should pass the wg as pointer</p></li>\n</ol>\n\n<p>Updated code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    c := make(chan int, 3)\n    var wg sync.WaitGroup\n    wg.Add(3)\n\n    go doSomething(c, &amp;wg)\n    go doSomething(c, &amp;wg)\n    go doSomething(c, &amp;wg)\n\n    wg.Wait()\n\n    close(c)\n\n    for v := range c {\n        fmt.Print(v)\n    }\n\n}\n\nfunc doSomething(c chan&lt;- int, wg *sync.WaitGroup) {\n    defer wg.Done()\n    c &lt;- 1\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8978, "user_id": 2223579, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/wQuP6.jpg?s=128&g=1", "display_name": "BlackMamba", "link": "https://stackoverflow.com/users/2223579/blackmamba"}, "is_accepted": false, "score": 0, "last_activity_date": 1486458581, "creation_date": 1486458581, "answer_id": 42085726, "question_id": 42085173, "link": "https://stackoverflow.com/questions/42085173/channel-deadlock-in-go/42085726#42085726", "title": "Channel Deadlock in Go", "body": "<p>Yes, there is an important <strong><em>issues</em></strong> in your code.</p>\n\n<p>you call <code>go doSomething(c, wg)</code> just pass <code>wg</code> value.\nyou should know </p>\n\n<blockquote>\n  <p>Arguments in Go are always passed by value. Use a pointer when an\n  argument may be modified.</p>\n</blockquote>\n\n<p>so you should do like this <code>go doSomething(c, &amp;wg)</code>, then <code>wg</code> in <code>main</code> function will be modified by <code>defer wg.Done()</code> in <code>func doSomething(c chan&lt;- int, wg sync.WaitGroup)</code>.</p>\n\n<p>. </p>\n"}, {"comments": [{"owner": {"reputation": 587, "user_id": 1144896, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/852a0c261ea9ff7ec2fda5ed437bde26?s=128&d=identicon&r=PG", "display_name": "tabiul", "link": "https://stackoverflow.com/users/1144896/tabiul"}, "edited": false, "score": 0, "creation_date": 1486463266, "post_id": 42086959, "comment_id": 71344936, "body": "I thought you cannot range over channel until the channel is closed. Maybe I am wrong but that is what it says here <a href=\"http://guzalexander.com/2013/12/06/golang-channels-tutorial.html\" rel=\"nofollow noreferrer\">guzalexander.com/2013/12/06/golang-channels-tutorial.html</a> &quot;As was mentioned above the range will work until the channel is closed explicitly&quot;. In this case we need to wait for the other goroutine to be executed anyway."}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "reply_to_user": {"reputation": 587, "user_id": 1144896, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/852a0c261ea9ff7ec2fda5ed437bde26?s=128&d=identicon&r=PG", "display_name": "tabiul", "link": "https://stackoverflow.com/users/1144896/tabiul"}, "edited": false, "score": 0, "creation_date": 1486463889, "post_id": 42086959, "comment_id": 71345359, "body": "You misunderstood - the point is that the loop wouldn&#39;t end until the channel is closed. So if the channel is never closed you would have infinite loop (it would wait for the next item or the closing of the channel)."}, {"owner": {"reputation": 587, "user_id": 1144896, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/852a0c261ea9ff7ec2fda5ed437bde26?s=128&d=identicon&r=PG", "display_name": "tabiul", "link": "https://stackoverflow.com/users/1144896/tabiul"}, "edited": false, "score": 0, "creation_date": 1486508210, "post_id": 42086959, "comment_id": 71373429, "body": "oh ok, so you mean the for range will block till the channel is closed. I think then your solution is better"}], "tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": true, "score": 1, "last_activity_date": 1486462004, "creation_date": 1486462004, "answer_id": 42086959, "question_id": 42085173, "link": "https://stackoverflow.com/questions/42085173/channel-deadlock-in-go/42086959#42086959", "title": "Channel Deadlock in Go", "body": "<p>While your solution might work I'm not happy with it.</p>\n\n<p>First, the fact that you need to change the channel size to make it work indicates that there is a potential problem / bug. Now each time you want to launch another <code>doSomething</code> you have to remember to change channel's length.</p>\n\n<p>Second, you wait until all the goroutines are finished before reading from the channel. This is kind of \"waste\" as one of the main points of range loop over an channel is that you don't have to wait until all the items are generated (written into channel), you can start processing the items as soon as some of them are ready.</p>\n\n<p>So I would write your code as something like</p>\n\n<pre><code>func main() {\n    c := make(chan int)\n\n    var wg sync.WaitGroup\n    wg.Add(3)\n    go func() {\n        doSomething(c)\n        defer wg.Done()\n    }()\n    go func() {\n        doSomething(c)\n        defer wg.Done()\n    }()\n    go func() {\n        doSomething(c)\n        defer wg.Done()\n    }()\n\n    go func() {\n        wg.Wait()\n        defer close(c)\n    }()\n\n    for v := range c {\n        fmt.Print(v)\n    }\n}\n\nfunc doSomething(c chan&lt;- int) {\n    c &lt;- 1\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/T3dfiztKot\" rel=\"nofollow noreferrer\">https://play.golang.org/p/T3dfiztKot</a></p>\n\n<p>Note how the waiting and closing the channel is now in it's own goroutine - this allows to start iterating over the channel (which is now unbuffered!) right away.</p>\n\n<p>I also changed the code so that the <code>WaitGroup</code> never leaves the scope where it is declared (ie it isn't used as parameter), this is my personal preference. I believe it makes code easier to follow and understand.</p>\n"}], "owner": {"reputation": 587, "user_id": 1144896, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/852a0c261ea9ff7ec2fda5ed437bde26?s=128&d=identicon&r=PG", "display_name": "tabiul", "link": "https://stackoverflow.com/users/1144896/tabiul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 0, "accepted_answer_id": 42086959, "answer_count": 3, "score": 0, "last_activity_date": 1486462004, "creation_date": 1486456712, "question_id": 42085173, "link": "https://stackoverflow.com/questions/42085173/channel-deadlock-in-go", "title": "Channel Deadlock in Go", "body": "<p>I am getting \"fatal error: all goroutines are asleep - deadlock!\n\" for some reason in the below code. I am using buffered channel which should be non-blocking. Not sure what I am doing wrong</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    c := make(chan int, 2)\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    go doSomething(c, wg)\n    go doSomething(c, wg)\n    go doSomething(c, wg)\n\n    wg.Wait()\n\n    close(c)\n\n    for v := range c {\n        fmt.Print(v)\n    }\n\n}\n\nfunc doSomething(c chan&lt;- int, wg sync.WaitGroup) {\n    defer wg.Done()\n    c &lt;- 1\n\n}\n</code></pre>\n\n<p>Playground link <a href=\"https://play.golang.org/p/J9meD5aKna\" rel=\"nofollow noreferrer\">https://play.golang.org/p/J9meD5aKna</a></p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "edited": false, "score": 1, "creation_date": 1486463892, "post_id": 42085131, "comment_id": 71345361, "body": "How did you install the dependencies?"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 7533034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db815ed29ca6c7265584b3f77cd58405?s=128&d=identicon&r=PG", "display_name": "Zin", "link": "https://stackoverflow.com/users/7533034/zin"}, "is_accepted": false, "score": 1, "last_activity_date": 1486538602, "creation_date": 1486538602, "answer_id": 42107033, "question_id": 42085131, "link": "https://stackoverflow.com/questions/42085131/kubernetes-client-go-undefined-v1-finalizerorphan/42107033#42107033", "title": "kubernetes/client-go undefined: v1.FinalizerOrphan", "body": "<p>I encountered a similar issue when I tried to go get kubernetes v1.5.2.<br/>\nJust solved it with:<br/>\n  <i>cd ../k8s.io/kubernetes</i><br/>\n  <i>git checkout v1.5.2</i><br/></p>\n"}, {"tags": [], "owner": {"reputation": 399, "user_id": 3935563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c13653d8c738e8fb478d4142af59d0b?s=128&d=identicon&r=PG&f=1", "display_name": "lavalamp", "link": "https://stackoverflow.com/users/3935563/lavalamp"}, "is_accepted": false, "score": 1, "last_activity_date": 1486771728, "creation_date": 1486771728, "answer_id": 42170658, "question_id": 42085131, "link": "https://stackoverflow.com/questions/42085131/kubernetes-client-go-undefined-v1-finalizerorphan/42170658#42170658", "title": "kubernetes/client-go undefined: v1.FinalizerOrphan", "body": "<p>Sorry, this should be temporary--we are working on a fix (and on a system so our publishing bot stops breaking the client). In the meantime, go back a commit or two, as the other answer suggests.</p>\n"}], "owner": {"reputation": 21, "user_id": 7527572, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CTH3S.jpg?s=128&g=1", "display_name": "H22F", "link": "https://stackoverflow.com/users/7527572/h22f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1540216599, "creation_date": 1486456552, "last_edit_date": 1540216599, "question_id": 42085131, "link": "https://stackoverflow.com/questions/42085131/kubernetes-client-go-undefined-v1-finalizerorphan", "title": "kubernetes/client-go undefined: v1.FinalizerOrphan", "body": "<p>I get the go get k8s.io/client-go/1.5/...\nAn error occurred while trying to go run:</p>\n\n<pre><code>&gt; # k8s.io/client-go/pkg/api/v1\n&gt; ../k8s.io/client-go/pkg/api/v1/helpers.go:86: undefined: v1.FinalizerOrphan\n</code></pre>\n\n<p>Want to how to deal with, please?</p>\n\n<p>../k8s.io/client-go/pkg/api/v1/helpers.go:86:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var standardFinalizers = sets.NewString(\n    string(FinalizerKubernetes),\n    metav1.FinalizerOrphan,\n)\n</code></pre>\n"}, {"tags": ["security", "go", "xss", "go-gin"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 3, "creation_date": 1486453427, "post_id": 42084269, "comment_id": 71338967, "body": "Detecting and removing XSS are both impossible. Instead, use strategies that are secure by default (automatic escaping, never disable escaping for individual cases if you can help it, never template inside <code>&lt;script&gt;</code> elements or unusual contexts like <code>on*</code> attributes) and create a restrictive Content-Security-Policy."}, {"owner": {"reputation": 29, "user_id": 6553123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/000887db6d43536f327f45622c6880bf?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh Gupta", "link": "https://stackoverflow.com/users/6553123/rakesh-gupta"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1486454054, "post_id": 42084269, "comment_id": 71339306, "body": "Thanks. But when i call endpoint url  0.0.0.0:8080/login with POST and json data as { \t&quot;user&quot; : &quot;manu&lt;script&gt;prdknfkdngknfkint()&lt;/script&gt;&quot;, \t&quot;password&quot; : &quot;123&quot;  } then output is  {   &quot;status&quot;: &quot;you are logged in&quot; }  I want to simply abort request instead of processing next, where this middleware is removing scripts. For this where can i change code.."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1486454178, "post_id": 42084269, "comment_id": 71339384, "body": "What\u2019s the problem if someone submits that?"}, {"owner": {"reputation": 29, "user_id": 6553123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/000887db6d43536f327f45622c6880bf?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh Gupta", "link": "https://stackoverflow.com/users/6553123/rakesh-gupta"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1486454376, "post_id": 42084269, "comment_id": 71339492, "body": "I don&#39;t want to store this malicious data in database. And i want to warn to user.. Thanks.."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1486454501, "post_id": 42084269, "comment_id": 71339558, "body": "You want to warn the user submitting the XSS? Also, there\u2019s no way to filter \u201cmalicious data\u201d out of your database; just accept that it could end up there and plan accordingly."}, {"owner": {"reputation": 29, "user_id": 6553123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/000887db6d43536f327f45622c6880bf?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh Gupta", "link": "https://stackoverflow.com/users/6553123/rakesh-gupta"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1486454673, "post_id": 42084269, "comment_id": 71339655, "body": "How can i know if submitted data is malicious. And plan accordingly in future?"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 1, "creation_date": 1486454870, "post_id": 42084269, "comment_id": 71339772, "body": "You <i>can\u2019t</i> know if submitted data is malicious. Plan accordingly = don\u2019t trust the user\u2019s input. If you\u2019re putting it in HTML, for example, make sure it\u2019s always escaped."}, {"owner": {"reputation": 2725, "user_id": 303114, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/kBVST.jpg?s=128&g=1", "display_name": "danfromisrael", "link": "https://stackoverflow.com/users/303114/danfromisrael"}, "edited": false, "score": 1, "creation_date": 1517220598, "post_id": 42084269, "comment_id": 83990649, "body": "i&#39;m also looking to reject malicious requests. i&#39;ve found node lib that does that here: <a href=\"https://github.com/akos-sereg/express-defend/blob/master/lib/express-defend.js?id=../../../etc/appsword\" rel=\"nofollow noreferrer\">github.com/akos-sereg/express-defend/blob/master/lib/&hellip;</a>"}], "owner": {"reputation": 29, "user_id": 6553123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/000887db6d43536f327f45622c6880bf?s=128&d=identicon&r=PG&f=1", "display_name": "Rakesh Gupta", "link": "https://stackoverflow.com/users/6553123/rakesh-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1045, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1489395308, "creation_date": 1486453285, "last_edit_date": 1489395308, "question_id": 42084269, "link": "https://stackoverflow.com/questions/42084269/how-to-detect-xss-attack-in-go-and-abort-request-with-error", "title": "How to detect xss attack in Go and abort request with error", "body": "<p>I am using <strong>dvwright/xss-mw</strong> middleware in Go to detect xss. This middleware auto remove xss from user submitted input, And request continue with valid response.\nI want to detect xss and if there is any xss script then through a error instead of simply removing xss.</p>\n\n<p>My code is here.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/dvwright/xss-mw\"\n    \"github.com/gin-gonic/gin\"\n    \"net/http\"\n)\n\nfunc main() {\n    r := gin.Default()\n\n    // include as standard middleware\n    var xssMdlwr xss.XssMw\n    r.Use(xssMdlwr.RemoveXss())\n\n    r.GET(\"/ping\", func(c *gin.Context) {\n        c.JSON(200, gin.H{\n            \"message\": \"pong\",\n        })\n    })\n\n\n    type Login struct {\n        User     string `form:\"user\" json:\"user\" binding:\"required\"`\n        Password string `form:\"password\" json:\"password\" binding:\"required\"`\n    }\n\n    r.POST(\"/login\", func(c *gin.Context) {\n        var json Login\n        if c.BindJSON(&amp;json) == nil {\n            if json.User == \"manu\" &amp;&amp; json.Password == \"123\" {\n                c.JSON(http.StatusOK, gin.H{\"status\": \"you are logged in\"})\n            } else {\n                c.JSON(http.StatusUnauthorized, gin.H{\"status\": \"unauthorized\"})\n            }\n        }\n    })\n\n\n    r.Run() // listen and serve on 0.0.0.0:8080\n}\n</code></pre>\n\n<p>Please help me out.</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7526969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a40574ce329cc0cfd5444023824b257?s=128&d=identicon&r=PG&f=1", "display_name": "Harini J", "link": "https://stackoverflow.com/users/7526969/harini-j"}, "edited": false, "score": 0, "creation_date": 1486462664, "post_id": 42085658, "comment_id": 71344511, "body": "Yes I have added the <code>db.AutoMigrate(&amp;User{}, &amp;UserSession{})</code> , error shown in log is <code>(sql: converting Exec argument #0&#39;s type: unsupported type models.User, a struct)</code>"}], "tags": [], "owner": {"reputation": 1, "user_id": 4727361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4baa917778790183fbc868c28c8c33c?s=128&d=identicon&r=PG&f=1", "display_name": "mylk", "link": "https://stackoverflow.com/users/4727361/mylk"}, "is_accepted": false, "score": 0, "last_activity_date": 1486458362, "creation_date": 1486458362, "answer_id": 42085658, "question_id": 42083941, "link": "https://stackoverflow.com/questions/42083941/one-to-one-relation-mapping-using-gorm-for-golang/42085658#42085658", "title": "One to One relation mapping using GORM for Golang", "body": "<p>I can't comment your questions so I would ask it here:\nDo you migrate your schema in any way like:</p>\n\n<pre><code>db.AutoMigrate(&amp;User{}, &amp;UserSession{})\n</code></pre>\n\n<p>?\nIf you do, you should get some detailed errors in log, which might be useful for you.</p>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 13202568, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-SZ8sgMXWvV4/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbAmNpgkkLjFurgYtMlUhnqASqrfTg/mo/photo.jpg?sz=128", "display_name": "Helios", "link": "https://stackoverflow.com/users/13202568/helios"}, "is_accepted": false, "score": 0, "last_activity_date": 1616728234, "creation_date": 1616728234, "answer_id": 66810509, "question_id": 42083941, "link": "https://stackoverflow.com/questions/42083941/one-to-one-relation-mapping-using-gorm-for-golang/66810509#66810509", "title": "One to One relation mapping using GORM for Golang", "body": "<p>The way I have managed to get something similar to work is this.</p>\n<pre><code>type UserSession struct {\n    Id           uint `gorm:&quot;AUTO_INCREMENT&quot;`\n    UserId       uint\n    User         User\n    SessionToken string `gorm:&quot;column:session_token&quot;`\n    CreatedAt    int64  `gorm:&quot;type(timestamp)&quot;`\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7526969, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4a40574ce329cc0cfd5444023824b257?s=128&d=identicon&r=PG&f=1", "display_name": "Harini J", "link": "https://stackoverflow.com/users/7526969/harini-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 518, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1616728234, "creation_date": 1486451914, "last_edit_date": 1527756420, "question_id": 42083941, "link": "https://stackoverflow.com/questions/42083941/one-to-one-relation-mapping-using-gorm-for-golang", "title": "One to One relation mapping using GORM for Golang", "body": "<p>I am trying to understand how GORM works for one to one relational mapping with MySQL. I have 2 structs like so:</p>\n\n<pre><code>type User struct {\n    Id              uint   `gorm:\"AUTO_INCREMENT\"`\n    FirstName       string `gorm:\"column:first_name\"`\n    LastName        string `gorm:\"column:last_name\"`\n    EncryptedUserId string `gorm:\"size:255\"`\n    Email           string `gorm:\"not null;unique\"`\n    Password        string `gorm:\"not null;unique\"`\n    CreatedAt       int64  `gorm:\"type(timestamp)\"`\n}\n\ntype UserSession struct {\n    Id           uint `gorm:\"AUTO_INCREMENT\"`\n    UserId       User \n    SessionToken string `gorm:\"column:session_token\"`\n    CreatedAt    int64  `gorm:\"type(timestamp)\"`\n}\n</code></pre>\n\n<p><code>User</code> and <code>UserSession</code> share one to one relation. But when code above is run, the column <code>UserId</code> for <code>UserSession</code> table is not created. Even after specifying the foreign key constraint <code>gorm:\"ForeignKey:Id\"</code>\nthe result is same. Why isn't the above code working? Is anything missing in the struct definition?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8978, "user_id": 2223579, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/wQuP6.jpg?s=128&g=1", "display_name": "BlackMamba", "link": "https://stackoverflow.com/users/2223579/blackmamba"}, "edited": false, "score": 1, "creation_date": 1486448984, "post_id": 42083059, "comment_id": 71336899, "body": "Are u in windiws env? This package is not implemented on Windows."}, {"owner": {"reputation": 12238, "user_id": 97926, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/7CP1W.png?s=128&g=1", "display_name": "Jalpesh Vadgama", "link": "https://stackoverflow.com/users/97926/jalpesh-vadgama"}, "reply_to_user": {"reputation": 8978, "user_id": 2223579, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/wQuP6.jpg?s=128&g=1", "display_name": "BlackMamba", "link": "https://stackoverflow.com/users/2223579/blackmamba"}, "edited": false, "score": 0, "creation_date": 1486449053, "post_id": 42083059, "comment_id": 71336918, "body": "Yes, I am in windows environment but see the playground one there also I&#39;m getting error and they are not using windows environment."}], "answers": [{"tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 6, "last_activity_date": 1486449842, "last_edit_date": 1592644375, "creation_date": 1486449842, "answer_id": 42083388, "question_id": 42083059, "link": "https://stackoverflow.com/questions/42083059/getting-syslog-writer-undefined/42083388#42083388", "title": "Getting syslog.Writer undefined", "body": "<p>According to <a href=\"https://blog.golang.org/playground\" rel=\"noreferrer\">https://blog.golang.org/playground</a>,</p>\n<blockquote>\n<p>To isolate user programs from Google's infrastructure, the back end runs them under Native Client (or &quot;NaCl&quot;)</p>\n</blockquote>\n<p>And from the <a href=\"https://golang.org/pkg/log/syslog/\" rel=\"noreferrer\">https://golang.org/pkg/log/syslog/</a></p>\n<blockquote>\n<p>This package is not implemented on Windows. As the syslog package is frozen, Windows users are encouraged to use a package outside of the standard library. For background, see <a href=\"https://golang.org/issue/1108\" rel=\"noreferrer\">https://golang.org/issue/1108</a>.</p>\n<p>This package is not implemented on Plan 9.</p>\n<p>This package is not implemented on NaCl (Native Client).</p>\n</blockquote>\n<p>You are using Windows, and Go Playground is using NaCl, which both syslog is not implemented.</p>\n"}], "owner": {"reputation": 12238, "user_id": 97926, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/7CP1W.png?s=128&g=1", "display_name": "Jalpesh Vadgama", "link": "https://stackoverflow.com/users/97926/jalpesh-vadgama"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1783, "favorite_count": 0, "accepted_answer_id": 42083388, "answer_count": 1, "score": 4, "last_activity_date": 1486449842, "creation_date": 1486448476, "question_id": 42083059, "link": "https://stackoverflow.com/questions/42083059/getting-syslog-writer-undefined", "title": "Getting syslog.Writer undefined", "body": "<p>I have created the custom type with like following.</p>\n\n<pre><code>import (\n    \"encoding/json\"\n     \"log\"\n     \"log/syslog\"\n     \"strconv\"\n     \"time\"\n)\n\ntype MyLogger struct {\n     w       *syslog.Writer\n     LogName string\n}\n</code></pre>\n\n<p>And I'm getting error syslog.writer undefined. Even I tried the same in golang play ground and its giving same error.</p>\n\n<p><a href=\"https://play.golang.org/p/2unuwHBoBE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/2unuwHBoBE</a></p>\n"}, {"tags": ["mongodb", "go", "database"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "edited": false, "score": 0, "creation_date": 1486451216, "post_id": 42083305, "comment_id": 71337864, "body": "Thank you for testing it on your PC. I also added an update with code for nested structs in case someone finds it useful, i&#39;ve seen that there&#39;s no information on that in google or stackoverflow"}], "tags": [], "owner": {"reputation": 6945, "user_id": 2288944, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/7qryD.jpg?s=128&g=1", "display_name": "armnotstrong", "link": "https://stackoverflow.com/users/2288944/armnotstrong"}, "is_accepted": true, "score": 3, "last_activity_date": 1486449987, "last_edit_date": 1495540406, "creation_date": 1486449590, "answer_id": 42083305, "question_id": 42081882, "link": "https://stackoverflow.com/questions/42081882/go-mongodb-driver-and-struct-find-messes-with-uppercase-and-lowercase/42083305#42083305", "title": "go mongodb driver and struct, find messes with uppercase and lowercase", "body": "<p>these <code>json</code> and <code>bson</code> stuff is called <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go\">tags</a></p>\n\n<p>My best guess is that because Go requires a variable or function to be public by Capitalize the first character, so serialize frameworks like json or bson require the struct Capitalize its first character to expose the field(so that it could see the field). Thus the exposed field name should be defined with a tag (to avoid the restriction).</p>\n\n<p>the space between <code>bson:</code> and <code>\"token\"</code> seems to have cause the problem</p>\n\n<p>I tried following code snippet and seems works fine.</p>\n\n<pre><code>type Token struct {\n    PageUrl string `json:\"pageUrl\" bson:\"pageUrl\"`\n    Token string `json:\"token\" bson:\"token\"`\n    PageId string `json:\"pageId\" bson:\"pageId\"`\n} \n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1331, "favorite_count": 0, "accepted_answer_id": 42083305, "answer_count": 1, "score": 4, "last_activity_date": 1500108408, "creation_date": 1486442485, "last_edit_date": 1506103077, "question_id": 42081882, "link": "https://stackoverflow.com/questions/42081882/go-mongodb-driver-and-struct-find-messes-with-uppercase-and-lowercase", "title": "go mongodb driver and struct, find messes with uppercase and lowercase", "body": "<pre><code>var Messages []Token\nc2 := session.DB(\"mydatabase\").C(\"pages\")\nquery2 := c2.Find(bson.M{}).All(&amp;Messages)\nfmt.Print(Messages)\n</code></pre>\n\n<p>Here's the structure in my Mongo DB: </p>\n\n<pre><code>id_\npageUrl\ntoken\npageId\n</code></pre>\n\n<p>I first tried the structure as this:</p>\n\n<pre><code>type Token struct {\n    PageUrl string\n    Token string\n    PageId string\n}\n</code></pre>\n\n<p>but only the token was being printed, perhaps because it's all lowercase. The other two fields were not being retrieved because they contain uppercase. Then I tried this:</p>\n\n<pre><code>type Token struct {\n    PageUrl string `json: \"pageUrl\" bson: \"pageUrl\"`\n    Token string `json: \"token\" bson: \"token\"`\n    PageId string `json: \"pageId\" bson: \"pageId\"`\n}    \n</code></pre>\n\n<p>what are those <code>bson</code> and <code>json</code> things? I've only put it there because I've seen in the internet, but it doesn't work, I still get only the <code>token</code> field</p>\n\n<p><strong>UPDATE with solution and tested example for nested documents</strong></p>\n\n<p>I've seen that there was no posts regarding this question so remember that the solution was to remove the spaces between <code>json:</code> and <code>bson:</code> \nAlso, to help someone who might be wondering how to do it for nested structs, here I give two structures that worked for me: </p>\n\n<pre><code>type Token struct {\n    PageUrl string `json:\"pageUrl\" bson:\"pageUrl\"`\n    Token string `json:\"token\" bson:\"token\"`\n    PageId string `json:\"pageId\" bson:\"pageId\"`\n}\n\n\ntype Message struct {\n    Sender struct {\n        Id string `json:\"id\" bson:\"id\"`\n    } `json:\"sender\" bson:\"sender\"`\n    Recipient struct {\n        Id string `json:\"id\" bson:\"id\"`\n    } `json:\"recipient\" bson:\"recipient\"`\n    Message struct {\n        Mid string `json:\"mid\" bson:\"mid\"`\n        Seq int `json:\"seq\" bson:\"seq\"`\n        Message string `json:\"text\" bson:\"text\"`\n    }\n}\n</code></pre>\n"}, {"tags": ["arrays", "loops", "recursion", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1486453494, "post_id": 42081430, "comment_id": 71339003, "body": "This question has not much to do with Go but with algorithm design."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486479734, "post_id": 42081430, "comment_id": 71356430, "body": "This isn&#39;t the place to ask for solution to Project Euler problems. If your solution takes hours to run, you probably have the wrong algorithm to begin with."}, {"owner": {"reputation": 11, "user_id": 4660797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b509568a91302b61b46cf33ba7fe08c1?s=128&d=identicon&r=PG&f=1", "display_name": "Young-Chul Lim", "link": "https://stackoverflow.com/users/4660797/young-chul-lim"}, "edited": false, "score": 0, "creation_date": 1486485420, "post_id": 42081430, "comment_id": 71360768, "body": "It returns the correct results, i checked up against values already computed by others it is just not efficient enough to run the (32,10) problem within an acceptable time frame.  Is there another forum where i could ask about a problem like this. I&#39;m not very good at formulating my problem so i wasn&#39;t sure if there was a dedicated forum to stuff like this.  Sorry for posting in the wrong place."}], "owner": {"reputation": 11, "user_id": 4660797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b509568a91302b61b46cf33ba7fe08c1?s=128&d=identicon&r=PG&f=1", "display_name": "Young-Chul Lim", "link": "https://stackoverflow.com/users/4660797/young-chul-lim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1486440059, "creation_date": 1486439716, "last_edit_date": 1486440059, "question_id": 42081430, "link": "https://stackoverflow.com/questions/42081430/optimizing-comparison-of-values-in-large-arrays-go", "title": "Optimizing comparison of values in large arrays - Go", "body": "<p>I am trying to learn Go, and made an attempt at solving the problem explained here <a href=\"https://projecteuler.net/problem=215\" rel=\"nofollow noreferrer\">https://projecteuler.net/problem=215</a></p>\n\n<p>I made a solution that works, but it takes a very long time to compute once the problem gets complex, literally running for hours without solving the question so i assume i need to optimize my solution somehow. Below is my code</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(wall(18, 10))\n}\n\nfunc wall(width, height int) int64 {\n\n    var total int64\n\n    combinations := findCombinations(width)\n\n    combiPointer := &amp;combinations\n\n    for i := 0; i &lt; 4; i++ {\n        for _, a := range combinations[i] {\n            if i%2 == 0 {\n                buildWall(a, combiPointer[i+1], 0, height, i+1, &amp;total, combiPointer)\n            } else {\n                buildWall(a, combiPointer[i-1], 0, height, i-1, &amp;total, combiPointer)\n            }\n        }\n    }\nreturn total\n}\n\nfunc buildWall(a []int, combi [][]int, level, height, index int, total *int64, pointer *[4][][]int) {\nlevel++\nvar canCombine bool\nfor _, a1 := range combi {\n    canCombine = true\n    for _, value := range a {\n            if canCombine == false {\n                break\n            }\n            for _, value1 := range a1 {\n                if value == value1 {\n                    canCombine = false\n                    break\n                }\n            }\n        }\n        if canCombine == true &amp;&amp; level &lt; height {\n\n            if index%2 == 0 {\n                buildWall(a1, pointer[index+1], level, height, index+1, total, pointer)\n            } else {\n                buildWall(a1, pointer[index-1], level, height, index-1, total, pointer)\n            }\n        } else if level == height {\n            *total++\n            break\n        }\n    }\n}\n</code></pre>\n\n<p>findCombinations works fine and returns a three dimensional array with all possible solutions. The arrays in [0] and [1] can (maybe) be put on top of each other without a crack occuring. Same for [2] and [3]. I choose to cut the array of all solutions up in 4 arrays by looking at the position of the first and last block used to build the wall as i assumed it would increase performance to loop over smaller arrays.</p>\n\n<pre><code>func findCombinations(width int) [4][][]int {\n    var i int\n    var tmp int\n    var tmpInt1 int\n    var tmpInt2 int\n    open := make([][]int, 0, 100)\n    var solutionsHolder [4][][]int\n    open = append(open, []int{3, 2})\n    tmpArray := make([]int, 0, 100)\n\n    for {\n        if len(open[i]) &gt; 0 {\n            tmpArray = append(tmpArray[:i], open[i][0])\n            open[i] = append(open[i][:0], open[i][1:]...)\n            counter := 0\n            for _, x := range tmpArray {\n                counter += x\n            }\n            if counter == width {\n                solutionArray := make([]int, len(tmpArray)-1)\n                counter2 := 0\n                for n := 0; n &lt; len(tmpArray)-1; n++ {\n                    if n == 0 {\n                        tmpInt1 = tmpArray[n] % 2\n                    }\n                    counter2 += tmpArray[n]\n                    solutionArray[n] = counter2\n                }\n                tmpInt2 = counter2 % 2\n                if tmpInt1 == 0 &amp;&amp; tmpInt2 == 0 {\n                    solutionsHolder[0] = append(solutionsHolder[0], solutionArray)\n                } else if tmpInt1 == 1 &amp;&amp; tmpInt2 == 1 {\n                    solutionsHolder[1] = append(solutionsHolder[1], solutionArray)\n                } else if tmpInt1 == 1 &amp;&amp; tmpInt2 == 0 {\n                    solutionsHolder[2] = append(solutionsHolder[2], solutionArray)\n                } else {\n                    solutionsHolder[3] = append(solutionsHolder[3], solutionArray)\n                }\n\n                for _, v := range open {\n                    tmp += len(v)\n                }\n                if tmp == 0 {\n                    return solutionsHolder\n                }\n                tmp = 0\n            } else if counter &gt; width {\n                for _, v := range open {\n                    tmp += len(v)\n                }\n                if tmp == 0 {\n                   return solutionsHolder\n                }\n                tmp = 0\n            } else if counter &lt; width {\n                i++\n                if len(open) &lt;= i {\n                    open = append(open, []int{3, 2})\n                } else {\n                    open[i] = append(open[i], []int{3, 2}...)\n                }\n            }\n        } else {\n            i--\n        }\n    }\n}\n</code></pre>\n\n<p>Its the wall function that calls a recursive function which will run for a very long time (i've had it run for an hour without a result) if you insert a width and height of wall(32,10) as they want you to compute on the website.</p>\n\n<p>buildWall() which is called by wall checks whether there is no crack on the same position for two solutions and if this is the case it runs buildWall again for the next level of the wall until the walls height is reached. It does this for every solutions comparing it to all other possible solutions, though limited to one subset of the 3d array.</p>\n\n<p>I'm thinking maybe there is another approach to find all the possible walls that can be combined, but i can't seem to wrap my head around it.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 913, "user_id": 5551912, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4ed9452605a562b6865a5527f92173a0?s=128&d=identicon&r=PG&f=1", "display_name": "Rome Torres", "link": "https://stackoverflow.com/users/5551912/rome-torres"}, "edited": false, "score": 0, "creation_date": 1486435962, "post_id": 42080830, "comment_id": 71332990, "body": "perfect that is exactly what it was and yes i&#39;m using http.ListenAndServe(&quot;:8000&quot;, nil) . Thanks a lot ."}], "tags": [], "owner": {"reputation": 18829, "user_id": 24998, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2c14a4f2931fa9336fdccdfe11318fef?s=128&d=identicon&r=PG", "display_name": "Jack", "link": "https://stackoverflow.com/users/24998/jack"}, "is_accepted": true, "score": 1, "last_activity_date": 1486435672, "creation_date": 1486435672, "answer_id": 42080830, "question_id": 42080450, "link": "https://stackoverflow.com/questions/42080450/golang-how-can-i-stop-an-http-request-from-continuing-to-fire/42080830#42080830", "title": "Golang how can I stop an Http request from continuing to fire", "body": "<blockquote>\n  <p>and the only way it stops is if I stop the requests manually otherwise\n  it keeps on going indefinitely</p>\n</blockquote>\n\n<p>You're not showing your full code, but it seems like you're using the <code>http.ListenAndServe</code> convenience function, which doesn't set a default timeout. So what I assume is happening is you're overloading your database server and your http server isn't set to timeout so it's just waiting for your database to respond.</p>\n\n<p>Assuming all of this is correct try doing something like this instead:</p>\n\n<pre><code>srv := &amp;http.Server{  \n    ReadTimeout: 5 * time.Second,\n    WriteTimeout: 10 * time.Second,\n}\nsrv.ListenAndServe()\n</code></pre>\n\n<p>There's a nice reference <a href=\"https://blog.cloudflare.com/the-complete-guide-to-golang-net-http-timeouts/\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 913, "user_id": 5551912, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/4ed9452605a562b6865a5527f92173a0?s=128&d=identicon&r=PG&f=1", "display_name": "Rome Torres", "link": "https://stackoverflow.com/users/5551912/rome-torres"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 42080830, "answer_count": 1, "score": 2, "last_activity_date": 1486445234, "creation_date": 1486432867, "last_edit_date": 1486445234, "question_id": 42080450, "link": "https://stackoverflow.com/questions/42080450/golang-how-can-i-stop-an-http-request-from-continuing-to-fire", "title": "Golang how can I stop an Http request from continuing to fire", "body": "<p>I was doing some load testing earlier today and found something peculiar, sometimes an Http request doesn't not die and keeps on firing . How can I correct that in my Golang code for instance see the image below . I am load testing loading 1,000 HTTP request but if you notice on the 1,000th request below it takes 392,999 milliseconds or <strong>392 seconds</strong> while the rest of the request takes <strong>2.2 seconds</strong> on average . I have done the test multiple times and sometimes it hangs . This is my code</p>\n\n<pre><code>func Home_streams(w http.ResponseWriter, r *http.Request) {\n    var result string\n\n    r.ParseForm()\n\n    wg := sync.WaitGroup{}\n\n    wg.Add(1)\n    go func() {\n\n\n    defer wg.Done()\n\n    db.QueryRow(\"select json_build_object('Locations', array_to_json(array_agg(t))) from (SELECT latitudes,county,longitudes,\"+\n        \"statelong,thirtylatmin,thirtylatmax,thirtylonmin,thirtylonmax,city\"+\n        \" FROM zips where city='Orlando' ORDER BY city limit 5) t\").Scan(&amp;result)\n\n    }()\n    wg.Wait()\n\n    fmt.Fprintf(w,result)\n}\n</code></pre>\n\n<p>and I connect to the database with this code</p>\n\n<pre><code>func init() {\n    var err error\n    db, err = sql.Open(\"postgres\",\"Postgres Connection String\")\n\n    if err != nil {\n        log.Fatal(\"Invalid DB config:\", err)\n    }\n    if err = db.Ping(); err != nil {\n        log.Fatal(\"DB unreachable:\", err)\n    }\n}\n</code></pre>\n\n<p>I would say that about 10 % of the time I load test this issue happens and the only way it stops is if I stop the requests manually otherwise it keeps on going indefinitely . I wonder if maybe this issue is addressed here <a href=\"https://medium.com/@nate510/don-t-use-go-s-default-http-client-4804cb19f779#.83uzpsp24\" rel=\"nofollow noreferrer\">https://medium.com/@nate510/don-t-use-go-s-default-http-client-4804cb19f779#.83uzpsp24</a>  I am still learning my way around Golang .\n<a href=\"https://i.stack.imgur.com/DiJND.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/DiJND.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 18829, "user_id": 24998, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2c14a4f2931fa9336fdccdfe11318fef?s=128&d=identicon&r=PG", "display_name": "Jack", "link": "https://stackoverflow.com/users/24998/jack"}, "is_accepted": true, "score": 2, "last_activity_date": 1486424666, "creation_date": 1486424666, "answer_id": 42079310, "question_id": 42079174, "link": "https://stackoverflow.com/questions/42079174/how-can-i-parse-int-json-data-in-go/42079310#42079310", "title": "How can I parse []int JSON data in Go?", "body": "<p><code>{a:[1,2,3]}</code> is not valid JSON. Object keys must be double-quoted. Changing it like this works as expected:</p>\n\n<p><code>s := \"{\\\"a\\\":[1,2,3]}\"</code></p>\n\n<p><a href=\"https://play.golang.org/p/qExZAeiRJy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qExZAeiRJy</a></p>\n"}, {"tags": [], "owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "is_accepted": false, "score": 1, "last_activity_date": 1486425145, "last_edit_date": 1486425145, "creation_date": 1486424805, "answer_id": 42079333, "question_id": 42079174, "link": "https://stackoverflow.com/questions/42079174/how-can-i-parse-int-json-data-in-go/42079333#42079333", "title": "How can I parse []int JSON data in Go?", "body": "<p>You have an invalid JSON. You should replace it, for example like this: <code>s := [{\"a\":[1,2,3]}]</code> or maybe like this <code>s := \"[{\\\"a\\\":[1,2,3]}]\"</code>.</p>\n\n<p>You can edit your code to something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\n\ntype Anything struct {\n    A []int `json:\"a\"`\n}\n\n\nfunc main() {\n    // note here: `[{\"a\":[1,2,3]}]`\n    // or: s := \"[{\\\"a\\\":[1,2,3]}]\"\n    s := `[{\"a\":[1,2,3]}]`\n\n    var a []Anything\n    json.Unmarshal([]byte(s), &amp;a)\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[{[1 2 3]}]\n</code></pre>\n\n<p>You can run it on <a href=\"https://play.golang.org/p/H4GupGFpfP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/H4GupGFpfP</a></p>\n"}], "owner": {"reputation": 21, "user_id": 1095222, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f39a252784d5a99589be6e20c4553fb?s=128&d=identicon&r=PG", "display_name": "takkanm", "link": "https://stackoverflow.com/users/1095222/takkanm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 42079310, "answer_count": 2, "score": 0, "last_activity_date": 1486425145, "creation_date": 1486423812, "question_id": 42079174, "link": "https://stackoverflow.com/questions/42079174/how-can-i-parse-int-json-data-in-go", "title": "How can I parse []int JSON data in Go?", "body": "<p>I try parse JSON data include integer array. But, I can't get integer array.</p>\n\n<pre><code>package main\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Anything struct {\n    A []int `json:\"a\"`\n}\n\nfunc main() {\n    s := \"{a:[1,2,3]}\"\n\n    var a Anything\n    json.Unmarshal([]byte(s), &amp;a)\n    fmt.Println(a.A)\n}\n</code></pre>\n\n<p>I got empty array.</p>\n\n<pre><code>[]\n</code></pre>\n\n<p>How can I get <code>[1, 2, 3]</code>?</p>\n"}, {"tags": ["arrays", "json", "go"], "answers": [{"comments": [{"owner": {"reputation": 449, "user_id": 727237, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0cc403d89092634ddfd75b780966d144?s=128&d=identicon&r=PG", "display_name": "uno-2017", "link": "https://stackoverflow.com/users/727237/uno-2017"}, "edited": false, "score": 0, "creation_date": 1486416937, "post_id": 42077628, "comment_id": 71326903, "body": "cannot range over s (type *ClientResponse)"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 449, "user_id": 727237, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0cc403d89092634ddfd75b780966d144?s=128&d=identicon&r=PG", "display_name": "uno-2017", "link": "https://stackoverflow.com/users/727237/uno-2017"}, "edited": false, "score": 0, "creation_date": 1486417474, "post_id": 42077628, "comment_id": 71327155, "body": "Ahhh, you made a named type of the slice.  Should be able to range over <code>*s</code>, though.  Incidentally, pointers to slices are almost <i>never</i> useful, since slices themselves are just 3-word structures, so you&#39;re only saving 2 words of data in exchange for an additional layer of indirection."}, {"owner": {"reputation": 449, "user_id": 727237, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0cc403d89092634ddfd75b780966d144?s=128&d=identicon&r=PG", "display_name": "uno-2017", "link": "https://stackoverflow.com/users/727237/uno-2017"}, "edited": false, "score": 0, "creation_date": 1486417975, "post_id": 42077628, "comment_id": 71327417, "body": "seems ok now , thanks .. what is the best approach for such arrays ? i mean you are saying &quot;pointers to slices are almost never useful&quot; i did that because i was getting error  : cannot unmarshal array into Go value of type main.Client"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 449, "user_id": 727237, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0cc403d89092634ddfd75b780966d144?s=128&d=identicon&r=PG", "display_name": "uno-2017", "link": "https://stackoverflow.com/users/727237/uno-2017"}, "edited": false, "score": 0, "creation_date": 1486418508, "post_id": 42077628, "comment_id": 71327705, "body": "Don&#39;t unmarshal it into a <code>Client</code>, unmarshal it directly into a slice <code>[]Client</code>.  Example: <a href=\"https://play.golang.org/p/-e6ypRch1N\" rel=\"nofollow noreferrer\">play.golang.org/p/-e6ypRch1N</a>"}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 1, "last_activity_date": 1486417492, "last_edit_date": 1486417492, "creation_date": 1486416786, "answer_id": 42077628, "question_id": 42077537, "link": "https://stackoverflow.com/questions/42077537/how-to-parse-json-array-of-json-hashes-in-golang/42077628#42077628", "title": "How to parse JSON Array of JSON Hashes in GOLANG", "body": "<p>You'll have to loop over them.</p>\n\n<pre><code>names := make([]string, len(*s))\nfor i := range *s {\n    names[i] = (*s)[i].Name\n}\n</code></pre>\n\n<p>Incidentally, your structure for unmarshalling is incorrect.  <code>keepalive</code> isn't exported, so it won't be unmarshalled, and even if it were, it's defined as a slice of strings, while the <code>keepalive</code> field in the JSON is an object with <code>thresholds</code>, <code>handlers</code>, and <code>refresh</code> fields</p>\n"}], "owner": {"reputation": 449, "user_id": 727237, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/0cc403d89092634ddfd75b780966d144?s=128&d=identicon&r=PG", "display_name": "uno-2017", "link": "https://stackoverflow.com/users/727237/uno-2017"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "accepted_answer_id": 42077628, "answer_count": 1, "score": 0, "last_activity_date": 1486417492, "creation_date": 1486416393, "question_id": 42077537, "link": "https://stackoverflow.com/questions/42077537/how-to-parse-json-array-of-json-hashes-in-golang", "title": "How to parse JSON Array of JSON Hashes in GOLANG", "body": "<p>i have the following json array of json hashes : </p>\n\n<pre><code>[\n  {\n    \"name\": \"XXXX\",\n    \"address\": \"XXXX\",\n    \"keepalive\": {\n      \"thresholds\": {\n        \"warning\": 30,\n        \"critical\": 100\n      },\n      \"handlers\": [\n        \"XXXXX\"\n      ],\n      \"refresh\": 180\n    },\n    \"subscriptions\": [\n      \"XXXX\",\n      \"XXXX\",\n      \"XXXX\"\n    ],\n    \"version\": \"0.17.1\",\n    \"timestamp\": 1486413490\n  },\n  {...}, \n  {...},\n...\n]\n</code></pre>\n\n<p>And am parsing the array as the following :</p>\n\n<pre><code>type Client struct {\n    Name string `json:\"name\"`\n    Address string `json:\"address\"`\n    PublicDNS string `json:\"publicDNS\"`\n    keepalive [] string `json:\"keepalive\"`\n    Subscriptions [] string `json:\"subscriptions\"`\n    Version string `json:\"version\"`\n    Timestamp int64 `json:\"timestamp\"`\n}\n\ntype ClientResponse []Client\n\n\nfunc getClients(body []byte) (*ClientResponse, error) {\n    var s = new(ClientResponse)\n    err := json.Unmarshal(body, &amp;s)\n    if(err != nil){\n        fmt.Println(\"whoops:\", err)\n    }\n    return s, err\n}\n\n\nfunc main() {\n    res,err := http.Get(\"http://xxxxx:4567/clients\")\n    if err != nil{\n        panic(err.Error())\n    }\n\n    body,err := ioutil.ReadAll(res.Body)\n    if err != nil{\n        panic(err.Error())\n    }\n    s, err := getClients([]byte(body))  \n    fmt.Println(s)\n}\n</code></pre>\n\n<p>Problem : variable s , contain all arrays . so how can i get lets say name value for all arrays ? should i do for loop and get values i need ? is this the best approach ? </p>\n"}, {"tags": ["arrays", "json", "go", "struct"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1486416293, "post_id": 42077426, "comment_id": 71326562, "body": "Wouldn&#39;t you just need to add a <code>.A</code> to the end of your current print to get the <code>A</code> field?"}, {"owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1486416607, "post_id": 42077426, "comment_id": 71326734, "body": "I tried doing that but it didn&#39;t work for some reason. Anyway, thanks for trying to help. The comment below has solved my problem."}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "edited": false, "score": 0, "creation_date": 1486416508, "post_id": 42077527, "comment_id": 71326687, "body": "I&#39;m quite new to Go and the structs but this is great. It works. Thanks a lot!"}, {"owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "edited": false, "score": 0, "creation_date": 1486836128, "post_id": 42077527, "comment_id": 71521687, "body": "What if A is an &quot;interface{}&quot; instead of an &quot;int&quot;. My api call sometimes returns a null value and I need to be able to handle that response in the struct. I know how to store &quot;J&quot; float64 to a variable however, if J is null, I get an error. I changed J float64 to J interface{}. But not sure how to store the interface{} value to a variable"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "edited": false, "score": 0, "creation_date": 1487004817, "post_id": 42077527, "comment_id": 71579848, "body": "If <code>J</code> is an <code>interface{}</code>, you need to check it for nil, then type assert it to whatever type you what.  Example: <a href=\"https://play.golang.org/p/inXq03UDUL\" rel=\"nofollow noreferrer\">play.golang.org/p/inXq03UDUL</a>"}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 1, "last_activity_date": 1486416350, "creation_date": 1486416350, "answer_id": 42077527, "question_id": 42077426, "link": "https://stackoverflow.com/questions/42077426/how-to-parse-structs-in-golang-and-print-the-items-from-the-struct/42077527#42077527", "title": "how to parse structs in golang and print the items from the struct?", "body": "<p>You can simply omit any piece of the structure you don't care about.  The JSON package will silently ignore anything present in the source JSON that isn't present in the destination structure.  Thus if you don't care about the Data portion, omit it from the structure.  If you only care about A and J in the stats section, only include those.  </p>\n\n<pre><code>type response struct {\n    Response []struct {\n        Stats struct {\n            A int `json:\"a\"`\n            J float64 `json:\"j\"`\n        } `json:\"stats\"`\n    } `json:\"response\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/W3bmlf15sF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/W3bmlf15sF</a></p>\n\n<p>Edit: Also worth noting that you don't need to include the struct tags if they are just lowercases of the field names, as the JSON package will match fields that only differ by capitalization (though it prefers exact matches, if there's ambiguity).</p>\n"}], "owner": {"reputation": 57, "user_id": 5081941, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ebbaa05eb3f2fece6685b69bebf6b564?s=128&d=identicon&r=PG&f=1", "display_name": "shishh03", "link": "https://stackoverflow.com/users/5081941/shishh03"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2426, "favorite_count": 0, "accepted_answer_id": 42077527, "answer_count": 1, "score": 1, "last_activity_date": 1486416350, "creation_date": 1486415962, "last_edit_date": 1495540899, "question_id": 42077426, "link": "https://stackoverflow.com/questions/42077426/how-to-parse-structs-in-golang-and-print-the-items-from-the-struct", "title": "how to parse structs in golang and print the items from the struct?", "body": "<p>Here is a similar example: <a href=\"https://stackoverflow.com/questions/35970395/parsing-json-in-golang-into-struct\">Parsing JSON in GoLang into struct</a>\nI am getting a json response from the server and I only need to get certain data.\nI've created a sample code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype response struct {\n    Response []struct {\n        Stats struct {\n            A int `json:\"a\"`\n            B float64 `json:\"b\"`\n            C int `json:\"c\"`\n            D float64 `json:\"d\"`\n            E float64 `json:\"e\"`\n            F float64 `json:\"f\"`\n            G float64 `json:\"g\"`\n            H float64 `json:\"h\"`\n            I float64 `json:\"i\"`\n            J float64 `json:\"j\"`\n        } `json:\"stats\"`\n        Data []struct {\n            Num0 int64 `json:\"0\"`\n            Num1 interface{} `json:\"1\"`\n        } `json:\"data\"`\n    } `json:\"response\"`\n}\n\n\nfunc main() {\n    src := `\n{\n    \"response\": [{\n            \"stats\": {\n                \"a\": 458,\n                \"b\": 302.3738,\n                \"c\": 0,\n                \"d\": 706.777,\n                \"e\": 2.423,\n                \"f\": 238.73375,\n                \"g\": 68.971,\n                \"h\": 85.1989781659389,\n                \"i\": 84.6381777592766,\n                \"j\": 292658.49\n            },\n            \"data\": [\n                [1453222860000, null],\n                [1453223160000, 3.769],\n                [1453223220000, 37.464]\n            ]\n        }\n    ]\n}\n`\n\n    var g response\n    json.Unmarshal([]byte(src), &amp;g)\n    fmt.Println(g.Response[0].Stats)  \n}\n</code></pre>\n\n<p>The output I get is </p>\n\n<pre><code>`{458 302.3738 0 706.777 2.423 238.73375 68.971 85.1989781659389 84.6381777592766 292658.49}\n</code></pre>\n\n<p>`</p>\n\n<p>I want to get certain items from just the stat struct. Let's say I want to print the value of A or J from the stats struct. How do I do that?\nI don't really need the data struct. The json response I got from the server gave me those data but I dont really need it. Anyway, my question is how do I get only certain items only in the Stats struct?</p>\n\n<p>Any suggestion on how to do this or even improve my structs format?\nThanks!</p>\n"}, {"tags": ["macos", "go", "upgrade"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486411893, "post_id": 42076405, "comment_id": 71324241, "body": "which is the output of <code>type go</code>, and <code>go env</code>?"}, {"owner": {"reputation": 173, "user_id": 7376505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1553eacd3688712aba1292319b179d45?s=128&d=identicon&r=PG&f=1", "display_name": "Seth R", "link": "https://stackoverflow.com/users/7376505/seth-r"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486412469, "post_id": 42076405, "comment_id": 71324544, "body": "I lied. I deleted <code>usr&#47;local&#47;go</code>, but not <code>usr&#47;local&#47;bin&#47;go</code>. I just deleted both directories and ran the package installer again. Now <code>go version</code> tells me I am on 1.7.5 as expected and it looks like everything works."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1486415959, "post_id": 42076405, "comment_id": 71326391, "body": "Recommendation for the future: take a look at <a href=\"https://github.com/moovweb/gvm\" rel=\"nofollow noreferrer\">gvm</a>.  It works a lot like rvm or virtualenv for managing runtime versions, allowing hotswapping and easy version management for your Go runtime."}], "answers": [{"tags": [], "owner": {"reputation": 173, "user_id": 7376505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1553eacd3688712aba1292319b179d45?s=128&d=identicon&r=PG&f=1", "display_name": "Seth R", "link": "https://stackoverflow.com/users/7376505/seth-r"}, "is_accepted": true, "score": 1, "last_activity_date": 1486412715, "creation_date": 1486412715, "answer_id": 42076646, "question_id": 42076405, "link": "https://stackoverflow.com/questions/42076405/golang-1-6-2-wont-upgrade-on-osx-sierra/42076646#42076646", "title": "Golang 1.6.2 Won&#39;t Upgrade on OSX Sierra", "body": "<p>I was incorrect in my question. I actually deleted <code>usr/local/go</code>, not <code>usr/local/bin/go</code>. I went back and deleted both directories manually, then ran the 1.7.5 package installer again. After restarting my terminal window, <code>go version</code> now shows me I am on 1.7.5 and it appears to be running correctly when I compile my code.</p>\n\n<p>Still interesting that the package installer did not do this automatically like it said it would. This could work as a solution if someone else is having the same problem.</p>\n"}], "owner": {"reputation": 173, "user_id": 7376505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1553eacd3688712aba1292319b179d45?s=128&d=identicon&r=PG&f=1", "display_name": "Seth R", "link": "https://stackoverflow.com/users/7376505/seth-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "accepted_answer_id": 42076646, "answer_count": 1, "score": 1, "last_activity_date": 1486412715, "creation_date": 1486411807, "question_id": 42076405, "link": "https://stackoverflow.com/questions/42076405/golang-1-6-2-wont-upgrade-on-osx-sierra", "title": "Golang 1.6.2 Won&#39;t Upgrade on OSX Sierra", "body": "<p>I just upgraded to OSX Sierra from El Capitan. As such, I also need to upgrade my Golang compiler from 1.6.2 since it does not support Sierra.</p>\n\n<p>I downloaded the latest 1.7.5 pkg installer and ran it, getting the prompt that it would remove previous versions of Go, and it said it was successful. But when I run <code>go version</code> it still says <code>go1.6.2 darwin/amd6</code>.</p>\n\n<p>I have gone so far as to manually delete my <code>/usr/local/bin/go</code> directory and run the 1.7.5 installer again, but <code>go version</code> still says <code>go1.6.2 darwin/amd6</code>. I have also restarted my terminal window and even the full computer between attempts.</p>\n\n<p>What is going wrong? How can I get my Go compiler to update?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2074, "user_id": 1279231, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/fbfc951121f17d11ad96275a87fe5df1?s=128&d=identicon&r=PG", "display_name": "jakebird451", "link": "https://stackoverflow.com/users/1279231/jakebird451"}, "edited": false, "score": 0, "creation_date": 1486409330, "post_id": 42075549, "comment_id": 71322877, "body": "The third option, creating a reference to the original, was what I needed. In my actual project, the main list contains members that change. The secondary lists need to be associated to those struct instances as they change."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1486408625, "creation_date": 1486408625, "answer_id": 42075549, "question_id": 42075480, "link": "https://stackoverflow.com/questions/42075480/duplicating-a-list-to-a-list-with-pointers/42075549#42075549", "title": "Duplicating a list to a list with pointers", "body": "<p>You're adding the address of the same <code>x</code> in every call to <code>append</code>. </p>\n\n<p>You could initialize a new <code>x</code> and copy the value:</p>\n\n<pre><code>for _, x := range main_list {\n    x := x\n    second_list = append(second_list, &amp;x)\n}\n</code></pre>\n\n<p>Or create a new <code>x</code> directly indexing the slice:</p>\n\n<pre><code>for i := range main_list {\n    x := main_list[i]\n    second_list = append(second_list, &amp;x)\n}\n</code></pre>\n\n<p>Or if you want the address of the original value in the slice, you can use:</p>\n\n<pre><code>for i := range main_list {\n    second_list = append(second_list, &amp;main_list[i])\n}\n</code></pre>\n"}], "owner": {"reputation": 2074, "user_id": 1279231, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/fbfc951121f17d11ad96275a87fe5df1?s=128&d=identicon&r=PG", "display_name": "jakebird451", "link": "https://stackoverflow.com/users/1279231/jakebird451"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31, "favorite_count": 0, "accepted_answer_id": 42075549, "answer_count": 1, "score": 1, "last_activity_date": 1486408625, "creation_date": 1486408369, "question_id": 42075480, "link": "https://stackoverflow.com/questions/42075480/duplicating-a-list-to-a-list-with-pointers", "title": "Duplicating a list to a list with pointers", "body": "<p>I have simplified the problem incredibly to a small runnable example of my issue, shown below:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype A struct {\n    Name string\n}\n\nfunc main() {\n    main_list := []A{A{\"1\"}, A{\"b\"}, A{\"3\"}}\n    second_list := make([]*A, 0)\n    fmt.Println(\"FIRST LIST:\")\n    for _, x := range main_list {\n        fmt.Println(x.Name)\n        second_list = append(second_list, &amp;x)\n    }\n    fmt.Println(\"SECOND LIST:\")\n    for _, x := range second_list {\n        fmt.Println((*x).Name)\n    }\n}\n</code></pre>\n\n<p>Which provides:</p>\n\n<pre><code>FIRST LIST:\n1\nb\n3\nSECOND LIST:\n3\n3\n3\n</code></pre>\n\n<p>The simple task is creating <code>main_list</code> with some dummy structs. The real issue is creating references (pointers) from the values in <code>main_list</code> into <code>second_list</code>. <strong>I absolutely do not want copies of the structs</strong>, only pointers/references to the <code>main_list</code> structs. The second for loop iterates through the newly populated <code>second_list</code> and shows only the last value from <code>main_list</code> (<code>3</code> in this example) three times.</p>\n\n<p>I expect the issue arrises with the way I am using <code>&amp;x</code> in the first loop. With the way I get all three values of <code>second_list</code> to all be the same struct instance; I am going to assume that I actually made a pointer to the for-loop's iterator (as if it were a reference?). So all the pointers in <code>second_list</code> will always be the last item referenced in the first loop.</p>\n\n<p><strong>The question</strong>: How could I make a pointer from what <code>x</code> was pointing to at that moment in the for loop?</p>\n"}, {"tags": ["variables", "go", "static"], "comments": [{"owner": {"reputation": 216447, "user_id": 846892, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/E9dZn.png?s=128&g=1", "display_name": "Ashwini Chaudhary", "link": "https://stackoverflow.com/users/846892/ashwini-chaudhary"}, "edited": false, "score": 0, "creation_date": 1486405569, "post_id": 42074611, "comment_id": 71320781, "body": "<code>if-else</code> blocks have their own scope. <code>dat</code> is not visible outside of them. You can declare <code>var dat []byte</code> before <code>if (bundled == &quot;true&quot;)</code> to fix it. Read: <a href=\"https://dave.cheney.net/2016/12/15/declaration-scopes-in-go\" rel=\"nofollow noreferrer\">Declaration scopes in Go</a>"}, {"owner": {"reputation": 1745, "user_id": 3888307, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/65d6a22ea2fb9fb7a3d78bd57b9d71ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3888307", "link": "https://stackoverflow.com/users/3888307/user3888307"}, "reply_to_user": {"reputation": 216447, "user_id": 846892, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/E9dZn.png?s=128&g=1", "display_name": "Ashwini Chaudhary", "link": "https://stackoverflow.com/users/846892/ashwini-chaudhary"}, "edited": false, "score": 0, "creation_date": 1486405672, "post_id": 42074611, "comment_id": 71320839, "body": "How could a declare dat in such a way that I could complete this request. Is there a way to create a place holder. I didn&#39;t realize the if/else were in their own space. Interesting"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486405993, "post_id": 42074611, "comment_id": 71321035, "body": "declare the variables in the scope you want. For reference: <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Declarations_and_scope</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1745, "user_id": 3888307, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/65d6a22ea2fb9fb7a3d78bd57b9d71ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3888307", "link": "https://stackoverflow.com/users/3888307/user3888307"}, "edited": false, "score": 0, "creation_date": 1486406099, "post_id": 42074802, "comment_id": 71321100, "body": "Okay, I got it to compile, see if it works. I had to declare this beforehand      dat:= []byte{}"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1486417726, "post_id": 42074802, "comment_id": 71327302, "body": "It&#39;s recommended to prefer <code>var dat []byte</code> over <code>dat := []byte{}</code>.  Main reason is that the former defines a <i>nil</i> slice while the latter defines an <i>empty</i> slice.  Not only does this make checking the slice easier, but it avoids allocating the slice until you append something to it (and in this case, you&#39;d just be throwing away the original allocation anyway).  Also, you&#39;ll want to declare the <code>err</code> variable beforehand and completely eliminate the short-form assignment in the if statement, or you&#39;ll just end up masking the <code>dat</code> variable instead."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1569680217, "post_id": 42074802, "comment_id": 102678796, "body": "@Kaedys <code>@dat := []byte{}</code> does not allocate memory."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1569782172, "post_id": 42074802, "comment_id": 102698673, "body": "<code>dat := []byte{}</code> has identical effect to <code>dat := make([]byte, 0).  It doesn&#39;t allocate any space, but it *does* assign an address to the pointer in the slice header (pointing to a 0-length array that takes up no memory).  This is, technically, more expensive than simply creating the slice header itself, and is also useless, since </code>append()` still has to make a new array on the first call anyway.  It&#39;s also uglier, but that&#39;s just me.  Also, <code>dat == nil</code> is only true for the <code>var</code> version.  Lastly, <code>golint</code> specifically checks for and complains about empty literals like that."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1569782274, "post_id": 42074802, "comment_id": 102698708, "body": "The major use case for an empty slice (either empty literal or <code>make([]type, 0)</code>, though the latter is preferred) is if the program is returning the slice (directly, or as part of a larger data structure) via an API encoding system like JSON or Thrift or some such.  In those cases, a <code>nil</code> slice is encoded as <code>null</code> in most encodings, while an empty slice is encoded as <code>[ ]</code> (or the equivalent in whatever encoding you&#39;re using)."}], "tags": [], "owner": {"reputation": 216447, "user_id": 846892, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/E9dZn.png?s=128&g=1", "display_name": "Ashwini Chaudhary", "link": "https://stackoverflow.com/users/846892/ashwini-chaudhary"}, "is_accepted": true, "score": 2, "last_activity_date": 1486406012, "creation_date": 1486406012, "answer_id": 42074802, "question_id": 42074611, "link": "https://stackoverflow.com/questions/42074611/if-else-condition-defines-variable-undefined-dat-variable/42074802#42074802", "title": "if/else condition defines variable. undefined: dat (variable)", "body": "<p><code>if-else</code> blocks have their own scope. In your case <code>dat</code>is not visible outside of them.</p>\n\n<p>You can declare <code>var dat []byte</code> before <code>if (bundled == \"true\")</code> to fix it.</p>\n\n<p>Docs: <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Declarations_and_scope</a></p>\n\n<p>You may also want to read: <a href=\"https://dave.cheney.net/2016/12/15/declaration-scopes-in-go\" rel=\"nofollow noreferrer\">Declaration scopes in Go</a></p>\n"}], "owner": {"reputation": 1745, "user_id": 3888307, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/65d6a22ea2fb9fb7a3d78bd57b9d71ea?s=128&d=identicon&r=PG&f=1", "display_name": "user3888307", "link": "https://stackoverflow.com/users/3888307/user3888307"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 541, "favorite_count": 0, "accepted_answer_id": 42074802, "answer_count": 1, "score": 0, "last_activity_date": 1486406012, "creation_date": 1486405233, "question_id": 42074611, "link": "https://stackoverflow.com/questions/42074611/if-else-condition-defines-variable-undefined-dat-variable", "title": "if/else condition defines variable. undefined: dat (variable)", "body": "<p>I know this is a basic question, but I'm curious why the code below does not work. There is no use case where this variable would not be declared.</p>\n\n<pre><code>if (bundled == \"true\") {\n            dat, err := Asset(\"index.html\")\n        } else {\n            dat, err := ioutil.ReadFile(\"./index.html\")\n\n        }\n        if ( err != nil) {\n            os.Exit(0)\n        }\n\n        t, _ = t.Parse(string(dat))\n        p := Person{Scope: \"\"}\n        t.Execute(w, p)\n</code></pre>\n\n<p>I get the error</p>\n\n<pre><code>.\\run.go:262: undefined: dat\n</code></pre>\n\n<p>I'm sure it's just basic GOLANG stuff I'm still learning.</p>\n\n<p>Thanks for your support</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 216447, "user_id": 846892, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/E9dZn.png?s=128&g=1", "display_name": "Ashwini Chaudhary", "link": "https://stackoverflow.com/users/846892/ashwini-chaudhary"}, "edited": false, "score": 4, "creation_date": 1486404735, "post_id": 42074316, "comment_id": 71320294, "body": "You can use basic JSON unmarshalling here."}, {"owner": {"reputation": 753, "user_id": 3911474, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/9nKHU.gif?s=128&g=1", "display_name": "Firedrake969", "link": "https://stackoverflow.com/users/3911474/firedrake969"}, "edited": false, "score": 2, "creation_date": 1486406679, "post_id": 42074316, "comment_id": 71321417, "body": "<a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Unmarshal</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4171, "user_id": 3258698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f432d577e5550e36ec267b85884364?s=128&d=identicon&r=PG", "display_name": "hbejgel", "link": "https://stackoverflow.com/users/3258698/hbejgel"}, "edited": false, "score": 1, "creation_date": 1486412111, "post_id": 42075550, "comment_id": 71324369, "body": "You don&#39;t need all this overhead of declaring a type, you can Unmarshal directly in an int slice: <a href=\"https://play.golang.org/p/3VgfnPo7Hz\" rel=\"nofollow noreferrer\">play.golang.org/p/3VgfnPo7Hz</a>"}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 0, "last_activity_date": 1486409263, "last_edit_date": 1486409263, "creation_date": 1486408637, "answer_id": 42075550, "question_id": 42074316, "link": "https://stackoverflow.com/questions/42074316/convert-string-to-array-of-integers-in-golang/42075550#42075550", "title": "Convert string to array of integers in golang", "body": "<p>Here is a working example if you haven't figured it out based on the comments suggesting that you use <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">json.Unmarshal</a></p>\n\n<p><a href=\"https://play.golang.org/p/t42PPlZXZX\" rel=\"nofollow noreferrer\">Playground link</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    str := \"[2,15,23]\"\n    ints, err := convertToIntSlice(str)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%v\", ints)\n}\n\ntype IntSlice struct {\n    Ints []int\n}\n\nfunc convertToIntSlice(s string) ([]int, error) {\n    a := &amp;IntSlice{}\n    err := json.Unmarshal([]byte(`{\"Ints\":`+s+\"}\"), a)\n    return a.Ints, err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 326, "user_id": 4500198, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a15a842a58c015610ac68e55ed7b4560?s=128&d=identicon&r=PG", "display_name": "Alex Smith", "link": "https://stackoverflow.com/users/4500198/alex-smith"}, "is_accepted": false, "score": 0, "last_activity_date": 1486408735, "creation_date": 1486408735, "answer_id": 42075578, "question_id": 42074316, "link": "https://stackoverflow.com/questions/42074316/convert-string-to-array-of-integers-in-golang/42075578#42075578", "title": "Convert string to array of integers in golang", "body": "<p>This is slightly hackish but you could treat it like a csv:</p>\n\n<pre><code>import (\n    \"encoding/csv\"\n    \"strings\"\n)\n\nin := `\"[2,15,23]\"`\nr := csv.NewReader(strings.NewReader(in))\n\nrecords, err := r.ReadAll()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4171, "user_id": 3258698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/68f432d577e5550e36ec267b85884364?s=128&d=identicon&r=PG", "display_name": "hbejgel", "link": "https://stackoverflow.com/users/3258698/hbejgel"}, "is_accepted": true, "score": 4, "last_activity_date": 1486412060, "creation_date": 1486412060, "answer_id": 42076472, "question_id": 42074316, "link": "https://stackoverflow.com/questions/42074316/convert-string-to-array-of-integers-in-golang/42076472#42076472", "title": "Convert string to array of integers in golang", "body": "<p>A better way using <code>json.Unmarshal</code>:</p>\n\n<pre><code>func main() {\n    str := \"[2,15,23]\"\n    var ints []int\n    err := json.Unmarshal([]byte(str), &amp;ints)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%v\", ints)\n}\n</code></pre>\n"}], "owner": {"reputation": 151, "user_id": 7029834, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8c25080bfc77d7dd21c3249b39c556f0?s=128&d=identicon&r=PG&f=1", "display_name": "CodeL", "link": "https://stackoverflow.com/users/7029834/codel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8350, "favorite_count": 0, "accepted_answer_id": 42076472, "answer_count": 3, "score": 0, "last_activity_date": 1486412060, "creation_date": 1486404058, "question_id": 42074316, "link": "https://stackoverflow.com/questions/42074316/convert-string-to-array-of-integers-in-golang", "title": "Convert string to array of integers in golang", "body": "<p>I am looking for an answer in internet but it no one that fit my needs.</p>\n\n<p>I have a string in the following format:</p>\n\n<pre><code>\"[2,15,23]\"\n</code></pre>\n\n<p>and i am trying to convert it in this format:</p>\n\n<pre><code>[2,15,23]\n</code></pre>\n\n<p>I need the type after the convertion to change to []int. I need to convert it because i want to use it later to make an interface type to use it in a sql query as param.</p>\n\n<p>Is there any way to convert it? </p>\n\n<p>Thanks</p>\n"}, {"tags": ["networking", "go", "tcp", "network-programming"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486401771, "post_id": 42073413, "comment_id": 71318524, "body": "Reading into a zero-length slice doesn&#39;t do anything."}, {"owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "edited": false, "score": 0, "creation_date": 1486419616, "post_id": 42073413, "comment_id": 71328250, "body": "as JimB said  <code>b, err := conn.Read([]byte{})</code> you&#39;re reading an empty data here"}, {"owner": {"reputation": 41, "user_id": 3041875, "user_type": "registered", "profile_image": "https://graph.facebook.com/1162946962/picture?type=large", "display_name": "plambein", "link": "https://stackoverflow.com/users/3041875/plambein"}, "edited": false, "score": 0, "creation_date": 1486453628, "post_id": 42073413, "comment_id": 71339090, "body": "That seems to be the solutions indeed.. I misread the example that was reading a byte with the name &quot;one&quot;.. The new output is: <code>Read 0 bytes with err EOF</code> after the client closes, which I expected. Thanks!"}], "owner": {"reputation": 41, "user_id": 3041875, "user_type": "registered", "profile_image": "https://graph.facebook.com/1162946962/picture?type=large", "display_name": "plambein", "link": "https://stackoverflow.com/users/3041875/plambein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3700, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1486400960, "creation_date": 1486400960, "last_edit_date": 1495540899, "question_id": 42073413, "link": "https://stackoverflow.com/questions/42073413/golang-tcp-connection-close-doesnt-give-an-eof", "title": "Golang TCP connection close doesn&#39;t give an EOF", "body": "<p>This is actually a follow up on this question: <a href=\"https://stackoverflow.com/questions/12741386/how-to-know-tcp-connection-is-closed-in-golang-net-package\">How to know TCP connection is closed in Golang net package?</a> which doesn't work in my implementation, and I'm trying to figure out why.</p>\n\n<p>The idea is, I have a server that accepts TCP connections and waits for the client to close them. It waits for 5 seconds, and every second it tries to read from the TCP connection, if this gives an EOF error, that would indicate that the client has closed the connection.</p>\n\n<p>This is the servers code:</p>\n\n<pre><code>func server(done chan bool) {\n    l, _ := net.Listen(\"tcp\", serverAddress)\n\n    // Listen for incomming TCP connections\n    conn, err := l.Accept()\n    if err != nil {\n        log.Fatalf(\"l.Accept(): got error on accept: %v\", err)\n    }\n    defer conn.Close()\n\n    // Read periodically from the TCP connection to see if we can find\n    // out when the client has closed his end.\n    go func() {\n        for {\n            conn.SetReadDeadline(time.Now().Add(10 * time.Millisecond))\n            b, err := conn.Read([]byte{})\n            fmt.Printf(\"Read %v bytes with err %v \\n\", b, err)\n            if err == io.EOF {\n                conn.Close()\n                conn = nil\n                break\n            } else {\n                var zero time.Time\n                conn.SetReadDeadline(zero)\n            }\n            time.Sleep(1 * time.Second)\n        }\n        done &lt;- true\n    }()\n\n    // Do this for 5 seconds, than quit\n    time.Sleep(5 * time.Second)\n    done &lt;- true\n}\n</code></pre>\n\n<p>So the client sets up a connection, waits for two seconds and then closes it. The clients code is as follows:</p>\n\n<pre><code>func main() {\n    done := make(chan bool, 1)\n    go server(done)\n\n    // Give the listener some time to set up\n    time.Sleep(200 * time.Millisecond)\n\n    // Dial the server\n    conn, err := net.Dial(\"tcp\", serverAddress)\n    if err != nil {\n        log.Fatalf(\"net.Dial(): got %v, want no error\", err)\n    }\n    defer conn.Close()\n\n    go func() {\n        // After two seconds, close the TCP connection to the server\n        time.Sleep(2 * time.Second)\n        fmt.Printf(\"Client closes conn now with err %v\\n\", conn.Close())\n    }()\n\n    // Wait untill server is done\n    &lt;-done\n}\n</code></pre>\n\n<p>I would expect that the server would get an EOF error when reading, after the client has closed the connection, however the output I get is:</p>\n\n<pre><code>Read 0 bytes with err &lt;nil&gt; \nRead 0 bytes with err &lt;nil&gt; \nClient closes conn now with err &lt;nil&gt;\nRead 0 bytes with err &lt;nil&gt; \nRead 0 bytes with err &lt;nil&gt; \nRead 0 bytes with err &lt;nil&gt; \n</code></pre>\n\n<p>I have the wireshark output here. It actually shows the FIN was send by the client (package 11), but only 3 seconds later the server sends it's own FIN:\n<a href=\"https://i.stack.imgur.com/AGUnV.png\" rel=\"nofollow noreferrer\">Wireshark output</a></p>\n\n<p>So basically I can't figure out why I'm not getting any error on the read on the servers side.</p>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 1, "creation_date": 1486397629, "post_id": 42072214, "comment_id": 71315978, "body": "I guess, <code>[16]string</code> isn&#39;t actually fixed size?"}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1486398088, "post_id": 42072214, "comment_id": 71316303, "body": "@CeriseLim&#243;n that is right. I needed to write a string of max size 16 bytes, and pad it with \\0 if it doesn&#39;t reach 16 in length :)"}], "answers": [{"comments": [{"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1486398021, "post_id": 42072427, "comment_id": 71316256, "body": "While I was re-reading my question, I actually realized this problem <code>[16]string</code> and have changed it to <code>[16]byte</code> in my code. But, I honestly didn&#39;t know how to initialize it anymore. I even tried: <code>username: [16]byte{&quot;username&quot;},</code>. Anyway, I&#39;ll accept this answer ASAP."}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1486398236, "post_id": 42072427, "comment_id": 71316404, "body": "@CeriseLim&#243;n yes, I did see that :)"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1486402666, "post_id": 42072427, "comment_id": 71319068, "body": "@majidarif Unfortunately, since these are <i>arrays</i> rather than slices, the only way to set those fields using a string is with the <code>copy()</code> syntax that @Ainar-G used: <code>copy(l.Username[:], &quot;username&quot;)</code>.  That syntax makes a slice header that points at the <code>Username</code> array, then copies the string into that slice (and thus the underlying array, where you want it)."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 3, "last_activity_date": 1486397874, "creation_date": 1486397874, "answer_id": 42072427, "question_id": 42072214, "link": "https://stackoverflow.com/questions/42072214/convert-struct-to-byte-with-go/42072427#42072427", "title": "Convert struct to []byte with Go", "body": "<p>You have two errors in your code. Firstly, your struct fields should be exported for <code>encoding/binary</code> to see it.</p>\n\n<p>Secondly, <code>[16]string</code> means an array of 16 strings, not a 16-byte string. So your struct should look like this:</p>\n\n<pre><code>type login struct {\n    Seq      uint8\n    ID       uint16\n    Username [16]byte\n    Password [16]byte\n    Unknown1 [16]byte\n}\n</code></pre>\n\n<p>Then it works: <a href=\"https://play.golang.org/p/Nq8fRqgkcp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Nq8fRqgkcp</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 902, "user_id": 1280277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00a5cdc5051fe6c137f4dfb343fdda8e?s=128&d=identicon&r=PG", "display_name": "amenzhinsky", "link": "https://stackoverflow.com/users/1280277/amenzhinsky"}, "is_accepted": false, "score": 3, "last_activity_date": 1494845206, "creation_date": 1494845206, "answer_id": 43977521, "question_id": 42072214, "link": "https://stackoverflow.com/questions/42072214/convert-struct-to-byte-with-go/43977521#43977521", "title": "Convert struct to []byte with Go", "body": "<p>You can do that using the <code>unsafe</code> package.</p>\n\n<pre><code>type test struct {\n    a int\n    s string\n}\n\nv1 := test{\n    a: 5,\n    s: \"sdaf\",\n}\n\nfmt.Printf(\"v1: %#v\\n\", v1)\n\nb := *(*[unsafe.Sizeof(v1)]byte)(unsafe.Pointer(&amp;v1))\nfmt.Printf(\"bytes: %#v\\n\", b)\n\nv2 := *(*test)(unsafe.Pointer(&amp;b))\n\nfmt.Printf(\"v2: %#v\\n\", v2)\n</code></pre>\n"}], "owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7529, "favorite_count": 1, "accepted_answer_id": 42072427, "answer_count": 2, "score": 5, "last_activity_date": 1494845206, "creation_date": 1486397234, "question_id": 42072214, "link": "https://stackoverflow.com/questions/42072214/convert-struct-to-byte-with-go", "title": "Convert struct to []byte with Go", "body": "<p>I have a packet structure and I wish to serialize it into binary so I can send it through the wire.</p>\n\n<p>There are many packet structures but I'll give the login packet as an example:</p>\n\n<pre><code>login struct {\n    seq      uint8\n    id       uint16\n    username [16]string\n    password [16]string\n    unknown1 [16]byte\n}\n</code></pre>\n\n<p>I've read somewhere that you can't use <code>binary.Write</code> for non-fixed size structures. But I believe my structure is fixed size (correct me if I'm wrong, I could be very wrong).</p>\n\n<p>Now using this code:</p>\n\n<pre><code>var buf bytes.Buffer\nx := login{\n    seq:      2,\n    id:       1,\n    username: [16]string{\"username\"},\n    password: [16]string{\"password\"},\n}\nerr := binary.Write(&amp;buf, binary.LittleEndian, x)\nif err != nil {\n    log.Fatalln(err)\n}\n</code></pre>\n\n<p>Gives me the error: <code>binary.Write: invalid type main.login</code></p>\n\n<p>Now, is there a way to fix this? Is there an alternative approach? Much like how you can use structs in C and send it through the network.</p>\n"}, {"tags": ["go", "neo4j", "cypher"], "answers": [{"comments": [{"owner": {"reputation": 882, "user_id": 1389683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7075af295df98a008adeb64d2e09e6e7?s=128&d=identicon&r=PG", "display_name": "mzimmerman", "link": "https://stackoverflow.com/users/1389683/mzimmerman"}, "edited": false, "score": 0, "creation_date": 1486414074, "post_id": 42072855, "comment_id": 71325329, "body": "Unfortunately, I think you&#39;re right and I was leaning that way already.  Because my charts can get rather large, I was hoping to simplify it (at least for viewing graphically).  Given your suggested data model, Is there any way to query where I would get JSESSION id as a relation and not a node? I.e., (a)-[:jsid]-(b) instead of (a)--(jsid)--(b)?"}, {"owner": {"reputation": 26608, "user_id": 92359, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/664d3d4c50c731d90a32db5f9e01b4b9?s=128&d=identicon&r=PG", "display_name": "InverseFalcon", "link": "https://stackoverflow.com/users/92359/inversefalcon"}, "reply_to_user": {"reputation": 882, "user_id": 1389683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7075af295df98a008adeb64d2e09e6e7?s=128&d=identicon&r=PG", "display_name": "mzimmerman", "link": "https://stackoverflow.com/users/1389683/mzimmerman"}, "edited": false, "score": 0, "creation_date": 1486414716, "post_id": 42072855, "comment_id": 71325690, "body": "I don&#39;t think so. Especially because relationships require two nodes, dangling relationships aren&#39;t allowed in Neo4j, so you wouldn&#39;t be able to save this info if only one node is using the session id. Also, you&#39;d need to figure out how this will scale with multiple email nodes using the same id. If there are 5 of them, how do you model this? Interconnect all 5 nodes to each other? That doesn&#39;t seem efficient. You&#39;d need to probably create some relationship chain. You also wouldn&#39;t be able to do fast lookups by session id, at least not with schema indexes. Legacy indexes might work though."}], "tags": [], "owner": {"reputation": 26608, "user_id": 92359, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/664d3d4c50c731d90a32db5f9e01b4b9?s=128&d=identicon&r=PG", "display_name": "InverseFalcon", "link": "https://stackoverflow.com/users/92359/inversefalcon"}, "is_accepted": true, "score": 1, "last_activity_date": 1486414227, "last_edit_date": 1486414227, "creation_date": 1486399145, "answer_id": 42072855, "question_id": 42071805, "link": "https://stackoverflow.com/questions/42071805/modeling-relationships-in-neo4j-when-they-arent-known-initially/42072855#42072855", "title": "Modeling relationships in neo4j when they aren&#39;t known initially", "body": "<p>Sounds like you should model JSESSIONID as nodes rather than as relationships, as that will allow you to link the JSESSIONID to multiple email addresses, and you can add a unique constraint on the id for fast lookups.</p>\n\n<pre><code>MERGE (a:EMAIL {label:userA@host.com}) \nMERGE (b:EMAIL {label:userB@host.com}) \nMERGE (jsid:JSESSIONID {id:'asdfghjkl'})\nMERGE (a)-[:jsid]-&gt;(jsid)\nMERGE (b)-[:jsid]-&gt;(jsid)\n</code></pre>\n\n<p>Your queries to find all :EMAIL nodes using a specific JSESSION id should be quite fast:</p>\n\n<pre><code>MATCH (email:EMAIL)-[:jsid]-&gt;(jsid:JSESSIONID {id:'asdfghjkl'})\nRETURN email\n</code></pre>\n"}], "owner": {"reputation": 882, "user_id": 1389683, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7075af295df98a008adeb64d2e09e6e7?s=128&d=identicon&r=PG", "display_name": "mzimmerman", "link": "https://stackoverflow.com/users/1389683/mzimmerman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 42072855, "answer_count": 1, "score": 0, "last_activity_date": 1486414227, "creation_date": 1486396040, "question_id": 42071805, "link": "https://stackoverflow.com/questions/42071805/modeling-relationships-in-neo4j-when-they-arent-known-initially", "title": "Modeling relationships in neo4j when they aren&#39;t known initially", "body": "<p>I currently have some code that looks through various datasets and models electronic relationships between them.  E.g., JSESSIONID.</p>\n\n<p>I would like to model each user's interactions with an application where they have to submit unique identifiers.  E.g., email address.</p>\n\n<p>In processing logs of the application, I see emailA@host.com use the application with JSESSIONID asdfghjkl.  I then see emailB@host.com also use the applcation with JESSIONID asdfghjkl.  Finally, I see emailB@host.com use JSESSIONID qwertyuiop.</p>\n\n<p>In my go code, it's easy for me to process the logs and write out both emailA@host.com and emailB@host.com as Nodes and then write the JSESSIONID relationship between them.</p>\n\n<pre><code>MERGE (a:EMAIL {label:userA@host.com}) MERGE (b:EMAIL {label:userB@host.com}) MERGE (a)-[:asdfghjkl]-(b)\n</code></pre>\n\n<p>However, I don't know the best way to do this at scale. (i.e., Application logs are 1TB in size).  The limitation is memory -- I can't find all email addresses that use asdfghjkl as a SessionIDs without processing all the data, so I can't write out the relationship between them due to memory constraints.</p>\n\n<p>What I would really like to do is to write out something as is follows, but this obviously fails:</p>\n\n<pre><code>MERGE (a:EMAIL {label:userA@host.com}) (a)-[:asdfghjkl]\n</code></pre>\n\n<p>Then later:\n    MERGE (b:EMAIL {label:userB@host.com}) (b)-[:asdfghjkl]</p>\n\n<p>Can I create these relationships with a query after the fact?</p>\n"}, {"tags": ["java", "android", "go", "react-native", "gomobile"], "answers": [{"tags": [], "owner": {"reputation": 975, "user_id": 865779, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/sgNMc.png?s=128&g=1", "display_name": "Minty", "link": "https://stackoverflow.com/users/865779/minty"}, "is_accepted": true, "score": 0, "last_activity_date": 1486529571, "creation_date": 1486529571, "answer_id": 42104990, "question_id": 42071515, "link": "https://stackoverflow.com/questions/42071515/cannot-get-gomobile-binding-to-work-with-java/42104990#42104990", "title": "Cannot get gomobile binding to work with java", "body": "<p>Thanks to <a href=\"https://github.com/eliasnaur\" rel=\"nofollow noreferrer\">eliasnaur</a>. Finally, I got this working. As of go 1.7.* you dont have access to go package. Instead access your package directly like this</p>\n\n<p>Before:</p>\n\n<pre><code>import go.rngo.Rngo;\n</code></pre>\n\n<p>After:(Since 1.7.*)</p>\n\n<pre><code>import rngo.Rngo;\n</code></pre>\n"}], "owner": {"reputation": 975, "user_id": 865779, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/sgNMc.png?s=128&g=1", "display_name": "Minty", "link": "https://stackoverflow.com/users/865779/minty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 774, "favorite_count": 0, "accepted_answer_id": 42104990, "answer_count": 1, "score": 0, "last_activity_date": 1486529571, "creation_date": 1486395243, "last_edit_date": 1592644375, "question_id": 42071515, "link": "https://stackoverflow.com/questions/42071515/cannot-get-gomobile-binding-to-work-with-java", "title": "Cannot get gomobile binding to work with java", "body": "<p><strong>Go version</strong>: 1.7.5</p>\n<p><strong>GOPATH</strong> = <em>D:/GoWork</em></p>\n<p><strong>React Native</strong> version 0.41</p>\n<p>Code below is the binding go package at <em><strong>D:\\GoWork\\src\\rngo\\rngo\\rngo.go</strong></em></p>\n<p>Very simple, just returning a string</p>\n<pre><code>package rngo\n\n// RNcall is used to bind with RN\nfunc RNcall()  string {\n    return &quot;From Go platform&quot;\n}\n</code></pre>\n<p>Running the below command from &gt; <em><strong>D:\\GoWork\\src\\rngo</strong></em></p>\n<pre><code>gomobile bind -target android -o rngo.aar -v  .\n</code></pre>\n<p><em>Verbose Output below seems to be fine</em></p>\n<blockquote>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\classes.go</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\classes.h</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\classes.c</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gen\\src\\Java\\interfaces.go\nrngo/rngo</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\fakegopath\\pkg\\android_arm\\rngo\\rngo.a\nwrite C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\go_rngomain.go</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\go_main.go</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\androidlib\\main.go</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\android\\src\\main\\java\\rngo\\Rngo.java</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\java_rngo.c</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\rngo.h</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\android\\src\\main\\java\\go\\Universe.java</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\android\\src\\main\\java\\go\\error.java</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\java_universe.c</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\universe.h</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\seq_android.go</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\seq_android.c</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\seq.h</p>\n<p>write C:\\Users\\Minty\\AppData\\Local\\Temp\\gomobile-work-855641675\\gomobile_bind\\seq.go</p>\n<p>Java\n<em>/C</em>/Users/Minty/AppData/Local/Temp/gomobile-work-855641675/gomobile_bind command-line-arguments rngo/rngo Java</p>\n<p><em>/C</em>/Users/Minty/AppData/Local/Temp/gomobile-work-855641675/gomobile_bind command-line-arguments rngo/rngo Java</p>\n<p><em>/C</em>/Users/Minty/AppData/Local/Temp/gomobile-work-855641675/gomobile_bind command-line-arguments rngo/rngo Java</p>\n<p><em>/C</em>/Users/Minty/AppData/Local/Temp/gomobile-work-855641675/gomobile_bind</p>\n<p>/# <em>/C</em>/Users/Minty/AppData/Local/Temp/gomobile-work-855641675/gomobile_bind</p>\n<p>D:\\Android\\sdk\\ndk-bundle\\toolchains\\x86_64-4.9\\prebuilt\\windows-x86_64/lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin\\ld:\nwarning: skipping incompatible\nD:\\Android\\sdk\\ndk-bundle\\platforms\\android-21\\arch-x86_64/usr/lib/liblog.so\nwhile searching for log</p>\n<p>D:\\Android\\sdk\\ndk-bundle\\toolchains\\x86_64-4.9\\prebuilt\\windows-x86_64/lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin\\ld:\nwarning: skipping incompatible\nD:\\Android\\sdk\\ndk-bundle\\platforms\\android-21\\arch-x86_64/usr/lib/libdl.so\nwhile searching for dl</p>\n<p>D:\\Android\\sdk\\ndk-bundle\\toolchains\\x86_64-4.9\\prebuilt\\windows-x86_64/lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin\\ld:\nwarning: skipping incompatible\nD:\\Android\\sdk\\ndk-bundle\\platforms\\android-21\\arch-x86_64/usr/lib/libc.so\nwhile searching for c</p>\n<p>D:\\Android\\sdk\\ndk-bundle\\toolchains\\x86_64-4.9\\prebuilt\\windows-x86_64/lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin\\ld:\nwarning: skipping incompatible\nD:\\Android\\sdk\\ndk-bundle\\platforms\\android-21\\arch-x86_64/usr/lib/libdl.so\nwhile searching for dl</p>\n<p>command-line-arguments</p>\n<p>aar: AndroidManifest.xml</p>\n<p>aar: proguard.txt</p>\n<p>aar: classes.jar</p>\n<p>jar: META-INF/MANIFEST.MF</p>\n<p>jar: go/LoadJNI.class</p>\n<p>jar: go/Seq$GoObject.class</p>\n<p>jar: go/Seq$Proxy.class</p>\n<p>jar: go/Seq$Ref.class</p>\n<p>jar: go/Seq$RefMap.class</p>\n<p>jar: go/Seq$RefTracker.class</p>\n<p>jar: go/Seq.class jar: go/Universe$proxyerror.class jar:\ngo/Universe.class</p>\n<p>jar: go/error.class</p>\n<p>jar: rngo/Rngo.class</p>\n<p>aar: jni/armeabi-v7a/libgojni.so</p>\n<p>aar: jni/arm64-v8a/libgojni.so</p>\n<p>aar: jni/x86/libgojni.so</p>\n<p>aar: jni/x86_64/libgojni.so</p>\n<p>aar: R.txt</p>\n<p>aar: res/</p>\n</blockquote>\n<p><strong>Successfully created</strong> rngo.aar since there is no error message and I can see that file at <em><strong>D:\\GoWork\\src\\rngo\\rngo.aar</strong></em></p>\n<p>I then manually import rngo.aar file into React Native project from android studio</p>\n<ol>\n<li><strong>File &gt; New &gt; New Module &gt; Import .aar/.jar Package &gt; #give the path\nto rngo.aar#</strong></li>\n<li><strong>File &gt; Project Structure &gt; app &gt; Dependencies &gt;\n Module dependency &gt; rngo.aar</strong></li>\n</ol>\n<p>Inside IDE, in MainActivity.java I can successfully do <strong>'import go.rngo.*;'</strong>, but I cannot get <strong>'go.rngo.Rngo.RNcall()'</strong> or <strong>'go.rngo.Rngo;'</strong> to work</p>\n<p><a href=\"https://i.stack.imgur.com/4QHLT.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4QHLT.jpg\" alt=\"enter image description here\" /></a></p>\n<p>Building this android app throws error <strong>'cannot find symbol'</strong></p>\n<blockquote>\n<p><em><strong>D:\\RN\\gomobile\\android\\app\\src\\main\\java\\com\\gomobile\\RngoModule.java:10</strong></em>:\nerror: cannot find symbol</p>\n<p>import go.rngo;<br />\n^</p>\n<p>symbol:   class rngo<br />\nlocation: package go<br />\n1 error<br />\n:app:compileDebugJavaWithJavac FAILED</p>\n</blockquote>\n<p><a href=\"https://i.stack.imgur.com/vZA0h.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vZA0h.jpg\" alt=\"enter image description here\" /></a></p>\n<p><strong>Conclusion</strong></p>\n<p>I am doing something horribly wrong, that I cannot get this simple thing to work. I wasted whole day on google but with no avail. Hence I need help getting this to work. All I need is a simple go code with that connects to react native hasselfree.</p>\n<p><em><strong>Thanks for reading all this. I appreciate it.</strong></em></p>\n"}, {"tags": ["postgresql", "go", "plpgsql"], "answers": [{"tags": [], "owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "is_accepted": true, "score": 2, "last_activity_date": 1486426785, "last_edit_date": 1486426785, "creation_date": 1486426367, "answer_id": 42079586, "question_id": 42070023, "link": "https://stackoverflow.com/questions/42070023/how-to-get-postgresql-procedure-warning-messages/42079586#42079586", "title": "How to get Postgresql procedure warning messages?", "body": "<p>The answer appears to be no.</p>\n\n<p>In my tests the Postgres server did not appear to send the warning with the results. Even if it did, returning an error along with the sql.Result would be confusing at best and would require <code>lib/pq</code> modifications. Raising an error in the function <em>did</em> return an error, but (obviously) no result.</p>\n\n<p>If this is a critical requirement (and your function can support it) you might consider using a <a href=\"https://www.postgresql.org/docs/current/static/sql-notify.html\" rel=\"nofollow noreferrer\">notification channel</a>. Bear in mind that this would tie your code to Postgres.</p>\n\n<p>--</p>\n\n<p>Here is the function I used:</p>\n\n<p><code>CREATE OR REPLACE function fugo() \nRETURNS bool as $$\nBEGIN\n  RAISE WARNING 'My function notice.' USING errcode = '01000';\n  return TRUE;\nEND;$$\nlanguage 'plpgsql';</code></p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5199825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cb187116673ae7a4ba70464e443ae07?s=128&d=identicon&r=PG", "display_name": "LeKovr", "link": "https://stackoverflow.com/users/5199825/lekovr"}, "is_accepted": false, "score": 1, "last_activity_date": 1606321946, "last_edit_date": 1606321946, "creation_date": 1576018293, "answer_id": 59276504, "question_id": 42070023, "link": "https://stackoverflow.com/questions/42070023/how-to-get-postgresql-procedure-warning-messages/59276504#59276504", "title": "How to get Postgresql procedure warning messages?", "body": "<p>For <code>lib/pq</code> driver, the answer is &quot;still no&quot;.\nSee <a href=\"https://github.com/lib/pq/issues/580\" rel=\"nofollow noreferrer\">open issue</a> and <a href=\"https://github.com/lib/pq/blob/master/conn.go#L958\" rel=\"nofollow noreferrer\">sources</a> for details.</p>\n<p>Meanwhile, another driver, <a href=\"https://github.com/jackc/pgx\" rel=\"nofollow noreferrer\">https://github.com/jackc/pgx</a> has support for messages in current (v4) version, see <a href=\"https://godoc.org/github.com/jackc/pgconn#Notice\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/jackc/pgconn#Notice</a> and earlier (see <a href=\"https://github.com/jackc/pgx/blob/v3/conn.go#L54\" rel=\"nofollow noreferrer\">https://github.com/jackc/pgx/blob/v3/conn.go#L54</a>)</p>\n<p><strong>Update</strong>: According to <a href=\"https://github.com/lib/pq/pull/932\" rel=\"nofollow noreferrer\">PR #932</a> which has been merged at Jan-2020, lib/pq supports NoticeHandler now. See <a href=\"https://pkg.go.dev/github.com/lib/pq#example-ConnectorWithNoticeHandler\" rel=\"nofollow noreferrer\">example</a>.</p>\n"}], "owner": {"reputation": 1137, "user_id": 2660766, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/qiIdj.png?s=128&g=1", "display_name": "maksadbek", "link": "https://stackoverflow.com/users/2660766/maksadbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 709, "favorite_count": 0, "accepted_answer_id": 42079586, "answer_count": 2, "score": 3, "last_activity_date": 1606321946, "creation_date": 1486390924, "last_edit_date": 1579615846, "question_id": 42070023, "link": "https://stackoverflow.com/questions/42070023/how-to-get-postgresql-procedure-warning-messages", "title": "How to get Postgresql procedure warning messages?", "body": "<p>While running a stored procedure, the procedure can raise warning messages.</p>\n\n<p>Is there any way to get these messages using Postgresql driver(<a href=\"https://github.com/lib/pq\" rel=\"nofollow noreferrer\">https://github.com/lib/pq</a>) in Golang ?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1486392471, "last_edit_date": 1486392471, "creation_date": 1486389866, "answer_id": 42069690, "question_id": 42069615, "link": "https://stackoverflow.com/questions/42069615/too-many-arguments-to-return-error/42069690#42069690", "title": "Too many arguments to return error", "body": "<p>You pass an anonymous function value to <code>once.Do()</code> (which is <a href=\"https://golang.org/pkg/sync/#Once.Do\" rel=\"noreferrer\"><code>Once.Do()</code></a>), and the <code>return</code> statements are inside that. Which means those <code>return</code> statements want to return from the anonymous function, but it doesn't have any return values:</p>\n\n<pre><code>func Config() (*ConfigMap, error) {\n    once.Do(func() {\n        // You can't return any values here, only this works:\n        return\n    })\n\n    // And you do need to return something here:\n    return &amp;ConfigMap{}, nil\n}\n</code></pre>\n\n<p>What you may do is create global variables matching the return values of <code>Config()</code>, and the anonymous function should store the values in them. And in <code>Config()</code> you may return the values of these global variables.</p>\n\n<pre><code>var cm *ConfigMap\nvar cmErr error\n\nfunc Config() (*ConfigMap, error) {\n    once.Do(func() {\n        // load config, and store, e.g.\n        cm, cmErr = &amp;ConfigMap{}, nil\n    })\n\n    return cm, cmErr\n}\n</code></pre>\n\n<p>Do we really need global variables? Since the values returned by <code>Config()</code> are produced by the anonymous function passed to <code>once.Do()</code> which is guaranteed to run only once, yes, you need to store them somewhere to be able to return them multiple times, even when the anonymous function is not called / run anymore (on subsequent calls to <code>Config()</code>).</p>\n\n<p><strong>Question: May there be a data race here?</strong></p>\n\n<p>If <code>Config()</code> is called from multiple goroutines, at least one will write the global variables <code>cm</code> and <code>cmErr</code>, and all will read them. So it's rightful to ask this question.</p>\n\n<p>But the answer is no, the above code is safe. The global variables <code>cm</code> and <code>cmErr</code> are only written once, and this happens before they could be read. Because <code>once.Do()</code> blocks until the anonymous function returns. If <code>Config()</code> (and thus <code>once.Do()</code>) is called simultaneously from multiple goroutines, all will block until the anonymous function completes (once only), and reading the variables can happen only after the first write. And since the anonymous function will not run anymore, no more writes will happen.</p>\n"}, {"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 1, "last_activity_date": 1486390041, "creation_date": 1486390041, "answer_id": 42069743, "question_id": 42069615, "link": "https://stackoverflow.com/questions/42069615/too-many-arguments-to-return-error/42069743#42069743", "title": "Too many arguments to return error", "body": "<p>You're calling <code>return nil, err</code> and similar from the nested <code>func()</code> inside your <code>once.Do</code>. Conversely, you're not returning from the actual function.</p>\n\n<p>Instead, you can structure your code like this:</p>\n\n<pre><code>func newConfig() (*Config, error) {\n    configFilePath, err := filepath.Abs(\"../build/app.conf\")\n    if err != nil {\n        return nil, err\n    }\n\n    // Load app.conf\n    cfg, err := ini.Load(configFilePath)\n    if err != nil {\n        return nil, err\n    }\n\n    // Get app mode\n    mode, err := AppMode()\n    if err != nil {\n        return nil, err\n    }\n\n    c := &amp;ConfigMap{}\n    err = cfg.Section(mode).MapTo(c)\n    if err != nil {\n        return nil, err\n    }\n\n    return c, err\n}\n\n// Cached config and any error.\nvar (\n   cachedConfig *Config\n   cachedConfigErr error\n)\n\nfunc Config() (*Config, error) {\n  once.Do(func() {\n    cachedConfig, cachedConfigErr = newConfig()\n  })\n  return cachedConfig, cachedConfigErr\n}\n</code></pre>\n"}], "owner": {"reputation": 932, "user_id": 279183, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/5df43f2d159d197c4ae9dbd8d9280b3c?s=128&d=identicon&r=PG&f=1", "display_name": "adredx", "link": "https://stackoverflow.com/users/279183/adredx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4420, "favorite_count": 0, "accepted_answer_id": 42069690, "answer_count": 2, "score": 0, "last_activity_date": 1486392471, "creation_date": 1486389644, "question_id": 42069615, "link": "https://stackoverflow.com/questions/42069615/too-many-arguments-to-return-error", "title": "Too many arguments to return error", "body": "<p>I've been pulling my hair out as to why this code throws the error:</p>\n\n<pre><code>package util\n\nimport (\n   \"path/filepath\"\n   \"sync\"\n\n   \"github.com/go-ini/ini\"\n)\n\n// ConfigMap is map for config values\ntype ConfigMap struct {\n    LogPath         string\n    PublicDir       string\n    SessionName     string\n    Debug           bool\n    DBUsersHost     string\n    DBUsersName     string\n    DBUsersUsername string\n    DBUsersPassword string\n}\n\nvar once sync.Once\n\n// Config loads and return config object\nfunc Config() (*ConfigMap, error) {\n    once.Do(func() {\n        // Find the location of the app.conf file\n        configFilePath, err := filepath.Abs(\"../build/app.conf\")\n        if err != nil {\n            return nil, err\n        }\n\n        // Load app.conf\n        cfg, err := ini.Load(configFilePath)\n        if err != nil {\n            return nil, err\n        }\n\n        // Get app mode\n        mode, err := AppMode()\n        if err != nil {\n            return nil, err\n        }\n\n        c := &amp;ConfigMap{}\n        err = cfg.Section(mode).MapTo(c)\n        if err != nil {\n            return nil, err\n        }\n\n        return c, err\n    })\n}\n</code></pre>\n\n<p>As you can see, the pairing is exactly correct. Each return code returns <code>&amp;ConfigMap</code> and <code>err</code> and the function signature matches it. What am I missing?</p>\n"}, {"tags": ["go", "garbage-collection"], "comments": [{"owner": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1486383550, "post_id": 42067478, "comment_id": 71306456, "body": "@EliasVanOotegem with &#39;assign it (so it can&#39;t be GC&#39;ed)&#39; are you saying that the version that uses the temporary variable is the safe one? That&#39;s the opposite of what the book says though. And as I say, the two programs seem equivalent to me. I can&#39;t see the semantic difference between them, assuming at least a basic optimising compiler."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1486383749, "post_id": 42067478, "comment_id": 71306597, "body": "Deleted my comments, I got things backwars... too tired, got confused thinking about C sequence points"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1486384063, "post_id": 42067478, "comment_id": 71306775, "body": "Simply put, <code>x</code> could be garbage collected between the assignment to <code>tmp</code> and the assignment to <code>pb</code>"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1486384132, "post_id": 42067478, "comment_id": 71306824, "body": "@JimB: Found the reference. It&#39;s not <code>x</code> that is the key. It&#39;s <code>tmp</code> being an integer rather than a reference, and not being managed/updated that makes the second snippet unsafe. The wording in the book/docs is a bit counter-intuitive, must be said"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1486389870, "post_id": 42067478, "comment_id": 71310580, "body": "@EliasVanOotegem: yes, the conversion from an integer to a pointer is what&#39;s actually unsafe; I thought it would be easier to understand in this example that what might happen is the value pointed to is garbage collected and may no longer exist. The spec is clear, but people often confuse the specification with the implementation."}, {"owner": {"reputation": 151, "user_id": 395916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9969d3b17c6fd9d604ad2c09a06d58?s=128&d=identicon&r=PG", "display_name": "Tristan Hume", "link": "https://stackoverflow.com/users/395916/tristan-hume"}, "edited": false, "score": 0, "creation_date": 1486418560, "post_id": 42067478, "comment_id": 71327727, "body": "This is a question about the spec and not the implementation right? Because the current Go GC never moves anything so both examples should be the same in practice as long as x is live the whole time."}, {"owner": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486421559, "post_id": 42067478, "comment_id": 71329047, "body": "Yes it&#39;s hypothetical I admit. But the book give it as such a specific example so I thought it must be there to imply something about when Go have safepoints or something like that. Maybe not."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 151, "user_id": 395916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9969d3b17c6fd9d604ad2c09a06d58?s=128&d=identicon&r=PG", "display_name": "Tristan Hume", "link": "https://stackoverflow.com/users/395916/tristan-hume"}, "edited": false, "score": 0, "creation_date": 1486473898, "post_id": 42067478, "comment_id": 71352077, "body": "@TristanHume: Not quite, I&#39;ve done some more digging and <a href=\"https://github.com/golang/proposal/blob/master/design/17503-eliminate-rescan.md\" rel=\"nofollow noreferrer\">this</a> is a good read to get a high-level overview on how the GC works. The key being the STW phase, and preventing to move objects etc... still going through it looking up the references to find the definitive answer to this question (probably will take some time for this after work)("}], "answers": [{"comments": [{"owner": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486384385, "post_id": 42067818, "comment_id": 71306973, "body": "&quot;but it&#39;s immediately assigned&quot; But what I am asking is what stops the garbage collector running in the middle of this statement? Why can&#39;t the GC run after the pointer has been converted to an integer, so moving the object and invalidating the integer? Does Go guarantee it won&#39;t have GC safepoints in the middle of a statement? How can that work when there are method calls in the statement? Every language with a GC I&#39;ve seen has safepoints on method entry points."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486384601, "post_id": 42067818, "comment_id": 71307138, "body": "@ChrisSeaton: By immediately assigned I mean: the assignment takes place <i>before</i> x has a chance to change (Go&#39;s GC is a stop-the-world GC after all). There&#39;s also no reason for the object referenced by <code>x</code> to be GC&#39;ed, because <code>x</code> still exists. In the second case, <code>x</code> can be moved, reassigned, ... before you convert the integer type <code>tmp</code> to a pointer (ie reference to object). I&#39;ve tried to find information on golang sequence points and the like, but haven&#39;t really spent a great amount of time on that"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486384719, "post_id": 42067818, "comment_id": 71307212, "body": "Bottom line is that, although in the case where <code>tmp</code> is assigned directly before you&#39;re assinging <code>pb</code>, and there&#39;s no concurrency issues, it&#39;s highly unlikely the second snippet will cause problems, but in the last example I included (with the sleep and reassigning <code>x</code>), then <code>pb</code> is likely to be unsafe"}, {"owner": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486384869, "post_id": 42067818, "comment_id": 71307313, "body": "I still don&#39;t get it, sorry. We (a) get a pointer to an object, (b) convert it to an integer, then (c) convert that integer to a pointer again. I don&#39;t see why the GC couldn&#39;t run after (b) has run and just before (c) runs, move the object, and mean that your integer is no longer pointing to the object. I know that the Go GC is stop-the-world, but I don&#39;t see how the compiler would know that it was not safe to stop the world in the middle of this statement."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486385155, "post_id": 42067818, "comment_id": 71307520, "body": "@ChrisSeaton: It can run then, but because <code>x</code> references the same object still, the object you point to will still exist. Say the integer value is 1234, that address will still be valid between (b) and (c), because <code>x</code> holds a reference to that object. The only way that can change is if you have a race condition that changes x in a routine at the exact same time. This is possible, but is caused by you not handling concurrency properly, not by the operation as such. I&#39;d say that that&#39;s why concurrency + <code>unsafe</code> is a bad idea without <code>atomic</code> and <code>sync</code>"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486385331, "post_id": 42067818, "comment_id": 71307610, "body": "By contrast, in the second snippet, <code>tmp</code> is managed for what it is (an integer). By the time you assign <code>pb</code>, there&#39;s a bigger chance for things to go wrong. Like I said: in this specific case (2 lines of code), it&#39;s extremely unlikely, but it&#39;s technically possible. I&#39;ll have a look during lunch into golang sequencing points, and see if go offers more guarantees WRT <code>x</code> being moved or GC&#39;ed while it&#39;s being referenced in an expression that is being evaluated. If not, then your scenario (something happening between (b) and (c) is impossible, making the first version completely safe)"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486385355, "post_id": 42067818, "comment_id": 71307628, "body": "Interesting question BTW +1 :D"}, {"owner": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486385705, "post_id": 42067818, "comment_id": 71307855, "body": "But the object in a <code>Pointer</code> can be moved can&#39;t it? So <code>x</code> references the object, but the object can be moved and <code>x</code> updated by the GC, but nobody updates the <code>uintptr</code> version. Thanks for trying to explain it but I still don&#39;t get it so I must be missing something fundamental and I&#39;ll stop going back and forth with you. Thanks!"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "edited": false, "score": 0, "creation_date": 1486387420, "post_id": 42067818, "comment_id": 71308930, "body": "@ChrisSeaton: Fair enough, <a href=\"https://docs.google.com/document/d/16Y4IsnNRCN43Mx0NZc5YXZLovrHvvLhK_h0KN8woTO4/edit\" rel=\"nofollow noreferrer\">this document</a> might be worth looking at. It&#39;s from way back when they started revamping the GC stuff. Basically, the way the go GC works I gather that <code>x</code> is not changed when there is an operation like <code>&amp;x</code> + <code>offsetof</code>, because if <code>x</code> were to move between evaluating these two expressions, the result is UB. I <i>believe</i> the first version basically blocks the GC to work on <code>x</code> entirely until the entire statement has been resolved, and no side effects remain, not so in the 2nd case"}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": false, "score": 1, "last_activity_date": 1486384834, "last_edit_date": 1486384834, "creation_date": 1486384069, "answer_id": 42067818, "question_id": 42067478, "link": "https://stackoverflow.com/questions/42067478/when-is-it-safe-in-go-to-reference-an-object-only-through-a-uintptr/42067818#42067818", "title": "When is it safe in Go to reference an object only through a `uintptr`?", "body": "<p>Found the reference I hinted at in my comments <a href=\"https://golang.org/pkg/unsafe/#Pointer\" rel=\"nofollow noreferrer\">here</a></p>\n\n<blockquote>\n  <p>A uintptr is an integer, not a reference. Converting a Pointer to a uintptr creates an integer value with no pointer semantics. Even if a uintptr holds the address of some object, the garbage collector will not update that uintptr's value if the object moves, nor will that uintptr keep the object from being reclaimed.</p>\n</blockquote>\n\n<p>What this means is that this expression:</p>\n\n<pre><code>pb := (*int16)(unsafe.Pointer(\n  uintptr(unsafe.Pointer(&amp;x)) + unsafe.Offsetof(x.b)))\n*pb = 42\n</code></pre>\n\n<p>Is safe because you're creating a <code>uintptr</code>, which is seen as an integer, not a reference, but it's immediately assigned (unless there's a race condition somewhere else, the object that <code>x</code> references cannot be GC'ed) until <em>after</em> the assignment). The <code>uintptr</code> (again: integer type) is also immediately cast to a pointer, turning it into a reference so the GC will manage <code>pb</code>. This means that:</p>\n\n<ul>\n<li><code>uintptr(unsafe.Pointer(&amp;x)) + unsafe.Offsetof(x.b))</code>: all safe, because <code>x</code> clearly is an existing reference to an object</li>\n<li><code>pb</code> is assigned an integer that is (through the cast) marked as a reference to an <code>int16</code> object</li>\n</ul>\n\n<p>However, when you write this:</p>\n\n<pre><code>tmp := uintptr(unsafe.Pointer(&amp;x)) + unsafe.Offsetof(x.b)\npb := (*int16)(unsafe.Pointer(tmp))\n</code></pre>\n\n<p>There is a chance that, between assigning <code>tmp</code> (remember integer, not reference), the actual object in memory is moved. As it says in the docs: <code>tmp</code> will <em>not</em> be updated. Thus, when you assign <code>pb</code>, you could end up with an invalid pointer.<br>\nthink of <code>tmp</code> in this case as <code>x</code> in the first case. Rather than being a reference to an object, it's as if you wrote</p>\n\n<pre><code>tmp := 123456 // a random integer\npb := (*int16) (unsafe.Pointer(tmp)) // not safe, obviously\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>var pb *int16\ntmp := uintptr(unsafe.Pointer(&amp;x)) + unsafe.Offsetof(x.b)\ngo func() {\n    time.Sleep(1 * time.Second)\n    pb = (*int16)(unsafe.Pointer(tmp))\n}()\n// original value of x could be GC'ed here, before the goroutine starts, or the time.Sleep call returns\nx = TypeOfX{\n    b: 123,\n}\n</code></pre>\n"}], "owner": {"reputation": 280, "user_id": 2901385, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0b0965afa66f2cabf76a8128b39e7c6?s=128&d=identicon&r=PG", "display_name": "Chris Seaton", "link": "https://stackoverflow.com/users/2901385/chris-seaton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1486384834, "creation_date": 1486383044, "last_edit_date": 1486383629, "question_id": 42067478, "link": "https://stackoverflow.com/questions/42067478/when-is-it-safe-in-go-to-reference-an-object-only-through-a-uintptr", "title": "When is it safe in Go to reference an object only through a `uintptr`?", "body": "<p>The Go Programming Language says in Section 13.2 that this is code is safe and <code>x</code> will always\nbe visible to the garbage collector:</p>\n\n<pre><code>pb := (*int16)(unsafe.Pointer(\n  uintptr(unsafe.Pointer(&amp;x)) + unsafe.Offsetof(x.b)))\n*pb = 42\n</code></pre>\n\n<p>And that this code is unsafe, because <code>x</code> is temporarily not visible to the\ngarbage collector, which could move it, making <code>pb</code> a dangling pointer:</p>\n\n<pre><code>tmp := uintptr(unsafe.Pointer(&amp;x)) + unsafe.Offsetof(x.b)\npb := (*int16)(unsafe.Pointer(tmp))\n*pb = 42\n</code></pre>\n\n<p>But I can't see the difference between these two examples.</p>\n\n<p>In the case described as safe, after <code>uintptr</code> has been called, the only\nreference to the <code>x</code> is the <code>uintptr</code> value, isn't it? There's a <code>Pointer</code>\nto it on the same line, but it was an argument to <code>uintptr</code>, which has run,\nso nothing is referencing the arguments, and so the <code>Pointer</code> is not live and the <code>uintptr</code> is the only reference to the object.</p>\n\n<p>I can't see how storing the <code>uintptr</code> in a local variable instead of as an\nexpression intermediate value makes it any more safe. Aren't local variables\nlike <code>tmp</code> removed in compiler phases anyway, becoming anonymous dataflow edges,\nso that the generated code should be semantically equivalent? Or does Go have\nsome rules for when garbage collection can run? Such as having safepoints only\nbetween statements? But the code in the first example has method calls so I\nwould presume they would always be safepoints?</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 8978, "user_id": 2223579, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/wQuP6.jpg?s=128&g=1", "display_name": "BlackMamba", "link": "https://stackoverflow.com/users/2223579/blackmamba"}, "edited": false, "score": 0, "creation_date": 1486459916, "post_id": 42066797, "comment_id": 71342626, "body": "Each element of such a variable or value is set to the zero value for its type: false for booleans, 0 for integers, 0.0 for floats, &quot;&quot; for strings, and nil for pointers, functions, interfaces, slices, channels, and maps."}], "answers": [{"tags": [], "owner": {"reputation": 2527, "user_id": 3476121, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1c621706e2e37eed4f82f074af9f706a?s=128&d=identicon&r=PG", "display_name": "sadlil", "link": "https://stackoverflow.com/users/3476121/sadlil"}, "is_accepted": false, "score": 9, "last_activity_date": 1486380934, "creation_date": 1486380934, "answer_id": 42066822, "question_id": 42066797, "link": "https://stackoverflow.com/questions/42066797/how-to-delete-struct-object-in-go/42066822#42066822", "title": "How to delete struct object in go?", "body": "<p>If you want to set nil use pointer instead of value.</p>\n\n<pre><code>person1 := &amp;Person{name: \"Name\", age: 69}\n// Then you can set\nperson1 = nil\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 208, "user_id": 3143562, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/y9Op3.jpg?s=128&g=1", "display_name": "mkmayank", "link": "https://stackoverflow.com/users/3143562/mkmayank"}, "edited": false, "score": 1, "creation_date": 1550834421, "post_id": 42067048, "comment_id": 96426616, "body": "@mkmayank If you want to clear the receiver, it must be a pointer, and assign an empty struct to the pointed value."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 53, "last_activity_date": 1588712295, "last_edit_date": 1588712295, "creation_date": 1486381692, "answer_id": 42067048, "question_id": 42066797, "link": "https://stackoverflow.com/questions/42066797/how-to-delete-struct-object-in-go/42067048#42067048", "title": "How to delete struct object in go?", "body": "<p>Go is a garbage collected language. You are not supposed to, and you cannot delete objects from memory. It is the garbage collector's <em>duty</em> and <em>responsibility</em> to do so, and it does this <em>automatically</em>. The garbage collector will properly remove objects from memory when they become unreachable.</p>\n\n<p>You can assign <code>nil</code> to maps and slices because <code>nil</code> is a valid value (the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero value</a>) for those types. The zero value for <code>struct</code> types is not <code>nil</code> but a <code>struct</code> value where all its fields have their zero values.</p>\n\n<p>If you want to clear or overwrite the struct value, you may simply <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">assign</a> another struct value to it, preferably the zero value (an empty struct):</p>\n\n<pre><code>person1 := Person{name: \"Name\", age: 69}\n// work with person1\n\n// Clear person1:\nperson1 = Person{}\n</code></pre>\n\n<p>But know that this will not free memory allocated by <code>person1</code>; as wrote earlier, it will be freed automatically by the GC when it becomes unreachable.</p>\n\n<p><code>nil</code> is also a valid value (the zero value) for pointer types, so if <code>person1</code> would be a pointer to <code>Person</code> (that is, <code>*Person</code>), you could also assign <code>nil</code> to it, e.g.:</p>\n\n<pre><code>person1 := &amp;Person{name: \"Name\", age: 69}\n// work with person1\n\n// Clear person1:\nperson1 = nil\n</code></pre>\n\n<p>When clearing a pointer by setting it to <code>nil</code>, the pointed object\u2013again\u2013will be taken care of by the GC.</p>\n\n<p>For more details about how the garbage collector works, see <a href=\"https://stackoverflow.com/questions/37382600/golang-cannot-free-memory-once-occupied-by-bytes-buffer/37383604#37383604\">Cannot free memory once occupied by bytes.Buffer</a>.</p>\n"}], "owner": {"reputation": 573, "user_id": 3060453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/423d15544ba61adc93c9d26bbf1639d2?s=128&d=identicon&r=PG", "display_name": "redpix_", "link": "https://stackoverflow.com/users/3060453/redpix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39120, "favorite_count": 8, "accepted_answer_id": 42067048, "answer_count": 2, "score": 29, "last_activity_date": 1588712295, "creation_date": 1486380851, "question_id": 42066797, "link": "https://stackoverflow.com/questions/42066797/how-to-delete-struct-object-in-go", "title": "How to delete struct object in go?", "body": "<p>Let's say I have the following struct:</p>\n\n<pre><code>type Person struct {\n    name string\n    age  int\n}\n</code></pre>\n\n<p>If I make an object of that struct</p>\n\n<pre><code>person1 := Person{name: \"Name\", age: 69}\n</code></pre>\n\n<p>If I set this object to nil </p>\n\n<pre><code>person1 = nil\n</code></pre>\n\n<p>it doesn't work, in fact it's a type assignment error, but it works for maps and slices. So, how otherwise would I remove the object i.e deallocate? I looked at the documentation for delete builtin but it removes an entry from a given map. Thanks.</p>\n"}, {"tags": ["go", "reflection", "struct"], "comments": [{"owner": {"reputation": 3592, "user_id": 3094805, "user_type": "registered", "accept_rate": 11, "profile_image": "https://www.gravatar.com/avatar/6f9729dacae0e6942713e6e84cf8a4db?s=128&d=identicon&r=PG&f=1", "display_name": "PaulNUK", "link": "https://stackoverflow.com/users/3094805/paulnuk"}, "edited": false, "score": 2, "creation_date": 1486376706, "post_id": 42065226, "comment_id": 71302260, "body": "Please see <a href=\"http://stackoverflow.com/help/how-to-ask\">stackoverflow.com/help/how-to-ask</a> for quidlines on how to ask a good question.  Your post doesn&#39;t actually ask a question."}], "answers": [{"comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 99, "user_id": 7417901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0a590a534c5f7b843a4cb88fcc28abb?s=128&d=identicon&r=PG&f=1", "display_name": "Ferry Sutanto", "link": "https://stackoverflow.com/users/7417901/ferry-sutanto"}, "edited": false, "score": 1, "creation_date": 1486382847, "post_id": 42065708, "comment_id": 71306025, "body": "Seems taking Type is not necessary cause Value has Kind() on its own as well."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 20, "last_activity_date": 1486377537, "creation_date": 1486377537, "answer_id": 42065708, "question_id": 42065226, "link": "https://stackoverflow.com/questions/42065226/how-to-determine-if-type-is-a-struct-in-golang/42065708#42065708", "title": "How to determine if type is a struct in Golang", "body": "<p>Just check the Kind() of Value</p>\n\n<pre><code>if reflect.ValueOf(e).Field(i).Kind() != reflect.Struct {\n    fmt.Println(reflect.ValueOf(e).Field(i))\n}\n</code></pre>\n"}], "owner": {"reputation": 99, "user_id": 7417901, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0a590a534c5f7b843a4cb88fcc28abb?s=128&d=identicon&r=PG&f=1", "display_name": "Ferry Sutanto", "link": "https://stackoverflow.com/users/7417901/ferry-sutanto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9746, "favorite_count": 4, "accepted_answer_id": 42065708, "answer_count": 1, "score": 8, "last_activity_date": 1503908864, "creation_date": 1486376120, "question_id": 42065226, "link": "https://stackoverflow.com/questions/42065226/how-to-determine-if-type-is-a-struct-in-golang", "title": "How to determine if type is a struct in Golang", "body": "<p>Suppose i have 2 structs :</p>\n\n<pre><code>type Base struct {\n id int\n name string\n}\n\ntype Extended struct {\n Base\n Email string\n Password string\n}\n</code></pre>\n\n<p>And i want to reflect the Extended struct to get it's field :</p>\n\n<pre><code>e := Extended{}\ne.Email = \"me@mail.com\"\ne.Password = \"secret\"\n\nfor i := 0 ; i &lt; reflect.TypeOf(e).NumField() ; i++ {\n  if reflect.TypeOf(e).Field(i) != \"struct\" {  &lt;&lt; how to do this validation?\n    fmt.Println(reflect.ValueOf(e).Field(i))\n  }\n}\n</code></pre>\n"}, {"tags": ["node.js", "go", "hash", "passwords", "sha256"], "comments": [{"owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "edited": false, "score": 0, "creation_date": 1486372512, "post_id": 42063110, "comment_id": 71299597, "body": "You are missing <code>salt</code> in the node part."}, {"owner": {"reputation": 831, "user_id": 3765203, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/jcsIU.jpg?s=128&g=1", "display_name": "Sharan Mohandas", "link": "https://stackoverflow.com/users/3765203/sharan-mohandas"}, "reply_to_user": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "edited": false, "score": 0, "creation_date": 1486372744, "post_id": 42063110, "comment_id": 71299738, "body": "test(&quot;XYZabc987&quot;,&quot;giri&quot;); we are sending it as argument"}], "answers": [{"comments": [{"owner": {"reputation": 831, "user_id": 3765203, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/jcsIU.jpg?s=128&g=1", "display_name": "Sharan Mohandas", "link": "https://stackoverflow.com/users/3765203/sharan-mohandas"}, "edited": false, "score": 0, "creation_date": 1486375145, "post_id": 42064617, "comment_id": 71301304, "body": "That helped.. Thanks a Lot!!"}], "tags": [], "owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "is_accepted": true, "score": 1, "last_activity_date": 1486374228, "creation_date": 1486374228, "answer_id": 42064617, "question_id": 42063110, "link": "https://stackoverflow.com/questions/42063110/converting-a-password-hashing-script-from-go-to-nodejs/42064617#42064617", "title": "Converting a Password Hashing Script from GO to Nodejs", "body": "<pre><code>var crypto = require('crypto');\nfunction test(pwd, key) {\n    var input = key.concat(pwd)\n    var hash = crypto.createHash('sha256').update(input).digest('hex');\n    console.log(\"hashcode of password :\", hash);\n};\ntest(\"XYZabc987\", \"giri\");\n</code></pre>\n\n<p>You could verify the correct hash using this <a href=\"http://www.xorbin.com/tools/sha256-hash-calculator\" rel=\"nofollow noreferrer\">online tool</a>.</p>\n"}], "owner": {"reputation": 831, "user_id": 3765203, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/jcsIU.jpg?s=128&g=1", "display_name": "Sharan Mohandas", "link": "https://stackoverflow.com/users/3765203/sharan-mohandas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "accepted_answer_id": 42064617, "answer_count": 1, "score": 0, "last_activity_date": 1486374228, "creation_date": 1486368976, "last_edit_date": 1486371911, "question_id": 42063110, "link": "https://stackoverflow.com/questions/42063110/converting-a-password-hashing-script-from-go-to-nodejs", "title": "Converting a Password Hashing Script from GO to Nodejs", "body": "<p>I have a hard time converting an existing GO script to NodeJS. It basically a hashing script which takes in 2 arguments <strong>agreedUponKey</strong> and <strong>salt</strong> and returns a password hash.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"hash\"\n    \"crypto/sha256\"\n)\n\nfunc main() {\n    var agreedUponKey string\n    var salt string\n    var h hash.Hash\n\n    agreedUponKey = \"giri\"\n    salt = \"XYZabc987\"\n\n    h = sha256.New()\n    h.Write([]byte(agreedUponKey))\n    h.Write([]byte(salt))\n\n    sha256Sum := h.Sum(nil)\n    print(\"calculated passwordHash:\", sha256Sum)\n\n    var hexHash = make([]byte, 0, 64)\n    for _, v := range sha256Sum {\n        hexHash = append(hexHash,[]byte(fmt.Sprintf(\"%02x\", v))...)\n    }\n\n    print(\"calculated passwordHash:\", string(hexHash))\n}\n</code></pre>\n\n<p>I have managed to code up to the below point </p>\n\n<pre><code>var crypto = require('crypto');\nvar convert = require('convert-string');\n\nfunction test(pwd,key) {\n  console.log(\"Password :\",pwd);\n  var byteKey=convert.stringToBytes(key);\n  var bytePwd=convert.stringToBytes(pwd);    \n  var hash = crypto.createHash('sha256').update(byteKey+bytePwd).digest('base64');\n  console.log(\"hashcode of password :\",hash);\n};\ntest(\"XYZabc987\",\"giri\");\n</code></pre>\n\n<p>The 2 hashes are different. Any help would be greatly appreciated. I am a Noob in GO Lang</p>\n\n<p>Please Note : You can use <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">https://play.golang.org/</a> to compile and run the Go Script</p>\n"}, {"tags": ["go", "go-present"], "answers": [{"tags": [], "owner": {"reputation": 2683, "user_id": 558262, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/lbx3r.jpg?s=128&g=1", "display_name": "Rajesh Pitty", "link": "https://stackoverflow.com/users/558262/rajesh-pitty"}, "is_accepted": false, "score": 2, "last_activity_date": 1486369321, "creation_date": 1486369321, "answer_id": 42063191, "question_id": 42061183, "link": "https://stackoverflow.com/questions/42061183/i-am-using-golang-present-tool-to-build-a-presentation-is-there-a-way-to-overri/42063191#42063191", "title": "I am using golang present tool to build a presentation. is there a way to override the default templates?", "body": "<p>do the following to override the default templates:</p>\n\n<p>copy the templates folder from <code>$GOPATH/src/golang.org/x/tools/cmd/present</code> folder to the project folder.</p>\n\n<p>edit the templates: remove google analytics script in all the templates.</p>\n\n<p>start the presentation with -base option: <code>present -base .</code></p>\n\n<p>with the <code>-base .</code> option present tool will use the templates in the current project folder.</p>\n"}], "owner": {"reputation": 2683, "user_id": 558262, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/lbx3r.jpg?s=128&g=1", "display_name": "Rajesh Pitty", "link": "https://stackoverflow.com/users/558262/rajesh-pitty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 796, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1535677859, "creation_date": 1486360676, "last_edit_date": 1535677859, "question_id": 42061183, "link": "https://stackoverflow.com/questions/42061183/i-am-using-golang-present-tool-to-build-a-presentation-is-there-a-way-to-overri", "title": "I am using golang present tool to build a presentation. is there a way to override the default templates?", "body": "<p>the present tool uses default templates that includes google analytics code of talks.golang.org.</p>\n\n<p>I would like to override/customise the templates. </p>\n\n<p>I couldn't find examples/guides/tutorials to achieve this.</p>\n\n<p>How to customise the templates ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486352645, "post_id": 42059800, "comment_id": 71292358, "body": "Cannot reproduce in my Linux environment, maybe you should write your OS."}, {"owner": {"reputation": 73, "user_id": 1345578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/779464a1f91db3bb8dc13fab6663f2bc?s=128&d=identicon&r=PG", "display_name": "fwang2002", "link": "https://stackoverflow.com/users/1345578/fwang2002"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486357754, "post_id": 42059800, "comment_id": 71293556, "body": "@ymonad what&#39;s your cpu usage, and how many serverDone case do you use. I tested on a centeros docker, the same result"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1486365667, "post_id": 42059800, "comment_id": 71296361, "body": "Maybe you could elaborate a bit more what is bothering you. You are spanning 1000 goroutines which do a busy-wait on one to 5 channels. What do you expect to happen and what &quot;performance&quot; would be &quot;good&quot; and why?"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1486366588, "post_id": 42059800, "comment_id": 71296805, "body": "@fwang2002 the reason behind this is the channel implementation.Check the answer below"}, {"owner": {"reputation": 73, "user_id": 1345578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/779464a1f91db3bb8dc13fab6663f2bc?s=128&d=identicon&r=PG", "display_name": "fwang2002", "link": "https://stackoverflow.com/users/1345578/fwang2002"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1486387604, "post_id": 42059800, "comment_id": 71309042, "body": "@Volker because the go routine switch, or waiting for channels spend too much CPU time. A typical use of messageLoop is in a network handler, which will make an instance of object which contains messageLoop, one channel for waiting for the connection to be done, one channel for waiting for the server to be shut down, one channel for the network messages, and maybe one channel for a specific timer.  If up to 4 channels, than in my computer, it will cost perhaps 20% CPU. And 1000 go routines is common in a network application."}], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 1345578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/779464a1f91db3bb8dc13fab6663f2bc?s=128&d=identicon&r=PG", "display_name": "fwang2002", "link": "https://stackoverflow.com/users/1345578/fwang2002"}, "edited": false, "score": 1, "creation_date": 1486387750, "post_id": 42062485, "comment_id": 71309138, "body": "Thank you very much. Perhaps I have to use channels very carefully!"}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 7, "last_activity_date": 1486393437, "last_edit_date": 1486393437, "creation_date": 1486366458, "answer_id": 42062485, "question_id": 42059800, "link": "https://stackoverflow.com/questions/42059800/performance-of-golang-select-statement-in-a-for-loop/42062485#42062485", "title": "performance of golang select statement in a for loop", "body": "<p><strong>Short Answer</strong> : Channels uses mutex. More channels means more  <code>futex</code> system calls </p>\n\n<p>Here is the strace on programs .</p>\n\n<p>The code with 7 select statements waiting for 7 <code>channels</code></p>\n\n<pre><code>% time     seconds  usecs/call     calls    errors syscall\n------ ----------- ----------- --------- --------- ----------------\n 98.20    0.424434          13     33665      6061 futex\n  1.09    0.004731          10       466           sched_yield\n  0.47    0.002038          30        67           select\n  0.11    0.000484           4       114           rt_sigaction\n  0.05    0.000203           5        41         8 rt_sigreturn\n  0.03    0.000128           9        15           mmap\n  0.02    0.000081          27         3           clone\n  0.01    0.000052           7         8           rt_sigprocmask\n  0.01    0.000032          32         1           openat\n  0.00    0.000011           4         3           setitimer\n  0.00    0.000009           5         2           sigaltstack\n  0.00    0.000008           8         1           munmap\n  0.00    0.000006           6         1           execve\n  0.00    0.000006           6         1           sched_getaffinity\n  0.00    0.000004           4         1           arch_prctl\n  0.00    0.000004           4         1           gettid\n  0.00    0.000000           0         2         2 restart_syscall\n------ ----------- ----------- --------- --------- ----------------\n100.00    0.432231                 34392      6071 total\n</code></pre>\n\n<p>The code with 3 select statements waiting for 3 <code>channels</code></p>\n\n<pre><code>% time     seconds  usecs/call     calls    errors syscall\n------ ----------- ----------- --------- --------- ----------------\n 90.47    0.118614          11     10384      1333 futex\n  6.64    0.008704          11       791           sched_yield\n  2.06    0.002706          23       120           select\n  0.39    0.000512           4       114           rt_sigaction\n  0.14    0.000181           8        22         2 rt_sigreturn\n  0.10    0.000131           9        15           mmap\n  0.05    0.000060          60         1           openat\n  0.04    0.000057          19         3           setitimer\n  0.04    0.000051          17         3           clone\n  0.03    0.000045           6         8           rt_sigprocmask\n  0.01    0.000009           9         1           execve\n  0.01    0.000009           5         2           sigaltstack\n  0.01    0.000009           9         1           sched_getaffinity\n  0.01    0.000008           8         1           munmap\n  0.01    0.000007           7         1           arch_prctl\n  0.00    0.000005           5         1           gettid\n------ ----------- ----------- --------- --------- ----------------\n100.00    0.131108                 11468      1335 total\n</code></pre>\n\n<p>As it is clear here the number of <code>futex</code> calls are proportional to the number of channels and futex system calls are the reason for this performance .</p>\n\n<p><strong>Here is explanation on that</strong></p>\n\n<p>You may find the channel implementation in the following file <a href=\"https://github.com/golang/go/blob/4fc9565ffce91c4299903f7c17a275f0786734a1/src/runtime/chan.go\" rel=\"noreferrer\">src/runtime/chan.go</a> . </p>\n\n<p>Here is <code>hchan</code> the struct for a channel</p>\n\n<pre><code>type hchan struct {\n    qcount   uint           // total data in the queue\n    dataqsiz uint           // size of the circular queue\n    buf      unsafe.Pointer // points to an array of dataqsiz elements\n    elemsize uint16\n    closed   uint32\n    elemtype *_type // element type\n    sendx    uint   // send index\n    recvx    uint   // receive index\n    recvq    waitq  // list of recv waiters\n    sendq    waitq  // list of send waiters\n    lock     mutex\n}\n</code></pre>\n\n<p>There's a Lock embedded structure that is defined in runtime2.go and that serves as a mutex (<code>futex</code>) or semaphore depending on the OS. </p>\n\n<p>So with increase in number of channels more <code>futex system call</code> calls be there and that would affect performance</p>\n\n<p>You may read more about these in : <a href=\"http://man7.org/linux/man-pages/man2/futex.2.html\" rel=\"noreferrer\">futex(2)</a>,<a href=\"https://docs.google.com/document/d/1yIAYmbvL3JxOKOjuCyon7JhW4cSv1wy5hC0ApeGMV9s/pub\" rel=\"noreferrer\">Channels in steroids</a></p>\n"}], "owner": {"reputation": 73, "user_id": 1345578, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/779464a1f91db3bb8dc13fab6663f2bc?s=128&d=identicon&r=PG", "display_name": "fwang2002", "link": "https://stackoverflow.com/users/1345578/fwang2002"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4138, "favorite_count": 4, "accepted_answer_id": 42062485, "answer_count": 1, "score": 6, "last_activity_date": 1486393437, "creation_date": 1486350226, "last_edit_date": 1486358482, "question_id": 42059800, "link": "https://stackoverflow.com/questions/42059800/performance-of-golang-select-statement-in-a-for-loop", "title": "performance of golang select statement in a for loop", "body": "<p>I make a test to see the performance of select, and found the result is not\ngood. The go version is 1.7.3</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"runtime/pprof\"\n    \"time\"\n)\n\nvar serverDone = make(chan struct{})\nvar serverDone1 = make(chan struct{})\nvar serverDone2 = make(chan struct{})\nvar serverDone3 = make(chan struct{})\nvar serverDone4 = make(chan struct{})\nvar serverDone5 = make(chan struct{})\n\nfunc main() {\n    f, err := os.Create(\"cpu.pprof\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    pprof.StartCPUProfile(f)\n    defer pprof.StopCPUProfile()\n\n    for i := 0; i &lt; 1000; i++ {\n        go messageLoop()\n    }\n    &lt;-time.After(10 * time.Second)\n    close(serverDone)\n    fmt.Println(\"finished\")\n}\n\nfunc messageLoop() {\n    var ticker = time.NewTicker(100 * time.Millisecond)\n    defer ticker.Stop()\n    var counter = 0\n    for {\n        select {\n        case &lt;-serverDone:\n            return\n        case &lt;-serverDone1:\n            return\n        // case &lt;-serverDone2:\n        //  return\n        // case &lt;-serverDone3:\n        //  return\n        // case &lt;-serverDone4:\n        //  return\n        // case &lt;-serverDone5:\n        //  return\n        case &lt;-ticker.C:\n            counter += 1\n        }\n    }\n}\n</code></pre>\n\n<p>When run the above code, you will find the CPU up(in my book, about 5%) each time when a serverDone case is added.<br>\nWhen all of the serverDone case are removed, the CPU is about 5%, It's not good.<br>\nIf I turn globally locked object(like serverDone) to locally, the performance is better, but still not good enough.</p>\n\n<p>Who knows is there anything wrong in my case, or what is the correct usage of select statement?</p>\n"}, {"tags": ["go", "random", "cryptography", "wifi", "entropy"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1486355359, "post_id": 42059289, "comment_id": 71292922, "body": "Go programs should use the <a href=\"https://godoc.org/crypto/rand\" rel=\"nofollow noreferrer\">crypto/rand package</a> instead of reading /dev/random or /dev/urandom directly."}, {"owner": {"reputation": 1821, "user_id": 1390723, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3910257eeac3402e68ab7934ded0ced4?s=128&d=identicon&r=PG", "display_name": "xendi", "link": "https://stackoverflow.com/users/1390723/xendi"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1486400889, "post_id": 42059289, "comment_id": 71318057, "body": "Right but that doesn&#39;t mean I shouldn&#39;t develop a way of adding more entropy to the system."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1486402611, "post_id": 42059289, "comment_id": 71319033, "body": "I am trying to help out by letting you know what the recommended practice is for getting cryptographically secure pseudorandom numbers. I am not making a comment about adding entropy to the system."}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1486783266, "post_id": 42059289, "comment_id": 71508299, "body": "Also see <a href=\"https://cseweb.ucsd.edu/~syilek/ndss2010.html\" rel=\"nofollow noreferrer\">When Good Randomness Goes Bad: Virtual Machine Reset Vulnerabilities and Hedging Deployed Cryptography</a>. Its provided for VMs, but the technique can help with entropy depletion in other pools. Another technique I use is to sample sensor data from mobile devices. See, for example, <a href=\"https://github.com/noloader/Android-PRNG/\" rel=\"nofollow noreferrer\">Android PRNG</a>."}], "owner": {"reputation": 1821, "user_id": 1390723, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3910257eeac3402e68ab7934ded0ced4?s=128&d=identicon&r=PG", "display_name": "xendi", "link": "https://stackoverflow.com/users/1390723/xendi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1486381699, "creation_date": 1486345092, "question_id": 42059289, "link": "https://stackoverflow.com/questions/42059289/can-i-collect-entropy-from-a-wifi-adapter", "title": "Can I Collect Entropy From A Wifi Adapter?", "body": "<p>Recently I was generating a GPG key and was made to wait for more entropy to be collected for /dev/random. I've found a few cool daemons that feed /dev/random entropy via microphones, webcams, etc...</p>\n\n<ul>\n<li><a href=\"https://www.vanheusden.com/aed/\" rel=\"nofollow noreferrer\">https://www.vanheusden.com/aed/</a></li>\n<li><a href=\"https://www.vanheusden.com/ved/\" rel=\"nofollow noreferrer\">https://www.vanheusden.com/ved/</a></li>\n</ul>\n\n<p>I thought it might be a fun exercise to code one myself with the idea I have in mind (If possible). I'm wondering if it's possible to programmatically collect signal noise from a wifi adapter. This is lower level than packet sniffing so I'm not sure where to start. I'm coding on Linux and I'd ideally use Go or Nim/C interop (Preferably Golang).</p>\n\n<p>Assuming it's possible, I'm also wondering if I'd be able to do it without disrupting regular usage of the wifi adapter.</p>\n"}, {"tags": ["go", "methods", "struct", "nested"], "comments": [{"owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "edited": false, "score": 2, "creation_date": 1486336592, "post_id": 42058388, "comment_id": 71289494, "body": "Function growOs() reutrns modified slice, but you don&#39;t modify the slice which you passed to this function. Try os = growOs(os) in your main()"}, {"owner": {"reputation": 2243, "user_id": 1149933, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ed2f32d0346075a7167e398d57778182?s=128&d=identicon&r=PG", "display_name": "Adam Barnes", "link": "https://stackoverflow.com/users/1149933/adam-barnes"}, "reply_to_user": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "edited": false, "score": 0, "creation_date": 1486339922, "post_id": 42058388, "comment_id": 71290115, "body": "Aah dang it, that was exactly it.  My toy example didn&#39;t accurately represent my actual code; I&#39;ll have to rewrite it, thanks."}, {"owner": {"reputation": 2243, "user_id": 1149933, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ed2f32d0346075a7167e398d57778182?s=128&d=identicon&r=PG", "display_name": "Adam Barnes", "link": "https://stackoverflow.com/users/1149933/adam-barnes"}, "reply_to_user": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "edited": false, "score": 0, "creation_date": 1486504859, "post_id": 42058388, "comment_id": 71371869, "body": "For those interested; in my actual problem, I was iterating over the array with <code>for _, o := range os</code>, mutating <code>o</code>, which was completely lost outside the loop, as the loop makes copies, not references.  I solved it with <code>for i := range os { os[i].inner.grow() }</code>"}], "answers": [{"comments": [{"owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "edited": false, "score": 1, "creation_date": 1486365211, "post_id": 42058890, "comment_id": 71296183, "body": "I&#39;m very new to Go, but I&#39;d bet on the fact that in <code>for i, x := range s {...}</code> the element <code>x</code> is a copy is a source of many misunderstandings. This is clearly stated and a &quot;pay attention&quot; in the docs, but the very fact than you need to pay attention seems suspicious."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "edited": false, "score": 0, "creation_date": 1486537145, "post_id": 42058890, "comment_id": 71382288, "body": "It needs to be explained better in the docs, it&#39;s a common source of confusion, same with exported members in structs."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 3, "last_activity_date": 1486340739, "creation_date": 1486340739, "answer_id": 42058890, "question_id": 42058388, "link": "https://stackoverflow.com/questions/42058388/why-are-my-changes-to-a-nested-struct-in-an-array-being-lost-outside-of-the-func/42058890#42058890", "title": "Why are my changes to a nested struct in an array being lost outside of the function making the changes?", "body": "<p>The <code>o</code> in your loop is a copy, so you either have to:</p>\n\n<ol>\n<li>Change your slice to be <code>[]*outer</code>.</li>\n<li>Simply use a pointer to each item and modify the items in place.</li>\n</ol>\n\n<p>Ex:</p>\n\n<pre><code>for i := range os {\n    o := &amp;os[i]\n    o.inner.grow()\n    // or just os[i].inner.grow()\n}\nreturn os\n</code></pre>\n\n<ol start=\"3\">\n<li>just assign use the returned slice: <code>os = growOs(os)</code></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "edited": false, "score": 0, "creation_date": 1486392582, "post_id": 42059099, "comment_id": 71312367, "body": "In fact it could be inefficient if  a slice contains large amount of data because <code>growOs</code> still creates two redundant objects which allocate, take its place in memory and must be utilized by garbage collector."}], "tags": [], "owner": {"reputation": 8978, "user_id": 2223579, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/wQuP6.jpg?s=128&g=1", "display_name": "BlackMamba", "link": "https://stackoverflow.com/users/2223579/blackmamba"}, "is_accepted": true, "score": 1, "last_activity_date": 1486392636, "last_edit_date": 1486392636, "creation_date": 1486342974, "answer_id": 42059099, "question_id": 42058388, "link": "https://stackoverflow.com/questions/42058388/why-are-my-changes-to-a-nested-struct-in-an-array-being-lost-outside-of-the-func/42059099#42059099", "title": "Why are my changes to a nested struct in an array being lost outside of the function making the changes?", "body": "<p>You should change </p>\n\n<pre><code>func main() {\n    os := []outer{\n        outer{},\n        outer{},\n    }\n    spew.Dump(\"----------pre\")\n    spew.Dump(os)\n    growOs(os)\n    spew.Dump(\"----------post\")\n    spew.Dump(os)\n}\n</code></pre>\n\n<p>to </p>\n\n<pre><code>func main() {\n    os := []outer{\n        outer{},\n        outer{},\n    }\n    spew.Dump(\"----------pre\")\n    spew.Dump(os)\n    os = growOs(os)\n    spew.Dump(\"----------post\")\n    spew.Dump(os)\n}\n</code></pre>\n\n<p><strong><em>NOTICE:</em></strong> <code>os = growOs(os)</code></p>\n\n<p>in function </p>\n\n<pre><code>func growOs(os []outer) (out []outer) {\n  for _, o := range os {\n    o.inner.grow()\n    out = append(out, o)\n  }\n  spew.Dump(\"----------during\")\n  spew.Dump(out)\n  return\n}\n</code></pre>\n\n<p>you just return a new slice <code>out</code>, you don't modify the input slice <code>os</code>,</p>\n\n<p>So in your <code>main</code> function, the <code>os</code> isn't changed.</p>\n"}, {"tags": [], "owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "is_accepted": false, "score": 1, "last_activity_date": 1486393862, "last_edit_date": 1486393862, "creation_date": 1486383878, "answer_id": 42067749, "question_id": 42058388, "link": "https://stackoverflow.com/questions/42058388/why-are-my-changes-to-a-nested-struct-in-an-array-being-lost-outside-of-the-func/42067749#42067749", "title": "Why are my changes to a nested struct in an array being lost outside of the function making the changes?", "body": "<h3><a href=\"https://play.golang.org/p/VpRrJakCli\" rel=\"nofollow noreferrer\">Pointer argument vs value argument</a></h3>\n\n<p>If a function expects pointer argument it will obtain a pointer to an object thereby each change executed upon the object will have effect on the object itself. If a function expects a value argument it will obtain a copy of an object so each operation will affect an obtained copy not the object.</p>\n\n<pre><code>func recPointer(s *string) {\n    fmt.Printf(\"%p\\n\", s) // The same object\n}\n\nfunc recValue(s string) {\n    fmt.Printf(\"%p\\n\", &amp;s) // A new object\n}\n\nfunc main() {\n    s := \"asdf\"\n    fmt.Printf(\"%p\\n\", &amp;s)\n    recPointer(&amp;s)\n    recValue(s)\n}\n</code></pre>\n\n<h3><a href=\"https://play.golang.org/p/gS3EZY2tXQ\" rel=\"nofollow noreferrer\">Named return values</a></h3>\n\n<blockquote>\n  <p>Go's return values may be named. If so, they are treated as variables defined at the top of the function.</p>\n</blockquote>\n\n<p>Thereby it becomes clear that named return values are defined in function not in a name space above it. So when you return a named value you do it with a new object (again).</p>\n\n<pre><code>func recValue(s []string) (out []string) {\n    fmt.Printf(\"%p\\n\", &amp;s) // A new object\n    out = append(out, s...)\n    // Again new object. It is not the `s` from `main`\n    // and obviously not the `s` var from incoming arguments.\n    fmt.Printf(\"%p\\n\", &amp;out)\n    return\n}\n\nfunc main() {\n    s := []string{\"asdf\"}\n    fmt.Printf(\"%p\\n\", &amp;s)\n    recValue(s)\n}\n</code></pre>\n\n<h3><a href=\"https://play.golang.org/p/RIGjDSQCV0\" rel=\"nofollow noreferrer\">Fixed example</a></h3>\n\n<p><em>Be careful! I replaced <code>spew.Dump</code> with <code>fmt.Printf</code> for demonstrative debug.</em></p>\n\n<pre><code>// No named return values\n// Pointer argument receiver\nfunc growOs(os *[]outer) *[]outer {\n    for _, o := range *os {\n        o.inner.grow()\n        *os = append(*os, o)\n    }\n    fmt.Printf(\"%p: %+v \\n\", os, os)\n    return os\n}\n\nfunc main() {\n    // `os` is a pointer to the object\n    os := &amp;[]outer{\n        outer{},\n        outer{},\n    }\n    fmt.Printf(\"%p: %+v \\n\", os, os)\n    growOs(os)\n    fmt.Printf(\"%p: %+v \\n\", os, os)\n}\n</code></pre>\n"}], "owner": {"reputation": 2243, "user_id": 1149933, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ed2f32d0346075a7167e398d57778182?s=128&d=identicon&r=PG", "display_name": "Adam Barnes", "link": "https://stackoverflow.com/users/1149933/adam-barnes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "accepted_answer_id": 42059099, "answer_count": 3, "score": 1, "last_activity_date": 1486393862, "creation_date": 1486336197, "question_id": 42058388, "link": "https://stackoverflow.com/questions/42058388/why-are-my-changes-to-a-nested-struct-in-an-array-being-lost-outside-of-the-func", "title": "Why are my changes to a nested struct in an array being lost outside of the function making the changes?", "body": "<p>I'm still in the \"wrestling with the language\" stage of my Go progress, so forgive me for almost definitely missing something very obvious here.</p>\n\n<p>I'm defining two structs, one containing the other.  I make an array of the outer structs, pass it to a function, which calls a method on each of the inner structs, modifying their contents.  This change is visible within the function, but when adding the outer structs to an array for returning, the outer function can't see the changes.  I've tried throwing pointers in everywhere to little avail - somewhat thankfully, because it looked awful.</p>\n\n<pre><code>package main\n\nimport \"github.com/davecgh/go-spew/spew\"\n\ntype inner struct {\n  ints []int\n}\n\nfunc (i *inner) grow() {\n  i.ints = append(i.ints, 0)\n}\n\ntype outer struct {\n  inner inner\n}\n\nfunc growOs(os []outer) (out []outer) {\n  for _, o := range os {\n    o.inner.grow()\n    out = append(out, o)\n  }\n  spew.Dump(\"----------during\")\n  spew.Dump(out)\n  return\n}\n\nfunc main() {\n  os := []outer{\n    outer{},\n    outer{},\n  }\n  spew.Dump(\"----------pre\")\n  spew.Dump(os)\n  growOs(os)\n  spew.Dump(\"----------post\")\n  spew.Dump(os)\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "path"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486337113, "post_id": 42058136, "comment_id": 71289601, "body": "Have you logged out completely since you modified your <code>.profile</code>?"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486337273, "post_id": 42058136, "comment_id": 71289632, "body": "Yes, I have logged out and back in. As I said, it is working when run from the terminal."}], "answers": [{"comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1486337516, "post_id": 42058536, "comment_id": 71289675, "body": "But that is my question: what IS the context that an application is run from when I double-click it? And how would I change my PATH variable globally if not in ~/.profile? Note that I also already tried changing it in my ~/.bashrc and /etc/bash.baschrc as well and it did not work."}, {"owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1486337684, "post_id": 42058536, "comment_id": 71289704, "body": "not sure about context you run it from when you double-click. But you can modify /etc/environment file to change it globally."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1486338306, "post_id": 42058536, "comment_id": 71289814, "body": "I just tried editing /etc/environment but the behavior is still the same."}, {"owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1486338378, "post_id": 42058536, "comment_id": 71289829, "body": "Did you restart your PC after you changed /etc/environment? logout-login doesn&#39;t work in this case. And you should not write &#39;export&#39; in /etc/environment."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1486338527, "post_id": 42058536, "comment_id": 71289860, "body": "Just did, doesn&#39;t help it."}], "tags": [], "owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "is_accepted": false, "score": 0, "last_activity_date": 1486377015, "last_edit_date": 1486377015, "creation_date": 1486337260, "answer_id": 42058536, "question_id": 42058136, "link": "https://stackoverflow.com/questions/42058136/different-os-getenvpath-results-from-shell-and-double-click-executable/42058536#42058536", "title": "Different os.Getenv(&quot;PATH&quot;) results from shell and double-click executable", "body": "<p>It depends on what PATH you want.</p>\n\n<p>Your program gets environment variables from the context it was executed from.\nYou need to modify your PATH variable for your system to \"know\" about executables provided with the Go release. And you usually don't need 'usr/local/go/bin' PATH when you already have a compiled binary file.</p>\n"}], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 310, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1486377015, "creation_date": 1486334291, "question_id": 42058136, "link": "https://stackoverflow.com/questions/42058136/different-os-getenvpath-results-from-shell-and-double-click-executable", "title": "Different os.Getenv(&quot;PATH&quot;) results from shell and double-click executable", "body": "<p>In my Go program I call os.Getenv(\"PATH\") on Linux (Debian) and I get different results when running the program from within the shell or when double-clicking the executable icon in my file browser or on my desktop.</p>\n\n<p>I have edited my ~/.profile to include the go binary in the PATH like so:</p>\n\n<p><code>export PATH=$PATH:/usr/local/go/bin</code></p>\n\n<p>as suggested the <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\" title=\"Getting Started\">Getting Started</a> Go instrutions.</p>\n\n<p>When I run my os.Getenv(\"PATH\") program from the shell it outputs:</p>\n\n<p><code>/usr/local/bin:/usr/bin:/bin:/usr/local/go/bin</code></p>\n\n<p>but when I run it by double-clicking the executable file it outputs:</p>\n\n<p><code>/usr/local/bin:/usr/bin:/bin</code></p>\n\n<p>This suggests that double-clicking an icon will not initialize the variables with the <code>profile</code> commands. How can I now get the PATH that I want, i.e. including the additional directories, from my Go program?</p>\n"}, {"tags": ["c#", "go", "rsa", "bouncycastle", "sha256"], "comments": [{"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1486336395, "post_id": 42057466, "comment_id": 71289449, "body": "You are missing the base64 decoding step in your Go program."}, {"owner": {"reputation": 33, "user_id": 4551184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06331262fe459b56a611aa36926b04c?s=128&d=identicon&r=PG", "display_name": "Toms Jansons", "link": "https://stackoverflow.com/users/4551184/toms-jansons"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1486357459, "post_id": 42057466, "comment_id": 71293467, "body": "yes, you were right. my code example was incorrect, but i did have the base64 encoding in the actual code. but still does not solve my problem unfortunately. I modified the go code to include it now."}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 1, "creation_date": 1486379850, "post_id": 42057466, "comment_id": 71304249, "body": "I have tried to sign and verify your hashed message using your public and private keys in Go, and it works. It seems, that the hard-coded <code>signatureStr</code> is incorrect."}, {"owner": {"reputation": 33, "user_id": 4551184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06331262fe459b56a611aa36926b04c?s=128&d=identicon&r=PG", "display_name": "Toms Jansons", "link": "https://stackoverflow.com/users/4551184/toms-jansons"}, "reply_to_user": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1486448672, "post_id": 42057466, "comment_id": 71336767, "body": "the <code>signatureStr</code> harcoded value is the result of the C# program that i copy from the console window. @dev.bmax Are you getting a different string in the console from the C# program?"}], "answers": [{"tags": [], "owner": {"reputation": 206, "user_id": 4824870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713f8db8763a5352eca7d85e67859e6f?s=128&d=identicon&r=PG&f=1", "display_name": "alex mullins", "link": "https://stackoverflow.com/users/4824870/alex-mullins"}, "is_accepted": true, "score": 1, "last_activity_date": 1486454369, "creation_date": 1486454369, "answer_id": 42084560, "question_id": 42057466, "link": "https://stackoverflow.com/questions/42057466/rsa-sha256-signature-generation-and-validation/42084560#42084560", "title": "RSA SHA256 signature generation and validation", "body": "<p>BouncyCastle will automatically calculate the sha256 of your message when you calculate the signature with sig.GenerateSignature(). What you should pass into sig.BlockUpdate() is the message that you want sha256 and rsa signed. So essentially you've used sha256 twice on your message.  </p>\n\n<p>You can see this here: <a href=\"https://play.golang.org/p/mplEnmNbs9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mplEnmNbs9</a>. On line 27 I added another call to sha256 on your hashBytes and then passed that to rsa.VerifyPKCS1v15() and works fine. </p>\n"}], "owner": {"reputation": 33, "user_id": 4551184, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f06331262fe459b56a611aa36926b04c?s=128&d=identicon&r=PG", "display_name": "Toms Jansons", "link": "https://stackoverflow.com/users/4551184/toms-jansons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6157, "favorite_count": 0, "accepted_answer_id": 42084560, "answer_count": 1, "score": 1, "last_activity_date": 1486454369, "creation_date": 1486329801, "last_edit_date": 1486450050, "question_id": 42057466, "link": "https://stackoverflow.com/questions/42057466/rsa-sha256-signature-generation-and-validation", "title": "RSA SHA256 signature generation and validation", "body": "<p>I am generating a RSA signature in C# by using BouncyCastle and validating the signature in Go. </p>\n\n<p>But for some reason the signature from the C# program will not validate in Go.</p>\n\n<p>The details:</p>\n\n<p>The public/private keypair is an example generated from <a href=\"http://travistidwell.com/jsencrypt/demo/\" rel=\"nofollow noreferrer\">Online RSA Key Generator</a></p>\n\n<p>The hash byte array is one that is generated by using SHA265 and hardcoded for simplicity.</p>\n\n<p>I've tried different signature algorithms for BouncyCastle, played around with key pairs but nothing seems to work. </p>\n\n<p>I've also validated that the byte array of the signature matches between the two languages...</p>\n\n<p>Can anyone tell me what I am missing here? Or at least how to investigate further?</p>\n\n<p>My C# code to generate the signature</p>\n\n<pre><code>    static void Main(string[] args)\n    {\n        byte[] hashBytes = new byte[32] { 152, 154, 255, 19, 168, 20, 167, 43, 232, 133, 146, 13, 183, 80, 186, 85, 180, 249, 95, 142, 234, 71, 93, 188, 29, 147, 220, 164, 248, 83, 196, 80 };\n        String privateKeyPemStr = @\"-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQCIw68jARnmvTh+xvMcv5iugtoHXt60NWEebfbghLTFuTlQvK0e\nxY5hxnN/uD2UVc/S3QGnBQn0AfynhxlEZkedpYBb5RWoVChGZMHu7hbZukMjByjx\nec0LjtuEQhY4m18XaVNmAQWD/EiROMGTghMwykkQ+SBtx4Gl/O/BB6F4SQIDAQAB\nAoGAJLarODFee6OGG/paXvhMC2TTFLFyBVxjAuEwKdtWD9IGQdc0fhM4gqTccofJ\n+B0FGiz7+ZMPtfImme5ZaRQv2wx7KOPbOdAyYxC7nLFCHYqDWZJ8/cCoS+hPJFd5\n9OeGLGz3QKfEEPtYEAw4+E/UjilYAtRNREkISkYoB9Va8PUCQQDDHMPRSCfXbfZV\nufmlRZj2bH8sjVaSBbJIw+y9HKJ3ORRnKGjtIZ/+z70EwMwtbbQKnl71SruO5HB9\nAUTtRka/AkEAs3GWQhplPbuH/fAlaEPy5GQilUNRt76NMsgtIFWPMXnt82cxTUUR\nRIKwX7M96WBppPZ2Dy7uLrX8O+3fr6BK9wJATZ0lsBy57JKLiTJ/wmTbIjuqozhe\nFZw6fYOiqt+3KSIFobuLcbkMgjp1AG0JS5D2K7swHvdpgMASl0dn+dMY1QJBAIPw\n9QbN2bs2dJvnQ9oSfDoq1rLhuOheF/xK68Nmpc8/VBMwwTOLoVK6tWzoopFC7ur4\nvX4Uh9WYwkpecab1OakCQD0SCs4zIggA/2NkUx8J5H07/drbm9uH+98EQUvzjTdz\nqSW2jJPCA4GYYmtnnDRduukjmkJlbaaTdEH5YLCilF0=\n-----END RSA PRIVATE KEY-----\";\n\n        StringReader strReader = new StringReader(privateKeyPemStr);\n        PemReader pemReader = new PemReader(strReader);\n        AsymmetricCipherKeyPair keyPair = (AsymmetricCipherKeyPair)pemReader.ReadObject();\n        RsaKeyParameters privateKey = (RsaKeyParameters)keyPair.Private;\n\n\n        ISigner sig = SignerUtilities.GetSigner(\"SHA256withRSA\");\n        sig.Init(true, privateKey);\n        sig.BlockUpdate(hashBytes, 0, hashBytes.Length);\n        byte[] signedBytes = sig.GenerateSignature();\n\n        var signedStr = Convert.ToBase64String(signedBytes);\n\n        Console.WriteLine(signedStr);\n        Console.ReadLine();            \n    }\n</code></pre>\n\n<p>This is my Go code to validate the signature. I copy the result of the C# code into the signature variable</p>\n\n<pre><code>func main() {\npubKeyStr := `-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCIw68jARnmvTh+xvMcv5iugtoH\nXt60NWEebfbghLTFuTlQvK0exY5hxnN/uD2UVc/S3QGnBQn0AfynhxlEZkedpYBb\n5RWoVChGZMHu7hbZukMjByjxec0LjtuEQhY4m18XaVNmAQWD/EiROMGTghMwykkQ\n+SBtx4Gl/O/BB6F4SQIDAQAB\n-----END PUBLIC KEY-----`\npemBlockPub, _ := pem.Decode([]byte(pubKeyStr))\npub, _ := x509.ParsePKIXPublicKey(pemBlockPub.Bytes)\npublicKey, _ := pub.(*rsa.PublicKey)\n\nsignatureStr := \"YJxDTSMnFb4uh/orsUjHTHEsW1dkxuStsGP0PmjmObJhog/7OQfWgBcBZ58w0qWoknLGMVBBgZTgJtKq1ZSSTsx9uXhNKEhNEI3a+7ZhmPiHp6JRLbftsEoGKe7FKU8vXkp6Bo90qMOoJz54YI2xue8EA9b5PTgjkGbDbKdimF8=\"\nsignatureBytes, err := base64.StdEncoding.DecodeString(signatureStr)\nhashBytes := [32]byte{152, 154, 255, 19, 168, 20, 167, 43, 232, 133, 146, 13, 183, 80, 186, 85, 180, 249, 95, 142, 234, 71, 93, 188, 29, 147, 220, 164, 248, 83, 196, 80}\n\nerr := rsa.VerifyPKCS1v15(publicKey, crypto.SHA256, hashBytes[:], signatureBytes)\n\nif err != nil {\n    fmt.Printf(\"err: %v\\n\", err)\n} else {\n    fmt.Printf(\"ok\")\n}\n</code></pre>\n\n<p>}</p>\n\n<p>If I use the following code in C# to validate the signature, it is fine. </p>\n\n<pre><code>        String publicKeyPemStr = @\"-----BEGIN PUBLIC KEY-----\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCIw68jARnmvTh+xvMcv5iugtoH\nXt60NWEebfbghLTFuTlQvK0exY5hxnN/uD2UVc/S3QGnBQn0AfynhxlEZkedpYBb\n5RWoVChGZMHu7hbZukMjByjxec0LjtuEQhY4m18XaVNmAQWD/EiROMGTghMwykkQ\n+SBtx4Gl/O/BB6F4SQIDAQAB\n-----END PUBLIC KEY-----\";\n\n        strReader = new StringReader(publicKeyPemStr);\n        pemReader = new PemReader(strReader);\n        RsaKeyParameters publicKey = (RsaKeyParameters)((AsymmetricKeyParameter)pemReader.ReadObject());\n\n        sig = SignerUtilities.GetSigner(\"SHA256withRSA\");\n        sig.Init(false, publicKey);\n        sig.BlockUpdate(hashBytes, 0, hashBytes.Length);\n\n        if (sig.VerifySignature(signedBytes))\n        {\n            Console.WriteLine(\"Ok\");\n        }\n        else\n        {\n            Console.WriteLine(\"NOK\");\n        }\n\n        Console.ReadLine();\n</code></pre>\n\n<p>Did some additional tests, the following Go code produces a totally different signature string from the C# code although the private key is the same. Where is the difference??</p>\n\n<pre><code>func main() {\nprivKeyStr := `-----BEGIN RSA PRIVATE KEY-----\nMIICXAIBAAKBgQCIw68jARnmvTh+xvMcv5iugtoHXt60NWEebfbghLTFuTlQvK0e\nxY5hxnN/uD2UVc/S3QGnBQn0AfynhxlEZkedpYBb5RWoVChGZMHu7hbZukMjByjx\nec0LjtuEQhY4m18XaVNmAQWD/EiROMGTghMwykkQ+SBtx4Gl/O/BB6F4SQIDAQAB\nAoGAJLarODFee6OGG/paXvhMC2TTFLFyBVxjAuEwKdtWD9IGQdc0fhM4gqTccofJ\n+B0FGiz7+ZMPtfImme5ZaRQv2wx7KOPbOdAyYxC7nLFCHYqDWZJ8/cCoS+hPJFd5\n9OeGLGz3QKfEEPtYEAw4+E/UjilYAtRNREkISkYoB9Va8PUCQQDDHMPRSCfXbfZV\nufmlRZj2bH8sjVaSBbJIw+y9HKJ3ORRnKGjtIZ/+z70EwMwtbbQKnl71SruO5HB9\nAUTtRka/AkEAs3GWQhplPbuH/fAlaEPy5GQilUNRt76NMsgtIFWPMXnt82cxTUUR\nRIKwX7M96WBppPZ2Dy7uLrX8O+3fr6BK9wJATZ0lsBy57JKLiTJ/wmTbIjuqozhe\nFZw6fYOiqt+3KSIFobuLcbkMgjp1AG0JS5D2K7swHvdpgMASl0dn+dMY1QJBAIPw\n9QbN2bs2dJvnQ9oSfDoq1rLhuOheF/xK68Nmpc8/VBMwwTOLoVK6tWzoopFC7ur4\nvX4Uh9WYwkpecab1OakCQD0SCs4zIggA/2NkUx8J5H07/drbm9uH+98EQUvzjTdz\nqSW2jJPCA4GYYmtnnDRduukjmkJlbaaTdEH5YLCilF0=\n-----END RSA PRIVATE KEY-----`\n\npemBlockPriv, _ := pem.Decode([]byte(privKeyStr))\nprivateKey, _ := x509.ParsePKCS1PrivateKey(pemBlockPriv.Bytes)\n\nhashBytes := [32]byte{152, 154, 255, 19, 168, 20, 167, 43, 232, 133, 146, 13, 183, 80, 186, 85, 180, 249, 95, 142, 234, 71, 93, 188, 29, 147, 220, 164, 248, 83, 196, 80}\n\nsignatureByte, _ := rsa.SignPKCS1v15(rand.Reader, privateKey, crypto.SHA256, hashBytes[:])\nsignatureStr := base64.StdEncoding.EncodeToString(signatureByte)\n\nfmt.Printf(\"%v\\n\", signatureStr)\n}\n</code></pre>\n"}, {"tags": ["go", "interface", "slice"], "comments": [{"owner": {"reputation": 12379, "user_id": 512155, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1d9e7cb33c7af34026a521a786ada19b?s=128&d=identicon&r=PG", "display_name": "jan groth", "link": "https://stackoverflow.com/users/512155/jan-groth"}, "edited": false, "score": 2, "creation_date": 1486345550, "post_id": 42054248, "comment_id": 71291081, "body": "3 downvotes, no comments?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 12379, "user_id": 512155, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1d9e7cb33c7af34026a521a786ada19b?s=128&d=identicon&r=PG", "display_name": "jan groth", "link": "https://stackoverflow.com/users/512155/jan-groth"}, "edited": false, "score": 2, "creation_date": 1486377136, "post_id": 42054248, "comment_id": 71302545, "body": "@jangroth: Probably because the question isn&#39;t too clear + the code contains some fairly obvious errors (ie it won&#39;t compile, but the compiler will tell you what the most obvious errors are)"}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 7515369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad8f7841c2a8fbde89c55027a86b918?s=128&d=identicon&r=PG&f=1", "display_name": "LoveLearn", "link": "https://stackoverflow.com/users/7515369/lovelearn"}, "edited": false, "score": 0, "creation_date": 1486312020, "post_id": 42054368, "comment_id": 71280991, "body": "i want execute for in function. how can do in function? <a href=\"https://play.golang.org/p/ZcIBLMliq3\" rel=\"nofollow noreferrer\">play.golang.org/p/ZcIBLMliq3</a>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1486313510, "last_edit_date": 1486313510, "creation_date": 1486311650, "answer_id": 42054368, "question_id": 42054248, "link": "https://stackoverflow.com/questions/42054248/cannot-range-over-list-type-interface-in-function-using-go/42054368#42054368", "title": "Cannot Range Over List Type Interface {} In Function Using Go", "body": "<p>It's possible to implement PrintCustomArray using the <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflect</a> package, but most experienced Go programmers will write a simple for loop:</p>\n\n<pre><code>for _, i := range box.Items {\n    fmt.Println(\"Name:\", i.Name)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/RhubiCpry0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RhubiCpry0</a></p>\n\n<p>You can also encapsulate it in a function:</p>\n\n<pre><code>func PrintCustomArray(items []MyBoxItem) {\n  for _, i := range items {\n    fmt.Println(\"Name:\", i.Name)\n  }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/c4EPQIx1AH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/c4EPQIx1AH</a></p>\n"}, {"tags": [], "owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "is_accepted": false, "score": 0, "last_activity_date": 1486312729, "creation_date": 1486312729, "answer_id": 42054574, "question_id": 42054248, "link": "https://stackoverflow.com/questions/42054248/cannot-range-over-list-type-interface-in-function-using-go/42054574#42054574", "title": "Cannot Range Over List Type Interface {} In Function Using Go", "body": "<p>Here since you are returning <code>box.Items</code> from <code>AddItem()</code>, <code>Items</code> is of the type <code>[]MyBoxItem</code> , so list should be of type <code>[]MyBoxItem</code> .Moreover you are returning 0 in <code>PrintCustomArray</code> and the return type you have set is <code>{}interface</code>.</p>\n\n<pre><code>func PrintCustomArray(list []MyBoxItem) {\n    //items := reflect.ValueOf(list)\n    for i, v := range list {\n        fmt.Println(i, v)\n    }\n    //return 0\n}\n</code></pre>\n\n<p>Again, <code>MyBoxItem</code> struct has only one variable named <code>Name</code> so <code>v.key</code> <code>v.value</code> won't make any sense.</p>\n\n<p>This is what the proper code should look like <a href=\"https://play.golang.org/p/ILoUwEWv6Y\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ILoUwEWv6Y</a> .</p>\n\n<p>You need to clear your understanding about interfaces in go. This might help <a href=\"https://golang.org/doc/effective_go.html#interfaces_and_types\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#interfaces_and_types</a> .</p>\n"}, {"tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": false, "score": 4, "last_activity_date": 1486341284, "last_edit_date": 1486341284, "creation_date": 1486339777, "answer_id": 42058795, "question_id": 42054248, "link": "https://stackoverflow.com/questions/42054248/cannot-range-over-list-type-interface-in-function-using-go/42058795#42058795", "title": "Cannot Range Over List Type Interface {} In Function Using Go", "body": "<h2>Note</h2>\n\n<p>The answer below describes, in broad strokes, 2 possible approaches: using interfaces, and using specific types. The approach focusing on interfaces is mentioned for completeness sake. IMHO, the case you've presented is not a viable use-case for interfaces.</p>\n\n<p>Below, you'll find a link to a playground example that uses both techniques. It should be apparent to anyone that the interface approach is too cumbersome if for this specific case.</p>\n\n<hr>\n\n<p>Quite apart from the fact that you don't really seem to be too familiar with how loops work in go (<code>v.Key</code> and <code>v.Value</code> are non-existent fields for example), I'll attempt to answer your question.</p>\n\n<p>You are passing a list to your function, sure enough, but it's being handled as an <code>interface{}</code> type. That means your function accepts, essentially, any value as an argument. You can't simply iterate over them.</p>\n\n<p>What you can do is use type assertions to convert the argument to a slice, then another assertion to use it as another, specific interface:</p>\n\n<pre><code>type Item interface{\n    key() string\n    val() string\n}\n\nfunc (i MyBoxItem) key() string {\n    return i.Key\n}\n\nfunc (i MyBoxItem) val() string {\n    return i.Value\n}\n\nfunc PrintCustomArray(list interface{}) error  {\n    listSlice, ok := list.([]interface{})\n    if !ok {\n        return fmt.Errorf(\"Argument is not a slice\")\n    }\n    for _, v := range listSlice {\n        item, ok := v.(Item)\n        if !ok {\n            return fmt.Errorf(\"element in slice does not implement the Item interface\")\n        }\n        fmt.Println(item.key(), item.val())\n    }\n    return nil\n}\n</code></pre>\n\n<p>But let's be honest, a function like this only works if a slice is passed as an argument. So having that first type assertion in there makes no sense whatsoever. At the very least, changing the function to something like this makes a lot more sense:</p>\n\n<pre><code>func PrintCustomArray(list []interface{})\n</code></pre>\n\n<p>Then, because we're not expecting an array as such, but rather a slice, the name should be changed to <code>PrintCustomSlice</code>.<br>\nLastly, because we're using the same type assertion for every value in the slice, we might as well change the function even more:</p>\n\n<pre><code>// at this point, we'll always return 0, which is pointless\n// just don't return anything\nfunc PrintCustomSlice(list []Item) {\n    for _, v := range list {\n        fmt.Println(v.key(), v.val())\n    }\n}\n</code></pre>\n\n<p>The advantages of a function like this is that it can still handle multiple types (all you have to do is implement the interface). You don't need any kind of expensive operations (like reflection), or type assertions.</p>\n\n<p>Type assertions are very useful, but in a case like this, they merely serve to hide problems that would otherwise have resulted in a compile-time error. Go's <code>interface{}</code> type is a very useful thing, but you seem to be using it to get around the type system. If that's what you want to achieve, why use a typed language in the first place?</p>\n\n<p>Some closing thoughts/remarks: If your function is only going to be used to iterate over specific <em>\"thing\"</em>, you don't need the interfaces at all, simply specify the type you're expecting to be passed to the function in the first place. In this case that would be:</p>\n\n<pre><code>func PrintCustomSlice(list []MyBoxItem) {\n    for _, v := range list {\n        fmt.Println(v.Key, v.Value)\n    }\n}\n</code></pre>\n\n<p>Another thing that I've noticed is that you seem to be exporting everything (all functions, types, and fields start with a capital letter). This, in go, is considered bad form. Only export what needs to be public. In the <code>main</code> package, that usually means you're hardly export anything.</p>\n\n<p>Lastly, as I mentioned at the start: you don't seem to have a firm grasp on the basics just yet. I'd strongly recommend you go through <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">the interactive tour</a>. It covers the basics nicely, but shows you the features of the language at a decent pace. It doesn't take long, and is well worth taking a couple of hours to complete</p>\n\n<hr>\n\n<h1>Playground <a href=\"https://play.golang.org/p/IQNWvedn_G\" rel=\"nofollow noreferrer\">demo</a></h1>\n"}], "owner": {"reputation": 41, "user_id": 7515369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad8f7841c2a8fbde89c55027a86b918?s=128&d=identicon&r=PG&f=1", "display_name": "LoveLearn", "link": "https://stackoverflow.com/users/7515369/lovelearn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9038, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1486341284, "creation_date": 1486310959, "last_edit_date": 1486312459, "question_id": 42054248, "link": "https://stackoverflow.com/questions/42054248/cannot-range-over-list-type-interface-in-function-using-go", "title": "Cannot Range Over List Type Interface {} In Function Using Go", "body": "<p>Cannot Range Over List Type Interface {} In Function Using Go.</p>\n\n<ul>\n<li>for me is important then i execute for in a function.</li>\n</ul>\n\n<p>How can fix?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype MyBoxItem struct {\n    Name string\n}\n\ntype MyBox struct {\n    Items []MyBoxItem\n}\n\nfunc (box *MyBox) AddItem(item MyBoxItem) []MyBoxItem {\n    box.Items = append(box.Items, item)\n    return box.Items\n}\n\nfunc PrintCustomArray(list interface{}) interface{}  {\n    //items := reflect.ValueOf(list)\n    for _, v := range list {\n        fmt.Println(v.Key,v.Value)\n    }\n    return 0\n}\nfunc main() {\n\n    items := []MyBoxItem{}\n    item := MyBoxItem{Name: \"Test Item 1\"}\n    box := MyBox{items}\n    box.AddItem(item)\n    fmt.Println((box.Items))\n    PrintCustomArray(box.Items)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ZcIBLMliq3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ZcIBLMliq3</a></p>\n\n<p>Error : <code>cannot range over list (type interface {})</code></p>\n\n<p>How can fix?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1486291806, "post_id": 42051117, "comment_id": 71274553, "body": "<code>Dogs</code> is a type, not a variable."}], "answers": [{"comments": [{"owner": {"reputation": 187, "user_id": 6096990, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0e1a94c9d0872086bbc93f9b0ed6903?s=128&d=identicon&r=PG&f=1", "display_name": "pkmangg", "link": "https://stackoverflow.com/users/6096990/pkmangg"}, "edited": false, "score": 0, "creation_date": 1486292291, "post_id": 42051146, "comment_id": 71274685, "body": "Lets say I have to use what is given, how do I make it a variable so I can call it in Append?"}, {"owner": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "reply_to_user": {"reputation": 187, "user_id": 6096990, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0e1a94c9d0872086bbc93f9b0ed6903?s=128&d=identicon&r=PG&f=1", "display_name": "pkmangg", "link": "https://stackoverflow.com/users/6096990/pkmangg"}, "edited": false, "score": 0, "creation_date": 1486296715, "post_id": 42051146, "comment_id": 71275878, "body": "You can create a variable from <code>type Dogs []Dog</code> , for example: <code>var myDogs Dogs</code>"}], "tags": [], "owner": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "is_accepted": true, "score": 5, "last_activity_date": 1486291884, "creation_date": 1486291884, "answer_id": 42051146, "question_id": 42051117, "link": "https://stackoverflow.com/questions/42051117/first-argument-to-append-must-be-slice/42051146#42051146", "title": "First argument to append must be slice", "body": "<p>Dogs is a type not a variable, you probably meant to:</p>\n\n<pre><code>var Dogs []Dog\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3819, "user_id": 5802335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6561d4f88469479b23557bdf8b4b6ae4?s=128&d=identicon&r=PG&f=1", "display_name": "metmirr", "link": "https://stackoverflow.com/users/5802335/metmirr"}, "is_accepted": false, "score": 6, "last_activity_date": 1486292656, "creation_date": 1486292656, "answer_id": 42051263, "question_id": 42051117, "link": "https://stackoverflow.com/questions/42051117/first-argument-to-append-must-be-slice/42051263#42051263", "title": "First argument to append must be slice", "body": "<p>As friends says it should not be a type, here is example can be helpful:</p>\n\n<pre><code>// Create empty slice of struct pointers.\nDogs := []*Dog{}\n// Create struct and append it to the slice.\ndog := new(Dog)\ndog.color = \"black\"\nDogs = append(Dogs, dog)\n</code></pre>\n"}], "owner": {"reputation": 187, "user_id": 6096990, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f0e1a94c9d0872086bbc93f9b0ed6903?s=128&d=identicon&r=PG&f=1", "display_name": "pkmangg", "link": "https://stackoverflow.com/users/6096990/pkmangg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14027, "favorite_count": 1, "accepted_answer_id": 42051146, "answer_count": 2, "score": 5, "last_activity_date": 1531928382, "creation_date": 1486291730, "last_edit_date": 1531928382, "question_id": 42051117, "link": "https://stackoverflow.com/questions/42051117/first-argument-to-append-must-be-slice", "title": "First argument to append must be slice", "body": "<p>I am having trouble calling the <code>append</code> function in Go</p>\n\n<pre><code>type Dog struct {\n    color  string\n}\n\ntype Dogs []Dog\n</code></pre>\n\n<p>I want to append \"Dog\" into \"Dogs\". </p>\n\n<p>I tried doing this</p>\n\n<pre><code>Dogs = append(Dogs, Dog)\n</code></pre>\n\n<p>But I get this error</p>\n\n<pre><code>First argument to append must be slice; have *Dogs\n</code></pre>\n\n<p>Sorry, I'm new to Go.</p>\n\n<p>Thanks!</p>\n\n<p>Edit:\nAlso, if I want to check if this Dog contains the color \"white\", for example. How would I call this?</p>\n\n<pre><code> if Dog.color.contains(\"white\") { \n    //then append this Dog into Dogs\n }\n</code></pre>\n"}, {"tags": ["go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 3095, "user_id": 178597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13148e76e55c7429e663480dc900bf77?s=128&d=identicon&r=PG", "display_name": "Christian", "link": "https://stackoverflow.com/users/178597/christian"}, "is_accepted": false, "score": 1, "last_activity_date": 1486293362, "creation_date": 1486293362, "answer_id": 42051400, "question_id": 42050754, "link": "https://stackoverflow.com/questions/42050754/pass-object-to-struct-in-other-package/42051400#42051400", "title": "Pass object to struct in other package", "body": "<p>In the package rest you have to add a constructor function like:</p>\n\n<pre><code>func NewAssetHandler(mc my.Client) AssetHandler {\n    return AssetHandler{mc}\n}\n</code></pre>\n\n<p>Then you have to instantiate the handler from your main function.</p>\n\n<p>Otherwise you would have to create a separate package where you store global variables. The main package itself can not be used for this because it can't be accessed from somewhere else.</p>\n"}], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486293362, "creation_date": 1486289048, "question_id": 42050754, "link": "https://stackoverflow.com/questions/42050754/pass-object-to-struct-in-other-package", "title": "Pass object to struct in other package", "body": "<p>I have a main function, where I initiate a variable, a client. For example:</p>\n\n<pre><code>func main() {\n  myClient := my.MustNewClient(\"localhost\")\n}\n</code></pre>\n\n<p>Now I want to pass this client to another package, but for some reason I cannot figure out how to do this. My package looks like this:</p>\n\n<pre><code>package rest\n\nimport (\n    \"net/http\"\n    \"github.com/Sirupsen/logrus\"\n)\n\ntype AssetHandler struct {\n    mc my.Client\n}\n\nfunc (f AssetHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    logrus.Info(\"bla\")\n    // here I want to use the client\n    mc.SomeFunctionIntheClient()\n\n}\n</code></pre>\n\n<p>So my question is, how do I use the client (out of main) in my package?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1486285573, "post_id": 42050085, "comment_id": 71272914, "body": "It is operating system specific. Linux has multiplexing calls (like <a href=\"http://man7.org/linux/man-pages/man2/poll.2.html\" rel=\"nofollow noreferrer\">poll(2)</a>) and non-blocking IO (see <a href=\"http://man7.org/linux/man-pages/man7/signal.7.html\" rel=\"nofollow noreferrer\">signal(7)</a> &amp; <a href=\"http://man7.org/linux/man-pages/man2/fcntl.2.html\" rel=\"nofollow noreferrer\">fcntl(2)</a> with <code>F_SETOWN</code> etc...) and asynchronous IO (see <a href=\"http://man7.org/linux/man-pages/man7/aio.7.html\" rel=\"nofollow noreferrer\">aio(7)</a>...). Your usage of <a href=\"https://en.wikipedia.org/wiki/Process_%28computing%29\" rel=\"nofollow noreferrer\"><i>process</i></a> word is wrong. Read also <a href=\"http://advancedlinuxprogramming.com/\" rel=\"nofollow noreferrer\">advancedlinuxprogramming.com</a> &amp; <a href=\"http://pages.cs.wisc.edu/~remzi/OSTEP/\" rel=\"nofollow noreferrer\">pages.cs.wisc.edu/~remzi/OSTEP</a>"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1486285809, "post_id": 42050085, "comment_id": 71272978, "body": "Your question is wrongly formulated, and is too broad to get an answer in a few paragraphs. Once you have understood more about operating systems, you could dive into the source code of Go runtime, since it is free software. On Linux, you might also experiment with <a href=\"http://man7.org/linux/man-pages/man1/strace.1.html\" rel=\"nofollow noreferrer\">strace(1)</a>. BTW, Go runtime is using <a href=\"https://en.wikipedia.org/wiki/Green_threads\" rel=\"nofollow noreferrer\">green threads</a> with <a href=\"https://gcc.gnu.org/wiki/SplitStacks\" rel=\"nofollow noreferrer\">split stacks</a>"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1486296704, "post_id": 42050085, "comment_id": 71275873, "body": "The Go runtime scheduler implements M&#215;N multiplexing of the <i>goroutines</i> (Go&#39;s concurrency primitives) over some dynamically changing number of OS threads. While Go scheduler gets updated almost any Go release, the basics of its implementation explained <a href=\"https://morsmachine.dk/go-scheduler\" rel=\"nofollow noreferrer\">here</a> still hold true, so please read it."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1486296744, "post_id": 42050085, "comment_id": 71275888, "body": "I should also say that the question as stated is unfit for SO; please direct such questions to the <code>golang-nuts</code> mailing list or the <code>&#47;r&#47;golang</code> Subreddit for instance."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1486383518, "post_id": 42050085, "comment_id": 71306423, "body": "Also note that goroutines are not quite like coroutines in other languages. You do not <i>need</i> to call any yield function ever (although <code>runtime.Gosched</code> exists for performance tuning)."}], "owner": {"reputation": 6743, "user_id": 1432751, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/e80f2b22b8c98730708ad3842c11604b?s=128&d=identicon&r=PG", "display_name": "Dmitry Bubnenkov", "link": "https://stackoverflow.com/users/1432751/dmitry-bubnenkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1486284158, "creation_date": 1486284158, "question_id": 42050085, "link": "https://stackoverflow.com/questions/42050085/where-is-background-process-execute", "title": "Where is background process execute?", "body": "<p>Ok, for example we have some blocking operation. Few questions.</p>\n\n<ol>\n<li><p>How Go understand that it's blocking operation and it's time to do <code>yield</code> (I do not know how it's name in Go)</p></li>\n<li><p>For example blocking operation is Reading file or some heavy calculations. Where are they processing? If I right understand goroutines should delegate it's processing for example to system threads. Am I right? But does it's mean that for every blocking operation new system thread is starting? If yes it's seems that we would have same problem with context-switching when would have a lot of system threads.</p></li>\n</ol>\n"}, {"tags": ["pointers", "go", "struct", "interface", "polymorphism"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 2, "creation_date": 1486292008, "post_id": 42049875, "comment_id": 71274609, "body": "fmt.Printf(&quot;Addr: %p\\n&quot;, adapter1) in first case and fmt.Printf(&quot;Addr: %p\\n&quot;, &amp;adapter) in second. &amp;adapter is pointer to pointer"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1486315274, "post_id": 42049875, "comment_id": 71282139, "body": "To add to @Uvelichitel&#39;s comment: The first printf is printing the address of an adapter, the second is printing the address of a local variable containing the address of an adapter."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1486318011, "post_id": 42049875, "comment_id": 71283122, "body": "@CeriseLim&#243;n so when we iterate over something, we&#39;re iterating over pointers?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1486322223, "post_id": 42049875, "comment_id": 71284665, "body": "Range iterates over values from the slice. In the for loop, your code prints the address of one of these values.  You should simply print the value.  <code>fmt.Printf(&quot;Addr: %p\\n&quot;, adapter)</code> will give the result you are expecting."}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 180656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c91c0ae420dcaf04e5e9061be6a93c?s=128&d=identicon&r=PG", "display_name": "Josef Grahn", "link": "https://stackoverflow.com/users/180656/josef-grahn"}, "is_accepted": true, "score": 0, "last_activity_date": 1486323247, "last_edit_date": 1486323247, "creation_date": 1486322924, "answer_id": 42056265, "question_id": 42049875, "link": "https://stackoverflow.com/questions/42049875/slice-of-pointers-when-passed-to-object-gets-pointers-with-other-addresses/42056265#42056265", "title": "Slice of pointers, when passed to object, gets pointers with other addresses", "body": "<p>In <code>var adapters []LogicAdapter</code>, you have an array of interfaces. The interface is itself essentially an object carrying a pointer to the object you assigned to it (with some extra information to track its type etc.). So when you append an <code>*ExampleAdapter</code> to it, you will create an interface instance holding a pointer to an <code>ExampleAdapter</code>.</p>\n\n<p>Later, when you do <code>for _, adapter := range logic.adapters {...}</code>, the variable <code>adapter</code> declared in the loop will be a copy of the interface \"object\" in the slice. So when you take a pointer to it with <code>&amp;adapter</code> you get a pointer to the <em>interface</em>, not to the <code>ExampleAdapter</code> the interface contains a pointer to.</p>\n\n<p>For a more detailed exposition of the internals of interfaces, see for example <a href=\"https://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">https://research.swtch.com/interfaces</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 42056265, "answer_count": 1, "score": 1, "last_activity_date": 1486323247, "creation_date": 1486282415, "question_id": 42049875, "link": "https://stackoverflow.com/questions/42049875/slice-of-pointers-when-passed-to-object-gets-pointers-with-other-addresses", "title": "Slice of pointers, when passed to object, gets pointers with other addresses", "body": "<p>I'm trying to pass a slice of pointers to structs that implement the interface LogicAdapter. Here's my code:</p>\n\n<p><strong>main.go:</strong></p>\n\n<pre><code>var adapters[]LogicAdapter\n    adapter1 := &amp;ExampleAdapter{}\n    fmt.Printf(\"Addr: %p\\n\", adapter1)\n    adapters = append(adapters, adapter1)\n    bot := ChatterBot{\"Charlie\", MultiLogicAdapter{adapters}}\n    bot.getResponse(\"test\", 0)\n</code></pre>\n\n<p><strong>multiadapterlogic.go:</strong></p>\n\n<pre><code>type MultiLogicAdapter struct {\n    adapters []LogicAdapter\n}\n\nfunc (logic *MultiLogicAdapter) process(text string, session int) string {\n    //response := logic.adapters[0].process(text, session)\n    response := \"\"\n    for _, adapter := range logic.adapters {\n        fmt.Printf(\"Addr: %p\\n\", &amp;adapter)\n    }\n    _ = response\n    return \"\"\n}\n</code></pre>\n\n<p>The output of main is:</p>\n\n<pre><code>Addr: 0x5178f0\n\nAddr: 0xc42000a340\n</code></pre>\n\n<p>I didn't include LogicAdapter because I don't think it's necessary. \nI don't like to fill this with much code, but here's ChatterBot if it makes things easier to understand (but keep in mind that <code>bot.getResponse</code> calls <code>process</code>, that's it)</p>\n\n<p><strong>chatterbot.go</strong></p>\n\n<pre><code>type ChatterBot struct {\n    Name string\n    MultiLogicAdapter\n}\n\nfunc (bot *ChatterBot) getResponse(text string, session int) string {\n    response := bot.process(text, session)\n    _ = response\n    return \"\"\n}\n</code></pre>\n\n<p>First of all, I had the idea of storing pointers to LogicAdapters, in this way</p>\n\n<pre><code>var adapters[]*LogicAdapter\n</code></pre>\n\n<p>but everytime I tried to insert the adapter1 pointer there, I got: </p>\n\n<p>*LogicAdapter is pointer to interface, not interface</p>\n\n<p>so I discovered <a href=\"https://stackoverflow.com/questions/13511203/why-cant-i-assign-a-struct-to-an-interface\">this</a> and learned this:</p>\n\n<blockquote>\n  <p>When you have a struct implementing an interface, a pointer to that\n  struct implements automatically that interface too. That's why you\n  never have *SomeInterface in the prototype of functions, as this\n  wouldn't add anything to SomeInterface, and you don't need such a type\n  in variable declaration (see this related question).</p>\n</blockquote>\n\n<p>So I decided to leave the <code>adapters[]</code> declaration as you see in the code. The problem is that besides <code>adapters</code> storing a pointer to <code>adapter1</code>, when it gets printed in <code>MultiLogicAdapter</code>, it's another address. I know that I'm passing <code>adapters</code> to <code>MultiLogicAdapter</code> as a copy, but the copy would have the same references to <code>adapter1</code>. So what's happening?</p>\n\n<p>Why I'm iterating through pointers? Because of this: <a href=\"https://www.goinggo.net/2013/09/iterating-over-slices-in-go.html\" rel=\"nofollow noreferrer\">https://www.goinggo.net/2013/09/iterating-over-slices-in-go.html</a>\nIf I don't, I'll be creating lots of unecessary copies. </p>\n"}, {"tags": ["go", "gofmt"], "answers": [{"tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": true, "score": 5, "last_activity_date": 1486277911, "creation_date": 1486277911, "answer_id": 42049383, "question_id": 42049267, "link": "https://stackoverflow.com/questions/42049267/does-my-gofmt-work-wrongly-or-i-dont-understand-something/42049383#42049383", "title": "Does my gofmt work wrongly or I don&#39;t understand something?", "body": "<p>Presumably <code>gofmt</code> works as its authors intended, which might be different from what you expected.\nThe <a href=\"https://golang.org/cmd/gofmt/\" rel=\"noreferrer\">documentation</a> says:</p>\n\n<blockquote>\n  <p>Both pattern and replacement must be valid Go expressions. In the pattern, single-character lowercase identifiers serve as wildcards matching arbitrary sub-expressions; those expressions will be substituted for the same identifiers in the replacement.</p>\n</blockquote>\n\n<p>As you have only a single lowercase letter in the pattern, <em>it matches all sub-expressions</em>. And then replaces them with <code>H</code>. Let's take your example further, consider this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc compare(a, b int) {\n    if a + b &lt; a * b {\n        fmt.Printf(\"hello, world\\n\")\n    }\n}\n</code></pre>\n\n<p>After the same <code>gofmt</code> command the above code becomes:</p>\n\n<pre><code>package H\n\nimport \"fmt\"\n\nfunc H(H, H H) {\n    if H+H &lt; H*H {\n        H\n    }\n}\n</code></pre>\n\n<p>If this is not what you want, then you should use a more specific pattern expression.</p>\n"}], "owner": {"reputation": 115, "user_id": 7518118, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/03e33a5f54c6f309726767274c815910?s=128&d=identicon&r=PG&f=1", "display_name": "Andy D", "link": "https://stackoverflow.com/users/7518118/andy-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 1, "accepted_answer_id": 42049383, "answer_count": 1, "score": 2, "last_activity_date": 1486284737, "creation_date": 1486276843, "last_edit_date": 1486284737, "question_id": 42049267, "link": "https://stackoverflow.com/questions/42049267/does-my-gofmt-work-wrongly-or-i-dont-understand-something", "title": "Does my gofmt work wrongly or I don&#39;t understand something?", "body": "<p>I suppose that my <code>gofmt</code> works not how it's supposed to, am I right ?</p>\n\n<p>Original file:</p>\n\n<pre><code>package main\n\n\nimport \"fmt\"\n\n\nfunc main() {\n    fmt.Printf(\"hello, world\\n\")\n}\n</code></pre>\n\n<p>Then I did:</p>\n\n<pre><code>gofmt -r 'h -&gt; H' -w \"hello.go\"\n</code></pre>\n\n<p>Content of the file after:</p>\n\n<pre><code>package H\n\n\nimport \"fmt\"\n\n\nfunc H() {\n H\n}\n</code></pre>\n"}, {"tags": ["sql", "sqlite", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7517990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a63bf879ac98f19b75bbe4417d2b549d?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Lesa", "link": "https://stackoverflow.com/users/7517990/andre-lesa"}, "edited": false, "score": 0, "creation_date": 1487087881, "post_id": 42177442, "comment_id": 71620761, "body": "I agree. I am documenting some bugs in it too. But pure SQL is the way."}], "tags": [], "owner": {"reputation": 583, "user_id": 1840094, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdf16b9a48f387c59fd5b6a4e412c027?s=128&d=identicon&r=PG", "display_name": "sethammons", "link": "https://stackoverflow.com/users/1840094/sethammons"}, "is_accepted": false, "score": 0, "last_activity_date": 1486825969, "creation_date": 1486825969, "answer_id": 42177442, "question_id": 42049175, "link": "https://stackoverflow.com/questions/42049175/gorm-many2many-preload-error/42177442#42177442", "title": "GORM many2many preload error", "body": "<p>The crux of your issue is in your WHERE clause, you need to use \"OR\", not \",\". </p>\n\n<p>This is likely an issue with GORM and you could open a GitHub issue with them for this. You can get around the issue using db.Raw() from GORM. In general, I prefer to avoid ORMs. Part of the reason is it is often easier to just build an SQL query by hand than try to figure out the strange way to do it in the ORM (for things beyond basic CRUD).</p>\n"}], "owner": {"reputation": 11, "user_id": 7517990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a63bf879ac98f19b75bbe4417d2b549d?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Lesa", "link": "https://stackoverflow.com/users/7517990/andre-lesa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 625, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1486825969, "creation_date": 1486275849, "question_id": 42049175, "link": "https://stackoverflow.com/questions/42049175/gorm-many2many-preload-error", "title": "GORM many2many preload error", "body": "<p>Currently using GORM to connect to two databases: POSTGRES AND sqlite (using a code switch to choose which one to use). I have a 2 database tables defined in my schema that look like this:</p>\n\n<pre><code>type TableClient struct { \n    Model\n    Synchronised bool\n    FacilityID string `gorm:\"primary_key\"`\n    Age                       int\n    ClientSexID               int  \n    MaritalStatusID           int\n    SpecificNeeds             []TableOptionList`gorm:\"many2many:options_specific_needs\"`\n}\n\ntype TableOptionList struct {\n    ID        int `gorm:\"primary_key\"`\n    Name    string\n    Value   string\n    Text    string\n    SortKey int\n  }\n</code></pre>\n\n<p>Previously, I would preload related table with code like this: </p>\n\n<pre><code>var dbClient TableClient\nDb.Where(\"facility_id = ? AND client_id = ? AND id = ?;\", URLFacilityID, URLClientID, URLIncidentID).\n   Preload(\"ClientSex\").\n   Preload(\"MaritalStatus\").\n   Preload(\"CareTakerRelationShip\").\n   Preload(\"HighestLevelOfEducation\").\n   Preload(\"Occupation\").\n   Preload(\"SpecificNeeds\").\n   First(&amp;dbClient)\n</code></pre>\n\n<p>Now that lookup fails with a syntax error and when I look at the SQL generated, it shows the following SQL is generated:</p>\n\n<pre><code>SELECT * FROM \"table_option_lists\" INNER JOIN \"options_specific_needs\" ON       \"options_specific_needs\".\"table_option_list_id\" = \"table_option_lists\".\"id\" WHERE ((\"options_specific_needs\".\"table_client_id\",\"options_specific_needs\".\"table_client_facility_id\") IN (('one','LS034')))\n</code></pre>\n\n<p>Pasting that into the sqlite console also fails with the same error: (near \",\": syntax error) </p>\n"}, {"tags": ["java", "android", "android-studio", "go"], "answers": [{"comments": [{"owner": {"reputation": 721, "user_id": 2108258, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/7b01fe08a510994b22f4c9d976d66bda?s=128&d=identicon&r=PG", "display_name": "user2108258", "link": "https://stackoverflow.com/users/2108258/user2108258"}, "edited": false, "score": 0, "creation_date": 1486325247, "post_id": 42053125, "comment_id": 71285813, "body": "I tried using the golang.mobile.bind plugin but I&#39;m not sure how to configure it properly. I keep getting the following gradle error      :mobilelib:gobind FAILED      FAILURE: Build failed with an exception.      * What went wrong:     Execution failed for task &#39;:mobilelib:gobind&#39;.     &gt; Cannot get property &#39;classpath&#39; on null object      * Try:     Run with --stacktrace option to get the stack trace. Run with --info or --     debug option to get more log output.      BUILD FAILED      Total time: 0.427 secs"}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "reply_to_user": {"reputation": 721, "user_id": 2108258, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/7b01fe08a510994b22f4c9d976d66bda?s=128&d=identicon&r=PG", "display_name": "user2108258", "link": "https://stackoverflow.com/users/2108258/user2108258"}, "edited": false, "score": 0, "creation_date": 1486329008, "post_id": 42053125, "comment_id": 71287189, "body": "I know, this plugin stopped functioning after the update of the Gradle tools. This is why I had to fall back to using the first option."}], "tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 2, "last_activity_date": 1486304390, "creation_date": 1486304390, "answer_id": 42053125, "question_id": 42048423, "link": "https://stackoverflow.com/questions/42048423/android-golang-bind-refresh-aar/42053125#42053125", "title": "Android golang bind refresh *.aar", "body": "<p>In theory,  you have two options:</p>\n\n<ol>\n<li><p>Run <code>gomobile bind</code> manually each time you change the library, then copy the AAR file from your Go source directory to the <code>mobilelib</code> directory, replacing the old AAR file. And, finally rebuild the project; </p></li>\n<li><p>Use the <code>org.golang.mobile.bind</code> Gradle plugin, that is supposed to do all of this work for you.</p></li>\n</ol>\n\n<p>But, as far as I know, the plugin is not up-to-date with the latest Gradle tools and doesn't work properly.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 4717162, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250c2face9d59936ee57a2b37ba662c0?s=128&d=identicon&r=PG&f=1", "display_name": "DYMATEJlb", "link": "https://stackoverflow.com/users/4717162/dymatejlb"}, "is_accepted": false, "score": 0, "last_activity_date": 1591173913, "creation_date": 1591173913, "answer_id": 62168626, "question_id": 42048423, "link": "https://stackoverflow.com/questions/42048423/android-golang-bind-refresh-aar/62168626#62168626", "title": "Android golang bind refresh *.aar", "body": "<p>I had the same problem. I solved it by simplifying a new function on golang. I used struct with supported by gomobile data types to return the result, when I simplified the function (encoded the result into a simple string), everything worked.</p>\n"}], "owner": {"reputation": 721, "user_id": 2108258, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/7b01fe08a510994b22f4c9d976d66bda?s=128&d=identicon&r=PG", "display_name": "user2108258", "link": "https://stackoverflow.com/users/2108258/user2108258"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 733, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1591173913, "creation_date": 1486267473, "question_id": 42048423, "link": "https://stackoverflow.com/questions/42048423/android-golang-bind-refresh-aar", "title": "Android golang bind refresh *.aar", "body": "<p>I am importing an aar file using the new module > import JAR or AAR package option. Initially I was able call a method from my library. However after updating the library and running Gomobile bind again, I can't figure out how to update the aar file. The new methods are not shown after updating the .aar file manually.\nImporting again causes \"Project already contains subproject with name mobilelib\". </p>\n\n<p>Android Studio 2.2.3\nHow do I refresh the .aar file?</p>\n\n<p>build.gradle(app)</p>\n\n<pre><code>apply plugin: 'com.android.application'\n\nandroid {\n    compileSdkVersion 24\n    buildToolsVersion \"23.0.2\"\n    defaultConfig {\n        applicationId \"com.testing.testgolanglib\"\n        minSdkVersion 16\n        targetSdkVersion 24\n        versionCode 1\n        versionName \"1.0\"\n        testInstrumentationRunner \"android.support.test.runner.AndroidJUnitRunner\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'\n        }\n    }\n}\n\ndependencies {\n    compile fileTree(include: ['*.jar'], dir: 'libs')\n    androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    })\n    compile 'com.android.support:appcompat-v7:24.2.1'\n    testCompile 'junit:junit:4.12'\n    compile project(':mobilelib')\n}\n</code></pre>\n\n<p>mobilelib</p>\n\n<pre><code>configurations.maybeCreate(\"default\")\nartifacts.add(\"default\", file('mobilelib.aar'))\n</code></pre>\n\n<p>Project build.gradle</p>\n\n<pre><code>// Top-level build file where you can add configuration options common to all sub-projects/modules.\n\nbuildscript {\n    repositories {\n        jcenter()\n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:2.2.3'\n\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n    }\n}\n\nallprojects {\n    repositories {\n        jcenter()\n        flatDir{\n            dirs '/Users/abc/projects/go/src/com.abc/mobilelib'\n        }\n\n    }\n\n}\n\ntask clean(type: Delete) {\n    delete rootProject.buildDir\n}\n</code></pre>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1486265547, "post_id": 42047991, "comment_id": 71269270, "body": "Have you tested this code with the race detector? That is the first thing you should do with seemingly random or unpredictable bugs."}, {"owner": {"reputation": 1, "user_id": 3030907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11edc38e918850a9e68b3a58f18bfa09?s=128&d=identicon&r=PG", "display_name": "Gian Giovani", "link": "https://stackoverflow.com/users/3030907/gian-giovani"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486301509, "post_id": 42047991, "comment_id": 71277393, "body": "haven&#39;t yet, is this good starting point for me <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">Data Race Detector</a> ? or do you have another suggestion"}, {"owner": {"reputation": 1, "user_id": 3030907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11edc38e918850a9e68b3a58f18bfa09?s=128&d=identicon&r=PG", "display_name": "Gian Giovani", "link": "https://stackoverflow.com/users/3030907/gian-giovani"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486301732, "post_id": 42047991, "comment_id": 71277471, "body": "I am using prepared statement, if it race condition, it could be coming from there."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486304335, "post_id": 42047991, "comment_id": 71278263, "body": "There&#39;s not much to the race detector, just enable it for you binary and monitor the logs. I&#39;m not sure what you mean with the prepared statement, that doesn&#39;t seem relevant."}, {"owner": {"reputation": 1, "user_id": 3030907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11edc38e918850a9e68b3a58f18bfa09?s=128&d=identicon&r=PG", "display_name": "Gian Giovani", "link": "https://stackoverflow.com/users/3030907/gian-giovani"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1486527267, "post_id": 42047991, "comment_id": 71378696, "body": "using race detector is not possible, its overhead is too much in production. My staging setup couldn&#39;t reproduce this issue, I need to figure out how to reproduce this issue in staging."}], "answers": [{"tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 0, "last_activity_date": 1486337061, "creation_date": 1486337061, "answer_id": 42058508, "question_id": 42047991, "link": "https://stackoverflow.com/questions/42047991/golang-postgresql-rows-next-panic/42058508#42058508", "title": "Golang, postgresql rows.next() panic", "body": "<p>The driver expects a 4 byte slice to encode as an integer, but is panicking when trying to index the individual bytes.</p>\n\n<p>Could the data accidentally be nil, or a data type less than 4 bytes?</p>\n\n<p>In the driver <a href=\"https://github.com/lib/pq/blob/master/encode.go#L76\" rel=\"nofollow noreferrer\">github.com/lib/pq/encode.go</a>:</p>\n\n<pre><code>case oid.T_int4:\n    return int64(int32(binary.BigEndian.Uint32(s)))\n</code></pre>\n\n<p>In encoding/binary <a href=\"https://golang.org/src/encoding/binary/binary.go?s=7232:7296#L99\" rel=\"nofollow noreferrer\">Uint32</a> (this line panics with index out of bounds):</p>\n\n<pre><code>return uint32(b[3]) | uint32(b[2])&lt;&lt;8 | uint32(b[1])&lt;&lt;16 | uint32(b[0])&lt;&lt;24\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 3030907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11edc38e918850a9e68b3a58f18bfa09?s=128&d=identicon&r=PG", "display_name": "Gian Giovani", "link": "https://stackoverflow.com/users/3030907/gian-giovani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 515, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486337061, "creation_date": 1486262209, "question_id": 42047991, "link": "https://stackoverflow.com/questions/42047991/golang-postgresql-rows-next-panic", "title": "Golang, postgresql rows.next() panic", "body": "<p>I'm getting error when interating rows using rows.next() using postgresql in golang. This is only happens in several machines and in quite unpredictable timing, which make it difficult to debug.</p>\n\n<pre><code>panic: runtime error: index out of range [recovered]\n        panic: runtime error: index out of range\n\ngoroutine 28078 [running]:\npanic(0xa63ae0, 0xc420014090)\n        /usr/local/go/src/runtime/panic.go:500 +0x1a1\ngithub.com/lib/pq.(*conn).errRecover(0xc420780500, 0xc420d2ef28)\n        /share/dpkg-build/pacman-build/src/github.com/lib/pq/error.go:482 +0x57e\npanic(0xa63ae0, 0xc420014090)\n        /usr/local/go/src/runtime/panic.go:458 +0x243\ngithub.com/lib/pq.binaryDecode(0xc420780728, 0xc4207806f0, 0x0, 0x30, 0xc400000017, 0xa24300, 0xc421fcb4b0)\n        /share/dpkg-build/pacman-build/src/github.com/lib/pq/encode.go:76 +0x385\ngithub.com/lib/pq.decode(0xc420780728, 0xc4207806f0, 0x0, 0x30, 0x17, 0x1, 0xa24300, 0xc421fcb4b0)\n        /share/dpkg-build/pacman-build/src/github.com/lib/pq/encode.go:61 +0x6c\ngithub.com/lib/pq.(*rows).Next(0xc42281e310, 0xc420b82000, 0x2f, 0x2f, 0x0, 0x0)\n        /share/dpkg-build/pacman-build/src/github.com/lib/pq/conn.go:1369 +0x420\ndatabase/sql.(*Rows).Next(0xc42005b560, 0xc4204eb590)\n        /usr/local/go/src/database/sql/sql.go:1758 +0x6c\ngithub.com/xxxxx/yyyyy/src/product/elasticsearch.getPart1(0xc4204eb590, 0xa24300, 0xc420a04190, 0x0, 0x0) &lt;-- rows.next() here\n        /share/dpkg-build/pacman-build/src/github.com/xxxxxx/yyyyyy/src/product/elasticsearch/collector.go:71 +0xff\ngithub.com/xxxxx/yyyyy/src/product/elasticsearch.Get(0xa24300, 0xc420a04190, 0xc420a04190, 0xa24300, 0xc420a04190, 0xc420980a00)\n        /share/dpkg-build/pacman-build/src/github.com/xxxxxx/yyyyyy/src/product/elasticsearch/collector.go:29 +0x118\n</code></pre>\n\n<p>From the call-stack above the panic comes from binaryDecode function which I imagine explain why it's only happening in some machines. There might be some bad network package or the message got corrupted, so the driver couldn't decode the message then failing.</p>\n\n<p>However I don't know where to go after this, anyone has idea?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 7455397, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ZhF8.jpg?s=128&g=1", "display_name": "Huy Le", "link": "https://stackoverflow.com/users/7455397/huy-le"}, "edited": false, "score": 0, "creation_date": 1486270248, "post_id": 42048039, "comment_id": 71269978, "body": "hmm make senses. Thank you"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 35, "user_id": 7455397, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ZhF8.jpg?s=128&g=1", "display_name": "Huy Le", "link": "https://stackoverflow.com/users/7455397/huy-le"}, "edited": false, "score": 0, "creation_date": 1486283752, "post_id": 42048039, "comment_id": 71272515, "body": "@HuyLe, Go actually makes pointers simpler than in certain other languages because it does not contain pass-by-value/pass-by-reference distinction nonsense. In Go, any value of any type is always passed by value (copied)--on assignment and when passed as a parameter to a function. A pointer is just a value, too, just it defined to store an address of the memory location of some other value."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 35, "user_id": 7455397, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ZhF8.jpg?s=128&g=1", "display_name": "Huy Le", "link": "https://stackoverflow.com/users/7455397/huy-le"}, "edited": false, "score": 0, "creation_date": 1486283866, "post_id": 42048039, "comment_id": 71272544, "body": "@HuyLe, Hence when you pass a pointer into a function, changing the pointer value itself in its code has little sense as you just re-write the address stored in it, and as with any other value, this does not affect the caller in any way. But you can use the pointer value to <i>dereference</i> (or &quot;chase&quot;) it--to get hold onto the value kept at the address stored in the poiner value. <i>That</i> value you can mutate in arbitrary ways."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 5, "last_activity_date": 1486262725, "creation_date": 1486262725, "answer_id": 42048039, "question_id": 42047889, "link": "https://stackoverflow.com/questions/42047889/change-structs-pointer-value-in-structs-method/42048039#42048039", "title": "change struct&#39;s pointer value in struct&#39;s method", "body": "<p>The receiver <code>node</code> is passed by value just like other parameters, so any changes you make in the function are not seen by the caller. If you want a function to modify something that exists outside the function, the function needs to be dealing with a pointer to that object. In your case, <code>node</code> is a pointer, but what you really want is a pointer to something that represents the list itself. For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype LinkedListNode struct {\n    data int\n    next *LinkedListNode\n}\n\ntype LinkedList struct {\n    head *LinkedListNode\n}\n\n// InsertList will insert a item into the list\nfunc (list *LinkedList) InsertList(data int) {\n    newHead := &amp;LinkedListNode{data, list.head}\n    list.head = newHead\n}\n\nfunc main() {\n    var list LinkedList\n    list.InsertList(4)\n    fmt.Printf(\"node = %+v\\n\", list.head)\n    list.InsertList(7)\n    fmt.Printf(\"node = %+v\\n\", list.head)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "is_accepted": false, "score": 2, "last_activity_date": 1486263713, "creation_date": 1486263713, "answer_id": 42048111, "question_id": 42047889, "link": "https://stackoverflow.com/questions/42047889/change-structs-pointer-value-in-structs-method/42048111#42048111", "title": "change struct&#39;s pointer value in struct&#39;s method", "body": "<p>Think of it like this: every variable must be stored at some location in memory, and you can use a pointer to store that location rather than just the variable itself.</p>\n\n<p>To get or set the value at that location using the pointer, you need to use the \"indirection\" operator. For example, <code>*node</code> will get the <code>LinkedList</code> at the location that <code>node</code> points to, and <code>*node = newHead</code> will set the <code>LinkedList</code> at the location that <code>node</code> points to.</p>\n\n<p>You can also point the pointer to a new memory location, but that change will only be visible in the current scope. In your case, that means <code>node = &amp;newHead</code> only affects the <code>node</code> pointer in <code>InsertList</code>, not the <code>node</code> pointer in <code>main</code>.</p>\n\n<p>Here's a simpler example using normal functions, though the same rules apply for methods:</p>\n\n<pre><code>// Changes the value `x` points to\nfunc modifyValue(x *int) {\n    fmt.Printf(\"  modifyValue: x=%3d @ %p\\n\", *x, x)\n    *x = 1\n    fmt.Printf(\"  modifyValue: x=%3d @ %p\\n\", *x, x)\n}\n\n// Changes the pointer `x` itself\nfunc modifyPointer(x *int) {\n    fmt.Printf(\"modifyPointer: x=%3d @ %p\\n\", *x, x)\n    n := 1\n    x = &amp;n\n    fmt.Printf(\"modifyPointer: x=%3d @ %p\\n\", *x, x)\n}\n\nfunc main() {\n    x := 200\n    fmt.Printf(\"         main: x=%3d @ %p\\n\\n\", x, &amp;x)\n    modifyPointer(&amp;x)\n    fmt.Printf(\"         main: x=%3d @ %p\\n\\n\", x, &amp;x)\n    modifyValue(&amp;x)\n    fmt.Printf(\"         main: x=%3d @ %p\\n\\n\", x, &amp;x)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>         main: x=200 @ 0x1040e0f8\n\nmodifyPointer: x=200 @ 0x1040e0f8\nmodifyPointer: x=  1 @ 0x1040e134\n         main: x=200 @ 0x1040e0f8\n\n  modifyValue: x=200 @ 0x1040e0f8\n  modifyValue: x=  1 @ 0x1040e0f8\n         main: x=  1 @ 0x1040e0f8\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/9Hl3hz-wM8\" rel=\"nofollow noreferrer\">Playground link</a></p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1486293198, "creation_date": 1486293198, "answer_id": 42051365, "question_id": 42047889, "link": "https://stackoverflow.com/questions/42047889/change-structs-pointer-value-in-structs-method/42051365#42051365", "title": "change struct&#39;s pointer value in struct&#39;s method", "body": "<p>Just change the value reference argument point to</p>\n\n<pre><code>func (node *LinkedList) InsertList(data int) {\n    newHead := LinkedList{data, node}\n    *node = newHead   //&lt;- dereference here \n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 7455397, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ZhF8.jpg?s=128&g=1", "display_name": "Huy Le", "link": "https://stackoverflow.com/users/7455397/huy-le"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2182, "favorite_count": 0, "accepted_answer_id": 42048039, "answer_count": 3, "score": 1, "last_activity_date": 1486293198, "creation_date": 1486260948, "question_id": 42047889, "link": "https://stackoverflow.com/questions/42047889/change-structs-pointer-value-in-structs-method", "title": "change struct&#39;s pointer value in struct&#39;s method", "body": "<p>I am trying to wrap my head around pointer in go. I have this code right here</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n// LinkedList type\ntype LinkedList struct {\n    data int\n    next *LinkedList\n}\n\n// InsertList will insert a item into the list\nfunc (node *LinkedList) InsertList(data int) {\n    newHead := LinkedList{data, node}\n    node = &amp;newHead\n}\n\nfunc main() {\n    node := &amp;LinkedList{}\n    node.InsertList(4)\n    fmt.Printf(\"node = %+v\\n\", node)\n}\n</code></pre>\n\n<p>and The output is</p>\n\n<pre><code>node = &amp;{data:0 next:&lt;nil&gt;}\n</code></pre>\n\n<p>I would like to understand that why is <code>node = &amp;newHead</code> my InsertList method did not reference the node pointer to a different struct at all</p>\n"}, {"tags": ["go", "threadpool"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486260920, "post_id": 42047678, "comment_id": 71268534, "body": "If you are using blocking IO you should consider using thread pool instead of goroutine."}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486261986, "post_id": 42047678, "comment_id": 71268698, "body": "@ymonad, what do you mean by blocking IO? In Go all IO is blocking, that&#39;s kinda the whole point of it&#39;s concurrency model. If you mean file IO, which internally is vastly different from network IO, then the problem is not about goroutines at all. It&#39;s about actual OS threads waiting for syscalls to return."}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486262671, "post_id": 42047678, "comment_id": 71268816, "body": "@crecker What I intended was that, as far as using go&#39;s network library which is non-blocking, you will get the benefit of M:N thread model of goroutine, however, When you use system call which blocks IO, the go scheduler creates one thread per goroutine, so using thread pool might be an option.  <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/Luje-okL4jI\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/golang-nuts/Luje-okL4jI</a>"}, {"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486265312, "post_id": 42047678, "comment_id": 71269233, "body": "@ymonad, the reason I asked is that, from a language perspective, all IO is blocking and your comment is misleading in that context - there is no &quot;if&quot;. You&#39;re always using blocking IO, even with network IO - Goroutine calls &quot;Read&quot; and blocks. What&#39;s going on inside is a completely different thing and may change in the future. But if you&#39;re concerned about syscalls, then it has nothing to do with the actual goroutines - they&#39;re still cheap. The problem is with OS threads being spawned to wait on syscalls. And it&#39;s not limited to IO, all syscalls work that way."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 1853733, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95fa0e937eaadf84f06a427a5b2d8655?s=128&d=identicon&r=PG", "display_name": "hunter_tech", "link": "https://stackoverflow.com/users/1853733/hunter-tech"}, "edited": false, "score": 0, "creation_date": 1586827865, "post_id": 42047892, "comment_id": 108265749, "body": "The book &quot;Concurrency in Go&quot; illustrates this topic well"}], "tags": [], "owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "is_accepted": false, "score": 2, "last_activity_date": 1486261004, "creation_date": 1486261004, "answer_id": 42047892, "question_id": 42047678, "link": "https://stackoverflow.com/questions/42047678/is-thread-pooling-relevant-for-go/42047892#42047892", "title": "Is &#39;thread pooling&#39; relevant for Go?", "body": "<p>Spawning and keeping lots of goroutines in golang is cheap but it's not free.</p>\n\n<p>Also you should remember that goroutine themselves may be very cheap, but at the same time a lot of memory can be allocated inside of goroutine code. So you may want to limit number of concurrently running goroutines. </p>\n\n<p>You may use semaphore to limit resources.\nAnother approach (more idiomatic for go) is to use executions pipelines with worker pools. This pattern is very well described in <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">golang blog</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1486392189, "post_id": 42051582, "comment_id": 71312092, "body": "This is slightly off topic - pooling database connections is not quite the same as thread pooling."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1486294571, "creation_date": 1486294571, "answer_id": 42051582, "question_id": 42047678, "link": "https://stackoverflow.com/questions/42047678/is-thread-pooling-relevant-for-go/42051582#42051582", "title": "Is &#39;thread pooling&#39; relevant for Go?", "body": "<p>Yes, it's relevant. <em>db/sql</em> uses pool of connections to database, because of establishing new connection take time.</p>\n"}], "owner": {"reputation": 346, "user_id": 7401775, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/79fae12e436469518f605824de67925b?s=128&d=identicon&r=PG&f=1", "display_name": "Joe Lin", "link": "https://stackoverflow.com/users/7401775/joe-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1297, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1486294571, "creation_date": 1486258571, "question_id": 42047678, "link": "https://stackoverflow.com/questions/42047678/is-thread-pooling-relevant-for-go", "title": "Is &#39;thread pooling&#39; relevant for Go?", "body": "<p>Since it is generally very little overhead in terms of memory requirement and setup/tear down cost of a Go routine. Is it relevant even to implement a thread(go routine) worker pool? When would you consider using a thread pool instead of 'spawning' a go routine per request?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1486260123, "post_id": 42047547, "comment_id": 71268401, "body": "The idiomatic way to write the code above is to write validatePassword and validateUsername as simple functions that return values. Goroutines do not provide any value here."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1486279640, "post_id": 42048047, "comment_id": 71271622, "body": "JFTR, these days <code>GOMAXPROCS</code> equals the number of cores (&quot;virtual CPUs&quot; reported by the OS) at program startup. The real problem is whether validation of the username and password is <i>that</i> resource consuming to outweigh the costs of creating goroutines and synchronizing them? Yes creating goroutines is dirt-cheap comparing to OS-level threads but this cost is non-zero nevertheless."}], "tags": [], "owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "is_accepted": true, "score": 2, "last_activity_date": 1486262827, "creation_date": 1486262827, "answer_id": 42048047, "question_id": 42047547, "link": "https://stackoverflow.com/questions/42047547/golang-multiple-goroutine-sharing-same-variable-by-reference/42048047#42048047", "title": "Golang multiple goroutine sharing same variable by reference", "body": "<p>Are you sure you need goroutines to perform simple validations?\nAnyway the code you have written uses goroutines, but they are not running in parallel.</p>\n\n<p>What's going on in your code:\nyou create non-buffered channel and put CredentialResponse variable into it.\nThen one goroutine (any of two) reads variable from channel, performs some actions, and puts variable back to the channel.\nWhile first goroutine was doing some actions, second one was just waiting for a value from a channel.</p>\n\n<p>So your code uses goroutines, but it can hardly be called parallel.</p>\n\n<p>You may want to use goroutines if you need some heavy operations  to validate data: io ops, or CPU, but in case of CPU you need specify GOMAXPROCS>1 to get some performance gain.</p>\n\n<p>If I'd wanted to use goroutines for validation, I'd have written smth like it:</p>\n\n<pre><code>func validateCredentials(req *ValidateCredentialsRequest){\n    ch := make(chan bool, 2)\n    go func(name string){\n    // ... validation code\n        ch &lt;- true // or false\n\n    }(req.GetUsername())\n\n    go func(pwd string){\n    // ... validation code\n        ch &lt;- true // or false\n    }(req.GetPassword())\n\n    valid := true\n    for i := 0; i &lt; 2; i++ {\n        v := &lt;- result\n        valid = valid &amp;&amp; v\n    }\n\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 27333, "user_id": 309343, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0af367dc4d144a1580cac9500a29f16f?s=128&d=identicon&r=PG", "display_name": "Moon", "link": "https://stackoverflow.com/users/309343/moon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1203, "favorite_count": 0, "accepted_answer_id": 42048047, "answer_count": 1, "score": -2, "last_activity_date": 1486294981, "creation_date": 1486257346, "last_edit_date": 1486294981, "question_id": 42047547, "link": "https://stackoverflow.com/questions/42047547/golang-multiple-goroutine-sharing-same-variable-by-reference", "title": "Golang multiple goroutine sharing same variable by reference", "body": "<p>I am trying to run multiple goroutines that modify the same variable passed by reference. </p>\n\n<p>But I am sure the way I have implemented this is functionally incorrect. Even though it seems to be working in my tests, I have a feeling this pattern would end the parent function when the first goroutine completes if the second goroutine takes considerably longer to run than the first one.</p>\n\n<p>I would like your input/suggestions/advice.</p>\n\n<pre><code>package auth\n\nimport (\n    \"regexp\"\n\n    zxcvbn \"github.com/nbutton23/zxcvbn-go\"\n    \"golang.org/x/net/context\"\n)\n\ntype AuthService struct{}\n\nfunc NewAuthService() *AuthService {\n    return &amp;AuthService{}\n}\n\nfunc (this *AuthService) ValidateCredentials(ctx context.Context, req *ValidateCredentialsRequest) (*ValidateCredentialsResponse, error) {\n    c := make(chan *ValidateCredentialsResponse)\n\n    go validatePassword(req.GetPassword(), c)\n    go validateUsername(req.GetUsername(), c)\n\n    c &lt;- &amp;ValidateCredentialsResponse{IsValid: true}\n\n    return &lt;-c, nil\n}\n\nfunc validateUsername(email string, c chan *ValidateCredentialsResponse) {\n    for {\n        res := &lt;-c\n\n        if email == \"\" {\n            res.IsValid = false\n            res.Username = \"Please provide your email address.\"\n        } else if len(email) &gt; 128 {\n            res.IsValid = false\n            res.Username = \"Email address can not exceed 128 characters.\"\n        } else if !regexp.MustCompile(`.+@.+`).MatchString(email) {\n            res.IsValid = false\n            res.Username = \"Please enter a valid email address.\"\n        }\n\n        c &lt;- res\n    }\n}\n\nfunc validatePassword(password string, c chan *ValidateCredentialsResponse) {\n    for {\n        res := &lt;-c\n\n        if password == \"\" {\n            res.IsValid = false\n            res.Password = \"Please provide your password.\"\n        } else {\n            quality := zxcvbn.PasswordStrength(password, []string{})\n            if quality.Score &lt; 3 {\n                res.IsValid = false\n                res.Password = \"Your password is weak.\"\n            }\n        }\n\n        c &lt;- res\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "configuration", "viper-go"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 2, "creation_date": 1486254645, "post_id": 42046893, "comment_id": 71267399, "body": "Your code works as expected and correctly triggers <code>OnConfigChange</code> in my Linux environment. You should write your OS, and maybe mount option of <code>&#47;tmp&#47;</code> to get help."}, {"owner": {"reputation": 341, "user_id": 1569602, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/dc2c984e0e0d5db7ce2bd8cd198af69f?s=128&d=identicon&r=PG", "display_name": "inari6", "link": "https://stackoverflow.com/users/1569602/inari6"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486405103, "post_id": 42046893, "comment_id": 71320510, "body": "Thanks for your quick response. I moved my config to current working directory and it worked."}], "answers": [{"comments": [{"owner": {"reputation": 341, "user_id": 1569602, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/dc2c984e0e0d5db7ce2bd8cd198af69f?s=128&d=identicon&r=PG", "display_name": "inari6", "link": "https://stackoverflow.com/users/1569602/inari6"}, "edited": false, "score": 0, "creation_date": 1486405183, "post_id": 42059514, "comment_id": 71320557, "body": "Thanks for your quick response. In my mac, moved config to current working directory and it worked. I also moved WatchConfig &amp; OnConfigChange to init function."}], "tags": [], "owner": {"reputation": 7159, "user_id": 1458771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/daccc9f7e12a09ef7adc52f9c7bd13b1?s=128&d=identicon&r=PG", "display_name": "Drew MacInnis", "link": "https://stackoverflow.com/users/1458771/drew-macinnis"}, "is_accepted": false, "score": 2, "last_activity_date": 1486347449, "last_edit_date": 1495541808, "creation_date": 1486347449, "answer_id": 42059514, "question_id": 42046893, "link": "https://stackoverflow.com/questions/42046893/how-to-use-golang-viper-watchconfig-onconfigchange/42059514#42059514", "title": "How to use golang viper Watchconfig &amp; onConfigChange", "body": "<p>The <a href=\"https://stackoverflow.com/questions/42046893/how-to-use-golang-viper-watchconfig-onconfigchange#comment71267399_42046893\">comment</a> by <a href=\"https://stackoverflow.com/users/2427222/ymonad\">ymonad</a> is on the right track, depending on your OS you may be experiencing problems with <a href=\"https://github.com/spf13/viper\" rel=\"nofollow noreferrer\">viper</a>/<a href=\"https://github.com/fsnotify/fsnotify\" rel=\"nofollow noreferrer\">fsnotify</a>.</p>\n\n<p>For example, I ran your example code on Mac OS X (Sierra) and noticed the same symptom you described: when the config file is in <code>/tmp</code> the viper <code>WatchConfig</code> call was not causing the viper <code>OnConfigChange</code> function to be called.</p>\n\n<p>However, when I change the <code>AddConfigPath</code> to use the current working directory or my home directory then I do see logging from your <code>OnConfigChange</code> function. For example, try:</p>\n\n<pre><code>v.AddConfigPath(\"./\")\n</code></pre>\n\n<p>I'd recommend experimenting with different directory locations to see if this is some sort of viper/fsnotify bug or limitation. For some reason, it doesn't appear to detect changes from the <code>/tmp</code> directory on Mac OS X, at least, it doesn't for my setup. I couldn't find any mention of problems with <code>/tmp</code> on OS X, but the fsnotify <a href=\"https://github.com/fsnotify/fsnotify/blob/bd2828f9f176e52d7222e565abb2d338d3f3c103/CONTRIBUTING.md#L59\" rel=\"nofollow noreferrer\">CONTRIBUTING.md</a> does mention limitations with \"shared\" directories under Vagrant so perhaps there are some filesystem configurations that do not trigger notifications:</p>\n\n<blockquote>\n  <p>Notice: fsnotify file system events won't trigger in shared folders. The tests get around this limitation by using the /tmp directory.</p>\n</blockquote>\n\n<p>Also, you don't need to keep calling <code>WatchConfig</code> and <code>OnConfigChange</code> via your goroutine. You can eliminate the goroutine completely and just move the relevant lines into <code>init</code>.</p>\n"}], "owner": {"reputation": 341, "user_id": 1569602, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/dc2c984e0e0d5db7ce2bd8cd198af69f?s=128&d=identicon&r=PG", "display_name": "inari6", "link": "https://stackoverflow.com/users/1569602/inari6"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3747, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486347449, "creation_date": 1486251202, "question_id": 42046893, "link": "https://stackoverflow.com/questions/42046893/how-to-use-golang-viper-watchconfig-onconfigchange", "title": "How to use golang viper Watchconfig &amp; onConfigChange", "body": "<p>I am trying to read my application configuration using golang viper and would like to read the latest config always. Please find my code below</p>\n\n<p>config.go</p>\n\n<pre><code>package config\n\nimport (\n    \"github.com/spf13/viper\"\n    \"log\"\n    \"github.com/fsnotify/fsnotify\"\n    \"time\"\n)\n\ntype Reader interface {\n    GetAllKeys() []string\n    Get(key string) interface{}\n    GetBool(key string) bool\n    GetString(key string) string\n}\n\ntype viperConfigReader struct {\n    viper *viper.Viper\n}\n\nvar TestConfReader *viperConfigReader\n\nfunc (v viperConfigReader) GetAllKeys() []string{\n    return v.viper.AllKeys()\n}\n\nfunc (v viperConfigReader) Get(key string) interface{} {\n    return v.viper.Get(key)\n}\n\nfunc (v viperConfigReader) GetBool(key string) bool {\n    return v.viper.GetBool(key)\n}\n\nfunc (v viperConfigReader) GetString(key string) string {\n    return v.viper.GetString(key)\n}\n\n\nfunc init() {\n    v:= viper.New()\n    v.SetConfigName(\"test\")\n    v.AddConfigPath(\"/tmp/\")\n\n    err := v.ReadInConfig()\n\n    if err != nil {\n        log.Panic(\"Not able to read configuration\", err.Error())\n    }\n\n    TestConfReader = &amp;viperConfigReader{\n        viper: v,\n    }\n\n    go func() {\n        for {\n            time.Sleep(time.Second * 5)\n            v.WatchConfig()\n            v.OnConfigChange(func(e fsnotify.Event) {\n                log.Println(\"config file changed\", e.Name)\n            })\n        }\n    }()\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/xxxx/xxxx/config\"\n    \"log\"\n    \"time\"\n)\n\nfunc main() {\n\n    conf := config.TestConfReader\n\n    log.Println(conf.GetAllKeys())\n    log.Println(conf.GetString(\"test1\"))\n\n    time.Sleep(20 * time.Second)\n\n    log.Println(conf.GetString(\"test1\"))\n}\n</code></pre>\n\n<p>When the main program is running, I tried to update the config and expected to see OnConfigChange log message but it never showed up. </p>\n\n<p>How can I fix this program ?.</p>\n\n<p>Can someone provide an example of using viper watchconfig &amp; onconfigchange methods to read the latest config</p>\n"}, {"tags": ["go", "idioms"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1486241518, "post_id": 42045034, "comment_id": 71264034, "body": "I don&#39;t know Go, but this strikes me as kind-of sort-of inheritance. If the function was part of a ABC instead of an interface, the language would automatically pick the correct method based on its type."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1486244046, "post_id": 42045034, "comment_id": 71264791, "body": "@Carcigenicate, which function do you mean ? I don&#39;t think this is in any way related to inheritance. The types  involved are completely unrelated."}, {"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1486245433, "post_id": 42045034, "comment_id": 71265200, "body": "Nvm, I think I misread the code. From description at the top and then code, it seemed like you were dispatching a function based on the type of an object."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 0, "creation_date": 1486245859, "post_id": 42045034, "comment_id": 71265316, "body": "A function is indeed being &#39;dispatched&#39; based on type of object but the types are completely unrelated to one another. With inheritance (perhaps polymorphism), the function being called depends on the type of object - but the objects are all of a certain parent type."}], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 2, "last_activity_date": 1486253253, "last_edit_date": 1486253253, "creation_date": 1486245749, "answer_id": 42046135, "question_id": 42045034, "link": "https://stackoverflow.com/questions/42045034/is-there-a-name-for-this-idiom/42046135#42046135", "title": "Is there a name for this idiom?", "body": "<p>I'd call this <em>dynamic method dispatch</em>. More or less the same mechanism used in Go interface implementation where <code>map[reflect.Type]encoderFunc</code> called <a href=\"https://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">i-table</a>. One even can rewrite marshalling just with interfaces, except we can't write methods for builtin types.</p>\n\n<pre><code>type encodable interface{\n    encode(e *encodeState, opts encOpts)\n}\nfunc (st SomeType) encode(e *encodeState, opts encOpts){\n...\n}\n...\nfunc (ot OtherType) encode(e *encodeState, opts encOpts){\n...\n}\nfunc (e *encodeState) marshal(v encodable, opts encOpts) (err error) {\n    v.encode(e, opts)\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 42046135, "answer_count": 1, "score": 1, "last_activity_date": 1486370998, "creation_date": 1486238843, "last_edit_date": 1486370998, "question_id": 42045034, "link": "https://stackoverflow.com/questions/42045034/is-there-a-name-for-this-idiom", "title": "Is there a name for this idiom?", "body": "<p>Is there a name for this idiom where a function is chosen based on type of interface ?</p>\n\n<pre><code>type encoderFunc func(e *encodeState, v reflect.Value, opts encOpts)\n\nvar encoderCache struct {\n    m map[reflect.Type]encoderFunc\n}\n\nfunc (e *encodeState) marshal(v interface{}, opts encOpts) (err error) {\n    v := refect.ValueOf(v)\n    valueEncoder(v)(e, v, opts)\n    return nil\n}\n\nfunc valueEncoder(v reflect.Value) encoderFunc {\n     return encoderCache.m[v.Type()]\n}\n</code></pre>\n\n<p>Copied from <a href=\"https://golang.org/src/encoding/json/encode.go\" rel=\"nofollow noreferrer\">encoding/json</a> and slightly altered for demonstration.    </p>\n"}, {"tags": ["go", "indirection"], "answers": [{"tags": [], "owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "is_accepted": false, "score": 1, "last_activity_date": 1486255084, "creation_date": 1486255084, "answer_id": 42047352, "question_id": 42045007, "link": "https://stackoverflow.com/questions/42045007/whats-a-reason-for-this-function-to-exist/42047352#42047352", "title": "What&#39;s a reason for this function to exist?", "body": "<p>I don't know the motivation of the author of this code. But I suppose that e.reflectValue() is a helper function which makes this code more precies and readable.</p>\n\n<p>When I look at the definition of this fucntion:</p>\n\n<pre><code>func (e *encodeState) reflectValue(v reflect.Value, opts encOpts)\n</code></pre>\n\n<p>It's pretty clear to me that reflectValue somehow changes encodeState based on reflect value and some encoding options.</p>\n\n<p>When I look at this defintion:</p>\n\n<pre><code>func valueEncoder(v reflect.Value) encoderFunc\n</code></pre>\n\n<p>I have no idea about what's going on, all I see is a higher-order function.</p>\n\n<p>Function calls are expensive in golang, but encoding/json package is not expected to be very fast.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1486275139, "creation_date": 1486275139, "answer_id": 42049104, "question_id": 42045007, "link": "https://stackoverflow.com/questions/42045007/whats-a-reason-for-this-function-to-exist/42049104#42049104", "title": "What&#39;s a reason for this function to exist?", "body": "<p>The method can be replaced by direct calls to <code>valueEncoder(v)(e, v, opts)</code>. The method is not needed to satisfy an interface, nor is it accessed through reflection.</p>\n\n<p>The method was <a href=\"https://github.com/golang/go/blob/2afc46f2b213336ca4ac1d518b9e9d4f6b5b0fbc/src/pkg/json/encode.go#L223\" rel=\"nofollow noreferrer\">much longer back in 2011</a>. The current method may be there because of the past history. It's also possible that the author thought that code readability is improved by encapsulating <code>valueEncoder(v)(e, v, opts)</code> in a method.</p>\n"}], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 42049104, "answer_count": 2, "score": 2, "last_activity_date": 1486372764, "creation_date": 1486238677, "last_edit_date": 1486372764, "question_id": 42045007, "link": "https://stackoverflow.com/questions/42045007/whats-a-reason-for-this-function-to-exist", "title": "What&#39;s a reason for this function to exist?", "body": "<p>In <a href=\"https://golang.org/src/encoding/json/encode.go\" rel=\"nofollow noreferrer\">encoding/json</a> the un-exported reflectValue function passes on all its arguments to another function. </p>\n\n<pre><code>func(e *encodeState) reflectValue(v reflect.Value, opts encOpts)       \n{           \n    valueEncoder(v)(e, v, opts)\n}\n</code></pre>\n\n<p>The call to valueEncoder can be made from wherever reflectValue is called. What's the motivation for this additional function ? </p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "edited": false, "score": 0, "creation_date": 1486235926, "post_id": 42044448, "comment_id": 71262174, "body": "please let me know if you see a silly mistake. I have been at it for hours and I am really frustrated now and I cant see where I am going wrong."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1486237116, "post_id": 42044448, "comment_id": 71262638, "body": "Provided snippet works normally on my machine without any errors"}, {"owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1486237562, "post_id": 42044448, "comment_id": 71262793, "body": "i have added the json file I am trying to decode. Is it working for it?"}, {"owner": {"reputation": 1362, "user_id": 1638814, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/79045cf2a5e6cd8d939d0e6d39327133?s=128&d=identicon&r=PG", "display_name": "nvartolomei", "link": "https://stackoverflow.com/users/1638814/nvartolomei"}, "edited": false, "score": 0, "creation_date": 1486238677, "post_id": 42044448, "comment_id": 71263097, "body": "what is <code>m</code> in <code>m[x.Name] = x.Url</code>? the provided example is correct, check carefully where <code>index is out of range</code> error is reported"}, {"owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "edited": false, "score": 0, "creation_date": 1486238770, "post_id": 42044448, "comment_id": 71263126, "body": "I forgot to mention, <code>var m =make(map[string]string)</code> is a global variable"}, {"owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "edited": false, "score": 0, "creation_date": 1486238958, "post_id": 42044448, "comment_id": 71263180, "body": "I checked, it is for t.Result[0] . When I do a <code>fmt.Println(t.Result)</code> it outputs <code>[]</code>"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1486239278, "post_id": 42044448, "comment_id": 71263289, "body": "t should be []Result ?"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1486239491, "post_id": 42044448, "comment_id": 71263362, "body": "@Krash Sorry I&#39;m too lazy to do POST requests for you. But as of code works with test JSON, I think URL just provide invalid JSON or you have mistakes in other places. Your structure works fine for JSON you show."}, {"owner": {"reputation": 1317, "user_id": 54256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xeM9M.jpg?s=128&g=1", "display_name": "Gonfva", "link": "https://stackoverflow.com/users/54256/gonfva"}, "edited": false, "score": 1, "creation_date": 1486240085, "post_id": 42044448, "comment_id": 71263573, "body": "@Krash Do you happen to read resp.body before calling decode?"}, {"owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1486240128, "post_id": 42044448, "comment_id": 71263586, "body": "@Uvelichitel Ok, What I tried was store the response body in a string and then try <code>json.Decode</code> like Niko does in his answer below. It worked that way. Any idea why it works this way but not the other way around?"}, {"owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "reply_to_user": {"reputation": 1317, "user_id": 54256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xeM9M.jpg?s=128&g=1", "display_name": "Gonfva", "link": "https://stackoverflow.com/users/54256/gonfva"}, "edited": false, "score": 0, "creation_date": 1486240177, "post_id": 42044448, "comment_id": 71263615, "body": "@Gonfva Yes, I was reading <code>resp.Body</code> . Does that mess it up ?"}, {"owner": {"reputation": 1317, "user_id": 54256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xeM9M.jpg?s=128&g=1", "display_name": "Gonfva", "link": "https://stackoverflow.com/users/54256/gonfva"}, "edited": false, "score": 1, "creation_date": 1486240204, "post_id": 42044448, "comment_id": 71263626, "body": "Just learning go myself, but I guess it consumes the buffer and when you try to decode, the buffer is empty"}, {"owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "reply_to_user": {"reputation": 1317, "user_id": 54256, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xeM9M.jpg?s=128&g=1", "display_name": "Gonfva", "link": "https://stackoverflow.com/users/54256/gonfva"}, "edited": false, "score": 0, "creation_date": 1486240294, "post_id": 42044448, "comment_id": 71263658, "body": "@Gonfva Wow thanks. It works now. I am sorry for taking everyone&#39;s time. I didn&#39;t know this."}], "answers": [{"tags": [], "owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "is_accepted": true, "score": 0, "last_activity_date": 1486239559, "creation_date": 1486239559, "answer_id": 42045151, "question_id": 42044448, "link": "https://stackoverflow.com/questions/42044448/how-do-i-decode-the-following-json/42045151#42045151", "title": "How do I decode the following JSON?", "body": "<p>Here is a slightly modified version that works on my machine and go playground:</p>\n\n<p><a href=\"https://play.golang.org/p/UuDjBO-Gun\" rel=\"nofollow noreferrer\">GoPlayground</a></p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n  \"strings\"\n)\n\ntype results struct {\n  Result []result `json:\"results\"`\n}\n\ntype result struct {\n  Hits []hit `json:\"hits\"`\n}\n\ntype hit struct {\n  Name string `json:\"title\"`\n  Url  string `json:\"author:url\"`\n}\n\nvar m = make(map[string]string)\n\nfunc main() {\n  jsonSample := `{\n  \"results\": [\n    {\n      \"hits\": [\n        {\n          \"title\": \"Juliette DELAUNAY\",\n          \"author:url\": \"abc.com\"\n        }\n        ]\n    }\n    ]\n  }`\n\n  var t results\n  decoder := json.NewDecoder(strings.NewReader(jsonSample))\n\n  err := decoder.Decode(&amp;t)\n  if err != nil {\n    fmt.Println(err)\n  }\n\n  for _, x := range t.Result[0].Hits {\n    m[x.Name] = x.Url\n    fmt.Println(x.Name, x.Url)\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 1589, "user_id": 7205620, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/d192b6e443c87744c05a745b951f8fde?s=128&d=identicon&r=PG&f=1", "display_name": "Krash", "link": "https://stackoverflow.com/users/7205620/krash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 42045151, "answer_count": 1, "score": 1, "last_activity_date": 1486239559, "creation_date": 1486235374, "last_edit_date": 1486238884, "question_id": 42044448, "link": "https://stackoverflow.com/questions/42044448/how-do-i-decode-the-following-json", "title": "How do I decode the following JSON?", "body": "<p>I have a JSON object of the format</p>\n\n<pre><code>{\n  \"results\": [\n    {\n      \"hits\": [\n        {\n          \"title\": \"Juliette DELAUNAY\",\n          \"author:url\": \"abc.com\"\n        }\n        ]\n    }\n    ]\n}\n</code></pre>\n\n<p>To decode in my go program, I have made the following structs</p>\n\n<pre><code>type results struct{\n    Result []result `json:\"results\"`\n}\n\ntype result struct{\n    Hits []hit `json:\"hits\"`\n}\n\ntype hit struct{\n    Name string `json:\"title\"`\n    Url string `json:\"author:url\"`\n}\nvar m =make(map[string]string)\nvar t results\n</code></pre>\n\n<p>But when I try to do the following,</p>\n\n<pre><code>decoder := json.NewDecoder(resp.Body)\n\n\n    err = decoder.Decode(&amp;t)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n\n    for _,x := range t.Result[0].Hits{\n        m[x.Name] = x.Url\n        fmt.Println(x.Name,x.Url)\n    }\n</code></pre>\n\n<p>It gives a runtime error saying index is out of range. What am I doing wrong? Are my structs incorrect for the given json? </p>\n\n<p>EDIT : The JSON file I need to decode</p>\n\n<pre><code>var jsonStr = []byte(`{\"requests\":[{\"indexName\":\"recherchepepitesAtoZ\",\"params\":\"query=x&amp;hitsPerPage=2817&amp;maxValuesPerFacet=42&amp;page=0&amp;facets=%5B%22field_frenchtech_hub_pepite%22%2C%22field_categorie%22%2C%22field_frenchtech_hub_pepite%22%5D&amp;tagFilters=\"}]}`)\n    req, err := http.NewRequest(\"POST\", \"http://6y0slgl8yj-dsn.algolia.net/1/indexes/*/queries?x-algolia-agent=Algolia%20for%20vanilla%20JavaScript%20(lite)%203.20.4%3Binstantsearch.js%201.10.4%3BJS%20Helper%202.18.0&amp;x-algolia-application-id=6Y0SLGL8YJ&amp;x-algolia-api-key=6832a361e1e1628f8ddb2483623104c6\", bytes.NewBuffer(jsonStr))\n    //req.Header.Set(\"X-Custom-Header\", \"application/x-www-form-urlencoded\")\n    req.Header.Set(\"Content-Type\", \"application/json\")\n\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 151, "user_id": 7029834, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8c25080bfc77d7dd21c3249b39c556f0?s=128&d=identicon&r=PG&f=1", "display_name": "CodeL", "link": "https://stackoverflow.com/users/7029834/codel"}, "edited": false, "score": 0, "creation_date": 1486231738, "post_id": 42043641, "comment_id": 71260691, "body": "In my func SearchUserRatings what should i replace? Thanks"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "reply_to_user": {"reputation": 151, "user_id": 7029834, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8c25080bfc77d7dd21c3249b39c556f0?s=128&d=identicon&r=PG&f=1", "display_name": "CodeL", "link": "https://stackoverflow.com/users/7029834/codel"}, "edited": false, "score": 0, "creation_date": 1486232153, "post_id": 42043641, "comment_id": 71260842, "body": "Here the function i proposed is in sich a way that you may give result of your search fuction as input to this. I&#39;ll update your function"}, {"owner": {"reputation": 151, "user_id": 7029834, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8c25080bfc77d7dd21c3249b39c556f0?s=128&d=identicon&r=PG&f=1", "display_name": "CodeL", "link": "https://stackoverflow.com/users/7029834/codel"}, "edited": false, "score": 0, "creation_date": 1486236738, "post_id": 42043641, "comment_id": 71262466, "body": "what is the variable result in the init method?"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "reply_to_user": {"reputation": 151, "user_id": 7029834, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8c25080bfc77d7dd21c3249b39c556f0?s=128&d=identicon&r=PG&f=1", "display_name": "CodeL", "link": "https://stackoverflow.com/users/7029834/codel"}, "edited": false, "score": 0, "creation_date": 1486236849, "post_id": 42043641, "comment_id": 71262520, "body": "Init initializes itself does not return anything. It is used as <code>ratingsPK</code> is not an exported field other ways you can straigt forward put it"}, {"owner": {"reputation": 151, "user_id": 7029834, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8c25080bfc77d7dd21c3249b39c556f0?s=128&d=identicon&r=PG&f=1", "display_name": "CodeL", "link": "https://stackoverflow.com/users/7029834/codel"}, "edited": false, "score": 0, "creation_date": 1486236968, "post_id": 42043641, "comment_id": 71262576, "body": "in the append method the r variable it gives me error..can not use r (type ratingPK) as type Rating.."}, {"owner": {"reputation": 151, "user_id": 7029834, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8c25080bfc77d7dd21c3249b39c556f0?s=128&d=identicon&r=PG&f=1", "display_name": "CodeL", "link": "https://stackoverflow.com/users/7029834/codel"}, "edited": false, "score": 0, "creation_date": 1486238946, "post_id": 42043641, "comment_id": 71263174, "body": "i have update my code, you can check it..but it doesnt work..i get error"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "reply_to_user": {"reputation": 151, "user_id": 7029834, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8c25080bfc77d7dd21c3249b39c556f0?s=128&d=identicon&r=PG&f=1", "display_name": "CodeL", "link": "https://stackoverflow.com/users/7029834/codel"}, "edited": false, "score": 0, "creation_date": 1486239095, "post_id": 42043641, "comment_id": 71263231, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/134868/discussion-between-sarathsp-and-codel\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 0, "last_activity_date": 1486244624, "last_edit_date": 1486244624, "creation_date": 1486231112, "answer_id": 42043641, "question_id": 42043219, "link": "https://stackoverflow.com/questions/42043219/how-can-i-put-an-object-in-object-in-golang/42043641#42043641", "title": "How can i put an object in object in golang", "body": "<p>You may loop and do as follows</p>\n\n<pre><code>type RatingPK struct {\n    ratingsPK Rating\n}\n\nfunc (r *RatingPK) Init(rg Rating) {\n    r.ratingsPK = rg\n}\n\nfunc searchUserRatings(id string) (ratings []RatingPK) {\n\n    rows, err := db.Query(\"SELECT * FROM ratings WHERE userId = ?\", id)\n\n    if err != nil {\n        return\n    }\n\n    var myarray []string\n\n    for rows.Next() {\n        rate := Rating{}\n        err = rows.Scan(&amp;rate.MovieId, &amp;rate.UserId, &amp;rate.RatingId, &amp;rate.Rating, &amp;rate.Timestamp)\n        if err != nil {\n            return\n        }\n        r := RatingPK{}\n        r.Init(rate)\n        ratings = append(ratings, r)\n    }\n\n    defer rows.Close()\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1362, "user_id": 6486607, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e6c5ef2e01327de3ee7c2913832c15c1?s=128&d=identicon&r=PG&f=1", "display_name": "Razvan Alex", "link": "https://stackoverflow.com/users/6486607/razvan-alex"}, "is_accepted": false, "score": 0, "last_activity_date": 1486231729, "creation_date": 1486231729, "answer_id": 42043768, "question_id": 42043219, "link": "https://stackoverflow.com/questions/42043219/how-can-i-put-an-object-in-object-in-golang/42043768#42043768", "title": "How can i put an object in object in golang", "body": "<p>Here's a short example that will help you understand how to use nested structs ;)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype nameType struct {\n    firstName string\n    lastName string\n}\n\ntype student struct {\n    name nameType\n    age int\n}\n\nfunc main() {\n    bob := student{nameType{\"bob\", \"dope\"}, 18}\n\n    fmt.Println(bob.name.firstName)\n}\n</code></pre>\n\n<p>You can test it up here ;)</p>\n\n<p><a href=\"https://play.golang.org/p/ft9PGrlrrx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ft9PGrlrrx</a></p>\n"}], "owner": {"reputation": 151, "user_id": 7029834, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8c25080bfc77d7dd21c3249b39c556f0?s=128&d=identicon&r=PG&f=1", "display_name": "CodeL", "link": "https://stackoverflow.com/users/7029834/codel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 42043641, "answer_count": 2, "score": 0, "last_activity_date": 1486244624, "creation_date": 1486228733, "last_edit_date": 1486238910, "question_id": 42043219, "link": "https://stackoverflow.com/questions/42043219/how-can-i-put-an-object-in-object-in-golang", "title": "How can i put an object in object in golang", "body": "<p>What i am trying to do is to load an whole object coming from my database into an object.</p>\n\n<pre><code>type RatingPK struct {\n    ratingsPK Rating\n}\n\nfunc (r *RatingPK) Init(rg Rating) {\n    r.ratingsPK = rg\n}    \n\nfunc searchUserRatings(id string)(ratings []Rating)  {\n\n    rows, err := db.Query(\"SELECT * FROM ratings WHERE userId = ?\", id)\n\n    if err != nil {\n        return\n    }\n\n    for rows.Next() {\n\n        rate := Rating{}\n\n        err = rows.Scan(&amp;rate.MovieId, &amp;rate.UserId, &amp;rate.RatingId, &amp;rate.Rating, &amp;rate.Timestamp)\n\n        if err != nil {\n            return\n        }\n\n        r := RatingPK{}\n        r.Init(rate)\n        ratings = append(ratings, r)\n    }\n\n    defer rows.Close()\n\n    return\n}\n</code></pre>\n\n<p>this code gives me this result:</p>\n\n<pre><code>   [{\n    \"rating_id\": 593,\n    \"userId\": 2,\n    \"movieId\": 93,\n    \"rating\": 3,\n    \"timestamp\": \"0000-00-00\"\n  },\n  {\n    \"rating_id\": 616,\n    \"userId\": 2,\n    \"movieId\": 94,\n    \"rating\": 3,\n    \"timestamp\": \"0000-00-00\"\n  }]\n</code></pre>\n\n<p>Now what i want to do is to get each object of the array and put in to another object and the desired result will be this:</p>\n\n<pre><code>[{\"ratingsPK\": {\n    \"rating_id\": 593,\n    \"userId\": 2,\n    \"movieId\": 93,\n    \"rating\": 3,\n    \"timestamp\": \"0000-00-00\"\n  }},\n  {\"ratingsPK\": {\n    \"rating_id\": 616,\n    \"userId\": 2,\n    \"movieId\": 94,\n    \"rating\": 3,\n    \"timestamp\": \"0000-00-00\"\n  }}]\n</code></pre>\n\n<p>Is there any way to achieve that?</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 1057, "user_id": 1750407, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/EobHJ.jpg?s=128&g=1", "display_name": "Wendy Adi", "link": "https://stackoverflow.com/users/1750407/wendy-adi"}, "edited": false, "score": 4, "creation_date": 1486222071, "post_id": 42040951, "comment_id": 71257441, "body": "afaik for Go grpc you must compile it with plugin <code>protoc --go_out=plugins=grpc:. *.proto</code>  <a href=\"https://github.com/golang/protobuf#grpc-support\" rel=\"nofollow noreferrer\">github.com/golang/protobuf#grpc-support</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7159, "user_id": 1458771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/daccc9f7e12a09ef7adc52f9c7bd13b1?s=128&d=identicon&r=PG", "display_name": "Drew MacInnis", "link": "https://stackoverflow.com/users/1458771/drew-macinnis"}, "is_accepted": true, "score": 9, "last_activity_date": 1486235032, "last_edit_date": 1495540450, "creation_date": 1486235032, "answer_id": 42044379, "question_id": 42040951, "link": "https://stackoverflow.com/questions/42040951/golang-grpc-register-a-service-on-grpcserver/42044379#42044379", "title": "golang + grpc: register a service on GrpcServer", "body": "<blockquote>\n  <p>Am I'm compiling it in the wrong way?</p>\n  \n  <p><code>protoc --go_output=. *.proto</code></p>\n</blockquote>\n\n<p>Yes. As pointed out in the <a href=\"https://stackoverflow.com/questions/42040951/golang-grpc-register-a-service-on-grpcserver#comment71257441_42040951\">comment</a> by <a href=\"https://stackoverflow.com/users/1750407/wendy-adi\">Wendy Adi</a>, the command-line option to <code>protoc</code> should be <code>--go_out</code> not <code>--go_output</code> and the <code>plugins=grpc</code> option is needed as well (as per the <a href=\"https://github.com/grpc/grpc-go/blob/master/codegen.sh\" rel=\"noreferrer\"><code>codegen.sh</code> script</a>). You should be able to use <code>protoc</code> to regenerate the <code>.pb.go</code> file in the helloworld example:</p>\n\n<pre><code>cd $GOPATH/src/google.golang.org/grpc/examples/helloworld\nmv helloworld.pb.go helloworld.pb.go.orig\nprotoc --go_out=plugins=grpc:. helloworld.proto\n</code></pre>\n\n<p>The <code>greeter_server</code> should compile correctly afterwards:</p>\n\n<pre><code>cd ../greeter_server\ngo build .\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5125, "user_id": 6468625, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RHnsOSmZM8g/AAAAAAAAAAI/AAAAAAAAAIw/yM_Sg1aLU_s/photo.jpg?sz=128", "display_name": "sourav pandit", "link": "https://stackoverflow.com/users/6468625/sourav-pandit"}, "is_accepted": false, "score": 0, "last_activity_date": 1610959705, "creation_date": 1610959705, "answer_id": 65771265, "question_id": 42040951, "link": "https://stackoverflow.com/questions/42040951/golang-grpc-register-a-service-on-grpcserver/65771265#65771265", "title": "golang + grpc: register a service on GrpcServer", "body": "<p>if using grpc 3  use below cmd</p>\n<pre><code>protoc -I=proto --go_out=. --go-grpc_out=. proto/*.proto\n</code></pre>\n"}], "owner": {"reputation": 3391, "user_id": 4470201, "user_type": "registered", "accept_rate": 66, "profile_image": "https://graph.facebook.com/558270100/picture?type=large", "display_name": "Shikloshi", "link": "https://stackoverflow.com/users/4470201/shikloshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2480, "favorite_count": 1, "accepted_answer_id": 42044379, "answer_count": 2, "score": 2, "last_activity_date": 1610959705, "creation_date": 1486214964, "question_id": 42040951, "link": "https://stackoverflow.com/questions/42040951/golang-grpc-register-a-service-on-grpcserver", "title": "golang + grpc: register a service on GrpcServer", "body": "<p>I'm working with this <a href=\"https://github.com/grpc/grpc-go/tree/master/examples/helloworld/helloworld\" rel=\"nofollow noreferrer\">example</a> for building a go lang grpc server.</p>\n\n<p>But it seems that I'm missing something - In the example there is a phase of registering a service to the grpc-server but my protoc output has no registration method exported:</p>\n\n<pre><code>s := grpc.NewServer()\npb.RegisterGreeterServer(s, &amp;server{})\n</code></pre>\n\n<p>Was there a change in the compilation of protobuf3 files? </p>\n\n<p>Am I'm compiling it in the wrong way?</p>\n\n<p><code>protoc --go_output=. *.proto\n</code></p>\n\n<p>And how can I make the service work for the server, It is currently not:</p>\n\n<pre><code>func main() {\n    lis, err := net.Listen(\"tcp\", port)\n    if err != nil {\n        log.Fatalf(\"failed to listen: %v\", err)\n    }\n    s := grpc.NewServer()\n    //register should go here?!\n    reflection.Register(s)\n    if err := s.Serve(lis); err != nil {\n        log.Fatalf(\"failed to server: %v\", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["dictionary", "go", "struct", "slice"], "answers": [{"comments": [{"owner": {"reputation": 40613, "user_id": 4099593, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zweIW.png?s=128&g=1", "display_name": "Bhargav Rao", "link": "https://stackoverflow.com/users/4099593/bhargav-rao"}, "edited": false, "score": 0, "creation_date": 1486220475, "post_id": 42040188, "comment_id": 71256920, "body": "Comments are not for extended discussion; this conversation has been <a href=\"http://chat.stackoverflow.com/rooms/134847/discussion-on-answer-by-sarathsp-how-fix-problm-in-struct-using-go\">moved to chat</a>."}], "tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": true, "score": 1, "last_activity_date": 1486212567, "last_edit_date": 1486212567, "creation_date": 1486210181, "answer_id": 42040188, "question_id": 42039921, "link": "https://stackoverflow.com/questions/42039921/how-fix-issue-in-struct-using-go/42040188#42040188", "title": "How fix Issue in Struct using Go?", "body": "<p><strong>1 . in function Add() , kvs[id]=kv have error! how fix?</strong></p>\n\n<p><code>kvs</code> is of type *KeyVals it does not support indexing\n   You may use </p>\n\n<pre><code>(*kvs)[id] = kv \n</code></pre>\n\n<p><strong>2 . speed of Exist() and Search() is good? can not make better?</strong></p>\n\n<p>You may use a hashmap instead of array for faster search/exist functions.You can combine <code>search</code> and <code>exist</code> to one function. </p>\n\n<p><strong>3 . i try add index name to code : type KeyVals []KeyVal change to : mean : type KeyVals [interface{}]KeyVal or type KeyVals [string]KeyVal ... but error!</strong></p>\n\n<p>The type declarations are wrong.Types closer to those are <code>map[interface{}]interface{}</code> or <code>map [string]interface{}</code></p>\n\n<p>Here is the updated code that works, I have used Hashmap instead of array and an array to keep track of the order</p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype KeyVals struct {\n    keyVals     map[string]interface{}\n    KeysInOrder []string\n}\n\nfunc (kvs *KeyVals) Add(key string, val interface{}) {\n    if kvs.keyVals == nil {\n        kvs.keyVals = make(map[string]interface{})\n    }\n    if _, ok := kvs.keyVals[key]; ok {\n        kvs.keyVals[key] = val\n        return\n    }\n    kvs.keyVals[key] = val\n    kvs.KeysInOrder = append(kvs.KeysInOrder, key)\n    return\n}\n\nfunc (kvs KeyVals) Search(key string) (interface{}, bool) {\n    val, found := kvs.keyVals[key]\n    return val, found\n}\n\nfunc main() {\n    var kvs KeyVals\n    kvs.Add(\"key1\", \"value1\")\n    kvs.Add(\"key2\", \"value2\")\n    kvs.Add(\"key3\", \"value3\")\n    kvs.Add(\"key4\", 5)\n    kvs.Add(\"key5\", 5.2)\n    kvs.Add(\"key5\", \"new....\") //this should update value of this key. but not work!\n\n    value, ok := kvs.Search(\"key5\")\n    fmt.Println(value, ok)\n\n    for _, key := range kvs.KeysInOrder {\n        value, _ = kvs.Search(key)\n        fmt.Println(key, \" ==&gt; \", value)\n    }\n}\n</code></pre>\n\n<p>Here is the play link : <a href=\"https://play.golang.org/p/ovC9x-Zq6V\" rel=\"nofollow noreferrer\">link</a></p>\n"}], "owner": {"reputation": 41, "user_id": 7515369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad8f7841c2a8fbde89c55027a86b918?s=128&d=identicon&r=PG&f=1", "display_name": "LoveLearn", "link": "https://stackoverflow.com/users/7515369/lovelearn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 1, "accepted_answer_id": 42040188, "answer_count": 1, "score": -1, "last_activity_date": 1538832639, "creation_date": 1486208355, "last_edit_date": 1538832639, "question_id": 42039921, "link": "https://stackoverflow.com/questions/42039921/how-fix-issue-in-struct-using-go", "title": "How fix Issue in Struct using Go?", "body": "<p>I have Problem in Struct using Go.</p>\n\n<p>example code:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n)    \ntype KeyVal struct {\n    Key   interface{}\n    Value interface{}\n}\ntype KeyVals []KeyVal\nfunc (kvs *KeyVals) AddOld(key interface{}, val interface{}) {\n    kv := KeyVal{key, val,typ}\n    *kvs = append(*kvs, kv)\n}\nfunc (kvs *KeyVals) Add(key interface{}, val interface{}){\n    var flag,id = kvs.Exist(key)\n    if flag == true {\n        //kv := KeyVal{key,\"Updated!\"}\n        //*kvs=append(*kvs,kv)\n        //fmt.Println(*kvs[0].Key)\n        //update value of them\n        kv := KeyVal{key,val}\n        kvs[id]=kv\n        //*kvs[id]=kv\n        //fmt.Println(\"old set with id =\",id,\",\",\"value =\",kvs)\n    }else{\n        kv := KeyVal{key, val}\n        *kvs = append(*kvs, kv)\n    }\n}\nfunc (kvs *KeyVals) Search(skey interface{}) (bool,interface{},interface{}) {\n    for n, kv := range *kvs {\n        key := kv.Key\n        val := kv.Value\n        if(key == skey){\n            return true,n,val\n        }\n    }\n    return false,nil,nil\n}\nfunc (kvs *KeyVals) Exist(skey interface{})(bool,int) {\n    for n, kv := range *kvs {\n        key := kv.Key\n        if(key == skey){\n            return true,n\n        }\n    }\n    return false,-1\n}\nfunc main() {\n    var kvs keyval.KeyVals\n\n    kvs.Add(\"key1\",\"value1\")\n    kvs.Add(\"key2\",\"value2\")\n    kvs.Add(\"key3\",\"value3\")\n    kvs.Add(\"key4\",5)\n    kvs.Add(\"key5\",5.2)\n    kvs.Add(\"key5\",\"new....\")//this should update value of this key. but not work!\n\n\nvar flag,id,value = kvs.Search(\"key5\")\nfmt.Println(flag,id,value)\n\n\n    for _, kv := range kvs {\n        key := kv.Key\n        val := kv.Value\n\n        fmt.Println(\"\", key,\" ==&gt; \", val)\n    }\n}\n</code></pre>\n\n<p>Problem of me:</p>\n\n<ol>\n<li><p>in function Add() , <code>kvs[id]=kv</code> have error! how fix?</p></li>\n<li><p>speed of <code>Exist()</code> and <code>Search()</code> is good? can not make better?</p></li>\n<li><p>I try add index name to code : <code>type KeyVals []KeyVal</code>  change to : mean : <code>type KeyVals [interface{}]KeyVal</code> or <code>type KeyVals [string]KeyVal</code> ... but error!</p></li>\n</ol>\n"}, {"tags": ["pointers", "go", "struct", "interface", "formatting"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486208045, "post_id": 42039827, "comment_id": 71253203, "body": "You should paste the code here. and in brief, <code>test1</code> has type of <code>Test</code>, and <code>test2</code> has type of <code>interface{}</code> (a.k.a empty interface). it&#39;s a different type."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486210358, "post_id": 42039827, "comment_id": 71253898, "body": "@ymonad Yes, I checked it, but how can I return it ad the correct struct?"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486211467, "post_id": 42039827, "comment_id": 71254235, "body": "Of course you can change <code>map[string]interface{}</code> to <code>map[string]Test</code>. However I suppose that this is <a href=\"http://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a>. Do you have any specific problem you want to solve ?"}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486212883, "post_id": 42039827, "comment_id": 71254637, "body": "@ymonad the Models array is full of with structs and i alwys want to return the instance of the correct struct. For example there is 300 struct which all represent database tables and i always want to return an instance of the table what i want to use."}], "answers": [{"tags": [], "owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "is_accepted": false, "score": 1, "last_activity_date": 1486215215, "creation_date": 1486215215, "answer_id": 42040985, "question_id": 42039827, "link": "https://stackoverflow.com/questions/42039827/difference-between-golang-pointers/42040985#42040985", "title": "Difference between golang pointers", "body": "<p>According to the <strong>Size and alignment guarantees</strong> as per golang docs </p>\n\n<blockquote>\n  <p>A struct or array type has size zero if it contains no fields (or\n  elements, respectively) that have a size greater than zero. Two\n  distinct zero-size variables may have the same address in memory.</p>\n</blockquote>\n\n<p>This is why  <code>Test 1</code> is <code>&amp;{}</code></p>\n\n<blockquote>\n  <p>Interface values are represented as a two-word pair giving a pointer\n  to information about the type stored in the interface and a pointer to\n  the associated data.</p>\n</blockquote>\n\n<p><code>Test2</code> is an <code>interface{}</code>, Test2 thus has pointer to information about type stored and pointer to the data itself. It Type and Value informations</p>\n"}, {"comments": [{"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1486230634, "post_id": 42042673, "comment_id": 71260304, "body": "Nice answer, and mostly I discovered this, but currently I don&#39;t have solution to my problem: I wrote my problem above what is your advice? <i>&quot;the Models array is full of with structs and i alwys want to return the instance of the correct struct. For example there is 300 struct which all represent database tables and i always want to return an instance of the table what i want to use&quot;</i>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1486245010, "post_id": 42042673, "comment_id": 71265064, "body": "@PumpkinSeed I don&#39;t understand your example, maybe you should post that as a new question?"}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1486289675, "post_id": 42042673, "comment_id": 71274069, "body": "I taked it, I hope everything is understandable: <a href=\"http://stackoverflow.com/questions/42038782/golang-database-manager-api-concept-error-with-type-assertion\" title=\"golang database manager api concept error with type assertion\">stackoverflow.com/questions/42038782/&hellip;</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1486227684, "last_edit_date": 1592644375, "creation_date": 1486225570, "answer_id": 42042673, "question_id": 42039827, "link": "https://stackoverflow.com/questions/42039827/difference-between-golang-pointers/42042673#42042673", "title": "Difference between golang pointers", "body": "<p><strong>TL;DR:</strong> In the first case you pass a value of type <code>*Test</code> for printing, but in the second case you pass a value of type <code>*interface{}</code>! The <code>%v</code> verb means to format using the default formatting, but the default formatting depends on the type of the value.</p>\n<hr />\n<p>The difference you see is just the default formatting rules of the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code></a> package's implementation.</p>\n<p>You're using <a href=\"https://golang.org/pkg/fmt/#Printf\" rel=\"nofollow noreferrer\"><code>fmt.Printf()</code></a>:</p>\n<pre><code>func Printf(format string, a ...interface{}) (n int, err error)\n</code></pre>\n<p>which takes a format string and other arguments as type <code>interface{}</code>. So note that if the value you pass is not of type <code>interface{}</code>, the value will be wrapped in a value of type <code>interface{}</code>.</p>\n<p>Now let's see your examples:</p>\n<pre><code>test1 := Test{}\n// ...\nfmt.Printf(&quot;%v&quot;, &amp;test1)\n</code></pre>\n<p><code>test1</code> is of type <code>Test</code>, and you pass <code>&amp;test1</code> which is of type <code>*Test</code>. This will be wrapped in an <code>interface{}</code>. The formatting rules from the package doc of <code>fmt</code>:</p>\n<blockquote>\n<p>For compound objects, the elements are printed using these rules, recursively, laid out like this:</p>\n<pre><code>struct:             {field0 field1 ...}\narray, slice:       [elem0 elem1 ...]\nmaps:               map[key1:value1 key2:value2]\npointer to above:   &amp;{}, &amp;[], &amp;map[]\n</code></pre>\n</blockquote>\n<p>Since it is a pointer to a <code>struct</code>, the <code>&amp;{}</code> format will be used. <code>Test</code> has a field <code>Test string</code>, but you didn't set its value, so it defaults to the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> of the type <code>string</code> which is the empty string <code>&quot;&quot;</code>. That's why you see nothing when displayed. Note that if you would have initialized it like this:</p>\n<pre><code>test1 := Test{&quot;a&quot;}\n</code></pre>\n<p>The output would have been:</p>\n<pre><code>&amp;{a}\n</code></pre>\n<p>Let's see your 2nd example:</p>\n<pre><code>test2 := Models[&quot;test&quot;]\n// ...\nfmt.Printf(&quot;%v&quot;, &amp;test2)\n</code></pre>\n<p>The first line is a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declaration</a>, type of <code>test2</code> will be inferred from the right-hand side expression. The right hand side expression is an <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">index expression</a>, indexing a map. Its type will be the value type of the map, and since type of <code>Models</code> is <code>map[string]interface{}</code>, type of <code>test2</code> will be <code>interface{}</code>.</p>\n<p>So far so good. But what happens when you try to print it like <code>fmt.Printf(&quot;%v&quot;, &amp;test2)</code>? You pass a pointer to <code>test2</code> which is of type <code>interface{}</code>, so what you pass is of type <code>*interface{}</code>, and since this is not identical to <code>interface{}</code>, it will be wrapped in another <code>interface{}</code> value.</p>\n<p>So what gets passed to <code>fmt.Printf()</code> is an <code>interface{}</code> value, wrapping a <code>*interface{}</code> value being the address of the <code>test2</code> variable.</p>\n<p>And now the formatting rule that applies here:</p>\n<blockquote>\n<p>The default format for %v is:</p>\n<pre><code>bool:                    %t\nint, int8 etc.:          %d\nuint, uint8 etc.:        %d, %x if printed with %#v\nfloat32, complex64, etc: %g\nstring:                  %s\nchan:                    %p\npointer:                 %p\n</code></pre>\n</blockquote>\n<p>Since the value to be formatted is a pointer (<code>*interface{}</code>), <code>%v</code> will default to <code>%p</code>, which is:</p>\n<blockquote>\n<p>Pointer:</p>\n<pre><code>%p    base 16 notation, with leading 0x\n</code></pre>\n</blockquote>\n<p>So the result is properly printing the address value in hexadecimal format, e.g.:</p>\n<pre><code>0x1040a160\n</code></pre>\n<hr />\n<p>To obtain a struct from <code>test2</code>, you can use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>. So it should rather be something like this:</p>\n<pre><code>t2 := Models[&quot;test&quot;]\ntest2 := t2.(Test) // test2 is of type Test\n</code></pre>\n<p>This <code>test2</code> has identical type to that of <code>test1</code>, and will produce the same result when printing. Try it on the <a href=\"https://play.golang.org/p/ndSvevmGJ9\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n<p>Best would be though to store <code>*Test</code> values in the map, and so no type assertion or even storing in local variable would be necessary, as the <code>interface{}</code> stored in the map would already be a pointer to <code>Test</code>, which can be used / passed around as-is.</p>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 42042673, "answer_count": 2, "score": 1, "last_activity_date": 1486227684, "creation_date": 1486207757, "last_edit_date": 1486227033, "question_id": 42039827, "link": "https://stackoverflow.com/questions/42039827/difference-between-golang-pointers", "title": "Difference between golang pointers", "body": "<p>There are 2 kinds of variables that I have. Check for the <a href=\"https://play.golang.org/p/ojjzqbFEJ7\" rel=\"nofollow noreferrer\">Go playground</a>, and I don't understand why this is happening. The problem: what I get from the <code>Models</code> it should be a <code>struct</code> to use it for GORM <code>First()</code> function.</p>\n\n<p>The code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Test struct {\n    Test string\n}\n\nvar Models = map[string]interface{}{\n    \"test\": newTest(),\n}\n\nfunc main() {\n    test1 := Test{}\n    fmt.Println(\"Test 1: \")\n    fmt.Printf(\"%v\", test1)\n    fmt.Println()\n    fmt.Println(\"Test 1 as pointer: \")\n    fmt.Printf(\"%v\", &amp;test1)\n    fmt.Println()\n    test2 := Models[\"test\"]\n    fmt.Println(\"Test 2: \")\n    fmt.Printf(\"%v\", test2)\n    fmt.Println()\n    fmt.Println(\"Test 2 as pointer: \")\n    fmt.Printf(\"%v\", &amp;test2)\n\n}\n\nfunc newTest() Test {\n    var model Test \n    return model\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 258, "user_id": 1682093, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TMysJ.jpg?s=128&g=1", "display_name": "n-canter", "link": "https://stackoverflow.com/users/1682093/n-canter"}, "is_accepted": true, "score": 1, "last_activity_date": 1486205945, "creation_date": 1486205945, "answer_id": 42039552, "question_id": 42039453, "link": "https://stackoverflow.com/questions/42039453/using-package-as-store-for-global-variables/42039552#42039552", "title": "Using package as store for global variables", "body": "<p>There is nothing wrong with this approach. Also you can use init() function instead of main() to initialize your global variables.</p>\n"}, {"tags": [], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "is_accepted": false, "score": 0, "last_activity_date": 1486320078, "creation_date": 1486320078, "answer_id": 42055785, "question_id": 42039453, "link": "https://stackoverflow.com/questions/42039453/using-package-as-store-for-global-variables/42055785#42055785", "title": "Using package as store for global variables", "body": "<p>Indeed, that is a very nice solution.</p>\n"}], "owner": {"reputation": 3, "user_id": 4955848, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92cc4c88af144a614efef4575a0310ef?s=128&d=identicon&r=PG&f=1", "display_name": "Dr.ink", "link": "https://stackoverflow.com/users/4955848/dr-ink"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 42039552, "answer_count": 2, "score": 0, "last_activity_date": 1486320078, "creation_date": 1486205372, "question_id": 42039453, "link": "https://stackoverflow.com/questions/42039453/using-package-as-store-for-global-variables", "title": "Using package as store for global variables", "body": "<p>I'm learning golang and for my first task I have started to build a simple website. The problem is that I need to have some globals available, I have learned that it is not wise to send these globals using context, as context should be different for every request. Therefore I have thought about creating a package that will be filled with needed variables in main(). I haven't seen this solution in other projects, so I'm asking if this is wrong?\nSimple example of config package:</p>\n\n<pre><code>package config\nvar DB *sql.DB\n</code></pre>\n\n<p>And the main:</p>\n\n<pre><code>package main\nimport \"project/config\"\nfunc main() {\n config.DB, err = sql.Open(\"postgres\", conn)\n if err != nil {\n    panic(err)\n }\n}\n</code></pre>\n\n<p>Then I would just import the config package and get the variable wherever I need.</p>\n"}, {"tags": ["sql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "is_accepted": true, "score": 0, "last_activity_date": 1486748017, "creation_date": 1486748017, "answer_id": 42165376, "question_id": 42038782, "link": "https://stackoverflow.com/questions/42038782/golang-database-manager-api-concept-error-with-type-assertion/42165376#42165376", "title": "Golang database manager api concept, error with type assertion", "body": "<p>Basically I solved the problem, for getting the model as a pointer, and after I return it back as a json file.</p>\n\n<p>So my model is the following: </p>\n\n<pre><code>var Models = map[string]interface{}{\n    \"users\": new(Users),\n    \"categories\": new(Categories),\n}\n</code></pre>\n\n<p>And it is return back a new model by table type. what I can use for gorm First() function. Then json Marshal it, and return.</p>\n\n<pre><code>func (o Operation) First(model string, query url.Values) string {\n    modelStruct := Models[model]\n    db := o.DB\n    db.First(modelStruct)\n    response, _ := json.Marshal(modelStruct)\n    clear(modelStruct)\n    return string(response)\n}\n</code></pre>\n\n<p>Before the return I clear the model pointer because the First() function store callbacks for the latest queries. </p>\n\n<pre><code>func clear(v interface{}) {\n    p := reflect.ValueOf(v).Elem()\n    p.Set(reflect.Zero(p.Type()))\n}\n</code></pre>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 42165376, "answer_count": 1, "score": 1, "last_activity_date": 1486748017, "creation_date": 1486201113, "last_edit_date": 1495539925, "question_id": 42038782, "link": "https://stackoverflow.com/questions/42038782/golang-database-manager-api-concept-error-with-type-assertion", "title": "Golang database manager api concept, error with type assertion", "body": "<p>The base concept creating a Database Manager API for getting data through an API. I am using the GORM for getting data of the instances of the strcuts. So there is 300-400 struct which represents the tables. </p>\n\n<pre><code>type Users struct {\n  ID int64\n  Name string\n}\n\ntype Categories struct {\n  ID int64\n  Category string\n}\n</code></pre>\n\n<p>The next step I implement a function which is return the correct instance of the struct by table name, what I get through the API endpoint param.</p>\n\n<pre><code>func GetModel(model string) interface{} {\n  switch model {\n  case \"users\":\n    return Users{}\n  case \"categories\"\n    return Categories{}\n  }\n  return false\n}\n</code></pre>\n\n<p>After there is an operations struct where the only one field is the DB. There is methods, for example the GetLast() where I want to use the GORM db.Last(&amp;users) function. </p>\n\n<pre><code>func (o Operations) GetLast(model string) interface{} {\n  modelStruct := GetModel(model)\n  .\n  .\n  .\n  return o.DB.Last(&amp;modelStruct)\n}\n</code></pre>\n\n<p>There is points so this is what I don't know. The current solution is not working because in this case it is an interface{} I need make a type assertion <a href=\"https://stackoverflow.com/questions/42039827/difference-between-golang-pointers\">more info in this question</a>. The type assertion is looks like: </p>\n\n<pre><code>func (o Operations) GetLast(model string) interface{} {\n  modelStruct := GetModel(model)\n  .\n  test := modelStruct.(Users)\n  .\n  return o.DB.Last(&amp;test)\n}\n</code></pre>\n\n<p>This solution working, but in this case I lost the modularity. I try using the <code>reflect.TypeOf(modelStruct)</code>, but it is also not working because the result of the reflect.TypeOf is a reflect.Type, with is not a golang type. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1486204428, "post_id": 42039225, "comment_id": 71252189, "body": "I was expecting that the second goroutine could run with true parallelism, since <code>GOMAXPROCS=2</code>."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "edited": false, "score": 0, "creation_date": 1486323470, "post_id": 42039225, "comment_id": 71285125, "body": "The second goroutine could run with true parallelism but the current Go runtime can only schedule it at certain safe points. Try adding <code>runtime.Gosched()</code> after <code>go threadMain(done)</code> to force it to be scheduled before the for loop. Of course there cases when Go sceduler might distribute work between running threads sub-optimally. If you have a real program that performs badly because of it try filling a bug report."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 0, "last_activity_date": 1486203838, "creation_date": 1486203838, "answer_id": 42039225, "question_id": 42038289, "link": "https://stackoverflow.com/questions/42038289/why-causes-the-difference-in-measured-time-for-goroutine-creation/42039225#42039225", "title": "Why causes the difference in measured time for goroutine creation?", "body": "<p>Go scheduler is cooperative. It can switch the current goroutine to another one only at certain points of the program such as function calls, reading/writing to a channel, etc. I expect that the difference you observe is due to the fact that the goroutines are started later (after the added for loop).</p>\n"}], "owner": {"reputation": 62800, "user_id": 391161, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fb76d8bcc69144a3ee4c893ece7fc588?s=128&d=identicon&r=PG&f=1", "display_name": "merlin2011", "link": "https://stackoverflow.com/users/391161/merlin2011"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 176, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1486203899, "creation_date": 1486197542, "question_id": 42038289, "link": "https://stackoverflow.com/questions/42038289/why-causes-the-difference-in-measured-time-for-goroutine-creation", "title": "Why causes the difference in measured time for goroutine creation?", "body": "<p>Consider the following application, designed to measure <code>goroutine</code> creation latency. Assume that we are running with <code>GOMAXPROCS=2</code>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nconst numRuns = 10000\n\ntype  timeRecord struct{\n    Ts time.Time\n    Msg string\n}\n\nvar timeStamps []timeRecord\n\nfunc threadMain(done chan bool) {\n    timeStamps = append(timeStamps, timeRecord{time.Now(), \"Inside thread\"})\n    done &lt;- true\n}\n\nfunc main() {\n    timeStamps = make([]timeRecord, 0, numRuns*2)\n    done := make(chan bool)\n    dummy := 0\n    for i := 0; i &lt; numRuns; i++ {\n        timeStamps = append(timeStamps, timeRecord{time.Now(), \"Before creation\"})\n        go threadMain(done)\n        &lt;-done\n    }\n\n    // Regularize\n    regularizedTime := make([]time.Duration, numRuns*2)\n    for i := 0; i &lt; len(timeStamps) ; i++ {\n        regularizedTime[i] = timeStamps[i].Ts.Sub(timeStamps[0].Ts)\n    }\n\n    // Fake timetraced\n    fmt.Printf(\"%6d ns (+%6d ns): %s\\n\", 0, 0, timeStamps[0].Msg)\n    for i := 1; i &lt; len(timeStamps) ; i++ {\n        fmt.Printf(\"%8d ns (+%6d ns): %s\\n\", regularizedTime[i], (regularizedTime[i] - regularizedTime[i-1]).Nanoseconds(), timeStamps[i].Msg)\n    }\n}\n</code></pre>\n\n<p>On my server, this consistently outputs roughly a median <strong>260 ns delta</strong> from <code>Before creation</code> to <code>Inside thread</code>. Now consider the following variation of the main method.</p>\n\n<pre><code>timeStamps = make([]timeRecord, 0, numRuns*2)\ndone := make(chan bool)\ndummy := 0\nfor i := 0; i &lt; numRuns; i++ {\n    timeStamps = append(timeStamps, timeRecord{time.Now(), \"Before creation\"})\n    go threadMain(done)\n    for j := 0; j &lt; 1000; j++ {\n        dummy += j\n    }\n    &lt;-done\n}\n</code></pre>\n\n<p>Under this variation, the same time delta takes roughly <strong>890 ns</strong>.</p>\n\n<p>Obviously, the exact numbers are machine-specific, but the difference between the numbers is curious. Logically, if I am measuring between \"Before creation\" and \"Inside thread\", adding extra logic after the <code>go</code> statement seems like it should not increase that time, but it does.</p>\n\n<p>Does anyone have a good idea for why the time increase is not occurring in the expected location?</p>\n"}, {"tags": ["postgresql", "go", "time", "go-gorm"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486194142, "post_id": 42037562, "comment_id": 71249378, "body": "Your code works in my environment and able to correctly insert data into database. From the error message, it seems that the error is happening when you ore creating <code>building</code>. can you paste the code?"}, {"owner": {"reputation": 2183, "user_id": 5257738, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1481932215459032/picture?type=large", "display_name": "Rustam Ibragimov", "link": "https://stackoverflow.com/users/5257738/rustam-ibragimov"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486194270, "post_id": 42037562, "comment_id": 71249405, "body": "@ymonad, can you check again?"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486194571, "post_id": 42037562, "comment_id": 71249476, "body": "I already tried setting the type of start_time and end_time for TIME, DATE, and TIMESTAMP, and all works, at least for <code>time.Now()</code>. here&#39;s the code: <a href=\"https://gist.github.com/anonymous/5014d44ca999144ff06ffc05aa4acee3\" rel=\"nofollow noreferrer\">gist.github.com/anonymous/5014d44ca999144ff06ffc05aa4acee3</a>"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486194639, "post_id": 42037562, "comment_id": 71249487, "body": "So as @VonC mentions in the answer, you may update the gorm library to the newest one, or try VonC&#39;s answer."}, {"owner": {"reputation": 2183, "user_id": 5257738, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1481932215459032/picture?type=large", "display_name": "Rustam Ibragimov", "link": "https://stackoverflow.com/users/5257738/rustam-ibragimov"}, "reply_to_user": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 0, "creation_date": 1486199198, "post_id": 42037562, "comment_id": 71250625, "body": "@ymonad, I see, you use time.Now() which gives complete date and time, but I use a string like &quot;10:00:00&quot;"}, {"owner": {"reputation": 98, "user_id": 4553664, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31b331929e2ed56a8689021fded2c19b?s=128&d=identicon&r=PG&f=1", "display_name": "Alan", "link": "https://stackoverflow.com/users/4553664/alan"}, "edited": false, "score": 0, "creation_date": 1582721560, "post_id": 42037562, "comment_id": 106873785, "body": "@RustamIbragimov were you able to find a fix/workaround for that? I&#39;m just starting to look at how to handle mysql TIME."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1486194010, "last_edit_date": 1495535368, "creation_date": 1486194010, "answer_id": 42037838, "question_id": 42037562, "link": "https://stackoverflow.com/questions/42037562/golang-gorm-time-data-type-conversion/42037838#42037838", "title": "Golang gorm time data type conversion", "body": "<p>As mentioned in \"<a href=\"https://stackoverflow.com/a/39519483/6309\">How to save time in the database in Go when using GORM and Postgresql?</a>\"</p>\n\n<blockquote>\n  <p>Currently, there's no support in GORM for any Date/Time types except <a href=\"https://github.com/jinzhu/gorm/blob/6ff0c72557730b9055dd020d73781eb362f40f3a/dialect_postgres.go#L60-L61\" rel=\"nofollow noreferrer\"><code>timestamp with time zone</code></a>.</p>\n</blockquote>\n\n<p>So you might need to parse a time as a date:</p>\n\n<pre><code>time.Parse(\"2006-01-02 3:04PM\", \"1970-01-01 9:00PM\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 14532497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e2005adb37a1bcc76a8c38b9e4aeba8?s=128&d=identicon&r=PG&f=1", "display_name": "Ramananda Panda", "link": "https://stackoverflow.com/users/14532497/ramananda-panda"}, "is_accepted": false, "score": 0, "last_activity_date": 1608734578, "creation_date": 1608734578, "answer_id": 65426134, "question_id": 42037562, "link": "https://stackoverflow.com/questions/42037562/golang-gorm-time-data-type-conversion/65426134#65426134", "title": "Golang gorm time data type conversion", "body": "<p>I am have come across the same error. It seems like there is a mismatch between type of the column in the database and the Gorm Model</p>\n<p>Probably the type of the column in the database is text which you might have set earlier and then changed the column type in gorm model.</p>\n"}, {"tags": [], "owner": {"reputation": 5734, "user_id": 415628, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/84d8280499418f22f42778cc40c20a12?s=128&d=identicon&r=PG", "display_name": "Ezequiel Muns", "link": "https://stackoverflow.com/users/415628/ezequiel-muns"}, "is_accepted": false, "score": 1, "last_activity_date": 1609006085, "last_edit_date": 1609006085, "creation_date": 1609004605, "answer_id": 65459041, "question_id": 42037562, "link": "https://stackoverflow.com/questions/42037562/golang-gorm-time-data-type-conversion/65459041#65459041", "title": "Golang gorm time data type conversion", "body": "<p>While gorm does not support the TIME type directly, you can always create your own type that implements the <code>sql.Scanner</code> and <code>driver.Valuer</code> interfaces to be able to put in and take out time values from the database.</p>\n<p>Here's an example implementation which reuses/aliases <code>time.Time</code>, but doesn't use the day, month, year data:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>const MyTimeFormat = &quot;15:04:05&quot;\n\ntype MyTime time.Time\n\nfunc NewMyTime(hour, min, sec int) MyTime {\n    t := time.Date(0, time.January, 1, hour, min, sec, 0, time.UTC)\n    return MyTime(t)\n}\n\nfunc (t *MyTime) Scan(value interface{}) error {\n    switch v := value.(type) {\n    case []byte:\n        return t.UnmarshalText(string(v))\n    case string:\n        return t.UnmarshalText(v)\n    case time.Time:\n        *t = MyTime(v)\n    case nil:\n        *t = MyTime{}\n    default:\n        return fmt.Errorf(&quot;cannot sql.Scan() MyTime from: %#v&quot;, v)\n    }\n    return nil\n}\n\nfunc (t MyTime) Value() (driver.Value, error) {\n    return driver.Value(time.Time(t).Format(MyTimeFormat)), nil\n}\n\nfunc (t *MyTime) UnmarshalText(value string) error {\n    dd, err := time.Parse(MyTimeFormat, value)\n    if err != nil {\n        return err\n    }\n    *t = MyTime(dd)\n    return nil\n}\n\nfunc (MyTime) GormDataType() string {\n    return &quot;TIME&quot;\n}\n</code></pre>\n<p>You can use it like:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type Building struct {\n    ID        int    `json:&quot;id,omitempty&quot;`\n    Name      string `gorm:&quot;size:255&quot; json:&quot;name,omitempty&quot;`\n    Lon       string `gorm:&quot;size:64&quot; json:&quot;lon,omitempty&quot;`\n    Lat       string `gorm:&quot;size:64&quot; json:&quot;lat,omitempty&quot;`\n    StartTime MyTime `json:&quot;start_time,omitempty&quot;`\n    EndTime   MyTime `json:&quot;end_time,omitempty&quot;`\n}\n\nb := Building{\n    Name:      &quot;test&quot;,\n    StartTime: NewMyTime(10, 23, 59),\n}\n</code></pre>\n<p>For proper JSON support you'll need to add implementations for <code>json.Marshaler</code>/<code>json.Unmarshaler</code>, which is left as an exercise for the reader \ud83d\ude09</p>\n"}], "owner": {"reputation": 2183, "user_id": 5257738, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/1481932215459032/picture?type=large", "display_name": "Rustam Ibragimov", "link": "https://stackoverflow.com/users/5257738/rustam-ibragimov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12229, "favorite_count": 2, "answer_count": 3, "score": 4, "last_activity_date": 1611655420, "creation_date": 1486191843, "last_edit_date": 1542544289, "question_id": 42037562, "link": "https://stackoverflow.com/questions/42037562/golang-gorm-time-data-type-conversion", "title": "Golang gorm time data type conversion", "body": "<p><strong>Situation:</strong></p>\n\n<p>I'm using a <em>postgres</em> database and have the following struct: </p>\n\n<pre><code>type Building struct {\nID        int `json:\"id,omitempty\"`\nName      string `gorm:\"size:255\" json:\"name,omitempty\"`\nLon       string `gorm:\"size:64\" json:\"lon,omitempty\"`\nLat       string `gorm:\"size:64\" json:\"lat,omitempty\"`\nStartTime time.Time `gorm:\"type:time\" json:\"start_time,omitempty\"`\nEndTime   time.Time `gorm:\"type:time\" json:\"end_time,omitempty\"`\n}\n</code></pre>\n\n<p><strong>Problem:</strong></p>\n\n<p>However, when I try to insert this struct into the database, the following error occurs:</p>\n\n<blockquote>\n  <p>parsing time \"\"10:00:00\"\" as \"\"2006-01-02T15:04:05Z07:00\"\": cannot\n  parse \"0:00\"\" as \"2006\"\"}.</p>\n</blockquote>\n\n<p>Probably, it doesn't recognize the <code>StartTime</code> and <code>EndTime</code> fields as <em>Time</em> type and uses <em>Timestamp</em> instead. How can I specify that these fields are of the type <em>Time</em>?</p>\n\n<p><strong>Additional information</strong></p>\n\n<p>The following code snippet shows my <code>Building</code> creation:</p>\n\n<pre><code>if err = db.Create(&amp;building).Error; err != nil {\n    return database.InsertResult{}, err\n}\n</code></pre>\n\n<p>The SQL code of the Building table is as follows:</p>\n\n<pre><code>DROP TABLE IF EXISTS building CASCADE;\nCREATE TABLE building(\n  id SERIAL,\n  name VARCHAR(255) NOT NULL ,\n  lon VARCHAR(31) NOT NULL ,\n  lat VARCHAR(31) NOT NULL ,\n  start_time TIME NOT NULL ,\n  end_time TIME NOT NULL ,\n  PRIMARY KEY (id)\n);\n</code></pre>\n"}, {"tags": ["go", "travis-ci"], "answers": [{"comments": [{"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1486242251, "post_id": 42035715, "comment_id": 71264259, "body": "omg, i can&#39;t that was it!   that&#39;s what I get for coding in the middle of the night with kids. thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1486174234, "last_edit_date": 1486174234, "creation_date": 1486173887, "answer_id": 42035715, "question_id": 42035363, "link": "https://stackoverflow.com/questions/42035363/travis-ci-golang-examples-test-error/42035715#42035715", "title": "Travis-CI GoLang Examples test error", "body": "<p>The got and want values on Travis are not identical. They differ by the time zone offset. </p>\n\n<p><a href=\"https://godoc.org/time#Local\" rel=\"nofollow noreferrer\"><code>time.Local</code></a> is -0500 on your local machine and +0000 on Travis. Use <code>time.UTC</code> or some other location that's independent of the system where the code is running running:</p>\n\n<pre><code>now := time.Date(2017, time.February, 1, 7, 51, 0, 0, time.UTC)\n</code></pre>\n"}], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 1, "accepted_answer_id": 42035715, "answer_count": 1, "score": 1, "last_activity_date": 1486242335, "creation_date": 1486170067, "last_edit_date": 1486242335, "question_id": 42035363, "link": "https://stackoverflow.com/questions/42035363/travis-ci-golang-examples-test-error", "title": "Travis-CI GoLang Examples test error", "body": "<p>Can't seem to find an answer to this one.</p>\n\n<p>I am trying to use Travis-CI to build/run tests for my GoLang package; but, Travis keeps failing on GoLang Examples that are running as part of the tests.</p>\n\n<p>For example, here's one Example:</p>\n\n<pre><code>func Example() {\n    now := time.Date(2017, time.February, 1, 7, 51, 0, 0, time.Local)\n\n    // instantiate a new Podcast\n    p := podcast.New(\n        \"Sample Podcasts\",\n        \"http://example.com/\",\n        \"An example Podcast\",\n        &amp;now, &amp;now,\n    )\n\n    // add some channel properties\n    p.ISubtitle = \"A simple Podcast\"\n    p.AddImage(\"http://example.com/podcast.jpg\")\n    p.AddAuthor(\"Jane Doe\", \"jane.doe@example.com\")\n\n    for i := int64(0); i &lt; 2; i++ {\n        n := strconv.FormatInt(i, 10)\n\n        // create an Item\n        item := podcast.Item{\n            Title:       \"Episode \" + n,\n            Description: \"Description for Episode \" + n,\n            ISubtitle:   \"A simple episode \" + n,\n            PubDate:     &amp;now,\n        }\n        // add a Download to the Item\n        item.AddEnclosure(\"http://example.com/\"+n+\".mp3\", podcast.MP3, 55*(i+1))\n\n        // add the Item and check for validation errors\n        if _, err := p.AddItem(item); err != nil {\n            os.Stderr.WriteString(\"item validation error: \" + err.Error())\n        }\n    }\n\n    // Podcast.Encode writes to an io.Writer\n    if err := p.Encode(os.Stdout); err != nil {\n        os.Stderr.WriteString(\"error writing to stdout: \" + err.Error())\n    }\n\n    // Output:\n    // &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n    // &lt;rss version=\"2.0\" xmlns:itunes=\"http://www.itunes.com/dtds/podcast-1.0.dtd\"&gt;\n    //   &lt;channel&gt;\n    //     &lt;title&gt;Sample Podcasts&lt;/title&gt;\n    //     &lt;link&gt;http://example.com/&lt;/link&gt;\n    //     &lt;description&gt;An example Podcast&lt;/description&gt;\n    //     &lt;generator&gt;go podcast v1.0.0 (github.com/eduncan911/podcast)&lt;/generator&gt;\n    //     &lt;language&gt;en-us&lt;/language&gt;\n    //     &lt;lastBuildDate&gt;Wed, 01 Feb 2017 07:51:00 -0500&lt;/lastBuildDate&gt;\n    //     &lt;managingEditor&gt;jane.doe@example.com (Jane Doe)&lt;/managingEditor&gt;\n    //     &lt;pubDate&gt;Wed, 01 Feb 2017 07:51:00 -0500&lt;/pubDate&gt;\n    //     &lt;image&gt;\n    //       &lt;url&gt;http://example.com/podcast.jpg&lt;/url&gt;\n    //     &lt;/image&gt;\n    //     &lt;itunes:author&gt;jane.doe@example.com (Jane Doe)&lt;/itunes:author&gt;\n    //     &lt;itunes:subtitle&gt;A simple Podcast&lt;/itunes:subtitle&gt;\n    //     &lt;itunes:image href=\"http://example.com/podcast.jpg\"&gt;&lt;/itunes:image&gt;\n    //     &lt;item&gt;\n    //       &lt;guid&gt;http://example.com/0.mp3&lt;/guid&gt;\n    //       &lt;title&gt;Episode 0&lt;/title&gt;\n    //       &lt;link&gt;http://example.com/0.mp3&lt;/link&gt;\n    //       &lt;description&gt;Description for Episode 0&lt;/description&gt;\n    //       &lt;pubDate&gt;Wed, 01 Feb 2017 07:51:00 -0500&lt;/pubDate&gt;\n    //       &lt;enclosure url=\"http://example.com/0.mp3\" length=\"55\" type=\"audio/mpeg\"&gt;&lt;/enclosure&gt;\n    //       &lt;itunes:author&gt;jane.doe@example.com (Jane Doe)&lt;/itunes:author&gt;\n    //       &lt;itunes:subtitle&gt;A simple episode 0&lt;/itunes:subtitle&gt;\n    //       &lt;itunes:image href=\"http://example.com/podcast.jpg\"&gt;&lt;/itunes:image&gt;\n    //       &lt;itunes:duration&gt;55&lt;/itunes:duration&gt;\n    //     &lt;/item&gt;\n    //     &lt;item&gt;\n    //       &lt;guid&gt;http://example.com/1.mp3&lt;/guid&gt;\n    //       &lt;title&gt;Episode 1&lt;/title&gt;\n    //       &lt;link&gt;http://example.com/1.mp3&lt;/link&gt;\n    //       &lt;description&gt;Description for Episode 1&lt;/description&gt;\n    //       &lt;pubDate&gt;Wed, 01 Feb 2017 07:51:00 -0500&lt;/pubDate&gt;\n    //       &lt;enclosure url=\"http://example.com/1.mp3\" length=\"110\" type=\"audio/mpeg\"&gt;&lt;/enclosure&gt;\n    //       &lt;itunes:author&gt;jane.doe@example.com (Jane Doe)&lt;/itunes:author&gt;\n    //       &lt;itunes:subtitle&gt;A simple episode 1&lt;/itunes:subtitle&gt;\n    //       &lt;itunes:image href=\"http://example.com/podcast.jpg\"&gt;&lt;/itunes:image&gt;\n    //       &lt;itunes:duration&gt;110&lt;/itunes:duration&gt;\n    //     &lt;/item&gt;\n    //   &lt;/channel&gt;\n    // &lt;/rss&gt;\n}\n</code></pre>\n\n<p>Here's a link to a specific Travis build that fails <code>go test</code>, even though it runs locally:</p>\n\n<p><a href=\"https://travis-ci.org/eduncan911/podcast/builds/198093154\" rel=\"nofollow noreferrer\">https://travis-ci.org/eduncan911/podcast/builds/198093154</a></p>\n\n<pre><code>$ go test -covermode count -coverprofile cover.out\n--- FAIL: Example (0.00s)\ngot:\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n...(omitted)\n\nwant:\n&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n...(omitted)\n</code></pre>\n\n<p><code>go test</code> command works normally locally on macOS, in a Windows 10 VM and in an EC2 Ubuntu instances.  </p>\n\n<p>It is only Travis that is not able to to run <code>go test</code>, with examples.</p>\n\n<p>If I skip the Examples, then the tests pass with:</p>\n\n<pre><code>$ go test -run Test -covermode count -coverprofile cover.out\n</code></pre>\n\n<p>But that defeats the purpose of:</p>\n\n<ol>\n<li>Validating the Examples</li>\n<li>Drops code-coverage report from 97% down to 43%</li>\n</ol>\n\n<p>(yes, I use Examples as part of code coverage - part of a blog post I am trying to write, and to use Travis to show it.  but, uh, oops!  travis errors!)</p>\n\n<p>I suspect Travis is doing something funky with <code>stderr</code> and/or <code>stdout</code>, redirecting the output to the console/log which may prevent <code>go test</code> from seeing the results.</p>\n"}, {"tags": ["unit-testing", "go", "error-handling"], "comments": [{"owner": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "edited": false, "score": 1, "creation_date": 1555944762, "post_id": 42035104, "comment_id": 98261640, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/39121172/how-to-compare-golang-error-objects\">How to compare Golang error objects</a>"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "reply_to_user": {"reputation": 7876, "user_id": 2777965, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/tQaGa.png?s=128&g=1", "display_name": "030", "link": "https://stackoverflow.com/users/2777965/030"}, "edited": false, "score": 3, "creation_date": 1555987889, "post_id": 42035104, "comment_id": 98275502, "body": "I don&#39;t think this is a duplicate @030, as the other question is just about comparing errors. This question is about how to effectively compare errors <i>in unit tests</i>. These are not exactly the same questions, and my answer for them would differ."}], "answers": [{"tags": [], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "is_accepted": false, "score": 4, "last_activity_date": 1555943435, "last_edit_date": 1555943435, "creation_date": 1486175503, "answer_id": 42035849, "question_id": 42035104, "link": "https://stackoverflow.com/questions/42035104/how-to-unit-test-go-errors/42035849#42035849", "title": "How to unit test Go errors", "body": "<p>Yes I test my function that return the error and check it if the error message match. But it is up to you whether you want to check it or just check the error is not <code>nil</code>.</p>\n\n<p>suppose you have a function like this : </p>\n\n<pre><code>func returnSomeErr(input int)error{\n    if input &gt; 0{\n        return nil\n    }\n    return errors.New(\"this is error message\")\n}\n</code></pre>\n\n<p>you can unit test the error message like this : </p>\n\n<pre><code>// testing tot get error message\nfunc TestReturnSomeErr(t *testing.T){\n   Expected := \"this is error message\"\n   actual := returnSomeErr(-1)\n\n   if actual.Error() != Expected{\n        t.Errorf(\"Error actual = %v, and Expected = %v.\", actual, test.Expected)\n   }\n}\n</code></pre>\n\n<p>Notice that I'm using <code>.Error()</code> function to get the error message so that I can compare it to string. you can create another test to test if there was no error if the input data <code>&gt; 0</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1098, "user_id": 1751481, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh4.googleusercontent.com/-onO6tWUKzZQ/AAAAAAAAAAI/AAAAAAAAABg/T7_y-XIV7CU/photo.jpg?sz=128", "display_name": "GabeMeister", "link": "https://stackoverflow.com/users/1751481/gabemeister"}, "edited": false, "score": 1, "creation_date": 1486233247, "post_id": 42036847, "comment_id": 71261230, "body": "I do like the idea of using custom error types, that would definitely simplify things."}], "tags": [], "owner": {"reputation": 964, "user_id": 3184079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/819c77c230e755f43bfbbbb87429c046?s=128&d=identicon&r=PG&f=1", "display_name": "Omar", "link": "https://stackoverflow.com/users/3184079/omar"}, "is_accepted": true, "score": 19, "last_activity_date": 1486186179, "creation_date": 1486186179, "answer_id": 42036847, "question_id": 42035104, "link": "https://stackoverflow.com/questions/42035104/how-to-unit-test-go-errors/42036847#42036847", "title": "How to unit test Go errors", "body": "<p>In most cases you can just check if the error is not nil.</p>\n\n<p>I'd recommend not checking error strings unless absolutely necessary. I generally consider error strings to be only for human consumption.</p>\n\n<p>If you need more detail about the error, one better alternative is to have custom error types. Then you can do a switch over the err.(type) and see if it's a type you expect.\nIf you need even more detail, you can make the custom error types contain values which you can then check in a test.</p>\n\n<p>Go's error is just an interface for a type that has an <code>Error() string</code> method, so implementing them yourself is straightforward.\n<a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"noreferrer\">https://blog.golang.org/error-handling-and-go</a></p>\n"}, {"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": false, "score": 6, "last_activity_date": 1555988219, "creation_date": 1555988219, "answer_id": 55803656, "question_id": 42035104, "link": "https://stackoverflow.com/questions/42035104/how-to-unit-test-go-errors/55803656#55803656", "title": "How to unit test Go errors", "body": "<p>I often use this simple function to check errors:</p>\n\n<pre><code>// ErrorContains checks if the error message in out contains the text in\n// want.\n//\n// This is safe when out is nil. Use an empty string for want if you want to\n// test that err is nil.\nfunc ErrorContains(out error, want string) bool {\n    if out == nil {\n        return want == \"\"\n    }\n    if want == \"\" {\n        return false\n    }\n    return strings.Contains(out.Error(), want)\n}\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>if !ErrorContains(err, \"unexpected banana\") {\n    t.Errorf(\"unexpected error: %v\", err)\n}\n\nif !ErrorContains(err, \"\") {\n    t.Errorf(\"unexpected error: %v\", err)\n}\n</code></pre>\n\n<p>I find this especially useful in table-driven tests, as I can do something like:</p>\n\n<pre><code>tests := struct{\n    want    string\n    wantErr string\n}{\n    {\n        \"some output\",\n        \"\",  // No error expected\n    },\n    {\n        \"\",\n        \"out of coconuts\",\n    }\n}\n</code></pre>\n\n<p>It avoids mucking about with <code>nil</code>, <code>errors.New()</code>, and the like.</p>\n\n<p>I use <code>string.Contains()</code> instead of checking the full error as that's more robust. I just want to know if this is roughly the error I'm expecting (and not a completely unrelated one). I rarely check for the full error message, but use keywords instead (e.g. \"unexpected end\", \"not enough\", etc.)</p>\n\n<hr>\n\n<p>This function is part of the <a href=\"https://github.com/Teamwork/test/blob/7949982/test.go#L12-L25\" rel=\"noreferrer\">github.com/teamwork/test</a> package (I am the chief author of that), but I often just copy/paste it if I use only this function and none of the others in that package.</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 7291473, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef471625b2f095aca0629c059621f8d6?s=128&d=identicon&r=PG&f=1", "display_name": "Roel4811", "link": "https://stackoverflow.com/users/7291473/roel4811"}, "is_accepted": false, "score": 4, "last_activity_date": 1607618173, "creation_date": 1607618173, "answer_id": 65238600, "question_id": 42035104, "link": "https://stackoverflow.com/questions/42035104/how-to-unit-test-go-errors/65238600#65238600", "title": "How to unit test Go errors", "body": "<p>The testify <a href=\"https://godoc.org/github.com/stretchr/testify\" rel=\"nofollow noreferrer\">package</a> will come in handy.</p>\n<p>From the docs: &quot;EqualErrorf asserts that a function returned an error (i.e. not <code>nil</code>) and that it is equal to the provided error.&quot;:</p>\n<pre><code>assert.EqualErrorf(t, err, expectedErrorMsg, &quot;Error should be: %v, got: %v&quot;, expectedErrorMsg, err)\n</code></pre>\n<p>To assert that the error message contains a substring:</p>\n<pre><code>assert.Containsf(t, err.Error(), tt.wantErrMsg, &quot;expected error containing %q, got %s&quot;, tt.wantErrMsg, err)\n</code></pre>\n<blockquote>\n<p>t is of type <code>*testing.T</code> and <code>err</code> is of type <code>error</code></p>\n</blockquote>\n"}], "owner": {"reputation": 1098, "user_id": 1751481, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh4.googleusercontent.com/-onO6tWUKzZQ/AAAAAAAAAAI/AAAAAAAAABg/T7_y-XIV7CU/photo.jpg?sz=128", "display_name": "GabeMeister", "link": "https://stackoverflow.com/users/1751481/gabemeister"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28778, "favorite_count": 3, "accepted_answer_id": 42036847, "answer_count": 4, "score": 24, "last_activity_date": 1607618173, "creation_date": 1486167825, "last_edit_date": 1555944329, "question_id": 42035104, "link": "https://stackoverflow.com/questions/42035104/how-to-unit-test-go-errors", "title": "How to unit test Go errors", "body": "<p>When you are unit testing functions that have an <code>error</code> return type, I was wondering how to properly unit test for this error. Are you supposed to just check if the error is nil or not nil? Or are you supposed to verify the error string matches an expected string as well?</p>\n"}, {"tags": ["multithreading", "sockets", "go", "zeromq"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "edited": false, "score": 0, "creation_date": 1486186949, "post_id": 42036853, "comment_id": 71247881, "body": "But why the context object isn&#39;t thread (actually, routine) safe? Shouldn&#39;t it be?"}, {"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1486216293, "post_id": 42036853, "comment_id": 71255637, "body": "ZeroMQ (the C library&#39;s) socket implementation is not thread safe, because that&#39;s how it was built. To add, you&#39;re confusing between ZeroMQ context vs. sockets. Contexts are thread safe, where as the underlying sockets are not. You should be able to create and pass a context between your Goroutines without directly using the underlying socket."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "edited": false, "score": 0, "creation_date": 1486242144, "post_id": 42036853, "comment_id": 71264227, "body": "But a new context is created for each worker in the example I posted. Why, if contexts are thread safe?"}], "tags": [], "owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "is_accepted": false, "score": 0, "last_activity_date": 1486216122, "last_edit_date": 1486216122, "creation_date": 1486186234, "answer_id": 42036853, "question_id": 42034641, "link": "https://stackoverflow.com/questions/42034641/why-a-zeromq-context-is-not-being-shared-amongst-all-the-goroutines/42036853#42036853", "title": "Why a ZeroMQ Context is not being shared amongst all the goroutines?", "body": "<p>You can absolutely share objects between Goroutines, as long as those objects are threadsafe. The Go ZeroMQ bindings you are using is explicitly non-threadsafe. While a single Goroutine may not correspond to a single OS thread, it is not possible to guarantee that the Goroutines you spawn will live on the same OS thread. Their life cycle is managed dynamically by the Go run-time.</p>\n\n<p>You can \"share\" your ZeroMQ socket between multiple Goroutines by using <a href=\"https://golang.org/doc/effective_go.html#channels\" rel=\"nofollow noreferrer\">channels</a> to synchronize access, or by using <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\">mutexes</a>, where you lock access to your socket while a Goroutine is accessing it.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 3666197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79fc6c23061326c7e6a6f82a1663634b?s=128&d=identicon&r=PG", "display_name": "user3666197", "link": "https://stackoverflow.com/users/3666197/user3666197"}, "is_accepted": false, "score": 0, "last_activity_date": 1486409850, "last_edit_date": 1486409850, "creation_date": 1486409108, "answer_id": 42075704, "question_id": 42034641, "link": "https://stackoverflow.com/questions/42034641/why-a-zeromq-context-is-not-being-shared-amongst-all-the-goroutines/42075704#42075704", "title": "Why a ZeroMQ Context is not being shared amongst all the goroutines?", "body": "<h2>Q: why isn't the context shared between goroutines?<sup> ( in the example )</sup></h2>\n\n<p>Besides the <sub>( rather extremist )</sub> technical option to indeed share a Context instance ( under some well justified circumstances / occassions ), the demonstrated piece of code has focused on a <strong>Zero-Sharing, as a general principle</strong>, the one of a few Zero-Maxims, the ZeroMQ is so well known for.</p>\n\n<p>There are advantages of a habit to employ a group of disjunct <strong><code>Context</code></strong> instances ( which one may also have several of these, within the same thread, on purpose ). The performance scaling:</p>\n\n<ul>\n<li><p>in a wide meaning, the separation of workloads, among instances</p></li>\n<li><p>in a narrower meaning, a direct IO-thread scaling ( defining different number of IO-threads upon the Context instantiation, some having just 1 IO-thread, whereas other may have 2, 3 or 10 IO-threads for a high-performance Data-pumping engine ) and using a bit-mask mapping via a <strong><code>setsockopt( ZMQ_AFFINITY ... )</code></strong>-based socket-to-IO-threads mapping, which allows to directly separate some transport-tasks onto different, discjunct  <strong><code>Context</code></strong>-instances, and also to more specifically handle different transport-traffic priority-modes, right by using the separate, specialised groups of <strong><code>Context</code></strong>-instances' IO-threads ( naturally, where knowingly equipped with more and different amounts of underlying ZeroMQ <code>Context</code>'s IO-threads ). This is an invaluable feature for performance scaling and almost-deterministic traffic-policy handling implementations.</p></li>\n</ul>\n\n<p>This may inspire your further thought on how such fine-grained management ( granularity ) may help your distributed applications better harness the ZeroMQ framework's services and how this Zero-Sharing concept opens you the new worlds of performance scaling and throughput throttling.</p>\n\n<p>If in doubts, just notice the inital remark in the source code:</p>\n\n<pre><code>...\n// Uses Goroutines.  We could also use channels (a native form of\n// inproc), but I stuck to the example.\n...\n</code></pre>\n\n<p>The <strong><code>inproc://</code></strong> transport class is the clear example on how to benefit from the non-shared, non-blocking Context-instance and enjoy the almost linear scale-up, up to the peak performance.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6791424"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 530, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1486409850, "creation_date": 1486164612, "last_edit_date": 1592644375, "question_id": 42034641, "link": "https://stackoverflow.com/questions/42034641/why-a-zeromq-context-is-not-being-shared-amongst-all-the-goroutines", "title": "Why a ZeroMQ Context is not being shared amongst all the goroutines?", "body": "<p>In this <a href=\"http://zguide.zeromq.org/go:mtserver\" rel=\"nofollow noreferrer\">ZeroMQ example</a>,</p>\n<pre><code>// Multithreaded Hello World server.\n// Uses Goroutines.  We could also use channels (a native form of\n// inproc), but I stuck to the example.\n//\n// Author:  Brendan Mc.\n// Requires: http://github.com/alecthomas/gozmq\n\npackage main\n\nimport (\n    &quot;fmt&quot;\n    zmq &quot;github.com/alecthomas/gozmq&quot;\n    &quot;time&quot;\n)\n\nfunc main() {\n    // Launch pool of worker threads\n    for i := 0; i != 5; i = i + 1 {\n        go worker()\n    }\n\n    // Prepare our context and sockets\n    context, _ := zmq.NewContext()\n    defer context.Close()\n\n    // Socket to talk to clients\n    clients, _ := context.NewSocket(zmq.ROUTER)\n    defer clients.Close()\n    clients.Bind(&quot;tcp://*:5555&quot;)\n\n    // Socket to talk to workers\n    workers, _ := context.NewSocket(zmq.DEALER)\n    defer workers.Close()\n    workers.Bind(&quot;ipc://workers.ipc&quot;)\n\n    // connect work threads to client threads via a queue\n    zmq.Device(zmq.QUEUE, clients, workers)\n\n}\n\nfunc worker() {\n    context, _ := zmq.NewContext()\n    defer context.Close()\n\n    // Socket to talk to dispatcher\n    receiver, _ := context.NewSocket(zmq.REP)\n    defer receiver.Close()\n    receiver.Connect(&quot;ipc://workers.ipc&quot;)\n\n    for true {\n        received, _ := receiver.Recv(0)\n        fmt.Printf(&quot;Received request [%s]\\n&quot;, received)\n\n        // Do some 'work'\n        time.Sleep(time.Second)\n\n        // Send reply back to client\n        receiver.Send([]byte(&quot;World&quot;), 0)\n    }\n}\n</code></pre>\n<p>each goroutine has its own ZeroMQ <strong><code>Context</code></strong>. However, in the <a href=\"http://zguide.zeromq.org/page:all#Multithreading-with-ZeroMQ\" rel=\"nofollow noreferrer\">ZeroMQ guide</a>, it says the following:</p>\n<blockquote>\n<p>Create one ZeroMQ context at the start of your process, and pass that\nto all threads that you want to connect via inproc sockets.</p>\n<p>Don't share ZeroMQ sockets between threads. ZeroMQ sockets are not\nthreadsafe. Technically it's possible to migrate a socket from one\nthread to another but it demands skill. The only place where it's\nremotely sane to share sockets between threads are in language\nbindings that need to do magic like garbage collection on sockets.</p>\n</blockquote>\n<p>I know that goroutines are not threads.</p>\n<p>Instead, they live in threads. But I've also read that it's possible to have a shared object between goroutines.</p>\n<p>So, <strong>why doesn't the context is shared between goroutines?</strong></p>\n<p>I think it'd consume a lot less space, because a context with a socket in it might be kinda big.</p>\n<p>But even if it's not that consuming, <strong>why at all the context is not shared in this example?</strong></p>\n"}, {"tags": ["go", "race-condition"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1486166064, "last_edit_date": 1486166064, "creation_date": 1486162786, "answer_id": 42034367, "question_id": 42034178, "link": "https://stackoverflow.com/questions/42034178/data-race-when-reading-field-from-struct-value-passed-by-value/42034367#42034367", "title": "Data race when reading field from struct value passed by value", "body": "<p>The race is because of the value receiver for the <code>get()</code> method. In order to call the <code>get()</code> method, a copy of the struct must be passed to the method expression. The method call without the syntactic sugar looks like:</p>\n\n<pre><code>value := Counter.get(*counter)\n</code></pre>\n\n<p>Copying the struct entails reading the <code>value</code> field, which happens before the method can take the lock, which is why the race is reported on the line of the method call, rather than within the method.</p>\n\n<p>This is why changing the receiver to a pointer receiver will fix the issue. Also, since all receivers need to be pointers, the <code>mtx</code> can be left as a <code>sync.Mutex</code> value so it doesn't need to be initialized. </p>\n"}, {"tags": [], "owner": {"reputation": 36, "user_id": 3056512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00e00d6316d600b22d61669aa7c785ea?s=128&d=identicon&r=PG&f=1", "display_name": "rbh", "link": "https://stackoverflow.com/users/3056512/rbh"}, "is_accepted": false, "score": 1, "last_activity_date": 1486198324, "creation_date": 1486198324, "answer_id": 42038391, "question_id": 42034178, "link": "https://stackoverflow.com/questions/42034178/data-race-when-reading-field-from-struct-value-passed-by-value/42038391#42038391", "title": "Data race when reading field from struct value passed by value", "body": "<p>As @JimB points out, in the case of the <code>get()</code> method a copy is passed in which case\nthe field value is read first and then copied, without any locking and since the\nsame variable is mutated in <code>inc()</code>, the race is detected.</p>\n\n<p>To further illustrate this point, you could also change the type of the field <code>value</code>\nto a pointer i.e. <code>value *int</code> in which case you should no longer see a race as now\nonly the pointer is copied and not the underlying value. That said, to make intentions\nclearer, it is cleaner to change the <code>get()</code> receiver type to be a pointer.</p>\n\n<p>Here is a good wiki around the same - <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#receiver-type\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/CodeReviewComments#receiver-type</a></p>\n\n<p>A brief commentary on methods:\n<a href=\"https://golang.org/ref/spec#Method_values\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Method_values</a></p>\n"}], "owner": {"reputation": 615, "user_id": 1325109, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/503cdb1e62fb2c8e86674c23b394e298?s=128&d=identicon&r=PG&f=1", "display_name": "dmgcodevil", "link": "https://stackoverflow.com/users/1325109/dmgcodevil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 774, "favorite_count": 0, "accepted_answer_id": 42034367, "answer_count": 2, "score": 3, "last_activity_date": 1486198324, "creation_date": 1486161704, "last_edit_date": 1486162633, "question_id": 42034178, "link": "https://stackoverflow.com/questions/42034178/data-race-when-reading-field-from-struct-value-passed-by-value", "title": "Data race when reading field from struct value passed by value", "body": "<p>Why does golang race detector complains about the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype Counter struct {\n    value int\n    mtx     *sync.Mutex\n}\n\nfunc NewCounter() *Counter {\n    return &amp;Counter {0, &amp;sync.Mutex{}}\n}\n\nfunc (c *Counter) inc() {\n    c.mtx.Lock()\n    c.value++\n    c.mtx.Unlock()\n}\n\nfunc (c Counter) get() int {\n    c.mtx.Lock()\n    res := c.value\n    c.mtx.Unlock()\n    return res\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    counter := NewCounter()\n    max := 100\n    wg.Add(max)\n\n    // consumer\n    go func() {\n        for i := 0; i &lt; max ; i++ {\n            value := counter.get()\n            fmt.Printf(\"counter value = %d\\n\", value)\n            wg.Done()\n        }\n    }()\n    // producer\n    go func() {\n        for i := 0; i &lt; max ; i++ {\n            counter.inc()\n        }\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>When I run the code above with <code>-race</code> I'm getting the following warnings:</p>\n\n<pre><code>==================\nWARNING: DATA RACE\nRead at 0x00c0420042b0 by goroutine 6:\n  main.main.func1()\n      main.go:39 +0x72\n\nPrevious write at 0x00c0420042b0 by goroutine 7:\n  main.(*Counter).inc()\n      main.go:19 +0x8b\n  main.main.func2()\n      main.go:47 +0x50\n\nGoroutine 6 (running) created at:\n  main.main()\n      main.go:43 +0x167\n\nGoroutine 7 (running) created at:\n  main.main()\n      main.go:49 +0x192\n==================\n</code></pre>\n\n<p>If I change <code>func (c Counter) get() int</code> to <code>func (c *Counter) get() int</code> then everything is working fine. It turns out that the receiver type for <code>get()</code> function should be a pointer. And I'm confused why that is. I'm aware of \"-copylocks\" but in this case <code>mtx</code> is a pointer, not value. If I change 'mtx' to be value and run program with <code>vet -copylocks</code> I get this warning:</p>\n\n<blockquote>\n  <p>main.go:23: get passes lock by value: main.Counter contains sync.Mutex`</p>\n</blockquote>\n\n<p>That makes sense.</p>\n\n<p><em>note:</em> This question is not about how to implement thread safe counter</p>\n\n<p><a href=\"https://play.golang.org/p/di_OywyU9z\" rel=\"nofollow noreferrer\">link to playground code</a></p>\n"}, {"tags": ["amazon-web-services", "go", "https", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 7430005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9ARcB.jpg?s=128&g=1", "display_name": "WeldPad", "link": "https://stackoverflow.com/users/7430005/weldpad"}, "edited": false, "score": 0, "creation_date": 1486159091, "post_id": 42033587, "comment_id": 71241847, "body": "I have also tried it and the responce was: wsconnect.html WebSocket connection to &#39;wss://www.weldpad.com/wss&#39; failed: Error during WebSocket handshake: Unexpected response code: 400"}, {"owner": {"reputation": 137816, "user_id": 13070, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/pio3A.jpg?s=128&g=1", "display_name": "Mark B", "link": "https://stackoverflow.com/users/13070/mark-b"}, "reply_to_user": {"reputation": 23, "user_id": 7430005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9ARcB.jpg?s=128&g=1", "display_name": "WeldPad", "link": "https://stackoverflow.com/users/7430005/weldpad"}, "edited": false, "score": 0, "creation_date": 1486163512, "post_id": 42033587, "comment_id": 71243318, "body": "Well that&#39;s a much better error message. It&#39;s getting a response from the server. Now you need to look at your server, maybe examine the server logs, and see why it is returning a 400 code."}, {"owner": {"reputation": 23, "user_id": 7430005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9ARcB.jpg?s=128&g=1", "display_name": "WeldPad", "link": "https://stackoverflow.com/users/7430005/weldpad"}, "edited": false, "score": 0, "creation_date": 1486196852, "post_id": 42033587, "comment_id": 71250006, "body": "Looking at the log, I found &quot;websocket: could not find upgrade header with token &#39;websocket&#39;&quot;, I am looking into it."}, {"owner": {"reputation": 23, "user_id": 7430005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9ARcB.jpg?s=128&g=1", "display_name": "WeldPad", "link": "https://stackoverflow.com/users/7430005/weldpad"}, "edited": false, "score": 0, "creation_date": 1486321066, "post_id": 42033587, "comment_id": 71284240, "body": "Found it, I was missing a load balancer mapping for tcp, mapping is SSL to tcp, once I enabled it, everything worked, thanks Mark, Your comment focused me on the problem."}], "tags": [], "owner": {"reputation": 137816, "user_id": 13070, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/pio3A.jpg?s=128&g=1", "display_name": "Mark B", "link": "https://stackoverflow.com/users/13070/mark-b"}, "is_accepted": true, "score": 1, "last_activity_date": 1486158711, "creation_date": 1486158711, "answer_id": 42033587, "question_id": 42033358, "link": "https://stackoverflow.com/questions/42033358/create-websocket-using-golang-in-aws/42033587#42033587", "title": "Create websocket using golang in aws", "body": "<p>I believe it should be <code>wss://www.weldpad.com/wss?</code> not <code>wss://https://www.weldpad.com/wss?</code></p>\n"}], "owner": {"reputation": 23, "user_id": 7430005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9ARcB.jpg?s=128&g=1", "display_name": "WeldPad", "link": "https://stackoverflow.com/users/7430005/weldpad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 619, "favorite_count": 0, "accepted_answer_id": 42033587, "answer_count": 1, "score": 1, "last_activity_date": 1486203218, "creation_date": 1486157700, "last_edit_date": 1486203218, "question_id": 42033358, "link": "https://stackoverflow.com/questions/42033358/create-websocket-using-golang-in-aws", "title": "Create websocket using golang in aws", "body": "<p>I am trying to create websockets using golang with gorilla on aws (without docker) with load balancer, I have a certificate connected to the load balancer.</p>\n\n<p>I managed to make the code work with http, but when I try to use the code over https it does not work.</p>\n\n<p>What am I doing wrong?\nWhen moving from http to https I changed the client request to wss instead of ws, and added the certificate to the load balancer.\nHere is my code.\nThis is my main.go</p>\n\n<pre><code>    http.HandleFunc(\"/wss\", serveWs)\n\nfmt.Printf(\"Listening on port %s\\n\\n\", port)\n\n\nif err := http.ListenAndServe(\":\"+port, nil); err != nil {\n    fmt.Printf(err.Error())\n}\n</code></pre>\n\n<p>This is the serveWs:</p>\n\n<pre><code>func serveWs(w http.ResponseWriter, r *http.Request) {\nupgrader.CheckOrigin = func(r *http.Request) bool {\n    // allow all connections by default\n    return true\n}\n\nws, err := upgrader.Upgrade(w, r, nil)\nif err != nil {\n    fmt.Println(err)\n    if _, ok := err.(websocket.HandshakeError); !ok {\n        log.Println(err)\n    }\n    return\n}\n\nvar lastMod time.Time\n\nif n, err := strconv.ParseInt(r.FormValue(\"lastMod\"), 16, 64); err != nil {\n    lastMod = time.Unix(0, n)\n}\n\ngo writer(ws, lastMod, w, r)\nreader(ws)\n</code></pre>\n\n<p>}</p>\n\n<p>This is the request:</p>\n\n<pre><code> var conn = new WebSocket(\"wss://https://www.weldpad.com/wss?\" \n</code></pre>\n\n<p>When I send a request from the client i get the folloing error:</p>\n\n<p>failed: Error during WebSocket handshake: Unexpected response code: 400 </p>\n\n<p>Looking at the server log, I see.</p>\n\n<p>\"could not find upgrade header with token 'websocket\"</p>\n\n<p>This is my load balancer configuration:</p>\n\n<p><a href=\"https://i.stack.imgur.com/T7jO9.jpg\" rel=\"nofollow noreferrer\">Load Balancing Configuration</a></p>\n"}, {"tags": ["debugging", "curl", "go", "jetbrains-ide", "goland"], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 2, "last_activity_date": 1486208390, "creation_date": 1486208390, "answer_id": 42039932, "question_id": 42033247, "link": "https://stackoverflow.com/questions/42033247/debugger-configuration-in-gogland/42039932#42039932", "title": "Debugger configuration in GoGland", "body": "<p>I've made a short video of how debugging works in Gogland and how it should be configured: <a href=\"https://youtu.be/tT0Op-DYs4s\" rel=\"nofollow noreferrer\">https://youtu.be/tT0Op-DYs4s</a>.</p>\n\n<p>In place of the Println you can have your usual api handler and then just run the curl command against your API as usual, as long as you run this with the debugging configuration.</p>\n"}], "owner": {"reputation": 387, "user_id": 4160072, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh4.googleusercontent.com/-87BjCfblqW4/AAAAAAAAAAI/AAAAAAAAAuU/96eymOXkgvs/photo.jpg?sz=128", "display_name": "Mohammed", "link": "https://stackoverflow.com/users/4160072/mohammed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2027, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1486208390, "creation_date": 1486157161, "last_edit_date": 1495540447, "question_id": 42033247, "link": "https://stackoverflow.com/questions/42033247/debugger-configuration-in-gogland", "title": "Debugger configuration in GoGland", "body": "<p>I want to debug my go application when I send request using curl command.</p>\n\n<p>Currently my request is handled by the binary I have. \nWhat I want that when I send request using curl command request should be handled by the code I have not by the binary.</p>\n\n<p>I did not find any documentation about it, only found this <a href=\"https://stackoverflow.com/questions/41592892/how-to-set-up-debugging-in-gogland\">this</a>which is still unanswered.</p>\n\n<p>@Zoyd did you found a way to configure it?</p>\n"}]