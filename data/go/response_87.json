[{"tags": ["go", "orm", "sqlite"], "comments": [{"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "edited": false, "score": 1, "creation_date": 1473289496, "post_id": 39379928, "comment_id": 66088349, "body": "your function signature of <code>Value()</code> is <code>(driver.Value, error)</code> and returned values are <code>int(u), nil</code> &lt;-- are they absolutely matched? Or you need a cast?"}, {"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "reply_to_user": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "edited": false, "score": 0, "creation_date": 1473351901, "post_id": 39379928, "comment_id": 66117954, "body": "Thanks for the pointer, <code>nil</code> is definitely matched with <code>error</code> for sure, so I just looked into the go/sql/driver and driver.Value seems only to support <code>int64</code>, <code>float64</code>, <code>bool</code>, <code>string</code> type."}], "answers": [{"comments": [{"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "edited": false, "score": 0, "creation_date": 1473363350, "post_id": 39396083, "comment_id": 66123769, "body": "You should accept your own answer so others having the same situation will know where to look at."}, {"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "reply_to_user": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "edited": false, "score": 0, "creation_date": 1473363654, "post_id": 39396083, "comment_id": 66123957, "body": "kk, thx. Stackoverflow prohibits user accepting their own answer <a href=\"http://meta.stackexchange.com/a/166887/320042\">within 48 hours since original posting.</a>"}], "tags": [], "owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "is_accepted": true, "score": 11, "last_activity_date": 1473363448, "last_edit_date": 1473363448, "creation_date": 1473352156, "answer_id": 39396083, "question_id": 39379928, "link": "https://stackoverflow.com/questions/39379928/golang-save-enum-type-to-sql-database-panic-sql-converting-exec-argument-1/39396083#39396083", "title": "golang - Save enum type to SQL database &quot;panic: sql: converting Exec argument #1&#39;s type: non-Value type int returned from Value&quot;", "body": "<p>According to <a href=\"https://golang.org/pkg/database/sql/\" rel=\"noreferrer\">current database/sql docs</a>, the <code>sql</code> has four builtin functions that returns <code>driver.Value</code>, and the underlying types are <code>int64</code>, <code>float64</code>, <code>string</code> and <code>bool</code>. So I guess that's the only four types supported.</p>\n\n<p>I just changed the underlying type of my enum from <code>int</code> to <code>int64</code> and things are working.</p>\n\n<p>The problematic section is updated to the following snippet:</p>\n\n<pre><code>// Platform Type enumeration\ntype PlatformType int64\nconst (\n    PLATFORM_TYPE_NOT_A_VALUE PlatformType = iota\n    PLATFORM_TYPE_TYPE1\n    PLATFORM_TYPE_TYPE2 \n)\n\nvar types = [...]string {\n    \"Not a type\",\n    \"Type1\",\n    \"Type2\",\n}\n\nfunc (platform_type PlatformType) String() string {\n    return types[platform_type]\n}\n\nfunc (u *PlatformType) Scan(value interface{}) error { *u = PlatformType(value.(int64)); return nil }\nfunc (u PlatformType) Value() (driver.Value, error)  { return int64(u), nil }\n</code></pre>\n"}], "owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7156, "favorite_count": 3, "accepted_answer_id": 39396083, "answer_count": 1, "score": 2, "last_activity_date": 1473363448, "creation_date": 1473287249, "question_id": 39379928, "link": "https://stackoverflow.com/questions/39379928/golang-save-enum-type-to-sql-database-panic-sql-converting-exec-argument-1", "title": "golang - Save enum type to SQL database &quot;panic: sql: converting Exec argument #1&#39;s type: non-Value type int returned from Value&quot;", "body": "<p>In my current go project (~5K LOC), I am using sqlite3 as my underlying database layer, and I am using gorm as my ORM engine. One of the models is a <code>Platform</code> with a field of <code>PlatformType</code> enum type. Here's a code snippet to demonstrate my problem.</p>\n\n<pre><code>package main\n\nimport (\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n    \"github.com/jinzhu/gorm\"\n    \"database/sql/driver\"\n    \"fmt\"\n)\n\n/****************************\\\n    Object Layer\n\\****************************/\n\n// Platform ID \ntype PlatformID string\n\nfunc (u *PlatformID) Scan(value interface{}) error { *u = PlatformID(value.([]byte)); return nil }\nfunc (u PlatformID) Value() (driver.Value, error)  { return string(u), nil }\n\n// Platform Type enumeration\ntype PlatformType int\nconst (\n    PLATFORM_TYPE_NOT_A_VALUE PlatformType = iota\n    PLATFORM_TYPE_TYPE1\n    PLATFORM_TYPE_TYPE2 \n)\n\nvar types = [...]string {\n    \"Not a type\",\n    \"Type1\",\n    \"Type2\",\n}\n\nfunc (platform_type PlatformType) String() string {\n    return types[platform_type]\n}\n\nfunc (u *PlatformType) Scan(value interface{}) error { *u = PlatformType(value.(int)); return nil }\nfunc (u PlatformType) Value() (driver.Value, error)  { return int(u), nil }\n\n// Platform descriptor.\ntype Platform struct {\n    ID              PlatformID          `json:\"ID\" gorm:\"type:varchar(100);unique;not null\"`                // Assigned by LCBO.\n    Type            PlatformType        `json:\"Type\" gorm:\"type:integer\"`   \n}\n\ntype PlatformStore interface {\n    Init() error\n    Save(platform *Platform) error\n}\n\n/****************************\\\n    Persist Layer\n\\****************************/\nfunc NewSqlite3Store(dbname string) *gorm.DB {\n    db, err := gorm.Open(\"sqlite3\", dbname)\n    if err != nil {\n        panic(\"failed to connect database\")\n    }\n    return db\n}\n\ntype DBPlatformStore struct {\n    db *gorm.DB\n}\n\nfunc NewDBPlatformStore(db *gorm.DB) PlatformStore {\n    return &amp;DBPlatformStore{\n        db: db,\n    }\n}\n\nfunc (store *DBPlatformStore) Init() error {\n    err := store.db.AutoMigrate(&amp;Platform{}).Error\n    if err != nil {\n        panic(err)\n    }\n    return err\n}\n\nfunc (store *DBPlatformStore) Save(platform *Platform) error {\n    err := store.db.Create(platform).Error\n    if err != nil {\n        panic(err)\n    }\n    return err\n}\n\n/****************************\\\n    Application Layer\n\\****************************/\nfunc main() {\n    db := NewSqlite3Store(\"enum_test.db\")\n    platformStore := NewDBPlatformStore(db)\n\n    fmt.Println(\"Initialize Database\")\n    err := platformStore.Init()\n    if err != nil {\n        panic(err)\n    }\n\n    platform := new(Platform)\n    platform.ID = \"12345\"\n    platform.Type = PLATFORM_TYPE_TYPE1\n\n    platformStore.Save(platform)\n}\n</code></pre>\n\n<p>After running the code above, I got a runtime error \"sql: converting Exec argument #1's type: non-Value type int returned from Value\"</p>\n\n<pre><code>]# go run enumtest.go\nInitialize Database\npanic: sql: converting Exec argument #1's type: non-Value type int returned from Value\n\ngoroutine 1 [running]:\npanic(0x66d380, 0xc8203ae350)\n        /*/panic.go:481 +0x3e6\nmain.(*DBPlatformStore).Save(0xc820020b20, 0xc820304500, 0x0, 0x0)\n        /*/enumtest.go:84 +0x9f\nmain.main()\n        /*/enumtest.go:106 +0x247\nexit status 2\n</code></pre>\n\n<p>And I checked my database, the <code>platforms</code> table has been created successfully.</p>\n\n<pre><code>]# sqlite3 enum_test.db\nsqlite&gt; .schema platforms\nCREATE TABLE \"platforms\" (\"id\" varchar(100) NOT NULL UNIQUE,\"type\" integer , PRIMARY KEY (\"id\"));\n</code></pre>\n\n<p>The (not-so) trivial question is <strong>how do I modify my code so that I can correctly save the entry to database</strong>.</p>\n\n<p>My bigger question is: <strong>How to save a customized GO enum type to a sql database?</strong>(with a ORM engine hopefully)</p>\n"}, {"tags": ["macos", "go", "compilation", "macos-sierra"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1473284950, "post_id": 39379295, "comment_id": 66086918, "body": "I&#39;m not sure what exactly is causing the breakage, but OS X is only supported for versions 10.7 and up."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6895304, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/d35aa1e5169196f23758805b6458626f?s=128&d=identicon&r=PG", "display_name": "Scott Weston", "link": "https://stackoverflow.com/users/6895304/scott-weston"}, "is_accepted": false, "score": 0, "last_activity_date": 1475083730, "creation_date": 1475083730, "answer_id": 39754071, "question_id": 39379295, "link": "https://stackoverflow.com/questions/39379295/golang-dyld-symbol-not-found-seccertificatecopynormalizedsubjectcontent/39754071#39754071", "title": "Golang: dyld: Symbol not found: _SecCertificateCopyNormalizedSubjectContent", "body": "<p>I had a problem where a perl module built successfully, but subsequently threw that 'dyld:' error. After getting a concussion from pounding my head into a brick wall for a day or two, I discovered that the perl module, which was 32-bit, attempted to dynamically link to a dylib that was 64-bit. Tweaking the perl module to compile as 64-bit resolved this problem. </p>\n\n<p>Upshot: this could be a 32-bit program attempting to 'talk' to a 64-bit dylib.</p>\n"}], "owner": {"reputation": 437, "user_id": 1922771, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/UTA6Q.jpg?s=128&g=1", "display_name": "Javier Carmona", "link": "https://stackoverflow.com/users/1922771/javier-carmona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 467, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1475083730, "creation_date": 1473283819, "question_id": 39379295, "link": "https://stackoverflow.com/questions/39379295/golang-dyld-symbol-not-found-seccertificatecopynormalizedsubjectcontent", "title": "Golang: dyld: Symbol not found: _SecCertificateCopyNormalizedSubjectContent", "body": "<p>I am building a Golang 1.7 (<code>go version go1.7 darwin/amd64</code>) application from OSX 10.12 Beta (16A312a) by running this command\n<code>env GOOS=darwin GOARCH=amd64 /usr/local/go/bin/go build -ldflags=-s -o dist/program ${GOPATH}src/github.com/owner/repo/program.go</code></p>\n\n<p>The program seems to run successfully on OSX 10.7 and above but it breaks in 10.6.8 with the following error:</p>\n\n<p><code>dyld: Symbol not found: _SecCertificateCopyNormalizedSubjectContent\n  Referenced from: /tmp/program\n  Expected in: flat namespace</code></p>\n\n<p>I used to compile this same program from OSX 10.11 and it would work on 10.6 and above.</p>\n\n<p>Any help?\nThanks</p>\n"}, {"tags": ["encryption", "go", "aes"], "comments": [{"owner": {"reputation": 14671, "user_id": 2317490, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ypoen.png?s=128&g=1", "display_name": "dandavis", "link": "https://stackoverflow.com/users/2317490/dandavis"}, "edited": false, "score": 0, "creation_date": 1473425936, "post_id": 39378051, "comment_id": 66148519, "body": "you can encrypt each block with GCM. it&#39;s not as efficient as a stream, but it works and will probably be &quot;fast enough&quot; these days."}], "answers": [{"comments": [{"owner": {"reputation": 8494, "user_id": 1103966, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0fb92143734ac26c56fca34c669cd99a?s=128&d=identicon&r=PG", "display_name": "Dr.Knowitall", "link": "https://stackoverflow.com/users/1103966/dr-knowitall"}, "edited": false, "score": 1, "creation_date": 1522361842, "post_id": 39380108, "comment_id": 86139970, "body": "I need GCM streams."}], "tags": [], "owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "is_accepted": false, "score": 6, "last_activity_date": 1473288425, "creation_date": 1473288425, "answer_id": 39380108, "question_id": 39378051, "link": "https://stackoverflow.com/questions/39378051/making-gcm-cbc-ciphers-streamable-in-golang/39380108#39380108", "title": "Making GCM/CBC ciphers streamable in golang", "body": "<p>Simple answer - that's how they designed the API.</p>\n\n<p>CBC and GCM are very different modes. GCM is AEAD mode (Authenticated Encryption with Associated Data). Do you actually need authentication? If not, for large files CBC is a good fit. You could also use CTR or OFB but they're streaming modes and are very strict about choosing an IV.</p>\n\n<p>Before implementing anything I suggest you read about these modes. You have to at least understand, which parameters they need, for what purpose and how they should be generated.</p>\n\n<h2>CBC</h2>\n\n<p><code>BlockMode</code> interface is a good fit for encrypting large files. You just need to encrypt block by block. CBC requires padding, but Go doesn't have the implementation. At least, I don't see one. You will have to deal with that somehow.</p>\n\n<h2>GCM</h2>\n\n<p>GCM uses <code>AEAD</code> interface, which only allows you to encrypt and decrypt a whole message. There is absolutely no reason why it should be implemented like that. GCM is a streaming mode, it's actually a good fit for streaming encryption. The only problem is authentication. GCM produces a tag at the end, which acts like a MAC. To make use of that tag you can't just encrypt an endless stream of data. You have to split it into chunks and authenticate them separately. Or do something else but at some point you have to read that tag and verify it, otherwise there's no point in using GCM.</p>\n\n<p>What some libraries do, including Go, is they append that tag at the end implicitly on encryption and read and verify it on decryption. Personally, I think that's a very bad design. Tag should be available as a separate entity, you can't just assume that it will always be at the end. And that's not the only one of the problems in Go implementation. \nSorry for that rant. Recently I've dealt with a particulary bad implementation.</p>\n\n<p>As a solution I suggest you split your stream into chunks and encrypt them separately with a unique nonce (that's very important). Each chunk will have a tag at the end, which you should verify. That way you can make use of GCM authentication. Yes, it's kind of ugly but Go doesn't give you access to inner methods, so that you could make your own encryption API. </p>\n\n<p>As an alternative you could find a different implementation. Maybe even a C library. I can suggest mbedtls. For me, it's the best implementation I came across in terms of API.</p>\n"}, {"tags": [], "owner": {"reputation": 8684, "user_id": 410747, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/4939d91065321d68191a16481ccbd9f2?s=128&d=identicon&r=PG", "display_name": "netbrain", "link": "https://stackoverflow.com/users/410747/netbrain"}, "is_accepted": false, "score": 2, "last_activity_date": 1570190765, "creation_date": 1570190765, "answer_id": 58236105, "question_id": 39378051, "link": "https://stackoverflow.com/questions/39378051/making-gcm-cbc-ciphers-streamable-in-golang/58236105#58236105", "title": "Making GCM/CBC ciphers streamable in golang", "body": "<p>Heres a stream implementation for reading from a BlockMode. Your mileage may vary.</p>\n\n<pre><code>type BlockReader struct {\n    buf   []byte\n    block cipher.BlockMode\n    in    io.Reader\n}\n\nfunc NewBlockReader(blockMode cipher.BlockMode,reader io.Reader) *BlockReader {\n    return &amp;BlockReader{\n        block: blockMode,\n        in:    reader,\n    }\n}\n\nfunc (b *BlockReader) Read(p []byte) (n int, err error) {\n    toRead := len(p)\n    mul := toRead/b.block.BlockSize()\n    size := mul*b.block.BlockSize()\n    if cap(b.buf) != size{\n        b.buf = make([]byte,toRead,toRead)\n    }\n\n    read, err := b.in.Read(b.buf)\n    if err != nil {\n        return 0,err\n    }\n\n    if read &lt; b.block.BlockSize(){\n        return 0,io.ErrUnexpectedEOF\n    }\n    b.block.CryptBlocks(b.buf,b.buf)\n    return copy(p,b.buf),nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1554, "favorite_count": 3, "answer_count": 2, "score": 3, "last_activity_date": 1570190765, "creation_date": 1473278166, "question_id": 39378051, "link": "https://stackoverflow.com/questions/39378051/making-gcm-cbc-ciphers-streamable-in-golang", "title": "Making GCM/CBC ciphers streamable in golang", "body": "<p>The GCM and CBC AES ciphers in Go can't be used along side with StreamWriter or StreamReader, which forces me to allocate the entire file into memory. Obviously, this is not ideal with large files.</p>\n\n<p>I was thinking of making them streamable, by allocation some fixed size of blocks into memory, and feeding them to GCM or CBC, but I'm assuming that is probably a bad idea, since there must be a reason they've been designed this way.</p>\n\n<p>Can someone explain why these operation modes can't be used without allocating the entire files into memory?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1473272577, "post_id": 39376566, "comment_id": 66081447, "body": "While there <i>are</i> ways to do this in Go, and perhaps there are valid use cases, I would recommend <i>not</i> doing this. It looks like you&#39;re trying to translate your Ruby knowledge and experience to Go, and this probably isn&#39;t a good idea. Go&#39;s typing is different from Ruby&#39;s, and requires a different way of thinking and programming."}, {"owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1473272660, "post_id": 39376566, "comment_id": 66081482, "body": "@Carpetsmoker thanks, I see what you mean, but I just wanna to know Go ability"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1473318854, "post_id": 39376566, "comment_id": 66096463, "body": "If you are new to Go: Maybe it would be helpful to stick to &quot;proper&quot;, safe and idiomatic Go and leave the borders of the Go universe unexplored for a few months?"}], "answers": [{"comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1473271996, "post_id": 39376629, "comment_id": 66081215, "body": "&quot;now you need to use type switches access elements&quot; What you have there isn&#39;t a &quot;type switch&quot;; it&#39;s a type assertion."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1473273275, "post_id": 39376629, "comment_id": 66081762, "body": "@Tim: fixed. Thanks"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 1, "creation_date": 1473277098, "post_id": 39376629, "comment_id": 66083557, "body": "To be precise it&#39;s a slice of same type - interface{}, not an array with different types elements."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 7, "last_activity_date": 1473273251, "last_edit_date": 1473273251, "creation_date": 1473271853, "answer_id": 39376629, "question_id": 39376566, "link": "https://stackoverflow.com/questions/39376566/build-array-with-different-types/39376629#39376629", "title": "Build array with different types", "body": "<p>You can do this by making a slice of <code>interface{}</code> type. For example:</p>\n\n<pre><code>func main() {\n    arr := []interface{}{1, 2, \"apple\", true}\n    fmt.Println(arr)\n\n    // however, now you need to use type assertion access elements\n    i := arr[0].(int)\n    fmt.Printf(\"i: %d, i type: %T\\n\", i, i)\n\n    s := arr[2].(string)\n    fmt.Printf(\"b: %s, i type: %T\\n\", s, s)\n}\n</code></pre>\n\n<p>Read more about this <a href=\"https://golang.org/doc/effective_go.html#interfaces\" rel=\"noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3792, "favorite_count": 1, "accepted_answer_id": 39376629, "answer_count": 1, "score": 6, "last_activity_date": 1473273251, "creation_date": 1473271562, "question_id": 39376566, "link": "https://stackoverflow.com/questions/39376566/build-array-with-different-types", "title": "Build array with different types", "body": "<p>I'm very new in Go, and I came from Ruby. So...</p>\n\n<p>can I build array what includes different types</p>\n\n<pre><code>[1, 2, \"apple\", true]\n</code></pre>\n\n<p>Sorry if it's stupid question.</p>\n\n<p>Thanks. </p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 217, "user_id": 1552704, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5d7a274c57be2a5c64fa45fcb25e89ed?s=128&d=identicon&r=PG", "display_name": "chetan", "link": "https://stackoverflow.com/users/1552704/chetan"}, "edited": false, "score": 0, "creation_date": 1473283716, "post_id": 39377813, "comment_id": 66086468, "body": "thanks Mark. I had tried it earlier, in vain. I deleted all k8s.io/ directory structure tried to run my script and it still failed. Some dependency somewhere is referring to <code>authentication.k8s.io&#47;install</code> instead of just <code>authentication&#47;install</code>"}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 1, "last_activity_date": 1473278157, "last_edit_date": 1473278157, "creation_date": 1473277090, "answer_id": 39377813, "question_id": 39376548, "link": "https://stackoverflow.com/questions/39376548/k8s-go-client-library-fails-to-find-package-on-go-get/39377813#39377813", "title": "K8s Go client library fails to find package on go get", "body": "<p>It looks like a package you imported has changed.</p>\n\n<p>You can update existing repositories:</p>\n\n<pre><code>go get -u\n</code></pre>\n\n<blockquote>\n  <p>The -u flag instructs get to use the network to update the named\n  packages and their dependencies.  By default, get uses the network to\n  check out missing packages but does not use it to look for updates to\n  existing packages.</p>\n</blockquote>\n\n<p>You do use <a href=\"http://labix.org/gopkg.in\" rel=\"nofollow\">gopkg.io</a> to pin the version to v1, but I think you want to be more specific, eg, v1.3.6 (EDIT: this won't work because gopkg.in doesn't permit package selectors more specific than the major version.). </p>\n\n<p>Alternatively, a good way to ensure code stays the same is to compile your binary and execute that, instead of using <code>go run</code>.</p>\n"}], "owner": {"reputation": 217, "user_id": 1552704, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5d7a274c57be2a5c64fa45fcb25e89ed?s=128&d=identicon&r=PG", "display_name": "chetan", "link": "https://stackoverflow.com/users/1552704/chetan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 937, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1473278157, "creation_date": 1473271468, "question_id": 39376548, "link": "https://stackoverflow.com/questions/39376548/k8s-go-client-library-fails-to-find-package-on-go-get", "title": "K8s Go client library fails to find package on go get", "body": "<p>We wrote some Go code to talk to our Kubernetes cluster and fetch the IP of a Service exposed. We do it like so:</p>\n\n<pre><code>(import \"gopkg.in/kubernetes/kubernetes.v1/pkg/client/restclient\")\n(import kubectl \"gopkg.in/kubernetes/kubernetes.v1/pkg/client/unversioned\")\n\n svc, err := c.Services(k8sNS).Get(svcName)\n if err != nil {\n   panic(l.Errorf(\"Could not retrieve svc details. %s\", err.Error()))\n }\n svcIP := svc.Status.LoadBalancer.Ingress[0].IP\n</code></pre>\n\n<p><code>go get</code> works fine, and our script executes when we do <code>go run ...</code> and everybody is happy. Now, as of yesterday (from the time this question is posted) on the same script - <code>go get</code> fails. The error is like so:</p>\n\n<pre><code>[09.07.2016 10:56 AM]$ go get\npackage k8s.io/kubernetes/pkg/apis/authentication.k8s.io/install: cannot find package \"k8s.io/kubernetes/pkg/apis/authentication.k8s.io/install\" in any of:\n        /usr/local/go/src/k8s.io/kubernetes/pkg/apis/authentication.k8s.io/install (from $GOROOT)\n        /home/ckotha/godir/src/k8s.io/kubernetes/pkg/apis/authentication.k8s.io/install (from $GOPATH)\n</code></pre>\n\n<p>We have not specifically used <code>authentication</code> package in our code. Are we importing kubernetes libraries correctly? is there another way to do this ?</p>\n\n<p><code>ls</code> on <code>$GOPATH/k8s.io/kubernetes/pkg/apis/</code> and found this:</p>\n\n<pre><code>:~/godir/src/k8s.io/kubernetes/pkg/apis\n[09.07.2016 10:53 AM]$ ls\nabac  apps  authentication  authorization  autoscaling  batch  certificates  componentconfig  extensions  imagepolicy  OWNERS  policy  rbac  storage\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1473264761, "post_id": 39374247, "comment_id": 66077571, "body": "Seems it can be done with just regexp."}, {"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 1, "creation_date": 1473264910, "post_id": 39374247, "comment_id": 66077665, "body": "Parsing XML with a regular expression? Just because you <i>can</i> doesn&#39;t mean you <i>should</i>. I&#39;m trying to avoid <a href=\"http://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454\">hacky solutions like that</a>."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1473265481, "post_id": 39374247, "comment_id": 66077965, "body": "In simple cases regexp can be faster and more readable than XML Encoder Decoder pipe"}, {"owner": {"reputation": 1765, "user_id": 332798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d47656e20ff5e42f125fc5ea0fd636c6?s=128&d=identicon&r=PG", "display_name": "tmm1", "link": "https://stackoverflow.com/users/332798/tmm1"}, "edited": false, "score": 0, "creation_date": 1576289093, "post_id": 39374247, "comment_id": 104862541, "body": "Did you find any generic solution to get a copy of the original outerxml when parsing into a struct?"}], "answers": [{"comments": [{"owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "edited": false, "score": 0, "creation_date": 1473265122, "post_id": 39374841, "comment_id": 66077779, "body": "Thanks, that&#39;s close, but I&#39;m hoping for a solution that captures the full outer xml of each order, in case an attribute is added (e.g. <code>&lt;order order-id=&quot;123&quot; foo=&quot;bar&quot;&#47;&gt;</code>) in the future without my knowledge."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1473266358, "last_edit_date": 1473266358, "creation_date": 1473264782, "answer_id": 39374841, "question_id": 39374247, "link": "https://stackoverflow.com/questions/39374247/how-do-i-retain-the-outer-xml-of-sub-elements/39374841#39374841", "title": "How do I retain the outer XML of sub-elements?", "body": "<p>Use <code>XMLName</code> on your <code>OrderRaw</code>:</p>\n\n<pre><code>type OrderRaw struct {\n    XMLName xml.Name `xml:\"order\"`\n    Order   string   `xml:\",innerxml\"`\n    OrderID string   `xml:\"order-id,attr\"`\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/onK5FExqzD\" rel=\"nofollow\">https://play.golang.org/p/onK5FExqzD</a>.</p>\n\n<hr>\n\n<p><strong>EDIT:</strong> If you want to save <em>all</em> attributes, you'll have to use <code>MarshalerXML</code> and <code>UnmarshalerXML</code> interfaces:</p>\n\n<pre><code>func (o *OrderRaw) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    o.attrs = map[xml.Name]string{}\n    for _, a := range start.Attr {\n        o.attrs[a.Name] = a.Value\n    }\n    type order OrderRaw\n    return d.DecodeElement((*order)(o), &amp;start)\n}\n\nfunc (o OrderRaw) MarshalXML(e *xml.Encoder, start xml.StartElement) error {\n    for name, attr := range o.attrs {\n        start.Attr = append(start.Attr, xml.Attr{Name: name, Value: attr})\n    }\n    start.Name = xml.Name{Local: \"order\"}\n    type order OrderRaw\n    return e.EncodeElement(order(o), start)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/XhkwqJFyMd\" rel=\"nofollow\">https://play.golang.org/p/XhkwqJFyMd</a>.</p>\n"}], "owner": {"reputation": 34669, "user_id": 34409, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4dfdadcd9bb62300eb1a54f02fe5dc18?s=128&d=identicon&r=PG", "display_name": "Chad Gilbert", "link": "https://stackoverflow.com/users/34409/chad-gilbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "accepted_answer_id": 39374841, "answer_count": 1, "score": 1, "last_activity_date": 1473266358, "creation_date": 1473263044, "question_id": 39374247, "link": "https://stackoverflow.com/questions/39374247/how-do-i-retain-the-outer-xml-of-sub-elements", "title": "How do I retain the outer XML of sub-elements?", "body": "<p>I have an XML file that contains a list of individual <code>&lt;order/&gt;</code> elements. I would like to split this single XML file up into multiple files, each of which contain a single order.</p>\n\n<p>Example input file:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;orders&gt;\n  &lt;order order-id=\"123\"&gt;\n    &lt;line-item product-id=\"ABC\"&gt;ABC&lt;/line-item&gt;\n  &lt;/order&gt;\n  &lt;order order-id=\"456\"&gt;\n    &lt;line-item product-id=\"DEF\"&gt;DEF&lt;/line-item&gt;\n  &lt;/order&gt;\n&lt;/orders&gt;\n</code></pre>\n\n<p>Desired outputs:</p>\n\n<blockquote>\n  <p>Order-123.xml:</p>\n\n<pre><code> &lt;order order-id=\"123\"&gt;\n   &lt;line-item product-id=\"ABC\"&gt;ABC&lt;/line-item&gt;\n &lt;/order&gt;\n</code></pre>\n  \n  <p>Order-456.xml:</p>\n\n<pre><code> &lt;order order-id=\"456\"&gt;\n   &lt;line-item product-id=\"DEF\"&gt;DEF&lt;/line-item&gt;\n &lt;/order&gt;\n</code></pre>\n</blockquote>\n\n<p>At this stage, I am not concerned with unmarshalling each of the order details into a struct; I merely want an exact copy of each <code>&lt;order/&gt;</code> node in its own file.</p>\n\n<p>I have tried a few variations of this using <code>xml:\",innerxml\"</code>, <a href=\"https://play.golang.org/p/zWb_Dxn4FW\" rel=\"nofollow\">like this</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type OrdersRaw struct {\n  Orders []OrderRaw `xml:\"order\"`\n}\n\ntype OrderRaw struct {\n  Order string `xml:\",innerxml\"`\n}\n</code></pre>\n\n<p>The problem in the above code is that each <code>Order</code> value contains the inner XML (starting with <code>&lt;line-item/&gt;</code>) but does not contain the wrapping <code>&lt;order/&gt;</code> tag.</p>\n\n<p>Ideally, if there were an <code>xml:\",outerxml\"</code> tag, it would serve my purpose.</p>\n\n<p>I am trying to avoid doing hacky things like manually concatenating the inner XML with handwritten XML (e.g. <code>&lt;order order-id=\"123\"&gt;</code>).</p>\n"}, {"tags": ["logging", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1473331039, "post_id": 39372418, "comment_id": 66103708, "body": "Would <a href=\"https://godoc.org/github.com/Sirupsen/logrus#Entry.WithField\" rel=\"nofollow noreferrer\"><code>WithField</code></a> method do the job?"}, {"owner": {"reputation": 67, "user_id": 5227921, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-Ui3DFQ6vnwo/AAAAAAAAAAI/AAAAAAAAE4M/wVkOlz-kT4Q/photo.jpg?sz=128", "display_name": "Rajendra Ugrani", "link": "https://stackoverflow.com/users/5227921/rajendra-ugrani"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1473358538, "post_id": 39372418, "comment_id": 66121286, "body": "I haven&#39;t found a way of using <code>WithField</code> for this purpose."}, {"owner": {"reputation": 5209, "user_id": 4317945, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/30jtQ.jpg?s=128&g=1", "display_name": "Gabe", "link": "https://stackoverflow.com/users/4317945/gabe"}, "edited": false, "score": 0, "creation_date": 1481577529, "post_id": 39372418, "comment_id": 69423871, "body": "This answer can help: <a href=\"http://stackoverflow.com/a/41049394/4317945\">stackoverflow.com/a/41049394/4317945</a>"}], "owner": {"reputation": 67, "user_id": 5227921, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-Ui3DFQ6vnwo/AAAAAAAAAAI/AAAAAAAAE4M/wVkOlz-kT4Q/photo.jpg?sz=128", "display_name": "Rajendra Ugrani", "link": "https://stackoverflow.com/users/5227921/rajendra-ugrani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 388, "favorite_count": 2, "answer_count": 0, "score": 2, "last_activity_date": 1473257964, "creation_date": 1473257964, "question_id": 39372418, "link": "https://stackoverflow.com/questions/39372418/how-to-tag-the-log-messages-with-a-request-header-in-golang-using-logrus", "title": "How to tag the log messages with a request header in golang using logrus?", "body": "<p>I am new to golang, and I need help attaching a http request header of my go application in all the log entries for a http request.The request is processed by multiple packages/go files. We use logrus package for logging. We have ton of code written already, so it would be nice to change something on a global level instead of going to each log entry.</p>\n\n<p>In Java, we use slf4j, and we use a feature called MDC; and I am looking for something similar. </p>\n"}, {"tags": ["go", "docker", "go-playground"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1473253056, "post_id": 39369223, "comment_id": 66069112, "body": "So your question is: &quot;How do I use xiam/go-playground?&quot;"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1473272931, "post_id": 39369223, "comment_id": 66081610, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/27812164/can-i-import-3rd-party-package-into-golang-playground\">Can I import 3rd party package into golang playground</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1473251206, "last_edit_date": 1495542817, "creation_date": 1473250746, "answer_id": 39369794, "question_id": 39369223, "link": "https://stackoverflow.com/questions/39369223/how-can-i-import-a-library-from-github-to-go-playground/39369794#39369794", "title": "How can I import a library from github to GO playground?", "body": "<p>The answer is still the same: you can't do that on the \"official\" Go Playground (at <a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">https://play.golang.org/</a>).</p>\n\n<p>If you or someone else runs a custom, modified version of the Go Playground: then the answer is you can do there whatever is allowed, which may include the usage of external libraries which the custom engine may <code>go get</code> prior to compilation and execution.</p>\n\n<p>Also see related question: <a href=\"https://stackoverflow.com/questions/36409302/which-packages-may-be-imported-in-the-go-playground\">Which packages may be imported in the go playground?</a></p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 0, "last_activity_date": 1557809802, "last_edit_date": 1592644375, "creation_date": 1557809802, "answer_id": 56123243, "question_id": 39369223, "link": "https://stackoverflow.com/questions/39369223/how-can-i-import-a-library-from-github-to-go-playground/56123243#56123243", "title": "How can I import a library from github to GO playground?", "body": "<p>You might be able to do it since May 14th, 2019</p>\n<p>See <a href=\"https://twitter.com/bradfitz/status/1128069715455123457\" rel=\"nofollow noreferrer\">this tweet</a> (from <a href=\"https://twitter.com/bradfitz\" rel=\"nofollow noreferrer\">Brad Fitzpatrick</a>)!</p>\n<blockquote>\n<p>The #golang playground now supports third-party imports, pulling them in via <a href=\"https://proxy.golang.org/\" rel=\"nofollow noreferrer\">https://proxy.golang.org/</a></p>\n<p>Example: <a href=\"https://play.golang.org/p/eqEo7mqdS9l\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eqEo7mqdS9l</a>  \ud83c\udf89</p>\n<p>Multi-file support &amp; few other things up next.<br />\nReport bugs at <a href=\"https://github.com/golang/go/issues/31944\" rel=\"nofollow noreferrer\"><code>golang/go</code> issue 31944</a>, or here on the tweeters.</p>\n</blockquote>\n<p>But that means you have published your package deliverable in such a way it is reference by <a href=\"https://twitter.com/FiloSottile/status/1123325054794657792\" rel=\"nofollow noreferrer\">the Go proxy</a>.</p>\n"}], "owner": {"reputation": 1308, "user_id": 5089153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/cf636637f2f2f80acaa49e04082922cd?s=128&d=identicon&r=PG&f=1", "display_name": "Said  Saifi", "link": "https://stackoverflow.com/users/5089153/said-saifi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 681, "favorite_count": 1, "accepted_answer_id": 39369794, "answer_count": 2, "score": 2, "last_activity_date": 1557809802, "creation_date": 1473249225, "last_edit_date": 1495540386, "question_id": 39369223, "link": "https://stackoverflow.com/questions/39369223/how-can-i-import-a-library-from-github-to-go-playground", "title": "How can I import a library from github to GO playground?", "body": "<p>Hi I want to import a 3rd party library to GO playground, I saw an answer for this question: <a href=\"https://stackoverflow.com/a/27813778/6638204\">https://stackoverflow.com/a/27813778/6638204</a> but it said that this can not be done, but the <a href=\"https://github.com/xiam/go-playground\" rel=\"nofollow noreferrer\">xiam/go-playground</a> library on github states that it can do this. I tried using it but I did not understand what should I exactly do. I successfully installed the library and used it to run programs that do not need third party libraries. but I did not get how can I import a third party library. ps: I have docker installed in my machine</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1473256464, "post_id": 39368353, "comment_id": 66071592, "body": "Nice. Didn&#39;t know template engine is smart enough to assert or reflect IData provided is slice underneath, not just interface{}"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1473259849, "post_id": 39368353, "comment_id": 66074261, "body": "@Uvelichitel The template engine uses reflection. <code>Execute()</code> and <code>ExecuteTemplate()</code> take the data as <code>interface{}</code>, so if this wouldn&#39;t be the case, you couldn&#39;t even range over a single passed slice (which is wrapped in an <code>interface{}</code> value)."}, {"owner": {"reputation": 33, "user_id": 5409286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7RHiy.png?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/5409286/martin"}, "edited": false, "score": 0, "creation_date": 1473267867, "post_id": 39368353, "comment_id": 66079227, "body": "@icza it seems to work fine but as I added more array of structs passed kinda got messed up, since in ExecuteTemplate you can only pass one data right, so what I&#39;m doing is passing an array of structs, so you have there different structs or objects if you want to call it that, would I need 3 ranges? it&#39;s hard to explain but lemme update above and also add my project so you can have a broader look."}, {"owner": {"reputation": 33, "user_id": 5409286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7RHiy.png?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/5409286/martin"}, "edited": false, "score": 0, "creation_date": 1473358124, "post_id": 39368353, "comment_id": 66121105, "body": "nvm I just figured it out, thank you very much. marked it as answered. Just as a side note, the problem was that I was getting the rows from the SQL in the wrong order."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1473247236, "last_edit_date": 1473247236, "creation_date": 1473246763, "answer_id": 39368353, "question_id": 39367890, "link": "https://stackoverflow.com/questions/39367890/access-my-array-of-structs-in-my-template/39368353#39368353", "title": "access my array of structs in my template", "body": "<p>If the pipeline value that you pass to the <code>\"content\"</code> template execution is <code>dataFinal</code>, then you have to use two <code>{{range}}</code> actions as <code>dataFinal</code> itself is a slice (of type <code>[]models.Data</code>), and <code>Data.IData</code> is also a slice (of type <code>[]model.User</code>).</p>\n\n<p>Inside the inner <code>{{range}}</code> you may refer to the <code>User.Name</code> like <code>.Name</code>:</p>\n\n<pre><code>&lt;li&gt;{{.Name}}&lt;/li&gt;\n</code></pre>\n\n<p>See this working example:</p>\n\n<pre><code>const templ = `{{define \"content\"}}\n&lt;h2&gt;THIS IS THE BODY CONTENT&lt;/h2&gt;\n\n&lt;ul&gt;\n    {{.}}\n    {{range .}}\n    &lt;ul&gt;\n       {{range .IData}}\n       &lt;li&gt;{{.Name}}&lt;/li&gt;\n       {{end}}\n    &lt;/ul&gt;\n    {{end}}\n&lt;/ul&gt;\n{{end}}`\n\n// Parsing and executing the template:\nt := template.Must(template.New(\"\").Parse(templ))\nfmt.Println(t.ExecuteTemplate(os.Stdout, \"content\", dataFinal))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/-xrWWCfFDQ\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>&lt;h2&gt;THIS IS THE BODY CONTENT&lt;/h2&gt;\n\n&lt;ul&gt;\n    [{content [{jon jon@mail.com}]} {content [{jon jon@mail.com}]}]\n\n    &lt;ul&gt;\n\n       &lt;li&gt;jon&lt;/li&gt;\n\n    &lt;/ul&gt;\n\n    &lt;ul&gt;\n\n       &lt;li&gt;jon&lt;/li&gt;\n\n    &lt;/ul&gt;\n\n&lt;/ul&gt;\n&lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 5409286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7RHiy.png?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/5409286/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 568, "favorite_count": 0, "accepted_answer_id": 39368353, "answer_count": 1, "score": 2, "last_activity_date": 1473267951, "creation_date": 1473245424, "last_edit_date": 1473267951, "question_id": 39367890, "link": "https://stackoverflow.com/questions/39367890/access-my-array-of-structs-in-my-template", "title": "access my array of structs in my template", "body": "<p>I'm passing an array of structs to my template, the data is there but I can't find a way to access specific data, I tried many things already, here it is</p>\n\n<p>My Struct</p>\n\n<pre><code>type Data struct {\n  Destination string\n  IData interface{}\n}\n</code></pre>\n\n<p>then in my controller I have</p>\n\n<pre><code>users := []models.User {}\n\nuserRow := models.User{Name: \"jon\", Email: \"jon@mail.com\"}\nusers = append(users, userRow)\nusers2 := users\n\ndata := models.Data{\n    Destination: \"content\",\n    IData: users,\n}\n\ndata2 := models.Data{\n    Destination: \"content\",\n    IData: users2,\n}\n\ndataFinal := []models.Data{}\ndataFinal = append(dataFinal, data)\ndataFinal = append(dataFinal, data2)\n</code></pre>\n\n<p>and this is my template, though this didn't seem to work, it does show the raw data but can't seem to access the name specifically.</p>\n\n<pre><code>{{define \"content\"}}\n&lt;h2&gt;THIS IS THE BODY CONTENT&lt;/h2&gt;\n\n&lt;ul&gt;\n    {{.}}\n    {{range .}}\n    &lt;li&gt;{{.}}&lt;/li&gt;\n    {{end}}\n&lt;/ul&gt;\n{{end}}\n</code></pre>\n\n<p>edit:\nproject: <a href=\"https://github.com/og2/go-og2-mvc\" rel=\"nofollow\">https://github.com/og2/go-og2-mvc</a></p>\n\n<p>you may wanna run:</p>\n\n<p><strong>go get github.com/go-sql-driver/mysql</strong></p>\n\n<p><strong>go get github.com/julienschmidt/httprouter</strong></p>\n\n<p>for it to work and should be just fine!</p>\n"}, {"tags": ["node.js", "sockets", "go", "tcp"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1473321524, "post_id": 39367765, "comment_id": 66097989, "body": "As the answers mentioned you have to break your messages somehow. TCP itself is a streaming protocol, not a packet based one."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 6221381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6efccbec4b4015e0d9194d86789afe5?s=128&d=identicon&r=PG&f=1", "display_name": "internet3", "link": "https://stackoverflow.com/users/6221381/internet3"}, "edited": false, "score": 0, "creation_date": 1473337609, "post_id": 39368564, "comment_id": 66107795, "body": "Thanks Nebril, it&#39;s right, now work as explained by Tomaz too."}, {"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "reply_to_user": {"reputation": 41, "user_id": 6221381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6efccbec4b4015e0d9194d86789afe5?s=128&d=identicon&r=PG&f=1", "display_name": "internet3", "link": "https://stackoverflow.com/users/6221381/internet3"}, "edited": false, "score": 0, "creation_date": 1473345413, "post_id": 39368564, "comment_id": 66113651, "body": "@internet3 great to know, feel free to accept either mine or Tomaz&#39;s answer (tick under answer score)."}], "tags": [], "owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "is_accepted": false, "score": 1, "last_activity_date": 1473247364, "creation_date": 1473247364, "answer_id": 39368564, "question_id": 39367765, "link": "https://stackoverflow.com/questions/39367765/golang-tcp-socket-process-multiple-messages/39368564#39368564", "title": "golang tcp socket - process multiple messages", "body": "<p>From the <code>io</code> package documentation: <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow\">https://golang.org/pkg/io/#Copy</a> , the Copy function copies until it encounters EOF.</p>\n\n<p>You don't send EOF manually but the client closing the connection does that, so the Copy function can finish the copying.</p>\n\n<p>You can use <code>bufio</code> package to read strings with your delimiter: </p>\n\n<pre><code>line, err := bufio.NewReader(conn).ReadString('\\n')\n</code></pre>\n\n<p>In the above case, the delimiter is new line character. You can reuse the reader to repeatedly call ReadString on it to retrieve more messages. </p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user4101925"}, "is_accepted": false, "score": 3, "last_activity_date": 1473247403, "creation_date": 1473247403, "answer_id": 39368581, "question_id": 39367765, "link": "https://stackoverflow.com/questions/39367765/golang-tcp-socket-process-multiple-messages/39368581#39368581", "title": "golang tcp socket - process multiple messages", "body": "<p>Because you are getting a constant stream of data the server needs to know how to seperate messages. One way of doing that is using a new line character.</p>\n\n<p>I have revised your code below.</p>\n\n<p>Go server:\n    package main</p>\n\n<pre><code>import (\n    \"bufio\"\n    \"log\"\n    \"net\"\n)\n\nfunc main() {\n\n    l, err := net.Listen(\"tcp\", \":1200\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer l.Close()\n    for {\n\n        conn, err := l.Accept()\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        go func(c net.Conn) {\n            for {\n                message, err := bufio.NewReader(conn).ReadString('\\n')\n                if err != nil {\n                    log.Printf(\"Error: %+v\", err.Error())\n                    return\n                }\n\n                log.Println(\"Message:\", string(message))\n            }\n        }(conn)\n    }\n}\n</code></pre>\n\n<p>Nodejs client:</p>\n\n<pre><code>var net = require('net');\n\nlet packet = {\n              Target: { Host: \"\", Port: \"9000\" },\n              Name: { Family: \"Newmarch\", Personal: \"Jan\" },\n              Email: [\n                      { Kind: \"home\", Address: \"jan@newmarch.name\"},\n                      { Kind: \"work\", Address: \"j.newmarch@boxhill.edu.au\"}\n                     ]\n}\n\n\nvar client = new net.Socket();\nclient.connect(1200, '0.0.0.0', function() {\n  console.log('Connected');\n\n  // Send 10 messages\n  for(var i = 0; i &lt; 10; i++) {\n    client.write( (new Buffer(JSON.stringify(packet), 'UTF-8')) );\n    client.write('\\n');\n  }\n\n  client.end();\n\n});\n\nclient.on('data', function(data) {\n  console.log('Received: ' + data);\n  client.destroy();\n});\n\nclient.on('close', function() {\n  console.log('Connection closed');\n});\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 6221381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6efccbec4b4015e0d9194d86789afe5?s=128&d=identicon&r=PG&f=1", "display_name": "internet3", "link": "https://stackoverflow.com/users/6221381/internet3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2720, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1473247403, "creation_date": 1473245090, "question_id": 39367765, "link": "https://stackoverflow.com/questions/39367765/golang-tcp-socket-process-multiple-messages", "title": "golang tcp socket - process multiple messages", "body": "<p>I have this Go tcp socket</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"io\"\n  \"log\"\n  \"net\"\n  \"bytes\"\n)\n\nfunc main() {\n\n  l, err := net.Listen(\"tcp\", \":1200\")\n  if err != nil {\n    log.Fatal(err)\n  }\n  defer l.Close()\n  for {\n\n    conn, err := l.Accept()\n    if err != nil {\n      log.Fatal(err)\n    }\n\n    go func(c net.Conn) {\n\n      var buf bytes.Buffer\n      io.Copy(&amp;buf, c)\n      fmt.Println(\"total size:\", buf.Len())\n      s := buf.String()\n      println(s)\n\n      c.Close()\n    }(conn)\n  }\n}\n</code></pre>\n\n<p>accept a message, transform it to string and display it, but if the connection is not closed by the client I am not able to see the message showed on the server as expected</p>\n\n<p>How is possible to send multiple message from the client without the need to close the client connection (by the client) ?</p>\n\n<p>Here the client in NodeJs</p>\n\n<pre><code>var net = require('net');\n\nlet packet = {\n              Target: { Host: \"\", Port: \"9000\" },\n              Name: { Family: \"Newmarch\", Personal: \"Jan\" },\n              Email: [\n                      { Kind: \"home\", Address: \"jan@newmarch.name\"},\n                      { Kind: \"work\", Address: \"j.newmarch@boxhill.edu.au\"}\n                     ]\n}\n\n\nvar client = new net.Socket();\nclient.connect(1200, '0.0.0.0', function() {\n  console.log('Connected');\n  client.write( (new Buffer(JSON.stringify(packet), 'UTF-8')) );\n  client.end();\n  //client.write('\\n');\n});\n\nclient.on('data', function(data) {\n  console.log('Received: ' + data);\n  client.destroy();\n});\n\nclient.on('close', function() {\n  console.log('Connection closed');\n});\n</code></pre>\n\n<p>Thanks valeriano cossu</p>\n"}, {"tags": ["http", "go", "proxy", "content-encoding"], "answers": [{"comments": [{"owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1473411145, "post_id": 39402833, "comment_id": 66139920, "body": "So in <code>go</code>, when I use <code>io.Copy(rw, resp.Body)</code>, should I copy the <code>Content-Encoding</code> header or not?"}], "tags": [], "owner": {"reputation": 905, "user_id": 411577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f3d780669bdc605a954cda738d1de743?s=128&d=identicon&r=PG", "display_name": "Adrien", "link": "https://stackoverflow.com/users/411577/adrien"}, "is_accepted": false, "score": 0, "last_activity_date": 1473387434, "creation_date": 1473387434, "answer_id": 39402833, "question_id": 39367100, "link": "https://stackoverflow.com/questions/39367100/should-http-proxy-copy-content-encoding-header-back-to-client/39402833#39402833", "title": "Should HTTP proxy copy Content-Encoding header back to client?", "body": "<p>In general, the Content-Encoding response header should not be altered by a proxy. </p>\n\n<p>Different encodings of the same URI are deemed to be different representations and have different ETags.  So, changing Content-Encoding would not play well with caching.</p>\n\n<p>But if it's your own proxy and client in your own ecosystem, you could do it, since you know what's going on, so if your proxy is decompressing data back to the client you'd need to strip the Content-Encoding header.</p>\n"}], "owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473387434, "creation_date": 1473243243, "question_id": 39367100, "link": "https://stackoverflow.com/questions/39367100/should-http-proxy-copy-content-encoding-header-back-to-client", "title": "Should HTTP proxy copy Content-Encoding header back to client?", "body": "<p>It's said that <code>Transport</code> will handle the <code>Content-Encoding</code> automatically (like auto decompressing when reading from <code>resp.Body</code>).</p>\n\n<p>It's also said that, <code>Content-Encoding</code> is an end-to-end HTTP header, not a hop-by-hop one.</p>\n\n<p>Therefore,  if a proxy copied <code>Content-Encoding</code> back to client's response header, and this proxy also <code>io.Copy</code> the upstream response body (which may decompressing automatically since <code>io.Copy</code> will read from <code>resp.Body</code>), won't it be inconsistent to client? (<code>Content-Encoding</code> copied from upstream response, but body has been decompressed)</p>\n"}, {"tags": ["mongodb", "go", "bson", "mgo", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "edited": false, "score": 0, "creation_date": 1473315121, "post_id": 39383654, "comment_id": 66094503, "body": "Awesome! This is what I needed!"}], "tags": [], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "is_accepted": true, "score": 1, "last_activity_date": 1473315045, "creation_date": 1473315045, "answer_id": 39383654, "question_id": 39364133, "link": "https://stackoverflow.com/questions/39364133/golang-find-a-value-from-a-map-of-nested-json-data-from-mongodb/39383654#39383654", "title": "Golang find a value from a map of nested json data from MongoDB", "body": "<p>you can do something like this</p>\n\n<pre><code>    majorCat := body[\"categorySlug\"]\n    category := body[\"category\"]\n    subCategory := body[\"subCategory\"]\n    brandId, err := strconv.Atoi(body[\"brandId\"])\n    if err != nil {\n        log.Println(err)\n    }\n    result := database.GetMappedFields(\"Brands\", bson.M{\"brandId\": brandId}, bson.M{\"category\": 1, \"_id\": 0})\n    internalObj := result[0][\"category\"].(map[string]interface{})\n    finalValue := internalObj[\"television_warrantyPeriod\"]\n    if category != \"\" {\n        for _, v := range internalObj[majorCat].([]interface{}) {\n            subObj := v.(map[string]interface{})\n            if subObj[\"cat\"] == category {\n                finalValue = subObj[\"warrantyPeriod\"]\n                if subCategory != \"\" {\n                    minorObj := subObj[\"subCategory\"].([]interface{})\n                    for _, iter := range minorObj {\n                        kevVal := iter.(map[string]interface{})\n                        if kevVal[\"subCat\"] == subCategory {\n                            finalValue = kevVal[\"warrantyPeriod\"]\n                        }\n                    }\n                }\n            }\n        }\n    }\n</code></pre>\n\n<p>Hopefully this will do dynamically or you can create a struct so that it can directly be decoded into that cheers</p>\n"}], "owner": {"reputation": 996, "user_id": 4720042, "user_type": "registered", "accept_rate": 95, "profile_image": "https://lh4.googleusercontent.com/-HJtrEmnS3s8/AAAAAAAAAAI/AAAAAAAABUo/w4vFRFBUbqE/photo.jpg?sz=128", "display_name": "Gaurav Ojha", "link": "https://stackoverflow.com/users/4720042/gaurav-ojha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 796, "favorite_count": 0, "accepted_answer_id": 39383654, "answer_count": 1, "score": 0, "last_activity_date": 1473315045, "creation_date": 1473234547, "question_id": 39364133, "link": "https://stackoverflow.com/questions/39364133/golang-find-a-value-from-a-map-of-nested-json-data-from-mongodb", "title": "Golang find a value from a map of nested json data from MongoDB", "body": "<p>I am trying to receive data from my MongoDB using MGO in a map of type <code>[]map[string]interface{}</code></p>\n\n<p>My JSON looks like this -</p>\n\n<pre><code>{\n   \"_id\":\"string\",\n   \"brandId\":123,\n   \"category\":{\n      \"television\":[\n         {\n            \"cat\":\"T1\",\n            \"subCategory\":[\n               {\n                  \"subCat\":\"T1A TV\",\n                  \"warrantyPeriod\":6\n               }\n            ],\n            \"warrantyPeriod\":12\n         },\n         {\n            \"cat\":\"T2\",\n            \"subCategory\":[\n               {\n                  \"subCat\":\"T2A\",\n                  \"warrantyPeriod\":18\n               },\n               {\n                  \"subCat\":\"T2B\",\n                  \"warrantyPeriod\":9\n               }\n            ],\n            \"warrantyPeriod\":15\n         },\n         {\n            \"cat\":\"T3\",\n            \"subCategory\":[\n               {\n                  \"subCat\":\"T3A\",\n                  \"warrantyPeriod\":3\n               },\n               {\n                  \"subCat\":\"T3B\",\n                  \"warrantyPeriod\":5\n               },\n               {\n                  \"subCat\":\"T3C\",\n                  \"warrantyPeriod\":7\n               },\n               {\n                  \"subCat\":\"T3D\",\n                  \"warrantyPeriod\":11\n               }\n            ],\n            \"warrantyPeriod\":4\n         }\n      ],\n      \"television_warrantyPeriod\":24\n   },\n   \"title\":\"BrandName\"\n}\n</code></pre>\n\n<p>I would ideally pass in the category name i.e. 'television' and <code>cat</code> and <code>subCat</code> values which could be optional.</p>\n\n<p>For e.g. something like this -</p>\n\n<pre><code>{\n\"categorySlug\": \"television\",\n\"brandId\": \"123\",\n\"model\": \"T2\"\n}\n</code></pre>\n\n<p>In which case I would expect to find '15' which is the warrantyPeriod value for T2 if there are no T2A or T2B specified.</p>\n\n<p>My query functions look like this -</p>\n\n<pre><code>var data map[string]string\nerr := json.NewDecoder(r.Body).Decode(&amp;data)\nlog.Println(err)\nvar buffer bytes.Buffer\nbuffer.WriteString(\"category.\")\nbuffer.WriteString(data[\"categorySlug\"])\nbrandId, _ := strconv.Atoi(data[\"brandId\"])\nconcernedbrandandcategory := database.GetMappedFields(\"Brands\", bson.M{\"brandId\": brandId, buffer.String(): bson.M{\"$exists\": true}}, bson.M{buffer.String(): 1})\ncategorymap := concernedbrandandcategory[0]\nlog.Println(categorymap[\"category\"][\"television\"], reflect.TypeOf(categorymap))\n</code></pre>\n\n<p>My GetMappedFields function looks like this -</p>\n\n<pre><code>func GetMappedFields(collectionName string, query interface{}, selector interface{}) (result []map[string]interface{}) {\n    MgoSession.DB(Dbname).C(collectionName).Find(query).Select(selector).All(&amp;result)\n    return\n}\n</code></pre>\n\n<p>I'm just not able to wrap my head around this nested structure which sometimes returns a map and sometimes an interface!\nAny help would be highly appreciated!</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 241, "user_id": 4964047, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-NSLQPGADXvI/AAAAAAAAAAI/AAAAAAAAIuQ/2U9PeBiwzrg/photo.jpg?sz=128", "display_name": "Oleg Khamov", "link": "https://stackoverflow.com/users/4964047/oleg-khamov"}, "edited": false, "score": 0, "creation_date": 1473238190, "post_id": 39364336, "comment_id": 66059193, "body": "No! :) Its bad practice. if i add new type, function doSome() need modify."}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "reply_to_user": {"reputation": 241, "user_id": 4964047, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-NSLQPGADXvI/AAAAAAAAAAI/AAAAAAAAIuQ/2U9PeBiwzrg/photo.jpg?sz=128", "display_name": "Oleg Khamov", "link": "https://stackoverflow.com/users/4964047/oleg-khamov"}, "edited": false, "score": 1, "creation_date": 1473242135, "post_id": 39364336, "comment_id": 66061747, "body": "I think it&#39;s <i>good</i> practice because it forces you to code <code>doSome()</code> explicitly instead of taking a guess at the behavior. If you want doSome to always create EMPTY slices then you could use <code>b := make([]Brush, 3)</code> instead of <code>doSome(&amp;b)</code>"}], "tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": false, "score": 3, "last_activity_date": 1473235184, "creation_date": 1473235184, "answer_id": 39364336, "question_id": 39363798, "link": "https://stackoverflow.com/questions/39363798/how-to-create-a-slice-of-variable-type-in-go/39364336#39364336", "title": "How to create a slice of variable type in Go?", "body": "<p>typeswitch!!</p>\n\n<pre><code>package main\nimport \"fmt\"\n\nfunc doSome(v interface{}) {\n  switch v := v.(type) {\n  case *[]Color:\n    *v = []Color{Color{0}, Color{128}, Color{255}}\n  case *[]Brush:\n    *v = []Brush{Brush{true}, Brush{true}, Brush{false}}\n  default:\n    panic(\"unsupported doSome input\")\n  }\n}  \n\ntype Color struct {\n    r uint8\n}\ntype Brush struct {\n    round bool\n}\n\nfunc main(){\n    var c []Color\n    doSome(&amp;c) // after \u0441 is array contains 3 elements type Color\n\n    var b []Brush\n    doSome(&amp;b) // after b is array contains 3 elements type Brush\n\n    fmt.Println(b)\n    fmt.Println(c)\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1473254420, "creation_date": 1473254420, "answer_id": 39371053, "question_id": 39363798, "link": "https://stackoverflow.com/questions/39363798/how-to-create-a-slice-of-variable-type-in-go/39371053#39371053", "title": "How to create a slice of variable type in Go?", "body": "<p>Go has no generics. Your possibilities are:</p>\n\n<p>Interface dispatching</p>\n\n<pre><code>type CanTraverse interface {\n    Get(int) interface{}\n    Len() int\n}\ntype Colours []Colour\n\nfunc (c Colours) Get(i int) interface{} {\n    return c[i]\n}\nfunc (c Colours) Len() int {\n    return len(c)\n}\nfunc doSome(v CanTraverse) {\n    for i := 0; i &lt; v.Len; i++ {\n        fmt.Println(v.Get(i))\n    }\n}\n</code></pre>\n\n<p>Type switch as @Plato suggested</p>\n\n<pre><code>func doSome(v interface{}) {\n  switch v := v.(type) {\n  case *[]Colour:\n    //Do something with colours\n  case *[]Brush:\n    //Do something with brushes\n  default:\n    panic(\"unsupported doSome input\")\n  }\n}\n</code></pre>\n\n<p>Reflection as fmt.Println() do. Reflection is very powerful but very expensive, code may be slow. Minimal example</p>\n\n<pre><code>func doSome(v interface{}) {\n    value := reflect.ValueOf(v)\n    if value.Kind() == reflect.Slice {\n        for i := 0; i &lt; value.Len(); i++ {\n            element := value.Slice(i, i+1)\n            fmt.Println(element)\n        }\n    } else {\n        fmt.Println(\"It's not a slice\")\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "is_accepted": true, "score": 4, "last_activity_date": 1473262640, "creation_date": 1473262640, "answer_id": 39374106, "question_id": 39363798, "link": "https://stackoverflow.com/questions/39363798/how-to-create-a-slice-of-variable-type-in-go/39374106#39374106", "title": "How to create a slice of variable type in Go?", "body": "<pre><code>func doSome(v interface{}) {\n\n    s := reflect.TypeOf(v).Elem()\n    slice := reflect.MakeSlice(s, 3, 3)\n    reflect.ValueOf(v).Elem().Set(slice)\n\n}  \n</code></pre>\n"}], "owner": {"reputation": 241, "user_id": 4964047, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh5.googleusercontent.com/-NSLQPGADXvI/AAAAAAAAAAI/AAAAAAAAIuQ/2U9PeBiwzrg/photo.jpg?sz=128", "display_name": "Oleg Khamov", "link": "https://stackoverflow.com/users/4964047/oleg-khamov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2362, "favorite_count": 1, "accepted_answer_id": 39374106, "answer_count": 3, "score": 3, "last_activity_date": 1473275440, "creation_date": 1473233451, "last_edit_date": 1473275440, "question_id": 39363798, "link": "https://stackoverflow.com/questions/39363798/how-to-create-a-slice-of-variable-type-in-go", "title": "How to create a slice of variable type in Go?", "body": "<p>I have a function.</p>\n\n<pre><code>func doSome(v interface{}) {\n\n}  \n</code></pre>\n\n<p>If I pass by pointer a slice of struct into the function, the function must fill the slice.</p>\n\n<pre><code>type Color struct {\n}\ntype Brush struct {\n}\n\nvar c []Color\ndoSome(&amp;c) // after \u0441 is array contains 3 elements type Color\n\nvar b []Brush\ndoSome(&amp;b) // after b is array contains 3 elements type Brush\n</code></pre>\n\n<p>Maybe I need use reflection, but how?</p>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 1, "creation_date": 1473233987, "post_id": 39363794, "comment_id": 66056704, "body": "You may simply write a for loop which sleeps for sometime and poll the REST endpoint in every iteration. May be u will run the for loop in a dedicated goroutine. Else you may use Ticker (<a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Ticker</a>) also."}, {"owner": {"reputation": 327, "user_id": 4362483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/07bf4729a8c6813243eb7442c357e3ff?s=128&d=identicon&r=PG&f=1", "display_name": "citizenBane", "link": "https://stackoverflow.com/users/4362483/citizenbane"}, "reply_to_user": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1473234555, "post_id": 39363794, "comment_id": 66057022, "body": "Thanks. Could this be implemented with long polling?"}, {"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1473250563, "post_id": 39363794, "comment_id": 66067268, "body": "yes, can be used for long polling."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1473250920, "post_id": 39363794, "comment_id": 66067503, "body": "Sure it could be implemented with long polling if endpoint support this. You just don&#39;t Close connection but read chunks of data from http.Response.Body as them are available."}], "answers": [{"tags": [], "owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "is_accepted": false, "score": 11, "last_activity_date": 1473274334, "creation_date": 1473274334, "answer_id": 39377205, "question_id": 39363794, "link": "https://stackoverflow.com/questions/39363794/periodically-polling-a-rest-endpoint-in-go/39377205#39377205", "title": "Periodically polling a REST endpoint in Go", "body": "<p>Simplest way would be to use a Ticker:</p>\n\n<pre><code>ticker := time.NewTicker(time.Second * 1).C\ngo func() {\n    for {\n        select {\n        case &lt;- ticker:\n            response,_ := http.Get(\"http://...\")\n            _, err := io.Copy(os.Stdout, response.Body)\n            if err != nil {\n                log.Fatal(err)\n            }\n            response.Body.Close()\n        }\n    }\n\n}()\n\n\ntime.Sleep(time.Second * 10)\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 4362483, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/07bf4729a8c6813243eb7442c357e3ff?s=128&d=identicon&r=PG&f=1", "display_name": "citizenBane", "link": "https://stackoverflow.com/users/4362483/citizenbane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2421, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1473274334, "creation_date": 1473233440, "question_id": 39363794, "link": "https://stackoverflow.com/questions/39363794/periodically-polling-a-rest-endpoint-in-go", "title": "Periodically polling a REST endpoint in Go", "body": "<p>I am trying to write a Go application that periodically polls a REST endpoint exposed by a PHP application. The Go polling application reads the payload into a struct and does further processing. I am looking for some recommendations for starting the implementation. </p>\n"}, {"tags": ["html", "go", "revel"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1473232087, "creation_date": 1473232087, "answer_id": 39363350, "question_id": 39362012, "link": "https://stackoverflow.com/questions/39362012/nested-template-in-revel-not-loading-properly/39363350#39363350", "title": "Nested template in Revel not loading properly", "body": "<p>The error is not in <code>mirror.html</code> but in <code>index.html</code>:</p>\n\n<blockquote>\n  <p>results.go:232: Template Execution Error (in <strong>Mirror/index.html</strong>): html/template:Mirror/index.html: \"\\\"\" in attribute name: \" class\\\"quote-component\\\" id=\\\"quot\"</p>\n</blockquote>\n\n<p>You simply left out an equal sign <code>'='</code> when specifying the <code>class</code> attribute of some element, for example you wrote:</p>\n\n<pre><code>&lt;span class\"quote-component\" id=\"quot\"&gt;...\n</code></pre>\n\n<p>See this simple example to verify:</p>\n\n<pre><code>const templ = `&lt;html&gt;&lt;body&gt;\n        &lt;span class\"quote-component\" id=\"quot\"&gt;Bad syntax&lt;/span&gt;\n        &lt;/body&gt;&lt;/html&gt;`\n\nt := template.Must(template.New(\"\").Parse(templ))\nerr := t.Execute(os.Stdout, nil)\nfmt.Println(err)\n</code></pre>\n\n<p>Output: almost identical to yours (try it on the <a href=\"https://play.golang.org/p/61h0b8jiVK\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>html/template: \"\\\"\" in attribute name: \" class\\\"quote-component\\\" id=\\\"quot\"\n</code></pre>\n"}], "owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 39363350, "answer_count": 1, "score": 1, "last_activity_date": 1473232087, "creation_date": 1473227233, "question_id": 39362012, "link": "https://stackoverflow.com/questions/39362012/nested-template-in-revel-not-loading-properly", "title": "Nested template in Revel not loading properly", "body": "<p>When I call a nested template, <code>{{template \"partials/mirror.html\" .}}</code>, it throws this error:</p>\n\n<pre><code>results.go:232: Template Execution Error (in App/index.html): html/template:App/index.html: \"\\\"\" in attribute name: \" class\\\"quote-component\\\" id=\\\"quot\"\n</code></pre>\n\n<p>If I create a controller specifically for the template <code>App/index.html</code> is calling, like this:</p>\n\n<pre><code>package controllers\n\nimport \"github.com/revel/revel\"\n\ntype Mirror struct {\n    *revel.Controller\n}\n\nfunc (m Mirror) Index() revel.Result {\n    return m.Render()\n}\n</code></pre>\n\n<p>I still get:</p>\n\n<pre><code>results.go:232: Template Execution Error (in Mirror/index.html): html/template:Mirror/index.html: \"\\\"\" in attribute name: \" class\\\"quote-component\\\" id=\\\"quot\"\n</code></pre>\n\n<p>Here are the contents of <code>mirror.html</code>:</p>\n\n<pre><code>&lt;!-- AUTH STATES --&gt;\n&lt;section class=\"auth-states\"&gt;\n\n  &lt;!-- FACE DETECTED W/IN RANGE --&gt;\n  {{template \"partials/faceClose.html\" .}}\n\n  &lt;!-- USER DETECTED --&gt;\n  {{template \"partials/userDetected.html\" .}}\n\n  &lt;!-- NON USER DETECTED --&gt;\n  {{template \"partials/nonUserDetected.html\" .}}\n\n  &lt;!-- TIME OUT LOGS USER OUT --&gt;\n  {{template \"partials/loggingOut.html\" .}}\n\n&lt;/section&gt;\n\n&lt;div class=\"clear eyelevel\"&gt;\n\n  &lt;!-- WEATHER--&gt;\n  {{template \"partials/weather.html\" .}}\n\n  &lt;!-- TIMELY CONTENT: TIMESTAMP AND ALERTS --&gt;\n  &lt;div class=\"timely-content\"&gt;\n\n    &lt;!-- TIMESTAMP --&gt;\n    {{template \"partials/timestamp.html\" .}}\n\n   &lt;!-- EMOTION --&gt;\n   {{template \"partials/emotion.html\" .}}\n\n  &lt;/div&gt;\n\n&lt;/div&gt;\n&lt;img id=\"shot-preview\"/&gt;\n\n&lt;!-- LOW PRIORITY CONTENT --&gt;\n&lt;section class=\"low-pri-content auth-content\"&gt;\n\n  &lt;h2 class=\"logged-in-stamp\"&gt;\n    Here's the scoop, &lt;span id=\"logged-in-name\"&gt;&lt;/span&gt;:\n  &lt;/h2&gt;\n\n  {{template \"partials/traffic.html\" .}}\n  {{template \"partials/stocks.html\" .}}\n  {{template \"partials/newsFeed.html\" .}}\n\n\n&lt;/section&gt;\n\n&lt;div id=\"video-hidden\" aria-hidden=\"true\"&gt;\n  &lt;video id=\"cameraPreview\" class=\"cameraPreview\"&gt;&lt;/video&gt;\n&lt;/div&gt;\n\n&lt;script src=\"https://code.jquery.com/jquery-2.2.1.js\"&gt;&lt;/script&gt;\n&lt;script src=\"https://cdn.jsdelivr.net/momentjs/2.11.2/moment.min.js\"&gt;&lt;/script&gt;\n&lt;script src=\"/public/js/weather.js\"&gt;&lt;/script&gt;\n&lt;script src=\"/public/js/stock.js\"&gt;&lt;/script&gt;\n&lt;script src=\"/public/js/news.js\"&gt;&lt;/script&gt;\n&lt;script src=\"/public/js/traffic.js\"&gt;&lt;/script&gt;\n&lt;script src=\"/public/js/mirror.js\"&gt;&lt;/script&gt;\n&lt;script src=\"/public/js/authenticate.js\"&gt;&lt;/script&gt;\n</code></pre>\n\n<p>The structure of the app follows the Revel recommendations, the project itself is just migrating <a href=\"https://github.com/MicrosoftEdge/magic-mirror-demo\" rel=\"nofollow\">this project</a> from Node to Go using Revel.</p>\n\n<p>My question is: what does that error message mean? It always loads the top 4 lines of the <code>mirror.html</code> file, regardless of what the top 4 lines are.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 6802962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c76599305e877b58caae52bfcb68aeee?s=128&d=identicon&r=PG&f=1", "display_name": "gwtony", "link": "https://stackoverflow.com/users/6802962/gwtony"}, "edited": false, "score": 0, "creation_date": 1473231035, "post_id": 39362849, "comment_id": 66054998, "body": "It is what i want\uff0cThank you\uff01"}], "tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": true, "score": 3, "last_activity_date": 1473231313, "last_edit_date": 1473231313, "creation_date": 1473230628, "answer_id": 39362849, "question_id": 39361537, "link": "https://stackoverflow.com/questions/39361537/where-is-g-struct-define-in-golang-source-code/39362849#39362849", "title": "Where is g struct define in golang source code?", "body": "<p>The struct is in <a href=\"https://golang.org/src/runtime/runtime2.go\" rel=\"nofollow\"><code>runtime2.go</code></a>.</p>\n\n<blockquote>\n<pre><code>type g struct {\n  // Stack parameters.\n  // stack describes the actual stack memory: [stack.lo, stack.hi).\n  // stackguard0 is the stack pointer compared in the Go stack growth prologue.\n</code></pre>\n</blockquote>\n\n<p>You can use <a href=\"https://github.com/rogpeppe/godef\" rel=\"nofollow\"><code>godef</code></a> to quickly answer questions like that on your own.</p>\n\n<p>The function's comment describes how that works:</p>\n\n<blockquote>\n  <p>The compiler rewrites calls to this function into instructions\n  that fetch the g directly (from TLS or from the dedicated register).</p>\n</blockquote>\n\n<p>To see how the compiler does this, check <code>cmd/compile/internal/gc/typecheck.go</code>:</p>\n\n<blockquote>\n<pre><code>if ..... &amp;&amp; n.Left.Sym.Name == \"getg\" { ...\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 41, "user_id": 6802962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c76599305e877b58caae52bfcb68aeee?s=128&d=identicon&r=PG&f=1", "display_name": "gwtony", "link": "https://stackoverflow.com/users/6802962/gwtony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 693, "favorite_count": 1, "accepted_answer_id": 39362849, "answer_count": 1, "score": 3, "last_activity_date": 1473241976, "creation_date": 1473224551, "last_edit_date": 1473241976, "question_id": 39361537, "link": "https://stackoverflow.com/questions/39361537/where-is-g-struct-define-in-golang-source-code", "title": "Where is g struct define in golang source code?", "body": "<p>In golang source code, there is some code like:</p>\n\n<pre><code>MOVL    (g_sched+gobuf_sp)(SI), SP  // sp = m-&gt;g0-&gt;sched.sp\n</code></pre>\n\n<p>And in <code>runtime/stubs.go</code> I found</p>\n\n<pre><code>func getg() *g\n</code></pre>\n\n<p>But i can not find <code>getg</code> function or <code>g</code> struct, where is it?</p>\n"}, {"tags": ["android", "mobile", "go"], "answers": [{"tags": [], "owner": {"reputation": 3811, "user_id": 4864943, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wnYSY.jpg?s=128&g=1", "display_name": "Arjun saini", "link": "https://stackoverflow.com/users/4864943/arjun-saini"}, "is_accepted": false, "score": 0, "last_activity_date": 1473225664, "last_edit_date": 1495541807, "creation_date": 1473225664, "answer_id": 39361712, "question_id": 39361071, "link": "https://stackoverflow.com/questions/39361071/android-programming-using-go-mobile-error-import-go-hello-hello/39361712#39361712", "title": "android programming using Go mobile error import go.hello.Hello", "body": "<p>See here <a href=\"https://stackoverflow.com/questions/28345340/android-studio-java-home-doesnt-point-to-a-valid-jvm-installation/36708374#36708374\">@Arpit Patel answer</a> You need to set the path like that</p>\n\n<p>As you told you have 64 bit system then copy this path <strong>C:\\Program Files\\Java\\jdk1.8.0_31</strong></p>\n\n<p><strong>Step 1 :-</strong>  Create  <strong>JAVA_HOME</strong>  variable by clicking new  and past    ( C:\\Program Files\\Java\\jdk1.8.0_31) this  path.</p>\n\n<p><strong>Step 2</strong> Then click path variable and edit then past it your path after add <strong>semicolon (;)</strong> C:\\Program Files\\Java\\jdk1.8.0_31</p>\n\n<p><a href=\"https://i.stack.imgur.com/YgDbm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YgDbm.png\" alt=\"enter image description here\"></a></p>\n\n<p>I am using <strong>windows 10</strong> so this windows look like this</p>\n\n<p><a href=\"https://i.stack.imgur.com/CfRY8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CfRY8.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Note :-</strong> If above dialog not open then \n, select path variable and click on Edit\u2026. Locate the end of the current variable value\n<strong>append the path of jdk, using a semicolon</strong> And click ok</p>\n"}], "owner": {"reputation": 1, "user_id": 6802878, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WikSG_sQJZs/AAAAAAAAAAI/AAAAAAAAAL0/5gBYmwwSuTk/photo.jpg?sz=128", "display_name": "dienia chitra", "link": "https://stackoverflow.com/users/6802878/dienia-chitra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 166, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1473227575, "creation_date": 1473221406, "last_edit_date": 1473227575, "question_id": 39361071, "link": "https://stackoverflow.com/questions/39361071/android-programming-using-go-mobile-error-import-go-hello-hello", "title": "android programming using Go mobile error import go.hello.Hello", "body": "<p>I have question about error while importing import.hello.Hello in android studio, as you see in the picture below. please give me solution how to solve this error </p>\n\n<p><a href=\"https://i.stack.imgur.com/xODuw.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/xODuw.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 1, "creation_date": 1473196671, "post_id": 39357910, "comment_id": 66045864, "body": "You can always substitute those calls for <code>Logf</code> instead but that requires using the verbose flag to see them."}], "answers": [{"tags": [], "owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "is_accepted": true, "score": 3, "last_activity_date": 1473204485, "creation_date": 1473204485, "answer_id": 39359186, "question_id": 39357910, "link": "https://stackoverflow.com/questions/39357910/can-golang-test-scripts-issue-warnings-rather-than-errors/39359186#39359186", "title": "Can Golang test scripts issue warnings rather than errors?", "body": "<p>The go test tool is like the compiler. To the compiler something either compiles or doesn't, there are no warnings. I think the closest thing you're going to get is to use <a href=\"https://golang.org/pkg/testing/#T.Skip\" rel=\"nofollow\">t.Skip</a>. It will stop execution of the current test but does not mark it as failed. You will not see anything in the output of <code>go test</code> however so you have to use <code>go test -v</code>.</p>\n\n<p>Here's an example package that uses <code>t.Skipf</code> if the <code>addExternal</code> function fails.</p>\n\n<pre><code>package app\n\nimport \"testing\"\n\nfunc add(a, b int) int {\n    return a + b\n}\n\nfunc addExternal(a, b int) int {\n    return 4\n}\n\nfunc divide(a, b int) int {\n    return a / b\n}\n\nfunc TestThing(t *testing.T) {\n    got := add(1, 2)\n    want := 3\n    if got != want {\n        t.Errorf(\"add(1, 2) = %d, want %d\", got, want)\n    }\n}\n\nfunc TestExternalThing(t *testing.T) {\n    got := addExternal(3, 4)\n    want := 7\n    if got != want {\n        t.Skipf(\"addExternal(3, 4) = %d, want %d\", got, want)\n    }\n}\n\nfunc TestAnotherThing(t *testing.T) {\n    got := divide(6, 3)\n    want := 2\n    if got != want {\n        t.Errorf(\"divide(6, 3) = %d, want %d\", got, want)\n    }\n}\n</code></pre>\n\n<p>And here's the output from running that. Note the return status is 0 and the package is considered to have passed</p>\n\n<pre><code>$ go test -v\n=== RUN   TestThing\n--- PASS: TestThing (0.00s)\n=== RUN   TestExternalThing\n--- SKIP: TestExternalThing (0.00s)\n        app_test.go:29: addExternal(3, 4) = 4, want 7\n=== RUN   TestAnotherThing\n--- PASS: TestAnotherThing (0.00s)\nPASS\nok      github.com/jcbwlkr/app  0.006s\n$ echo $?\n0\n</code></pre>\n\n<p>Note though that if I change the <code>t.Skipf</code> to <code>t.Errorf</code> or <code>t.Fatalf</code> I get this output</p>\n\n<pre><code>$ go test -v\n=== RUN   TestThing\n--- PASS: TestThing (0.00s)\n=== RUN   TestExternalThing\n--- FAIL: TestExternalThing (0.00s)\n        app_test.go:29: addExternal(3, 4) = 4, want 7\n=== RUN   TestAnotherThing\n--- PASS: TestAnotherThing (0.00s)\nFAIL\nexit status 1\nFAIL    github.com/jcbwlkr/app  0.005s\n$ echo $?\n1\n</code></pre>\n\n<p>The other tests in the package are still ran. If I was testing multiple packages such as with <code>go test -v ./...</code> I believe they would also still be ran.</p>\n"}], "owner": {"reputation": 165, "user_id": 4150729, "user_type": "registered", "accept_rate": 81, "profile_image": "https://graph.facebook.com/1492722699/picture?type=large", "display_name": "Nik Kunkel", "link": "https://stackoverflow.com/users/4150729/nik-kunkel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 843, "favorite_count": 0, "accepted_answer_id": 39359186, "answer_count": 1, "score": 2, "last_activity_date": 1473204485, "creation_date": 1473196296, "last_edit_date": 1473198803, "question_id": 39357910, "link": "https://stackoverflow.com/questions/39357910/can-golang-test-scripts-issue-warnings-rather-than-errors", "title": "Can Golang test scripts issue warnings rather than errors?", "body": "<p>I have a set of tests that may not pass due to external 3rd party issues.\nI don't want the test to fail when this condition occurs but would like to be made aware. </p>\n\n<p>Issuing a <code>t.Errorf()</code> is not idea because it will stop all subsequent tests. Is there some kind of \"Warning\" I can trigger that the test script would post and then continue with the remainder of the tests? </p>\n"}, {"tags": ["string", "go", "byte", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1473189130, "post_id": 39355642, "comment_id": 66042427, "body": "<i>&quot;... but this involves error checking, and I was hoping to set them aside.&quot;</i> If you want to work / program in Go, get used to error checking. Else you&#39;ll make your (Go) life miserable..."}, {"owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1473216097, "post_id": 39355642, "comment_id": 66050368, "body": "Oh and I do love the error checking, I meant, I didn&#39;t want to error check for a DecodeString for which I was sure to succeed in, that is, I wanted to define the []byte before compiling, with a value I was already sure would not give me an error."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1473231336, "post_id": 39355642, "comment_id": 66055185, "body": "If you know it won&#39;t fail, you may provide a <code>MustDecode()</code> helper function. For details see answer <a href=\"http://stackoverflow.com/a/28233172/1705598\">Go: multiple value in single-value context</a>."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1473206320, "last_edit_date": 1473206320, "creation_date": 1473187020, "answer_id": 39355729, "question_id": 39355642, "link": "https://stackoverflow.com/questions/39355642/define-a-byte-without-hex-decodestring/39355729#39355729", "title": "Define a []byte without hex.DecodeString", "body": "<p>Use the following:</p>\n\n<pre><code>var (\n    left = []byte{0, 0}\n    right = []byte{1, 0}\n    // ... and so on\n)\n</code></pre>\n\n<p>If you want to write it on hex:</p>\n\n<pre><code>var (\n    left = []byte{0x00, 0x00}\n    right = []byte{0x01, 0x00}\n    // ... and so on\n)\n</code></pre>\n\n<p>You can also convert a string to a []byte:</p>\n\n<pre><code>var (\n    left = []byte(\"\\x00\\x00\")\n    right = []byte(\"\\x01\\x00\")\n)\n</code></pre>\n\n<p>Use these variables in a switch statement like this:</p>\n\n<pre><code>switch {\ncase bytes.Equal(v, left):\n    fmt.Println(\"left\")\ncase bytes.Equal(v, right): \n    fmt.Println(\"right\"\n}\n</code></pre>\n\n<p>It looks like you are working with 2 byte numbers encoded in little-endian format. If so, you can <a href=\"https://godoc.org/encoding/binary#LittleEndian\" rel=\"noreferrer\">decode the bytes to an integer</a>:</p>\n\n<pre><code>const (\n    left = 0\n    right = 1\n)\n\nswitch binary.LittleEndian.Uint16(byteSlice) {\ncase left:\n    fmt.Println(\"left\")\ncase right:\n    fmt.Println(\"right\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1473190674, "last_edit_date": 1495535266, "creation_date": 1473190350, "answer_id": 39356522, "question_id": 39355642, "link": "https://stackoverflow.com/questions/39355642/define-a-byte-without-hex-decodestring/39356522#39356522", "title": "Define a []byte without hex.DecodeString", "body": "<p>Defining a <code>[]byte</code> is easiest and recommended to do with a <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">Composite literal</a> as Mellow Marmot suggested. Note that the composite literal also has the advantage that you may use optional indices in the literal, and values for \"missing\" indices will be the zero value of the element type (<code>0</code> in case of <code>byte</code>). And also if you need a <code>[]byte</code> full of zeros, you don't need to list the elements, you can just <code>make</code> an \"empty\" slice.</p>\n\n<p>So for example you may also create your slices like this:</p>\n\n<pre><code>var (\n    left  = make([]byte, 2) // will be [0, 0]\n    right = []byte{1: 1}    // will be [0, 1]\n)\n\nfunc main() {\n    fmt.Println(left, right)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/e4ntQZraSg\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[0 0] [0 1]\n</code></pre>\n\n<p>Also know that <code>string</code> values can be directly converted to <code>[]byte</code> which results in the byte sequence of the UTF-8 encoded bytes of the <code>string</code> (this is how Go stores strings in memory).</p>\n\n<p>So if you can provide a <code>string</code> literal which has the UTF-8 encoded byte sequence that you need, you can simply <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">convert</a> it to <code>[]byte</code>. And since interpreted <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">string literals</a> may contain escape sequences, it's easier than you think:</p>\n\n<blockquote>\n  <p>The three-digit octal (<em>\\nnn</em>) and two-digit hexadecimal (<em>\\xnn</em>) escapes represent individual bytes of the resulting string...</p>\n</blockquote>\n\n<p>So you may also specify your byte values encoded in a <code>string</code> like this:</p>\n\n<pre><code>// With octal escapes\nvar (\n    left  = []byte(\"\\000\\000\")\n    right = []byte(\"\\001\\000\")\n)\n\n// With hexa escapes\nvar (\n    left2  = []byte(\"\\x00\\x00\")\n    right2 = []byte(\"\\x01\\x00\")\n)\n\nfunc main() {\n    fmt.Println(left, right)\n    fmt.Println(left2, right2)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/sjhQbz3pC0\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[0 0] [1 0]\n[0 0] [1 0]\n</code></pre>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/38783260/go-explicit-array-initialization\">GO explicit array initialization</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/36302441/keyed-items-in-golang-array-initialization\">Keyed items in golang array initialization</a></p>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1473194605, "creation_date": 1473194605, "answer_id": 39357536, "question_id": 39355642, "link": "https://stackoverflow.com/questions/39355642/define-a-byte-without-hex-decodestring/39357536#39357536", "title": "Define a []byte without hex.DecodeString", "body": "<p>You can't use []byte in <code>switch</code> because slices are not comparable, strings are.\nSo seams just</p>\n\n<pre><code>const LEFT = `0000`\n</code></pre>\n"}], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6607, "favorite_count": 0, "accepted_answer_id": 39355729, "answer_count": 3, "score": 5, "last_activity_date": 1475355287, "creation_date": 1473186718, "last_edit_date": 1475355287, "question_id": 39355642, "link": "https://stackoverflow.com/questions/39355642/define-a-byte-without-hex-decodestring", "title": "Define a []byte without hex.DecodeString", "body": "<p>I'm working with a HID driver, and this driver reads onto a <code>[]byte</code> buffer one of a few different reports. When I use <code>hex.EncodeToString(buffer)</code>, it will return a string looking like either <code>0000</code> or <code>0100</code> or <code>0200</code>, etc. I want to check, using a switch, against the input from the HID device, and so I want to predefine these possibilities, up outside the <code>main()</code>, how should I proceed?</p>\n\n<p>I've tried these possibilities:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var LEFT []byte = []byte('0000')\n// or\nvar LEFT []byte = `0000`\n// or \nvar LEFT []byte = '0000'\n// or\nvar LEFT []byte = '\\x00\\x00' // from the %q Printf verb\n</code></pre>\n\n<p>The alternative is that I call <code>hex.DecodeString(\"0000\")</code> inside the main() function.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>A note on the solution offered, the <code>EncodeToString</code> hex <code>0000</code> or <code>0100</code> is not <em>four</em> bytes but rather <em>two</em>:</p>\n\n<p><code>\"\\x01\"</code> == <code>\"01\"</code> == <code>'1'</code></p>\n\n<p>so I can use, in order to get 0100, or 0200, as suggested:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var LEFT []byte{1,0}\n// or \nvar LEFT []byte(\"\\x01\\x00\")\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "edited": false, "score": 0, "creation_date": 1473190647, "post_id": 39356108, "comment_id": 66043124, "body": "Oh, how silly of me. That&#39;s muscle memory always initialising a slice to be empty. Thanks very much"}, {"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 0, "creation_date": 1512594879, "post_id": 39356108, "comment_id": 82326578, "body": "By the way, <code>io.Copy</code> is not needed because both <code>Conn</code>s returned by <code>net.Pipe</code> are connected! Consult <a href=\"https://golang.org/pkg/net/#Pipe\" rel=\"nofollow noreferrer\">the doc</a> and try the code without explicit <code>io.Copy</code>..."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1512598564, "last_edit_date": 1512598564, "creation_date": 1473188542, "answer_id": 39356108, "question_id": 39355092, "link": "https://stackoverflow.com/questions/39355092/golang-io-reader-usage-with-net-pipe/39356108#39356108", "title": "Golang io.Reader usage with net.Pipe", "body": "<p>The issue is on line 68:</p>\n\n<pre><code>data_received := make([]byte, 0, count)\n</code></pre>\n\n<p>This line creates a slice with length 0 and capacity <code>count</code>.  The call to <code>Read</code> does not read data because the length is 0. The call to <code>Write</code> blocks because the data is never read.</p>\n\n<p>Fix the issue by changing the line to:</p>\n\n<pre><code>data_received := make([]byte, count)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/YRZ4H91AUm\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p>Note that \"Finished Writing\" may not be printed because the program can exit before <code>dataSrc</code> finishes executing.</p>\n"}], "owner": {"reputation": 763, "user_id": 5986227, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-R58sngDauK0/AAAAAAAAAAI/AAAAAAAAB_0/pzxD2AYGNQA/photo.jpg?sz=128", "display_name": "Chris Hopkins", "link": "https://stackoverflow.com/users/5986227/chris-hopkins"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1130, "favorite_count": 0, "accepted_answer_id": 39356108, "answer_count": 1, "score": 1, "last_activity_date": 1512598564, "creation_date": 1473184401, "question_id": 39355092, "link": "https://stackoverflow.com/questions/39355092/golang-io-reader-usage-with-net-pipe", "title": "Golang io.Reader usage with net.Pipe", "body": "<p>The problem I'm trying to solve is using io.Reader and io.Writer in a net application without using bufio and strings as per the examples I've been able to find online. For efficiency I'm trying to avoid the memcopys those imply.</p>\n\n<p>I've created a test application using net.Pipe on the play area (<a href=\"https://play.golang.org/p/-7YDs1uEc5\" rel=\"nofollow\">https://play.golang.org/p/-7YDs1uEc5</a>). There is a data source and sink which talk through a net.Pipe pair of connections (to model a network connection) and a loopback on the far end to reflect the data right back at us. </p>\n\n<p>The program gets as far as the loopback agent reading the sent data, but as far as I can see the write back to the connection locks; it certainly never completes. Additionally the receiver in the Sink never receives any data whatsoever.</p>\n\n<p>I can't figure out why the write cannot proceed as it's wholly symmetrical with the path that does work. I've written other test systems that use bi-directional network connections but as soon as I stop using bufio and ReadString I encounter this problem. I've looked at the code of those and can't see what I've missed.</p>\n\n<p>Thanks in advance for any help.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 1, "creation_date": 1473183398, "post_id": 39354624, "comment_id": 66039544, "body": "Go templates don&#39;t know anything about the URL or any other part of the request / response. They only have whatever data you pass in to them. Look to where you&#39;re executing the template and see if you can give it something useful"}, {"owner": {"reputation": 1318, "user_id": 3177186, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/374675543dcada464668ba2bd9539adf?s=128&d=identicon&r=PG&f=1", "display_name": "not_a_generic_user", "link": "https://stackoverflow.com/users/3177186/not-a-generic-user"}, "reply_to_user": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 0, "creation_date": 1473183793, "post_id": 39354624, "comment_id": 66039779, "body": "Is it possible to create variables based on values in the URL or in JS?"}, {"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 0, "creation_date": 1473184141, "post_id": 39354624, "comment_id": 66039958, "body": "Yeah, check out the URL field of <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Request</a> as well as <a href=\"https://golang.org/pkg/net/url/#URL.Query\" rel=\"nofollow noreferrer\">golang.org/pkg/net/url/#URL.Query</a>"}, {"owner": {"reputation": 16814, "user_id": 3849456, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AonOf.jpg?s=128&g=1", "display_name": "Anzel", "link": "https://stackoverflow.com/users/3849456/anzel"}, "edited": false, "score": 0, "creation_date": 1473184196, "post_id": 39354624, "comment_id": 66039986, "body": "@not_a_generic_user, you can use JS of course, but you can also create a &quot;renderTemplate&quot; function and pass a map with URL params in the context."}, {"owner": {"reputation": 1318, "user_id": 3177186, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/374675543dcada464668ba2bd9539adf?s=128&d=identicon&r=PG&f=1", "display_name": "not_a_generic_user", "link": "https://stackoverflow.com/users/3177186/not-a-generic-user"}, "edited": false, "score": 0, "creation_date": 1473189095, "post_id": 39354624, "comment_id": 66042411, "body": "What would a line of code that brings a url variable (or JS variable since I can get URL variables with JS) into go so I can test the logic look like?"}], "owner": {"reputation": 1318, "user_id": 3177186, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/374675543dcada464668ba2bd9539adf?s=128&d=identicon&r=PG&f=1", "display_name": "not_a_generic_user", "link": "https://stackoverflow.com/users/3177186/not-a-generic-user"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1802, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1473182589, "creation_date": 1473182589, "question_id": 39354624, "link": "https://stackoverflow.com/questions/39354624/using-url-parameters-in-golang-template-code", "title": "Using url parameters in golang template code", "body": "<p>I'm new to Go and trying to modify some code written by someone else. Right now he tests the stored value of a given day to determine if someone took lunch that day or not. </p>\n\n<p>What I want to do is see if there's a stored value and if there isn't, use the default value which is passed via URL parameter. The code looks like this:</p>\n\n<pre><code>&lt;input id=\"lunch{{.place}}\" type=\"checkbox\" {{if index .week.NoMeals .place}} checked {{end}}&gt;\n</code></pre>\n\n<p>I have a URL variable set like so:</p>\n\n<pre><code>sitename?nolunch=1\n</code></pre>\n\n<p>So the logic I want is that if the stored data for that day is set, the checkbox will reflect the stored value. If it hasn't been set, the box should be checked if the nolunch URL parameter is set and not checked if it's not.</p>\n\n<p>How do I test for url parameters in Go template code?</p>\n"}, {"tags": ["go", "pprof"], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 9476826, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ulR67.jpg?s=128&g=1", "display_name": "Haril Satra", "link": "https://stackoverflow.com/users/9476826/haril-satra"}, "is_accepted": false, "score": 1, "last_activity_date": 1563520313, "creation_date": 1563520313, "answer_id": 57107290, "question_id": 39353219, "link": "https://stackoverflow.com/questions/39353219/can-i-download-a-heap-dump-to-run-pprof-on-later/57107290#57107290", "title": "Can I download a heap dump to run pprof on later?", "body": "<p><code>go tool pprof -png http://my-server/debug/pprof/heap &gt; out.png</code> stores a proper graph for me in the <code>out.png</code> file.</p>\n"}], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 538, "favorite_count": 0, "answer_count": 1, "score": 6, "last_activity_date": 1563520313, "creation_date": 1473177390, "question_id": 39353219, "link": "https://stackoverflow.com/questions/39353219/can-i-download-a-heap-dump-to-run-pprof-on-later", "title": "Can I download a heap dump to run pprof on later?", "body": "<p>I'm trying to find a way to store the heap data from pprof so that I can share it, view it later, attach to issues and so on. My attempts so far have not worked.</p>\n\n<p>If I run</p>\n\n<p><code>go tool pprof http://my-server/debug/pprof/heap</code> and then run <code>web</code>, I get a full graph like I expect. However, If I dowload the file:</p>\n\n<p><code>wget -O heapDump http://my-server/debug/pprof/heap</code></p>\n\n<p>and try <code>go tool pprof heapDump</code>, it seems it can't do everything it needs to. I only get a very limited graph:</p>\n\n<p><a href=\"https://i.stack.imgur.com/UiUnb.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/UiUnb.png\" alt=\"enter image description here\"></a></p>\n\n<p>I have tried adding <code>?debug=1</code> and playing with different values, but none of them seem to work properly.</p>\n"}, {"tags": ["go", "bosun", "scollector"], "answers": [{"comments": [{"owner": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473178487, "post_id": 39353435, "comment_id": 66036905, "body": "It does have eth0, I have checked that. The snippet you posted works too. But when I try to use it as I do, it fails. Any pointers why."}, {"owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "reply_to_user": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473178524, "post_id": 39353435, "comment_id": 66036920, "body": "What Bosun version?"}, {"owner": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473178577, "post_id": 39353435, "comment_id": 66036951, "body": "./bosun --version bosun version 0.5.0-dev (00772aee8c27482893f885bbdbb10e26f75d7fd0) built 2016-06-22T00:47:49Z"}, {"owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "reply_to_user": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473179139, "post_id": 39353435, "comment_id": 66037246, "body": "Not sure ... What you provided would error for me because of <code>Group</code> and not <code>.Group</code>. Is the snippet different from what you are running. Maybe yo ucan post more/ I&#39;m not sure I understand how the Go struct fits in, is that something you are using in a different process?"}, {"owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "reply_to_user": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473179248, "post_id": 39353435, "comment_id": 66037300, "body": "I also don&#39;t understand where the <code>ifName</code> in the error comes from since the alert that goes with the template is not shown."}, {"owner": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473179361, "post_id": 39353435, "comment_id": 66037364, "body": "I updated the question. Had missed the &#39;.&#39; while formatting the question here."}, {"owner": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "reply_to_user": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "edited": false, "score": 0, "creation_date": 1473179612, "post_id": 39353435, "comment_id": 66037486, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/122768/discussion-between-krish7919-and-kyle-brandt\">continue this discussion in chat</a>."}, {"owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "reply_to_user": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473179613, "post_id": 39353435, "comment_id": 66037487, "body": "Might also see if host api sees it: <code>curl bosun&#47;api&#47;host | jq &#39;.&quot;ny-bosun01&quot; | .&quot;Interfaces&quot;&#39;</code> , replacing ny-bosun01 with your host 147210308125790 ( odd hostname by the way :P )"}, {"owner": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473179731, "post_id": 39353435, "comment_id": 66037537, "body": "Thanks, Kyle. The hostname is a timestamp. :) The problem seems to be translating the [IP, Mac] to the golang json struct. I think the bug is on that side. Is there a way to just extract the IP from the host?"}, {"owner": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473180008, "post_id": 39353435, "comment_id": 66037674, "body": "the ifName comes from because I measure the container.net.bytes of an interface. Will edit the question and post the alert."}, {"owner": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "edited": false, "score": 0, "creation_date": 1473228013, "post_id": 39353435, "comment_id": 66053465, "body": "alright, I could reproduce this issue and know the root cause. basically when I restart bosun container, scollector does not populate the metadata for a node again. I have opened another one here: <a href=\"http://stackoverflow.com/questions/39362190/scollector-send-metadata-for-a-node-if-bosun-restarts\" title=\"scollector send metadata for a node if bosun restarts\">stackoverflow.com/questions/39362190/&hellip;</a>"}], "tags": [], "owner": {"reputation": 23028, "user_id": 107156, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/mSIVv.jpg?s=128&g=1", "display_name": "Kyle Brandt", "link": "https://stackoverflow.com/users/107156/kyle-brandt"}, "is_accepted": true, "score": 2, "last_activity_date": 1473178139, "creation_date": 1473178139, "answer_id": 39353435, "question_id": 39352921, "link": "https://stackoverflow.com/questions/39352921/bosun-get-ip-address-of-host-using-getmeta/39353435#39353435", "title": "Bosun - Get IP address of host using .GetMeta", "body": "<p>Are you sure that the host in question as an eth0 device (and bosun has indexed that metadata)? nil means it couldn't find the entry.</p>\n\n<p>The following works for me:</p>\n\n<pre><code>template test {\n    subject = {{ .GetMeta \"\" \"addresses\" (printf \"host=%s,iface=eth0\" .Group.host) }}\n}\n</code></pre>\n"}], "owner": {"reputation": 804, "user_id": 880963, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/edacc2ea1717765faf2ab392116b7182?s=128&d=identicon&r=PG", "display_name": "krish7919", "link": "https://stackoverflow.com/users/880963/krish7919"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 39353435, "answer_count": 1, "score": 1, "last_activity_date": 1473179957, "creation_date": 1473176337, "last_edit_date": 1473179957, "question_id": 39352921, "link": "https://stackoverflow.com/questions/39352921/bosun-get-ip-address-of-host-using-getmeta", "title": "Bosun - Get IP address of host using .GetMeta", "body": "<p>I am trying to create a (golang) struct for handling bosun alerts sent over http. It holds alert details, most importantly, about the <code>eth0</code> IP address of the corresponding host.</p>\n\n<pre><code>/* This struct is defined as per the notification defined in bosun config */\ntype BosunAlert struct {\n    AckUrl       string   `json:\"ack\"`\n    AlertName    string   `json:\"alert_name\"`\n    LastStatus   string   `json:\"last_status\"`\n    IpMac        []string `json:\"ip,omitempty\"`\n}\n</code></pre>\n\n<p>The corresponding template looks as follows:</p>\n\n<pre><code>template template.bosun_listener {\n    subject = `{\n        \"ack\":\"{{.Ack}}\",\n        \"alert_name\":\"{{.Alert.Name}}\",\n        \"last_status\":\"{{.Last.Status}}\",\n        \"ip\":{{ .GetMeta \"\" \"addresses\" (printf \"host=%s,iface=eth0\" .Group.host) }}\n    }`\n    body = ``\n}\n</code></pre>\n\n<p>However, I get this error:</p>\n\n<pre><code>info: check.go:305: alert.network{host=147210308125790,ifName=server-1609}:\ntemplate: template.bosun_listener:6:12: executing \"template.bosun_listener\" at \n&lt;.GetMeta&gt;: error calling GetMeta: redigo: nil returned\n</code></pre>\n\n<p>I am using a []string for IpMac field as I cannot isolate the eth0 IP from  it's ethernet address.</p>\n\n<p>Any way to do this?</p>\n\n<p>EDIT:\nThis is the output I get:</p>\n\n<pre><code>\"ack\":\"http://localhost:8070/action?\nkey=alert.network%7Bhost%3D147210308125790%2CifName%3server-1609%7D&amp;type=ack\",\n\"alert_name\":\"alert.network\", \"last_status\":\"critical\", \"ip\":\n[\"172.31.40.31/20\",\"fe80::61:adff:feb1:1f5b/64\"] }\n</code></pre>\n\n<p>This is the alert I have configured:</p>\n\n<pre><code>alert alert.network {\n    runEvery = 5\n    $ip = \"\"\n    template = template.bosun_listener\n    $usage = avg(q(\"avg:rate:container.net.bytes{host=*,ifName=server*}\", \"5m\", \"\"))\n    crit = $usage &gt; 100\n    critNotification = notification.test\n}\n</code></pre>\n"}, {"tags": ["macos", "vim", "go", "stdin", "tty"], "comments": [{"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1473174449, "post_id": 39352292, "comment_id": 66034409, "body": "try calling c.Wait() after."}, {"owner": {"reputation": 13, "user_id": 5022755, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2tk7u9LowDw/AAAAAAAAAAI/AAAAAAAAABo/KEZV92L45hk/photo.jpg?sz=128", "display_name": "Benjamin Radovsky", "link": "https://stackoverflow.com/users/5022755/benjamin-radovsky"}, "reply_to_user": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1473174577, "post_id": 39352292, "comment_id": 66034494, "body": "Hey @AJPennster, I&#39;m currently using c.Run and not c.Start and c.Run automatically calls Wait for you."}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1473175172, "post_id": 39352292, "comment_id": 66034888, "body": "ah right, I missed that."}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1473175347, "post_id": 39352292, "comment_id": 66034995, "body": "What happens exactly when you type in the window?"}, {"owner": {"reputation": 13, "user_id": 5022755, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2tk7u9LowDw/AAAAAAAAAAI/AAAAAAAAABo/KEZV92L45hk/photo.jpg?sz=128", "display_name": "Benjamin Radovsky", "link": "https://stackoverflow.com/users/5022755/benjamin-radovsky"}, "reply_to_user": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1473175563, "post_id": 39352292, "comment_id": 66035156, "body": "For example, usually in vim if you simply type the letter i, you are placed into insert mode whereas in this case, you can continually type the letter i, but it&#39;s just ignored and placed on the screen (not actually interacting with the vim process), but sometimes after typing enter, a command such as the letter i might actually go through. I can&#39;t pin what the issue is unfortunately."}, {"owner": {"reputation": 13, "user_id": 5022755, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2tk7u9LowDw/AAAAAAAAAAI/AAAAAAAAABo/KEZV92L45hk/photo.jpg?sz=128", "display_name": "Benjamin Radovsky", "link": "https://stackoverflow.com/users/5022755/benjamin-radovsky"}, "reply_to_user": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1473175656, "post_id": 39352292, "comment_id": 66035227, "body": "This is the reason I was trying to work out the correct settings such as setting Foreground to true in SysProcAttr, since I think the issue is that the command does not run properly in the foreground in the separate tty instance."}, {"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1473182736, "post_id": 39352292, "comment_id": 66039159, "body": "If i were to do the same thing with echo &quot;hello&quot;, i get the output but I don&#39;t get the prompt after, that indicates that the command has ended. I figure that this behaviour is specific to the terminal. I&#39;m speculating, based on what i get when running it, that the problem has to do with incompatibility with the terminal and cmd.Run(). The terminal probably does some initialising or something of the sort before(and after) running the command. Whatever it does though, helps it with printing stdin/stdout/stderr of whatever command it is running. Go on the other hand just runs the command."}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 5022755, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2tk7u9LowDw/AAAAAAAAAAI/AAAAAAAAABo/KEZV92L45hk/photo.jpg?sz=128", "display_name": "Benjamin Radovsky", "link": "https://stackoverflow.com/users/5022755/benjamin-radovsky"}, "is_accepted": true, "score": 0, "last_activity_date": 1473258341, "creation_date": 1473258341, "answer_id": 39372588, "question_id": 39352292, "link": "https://stackoverflow.com/questions/39352292/why-does-this-exec-command-to-a-different-opened-tty-not-work-properly/39372588#39372588", "title": "Why does this exec.Command to a different opened tty not work properly", "body": "<p>For anybody who's interested, I came up with a solution, but I ended up having to use system calls instead of the os/exec package's functions.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nvar tty = \"/dev/ttys001\"\nvar cmd = \"vim\\n\"\n\nfunc main() {\n    ttyFile, err := os.Open(tty)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer ttyFile.Close()\n\n    cbs, err := syscall.ByteSliceFromString(cmd)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    var eno syscall.Errno\n    for _, c := range cbs {\n        _, _, eno = syscall.Syscall(syscall.SYS_IOCTL,\n            ttyFile.Fd(),\n            syscall.TIOCSTI,\n            uintptr(unsafe.Pointer(&amp;c)),\n        )\n        if eno != 0 {\n            log.Fatalln(eno)\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 5022755, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2tk7u9LowDw/AAAAAAAAAAI/AAAAAAAAABo/KEZV92L45hk/photo.jpg?sz=128", "display_name": "Benjamin Radovsky", "link": "https://stackoverflow.com/users/5022755/benjamin-radovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 593, "favorite_count": 0, "accepted_answer_id": 39372588, "answer_count": 1, "score": 0, "last_activity_date": 1473258341, "creation_date": 1473174284, "last_edit_date": 1473174508, "question_id": 39352292, "link": "https://stackoverflow.com/questions/39352292/why-does-this-exec-command-to-a-different-opened-tty-not-work-properly", "title": "Why does this exec.Command to a different opened tty not work properly", "body": "<p>Can anybody please help me figure out what I'm doing wrong here.</p>\n\n<p>I'm trying to execute a command (opening vim in this case) that runs in a different tty, in this case /dev/ttys001, which is opened in another tab in my terminal.</p>\n\n<p>Running the code below does render vim in /dev/ttys001's window, however, actually typing to stdin from that window doesn't register properly.</p>\n\n<p>Any advice is much appreciated!</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    tty, err := os.OpenFile(\"/dev/ttys001\", os.O_RDWR, os.ModePerm)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer tty.Close()\n\n    c := exec.Command(\"vim\")\n    c.Stdin = tty\n    c.Stdout = tty\n    c.Stderr = tty\n    if err := c.Run(); err != nil {\n        log.Fatalln(err)\n    }\n}\n</code></pre>\n\n<p>I have also tried setting the command's SysProcAttr field with the following code but receive the error: fork/exec /usr/local/bin/vim: inappropriate ioctl for device.</p>\n\n<pre><code>procAttr := &amp;syscall.SysProcAttr{\n    Setpgid:    true,\n    Ctty:       int(tty.Fd()),\n    Foreground: true,\n}\nc.SysProcAttr = procAttr\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1473168191, "post_id": 39349612, "comment_id": 66029907, "body": "So use what works"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6800376, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210414963069936/picture?type=large", "display_name": "Ramesh Kunhiraman", "link": "https://stackoverflow.com/users/6800376/ramesh-kunhiraman"}, "edited": false, "score": 0, "creation_date": 1473225706, "post_id": 39350291, "comment_id": 66052599, "body": "Thanks @Moshe Revah for a very good response. How can I add multiple patterns? for e.g  <code>{$match : { &quot;wordname&quot;:{$in: [&#47;^how$&#47;, &#47;^to$&#47;,&#47;^stop$&#47;, &#47;^neck$&#47;, &#47;^pain$&#47;]}}},</code>"}, {"owner": {"reputation": 11, "user_id": 6800376, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210414963069936/picture?type=large", "display_name": "Ramesh Kunhiraman", "link": "https://stackoverflow.com/users/6800376/ramesh-kunhiraman"}, "edited": false, "score": 1, "creation_date": 1473227853, "post_id": 39350291, "comment_id": 66053408, "body": "Hey Moshe. I solved the question for handling multiple patterns.  Thanks Again. <code>bson.M{&quot;$match&quot;: bson.M{&quot;wordname&quot;: bson.M{&quot;$in&quot;: []bson.RegEx{ bson.RegEx{&quot;^how$&quot;, &quot;i&quot;}},bson.RegEx{&quot;^to$&quot;,&quot;i&quot;} } }}}</code>"}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": false, "score": 1, "last_activity_date": 1473168609, "creation_date": 1473168609, "answer_id": 39350291, "question_id": 39349612, "link": "https://stackoverflow.com/questions/39349612/go-based-mongo-aggregate-query-issue/39350291#39350291", "title": "GO based Mongo Aggregate Query issue", "body": "<p>That's not how you do regex with mgo. You must use <a href=\"https://godoc.org/labix.org/v2/mgo/bson#RegEx\" rel=\"nofollow\"><code>bson.RegEx</code></a>. Try this:</p>\n\n<p><code>bson.M{\"$match\": bson.M{\"wordname\": bson.M{\"$in\": []bson.RegEx{{\"^how$\", \"i\"}}}}}</code></p>\n"}], "owner": {"reputation": 11, "user_id": 6800376, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210414963069936/picture?type=large", "display_name": "Ramesh Kunhiraman", "link": "https://stackoverflow.com/users/6800376/ramesh-kunhiraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473168609, "creation_date": 1473166681, "last_edit_date": 1473166757, "question_id": 39349612, "link": "https://stackoverflow.com/questions/39349612/go-based-mongo-aggregate-query-issue", "title": "GO based Mongo Aggregate Query issue", "body": "<p>The regular expression query in $in is not working. It works fine in the mongo shell.</p>\n\n<p>Does not work:</p>\n\n<pre><code>OpMatch := bson.M{\"$match\": bson.M{\"wordname\": bson.M{\"$in\": [...]string{\"/^how$/\"}}}}\n</code></pre>\n\n<p>Works:</p>\n\n<pre><code>OpMatch := bson.M{\"$match\": bson.M{\"wordname\": bson.M{\"$in\": [...]string{\"how\"}}}}\n</code></pre>\n"}, {"tags": ["go", "service", "centos", "command"], "comments": [{"owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "edited": false, "score": 0, "creation_date": 1473170040, "post_id": 39348993, "comment_id": 66031321, "body": "This should help guide you:<a href=\"http://unix.stackexchange.com/questions/236084/how-do-i-create-a-service-for-a-shell-script-so-i-can-start-and-stop-it-like-a-d\" title=\"how do i create a service for a shell script so i can start and stop it like a d\">unix.stackexchange.com/questions/236084/&hellip;</a>"}, {"owner": {"reputation": 472, "user_id": 2064183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f9d0065dda5ffd11d5c0f516fc2bce5?s=128&d=identicon&r=PG", "display_name": "Kyaw Myint Thein", "link": "https://stackoverflow.com/users/2064183/kyaw-myint-thein"}, "edited": false, "score": 0, "creation_date": 1473179026, "post_id": 39348993, "comment_id": 66037194, "body": "Golang app mean web app or system app?"}, {"owner": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "reply_to_user": {"reputation": 472, "user_id": 2064183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f9d0065dda5ffd11d5c0f516fc2bce5?s=128&d=identicon&r=PG", "display_name": "Kyaw Myint Thein", "link": "https://stackoverflow.com/users/2064183/kyaw-myint-thein"}, "edited": false, "score": 0, "creation_date": 1473183828, "post_id": 39348993, "comment_id": 66039795, "body": "@KyawMyintThein web app"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "edited": false, "score": 0, "creation_date": 1473233318, "post_id": 39363275, "comment_id": 66056332, "body": "I said httpd as an example , of course Go web server is enough itself, What I need is create a service file  for centos 6 to run the app. Somthing like that <a href=\"https://github.com/jpillora/cloud-torrent/wiki/Installation\" rel=\"nofollow noreferrer\">github.com/jpillora/cloud-torrent/wiki/Installation</a> but in centos 6 because it&#39;s not has systemd."}], "tags": [], "owner": {"reputation": 472, "user_id": 2064183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f9d0065dda5ffd11d5c0f516fc2bce5?s=128&d=identicon&r=PG", "display_name": "Kyaw Myint Thein", "link": "https://stackoverflow.com/users/2064183/kyaw-myint-thein"}, "is_accepted": false, "score": -1, "last_activity_date": 1473231885, "creation_date": 1473231885, "answer_id": 39363275, "question_id": 39348993, "link": "https://stackoverflow.com/questions/39348993/run-go-app-by-service/39363275#39363275", "title": "Run go app by service", "body": "<p>I assume you tried to use apache web server. Actually, Go web server is enough itself. Main purpose is to run Go web server in system service.So, you can use <strong>tmux</strong> <a href=\"https://tmux.github.io/\" rel=\"nofollow\">https://tmux.github.io/</a> or <strong>nohup</strong> to run as system service. You can also use apache or nginx web server as proxy.</p>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "edited": false, "score": 0, "creation_date": 1473425254, "post_id": 39399526, "comment_id": 66148114, "body": "Well. that&#39;s the problem , CentOS 6.8 don&#39;t have systemd. So your <code>systemctl</code> code will not work."}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "edited": false, "score": 0, "creation_date": 1473428815, "post_id": 39399526, "comment_id": 66150414, "body": "how about now @AliCoder ?"}, {"owner": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "edited": false, "score": 0, "creation_date": 1473434642, "post_id": 39399526, "comment_id": 66154378, "body": "yes that&#39;s it, I have just a problem that <code>update-rc.d coolserver defaults</code> give me <code>update-rc.d command not found</code>, also How can I put parameters like <code>--auth &quot;user:password&quot;</code>"}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "edited": false, "score": 0, "creation_date": 1473434962, "post_id": 39399526, "comment_id": 66154578, "body": "@AliCoder add the flags to your &lt;COMMAND&gt;, as you would on the command line. Things are a lil different on CentOs, I do not have a box to test this with, but read this <a href=\"http://www.cyberciti.biz/faq/rhel5-update-rcd-command/\" rel=\"nofollow noreferrer\">cyberciti.biz/faq/rhel5-update-rcd-command</a>"}, {"owner": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "edited": false, "score": 0, "creation_date": 1473437397, "post_id": 39399526, "comment_id": 66156030, "body": "I did it <code>&#47;path&#47;to&#47;coolserver --auth &quot;user:password&quot;</code> and it give me  <code>-auth: command not found</code>"}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "edited": false, "score": 0, "creation_date": 1473437536, "post_id": 39399526, "comment_id": 66156099, "body": "I have edited the answer for completness <a href=\"http://serverfault.com/questions/462067/passing-arguments-to-a-service-started-with-init-d\" title=\"passing arguments to a service started with init d\">serverfault.com/questions/462067/&hellip;</a>"}, {"owner": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "edited": false, "score": 0, "creation_date": 1473438193, "post_id": 39399526, "comment_id": 66156468, "body": "nice. Thank you very much"}], "tags": [], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "is_accepted": true, "score": 2, "last_activity_date": 1547800165, "last_edit_date": 1547800165, "creation_date": 1473365992, "answer_id": 39399526, "question_id": 39348993, "link": "https://stackoverflow.com/questions/39348993/run-go-app-by-service/39399526#39399526", "title": "Run go app by service", "body": "<p>First, you will need to build your Go binary and put it in your path.</p>\n\n<pre><code>go install main.go\n</code></pre>\n\n<p>If your \"main\" file is called main, <code>go install</code> will place a binary called \"main\" in your path, so I suggest you rename your file to whatever you call your project/server.</p>\n\n<pre><code>mv main.go coolserver.go\ngo install coolserver.go\n</code></pre>\n\n<p>You can run <code>coolserver</code> to make sure everything is fine. It will if you have your $GOPATH setup properly. </p>\n\n<p>Here it is an example of a init.d service called <code>service.sh</code></p>\n\n<pre><code>#!/bin/sh\n### BEGIN INIT INFO\n# Provides:          &lt;NAME&gt;\n# Required-Start:    $local_fs $network $named $time $syslog\n# Required-Stop:     $local_fs $network $named $time $syslog\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Description:       &lt;DESCRIPTION&gt;\n### END INIT INFO\n\nSCRIPT=&lt;COMMAND&gt;\nFLAGS=\"--auth=user:password\"\nRUNAS=&lt;USERNAME&gt;\n\nPIDFILE=/var/run/&lt;NAME&gt;.pid\nLOGFILE=/var/log/&lt;NAME&gt;.log\n\nstart() {\n  if [ -f /var/run/$PIDNAME ] &amp;&amp; kill -0 $(cat /var/run/$PIDNAME); then\n    echo 'Service already running' &gt;&amp;2\n    return 1\n  fi\n  echo 'Starting service\u2026' &gt;&amp;2\n  local CMD=\"$SCRIPT  $FLAGS &amp;&gt; \\\"$LOGFILE\\\" &amp; echo \\$!\"\n  su -c \"$CMD\" $RUNAS &gt; \"$PIDFILE\"\n  echo 'Service started' &gt;&amp;2\n}\n\nstop() {\n  if [ ! -f \"$PIDFILE\" ] || ! kill -0 $(cat \"$PIDFILE\"); then\n    echo 'Service not running' &gt;&amp;2\n    return 1\n  fi\n  echo 'Stopping service\u2026' &gt;&amp;2\n  kill -15 $(cat \"$PIDFILE\") &amp;&amp; rm -f \"$PIDFILE\"\n  echo 'Service stopped' &gt;&amp;2\n}\n\nuninstall() {\n  echo -n \"Are you really sure you want to uninstall this service? That cannot be undone. [yes|No] \"\n  local SURE\n  read SURE\n  if [ \"$SURE\" = \"yes\" ]; then\n    stop\n    rm -f \"$PIDFILE\"\n    echo \"Notice: log file is not be removed: '$LOGFILE'\" &gt;&amp;2\n    update-rc.d -f &lt;NAME&gt; remove\n    rm -fv \"$0\"\n  fi\n}\n\ncase \"$1\" in\n  start)\n    start\n    ;;\n  stop)\n    stop\n    ;;\n  uninstall)\n    uninstall\n    ;;\n  restart)\n    stop\n    start\n    ;;\n  *)\n    echo \"Usage: $0 {start|stop|restart|uninstall}\"\nesac\n</code></pre>\n\n<p>Copy to /etc/init.d:</p>\n\n<pre><code>cp \"service.sh\" \"/etc/init.d/coolserver\"\nchmod +x /etc/init.d/coolserver\n</code></pre>\n\n<h1>Remember to replace</h1>\n\n<pre><code>&lt;NAME&gt; = coolserver\n&lt;DESCRIPTION&gt; = Describe your service here (be concise)\n&lt;COMMAND&gt; = /path/to/coolserver\n&lt;USER&gt; = Login of the system user the script should be run as \n</code></pre>\n\n<p>Start and test your service and install the service to be run at boot-time:</p>\n\n<pre><code>service coolserver start\nservice coolserver stop\nupdate-rc.d coolserver defaults\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 5754013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98548f48933f4e593cf4032b28b6b117?s=128&d=identicon&r=PG", "display_name": "Ali Coder", "link": "https://stackoverflow.com/users/5754013/ali-coder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4978, "favorite_count": 2, "accepted_answer_id": 39399526, "answer_count": 2, "score": 1, "last_activity_date": 1547800165, "creation_date": 1473164700, "question_id": 39348993, "link": "https://stackoverflow.com/questions/39348993/run-go-app-by-service", "title": "Run go app by service", "body": "<p>In CentOS 6.8 I have a golang app , that run in command <code>go run main.go</code> and I need to create a system service to run it in boot like service httpd.<br>\nI know that I have to create file like <code>/etc/rc.d/init.d/httpd</code> But I don't know how to do it to run that command.</p>\n"}, {"tags": ["encryption", "go", "block-cipher"], "answers": [{"tags": [], "owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "is_accepted": false, "score": 0, "last_activity_date": 1473187440, "creation_date": 1473187440, "answer_id": 39355845, "question_id": 39347206, "link": "https://stackoverflow.com/questions/39347206/how-to-encrypt-files-with-aes256-gcm-in-golang/39355845#39355845", "title": "How to encrypt files with AES256-GCM in golang?", "body": "<p>It's not a design mistake. It's just that the API is incomplete in that regard. </p>\n\n<p>GCM is a streaming mode of operation and therefore able to handle encryption and decryption on demand without stopping the stream. It seems that you cannot reuse the same AEAD instance with the previous MAC state, so you cannot directly use this API for GCM encryption. </p>\n\n<p>You could implement your own GCM on top of <code>crypto.NewCTR</code> and your own implementation of GHASH.</p>\n"}, {"comments": [{"owner": {"reputation": 1748, "user_id": 1077158, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1062d55a6ee0f0f6c71398be71fc86bd?s=128&d=identicon&r=PG", "display_name": "can.", "link": "https://stackoverflow.com/users/1077158/can"}, "edited": false, "score": 0, "creation_date": 1473732847, "post_id": 39455193, "comment_id": 66243304, "body": "Thanks! As a suggestion, I think this explanation could be added to golang docs."}, {"owner": {"reputation": 8555, "user_id": 1402846, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/z5AzI.png?s=128&g=1", "display_name": "Pang", "link": "https://stackoverflow.com/users/1402846/pang"}, "edited": false, "score": 0, "creation_date": 1597225151, "post_id": 39455193, "comment_id": 112061104, "body": "Link to miniLock is giving <i>&quot;404 - Page not found&quot;</i>."}], "tags": [], "owner": {"reputation": 366, "user_id": 133912, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5189937e75270e3e69518b96a1f6d161?s=128&d=identicon&r=PG", "display_name": "agl", "link": "https://stackoverflow.com/users/133912/agl"}, "is_accepted": true, "score": 2, "last_activity_date": 1473699319, "last_edit_date": 1492086162, "creation_date": 1473699319, "answer_id": 39455193, "question_id": 39347206, "link": "https://stackoverflow.com/questions/39347206/how-to-encrypt-files-with-aes256-gcm-in-golang/39455193#39455193", "title": "How to encrypt files with AES256-GCM in golang?", "body": "<p>AEADs should not be used to encrypt large amounts of data in one go. The API is designed to discourage this.</p>\n\n<p>Encrypting large amounts of data in a single operation means that a) either all the data has to be held in memory or b) the API has to operate in a streaming fashion, by returning unauthenticated plaintext.</p>\n\n<p>Returning unauthenticated data is dangerous it's <a href=\"https://askubuntu.com/questions/95920/encrypt-tar-gz-file-on-create\">not\nhard</a> to find people on the internet suggesting things like <code>gpg -d your_archive.tgz.gpg | tar xz</code>because the gpg command also provides a streaming interface.</p>\n\n<p>With constructions like AES-GCM it's, of course, very easy to\nmanipulate the plaintext at will if the application doesn't\nauthenticate it before processing. Even if the application is careful\nnot to \"release\" plaintext to the UI until the authenticity has been\nestablished, a streaming design exposes more program attack surface.</p>\n\n<p>By normalising large ciphertexts and thus streaming APIs, the next\nprotocol that comes along is more likely to use them without realising\nthe issues and thus the problem persists.</p>\n\n<p>Preferably, plaintext inputs would be chunked into reasonably large\nparts (say 16KiB) and encrypted separately. The chunks only need to be\nlarge enough that the overhead from the additional authenticators is\nnegligible. With such a design, large messages can be incrementally\nprocessed without having to deal with unauthenticated plaintext, and\nAEAD APIs can be safer. (Not to mention that larger messages can be\nprocessed since AES-GCM, for one, has a 64GiB limit for a single\nplaintext.)</p>\n\n<p>Some thought is needed to ensure that the chunks are in the correct\norder, i.e. by counting nonces, that the first chunk should be first, i.e. by starting the nonce at zero, and that the last chunk should be\nlast, i.e. by appending an empty, terminator chunk with special\nadditional data. But that's not hard.</p>\n\n<p>For an example, see the chunking used in <a href=\"https://github.com/kaepora/miniLock/blob/master/README.md#-minilock\" rel=\"nofollow noreferrer\">miniLock</a>.</p>\n\n<p>Even with such a design it's still the case that an attacker can cause\nthe message to be detectably truncated. If you want to aim higher, an\nall-or-nothing transform can be used, although that requires two\npasses over the input and isn't always viable.</p>\n"}], "owner": {"reputation": 1748, "user_id": 1077158, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/1062d55a6ee0f0f6c71398be71fc86bd?s=128&d=identicon&r=PG", "display_name": "can.", "link": "https://stackoverflow.com/users/1077158/can"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3587, "favorite_count": 3, "accepted_answer_id": 39455193, "answer_count": 2, "score": 5, "last_activity_date": 1473699319, "creation_date": 1473159035, "question_id": 39347206, "link": "https://stackoverflow.com/questions/39347206/how-to-encrypt-files-with-aes256-gcm-in-golang", "title": "How to encrypt files with AES256-GCM in golang?", "body": "<p>AES256-GCM could be implemented in go as <a href=\"https://gist.github.com/cannium/c167a19030f2a3c6adbb5a5174bea3ff\" rel=\"noreferrer\">https://gist.github.com/cannium/c167a19030f2a3c6adbb5a5174bea3ff</a></p>\n\n<p>However, <code>Seal</code> method of interface <code>cipher.AEAD</code> has signature:</p>\n\n<pre><code>Seal(dst, nonce, plaintext, additionalData []byte) []byte\n</code></pre>\n\n<p>So for very large files, one must read all file contents into memory, which is unacceptable.</p>\n\n<p>A possible way is to implement <code>Reader</code>/<code>Writer</code> interfaces on <code>Seal</code> and <code>Open</code>, but shouldn't that be solved by those block cipher \"modes\" of AEAD? So I wonder if this is a design mistake of golang cipher lib, or I missed something important with GCM?</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 461, "user_id": 1250284, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f54f958174d176b2ecde9b495cedd11c?s=128&d=identicon&r=PG", "display_name": "Ravi Desai", "link": "https://stackoverflow.com/users/1250284/ravi-desai"}, "edited": false, "score": 0, "creation_date": 1531172939, "post_id": 39347390, "comment_id": 89487863, "body": "Does this still work, in the latest version of gorm?"}], "tags": [], "owner": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "is_accepted": false, "score": 0, "last_activity_date": 1473179421, "last_edit_date": 1473179421, "creation_date": 1473159577, "answer_id": 39347390, "question_id": 39346924, "link": "https://stackoverflow.com/questions/39346924/golang-gorm-use-findmodel-for-non-gorm-migrate-table/39347390#39347390", "title": "Golang: gorm use Find(&amp;model) for non gorm migrate table", "body": "<p>Found the solution:</p>\n\n<pre><code>func(TableGo) TableName() string {\n    return \"account_status\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 472, "user_id": 2064183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f9d0065dda5ffd11d5c0f516fc2bce5?s=128&d=identicon&r=PG", "display_name": "Kyaw Myint Thein", "link": "https://stackoverflow.com/users/2064183/kyaw-myint-thein"}, "is_accepted": true, "score": 0, "last_activity_date": 1473179293, "creation_date": 1473179293, "answer_id": 39353757, "question_id": 39346924, "link": "https://stackoverflow.com/questions/39346924/golang-gorm-use-findmodel-for-non-gorm-migrate-table/39353757#39353757", "title": "Golang: gorm use Find(&amp;model) for non gorm migrate table", "body": "<p>I think table name in your migration script is wrong. Because it is not in GORM convention. If you want to use that name,you can use following method in your model for custom table name.</p>\n\n<pre><code>func (m *Model) TableName() string {\n    return \"custom_table_name\"\n}\n</code></pre>\n"}], "owner": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 776, "favorite_count": 0, "accepted_answer_id": 39353757, "answer_count": 2, "score": 0, "last_activity_date": 1473179421, "creation_date": 1473158169, "question_id": 39346924, "link": "https://stackoverflow.com/questions/39346924/golang-gorm-use-findmodel-for-non-gorm-migrate-table", "title": "Golang: gorm use Find(&amp;model) for non gorm migrate table", "body": "<p>There is table <code>customer_account</code> (<code>postgres</code>) which one was migrate from YII2.</p>\n\n<p>DDL:</p>\n\n<pre><code>CREATE TABLE public.test_table (\n  id INTEGER PRIMARY KEY NOT NULL DEFAULT nextval('test_table_id_seq'::regclass),\n  data JSONB\n);\n</code></pre>\n\n<p>In go project i try to get value from this table.</p>\n\n<pre><code>type TableGo struct {\n    Id int\n    Data string `gorm:\"type:jsonb\"`\n}\n\n    table := TableGo{}\n    db.Where(\"id = ?\", 75).Find(&amp;table)\n    println(table.Data)\n</code></pre>\n\n<p>But there is <code>(pq: relation \"table_gos\" does not exist)</code>  </p>\n\n<p>How i can link structure which table without <code>db.AutoMigrate(&amp;TableGo{})</code>?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 13903, "user_id": 86388, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/cPl84.jpg?s=128&g=1", "display_name": "Tarion", "link": "https://stackoverflow.com/users/86388/tarion"}, "is_accepted": false, "score": 1, "last_activity_date": 1473155625, "creation_date": 1473155625, "answer_id": 39345982, "question_id": 39345921, "link": "https://stackoverflow.com/questions/39345921/why-does-go-unmarshaljson-receives-json-object-and-not-just-value/39345982#39345982", "title": "Why does go UnmarshalJSON receives Json Object and not just value", "body": "<p>Wow I just have the wrong type in this line:</p>\n\n<pre><code>parsed := TimeWithoutZone{}\n</code></pre>\n\n<p>must be</p>\n\n<pre><code>parsed := TimeTestObj{}\n</code></pre>\n\n<p>...</p>\n"}], "owner": {"reputation": 13903, "user_id": 86388, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/cPl84.jpg?s=128&g=1", "display_name": "Tarion", "link": "https://stackoverflow.com/users/86388/tarion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1473155625, "creation_date": 1473155499, "question_id": 39345921, "link": "https://stackoverflow.com/questions/39345921/why-does-go-unmarshaljson-receives-json-object-and-not-just-value", "title": "Why does go UnmarshalJSON receives Json Object and not just value", "body": "<p>I got the following custom type:</p>\n\n<pre><code>type TimeWithoutZone struct {\n    time.Time\n}\n</code></pre>\n\n<p>The Marshaling works fine: </p>\n\n<pre><code>const timeWithoutZoneFormat = \"2006-01-02T15:04:05\"\nfunc (t *TimeWithoutZone) MarshalJSON() ([]byte, error) {\n    stamp := fmt.Sprintf(`\"%s\"`, t.Time.Format(timeWithoutZoneFormat ))\n    return []byte(stamp), nil\n}\n</code></pre>\n\n<p>But here the date can not be parsed:</p>\n\n<pre><code>func (t *TimeWithoutZone) UnmarshalJSON(data []byte) (err error) {\n    log.Println(\"Parsing: \" + string(data))\n    t.Time, err = time.Parse(`\"` + timeWithoutZoneFormat + `\"`, string(data))\n\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>It logs: <code>Parsing: {\"time\":\"2016-09-06T11:06:16\"}</code> but I would expect it to parse just the value of <code>time</code></p>\n\n<p>What am I doing wrong? here is the related test:</p>\n\n<pre><code>type TimeTestObj struct {\n    Time TimeWithoutZone `json:\"time\"`\n}\n\nfunc TestParseDataWithoutTimezone(t *testing.T) {\n    parsed := TimeWithoutZone{}\n\n    data := `{\"time\":\"2016-09-06T11:06:16\"}`\n    err := json.Unmarshal([]byte(data), &amp;parsed)\n\n    if err != nil {\n        t.Error(err)\n    }\n\n    if parsed.Unix() != 1473152776 {\n        t.Error(parsed.Unix(), \"!=\", 1473152776)\n    }\n}\n</code></pre>\n\n<p>All the examples I find, and even the default parser from the Go time package seem to work that way...</p>\n"}, {"tags": ["c", "go", "unions", "cgo"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1473160843, "post_id": 39345285, "comment_id": 66025014, "body": "Just as you can read the values with an <code>unsafe.Pointer</code>, you should also be able to write them."}], "answers": [{"comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 0, "creation_date": 1473160862, "post_id": 39346806, "comment_id": 66025026, "body": "This is a bad idea because you introduce a dependency on endianness for no reason at all."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 1, "creation_date": 1473163370, "post_id": 39346806, "comment_id": 66026735, "body": "@FUZxxl As I wrote, I would like to know a better way to do this. If you have one, why not write an answer?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1473172480, "post_id": 39346806, "comment_id": 66033042, "body": "There no reason you need to use encoding/binary to write the value here. You have the value and the address, just assign it."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1473157834, "creation_date": 1473157834, "answer_id": 39346806, "question_id": 39345285, "link": "https://stackoverflow.com/questions/39345285/cgo-how-to-set-a-c-union-value/39346806#39346806", "title": "cgo how to set a C union value", "body": "<p>It seems that <code>cgo</code> turns the union values into byte arrays. As such, you can set them using <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow\"><code>encoding/binary</code></a>:</p>\n\n<pre><code>v._type = 0\nbinary.LittleEndian.PutUint16(v.data[:], 42)\nC.print_val(v)\n\nv._type = 1\ncstr := C.CString(\"hello world\")\ndefer C.free(unsafe.Pointer(cstr))\nbinary.LittleEndian.PutUint64(v.data[:], uint64(uintptr(unsafe.Pointer(cstr))))\nC.print_val(v)\n</code></pre>\n\n<p>This (with an appropriate <code>print_val</code> function) prints:</p>\n\n<pre><code>int16: 42\nstring: hello world\n</code></pre>\n\n<p>This is <strong>unsafe</strong> and <strong>non-portable</strong> though, so if anyone has a better way, I'll be glad to learn it.</p>\n"}], "owner": {"reputation": 621, "user_id": 2294667, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9a834b6b0c63e84c6e4f473161eec983?s=128&d=identicon&r=PG", "display_name": "Westy10101", "link": "https://stackoverflow.com/users/2294667/westy10101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1473158333, "creation_date": 1473153696, "question_id": 39345285, "link": "https://stackoverflow.com/questions/39345285/cgo-how-to-set-a-c-union-value", "title": "cgo how to set a C union value", "body": "<p>Given I have a C structure as below. I am able to read the data union values using unsafe pointers but am unable to work out how I can set the union value data?  </p>\n\n<pre><code> typedef struct val {\n    char *var1;\n\n    type type;\n\n    union {\n        char *binary_val;      \n        char *bits_val;        \n        bool bool_val;         \n        double decimal64_val;  \n        char *enum_val;        \n        char *identityref_val; \n        char *instanceid_val;   \n        int8_t int8_val;       \n        int16_t int16_val;    \n        int32_t int32_val;     \n        int64_t int64_val;     \n        char *string_val;   \n        uint8_t uint8_val;      \n        uint16_t uint16_val;   \n        uint32_t uint32_val;   \n        uint64_t uint64_val;   \n    } data;\n} val_t;\n</code></pre>\n\n<p>Is there a way without creating helper methods in C? An example of setting string_val would be perfect? I am aware that Go represents a union as a byte array with the longest type setting the length of the byte array.</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "edited": false, "score": 0, "creation_date": 1473220405, "post_id": 39343282, "comment_id": 66051203, "body": "<a href=\"https://github.com/golang/mock\" rel=\"nofollow noreferrer\">github.com/golang/mock</a>"}, {"owner": {"reputation": 310, "user_id": 5459095, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-GXVoHKG4x18/AAAAAAAAAAI/AAAAAAAAABE/atHidsy_iF0/photo.jpg?sz=128", "display_name": "Klaus Ma", "link": "https://stackoverflow.com/users/5459095/klaus-ma"}, "reply_to_user": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "edited": false, "score": 0, "creation_date": 1473397348, "post_id": 39343282, "comment_id": 66133681, "body": "@SachinNambiarNalavattanon , not sure which one is more popular, gmock or testify/mock ?"}], "answers": [{"comments": [{"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1473149161, "post_id": 39343676, "comment_id": 66017674, "body": "BTW you should declare an interface that is fulfilled by MyClass and FakeMyClass, so you can happily pass either type in to functions in the rest of your code"}, {"owner": {"reputation": 1105, "user_id": 1117937, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8df761b88deb3c8709ac8c909f565092?s=128&d=identicon&r=PG", "display_name": "DAB", "link": "https://stackoverflow.com/users/1117937/dab"}, "edited": false, "score": 0, "creation_date": 1521664408, "post_id": 39343676, "comment_id": 85833797, "body": "I&#39;ve been able to do this, but if i try to pass mc (FakeMyClass) into a function that requires MyClass - i get a type mismatch error. Is there a way i can pass this in for dependency injection?"}, {"owner": {"reputation": 1105, "user_id": 1117937, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/8df761b88deb3c8709ac8c909f565092?s=128&d=identicon&r=PG", "display_name": "DAB", "link": "https://stackoverflow.com/users/1117937/dab"}, "edited": false, "score": 0, "creation_date": 1521811895, "post_id": 39343676, "comment_id": 85903875, "body": "I found what I was doing wrong. I had my receivers as pointers as the above example, but i had a constructor returning the sctruct and not a pointer to the struct. So somehow it connects the dots implicitly"}], "tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": false, "score": 2, "last_activity_date": 1473153733, "last_edit_date": 1473153733, "creation_date": 1473149030, "answer_id": 39343676, "question_id": 39343282, "link": "https://stackoverflow.com/questions/39343282/how-to-build-mock-class-in-golang/39343676#39343676", "title": "How to build mock class in golang?", "body": "<p>I prefer to use <a href=\"https://github.com/stretchr/testify\" rel=\"nofollow\"><code>github.com/stretchr/testify/tree/master/mock</code></a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/stretchr/testify/mock\"\n)\n\ntype MyClass struct {\n}\n\nfunc (*MyClass) Object() (int) {\n    return 0\n}\n\nfunc (mc *MyClass) PrintInfo() {\n    fmt.Printf(\"%v\\n\", mc.Object())\n}\n\ntype FakeMyClass struct {\n    mock.Mock\n}\n\nfunc (fmc *FakeMyClass) Object() (int) {\n    args := fmc.Called()\n    return args.Int(0)\n}\nfunc (fmc *FakeMyClass) PrintInfo() {\n    fmt.Printf(\"%v\\n\", fmc.Object())\n}\n\nfunc main() {\n    mc := &amp;FakeMyClass{}\n    mc.On(\"Object\").Return(1)\n    mc.PrintInfo()\n    //mc.AssertExpectations(t)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1473149247, "post_id": 39343685, "comment_id": 66017715, "body": "this was the approach I used before finding testify/mock, this works great too"}, {"owner": {"reputation": 51, "user_id": 3955969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xIY1I.png?s=128&g=1", "display_name": "fitzy101", "link": "https://stackoverflow.com/users/3955969/fitzy101"}, "reply_to_user": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1473149662, "post_id": 39343685, "comment_id": 66017959, "body": "I like the look of testify/mock too (haven&#39;t actually used it before), I guess its dependant on the OP wanting to introduce extra package dependencies or not."}], "tags": [], "owner": {"reputation": 51, "user_id": 3955969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xIY1I.png?s=128&g=1", "display_name": "fitzy101", "link": "https://stackoverflow.com/users/3955969/fitzy101"}, "is_accepted": false, "score": 0, "last_activity_date": 1473149062, "creation_date": 1473149062, "answer_id": 39343685, "question_id": 39343282, "link": "https://stackoverflow.com/questions/39343282/how-to-build-mock-class-in-golang/39343685#39343685", "title": "How to build mock class in golang?", "body": "<p>You can make a struct that returns mocked functions, which you pass in with each test case for values you want returned. For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype MyClass struct{}\n\nfunc (*MyClass) Object() int {\n    return 0\n}\nfunc (mc *MyClass) PrintInfo() {\n    fmt.Printf(\"%v\\n\", mc.Object())\n}\n\ntype FakeMyClass struct {\n     ObjectMock: func() int\n}\n\nfunc (fm *FakeMyClass) Object() int {\n    return fm.ObjectMock()\n}\nfunc (fm *FakeMyClass) PrintInfo() {\n    fmt.Printf(\"%v\\n\", fm.Object())\n}\n\nfunc main() {\n\n    mc := &amp;FakeMyClass{\n        // Create the mocked function here, to be called when the Object() function is called.\n        ObjectMock: func() int {\n            return 0\n        }\n    }\n\n    mc.PrintInfo()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15285, "user_id": 113158, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/48b539a26d13f6c9e40081805d8f47ac?s=128&d=identicon&r=PG", "display_name": "Jean Hominal", "link": "https://stackoverflow.com/users/113158/jean-hominal"}, "is_accepted": false, "score": 0, "last_activity_date": 1473149104, "creation_date": 1473149104, "answer_id": 39343703, "question_id": 39343282, "link": "https://stackoverflow.com/questions/39343282/how-to-build-mock-class-in-golang/39343703#39343703", "title": "How to build mock class in golang?", "body": "<p>You are looking for virtual dispatch on the <code>Object()</code> method. The only form of virtual dispatch that I know of in Go is to use interfaces.</p>\n\n<p><code>PrintInfo</code> will then be a function that uses that interface type.</p>\n\n<p>E.g.:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype WithObject interface {\n    Object() int\n}\n\nfunc PrintInfo(wo WithObject) {\n    fmt.Printf(\"%v\\n\", wo.Object())\n}\n\ntype MyClass struct {\n}\n\nfunc (*MyClass) Object() (int) {\n    return 0\n}\n\ntype FakeMyClass struct {\n    MyClass\n}\n\nfunc (*FakeMyClass) Object() (int) {\n    return 1\n}\n\nfunc main() {\n    fmc := &amp;FakeMyClass{}\n    PrintInfo(fmc)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 189, "user_id": 1773858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/510f80ebcc789a222a7e7434dfbb8afa?s=128&d=identicon&r=PG", "display_name": "Abhishek Srivastava", "link": "https://stackoverflow.com/users/1773858/abhishek-srivastava"}, "is_accepted": false, "score": 1, "last_activity_date": 1496206384, "creation_date": 1496206384, "answer_id": 44275920, "question_id": 39343282, "link": "https://stackoverflow.com/questions/39343282/how-to-build-mock-class-in-golang/44275920#44275920", "title": "How to build mock class in golang?", "body": "<p>I used mockgen for it:</p>\n\n<p>mockgen -source myModule.go -package myPackage -destination myModuleMock.go</p>\n\n<p>You can install it by:\ngot get github.com/golang/mock</p>\n"}], "owner": {"reputation": 310, "user_id": 5459095, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-GXVoHKG4x18/AAAAAAAAAAI/AAAAAAAAABE/atHidsy_iF0/photo.jpg?sz=128", "display_name": "Klaus Ma", "link": "https://stackoverflow.com/users/5459095/klaus-ma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1573, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1496206384, "creation_date": 1473147753, "question_id": 39343282, "link": "https://stackoverflow.com/questions/39343282/how-to-build-mock-class-in-golang", "title": "How to build mock class in golang?", "body": "<p>I'm trying to build mock class for unit test in golang; does anyone know how to do that? For example, in the following code slice, I'd like to print FakeMyClass.Object's return value.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype MyClass struct {\n}\n\nfunc (*MyClass) Object() (int) {\n    return 0\n}\n\nfunc (mc *MyClass) PrintInfo() {\n    fmt.Printf(\"%v\\n\", mc.Object())\n}\n\ntype FakeMyClass struct {\n    MyClass\n}\n\nfunc (*FakeMyClass) Object() (int) {\n    return 1\n}\n\nfunc main() {\n    mc := &amp;FakeMyClass{}\n    mc.PrintInfo()\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 6265, "user_id": 3387925, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/mtLre.jpg?s=128&g=1", "display_name": "Mayank Patel", "link": "https://stackoverflow.com/users/3387925/mayank-patel"}, "is_accepted": true, "score": 3, "last_activity_date": 1473141314, "creation_date": 1473141314, "answer_id": 39341532, "question_id": 39341513, "link": "https://stackoverflow.com/questions/39341513/go-vet-panic-inconsistent-import/39341532#39341532", "title": "go vet panic: inconsistent import", "body": "<p>This happens when there is any incompatible file in the <code>$GOPATH/pkg</code> after upgrading the go version. Clean your GOPATH/pkg and build again to resolve this problem.</p>\n\n<pre><code>rm -rf $GOPATH/pkg/\ngo build\ngo vet ./...\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 5141019, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/fc929e8e8da518d6cf4ce1a946fdf043?s=128&d=identicon&r=PG&f=1", "display_name": "Priyaranjan", "link": "https://stackoverflow.com/users/5141019/priyaranjan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 214, "favorite_count": 0, "accepted_answer_id": 39341532, "answer_count": 1, "score": 2, "last_activity_date": 1473141314, "creation_date": 1473141251, "question_id": 39341513, "link": "https://stackoverflow.com/questions/39341513/go-vet-panic-inconsistent-import", "title": "go vet panic: inconsistent import", "body": "<p>When I run <code>go vet ./...</code>, I am go vet is panicking with following output:</p>\n\n<pre><code>% go version \ngo version go1.6.2 darwin/amd64 \n% go vet ./... \n% go version \ngo version go1.7beta1 darwin/amd64 \n% go vet ./... panic: inconsistent import:\n    var crypto/rand.Reader io.Reader previously imported as:\n    var Reader io.Reader  [recovered]\n    panic: inconsistent import:\n    var crypto/rand.Reader io.Reader previously imported as:\n    var Reader io.Reader\n\n\ngoroutine 1 [running]: panic(0x25f720, 0xc4203fc1f0)\n    /usr/local/go/src/runtime/panic.go:500 +0x1a1 go/types.(*Checker).handleBailout(0xc4200b61c0, 0xc4200c78e8)\n    /usr/local/go/src/go/types/check.go:213 +0xae panic(0x25f720, 0xc4203fc1f0)\n    /usr/local/go/src/runtime/panic.go:458 +0x243 go/internal/gcimporter.(*importer).declare(0xc42008e000, 0x3d81c0, 0xc4203ea5f0)\n    /usr/local/go/src/go/internal/gcimporter/bimport.go:173 +0x17c go/internal/gcimporter.(*importer).obj(0xc42008e000, 0xfffffffffffffffc)\n    /usr/local/go/src/go/internal/gcimporter/bimport.go:193 +0x1af go/internal/gcimporter.BImportData(0xc42000af00, 0xc420334000, 0x703e, 0x7e00, 0xc420166a51, 0xb, 0x0, 0xb, 0xc4203f4ff0, 0xc4200c70c8)\n    /usr/local/go/src/go/internal/gcimporter/bimport.go:86 +0x34c go/internal/gcimporter.Import(0xc42000af00, 0xc420166a51, 0xb, 0x7fff5fbff610, 0x8, 0xc420320190, 0x0, 0x0)\n    /usr/local/go/src/go/internal/gcimporter/gcimporter.go:166 +0x551 go/importer.gcimports.ImportFrom(0xc42000af00, 0xc420166a51, 0xb, 0x7fff5fbff610, 0x8, 0x0, 0xc4202d55e0, 0x0, 0x0)\n    /usr/local/go/src/go/importer/importer.go:70 +0x67 go/types.(*Checker).collectObjects(0xc4200b61c0)\n    /usr/local/go/src/go/types/resolver.go:191 +0x81d go/types.(*Checker).checkFiles(0xc4200b61c0, 0xc42018b600, 0x2, 0x2, 0x0, 0x0)\n    /usr/local/go/src/go/types/check.go:225 +0xaa go/types.(*Checker).Files(0xc4200b61c0, 0xc42018b600, 0x2, 0x2, 0xc420192a80, 0xc4200cb960)\n    /usr/local/go/src/go/types/check.go:218 +0x49 go/types.(*Config).Check(0xc42018d9c0, 0xc420015817, 0x5, 0xc420013f00, 0xc42018b600, 0x2, 0x2, 0xc420187400, 0x45e000, 0x0, ...)\n    /usr/local/go/src/go/types/api.go:344 +0x19f main.(*Package).check(0xc42001a8a0, 0xc420013f00, 0xc42018b600, 0x2, 0x2, 0xc42018b610, 0x1)\n    /usr/local/go/src/cmd/vet/types.go:76 +0x36c main.doPackage(0x2b769c, 0x1, 0xc42000a220, 0x2, 0x2, 0x0)\n    /usr/local/go/src/cmd/vet/main.go:333 +0x992 main.main()\n    /usr/local/go/src/cmd/vet/main.go:241 +0x335 exit status 2 panic: inconsistent import:\n    var time.UTC *time.Location previously imported as:\n    var UTC *time.Location  [recovered]\n    panic: inconsistent import:\n    var time.UTC *time.Location previously imported as:\n    var UTC *time.Location\n\n\ngoroutine 1 [running]: panic(0x25f720, 0xc420141b10)\n    /usr/local/go/src/runtime/panic.go:500 +0x1a1 go/types.(*Checker).handleBailout(0xc4200ce1c0, 0xc42004b8d8)\n    /usr/local/go/src/go/types/check.go:213 +0xae panic(0x25f720, 0xc420141b10)\n    /usr/local/go/src/runtime/panic.go:458 +0x243 go/internal/gcimporter.(*importer).declare(0xc4200a2cc0, 0x3d81c0, 0xc4205f6d70)\n    /usr/local/go/src/go/internal/gcimporter/bimport.go:173 +0x17c go/internal/gcimporter.(*importer).obj(0xc4200a2cc0, 0xfffffffffffffffc)\n    /usr/local/go/src/go/internal/gcimporter/bimport.go:193 +0x1af go/internal/gcimporter.BImportData(0xc42007ae40, 0xc42035a000, 0x3a210, 0x3fe00, 0xc42007995b, 0x4, 0x0, 0x4, 0xc4201392f0, 0xc42004b0b8)\n    /usr/local/go/src/go/internal/gcimporter/bimport.go:86 +0x34c go/internal/gcimporter.Import(0xc42007ae40, 0xc42007995b, 0x4, 0x7fff5fbff598, 0x7, 0xc4205b7040, 0x0, 0x0)\n    /usr/local/go/src/go/internal/gcimporter/gcimporter.go:166 +0x551 go/importer.gcimports.ImportFrom(0xc42007ae40, 0xc42007995b, 0x4, 0x7fff5fbff598, 0x7, 0x0, 0xc42017ec80, 0x0, 0x0)\n    /usr/local/go/src/go/importer/importer.go:70 +0x67 go/types.(*Checker).collectObjects(0xc4200ce1c0)\n    /usr/local/go/src/go/types/resolver.go:191 +0x81d go/types.(*Checker).checkFiles(0xc4200ce1c0, 0xc42018b600, 0x8, 0x8, 0x0, 0x0)\n    /usr/local/go/src/go/types/check.go:225 +0xaa go/types.(*Checker).Files(0xc4200ce1c0, 0xc42018b600, 0x8, 0x8, 0xc420199800, 0xc4200e3960)\n    /usr/local/go/src/go/types/check.go:218 +0x49 go/types.(*Config).Check(0xc420193cc0, 0xc420079667, 0x7, 0xc420095c00, 0xc42018b600, 0x8, 0x8, 0xc420194b40, 0x45e4b0, 0x0, ...)\n    /usr/local/go/src/go/types/api.go:344 +0x19f main.(*Package).check(0xc420076a80, 0xc420095c00, 0xc42018b600, 0x8, 0x8, 0x0, 0xc4200b9980)\n    /usr/local/go/src/cmd/vet/types.go:76 +0x36c main.doPackage(0x2b769c, 0x1, 0xc420098010, 0x8, 0x8, 0x0)\n    /usr/local/go/src/cmd/vet/main.go:333 +0x992 main.main()\n    /usr/local/go/src/cmd/vet/main.go:241 +0x335 exit status 2 panic: inconsistent import:\n    func errors.New(text string) error previously imported as:\n    func errors.New(text string) error  [recovered]\n    panic: inconsistent import:\n    func errors.New(text string) error previously imported as:\n    func errors.New(text string) error\n\n\ngoroutine 1 [running]: panic(0x25f720, 0xc4203f73c0)\n    /usr/local/go/src/runtime/panic.go:500 +0x1a1 go/types.(*Checker).handleBailout(0xc4200b61c0, 0xc4200c98e8)\n    /usr/local/go/src/go/types/check.go:213 +0xae panic(0x25f720, 0xc4203f73c0)\n    /usr/local/go/src/runtime/panic.go:458 +0x243 go/internal/gcimporter.(*importer).declare(0xc4204b60c0, 0x3d7ea0, 0xc4203fe460)\n    /usr/local/go/src/go/internal/gcimporter/bimport.go:173 +0x17c go/internal/gcimporter.(*importer).obj(0xc4204b60c0, 0xfffffffffffffffb)\n    /usr/local/go/src/go/internal/gcimporter/bimport.go:201 +0x49d go/internal/gcimporter.BImportData(0xc420014ea0, 0xc420406000, 0xb62, 0xe00, 0xc420169771, 0x6, 0x0, 0x6, 0x10, 0x10)\n    /usr/local/go/src/go/internal/gcimporter/bimport.go:86 +0x34c go/internal/gcimporter.Import(0xc420014ea0, 0xc420169771, 0x6, 0x7fff5fbff5f0, 0x5, 0xc420430f00, 0x0, 0x0)\n    /usr/local/go/src/go/internal/gcimporter/gcimporter.go:166 +0x551 go/importer.gcimports.ImportFrom(0xc420014ea0, 0xc420169771, 0x6, 0x7fff5fbff5f0, 0x5, 0x0, 0x1, 0x2, 0x0)\n    /usr/local/go/src/go/importer/importer.go:70 +0x67 go/types.(*Checker).collectObjects(0xc4200b61c0)\n    /usr/local/go/src/go/types/resolver.go:191 +0x81d go/types.(*Checker).checkFiles(0xc4200b61c0, 0xc42017df00, 0x4, 0x4, 0x0, 0x0)\n    /usr/local/go/src/go/types/check.go:225 +0xaa go/types.(*Checker).Files(0xc4200b61c0, 0xc42017df00, 0x4, 0x4, 0xc420192360, 0xc4200c9960)\n    /usr/local/go/src/go/types/check.go:218 +0x49 go/types.(*Config).Check(0xc42018b700, 0xc420017837, 0x5, 0xc420013e80, 0xc42017df00, 0x4, 0x4, 0xc42017fdb0, 0x45e000, 0x0, ...)\n    /usr/local/go/src/go/types/api.go:344 +0x19f main.(*Package).check(0xc42001a960, 0xc420013e80, 0xc42017df00, 0x4, 0x4, 0x0, 0xc420011880)\n    /usr/local/go/src/cmd/vet/types.go:76 +0x36c main.doPackage(0x2b769c, 0x1, 0xc42000a1a0, 0x4, 0x4, 0x0)\n    /usr/local/go/src/cmd/vet/main.go:333 +0x992 main.main()\n    /usr/local/go/src/cmd/vet/main.go:241 +0x335 exit status 2\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12699, "user_id": 1914652, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/iZiGj.jpg?s=128&g=1", "display_name": "Subtubes", "link": "https://stackoverflow.com/users/1914652/subtubes"}, "edited": false, "score": 0, "creation_date": 1473133453, "post_id": 39340219, "comment_id": 66011581, "body": "Why was this down voted ? it is a legitimate questions"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1473145841, "post_id": 39340219, "comment_id": 66015787, "body": "Just because something is a legitimate question doesn&#39;t make it into an interesting question or something valuable for other users."}], "answers": [{"comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1473137395, "post_id": 39340272, "comment_id": 66012482, "body": "Totally agree about the busy for loop, but getting rid of it as the code stands now will yield zero output on all platforms because the program will exit immediately before the goroutines have a chance to run."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1473138528, "post_id": 39340272, "comment_id": 66012794, "body": "@sberry Please excuse my sloppy expression. With &quot;get rid of&quot; I didn&#39;t mean &quot;delete it entirely&quot; but &quot;replace with something which yields to the scheduler&quot;."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1473139900, "post_id": 39340272, "comment_id": 66013178, "body": "+1, but you should change the wording and perhaps give an example like a <code>waitGroup</code>, <code>runtime.Goexit()</code>, read from nil / empty channel, etc, etc."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1473133016, "creation_date": 1473133016, "answer_id": 39340272, "question_id": 39340219, "link": "https://stackoverflow.com/questions/39340219/why-wont-go-print-from-thread-after-infinit-go-routine-on-ubuntu/39340272#39340272", "title": "Why wont go print from thread after infinit go routine on Ubuntu", "body": "<p>A busy-wait <code>for {}</code>-loop does not yield to the scheduler and so your goroutines might or might not be able to run. This has nothing to do with the OS; just get rid of the <code>for {}</code> loop.</p>\n"}], "owner": {"reputation": 12699, "user_id": 1914652, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/iZiGj.jpg?s=128&g=1", "display_name": "Subtubes", "link": "https://stackoverflow.com/users/1914652/subtubes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1473133504, "creation_date": 1473132535, "last_edit_date": 1473133504, "question_id": 39340219, "link": "https://stackoverflow.com/questions/39340219/why-wont-go-print-from-thread-after-infinit-go-routine-on-ubuntu", "title": "Why wont go print from thread after infinit go routine on Ubuntu", "body": "<p>I have a go program that looks like this on Ubuntu </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n\n    count := 2\n\n    for i := 0; i &lt; count; i++ {\n\n        go  ping()\n    }\n\n    for  {}\n}\n\nfunc ping() {\n\n    for {\n        time.Sleep(time.Second )\n        fmt.Println(\"hello world\")\n\n    }\n}\n</code></pre>\n\n<p>The idea was to call the go routine twice and then in each running of the go routine I would wait 1 seconds and then print <code>\"hello world\"</code> however the output from this program on ubuntu is no output. It seems to work on OSX </p>\n\n<p>here is the output from OSX:</p>\n\n<p><img src=\"https://www.dropbox.com/s/7ffoke49ubdcdlf/Screenshot%202016-09-05%2020.27.21.png?dl=1\" alt=\"\"></p>\n\n<p>on Ubuntu the output looks like this </p>\n\n<p><img src=\"https://www.dropbox.com/s/4l4yp2iurc8x48y/Screenshot%202016-09-05%2020.25.34.png?dl=1\" alt=\"\"></p>\n\n<p>Is there a reason for this madness?\nAm I doing something wrong that perhaps is being handled differently on two different Operating Systems?</p>\n\n<p>Why does Ubuntu show no output? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 904, "user_id": 6080206, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e004f9854173d82f6fd3c70d38ba3a77?s=128&d=identicon&r=PG&f=1", "display_name": "John Zeng", "link": "https://stackoverflow.com/users/6080206/john-zeng"}, "edited": false, "score": 0, "creation_date": 1473127879, "post_id": 39339557, "comment_id": 66010512, "body": "I am using mac and go version is 1.6. I ran your code and everything is fine....."}, {"owner": {"reputation": 41, "user_id": 6798196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c40070f02a2cc7f545c50f58bf4f22?s=128&d=identicon&r=PG&f=1", "display_name": "tsjsdbd", "link": "https://stackoverflow.com/users/6798196/tsjsdbd"}, "reply_to_user": {"reputation": 904, "user_id": 6080206, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e004f9854173d82f6fd3c70d38ba3a77?s=128&d=identicon&r=PG&f=1", "display_name": "John Zeng", "link": "https://stackoverflow.com/users/6080206/john-zeng"}, "edited": false, "score": 0, "creation_date": 1473211938, "post_id": 39339557, "comment_id": 66049630, "body": "so this can Golang&#39;s problem? I&#39;m using Ubuntu 14.04 LTS"}, {"owner": {"reputation": 904, "user_id": 6080206, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e004f9854173d82f6fd3c70d38ba3a77?s=128&d=identicon&r=PG&f=1", "display_name": "John Zeng", "link": "https://stackoverflow.com/users/6080206/john-zeng"}, "edited": false, "score": 0, "creation_date": 1473216125, "post_id": 39339557, "comment_id": 66050375, "body": "I am not sure because I can&#39;t reproduce this error on my laptop."}, {"owner": {"reputation": 904, "user_id": 6080206, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e004f9854173d82f6fd3c70d38ba3a77?s=128&d=identicon&r=PG&f=1", "display_name": "John Zeng", "link": "https://stackoverflow.com/users/6080206/john-zeng"}, "edited": false, "score": 0, "creation_date": 1473216440, "post_id": 39339557, "comment_id": 66050420, "body": "I searched about the stack on google, and I found some issues for the likely stacks, refer to <a href=\"https://github.com/golang/go/issues/16069\" rel=\"nofollow noreferrer\">this</a> , it seems that there are some problem for amd64 version of golang."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 6798196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c40070f02a2cc7f545c50f58bf4f22?s=128&d=identicon&r=PG&f=1", "display_name": "tsjsdbd", "link": "https://stackoverflow.com/users/6798196/tsjsdbd"}, "edited": false, "score": 0, "creation_date": 1473170627, "post_id": 39341223, "comment_id": 66031719, "body": "but you can see in Go code,Run also call Wait() function, is that mean Run need waiting the result like Output.<code>func (c *Cmd) Run() error { \tif err := c.Start(); err != nil { \t\treturn err \t} \treturn c.Wait() }</code>"}, {"owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "reply_to_user": {"reputation": 41, "user_id": 6798196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c40070f02a2cc7f545c50f58bf4f22?s=128&d=identicon&r=PG&f=1", "display_name": "tsjsdbd", "link": "https://stackoverflow.com/users/6798196/tsjsdbd"}, "edited": false, "score": 0, "creation_date": 1473213321, "post_id": 39341223, "comment_id": 66049856, "body": "@tsjsdbd it waits for result of /bin/bash, not an output of child process."}, {"owner": {"reputation": 904, "user_id": 6080206, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/e004f9854173d82f6fd3c70d38ba3a77?s=128&d=identicon&r=PG&f=1", "display_name": "John Zeng", "link": "https://stackoverflow.com/users/6080206/john-zeng"}, "edited": false, "score": 0, "creation_date": 1473216566, "post_id": 39341223, "comment_id": 66050439, "body": "So why does the program crash..... I am also very interesting about this question..."}], "tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": false, "score": 3, "last_activity_date": 1473139713, "creation_date": 1473139713, "answer_id": 39341223, "question_id": 39339557, "link": "https://stackoverflow.com/questions/39339557/golang-exec-output-stuck-but-run-is-ok/39341223#39341223", "title": "golang exec Output() stuck, but Run() is OK", "body": "<p>What you are seeing is normal behaviour, but it's a little unusual. What happens is your program forks /bin/bash, which forks test.sh, which forks sleep.sh. Now you are waiting on Output, which means the stdout from the command you executed, /bin/bash, which has forked test.sh, then returned.</p>\n\n<p>So, why does this behave differently when you just call cmd.Run ? Because your program forks /bin/bash, which then forks test.sh, and returns. Your program is not waiting to read the output of the program, it's just looking for the exit status of /bin/bash, which returns immediately.</p>\n\n<p>Here are some exercises:</p>\n\n<ol>\n<li>Modify your code sample to use cmd.StdoutPipe</li>\n<li>Observe the changes in behaviour between waiting on cmd.StdoutPipe().Read() to return io.EOF (ioutils.ReadAll will be useful here) and another goroutine waiting on cmd.Run(). Be sure not to let your main goroutine exit til the other one reading from the pipe has exited.</li>\n</ol>\n"}], "owner": {"reputation": 41, "user_id": 6798196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4c40070f02a2cc7f545c50f58bf4f22?s=128&d=identicon&r=PG&f=1", "display_name": "tsjsdbd", "link": "https://stackoverflow.com/users/6798196/tsjsdbd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1875, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1473221375, "creation_date": 1473126811, "last_edit_date": 1473221375, "question_id": 39339557, "link": "https://stackoverflow.com/questions/39339557/golang-exec-output-stuck-but-run-is-ok", "title": "golang exec Output() stuck, but Run() is OK", "body": "<p>when I execute an go exec command, it stucks, I don't know why?<br>\nthe Go code:</p>\n\n<pre><code>func main() {\n    cmd := exec.Command(\"/bin/bash\", \"test.sh\")\n    _, err := cmd.Output()\n    //err := cmd.Run()\n    if err != nil {\n            fmt.Println(err)\n    } else {\n            fmt.Println(\"out\")\n    }\n}\n</code></pre>\n\n<p>as show in the code, if use Run(), it's OK.  </p>\n\n<p>the test.sh:</p>\n\n<pre><code>#!/bin/bash\n./sleep.sh &amp;\n</code></pre>\n\n<p>it call another shell script, run sleep.sh in background</p>\n\n<p>the sleep.sh:</p>\n\n<pre><code>#!/bin/bash\nwhile true\ndo\n  echo hello &gt;&gt; test.txt\n  sleep 30\ndone\n</code></pre>\n\n<p>it never quit, always run in the background. </p>\n\n<p>you can see actually it will not output anything to stdout, but Output() will Stuck, Run() can just fine. the source code of Go show Output() will call Run(). so why? </p>\n\n<p>some GDB info when the program stuck:</p>\n\n<pre><code>(gdb) info goroutines\n  1 waiting  runtime.gopark\n  2 waiting  runtime.gopark\n  3 waiting  runtime.gopark\n  4 waiting  runtime.gopark\n* 5 syscall  syscall.Syscall\n\n(gdb) goroutine 5 bt\n#0  syscall.Syscall () at /usr/local/go/src/syscall/asm_linux_amd64.s:19\n#1  0x00000000004acf2f in syscall.read (fd=4, p= []uint8 = {...}, n=4254696, err=...) at /usr/local/go/src/syscall/zsyscall_linux_amd64.go:783\n#2  0x00000000004ac73d in syscall.Read (fd=4, p= []uint8 = {...}, n=859530501352, err=...) at /usr/local/go/src/syscall/syscall_unix.go:160\n#3  0x0000000000487703 in os.(*File).read (f=0xc82002c030, b= []uint8 = {...}, n=859530919936, err=...) at /usr/local/go/src/os/file_unix.go:211\n#4  0x0000000000484f3a in os.(*File).Read (f=0xc82002c030, b= []uint8 = {...}, n=0, err=...) at /usr/local/go/src/os/file.go:95\n#5  0x00000000004a5c6f in bytes.(*Buffer).ReadFrom (b=0xc8200140e0, r=..., n=0, err=...) at /usr/local/go/src/bytes/buffer.go:173\n#6  0x0000000000482160 in io.copyBuffer (dst=..., src=..., buf= []uint8, written=0, err=...) at /usr/local/go/src/io/io.go:375\n#7  0x0000000000481fa4 in io.Copy (dst=..., src=..., written=0, err=...) at /usr/local/go/src/io/io.go:351\n#8  0x000000000047262b in os/exec.(*Cmd).writerDescriptor.func1 (~r0=...) at /usr/local/go/src/os/exec/exec.go:232\n#9  0x00000000004726cd in os/exec.(*Cmd).Start.func1 (c=0xc820088000, fn={void (error *)} 0xc820029fb8) at /usr/local/go/src/os/exec/exec.go:340\n#10 0x0000000000456241 in runtime.goexit () at /usr/local/go/src/runtime/asm_amd64.s:1721\n#11 0x000000c820088000 in ?? ()\n#12 0x000000c82000c140 in ?? ()\n#13 0x0000000000000000 in ?? ()\n</code></pre>\n"}, {"tags": ["go", "channel"], "answers": [{"tags": [], "owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "is_accepted": true, "score": 6, "last_activity_date": 1473120486, "creation_date": 1473120486, "answer_id": 39338978, "question_id": 39338951, "link": "https://stackoverflow.com/questions/39338951/why-does-select-in-golang-only-works-with-channels-in-goroutine/39338978#39338978", "title": "Why does select in golang only works with channels in goroutine?", "body": "<blockquote>\n  <p>Shouldn't the code execute in a sequential manner in the first case so that by the time the select statement is reached, the msg will be passed and it will catch the case msg := &lt;-messages ?</p>\n</blockquote>\n\n<p>The select statement is never reached, thats the problem in your first code.</p>\n\n<p>The statement</p>\n\n<pre><code>messages &lt;- \"my msg\"\n</code></pre>\n\n<p>Wants to push a string into the channel, but since you created a unbuffered channel</p>\n\n<pre><code>messages := make(chan string)\n</code></pre>\n\n<p>the goroutine keeps waiting for someone to actually read from the channel, so it can push the string to the channel. You can <strong>only</strong> push something to a unbuffered channel <strong>if</strong> there is somewhere a goroutine reading from it!</p>\n\n<p>Try the first example with a buffered channel:</p>\n\n<pre><code>messages := make(chan string, 1)\n</code></pre>\n\n<p>It should work as you expected.</p>\n"}], "owner": {"reputation": 527, "user_id": 3591466, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/977d21dd4dde36df3ae73e9bef6ecf49?s=128&d=identicon&r=PG&f=1", "display_name": "user3591466", "link": "https://stackoverflow.com/users/3591466/user3591466"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 676, "favorite_count": 0, "accepted_answer_id": 39338978, "answer_count": 1, "score": 0, "last_activity_date": 1473120486, "creation_date": 1473120247, "question_id": 39338951, "link": "https://stackoverflow.com/questions/39338951/why-does-select-in-golang-only-works-with-channels-in-goroutine", "title": "Why does select in golang only works with channels in goroutine?", "body": "<p>Consider the following <a href=\"https://play.golang.org/p/M_ui4GNMMw\" rel=\"nofollow\">go playground</a></p>\n\n<pre><code>    package main\n\n    import \"fmt\"\n\n    func main() {\n        messages := make(chan string)\n\n        messages &lt;- \"my msg\"\n\n        select {\n        case msg := &lt;-messages:\n            fmt.Println(\"received message\", msg)\n        }\n\n    }\n</code></pre>\n\n<p>The code above will reach error</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>However </p>\n\n<p>if I change it to</p>\n\n<pre><code>    package main\n\n    import \"fmt\"\n\n    func main() {\n        messages := make(chan string)\n\n        go func() {\n            messages &lt;- \"my msg\"\n        }()\n        select {\n        case msg := &lt;-messages:\n            fmt.Println(\"received message\", msg)\n        }\n\n    }\n</code></pre>\n\n<p>It will work.</p>\n\n<p>Is there a particular reason for this behavior?</p>\n\n<p>Shouldn't the code execute in a sequential manner in the first case so that by the time the select statement is reached, the msg will be passed and it will catch the case <code>msg := &lt;-messages</code> ?</p>\n"}, {"tags": ["javascript", "ajax", "go"], "answers": [{"tags": [], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "is_accepted": true, "score": 2, "last_activity_date": 1473140031, "creation_date": 1473140031, "answer_id": 39341298, "question_id": 39338768, "link": "https://stackoverflow.com/questions/39338768/golang-upload-file-using-ajax/39341298#39341298", "title": "Golang upload file using AJAX", "body": "<p>Few exercises for you:</p>\n\n<ol>\n<li>Parse multipart form: <code>c.Request..ParseMultipartForm(32 &lt;&lt; 20)</code></li>\n<li>Change AJAX request a bit:</li>\n</ol>\n\n<blockquote>\n<pre><code>data.append('file', file);\n// ...\n$.ajax({\n//...\n    contentType: false,\n    processData: false,\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1189, "favorite_count": 0, "closed_date": 1473385943, "accepted_answer_id": 39341298, "answer_count": 1, "score": 0, "last_activity_date": 1473140031, "creation_date": 1473118193, "last_edit_date": 1473118585, "question_id": 39338768, "link": "https://stackoverflow.com/questions/39338768/golang-upload-file-using-ajax", "closed_reason": "Duplicate", "title": "Golang upload file using AJAX", "body": "<p>I currently have the following JavaScript code</p>\n\n<pre><code>&lt;script&gt;\n    $(document).ready(function() {\n        $('#preview').click(function() {\n            var file = document.getElementById(\"widget-file\").files[0];\n            var fr = new FileReader();\n            fr.readAsArrayBuffer(file);\n            fr.onload = function() {\n                $.post(\"/admin/snact/info\", {\n                    \"file\": fr.result,\n                    \"name\": \"test\"\n                }).done(function(data) {\n                    console.log(data)\n                });\n            }\n        });\n    });\n&lt;/script&gt;\n</code></pre>\n\n<p>I want to process the file on the server-side and return some nice information but I have no idea how to access the file as a binary one (the file is binary)</p>\n\n<p>Trying that js code I can access the property name without problems but the property file will give me nothing</p>\n\n<pre><code>...\nINFO.Println(c.Request.FormValue(\"file\"), c.Request.FormValue(\"name\"))\n...\n</code></pre>\n\n<p>What I am missing here? There is readAsBinary for the FileReader class but it says its under development</p>\n\n<p>I tried the following js code</p>\n\n<pre><code>&lt;script&gt;\n    $(document).ready(function() {\n        $('#preview').click(function() {\n            var file = document.getElementById(\"widget-file\").files[0];\n            var fr = new FileReader();\n            fr.readAsArrayBuffer(file);\n            fr.onload = function() {\n                var fd = new FormData();\n                fd.append(\"file\", fr.result);\n                fd.append(\"name\", \"test\");\n                $.ajax({\n                    url: \"/admin/snact/info\",\n                    data: fd,\n                    processData: false,\n                    contentType: \"multipart/form-data\",\n                    type: \"POST\"\n                }).done(function(data) {\n                    console.log(data)\n                });\n            }\n        });\n    });\n&lt;/script&gt;\n</code></pre>\n\n<p>And on the Go side I will try to load the file with</p>\n\n<pre><code>INFO.Println(c.Request.FormFile(\"file\"))\n</code></pre>\n\n<p>But I am getting this error</p>\n\n<blockquote>\n  <p>no multipart boundary param in Content-Type</p>\n</blockquote>\n"}, {"tags": ["go", "docker", "tty", "pty"], "comments": [{"owner": {"reputation": 12114, "user_id": 1556338, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/032183d1d89374352470ebe6bc87b38c?s=128&d=identicon&r=PG&f=1", "display_name": "Bernard", "link": "https://stackoverflow.com/users/1556338/bernard"}, "edited": false, "score": 4, "creation_date": 1473112326, "post_id": 39336539, "comment_id": 66007400, "body": "Why aren&#39;t you using the Golang Docker engine API? <a href=\"https://github.com/docker/engine-api/tree/master/client\" rel=\"nofollow noreferrer\">github.com/docker/engine-api/tree/master/client</a>"}, {"owner": {"reputation": 171, "user_id": 1124133, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d494f5e1ac7a789670314adb451e7f80?s=128&d=identicon&r=PG", "display_name": "aboltart", "link": "https://stackoverflow.com/users/1124133/aboltart"}, "reply_to_user": {"reputation": 12114, "user_id": 1556338, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/032183d1d89374352470ebe6bc87b38c?s=128&d=identicon&r=PG&f=1", "display_name": "Bernard", "link": "https://stackoverflow.com/users/1556338/bernard"}, "edited": false, "score": 0, "creation_date": 1473195538, "post_id": 39336539, "comment_id": 66045366, "body": "@Alkaline Thanks for pointing me in right direction  Here is solution what I needed   <a href=\"http://go-search.org/view?id=github.com%2Ffgrehm%2Fgo-dockerpty\" rel=\"nofollow noreferrer\">go-dockerpty</a>"}, {"owner": {"reputation": 12114, "user_id": 1556338, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/032183d1d89374352470ebe6bc87b38c?s=128&d=identicon&r=PG&f=1", "display_name": "Bernard", "link": "https://stackoverflow.com/users/1556338/bernard"}, "edited": false, "score": 0, "creation_date": 1473198907, "post_id": 39336539, "comment_id": 66046726, "body": "ah good. You can add it as an answer so others will find it. Cheers"}], "answers": [{"tags": [], "owner": {"reputation": 399, "user_id": 8264607, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-WQKpnhD7pmQ/AAAAAAAAAAI/AAAAAAAAABM/vjTCAvnmiD0/photo.jpg?sz=128", "display_name": "scriptonist", "link": "https://stackoverflow.com/users/8264607/scriptonist"}, "is_accepted": false, "score": 0, "last_activity_date": 1528789922, "last_edit_date": 1528789922, "creation_date": 1528785454, "answer_id": 50810670, "question_id": 39336539, "link": "https://stackoverflow.com/questions/39336539/using-golang-connect-to-docker-container-with-functional-tty/50810670#50810670", "title": "Using golang connect to docker container with functional tty", "body": "<p><a href=\"https://github.com/fsouza/go-dockerclient\" rel=\"nofollow noreferrer\">go-dockerclient</a> is worth checking out. It is a simple nice abstraction of the Docker remote API. It is used by many opensource projects and is regularly maintained as well.</p>\n"}], "owner": {"reputation": 171, "user_id": 1124133, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/d494f5e1ac7a789670314adb451e7f80?s=128&d=identicon&r=PG", "display_name": "aboltart", "link": "https://stackoverflow.com/users/1124133/aboltart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2646, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1528789922, "creation_date": 1473103350, "last_edit_date": 1473105665, "question_id": 39336539, "link": "https://stackoverflow.com/questions/39336539/using-golang-connect-to-docker-container-with-functional-tty", "title": "Using golang connect to docker container with functional tty", "body": "<p>Start simple Docker container in Detached(Background) mode</p>\n\n<pre><code>docker run -d --name test ubuntu tail -f /dev/null\n</code></pre>\n\n<p>Here comes my simple golang code where I connect to running container.\nIn current connection I want to get functional tty.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"os/exec\"\n  \"bufio\"\n  \"io\"\n  \"os\"\n  \"github.com/kr/pty\"\n)\n\nfunc main() {\n  cmd := exec.Command(\"docker\", \"exec\", \"-it\", \"test\", \"bin/bash\")\n\n  tty, err := pty.Start(cmd)\n  if err != nil {\n    fmt.Println(\"Error start cmd\", err)\n  }\n  defer tty.Close()\n\n  go func() {\n    scanner := bufio.NewScanner(tty)\n    for scanner.Scan() {\n       fmt.Println(scanner.Text())\n    }\n  }()\n  go func() {\n    io.Copy(tty, os.Stdin)\n  }()\n\n  err = cmd.Wait()\n  if err != nil {\n    fmt.Println(\"Error Waiting\", err)\n  }\n}\n</code></pre>\n\n<p>More less it works, but there is couple thinks which is not working as I would run docker command from my terminal.</p>\n\n<ol>\n<li>After login I don't see prompt, like <code>root@ba351b44ca80:/#</code> only after hitting return it appears, but my currsor is in new line where are no prompt;</li>\n<li><p>Also arrow up to get previous command is not working\nOnly prints out </p>\n\n<pre><code>root@ba351b44ca80:/#\n^[[A^[[A^[[A\n</code></pre></li>\n</ol>\n\n<p>but behind scene previous command is selected and by hitting return it is executed.</p>\n\n<ol start=\"3\">\n<li><p>After executing command for cursor is not displayed prompt, like</p>\n\n<pre><code>root@ba351b44ca80:/# ls\nbin   dev  home  lib64  mnt  proc  run   srv  tmp  var\nboot  etc  lib   media  opt  root  sbin  sys  usr\n&lt;Here my cursor&gt;\n</code></pre></li>\n</ol>\n"}, {"tags": ["sql", "postgresql", "go", "orm"], "answers": [{"tags": [], "owner": {"reputation": 2145, "user_id": 87, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1f8377ba373028db1c2598a963c9ee2c?s=128&d=identicon&r=PG", "display_name": "DylanJ", "link": "https://stackoverflow.com/users/87/dylanj"}, "is_accepted": true, "score": 0, "last_activity_date": 1578409855, "last_edit_date": 1578409855, "creation_date": 1473185518, "answer_id": 39355334, "question_id": 39335248, "link": "https://stackoverflow.com/questions/39335248/sqlboiler-orm-how-to-execute-raw-query-without-binding/39355334#39355334", "title": "SQLBoiler ORM, how to execute raw query without binding?", "body": "<p><code>boil.SQL()</code> returns a <code>*boil.Query</code>. You can pass this into <code>boil.ExecQuery()</code> if you don't care about the results.</p>\n\n<pre><code>q := boil.SQL(\"execute foo()\")\n_, err := boil.ExecQuery(q)\n</code></pre>\n\n<p><a href=\"https://godoc.org/github.com/vattle/sqlboiler/boil#ExecQuery\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/vattle/sqlboiler/boil#ExecQuery</a></p>\n"}], "owner": {"reputation": 117, "user_id": 6797257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3109460b557e0f69e11fc8a0941df7e0?s=128&d=identicon&r=PG&f=1", "display_name": "jrichie911", "link": "https://stackoverflow.com/users/6797257/jrichie911"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1565, "favorite_count": 0, "accepted_answer_id": 39355334, "answer_count": 1, "score": 0, "last_activity_date": 1578409855, "creation_date": 1473096236, "question_id": 39335248, "link": "https://stackoverflow.com/questions/39335248/sqlboiler-orm-how-to-execute-raw-query-without-binding", "title": "SQLBoiler ORM, how to execute raw query without binding?", "body": "<p>I'm trying this ORM generator here <a href=\"https://github.com/vattle/sqlboiler\" rel=\"nofollow\">https://github.com/vattle/sqlboiler</a></p>\n\n<p>and I'm trying to execute a raw query using boil.SQL which I can see in their documentation. But when I do boil.SQL()., I see that the only methods available are Bind. Is there a way I can execute the query without binding to an object? Because I do not need any results back. </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "govendor"], "answers": [{"tags": [], "owner": {"reputation": 26092, "user_id": 824377, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e600bd229c588891a7616f303e30efd9?s=128&d=identicon&r=PG", "display_name": "AJcodez", "link": "https://stackoverflow.com/users/824377/ajcodez"}, "is_accepted": true, "score": 1, "last_activity_date": 1473091432, "creation_date": 1473091432, "answer_id": 39334209, "question_id": 39333942, "link": "https://stackoverflow.com/questions/39333942/govendor-panic-empty-package-path/39334209#39334209", "title": "govendor panic: Empty package path", "body": "<p>I figured it out. The issue was I saved a file in my project in an intermediate state.</p>\n\n<pre><code>package whatever\n\nimport (\n    \"\"\n)\n</code></pre>\n\n<p><code>govendor</code> was complaining the import statement was empty. </p>\n"}], "owner": {"reputation": 26092, "user_id": 824377, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e600bd229c588891a7616f303e30efd9?s=128&d=identicon&r=PG", "display_name": "AJcodez", "link": "https://stackoverflow.com/users/824377/ajcodez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1063, "favorite_count": 0, "accepted_answer_id": 39334209, "answer_count": 1, "score": 1, "last_activity_date": 1473091432, "creation_date": 1473090228, "question_id": 39333942, "link": "https://stackoverflow.com/questions/39333942/govendor-panic-empty-package-path", "title": "govendor panic: Empty package path", "body": "<p>How do you fix empty package path error? It's unclear to me which package has the issue or how to fix. </p>\n\n<p><code>vendor/vendor.json</code> json file.</p>\n\n<pre><code>{\n    \"comment\": \"\",\n    \"heroku\": {\n        \"goVersion\": \"go1.6\",\n        \"install\": [\n            \".\"\n        ]\n    },\n    \"ignore\": \"test\",\n    \"package\": [\n        {\n            \"path\": \"context\",\n            \"revision\": \"\"\n        },\n        {\n            \"checksumSHA1\": \"eJQuyvuWx82bVvH0+b7a1AOQGqs=\",\n            \"path\": \"github.com/ChimeraCoder/anaconda\",\n            \"revision\": \"00ecb7b4510497dc28cd46a598007ab8fe01f889\",\n            \"revisionTime\": \"2016-06-04T23:38:44Z\"\n        },\n        {\n            \"checksumSHA1\": \"xE9Zo5ubzdEVBeRf+yD/ZjLALHk=\",\n            \"path\": \"github.com/ChimeraCoder/tokenbucket\",\n            \"revision\": \"c5a927568de7aad8a58127d80bcd36ca4e71e454\",\n            \"revisionTime\": \"2013-12-01T22:36:12Z\"\n        },\n        {\n            \"checksumSHA1\": \"3RgReu+42CU1EQ6afDsVSvBuPyk=\",\n            \"path\": \"github.com/azr/backoff\",\n            \"revision\": \"53511d3c733003985b0b76f733df1f4d0095ee6a\",\n            \"revisionTime\": \"2016-01-15T11:51:03Z\"\n        },\n        {\n            \"checksumSHA1\": \"bO0ErJXuVJ7s7DS4AJlN55op8cM=\",\n            \"path\": \"github.com/dghubble/oauth1\",\n            \"revision\": \"d9f485600d309576dfa9764424f537e1f254d9a1\",\n            \"revisionTime\": \"2016-08-21T06:27:25Z\"\n        },\n        {\n            \"checksumSHA1\": \"ycg56E+pTPAHToKMIj8C5SZ+WYQ=\",\n            \"path\": \"github.com/dustin/go-jsonpointer\",\n            \"revision\": \"ba0abeacc3dcca5b9b20f31509c46794edbc9965\",\n            \"revisionTime\": \"2016-08-14T07:29:49Z\"\n        },\n        {\n            \"checksumSHA1\": \"2138MttIW/b+UkA4YMYcTc6yzOU=\",\n            \"path\": \"github.com/dustin/gojson\",\n            \"revision\": \"2e71ec9dd5adce3b168cd0dbde03b5cc04951c30\",\n            \"revisionTime\": \"2016-03-07T16:12:27Z\"\n        },\n        {\n            \"checksumSHA1\": \"PYBCaIzh3RFkxtkkP8x4XCEYLCg=\",\n            \"path\": \"github.com/garyburd/go-oauth/oauth\",\n            \"revision\": \"719b069913e1151a73ea30d2ea4f90deda3ce234\",\n            \"revisionTime\": \"2016-04-12T16:13:20Z\"\n        },\n        {\n            \"checksumSHA1\": \"mOUDsWfYLlh8f6ekwyIUo3+4xJI=\",\n            \"path\": \"goji.io\",\n            \"revision\": \"e355964ac565b94cf0fc7f218346626529125086\",\n            \"revisionTime\": \"2016-05-07T21:13:57Z\"\n        },\n        {\n            \"checksumSHA1\": \"Jf3C/refSMB2wVYGp1pssKXVNcI=\",\n            \"path\": \"goji.io/internal\",\n            \"revision\": \"e355964ac565b94cf0fc7f218346626529125086\",\n            \"revisionTime\": \"2016-05-07T21:13:57Z\"\n        },\n        {\n            \"checksumSHA1\": \"gHp/Mv7vgZWs7iq/F0YHnWgEotQ=\",\n            \"path\": \"goji.io/pat\",\n            \"revision\": \"e355964ac565b94cf0fc7f218346626529125086\",\n            \"revisionTime\": \"2016-05-07T21:13:57Z\"\n        },\n        {\n            \"checksumSHA1\": \"z2zVlHamw4ufyuSaf49reuusrmg=\",\n            \"path\": \"goji.io/pattern\",\n            \"revision\": \"e355964ac565b94cf0fc7f218346626529125086\",\n            \"revisionTime\": \"2016-05-07T21:13:57Z\"\n        },\n        {\n            \"checksumSHA1\": \"9jjO5GjLa0XF/nfWihF02RoH4qc=\",\n            \"path\": \"golang.org/x/net/context\",\n            \"revision\": \"6c89f9617983ee917132513a791d8b5850fe90c5\",\n            \"revisionTime\": \"2016-08-24T21:03:21Z\"\n        }\n    ],\n    \"rootPath\": \"thinkwire.com/thw1\"\n}\n</code></pre>\n\n<p>Full stack trace.</p>\n\n<pre><code>$ govendor fetch lib/pq\npanic: Empty package path\n\ngoroutine 1 [running]:\npanic(0x4b9c20, 0xc8200123e0)\n    /usr/local/Cellar/go/1.6.2/libexec/src/runtime/panic.go:481 +0x3e6\ngithub.com/kardianos/govendor/context.(*Context).setPackage(0xc820122000, 0xc820326420, 0x26, 0xc82029d5a0, 0x0, 0xc82029d5a0, 0x0, 0xc820112060, 0x26, 0x10201, ...)\n    $GOPATH/src/github.com/kardianos/govendor/context/resolve.go:335 +0x8ba\ngithub.com/kardianos/govendor/context.(*Context).addSingleImport(0xc820122000, 0xc8203189c0, 0x2b, 0xc82029d5a0, 0x0, 0x0, 0x0, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/context/resolve.go:383 +0x457\ngithub.com/kardianos/govendor/context.(*Context).addFileImports(0xc820122000, 0xc8203189c0, 0x30, 0xc820118080, 0x15, 0x27, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/context/resolve.go:251 +0x13e8\ngithub.com/kardianos/govendor/context.(*Context).loadPackage.func1(0xc8203189c0, 0x30, 0xda5950, 0xc820312820, 0x0, 0x0, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/context/resolve.go:55 +0x150\ngithub.com/kardianos/govendor/internal/vfilepath.walk(0xc8203189c0, 0x30, 0xda5950, 0xc820312820, 0xc820118780, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/internal/vfilepath/walk.go:19 +0x80\ngithub.com/kardianos/govendor/internal/vfilepath.walk(0xc8203188a0, 0x2a, 0xda5950, 0xc820312680, 0xc820118780, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/internal/vfilepath/walk.go:44 +0x4f5\ngithub.com/kardianos/govendor/internal/vfilepath.walk(0xc820112990, 0x27, 0xda5950, 0xc820134680, 0xc820118780, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/internal/vfilepath/walk.go:44 +0x4f5\ngithub.com/kardianos/govendor/internal/vfilepath.Walk(0xc820112990, 0x27, 0xc820118780, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/internal/vfilepath/walk.go:82 +0xe1\ngithub.com/kardianos/govendor/context.(*Context).loadPackage(0xc820122000, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/context/resolve.go:72 +0x19a\ngithub.com/kardianos/govendor/context.(*Context).modify(0xc820122000, 0xc820120140, 0x7fff5fbff804, 0xc8200f77e5, 0x0, 0x3, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/context/modify.go:232 +0xfcf\ngithub.com/kardianos/govendor/context.(*Context).ModifyImport(0xc820122000, 0xc820120140, 0xc82000a204, 0xc8200f77e5, 0x0, 0x3, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/context/modify.go:183 +0x23b\ngithub.com/kardianos/govendor/run.(*runner).Modify(0xc8200f7d50, 0xda51c0, 0xc82002a010, 0xc82000a260, 0x1, 0x1, 0x81de04, 0xda5808, 0xc8200f7db7, 0x12ec8, ...)\n    $GOPATH/src/github.com/kardianos/govendor/run/modify.go:105 +0x9e7\ngithub.com/kardianos/govendor/run.(*runner).run(0xc8200f7d50, 0xda51c0, 0xc82002a010, 0xc82000a240, 0x3, 0x3, 0xda5808, 0xc8200f7db7, 0xda5808, 0x0, ...)\n    $GOPATH/src/github.com/kardianos/govendor/run/run.go:83 +0x662\ngithub.com/kardianos/govendor/run.Run(0xda51c0, 0xc82002a010, 0xc82000a240, 0x3, 0x3, 0xda5808, 0xc8200f7db7, 0x0, 0x0, 0x0)\n    $GOPATH/src/github.com/kardianos/govendor/run/run.go:41 +0x95\nmain.main()\n    $GOPATH/src/github.com/kardianos/govendor/main.go:35 +0x453\n</code></pre>\n"}, {"tags": ["go", "orm", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "edited": false, "score": 1, "creation_date": 1506069225, "post_id": 39333848, "comment_id": 79680187, "body": "The correct link is here: <a href=\"http://jinzhu.me/gorm/crud.html\" rel=\"nofollow noreferrer\">jinzhu.me/gorm/crud.html</a> (could not edit because it&#39;s less than 6 characters)"}, {"owner": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "edited": false, "score": 0, "creation_date": 1562882250, "post_id": 39333848, "comment_id": 100529432, "body": "Changed embedded link from curd to crud"}], "tags": [], "owner": {"reputation": 2081, "user_id": 2378213, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3639dc9bce37b77502008ab6ca6feb?s=128&d=identicon&r=PG", "display_name": "edufinn", "link": "https://stackoverflow.com/users/2378213/edufinn"}, "is_accepted": false, "score": 0, "last_activity_date": 1562882204, "last_edit_date": 1562882204, "creation_date": 1473089759, "answer_id": 39333848, "question_id": 39333102, "link": "https://stackoverflow.com/questions/39333102/how-to-create-or-update-a-record-with-gorm/39333848#39333848", "title": "How to Create or Update a record with GORM?", "body": "<p>Here's example from gorm documentation <a href=\"http://jinzhu.me/gorm/crud.html\" rel=\"nofollow noreferrer\">CRUD section</a></p>\n\n<pre><code>user := User{Name: \"Jinzhu\", Age: 18, Birthday: time.Now()}\n\ndb.NewRecord(user) // =&gt; returns `true` as primary key is blank\n\ndb.Create(&amp;user)\n\ndb.NewRecord(user) // =&gt; return `false` after `user` created\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": false, "score": 0, "last_activity_date": 1473217415, "last_edit_date": 1473217415, "creation_date": 1473216455, "answer_id": 39360502, "question_id": 39333102, "link": "https://stackoverflow.com/questions/39333102/how-to-create-or-update-a-record-with-gorm/39360502#39360502", "title": "How to Create or Update a record with GORM?", "body": "<p>See Attrs <a href=\"http://jinzhu.me/gorm/curd.html#firstorcreate\" rel=\"nofollow\">here</a>. It won't exactly tell you whether the record was actually created, but will let you update some fields only if record was actually created (which seems to be what you want to achieve in the end).</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 9888920, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/072c3ea1aaf65a6e11f20482bf8e410c?s=128&d=identicon&r=PG", "display_name": "klim0v", "link": "https://stackoverflow.com/users/9888920/klim0v"}, "is_accepted": false, "score": 2, "last_activity_date": 1547798967, "creation_date": 1547798967, "answer_id": 54249884, "question_id": 39333102, "link": "https://stackoverflow.com/questions/39333102/how-to-create-or-update-a-record-with-gorm/54249884#54249884", "title": "How to Create or Update a record with GORM?", "body": "<pre><code>gormDB.Where(entity.AggregatedData{Type: v.Type}).Assign(entity.AggregatedData{Type: v.Type, Data: v.Data}).FirstOrCreate(v)\n\n\n SELECT * FROM \"aggregated_data\"  WHERE (\"aggregated_data\".\"type\" = '2') ORDER BY \"aggregated_data\".\"id\" ASC LIMIT 1 \n</code></pre>\n\n<p>and if exist then</p>\n\n<pre><code> UPDATE \"aggregated_data\" SET \"data\" = '[{\"a\":2}]', \"type\" = '2'  WHERE \"aggregated_data\".\"id\" = '2' AND ((\"aggregated_data\".\"type\" = '2'))  \n</code></pre>\n\n<p>else </p>\n\n<pre><code>INSERT INTO \"aggregated_data\" (\"data\",\"type\") VALUES ('[{\"a\":2}]','1') RETURNING \"aggregated_data\".\"id\"  \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1381, "user_id": 1588303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02fa7266adc9004d79339808f4f13127?s=128&d=identicon&r=PG", "display_name": "Rodney P. Barbati", "link": "https://stackoverflow.com/users/1588303/rodney-p-barbati"}, "edited": false, "score": 3, "creation_date": 1556647147, "post_id": 54251638, "comment_id": 98506447, "body": "This does not make sense to me - why would you need to specify a where clause to update an existing record.  The user object should already have the id if it is an existing record and I would hope gorm would be smart enough to know that if the id exists, it should update.  I wrote a gorm like library for Java, and it only requires a call to save() regardless of whether the record is new or not - it will insert it if it does not have an id, and update if it does."}, {"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "reply_to_user": {"reputation": 1381, "user_id": 1588303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02fa7266adc9004d79339808f4f13127?s=128&d=identicon&r=PG", "display_name": "Rodney P. Barbati", "link": "https://stackoverflow.com/users/1588303/rodney-p-barbati"}, "edited": false, "score": 0, "creation_date": 1590035688, "post_id": 54251638, "comment_id": 109530022, "body": "The question is \u201cif it exists I want to update some fields\u201d\u3002So you have to check if it exist, and if so, you could update the selected field only. if you use <code>db.save(&amp;user)</code>, all fields in user world be written to db."}, {"owner": {"reputation": 404, "user_id": 9641939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c64b5e0ccadd1d1ada1cf05b8e8747c2?s=128&d=identicon&r=PG&f=1", "display_name": "Cephalopod", "link": "https://stackoverflow.com/users/9641939/cephalopod"}, "edited": false, "score": 1, "creation_date": 1601400510, "post_id": 54251638, "comment_id": 113394264, "body": "Gorm now has first class support for upsert <a href=\"https://gorm.io/docs/create.html#Upsert-On-Conflict\" rel=\"nofollow noreferrer\">gorm.io/docs/create.html#Upsert-On-Conflict</a>"}], "tags": [], "owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "is_accepted": false, "score": 12, "last_activity_date": 1602224248, "last_edit_date": 1602224248, "creation_date": 1547805932, "answer_id": 54251638, "question_id": 39333102, "link": "https://stackoverflow.com/questions/39333102/how-to-create-or-update-a-record-with-gorm/54251638#54251638", "title": "How to Create or Update a record with GORM?", "body": "<p>update 2020.10.09</p>\n<p>Thanks for <a href=\"https://stackoverflow.com/users/9641939/vaelin\">@vaelin</a></p>\n<p>From 1.20.x on, GORM provides compatible Upsert support for different databases( <a href=\"https://gorm.io/docs/create.html#Upsert-On-Conflict\" rel=\"nofollow noreferrer\">Upsert-On-Conflict</a>)</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// Update columns to new value on `id` conflict\nDB.Clauses(clause.OnConflict{\n  Columns:   []clause.Column{{Name: &quot;id&quot;}}, // key colume\n  DoUpdates: clause.AssignmentColumns([]string{&quot;name&quot;, &quot;age&quot;}), // column needed to be updated\n}).Create(&amp;users)\n// MERGE INTO &quot;users&quot; USING *** WHEN NOT MATCHED THEN INSERT *** WHEN MATCHED THEN UPDATE SET &quot;name&quot;=&quot;excluded&quot;.&quot;name&quot;; SQL Server\n// INSERT INTO &quot;users&quot; *** ON CONFLICT (&quot;id&quot;) DO UPDATE SET &quot;name&quot;=&quot;excluded&quot;.&quot;name&quot;, &quot;age&quot;=&quot;excluded&quot;.&quot;age&quot;; PostgreSQL\n// INSERT INTO `users` *** ON DUPLICATE KEY UPDATE `name`=VALUES(name),`age=VALUES(age); MySQL\n</code></pre>\n<p>With gorm 1.9.x or below, it's more effecient to update first, then insert when not existed.</p>\n<pre><code>// update only set name=nick\nif err := db.Model(&amp;newUser).Where(&quot;id = ?&quot;, 3333).Update(&quot;name&quot;, &quot;nick&quot;).Error; err != nil {\n    // always handle error like this, cause errors maybe happened when connection failed or something. \n    // record not found...\n    if gorm.IsRecordNotFoundError(err){\n        db.Create(&amp;newUser)  // create new record from newUser\n    }\n}\n</code></pre>\n<p><code>FirstOrInit</code> and <code>FirstOrCreate</code> are different. If there is no match record in database, <code>FirstOrInit</code> will init struct but not create record, <code>FirstOrCreate</code> will create a record and query that record to struct.</p>\n"}, {"tags": [], "owner": {"reputation": 563, "user_id": 921684, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/pUbv3.png?s=128&g=1", "display_name": "nobody", "link": "https://stackoverflow.com/users/921684/nobody"}, "is_accepted": false, "score": 3, "last_activity_date": 1596050449, "creation_date": 1596050449, "answer_id": 63160987, "question_id": 39333102, "link": "https://stackoverflow.com/questions/39333102/how-to-create-or-update-a-record-with-gorm/63160987#63160987", "title": "How to Create or Update a record with GORM?", "body": "<p>The most upvoted answer did not work for me, but this did:</p>\n<pre><code>user := NewUser(email, password)\nif db.Model(&amp;user).Where(&quot;email = ?&quot;, email).Updates(&amp;user).RowsAffected == 0 {\n    db.Create(&amp;user)\n}\n</code></pre>\n<p>This works for gorm v1.9.15 and go 1.13</p>\n"}, {"tags": [], "owner": {"reputation": 13, "user_id": 6743836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29ff0d61d4b98aa0f6b70f1b3b34f808?s=128&d=identicon&r=PG&f=1", "display_name": "allenartisan", "link": "https://stackoverflow.com/users/6743836/allenartisan"}, "is_accepted": false, "score": 0, "last_activity_date": 1599934252, "last_edit_date": 1599934252, "creation_date": 1599932669, "answer_id": 63863197, "question_id": 39333102, "link": "https://stackoverflow.com/questions/39333102/how-to-create-or-update-a-record-with-gorm/63863197#63863197", "title": "How to Create or Update a record with GORM?", "body": "<pre><code>func CreateOrUpdate(db *gorm.DB, model interface{}, where interface{}, update interface{}) (interface{}, error) {\n    var result interface{}\n    err := db.Model(model).Where(where).First(result).Error\n    if err != nil {\n        if !errors.Is(err, gorm.ErrRecordNotFound) {\n            return nil, err\n        } else {\n            //insert\n            if err = db.Model(model).Create(update).Error; err != nil {\n                return nil, err\n            }\n        }\n    }\n    //not update some field\n    reflect.ValueOf(update).Elem().FieldByName(&quot;someField&quot;).SetInt(0)\n    if err = db.Model(model).Where(where).Updates(update).Error; err != nil {\n        return nil, err\n    }\n    return update, nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 410, "user_id": 4793100, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/df152828f32e71f57e4ca98ca0e67bc0?s=128&d=identicon&r=PG", "display_name": "Jordy Baylac", "link": "https://stackoverflow.com/users/4793100/jordy-baylac"}, "is_accepted": false, "score": 0, "last_activity_date": 1600658610, "creation_date": 1600658610, "answer_id": 63985785, "question_id": 39333102, "link": "https://stackoverflow.com/questions/39333102/how-to-create-or-update-a-record-with-gorm/63985785#63985785", "title": "How to Create or Update a record with GORM?", "body": "<p>There is a better way to do it:</p>\n<pre><code>    if err := db.Where(User{Email: &quot;some@email.com&quot;}).\n       Assign(User{Email: &quot;some@email.com&quot;, Age: 45}).\n       FirstOrCreate(&amp;User{}).Error; err != nil {\n         c.Next(err)\n         return\n    }\n</code></pre>\n<p>In this example, if a user with email &quot;some@email.com&quot; is found, then the field &quot;Age&quot; will be updated. On the contrary, if no user if found, then it is created.</p>\n<p>Note that I am discarding the created user, but you can keep the reference if you want.\nAlso, for some GORM reasons, it is required to provide at least a filter field in the Assign clause, that's why you see <strong>email</strong> being populated twice.</p>\n"}], "owner": {"reputation": 13903, "user_id": 86388, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/cPl84.jpg?s=128&g=1", "display_name": "Tarion", "link": "https://stackoverflow.com/users/86388/tarion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27916, "favorite_count": 2, "answer_count": 7, "score": 9, "last_activity_date": 1602224248, "creation_date": 1473086922, "last_edit_date": 1473098551, "question_id": 39333102, "link": "https://stackoverflow.com/questions/39333102/how-to-create-or-update-a-record-with-gorm", "title": "How to Create or Update a record with GORM?", "body": "<p>Gorm has a <code>FirstOrCreate</code> method and a <code>FirstOrInit</code> but how to check afterwards if the record was actually created? I like to create a record if it does not exists and if it exists I want to update some fields.</p>\n"}, {"tags": ["multithreading", "go", "locking", "channel"], "answers": [{"comments": [{"owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1473128730, "post_id": 39333477, "comment_id": 66010669, "body": "I don&#39;t think your revision really works. You put <code>wg.Wait()</code> into another goroutine, which means they may not get a chance to be executed after the main routine terminates. To illustrate, <code>count++</code> after each <code>Lock()</code> and print  count before DONE."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1473185452, "post_id": 39333477, "comment_id": 66040548, "body": "You don&#39;t need to close channels unless you&#39;re trying to communicate that closure.  In this case, he&#39;s not loop over <code>range c</code>, so closing the channel is unnecessary."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": -1, "last_activity_date": 1473088319, "creation_date": 1473088319, "answer_id": 39333477, "question_id": 39332596, "link": "https://stackoverflow.com/questions/39332596/why-channel-based-lock-blocks/39333477#39333477", "title": "why channel-based Lock blocks?", "body": "<p>I think the problem is with your <code>main</code> <code>for</code> loop. You are not closing the channel <code>c</code> anywhere that's causing the deadlock. Try changing the loop to this:</p>\n\n<pre><code>for i := 0; i &lt; 10; i++ {\n    var wg sync.WaitGroup // use WaitGroup\n    wg.Add(1)\n    go func(l *AppLock, loops int, cdone chan bool) {\n        defer wg.Done()\n        for i := 0; i &lt; loops; i++ {\n            l.Lock(app)\n            l.Unlock(app)\n        }\n        cdone &lt;- true\n    }(appLock, 1, c)\n    go func() {\n        wg.Wait()\n        close(c)\n    }()\n}\n</code></pre>\n\n<p>Working code: <a href=\"https://play.golang.org/p/cbXj0CPTGO\" rel=\"nofollow\">https://play.golang.org/p/cbXj0CPTGO</a></p>\n\n<p>Although this should solve the deadlock problem, that doesn't necessarily mean the behavior of the program is correct. You'll need better tests to work that out.</p>\n"}, {"comments": [{"owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1473154697, "post_id": 39344748, "comment_id": 66021102, "body": "The go playground link is Forbidden for me.  :("}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1473155338, "post_id": 39344748, "comment_id": 66021489, "body": "pls try again (I re-shared it)"}, {"owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1473160986, "post_id": 39344748, "comment_id": 66025098, "body": "Still Forbidden. Based on your answer, I suppose implementation of <code>Lock()</code> is not enough, since you&#39;re putting into a buffered channel, which will succeed immediately, and that makes <code>Lock()</code> nonsense (doesn&#39;t really own the lock before it returns). But it&#39;s cool of the for loop inside lockRoutine, that kind of state machine inspires me a lot."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1473174175, "post_id": 39344748, "comment_id": 66034225, "body": "Somewhat surprised: since when has the playground forbidden people?"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1473174330, "post_id": 39344748, "comment_id": 66034322, "body": "I&#39;ve copied more code from the Playground into the answer."}], "tags": [], "owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "is_accepted": false, "score": 0, "last_activity_date": 1473175058, "last_edit_date": 1473175058, "creation_date": 1473152178, "answer_id": 39344748, "question_id": 39332596, "link": "https://stackoverflow.com/questions/39332596/why-channel-based-lock-blocks/39344748#39344748", "title": "why channel-based Lock blocks?", "body": "<p>Do you need to implement the state machine containing the linked list? There may be a much simpler solution using Go's normal channel contention to provide the queue.</p>\n\n<p>So, clients are queued up to access an unbuffered channel. The locking service simply waits for a client. When one arrives, the lock service goes into a locked state. Unlock is signalled using an unbuffered channel and the state returns to unlocked.</p>\n\n<p>Whilst locked, the locking service ignores subsequent requests to gain the lock. Those clients have to wait (the Go runtime provides a queue for this). Each time it is unlocked, the service can then take the next client.</p>\n\n<pre><code>type AppLock struct {\n    lockCh   chan struct{}\n    unlockCh chan struct{}\n}\n\nfunc NewAppLock() *AppLock {\n    l := new(AppLock)\n    l.lockCh = make(chan struct{})\n    l.unlockCh = make(chan struct{})\n    go l.lockRoutine()\n    return l\n}\n\nfunc (l *AppLock) lockRoutine() {\n    for {\n        // take the next client off the channel\n        &lt;- l.lockCh\n        // we are now in a locked state; wait until the client has released\n        // which it signals via the channel c\n        &lt;- l.unlockCh\n    }\n}\n\nfunc (l *AppLock) Lock() {\n    // join the queue for a lock\n    l.lockCh &lt;- struct{}{}\n}\n\nfunc (l *AppLock) Unlock() {\n    l.unlockCh &lt;- struct{}{}\n}\n</code></pre>\n\n<p>And the calling loop contains</p>\n\n<pre><code>        for i := 0; i &lt; loops; i++ {\n            l.Lock()\n            l.Unlock()\n        }\n</code></pre>\n\n<p>It is important that the channels are unbuffered because the clients must wait for completed rendezvous before they know they have acquired (for <code>l.Lock()</code>) or released (for <code>l.Unlock()</code>) the lock.</p>\n\n<p><a href=\"https://play.golang.org/p/2j4lkeOR_s\" rel=\"nofollow\">https://play.golang.org/p/2j4lkeOR_s</a></p>\n\n<p><strong>PS</strong></p>\n\n<p>I can't help wondering whether you just need RWMutex (<a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow\">https://golang.org/pkg/sync/#RWMutex</a>)</p>\n"}, {"tags": [], "owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "is_accepted": true, "score": 0, "last_activity_date": 1473160450, "creation_date": 1473160450, "answer_id": 39347689, "question_id": 39332596, "link": "https://stackoverflow.com/questions/39332596/why-channel-based-lock-blocks/39347689#39347689", "title": "why channel-based Lock blocks?", "body": "<p>I just found the mistake in my code.  </p>\n\n<pre><code>type AppLock struct {\n    lockCh   chan receiver\n    unlockCh chan receiver\n\n    // Consider lock x:\n    // if map[x] doesn't exist, x is unlocked\n    // if map[x] exist but head is nil, x is locked but no waiter\n    // if map[x] exist and head isn't nil, x is locked and there're waiters\n    m map[string]receiveList\n}\n</code></pre>\n\n<p>Originally, I thought <code>head</code> and <code>tail</code> inside <code>receiveList</code> are all pointers, so we can always operate on the same waiters-list even though the <code>receiveList</code> isn't a Pointer type. (Obviously it's wrong)  </p>\n\n<p>Indeed, it's okay if we only read from <code>head</code> and <code>tail</code> without using Pointer type for <code>receiveList</code>. However, I do write to them inside the lockRoutine, which is writing to a copy of them. That's the problem.</p>\n"}, {"comments": [{"owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1473225893, "post_id": 39355750, "comment_id": 66052660, "body": "You&#39;ll get a serious concurrency problem since you are reading and writing to a <code>map</code> without <code>lock</code>. Run an unit test if you&#39;re not sure."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "edited": false, "score": 0, "creation_date": 1473433123, "post_id": 39355750, "comment_id": 66153379, "body": "Ya, that&#39;s fair.  Should probably mutex the map.  Still, the only race condition that exists, technically, is if two (or more) threads try to lock an app for the first time at the same time, as that&#39;s the only time the map is written to.  Still, updated my answer to include a RWMutex for protection."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 0, "last_activity_date": 1473433214, "last_edit_date": 1473433214, "creation_date": 1473187113, "answer_id": 39355750, "question_id": 39332596, "link": "https://stackoverflow.com/questions/39332596/why-channel-based-lock-blocks/39355750#39355750", "title": "why channel-based Lock blocks?", "body": "<p>There's a much much simpler solution to this.  A single-slot buffered channel already functions as a simple locker.  No need for a manager routine or a linked list queue:</p>\n\n<pre><code>// AppLock maintains a single exclusive lock for each app name string provided\ntype AppLock struct {\n    // Consider lock x:\n    // if map[x] doesn't exist, x is implicitly unlocked\n    // if map[x] exist and can be read from, x is unlocked\n    // if map[x] exist and blocks on read, x is locked\n    m map[string]chan struct{}\n\n    // RWMutex to protect the map writes, but allow free read access\n    mut sync.RWMutex\n}\n\nfunc NewAppLock() *AppLock {\n    l := new(AppLock)\n    l.m = make(map[string]chan struct{})\n    return l\n}\n\nfunc (l *AppLock) Lock(app string) {\n    l.mut.RLock()\n    ch, ok := l.m[app]\n    l.mut.RUnlock()\n\n    if ok {\n        &lt;-ch // blocks until lock acquired\n    } else {\n        l.mut.Lock()\n        l.m[app] = make(chan struct{}, 1)\n        // we don't want to put anything on it yet, because we still want the lock\n        l.mut.Unlock()\n    }\n}\n\nfunc (l *AppLock) Unlock(app string) {\n    l.mut.RLock()\n    ch, ok := l.m[app]\n    l.mut.RUnlock()\n\n    if ok {\n        select {\n        case ch &lt;- struct{}{}:\n            // do nothing, expected behavior\n        default:\n            // something already on channel, which means it wasn't locked\n            panic(\"Unlock called on app not previously locked\")\n        }\n    } else {\n        panic(\"Unlock called on app not previously locked\")\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/o02BHfRto3\" rel=\"nofollow\">https://play.golang.org/p/o02BHfRto3</a></p>\n\n<p>This maintains a single channel, buffered 1, for each app.  To lock, you attempt to read from the channel.  If you receive something (which is just a generic token representing the lock), you got the lock, and you put the token back on the channel to unlock it.  If the receive blocks, something else has the lock, and the receive will unblock when that other routine unlocks (puts the token back on the channel).</p>\n\n<p>Incidentally, this also still functions as a first-in first-out system, as Go channels are ordered and will fill the receive that started receiving earliest (amongst those still trying to receive).</p>\n"}], "owner": {"reputation": 826, "user_id": 3505816, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/515d6b58cb611ea9e404391e983a166d?s=128&d=identicon&r=PG&f=1", "display_name": "dastan", "link": "https://stackoverflow.com/users/3505816/dastan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 39347689, "answer_count": 4, "score": 0, "last_activity_date": 1473433214, "creation_date": 1473085155, "question_id": 39332596, "link": "https://stackoverflow.com/questions/39332596/why-channel-based-lock-blocks", "title": "why channel-based Lock blocks?", "body": "<p>Hi i'm writing a <code>Lock</code> using channel, which aims to Lock/Unlock an operation for a given 'app'.  </p>\n\n<p>The general idea is that, one goroutine keeps listening on two channels: <code>lockCh</code> and <code>unlockCh</code>. Any <code>Lock()</code> operation sends a self-made channel to <code>lockCh</code>, and waits for reading from that self-made channel, done from reading this channel means <code>Lock()</code> succeed.  </p>\n\n<p>Similar process applies to <code>Unlock()</code>.</p>\n\n<p>To the listener gorouting, it checks if an 'app' is already locked when accepting a <code>Lock()</code>, if so, it puts that self-made channel to the tail of waiters-list. If somebody <code>Unlock()</code>, it wakes up (by sending message to channel) next waiter or delete the waiters-list if nobody else is waiting for the lock.  </p>\n\n<p>Code is put at below, I don't know where is wrong but the test cases just don't pass (it blocks after several <code>Lock()</code> and <code>Unlock()</code>!)  </p>\n\n<p>Thanks for giving me some advice.</p>\n\n<pre><code>type receiver struct {\n            app  string\n            ch   chan struct{}\n            next *receiver\n}\n\ntype receiveList struct {\n            head *receiver\n            tail *receiver\n}\n\ntype AppLock struct {\n            lockCh   chan receiver\n            unlockCh chan receiver\n\n            // Consider lock x:\n            // if map[x] doesn't exist, x is unlocked\n            // if map[x] exist but head is nil, x is locked but no waiter\n            // if map[x] exist and head isn't nil, x is locked and there're waiters\n            m map[string]receiveList\n}\n\nfunc NewAppLock() *AppLock {\n            l := new(AppLock)\n            l.lockCh = make(chan receiver)\n            l.unlockCh = make(chan receiver)\n            l.m = make(map[string]receiveList)\n\n            go l.lockRoutine()\n            return l\n}\n\nfunc (l *AppLock) Lock(app string) {\n            ch := make(chan struct{})\n            l.lockCh &lt;- receiver{\n                app: app,\n                ch:  ch,\n            }\n            &lt;-ch\n}\n\nfunc (l *AppLock) Unlock(app string) {\n            ch := make(chan struct{})\n            l.unlockCh &lt;- receiver{\n                app: app,\n                ch:  ch,\n            }\n            &lt;-ch\n}\n\nfunc (l *AppLock) lockRoutine() {\n            for {\n                select {\n                case r := &lt;-l.lockCh:\n                    rlist, ok := l.m[r.app]\n                    if ok { // already locked\n                        if rlist.head == nil { // no waiter\n                            rlist.head = &amp;r\n                            rlist.tail = &amp;r\n                        } else { // there're waiters, wait in queue\n                            rlist.tail.next = &amp;r\n                            rlist.tail = &amp;r\n                        }\n                    } else { // unlocked\n                        rlist = receiveList{}\n                        l.m[r.app] = rlist\n                        r.ch &lt;- struct{}{}\n                    }\n                case r := &lt;-l.unlockCh:\n                    rlist, ok := l.m[r.app]\n                    if ok {\n                        if rlist.head == nil { // no waiter\n                            delete(l.m, r.app)\n                            r.ch &lt;- struct{}{}\n                        } else { // there're waiters\n                            candidate := rlist.head\n                            if rlist.head == rlist.tail {\n                                rlist.head = nil\n                                rlist.tail = nil\n                            } else {\n                                rlist.head = rlist.head.next\n                            }\n                            candidate.ch &lt;- struct{}{}\n                            r.ch &lt;- struct{}{}\n                        }\n                    } else {\n                        panic(\"AppLock: inconsistent lock state\")\n                    }\n                }\n            }\n}\n</code></pre>\n\n<p>Test:  </p>\n\n<pre><code>func main() {\n        app := \"APP\"\n        appLock := NewAppLock()\n        c := make(chan bool)\n\n        for i := 0; i &lt; 10; i++ {\n            go func(l *AppLock, loops int, cdone chan bool) {\n                for i := 0; i &lt; loops; i++ {\n                    l.Lock(app)\n                    l.Unlock(app)\n                }\n                cdone &lt;- true\n            }(appLock, 1, c)\n        }\n\n        for i := 0; i &lt; 10; i++ {\n            &lt;-c\n        }\n\n    fmt.Println(\"DONE\")\n}\n</code></pre>\n"}, {"tags": ["go", "dns", "kubernetes", "google-kubernetes-engine"], "owner": {"reputation": 812, "user_id": 597430, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fbbcf771a630a0e452083fdc08cfaa6c?s=128&d=identicon&r=PG", "display_name": "Matthias Loibl", "link": "https://stackoverflow.com/users/597430/matthias-loibl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1473082076, "creation_date": 1473082076, "question_id": 39331679, "link": "https://stackoverflow.com/questions/39331679/dns-error-no-such-host-on-google-container-engine", "title": "dns error, no such host on google-container-engine", "body": "<p>we're trying to get Let's Encrypt up and running inside kubernetes with <a href=\"https://github.com/kelseyhightower/kube-cert-manager\" rel=\"nofollow\">kube-cert-manager</a>.</p>\n\n<p>When running <code>kube-cert-manager</code><a href=\"https://github.com/kelseyhightower/kube-cert-manager/blob/master/dns.go#L103\" rel=\"nofollow\">this function</a> is called to monitor the dns propagation which checks if the ACME challenge is found inside the dns TXT record.<br>\nWhen this gets called this error gets logged.</p>\n\n<pre><code> 2016/09/05 12:52:47 monitorDNSProgragation error: lookup foo.bar.de on 10.71.240.10:53: no such host\n</code></pre>\n\n<p><code>10.71.240.10</code> is the DNS server used everywhere inside our kubernetes cluster. I can resolve <code>foo.bar.de</code> in every container (pod) inside the cluster using <code>dig</code>. This is also possible in the <code>kube-cert-manger</code> container.<br>\nIt's just not possible with the <code>kube-cert-manager</code> binary.</p>\n\n<p><code>kube-cert-manager</code> uses <a href=\"https://github.com/miekg/dns\" rel=\"nofollow\">github.com/miekg/dns</a>. I've replaced the function linked above with stdlib <code>net.LookupTXT(c.domain)</code> which returns the same error.</p>\n\n<p>Is this some Go bug?<br>\nSome known configuration error in google-container-engine?</p>\n\n<p>If you need more information just ask. </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["validation", "go", "struct", "conditional-statements"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 1, "creation_date": 1473073031, "post_id": 39328706, "comment_id": 65989528, "body": "Your code looks fine. It isn&#39;t terrible."}], "answers": [{"comments": [{"owner": {"reputation": 855, "user_id": 4786134, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/568608213301299/picture?type=large", "display_name": "0x01", "link": "https://stackoverflow.com/users/4786134/0x01"}, "edited": false, "score": 1, "creation_date": 1473074057, "post_id": 39328906, "comment_id": 65990092, "body": "Amazingly detailed answer. Thank you very much @icza !"}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "edited": false, "score": 0, "creation_date": 1473079521, "post_id": 39328906, "comment_id": 65993310, "body": "Keep in mind that a code using reflection is much slower than one not using it, like the original approach."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "edited": false, "score": 0, "creation_date": 1473080448, "post_id": 39328906, "comment_id": 65993818, "body": "@cd1 Yes, you&#39;re right. But since we&#39;re already talking about HTTP POST requests, the performance difference is negligible."}, {"owner": {"reputation": 855, "user_id": 4786134, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/568608213301299/picture?type=large", "display_name": "0x01", "link": "https://stackoverflow.com/users/4786134/0x01"}, "edited": false, "score": 0, "creation_date": 1473080915, "post_id": 39328906, "comment_id": 65994080, "body": "@icza Mind to explain why it would be negligible in HTTP POST requests ? Also, using reflection is a bit against the Golang&#39;s good practices since Golang aim explicit everything in the code right ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 855, "user_id": 4786134, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/568608213301299/picture?type=large", "display_name": "0x01", "link": "https://stackoverflow.com/users/4786134/0x01"}, "edited": false, "score": 1, "creation_date": 1473081619, "post_id": 39328906, "comment_id": 65994487, "body": "@MEGADEVOPS Because a typical HTTP <code>POST</code> request takes the order of <b>hundred milliseconds</b> magnitude (including network delay), and the above <code>check()</code> function with reflection takes only half a <b>microsecond</b> to execute (called with a value of your <code>SignupModel</code> type). So with direct field comparison handling the POST request may be 200.0001 ms, and using this <code>check()</code> function it may be 200.0005 ms. You won&#39;t even notice the difference."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1473083103, "last_edit_date": 1473083103, "creation_date": 1473072240, "answer_id": 39328906, "question_id": 39328706, "link": "https://stackoverflow.com/questions/39328706/a-better-way-to-check-post-params/39328906#39328906", "title": "A better way to check POST params?", "body": "<p>You could create a general helper function which uses reflection (<a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow\"><code>reflect</code></a> package) to check all fields of a struct:</p>\n\n<pre><code>func check(s interface{}) error {\n    v := reflect.ValueOf(s)\n    for i := v.NumField() - 1; i &gt;= 0; i-- {\n        if v.Field(i).Interface() == \"\" {\n            return fmt.Errorf(\"Field %s is empty!\", v.Type().Field(i).Name)\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>fmt.Println(check(SignupModel{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\"}))\nfmt.Println(check(SignupModel{}))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/SAdjZYUVmE\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>&lt;nil&gt;\nField Picture is empty!\n</code></pre>\n\n<p><strong>Improvements:</strong></p>\n\n<p>The above <code>check()</code> function works for all types, not just for <code>SignupModel</code>, but currently \u2013as it is\u2013 only handles fields of <code>string</code> type. You can improve it if you want to support other field types.</p>\n\n<p>Here's an improved version which handles fields of other types too, and it also handles if the passed value is a pointer to a struct (simply dereferences it). If a non-<code>struct</code> value is passed, it returns an error:</p>\n\n<pre><code>func check(s interface{}) error {\n    v := reflect.Indirect(reflect.ValueOf(s))\n    if v.Kind() != reflect.Struct {\n        return fmt.Errorf(\"Not struct!\")\n    }\n    v2 := reflect.Zero(v.Type())\n    for i := v.NumField() - 1; i &gt;= 0; i-- {\n        if v.Field(i).Interface() == v2.Field(i).Interface() {\n            return fmt.Errorf(\"Field %s is empty!\", v.Type().Field(i).Name)\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>fmt.Println(check(&amp;struct{ I int }{1}))\nfmt.Println(check(struct{ I int }{}))\nfmt.Println(check(struct { I int; S string }{1, \"a\"}))\nfmt.Println(check(&amp;struct { I int; S string }{}))\nfmt.Println(check(\"I'm a string\"))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/IrLJNRp2dL\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>&lt;nil&gt;\nField I is empty!\n&lt;nil&gt;\nField S is empty!\nNot struct!\n</code></pre>\n\n<p><strong>Final notes:</strong></p>\n\n<p>The above solution uses reflection which is always slower than direct code (the one you're trying to shorten). But since we're talking about HTTP <code>POST</code> requests, the performance difference is negligible (as an HTTP <code>POST</code> request could take <strong>hundreds of milliseconds</strong> while this <code>check()</code> function takes <strong>half a microsecond</strong> when called with a value of your <code>SignupModel</code> type \u2013 benchmarked).</p>\n\n<p>If you'd want to mix the speed of your code and the flexibility of this, one option would be to create a generator (<code>go generate</code>, read blog post: <a href=\"https://blog.golang.org/generate\" rel=\"nofollow\">Generating code</a>) which would generate unique <code>checkXX()</code> helper functions, one for each distinct struct type, operating without reflection (using direct field value comparisons).</p>\n"}], "owner": {"reputation": 855, "user_id": 4786134, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/568608213301299/picture?type=large", "display_name": "0x01", "link": "https://stackoverflow.com/users/4786134/0x01"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "accepted_answer_id": 39328906, "answer_count": 1, "score": 3, "last_activity_date": 1473083103, "creation_date": 1473071571, "last_edit_date": 1473073716, "question_id": 39328706, "link": "https://stackoverflow.com/questions/39328706/a-better-way-to-check-post-params", "title": "A better way to check POST params?", "body": "<p>I'm currently working on setting up an API using Golang. I'm making a signup route and I need to check that everything is filled in my <code>SignupModel</code>. So for now I'm using a <strong>very</strong> long if condition.. I'm sure there must be more efficient/elegant solutions, but I somehow cannot find them.</p>\n\n<p>Here is a code snippet:</p>\n\n<pre><code>// My SignupModel\ntype SignupModel struct {\n    ID        string `json:\"id\"`\n    Username  string `json:\"username\"`\n    FbToken   string `json:\"fbtoken\"`\n    Email     string `json:\"email\"`\n    Firstname string `json:\"firstname\"`\n    Lastname  string `json:\"lastname\"`\n    Picture   string `json:\"picture\"`\n}\n\n// This is the condition I'm using inside my route (I know it's terrible)\nif signup.ID != \"\" &amp;&amp; signup.Username != \"\" &amp;&amp; signup.FbToken == \"\" &amp;&amp; signup.Email == \"\" &amp;&amp; signup.Firstname == \"\" &amp;&amp; signup.Lastname == \"\" &amp;&amp; signup.Picture == \"\" {        \n    json.NewEncoder(w).Encode(signup)\n} else {\n    statusResponse := StatusResponse{Status: \"Something went wrong\", StatusCode: 401}\n    json.NewEncoder(w).Encode(statusResponse)\n}\n</code></pre>\n\n<p>Thanks in advance for the help.</p>\n"}, {"tags": ["github", "go"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1473068906, "post_id": 39326948, "comment_id": 65987336, "body": "Why <b>must</b> you have source in a folder not under $GOPATH ? You are aware that you can have multiple paths as $GOPATH ?"}, {"owner": {"reputation": 4366, "user_id": 176478, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a10b460f85d3d8b9702782bf6dd72307?s=128&d=identicon&r=PG", "display_name": "dmportella", "link": "https://stackoverflow.com/users/176478/dmportella"}, "edited": false, "score": 0, "creation_date": 1473085829, "post_id": 39326948, "comment_id": 65996891, "body": "you should have your project in golang source path, biggest mistake new golang devs make is putting stuff outside the golang path. GOLANG workspace is build to be managed by go dont try to change that as it will not work."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1473069525, "creation_date": 1473069525, "answer_id": 39328105, "question_id": 39326948, "link": "https://stackoverflow.com/questions/39326948/using-go-get-to-retrieve-from-a-local-repository-and-private-repo/39328105#39328105", "title": "Using go get to retrieve from a local repository and private repo", "body": "<p>You cannot do neither 1) nor 2) (easily). <code>go get</code> is not intended to be used this way.</p>\n"}, {"tags": [], "owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "is_accepted": false, "score": 3, "last_activity_date": 1473122131, "creation_date": 1473122131, "answer_id": 39339116, "question_id": 39326948, "link": "https://stackoverflow.com/questions/39326948/using-go-get-to-retrieve-from-a-local-repository-and-private-repo/39339116#39339116", "title": "Using go get to retrieve from a local repository and private repo", "body": "<ol>\n<li><p>This is not really possible without serious hacks. The \"simplest\" hack is probably using a symlink, bind mount, or NFS mount.</p>\n\n<p>That being said, it's best to just follow <code>GOPATH</code>. You don't have to like it, but for better or worse Go is opinionated about these sort of things, and your life will be easier.</p></li>\n<li><p>Use ssh keys for authorisation (rather than a user/password) and add this to your <code>~/.gitconfig</code> to make sure <code>ssh</code> is used: </p>\n\n<pre><code>[url \"git@github.com:\"]\n    insteadOf = https://github.com/\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 621, "user_id": 2294667, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9a834b6b0c63e84c6e4f473161eec983?s=128&d=identicon&r=PG", "display_name": "Westy10101", "link": "https://stackoverflow.com/users/2294667/westy10101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1374, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1473122181, "creation_date": 1473065593, "last_edit_date": 1473122181, "question_id": 39326948, "link": "https://stackoverflow.com/questions/39326948/using-go-get-to-retrieve-from-a-local-repository-and-private-repo", "title": "Using go get to retrieve from a local repository and private repo", "body": "<p>Hi my goal is to have <code>go get</code> retrieve from a private repo on github. </p>\n\n<p>The problem I am having is that I am committing into a folder structure that is outside of my GOPATH. So I want to test that what I have works before I commit. </p>\n\n<p>1) How do I make go get retrieve from a local directory that is outside my path. Say my go code is in a directory $HOME/project/ How can I tell go get to retrieve the package and place it in the appropriate github.com folder structure so that my package references work?</p>\n\n<p>2) How can I use go get to pull from a private repo? Should it just ask for my username and password? </p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 1, "creation_date": 1473024697, "post_id": 39321653, "comment_id": 65975298, "body": "You&#39;re missing a {} at the end of []Abonnement"}, {"owner": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1473025738, "post_id": 39321653, "comment_id": 65975573, "body": "How can I add the default value for abonnements? &quot;abonnements&quot;: { &quot;newsletter&quot;: false }  @Sridhar"}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "edited": false, "score": 0, "creation_date": 1473025576, "post_id": 39321696, "comment_id": 65975520, "body": "How can I add the default value for abonnements? @uvelichitel  &quot;abonnements&quot;: {     &quot;newsletter&quot;: false   }"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "edited": false, "score": 0, "creation_date": 1473028578, "post_id": 39321696, "comment_id": 65976105, "body": "Abonnements :  []Abonnement{{false}}"}, {"owner": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "edited": false, "score": 0, "creation_date": 1473100417, "post_id": 39321696, "comment_id": 66003340, "body": "The problem with this solution is that it creates : &quot;abonnements&quot;: [ { &quot;newsletter&quot;: false } ] and I would like : {&quot;abonnements&quot;: { &quot;newsletter&quot;: false } }"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "edited": false, "score": 0, "creation_date": 1473101742, "post_id": 39321696, "comment_id": 66003800, "body": "You define Abonnements as slice of Abonnement in Person struct. So it initialized as slice and than marshalled in bson array."}, {"owner": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "edited": false, "score": 0, "creation_date": 1473102503, "post_id": 39321696, "comment_id": 66004078, "body": "Ok, but if I do this : Abonnements Abonnement <code>bson:&quot;abonnements&quot;</code> How can I add the default value this time ? <a href=\"https://puu.sh/r11A6/5925bdfa82.png\" rel=\"nofollow noreferrer\">puu.sh/r11A6/5925bdfa82.png</a>"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "edited": false, "score": 1, "creation_date": 1473102964, "post_id": 39321696, "comment_id": 66004226, "body": "Abonnements : Abonnement{false}"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 1, "last_activity_date": 1473024811, "creation_date": 1473024811, "answer_id": 39321696, "question_id": 39321653, "link": "https://stackoverflow.com/questions/39321653/insert-nested-structures-in-mongodb-with-golang/39321696#39321696", "title": "Insert nested structures in MongoDb with Golang", "body": "<p>Seems just a typo</p>\n\n<pre><code>Abonnements : []Abonnement{}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "edited": false, "score": 0, "creation_date": 1473027874, "post_id": 39321938, "comment_id": 65975991, "body": "The problem with this solution is that it creates : &quot;abonnements&quot;: [ { &quot;newsletter&quot;: false } ]  and I would like : {&quot;abonnements&quot;:  { &quot;newsletter&quot;: false } }"}, {"owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "reply_to_user": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "edited": false, "score": 0, "creation_date": 1473029203, "post_id": 39321938, "comment_id": 65976213, "body": "In the edit I made a map, then marshaled the map to json and assigned the string to Abonnments as string."}], "tags": [], "owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "is_accepted": false, "score": 1, "last_activity_date": 1473027802, "last_edit_date": 1473027802, "creation_date": 1473027102, "answer_id": 39321938, "question_id": 39321653, "link": "https://stackoverflow.com/questions/39321653/insert-nested-structures-in-mongodb-with-golang/39321938#39321938", "title": "Insert nested structures in MongoDb with Golang", "body": "<p>Maybe something like this. First define a function that returns a pointer to the structure:</p>\n\n<pre><code>func NewAbonnement()(ab *Abonnement){\n    return &amp;Abonnement{Newsletter: false}\n}\n</code></pre>\n\n<p>Then call the function as Abonnement slice literal:</p>\n\n<pre><code> personita := Persone{\n      Compte : \"Standard\",\n      Datei : time.Date(2015, time.February, 12, 04, 11, 0, 0, time.UTC),\n      Email : \"test@test.com\",\n      MDP : \"test_mdp\",\n      Type : \"T&amp;D\",\n      User : \"test_user\",\n      Validation : \"valid\u00e9\",\n      Arrival  : []string{},\n      Clicks : []string{},\n      Recherches : []string{},\n      Abonnements : []Abonnement{*NewAbonnement()},\n    }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/K5UE4xC9TE\" rel=\"nofollow\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "is_accepted": false, "score": 0, "last_activity_date": 1473601678, "creation_date": 1473601678, "answer_id": 39436744, "question_id": 39321653, "link": "https://stackoverflow.com/questions/39321653/insert-nested-structures-in-mongodb-with-golang/39436744#39436744", "title": "Insert nested structures in MongoDb with Golang", "body": "<p>The solution for having Nested structures is to do:</p>\n\n<pre><code>type Abonnement struct {\n  Newsletter bool `bson:\"newsletter\"`\n  StripeID string `bson:\"stripe_id,omitempty\"`\n  StripeSub string `bson:\"stripe_sub,omitempty\"`\n}\n\ntype Personne struct {\n  Compte string `bson:\"compte\"`\n  Datei time.Time `bson:\"datei\"`\n  Email string  `bson:\"email\"`\n  MDP string `bson:\"mdp\"`\n  Type string `bson:\"T&amp;D\"`\n  User string `bson:\"user\"`\n  Validation string `bson:\"validation\"`\n  Arrival []string `bson:\"Arrival\"`\n  Clicks []string `bson:\"Clicks\"`\n  Recherches []string `bson:\"Recherches\"`\n  Abonnements Abonnement `bson:\"abonnements\"`\n}\n</code></pre>\n\n<p>and then :</p>\n\n<pre><code>personita := Personne{\n    Compte : \"Standard\",\n    Datei : time.Date(2015, time.February, 12, 04, 11, 0, 0, time.UTC),\n    Email : \"test@test.com\",\n    MDP : \"test_mdp\",\n    Type : \"T&amp;D\",\n    User : \"test_user\",\n    Validation : \"valid\u00e9\",\n    Abonnements : Abonnement{false,\"\",\"\"},\n   }\n\nif err := coll.Insert(personita); err != nil {panic(err)}\n</code></pre>\n\n<p>This way you have  the nested JSON added to MongoDB with default values.</p>\n\n<p>Furthermore, in this particular case, StripeID or StripeSub are optional, hence if the value is empty they won't appear on your database.</p>\n"}], "owner": {"reputation": 65, "user_id": 1080674, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a3448b3cb7a810959aa15339156941d7?s=128&d=identicon&r=PG", "display_name": "Juanse", "link": "https://stackoverflow.com/users/1080674/juanse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1195, "favorite_count": 0, "accepted_answer_id": 39321696, "answer_count": 3, "score": 0, "last_activity_date": 1604701081, "creation_date": 1473024428, "last_edit_date": 1604701081, "question_id": 39321653, "link": "https://stackoverflow.com/questions/39321653/insert-nested-structures-in-mongodb-with-golang", "title": "Insert nested structures in MongoDb with Golang", "body": "<p>I have a question regarding storage in MongoDB using mgo.</p>\n<p>My DB has this structure :</p>\n<pre><code>{\n  &quot;Arrival&quot;: [\n    &quot;04-09-2016&quot;\n  ],\n  &quot;Clicks&quot;: [\n    &quot;56ffd41d9c8c9adf088b4576&quot;,\n    &quot;4f1dc63a7c2d3817640000a1&quot;\n  ],\n  &quot;Recherches&quot;: [\n    &quot;\u00e9rysip\u00e8le&quot;\n  ],\n  &quot;abonnements&quot;: {\n    &quot;newsletter&quot;: false\n  },\n  &quot;compte&quot;: &quot;Standard&quot;,\n  &quot;datei&quot;: ISODate(&quot;2016-09-04T14:55:39.179Z&quot;),\n  &quot;email&quot;: &quot;_\u00b0\u00b0\u00b0\u00b0_&quot;,\n  &quot;mdp&quot;: &quot;27d8d166ca1f1715541b7df6453401b95a1d59c2ca0f60ce71037d33926c4d6f09a63a909a8d5cb5230f92584973a4dd2b8bcf155d5785ef7e2afdd113334eee&quot;,\n  &quot;type&quot;: &quot;T&amp;D&quot;,\n  &quot;user&quot;: &quot;_\u00b0\u00b0\u00b0\u00b0_&quot;,\n  &quot;validation&quot;: &quot;valid\u00e9&quot;\n}\n</code></pre>\n<p>In my Go application the structures are :</p>\n<pre><code>type Abonnement struct {\n    Newsletter bool bson:&quot;newsletter&quot;'\n  }\n\ntype Persone struct {\n    Compte string 'bson:&quot;compte&quot;'\n    Datei time.Time 'bson:&quot;datei&quot;'\n    Email string  'bson:&quot;email&quot;'\n    MDP string 'bson:&quot;mdp&quot;'\n    Type string 'bson:&quot;T&amp;D&quot;'\n    User string 'bson:&quot;user&quot;'\n    Validation string 'bson:&quot;validation&quot;'\n    Arrival []string 'bson:&quot;Arrival&quot;'\n    Clicks []string 'bson:&quot;Clicks&quot;'\n    Recherches []string 'bson:&quot;Recherches&quot;'\n    Abonnements []Abonnement 'bson:&quot;abonnements&quot;'\n  }\n</code></pre>\n<p>But I can't manage to create the variable to put everything together :</p>\n<pre><code>personita := Persone{\n      Compte : &quot;Standard&quot;,\n      Datei : time.Date(2015, time.February, 12, 04, 11, 0, 0, time.UTC),\n      Email : &quot;test@test.com&quot;,\n      MDP : &quot;test_mdp&quot;,\n      Type : &quot;T&amp;D&quot;,\n      User : &quot;test_user&quot;,\n      Validation : &quot;valid\u00e9&quot;,\n      Arrival  : []string{},\n      Clicks : []string{},\n      Recherches : []string{},\n      Abonnements : []Abonnement{},\n    }\n</code></pre>\n<p>My main goal would be that there's a default value when I insert 'personita' with this inside :</p>\n<pre><code>&quot;abonnements&quot;: {\n    &quot;newsletter&quot;: false\n  }\n</code></pre>\n"}, {"tags": ["http", "browser", "go", "server"], "answers": [{"comments": [{"owner": {"reputation": 1230, "user_id": 8817146, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PumT2uwEpIM/AAAAAAAAAAI/AAAAAAAAABU/uws_6uoMmkw/photo.jpg?sz=128", "display_name": "rotimi-best", "link": "https://stackoverflow.com/users/8817146/rotimi-best"}, "edited": false, "score": 0, "creation_date": 1558350900, "post_id": 39320821, "comment_id": 99060011, "body": "What if I wanted to then close the tab that was opened by <code>xdg-open</code>?"}, {"owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "reply_to_user": {"reputation": 1230, "user_id": 8817146, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PumT2uwEpIM/AAAAAAAAAAI/AAAAAAAAABU/uws_6uoMmkw/photo.jpg?sz=128", "display_name": "rotimi-best", "link": "https://stackoverflow.com/users/8817146/rotimi-best"}, "edited": false, "score": 0, "creation_date": 1558352032, "post_id": 39320821, "comment_id": 99060666, "body": "@RotimiBest That is not possible."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 0, "last_activity_date": 1473018199, "creation_date": 1473018199, "answer_id": 39320821, "question_id": 39320371, "link": "https://stackoverflow.com/questions/39320371/how-start-web-server-to-open-page-in-browser-in-golang/39320821#39320821", "title": "How start web server to open page in browser in golang?", "body": "<p>It is quite a general problem. You can use <code>xdg-open</code> program to do it for you. Just run the process from Go. The <code>xdg-open</code> will fork by itself so we can just simply use <code>Run</code> and wait for the end of process.</p>\n\n<pre><code>package main\n\nimport \"os/exec\"\n\nfunc main() {\n    exec.Command(\"xdg-open\", \"http://example.com/\").Run()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1903, "user_id": 98071, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/f1a4dedc45c7856be78196f677456cb2?s=128&d=identicon&r=PG", "display_name": "Pep", "link": "https://stackoverflow.com/users/98071/pep"}, "edited": false, "score": 0, "creation_date": 1536404621, "post_id": 39324149, "comment_id": 91417940, "body": "Perhaps a ParseRequestURI validation for the url parameter will not harm. You never know how SO code is copied and pasted in the wild."}, {"owner": {"reputation": 1828, "user_id": 3236818, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c8c062d0722ae02e3b5fafe312528b9e?s=128&d=identicon&r=PG&f=1", "display_name": "tharinduwijewardane", "link": "https://stackoverflow.com/users/3236818/tharinduwijewardane"}, "edited": false, "score": 0, "creation_date": 1567401769, "post_id": 39324149, "comment_id": 101940316, "body": "<a href=\"https://stackoverflow.com/a/32742904/3236818\">stackoverflow.com/a/32742904/3236818</a> explains how to start the browser after the server starts listening. without any polling."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 32, "last_activity_date": 1608886872, "last_edit_date": 1608886872, "creation_date": 1473051369, "answer_id": 39324149, "question_id": 39320371, "link": "https://stackoverflow.com/questions/39320371/how-start-web-server-to-open-page-in-browser-in-golang/39324149#39324149", "title": "How start web server to open page in browser in golang?", "body": "<p>Your question is a little misleading as it asks how to open a local page in the web browser, but you actually want to know how to fire up a web server so it can be opened in the browser.</p>\n<p>For the latter (firing up a web server to serve static files), you may use the <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\"><code>http.FileServer()</code></a> function. For answers presenting it in greater detail, see: <a href=\"https://stackoverflow.com/a/28899786/1705598\">Include js file in Go template</a> and <a href=\"https://stackoverflow.com/a/28745280/1705598\">With golang webserver where does the root of the website map onto the filesystem&gt;</a>.</p>\n<p>Example serving your <code>/tmp/data</code> folder:</p>\n<pre><code>http.Handle(&quot;/&quot;, http.FileServer(http.Dir(&quot;/tmp/data&quot;)))\npanic(http.ListenAndServe(&quot;:8080&quot;, nil))\n</code></pre>\n<p>If you want to serve dynamic content (generated by Go code), you can use the <a href=\"http://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\"><code>net/http</code></a> package and write your own handler generating the response, e.g.:</p>\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, &quot;Hello from Go&quot;)\n}\n\nfunc main() {\n    http.HandleFunc(&quot;/&quot;, myHandler)\n    panic(http.ListenAndServe(&quot;:8080&quot;, nil))\n}\n</code></pre>\n<p>As to the first (to open a page in your default browser), there is no builtin support in the Go standard library. But it's not that hard, you just have to execute an OS-specific external command. You may use this cross-platform solution (which I also released in my <a href=\"https://github.com/icza/gox\" rel=\"nofollow noreferrer\"><code>github.com/icza/gox</code></a> library, see <a href=\"https://godoc.org/github.com/icza/gox/osx#OpenDefault\" rel=\"nofollow noreferrer\"><code>osx.OpenDefault()</code></a>):</p>\n<pre><code>// open opens the specified URL in the default browser of the user.\nfunc open(url string) error {\n    var cmd string\n    var args []string\n\n    switch runtime.GOOS {\n    case &quot;windows&quot;:\n        cmd = &quot;cmd&quot;\n        args = []string{&quot;/c&quot;, &quot;start&quot;}\n    case &quot;darwin&quot;:\n        cmd = &quot;open&quot;\n    default: // &quot;linux&quot;, &quot;freebsd&quot;, &quot;openbsd&quot;, &quot;netbsd&quot;\n        cmd = &quot;xdg-open&quot;\n    }\n    args = append(args, url)\n    return exec.Command(cmd, args...).Start()\n}\n</code></pre>\n<p>This example code is taken from <a href=\"https://github.com/icza/gowut\" rel=\"nofollow noreferrer\">Gowut</a> (which is Go Web UI Toolkit; disclosure: I'm the author).</p>\n<p>Note that <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"nofollow noreferrer\"><code>exec.Command()</code></a> performs OS-specific argument quoting if needed. So for example if the URL contains <code>&amp;</code>, it will be properly escaped on Linux, however, it might not work on Windows. On Windows you might have to manually quote it yourself, e.g. with replacing <code>&amp;</code> signs with <code>&quot;^&amp;&quot;</code> with a call like <code>strings.ReplaceAll(url, &quot;&amp;&quot;, &quot;^&amp;&quot;)</code>.</p>\n<p>Using this to open the previously started webserver in your default browser:</p>\n<pre><code>open(&quot;http://localhost:8080/&quot;)\n</code></pre>\n<p>One last thing to note: <a href=\"https://golang.org/pkg/net/http/#ListenAndServe\" rel=\"nofollow noreferrer\"><code>http.ListenAndServe()</code></a> blocks and never returns (if there is no error). So you have to start the server or the browser in another goroutine, for example:</p>\n<pre><code>go open(&quot;http://localhost:8080/&quot;)\npanic(http.ListenAndServe(&quot;:8080&quot;, nil))\n</code></pre>\n<p>Check out this question for other alternatives how to start the browser after the webserver has been started: <a href=\"https://stackoverflow.com/questions/32738188/go-how-can-i-start-the-browser-after-the-server-started-listening/32738973#32738973\">Go: How can I start the browser AFTER the server started listening?</a></p>\n"}, {"comments": [{"owner": {"reputation": 998, "user_id": 2325784, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/85f7bd93e3c87e1b2174ab0fecb5b28b?s=128&d=identicon&r=PG", "display_name": "JamesStewy", "link": "https://stackoverflow.com/users/2325784/jamesstewy"}, "edited": false, "score": 0, "creation_date": 1480547566, "post_id": 40899812, "comment_id": 69013686, "body": "Hi. The code you have provided has a number of syntax errors including not importing &quot;net/http&quot;, importing &quot;os/exec&quot; but not using it and calling &quot;open&quot; which is not defined. Could you please edit you code (and test it) to help answer this question. Thanks."}], "tags": [], "owner": {"reputation": 735, "user_id": 7233489, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vadH0.jpg?s=128&g=1", "display_name": "Paul Buis", "link": "https://stackoverflow.com/users/7233489/paul-buis"}, "is_accepted": false, "score": -2, "last_activity_date": 1512711113, "last_edit_date": 1512711113, "creation_date": 1480546678, "answer_id": 40899812, "question_id": 39320371, "link": "https://stackoverflow.com/questions/39320371/how-start-web-server-to-open-page-in-browser-in-golang/40899812#40899812", "title": "How start web server to open page in browser in golang?", "body": "<p>Last time I did something like this, I added a short delay before starting up the browser, to make sure the server had time to be listening before the browser sent the first request. On my Linux system, xdg wasn't configured quite right and rather than fixing the xdg configuration, I just hardwired it with \"firefox\" rather than \"xdg-open\". Starting the browser on the same machine as the web server made for a good thing in development. But in deployment, the web server is likely to be running on a headless remote system and it might make more sense to simply print the initial URL to the console for a copy-paste from a terminal session to the remote server into a local browser. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc myHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello from Go\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", myHandler)\n    go func() {\n        &lt;-time.After(100 * time.Millisecond)\n        open(\"http://localhost:8080/\")\n    }()\n    panic(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 929, "user_id": 6146337, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/10207160730031528/picture?type=large", "display_name": "Sebastian", "link": "https://stackoverflow.com/users/6146337/sebastian"}, "is_accepted": false, "score": 0, "last_activity_date": 1522939772, "creation_date": 1522939772, "answer_id": 49675316, "question_id": 39320371, "link": "https://stackoverflow.com/questions/39320371/how-start-web-server-to-open-page-in-browser-in-golang/49675316#49675316", "title": "How start web server to open page in browser in golang?", "body": "<p>Building off of Paul's answer, here is a solution that works on Windows:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"os/exec\"\n    \"time\"\n)\n\n\nfunc main() {\n    http.HandleFunc(\"/\", myHandler)\n    go func() {\n        &lt;-time.After(100 * time.Millisecond)\n        err := exec.Command(\"explorer\", \"http://127.0.0.1:8080\").Run()\n        if err != nil {\n            log.Println(err)\n        }\n    }()\n\n    log.Println(\"running at port localhost:8080\")\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}], "owner": {"reputation": 6272, "user_id": 3311276, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/tzd3h.png?s=128&g=1", "display_name": "Ciasto piekarz", "link": "https://stackoverflow.com/users/3311276/ciasto-piekarz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15828, "favorite_count": 9, "accepted_answer_id": 39324149, "answer_count": 4, "score": 14, "last_activity_date": 1608886872, "creation_date": 1473014965, "last_edit_date": 1473060976, "question_id": 39320371, "link": "https://stackoverflow.com/questions/39320371/how-start-web-server-to-open-page-in-browser-in-golang", "title": "How start web server to open page in browser in golang?", "body": "<p>How do I temporarily open a web page in browser using golang?</p>\n\n<p>Like here is how it is done using <a href=\"http://m.linuxjournal.com/content/tech-tip-really-simple-http-server-python\" rel=\"noreferrer\">HTTPServer in</a> python.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "edited": false, "score": 1, "creation_date": 1473022415, "post_id": 39320530, "comment_id": 65974708, "body": "thanks but that doesn&#39;t answer my question. I am asking about <code>http.ListenAndServe</code> for specific reasons. That is how I use GWT MUX library, i&#39;m not sure how to use net.listen for that.."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "edited": false, "score": 6, "creation_date": 1473023435, "post_id": 39320530, "comment_id": 65974979, "body": "You use http.Serve() instead of http.ListenAndServe() exactly same way with same syntax just with own Listener. http.Serve(net.Listener, gorilla.mux.Router)"}, {"owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "edited": false, "score": 0, "creation_date": 1473025922, "post_id": 39320530, "comment_id": 65975615, "body": "Ah great, thanks. I haven&#39;t tested yet but should work."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1473196255, "post_id": 39320530, "comment_id": 66045680, "body": "Bit late, but we&#39;ve been using the <a href=\"https://github.com/braintree/manners\" rel=\"nofollow noreferrer\">manners package</a> for this use case.  It&#39;s a drop-in replacement for the standard http package that allows graceful shutdown (ie. finishes all active requests while declining new ones, then exits)."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 21, "last_activity_date": 1473017107, "last_edit_date": 1473017107, "creation_date": 1473016197, "answer_id": 39320530, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve/39320530#39320530", "title": "How to stop http.ListenAndServe()", "body": "<p>You can construct <code>net.Listener</code></p>\n\n<pre><code>l, err := net.Listen(\"tcp\", fmt.Sprintf(\":%d\", service.Port()))\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>which you can <code>Close()</code></p>\n\n<pre><code>go func(){\n    //...\n    l.Close()\n}()\n</code></pre>\n\n<p>and <code>http.Serve()</code> on it</p>\n\n<pre><code>http.Serve(l, service.router)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2139, "user_id": 616310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f068ea99138ae9159afacec3e94dbdec?s=128&d=identicon&r=PG&f=1", "display_name": "pseidemann", "link": "https://stackoverflow.com/users/616310/pseidemann"}, "edited": false, "score": 0, "creation_date": 1529430230, "post_id": 40041517, "comment_id": 88866838, "body": "I created a package which does the boilerplate for you <a href=\"https://github.com/pseidemann/finish\" rel=\"nofollow noreferrer\">github.com/pseidemann/finish</a>"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 76, "last_activity_date": 1583330350, "last_edit_date": 1583330350, "creation_date": 1476442685, "answer_id": 40041517, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve/40041517#40041517", "title": "How to stop http.ListenAndServe()", "body": "<p>As mentioned in <code>yo.ian.g</code>'s answer. Go 1.8 has included this functionality in the standard lib.</p>\n\n<p>Minimal example for for <code>Go 1.8+</code>:</p>\n\n<pre><code>    server := &amp;http.Server{Addr: \":8080\", Handler: handler}\n\n    go func() {\n        if err := server.ListenAndServe(); err != nil {\n            // handle err\n        }\n    }()\n\n    // Setting up signal capturing\n    stop := make(chan os.Signal, 1)\n    signal.Notify(stop, os.Interrupt)\n\n    // Waiting for SIGINT (pkill -2)\n    &lt;-stop\n\n    ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\n    defer cancel()\n    if err := server.Shutdown(ctx); err != nil {\n        // handle err\n    }\n\n    // Wait for ListenAndServe goroutine to close.\n</code></pre>\n\n<hr>\n\n<p><strong>Original Answer - Pre Go 1.8 :</strong></p>\n\n<p>Building on <a href=\"https://stackoverflow.com/users/4374109/uvelichitel\">Uvelichitel's</a> answer. </p>\n\n<p>You can create your own version of <code>ListenAndServe</code> which returns an <code>io.Closer</code> and does not block.</p>\n\n<pre><code>func ListenAndServeWithClose(addr string, handler http.Handler) (io.Closer,error) {\n\n    var (\n        listener  net.Listener\n        srvCloser io.Closer\n        err       error\n    )\n\n    srv := &amp;http.Server{Addr: addr, Handler: handler}\n\n    if addr == \"\" {\n        addr = \":http\"\n    }\n\n    listener, err = net.Listen(\"tcp\", addr)\n    if err != nil {\n        return nil, err\n    }\n\n    go func() {\n        err := srv.Serve(tcpKeepAliveListener{listener.(*net.TCPListener)})\n        if err != nil {\n            log.Println(\"HTTP Server Error - \", err)\n        }\n    }()\n\n    srvCloser = listener\n    return srvCloser, nil\n}\n</code></pre>\n\n<p>Full code available <a href=\"https://play.golang.org/p/-G7nJlH_Mz\" rel=\"noreferrer\">here</a>.</p>\n\n<p>The HTTP Server will close with the error \n<code>accept tcp [::]:8080: use of closed network connection</code></p>\n"}, {"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 7, "creation_date": 1520109941, "post_id": 41433555, "comment_id": 85183556, "body": "sorry to be picky, and I know you&#39;re code was purely example usage, but as a general rule: <code>go func() { X() }()</code> followed by <code>Y()</code> makes the false assumption to the reader that <code>X()</code> will execute before <code>Y()</code>. Waitgroups etc. ensure timing bugs like this don&#39;t bite you when least expected!"}], "tags": [], "owner": {"reputation": 1274, "user_id": 96153, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4bb66a2f2e0ce3f812e68dcf625c753?s=128&d=identicon&r=PG", "display_name": "yo.ian.g", "link": "https://stackoverflow.com/users/96153/yo-ian-g"}, "is_accepted": false, "score": 24, "last_activity_date": 1483392805, "creation_date": 1483392805, "answer_id": 41433555, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve/41433555#41433555", "title": "How to stop http.ListenAndServe()", "body": "<p>Go 1.8 will include graceful and forceful shutdown, available via <code>Server::Shutdown(context.Context)</code> and <code>Server::Close()</code> respectively.</p>\n\n<pre><code>go func() {\n    httpError := srv.ListenAndServe(address, handler)\n    if httpError != nil {\n        log.Println(\"While serving HTTP: \", httpError)\n    }\n}()\n\nsrv.Shutdown(context)\n</code></pre>\n\n<p>The relevant commit can be found <a href=\"https://github.com/golang/go/commit/53fc330e2d154443acf3d01e0d68bae22b2b7804\">here</a></p>\n"}, {"comments": [{"owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "reply_to_user": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "edited": false, "score": 1, "creation_date": 1488525163, "post_id": 42533360, "comment_id": 72278751, "body": "Yes, the feature is Shutdown(), whose concrete usage I&#39;m demonstrating here. Thanks, I should&#39;ve been more clear, I changed the heading to this now: &quot;Regarding graceful shutdown (introduced in Go 1.8), a bit more concrete example:&quot;"}, {"owner": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 0, "creation_date": 1522258315, "post_id": 42533360, "comment_id": 86088850, "body": "When I pass <code>nil</code> to <code>srv.Shutdown</code> I get <code>panic: runtime error: invalid memory address or nil pointer dereference</code>. Passing <code>context.Todo()</code> instead works."}, {"owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "reply_to_user": {"reputation": 48302, "user_id": 388916, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6f9d967832644f9faa431e4e50b69bb0?s=128&d=identicon&r=PG", "display_name": "Hubro", "link": "https://stackoverflow.com/users/388916/hubro"}, "edited": false, "score": 1, "creation_date": 1522306020, "post_id": 42533360, "comment_id": 86106447, "body": "@Hubro that&#39;s weird, I just tried this on latest Golang version (1.10), and it ran fine. context.Background() or context.TODO() of course works and if it works for you, good. :)"}, {"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1545532175, "post_id": 42533360, "comment_id": 94646991, "body": "&quot;NOTE: there is a chance that next line won&#39;t have time to run...&quot; How can we make sure the code in the error handling gets ran?"}, {"owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "reply_to_user": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 1, "creation_date": 1545901181, "post_id": 42533360, "comment_id": 94723493, "body": "@newplayer65 there&#39;s multiple ways to do that. One way could be to create sync.WaitGroup in main(), call Add(1) on it and pass a pointer to it to startHttpServer() and call defer waitGroup.Done() at start of the goroutine that has a call to the ListenAndServe(). then just call waitGroup.Wait() at end of main() to wait for the goroutine to have finished its job."}, {"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1545946873, "post_id": 42533360, "comment_id": 94740913, "body": "I&#39;ve already figured it out, but thanks! I made a goroutine run the <code>ListenAndServe()</code> and have it send it&#39;s error over a <code>chan error</code> to the main thread. So, I block the main thread, and receive the error there to do whatever I want with it on the main thread when the server shuts down :) I actually started a new question for this: <a href=\"https://stackoverflow.com/questions/53907970/golang-graceful-http-server-shutdown-with-error-handling\" title=\"golang graceful http server shutdown with error handling\">stackoverflow.com/questions/53907970/&hellip;</a> and have my solution posted in my edit."}, {"owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "reply_to_user": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 1, "creation_date": 1546009998, "post_id": 42533360, "comment_id": 94758619, "body": "@newplayer65 I looked at your code. Using a channel is a good, probably better option than my suggestion. My code was mainly to demonstrate Shutdown() - not showcase production quality code :) P.s. your project&#39;s &quot;server gopher&quot; logo is adorbs! :D"}, {"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1546029884, "post_id": 42533360, "comment_id": 94765904, "body": "@joonas.fi thanks a lot! Always feels nice to get a positive code/repo review &lt;3"}], "tags": [], "owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "is_accepted": false, "score": 96, "last_activity_date": 1576781061, "last_edit_date": 1576781061, "creation_date": 1488375766, "answer_id": 42533360, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve/42533360#42533360", "title": "How to stop http.ListenAndServe()", "body": "<p>Regarding graceful shutdown (introduced in Go 1.8), a bit more concrete example:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\nfunc startHttpServer(wg *sync.WaitGroup) *http.Server {\n    srv := &amp;http.Server{Addr: \":8080\"}\n\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        io.WriteString(w, \"hello world\\n\")\n    })\n\n    go func() {\n        defer wg.Done() // let main know we are done cleaning up\n\n        // always returns error. ErrServerClosed on graceful close\n        if err := srv.ListenAndServe(); err != http.ErrServerClosed {\n            // unexpected error. port in use?\n            log.Fatalf(\"ListenAndServe(): %v\", err)\n        }\n    }()\n\n    // returning reference so caller can call Shutdown()\n    return srv\n}\n\nfunc main() {\n    log.Printf(\"main: starting HTTP server\")\n\n    httpServerExitDone := &amp;sync.WaitGroup{}\n\n    httpServerExitDone.Add(1)\n    srv := startHttpServer(httpServerExitDone)\n\n    log.Printf(\"main: serving for 10 seconds\")\n\n    time.Sleep(10 * time.Second)\n\n    log.Printf(\"main: stopping HTTP server\")\n\n    // now close the server gracefully (\"shutdown\")\n    // timeout could be given with a proper context\n    // (in real world you shouldn't use TODO()).\n    if err := srv.Shutdown(context.TODO()); err != nil {\n        panic(err) // failure/timeout shutting down the server gracefully\n    }\n\n    // wait for goroutine started in startHttpServer() to stop\n    httpServerExitDone.Wait()\n\n    log.Printf(\"main: done. exiting\")\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 6784278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r1N4w.jpg?s=128&g=1", "display_name": "greg.carter", "link": "https://stackoverflow.com/users/6784278/greg-carter"}, "reply_to_user": {"reputation": 543, "user_id": 1852043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739caa46b06af1242f96cf556b5f0038?s=128&d=identicon&r=PG", "display_name": "Marcin Bilski", "link": "https://stackoverflow.com/users/1852043/marcin-bilski"}, "edited": false, "score": 0, "creation_date": 1560870509, "post_id": 43691382, "comment_id": 99874193, "body": "Of course, I answered the question as asked without any further assumptions about the nature of the problem, and in particular, no assumptions about any given production environment.  But for my own edification, @MarcinBilski, exactly what requirements would render this solution not a good fit for any environment, production or otherwise?"}, {"owner": {"reputation": 543, "user_id": 1852043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739caa46b06af1242f96cf556b5f0038?s=128&d=identicon&r=PG", "display_name": "Marcin Bilski", "link": "https://stackoverflow.com/users/1852043/marcin-bilski"}, "edited": false, "score": 2, "creation_date": 1560961552, "post_id": 43691382, "comment_id": 99911689, "body": "Meant it more tongue-in-cheek than anything because it&#39;s clear you wouldn&#39;t have a /shutdown handler in a production app. :) Anything goes for internal tooling I guess. That aside, there are ways to gracefully shut down the server so it doesn&#39;t suddenly drop connections or crash mid-way through a database transaction or, worse, while writing to disk etc."}, {"owner": {"reputation": 27, "user_id": 6784278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r1N4w.jpg?s=128&g=1", "display_name": "greg.carter", "link": "https://stackoverflow.com/users/6784278/greg-carter"}, "reply_to_user": {"reputation": 543, "user_id": 1852043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739caa46b06af1242f96cf556b5f0038?s=128&d=identicon&r=PG", "display_name": "Marcin Bilski", "link": "https://stackoverflow.com/users/1852043/marcin-bilski"}, "edited": false, "score": 0, "creation_date": 1560970161, "post_id": 43691382, "comment_id": 99915554, "body": "Certainly, it can&#39;t be the case that the down voters are unimaginative. It must be that I assume too much imagination. I&#39;ve updated the response (including the example) to correct my error."}], "tags": [], "owner": {"reputation": 27, "user_id": 6784278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r1N4w.jpg?s=128&g=1", "display_name": "greg.carter", "link": "https://stackoverflow.com/users/6784278/greg-carter"}, "is_accepted": false, "score": -7, "last_activity_date": 1560969966, "last_edit_date": 1560969966, "creation_date": 1493435111, "answer_id": 43691382, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve/43691382#43691382", "title": "How to stop http.ListenAndServe()", "body": "<p>What I've done for such cases where the application is just the server and performing no other function is install an <code>http.HandleFunc</code> for a pattern like <code>/shutdown</code>. Something like</p>\n\n<pre><code>http.HandleFunc(\"/shutdown\", func(w http.ResponseWriter, r *http.Request) {\n    if &lt;credentials check passes&gt; {\n        // - Turn on mechanism to reject incoming requests.\n        // - Block until \"in-flight\" requests complete.\n        // - Release resources, both internal and external.\n        // - Perform all other cleanup procedures thought necessary\n        //   for this to be called a \"graceful shutdown\".\n        fmt.Fprint(w, \"Goodbye!\\n\")\n        os.Exit(0)\n    }\n})\n</code></pre>\n\n<p>It does not require 1.8. But if 1.8 is available, then that solution can be embedded here instead of the <code>os.Exit(0)</code> call if desirable, I believe.</p>\n\n<p>The code to perform all of that cleanup work is left as an exercise for the reader.</p>\n\n<p>Extra credit if you can say where that cleanup code might be most reasonably be placed, for I would not recommend doing it here, and how this endpoint hit should cause the invocation that code.</p>\n\n<p>More extra credit if you can say where that <code>os.exit(0)</code> call (or whatever process exit you choose to use), given here for illustrative purposes only, would be most reasonably placed.</p>\n\n<p>Yet even more extra credit if you can explain why <em>this</em> mechanism of HTTP server process signaling should be considered above all other such mechanisms thought workable in this case.</p>\n"}, {"tags": [], "owner": {"reputation": 541, "user_id": 2431606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65b0ac296333385b22c7616a30d3ac66?s=128&d=identicon&r=PG", "display_name": "juz", "link": "https://stackoverflow.com/users/2431606/juz"}, "is_accepted": false, "score": 14, "last_activity_date": 1494418749, "creation_date": 1494418749, "answer_id": 43892323, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve/43892323#43892323", "title": "How to stop http.ListenAndServe()", "body": "<p>Since none of the previous answers say why you can't do it if you use http.ListenAndServe(), I went into the v1.8 http source code and here is what it says:</p>\n\n<pre><code>func ListenAndServe(addr string, handler Handler) error {\n    server := &amp;Server{Addr: addr, Handler: handler}\n    return server.ListenAndServe()\n}\n</code></pre>\n\n<p>As you can see the http.ListenAndServe function does not return the server variable.  This means you cannot get to 'server' to use the Shutdown command.  Therefore, you need to create your own 'server' instance instead of using this function for the graceful shutdown to be implemented.</p>\n"}, {"comments": [{"owner": {"reputation": 8903, "user_id": 96140, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/57371bcaddaa3fc46e2095bf947b2cb4?s=128&d=identicon&r=PG", "display_name": "Paul Knopf", "link": "https://stackoverflow.com/users/96140/paul-knopf"}, "edited": false, "score": 0, "creation_date": 1541792602, "post_id": 52936280, "comment_id": 93351558, "body": "&quot;Shutting down the server is not something bad ffs Go...&quot;  :)"}, {"owner": {"reputation": 543, "user_id": 1852043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739caa46b06af1242f96cf556b5f0038?s=128&d=identicon&r=PG", "display_name": "Marcin Bilski", "link": "https://stackoverflow.com/users/1852043/marcin-bilski"}, "edited": false, "score": 0, "creation_date": 1560961768, "post_id": 52936280, "comment_id": 99911777, "body": "One thing worth noting is that, for a graceful shutdown, before exiting you need to wait for Shutdown to return which doesn&#39;t seem to be happening here."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565266559, "post_id": 52936280, "comment_id": 101304691, "body": "Your use of <code>ctx</code> to <code>server.Shutdown</code> is incorrect. The context is already cancelled so it <i>will not be shutdown</i> cleanly. You might have well called <code>server.Close</code> for an unclean shutdown. (For a clean shutdown this code would need to be extensively re-worked."}], "tags": [], "owner": {"reputation": 5658, "user_id": 1162217, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/7E5sp.jpg?s=128&g=1", "display_name": "Lukas Lukac", "link": "https://stackoverflow.com/users/1162217/lukas-lukac"}, "is_accepted": false, "score": 2, "last_activity_date": 1565267147, "last_edit_date": 1565267147, "creation_date": 1540235556, "answer_id": 52936280, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve/52936280#52936280", "title": "How to stop http.ListenAndServe()", "body": "<p>You can close the server by closing its context.</p>\n\n<pre><code>type ServeReqs func(ctx context.Context, cfg Config, deps ReqHandlersDependencies) error\n\nvar ServeReqsImpl = func(ctx context.Context, cfg Config, deps ReqHandlersDependencies) error {\n    http.Handle(pingRoute, decorateHttpRes(pingHandlerImpl(deps.pingRouteResponseMessage), addJsonHeader()))\n\n    server := &amp;http.Server{Addr: fmt.Sprintf(\":%d\", cfg.port), Handler: nil}\n\n    go func() {\n        &lt;-ctx.Done()\n        fmt.Println(\"Shutting down the HTTP server...\")\n        server.Shutdown(ctx)\n    }()\n\n    err := server.ListenAndServeTLS(\n        cfg.certificatePemFilePath,\n        cfg.certificatePemPrivKeyFilePath,\n    )\n\n    // Shutting down the server is not something bad ffs Go...\n    if err == http.ErrServerClosed {\n        return nil\n    }\n\n    return err\n}\n</code></pre>\n\n<p>And whenever you are ready to close it, call:</p>\n\n<pre><code>ctx, closeServer := context.WithCancel(context.Background())\nerr := ServeReqs(ctx, etc)\ncloseServer()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8906, "user_id": 736571, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/032f0832fef7fa016de14a756fa8ac65?s=128&d=identicon&r=PG", "display_name": "Sean", "link": "https://stackoverflow.com/users/736571/sean"}, "is_accepted": false, "score": 1, "last_activity_date": 1578903101, "creation_date": 1578903101, "answer_id": 59712679, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve/59712679#59712679", "title": "How to stop http.ListenAndServe()", "body": "<p>It is possible to solve this using a <code>context.Context</code> using a <a href=\"https://golang.org/pkg/net/#ListenConfig\" rel=\"nofollow noreferrer\"><code>net.ListenConfig</code></a>.  In my case, I didn't want to use a <code>sync.WaitGroup</code> or <code>http.Server</code>'s <code>Shutdown()</code> call, and instead rely on a <code>context.Context</code> (which was closed with a signal).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n  \"context\"\n  \"http\"\n  \"net\"\n  \"net/http/pprof\"\n)\n\nfunc myListen(ctx context.Context, cancel context.CancelFunc) error {\n  lc := net.ListenConfig{}\n  ln, err := lc.Listen(ctx, \"tcp4\", \"127.0.0.1:6060\")\n  if err != nil {\n    // wrap the err or log why the listen failed\n    return err\n  }\n\n  mux := http.NewServeMux()\n  mux.Handle(\"/debug/pprof/\", pprof.Index)\n  mux.Handle(\"/debug/pprof/cmdline\", pprof.CmdLine)\n  mux.Handle(\"/debug/pprof/profile\", pprof.Profile)\n  mux.Handle(\"/debug/pprof/symbol\", pprof.Symbol)\n  mux.Handle(\"/debug/pprof/trace\", pprof.Trace)\n\n  go func() {\n    if err := http.Serve(l, mux); err != nil {\n      cancel()\n      // log why we shut down the context\n      return err\n    }\n  }()\n\n  // If you want something semi-synchronous, sleep here for a fraction of a second\n\n  return nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2231, "user_id": 9805867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g1ebb.png?s=128&g=1", "display_name": "IvanD", "link": "https://stackoverflow.com/users/9805867/ivand"}, "is_accepted": false, "score": 0, "last_activity_date": 1615585439, "creation_date": 1615585439, "answer_id": 66607600, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve/66607600#66607600", "title": "How to stop http.ListenAndServe()", "body": "<p>Reproducible example when you do not want your main server to be run in a separate goroutine:</p>\n<p><code>main.go:</code></p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;context&quot;\n    &quot;log&quot;\n    &quot;net/http&quot;\n    &quot;os&quot;\n    &quot;os/signal&quot;\n    &quot;sync&quot;\n    &quot;time&quot;\n)\n\nfunc main() {\n    http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, _ *http.Request) {\n        // wait for 10 seconds before sending OK\n        time.Sleep(10 * time.Second)\n        _, _ = w.Write([]byte(&quot;OK\\n&quot;))\n    })\n    server := &amp;http.Server{Addr: &quot;:3333&quot;, Handler: nil}\n\n    // Creating a waiting group that waits until the graceful shutdown procedure is done\n    var wg sync.WaitGroup\n    wg.Add(1)\n\n    // This goroutine is running in parallels to the main one\n    go func() {\n        // creating a channel to listen for signals, like SIGINT\n        stop := make(chan os.Signal, 1)\n        // subscribing to interruption signals\n        signal.Notify(stop, os.Interrupt)\n        // this blocks until the signal is received\n        &lt;-stop\n        // initiating the shutdown\n        err := server.Shutdown(context.Background())\n        // can't do much here except for logging any errors\n        if err != nil {\n            log.Printf(&quot;error during shutdown: %v\\n&quot;, err)\n        }\n        // notifying the main goroutine that we are done\n        wg.Done()\n    }()\n\n    log.Println(&quot;listening on port 3333...&quot;)\n    err := server.ListenAndServe()\n    if err == http.ErrServerClosed { // graceful shutdown\n        log.Println(&quot;commencing server shutdown...&quot;)\n        wg.Wait()\n        log.Println(&quot;server was gracefully shut down.&quot;)\n    } else if err != nil {\n        log.Printf(&quot;server error: %v\\n&quot;, err)\n    }\n}\n</code></pre>\n<p>Open two terminals. In the first run the app, in the second one run <code>curl localhost:3333</code>, then <strong>quickly</strong> switch to the first one and try to stop the app with <code>CTRL+C</code></p>\n<p>The output should be:</p>\n<pre><code>2021/03/12 13:39:49 listening on port 3333...\n2021/03/12 13:39:50 user initiated a request\n2021/03/12 13:39:54 commencing server shutdown...\n2021/03/12 13:40:00 user request is fulfilled\n2021/03/12 13:40:01 server was gracefully shut down.\n</code></pre>\n"}], "owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71599, "favorite_count": 31, "answer_count": 9, "score": 93, "last_activity_date": 1615585439, "creation_date": 1473012722, "last_edit_date": 1564161817, "question_id": 39320025, "link": "https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve", "title": "How to stop http.ListenAndServe()", "body": "<p>I am using the Mux library from Gorilla Web Toolkit along with the bundled Go http server.</p>\n\n<p>The problem is that in my application the HTTP server is only one component and it is required to stop and start at my discretion.</p>\n\n<p>When I call <code>http.ListenAndServe(fmt.Sprintf(\":%d\", service.Port()), service.router)</code> it blocks and I cannot seem to stop the server from running.</p>\n\n<p>I am aware this has been a problem in the past, is that still the case? Are there any new solutions?</p>\n"}, {"tags": ["java", "json", "go", "middleware"], "comments": [{"owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "edited": false, "score": 0, "creation_date": 1473010055, "post_id": 39319481, "comment_id": 65971248, "body": "Can you share the code where you are unmarshalling in go?"}], "answers": [{"tags": [], "owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "is_accepted": true, "score": 3, "last_activity_date": 1473010514, "creation_date": 1473010514, "answer_id": 39319679, "question_id": 39319481, "link": "https://stackoverflow.com/questions/39319481/golang-java-failed-to-unmarshal-json-from-middleware/39319679#39319679", "title": "Golang/Java Failed to unmarshal JSON from middleware", "body": "<p>The error message says <code>cannot unmarshal string into Go value of type int</code>. Which means you are sending something as <code>string</code> when Go is expecting it to be an <code>int</code>.</p>\n\n<p>The Go code is trying to unmarshall JSON using <a href=\"https://github.com/SpectoLabs/hoverfly/blob/1e0b67df2c3f16d3fbac0aa9904f5e14fca1f058/functional-tests/core/vendor/github.com/SpectoLabs/hoverfly/core/views/views.go#L29\" rel=\"nofollow\">this</a> definition</p>\n\n<p><strong>Solution:</strong></p>\n\n<p><code>\"status\":\"500\"</code> should be sent as <code>\"status\":500</code></p>\n\n<p>Try </p>\n\n<pre><code> response.put(\"status\", 500);\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6454262, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/06eb599124d3d87bd5b644300becc495?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Korza", "link": "https://stackoverflow.com/users/6454262/mike-korza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 365, "favorite_count": 0, "accepted_answer_id": 39319679, "answer_count": 1, "score": 0, "last_activity_date": 1473010514, "creation_date": 1473009088, "last_edit_date": 1473009389, "question_id": 39319481, "link": "https://stackoverflow.com/questions/39319481/golang-java-failed-to-unmarshal-json-from-middleware", "title": "Golang/Java Failed to unmarshal JSON from middleware", "body": "<p>I am writing a middleware for a GoLang application (<a href=\"http://hoverfly.io/\" rel=\"nofollow\">http://hoverfly.io/</a>) but having some issues.</p>\n\n<p>The concept is very simple. Golang passes in a JSON input to my Java middleware, and my middleware then returns a modified json output to the Golang application.</p>\n\n<pre><code>import java.io.BufferedWriter;\nimport java.io.File;\nimport java.io.FileWriter;\nimport java.io.IOException;\nimport java.util.Scanner;\nimport org.json.JSONObject;\n\npublic class mid\n{\n\n    static String payload  =\"\";\n    public static void main (String[] args) throws Exception\n  {\n    try {\n        @SuppressWarnings(\"resource\")\n        Scanner scanner = new Scanner(System.in);\n\n\n         payload = scanner.nextLine();\n\n\n        JSONObject obj = new JSONObject(payload);\n\n\n        JSONObject response = obj.getJSONObject(\"response\");\n\n        response.remove(\"status\");\n\n        response.put(\"status\", \"500\");\n\n\n\n        String newjson = obj.toString();\n\n\n         write (newjson);\n\n        System.out.print(obj);\n\n\n    } catch (Exception e) {\n        e.printStackTrace();\n    }\n\n\n\n  }    \n}\n</code></pre>\n\n<p>I then run the program:</p>\n\n<pre><code>./hoverfly -middleware \"java -jar mid.jar\"\n</code></pre>\n\n<p>The JSON input to my program is this:</p>\n\n<pre><code>{\"response\":{\"status\":200,\"body\":\"\\u003c?xml version=\\\"1.0\\\"?\\u003e\\u003cpathList xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\"\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/0/\\\"\\u003e0\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/1/\\\"\\u003e1\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/3/\\\"\\u003e3\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/4/\\\"\\u003e4\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/5/\\\"\\u003e5\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/6/\\\"\\u003e6\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/7/\\\"\\u003e7\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/8/\\\"\\u003e8\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/9/\\\"\\u003e9\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/10/\\\"\\u003e10\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/11/\\\"\\u003e11\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/12/\\\"\\u003e12\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/13/\\\"\\u003e13\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/14/\\\"\\u003e14\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/15/\\\"\\u003e15\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/16/\\\"\\u003e16\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/17/\\\"\\u003e17\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/18/\\\"\\u003e18\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/19/\\\"\\u003e19\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/20/\\\"\\u003e20\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/21/\\\"\\u003e21\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/22/\\\"\\u003e22\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/23/\\\"\\u003e23\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/25/\\\"\\u003e25\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/26/\\\"\\u003e26\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/27/\\\"\\u003e27\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/28/\\\"\\u003e28\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/29/\\\"\\u003e29\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/30/\\\"\\u003e30\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/31/\\\"\\u003e31\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/32/\\\"\\u003e32\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/33/\\\"\\u003e33\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/34/\\\"\\u003e34\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/35/\\\"\\u003e35\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/36/\\\"\\u003e36\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/37/\\\"\\u003e37\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/38/\\\"\\u003e38\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/39/\\\"\\u003e39\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/40/\\\"\\u003e40\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/41/\\\"\\u003e41\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/42/\\\"\\u003e42\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/43/\\\"\\u003e43\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/44/\\\"\\u003e44\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/45/\\\"\\u003e45\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/46/\\\"\\u003e46\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/47/\\\"\\u003e47\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/48/\\\"\\u003e48\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/49/\\\"\\u003e49\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/50/\\\"\\u003e50\\u003c/path\\u003e\\n    \\u003cpath xlink:href=\\\"http://www.testapi.com/endpoint/path/5555/\\\"\\u003e5555\\u003c/path\\u003e\\n\\u003c/pathList\\u003e\",\"encodedBody\":false,\"headers\":{\"Content-Length\":[\"4580\"],\"Content-Type\":[\"application/xml\"],\"Date\":[\"Fri, 02 Sep 2016 11:31:17 GMT\"],\"Hoverfly\":[\"Was-Here\"],\"Server\":[\"Apache-Coyote/1.1\"]}},\"request\":{\"requestType\":\"recording\",\"path\":\"/endpoint/path/\",\"method\":\"GET\",\"destination\":\"www.testapi.com\",\"scheme\":\"http\",\"query\":\"\",\"body\":\"\",\"headers\":{\"Accept\":[\"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\"],\"Accept-Encoding\":[\"gzip, deflate\"],\"Accept-Language\":[\"en-US,sv-SE;q=0.8,sv;q=0.5,en;q=0.3\"],\"Connection\":[\"keep-alive\"],\"User-Agent\":[\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0\"]}}}\n</code></pre>\n\n<p>The output sent to hoverfly is then this:</p>\n\n<pre><code>{\"response\":{\"headers\":{\"Hoverfly\":[\"Was-Here\"],\"Date\":[\"Fri, 02 Sep 2016 11:31:17 GMT\"],\"Content-Length\":[\"4580\"],\"Content-Type\":[\"application/xml\"],\"Server\":[\"Apache-Coyote/1.1\"]},\"body\":\"&lt;?xml version=\\\"1.0\\\"?&gt;&lt;endpointList xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\"&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/0/\\\"&gt;0&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/1/\\\"&gt;1&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/3/\\\"&gt;3&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/4/\\\"&gt;4&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/5/\\\"&gt;5&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/6/\\\"&gt;6&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/7/\\\"&gt;7&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/8/\\\"&gt;8&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/9/\\\"&gt;9&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/10/\\\"&gt;10&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/11/\\\"&gt;11&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/12/\\\"&gt;12&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/13/\\\"&gt;13&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/14/\\\"&gt;14&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/15/\\\"&gt;15&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/16/\\\"&gt;16&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/17/\\\"&gt;17&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/18/\\\"&gt;18&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/19/\\\"&gt;19&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/20/\\\"&gt;20&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/21/\\\"&gt;21&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/22/\\\"&gt;22&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/23/\\\"&gt;23&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/25/\\\"&gt;25&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/26/\\\"&gt;26&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/27/\\\"&gt;27&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/28/\\\"&gt;28&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/29/\\\"&gt;29&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/30/\\\"&gt;30&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/31/\\\"&gt;31&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/32/\\\"&gt;32&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/33/\\\"&gt;33&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/34/\\\"&gt;34&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/35/\\\"&gt;35&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/36/\\\"&gt;36&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/37/\\\"&gt;37&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/38/\\\"&gt;38&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/39/\\\"&gt;39&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/40/\\\"&gt;40&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/41/\\\"&gt;41&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/42/\\\"&gt;42&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/43/\\\"&gt;43&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/44/\\\"&gt;44&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/45/\\\"&gt;45&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/46/\\\"&gt;46&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/47/\\\"&gt;47&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/48/\\\"&gt;48&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/49/\\\"&gt;49&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/50/\\\"&gt;50&lt;\\/endpoint&gt;\\n    &lt;endpoint xlink:href=\\\"http://testapi/path/endpoint/5555/\\\"&gt;5555&lt;\\/endpoint&gt;\\n&lt;\\/endpointList&gt;\",\"status\":\"500\",\"encodedBody\":false},\"request\":{\"headers\":{\"Accept-Language\":[\"en-US,sv-SE;q=0.8,sv;q=0.5,en;q=0.3\"],\"Accept-Encoding\":[\"gzip, deflate\"],\"User-Agent\":[\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.11; rv:47.0) Gecko/20100101 Firefox/47.0\"],\"Connection\":[\"keep-alive\"],\"Accept\":[\"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\"]},\"body\":\"\",\"scheme\":\"http\",\"query\":\"\",\"path\":\"/path/endpoint/\",\"method\":\"GET\",\"requestType\":\"recording\",\"destination\":\"testapi\"}}\n</code></pre>\n\n<p>However when I run this I get the error:</p>\n\n<pre><code>\"error\":\"json: cannot unmarshal string into Go value of type int\",\"level\":\"error\",\"msg\":\"Failed to unmarshal JSON \n</code></pre>\n\n<p>Is Go expecting some kind of special JSON format or what can the problem be?</p>\n\n<p>All help is appreciated.</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1473008776, "creation_date": 1473008776, "answer_id": 39319434, "question_id": 39319380, "link": "https://stackoverflow.com/questions/39319380/unmarshal-json-as-struct-with-embedded-key/39319434#39319434", "title": "Unmarshal JSON as struct with &quot;embedded&quot; key", "body": "<p>You can define an unmarshaller for <code>Film</code> that \"unpacks\" the nested JSON structure for you.  Example:</p>\n\n<pre><code>func (f *Film) UnmarshalJSON(b []byte) error {\n    internal := struct {\n        ID     int `json:\"id\"`\n        Videos struct {\n            Results []Video `json:\"results\"`\n        } `json:\"videos\"`\n    }{}\n\n    if err := json.Unmarshal(b, &amp;internal); err != nil {\n        return err\n    }\n    f.ID = internal.ID\n    f.Videos = internal.Videos.Results\n    return nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/rEiKqLYB-1\" rel=\"nofollow\">https://play.golang.org/p/rEiKqLYB-1</a></p>\n"}], "owner": {"reputation": 19583, "user_id": 3026283, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/SyT5b.png?s=128&g=1", "display_name": "H&#233;ctor", "link": "https://stackoverflow.com/users/3026283/h%c3%a9ctor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 39319434, "answer_count": 1, "score": 0, "last_activity_date": 1473009137, "creation_date": 1473008401, "question_id": 39319380, "link": "https://stackoverflow.com/questions/39319380/unmarshal-json-as-struct-with-embedded-key", "title": "Unmarshal JSON as struct with &quot;embedded&quot; key", "body": "<p>I have this JSON:</p>\n\n<pre><code>{\n  id : \"12345\",\n  videos: {\n    results: [\n      {\n        id: \"533ec655c3a3685448000505\",\n        key: \"cYyx5DwWu0k\"\n      }\n    ]\n  }\n}\n</code></pre>\n\n<p>And I want to unmarshal it to this struct:</p>\n\n<pre><code>type Film struct {\n    ID          int     `json:\"id\"`\n    Videos      []Video `json:\"videos\"`\n}\n\ntype Video struct {\n    ID   string  `json:\"id\"`\n    Key  string  `json:\"key\"`\n}\n</code></pre>\n\n<p>I mean, I want to <code>Videos</code> struct field to be <code>videos.results</code> array. </p>\n\n<p>If I do this:</p>\n\n<pre><code>body := //retrieve json above\nvar film Film\njson.Unmarshal(body, &amp;film)\n</code></pre>\n\n<p>obviously doesn't work because it can't unmarshal <code>videos</code> json key to a <code>Video</code> array because of <code>results</code> key. </p>\n\n<p>How can I do this?</p>\n"}, {"tags": ["performance", "go", "byte", "buffer"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1473006768, "post_id": 39319024, "comment_id": 65970235, "body": "builtin functions are generally faster than any alternative. I guess append will be faster in this case"}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 1, "last_activity_date": 1473007150, "creation_date": 1473007150, "answer_id": 39319180, "question_id": 39319024, "link": "https://stackoverflow.com/questions/39319024/builtin-append-vs-bytes-buffer-write/39319180#39319180", "title": "Builtin append vs. bytes.Buffer write", "body": "<p>Using the built-in function <code>append</code> is faster, as shown by the following benchmark:</p>\n\n<pre><code>package x\n\nimport (\n    \"bytes\"\n    \"math/rand\"\n    \"testing\"\n    \"time\"\n)\n\nvar startSeed = time.Now().UnixNano()\n\nfunc randomSlice() []byte {\n    return make([]byte, 0, rand.Intn(1&lt;&lt;10))\n}\n\nfunc BenchmarkAppend(b *testing.B) {\n    rand.Seed(startSeed)\n    b.ResetTimer()\n    var all []byte\n\n    for i := 0; i &lt; b.N; i++ {\n        all = append(all, randomSlice()...)\n    }\n}\n\nfunc BenchmarkBufferWrite(b *testing.B) {\n    rand.Seed(startSeed)\n    b.ResetTimer()\n    var buff bytes.Buffer\n    for i := 0; i &lt; b.N; i++ {\n        buff.Write(randomSlice())\n    }\n    all := buff.Bytes()\n    _ = all\n}\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>BenchmarkAppend-4           10000000           206 ns/op         540 B/op          0 allocs/op\nBenchmarkBufferWrite-4      10000000           214 ns/op         540 B/op          0 allocs/op\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "edited": false, "score": 0, "creation_date": 1473010612, "post_id": 39319186, "comment_id": 65971429, "body": "Seeing different results from the two answers, I tried to write my own according to my needs :<a href=\"https://play.golang.org/p/kyuX5qzaIG\" rel=\"nofollow noreferrer\">play.golang.org/p/kyuX5qzaIG</a>. The results shows that append is fastest  (append = 2.70 ns/op, bufferWrite = 9.32 ns/op). There must be an issue with your bench somehow."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "edited": false, "score": 0, "creation_date": 1473013180, "post_id": 39319186, "comment_id": 65972189, "body": "@WilliamPoussier: in Tim Cooper answer in func: <code>randomSlice</code> try <code>return make([]byte,  rand.Intn(1&lt;&lt;10))</code> instead of <code>return make([]byte, 0, rand.Intn(1&lt;&lt;10))</code> using slice with zero length is not a good benchmark."}, {"owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "edited": false, "score": 1, "creation_date": 1473014023, "post_id": 39319186, "comment_id": 65972471, "body": "Indeed you are right. When i changed by test data to a non-empty slice, append is slowest than using a buffer."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 8, "last_activity_date": 1473015370, "last_edit_date": 1495541802, "creation_date": 1473007209, "answer_id": 39319186, "question_id": 39319024, "link": "https://stackoverflow.com/questions/39319024/builtin-append-vs-bytes-buffer-write/39319186#39319186", "title": "Builtin append vs. bytes.Buffer write", "body": "<p>It depends to use case.<br>\nHere in both cases <code>bytes.Buffer</code> is faster than <code>append</code> (Samples: 1, 2, 3, 4).</p>\n\n<p>Using <code>buf.Write(make([]byte, 16))</code> takes <code>4.6482659s</code>,<br>\nUsing <code>buf = append(buf, make([]byte, 16)...)</code> takes <code>6.6623811s</code>.</p>\n\n<p>For samples 5, 6:<br>\nUsing <code>buf = append(buf, byte(i))</code> takes <code>445.0255ms</code>,<br>\nUsing <code>buf.WriteByte(byte(i))</code> takes <code>1.4410824s</code></p>\n\n<hr>\n\n<p>And <code>bytes.Buffer</code> uses builtin function <code>copy</code> and it is fast:</p>\n\n<blockquote>\n  <p>// Write appends the contents of p to the buffer, growing the buffer\n  as<br>\n  // needed. The return value n is the length of p; err is always\n  nil. If the<br>\n  // buffer becomes too large, Write will panic with\n  ErrTooLarge.</p>\n\n<pre><code>func (b *Buffer) Write(p []byte) (n int, err error) {\n  b.lastRead = opInvalid\n  m := b.grow(len(p))\n  return copy(b.buf[m:], p), nil\n}\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p><code>bytes.Buffer</code> takes 4.8892797s and <code>append</code> takes   7.7514434s </p>\n\n<p>See these benchmarks:</p>\n\n<p>1- Using <code>append</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    buf := []byte{}\n    data := []byte{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}\n    t := time.Now()\n    for i := 0; i &lt; 100000000; i++ {\n        buf = append(buf, data...)\n    }\n    fmt.Println(time.Since(t))\n    fmt.Println(len(buf))\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>7.7514434s\n1600000000\n</code></pre>\n\n<hr>\n\n<p>2- Using <code>bytes.Buffer</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    buf := &amp;bytes.Buffer{}\n    data := []byte{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}\n    t := time.Now()\n    for i := 0; i &lt; 100000000; i++ {\n        buf.Write(data)\n    }\n    fmt.Println(time.Since(t))\n    fmt.Println(buf.Len())\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>4.8892797s\n1600000000\n</code></pre>\n\n<hr>\n\n<p>3- Using <code>bytes.Buffer</code> with <code>make([]byte, 16)</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    buf := &amp;bytes.Buffer{}\n    t := time.Now()\n    for i := 0; i &lt; 100000000; i++ {\n        buf.Write(make([]byte, 16))\n    }\n    fmt.Println(time.Since(t)) // 4.6482659s\n    fmt.Println(buf.Len())     //1600000000\n}\n</code></pre>\n\n<hr>\n\n<p>4- Using <code>append</code> with <code>make([]byte, 16)</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    buf := []byte{}\n    t := time.Now()\n    for i := 0; i &lt; 100000000; i++ {\n        buf = append(buf, make([]byte, 16)...)\n    }\n    fmt.Println(time.Since(t)) // 6.6623811s\n    fmt.Println(len(buf))      // 1600000000\n}\n</code></pre>\n\n<hr>\n\n<p>5- Using <code>buf = append(buf, byte(i))</code> takes <code>445.0255ms</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    buf := []byte{}\n    t := time.Now()\n    for i := 0; i &lt; 100000000; i++ {\n        buf = append(buf, byte(i))\n    }\n    fmt.Println(time.Since(t)) // 445.0255ms\n    fmt.Println(len(buf))      // 100000000\n}\n</code></pre>\n\n<hr>\n\n<p>6- Using <code>buf.WriteByte(byte(i))</code> takes <code>1.4410824s</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    buf := &amp;bytes.Buffer{}\n\n    t := time.Now()\n    for i := 0; i &lt; 100000000; i++ {\n        buf.WriteByte(byte(i))\n    }\n    fmt.Println(time.Since(t)) // 1.4410824s\n    fmt.Println(buf.Len())     // 100000000\n}\n</code></pre>\n\n<hr>\n\n<p>And See: </p>\n\n<p><a href=\"https://stackoverflow.com/questions/32264208/appending-to-slice-bad-performance-why\">Appending to slice bad performance.. why?</a><br>\n<a href=\"https://stackoverflow.com/questions/31790311/where-is-append-implementation\">Where is append() implementation?</a><br>\n<a href=\"https://stackoverflow.com/questions/20251900/efficient-appending-to-a-variable-length-container-of-strings-golang\">Efficient appending to a variable-length container of strings (Golang)</a></p>\n"}], "owner": {"reputation": 1308, "user_id": 4709839, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh6.googleusercontent.com/-4w1KKdkUNJk/AAAAAAAAAAI/AAAAAAAAABc/Xg55afDDwjk/photo.jpg?sz=128", "display_name": "William Poussier", "link": "https://stackoverflow.com/users/4709839/william-poussier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7676, "favorite_count": 0, "accepted_answer_id": 39319186, "answer_count": 2, "score": 6, "last_activity_date": 1473015370, "creation_date": 1473006151, "last_edit_date": 1473015267, "question_id": 39319024, "link": "https://stackoverflow.com/questions/39319024/builtin-append-vs-bytes-buffer-write", "title": "Builtin append vs. bytes.Buffer write", "body": "<p>In the situation where I need to add an unknown amount of data to a slice of byte, let say in a loop, I could either way use the builtin function <code>append()</code> or create a new <code>Buffer</code> and use the <code>Write()</code> function.</p>\n\n<p>Which method is fastest ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "edited": false, "score": 0, "creation_date": 1473010854, "post_id": 39318603, "comment_id": 65971499, "body": "Can you elaborate your requirements?"}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 0, "last_activity_date": 1473014391, "creation_date": 1473014391, "answer_id": 39320284, "question_id": 39318603, "link": "https://stackoverflow.com/questions/39318603/go-return-child-type-from-parent-function/39320284#39320284", "title": "go return child type from parent function", "body": "<p>No.</p>\n\n<p>Embedding is not inheritance.</p>\n"}], "owner": {"reputation": 23, "user_id": 6793484, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d326e8177be82bf3230f2f2df096459?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/6793484/dan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 39320284, "answer_count": 1, "score": -2, "last_activity_date": 1473014391, "creation_date": 1473003290, "question_id": 39318603, "link": "https://stackoverflow.com/questions/39318603/go-return-child-type-from-parent-function", "title": "go return child type from parent function", "body": "<p>I am still fairly new to Go.</p>\n\n<p>Is it possible to return a child type from an embedded parent function?</p>\n\n<p>Something along the lines of the following code:</p>\n\n<pre><code>type Humans struct {\n    NextPage string\n}\n\ntype Employees struct {\n    Humans \n    Items []struct {\n        Stuff string\n        DifferentStuff float64\n    }      \n}\n\nfunc (h *Human) Next() interface{} {\n    list interface{}\n    jsonGet(h.NextPage, &amp;list)\n    return list\n}\n\nfunc main() {\n    list := Employees{}\n    jsonGet(\"http://blah.blah\", &amp;list)\n    for ; list != nil; list = list.Next() {\n         for _, item := range list.Items {\n             ... do stuff ...\n         }\n    }\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-app-engine-go"], "answers": [{"tags": [], "owner": {"reputation": 816, "user_id": 478440, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0ef05c8358b8de512c314a1e72c9d0b?s=128&d=identicon&r=PG", "display_name": "ernestoalejo", "link": "https://stackoverflow.com/users/478440/ernestoalejo"}, "is_accepted": false, "score": 0, "last_activity_date": 1474379824, "creation_date": 1474379824, "answer_id": 39596104, "question_id": 39318367, "link": "https://stackoverflow.com/questions/39318367/how-to-handle-404-error-on-gae-using-http-fileserver-in-golang/39596104#39596104", "title": "How to handle 404 Error on GAE using http.FileServer in Golang", "body": "<p>You can stat the file before serving it to see if it exists. Adapt the 404 handler as needed (emit a template, etc.)</p>\n\n<pre><code>package main\n\nimport ( \n  \"net/http\"\n  \"path\"\n  \"os\"\n)\n\nfunc init() {\n    http.Handle(\"/\", staticHandler)\n}\n\nfunc error404Handler(w http.ResponseWriter, r *http.Request) {\n    http.Error(w, \"404 not found\", http.StatusNotFound)\n}\n\nfunc staticHandler(w http.ResponseWriter, r *http.Request) {\n    name := path.Clean(r.URL.Path)\n    if _, err := os.Stat(name); err != nil {\n        if os.IsNotExist(err) {\n            error404Handler(w, r)\n            return\n        }\n\n        http.Error(w, \"internal error\", http.StatusInternalServerError)\n        return\n    }\n\n    return http.ServeFile(w, r, name)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 816, "user_id": 478440, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f0ef05c8358b8de512c314a1e72c9d0b?s=128&d=identicon&r=PG", "display_name": "ernestoalejo", "link": "https://stackoverflow.com/users/478440/ernestoalejo"}, "edited": false, "score": 0, "creation_date": 1474390486, "post_id": 39599490, "comment_id": 66507929, "body": "For future readers, if you need to catch errors half-way into rendering a template, or you want to change the handler signature (return an error from the handler, for example) I would totally recommend this approach of wrapping the response writer to add custom logic to it."}, {"owner": {"reputation": 611, "user_id": 2327005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/638b14bbcadf276c9a89fe2dd28b1fd4?s=128&d=identicon&r=PG", "display_name": "pascal", "link": "https://stackoverflow.com/users/2327005/pascal"}, "edited": false, "score": 0, "creation_date": 1474700816, "post_id": 39599490, "comment_id": 66647955, "body": "Thank you Thomas Broyer, this solution works well. I&#39;ve implemented a notFoundHandler which just serves my static 404.html file."}], "tags": [], "owner": {"reputation": 63777, "user_id": 116472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13753e40e0a6a2ef6b0652e1e05b0af0?s=128&d=identicon&r=PG", "display_name": "Thomas Broyer", "link": "https://stackoverflow.com/users/116472/thomas-broyer"}, "is_accepted": true, "score": 3, "last_activity_date": 1474389394, "creation_date": 1474389394, "answer_id": 39599490, "question_id": 39318367, "link": "https://stackoverflow.com/questions/39318367/how-to-handle-404-error-on-gae-using-http-fileserver-in-golang/39599490#39599490", "title": "How to handle 404 Error on GAE using http.FileServer in Golang", "body": "<p>To keep the middleware decoupled from the <code>http.FileServer</code>, as you're wrapping it, you can pass a specific implementation of <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow\"><code>http.ResponseWriter</code></a> that will:</p>\n\n<ol>\n<li>accumulate headers, in case they'd need to be ditched away (if <code>WriteHeader</code> is called with a 404)</li>\n<li>if <code>WriteHeader</code> is called with a 404:\n\n<ol>\n<li>dismiss accumulated headers</li>\n<li>send a custom 404</li>\n<li>ignore calls with <code>Write</code> from the wrapped handler</li>\n</ol></li>\n<li>if <code>WriteHeader</code> is not called, or called with a non-404, then:\n\n<ol>\n<li>emit accumulated headers to the real <code>ResponseWriter</code></li>\n<li>route the <code>WriteHeader</code> and <code>Write</code> calls to the real <code>ResponseWriter</code></li>\n</ol></li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    type notFoundInterceptorWriter struct {\n    rw              http.ResponseWriter // set to nil to signal a 404 has been intercepted\n    h               http.Header         // set to nil to signal headers have been emitted\n    notFoundHandler http.Handler\n    r               *http.Request\n}\n\nfunc (rw *notFoundInterceptorWriter) Header() http.Header {\n    if rw.h == nil &amp;&amp; rw.rw != nil {\n        return rw.rw.Header()\n    }\n    return rw.h\n}\n\nfunc (rw *notFoundInterceptorWriter) WriteHeader(status int) {\n    if status == http.StatusNotFound {\n        rw.notFoundHandler.ServeHTTP(rw.rw, rw.r)\n        rw.rw = nil\n    } else {\n        for k, vs := range rw.h {\n            for _, v := range vs {\n                rw.rw.Header().Add(k, v)\n            }\n        }\n        rw.rw.WriteHeader(status)\n    }\n    rw.h = nil\n}\n\nfunc (rw *notFoundInterceptorWriter) Write(b []byte) (int, error) {\n    if rw.rw != nil {\n        return rw.rw.Write(b)\n    }\n    // ignore, so do as if everything was written OK\n    return len(b), nil\n}\n\nfunc StaticSiteHandler(h, notFoundHandler http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w = &amp;notFoundInterceptorWriter{\n            rw:              w,\n            h:               make(http.Header),\n            notFoundHandler: notFoundHandler,\n            r:               r,\n        }\n        h.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 611, "user_id": 2327005, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/638b14bbcadf276c9a89fe2dd28b1fd4?s=128&d=identicon&r=PG", "display_name": "pascal", "link": "https://stackoverflow.com/users/2327005/pascal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 674, "favorite_count": 0, "accepted_answer_id": 39599490, "answer_count": 2, "score": 2, "last_activity_date": 1474389394, "creation_date": 1473001850, "question_id": 39318367, "link": "https://stackoverflow.com/questions/39318367/how-to-handle-404-error-on-gae-using-http-fileserver-in-golang", "title": "How to handle 404 Error on GAE using http.FileServer in Golang", "body": "<p>I am using Google App Engine to serve my (semi-)static website generated with Hugo. I have a directory \"public\" where all the HTML files are stored and are to be served. I also have some server-side scripts for the contact form handling for example. The <code>app.yaml</code> file looks like this.</p>\n\n<pre><code>// app.yaml\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /.*\n  script: _go_app\n  secure: always\n</code></pre>\n\n<p>And the simplified <code>main.go</code> file looks like this</p>\n\n<pre><code>// main.go\npackage main\n\nimport ( \n  \"net/http\"\n  \"encoding/json\"\n\n  \"appengine\"\n  \"appengine/urlfetch\"   \n)\n\nfunc init() {\n\n  fileHandler := http.FileServer(http.Dir(\"public\"))\n  http.Handle(\"/\", fileHandler)\n\n  http.HandleFunc(\"/contactus/\", HandleContactus)\n}\n</code></pre>\n\n<p>This works perfectly well and serves the html files. However, I am looking at a solution to handle the cases where the pages are not found and the response is <code>404 Not Found</code> for example (or any other server error). </p>\n\n<p>My thought was to create a custom handler which can be passed in the <code>http.Handle(\"/\", myCustomHandler)</code> and would handle the server response and would redirect to a custom <code>404.html</code> or the like if necessary. I am new to Go and can't seem to figure out how this should be implemented. I have also looked at the Gorilla Mux, but would prefer (if possible) not to use external libraries to keep it simple. </p>\n\n<p>Based on <a href=\"http://capotej.com/blog/2013/10/07/golang-http-handlers-as-middleware/\" rel=\"nofollow\">this post</a>, I have tried the following</p>\n\n<pre><code>package main\n\nimport ( \n  \"net/http\"\n  \"encoding/json\"\n\n  \"appengine\"\n  \"appengine/urlfetch\"   \n)\n\nfunc StaticSiteHandler(h http.Handler) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request){\n\n    h.ServeHTTP(w, r)\n  })\n}\n\n\nfunc init() {\n\n  fileHandler := http.FileServer(http.Dir(\"public\"))\n  http.Handle(\"/\", StaticSiteHandler(fileHandler))\n\n  http.HandleFunc(\"/contactus/\", HandleContactus)\n}\n</code></pre>\n\n<p>This solution works in the sense that it also does serve my HTML pages, however I still can't figure out how to handle the server response codes. </p>\n\n<p>Any help would be highly appreciated.\nThanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1473004663, "post_id": 39318255, "comment_id": 65969596, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/28227095/go-multiple-value-in-single-value-context\">Go: multiple value in single-value context</a> and <a href=\"http://stackoverflow.com/questions/28487036/return-map-like-ok-in-golang-on-normal-functions\">Return map like &#39;ok&#39; in Golang on normal functions</a>"}], "answers": [{"comments": [{"owner": {"reputation": 857, "user_id": 2093954, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b3889bd7298b1708b66044e74d4add2f?s=128&d=identicon&r=PG&f=1", "display_name": "Rouz", "link": "https://stackoverflow.com/users/2093954/rouz"}, "edited": false, "score": 0, "creation_date": 1473001506, "post_id": 39318297, "comment_id": 65968630, "body": "Thanks mate! This language keeps fascinating me."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1473001565, "post_id": 39318297, "comment_id": 65968651, "body": "The first snippet is invalid Go code. Replace <code>map</code> with some other variable name."}], "tags": [], "owner": {"reputation": 953, "user_id": 514672, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7c18ee0746871b60d98156eb8fe79379?s=128&d=identicon&r=PG", "display_name": "Actorclavilis", "link": "https://stackoverflow.com/users/514672/actorclavilis"}, "is_accepted": true, "score": 5, "last_activity_date": 1473001815, "last_edit_date": 1473001815, "creation_date": 1473001399, "answer_id": 39318297, "question_id": 39318255, "link": "https://stackoverflow.com/questions/39318255/get-nth-return-value-from-function-in-go/39318297#39318297", "title": "Get nth return value from function in Go", "body": "<p>In Go, the character <code>_</code> is a placeholder indicating that you don't care about the value. Therefore, you can do</p>\n\n<pre><code>var _, hasElement = myMap[key]\n</code></pre>\n\n<p>which will ignore the first return value.</p>\n\n<p>This extends to functions with any number of return values:</p>\n\n<pre><code>var a, _, _, d, e, _ = bigFunction()\n</code></pre>\n"}], "owner": {"reputation": 857, "user_id": 2093954, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/b3889bd7298b1708b66044e74d4add2f?s=128&d=identicon&r=PG&f=1", "display_name": "Rouz", "link": "https://stackoverflow.com/users/2093954/rouz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1595, "favorite_count": 0, "accepted_answer_id": 39318297, "answer_count": 1, "score": 6, "last_activity_date": 1473001815, "creation_date": 1473001192, "last_edit_date": 1473001533, "question_id": 39318255, "link": "https://stackoverflow.com/questions/39318255/get-nth-return-value-from-function-in-go", "title": "Get nth return value from function in Go", "body": "<p>I have started learning Go yesterday and so far I am fascinated. But I bumped to a problem. </p>\n\n<p>Lets assume that function returns multiple vars (awesome feature).  How should I use only nth value and not first n-1 values? In example I just want to check whether key exists in hash map but do nothing with value. </p>\n\n<pre><code>var value, hasElement = myMap[key]\n</code></pre>\n\n<p>The error I get is </p>\n\n<pre><code>main.go:15: value declared and not used\n</code></pre>\n\n<p>If I just print value it will all be fine but that is not good. </p>\n"}, {"tags": ["go", "hashcode"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1473081929, "last_edit_date": 1495540863, "creation_date": 1473081929, "answer_id": 39331623, "question_id": 39315830, "link": "https://stackoverflow.com/questions/39315830/calculating-hashcode-in-go/39331623#39331623", "title": "Calculating hashCode in Go", "body": "<p>The <a href=\"https://golang.org/\" rel=\"nofollow noreferrer\">Go programming language</a> is <a href=\"https://github.com/golang/go\" rel=\"nofollow noreferrer\">open source</a>. You can check its standard library for a fast and efficient Go hash implementation.</p>\n\n<p>Here it is:</p>\n\n<ul>\n<li><p><a href=\"https://golang.org/src/runtime/hash64.go\" rel=\"nofollow noreferrer\"><code>runtime/hash64.go</code></a> for 64-bit architecture</p></li>\n<li><p><a href=\"https://golang.org/src/runtime/hash32.go\" rel=\"nofollow noreferrer\"><code>runtime/hash32.go</code></a> for 32-bit architecture</p></li>\n</ul>\n\n<p>They are unexported, but if you'd ever need them in your app, you can just copy the code to your project. Also note that if your CPU supports it, the Go runtime will use <code>aeshash</code> to utilize your CPU's capabilities (more info on this here: <a href=\"https://stackoverflow.com/questions/37625480/how-does-go-calculate-a-hash-value-for-keys-in-a-map\">How does go calculate a hash value for keys in a map?</a>).</p>\n\n<p>Qutoing the shorter <a href=\"https://golang.org/src/runtime/hash32.go\" rel=\"nofollow noreferrer\">32-bit version</a>:</p>\n\n<pre><code>const (\n    // Constants for multiplication: four random odd 32-bit numbers.\n    m1 = 3168982561\n    m2 = 3339683297\n    m3 = 832293441\n    m4 = 2336365089\n)\n\nfunc memhash(p unsafe.Pointer, seed, s uintptr) uintptr {\n    if GOARCH == \"386\" &amp;&amp; GOOS != \"nacl\" &amp;&amp; useAeshash {\n        return aeshash(p, seed, s)\n    }\n    h := uint32(seed + s*hashkey[0])\ntail:\n    switch {\n    case s == 0:\n    case s &lt; 4:\n        h ^= uint32(*(*byte)(p))\n        h ^= uint32(*(*byte)(add(p, s&gt;&gt;1))) &lt;&lt; 8\n        h ^= uint32(*(*byte)(add(p, s-1))) &lt;&lt; 16\n        h = rotl_15(h*m1) * m2\n    case s == 4:\n        h ^= readUnaligned32(p)\n        h = rotl_15(h*m1) * m2\n    case s &lt;= 8:\n        h ^= readUnaligned32(p)\n        h = rotl_15(h*m1) * m2\n        h ^= readUnaligned32(add(p, s-4))\n        h = rotl_15(h*m1) * m2\n    case s &lt;= 16:\n        h ^= readUnaligned32(p)\n        h = rotl_15(h*m1) * m2\n        h ^= readUnaligned32(add(p, 4))\n        h = rotl_15(h*m1) * m2\n        h ^= readUnaligned32(add(p, s-8))\n        h = rotl_15(h*m1) * m2\n        h ^= readUnaligned32(add(p, s-4))\n        h = rotl_15(h*m1) * m2\n    default:\n        v1 := h\n        v2 := uint32(seed * hashkey[1])\n        v3 := uint32(seed * hashkey[2])\n        v4 := uint32(seed * hashkey[3])\n        for s &gt;= 16 {\n            v1 ^= readUnaligned32(p)\n            v1 = rotl_15(v1*m1) * m2\n            p = add(p, 4)\n            v2 ^= readUnaligned32(p)\n            v2 = rotl_15(v2*m2) * m3\n            p = add(p, 4)\n            v3 ^= readUnaligned32(p)\n            v3 = rotl_15(v3*m3) * m4\n            p = add(p, 4)\n            v4 ^= readUnaligned32(p)\n            v4 = rotl_15(v4*m4) * m1\n            p = add(p, 4)\n            s -= 16\n        }\n        h = v1 ^ v2 ^ v3 ^ v4\n        goto tail\n    }\n    h ^= h &gt;&gt; 17\n    h *= m3\n    h ^= h &gt;&gt; 13\n    h *= m4\n    h ^= h &gt;&gt; 16\n    return uintptr(h)\n}\n\n// Note: in order to get the compiler to issue rotl instructions, we\n// need to constant fold the shift amount by hand.\n// TODO: convince the compiler to issue rotl instructions after inlining.\nfunc rotl_15(x uint32) uint32 {\n    return (x &lt;&lt; 15) | (x &gt;&gt; (32 - 15))\n}\n</code></pre>\n"}], "owner": {"reputation": 1226, "user_id": 427566, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/AATey.jpg?s=128&g=1", "display_name": "yngling", "link": "https://stackoverflow.com/users/427566/yngling"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1131, "favorite_count": 1, "accepted_answer_id": 39331623, "answer_count": 1, "score": 3, "last_activity_date": 1523007874, "creation_date": 1472983991, "last_edit_date": 1523007874, "question_id": 39315830, "link": "https://stackoverflow.com/questions/39315830/calculating-hashcode-in-go", "title": "Calculating hashCode in Go", "body": "<p>Java objects have a <code>hashCode</code>, which are cheaper than a cryptographic hash. How would one implement such a hashCode in Go?</p>\n"}, {"tags": ["go", "struct", "dry"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1472979433, "post_id": 39315079, "comment_id": 65962640, "body": "In this code <code>User</code> is not embedding <code>BaseStruct</code>. So I&#39;m confused."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472982040, "post_id": 39315079, "comment_id": 65963293, "body": "Using <code>this</code> as pointer receiver is not recommended style. Create a datastore object with a Put(v interface{}) method and use reflect to determine runtime type of object being put."}, {"owner": {"reputation": 9, "user_id": 5245031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb583c994fa920740ecb5df6834a5be5?s=128&d=identicon&r=PG&f=1", "display_name": "Evgen Kostenko", "link": "https://stackoverflow.com/users/5245031/evgen-kostenko"}, "edited": false, "score": 0, "creation_date": 1472982242, "post_id": 39315079, "comment_id": 65963349, "body": "So if I use reflect for this, my method should know every type what I need to process?"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472982639, "post_id": 39315079, "comment_id": 65963445, "body": "Not necessarily. The method will load try to load into db whatever you pass it - it&#39;ll throw an error if what you&#39;re trying to do isn&#39;t permitted."}, {"owner": {"reputation": 9, "user_id": 5245031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb583c994fa920740ecb5df6834a5be5?s=128&d=identicon&r=PG&f=1", "display_name": "Evgen Kostenko", "link": "https://stackoverflow.com/users/5245031/evgen-kostenko"}, "edited": false, "score": 0, "creation_date": 1472983286, "post_id": 39315079, "comment_id": 65963615, "body": "ok, but if I use <code>interface{}</code> how my method should know that my struct have <code>Data</code> field? So i need <code>for i := 0; i &lt; val.NumField(); i++ </code> do <code>if val.Type().Name() == &quot;Data&quot;</code> then  <code>data := val.Field(i).Interface()</code> ?"}, {"owner": {"reputation": 9, "user_id": 5245031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb583c994fa920740ecb5df6834a5be5?s=128&d=identicon&r=PG&f=1", "display_name": "Evgen Kostenko", "link": "https://stackoverflow.com/users/5245031/evgen-kostenko"}, "edited": false, "score": 0, "creation_date": 1472983659, "post_id": 39315079, "comment_id": 65963707, "body": "And it gave me <code>importers&#47;base.go:40: cannot range over data (type interface {})</code> when I try to <code>for _, row := range data</code>"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472985503, "post_id": 39315079, "comment_id": 65964204, "body": "I think you can accomplish what you want to do without knowing the names of the fields. There are other functions in reflect which you could try instead of ranging over the interface - relect.ValueOf(data).Slice(...) for instance."}, {"owner": {"reputation": 24361, "user_id": 629685, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cadce7a59af35a66f18b9aaddebfd50f?s=128&d=identicon&r=PG", "display_name": "I159", "link": "https://stackoverflow.com/users/629685/i159"}, "edited": false, "score": 0, "creation_date": 1477403562, "post_id": 39315079, "comment_id": 67745669, "body": "Please simplify your code snippet. It is complicated with redundant details of implementation. I believe you will find an answer when you try to reproduce the issue with simpler and shorter code snippet."}], "owner": {"reputation": 9, "user_id": 5245031, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb583c994fa920740ecb5df6834a5be5?s=128&d=identicon&r=PG&f=1", "display_name": "Evgen Kostenko", "link": "https://stackoverflow.com/users/5245031/evgen-kostenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 231, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1473050033, "creation_date": 1472978547, "last_edit_date": 1472987912, "question_id": 39315079, "link": "https://stackoverflow.com/questions/39315079/golang-dry-for-nested-structs", "title": "Golang DRY for nested structs", "body": "<p>I have a BaseEntity struct and one method with *BaseEntity receiver that parses xml from file</p>\n\n<pre><code>type BaseEntity struct {\n   FilePath   string\n   Collection string\n}\n\nfunc (this *BaseEntity) Parse() *[]byte {\n    xmlFile, err := ioutil.ReadFile(this.FilePath)\n    if err != nil {\n       fmt.Println(\"Error opening file:\", err)\n       return nil\n    }\n    return &amp;xmlFile\n}\n</code></pre>\n\n<p>I also have several structs where BaseEntity is embedded, for eg. Users, Posts, Comments, Tags ... etc</p>\n\n<pre><code>type Users struct {\n    Data []User `xml:\"row\"`\n    BaseEntity\n}\ntype User struct {\n    WebsiteUrl      string `xml:\"WebsiteUrl,attr\"`\n    UpVotes         string `xml:\"UpVotes,attr\"`\n    Id              string `xml:\"Id,attr\"`\n    Age             string `xml:\"Age,attr\"`\n    DisplayName     string `xml:\"DisplayName,attr\"`\n    AboutMe         string `xml:\"AboutMe,attr\"`\n    Reputation      string `xml:\"Reputation,attr\"`\n    LastAccessDate  string `xml:\"LastAccessDate,attr\"`\n    DownVotes       string `xml:\"DownVotes,attr\"`\n    AccountId       string `xml:\"AccountId,attr\"`\n    Location        string `xml:\"Location,attr\"`\n    Views           string `xml:\"Views,attr\"`\n    CreationDate    string `xml:\"CreationDate,attr\"`\n    ProfileImageUrl string `xml:\"ProfileImageUrl,attr\"`\n}\n\nfunc (this *Users) LoadDataToDB() {\n\n    file := this.Parse()\n    xml.Unmarshal(*file, &amp;this)\n\n    // Init db\n    db := database.MgoDb{}\n    db.Init()\n    defer db.Close()\n\n    for _, row := range this.Data {\n        err := db.C(this.Collection).Insert(&amp;row)\n        if err != nil {\n            fmt.Println(err)\n        }\n    }\n}\n</code></pre>\n\n<p>And for each of these structs I need to create a method LoadDataToDB that loads data in db and has some code.</p>\n\n<p>This method can't have *BaseEntity receiver because I can't get this.Data in base struct and I can't get this struct from parameters because it always a different struct.</p>\n\n<p>How to DRY and move this repeating method from every embedded struct to one?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 18203, "user_id": 100731, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/056c32203f8017f075ac060069823b66?s=128&d=identicon&r=PG", "display_name": "phoet", "link": "https://stackoverflow.com/users/100731/phoet"}, "edited": false, "score": 1, "creation_date": 1472984023, "post_id": 39314219, "comment_id": 65963810, "body": "isn&#39;t it just a specification of how it should be implemented?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1472992691, "post_id": 39314219, "comment_id": 65966013, "body": "Aehm, maybe because users of a RoundTripper may rely on this behaviour?"}], "answers": [{"tags": [], "owner": {"reputation": 338, "user_id": 2173587, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tRluu.jpg?s=128&g=1", "display_name": "Jo Oko", "link": "https://stackoverflow.com/users/2173587/jo-oko"}, "is_accepted": true, "score": 1, "last_activity_date": 1474915886, "last_edit_date": 1474915886, "creation_date": 1474903644, "answer_id": 39706730, "question_id": 39314219, "link": "https://stackoverflow.com/questions/39314219/why-shouldnt-roundtrip-modify-the-request/39706730#39706730", "title": "Why shouldn&#39;t RoundTrip modify the request?", "body": "<p>The awnser is stated in the interface comment <a href=\"https://golang.org/src/net/http/client.go#L89\" rel=\"nofollow\">https://golang.org/src/net/http/client.go#L89</a></p>\n\n<pre><code>A RoundTripper must be safe for concurrent use by multiple goroutines.\n</code></pre>\n\n<p>If a server gets a request, and starts multiple goroutines, it must be ensured that all requests work on the same input. If a RoundTripper changes the request, it can make already collected data useless (which may not even be noticed)</p>\n"}], "owner": {"reputation": 41, "user_id": 6636918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qHX1R.jpg?s=128&g=1", "display_name": "sona-tar", "link": "https://stackoverflow.com/users/6636918/sona-tar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 326, "favorite_count": 1, "accepted_answer_id": 39706730, "answer_count": 1, "score": 2, "last_activity_date": 1474915886, "creation_date": 1472971113, "last_edit_date": 1472993050, "question_id": 39314219, "link": "https://stackoverflow.com/questions/39314219/why-shouldnt-roundtrip-modify-the-request", "title": "Why shouldn&#39;t RoundTrip modify the request?", "body": "<p>Why shouldn't RoundTrip modify the request ?</p>\n\n<p><a href=\"https://golang.org/src/net/http/client.go#L103\" rel=\"nofollow\">https://golang.org/src/net/http/client.go#L103</a></p>\n\n<p>What happens if http.Request gets modified by a RoundTripper (http.Transport for instance)?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1472965705, "post_id": 39313533, "comment_id": 65960006, "body": "What is the error message reported by the go tool?  Is the absolute path of the <code>src</code> directory <code>&#47;Users&#47;sunitjoshi&#47;Projects&#47;go&#47;src</code>?"}, {"owner": {"reputation": 63, "user_id": 5787683, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/e97e45c6846214b3ad8bc66b3276a0b5?s=128&d=identicon&r=PG&f=1", "display_name": "Eagle Amulet", "link": "https://stackoverflow.com/users/5787683/eagle-amulet"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1472994706, "post_id": 39313533, "comment_id": 65966509, "body": "Here it is:\u25cb \u2192 go install myFirst.go  # command-line-arguments ./myFirst.go:35: undefined: BoilC ./myFirst.go:35: undefined: FreezC ./myFirst.go:36: undefined: CelToFar ./myFirst.go:36: undefined: BoilC ./myFirst.go:38: undefined: Far ./myFirst.go:39: undefined: Cel ./myFirst.go:40: undefined: FarToCel"}, {"owner": {"reputation": 63, "user_id": 5787683, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/e97e45c6846214b3ad8bc66b3276a0b5?s=128&d=identicon&r=PG&f=1", "display_name": "Eagle Amulet", "link": "https://stackoverflow.com/users/5787683/eagle-amulet"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1473001088, "post_id": 39313533, "comment_id": 65968505, "body": "My bad, I forgot to qualify the function name with the package...Duuh. Once I used that, everything worked fine."}], "answers": [{"tags": [], "owner": {"reputation": 63, "user_id": 5787683, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/e97e45c6846214b3ad8bc66b3276a0b5?s=128&d=identicon&r=PG&f=1", "display_name": "Eagle Amulet", "link": "https://stackoverflow.com/users/5787683/eagle-amulet"}, "is_accepted": false, "score": 1, "last_activity_date": 1473001147, "creation_date": 1473001147, "answer_id": 39318249, "question_id": 39313533, "link": "https://stackoverflow.com/questions/39313533/go-package-import-issue/39318249#39318249", "title": "Go package import issue", "body": "<p>Keep forgetting about qualifying the function names. It would have worked if I had done <strong>.</strong> to import into the current namespace.</p>\n"}, {"tags": [], "owner": {"reputation": 300, "user_id": 2068742, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/531732e06128a2c69f720d9abefbc464?s=128&d=identicon&r=PG", "display_name": "AvnishSingh", "link": "https://stackoverflow.com/users/2068742/avnishsingh"}, "is_accepted": false, "score": 1, "last_activity_date": 1498245205, "creation_date": 1498245205, "answer_id": 44728494, "question_id": 39313533, "link": "https://stackoverflow.com/questions/39313533/go-package-import-issue/44728494#44728494", "title": "Go package import issue", "body": "<p>All the packages imported are looked in under GOROOT and GOPATH environment variables first. Make sure your package is somewhere under these directories. </p>\n\n<p>Now Suppose <strong>GOPATH</strong> is set to : /Users/test/Desktop/GoProject/src(lets assume, your src directory)</p>\n\n<p>and <em>GOROOT</em> : /usr/local/go (where go is installed)\n. If a file(myFirst.go) in your GoProject has a package imported as</p>\n\n<pre><code>import \"abc/def/packageName\"\n</code></pre>\n\n<p>then it should be present at any of the below two places:</p>\n\n<p><strong>/Users/test/Desktop/GoProject</strong>/src/abc/def/packageName/*\n<em>/usr/local/go</em>/src/abc/def/packageName/*</p>\n\n<p>If not, you will get import error.</p>\n\n<p>The files inside these directories will have the first line as </p>\n\n<pre><code>package packageName\n</code></pre>\n\n<p>stating that all these files constitutes a package <strong>packageName</strong></p>\n"}], "owner": {"reputation": 63, "user_id": 5787683, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/e97e45c6846214b3ad8bc66b3276a0b5?s=128&d=identicon&r=PG&f=1", "display_name": "Eagle Amulet", "link": "https://stackoverflow.com/users/5787683/eagle-amulet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1498245205, "creation_date": 1472963120, "question_id": 39313533, "link": "https://stackoverflow.com/questions/39313533/go-package-import-issue", "title": "Go package import issue", "body": "<p>I've my folder setup like this:</p>\n\n<pre><code>-src\n--bitbucket.org\n---eagleamulet\n----myFirst.go (package main)\n-----utils\n------tempconv\n-------tempconv.go (package tempconv)\n</code></pre>\n\n<p>However I'm not able to add the tempconv package to myFirst.go My Go environment settings look ok, so I'm not sure what's wrong here:</p>\n\n<p><a href=\"http://i.stack.imgur.com/QYXkk.png\" rel=\"nofollow\">temppackage</a></p>\n\n<p><a href=\"http://i.stack.imgur.com/DfBn0.png\" rel=\"nofollow\">goenv</a></p>\n\n<p>Any pointers are greatly appreciated!</p>\n\n<p>thanks\nEA</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 1, "last_activity_date": 1472940533, "creation_date": 1472940533, "answer_id": 39311747, "question_id": 39311436, "link": "https://stackoverflow.com/questions/39311436/using-overridden-parent-method-in-other-parent-methods/39311747#39311747", "title": "Using overridden parent method in other parent methods", "body": "<p>Two approaches I would consider for solving this:</p>\n\n<p><strong>1.</strong> Refactor your code to have a single type <code>Cat</code> with the fields <code>Name string</code> and <code>Legs int</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Cat struct {\n    Name string\n    Legs int\n}\n\nfunc (c *Cat) PrintLegs() {\n    fmt.Printf(\"I have %d legs.\\n\", c.Legs)\n}\n\nfunc main() {\n    c := &amp;Cat{\"Steve\", 4}\n    c.PrintLegs() // want 4\n    o := &amp;Cat{\"Bob\", 8}\n    o.PrintLegs() // want 8\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/_PNAu3sgG8\" rel=\"nofollow\">https://play.golang.org/p/_PNAu3sgG8</a></p>\n\n<p><strong>2.</strong> Do away with the <code>Cat</code> type and just have <code>TetraCat</code> and <code>OctoCat</code> implement the <code>Legger</code> interface:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Legger interface {\n    Legs() int\n}\n\nfunc PrintLegs(l Legger) {\n    fmt.Printf(\"I have %d legs.\\n\", l.Legs())\n}\n\n// OctoCat is a Cat with a particular implementation of Legs\ntype OctoCat struct {\n    Name string\n}\n\nfunc (c *OctoCat) Legs() int {\n    return 8\n}\n\n// TetraCat has a different implementation of Legs\ntype TetraCat struct {\n    Name string\n}\n\nfunc (c *TetraCat) Legs() int {\n    return 4\n}\n\nfunc main() {\n    c := &amp;TetraCat{\"Steve\"}\n    PrintLegs(c) // want 4\n    o := &amp;OctoCat{\"Bob\"}\n    PrintLegs(o) // want 8\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/m4QvKhSj0w\" rel=\"nofollow\">https://play.golang.org/p/m4QvKhSj0w</a></p>\n"}], "owner": {"reputation": 622, "user_id": 1224002, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f4dcddce38402fb5ef2c2cf390ee82a4?s=128&d=identicon&r=PG", "display_name": "Ted Pudlik", "link": "https://stackoverflow.com/users/1224002/ted-pudlik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473667428, "creation_date": 1472937561, "last_edit_date": 1495540863, "question_id": 39311436, "link": "https://stackoverflow.com/questions/39311436/using-overridden-parent-method-in-other-parent-methods", "title": "Using overridden parent method in other parent methods", "body": "<p>I have two types, B and C, which share all methods, but implement one of them differently.  I would like to express this by having a parent type A, containing the implementations of the shared methods, and embedding A in B and C.  (Don't Repeat Yourself!) The snag is that the method that differs between B and C is called in many of the shared methods.  What's the idiomatic way to structure such code?</p>\n\n<p>My current implementation looks essentially like this (<a href=\"https://play.golang.org/p/RAvH_hBFDN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RAvH_hBFDN</a>; based on an example by <a href=\"http://dave.cheney.net/2016/08/20/solid-go-design\" rel=\"nofollow noreferrer\">Dave Cheney</a>):</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Legger interface {\n    Legs() int\n}\n\ntype Cat struct {\n    Name string\n    L    Legger\n}\n\n// Cat has many methods like this, involving calling c.L.Legs()\nfunc (c Cat) PrintLegs() {\n    fmt.Printf(\"I have %d legs.\\n\", c.L.Legs())\n}\n\n// OctoCat is a Cat with a particular implementation of Legs\ntype OctoCat struct {\n    Cat\n}\n\nfunc (c OctoCat) Legs() int {\n    return 8\n}\n\n// TetraCat has a different implementation of Legs\ntype TetraCat struct {\n    Cat\n}\n\nfunc (c TetraCat) Legs() int {\n    return 4\n}\n\nfunc main() {\n    c := TetraCat{Cat{\"Steve\",nil}}\n    c.L = &amp;c\n    c.PrintLegs() // want 4\n    o := OctoCat{Cat{\"Bob\",nil}}\n    o.L = &amp;o\n    o.PrintLegs() // want 8\n}\n</code></pre>\n\n<p>The type definitions themselves look nice and clean, but the initialization code in <code>main</code> is wacky (first the <code>nil</code> in the struct literal, then <code>c.L = &amp;c</code>, what?).  Is there a better solution?</p>\n\n<p>A similar pattern was presented in <a href=\"https://stackoverflow.com/q/21251242/1224002\">is it possible to call overridden method from parent struct in golang?</a>, but the question of whether this is the idiomatic way to proceed was not answered.</p>\n"}, {"tags": ["bash", "go", "environment-variables"], "comments": [{"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1472937593, "post_id": 39311386, "comment_id": 65955682, "body": "have you read there? <a href=\"http://stackoverflow.com/questions/21001387/how-do-i-set-the-gopath-environment-variable-on-ubuntu-what-file-must-i-edit\" title=\"how do i set the gopath environment variable on ubuntu what file must i edit\">stackoverflow.com/questions/21001387/&hellip;</a>. Are you sure your <code>&#47;home&#47;rsg&#47;Go</code> directory exists and has user permissions?"}, {"owner": {"reputation": 33471, "user_id": 1420279, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c799e8b3d14c4f149ce71455109f17eb?s=128&d=identicon&r=PG", "display_name": "Antimony", "link": "https://stackoverflow.com/users/1420279/antimony"}, "reply_to_user": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1472937952, "post_id": 39311386, "comment_id": 65955771, "body": "@Jean-Fran&#231;oisFabre yes and yes. The real mystery is why writing <code>export GOPATH=...</code> doesn&#39;t actually export the variable."}, {"owner": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1472938525, "post_id": 39311386, "comment_id": 65955908, "body": "Strange, all the guys who answered seemed to have that part okay ! can you <code>ls $GOPATH</code> ? (I mean: maybe <code>go</code> filters out directories that don&#39;t please it)"}, {"owner": {"reputation": 33471, "user_id": 1420279, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c799e8b3d14c4f149ce71455109f17eb?s=128&d=identicon&r=PG", "display_name": "Antimony", "link": "https://stackoverflow.com/users/1420279/antimony"}, "reply_to_user": {"reputation": 126278, "user_id": 6451573, "user_type": "moderator", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4xczZ.jpg?s=128&g=1", "display_name": "Jean-Fran&#231;ois Fabre", "link": "https://stackoverflow.com/users/6451573/jean-fran%c3%a7ois-fabre"}, "edited": false, "score": 0, "creation_date": 1472938748, "post_id": 39311386, "comment_id": 65955962, "body": "Running <code>unset GOPATH</code> seems to have fixed things. I have no idea why, but at least it works now."}], "answers": [{"tags": [], "owner": {"reputation": 33471, "user_id": 1420279, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c799e8b3d14c4f149ce71455109f17eb?s=128&d=identicon&r=PG", "display_name": "Antimony", "link": "https://stackoverflow.com/users/1420279/antimony"}, "is_accepted": true, "score": 0, "last_activity_date": 1472938716, "creation_date": 1472938716, "answer_id": 39311555, "question_id": 39311386, "link": "https://stackoverflow.com/questions/39311386/go-ignores-exported-gopath/39311555#39311555", "title": "Go ignores exported GOPATH", "body": "<p>I still have no idea what the problem was, but running <code>unset GOPATH</code> fixed it.</p>\n"}], "owner": {"reputation": 33471, "user_id": 1420279, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c799e8b3d14c4f149ce71455109f17eb?s=128&d=identicon&r=PG", "display_name": "Antimony", "link": "https://stackoverflow.com/users/1420279/antimony"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 0, "accepted_answer_id": 39311555, "answer_count": 1, "score": 1, "last_activity_date": 1472938716, "creation_date": 1472937229, "last_edit_date": 1472938574, "question_id": 39311386, "link": "https://stackoverflow.com/questions/39311386/go-ignores-exported-gopath", "title": "Go ignores exported GOPATH", "body": "<p>I followed the <a href=\"https://golang.org/doc/install\" rel=\"nofollow\">linux go installation instructions</a> and ran <code>sudo tar -C /usr/local -xzf go$VERSION.$OS-$ARCH.tar.gz</code> and added <code>/usr/local/go/bin</code>to <code>$PATH</code>. Unfortunately, I am stuck because <code>go</code> ignores any attempt to export <code>$GOPATH</code> in the terminal. What's going on and how can I fix it?</p>\n\n<pre><code>$ export GOPATH=$HOME/Go\n$ echo $GOPATH\n/home/rsg/Go\n$ go env\nGOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build834345994=/tmp/go-build -gno-record-gcc-switches\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>Edit: On further inspection, it seems that for some reason, I am unable to export GOPATH at all. I am not sure why, because exporting other variables (e.g. FOO) works just fine. What on earth is going on?</p>\n\n<pre><code>rsg@P ~ $ env | grep FOO\nrsg@P ~ $ env | grep GOPATH\nrsg@P ~ $ export FOO=bar\nrsg@P ~ $ env | grep FOO\nFOO=bar\nrsg@P ~ $ export GOPATH=bar\nrsg@P ~ $ env | grep GOPATH\nrsg@P ~ $ GOPATH=foo env | grep GOPATH\nGOPATH=foo\nrsg@P ~ $ env | grep GOPATH\n</code></pre>\n"}, {"tags": ["file", "go", "writer"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1472936926, "post_id": 39311307, "comment_id": 65955499, "body": "Not sure what you&#39;re actually asking but <code>os.File</code> implements <a href=\"https://golang.org/src/os/file.go#L138\" rel=\"nofollow noreferrer\">Write</a>"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472937278, "post_id": 39311307, "comment_id": 65955597, "body": "Ah it may be a <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\">bad link</a> because that File link goes to <a href=\"https://golang.org/src/os/file_unix.go?s=597:624#L17\" rel=\"nofollow noreferrer\">file_unix.go</a> not to file.go and I didn&#39;t look at the filename closely"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472940691, "post_id": 39311307, "comment_id": 65956344, "body": "Ok it&#39;s not a bad link. The File type is re-defined in multiple files under src/os but the exported methods are all in a different file. Now the question arises is how is the redefinition in the same package permitted ?"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472940950, "post_id": 39311307, "comment_id": 65956391, "body": "There is redefinition because only one of the files defining the type will be included in the build."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472941104, "post_id": 39311307, "comment_id": 65956433, "body": "Well why don&#39;t they just stick the type declaration in the one file along with all the exported methods then ?"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472941147, "post_id": 39311307, "comment_id": 65956447, "body": "Because different Operating-Systems need different metadata to talk to a file (i.e. read to it, write from it, ...)"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472941231, "post_id": 39311307, "comment_id": 65956467, "body": "Just the type <code>type File struct {}</code> bit can move to File.go. The unexported types/methods are where the os specific work happens"}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1472936953, "creation_date": 1472936953, "answer_id": 39311352, "question_id": 39311307, "link": "https://stackoverflow.com/questions/39311307/how-does-os-file-implement-io-writer/39311352#39311352", "title": "How does os.File implement io.Writer?", "body": "<p>You are missing the exported <code>Write([]byte)</code> defined on <code>*os.File</code> here: <a href=\"https://golang.org/src/os/file.go?s=4417:4466#L128\" rel=\"nofollow\">https://golang.org/src/os/file.go?s=4417:4466#L128</a></p>\n"}], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3934, "favorite_count": 0, "accepted_answer_id": 39311352, "answer_count": 1, "score": -1, "last_activity_date": 1473073683, "creation_date": 1472936613, "last_edit_date": 1473073683, "question_id": 39311307, "link": "https://stackoverflow.com/questions/39311307/how-does-os-file-implement-io-writer", "title": "How does os.File implement io.Writer?", "body": "<p>I'm able to do this:</p>\n\n<pre><code>f, err := os.Create(\"file\")\nif err != nil {\n    ....\n}\nby := bufio.NewWriter(f)\n</code></pre>\n\n<p>And this:</p>\n\n<pre><code>var _ io.Writer = &amp;os.File{}\n</code></pre>\n\n<p>The package documentation for <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow\">os.File</a> leads to <a href=\"https://golang.org/src/os/file_unix.go?s=597:624#L17\" rel=\"nofollow\">this source file</a> which does contain an <em>unexported</em> write function but I get an error when I try to implement an interface with an unexported function.</p>\n\n<pre><code>var _ Disease = &amp;Scratch{}  // *Scratch doesn't implement Disease have spread() want Spread()\ntype Disease interface {\n    Spread()\n}\ntype Scratch struct {\n    ....\n}\nfunc (s* Scratch) spread() {\n    ....\n}\n</code></pre>\n\n<p>What am I missing ?</p>\n\n<p><strong>Update</strong>: os.File <a href=\"https://github.com/golang/go/issues/16993\" rel=\"nofollow\">did need cleaning up</a></p>\n"}, {"tags": ["go", "polymorphism", "cqrs"], "answers": [{"comments": [{"owner": {"reputation": 474, "user_id": 915020, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f1cd4becf55b90e785aee0cc1142d14f?s=128&d=identicon&r=PG", "display_name": "HexaGridBrain", "link": "https://stackoverflow.com/users/915020/hexagridbrain"}, "edited": false, "score": 0, "creation_date": 1472941734, "post_id": 39311294, "comment_id": 65956571, "body": "Thank you for the &quot;Type assertion&quot;, it seems to work for my purpose."}], "tags": [], "owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "is_accepted": true, "score": 1, "last_activity_date": 1472936536, "last_edit_date": 1592644375, "creation_date": 1472936536, "answer_id": 39311294, "question_id": 39311049, "link": "https://stackoverflow.com/questions/39311049/how-to-dispatch-commands-to-the-right-commandhandler-by-the-composition-inherite/39311294#39311294", "title": "How to dispatch Commands to the right CommandHandler by the composition inheritence of Golang?", "body": "<p>the signature of <code>Handle</code> has to be exactly <code>func (ch HelloWorldCommandHandler) Handle(cmd Command) {</code> to implement the interface.\nA quick fix would be to do a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> at the beginning of your <code>Handle</code> function to get the <code>HelloWorldCommand</code> from your <code>Command</code>)</p>\n<p>But I think this might be a symptom of a possible design issue: if the polymorphism is on <code>Command</code>, maybe command should handle/run itself? maybe with a <code>Run() error</code> in the interface?</p>\n"}], "owner": {"reputation": 474, "user_id": 915020, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f1cd4becf55b90e785aee0cc1142d14f?s=128&d=identicon&r=PG", "display_name": "HexaGridBrain", "link": "https://stackoverflow.com/users/915020/hexagridbrain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 573, "favorite_count": 0, "accepted_answer_id": 39311294, "answer_count": 1, "score": 0, "last_activity_date": 1472949761, "creation_date": 1472934406, "last_edit_date": 1472949761, "question_id": 39311049, "link": "https://stackoverflow.com/questions/39311049/how-to-dispatch-commands-to-the-right-commandhandler-by-the-composition-inherite", "title": "How to dispatch Commands to the right CommandHandler by the composition inheritence of Golang?", "body": "<p>I want to learn to program in Go, I decided as a pet program I would do a simple dispatcher of different Commands to several CommandHandler (if the CommandHandler has the same name as the Command it should handle.)</p>\n\n<p>My problem is when I want to have a CommandHandlerManager that publishes a Commands that would be dispatch to the correct CommandHandler, it tells me that I need to have a concrete implementation of my HelloWorldCommand because HelloWorldCommandHandler doesn't implement the interface of Command.</p>\n\n<p><strong>Error message at compilation</strong></p>\n\n<pre><code>E:\\Desktop\\ManBear\\golang\\src&gt;go run main.go\n# command-line-arguments\n.\\main.go:71: cannot use cmdHandler (type HelloWorldCommandHandler) as type CommandHandler in array or slice literal:\n        HelloWorldCommandHandler does not implement CommandHandler (wrong type for Handle method)\n                have Handle(HelloWorldCommand)\n                want Handle(Command)\n</code></pre>\n\n<p>I would need that someone explains the me what I'm doing wrong, I guessed it meant that I should implement an alone <strong>func</strong> method to my HelloWorldCommandHandler for the interface alone like below:</p>\n\n<pre><code>func (ch HelloWorldCommandHandler) Handle(cmd Command) {\n    fmt.Println(\"HelloWorldCommandHandler handled the basic command with name --&gt; \" + cmd.GetName())\n}\n</code></pre>\n\n<p>But it created more type-related errors.</p>\n\n<p>A working example of what I'm trying to do with an explanation of how and why I'm doing it wrong would be appreciated.</p>\n\n<p>Thank you.</p>\n\n<p><strong>Here's my code:</strong></p>\n\n<pre><code>package main \n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\n\ntype Command interface {\n    GetName() string\n}\n\n\ntype CommandHandler interface {\n    Command\n    Handle(cmd Command)\n}\n\n\ntype HelloWorldCommand struct {\n    Command\n    Name string\n    Age int\n}\n\nfunc (cmd HelloWorldCommand) GetName() string {\n    return \"HelloWorldCommand\"\n}\n\n\ntype HelloWorldCommandHandler struct {\n    CommandHandler\n}\n\nfunc (cmd HelloWorldCommandHandler) GetName() string {\n    return \"HelloWorldCommand\"\n}\n\nfunc (ch HelloWorldCommandHandler) Handle(cmd HelloWorldCommand) {\n    fmt.Println(\"Hello World! My name is \" + cmd.Name + \" and I'm \" + strconv.Itoa(cmd.Age) + \" years old!\")\n}\n\ntype CommandHandlerManager struct {\n    CommandHandlers []CommandHandler\n}\n\nfunc (chm CommandHandlerManager) Publish(cmd Command) {\n\n    for _, cmdHandler := range chm.CommandHandlers {\n        if cmd.GetName() == cmdHandler.GetName() {\n            cmdHandler.Handle(cmd)\n        }\n    }\n}\n\n\nfunc main() {\n\n    fmt.Println(\"Hey my friend!\")\n\n    cmd := HelloWorldCommand {Name: \"ManBear\", Age: 357}\n    cmdHandler := HelloWorldCommandHandler {}\n\n    fmt.Println(cmd.GetName())\n    fmt.Println(cmdHandler.GetName())\n\n    cmdHandler.Handle(cmd)\n\n    cmdHandlerManager := CommandHandlerManager { \n        CommandHandlers: []CommandHandler { \n            cmdHandler, // &lt;-- the error is here \n        },\n    };\n}\n</code></pre>\n\n<p><strong><em>UPDATE:</em></strong></p>\n\n<p><strong>For the curious, here is a functionning version of my pet program</strong></p>\n\n<p>Thanks to the help of <em>Dean Elbaz</em> by suggesting to use the type assertion, it makes it possible to handle a Command by it correct CommandHandler and use the correct set of values that comes with each Command. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"time\"\n)\n\n\ntype Command interface {\n    GetName() string\n}\n\n\ntype CommandHandler interface {\n    Command\n    Handle(cmd Command)\n}\n\nconst HelloWorldCommandName string = \"HelloWorldCommand\"\n\ntype HelloWorldCommand struct {\n    Command\n    Name string\n    Age int\n}\n\nfunc (cmd HelloWorldCommand) GetName() string {\n    return HelloWorldCommandName\n}\n\n// Basic Hello World\ntype HelloWorldCommandHandler struct {\n    CommandHandler\n}\n\nfunc (cmd HelloWorldCommandHandler) GetName() string {\n    return HelloWorldCommandName\n}\n\nfunc (ch HelloWorldCommandHandler) Handle(cmd Command) {\n    fmt.Println(\"Hello World!\\n----------------------------------------\\n\")\n}\n\n// Hello World with Name and Age\ntype HelloWorldWithNameAndAgeCommandHandler struct {\n    CommandHandler\n}\n\nfunc (cmd HelloWorldWithNameAndAgeCommandHandler) GetName() string {\n    return HelloWorldCommandName\n}\n\nfunc (ch HelloWorldWithNameAndAgeCommandHandler) Handle(cmd Command) {\n    var helloWorldCommand HelloWorldCommand = cmd.(HelloWorldCommand)\n    fmt.Println(\"Hello World! My name is \" + helloWorldCommand.Name + \" and I'm \" + strconv.Itoa(helloWorldCommand.Age) + \" years old!\\n----------------------------------------\\n\")\n}\n\n\nconst TodayDateTimeCommandName string = \"TodayDateTimeCommand\"\n\n// Today's DateTime Command\ntype TodayDateTimeCommand struct {\n    Command\n    TimeZone string\n}\n\nfunc (cmd TodayDateTimeCommand) GetName() string {\n    return TodayDateTimeCommandName\n}\n\n\ntype TodayDateTimeCommandHandler struct {\n\n}\n\nfunc (ch TodayDateTimeCommandHandler) GetName() string {\n    return TodayDateTimeCommandName\n}\n\nfunc (ch TodayDateTimeCommandHandler) Handle(cmd Command) {\n    var todayCommand TodayDateTimeCommand = cmd.(TodayDateTimeCommand)\n    location, err := time.LoadLocation(todayCommand.TimeZone)\n    if err != nil {\n        fmt.Errorf(\"Could not load the Location of the TimeZone. %f\", err.Error())\n        return\n    }\n    current_time := time.Now().In(location)\n    fmt.Println(\"Today's date and time is \" + current_time.String() + \" for the time zone: \" + todayCommand.TimeZone)\n}\n\n\n// The CommandHandler Manager\ntype CommandHandlerManager struct {\n    CommandHandlers []CommandHandler\n}\n\nfunc (chm CommandHandlerManager) Publish(cmd Command) {\n\n    for _, cmdHandler := range chm.CommandHandlers {\n        if cmd.GetName() == cmdHandler.GetName() {\n            cmdHandler.Handle(cmd)\n        }\n    }\n}\n\n\nfunc main() {\n\n    fmt.Println(\"Hey my friend!\\n\\n\\n\")\n\n    cmdHandlerManager := CommandHandlerManager {\n        CommandHandlers: []CommandHandler {\n            HelloWorldCommandHandler {},\n            HelloWorldWithNameAndAgeCommandHandler {},\n            TodayDateTimeCommandHandler {},\n        },\n    };\n\n    cmd := HelloWorldCommand {Name: \"ManBear\", Age: 357}\n    cmdHandlerManager.Publish(cmd)\n\n    fmt.Println(\"~~~~~~~~ other command published ~~~~~~~~~~~~~~~~~~~~~\")\n    cmd2 := TodayDateTimeCommand{ TimeZone: \"America/Montreal\" }\n    cmdHandlerManager.Publish(cmd2)\n}\n</code></pre>\n"}, {"tags": ["html", "go", "escaping"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 2, "last_activity_date": 1472932362, "creation_date": 1472932362, "answer_id": 39310788, "question_id": 39310259, "link": "https://stackoverflow.com/questions/39310259/what-is-the-difference-between-html-escapestring-and-template-htmlescapestring/39310788#39310788", "title": "What is the difference between html.EscapeString() and template.HTMLEscapeString()?", "body": "<p>There is no difference. Internally they are differently implemented (<a href=\"https://github.com/golang/go/blob/master/src/html/escape.go#L166\" rel=\"nofollow\">[1]</a> <a href=\"https://github.com/golang/go/blob/master/src/text/template/funcs.go#L489\" rel=\"nofollow\">[2]</a>) but results are 100% equal. </p>\n\n<p>I'm pretty sure <code>HTMLEscapeString</code> was created for internal <code>text/template</code> package usage so if you need to escape HTML in your app just use <code>html.EscapeString</code>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 821, "favorite_count": 0, "accepted_answer_id": 39310788, "answer_count": 1, "score": 1, "last_activity_date": 1472932362, "creation_date": 1472928327, "last_edit_date": 1472929016, "question_id": 39310259, "link": "https://stackoverflow.com/questions/39310259/what-is-the-difference-between-html-escapestring-and-template-htmlescapestring", "title": "What is the difference between html.EscapeString() and template.HTMLEscapeString()?", "body": "<p>I need to escape some html and want to make sure I am not missing anything. </p>\n\n<p>The \"html\" package has:</p>\n\n<pre><code>[html.EscapeString(s string) string][1]\nwhich will escape `'\"&amp;&lt;&gt;`\n</code></pre>\n\n<p>The \"text/template\" package has:</p>\n\n<pre><code>[template.HTMLEscapeString(s string) string][2]\nwhich also escapes `'\"&amp;&lt;&gt;`\n</code></pre>\n\n<p>They seem to do the same but have slightly different approaches. Is there any differences that I am missing? If not, why 2 different built-in functions?</p>\n"}, {"tags": ["google-app-engine", "session", "twitter", "go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1472927692, "post_id": 39310126, "comment_id": 65953040, "body": "How have you defined <code>GetGSession</code>?"}, {"owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1472928433, "post_id": 39310126, "comment_id": 65953247, "body": "That is a normal Gorilla session..   &#39;code&#39; //GetGSession - func GetGSession(req *http.Request) (session *sessions.Session, err error) {  \tsession, err = mcdstore.Get(req, &quot;secondSession&quot;) \tif err != nil { \t\treturn nil, err \t} \treturn session, err }"}], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "edited": false, "score": 0, "creation_date": 1472946202, "post_id": 39310974, "comment_id": 65957398, "body": "Sorry I am new to this, so unable to execute your suggestion. I getting null value in v4."}, {"owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "edited": false, "score": 0, "creation_date": 1472946612, "post_id": 39310974, "comment_id": 65957475, "body": "&lt;code&gt; &#39;type S struct { datastore.Key} func (s S) I() {\tfmt.Println(&quot;S implements the I interface&quot;) } func f(s S) interface{} { return []interface{}{s} } func GetHTLKeysTypeAssert(req *http.Request, vars ...string) []interface{} { \tctx := appengine.NewContext(req) \ts, _ := GetGSession(req) \tv := f(S{}) \tkey := internalKey \tvar ok bool \tif v, ok = s.Values[key]; ok { \t\tv2, ok1 := v.([]interface{}) \t\tif !ok1 {//err} \t\t\tfor _, v3 := range v2 { v4, ok2 := v3.(I) \t\t\tif !ok {//err} log.Infof(ctx, &quot;v4 %+v&quot;, v4) \t} return v2 }&#39; &lt;/code&gt;"}, {"owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "reply_to_user": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "edited": false, "score": 0, "creation_date": 1472996110, "post_id": 39310974, "comment_id": 65966935, "body": "So if v4 is nil, it means what you had in v3 wasn&#39;t of the interface you were expecting, or it had a nil value to begin with. did you get the log from line 49?"}, {"owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "edited": false, "score": 0, "creation_date": 1473013877, "post_id": 39310974, "comment_id": 65972429, "body": "Hi Dean, ya there was a typo on line 48 that is why didn&#39;t catch the null earlier. However, I changed the implementation. Instead of using interface, I changed everything to []datastore.Key and it working fine now. Will explore why it didn&#39;t work for interface. Thanks for all your help."}], "tags": [], "owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "is_accepted": true, "score": 0, "last_activity_date": 1472933831, "creation_date": 1472933831, "answer_id": 39310974, "question_id": 39310126, "link": "https://stackoverflow.com/questions/39310126/loading-page-faster-by-storing-keys-into-sessions-golang/39310974#39310974", "title": "Loading page faster by storing keys into sessions golang", "body": "<p>Your issue is that you can't assert an <code>[]interface{}</code> is a <code>[]datastore.Key</code>. This is because they are different.\nWhat you can do at this point, is type assert <code>v</code> to a <code>[]interface{}</code> then loop through the slice and type assert each element.</p>\n\n<p>Here is an example demonstrating this (<a href=\"https://play.golang.org/p/IFEzOQsoyo\" rel=\"nofollow\">playground version</a>):</p>\n\n<pre><code>type I interface {\n    I()\n}\n\ntype S struct{}\n\nfunc (s S) I() {\n    fmt.Println(\"S implements the I interface\")\n}\n\n// Represents you getting something out of the session\nfunc f(s S) interface{} {\n    return []interface{}{s}\n}\n\nfunc main() {\n    v := f(S{})\n\n    //v2 := v.([]I) would panic like in your example.\n\n    v2, ok := v.([]interface{})\n    if !ok {\n        // handle having a non []interface{} as a value\n    }\n    for _, v3 := range v2 {\n        v4, ok := v3.(I)\n        if !ok {\n            // handle having a non-I in the slice\n        }\n        v4.I() //you definitely have an I here \n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 5728873, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/R37ba.jpg?s=128&g=1", "display_name": "Dheeraj Sarwaiya", "link": "https://stackoverflow.com/users/5728873/dheeraj-sarwaiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 39310974, "answer_count": 1, "score": 0, "last_activity_date": 1472933831, "creation_date": 1472927341, "question_id": 39310126, "link": "https://stackoverflow.com/questions/39310126/loading-page-faster-by-storing-keys-into-sessions-golang", "title": "Loading page faster by storing keys into sessions golang", "body": "<p>I am trying to load dynamic page faster. I am making twitter clone as a learning assignment. I am following below approach</p>\n\n<ol>\n<li><p>When somebody tweets, store the tweet in datastore and safe the same in memcache { key.string(), json.Marshal(tweet) }</p></li>\n<li><p>I push the tweet in User home time line. The home time line is a []*datastore.Key, which is stored in user session (which get copied in memcache and then in DB).</p></li>\n<li><p>When user open her homepage, the homepage try to get the Keys from session, if not found then it make a datastore query.</p></li>\n<li><p>Once i get the keys I fetch the tweets from memcache (if not then from db)</p></li>\n</ol>\n\n<p>I am stuck at step 3. </p>\n\n<p>In first case I am getting the correct information but in string slices (not in []*datastore.Key). </p>\n\n<p>In second case I getting this error</p>\n\n<blockquote>\n  <p>2016/09/03 17:23:42 http: panic serving 127.0.0.1:47104: interface\n  conversion: interface is []interface {}, not []datastore.Key</p>\n</blockquote>\n\n<p>Kindly help me where I am going wrong and is there a better way.  </p>\n\n<p>case 1 </p>\n\n<pre><code>func GetKeys(req *http.Request, vars ...string) []interface{} {\n    //GetKeys - get the keys\n    s, _ := GetGSession(req)\n    var flashes []interface{}\n    key := internalKey\n    if len(vars) &gt; 0 {\n        key = vars[0]\n    }\n\n    if v, ok := s.Values[key]; ok {\n        // Drop the flashes and return it.\n        //  delete(s.Values, key)\n        flashes = v.([]interface{})\n    }\n    return flashes\n}\n</code></pre>\n\n<p>Case2</p>\n\n<pre><code>//GetHTLKeys - get the hometimeline keys\nfunc GetHTLKeys(req *http.Request, vars ...string) []datastore.Key {\n    s, _ := GetGSession(req)\n\n    var keyList []datastore.Key\n\n    key := internalKey\n    if len(vars) &gt; 0 {\n        key = vars[0]\n    }\n\n    if v, ok := s.Values[key]; ok {\n        keyList = v.([]datastore.Key)\n    }\n    return keyList\n}\n</code></pre>\n"}, {"tags": ["sorting", "go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 6, "last_activity_date": 1472927137, "creation_date": 1472927137, "answer_id": 39310100, "question_id": 39310088, "link": "https://stackoverflow.com/questions/39310088/golang-sort-does-not-implement-sort-interface-missing-len-method/39310100#39310100", "title": "Golang Sort :does not implement sort.Interface (missing Len method)", "body": "<p><code>[]*Team</code> is not the same as <code>Teams</code>; you need to explicitly use or cast to the latter:</p>\n\n<pre><code>type Group struct {\n   Teams Teams\n}\nsort.Sort(group.Teams)\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>type Group struct {\n   Teams []*Team\n}\nsort.Sort(Teams(group.Teams))\n</code></pre>\n"}], "owner": {"reputation": 675, "user_id": 1593432, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/acf2511e93a790ecb2e50f31ba576673?s=128&d=identicon&r=PG", "display_name": "marsrover", "link": "https://stackoverflow.com/users/1593432/marsrover"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2189, "favorite_count": 0, "accepted_answer_id": 39310100, "answer_count": 1, "score": 1, "last_activity_date": 1480684172, "creation_date": 1472927042, "question_id": 39310088, "link": "https://stackoverflow.com/questions/39310088/golang-sort-does-not-implement-sort-interface-missing-len-method", "title": "Golang Sort :does not implement sort.Interface (missing Len method)", "body": "<p>I\u00b4m having issues implementing the Sort interface in my Go app. Here\u00b4s the relevant code:</p>\n\n<pre><code>type Group struct {\n   Teams []*Team\n}\n\ntype Team struct {\n    Points int\n }\n\n    type Teams []*Team\n\n            func (slice Teams) Len() int {\n                return len(slice)\n            }\n\n            func (slice Teams) Less(i, j int) bool {\n                return slice[i].Points &lt; slice[j].Points\n            }\n\n            func (slice Teams) Swap(i, j int) {\n                slice[i], slice[j] = slice[j], slice[i]\n            }\n</code></pre>\n\n<p>So I wanna sort the groups\u00b4 teams on based on their points. But whenever I run </p>\n\n<pre><code>sort.Sort(group.Teams)\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code> cannot use group.Teams (type []*Team) as type sort.Interface in argument\nto sort.Sort:   []*Team does not implement sort.Interface (missing Len\nmethod)\n</code></pre>\n\n<p>Why is this?</p>\n"}, {"tags": ["elasticsearch", "go", "client"], "answers": [{"comments": [{"owner": {"reputation": 181, "user_id": 4453606, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/f22060487336c0de33d2f973806562cc?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4453606/david"}, "edited": false, "score": 0, "creation_date": 1472987497, "post_id": 39313915, "comment_id": 65964637, "body": "Is there a way to make the body pretty print? I add &amp;pretty as ....}&amp;pretty`) to query but it doesn&#39;t change."}, {"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "reply_to_user": {"reputation": 181, "user_id": 4453606, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/f22060487336c0de33d2f973806562cc?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4453606/david"}, "edited": false, "score": 0, "creation_date": 1475206397, "post_id": 39313915, "comment_id": 66860388, "body": "Yes, you can use something like this: <a href=\"http://stackoverflow.com/questions/19038598/how-can-i-pretty-print-json-using-go\" title=\"how can i pretty print json using go\">stackoverflow.com/questions/19038598/&hellip;</a>"}], "tags": [], "owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "is_accepted": false, "score": 4, "last_activity_date": 1472968118, "creation_date": 1472968118, "answer_id": 39313915, "question_id": 39309862, "link": "https://stackoverflow.com/questions/39309862/querying-elasticsearch-from-golang/39313915#39313915", "title": "Querying ElasticSearch from Golang", "body": "<p>Generally speaking, you should be using POST instead of GET when sending a payload (even if ES accepts payload in GET requests).</p>\n\n<p>Try this code instead:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc main() {\n    url := \"http://localhost:9200/employee/info/_search\"\n    query := []byte(`{\n            \"query\":{\n                \"bool\": {\n                    \"should\": [\n                    {\"match\": {\"name\": \"Rodri\"}},\n                    {\"match\": {\"name\": \"Massadra\"}}\n                    ]\n                }\n            }\n            }`)\n    req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(query))\n    req.Header.Set(\"Content-Type\", \"application/json\")\n\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"\\n%s\", string(body))\n}\n</code></pre>\n"}], "owner": {"reputation": 181, "user_id": 4453606, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/f22060487336c0de33d2f973806562cc?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4453606/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2606, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1472968118, "creation_date": 1472925637, "last_edit_date": 1592644375, "question_id": 39309862, "link": "https://stackoverflow.com/questions/39309862/querying-elasticsearch-from-golang", "title": "Querying ElasticSearch from Golang", "body": "<p>Given a query string in Go like below in <a href=\"https://www.elastic.co/guide/en/sense/current/introduction.html\" rel=\"nofollow noreferrer\">Sense</a></p>\n<pre><code>GET employee/info/_search\n{\n    &quot;query&quot;:{\n        &quot;bool&quot;: {\n            &quot;should&quot;: [\n               {&quot;match&quot;: {&quot;name&quot;: &quot;Rodri&quot;}},\n                {&quot;match&quot;: {&quot;name&quot;: &quot;Massadra&quot;}}\n            ]\n        }\n    }\n}\n</code></pre>\n<p>how to get the response from ElasticSearch. This query works in Sense.\nThis is how I try to do get a response from ElasticSearch: encoding the string and call ElasticSearch</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;io/ioutil&quot;\n    &quot;net/http&quot;\n    &quot;net/url&quot;\n)\n\nfunc main() {\n    query := `{\n        &quot;query&quot;:{\n            &quot;bool&quot;: {\n                &quot;should&quot;: [\n                {&quot;match&quot;: {&quot;name&quot;: &quot;Rodri&quot;}},\n                {&quot;match&quot;: {&quot;name&quot;: &quot;Massadra&quot;}}\n                ]\n            }\n        }\n        }`\n    query = url.QueryEscape(query)\n    resp, err := http.Get(&quot;http://localhost:9200/employee/info/_search?q=&quot; + query)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(&quot;\\n%s&quot;, body)\n}\n</code></pre>\n<p>and this is the error i got:</p>\n<pre><code>{&quot;error&quot;:{&quot;root_cause&quot;:[{&quot;type&quot;:&quot;query_parsing_exception&quot;,&quot;reason&quot;:&quot;\nFailed to parse query [{\\n\\t\\t\\&quot;query\\&quot;:{\\n\\t\\t\\t\\&quot;bool\\&quot;: \n{\\n\\t\\t\\t\\t\\&quot;should\\&quot;: [\\n\\t\\t\\t\\t{\\&quot;match\\&quot;: {\\&quot;name\\&quot;: \\&quot;Rodri\\&quot;}},\n\\n\\t\\t\\t\\t{\\&quot;match\\&quot;: {\\&quot;name\\&quot;: \\&quot;Massadra\\&quot;}}\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t}]&quot;,\n&quot;index&quot;:&quot;employee&quot;}],&quot;type&quot;:&quot;search_phase_execution_exception&quot;,\n&quot;reason&quot;:&quot;all shards failed&quot;,&quot;phase&quot;:&quot;query&quot;,&quot;grouped&quot;:true,\n&quot;failed_shards&quot;:[{&quot;shard&quot;:0,&quot;index&quot;:&quot;employee&quot;,&quot;node&quot;:&quot;EbSLFZXfRCGoqnPcGsoNAg&quot;,\n&quot;reason&quot;:{&quot;type&quot;:&quot;query_parsing_exception&quot;,&quot;reason&quot;:&quot;Failed to parse query\n [{\\n\\t\\t\\&quot;query\\&quot;:{\\n\\t\\t\\t\\&quot;bool\\&quot;: {\\n\\t\\t\\t\\t\\&quot;should\\&quot;:\n [\\n\\t\\t\\t\\t{\\&quot;match\\&quot;: {\\&quot;name\\&quot;: \\&quot;Rodri\\&quot;}},\\n\\t\\t\\t\\t{\\&quot;match\\&quot;: \n{\\&quot;name\\&quot;: \\&quot;Massadra\\&quot;}}\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t}]&quot;,&quot;index&quot;:&quot;employee&quot;,\n&quot;caused_by&quot;:{&quot;type&quot;:&quot;parse_exception&quot;,&quot;reason&quot;:\n&quot;Cannot parse '{\\n\\t\\t\\&quot;query\\&quot;:{\\n\\t\\t\\t\\&quot;bool\\&quot;: {\\n\\t\\t\\t\\t\\&quot;should\\&quot;: [\\n\\t\\t\\t\\t{\\&quot;match\\&quot;:\n {\\&quot;name\\&quot;: \\&quot;Rodri\\&quot;}},\\n\\t\\t\\t\\t{\\&quot;match\\&quot;: {\\&quot;name\\&quot;: \\&quot;Massadra\\&quot;}}\\n\\t\\t\\t\\t]\\n\\t\\t\\t}\\n\\t\\t}\\n\\t\\t}': \nEncountered \\&quot; &lt;RANGE_GOOP&gt; \\&quot;[\\\\n\\\\t\\\\t\\\\t\\\\t{\\\\\\&quot;match\\\\\\&quot;: \\&quot;\\&quot; \nat line 1, column 41.\\nWas expecting one of:\\n    \\&quot;]\\&quot; ...\\n    \\&quot;}\\&quot; ...\\n   \n &quot;,&quot;caused_by&quot;:{&quot;type&quot;:&quot;parse_exception&quot;,&quot;reason&quot;:&quot;Encountered \\&quot; &lt;RANGE_GOOP&gt; \n\\&quot;[\\\\n\\\\t\\\\t\\\\t\\\\t{\\\\\\&quot;match\\\\\\&quot;: \\&quot;\\&quot; at line 1, column 41.\\nWas expecting one\n</code></pre>\n<p>I also try this <a href=\"https://github.com/olivere/elastic\" rel=\"nofollow noreferrer\">client</a> but I didn't find a way to use it from string query.</p>\n<p>Thank you</p>\n"}, {"tags": ["go", "system-calls"], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 1, "last_activity_date": 1472933748, "creation_date": 1472933748, "answer_id": 39310961, "question_id": 39309798, "link": "https://stackoverflow.com/questions/39309798/shutdown-pc-in-go/39310961#39310961", "title": "Shutdown pc in Go", "body": "<p>This is not about system shutdown, but about <a href=\"http://linux.die.net/man/2/shutdown\" rel=\"nofollow\">shutting down connections</a>. I think for system shutdown you need to use <code>os/exec</code> and proper commands for current OS.</p>\n"}, {"comments": [{"owner": {"reputation": 518, "user_id": 10471621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CGkTl.jpg?s=128&g=1", "display_name": "Atomzwieback", "link": "https://stackoverflow.com/users/10471621/atomzwieback"}, "edited": false, "score": 0, "creation_date": 1595399176, "post_id": 63026709, "comment_id": 111456655, "body": "That applies only to Linux based systems but not Windows for example."}], "tags": [], "owner": {"reputation": 1, "user_id": 13973548, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/5bbdd5fae65424a86d629df36775f6b1?s=128&d=identicon&r=PG", "display_name": "wyongcan", "link": "https://stackoverflow.com/users/13973548/wyongcan"}, "is_accepted": false, "score": 0, "last_activity_date": 1595390886, "creation_date": 1595390886, "answer_id": 63026709, "question_id": 39309798, "link": "https://stackoverflow.com/questions/39309798/shutdown-pc-in-go/63026709#63026709", "title": "Shutdown pc in Go", "body": "<p>You should use syscall.Reboot(syscall.LINUX_REBOOT_CMD_POWER_OFF).</p>\n"}], "owner": {"reputation": 219, "user_id": 4231291, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/59lgf.jpg?s=128&g=1", "display_name": "Alejandro", "link": "https://stackoverflow.com/users/4231291/alejandro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 566, "favorite_count": 0, "accepted_answer_id": 39310961, "answer_count": 2, "score": -1, "last_activity_date": 1595390886, "creation_date": 1472925225, "question_id": 39309798, "link": "https://stackoverflow.com/questions/39309798/shutdown-pc-in-go", "title": "Shutdown pc in Go", "body": "<p>After looking in the go documentation this seems to be what I am looking for <a href=\"https://golang.org/pkg/syscall/#Shutdown\" rel=\"nofollow\">https://golang.org/pkg/syscall/#Shutdown</a> , what do you need to pass to this function?</p>\n"}, {"tags": ["google-app-engine", "go", "memcached"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472919923, "post_id": 39308887, "comment_id": 65950578, "body": "The context that you&#39;re passing to the datastore is expiring too quickly or being cancelled by an upstream request before the datastore can persist the data"}, {"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472922658, "post_id": 39308887, "comment_id": 65951474, "body": "This implies that the Memcache call itself is canceling the request since this only happens when I access Memcache. Is a fault potentially destabilizing the request?"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472924300, "post_id": 39308887, "comment_id": 65951947, "body": "It&#39;s unlikely a memcache call can cancel a request, usually the other way around. A request has a context, which is passed to memcache/datastore. The context has a done channel which is listened to by memcache/datastore. If the done channel gets closed, memcache/datastore will stop doing whatever they were doing"}, {"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472924726, "post_id": 39308887, "comment_id": 65952073, "body": "Yes.. I&#39;m just having trouble thinking of how that can happen. I&#39;m guessing that it&#39;s my assumptions. Looking at the memcache logic, at the AppEngine level, it&#39;s not touching anything inside he context so it&#39;s not inadvertently interfering. Can I assume that datastore workflow is sufficiently done by the time the Put() returns?"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472925037, "post_id": 39308887, "comment_id": 65952198, "body": "I see you&#39;ve already seen <a href=\"https://groups.google.com/forum/#!topic/google-appengine/Kb5iYjhfang\" rel=\"nofollow noreferrer\">this</a>"}, {"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472925229, "post_id": 39308887, "comment_id": 65952256, "body": "Yeah :) . If my post has been approved then it has gathered little interest."}, {"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472928491, "post_id": 39308887, "comment_id": 65953262, "body": "It looks like, when I&#39;m not using Memcache, I can rapidly, repeatedly call the API request, but, if I&#39;m using Memcache, I can&#39;t call more than once or twice, even waiting for ten-seconds in-between. Let me know if you have any insight, here. The payloads are only about five-hundred bytes."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472930187, "post_id": 39308887, "comment_id": 65953775, "body": "Nope sorry all you"}, {"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1474237766, "post_id": 39308887, "comment_id": 66436984, "body": "By the way.. It turns out that I had a lingering goroutine buried in the lower-level logic. Every so often it&#39;d try to write to datastore after the request had already ended. It seems to only have happened when I used Memcache."}], "owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 490, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472919146, "creation_date": 1472919146, "question_id": 39308887, "link": "https://stackoverflow.com/questions/39308887/appengine-call-error-3-invalid-security-ticket-when-using-memcache", "title": "AppEngine: &quot;Call error 3: invalid security ticket&quot; when using memcache", "body": "<p>I only recently noticed it happening more frequently after I implemented session management on top of datastore and memcache, but, now, as I actually explicitly push data into memcache, it is now happening constantly. Most often, I'll get this error every time until I flush, it will work once, and then I'll get this error every time afterward.</p>\n\n<p>The requests that are inciting the issue are very simple (try <em>get</em> from memcache, do <em>get</em> from datastore, <em>put</em> to memcache), so they're very quick. The request either completes or fails within a second. Any ideas?</p>\n\n<pre><code>&lt;-- Current user reconcile here.\n2016/09/01 03:00:42 DEBUG: Session save not necessary: [DCRBDGRY6RMWANCSJXVLD7GULDH4NZEB6SBAQ3KSFIGA2LP45IIQ]    \n2016/09/01 03:00:42 DEBUG: Got session: [DCRBDGRY6RMWANCSJXVLD7GULDH4NZEB6SBAQ3KSFIGA2LP45IIQ]\n2016/09/01 03:00:42 DEBUG: Found user in session.\n&lt;-- Request-specific handler logic here.\n2016/09/01 03:00:42 DEBUG: Cache hit: [type.family:522450f6795592f844a27213a2dddf8de169f204]\n2016/09/01 03:00:42 ERROR: context expired before API call datastore_v3/Put completed\nrequest URL: /api/1/type/family/522450f6795592f844a27213a2dddf8de169f204\npanic: Call error 3: invalid security ticket (context expired)\n</code></pre>\n\n<p>Maybe if I could understand the nature of the failure and how it might potentially be tricked to fire so early I might be more helpful in providing more information?</p>\n"}, {"tags": ["go", "docker"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1472914535, "post_id": 39308223, "comment_id": 65948948, "body": "This is not what yo are asking for, but it might be helpful: <a href=\"https://docs.google.com/document/d/1_Y9xCEMj5S-7rv2ooHpZNH15JgRT5iM742gJkw5LtmQ/edit\" rel=\"nofollow noreferrer\">docs.google.com/document/d/&hellip;</a>"}, {"owner": {"reputation": 497, "user_id": 2692215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d0b6dabfa2ba63adece2081af25989e?s=128&d=identicon&r=PG&f=1", "display_name": "1lann", "link": "https://stackoverflow.com/users/2692215/1lann"}, "edited": false, "score": 0, "creation_date": 1472992154, "post_id": 39308223, "comment_id": 65965869, "body": "Are you looking for a Go debugger, like Delve? <a href=\"https://github.com/derekparker/delve\" rel=\"nofollow noreferrer\">github.com/derekparker/delve</a>. Or does it strictly need to be graphical/visual?"}], "owner": {"reputation": 6631, "user_id": 6790948, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/w18wK.png?s=128&g=1", "display_name": "mchawre", "link": "https://stackoverflow.com/users/6790948/mchawre"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1472914322, "creation_date": 1472914322, "question_id": 39308223, "link": "https://stackoverflow.com/questions/39308223/is-there-any-way-to-visualize-code-flow-in-docker-or-in-go-language", "title": "Is there any way to visualize code flow in docker (or in go language)", "body": "<p>I started contributing to docker but faced some challenges.</p>\n\n<ul>\n<li>Its difficult to understand the flow of code. Is there any way to know the flow of code. Suppose I ran \"docker run\" is there any way or tool where I get to know what all functions are called.</li>\n<li>If docker don't provide any such tool then is there any similar tool for go language as docker is written in go.</li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 20787, "user_id": 1251660, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/UaQAA.jpg?s=128&g=1", "display_name": "slayedbylucifer", "link": "https://stackoverflow.com/users/1251660/slayedbylucifer"}, "edited": false, "score": 1, "creation_date": 1472923290, "post_id": 39308152, "comment_id": 65951642, "body": "I edited your <code>for</code> loop a little bit. Thanks for the input. I had run exact similar code in python/ruby and the <code>resp</code> was a standard python dictionary/ruby hash. So it was easy to retrieve the values. I thought even in go, the response is a map, and hence I could not get it working. And thanks for the doc link."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 1, "last_activity_date": 1472923156, "last_edit_date": 1472923156, "creation_date": 1472913842, "answer_id": 39308152, "question_id": 39308040, "link": "https://stackoverflow.com/questions/39308040/how-to-retrieve-nested-map-values/39308152#39308152", "title": "How to retrieve nested map values", "body": "<p>The value of <code>resp</code> above is of the type <code>*ScanOutput</code>, which has <code>Items</code> type as <code>[]map[string]*AttributeValue</code>.</p>\n\n<p>To access <code>update_time</code>, you can try:</p>\n\n<pre><code>updateTimes := make([]string, 0)\n\n// Items is a slice of map of type map[string]*AttributeValue\nfor _, m := range resp.Items {\n    // m is of type map[string]*AttributeValue\n    timeStrPtr := *m[\"update_time\"].N\n    updateTimes = append(updateTimes, *timeStrPtr)\n}\n</code></pre>\n\n<p><code>updateTimes</code> should now contains all the <code>\"update_time\"</code> values as strings.</p>\n\n<p>More details <a href=\"https://godoc.org/github.com/aws/aws-sdk-go/service/dynamodb#ScanOutput\" rel=\"nofollow\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 8582, "user_id": 2503796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3J7Wd.jpg?s=128&g=1", "display_name": "a8m", "link": "https://stackoverflow.com/users/2503796/a8m"}, "is_accepted": false, "score": 0, "last_activity_date": 1488367302, "last_edit_date": 1488367302, "creation_date": 1488357213, "answer_id": 42526808, "question_id": 39308040, "link": "https://stackoverflow.com/questions/39308040/how-to-retrieve-nested-map-values/42526808#42526808", "title": "How to retrieve nested map values", "body": "<p>You should use the <a href=\"http://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/dynamodbattribute/\" rel=\"nofollow noreferrer\"><code>dynamodbattribute</code></a> package. it's cheaper, safer, and more readable.</p>\n\n<p>Following your example:  </p>\n\n<pre><code>type Row struct {\n    CreateTime int `dynamodbav:\"create_time\"`  \n    UpdateTime int `dynamodbav:\"update_time\"` \n}\n\n// ...\nrows := make([]*Row, len(resp.Items))\nif err := dynamodbattribute.Unmarshal(resp.Items, &amp;rows); err != nil {\n    // handle the error    \n}\n\n// access the data\nfor _, row := range rows {\n    fmt.Println(row.CreateTime, row.UpdateTime)    \n}\n</code></pre>\n"}], "owner": {"reputation": 20787, "user_id": 1251660, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/UaQAA.jpg?s=128&g=1", "display_name": "slayedbylucifer", "link": "https://stackoverflow.com/users/1251660/slayedbylucifer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 0, "accepted_answer_id": 39308152, "answer_count": 2, "score": 0, "last_activity_date": 1488367302, "creation_date": 1472913107, "question_id": 39308040, "link": "https://stackoverflow.com/questions/39308040/how-to-retrieve-nested-map-values", "title": "How to retrieve nested map values", "body": "<p>I want to scan AWS DynamoDB table and then pull only a certain value. Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb\"\n)\n\nfunc main() {\n    svc := dynamodb.New(session.New(), &amp;aws.Config{Region: aws.String(\"us-west-2\")})\n\n    params := &amp;dynamodb.ScanInput{\n        TableName: aws.String(\"my_Dynamo_table_name\"),\n        Limit: aws.Int64(2),\n    }\n\n    resp, err := svc.Scan(params)\n    if err != nil {\n        fmt.Println(err.Error())\n        return\n    }\n\n    fmt.Println(resp)\n}\n</code></pre>\n\n<p>and The output is:</p>\n\n<pre><code>{\n  Count: 2,\n  Items: [{\n      update_time: {\n        N: \"1466495096\"\n      },\n      create_time: {\n        N: \"1465655549\"\n      }\n    },{\n      update_time: {\n        N: \"1466503947\"\n      },\n      create_time: {\n        N: \"1466503947\"\n      }\n    }],\n  LastEvaluatedKey: {\n    Prim_key: {\n      S: \"1234567890\"\n    }\n  },\n  ScannedCount: 2\n}\n</code></pre>\n\n<p>Now, I want to retrieve the <code>update_time</code> value for all elements in above output. Here are my attempts:</p>\n\n<pre><code>for _, value := range resp.Items {\n    fmt.Println(value[\"create_time\"][\"N\"])\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>for _, value := range resp.Items {\n    fmt.Println(value.create_time.N)\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>for _, value := range resp.Items {\n    fmt.Println(*value.create_time.N)\n}\n</code></pre>\n\n<p>All above attempts error out with <code>/var/tmp/dynamo.go:37: invalid operation:</code> error.\nI am from perl/python background and recently started learning golang.</p>\n\n<p>How to retrieve nested map/array values in this case. Also, any reading references would be of great help. My google search did not reveal anything relevant.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 6790797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07a8cb28a1b08216d89756fec229e0e5?s=128&d=identicon&r=PG&f=1", "display_name": "ashvin patel", "link": "https://stackoverflow.com/users/6790797/ashvin-patel"}, "edited": false, "score": 1, "creation_date": 1472933976, "post_id": 39308100, "comment_id": 65954755, "body": "Got it.Thanks +1 :)"}, {"owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "reply_to_user": {"reputation": 21, "user_id": 6790797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07a8cb28a1b08216d89756fec229e0e5?s=128&d=identicon&r=PG&f=1", "display_name": "ashvin patel", "link": "https://stackoverflow.com/users/6790797/ashvin-patel"}, "edited": false, "score": 0, "creation_date": 1472937161, "post_id": 39308100, "comment_id": 65955568, "body": "@ashvinpatel If it helped you, do you mind accepting it as the correct answer?"}], "tags": [], "owner": {"reputation": 5278, "user_id": 3074508, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6bbb9b3baf8440bc7a00e3147378bcf2?s=128&d=identicon&r=PG", "display_name": "CESCO", "link": "https://stackoverflow.com/users/3074508/cesco"}, "is_accepted": false, "score": 3, "last_activity_date": 1472913483, "creation_date": 1472913483, "answer_id": 39308100, "question_id": 39307460, "link": "https://stackoverflow.com/questions/39307460/how-to-configure-glidefor-vendoring-packages-for-golang-in-windows/39308100#39308100", "title": "how to Configure glide(for vendoring packages) for golang in windows", "body": "<p>You can download the Window's glide binary from their Github <a href=\"https://github.com/Masterminds/glide/releases\" rel=\"nofollow\">releases page</a> and toss it under your path.</p>\n\n<p>But you can always build it from source if you already got go installed. </p>\n\n<ol>\n<li>Clone this repository into $GOPATH/src/github.com/Masterminds/glide and change directory into it</li>\n<li>If you are using Go 1.5 ensure the environment variable GO15VENDOREXPERIMENT is set, for example by running export GO15VENDOREXPERIMENT=1. In Go 1.6 it is enabled by default and in Go 1.7 it is always enabled without the ability to turn it off.</li>\n<li>go build -o glide -ldflags \"-X main.version=$(git describe --tags)\" glide.go</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 103, "user_id": 6144218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efe73e75f8815598b039d4a4221e6dd4?s=128&d=identicon&r=PG&f=1", "display_name": "Le Nguyen", "link": "https://stackoverflow.com/users/6144218/le-nguyen"}, "is_accepted": false, "score": 1, "last_activity_date": 1558428714, "creation_date": 1558428714, "answer_id": 56234584, "question_id": 39307460, "link": "https://stackoverflow.com/questions/39307460/how-to-configure-glidefor-vendoring-packages-for-golang-in-windows/56234584#56234584", "title": "how to Configure glide(for vendoring packages) for golang in windows", "body": "<p>thanks @CESCO, i update it a bit, on window 10 64bit, you need to use  glide-v0.12.3, after downloaded it, extract and copy 'glide' to @GOPATH/bin</p>\n"}], "owner": {"reputation": 21, "user_id": 6790797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07a8cb28a1b08216d89756fec229e0e5?s=128&d=identicon&r=PG&f=1", "display_name": "ashvin patel", "link": "https://stackoverflow.com/users/6790797/ashvin-patel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2676, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1558428714, "creation_date": 1472909384, "question_id": 39307460, "link": "https://stackoverflow.com/questions/39307460/how-to-configure-glidefor-vendoring-packages-for-golang-in-windows", "title": "how to Configure glide(for vendoring packages) for golang in windows", "body": "<p>After making the project in Mac, I just want to configure it in windows </p>\n\n<p>machine.For that how can i install glide in windows 8.1 for run go project.</p>\n\n<p>-Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1472864406, "post_id": 39302313, "comment_id": 65938664, "body": "Why do you create a new type for your <code>PlatformID</code> if it&#39;s just a string?"}, {"owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472864624, "post_id": 39302313, "comment_id": 65938701, "body": "I didn&#39;t write that part of code, if it were up to me, I will just leave it as string...I am told it comes from the industrial practice of C++ where you never use base type for ID."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 1, "creation_date": 1472879978, "post_id": 39302313, "comment_id": 65940725, "body": "The whole code seems unnecessary, if you unmarshal into a struct with fields of the correct types, instead of a map, there&#39;s nothing to convert."}], "answers": [{"tags": [], "owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "is_accepted": true, "score": 0, "last_activity_date": 1472907717, "last_edit_date": 1472907717, "creation_date": 1472864862, "answer_id": 39302375, "question_id": 39302313, "link": "https://stackoverflow.com/questions/39302313/how-to-convert-interface-to-custom-type/39302375#39302375", "title": "How to convert interface to custom type", "body": "<p>After playing around with the syntax a bit more, I think I need to do both type conversion and type assertion.</p>\n\n<p>So the following line solves the problem</p>\n\n<pre><code>return PlatformID(dict[\"platform-id\"].(string)), err\n</code></pre>\n\n<p>In retrospect, I need to first assert the interface type to a base type <code>string</code>, and from there I can just do a type conversion to <code>PlatformID</code></p>\n\n<p>PS 1: The use case is that I got the raw string in the request body, REST layer will parse out certain fields in a dictionary, then forward the rest of unparsed string to API layer for further processing. The keys in dictionary vary depends on workload, so I can't really Unmarshal it to a well defined struct.</p>\n"}, {"tags": [], "owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "is_accepted": false, "score": 1, "last_activity_date": 1472879584, "creation_date": 1472879584, "answer_id": 39303480, "question_id": 39302313, "link": "https://stackoverflow.com/questions/39302313/how-to-convert-interface-to-custom-type/39303480#39303480", "title": "How to convert interface to custom type", "body": "<p>After looking at <code>PlatformDictStr</code>, I think <code>var dictionary map[string]string</code> should do the job. \n<code>PlatformID(dict[\"platform-id\"].(string))</code> can be avoided in that case. Working example here\n<a href=\"https://play.golang.org/p/A5kiVm_XbP\" rel=\"nofollow\">https://play.golang.org/p/A5kiVm_XbP</a></p>\n"}, {"tags": [], "owner": {"reputation": 803, "user_id": 2507703, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d37dfbae59ca0ae7bb70b325dcb10b70?s=128&d=identicon&r=PG", "display_name": "R4chi7", "link": "https://stackoverflow.com/users/2507703/r4chi7"}, "is_accepted": false, "score": 0, "last_activity_date": 1472883981, "creation_date": 1472883981, "answer_id": 39303914, "question_id": 39302313, "link": "https://stackoverflow.com/questions/39302313/how-to-convert-interface-to-custom-type/39303914#39303914", "title": "How to convert interface to custom type", "body": "<p>Is there any specific reason for which you have created types for string and map? If not, I think you are over-engineering a simple use-case. The following works fine:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc Str2Map(str string) (map[string]interface{}, error) {\n    var dictionary map[string]interface{}\n    bytes := []byte(str)\n    err := json.Unmarshal(bytes, &amp;dictionary)\n    if err != nil {\n        fmt.Println(err)\n    }\n    return dictionary, err\n}\n\nfunc parsePlatformID(str string) (string, error) {\n    fmt.Println(str)\n    dict, err := Str2Map(str)\n    fmt.Println(dict)\n    return dict[\"platform-id\"].(string), err\n}\n\nfunc main() {\n    PlatformDictStr := \"{\\\"platform-id\\\":\\\"platform_BnjliXLEUV26\\\",\\\"platform-labels\\\":\\\"test\\\",\\\"OptimizeScheme\\\":\\\"None\\\"}\"\n\n    fmt.Println(PlatformDictStr)\n\n    ID, _ := parsePlatformID(PlatformDictStr)\n    fmt.Println(ID)\n}\n</code></pre>\n\n<p>Working Playground example: <a href=\"https://play.golang.org/p/mpPpDmiz7x\" rel=\"nofollow\">https://play.golang.org/p/mpPpDmiz7x</a></p>\n"}], "owner": {"reputation": 1069, "user_id": 3806343, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/tzFZo.png?s=128&g=1", "display_name": "cookieisaac", "link": "https://stackoverflow.com/users/3806343/cookieisaac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1858, "favorite_count": 0, "accepted_answer_id": 39302375, "answer_count": 3, "score": 0, "last_activity_date": 1560093523, "creation_date": 1472864024, "last_edit_date": 1560093523, "question_id": 39302313, "link": "https://stackoverflow.com/questions/39302313/how-to-convert-interface-to-custom-type", "title": "How to convert interface to custom type", "body": "<p>I am trying to parse out a specific field from a json string, and currently I have the following code snippet.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype PlatformID string\n\ntype Map map[string]interface{}\n\nfunc Str2Map(str string) (Map, error) {\n    var dictionary Map\n    bytes := []byte(str)\n    err := json.Unmarshal(bytes, &amp;dictionary)\n    if err != nil {\n        fmt.Println(err)\n    }\n    return dictionary, err\n}\n\nfunc parsePlatformID(str string) (PlatformID, error) {\n    fmt.Println(str)\n    dict, err := Str2Map(str)\n    fmt.Println(dict)\n    return dict[\"platform-id\"].(PlatformID), err\n}\n\nfunc main() {\n    PlatformDictStr := \"{\\\"platform-id\\\":\\\"platform_BnjliXLEUV26\\\",\\\"platform-labels\\\":\\\"test\\\",\\\"OptimizeScheme\\\":\\\"None\\\"}\"\n\n    fmt.Println(PlatformDictStr)\n\n    ID, _ := parsePlatformID(PlatformDictStr)\n    fmt.Println(ID)\n}\n</code></pre>\n\n<p>When I try to run it, it gives me the following error </p>\n\n<pre><code>{\"platform-id\":\"platform_BnjliXLEUV26\",\"platform-labels\":\"test\",\"OptimizeScheme\":\"None\"}\n{\"platform-id\":\"platform_BnjliXLEUV26\",\"platform-labels\":\"test\",\"OptimizeScheme\":\"None\"}\nmap[platform-id:platform_BnjliXLEUV26 platform-labels:test OptimizeScheme:None]\npanic: interface conversion: interface is string, not main.PlatformID\n\ngoroutine 1 [running]:\npanic(0x126aa0, 0x10532300)\n    /usr/local/go/src/runtime/panic.go:500 +0x720\nmain.parsePlatformID(0x13e6fe, 0x58, 0x0, 0x0, 0x0, 0x0)\n    /tmp/sandbox256874711/main.go:26 +0x220\nmain.main()\n    /tmp/sandbox256874711/main.go:34 +0x100\n</code></pre>\n\n<p>This <a href=\"https://stackoverflow.com/questions/19577423/how-to-cast-to-a-type-alias-in-go\">question</a> sort of answers why I got <code>panic: interface conversion: interface is string</code></p>\n\n<p>If I try to change the type assertion to <code>string</code>, the underlying type of PlatformID, it won't even compile <code>tmp/sandbox325023244/main.go:26: cannot use dict[\"platform-id\"].(string) (type string) as type PlatformID in return argument</code></p>\n\n<p>So how should I modify the <code>return</code> line so that I can retrieve PlatformID?</p>\n"}, {"tags": ["parsing", "go", "yacc", "shift-reduce-conflict"], "comments": [{"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472862956, "post_id": 39301979, "comment_id": 65938416, "body": "Are statements not separated by punctuation? IOW, if <code>(v) {v*2}</code> is not a lambda, what is it? A <code>stmt_list</code> or something else? Please add a bit more grammar to the question."}, {"owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472864042, "post_id": 39301979, "comment_id": 65938614, "body": "There are no semicolons between statements (they are actually comments, as in lisp. New lines are effectively end-of-statement indicators, as in Go or JavaScript."}, {"owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472864104, "post_id": 39301979, "comment_id": 65938624, "body": "This does pose some complexity in the grammar, as newlines may occur, for example in argument lists. Maybe this is what&#39;s getting me into trouble. I just know its complaining about the &#39;{&#39; right after its reduced the argument list as an expr."}, {"owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472864254, "post_id": 39301979, "comment_id": 65938641, "body": "I could post the entire grammar, but obviously it&#39;s long and hard to distill down to the root cause of the conflict."}, {"owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472866380, "post_id": 39301979, "comment_id": 65938914, "body": "Actually TBH I haven&#39;t tried writing a tiny grammar with this issue in isolation. That would help. I&#39;ll do that and probably have a lightbulb moment :)"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472866467, "post_id": 39301979, "comment_id": 65938928, "body": "It&#39;s pretty difficult to provide advice about how to fix a problem without actual details, so I&#39;m not going to try. You need to <i>at least</i> answer my direct question: if <code>(v){v*2}</code> is not a lambda, what is it? Or, if you prefer, what valid derivation can start <code>(v){...</code>? BTW, newlines are not end-of-statement indicators in Go and Javascript; semicolons are, and the grammar reflects that fact. The Go rules are simple enough to be implemented by the lexical scanner, which would be my recommendation. The JS rule is trickier. If your problem is really about ASI, please ask a different question :)"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472866543, "post_id": 39301979, "comment_id": 65938932, "body": "... So you might just start by writing the grammar without trying to deal with ASI or newlines; if that works, then the question is really how to perform the ASI."}, {"owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472876765, "post_id": 39301979, "comment_id": 65940279, "body": "Thanks @rici you&#39;re right, there&#39;s not enough info here to resolve this. I&#39;m gonna distill it down and rewrite the question. In response to your question &quot;then what is it?&quot;, the entire construct can only be a lambda. If new lines were not required between statements, however, the (v) would be the expr <code>v</code>, and the { v * 2 } would be a set. However they shouldn&#39;t be allowed side-by-side in the same expression like this. I&#39;ll distill it down with a smaller grammar and rewrite or delete this question, thanks :)"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472878225, "post_id": 39301979, "comment_id": 65940475, "body": "Cool. Sounds like your newline handling isn&#39;t wirking. I suggest you write the grammar as though statement separators were required and then figure out the best way to fabricate the tokens, which is my approach to parsing JS, for example."}, {"owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1472986663, "post_id": 39301979, "comment_id": 65964463, "body": "@rici I&#39;ve updated my question with a minimal problem grammar. I&#39;ve also removed ASI handling from the equation and just focusing on a single line of input."}], "answers": [{"comments": [{"owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "edited": false, "score": 0, "creation_date": 1473025669, "post_id": 39319659, "comment_id": 65975553, "body": "Great answer @rici, thanks. The parameters in my functions are valid exprs as the language is pattern matched and the patterns are entirely arbitrary. Both the solutions you suggest are up for consideration. What I&#39;m actually thinking at this point (as it&#39;s easy for the lexer to spot) is to define an imaginary token <code>PARAMS</code> and emit that right before the &#39;)&#39; if followed by &#39;{&#39;. Then the grammar just needs to expect <code>&#39;(&#39; params PARAMS &#39;)&#39;</code>, where that PARAMS token is just some virtual sentinel that the lexer spits out."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "reply_to_user": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "edited": false, "score": 0, "creation_date": 1473026167, "post_id": 39319659, "comment_id": 65975678, "body": "@d11wtq: Yes, you could insert a fake token. Or you could change the <code>)</code> to <code>CLOSE_PARAMS</code>. Or you could combine the two tokens into one. I&#39;ve used the latter two strategies; the first one seems like unnecessary overhead to me, since it doesn&#39;t do anything to simplify either the grammar or the lexer. Either way, the lexer needs to read ahead after it sees a <code>)</code>. The combined token solution is the easiest if your parser pulls tokens from the lexer; if the lexer pushes tokens to the parser, then there is little difference in lexer complexity (but I don&#39;t think go yacc supports that)."}], "tags": [], "owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "is_accepted": true, "score": 3, "last_activity_date": 1473025777, "last_edit_date": 1473025777, "creation_date": 1473010367, "answer_id": 39319659, "question_id": 39301979, "link": "https://stackoverflow.com/questions/39301979/yacc-shift-reduce-for-ambiguous-lambda-syntax/39319659#39319659", "title": "yacc shift-reduce for ambiguous lambda syntax", "body": "<p>Your analysis is indeed correct; although the grammar is not ambiguous, it is impossible for the parser to decide with the input reduced to <code>( &lt;expr&gt;</code> and with lookahead <code>)</code> whether or not the <code>expr</code> should be reduced to <code>params</code> before shifting the <code>)</code> or whether the <code>)</code> should be shifted as part of a <code>lambda</code>. If the next token were visible, the decision could be made, so the grammar LR(2), which is outside of the competence of go/yacc.</p>\n\n<p>If you were using bison, you could easily solve this problem by requesting a GLR parser, but I don't believe that go/yacc provides that feature.</p>\n\n<p>There is an LR(1) grammar for the language (there is always an LR(1) grammar corresponding to any LR(k) grammar for any value of <code>k</code>) but it is rather annoying to write by hand. The essential idea of the LR(k) to LR(1) transformation is to shift the reduction decisions k-1 tokens forward by accumulating k-1 tokens of context into each production. So in the case that <code>k</code> is 2, each production P: <code>N &rarr; &alpha;</code> will be replaced with productions <code><sup>T</sup>N<sup>U</sup> &rarr; <sup>T</sup>&alpha; U</code> for each <code>T</code> in <code>FIRST(&alpha;)</code> and each <code>U</code> in <code>FOLLOW(N)</code>. [See Note 1] That leads to a considerable blow-up of non-terminals in any non-trivial grammar.</p>\n\n<p>Rather than pursuing that idea, let me propose two much simpler solutions, both of which you seem to be quite close to.</p>\n\n<p>First, in the grammar you present, the issue really is simply the need for a two-token lookahead when the two tokens are <kbd>)</kbd><kbd>{</kbd>. That could easily be detected in the lexer, and leads to a solution which is still hacky but a simpler hack: Return <code>){</code> as a single token. You need to deal with intervening whitespace, etc., but it doesn't require retaining any context in the lexer. This has the added bonus that you don't need to define <code>params</code> as a list of <code>expr</code>s; they can just be a list of <code>IDENT</code> (if that's relevant; a comment suggests that it isn't).</p>\n\n<p>The alternative, which I think is a bit cleaner, is to extend the solution you already seem to be proposing: accept a little too much and reject the errors in a semantic action. In this case, you might do something like:</p>\n\n<pre><code>start:\n  stmt_list\n\nexpr:\n    INT\n  | IDENT\n  | lambda\n  | '(' expr_list ')'\n        { // If $2 has more than one expr, report error\n          $$ = $2\n        }\n\nlambda:\n  '(' expr_list ')' '{' stmt_list '}'\n        { // If anything in expr_list is not a valid param, report error\n          $$ = make_lambda($2, $4)\n        }\n\nexpr_list:\n  expr | expr_list ',' expr\n\nstmt:\n  /* empty */ | expr\n\nstmt_list:\n  stmt | stmt_list ';' stmt\n</code></pre>\n\n<h3>Notes</h3>\n\n<ol>\n<li>That's only an outline; the complete algorithm includes the mechanism to recover the original parse tree. If <code>k</code> is greater than 2 then <code>T</code> and <code>U</code> are strings the the <code>FIRST<sub>k-1</sub></code> and <code>FOLLOW<sub>k-1</sub></code> sets.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1473039717, "post_id": 39322206, "comment_id": 65977948, "body": "I don&#39;t see how shift/reduce preference can help here. The grammar is LR(2); sometimes a shift is necessary and sometimes a reduce. So the solution is to use a GLR (or LALR(2)) parser, or rewrite the grammar so that it&#39;s LR(1), or abuse the lexer, or accept a superset and throw an error in the action. The first option is apparently unavailable for Go; the second one is a pain, and therefore the fourth one is my preference; I say so in my answer. But option 3 is possible, too, and a not uncommon solution to LR(2) grammars. (Bison does it, for example, to parse its own input.)"}, {"owner": {"reputation": 88411, "user_id": 120163, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/OPDmg.jpg?s=128&g=1", "display_name": "Ira Baxter", "link": "https://stackoverflow.com/users/120163/ira-baxter"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1473044487, "post_id": 39322206, "comment_id": 65978706, "body": "If it really is LR(2) with sometimes-shift, sometimes-reduce, then my solution doesn&#39;t apply.  I took OP&#39;s word that he had a (simple) shift-reduce conflict.   The semantic reduction predicate may help even if it is LR(2), if the lexer is willing to read ahead several tokens (required by LR(2) anyway).  For the example grammar given, it appears that a &quot;prefer to shift on {&quot; resolves the problem.  What am I missing?"}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1473046094, "post_id": 39322206, "comment_id": 65979016, "body": "By the time you see <code>{</code>, it&#39;s too late to shift because you don&#39;t have <code>( params )</code> on the stack. You have <code>( expr )</code>. The decision to shift or reduce which creates the conflict was with respect to the <code>)</code>; since the default is to shift, you&#39;re guaranteed to have <code>( expr )</code>, but that cannot be followed by <code>{</code>. In order to create the conditions for accepting <code>{</code>, you need to have reduced <code>expr</code> to <code>params</code> prior to shifting the <code>)</code>. To make that shift/reduce decision (about the <code>)</code>), you need to know what follows the <code>)</code> -- two tokens of lookahead. Neither shift nor reduce is always right."}, {"owner": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 1, "creation_date": 1473046350, "post_id": 39322206, "comment_id": 65979065, "body": "You could fix that by manipulating the grammar; it&#39;s not <i>that</i> difficult, but it&#39;s not pretty. OTOH, allowing <code>expr: &#39;(&#39; params &#39;)&#39;</code> and then checking in the semantic actcion that <code>params</code> never used the  <code>params: params &#39;,&#39; expr</code> production is pretty straightforward, and avoids the question of deciding whether or not to reduce <code>params: expr</code> before the <code>)</code>."}, {"owner": {"reputation": 88411, "user_id": 120163, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/OPDmg.jpg?s=128&g=1", "display_name": "Ira Baxter", "link": "https://stackoverflow.com/users/120163/ira-baxter"}, "reply_to_user": {"reputation": 199706, "user_id": 1566221, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ce3ea4ffd1023d4382f397312352726d?s=128&d=identicon&r=PG", "display_name": "rici", "link": "https://stackoverflow.com/users/1566221/rici"}, "edited": false, "score": 0, "creation_date": 1473058453, "post_id": 39322206, "comment_id": 65982058, "body": "Ah, I missed the reduction to expr. OK,my solution doesn&#39;t work.  I like your &#39;(&#39; params &#39;)&#39; as expr with semantic check.   I&#39;m leaving my answer because it is useful for resolving some situations. Upvotes not expected."}], "tags": [], "owner": {"reputation": 88411, "user_id": 120163, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/OPDmg.jpg?s=128&g=1", "display_name": "Ira Baxter", "link": "https://stackoverflow.com/users/120163/ira-baxter"}, "is_accepted": false, "score": 0, "last_activity_date": 1473030577, "last_edit_date": 1473030577, "creation_date": 1473030234, "answer_id": 39322206, "question_id": 39301979, "link": "https://stackoverflow.com/questions/39301979/yacc-shift-reduce-for-ambiguous-lambda-syntax/39322206#39322206", "title": "yacc shift-reduce for ambiguous lambda syntax", "body": "<p>If it really is a shift-reduce conflict, and you want only the shift behavior, your parser generator may give you a way to prefer a shift vs. a reduce.  This is classically how the conflict for grammar rules for \"if-then-stmt\" and \"if-then-stmt-else-stmt\" is resolved, when the if statement can also be a statement.</p>\n\n<p>See <a href=\"http://www.gnu.org/software/bison/manual/html_node/Shift_002fReduce.html\" rel=\"nofollow\">http://www.gnu.org/software/bison/manual/html_node/Shift_002fReduce.html</a></p>\n\n<p>You can get this effect two ways:\na)  Count on the accidental behavior of the parsing engine.\n   If an LALR parser handles shifts first, and then reductions if there are no shifts, then you'll get this \"prefer shift\" for free.   All the parser generator has to do is built the parse tables anyway, even if there is a detected conflict.\nb)  Enforce the accidental behavior.   Design (or a get a) parser generator to accept \"prefer shift on token T\".  Then one can supress the ambiguity.  One still have to implement the parsing engine as in a) but that's pretty easy.</p>\n\n<p>I think this is easier/cleaner than abusing the lexer to make strange tokens (and that doesn't always work anyway).</p>\n\n<p>Obviously, you could make a preference for reductions to turn it the other way.  With some extra hacking, you could make shift-vs-reduce specific the state in which the conflict occured; you can even make it specific to the pair of conflicting rules but now the parsing engine needs to keep preference data around for nonterminals.  That still isn't hard.   Finally, you could add a predicate for each nonterminal which is called when a shift-reduce conflict is about to occur, and it have it provide a decision.</p>\n\n<p>The point is you don't have to accept \"pure\" LALR parsing; you can bend it easily in a variety of ways, if you are willing to modify the parser generator/engine a little bit.    This gives a really good reason to understand how these tools work; then you can abuse them to your benefit.</p>\n"}], "owner": {"reputation": 33152, "user_id": 322122, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/f855324f298eb7708e39ea117477cbd5?s=128&d=identicon&r=PG", "display_name": "d11wtq", "link": "https://stackoverflow.com/users/322122/d11wtq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 652, "favorite_count": 1, "accepted_answer_id": 39319659, "answer_count": 2, "score": 2, "last_activity_date": 1473030577, "creation_date": 1472860319, "last_edit_date": 1472988063, "question_id": 39301979, "link": "https://stackoverflow.com/questions/39301979/yacc-shift-reduce-for-ambiguous-lambda-syntax", "title": "yacc shift-reduce for ambiguous lambda syntax", "body": "<p>I'm writing a grammar for a toy language in Yacc (the one packaged with Go) and I have an expected shift-reduce conflict due to the following pseudo-issue. I have to distilled the problem grammar down to the following.</p>\n\n<pre><code>start:\n  stmt_list\n\nexpr:\n  INT | IDENT | lambda | '(' expr ')' { $$ = $2 }\n\nlambda:\n  '(' params ')' '{' stmt_list '}'\n\nparams:\n  expr | params ',' expr\n\nstmt:\n  /* empty */ | expr\n\nstmt_list:\n  stmt | stmt_list ';' stmt\n</code></pre>\n\n<p>A lambda function looks something like this:</p>\n\n<pre><code>map((v) { v * 2 }, collection)\n</code></pre>\n\n<p>My parser emits:</p>\n\n<blockquote>\n  <p>conflicts: 1 shift/reduce</p>\n</blockquote>\n\n<p>Given the input:</p>\n\n<pre><code>(a)\n</code></pre>\n\n<p>It correctly parses an <code>expr</code> by the <code>'(' expr ')'</code> rule. However given an input of:</p>\n\n<pre><code>(a) { a }\n</code></pre>\n\n<p>(Which would be a lambda for the identity function, returning its input). I get:</p>\n\n<blockquote>\n  <p>syntax error: unexpected '{'</p>\n</blockquote>\n\n<p>This is because when <code>(a)</code> is read, the parser is choosing to reduce it as <code>'(' expr ')'</code>, rather than consider it to be <code>'(' params ')'</code>. Given this conflict is a shift-reduce and not a reduce-reduce, I'm assuming this is solvable. I just don't know how to structure the grammar to support this syntax.</p>\n\n<p>EDIT | It's ugly, but I'm considering defining a token so that the lexer can recognize the ')' '{' sequence and send it through as a single token to resolve this.</p>\n\n<p>EDIT 2 | Actually, better still, I'll make lambdas require syntax like <code>-&gt;(a, b) { a * b}</code> in the grammar, but have the lexer emit the <code>-&gt;</code> rather than it being in the actual source code.</p>\n"}, {"tags": ["windows", "go", "vendor", "gopath"], "comments": [{"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472859910, "post_id": 39301930, "comment_id": 65937863, "body": "You were quick, but I just realised I forgot it and added it before I saw your comment. go1.7"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472860127, "post_id": 39301930, "comment_id": 65937908, "body": "And where exactly is your <code>main.go</code>?"}, {"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472860261, "post_id": 39301930, "comment_id": 65937939, "body": "<code>$GOPATH&#47;src&#47;main.go</code> and <code>$GOPATH&#47;src&#47;vendor&#47;</code>... This exact same <code>vendor</code> dir works when I mount the exact same directory in Docker."}, {"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1472860371, "post_id": 39301930, "comment_id": 65937966, "body": "To be clear: <code>cd C:\\Users\\js\\dev\\my_project\\rest\\src` then </code>set GOPATH=C:\\Users\\js\\dev\\my_project\\rest\\src\\;C:\\Users\\js\\dev\\&zwnj;&#8203;go` after that I do <code>go run main.go</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472861290, "post_id": 39301930, "comment_id": 65938145, "body": "Don&#39;t use <code>go run</code>, and make sure you go source is in a directory in GOPATH. There&#39;s also not much point in putting the vendor outside your project directory, since the idea is you vendor the dependencies for your project."}, {"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1472861469, "post_id": 39301930, "comment_id": 65938168, "body": "Why shouldn&#39;t I use <code>go run</code>? Also <code>go build</code> gives the same issue. And as I state my source is in <code>GOPATH</code>, under <code>$GOPATH&#47;src&#47;</code> specifically."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472863807, "post_id": 39301930, "comment_id": 65938581, "body": "<code>go run</code> operates on single files, not packages, so it&#39;s a common point of confusion around GOPATH issues. Your main.go is not in an import directory. You shouldn&#39;t have any source files in GOPATH/src"}], "answers": [{"comments": [{"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1472861365, "post_id": 39302047, "comment_id": 65938155, "body": "Sorry I had made a typo when writing the example of what I am writing. This does not work either, it never checks the vendor directory. I had set the path like you suggest all along... In my example I accidentally added <code>src&#47;</code> at the end"}], "tags": [], "owner": {"reputation": 905, "user_id": 3781709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd4fa60c6b287ee4f006d6c4e320daf5?s=128&d=identicon&r=PG", "display_name": "Pradip Patil", "link": "https://stackoverflow.com/users/3781709/pradip-patil"}, "is_accepted": false, "score": 1, "last_activity_date": 1472861038, "creation_date": 1472861038, "answer_id": 39302047, "question_id": 39301930, "link": "https://stackoverflow.com/questions/39301930/go-ignoring-vendor-directory/39302047#39302047", "title": "go ignoring vendor directory", "body": "<p>Seems your <code>GOPATH</code> is incorrect?\nThe <code>GOPATH</code> should specify the location of your workspace i.e. directory containing <code>src</code>, <code>pkg</code> and <code>bin</code> directories at its root.</p>\n\n<p>Try doing</p>\n\n<blockquote>\n  <p>set GOPATH=C:\\Users\\js\\dev\\my_project\\rest\\;c:\\Users\\js\\dev\\go</p>\n</blockquote>\n\n<p>More details at: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">https://golang.org/doc/code.html</a></p>\n"}, {"comments": [{"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1472861828, "post_id": 39302104, "comment_id": 65938218, "body": "This does not help with my problem however. I have done <code>go get</code> and <code>godep save</code>. The dependencies are there in the <code>vendor&#47;</code> directory. Everything works fine with this setup if I run inside of my Docker, it uses the dependencies in the <code>vendor&#47;</code> directory. But if I instead run it on Windows, exact same directory and files, it doesn&#39;t look in <code>vendor&#47;</code>"}, {"owner": {"reputation": 3010, "user_id": 519557, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/x9V4f.jpg?s=128&g=1", "display_name": "jxstanford", "link": "https://stackoverflow.com/users/519557/jxstanford"}, "reply_to_user": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1472862027, "post_id": 39302104, "comment_id": 65938256, "body": "Did you try setting GO15VENDOREXPERIMENT=1 in your environment explicitly?  You shouldn&#39;t have to, but it&#39;s not impossibly that you hit a bug, and might be worth a quick try."}, {"owner": {"reputation": 3010, "user_id": 519557, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/x9V4f.jpg?s=128&g=1", "display_name": "jxstanford", "link": "https://stackoverflow.com/users/519557/jxstanford"}, "reply_to_user": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1472862177, "post_id": 39302104, "comment_id": 65938285, "body": "You should also ensure that your version of <code>godep</code> is up to date.  I have <code>godep v74 (darwin&#47;amd64&#47;go1.7)</code>.  I ran into some trouble when I had an outdated <code>godep</code>."}, {"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1472862182, "post_id": 39302104, "comment_id": 65938287, "body": "Yes I actually tried that already. And I retried it now, but no help. (In regards to using GO15VENDOREXPERIMENT=1)"}, {"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1472862420, "post_id": 39302104, "comment_id": 65938329, "body": "Ok, but I shouldn&#39;t need godep at all should I? It is just there as a help. As I understand it, I could manually create a <code>vendor&#47;</code> dir and copy stuff there myself (I haven&#39;t, but that should work)"}, {"owner": {"reputation": 3010, "user_id": 519557, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/x9V4f.jpg?s=128&g=1", "display_name": "jxstanford", "link": "https://stackoverflow.com/users/519557/jxstanford"}, "reply_to_user": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1472862539, "post_id": 39302104, "comment_id": 65938351, "body": "I&#39;m not sure about that. For what it&#39;s worth, I generally create a binary for each platform I&#39;m interested in and execute it (rather than using <code>go run</code>).  Something like:  <code>env GOOS=darwin GOARCH=amd64 CGO_ENABLED=0 go build -o bin&#47;$(BINNAME).darwin</code> for mac and <code>env GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o bin&#47;$(BINNAME).linux</code>.  Hopefully this isn&#39;t making you chase your tail around :-)"}, {"owner": {"reputation": 3010, "user_id": 519557, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/x9V4f.jpg?s=128&g=1", "display_name": "jxstanford", "link": "https://stackoverflow.com/users/519557/jxstanford"}, "reply_to_user": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1472862694, "post_id": 39302104, "comment_id": 65938370, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/122552/discussion-between-jxstanford-and-joakim\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 3010, "user_id": 519557, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/x9V4f.jpg?s=128&g=1", "display_name": "jxstanford", "link": "https://stackoverflow.com/users/519557/jxstanford"}, "is_accepted": false, "score": 0, "last_activity_date": 1472861620, "creation_date": 1472861620, "answer_id": 39302104, "question_id": 39301930, "link": "https://stackoverflow.com/questions/39301930/go-ignoring-vendor-directory/39302104#39302104", "title": "go ignoring vendor directory", "body": "<p>The first thing to understand is that <code>godep save</code> is simply copying dependencies from your <code>$GOPATH</code> to a <code>vendor</code> directory inside your project. </p>\n\n<p>You will have to <code>go get</code> your dependencies first. After you have them in <code>$GOPATH</code>, you can do a <code>godep save</code> to copy the current version to your project, and be assured that even if the version in <code>$GOPATH</code> changes, you will have a fixed version in your project until you explicitly change it  via <code>godep</code>.</p>\n\n<p>So, if I have a $GOPATH of <code>/home/me/go_workspace</code>, and a project called <code>$GOPATH/src/github.com/project_x</code> with a dependency of <code>github.com/you/xyz</code>, then I would do <code>go get github.com/you/xyz</code>, and <code>godep save</code> from within my project directory.  This would create a <code>vendor</code> folder with the dependency at its current commit inside. </p>\n"}, {"tags": [], "owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "is_accepted": true, "score": 4, "last_activity_date": 1473283394, "creation_date": 1473283394, "answer_id": 39379211, "question_id": 39301930, "link": "https://stackoverflow.com/questions/39301930/go-ignoring-vendor-directory/39379211#39379211", "title": "go ignoring vendor directory", "body": "<p>The reason this did not work is because you are not supposed to put any code directly into the <code>$GOPATH/src/</code> directory.</p>\n\n<p>The solution is to put your project into a sub-directory like so:</p>\n\n<p><code>$GOPATH/src/app/*.go</code></p>\n"}], "owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3301, "favorite_count": 2, "accepted_answer_id": 39379211, "answer_count": 3, "score": 3, "last_activity_date": 1473283394, "creation_date": 1472859763, "last_edit_date": 1472861310, "question_id": 39301930, "link": "https://stackoverflow.com/questions/39301930/go-ignoring-vendor-directory", "title": "go ignoring vendor directory", "body": "<p>Everything I read about the vendor directory gives me the understanding that if I have a directory:</p>\n\n<pre><code>$GOPATH/src/vendor\n</code></pre>\n\n<p>And put my dependencies in there (I am using godeps), when doing <code>go run</code>, go should check in that directory first.</p>\n\n<p>If I run my code in a Docker image I have, this works fine. However now that I try to run the same code on my Windows machine, go simply ignores the <code>vendor/</code> directory, and fails to find the dependencies.</p>\n\n<p>What am I doing wrong?</p>\n\n<pre><code>main.go:7:2: cannot find package \"gopkg.in/alecthomas/kingpin.v2\" in any of:\n        C:\\Go\\src\\gopkg.in\\alecthomas\\kingpin.v2 (from $GOROOT)\n        C:\\Users\\js\\dev\\my_project\\rest\\src\\gopkg.in\\alecthomas\\kingpin.v2 (from $GOPATH)\n        C:\\Users\\js\\dev\\go\\src\\gopkg.in\\alecthomas\\kingpin.v2\n</code></pre>\n\n<p>Is the output when I try to do:</p>\n\n<pre><code>go run main.go\n</code></pre>\n\n<p>A directory <code>vendor/</code> exists in this directory.</p>\n\n<pre><code>go version go1.7 windows/amd64\n</code></pre>\n\n<hr>\n\n<p>The exact commands I run (in windows cmd.exe)</p>\n\n<pre><code>&gt; cd C:\\Users\\js\\dev\\my_project\\rest\\\n&gt; set GOPATH=C:\\Users\\js\\dev\\my_project\\rest\\;c:\\Users\\js\\dev\\go\n\n&gt; cd src\n&gt; dir\n...\n2016-09-01  23:20             2\u00a0923 main.go\n...\n2016-09-03  01:27    &lt;DIR&gt;          vendor\n\n&gt; go run main.go\n</code></pre>\n"}, {"tags": ["amazon-web-services", "nginx", "go"], "answers": [{"comments": [{"owner": {"reputation": 372, "user_id": 1214879, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/HTNHK.jpg?s=128&g=1", "display_name": "j boschiero", "link": "https://stackoverflow.com/users/1214879/j-boschiero"}, "edited": false, "score": 0, "creation_date": 1473194322, "post_id": 39303027, "comment_id": 66044804, "body": "That works but feels like a bandage rather than a solution. I&#39;d be a lot happier addressing the root cause instead of having to tack on another line of code everywhere I grab variables out of the URL."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 2, "last_activity_date": 1472874165, "creation_date": 1472874165, "answer_id": 39303027, "question_id": 39301624, "link": "https://stackoverflow.com/questions/39301624/golang-app-on-elastic-beanstalk-seems-to-be-receiving-double-encoded-requests/39303027#39303027", "title": "Golang app on elastic beanstalk seems to be receiving double encoded requests", "body": "<p>You may use <code>func QueryUnescape(s string) (string, error)</code> from \"net/url\" package:</p>\n\n<p><a href=\"https://golang.org/pkg/net/url/#QueryUnescape\" rel=\"nofollow\">QueryUnescape</a>:</p>\n\n<blockquote>\n  <p>QueryUnescape does the inverse transformation of QueryEscape,\n  converting %AB into the byte 0xAB and '+' into ' ' (space). It returns\n  an error if any % is not followed by two hexadecimal digits.</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc main() {\n    s, err := url.QueryUnescape(\"super%20duper\")\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(s) // super duper\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>super duper\n</code></pre>\n"}], "owner": {"reputation": 372, "user_id": 1214879, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/HTNHK.jpg?s=128&g=1", "display_name": "j boschiero", "link": "https://stackoverflow.com/users/1214879/j-boschiero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472874566, "creation_date": 1472856769, "last_edit_date": 1472874566, "question_id": 39301624, "link": "https://stackoverflow.com/questions/39301624/golang-app-on-elastic-beanstalk-seems-to-be-receiving-double-encoded-requests", "title": "Golang app on elastic beanstalk seems to be receiving double encoded requests", "body": "<p>I'm using <code>gorilla/mux</code> inside a Golang application to retrieve variables out of my routes, like so:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n  router := mux.NewRouter()\n  router.HandleFunc(\"/items/{name}\", itemHandler)\n  log.Fatal(http.ListenAndServe(\":5000\", router)\n}\n\nfunc itemHandler(w http.ResponsWriter, r *http.Request) {\n  name := mux.Vars(r)[\"name\"]\n  fmt.Println(\"name is: \", name)\n}\n</code></pre>\n\n<p>If I navigate to <code>/items/super%20duper</code> on my local VM the console output is <code>name is: super duper</code>, as I would expect. But when I run this on our Elastic Beanstalk instance and go to the same URL the console output is <code>name is: super%20duper</code>. </p>\n\n<p>We tried changing the <code>proxy_pass</code> entry in the nginx config thinking maybe nginx was not passing the request URI exactly as received, but that had no effect. </p>\n\n<p>If anyone else has seen the same issue I would love to know how you solved it.</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 1889, "user_id": 743717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/db21cacbe8174f2ca01cce29ce3a7449?s=128&d=identicon&r=PG", "display_name": "Alexei Danchenkov", "link": "https://stackoverflow.com/users/743717/alexei-danchenkov"}, "edited": false, "score": 2, "creation_date": 1472845863, "post_id": 39299711, "comment_id": 65933599, "body": "From what I can see your concurrent algorithm is not &#39;concurrent&#39;. The essential part of the algorithm \u2014 <code>callFact</code> func \u2014 is a regular recursive function. You are not even caching values already calculated."}, {"owner": {"reputation": 11, "user_id": 5914933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d3f0e73d6186a081fe7c7fdfab41fb7?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis John", "link": "https://stackoverflow.com/users/5914933/dennis-john"}, "reply_to_user": {"reputation": 1889, "user_id": 743717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/db21cacbe8174f2ca01cce29ce3a7449?s=128&d=identicon&r=PG", "display_name": "Alexei Danchenkov", "link": "https://stackoverflow.com/users/743717/alexei-danchenkov"}, "edited": false, "score": 0, "creation_date": 1472846401, "post_id": 39299711, "comment_id": 65933798, "body": "The callFact() recursive function is running on its own Go Routine."}, {"owner": {"reputation": 1889, "user_id": 743717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/db21cacbe8174f2ca01cce29ce3a7449?s=128&d=identicon&r=PG", "display_name": "Alexei Danchenkov", "link": "https://stackoverflow.com/users/743717/alexei-danchenkov"}, "edited": false, "score": 0, "creation_date": 1472854589, "post_id": 39299711, "comment_id": 65936639, "body": "That&#39;s correct, but how then your current concurrency model speeds up the process? As @abhink pointed out, think about splitting the input for your concurrent funcs."}, {"owner": {"reputation": 11, "user_id": 5914933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d3f0e73d6186a081fe7c7fdfab41fb7?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis John", "link": "https://stackoverflow.com/users/5914933/dennis-john"}, "reply_to_user": {"reputation": 1889, "user_id": 743717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/db21cacbe8174f2ca01cce29ce3a7449?s=128&d=identicon&r=PG", "display_name": "Alexei Danchenkov", "link": "https://stackoverflow.com/users/743717/alexei-danchenkov"}, "edited": false, "score": 0, "creation_date": 1472868336, "post_id": 39299711, "comment_id": 65939164, "body": "Thanks you for your input."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 5914933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d3f0e73d6186a081fe7c7fdfab41fb7?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis John", "link": "https://stackoverflow.com/users/5914933/dennis-john"}, "edited": false, "score": 0, "creation_date": 1472868389, "post_id": 39300241, "comment_id": 65939175, "body": "Thank you abhink for you input."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 3, "last_activity_date": 1472848038, "creation_date": 1472848038, "answer_id": 39300241, "question_id": 39299711, "link": "https://stackoverflow.com/questions/39299711/golang-sequential-vs-concurrent/39300241#39300241", "title": "GoLang - Sequential vs Concurrent", "body": "<p>Concurrent version of your program will always be slow compared to the sequential version. The reason however, is related to the nature and behavior of problem you are trying to solve.</p>\n\n<p>Your program is concurrent but it is not parallel. Each <code>callFact</code> is running in it's own goroutine but there is no division of the amount of work required to be done. Each goroutine must perform the same computation and output the same value.</p>\n\n<p>It is like having a task that requires some text to be copied a hundred times. You have just one CPU (ignore the cores for now).</p>\n\n<p>When you start a sequential process, you point the CPU to the original text once, and ask it to write it down a 100 times. The CPU has to manage a single task.</p>\n\n<p>With goroutines, the CPU is told that there are a hundred tasks that must be done concurrently. It just so happens that they are all the same tasks. But CPU is not smart enough to know that.</p>\n\n<p>So it does the same thing as above. Even though each task now is a 100 times smaller, there is still just one CPU. So the amount of work CPU has to do is still the same, except with all the added overhead of managing 100 different things at once. Hence, it looses a part of its efficiency.</p>\n\n<p>To see an improvement in performance you'll need proper parallelism. A simple example would be to split the factorial input number roughly in the middle and compute 2 smaller factorials. Then combine them together:</p>\n\n<pre><code>// not an ideal solution\n\nfunc main() {\n    ch := make(chan int)\n    r := 10\n    result := 1\n    go fact(r, ch)\n    for i := range ch {\n        result *= i\n    }\n    fmt.Println(result)\n}\n\nfunc fact(n int, ch chan int) {\n    p := n/2\n    q := p + 1\n    var wg sync.WaitGroup\n    wg.Add(2)\n    go func() {\n        ch &lt;- factPQ(1, p)\n        wg.Done()\n    }()\n    go func() {\n        ch &lt;- factPQ(q, n)\n        wg.Done()\n    }()\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n}\n\nfunc factPQ(p, q int) int {\n    r := 1\n    for i := p; i &lt;= q; i++ {\n        r *= i\n    }\n    return r\n}\n</code></pre>\n\n<p>Working code: <a href=\"https://play.golang.org/p/xLHAaoly8H\" rel=\"nofollow\">https://play.golang.org/p/xLHAaoly8H</a></p>\n\n<p>Now you have two goroutines working towards the same goal and not just repeating the same calculations.</p>\n\n<p><em>Note about CPU cores:</em></p>\n\n<p>In your original code, the sequential version's operations are most definitely being distributed amongst various CPU cores by the runtime environment and the OS. So it still has parallelism to a degree, you just don't controll it.</p>\n\n<p>The same is happening in the concurrent version but again as mentioned above, the overhead of goroutine context switching makes the performance come down.</p>\n"}, {"tags": [], "owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "is_accepted": false, "score": 0, "last_activity_date": 1472980864, "creation_date": 1472980864, "answer_id": 39315410, "question_id": 39299711, "link": "https://stackoverflow.com/questions/39299711/golang-sequential-vs-concurrent/39315410#39315410", "title": "GoLang - Sequential vs Concurrent", "body": "<p>abhink has given a good answer. I would also like to draw attention to <a href=\"https://en.wikipedia.org/wiki/Amdahl%27s_law\" rel=\"nofollow\">Amdahl's Law</a>, which should always be borne in mind when trying to use parallel processing to increase the overall speed of computation. That's <em>not</em> to say \"don't make things parallel\", but rather: be realistic about expectations and understand the parallel architecture fully.</p>\n\n<p>Go allows us to write concurrent programs. This is related to trying to write faster parallel programs, but the two issues are separate. See Rob Pike's <a href=\"https://blog.golang.org/concurrency-is-not-parallelism\" rel=\"nofollow\">Concurrency is not Parallelism</a> for more info.</p>\n"}], "owner": {"reputation": 11, "user_id": 5914933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d3f0e73d6186a081fe7c7fdfab41fb7?s=128&d=identicon&r=PG&f=1", "display_name": "Dennis John", "link": "https://stackoverflow.com/users/5914933/dennis-john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1064, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1472980864, "creation_date": 1472845477, "question_id": 39299711, "link": "https://stackoverflow.com/questions/39299711/golang-sequential-vs-concurrent", "title": "GoLang - Sequential vs Concurrent", "body": "<p>I have two versions of factorial.  Concurrent vs Sequencial. </p>\n\n<p>Both the program will calculate factorial of 10 \"1000000\" times.</p>\n\n<h2>Factorial Concurrent Processing</h2>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    //\"math/rand\"\n    \"sync\"\n    \"time\"\n    //\"runtime\"\n)\n\nfunc main() {\n    start := time.Now()\n    printFact(fact(gen(1000000)))\n    fmt.Println(\"Current Time:\", time.Now(), \"Start Time:\", start, \"Elapsed Time:\", time.Since(start))\n    panic(\"Error Stack!\")\n}\n\nfunc gen(n int) &lt;-chan int {\n    c := make(chan int)\n    go func() {\n        for i := 0; i &lt; n; i++ {\n            //c &lt;- rand.Intn(10) + 1\n            c &lt;- 10\n        }\n        close(c)\n    }()\n    return c\n}\n\nfunc fact(in &lt;-chan int) &lt;-chan int {\n    out := make(chan int)\n    var wg sync.WaitGroup\n    for n := range in {\n        wg.Add(1)\n        go func(n int) {\n            //temp := 1\n            //for i := n; i &gt; 0; i-- {\n            //  temp *= i\n            //}\n            temp := calcFact(n)\n            out &lt;- temp\n            wg.Done()\n        }(n)\n    }\n    go func() {\n        wg.Wait()\n        close(out)\n    }()\n    return out\n}\n\nfunc printFact(in &lt;-chan int) {\n    //for n := range in {\n    //  fmt.Println(\"The random Factorial is:\", n)\n    //}\n    var i int\n    for range in {\n        i ++\n    }\n    fmt.Println(\"Count:\" , i)\n}\n\nfunc calcFact(c int) int {\n    if c == 0 {\n        return 1\n    } else {\n        return calcFact(c-1) * c\n    }\n}\n\n//###End of Factorial Concurrent \n</code></pre>\n\n<h2>Factorial Sequencial Processing</h2>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    //\"math/rand\"\n    \"time\"\n    \"runtime\"\n)\n\nfunc main() {\n    start := time.Now()\n    //for _, n := range factorial(gen(10000)...) {\n    //  fmt.Println(\"The random Factorial is:\", n)\n    //}\n    var i int\n    for range factorial(gen(1000000)...) {\n        i++\n    }\n    fmt.Println(\"Count:\" , i)\n    fmt.Println(\"Current Time:\", time.Now(), \"Start Time:\", start, \"Elapsed Time:\", time.Since(start))\n}\n\nfunc gen(n int) []int {\n    var out []int\n    for i := 0; i &lt; n; i++ {\n        //out = append(out, rand.Intn(10)+1)\n        out = append(out, 10)\n    }\n    println(len(out))\n    return out\n}\n\nfunc factorial(val ...int) []int {\n    var out []int\n    for _, n := range val {\n        fa := calcFact(n)\n        out = append(out, fa)\n    }\n    return out\n}\n\nfunc calcFact(c int) int {\n    if c == 0 {\n        return 1\n    } else {\n        return calcFact(c-1) * c\n    }\n}\n\n//###End of Factorial sequential processing\n</code></pre>\n\n<p>My assumption was concurrent processing will be faster than sequential but sequential is executing faster than concurrent in my windows machine.</p>\n\n<p>I am using 8 core/ i7 / 32 GB RAM. </p>\n\n<p>I am not sure if there is something wrong in the programs or my basic understanding is correct.</p>\n\n<p>p.s. - I am new to GoLang.  </p>\n"}, {"tags": ["unit-testing", "testing", "go"], "comments": [{"owner": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "edited": false, "score": 0, "creation_date": 1472847159, "post_id": 39297700, "comment_id": 65934118, "body": "Your test function should return an error in the conditions where the test function &quot;should fail the test&quot;, then check for that error?"}, {"owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "reply_to_user": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "edited": false, "score": 0, "creation_date": 1472848382, "post_id": 39297700, "comment_id": 65934612, "body": "@AlexanderKohler Thanks, yes, this is one way to do it, but it is not very convenient since I already have a lot of helper functions that operate on the test object directly and the more complex ones depend on other."}, {"owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "reply_to_user": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "edited": false, "score": 0, "creation_date": 1472848539, "post_id": 39297700, "comment_id": 65934680, "body": "@AlexanderKohler also propagating the failure to the end will complicate the triaging of issues - &quot;hiding&quot; the origin of the problem."}, {"owner": {"reputation": 685, "user_id": 7047363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3a4cda8321abd1a553445a95258babb?s=128&d=identicon&r=PG&f=1", "display_name": "muthukumar selvaraj", "link": "https://stackoverflow.com/users/7047363/muthukumar-selvaraj"}, "edited": false, "score": 0, "creation_date": 1528222175, "post_id": 39297700, "comment_id": 88421965, "body": "any sample code for your <code>Testcases</code>"}], "owner": {"reputation": 5088, "user_id": 1870790, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/74516aa9ada5685130de646902051d8c?s=128&d=identicon&r=PG", "display_name": "gsf", "link": "https://stackoverflow.com/users/1870790/gsf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 872, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1472836570, "creation_date": 1472836570, "question_id": 39297700, "link": "https://stackoverflow.com/questions/39297700/golang-test-assert-the-test-is-failing", "title": "golang test assert the test is failing", "body": "<p>I am writing several helper functions for tests that I would like to test.</p>\n\n<p>I need to make sure that in some conditions the test function will fail the test. Since this is the expected behavior - my actual test needs to succeed.</p>\n\n<p>Some ideas of how I can achieve this? Something like test reset or fake testing.T object.</p>\n"}, {"tags": ["testing", "go", "benchmarking"], "answers": [{"comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472831814, "post_id": 39296444, "comment_id": 65926653, "body": "I suppose -run none should work. Is this pre-condition to running benchmarks documented or is it so obvious it doesn&#39;t need any ?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1472832033, "post_id": 39296444, "comment_id": 65926779, "body": "It actually is obvious."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 2, "creation_date": 1472832305, "post_id": 39296444, "comment_id": 65926934, "body": "@Sridhar: I never read closely, but I&#39;m not sure if this is the intended behavior. For all failure methods, the docs state: <code>Execution will continue at the next test or benchmark</code>, which makes it sound like benchmarks should continue."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1472831636, "creation_date": 1472831636, "answer_id": 39296444, "question_id": 39296241, "link": "https://stackoverflow.com/questions/39296241/is-there-a-way-to-run-benchmarks-with-failing-tests/39296444#39296444", "title": "Is there a way to run benchmarks with failing tests?", "body": "<p>You can skip the failing tests using the <code>-run</code> flag, or choose to run none at all</p>\n\n<pre><code>go test -bench . -run NONE\n</code></pre>\n"}], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 39296444, "answer_count": 1, "score": 0, "last_activity_date": 1472831636, "creation_date": 1472830990, "question_id": 39296241, "link": "https://stackoverflow.com/questions/39296241/is-there-a-way-to-run-benchmarks-with-failing-tests", "title": "Is there a way to run benchmarks with failing tests?", "body": "<p>Is it expected that benchmarks don't run unless all tests in the package have passed. </p>\n\n<p>I've looked at the <a href=\"https://golang.org/pkg/testing\" rel=\"nofollow\">testing package doc</a> and the <a href=\"https://golang.org/cmd/go/#hdr-Description_of_testing_flags\" rel=\"nofollow\">testing flags</a> and I can't find it documented that benchmarks run only after all tests pass. </p>\n\n<p>Is there a way to force benchmark functions to run even when some tests in the package have failed ? </p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472822912, "post_id": 39293238, "comment_id": 65920907, "body": "Without seeing the code for each request, it&#39;s more likely that they are not using any CPU, and are waiting on network. How do you intend to cancel those?"}, {"owner": {"reputation": 4342, "user_id": 506822, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/357e1493f08a3eabb18f69c368867eb5?s=128&d=identicon&r=PG", "display_name": "Rami Dabain", "link": "https://stackoverflow.com/users/506822/rami-dabain"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472823902, "post_id": 39293238, "comment_id": 65921564, "body": "@JimB No idea buddy, thats why My question is there, mind if i add your comment to the question? as it describes a part of my problem as well..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472824723, "post_id": 39293238, "comment_id": 65922119, "body": "That was more of a rhetorical questions, since in effect it may not be feasible, required, or even more efficient to do so. This also depends on the server (I don&#39;t think either of those provide an API to cancel an in-progress request), and the client library (is there a useful hook to force the connection closed to begin with)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1472825141, "post_id": 39293238, "comment_id": 65922413, "body": "You may use timeouts with <code>select</code> to &quot;move on&quot;, but you can&#39;t stop a goroutine from the outside: <a href=\"http://stackoverflow.com/questions/28240133/cancel-a-blocking-operation-in-go\"><b>Cancel a blocking operation in Go</b></a>. The goroutine (the code executed in the goroutine) has to support the cancellation."}], "answers": [{"comments": [{"owner": {"reputation": 4342, "user_id": 506822, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/357e1493f08a3eabb18f69c368867eb5?s=128&d=identicon&r=PG", "display_name": "Rami Dabain", "link": "https://stackoverflow.com/users/506822/rami-dabain"}, "edited": false, "score": 0, "creation_date": 1472824950, "post_id": 39293784, "comment_id": 65922289, "body": "Where can i stop the process in &quot;REDIS &lt;- 102&quot; ? once ES has returned ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472826531, "post_id": 39293784, "comment_id": 65923386, "body": "@Amd: option 1 does start separate goroutines, you&#39;re just hiding the <code>go</code> calls behind <code>AfterFunc</code>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472826762, "post_id": 39293784, "comment_id": 65923535, "body": "@JimB: <code>AfterFunc</code> is just for simulation, in real code you don&#39;t need it, it simulates random timing for one input. I will clarify this more."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 2, "last_activity_date": 1472827329, "last_edit_date": 1472827329, "creation_date": 1472823353, "answer_id": 39293784, "question_id": 39293238, "link": "https://stackoverflow.com/questions/39293238/getting-value-from-goroutine-and-canceling-another-goroutine/39293784#39293784", "title": "Getting value from goroutine and canceling another goroutine", "body": "<p>You have some Options depending to your real use case:</p>\n\n<p>1- Using two goroutines:</p>\n\n<p>This needs <code>sync/Lock</code>:<br>\nTry this simulated sample (<a href=\"https://play.golang.org/p/EUJH6K8r0B\" rel=\"nofollow\">The Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    rand.Seed(time.Now().Unix())\n    time.AfterFunc(time.Duration(rand.Intn(1000))*time.Millisecond, func() { ES &lt;- 101 })\n    time.AfterFunc(time.Duration(rand.Intn(1000))*time.Millisecond, func() { REDIS &lt;- 102 })\n\n    go B()\n    go C()\n\n    data := &lt;-channel\n\n    fmt.Println(data)\n\n}\n\nfunc B() {\n    check := true\n    data := 0\n    for {\n        select {\n        case &lt;-quit:\n            return\n        case data = &lt;-ES: // receive data\n        }\n        if check {\n            mx.Lock()\n            //defer mx.Unlock()\n            if mx.done {\n                mx.Unlock()\n                return\n            }\n            check = false\n            close(quit)\n            mx.done = true\n            mx.Unlock()\n        }\n        fmt.Println(\"ES ready\")\n        channel &lt;- data\n    }\n}\n\nfunc C() {\n    check := true\n    data := 0\n    for {\n        select {\n        case &lt;-quit:\n            return\n        case data = &lt;-REDIS: // receive data\n        }\n        if check {\n            mx.Lock()\n            //defer mx.Unlock()\n            if mx.done {\n                mx.Unlock()\n                return\n            }\n            check = false\n            close(quit)\n            mx.done = true\n            mx.Unlock()\n        }\n        fmt.Println(\"REDIS ready\")\n        channel &lt;- data\n    }\n}\n\nvar (\n    channel = make(chan int)\n    ES      = make(chan int)\n    REDIS   = make(chan int)\n    quit    = make(chan struct{})\n    mx      lockdown\n)\n\ntype lockdown struct {\n    sync.Mutex\n    done bool\n}\n</code></pre>\n\n<hr>\n\n<p>2- In this sample you just start one goroutine <code>B</code> or <code>C</code>:<br>\nsee this pseudo code:</p>\n\n<pre><code>func main() { \n    go A()\n    data := &lt;-channel\n    fmt.Println(data)\n}\n\nfunc A() {\n    for{\n        if ES ready \n            go B(data)\n            return\n        if REDIS ready\n            go C(data)\n            return\n    }\n}\n</code></pre>\n\n<p>You may start <code>A</code> goroutine, in <code>A</code> goroutine it detects which input is ready e.g. <code>ES</code> or <code>REDIS</code>, then starts <code>B</code> or <code>C</code> goroutine accordingly:</p>\n\n<p>Try this simulated sample (<a href=\"https://play.golang.org/p/1nmwIDtPiP\" rel=\"nofollow\">The Go Playground</a>):<br>\nAfterFunc is just for simulation, in real code you don't need it, it simulates random timing for one input.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    rand.Seed(time.Now().Unix())\n    time.AfterFunc(time.Duration(rand.Intn(1000))*time.Millisecond, func() { ES &lt;- 101 })\n    time.AfterFunc(time.Duration(rand.Intn(1000))*time.Millisecond, func() { REDIS &lt;- 102 })\n    go A()\n\n    data := &lt;-channel\n\n    fmt.Println(data)\n\n}\n\nfunc A() {\n    select {\n    case data := &lt;-ES:\n        go B(data)\n        return\n    case data := &lt;-REDIS:\n        go C(data)\n        return\n    }\n}\n\nfunc B(data int) {\n    for {\n        fmt.Println(\"ES ready\")\n        channel &lt;- data\n        data = &lt;-ES\n    }\n}\nfunc C(data int) {\n    for {\n        fmt.Println(\"REDIS ready\")\n        channel &lt;- data\n        data = &lt;-REDIS\n    }\n}\n\nvar (\n    channel = make(chan int)\n    ES      = make(chan int)\n    REDIS   = make(chan int)\n)\n</code></pre>\n\n<p>output from run 1:</p>\n\n<pre><code>REDIS ready\n102\n</code></pre>\n\n<p>output from run 2:</p>\n\n<pre><code>ES ready\n101\n</code></pre>\n\n<hr>\n"}, {"comments": [{"owner": {"reputation": 4342, "user_id": 506822, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/357e1493f08a3eabb18f69c368867eb5?s=128&d=identicon&r=PG", "display_name": "Rami Dabain", "link": "https://stackoverflow.com/users/506822/rami-dabain"}, "edited": false, "score": 0, "creation_date": 1472824535, "post_id": 39294062, "comment_id": 65921990, "body": "What if there were a time.sleep(1 minute/second) before data &lt;- &quot;B complete&quot; and println(&quot;pased&quot;) after data &lt;- &quot;B complete&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 4342, "user_id": 506822, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/357e1493f08a3eabb18f69c368867eb5?s=128&d=identicon&r=PG", "display_name": "Rami Dabain", "link": "https://stackoverflow.com/users/506822/rami-dabain"}, "edited": false, "score": 0, "creation_date": 1472824898, "post_id": 39294062, "comment_id": 65922248, "body": "@RonanDejhero: I&#39;m not sure what you mean. You can try it yourself: <a href=\"https://play.golang.org/p/CUCgYeVHO6\" rel=\"nofollow noreferrer\">play.golang.org/p/CUCgYeVHO6</a>. This falls into the area of what it means to &quot;cancel&quot; a remote request. One would usually set the clients with a reasonable timeout so that the outstanding requests take care of themselves. This is also very dependent on what the client code looks like, and how you are handling the data."}, {"owner": {"reputation": 4342, "user_id": 506822, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/357e1493f08a3eabb18f69c368867eb5?s=128&d=identicon&r=PG", "display_name": "Rami Dabain", "link": "https://stackoverflow.com/users/506822/rami-dabain"}, "edited": false, "score": 0, "creation_date": 1472825405, "post_id": 39294062, "comment_id": 65922567, "body": "the only time consuming code i found in the example is &quot;time.After(XXX):&quot; Not sure how can that be replaced with &quot;connect to ES, do some logic on value and return value&quot;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 4342, "user_id": 506822, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/357e1493f08a3eabb18f69c368867eb5?s=128&d=identicon&r=PG", "display_name": "Rami Dabain", "link": "https://stackoverflow.com/users/506822/rami-dabain"}, "edited": false, "score": 0, "creation_date": 1472825826, "post_id": 39294062, "comment_id": 65922886, "body": "@RonanDejhero: that stands in for any operation you want, and you would return your value over a channel.  Optionally, some code chooses to check the <code>Err()</code> value of the context between operations to determine if the request has been cancelled."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 4342, "user_id": 506822, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/357e1493f08a3eabb18f69c368867eb5?s=128&d=identicon&r=PG", "display_name": "Rami Dabain", "link": "https://stackoverflow.com/users/506822/rami-dabain"}, "edited": false, "score": 2, "creation_date": 1472826371, "post_id": 39294062, "comment_id": 65923279, "body": "@RonanDejhero: To expand, say the request was http based, you could take the http.Request, and use <a href=\"https://golang.org/pkg/net/http/#Request.WithContext\" rel=\"nofollow noreferrer\"><code>WithContext</code></a> to automatically cancel the http request when you cancel the context. As you can see, the actual cancelation code is going to be unique to the client library and codepath around the handling of data."}, {"owner": {"reputation": 4342, "user_id": 506822, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/357e1493f08a3eabb18f69c368867eb5?s=128&d=identicon&r=PG", "display_name": "Rami Dabain", "link": "https://stackoverflow.com/users/506822/rami-dabain"}, "edited": false, "score": 0, "creation_date": 1472827362, "post_id": 39294062, "comment_id": 65923966, "body": "Managed to do it, this is a great way to do it as it also allows for timeout"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "edited": false, "score": 0, "creation_date": 1472829342, "post_id": 39294062, "comment_id": 65925195, "body": "If two inputs ready at the same time this sample code panics, (you need sync/Lock) see(run): <a href=\"https://play.golang.org/p/9CJ2_NhpWN\" rel=\"nofollow noreferrer\">play.golang.org/p/9CJ2_NhpWN</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472829719, "post_id": 39294062, "comment_id": 65925451, "body": "@Amd: good point. It&#39;s blocking on the second send to <code>data</code>, and in this case it&#39;s better to use a buffered channel to prevent blocking at rather than add extra synchronization."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1472829765, "last_edit_date": 1472829765, "creation_date": 1472824210, "answer_id": 39294062, "question_id": 39293238, "link": "https://stackoverflow.com/questions/39293238/getting-value-from-goroutine-and-canceling-another-goroutine/39294062#39294062", "title": "Getting value from goroutine and canceling another goroutine", "body": "<p>The <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow\">context package</a> provides cancelation, timeout and deadline contexts for this purpose. Here you can see a cancelation example, and we wait for the slower goroutine to print the cancelled message:</p>\n\n<pre><code>ctx, cancel := context.WithCancel(context.Background())\n\n// buffer the channel for extra results returned before cancelation\ndata := make(chan string, 2)\n\nvar wg sync.WaitGroup\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n    select {\n    case &lt;-time.After(100 * time.Millisecond):\n        data &lt;- \"A complete\"\n    case &lt;-ctx.Done():\n        fmt.Println(\"A cancelled\")\n    }\n}()\n\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n    select {\n    case &lt;-time.After(200 * time.Millisecond):\n        data &lt;- \"B complete\"\n    case &lt;-ctx.Done():\n        fmt.Println(\"B cancelled\")\n    }\n}()\n\nresp := &lt;-data\ncancel()\nfmt.Println(resp)\nwg.Wait()\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/vAhksjKozW\" rel=\"nofollow\">https://play.golang.org/p/vAhksjKozW</a></p>\n"}], "owner": {"reputation": 4342, "user_id": 506822, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/357e1493f08a3eabb18f69c368867eb5?s=128&d=identicon&r=PG", "display_name": "Rami Dabain", "link": "https://stackoverflow.com/users/506822/rami-dabain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 1, "accepted_answer_id": 39294062, "answer_count": 2, "score": 2, "last_activity_date": 1516873428, "creation_date": 1472821693, "last_edit_date": 1516873428, "question_id": 39293238, "link": "https://stackoverflow.com/questions/39293238/getting-value-from-goroutine-and-canceling-another-goroutine", "title": "Getting value from goroutine and canceling another goroutine", "body": "<p>I have a case where I am reading data from 2 different locations (ES and REDIS), I need to read a single value from the fastest source, thus I am firing 2 goroutines, one to get the data from ES, the other to get it from REDIS. </p>\n\n<p>once data has been fetched from one of the goroutines, the other goroutine must be canceled completely not to waste CPU.</p>\n\n<p>simplified:</p>\n\n<pre><code>func A(){\n    go funcB(){\n\n    }()\n\n    go funcC(){\n\n    }()\n\n    data := &lt;-channel // \n}\n</code></pre>\n\n<p>now once the data is received, <code>funcA</code> or <code>funcB</code> must be canceled, no matter what they were doing (I don't care for their output anymore, they are just wasting CPU)</p>\n\n<p>what would be the most efficient way to do it?\ncan it be done using channels only?</p>\n"}, {"tags": ["dictionary", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "edited": false, "score": 0, "creation_date": 1472821814, "post_id": 39293129, "comment_id": 65920149, "body": "Great answer ! Thanks !"}], "tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": true, "score": 6, "last_activity_date": 1472821819, "last_edit_date": 1472821819, "creation_date": 1472821362, "answer_id": 39293129, "question_id": 39292672, "link": "https://stackoverflow.com/questions/39292672/how-to-build-a-map-of-struct-and-append-values-to-it-using-go/39293129#39293129", "title": "How to build a map of struct and append values to it using GO?", "body": "<p>Here's a way to write it:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n\ntype TEST struct {\n    x   int\n    y   []string  \n}\n\nvar m = map[string]*TEST { \"a\": {2, []string{\"a\", \"b\"}} }\n\n\nfunc main() {\n\n    a := new(TEST)\n    a.x = 0\n    a.y = []string{\"c\", \"d\"}\n\n    m[\"toto\"] = a\n\n    fmt.Println(m) \n\n}\n</code></pre>\n\n<p>Note: two types aren't the same just because their struct have identical fields.</p>\n"}, {"comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1472829004, "post_id": 39295166, "comment_id": 65924986, "body": "You don&#39;t have to be <i>this</i> verbose, and you don&#39;t have to repeat the struct definition in the struct literal. This is correct: <code>var m = map[string]*struct {x int; y []string} { &quot;a&quot;: {2, []string{&quot;a&quot;, &quot;b&quot;}} }</code>."}, {"owner": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "edited": false, "score": 0, "creation_date": 1472846679, "post_id": 39295166, "comment_id": 65933909, "body": "Thank you very much for the explanation Uvelichitel and Denys !"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1472830243, "last_edit_date": 1472830243, "creation_date": 1472827516, "answer_id": 39295166, "question_id": 39292672, "link": "https://stackoverflow.com/questions/39292672/how-to-build-a-map-of-struct-and-append-values-to-it-using-go/39295166#39295166", "title": "How to build a map of struct and append values to it using GO?", "body": "<p>Long story. If you for some reason prefer unnamed types you must be quite verbose in composite literal describing both types and values</p>\n\n<pre><code>var m = map[string]*struct {\n    x int\n    y []string\n}{\"foo\": {2, []string{\"a\", \"b\"}}}\n</code></pre>\n\n<p>or with semicolons</p>\n\n<pre><code>var m = map[string]*struct {x int; y []string}{\"foo\": {2, []string{\"a\", \"b\"}}}\n</code></pre>\n\n<p>and without indirection</p>\n\n<pre><code>var m1 = map[string]struct {\n    x int\n    y []string\n}{2, []string{\"a\", \"b\"}}}\n</code></pre>\n\n<p>To add new key</p>\n\n<pre><code>m[\"todo\"] = &amp;struct {\n        x int\n        y []string\n    }{0, []string{\"c\", \"d\"}}\n</code></pre>\n\n<p>You can also assign TEST struct but only without indirection because pointers *TEST and *youunnamedstruct are not assignable nevertheless structs having identical fields assignable themself</p>\n\n<pre><code>m1[\"todo\"] = TEST{0, []string{\"c\", \"d\"}}\n</code></pre>\n\n<p>You can append only to indirect map struct field</p>\n\n<pre><code>m[\"todo\"].y = append(m[\"todo\"].y, \"e\")\n</code></pre>\n\n<p>because direct map struct fields are not addressable</p>\n"}], "owner": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6910, "favorite_count": 2, "accepted_answer_id": 39293129, "answer_count": 2, "score": 1, "last_activity_date": 1472830243, "creation_date": 1472819916, "last_edit_date": 1472822270, "question_id": 39292672, "link": "https://stackoverflow.com/questions/39292672/how-to-build-a-map-of-struct-and-append-values-to-it-using-go", "title": "How to build a map of struct and append values to it using GO?", "body": "<p>I tried many ways to build a map of struct and append values to it and I did not find any way to do it.</p>\n\n<p>The keys of the map are strings. The struct is made of two parts : \"x\" integer and \"y\" a slice of strings.</p>\n\n<p>The errors I face to build the map are (for m) : <code>main.go:11: syntax error: unexpected comma, expecting semicolon, newline, or }</code></p>\n\n<p>When I try to add new keys and values to the map, the errors are : <code>go:33: syntax error: missing operand</code></p>\n\n<p>Thank you very much to help me find the mistakes !</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype TEST struct {\n    x  int\n    y []string  \n}\n\n// none of these var gives the expected result\n\nvar m = map[string]*struct{x int, y []string}{\"foo\": {2, {\"a\", \"b\"}}, }\n\nvar m2 = map[string]struct{x int, y []string}{\"foo\": {2, {\"a\", \"b\"}}, }\n\n\nvar n = map[string]*struct{x int\n            y []string\n            }{\"foo\": {2, {\"a\", \"b\"}}, }\n\nvar o = map[string]*struct{\n            x int\n            y []string\n            }{\"foo\": {2, {\"a\", \"b\"}}, }         \n\n\n\nfunc main() {\n\n    m[\"foo\"].x = 4\n    fmt.Println(m[\"foo\"].x)\n\n// how can I had a new key ?\n\n    m[\"toto\"].x = 0\n    m[\"toto\"] = {0, {\"c\", \"d\"}}\n\n// and append the string \"e\" to {\"c\", \"d\"} ?\n\n    m[\"toto\"].y = append(m[\"toto\"].y, \"e\")\n\n\n    a := new(TEST)\n    a.x = 0\n    a.y = {\"c\", \"d\"}\n\n    m[\"toto\"] = a\n\n    fmt.Println(m) \n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1472810503, "post_id": 39289590, "comment_id": 65913174, "body": "Related / possible duplicate of <a href=\"http://stackoverflow.com/questions/38875016/splitting-client-server-code\">Splitting client/server code</a>"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472810968, "post_id": 39289590, "comment_id": 65913436, "body": "And don&#39;t forget about the workaround for <a href=\"https://golang.org/issue/15093\" rel=\"nofollow noreferrer\">this</a>"}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1472812372, "post_id": 39289590, "comment_id": 65914238, "body": "@icza It&#39;s not a duplicate in that I&#39;m not concerned by dead code removal. ? I&#39;ll give an example to make my question more clear."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472815127, "post_id": 39289590, "comment_id": 65915752, "body": "Maybe I don&#39;t understand the question, but what&#39;s the problem with importing from a shared package ?"}, {"owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472815836, "post_id": 39289590, "comment_id": 65916195, "body": "@Sridhar I thought that creating a package would require me to create a directory outside of the project directory <code>thing</code>. See my Edit2. I now understood how it must be done. If you provide this info as answer I&#39;ll validate it. I can&#39;t answer myself yet."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472816183, "post_id": 39289590, "comment_id": 65916426, "body": "I&#39;m pretty sure you can create a directory called util under thing and have all files in util as package util. You should then be able to import thing/util from your client &amp; server"}], "answers": [{"tags": [], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "is_accepted": true, "score": 2, "last_activity_date": 1472818259, "last_edit_date": 1472818259, "creation_date": 1472817095, "answer_id": 39291754, "question_id": 39289590, "link": "https://stackoverflow.com/questions/39289590/go-files-organisation-for-two-apps-with-shared-code/39291754#39291754", "title": "go files organisation for two apps with shared code", "body": "<p>As per this, <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">How to Write Go Code</a> create a package containing the shared code and import it in the client and server code. </p>\n\n<p>The package can be stored in a specific directory named for instance .../go/src/thing/common. All go files inside common should declare to be a member of the package named common. The client and server source files should then import thing/common to access the shared source code.</p>\n\n<p>To avoid package name collisions, the project directory can be renamed using a URL like path with a unique domain name, e.g. \"github.com/user/thing\". This will avoid any collision. The project source files can then be stored under .../go/src/github.com/user/thing/.... </p>\n\n<p>The client and server can then import \"github.com/user/thing/common\".</p>\n\n<p>If there are no source files directly under github.com/user/thing you can create a new empty file with just a package name in it to get around <a href=\"https://golang.org/issue/15093\" rel=\"nofollow\">this</a> until 1.8</p>\n"}], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 641, "favorite_count": 0, "accepted_answer_id": 39291754, "answer_count": 1, "score": 2, "last_activity_date": 1472818259, "creation_date": 1472810215, "last_edit_date": 1472815655, "question_id": 39289590, "link": "https://stackoverflow.com/questions/39289590/go-files-organisation-for-two-apps-with-shared-code", "title": "go files organisation for two apps with shared code", "body": "<p>I have a client and server application that share some code. I would like to group them all in a single directory under git control. </p>\n\n<p>In this directory I can create two sub-directories, one for the client and one for the server. The compiled code will have the name of the directory provided I compile them using <code>go install</code> from within their respective directory.  </p>\n\n<p>What is unclear is how to deal with the shared code (.go files) which I don't want to copy in each repository. </p>\n\n<p>Am I required to create a separate package ? Can this package be stored in the common root directory ? </p>\n\n<p><strong>EDIT 1</strong>: Here is an example to make the question clear</p>\n\n<p>The directory <em>thing</em> is for the project. It contains the <em>thingClient</em> and <em>thingServer</em> directory containing the client and server specific go files. </p>\n\n<p>The client and server use common functions stored in specific files. I want these common files to be stored in .../go/src/thing so that they remain in the same git repository. I don't want them to be compiled into a shared library.</p>\n\n<p><code>\n.../go/src/thing  &lt;-- under git control\n.../go/src/thing/thingClient   &lt;-- contains main.go of client\n.../go/src/thing/thingServer   &lt;-- contains main.go of server\n.../go/src/thing/ ???          &lt;-- contains go files used by client and server\n</code>\nI would prefer avoiding to create a package containing those common files if possible. </p>\n\n<p><strong>EDIT\u00a02</strong>: According to this documentation <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">How to Write Go Code</a> I do have to create a package containing the shared code and import it in the client and server code. The package would be stored in a specific directory named for instance <code>.../go/src/thing/common</code>. All go files inside common should declare to be member of the package named <em>common</em>. The client and server source files should then <code>import thing/common</code> to access the shared source code.</p>\n\n<p>Another important point is the project directory. To avoid package name collisions, the project directory should be renamed using a URL like path with a unique domain name, e.g. \"github/user/thing\". This will avoid any collision. The project source files should then be stored under <code>.../go/src/github/user/thing/...</code>. The client and server should then import \"github/user/thing/common\". </p>\n"}, {"tags": ["dictionary", "go", "concurrency", "goroutine", "panic"], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 51721, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KcEea.jpg?s=128&g=1", "display_name": "Igor Lankin", "link": "https://stackoverflow.com/users/51721/igor-lankin"}, "edited": false, "score": 3, "creation_date": 1472808776, "post_id": 39288885, "comment_id": 65912031, "body": "This was not the question. The question was why recover does not work."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 1, "last_activity_date": 1472808548, "last_edit_date": 1472808548, "creation_date": 1472808219, "answer_id": 39288885, "question_id": 39288741, "link": "https://stackoverflow.com/questions/39288741/how-to-recover-from-concurrent-map-writes/39288885#39288885", "title": "How to recover from concurrent map writes?", "body": "<p>Do not recover, guard your code with mutexes form package <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow\">sync</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n    \"time\"\n)\n\nvar m = make(map[string]string)\nvar l = sync.Mutex{}\n\nfunc main() {\n    go func() {\n        for {\n            l.Lock()\n            m[\"x\"] = \"foo\"\n            l.Unlock()\n        }\n    }()\n    go func() {\n        for {\n            l.Lock()\n            m[\"x\"] = \"foo\"\n            l.Unlock()\n        }\n    }()\n\n    time.Sleep(1 * time.Second)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1250, "user_id": 51721, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KcEea.jpg?s=128&g=1", "display_name": "Igor Lankin", "link": "https://stackoverflow.com/users/51721/igor-lankin"}, "edited": false, "score": 0, "creation_date": 1472814721, "post_id": 39289246, "comment_id": 65915525, "body": "Thanks for the refence to the release notes. I was looking for that."}, {"owner": {"reputation": 1250, "user_id": 51721, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KcEea.jpg?s=128&g=1", "display_name": "Igor Lankin", "link": "https://stackoverflow.com/users/51721/igor-lankin"}, "edited": false, "score": 0, "creation_date": 1472814892, "post_id": 39289246, "comment_id": 65915610, "body": "What is misleading here is that the stacktrace is pointing to a function called <code>dopanic</code> in &quot;/usr/local/go/src/runtime/panic.go:547&quot;: <code>dopanic(0)</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1250, "user_id": 51721, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KcEea.jpg?s=128&g=1", "display_name": "Igor Lankin", "link": "https://stackoverflow.com/users/51721/igor-lankin"}, "edited": false, "score": 0, "creation_date": 1472815224, "post_id": 39289246, "comment_id": 65915813, "body": "@IgorLankin Because things are done that are similar to a panic: stack trace is printed, but then the app is crashed. You can see this in <code>panic.go</code>, end of <code>dopanic_m()</code> function: <code>crash()</code> and <code>exit()</code> calls."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 20, "last_activity_date": 1472809803, "last_edit_date": 1472809803, "creation_date": 1472809196, "answer_id": 39289246, "question_id": 39288741, "link": "https://stackoverflow.com/questions/39288741/how-to-recover-from-concurrent-map-writes/39289246#39289246", "title": "How to recover from concurrent map writes?", "body": "<p>Recovering doesn't work here because what you experience is not a panicing state.</p>\n\n<p><a href=\"https://golang.org/doc/go1.6#runtime\">Go 1.6 added</a> a lightweight concurrent misuse of maps detection to the runtime:</p>\n\n<blockquote>\n  <p>The runtime has added lightweight, best-effort detection of concurrent misuse of maps. As always, if one goroutine is writing to a map, no other goroutine should be reading or writing the map concurrently. <strong>If the runtime detects this condition, it prints a diagnosis and crashes the program.</strong> The best way to find out more about the problem is to run the program under the <a href=\"https://blog.golang.org/race-detector\">race detector</a>, which will more reliably identify the race and give more detail.</p>\n</blockquote>\n\n<p>What you experience is an <em>intentional crash</em> by the runtime, it's not the result of a <code>panic()</code> call that a <code>recover()</code> call in a deferred function could stop.</p>\n\n<p>There's nothing you can do to stop that except prevent the concurrent misuse of maps. If you would leave your app like that and it wouldn't crash, you could experience mysterious, undefined behavior at runtime.</p>\n"}], "owner": {"reputation": 1250, "user_id": 51721, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/KcEea.jpg?s=128&g=1", "display_name": "Igor Lankin", "link": "https://stackoverflow.com/users/51721/igor-lankin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4198, "favorite_count": 2, "accepted_answer_id": 39289246, "answer_count": 2, "score": 5, "last_activity_date": 1473407493, "creation_date": 1472807821, "last_edit_date": 1473407493, "question_id": 39288741, "link": "https://stackoverflow.com/questions/39288741/how-to-recover-from-concurrent-map-writes", "title": "How to recover from concurrent map writes?", "body": "<p>How do you recover from a runtime panic on a \"concurrent map read and map write\"? The usual defer with recover doesn't seem to work. Why is that?</p>\n\n<p>I know that you are not supposed to use maps in concurrent contexts, but still: how to recover here?</p>\n\n<p>Example: </p>\n\n<pre><code>package main\n\nimport \"time\"\n\nvar m = make(map[string]string)\n\nfunc main() {\n    go func() {\n        for {\n            m[\"x\"] = \"foo\"\n        }\n    }()\n    go func() {\n        for {\n            m[\"x\"] = \"foo\"\n        }\n    }()\n\n    time.Sleep(1 * time.Second)\n}\n</code></pre>\n\n<p>Please add recovery code. :)</p>\n"}, {"tags": ["c", "memory-management", "go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 4282, "user_id": 165063, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MJdL7.png?s=128&g=1", "display_name": "Roman Khimov", "link": "https://stackoverflow.com/users/165063/roman-khimov"}, "is_accepted": false, "score": 0, "last_activity_date": 1472812857, "creation_date": 1472812857, "answer_id": 39290409, "question_id": 39288118, "link": "https://stackoverflow.com/questions/39288118/cgo-do-i-need-to-free-the-memory-for-a-variable-returned-by-a-c-function-to-go/39290409#39290409", "title": "cgo do i need to free the memory for a variable returned by a C function to go", "body": "<p>Think of it in terms of C more than in terms of Go. If you're returning (from your C function) a pointer to some allocated (as in <code>malloc()</code>) memory &mdash; that should be freed (if, of course it's not referenced in some other memory allocated by C code). If you're returning some structure (not a pointer to the structure) or integer &mdash; there is nothing to free. If you're returning a pointer to some static memory &mdash; that should not be freed.</p>\n\n<p>So in your example it's the question of what <code>feats</code> is, how it was allocated, how it is managed. Given the current code it's just impossible to give the definitive answer on whether you need to <code>free()</code> the returned value or not.</p>\n"}], "owner": {"reputation": 621, "user_id": 2294667, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/9a834b6b0c63e84c6e4f473161eec983?s=128&d=identicon&r=PG", "display_name": "Westy10101", "link": "https://stackoverflow.com/users/2294667/westy10101"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 543, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1472812857, "creation_date": 1472806126, "question_id": 39288118, "link": "https://stackoverflow.com/questions/39288118/cgo-do-i-need-to-free-the-memory-for-a-variable-returned-by-a-c-function-to-go", "title": "cgo do i need to free the memory for a variable returned by a C function to go", "body": "<p>I am new to cgo and have a couple of questions to do with memory management.</p>\n\n<p>Say I have a simple c function as below:</p>\n\n<pre><code>char* get_str_in_arr(char **charArr, size_t i){\n    return charArr[i];\n}\n</code></pre>\n\n<p>do i need to free the memory as below:</p>\n\n<pre><code>func doSomething(){\n    cStr := C.get_str_in_arr(feats, C.size_t(1))\n    goStr := C.GoString(cStr)\n    defer C.free(unsafe.Pointer(cStr))\n    ...\n}\n</code></pre>\n\n<p>If this is the case do I need to do this with any variable returned from a method. For example a c Struct, uint32_t, ... etc </p>\n"}, {"tags": ["post", "go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1472806210, "post_id": 39288079, "comment_id": 65910282, "body": "<a href=\"https://golang.org/pkg/net/http/#PostForm\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#PostForm</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "reply_to_user": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "edited": false, "score": 0, "creation_date": 1472808073, "post_id": 39288218, "comment_id": 65911541, "body": "Looks like yii framework is expecting a straight JSON post and not a application/x-www-form-urlencoded as most &lt;form...&gt; type transactions would.  I.e. it&#39;s not so much a parameter as the entire content of the POST body.  I&#39;ll update my answer shortly."}, {"owner": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "edited": false, "score": 1, "creation_date": 1472826133, "post_id": 39288218, "comment_id": 65923103, "body": "my bad... problem was in php."}], "tags": [], "owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "is_accepted": true, "score": 6, "last_activity_date": 1472809842, "last_edit_date": 1472809842, "creation_date": 1472806385, "answer_id": 39288218, "question_id": 39288079, "link": "https://stackoverflow.com/questions/39288079/how-to-send-parameters-by-post/39288218#39288218", "title": "How to send parameters by POST", "body": "<p>There are a bunch of ways to POST stuff, but you probably want to use PostForm: <a href=\"https://golang.org/pkg/net/http/#PostForm\" rel=\"noreferrer\">https://golang.org/pkg/net/http/#PostForm</a></p>\n\n<p>You'll need to set up a Values object first then pass it right in.  See the example code in the docs: <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"noreferrer\">https://golang.org/pkg/net/url/#Values</a></p>\n\n<p>Once you've jammed the json into a Values object, just call PostForm() to fire it up.</p>\n\n<p>Edit:  This works assuming that the receiving end is wanting something encoded as application/x-www-form-urlencoded.  I'm putting in a second answer if the receiving end is expecting application/json.</p>\n"}, {"comments": [{"owner": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "edited": false, "score": 0, "creation_date": 1472810899, "post_id": 39289607, "comment_id": 65913389, "body": "I try it.   Still missing param.  json - name of parameter for php controller.  actionShowData($json)  &lt;- this one is missing!"}, {"owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "reply_to_user": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "edited": false, "score": 1, "creation_date": 1472811404, "post_id": 39289607, "comment_id": 65913697, "body": "JSON input has been turned on for this action per <a href=\"http://www.yiiframework.com/doc-2.0/guide-rest-quick-start.html#enabling-json-input\" rel=\"nofollow noreferrer\">yiiframework.com/doc-2.0/&hellip;</a> ?"}], "tags": [], "owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "is_accepted": false, "score": -1, "last_activity_date": 1472810287, "creation_date": 1472810287, "answer_id": 39289607, "question_id": 39288079, "link": "https://stackoverflow.com/questions/39288079/how-to-send-parameters-by-post/39289607#39289607", "title": "How to send parameters by POST", "body": "<p>This answer assumes that the receiving end is expecting application/json.  It's still problematic in this particular case, though I've verified using Wireshark that the request is correct (has the correct headers and body content):</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nfunc main() {\n\n    // Create a key/value map of strings\n    kvPairs := make(map[string]string)\n    kvPairs[\"foo\"] = \"bar\"\n\n    // Make this JSON\n    postJson, err := json.Marshal(kvPairs)\n    if err != nil { panic(err) }\n    fmt.Printf(\"Sending JSON string '%s'\\n\", string(postJson))\n\n    // http.POST expects an io.Reader, which a byte buffer does\n    postContent := bytes.NewBuffer(postJson)\n\n    // Send request to OP's web server\n    resp, err := http.Post(\"http://87.236.22.7:1488/test/show-data\", \"application/json\", postContent)\n    if err != nil { panic(err) }\n\n    // Spit back the complete status\n    fmt.Printf(\"Status: %s\\n\", resp.Status)\n    buf, _ := ioutil.ReadAll(resp.Body)\n    fmt.Println(string(buf))\n}\n</code></pre>\n\n<p>It appears that either the receiving yii framework doesn't know what to do with this type of REST request, or is expecting stuff in the GET part of the parameters anyway.  The yii page describing <a href=\"http://www.yiiframework.com/doc-2.0/guide-rest-quick-start.html#enabling-json-input\" rel=\"nofollow\">REST requests</a> has an example CURL command line that makes a request that's more like what the code above does, but it doesn't work in OP's example.</p>\n\n<p>OP:  Please double-check your receiver to make sure it's configured to receive such requests.  A similar CURL command line should work (and if it does, so should my code).</p>\n"}], "owner": {"reputation": 481, "user_id": 5923447, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3e8d4b82ca8809700e626d0ba9fb55e4?s=128&d=identicon&r=PG&f=1", "display_name": "user199588", "link": "https://stackoverflow.com/users/5923447/user199588"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10442, "favorite_count": 0, "accepted_answer_id": 39288218, "answer_count": 2, "score": 1, "last_activity_date": 1552588758, "creation_date": 1472805961, "last_edit_date": 1552588758, "question_id": 39288079, "link": "https://stackoverflow.com/questions/39288079/how-to-send-parameters-by-post", "title": "How to send parameters by POST", "body": "<p>resource receives the parameters</p>\n\n<p>example:  <code>http://example.com/show-data?json={\"fob\":\"bar\"}</code></p>\n\n<p>in case of GET request, all clear and work well.</p>\n\n<pre><code>urlStr := \"http://87.236.22.7:1488/test/show-data\"\njson := `\"foo\":\"bar\"`\nr, _ := http.Get(urlStr+`?json=`+json)\nprintln(r.Status)\n\n\n200 OK\n</code></pre>\n\n<p>But how it shoud be done when use POST request? </p>\n\n<p>i try </p>\n\n<pre><code> urlStr := \"http://87.236.22.7:1488/test/show-data\"\n    json := `{\"foo\":\"bar\"}`\n    form := url.Values{}\n    form.Set(\"json\", json)\n\n    println(form.Encode())\n    post, _ := http.PostForm(urlStr, form)\n\n    println(post.Status)\n\n\n\n400 Bad Request \n\njson parameter is missing\n</code></pre>\n\n<p>but it`s not work.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472804566, "post_id": 39287364, "comment_id": 65909171, "body": "I don&#39;t think it makes a difference since the close call is deferred. It seems to be idiomatic to check the error first and then defer the close."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 2, "creation_date": 1472804975, "post_id": 39287364, "comment_id": 65909416, "body": "@Sridhar: This is <b>wrong</b>! if err!=nil then resp == nil in which case the defered Body.Close() will panic."}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472805486, "post_id": 39287364, "comment_id": 65909756, "body": "Yikes you&#39;re right - just tried it. Obviously never come across this because I handle all my errors straight away :)"}], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 5, "last_activity_date": 1472806816, "last_edit_date": 1472806816, "creation_date": 1472803971, "answer_id": 39287459, "question_id": 39287364, "link": "https://stackoverflow.com/questions/39287364/golang-whats-the-correct-order-to-check-error-and-defer-an-operation/39287459#39287459", "title": "Golang - what&#39;s the correct order to check error and defer an operation?", "body": "<p>You need to check for error right after the call to <code>Get</code>. If <code>Get</code> fails, <code>resp</code> will be set to <code>nil</code>. This means that <code>resp.Body</code> would generate runtime <code>nil pointer dereferenced</code> error.</p>\n\n<pre><code>resp, err := http.Get(\"https://www.google.com\")\nif err != nil {\n    // process error\n    return err\n}\ndefer resp.Body.Close()\n</code></pre>\n"}], "owner": {"reputation": 21084, "user_id": 170931, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/WA698.png?s=128&g=1", "display_name": "Just a learner", "link": "https://stackoverflow.com/users/170931/just-a-learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1482, "favorite_count": 1, "closed_date": 1472805302, "accepted_answer_id": 39287459, "answer_count": 1, "score": 2, "last_activity_date": 1472806816, "creation_date": 1472803654, "question_id": 39287364, "link": "https://stackoverflow.com/questions/39287364/golang-whats-the-correct-order-to-check-error-and-defer-an-operation", "closed_reason": "Duplicate", "title": "Golang - what&#39;s the correct order to check error and defer an operation?", "body": "<p>I'm new to Go. If I'm doing an HTTP get request let this:</p>\n\n<pre><code>resp, err := http.Get(\"https://www.google.com\")\n</code></pre>\n\n<p>Now I need to check whether <code>err</code> is nil and <code>defer resp.Body.Close()</code>. What's the correct order to do these two operations?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 1894, "user_id": 2269979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff22a1e835980e29baccf08a62e7ff71?s=128&d=identicon&r=PG", "display_name": "molivier", "link": "https://stackoverflow.com/users/2269979/molivier"}, "is_accepted": true, "score": 1, "last_activity_date": 1472805139, "last_edit_date": 1472805139, "creation_date": 1472804810, "answer_id": 39287714, "question_id": 39285029, "link": "https://stackoverflow.com/questions/39285029/middleware-error-handling/39287714#39287714", "title": "Middleware error handling", "body": "<p>You can use a \"naked\" <code>return</code> just after your error to stop the middleware chain execution.</p>\n\n<p>From <a href=\"https://golang.org/pkg/net/http/#Error\" rel=\"nofollow\">http documentation</a>:</p>\n\n<blockquote>\n  <p>Error replies to the request with the specified error message and HTTP code. It does not otherwise end the request; the caller should ensure no further writes are done to w. The error message should be plain text. </p>\n</blockquote>\n\n<p>From this <a href=\"http://elithrar.github.io/article/custom-handlers-avoiding-globals/\" rel=\"nofollow\">Custom Handlers and Avoiding Globals in Go Web Applications </a>:</p>\n\n<pre><code>func myHandler(w http.ResponseWriter, r *http.Request) {\n    session, err := store.Get(r, \"myapp\")\n    if err != nil {\n        http.Error(w, http.StatusText(http.StatusInternalServerError), http.StatusInternalServerError)\n        return // Forget to return, and the handler will continue on\n    }\n    .../...\n}\n</code></pre>\n"}], "owner": {"reputation": 6586, "user_id": 256405, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/420ecb69f4d50ee66160e01e4071be6e?s=128&d=identicon&r=PG", "display_name": "Morrowless", "link": "https://stackoverflow.com/users/256405/morrowless"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 306, "favorite_count": 0, "accepted_answer_id": 39287714, "answer_count": 1, "score": 0, "last_activity_date": 1472805139, "creation_date": 1472794901, "last_edit_date": 1472796263, "question_id": 39285029, "link": "https://stackoverflow.com/questions/39285029/middleware-error-handling", "title": "Middleware error handling", "body": "<p>I have a chain of <a href=\"https://github.com/go-zoo/claw\" rel=\"nofollow\">claw</a> <code>http.Handler</code> middlewares, where my first handler might write an error response:</p>\n\n<pre><code>http.Error(w, err.Error(), http.StatusUnauthorized)\n</code></pre>\n\n<p>However my other middlewares continue executing, but I don't want it to. What is the best way to go about this? I tried checking the status header after calling <code>http.Error()</code>, to see if it is other than a 200:</p>\n\n<pre><code>status := w.Header().Get(\"Status\")\n</code></pre>\n\n<p>but status is an empty string.</p>\n"}, {"tags": ["go", "protocol-buffers", "access-control", "grpc", "capability"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 1646637, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e802b4a743b416dfdda55603e8953026?s=128&d=identicon&r=PG", "display_name": "user1646637", "link": "https://stackoverflow.com/users/1646637/user1646637"}, "edited": false, "score": 0, "creation_date": 1472840536, "post_id": 39284496, "comment_id": 65931210, "body": "Thank you so much. These are great tips!"}], "tags": [], "owner": {"reputation": 2527, "user_id": 3476121, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/1c621706e2e37eed4f82f074af9f706a?s=128&d=identicon&r=PG", "display_name": "sadlil", "link": "https://stackoverflow.com/users/3476121/sadlil"}, "is_accepted": true, "score": 2, "last_activity_date": 1472791676, "creation_date": 1472791676, "answer_id": 39284496, "question_id": 39282755, "link": "https://stackoverflow.com/questions/39282755/adding-access-control-to-protobuf/39284496#39284496", "title": "Adding access control to Protobuf", "body": "<p>One way is to achieve this is writing a generator plugin that will parse your proto file, and generates some sort of code or data file. Like <a href=\"https://github.com/grpc-ecosystem/grpc-gateway\" rel=\"nofollow\">grpc-gateway</a> does. Each rpc have options can be customized, and added in proto file like <a href=\"https://github.com/grpc-ecosystem/grpc-gateway/blob/master/examples/examplepb/a_bit_of_everything.proto#L74\" rel=\"nofollow\">this</a>. Those options are called protobuf.MethodOptions. You can see this <a href=\"https://github.com/googleapis/googleapis/blob/master/google/api/annotations.proto\" rel=\"nofollow\">here</a>. So You can have your own method options and generate your validator or modifier using this, then call the validator from the interceptor to resolve.</p>\n\n<p>Another unconventional way i could tell you is that,\nyou could have an json or yaml file including a map. Every protobuf method has an unique name identifier formated as <code>\"/package.service/rpcMethodName\"</code>. so if you have a rpc method like:</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage yourpackage;\n\nservice ServiceName {\n  rpc MethodName(Request) returns (Response) {};\n}\n</code></pre>\n\n<p>the unique identifier for this method will be like as <code>/yourpackage.ServiceName/MethodName</code> that you will find inside your interceptor, as <code>grpc.UnaryServerInfo.FullMethod</code>.</p>\n\n<p>so the way is you maintain a separate map via yaml or json, that contains your FullMethodName and required capability, then inside your interceptor read the map and find the desired capability for your method, and apply your desired operations.</p>\n"}], "owner": {"reputation": 33, "user_id": 1646637, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e802b4a743b416dfdda55603e8953026?s=128&d=identicon&r=PG", "display_name": "user1646637", "link": "https://stackoverflow.com/users/1646637/user1646637"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 488, "favorite_count": 0, "closed_date": 1472796810, "accepted_answer_id": 39284496, "answer_count": 1, "score": 0, "last_activity_date": 1472791676, "creation_date": 1472776802, "question_id": 39282755, "link": "https://stackoverflow.com/questions/39282755/adding-access-control-to-protobuf", "closed_reason": "Needs more focus", "title": "Adding access control to Protobuf", "body": "<p>I have been thinking of adding some sort of capability-based access control to grpc services. My idea was to have a required capability for each rpc defined in the proto file, and use grpc interceptors to check that the capability provided by the user matches that which is required by the rpc. I have looked at several documents and tutorials, but I'm at a bit of a loss as to where to start. Would appreciate any guidance.</p>\n"}, {"tags": ["go", "profiling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472831209, "post_id": 39281446, "comment_id": 65926320, "body": "The first thing I notice is that the integration tests are calling <code>exec.Command</code> to exec the docker binary directly (these are integration tests after all). You can&#39;t profile what&#39;s going on in the child processes, and the tests likely spend most of the time just waiting for these external processes."}, {"owner": {"reputation": 19007, "user_id": 444646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/996ae88559e4c401582326971c77c75a?s=128&d=identicon&r=PG", "display_name": "dnephin", "link": "https://stackoverflow.com/users/444646/dnephin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472837943, "post_id": 39281446, "comment_id": 65929901, "body": "Thanks, yes that is expected. That is why I have enabled the blocking profiler. Shouldn&#39;t it be capturing all the blocking events? Also, even if we were to say that 90% of the time was spent waiting on blocking calls, I would still expect a profile with the other 10% of the time, but the cpu profile only has a total of 140 samples! That&#39;s not even 0.05% of the time."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472841406, "post_id": 39281446, "comment_id": 65931631, "body": "Yeah, I&#39;m not sure about the rest of the possibly missing data, just that there&#39;s not going to be a whole lot of useful samples from this type of test."}, {"owner": {"reputation": 19007, "user_id": 444646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/996ae88559e4c401582326971c77c75a?s=128&d=identicon&r=PG", "display_name": "dnephin", "link": "https://stackoverflow.com/users/444646/dnephin"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472842098, "post_id": 39281446, "comment_id": 65931979, "body": "I think it could still be useful. The flamegraphs should still show slower areas.  Do you have a suggestions for an alternative way to profile this type of code?"}], "owner": {"reputation": 19007, "user_id": 444646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/996ae88559e4c401582326971c77c75a?s=128&d=identicon&r=PG", "display_name": "dnephin", "link": "https://stackoverflow.com/users/444646/dnephin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 421, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1472766825, "creation_date": 1472766825, "question_id": 39281446, "link": "https://stackoverflow.com/questions/39281446/how-to-profile-a-golang-test-suite-that-uses-the-gocheck-test-framework", "title": "How to profile a golang test suite that uses the gocheck test framework", "body": "<p>I'm attempting to profile a golang test suite that uses the <a href=\"https://labix.org/gocheck\" rel=\"nofollow\">gocheck</a> test framework.</p>\n\n<p>I'm running the following commands to start the test with profiling:</p>\n\n<pre><code>go test -c -o integration.test -cpuprofile cpu.prof -blockprofile block.prof\n./integration.test -test.cpuprofile cpu.prof -test.blockprofile block.prof\n</code></pre>\n\n<p>The test suite runs as it would normally, and produces the two expected files. The total test execution time is approxiately 50 minutes. The problem is with the contents of the files.</p>\n\n<p>If I create a report with <code>go tool pprof</code> or <a href=\"https://github.com/uber/go-torch\" rel=\"nofollow\">go-torch</a> the profiles appear to only contain data for a few seconds, instead of the entire test run (50 minutes).</p>\n\n<p>If I look at the stdout of the test runs, I notice some tests are much slower than others, and run for 50s, but those slow tests don't even appear in the profile data.</p>\n\n<p>I believe something is causing pprof to write out incorrect data, but I'm not sure what that might be. My only guess is that it has to do with <code>gocheck</code>s use of <code>panic()</code> to run every test and test fixture.</p>\n\n<p>This <a href=\"https://github.com/docker/docker/files/450711/profile1.zip\" rel=\"nofollow\">profile1.zip</a> contains: the test binary, the profiles, and a framegraph report from them.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 6785215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb6f55e98e78a4ad377de7c3c81ba8e?s=128&d=identicon&r=PG", "display_name": "Archie", "link": "https://stackoverflow.com/users/6785215/archie"}, "edited": false, "score": 0, "creation_date": 1472768192, "post_id": 39281540, "comment_id": 65897764, "body": "Thanks didn&#39;t know you could do it like that."}], "tags": [], "owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "is_accepted": true, "score": 1, "last_activity_date": 1472767316, "creation_date": 1472767316, "answer_id": 39281540, "question_id": 39281356, "link": "https://stackoverflow.com/questions/39281356/splitn-backwards/39281540#39281540", "title": "SplitN backwards?", "body": "<p>If you know that it will always end with time and then date why not just go backwards with split?</p>\n\n<p><a href=\"https://play.golang.org/p/7yhPOQHYcI\" rel=\"nofollow\">Playground link</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    s := \"I went to the shop 12:00 12/12/12\"\n    chunks := strings.Split(s, \" \")\n    time := chunks[len(chunks)-2]\n    fmt.Println(time)\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 6785215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cb6f55e98e78a4ad377de7c3c81ba8e?s=128&d=identicon&r=PG", "display_name": "Archie", "link": "https://stackoverflow.com/users/6785215/archie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 496, "favorite_count": 0, "accepted_answer_id": 39281540, "answer_count": 1, "score": 1, "last_activity_date": 1472767316, "creation_date": 1472766357, "question_id": 39281356, "link": "https://stackoverflow.com/questions/39281356/splitn-backwards", "title": "SplitN backwards?", "body": "<p>I have a string that will always start with a sentence that well change each time but end with time then date. For example \"I went to the shop 12:00 12/12/12\" or \"I like toast 11:20 13/10/14\". </p>\n\n<p>I want to extract the time out of these strings. Is it possible to do SplitN starting from the right?  </p>\n"}, {"tags": ["encryption", "go", "block-cipher"], "answers": [{"comments": [{"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 1, "creation_date": 1492190368, "post_id": 39280777, "comment_id": 73891148, "body": "Here is a good implementation of that: <a href=\"https://github.com/go-web/tokenizer/blob/master/pkcs7.go\" rel=\"nofollow noreferrer\">github.com/go-web/tokenizer/blob/master/pkcs7.go</a> (block size for AES is 16 byte)"}], "tags": [], "owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "is_accepted": true, "score": 1, "last_activity_date": 1472763537, "creation_date": 1472763537, "answer_id": 39280777, "question_id": 39280574, "link": "https://stackoverflow.com/questions/39280574/proper-way-to-add-padding-to-byte-slice-in-golang/39280777#39280777", "title": "Proper way to add padding to byte slice in golang?", "body": "<p>Looking at <a href=\"https://golang.org/pkg/crypto/cipher/\" rel=\"nofollow\">Package cipher</a> it appears like you may have to add the padding yourself, see <a href=\"https://en.wikipedia.org/wiki/Padding_(cryptography)#PKCS7\" rel=\"nofollow\">PKCS#7 padding</a>.</p>\n\n<p>Essentially add the required padding bytes with the value of each byte the number of padding byte added.</p>\n\n<p>Note that you need to add padding consistently and that means that if the data to be encrypted is an exact multiple of the block size an entire block of padding must be added since there is no way to know from the data if padding has been added or not, it is a common mistake to try to out-smart this. Consider if the last byte is 0x00, is that padding or data?</p>\n"}, {"comments": [{"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1472767226, "post_id": 39281081, "comment_id": 65897439, "body": "It really is best to use accepted methods and <a href=\"https://en.wikipedia.org/wiki/Padding_(cryptography)#PKCS7\" rel=\"nofollow noreferrer\">PKCS#7 padding</a> it a generally accepted and common method of padding symetric encryption."}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "reply_to_user": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1472767593, "post_id": 39281081, "comment_id": 65897577, "body": "@zaph good to know, i was using this for non-cryptographic applications"}], "tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": false, "score": 0, "last_activity_date": 1472765010, "creation_date": 1472765010, "answer_id": 39281081, "question_id": 39280574, "link": "https://stackoverflow.com/questions/39280574/proper-way-to-add-padding-to-byte-slice-in-golang/39281081#39281081", "title": "Proper way to add padding to byte slice in golang?", "body": "<p>here's my solution</p>\n\n<pre><code>// padOrTrim returns (size) bytes from input (bb)\n// Short bb gets zeros prefixed, Long bb gets left/MSB bits trimmed\nfunc padOrTrim(bb []byte, size int) []byte {\n    l := len(bb)\n    if l == size {\n        return bb\n    }\n    if l &gt; size {\n        return bb[l-size:]\n    }\n    tmp := make([]byte, size)\n    copy(tmp[size-l:], bb)\n    return tmp\n}\n</code></pre>\n"}], "owner": {"reputation": 988, "user_id": 6149170, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/bc071a84d9b5d4ec115745e1d0922b29?s=128&d=identicon&r=PG", "display_name": "hermancain", "link": "https://stackoverflow.com/users/6149170/hermancain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4049, "favorite_count": 1, "accepted_answer_id": 39280777, "answer_count": 2, "score": 2, "last_activity_date": 1472765010, "creation_date": 1472762630, "question_id": 39280574, "link": "https://stackoverflow.com/questions/39280574/proper-way-to-add-padding-to-byte-slice-in-golang", "title": "Proper way to add padding to byte slice in golang?", "body": "<p>I'm trying to encrypt some data in go but it's hardly ever the correct <code>cipher.BlockSize</code>.</p>\n\n<p>Is there a \"built-in\" way to add padding or should I be using a function to add it manually?</p>\n\n<p>This is my solution now:</p>\n\n<pre><code>// encrypt() encrypts the message, but sometimes the \n// message isn't the proper length, so we add padding.\nfunc encrypt(msg []byte, key []byte) []byte {        \n  cipher, err := aes.NewCipher(key)                  \n  if err != nil {                                    \n    log.Fatal(err)                                   \n  }                                                  \n\n  if len(msg) &lt; cipher.BlockSize() {                 \n    var endLength = cipher.BlockSize() - len(msg)    \n    ending := make([]byte, endLength, endLength)     \n    msg = append(msg[:], ending[:]...)               \n    cipher.Encrypt(msg, msg)                         \n  } else {                                           \n    var endLength = len(msg) % cipher.BlockSize()    \n    ending := make([]byte, endLength, endLength)     \n    msg = append(msg[:], ending[:]...)               \n    cipher.Encrypt(msg, msg)                         \n  }                                                  \n  return msg                                         \n}                                                    \n</code></pre>\n"}, {"tags": ["go", "shorthand"], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 3657564, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/435c4d3d3435ec1b17f365ce5f123cfb?s=128&d=identicon&r=PG", "display_name": "32767", "link": "https://stackoverflow.com/users/3657564/32767"}, "edited": false, "score": 0, "creation_date": 1530904731, "post_id": 39280485, "comment_id": 89414171, "body": "Thank you @icza,  That was instructive.  Apologies for the massive delay in acknowledging your response."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1472762598, "last_edit_date": 1472762598, "creation_date": 1472762253, "answer_id": 39280485, "question_id": 39280447, "link": "https://stackoverflow.com/questions/39280447/shorthand-return/39280485#39280485", "title": "Shorthand return", "body": "<p>It's an error, because the <code>++</code> and <code>--</code> in Go are statements, not expressions: <a href=\"https://golang.org/ref/spec#IncDec_statements\" rel=\"noreferrer\">Spec: IncDec Statements</a> (and statements have no results that would be returned).</p>\n\n<p>For reasoning, see Go FAQ: <a href=\"https://golang.org/doc/faq#inc_dec\" rel=\"noreferrer\">Why are ++ and -- statements and not expressions? And why postfix, not prefix?</a></p>\n\n<blockquote>\n  <p>Without pointer arithmetic, the convenience value of pre- and postfix increment operators drops. By removing them from the expression hierarchy altogether, expression syntax is simplified and the messy issues around order of evaluation of ++ and -- (consider f(i++) and p[i] = q[++i]) are eliminated as well. The simplification is significant. As for postfix vs. prefix, either would work fine but the postfix version is more traditional; insistence on prefix arose with the STL, a library for a language whose name contains, ironically, a postfix increment.</p>\n</blockquote>\n\n<p>So the code you wrote can only be written as:</p>\n\n<pre><code>func increment() int {\n    x++\n    return x\n}\n</code></pre>\n\n<p>And you have to call it without passing anything:</p>\n\n<pre><code>fmt.Println(increment())\n</code></pre>\n\n<p>Note that we would be tempted to still try to write it in one line using an assignment, e.g.:</p>\n\n<pre><code>func increment() int {\n    return x += 1 // Compile-time error!\n}\n</code></pre>\n\n<p>But this also doesn't work in Go, because the <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">assignment</a> is also a statement, and thus you get a compile-time error:</p>\n\n<blockquote>\n  <p>syntax error: unexpected += at end of statement</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 12503, "user_id": 2668545, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/qjh4R.jpg?s=128&g=1", "display_name": "ThinkBonobo", "link": "https://stackoverflow.com/users/2668545/thinkbonobo"}, "is_accepted": false, "score": 1, "last_activity_date": 1599405614, "last_edit_date": 1599405614, "creation_date": 1594915927, "answer_id": 62938974, "question_id": 39280447, "link": "https://stackoverflow.com/questions/39280447/shorthand-return/62938974#62938974", "title": "Shorthand return", "body": "<p>The accepted solution is right that the OP's code does not work because in go increment/decrement(x++/x--) statements are expressions that don't return a value.</p>\n<p>However the solution presented has a slightly different effect than the original request.</p>\n<p>x++ would return the value of x then increment in C like syntax.</p>\n<p>however the opposite would happen if you do it this way:</p>\n<pre><code>x++\nreturn x\n</code></pre>\n<p>You can negate that issue by reducing your initial value by one or by using a defer statement as written here:</p>\n<pre><code>func incr() int {\n    defer func() { counter++ }()\n    return counter\n}\n</code></pre>\n<p><a href=\"https://play.golang.org/p/rOuAv7KFJQw\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rOuAv7KFJQw</a></p>\n"}], "owner": {"reputation": 85, "user_id": 3657564, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/435c4d3d3435ec1b17f365ce5f123cfb?s=128&d=identicon&r=PG", "display_name": "32767", "link": "https://stackoverflow.com/users/3657564/32767"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1580, "favorite_count": 0, "accepted_answer_id": 39280485, "answer_count": 2, "score": 1, "last_activity_date": 1613379599, "creation_date": 1472762071, "last_edit_date": 1613379599, "question_id": 39280447, "link": "https://stackoverflow.com/questions/39280447/shorthand-return", "title": "Shorthand return", "body": "<p>The following code generates a syntax error (<strong>unexpected ++ at end of statement</strong>) in Go 1.6 or 1.7:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar x int\n\nfunc increment() int {\n        return x++   // not allowed\n}\n\nfunc main() {\n  fmt.Println( increment() )\n}\n</code></pre>\n\n<p>Shouldn't this be permitted?</p>\n"}, {"tags": ["string", "google-app-engine", "go", "google-cloud-datastore", "gql"], "comments": [{"owner": {"reputation": 10484, "user_id": 3524613, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/71de987671a207271720d862fa4caafb?s=128&d=identicon&r=PG&f=1", "display_name": "GAEfan", "link": "https://stackoverflow.com/users/3524613/gaefan"}, "edited": false, "score": 0, "creation_date": 1472760212, "post_id": 39279779, "comment_id": 65894411, "body": "Remove the trailing space: <code>&quot;Name &gt; &quot;</code> and try again."}, {"owner": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "reply_to_user": {"reputation": 10484, "user_id": 3524613, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/71de987671a207271720d862fa4caafb?s=128&d=identicon&r=PG&f=1", "display_name": "GAEfan", "link": "https://stackoverflow.com/users/3524613/gaefan"}, "edited": false, "score": 0, "creation_date": 1472760618, "post_id": 39279779, "comment_id": 65894582, "body": "the trailling space ? it is the same thing as you no?"}, {"owner": {"reputation": 10484, "user_id": 3524613, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/71de987671a207271720d862fa4caafb?s=128&d=identicon&r=PG&f=1", "display_name": "GAEfan", "link": "https://stackoverflow.com/users/3524613/gaefan"}, "edited": false, "score": 0, "creation_date": 1472760969, "post_id": 39279779, "comment_id": 65894744, "body": "Change it to: <code>&quot;Name &gt;&quot;</code>.  Also, how do you know it isn&#39;t working?  &gt;a means all letters except a.  Is that what you are getting?"}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "edited": false, "score": 0, "creation_date": 1472761696, "post_id": 39280135, "comment_id": 65895037, "body": "@Fantasim If an answer works and solves your problem, you should accpet it. You have many questions but you haven&#39;t accepted a single answer. There&#39;s a gray &quot;tick&quot;  below the votes of the answer, you can accept it by clicking on that. Hovering the mouse over that will display a text: <i>&quot;Click to accept this answer...&quot;</i>"}, {"owner": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "edited": false, "score": 0, "creation_date": 1472810177, "post_id": 39280135, "comment_id": 65912965, "body": "Could you precise in your answer why this solution doesn&#39;t work with an order filter ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "edited": false, "score": 0, "creation_date": 1472810301, "post_id": 39280135, "comment_id": 65913036, "body": "@Fantasim By &quot;order filter&quot; you mean a simple <code>.Filter(&quot;Name &gt;&quot;, &quot;li&quot;)</code>? Because this single filter will also accept <code>&quot;ljoi&quot;</code> for example, which does not have a <code>&quot;li&quot;</code> prefix. The 2nd filter <code>.Filter(&quot;Name &lt;&quot;, &quot;lj&quot;)</code> is needed to exclude everything whose prefix is &quot;beyond&quot; <code>&quot;li&quot;</code>."}, {"owner": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "edited": false, "score": 0, "creation_date": 1472810402, "post_id": 39280135, "comment_id": 65913106, "body": "q = datastore.NewQuery(&quot;Places&quot;).Filter(&quot;Name &gt;&quot;, &quot;sorb&quot;).Filter(&quot;Name &lt;&quot;, &quot;sorc&quot;).Offset(0).Limit(10).Order(&quot;-PostNb&quot;) . If i put Order(&quot;-PostNb&quot;) query get me 0 entitie"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "edited": false, "score": 1, "creation_date": 1472812460, "post_id": 39280135, "comment_id": 65914281, "body": "@Fantasim Most likely because you don&#39;t have the appropriate index. Every search / filter operates on an index. Filtering by <code>Name</code> requires the <code>Name</code> property to be indexed. If you also want the results to be ordered by <code>PostNb</code>, you need an index that includes both. Also: <i>&quot;...if a query specifies inequality filters on a property and sort orders on other properties, the property used in the inequality filters must be ordered before the other properties.&quot;</i> (<a href=\"https://cloud.google.com/appengine/docs/go/datastore/queries#sort_orders\" rel=\"nofollow noreferrer\">source</a>)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1472761034, "last_edit_date": 1472761034, "creation_date": 1472760635, "answer_id": 39280135, "question_id": 39279779, "link": "https://stackoverflow.com/questions/39279779/search-a-string-beginning-with-a-prefix-in-google-app-engine-datastore/39280135#39280135", "title": "Search a string beginning with a prefix in Google App Engine Datastore", "body": "<p>This is something that is possible, but with a combination of 2 inequality filters.</p>\n\n<p>Let's say you want to list <code>Places</code> that have the <code>\"li\"</code> prefix. This can be described with a query that lists <code>Places</code> that are greater than (or equal to) <code>\"li\"</code> <strong>and</strong> less than a prefix that is the next string after <code>\"li\"</code> in lexicographical order: <code>\"lj\"</code>.</p>\n\n<p>This is how the GQL looks like:</p>\n\n<pre><code>SELECT * FROM Places WHERE Name &gt; 'li' AND Name &lt; 'lj'\n</code></pre>\n\n<p>Coded in Go it looks like this:</p>\n\n<pre><code>q = datastore.NewQuery(\"Places\").Filter(\"Name &gt;\", \"li\").Filter(\"Name &lt;\", \"lj\")\n</code></pre>\n\n<p>This will list <code>Places</code> where name is for example:</p>\n\n<pre><code>liam\nlisotto\nlizst\n</code></pre>\n\n<p>But will exclude names like:</p>\n\n<pre><code>abc\nljoi\nlj\nqwerty\n</code></pre>\n\n<p>One thing to note: small and capital letters are different in lexicographical order, so for example <code>\"List\"</code> is less than <code>\"li\"</code> (even though <code>\"list\"</code> is greater than <code>\"li\"</code>)!</p>\n"}], "owner": {"reputation": 770, "user_id": 5347945, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/314fa7f57283b7ee9f1a207bb9d44828?s=128&d=identicon&r=PG&f=1", "display_name": "Fantasim", "link": "https://stackoverflow.com/users/5347945/fantasim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1198, "favorite_count": 0, "accepted_answer_id": 39280135, "answer_count": 1, "score": 4, "last_activity_date": 1472802074, "creation_date": 1472759295, "last_edit_date": 1472802074, "question_id": 39279779, "link": "https://stackoverflow.com/questions/39279779/search-a-string-beginning-with-a-prefix-in-google-app-engine-datastore", "title": "Search a string beginning with a prefix in Google App Engine Datastore", "body": "<p>I want to search all entities whose name starts with a specific string, is this possible in Datastore?</p>\n\n<p>I've tried this:</p>\n\n<pre><code>q = datastore.NewQuery(\"Places\").Filter(\"Name &gt; \", \"a\")\n</code></pre>\n\n<p>But it doesn't work.</p>\n\n<p>If this is not possible, what alternative solution can you suggest to me? BigQuery? BigTable or other services on App Engine?</p>\n"}, {"tags": ["go", "google-api"], "answers": [{"tags": [], "owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "is_accepted": false, "score": 0, "last_activity_date": 1473012535, "creation_date": 1473012535, "answer_id": 39319990, "question_id": 39279692, "link": "https://stackoverflow.com/questions/39279692/using-google-apis-for-google-sheets-how-to-update-a-specific-cell-based-on-crit/39319990#39319990", "title": "Using google-apis for google sheets, how to update a specific cell based on criteria", "body": "<pre><code>for rowNum, row := range resp.Values {\n    // check the value of row[0]\n    // If true then take action on the cell @ row[3]\n    if row[0] == \"Done\" {\n        rowRange := sheets.getRange(rowNum, 3)\n        spreadsheets.values.update(spreadsheetId, rowRange.getA1Notation(), update)\n    }\n}\n</code></pre>\n\n<p>This is not a tested code. <a href=\"https://developers.google.com/apps-script/reference/spreadsheet/range#geta1notation\" rel=\"nofollow\">This</a> documentation should be of help.</p>\n"}], "owner": {"reputation": 590, "user_id": 1384890, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/c050d31929bf518cf68d4b34aa4a7f3e?s=128&d=identicon&r=PG", "display_name": "Eric", "link": "https://stackoverflow.com/users/1384890/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 232, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1473012535, "creation_date": 1472758968, "last_edit_date": 1472761330, "question_id": 39279692, "link": "https://stackoverflow.com/questions/39279692/using-google-apis-for-google-sheets-how-to-update-a-specific-cell-based-on-crit", "title": "Using google-apis for google sheets, how to update a specific cell based on criteria", "body": "<p>I'm using google-apis v4 with golang and I have successfully used their getting started demo and updated it to read from my google sheet.  I would now like to read (loop) over my results and if results in row[n] match a specific criteria I'd like to get that range in A1 format so that I can then run spreadsheets.values.update(spreadsheetId, range).</p>\n\n<p>Code from the sample I'm using and trying to extend for r/w functionality.</p>\n\n<pre><code>readRange := \"WorkSheet!C4:G40\"\nresp, err := srv.Spreadsheets.Values.Get(spreadsheetID, readRange).Do()\nif err != nil {\n    log.Fatalf(\"Unable to retrieve data from sheet. %v\", err)\n}\n\nif len(resp.Values) &gt; 0 {\n    for _, row := range resp.Values {\n        fmt.Printf(\"%s, %s, %s\\n\", row[0], row[3], row[4])\n    }\n} else {\n    fmt.Print(\"No data found.\")\n}\n</code></pre>\n\n<p>What I'd like to do is take the above and add an if condition as follows:</p>\n\n<pre><code>readRange := \"WorkSheet!C4:G40\"\nresp, err := srv.Spreadsheets.Values.Get(spreadsheetID, readRange).Do()\nif err != nil {\n    log.Fatalf(\"Unable to retrieve data from sheet. %v\", err)\n}\n\nif len(resp.Values) &gt; 0 {\n    for _, row := range resp.Values {\n        // check the value of row[0]\n        // If true then take action on the cell @ row[3]\n        if row[0] == \"Done\" {\n            rowRange := row[3].A1FormattedRange  // I made this up, this is where I'm stuck.\n            spreadsheets.values.update(spreadsheetId, rowRange, update)\n        }\n    }\n} else {\n    fmt.Print(\"No data found.\")\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1858, "user_id": 4971315, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/10206972837629356/picture?type=large", "display_name": "Roberto Attias", "link": "https://stackoverflow.com/users/4971315/roberto-attias"}, "edited": false, "score": 0, "creation_date": 1472761010, "post_id": 39279427, "comment_id": 65894758, "body": "but a non-pointer method will receive a copy of the struct, which in general is both inefficient and won&#39;t allow modifications of the original struct, right?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1858, "user_id": 4971315, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/10206972837629356/picture?type=large", "display_name": "Roberto Attias", "link": "https://stackoverflow.com/users/4971315/roberto-attias"}, "edited": false, "score": 0, "creation_date": 1472762074, "post_id": 39279427, "comment_id": 65895197, "body": "@RobertoAttias: The value has to be fairly large in order for the copy to be &quot;inefficient&quot; (depending on what you mean by that, copying 4 bytes in this case is much faster than dereferencing a pointer, not to mention it&#39;s smaller than a 64bit pointer to begin with!).  And yes, if you modify the copy of a value, the changes won&#39;t be seen in another copy. But in this case, <code>String()</code> doesn&#39;t, nor should it, modify the receiver value."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 3, "last_activity_date": 1472759601, "last_edit_date": 1472759601, "creation_date": 1472757946, "answer_id": 39279427, "question_id": 39279384, "link": "https://stackoverflow.com/questions/39279384/puzzling-behavior-for-stringers/39279427#39279427", "title": "puzzling behavior for Stringers?", "body": "<p>Because you're passing an <code>IPAddr</code> value to <code>fmt.Printf</code>, your <code>String()</code> method isn't part of the method set. Your solution works if you pass in a pointer:</p>\n\n<pre><code>fmt.Printf(\"%v: %v\\n\", name, &amp;ip)\n</code></pre>\n\n<p>But a general solution is to not use a pointer receiver:</p>\n\n<pre><code>func (ip IPAddr) String() string {\n  return fmt.Sprintf(\"%d.%d.%d.%d\", ip[0], ip[1], ip[2], ip[3])\n}\n</code></pre>\n\n<p>This way the <code>String()</code> method can be used from an <code>IPAddr</code>, which is what you're passing to <code>Printf</code>, or an <code>*IPAddr</code>, which includes the methods of the value receiver. </p>\n"}, {"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1472758066, "creation_date": 1472758066, "answer_id": 39279463, "question_id": 39279384, "link": "https://stackoverflow.com/questions/39279384/puzzling-behavior-for-stringers/39279463#39279463", "title": "puzzling behavior for Stringers?", "body": "<p>Firstly, never call method receiver <code>this</code>. It's against the <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#receiver-names\" rel=\"nofollow\">Style</a>.</p>\n\n<p>Secondly, you've defined method on <code>*IPAddr</code>, not <code>IPAddr</code>. Do this:</p>\n\n<pre><code>func (ip IPAddr) String() string {\n    return fmt.Sprintf(\"%d.%d.%d.%d\", ip[0], ip[1], ip[2], ip[3])\n}\n</code></pre>\n"}], "owner": {"reputation": 1858, "user_id": 4971315, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/10206972837629356/picture?type=large", "display_name": "Roberto Attias", "link": "https://stackoverflow.com/users/4971315/roberto-attias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1472759601, "creation_date": 1472757771, "question_id": 39279384, "link": "https://stackoverflow.com/questions/39279384/puzzling-behavior-for-stringers", "title": "puzzling behavior for Stringers?", "body": "<p>New to Go, so please bear with me.</p>\n\n<p>I've been looking at the \"Tour of Go\" pages, and stumbled into something puzzling about Stringers. Consider the exercise at <a href=\"https://tour.golang.org/methods/18\" rel=\"nofollow\">https://tour.golang.org/methods/18</a></p>\n\n<p>My initial answer was implementing</p>\n\n<pre><code>func (this *IPAddr) String() string {\n  return fmt.Sprintf(\"%d.%d.%d.%d\", this[0], this[1], this[2], this[3])\n}\n</code></pre>\n\n<p>however, this is not used f main prints just <code>fmt.Printf(\"%v: %v\\n\", name, ip)</code>. If I change the print to <code>fmt.Printf(\"%v: %v\\n\", name, ip.String())</code>, then it is used whether the receiver type is <code>*IPAddr</code> or <code>IPAddr</code>). </p>\n\n<p>why is this happening?</p>\n"}, {"tags": ["unit-testing", "go", "docker", "docker-compose"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1472755908, "post_id": 39278756, "comment_id": 65892437, "body": "If you&#39;re going to &quot;cache&quot; the dependencies, do it in a vendor directory so you know exactly what version you have cached. If you don&#39;t want to use <code>vendor&#47;</code>, just copy in your GOPATH."}, {"owner": {"reputation": 19007, "user_id": 444646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/996ae88559e4c401582326971c77c75a?s=128&d=identicon&r=PG", "display_name": "dnephin", "link": "https://stackoverflow.com/users/444646/dnephin"}, "edited": false, "score": 0, "creation_date": 1472826228, "post_id": 39278756, "comment_id": 65923174, "body": "You might be interested in <a href=\"http://dnephin.github.io/dobi/\" rel=\"nofollow noreferrer\">dobi</a> as a way to run these kind of tasks. Compose is designed more for running services, where as dobi is focused on these type of build tasks."}], "answers": [{"tags": [], "owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "is_accepted": true, "score": 8, "last_activity_date": 1472766246, "creation_date": 1472766246, "answer_id": 39281333, "question_id": 39278756, "link": "https://stackoverflow.com/questions/39278756/cache-go-get-in-docker-build/39281333#39281333", "title": "Cache &quot;go get&quot; in docker build", "body": "<p>Personally I use <a href=\"https://github.com/kardianos/govendor\" rel=\"noreferrer\">govendor</a>. It keeps your dependencies in a vendor dir inside your project according to golang vendor conventions. This will still need to be copied to your docker image on build. </p>\n\n<p>But there are very good reasons not to vendor. For example when you are building a pkg you should not vendor. When you have different pkg's using different versions of dependencies things get messy. This can be remedied by only vendoring executables.</p>\n\n<p>So if you have a good reason not to vendor you can seperate a few steps.\nPutting them in the right order will speed things up.</p>\n\n<p>You can create a shell script (<code>get.sh</code>) with some <code>go get</code> commands for dependencies. (you can put these in your Dockerfile, but they have a line limit)</p>\n\n<pre><code>go get github.com/golang/protobuf/proto\ngo get github.com/pborman/uuid\ngo get golang.org/x/net/context\ngo get golang.org/x/net/http2\ngo get golang.org/x/net/http2/hpack\n</code></pre>\n\n<p>Then in your Dockerfile you first copy and execute the shell script.\nEach time you update the get.sh it will rebuild entirely. It still runs <code>got get ./...</code> to make sure all dependencies are there. But if everything is added in the <code>get.sh</code> script, you will get a decent speed boost.</p>\n\n<pre><code>FROM golang:1.6\n\nRUN mkdir -p /go/src/app\n\nCOPY get.sh /go/src/app\n\nWORKDIR /go/src/app\n\nRUN bash get.sh\n\nCOPY . /go/src/app\n\nRUN go get ./...\n\nCMD go test -v\n</code></pre>\n\n<p>The general idea is that you keep frequently changing content lower in your Dockerfile and stuff that is pretty constant at the top. Even if you have to add another command or two. Docker will go line by line until it finds something that needs a rebuild and will then do every line after that too.</p>\n"}, {"comments": [{"owner": {"reputation": 441, "user_id": 4016841, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/AHRZN.png?s=128&g=1", "display_name": "PiMaker", "link": "https://stackoverflow.com/users/4016841/pimaker"}, "edited": false, "score": 0, "creation_date": 1508972841, "post_id": 46943311, "comment_id": 80834175, "body": "That works, but ignores one part of my original question (so not sure it fits here): Your solution doesn&#39;t involve &#39;go get&#39; at all. If dependencies change you still have to rebuild the container. Either that or you also put the golang binary output folder into a volume (for persistance) - but that would be against what I was trying to do, encapsulating the entirety of the test in the container."}], "tags": [], "owner": {"reputation": 832, "user_id": 698210, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/869241fb965f7c14d56e9c1b1de1fee8?s=128&d=identicon&r=PG", "display_name": "Ramfjord", "link": "https://stackoverflow.com/users/698210/ramfjord"}, "is_accepted": false, "score": 2, "last_activity_date": 1510015103, "last_edit_date": 1510015103, "creation_date": 1508972451, "answer_id": 46943311, "question_id": 39278756, "link": "https://stackoverflow.com/questions/39278756/cache-go-get-in-docker-build/46943311#46943311", "title": "Cache &quot;go get&quot; in docker build", "body": "<p>I was looking for an answer to your question, but ironically found a question I have an answer to (how to run docker tests quickly).  If you really want fast tests, you should ideally avoid rebuilding the container at all when you run them.  But wait, how to get the new source code onto the container?  Volumes my friend, volumes.  Here's how I've set this up:</p>\n\n<p>docker-compose.dev.yml:</p>\n\n<pre><code>backend-test:\n  volumes:\n    - .:/path/to/myapp\n</code></pre>\n\n<p>Where /path/to/myapp is the path in the image, of course.  You'll have to explicitly pass in this image for dev:</p>\n\n<pre><code>docker-compose up -f docker-compose.dev.yml\n</code></pre>\n\n<p>But now, when you run your tests, you're not going to use docker-compose anymore, you're going to use docker exec:</p>\n\n<pre><code>docker exec -it backend-test go test\n</code></pre>\n\n<p>If you do this right, your src dir in the backend-test container will always be up to date because it's in fact a mounted volume.  Attaching to a running container and running tests should prove far faster than spinning up a new one each time.</p>\n\n<p>EDIT: Commenter correctly pointed out that this only avoids rebuilding the image when you're dependencies haven't changed (no need <code>go get</code>).  The nice thing is that it not only avoids rebuilding, but it also avoids restarting.  When I'm testing like this, and I add a dependency, I typically just <code>go get</code> directly from my test console. It can be a bit tricky to get <code>go get</code> to work within your container, but one way is to forward your ssh agent through to your container by <a href=\"https://gist.github.com/d11wtq/8699521\" rel=\"nofollow noreferrer\">mounting SSH_AUTH_SOCK</a>.  Sadly, you can't mount volumes during build, so you may need to include some kind of deploy key in your image if you want your build target to be able to pull fresh dependencies before running tests.  However, The main point of my answer was to separate out the build and test, to avoid the full build until you're ready to generate the final artifact.</p>\n\n<p>That said, I think I <em>might</em> understand that I'm not answering the question in the way that you asked it.  In ruby, the answer would be as simple as copying the Gemfile and Gemfile.lock, and running <code>bundle install --deploy</code>, before copying over the code you've changed.  Personally I don't mind the cost of rebuilding when I add dependencies, since 99% of my changes still won't involve a rebuild.  That said, you might look into using golang's new Bundler inspired dependency manager: <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a>.  With dep installed, I'm pretty sure you can just copy your <code>Gopkg.toml</code> and <code>Gopkg.lock</code> into your workdir, run <code>dep ensure</code>, and then copy your code.  This will only pull dependencies when the Gopkg has been updated - otherwise docker will be able to reuse the cached layer with your previous dependencies installed.  Sorry for the long edit!</p>\n"}], "owner": {"reputation": 441, "user_id": 4016841, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/AHRZN.png?s=128&g=1", "display_name": "PiMaker", "link": "https://stackoverflow.com/users/4016841/pimaker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6481, "favorite_count": 2, "accepted_answer_id": 39281333, "answer_count": 2, "score": 11, "last_activity_date": 1510015103, "creation_date": 1472755409, "question_id": 39278756, "link": "https://stackoverflow.com/questions/39278756/cache-go-get-in-docker-build", "title": "Cache &quot;go get&quot; in docker build", "body": "<p>I want to encapsulate my golang unit testing in a docker-compose script because it depends on several external services. My application has quite a lot of dependencies, so it takes a while to <code>go get</code>.</p>\n\n<p>How can I cache packages in a way that allows the docker container to build without having to download all dependencies every time I want to test?</p>\n\n<p>My Dockerfile:</p>\n\n<pre><code>FROM golang:1.7\n\nCMD [\"go\", \"test\", \"-v\"]\n\nRUN mkdir -p /go/src/app\nWORKDIR /go/src/app\n\nCOPY . /go/src/app\nRUN go-wrapper download\nRUN go-wrapper install\n</code></pre>\n\n<p>Every time I want to run my unit tests I run <code>docker-compose up --build backend-test</code> on the following script:</p>\n\n<pre><code>version: '2'\nservices:\n  ...\n  backend-test:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    image: backend-test\n    depends_on:\n      ...\n</code></pre>\n\n<p>But now <code>go-wrapper download</code> is called each time I want to run the tests and it takes a looong time to complete.</p>\n\n<p>Solutions? Thanks in advance!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 372, "user_id": 2397226, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ecf8aae1b1c82da6448fdac37204319e?s=128&d=identicon&r=PG", "display_name": "MrX", "link": "https://stackoverflow.com/users/2397226/mrx"}, "edited": false, "score": 0, "creation_date": 1472759480, "post_id": 39279592, "comment_id": 65894092, "body": "So technically if I&#39;m understanding correctly <code>horzMatrix</code> is just allocating references to the interface (only pointer allocation) no actual allocation to the physical data structure which is actually going to hold the physical payload is done   Only when assignment <code>horzMatrix[row][column]</code> is the allocation to the actual <code>LocatableElement</code> done. (where the LocatableElement structure is allocated and created and the pointer created previously is made to point to the newly allocated structure)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 372, "user_id": 2397226, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ecf8aae1b1c82da6448fdac37204319e?s=128&d=identicon&r=PG", "display_name": "MrX", "link": "https://stackoverflow.com/users/2397226/mrx"}, "edited": false, "score": 0, "creation_date": 1472765406, "post_id": 39279592, "comment_id": 65896709, "body": "@MrX, <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">more background</a> on your issue."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 1, "last_activity_date": 1472766394, "last_edit_date": 1472766394, "creation_date": 1472758540, "answer_id": 39279592, "question_id": 39278725, "link": "https://stackoverflow.com/questions/39278725/creating-a-slice-of-concrete-types-and-casting-to-its-respective-interface/39279592#39279592", "title": "Creating a Slice of Concrete Types and Casting to its Respective Interface", "body": "<p>You can't neither cast <code>[]ConcreteTypes([]Interfaces)</code> nor assert <code>[]Interfaces.([]ConcreteTypes)</code> nevertheless  <code>ConcreteTypes</code> implements <code>Interfaces</code>. You should either define container</p>\n\n<pre><code>type Matrix interface{\n    GetElem(abs, ord int) MatrixElement \n}\n</code></pre>\n\n<p>and satisfy it for <code>HorizontalMatrix</code> or make matrix as []interface</p>\n\n<pre><code>horzMatrix := make([][]matrix.MatrixElement, rows)\nhorzMatrix[i] = make([]matrix.MatrixElement, columns)\n</code></pre>\n\n<p>and than populate it with concrete type <code>LocatableElement</code></p>\n"}], "owner": {"reputation": 372, "user_id": 2397226, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ecf8aae1b1c82da6448fdac37204319e?s=128&d=identicon&r=PG", "display_name": "MrX", "link": "https://stackoverflow.com/users/2397226/mrx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 39279592, "answer_count": 1, "score": 1, "last_activity_date": 1472766394, "creation_date": 1472755243, "question_id": 39278725, "link": "https://stackoverflow.com/questions/39278725/creating-a-slice-of-concrete-types-and-casting-to-its-respective-interface", "title": "Creating a Slice of Concrete Types and Casting to its Respective Interface", "body": "<p>Having some issues creating a slice of interfaces and initiating it to its concrete type, any help would be greatly appretiated</p>\n\n<p>Interface</p>\n\n<pre><code>type MatrixElement interface {\n    GetValue() Element\n    GetCoordinate() Coordinate\n}\n</code></pre>\n\n<p>Concrete Implementation</p>\n\n<pre><code>type LocatableElement struct {\n    value datastructures.Element\n    coordinate datastructures.Coordinate\n}\n\nfunc (ele LocatableElement)GetValue() datastructures.Element {\n    return ele.value\n}\n\nfunc (ele LocatableElement)GetCoordinate() datastructures.Coordinate {\n    return ele.coordinate\n}\n\nfunc CreateLocatableElement(value datastructures.Element, coordinate datastructures.Coordinate) LocatableElement {\n    return LocatableElement{\n        value: value,\n        coordinate: coordinate,\n    }\n}\n</code></pre>\n\n<p>Defining the Type as a slice</p>\n\n<pre><code>type HorizontalMatrix [][]datastructures.MatrixElement\n</code></pre>\n\n<p>Creating an instance of the new HorizonatlMatrix</p>\n\n<pre><code>func CreateHorizontalMatrix(rows int, columns int) HorizontalMatrix {\n    horzMatrix := make([][]matrix.LocatableElement, rows)\n    for i := 0; i &lt; rows; i++ {\n        horzMatrix[i] = make([]matrix.LocatableElement, columns)\n    }\n    return horzMatrix;\n}\n</code></pre>\n\n<p><code>cannot use horzMatrix (type [][]matrix.LocatableElement) as type HorizontalMatrix in return argument</code></p>\n"}, {"tags": ["go", "hugo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1472747729, "post_id": 39276675, "comment_id": 65888075, "body": "I think what you&#39;re looking for is here: <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org/pkg/text/template</a>"}, {"owner": {"reputation": 153, "user_id": 3036721, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/2febd2b9ad3c37091344c2592ee722f3?s=128&d=identicon&r=PG&f=1", "display_name": "asebold", "link": "https://stackoverflow.com/users/3036721/asebold"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1472748556, "post_id": 39276675, "comment_id": 65888524, "body": "@JimB This is helpful, thank you"}, {"owner": {"reputation": 1754, "user_id": 3943954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aYknv.png?s=128&g=1", "display_name": "revelt", "link": "https://stackoverflow.com/users/3943954/revelt"}, "edited": false, "score": 0, "creation_date": 1473134142, "post_id": 39276675, "comment_id": 66011741, "body": "@asebold do you need to do something specific with frontmatter fields (iterate or sort them for example) or do you just simply want to have extra custom fields in each .md?"}, {"owner": {"reputation": 153, "user_id": 3036721, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/2febd2b9ad3c37091344c2592ee722f3?s=128&d=identicon&r=PG&f=1", "display_name": "asebold", "link": "https://stackoverflow.com/users/3036721/asebold"}, "reply_to_user": {"reputation": 1754, "user_id": 3943954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aYknv.png?s=128&g=1", "display_name": "revelt", "link": "https://stackoverflow.com/users/3943954/revelt"}, "edited": false, "score": 0, "creation_date": 1473175658, "post_id": 39276675, "comment_id": 66035230, "body": "@revelt it looks like we&#39;re going to go with custom fields."}, {"owner": {"reputation": 1754, "user_id": 3943954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aYknv.png?s=128&g=1", "display_name": "revelt", "link": "https://stackoverflow.com/users/3943954/revelt"}, "edited": false, "score": 0, "creation_date": 1473947229, "post_id": 39276675, "comment_id": 66341317, "body": "It depends what flavour of front matter you prefer, but it&#39;s simple, declare variable in article&#39;s <code>.md</code> file, like <code>video: &quot;your_url&#39;</code>, then reference it anywhere within the ranged partial: <code>{{ if .Params.video }}{{ .Params.video }}{{ end }}</code>. Is this what you&#39;re looking for specifically?"}], "answers": [{"tags": [], "owner": {"reputation": 3415, "user_id": 5287638, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AzeH8.png?s=128&g=1", "display_name": "Jack Taylor", "link": "https://stackoverflow.com/users/5287638/jack-taylor"}, "is_accepted": false, "score": 0, "last_activity_date": 1492913855, "creation_date": 1492913855, "answer_id": 43566718, "question_id": 39276675, "link": "https://stackoverflow.com/questions/39276675/documentation-for-hugo-syntax-inside-of-handlebars/43566718#43566718", "title": "Documentation for Hugo syntax inside of handlebars?", "body": "<p>These are functions that have specifically been made available to Go templates (you can't just use any Go functions). They include the built-in functions documented in the <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">golang.org template docs</a> which JimB linked to in his comment, and also Hugo-specific functions which are documented on the <a href=\"https://gohugo.io/templates/functions/\" rel=\"nofollow noreferrer\">Hugo template functions page</a>.</p>\n"}], "owner": {"reputation": 153, "user_id": 3036721, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/2febd2b9ad3c37091344c2592ee722f3?s=128&d=identicon&r=PG&f=1", "display_name": "asebold", "link": "https://stackoverflow.com/users/3036721/asebold"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 507, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1492913855, "creation_date": 1472747613, "question_id": 39276675, "link": "https://stackoverflow.com/questions/39276675/documentation-for-hugo-syntax-inside-of-handlebars", "title": "Documentation for Hugo syntax inside of handlebars?", "body": "<p>I'm trying to build a site with Hugo and having a hard time understanding some of their documentation. Specifically, when displaying frontmatter in a template. </p>\n\n<p>There are functions you can preform on variables inside the handle bars. ex: {{ range .Data.Pages }} What is range? I can't find any documentation on what these functions do. Or is it just plain Go code and anything Go is fair game? Just looking for documentation so I can figure out what I need. </p>\n"}, {"tags": ["unit-testing", "go", "mocking"], "answers": [{"tags": [], "owner": {"reputation": 750, "user_id": 2809739, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ymnxe.jpg?s=128&g=1", "display_name": "Sachin Nambiar Nalavattanon", "link": "https://stackoverflow.com/users/2809739/sachin-nambiar-nalavattanon"}, "is_accepted": true, "score": -1, "last_activity_date": 1473012721, "creation_date": 1473012721, "answer_id": 39320024, "question_id": 39274088, "link": "https://stackoverflow.com/questions/39274088/getting-error-in-sqlmock-for-golang/39320024#39320024", "title": "Getting error in sqlmock for GoLang", "body": "<p>The error message means some SQL query was called which was not mocked.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7053511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66cd35981be74eaf68a90f1802bb39a0?s=128&d=identicon&r=PG&f=1", "display_name": "Proton14", "link": "https://stackoverflow.com/users/7053511/proton14"}, "is_accepted": false, "score": 1, "last_activity_date": 1477944159, "creation_date": 1477944159, "answer_id": 40349696, "question_id": 39274088, "link": "https://stackoverflow.com/questions/39274088/getting-error-in-sqlmock-for-golang/40349696#40349696", "title": "Getting error in sqlmock for GoLang", "body": "<p>sqlmock expected a begin, but instead got something else. Show the function and test here for more info.</p>\n"}], "owner": {"reputation": 539, "user_id": 1386755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/847e12d5214e6c9ec2a46d0715cea1ff?s=128&d=identicon&r=PG", "display_name": "Vivek Srivastava", "link": "https://stackoverflow.com/users/1386755/vivek-srivastava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2409, "favorite_count": 0, "accepted_answer_id": 39320024, "answer_count": 2, "score": 0, "last_activity_date": 1582619560, "creation_date": 1472739627, "question_id": 39274088, "link": "https://stackoverflow.com/questions/39274088/getting-error-in-sqlmock-for-golang", "title": "Getting error in sqlmock for GoLang", "body": "<p>I am writing test cases for a GoLang application and i am using sqlmock for mocking the SQL queries but i am getting following error while executing <strong>go test</strong></p>\n\n<p>Params: [ call to query , was not expected, next expectation is: ExpectedBegin => expecting database transaction Begin]</p>\n\n<p>Any idea on this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1472738954, "post_id": 39273490, "comment_id": 65882234, "body": "Show the code for the request handler and where you added the call to set the header."}, {"owner": {"reputation": 21011, "user_id": 353612, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a7716a3557d0feabd739cd930875fb?s=128&d=identicon&r=PG", "display_name": "greg0ire", "link": "https://stackoverflow.com/users/353612/greg0ire"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1472738991, "post_id": 39273490, "comment_id": 65882261, "body": "I just did I think :)"}, {"owner": {"reputation": 1786, "user_id": 4099287, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-OMz777BPLQI/AAAAAAAAAAI/AAAAAAAAFcM/tV8IW2TybOw/photo.jpg?sz=128", "display_name": "Kevin M Granger", "link": "https://stackoverflow.com/users/4099287/kevin-m-granger"}, "edited": false, "score": 5, "creation_date": 1472739094, "post_id": 39273490, "comment_id": 65882335, "body": "Is the ResponseWriter modified anywhere else before it gets to this function?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1472739121, "post_id": 39273490, "comment_id": 65882363, "body": "That looks correct at first glance. Are you sure you&#39;re testing the updated code?"}, {"owner": {"reputation": 21011, "user_id": 353612, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a7716a3557d0feabd739cd930875fb?s=128&d=identicon&r=PG", "display_name": "greg0ire", "link": "https://stackoverflow.com/users/353612/greg0ire"}, "edited": false, "score": 0, "creation_date": 1472739175, "post_id": 39273490, "comment_id": 65882401, "body": "JimB I just added a log and it does not appear after using the attach trick described in the linked thread, so I&#39;ll try again with <code>--no-cache</code>"}, {"owner": {"reputation": 21011, "user_id": 353612, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a7716a3557d0feabd739cd930875fb?s=128&d=identicon&r=PG", "display_name": "greg0ire", "link": "https://stackoverflow.com/users/353612/greg0ire"}, "reply_to_user": {"reputation": 1786, "user_id": 4099287, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-OMz777BPLQI/AAAAAAAAAAI/AAAAAAAAFcM/tV8IW2TybOw/photo.jpg?sz=128", "display_name": "Kevin M Granger", "link": "https://stackoverflow.com/users/4099287/kevin-m-granger"}, "edited": false, "score": 0, "creation_date": 1472739210, "post_id": 39273490, "comment_id": 65882423, "body": "@KevinMGranger : I don&#39;t know, can you explain why that would matter? Do you mean I wouldn&#39;t be able to overwrite an existing header?"}, {"owner": {"reputation": 3800, "user_id": 1037465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b68d0fdfc74f6a893936d043d2f545b?s=128&d=identicon&r=PG", "display_name": "a-h", "link": "https://stackoverflow.com/users/1037465/a-h"}, "edited": false, "score": 0, "creation_date": 1472739276, "post_id": 39273490, "comment_id": 65882475, "body": "You have to be careful that other middleware in the chain hasn&#39;t written to the body, since this forces the headers to be written out, after which they can&#39;t be modified."}, {"owner": {"reputation": 21011, "user_id": 353612, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a7716a3557d0feabd739cd930875fb?s=128&d=identicon&r=PG", "display_name": "greg0ire", "link": "https://stackoverflow.com/users/353612/greg0ire"}, "edited": false, "score": 1, "creation_date": 1472739319, "post_id": 39273490, "comment_id": 65882517, "body": "Yay! It finally works! Thanks to the <code>w.WriteHeader(http.StatusOK)</code> aacebedo made me add. You can get easy internet points if you want by answering that :)"}, {"owner": {"reputation": 21011, "user_id": 353612, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a7716a3557d0feabd739cd930875fb?s=128&d=identicon&r=PG", "display_name": "greg0ire", "link": "https://stackoverflow.com/users/353612/greg0ire"}, "edited": false, "score": 0, "creation_date": 1472739387, "post_id": 39273490, "comment_id": 65882564, "body": "Also, I&#39;m moving this logic after the if clause to avoid using json for the error message."}, {"owner": {"reputation": 21011, "user_id": 353612, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a7716a3557d0feabd739cd930875fb?s=128&d=identicon&r=PG", "display_name": "greg0ire", "link": "https://stackoverflow.com/users/353612/greg0ire"}, "edited": false, "score": 0, "creation_date": 1472739484, "post_id": 39273490, "comment_id": 65882639, "body": "Thanks a-h, it wasn&#39;t the case apparently, but it makes sense!"}], "answers": [{"tags": [], "owner": {"reputation": 673, "user_id": 1595262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82cb7b22459aaa7eae5f8a3a0c6bf91?s=128&d=identicon&r=PG", "display_name": "Itamar Lavender", "link": "https://stackoverflow.com/users/1595262/itamar-lavender"}, "is_accepted": false, "score": 7, "last_activity_date": 1560685936, "creation_date": 1560685936, "answer_id": 56618564, "question_id": 39273490, "link": "https://stackoverflow.com/questions/39273490/adding-a-header-to-a-responsewriter/56618564#56618564", "title": "Adding a header to a ResponseWriter", "body": "<p>if somebody hit this issue, the next info might be helpful.</p>\n\n<p>the reason this wasn't working is the status code was written out before the attempt to add the content-type header.</p>\n\n<p>to make it work, all headers should be added before w.WriteHeader(status code) is being invoked.\nexample:</p>\n\n<pre><code>w.Header().Add(\"Content-Type\", \"application/json\")\nw.WriteHeader(http.StatusOK)\nencoder := json.NewEncoder(w)\nencoder.SetEscapeHTML(false)\nif err := encoder.Encode(s.list.GetAllServices()); err != nil {\n    panic(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 21011, "user_id": 353612, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/66a7716a3557d0feabd739cd930875fb?s=128&d=identicon&r=PG", "display_name": "greg0ire", "link": "https://stackoverflow.com/users/353612/greg0ire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3220, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1560685936, "creation_date": 1472738177, "last_edit_date": 1495540301, "question_id": 39273490, "link": "https://stackoverflow.com/questions/39273490/adding-a-header-to-a-responsewriter", "title": "Adding a header to a ResponseWriter", "body": "<p>I'm trying to contribute a fix for <a href=\"https://github.com/tonistiigi/dnsdock/issues/68\" rel=\"nofollow noreferrer\">this issue</a>, and tried something similar to <a href=\"https://stackoverflow.com/questions/12830095/setting-http-headers-in-golang/12830156#12830156\">this</a>, but no matter what header I try to set, I don't see it in the http response I am trying to modify.</p>\n\n<p><a href=\"https://github.com/tonistiigi/dnsdock/blob/master/src/http.go#L43\" rel=\"nofollow noreferrer\">This</a> is the method I'm trying to change, and here is the line I tried to add : </p>\n\n<p><code>w.Header().Set(\"Content-Type\", \"application/json\")</code>.</p>\n\n<p>The full method : </p>\n\n<pre><code>func (s *HTTPServer) getServices(w http.ResponseWriter, req *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    if err := json.NewEncoder(w).Encode(s.list.GetAllServices()); err != nil {\n        log.Println(\"Error encoding: \", err)\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n}\n</code></pre>\n\n<p>I would expect the header to change, but it always is <code>text/plain; charset=utf-8</code></p>\n\n<p>Disclaimer: this is the first piece of code I wrote (or rather, copy/pasted/adapted) in Go.</p>\n"}, {"tags": ["php", "go", "cryptography", "aes"], "comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472737452, "post_id": 39273002, "comment_id": 65880998, "body": "fmt.Printf(&quot;%x\\n&quot;, ciphertext[aes.BlockSize:])"}, {"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472741419, "post_id": 39273002, "comment_id": 65884094, "body": "The output ciphertext from Go seems to be decrypt correctly back to the original plain text. See <a href=\"https://play.golang.org/p/LmL4N1J0Aq\" rel=\"nofollow noreferrer\">here</a>. Can&#39;t say same for php ciphertext"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472745168, "post_id": 39273002, "comment_id": 65886692, "body": "php info <a href=\"https://gist.github.com/andrewarrow/2cb9484a3d0f0f7f1db24660e406a755\" rel=\"nofollow noreferrer\">gist.github.com/andrewarrow/2cb9484a3d0f0f7f1db24660e406a755</a>"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472745538, "post_id": 39273002, "comment_id": 65886880, "body": "full source <a href=\"https://github.com/Marfjeh/ALA-Reken/blob/c1c8926648ab33b1320c3b4d63c60d4a9c73de56/src/phpmyadmin/libraries/phpseclib/Crypt/Rijndael.php\" rel=\"nofollow noreferrer\">github.com/Marfjeh/ALA-Reken/blob/&hellip;</a>"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472747275, "post_id": 39273002, "comment_id": 65887822, "body": "better link <a href=\"https://github.com/andrewarrow/phpseclib1/blob/master/Crypt/AES.php\" rel=\"nofollow noreferrer\">github.com/andrewarrow/phpseclib1/blob/master/Crypt/AES.php</a>"}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472747506, "post_id": 39273002, "comment_id": 65887948, "body": "i updated the question with example php code to show problem."}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1472748282, "post_id": 39273002, "comment_id": 65888386, "body": "Again, I am asking to use an explicit for the IV so it can be distinguished from 0x00 bytes. That will show if the IV is prefixing the encrypted data for the Go case."}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1472751354, "post_id": 39273002, "comment_id": 65890029, "body": "by explicit iv do you mean adding something like &quot;io.ReadFull(bytes.NewReader([]byte{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16}), iv)&quot; ? So I tried that and get very different output: 0102030405060708090a0b0c0d0e0f10b2439c71f018c42cfae730f9a9c4&zwnj;&#8203;9a4584c2e432dcc6e06f&zwnj;&#8203;ac5d13d1b39aeb11"}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 1, "creation_date": 1472761043, "post_id": 39273002, "comment_id": 65894773, "body": "Yes, and you will get a different output, that is the point of an IV, which should be a random value so that the same message wil lnot have the same encrypted data. As you can see the IV is sent prefixed to the encrypted data, that is used for the IV when decrypting."}], "answers": [{"comments": [{"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1472745673, "post_id": 39273277, "comment_id": 65886964, "body": "i get more zeros on the end, but still don&#39;t get the missing data php has."}, {"owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "edited": false, "score": 0, "creation_date": 1472747524, "post_id": 39273277, "comment_id": 65887956, "body": "i updated the question with example php code to show problem"}], "tags": [], "owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "is_accepted": false, "score": 1, "last_activity_date": 1472740255, "last_edit_date": 1472740255, "creation_date": 1472737604, "answer_id": 39273277, "question_id": 39273002, "link": "https://stackoverflow.com/questions/39273002/how-do-i-match-phpseclib1-rijndael-php-cbc-aes-encryption-in-golang/39273277#39273277", "title": "How do I match phpseclib1 Rijndael.php CBC AES encryption in golang?", "body": "<p>It is not a shifting problem, it is an output buffer size problem due to the prefixing of the iv to the encrypted data.</p>\n\n<p>The IV is a block of nulls (0x00) since it is never set to a value. It is prepended to the encrypted data, that is common. A block of padding needs to be added since the input data is an exact multiple of the block size.</p>\n\n<p>This the output buffer needs to be the size of the iv + the size of the data + the size of the padding block. (16 + 32 + 16 = 64)</p>\n\n<p>Add another block size to the output buffer:</p>\n\n<pre><code>ciphertext := make([]byte, aes.BlockSize + len(plaintext) + aes.BlockSize)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1472760931, "post_id": 39278469, "comment_id": 65894723, "body": "That is [PKCS#7 padding](PKCS#7 padding). AES is a block cipher and required input to be in exact multiples of the block size, 16-bytes. Padding is needed when the input is not an exact multiple of the block size and when using padding every encryption must be padded which means adding padding even when the input is an exact multiple of the block. The padding bytes are the integer value of the number of padding bytes. In your case one block of padding is being added, 16 bytes, tyhat is why there are 16 bytes of padding with the value 16."}], "tags": [], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "is_accepted": false, "score": -1, "last_activity_date": 1472754139, "creation_date": 1472754139, "answer_id": 39278469, "question_id": 39273002, "link": "https://stackoverflow.com/questions/39273002/how-do-i-match-phpseclib1-rijndael-php-cbc-aes-encryption-in-golang/39278469#39278469", "title": "How do I match phpseclib1 Rijndael.php CBC AES encryption in golang?", "body": "<p>The PHP version was encoding an extra 16 bytes of an \"empty\" string that was filled with 16s!</p>\n\n<pre><code>  p1 := \"0000000000000tha\"\n  p2 := \"nkustackoverflow\"\n\n  p1b := []byte(p1)\n  p2b := []byte(p2)\n  p3b, _ := hex.DecodeString(\"10101010101010101010101010101010\")\n  fmt.Println(p3b)\n\n  key := []byte(\"abcdefghijklmnop\")\n  block, _ := aes.NewCipher(key)\n  ciphertext := make([]byte, aes.BlockSize+16)\n  iv := ciphertext[:aes.BlockSize]\n  mode := cipher.NewCBCEncrypter(block, iv)\n\n  i := 0\n  for {\n    if i == 0 {\n      mode.CryptBlocks(ciphertext[aes.BlockSize:], p1b)\n    } else if i == 1 {\n      mode.CryptBlocks(ciphertext[aes.BlockSize:], p2b)\n    } else if i == 2 {\n      mode.CryptBlocks(ciphertext[aes.BlockSize:], p3b)\n    }\n    fmt.Printf(\"%x\\n\", ciphertext[16:])\n    i += 1\n    if i &gt; 2 {\n      break\n    }\n  }\n</code></pre>\n\n<p>This code prints the <code>identical</code> stuff in golang that php is.</p>\n"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1472759083, "creation_date": 1472736820, "last_edit_date": 1472759083, "question_id": 39273002, "link": "https://stackoverflow.com/questions/39273002/how-do-i-match-phpseclib1-rijndael-php-cbc-aes-encryption-in-golang", "title": "How do I match phpseclib1 Rijndael.php CBC AES encryption in golang?", "body": "<p>I am encrypting like:</p>\n\n<pre><code>  plaintextstr := \"0000000000000thankustackoverflow\"\n  plaintext := []byte(plaintextstr)\n\n  key := []byte(\"abcdefghijklmnop\")\n  block, _ := aes.NewCipher(key)\n\n  ciphertext := make([]byte, aes.BlockSize+len(plaintext))\n  iv := ciphertext[:aes.BlockSize]\n\n  mode := cipher.NewCBCEncrypter(block, iv)\n  mode.CryptBlocks(ciphertext[aes.BlockSize:], plaintext)\n  fmt.Printf(\"%x\\n\", ciphertext)\n</code></pre>\n\n<p>and the output is:</p>\n\n<p>00000000000000000000000000000000d77aa6646bb541808ed23c88d4b06d30f42b01d6e806a02b29086bc82892334f</p>\n\n<p>but the output from another version of this code writen in PHP is:</p>\n\n<p>d77aa6646bb541808ed23c88d4b06d30f42b01d6e806a02b29086bc82892334fbf21ea861abbc3d72e44731978bb76c2</p>\n\n<p>Notice the 00000000000000000000000000000000 is the exact length of the missing data at the end. And it's 32, the size of the orig plaintextstr. Any idea how to left shift all that in golang and get the missing data?</p>\n\n<p>PHP:</p>\n\n<pre><code>&lt;?php\n\ninclude('Crypt/AES.php');\n\n$aes = new Crypt_AES();\n\n$aes-&gt;setKey('abcdefghijklmnop');\necho bin2hex($aes-&gt;encrypt(\"0000000000000thankustackoverflow\"));\n</code></pre>\n\n<p><a href=\"https://github.com/andrewarrow/phpseclib1/blob/master/Crypt/AES.php\" rel=\"nofollow\">https://github.com/andrewarrow/phpseclib1/blob/master/Crypt/AES.php</a>\n<a href=\"https://github.com/andrewarrow/phpseclib1/blob/master/Crypt/Rijndael.php\" rel=\"nofollow\">https://github.com/andrewarrow/phpseclib1/blob/master/Crypt/Rijndael.php</a></p>\n\n<p>Debug php output:</p>\n\n<pre><code>00000000000000000000000000000000 &lt;--- IV\n30303030303030303030303030746861 block 0\nd77aa6646bb541808ed23c88d4b06d30 crypted 0\n6e6b75737461636b6f766572666c6f77 block 16\nf42b01d6e806a02b29086bc82892334f crypted 16\n10101010101010101010101010101010 block 32\nbf21ea861abbc3d72e44731978bb76c2 crypted 32\n</code></pre>\n"}, {"tags": ["url", "go", "escaping"], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 2, "last_activity_date": 1472732135, "creation_date": 1472732135, "answer_id": 39271327, "question_id": 39270633, "link": "https://stackoverflow.com/questions/39270633/why-does-url-parse-not-populate-url-rawpath/39271327#39271327", "title": "Why does url.Parse not populate URL.RawPath?", "body": "<p>Just use <code>func(*URL)EscapedPath()</code></p>\n\n<pre><code>fmt.Println(u.EscapedPath()) //give you expected result\n</code></pre>\n\n<p>From package spec</p>\n\n<blockquote>\n  <p>In general, code should call EscapedPath instead of reading u.RawPath\n  directly.</p>\n</blockquote>\n\n<p>And from source comments</p>\n\n<pre><code>// RawPath is a hint as to the encoding of Path to use\n// in url.EscapedPath. If that method already gets the\n// right answer without RawPath, leave it empty.\n// This will help make sure that people don't rely on it in general. \n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472734907, "post_id": 39271353, "comment_id": 65879009, "body": "Doesn&#39;t a &#39;%&#39; need to be escaped in a query ? If not, why does url.Encode then change a &#39;%&#39; to &#39;%25&#39; in a query ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "edited": false, "score": 0, "creation_date": 1472735261, "post_id": 39271353, "comment_id": 65879269, "body": "@Sridhar Yes (if it is part of the param name or value). But the question here was: why does <code>%25</code> prevent <code>URL.RawPath</code> being filled, contrary to <code>%2f</code> which does not prevent it. And the answer is that because <code>%25</code> renders the path invalid based on the criteria listed in the answer, while <code>%2f</code> does not."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1472798950, "last_edit_date": 1472798950, "creation_date": 1472732189, "answer_id": 39271353, "question_id": 39270633, "link": "https://stackoverflow.com/questions/39270633/why-does-url-parse-not-populate-url-rawpath/39271353#39271353", "title": "Why does url.Parse not populate URL.RawPath?", "body": "<p>Note that <code>URL.RawPath</code> is not the raw (escaped) path. It <em>may</em> be, but not always. It's just a <em>hint</em>. Its doc says:</p>\n\n<pre><code>RawPath    string // encoded path hint (Go 1.5 and later only; see EscapedPath method)\n</code></pre>\n\n<p>So when you need the escaped path, always use <a href=\"https://golang.org/pkg/net/url/#URL.EscapedPath\" rel=\"nofollow\"><code>URL.EscapedPath()</code></a> and don't rely on the <code>URL.RawPath</code> field. Doc of <code>URL.EscapedPath()</code> says:</p>\n\n<blockquote>\n  <p>EscapedPath returns u.RawPath <strong>when it is a valid escaping of u.Path</strong>.</p>\n</blockquote>\n\n<p>This is your case. A raw path is invalid if it contains bytes that need escaping during URL encoding. Your path is such an example because it contains <code>%25</code> which is the URL escaped text of the percent symbol itself <code>'%'</code>, and percent symbols need to be escaped if part of URL paths.</p>\n\n<p>Your first example contained <code>%2f</code> which is the URL escaped text of the  slash<code>'/'</code> which if present in a path does not need to be escaped (<code>'/'</code> is a valid character in paths and is treated as a separator).</p>\n\n<p>See this example:</p>\n\n<pre><code>u, err = url.Parse(\"https://example.com/foo%25fbar?q=morefoo%25bar\")\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(\"Path:       \", u.Path)\nfmt.Println(\"RawPath:    \", u.RawPath)\nfmt.Println(\"EscapedPath:\", u.EscapedPath())\nfmt.Println(\"RawQuery:   \", u.RawQuery)\nfmt.Println(\"String:     \", u.String())\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/YZC2Xq35Yt\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>Path:        /foo%fbar\nRawPath:     \nEscapedPath: /foo%25fbar\nRawQuery:    q=morefoo%25bar\nString:      https://example.com/foo%25fbar?q=morefoo%25bar\n</code></pre>\n\n<p><code>RawPath</code> is the empty string (because <code>\"/foo%25fbar\"</code> is an invalid escaped path), but <code>EscapedPath()</code> returns you the original escaped path.</p>\n"}], "owner": {"reputation": 2084, "user_id": 1093710, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/0c2c2a8067de0b33d2733bc4225568af?s=128&d=identicon&r=PG", "display_name": "Sridhar", "link": "https://stackoverflow.com/users/1093710/sridhar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1404, "favorite_count": 0, "accepted_answer_id": 39271353, "answer_count": 2, "score": 5, "last_activity_date": 1472798950, "creation_date": 1472730141, "last_edit_date": 1472730492, "question_id": 39270633, "link": "https://stackoverflow.com/questions/39270633/why-does-url-parse-not-populate-url-rawpath", "title": "Why does url.Parse not populate URL.RawPath?", "body": "<p>While with similar input, URL.RawQuery seems to be properly populated.</p>\n\n<p><a href=\"https://play.golang.org/p/C9vFvAsxvW\" rel=\"noreferrer\">Playground</a></p>\n\n<pre><code>u, err := url.Parse(\"https://example.com/foo%2fbar\")\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(u.Path)\nfmt.Println(u.RawPath)\nfmt.Println(u.String(), \"\\n\")\n\nu, err = url.Parse(\"https://example.com/foo%25fbar?q=morefoo%25bar\")\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Println(u.Path)\nfmt.Println(u.RawPath)\nfmt.Println(u.RawQuery)\nfmt.Println(u.String())\n</code></pre>\n"}]